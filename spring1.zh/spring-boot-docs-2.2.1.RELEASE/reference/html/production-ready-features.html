<!DOCTYPE html>
<html lang="zh-Hans" ><head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Spring Boot Actuator：生产就绪功能</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head><body id="production-ready" class="book toc2 toc-left" ><div id="header">
<h1>Spring Boot Actuator：生产就绪功能</h1>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#production-ready-enabling">1。启用生产就绪功能</a></li>
<li><a href="#production-ready-endpoints">2。终点</a>
<ul class="sectlevel2">
<li><a href="#production-ready-endpoints-enabling-endpoints">2.1。启用端点</a></li>
<li><a href="#production-ready-endpoints-exposing-endpoints">2.2。暴露端点</a></li>
<li><a href="#production-ready-endpoints-security">2.3。保护HTTP端点</a></li>
<li><a href="#production-ready-endpoints-caching">2.4。配置端点</a></li>
<li><a href="#production-ready-endpoints-hypermedia">2.5。用于执行器Web端点的超媒体</a></li>
<li><a href="#production-ready-endpoints-cors">2.6。CORS支持</a></li>
<li><a href="#production-ready-endpoints-custom">2.7。实施自定义端点</a>
<ul class="sectlevel3">
<li><a href="#production-ready-endpoints-custom-input">2.7.1。接收输入</a>
<ul class="sectlevel4">
<li><a href="#production-ready-endpoints-custom-input-conversion">输入类型转换</a></li>
</ul>
</li>
<li><a href="#production-ready-endpoints-custom-web">2.7.2。自定义Web端点</a>
<ul class="sectlevel4">
<li><a href="#production-ready-endpoints-custom-web-predicate">Web端点请求谓词</a></li>
<li><a href="#production-ready-endpoints-custom-web-predicate-path">路径</a></li>
<li><a href="#production-ready-endpoints-custom-web-predicate-http-method">HTTP方法</a></li>
<li><a href="#production-ready-endpoints-custom-web-predicate-consumes">消耗</a></li>
<li><a href="#production-ready-endpoints-custom-web-predicate-produces">产生</a></li>
<li><a href="#production-ready-endpoints-custom-web-response-status">Web端点响应状态</a></li>
<li><a href="#production-ready-endpoints-custom-web-range-requests">Web端点范围请求</a></li>
<li><a href="#production-ready-endpoints-custom-web-security">Web端点安全</a></li>
</ul>
</li>
<li><a href="#production-ready-endpoints-custom-servlet">2.7.3。Servlet端点</a></li>
<li><a href="#production-ready-endpoints-custom-controller">2.7.4。控制器端点</a></li>
</ul>
</li>
<li><a href="#production-ready-health">2.8。健康资讯</a>
<ul class="sectlevel3">
<li><a href="#auto-configured-healthindicators">2.8.1。自动配置的健康指标</a></li>
<li><a href="#writing-custom-healthindicators">2.8.2。编写自定义健康指标</a></li>
<li><a href="#reactive-health-indicators">2.8.3。反应性健康指标</a></li>
<li><a href="#auto-configured-reactivehealthindicators">2.8.4。自动配置的ReactiveHealthIndicators</a></li>
<li><a href="#health-groups">2.8.5。卫生团体</a></li>
</ul>
</li>
<li><a href="#production-ready-application-info">2.9。应用信息</a>
<ul class="sectlevel3">
<li><a href="#production-ready-application-info-autoconfigure">2.9.1。自动配置的信息贡献者</a></li>
<li><a href="#production-ready-application-info-env">2.9.2。定制应用信息</a></li>
<li><a href="#production-ready-application-info-git">2.9.3。Git提交信息</a></li>
<li><a href="#production-ready-application-info-build">2.9.4。建造信息</a></li>
<li><a href="#production-ready-application-info-custom">2.9.5。编写自定义信息贡献者</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#production-ready-monitoring">3。通过HTTP进行监视和管理</a>
<ul class="sectlevel2">
<li><a href="#production-ready-customizing-management-server-context-path">3.1。自定义管理端点路径</a></li>
<li><a href="#production-ready-customizing-management-server-port">3.2。自定义管理服务器端口</a></li>
<li><a href="#production-ready-management-specific-ssl">3.3。配置特定于管理的SSL</a></li>
<li><a href="#production-ready-customizing-management-server-address">3.4。自定义管理服务器地址</a></li>
<li><a href="#production-ready-disabling-http-endpoints">3.5。禁用HTTP端点</a></li>
</ul>
</li>
<li><a href="#production-ready-jmx">4。通过JMX进行监视和管理</a>
<ul class="sectlevel2">
<li><a href="#production-ready-custom-mbean-names">4.1。自定义MBean名称</a></li>
<li><a href="#production-ready-disable-jmx-endpoints">4.2。禁用JMX端点</a></li>
<li><a href="#production-ready-jolokia">4.3。通过HTTP将Jolokia用于JMX</a>
<ul class="sectlevel3">
<li><a href="#production-ready-customizing-jolokia">4.3.1。自定义Jolokia</a></li>
<li><a href="#production-ready-disabling-jolokia">4.3.2。禁用Jolokia</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#production-ready-loggers">5，记录仪</a>
<ul class="sectlevel2">
<li><a href="#production-ready-logger-configuration">5.1。配置记录器</a></li>
</ul>
</li>
<li><a href="#production-ready-metrics">6。指标</a>
<ul class="sectlevel2">
<li><a href="#production-ready-metrics-getting-started">6.1。入门</a></li>
<li><a href="#production-ready-metrics-export">6.2。支持的监控系统</a>
<ul class="sectlevel3">
<li><a href="#production-ready-metrics-export-appoptics">6.2.1。AppOptics</a></li>
<li><a href="#production-ready-metrics-export-atlas">6.2.2。阿特拉斯</a></li>
<li><a href="#production-ready-metrics-export-datadog">6.2.3。数据狗</a></li>
<li><a href="#production-ready-metrics-export-dynatrace">6.2.4。动态痕迹</a></li>
<li><a href="#production-ready-metrics-export-elastic">6.2.5。有弹性</a></li>
<li><a href="#production-ready-metrics-export-ganglia">6.2.6。神经节</a></li>
<li><a href="#production-ready-metrics-export-graphite">6.2.7。石墨</a></li>
<li><a href="#production-ready-metrics-export-humio">6.2.8。悍马</a></li>
<li><a href="#production-ready-metrics-export-influx">6.2.9。涌入</a></li>
<li><a href="#production-ready-metrics-export-jmx">6.2.10。JMX</a></li>
<li><a href="#production-ready-metrics-export-kairos">6.2.11。Kairos数据库</a></li>
<li><a href="#production-ready-metrics-export-newrelic">6.2.12。新遗物</a></li>
<li><a href="#production-ready-metrics-export-prometheus">6.2.13。普罗米修斯</a></li>
<li><a href="#production-ready-metrics-export-signalfx">6.2.14。信号交换</a></li>
<li><a href="#production-ready-metrics-export-simple">6.2.15。简单</a></li>
<li><a href="#production-ready-metrics-export-statsd">6.2.16。统计数据</a></li>
<li><a href="#production-ready-metrics-export-wavefront">6.2.17。波前</a></li>
</ul>
</li>
<li><a href="#production-ready-metrics-meter">6.3。支持的指标</a>
<ul class="sectlevel3">
<li><a href="#production-ready-metrics-spring-mvc">6.3.1。Spring MVC指标</a></li>
<li><a href="#production-ready-metrics-web-flux">6.3.2。Spring WebFlux指标</a></li>
<li><a href="#production-ready-metrics-jersey-server">6.3.3。泽西岛服务器指标</a></li>
<li><a href="#production-ready-metrics-http-clients">6.3.4。HTTP客户端指标</a></li>
<li><a href="#production-ready-metrics-cache">6.3.5。缓存指标</a></li>
<li><a href="#production-ready-metrics-jdbc">6.3.6。数据源指标</a></li>
<li><a href="#production-ready-metrics-hibernate">6.3.7。休眠指标</a></li>
<li><a href="#production-ready-metrics-rabbitmq">6.3.8。RabbitMQ指标</a></li>
</ul>
</li>
<li><a href="#production-ready-metrics-custom">6.4。注册自定义指标</a></li>
<li><a href="#production-ready-metrics-per-meter-properties">6.5。自定义单个指标</a>
<ul class="sectlevel3">
<li><a href="#production-ready-metrics-common-tags">6.5.1。常用标签</a></li>
<li><a href="#per-meter-properties">6.5.2。每米属性</a></li>
</ul>
</li>
<li><a href="#production-ready-metrics-endpoint">6.6。指标终点</a></li>
</ul>
</li>
<li><a href="#production-ready-auditing">7。稽核</a>
<ul class="sectlevel2">
<li><a href="#production-ready-auditing-custom">7.1。定制审核</a></li>
</ul>
</li>
<li><a href="#production-ready-http-tracing">8。HTTP追踪</a>
<ul class="sectlevel2">
<li><a href="#production-ready-http-tracing-custom">8.1。自定义HTTP跟踪</a></li>
</ul>
</li>
<li><a href="#production-ready-process-monitoring">9。过程监控</a>
<ul class="sectlevel2">
<li><a href="#production-ready-process-monitoring-configuration">9.1。扩展配置</a></li>
<li><a href="#production-ready-process-monitoring-programmatically">9.2。以编程方式</a></li>
</ul>
</li>
<li><a href="#production-ready-cloudfoundry">10。Cloud Foundry支持</a>
<ul class="sectlevel2">
<li><a href="#production-ready-cloudfoundry-disable">10.1。禁用扩展的Cloud Foundry执行器支持</a></li>
<li><a href="#production-ready-cloudfoundry-ssl">10.2。Cloud Foundry自签名证书</a></li>
<li><a href="#custom-context-path">10.3。自定义上下文路径</a></li>
</ul>
</li>
<li><a href="#production-ready-whats-next">11。接下来要读什么</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot包含许多其他功能，可帮助您在将应用程序投入生产时监视和管理您的应用程序。您可以选择使用HTTP端点或JMX管理和监视应用程序。审核，运行状况和指标收集也可以自动应用于您的应用程序。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-enabling"><a class="anchor" href="#production-ready-enabling"></a> 1。启用生产就绪功能</h2>
<div class="sectionbody">
<div class="paragraph">
<p>的<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator"><code>spring-boot-actuator</code></a>该模块提供了Spring Boot生产就绪的所有功能。启用功能的最简单方法是将依赖项添加到<code>spring-boot-starter-actuator</code> '起动机'。</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">执行器的定义</div>
<div class="paragraph">
<p>致动器是制造术语，是指用于移动或控制某些物体的机械设备。执行器可以通过很小的变化产生大量的运动。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>要将执行器添加到基于Maven的项目中，请添加以下“ Starter”依赖项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Gradle，请使用以下声明：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile("org.springframework.boot:spring-boot-starter-actuator")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-endpoints"><a class="anchor" href="#production-ready-endpoints"></a> 2。终点</h2>
<div class="sectionbody">
<div class="paragraph">
<p>执行器端点使您可以监视应用程序并与之交互。Spring Boot包含许多内置端点，可让您添加自己的端点。例如， <code>health</code>端点提供基本的应用程序运行状况信息。</p>
</div>
<div class="paragraph">
<p>每个端点都可以<a href="#production-ready-endpoints-enabling-endpoints">启用或禁用</a> 。这控制了是否创建了端点以及它的bean在应用程序上下文中是否存在。为了可以远程访问，端点还必须<a href="#production-ready-endpoints-exposing-endpoints">通过JMX或HTTP公开</a> 。大多数应用程序选择HTTP，其中端点ID以及前缀为<code>/actuator</code>映射到URL。例如，默认情况下， <code>health</code>端点映射到<code>/actuator/health</code> 。</p>
</div>
<div class="paragraph">
<p>可以使用以下与技术无关的端点：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:28.5714%">
<col style="width:71.4286%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auditevents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公开当前应用程序的审核事件信息。需要一个<code>AuditEventRepository</code> bean 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beans</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示应用程序中所有Spring Bean的完整列表。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>caches</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公开可用的缓存。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示在配置和自动配置类上评估的条件以及它们匹配或不匹配的原因。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configprops</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示所有的整理列表<code>@ConfigurationProperties</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公开Spring的属性<code>ConfigurableEnvironment</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flyway</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示已应用的所有Flyway数据库迁移。需要一个或多个<code>Flyway</code>beans。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示应用程序运行状况信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httptrace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应交换）。需要一个<code>HttpTraceRepository</code> bean 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示任意应用程序信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integrationgraph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示Spring Integration图。需要依赖<code>spring-integration-core</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loggers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示和修改应用程序中记录器的配置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>liquibase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示已应用的所有Liquibase数据库迁移。需要一个或多个<code>Liquibase</code>beans。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示当前应用程序的“指标”信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mappings</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示所有的整理列表<code>@RequestMapping</code>路径。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheduledtasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">显示应用程序中的计划任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shutdown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使应用程序正常关闭。默认禁用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>threaddump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行线程转储。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果您的应用程序是Web应用程序（Spring MVC，Spring WebFlux或Jersey），则可以使用以下附加端点：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:28.5714%">
<col style="width:71.4286%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>heapdump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回一个<code>hprof</code>堆转储文件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jolokia</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过HTTP公开JMX bean（当Jolokia在类路径上时，不适用于WebFlux）。需要依赖<code>jolokia-core</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回日志文件的内容（如果<code>logging.file.name</code>要么<code>logging.file.path</code>属性已设置）。支持HTTP的使用<code>Range</code>标头，用于检索部分日志文件的内容。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prometheus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">以Prometheus服务器可以抓取的格式公开指标。需要依赖<code>micrometer-registry-prometheus</code> 。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要了解有关执行器端点及其请求和响应格式的更多信息，请参阅单独的API文档（ <a href="https://docs.spring.io/spring-boot/docs/2.2.1.RELEASE/actuator-api//html/">HTML</a>或<a href="https://docs.spring.io/spring-boot/docs/2.2.1.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a> ）。</p>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-enabling-endpoints"><a class="anchor" href="#production-ready-endpoints-enabling-endpoints"></a> 2.1。启用端点</h3>
<div class="paragraph">
<p>默认情况下，除<code>shutdown</code>已启用。要配置端点的启用，请使用其端点<code>management.endpoint.<id>.enabled</code>属性。以下示例启用了<code>shutdown</code>端点：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.shutdown.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您希望端点启用而不是退出，请设置<code>management.endpoints.enabled-by-default</code>财产<code>false</code>并使用单个端点<code>enabled</code>选择重新加入的属性。以下示例启用了<code>info</code>端点并禁用所有其他端点：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.enabled-by-default=false
management.endpoint.info.enabled=true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">禁用的端点将从应用程序上下文中完全删除。如果您只想更改端点公开的技术，请使用<a href="#production-ready-endpoints-exposing-endpoints"><code>include</code>和<code>exclude</code>属性</a>代替。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-exposing-endpoints"><a class="anchor" href="#production-ready-endpoints-exposing-endpoints"></a> 2.2。暴露端点</h3>
<div class="paragraph">
<p>由于端点可能包含敏感信息，因此应谨慎考虑何时公开它们。下表显示了内置端点的默认暴露：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">JMX</th>
<th class="tableblock halign-left valign-top">网页</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auditevents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beans</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>caches</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configprops</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flyway</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>heapdump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httptrace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integrationgraph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jolokia</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loggers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>liquibase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mappings</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prometheus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheduledtasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shutdown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>threaddump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>若要更改公开的端点，请使用以下特定于技术的<code>include</code>和<code>exclude</code>特性：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:75%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">默认</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.jmx.exposure.exclude</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.jmx.exposure.include</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.web.exposure.exclude</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.web.exposure.include</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>info, health</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>的<code>include</code>属性列出了公开的端点的ID。的<code>exclude</code>属性列出了不应公开的端点的ID。的<code>exclude</code>属性优先于<code>include</code>属性。都<code>include</code>和<code>exclude</code>可以使用端点ID列表配置属性。</p>
</div>
<div class="paragraph">
<p>例如，要停止通过JMX公开所有端点，而仅公开<code>health</code>和<code>info</code>端点，请使用以下属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.jmx.exposure.include=health,info</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>*</code>可用于选择所有端点。例如，通过HTTP公开除<code>env</code>和<code>beans</code>端点，请使用以下属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.web.exposure.include=*
management.endpoints.web.exposure.exclude=env,beans</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>*</code>在YAML中具有特殊含义，因此，如果要包括（或排除）所有端点，请确保添加引号，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">management:
  endpoints:
    web:
      exposure:
        include: "*"</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您的应用程序公开公开，我们强烈建议您也<a href="#production-ready-endpoints-security">保护端点</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">如果您想针对暴露端点的时间实施自己的策略，可以注册一个<code>EndpointFilter</code> bean 。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-security"><a class="anchor" href="#production-ready-endpoints-security"></a> 2.3。保护HTTP端点</h3>
<div class="paragraph">
<p>您应该像对待其他任何敏感URL一样，小心保护HTTP端点的安全。如果存在Spring Security，则默认情况下使用Spring Security的内容协商策略来保护端点安全。例如，如果您希望为HTTP端点配置自定义安全性，仅允许具有特定角色的用户访问它们，Spring Boot提供了一些方便的方法。 <code>RequestMatcher</code>可以与Spring Security结合使用的对象。</p>
</div>
<div class="paragraph">
<p>典型的Spring Security配置可能类似于以下示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration(proxyBeanMethods = false)
public class ActuatorSecurity extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests((requests) -&gt;
                requests.anyRequest().hasRole("ENDPOINT_ADMIN"));
        http.httpBasic();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>前面的示例使用<code>EndpointRequest.toAnyEndpoint()</code>将请求匹配到任何端点，然后确保所有端点都具有<code>ENDPOINT_ADMIN</code>角色。其他几种匹配方法也可以在<code>EndpointRequest</code> 。有关详细信息，请参见API文档（ <a href="https://docs.spring.io/spring-boot/docs/2.2.1.RELEASE/actuator-api//html">HTML</a>或<a href="https://docs.spring.io/spring-boot/docs/2.2.1.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a> ）。</p>
</div>
<div class="paragraph">
<p>如果将应用程序部署在防火墙后面，则可能希望可以在不进行身份验证的情况下访问所有执行器端点。您可以通过更改<code>management.endpoints.web.exposure.include</code>属性，如下所示：</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.web.exposure.include=*</code></pre>
</div>
</div>
<div class="paragraph">
<p>此外，如果存在Spring Security，则需要添加自定义安全配置，该配置允许未经身份验证的端点访问，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration(proxyBeanMethods = false)
public class ActuatorSecurity extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests((requests) -&gt;
            requests.anyRequest().permitAll());
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-caching"><a class="anchor" href="#production-ready-endpoints-caching"></a> 2.4。配置端点</h3>
<div class="paragraph">
<p>端点自动缓存对不带任何参数的读取操作的响应。要配置端点缓存响应的时间，请使用其响应时间。 <code>cache.time-to-live</code>属性。以下示例设置了<code>beans</code>端点的缓存到10秒：</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.beans.cache.time-to-live=10s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">前缀<code>management.endpoint.<name></code>用于唯一标识正在配置的端点。
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">发出经过身份验证的HTTP请求时， <code>Principal</code>被视为端点的输入，因此不会缓存响应。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-hypermedia"><a class="anchor" href="#production-ready-endpoints-hypermedia"></a> 2.5。用于执行器Web端点的超媒体</h3>
<div class="paragraph">
<p>添加了“发现页面”，其中包含指向所有端点的链接。“发现页面”位于<code>/actuator</code>默认。</p>
</div>
<div class="paragraph">
<p>配置自定义管理上下文路径后，“发现页面”会自动从<code>/actuator</code>到管理环境的根源。例如，如果管理上下文路径为<code>/management</code> ，然后可以从以下位置找到发现页面<code>/management</code> 。将管理上下文路径设置为<code>/</code> ，禁用发现页面以防止与其他映射发生冲突的可能性。</p>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-cors"><a class="anchor" href="#production-ready-endpoints-cors"></a> 2.6。CORS支持</h3>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">跨域资源共享</a> （CORS）是<a href="https://www.w3.org/TR/cors/">W3C规范</a> ，可让您灵活地指定授权哪种类型的跨域请求。如果使用Spring MVC或Spring WebFlux，则可以将Actuator的Web端点配置为支持此类方案。</p>
</div>
<div class="paragraph">
<p>默认情况下，CORS支持处于禁用状态，只有在<code>management.endpoints.web.cors.allowed-origins</code>属性已设置。以下配置允许<code>GET</code>和<code>POST</code>来自的呼叫<code>example.com</code>域：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.web.cors.allowed-origins=https://example.com
management.endpoints.web.cors.allowed-methods=GET,POST</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">有关选项的完整列表，请参见<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/CorsEndpointProperties.java">CorsEndpointProperties</a> 。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-endpoints-custom"><a class="anchor" href="#production-ready-endpoints-custom"></a> 2.7。实施自定义端点</h3>
<div class="paragraph">
<p>如果您添加一个<code>@Bean</code>带有注释<code>@Endpoint</code> ，任何带注解的方法<code>@ReadOperation</code> ， <code>@WriteOperation</code> ， 要么<code>@DeleteOperation</code>通过JMX以及Web应用程序中的HTTP自动公开。可以使用Jersey，Spring MVC或Spring WebFlux通过HTTP公开端点。如果同时提供Jersey和Spring MVC，将使用Spring MVC。</p>
</div>
<div class="paragraph">
<p>您还可以通过使用编写技术特定的端点<code>@JmxEndpoint</code>要么<code>@WebEndpoint</code> 。这些端点仅限于各自的技术。例如， <code>@WebEndpoint</code>仅通过HTTP而不是JMX公开。</p>
</div>
<div class="paragraph">
<p>您可以使用编写特定于技术的扩展<code>@EndpointWebExtension</code>和<code>@EndpointJmxExtension</code> 。这些注释使您可以提供特定于技术的操作来扩展现有端点。</p>
</div>
<div class="paragraph">
<p>最后，如果您需要访问特定于Web框架的功能，则可以实现Servlet或Spring <code>@Controller</code>和<code>@RestController</code>端点的代价是它们无法通过JMX或使用其他Web框架提供。</p>
</div>
<div class="sect3">
<h4 id="production-ready-endpoints-custom-input"><a class="anchor" href="#production-ready-endpoints-custom-input"></a> 2.7.1。接收输入</h4>
<div class="paragraph">
<p>端点上的操作通过其参数接收输入。通过网络公开时，这些参数的值取自URL的查询参数和JSON请求正文。通过JMX公开时，参数将映射到MBean操作的参数。默认情况下，参数是必需的。可以通过注释它们来使它们成为可选的<code>@org.springframework.lang.Nullable</code> 。</p>
</div>
<div class="paragraph">
<p>JSON请求正文中的每个根属性都可以映射到端点的参数。考虑以下JSON请求正文：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name": "test",
    "counter": 42
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这可以用来调用需要<code>String name</code>和<code>int counter</code>参数。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">由于端点与技术无关，因此只能在方法签名中指定简单类型。特别是使用自定义类型声明一个参数来定义一个<code>name</code>和<code>counter</code>不支持属性。
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">为了将输入映射到操作方法的参数，应使用以下命令编译实现端点的Java代码： <code>-parameters</code> ，并且实施端点的Kotlin代码应使用<code>-java-parameters</code> 。如果您使用的是Spring Boot的Gradle插件，或者您使用的是Maven和<code>spring-boot-starter-parent</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-input-conversion"><a class="anchor" href="#production-ready-endpoints-custom-input-conversion"></a>输入类型转换</h5>
<div class="paragraph">
<p>如有必要，传递给端点操作方法的参数会自动转换为所需的类型。在调用操作方法之前，通过JMX或HTTP请求接收的输入将使用的实例转换为所需的类型。 <code>ApplicationConversionService</code>以及任何<code>Converter</code>要么<code>GenericConverter</code>合格的 bean <code>@EndpointConverter</code> 。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-endpoints-custom-web"><a class="anchor" href="#production-ready-endpoints-custom-web"></a> 2.7.2。自定义Web端点</h4>
<div class="paragraph">
<p>操作上<code>@Endpoint</code> ， <code>@WebEndpoint</code> ， 要么<code>@EndpointWebExtension</code>使用Jersey，Spring MVC或Spring WebFlux通过HTTP自动公开。如果同时提供Jersey和Spring MVC，将使用Spring MVC。</p>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-predicate"><a class="anchor" href="#production-ready-endpoints-custom-web-predicate"></a> Web端点请求谓词</h5>
<div class="paragraph">
<p>对于在暴露于Web的端点上的每个操作，都会自动生成一个请求谓词。</p>
</div>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-predicate-path"><a class="anchor" href="#production-ready-endpoints-custom-web-predicate-path"></a>路径</h5>
<div class="paragraph">
<p>谓词的路径由终结点的ID和暴露于Web的终结点的基本路径确定。默认基本路径是<code>/actuator</code> 。例如，具有ID的端点<code>sessions</code>将使用<code>/actuator/sessions</code>作为它在谓词中的路径。</p>
</div>
<div class="paragraph">
<p>可以通过使用以下注释操作方法的一个或多个参数来进一步自定义路径<code>@Selector</code> 。这样的参数作为路径变量添加到路径谓词。当端点操作被调用时，变量的值被传递到操作方法中。如果要捕获所有剩余的路径元素，则可以添加<code>@Selector(Match=ALL_REMAINING)</code>到最后一个参数，并使其类型与<code>String[]</code> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-predicate-http-method"><a class="anchor" href="#production-ready-endpoints-custom-web-predicate-http-method"></a> HTTP方法</h5>
<div class="paragraph">
<p>谓词的HTTP方法由操作类型决定，如下表所示：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:75%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">运作方式</th>
<th class="tableblock halign-left valign-top">HTTP方法</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ReadOperation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@WriteOperation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DeleteOperation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-predicate-consumes"><a class="anchor" href="#production-ready-endpoints-custom-web-predicate-consumes"></a>消耗</h5>
<div class="paragraph">
<p>为一个<code>@WriteOperation</code> （HTTP <code>POST</code> ）使用请求主体，则谓词的消耗子句为<code>application/vnd.spring-boot.actuator.v2+json, application/json</code> 。对于所有其他操作，消耗子句为空。</p>
</div>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-predicate-produces"><a class="anchor" href="#production-ready-endpoints-custom-web-predicate-produces"></a>产生</h5>
<div class="paragraph">
<p>谓词的Produces子句可以由<code>produces</code>的属性<code>@DeleteOperation</code> ， <code>@ReadOperation</code>和<code>@WriteOperation</code>注释。该属性是可选的。如果未使用，则会自动确定produces子句。</p>
</div>
<div class="paragraph">
<p>如果操作方法返回<code>void</code>要么<code>Void</code> Produces子句为空。如果操作方法返回一个<code>org.springframework.core.io.Resource</code> ，produces子句是<code>application/octet-stream</code> 。对于所有其他操作，produces子句为<code>application/vnd.spring-boot.actuator.v2+json, application/json</code> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-response-status"><a class="anchor" href="#production-ready-endpoints-custom-web-response-status"></a> Web端点响应状态</h5>
<div class="paragraph">
<p>端点操作的默认响应状态取决于操作类型（读，写或删除）以及该操作返回的内容（如果有）。</p>
</div>
<div class="paragraph">
<p>一种<code>@ReadOperation</code>返回一个值，响应状态将为200（确定）。如果未返回值，则响应状态将为404（未找到）。</p>
</div>
<div class="paragraph">
<p>如果一个<code>@WriteOperation</code>要么<code>@DeleteOperation</code>返回一个值，响应状态将为200（确定）。如果未返回值，则响应状态将为204（无内容）。</p>
</div>
<div class="paragraph">
<p>如果在没有必需参数或无法将参数转换为必需类型的参数的情况下调用操作，则不会调用该操作方法，并且响应状态为400（错误请求）。</p>
</div>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-range-requests"><a class="anchor" href="#production-ready-endpoints-custom-web-range-requests"></a> Web端点范围请求</h5>
<div class="paragraph">
<p>HTTP范围请求可用于请求HTTP资源的一部分。使用Spring MVC或Spring Web Flux时，返回以下内容的操作<code>org.springframework.core.io.Resource</code>自动支持范围请求。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">使用Jersey时，范围请求不受支持。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="production-ready-endpoints-custom-web-security"><a class="anchor" href="#production-ready-endpoints-custom-web-security"></a> Web端点安全</h5>
<div class="paragraph">
<p>Web终结点或特定于Web的终结点扩展上的操作可以接收当前<code>java.security.Principal</code>要么<code>org.springframework.boot.actuate.endpoint.SecurityContext</code>作为方法参数。前者通常与<code>@Nullable</code>为经过身份验证和未经身份验证的用户提供不同的行为。后者通常用于执行授权检查， <code>isUserInRole(String)</code>方法。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-endpoints-custom-servlet"><a class="anchor" href="#production-ready-endpoints-custom-servlet"></a> 2.7.3。Servlet端点</h4>
<div class="paragraph">
<p>一种<code>Servlet</code>通过实现带有注释的类可以将其公开为端点<code>@ServletEndpoint</code>这也实现了<code>Supplier<EndpointServlet></code> 。Servlet端点提供与Servlet容器的更深层集成，但以可移植性为代价。它们旨在用于暴露现有的<code>Servlet</code>作为端点。对于新端点， <code>@Endpoint</code>和<code>@WebEndpoint</code>注释应尽可能首选。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-endpoints-custom-controller"><a class="anchor" href="#production-ready-endpoints-custom-controller"></a> 2.7.4。控制器端点</h4>
<div class="paragraph">
<p><code>@ControllerEndpoint</code>和<code>@RestControllerEndpoint</code>可以用于实现仅由Spring MVC或Spring WebFlux公开的端点。方法使用Spring MVC和Spring WebFlux的标准注释进行映射，例如<code>@RequestMapping</code>和<code>@GetMapping</code> ，将端点的ID用作路径的前缀。控制器端点提供了与Spring Web框架的更深层集成，但以可移植性为代价。的<code>@Endpoint</code>和<code>@WebEndpoint</code>注释应尽可能首选。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-health"><a class="anchor" href="#production-ready-health"></a> 2.8。健康资讯</h3>
<div class="paragraph">
<p>您可以使用运行状况信息来检查正在运行的应用程序的状态。监视软件通常使用它在生产系统出现故障时向某人发出警报。暴露的信息<code>health</code>端点取决于<code>management.endpoint.health.show-details</code>和<code>management.endpoint.health.show-components</code>可以使用以下值之一配置的属性：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:25%">
<col style="width:75%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>never</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">详细信息永远不会显示。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>when-authorized</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">详细信息仅显示给授权用户。可以使用以下命令配置授权角色<code>management.endpoint.health.roles</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>always</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">向所有用户显示详细信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>默认值为<code>never</code> 。当用户担任端点的一个或多个角色时，该用户被视为已授权。如果端点没有配置的角色（默认值），则所有经过身份验证的用户均被视为已授权。可以使用以下命令配置角色<code>management.endpoint.health.roles</code>属性。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您已保护自己的应用程序并希望使用<code>always</code> ，您的安全配置必须允许经过身份验证的用户和未经身份验证的用户都可以访问运行状况端点。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>健康信息是从<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributorRegistry.java"><code>HealthContributorRegistry</code></a> （默认情况下，全部<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributor.java"><code>HealthContributor</code></a>您中定义的实例<code>ApplicationContext</code> ）。Spring Boot包含许多自动配置的<code>HealthContributors</code>您也可以编写自己的。</p>
</div>
<div class="paragraph">
<p>一种<code>HealthContributor</code>可以是一个<code>HealthIndicator</code>或一个<code>CompositeHealthContributor</code> 。一种<code>HealthIndicator</code>提供实际的健康信息，包括<code>Status</code> 。一种<code>CompositeHealthContributor</code>提供其他的组合<code>HealthContributors</code> 。合起来，贡献者形成一个树形结构来代表整个系统的健康状况。</p>
</div>
<div class="paragraph">
<p>默认情况下，最终系统运行状况是由<code>StatusAggregator</code>从每个状态排序状态<code>HealthIndicator</code>根据状态的有序列表。排序列表中的第一个状态用作整体运行状况。如果不<code>HealthIndicator</code>返回状态为<code>StatusAggregator</code> ， <code>UNKNOWN</code>使用状态。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">的<code>HealthContributorRegistry</code>可用于在运行时注册和注销健康指标。
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="auto-configured-healthindicators"><a class="anchor" href="#auto-configured-healthindicators"></a> 2.8.1。自动配置的健康指标</h4>
<div class="paragraph">
<p>下列<code>HealthIndicators</code>在适当的情况下由Spring Boot自动配置：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:40%">
<col style="width:60%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraHealthIndicator.java"><code>CassandraHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Cassandra数据库是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java"><code>CouchbaseHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Couchbase群集是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java"><code>DiskSpaceHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查磁盘空间不足。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticSearchRestHealthContributorAutoConfiguration.java"><code>ElasticSearchRestHealthContributorAutoConfiguration</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Elasticsearch集群是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/hazelcast/HazelcastHealthIndicator.java"><code>HazelcastHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Hazelcast服务器是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java"><code>InfluxDbHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查InfluxDB服务器是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java"><code>JmsHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查JMS代理是否启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java"><code>MailHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查邮件服务器是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoHealthIndicator.java"><code>MongoHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Mongo数据库是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/PingHealthIndicator.java"><code>PingHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">始终以<code>UP</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java"><code>RabbitHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Rabbit服务器是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisHealthIndicator.java"><code>RedisHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Redis服务器是否启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/solr/SolrHealthIndicator.java"><code>SolrHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Solr服务器是否已启动。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">您可以通过设置<code>management.health.defaults.enabled</code>属性。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="writing-custom-healthindicators"><a class="anchor" href="#writing-custom-healthindicators"></a> 2.8.2。编写自定义健康指标</h4>
<div class="paragraph">
<p>要提供自定义健康信息，您可以注册实现<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a>接口。您需要提供<code>health()</code>方法并返回一个<code>Health</code>响应。的<code>Health</code>响应应包含状态，并可以选择包含要显示的其他详细信息。以下代码显示了一个示例<code>HealthIndicator</code>实施：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.springframework.boot.actuate.health.Health;
import org.springframework.boot.actuate.health.HealthIndicator;
import org.springframework.stereotype.Component;

@Component
public class MyHealthIndicator implements HealthIndicator {

    @Override
    public Health health() {
        int errorCode = check(); // perform some specific health check
        if (errorCode != 0) {
            return Health.down().withDetail("Error Code", errorCode).build();
        }
        return Health.up().build();
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">给定的标识符<code>HealthIndicator</code>是没有名称的Bean的名称<code>HealthIndicator</code>后缀（如果存在）。在前面的示例中，健康信息在名为的条目中可用<code>my</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>除了Spring Boot的预定义<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java"><code>Status</code></a>类型，也有可能<code>Health</code>返回自定义<code>Status</code>代表新的系统状态。在这种情况下， <a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/StatusAggregator.java"><code>StatusAggregator</code></a>还需要提供接口，或者必须使用<code>management.endpoint.health.status.order</code>配置属性。</p>
</div>
<div class="paragraph">
<p>例如，假设一个新<code>Status</code>带代码<code>FATAL</code>被用于您的其中之一<code>HealthIndicator</code>实现。要配置严重性顺序，请将以下属性添加到您的应用程序属性中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.health.status.order=fatal,down,out-of-service,unknown,up</code></pre>
</div>
</div>
<div class="paragraph">
<p>响应中的HTTP状态代码反映了总体健康状态（例如， <code>UP</code>映射到200，而<code>OUT_OF_SERVICE</code>和<code>DOWN</code>映射到503）。如果通过HTTP访问运行状况终结点，则可能还需要注册自定义状态映射。例如，以下属性映射<code>FATAL</code>到503（服务不可用）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.health.status.http-mapping.fatal=503</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">如果您需要更多控制权，则可以定义自己的<code>HttpCodeStatusMapper</code> bean 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>下表显示了内置状态的默认状态映射：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:25%">
<col style="width:75%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">状态</th>
<th class="tableblock halign-left valign-top">映射</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">下</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE_UNAVAILABLE（503）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">停止服务</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE_UNAVAILABLE（503）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">上</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认情况下没有映射，因此http状态为200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">未知</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认情况下没有映射，因此http状态为200</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="reactive-health-indicators"><a class="anchor" href="#reactive-health-indicators"></a> 2.8.3。反应性健康指标</h4>
<div class="paragraph">
<p>对于反应式应用程序（例如使用Spring WebFlux的应用程序）， <code>ReactiveHealthContributor</code>提供非阻塞性合同以获取应用程序运行状况。类似于传统<code>HealthContributor</code> ，健康信息是从<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthContributorRegistry.java"><code>ReactiveHealthContributorRegistry</code></a> （默认情况下，全部<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributor.java"><code>HealthContributor</code></a>和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthContributor.java"><code>ReactiveHealthContributor</code></a>您中定义的实例<code>ApplicationContext</code> ）。定期<code>HealthContributors</code>在弹性调度程序上执行不检查反应式API的命令。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">在反应式应用中， <code>ReactiveHealthContributorRegistry</code>可用于在运行时注册和注销健康指标。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>要从反应式API提供自定义健康信息，您可以注册实现<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java"><code>ReactiveHealthIndicator</code></a>接口。以下代码显示了一个示例<code>ReactiveHealthIndicator</code>实施：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class MyReactiveHealthIndicator implements ReactiveHealthIndicator {

    @Override
    public Mono&lt;Health&gt; health() {
        return doHealthCheck() //perform some specific health check that returns a Mono&lt;Health&gt;
            .onErrorResume(ex -&gt; Mono.just(new Health.Builder().down(ex).build()));
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">要自动处理错误，请考虑从<code>AbstractReactiveHealthIndicator</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="auto-configured-reactivehealthindicators"><a class="anchor" href="#auto-configured-reactivehealthindicators"></a> 2.8.4。自动配置的ReactiveHealthIndicators</h4>
<div class="paragraph">
<p>下列<code>ReactiveHealthIndicators</code>在适当的情况下由Spring Boot自动配置：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraReactiveHealthIndicator.java"><code>CassandraReactiveHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Cassandra数据库是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseReactiveHealthIndicator.java"><code>CouchbaseReactiveHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Couchbase群集是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoReactiveHealthIndicator.java"><code>MongoReactiveHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Mongo数据库是否已启动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisReactiveHealthIndicator.java"><code>RedisReactiveHealthIndicator</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查Redis服务器是否启动。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">如有必要，可用无功指示器代替常规指示器。还有，任何<code>HealthIndicator</code>未明确处理的内容将自动包装。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="health-groups"><a class="anchor" href="#health-groups"></a> 2.8.5。健康团体</h4>
<div class="paragraph">
<p>有时将健康指标组织为可用于不同目的的组很有用。例如，如果将应用程序部署到Kubernetes，则可能需要一组不同的运行状况指示器来进行“活动”和“就绪”探测。</p>
</div>
<div class="paragraph">
<p>要创建健康指标组，您可以使用<code>management.endpoint.health.group.<name></code>属性，并指定健康指标ID列表以<code>include</code>要么<code>exclude</code> 。例如，要创建仅包含数据库指示符的组，可以定义以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.health.group.custom.include=db</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以点击<code><a href="http://localhost:8080/actuator/health/custom" class="bare">localhost:8080/actuator/health/custom</a></code> 。</p>
</div>
<div class="paragraph">
<p>默认情况下，组将继承相同的<code>StatusAggregator</code>和<code>HttpCodeStatusMapper</code>设置作为系统运行状况，但是，这些设置也可以按组定义。也可以覆盖<code>show-details</code>和<code>roles</code>属性（如果需要）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.health.group.custom.show-details=when-authorized
management.endpoint.health.group.custom.roles=admin
management.endpoint.health.group.custom.status.order=fatal,up
management.endpoint.health.group.custom.status.http-mapping.fatal=500</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">您可以使用<code>@Qualifier("groupname")</code>如果您需要注册自定义<code>StatusAggregator</code>要么<code>HttpCodeStatusMapper</code>与组一起使用。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-application-info"><a class="anchor" href="#production-ready-application-info"></a> 2.9。应用信息</h3>
<div class="paragraph">
<p>应用程序信息公开了从所有收集的各种信息<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a>您定义的bean <code>ApplicationContext</code> 。Spring Boot包含许多自动配置的<code>InfoContributor</code> bean ，您可以编写自己的beans。</p>
</div>
<div class="sect3">
<h4 id="production-ready-application-info-autoconfigure"><a class="anchor" href="#production-ready-application-info-autoconfigure"></a> 2.9.1。自动配置的信息贡献者</h4>
<div class="paragraph">
<p>下列<code>InfoContributor</code>适当时，Spring Boot会自动配置bean：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java"><code>EnvironmentInfoContributor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公开来自<code>Environment</code>在下面<code>info</code>键。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java"><code>GitInfoContributor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">公开git信息，如果<code>git.properties</code>文件可用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java"><code>BuildInfoContributor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在以下情况下公开构建信息： <code>META-INF/build-info.properties</code>文件可用。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">可以通过设置<code>management.info.defaults.enabled</code>属性。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-application-info-env"><a class="anchor" href="#production-ready-application-info-env"></a> 2.9.2。定制应用信息</h4>
<div class="paragraph">
<p>您可以自定义由<code>info</code>通过设置端点<code>info.*</code>弹簧特性。所有<code>Environment</code>的属性<code>info</code>按键会自动暴露。例如，您可以将以下设置添加到您的<code>application.properties</code>文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">info.app.encoding=UTF-8
info.app.java.source=1.8
info.app.java.target=1.8</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p>除了对这些值进行硬编码之外，您还可以<a href="howto.html#howto-automatic-expansion">在构建时扩展info属性</a> 。</p>
</div>
<div class="paragraph">
<p>假设您使用Maven，则可以按如下所示重写前面的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">info.app.encoding=@project.build.sourceEncoding@
info.app.java.source=@java.version@
info.app.java.target=@java.version@</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-application-info-git"><a class="anchor" href="#production-ready-application-info-git"></a> 2.9.3。Git提交信息</h4>
<div class="paragraph">
<p>另一个有用的功能<code>info</code>端点是其发布有关您的状态的信息的能力<code>git</code>项目建立时的源代码存储库。如果一个<code>GitProperties</code> bean 可用， <code>git.branch</code> ， <code>git.commit.id</code>和<code>git.commit.time</code>属性是公开的。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">一种<code>GitProperties</code>如果一个<code>git.properties</code>该文件位于类路径的根目录。有关更多详细<a href="howto.html#howto-git-info">信息，</a>请参见“ <a href="howto.html#howto-git-info">生成git信息</a> ”。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果要显示完整的git信息（即<code>git.properties</code> ）， 使用<code>management.info.git.mode</code>属性，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.info.git.mode=full</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-application-info-build"><a class="anchor" href="#production-ready-application-info-build"></a> 2.9.4。建造信息</h4>
<div class="paragraph">
<p>如果一个<code>BuildProperties</code> bean 可用， <code>info</code>端点还可以发布有关构建的信息。如果发生<code>META-INF/build-info.properties</code>文件在类路径中可用。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">Maven和Gradle插件都可以生成该文件。有关更多详细<a href="howto.html#howto-build-info">信息，</a>请参见“ <a href="howto.html#howto-build-info">生成构建信息</a> ”。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-application-info-custom"><a class="anchor" href="#production-ready-application-info-custom"></a> 2.9.5。编写自定义信息贡献者</h4>
<div class="paragraph">
<p>要提供自定义应用程序信息，您可以注册实现<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a>接口。</p>
</div>
<div class="paragraph">
<p>以下示例有助于<code>example</code>具有单个值的条目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Collections;

import org.springframework.boot.actuate.info.Info;
import org.springframework.boot.actuate.info.InfoContributor;
import org.springframework.stereotype.Component;

@Component
public class ExampleInfoContributor implements InfoContributor {

    @Override
    public void contribute(Info.Builder builder) {
        builder.withDetail("example",
                Collections.singletonMap("key", "value"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果达到<code>info</code>端点，您应该看到包含以下附加条目的响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "example": {
        "key" : "value"
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-monitoring"><a class="anchor" href="#production-ready-monitoring"></a> 3。通过HTTP进行监视和管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果您正在开发Web应用程序，则Spring Boot Actuator会自动配置所有已启用的端点以通过HTTP公开。默认约定是使用<code>id</code>端点前缀为<code>/actuator</code>作为URL路径。例如， <code>health</code>被暴露为<code>/actuator/health</code> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">Spring MVC，Spring WebFlux和Jersey本身支持Actuator。如果同时提供Jersey和Spring MVC，将使用Spring MVC。
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="production-ready-customizing-management-server-context-path"><a class="anchor" href="#production-ready-customizing-management-server-context-path"></a> 3.1。自定义管理端点路径</h3>
<div class="paragraph">
<p>有时，自定义管理端点的前缀很有用。例如，您的应用程序可能已经使用<code>/actuator</code>为了另一个目的。您可以使用<code>management.endpoints.web.base-path</code>属性以更改管理端点的前缀，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.web.base-path=/manage</code></pre>
</div>
</div>
<div class="paragraph">
<p>前面的<code>application.properties</code>示例将端点从<code>/actuator/{id}</code>至<code>/manage/{id}</code> （例如， <code>/manage/info</code> ）。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">除非管理端口已配置为<a href="#production-ready-customizing-management-server-port">使用其他HTTP端口公开端点，</a>否则， <code>management.endpoints.web.base-path</code>相对于<code>server.servlet.context-path</code> 。如果<code>management.server.port</code>已配置， <code>management.endpoints.web.base-path</code>相对于<code>management.server.servlet.context-path</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果要将端点映射到其他路径，可以使用<code>management.endpoints.web.path-mapping</code>属性。</p>
</div>
<div class="paragraph">
<p>以下示例重新映射<code>/actuator/health</code>至<code>/healthcheck</code> ：</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.web.base-path=/
management.endpoints.web.path-mapping.health=healthcheck</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-customizing-management-server-port"><a class="anchor" href="#production-ready-customizing-management-server-port"></a> 3.2。自定义管理服务器端口</h3>
<div class="paragraph">
<p>对于基于云的部署，通过使用默认的HTTP端口公开管理端点是明智的选择。但是，如果您的应用程序在自己的数据中心内运行，则您可能更喜欢使用其他HTTP端口公开端点。</p>
</div>
<div class="paragraph">
<p>您可以设置<code>management.server.port</code>属性以更改HTTP端口，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.server.port=8081</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">在Cloud Foundry上，默认情况下，应用程序仅在端口8080上接收HTTP和TCP路由请求。如果要在Cloud Foundry上使用自定义管理端口，则需要明确设置应用程序的路由，以将流量转发到该自定义端口。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-management-specific-ssl"><a class="anchor" href="#production-ready-management-specific-ssl"></a> 3.3。配置特定于管理的SSL</h3>
<div class="paragraph">
<p>当配置为使用自定义端口时，还可以通过使用各种配置将管理服务器配置为其自己的SSL <code>management.server.ssl.*</code>属性。例如，这样做可以使管理服务器通过HTTP可用，而主应用程序使用HTTPS，如以下属性设置所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.port=8443
server.ssl.enabled=true
server.ssl.key-store=classpath:store.jks
server.ssl.key-password=secret
management.server.port=8080
management.server.ssl.enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，主服务器和管理服务器都可以使用SSL，但具有不同的密钥库，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.port=8443
server.ssl.enabled=true
server.ssl.key-store=classpath:main.jks
server.ssl.key-password=secret
management.server.port=8080
management.server.ssl.enabled=true
management.server.ssl.key-store=classpath:management.jks
management.server.ssl.key-password=secret</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-customizing-management-server-address"><a class="anchor" href="#production-ready-customizing-management-server-address"></a> 3.4。自定义管理服务器地址</h3>
<div class="paragraph">
<p>您可以通过设置以下选项来自定义管理端点可用的地址<code>management.server.address</code>属性。如果您只想在内部或面向操作的网络上侦听或仅侦听来自<code>localhost</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">仅当端口与主服务器端口不同时，您才能在其他地址上侦听。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>下面的例子<code>application.properties</code>不允许远程管理连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.server.port=8081
management.server.address=127.0.0.1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-disabling-http-endpoints"><a class="anchor" href="#production-ready-disabling-http-endpoints"></a> 3.5。禁用HTTP端点</h3>
<div class="paragraph">
<p>如果您不想通过HTTP公开端点，则可以将管理端口设置为<code>-1</code> ，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.server.port=-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>这可以通过使用<code>management.endpoints.web.exposure.exclude</code>属性，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.web.exposure.exclude=*</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-jmx"><a class="anchor" href="#production-ready-jmx"></a> 4。通过JMX进行监视和管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java管理扩展（JMX）提供了监视和管理应用程序的标准机制。默认情况下，此功能未启用，可以通过设置配置属性来启用<code>spring.jmx.enabled</code>至<code>true</code> 。Spring Boot将管理端点公开为JMX MBean，位于<code>org.springframework.boot</code>域默认情况下。</p>
</div>
<div class="sect2">
<h3 id="production-ready-custom-mbean-names"><a class="anchor" href="#production-ready-custom-mbean-names"></a> 4.1。自定义MBean名称</h3>
<div class="paragraph">
<p>MBean的名称通常是从<code>id</code>端点的例如， <code>health</code>端点暴露为<code>org.springframework.boot:type=Endpoint,name=Health</code> 。</p>
</div>
<div class="paragraph">
<p>如果您的应用程序包含多个Spring <code>ApplicationContext</code> ，您可能会发现名称冲突。要解决此问题，您可以设置<code>spring.jmx.unique-names</code>财产<code>true</code>因此MBean名称始终是唯一的。</p>
</div>
<div class="paragraph">
<p>您还可以自定义暴露端点的JMX域。以下设置显示了这样做的示例<code>application.properties</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">spring.jmx.unique-names=true
management.endpoints.jmx.domain=com.example.myapp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-disable-jmx-endpoints"><a class="anchor" href="#production-ready-disable-jmx-endpoints"></a> 4.2。禁用JMX端点</h3>
<div class="paragraph">
<p>如果您不想通过JMX公开端点，则可以设置<code>management.endpoints.jmx.exposure.exclude</code>财产<code>*</code> ，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoints.jmx.exposure.exclude=*</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-jolokia"><a class="anchor" href="#production-ready-jolokia"></a> 4.3。通过HTTP将Jolokia用于JMX</h3>
<div class="paragraph">
<p>Jolokia是一个JMX-HTTP桥，它提供了一种访问JMX Bean的替代方法。要使用Jolokia，请添加对<code>org.jolokia:jolokia-core</code> 。例如，使用Maven，您将添加以下依赖项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jolokia&lt;/groupId&gt;
    &lt;artifactId&gt;jolokia-core&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后可以通过添加Jolokia端点来暴露<code>jolokia</code>要么<code>*</code>到<code>management.endpoints.web.exposure.include</code>属性。然后，您可以使用来访问它<code>/actuator/jolokia</code>在您的管理HTTP服务器上。</p>
</div>
<div class="sect3">
<h4 id="production-ready-customizing-jolokia"><a class="anchor" href="#production-ready-customizing-jolokia"></a> 4.3.1。自定义Jolokia</h4>
<div class="paragraph">
<p>Jolokia具有许多传统上可以通过设置servlet参数进行配置的设置。借助Spring Boot，您可以使用<code>application.properties</code>文件。为此，请在参数前面加上<code>management.endpoint.jolokia.config.</code> ，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.jolokia.config.debug=true</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-disabling-jolokia"><a class="anchor" href="#production-ready-disabling-jolokia"></a> 4.3.2。禁用Jolokia</h4>
<div class="paragraph">
<p>如果您使用Jolokia但不希望Spring Boot对其进行配置，请设置<code>management.endpoint.jolokia.enabled</code>财产<code>false</code> ， 如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.endpoint.jolokia.enabled=false</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-loggers"><a class="anchor" href="#production-ready-loggers"></a> 5，记录仪</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot Actuator可以在运行时查看和配置应用程序的日志级别。您可以查看整个列表，也可以查看单个记录器的配置，该配置由显式配置的记录级别以及由记录框架赋予它的有效记录级别组成。这些级别可以是以下之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TRACE</code></p>
</li>
<li>
<p><code>DEBUG</code></p>
</li>
<li>
<p><code>INFO</code></p>
</li>
<li>
<p><code>WARN</code></p>
</li>
<li>
<p><code>ERROR</code></p>
</li>
<li>
<p><code>FATAL</code></p>
</li>
<li>
<p><code>OFF</code></p>
</li>
<li>
<p><code>null</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>null</code>表示没有显式配置。</p>
</div>
<div class="sect2">
<h3 id="production-ready-logger-configuration"><a class="anchor" href="#production-ready-logger-configuration"></a> 5.1。配置记录器</h3>
<div class="paragraph">
<p>要配置给定的记录器， <code>POST</code>资源URI的部分实体，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "configuredLevel": "DEBUG"
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">要“重置”记录器的特定级别（并使用默认配置），您可以传递值<code>null</code>作为<code>configuredLevel</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-metrics"><a class="anchor" href="#production-ready-metrics"></a> 6。指标</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot Actuator为<a href="https://micrometer.io">Micrometer</a>提供了依赖项管理和自动配置， <a href="https://micrometer.io">Micrometer</a>是一种支持多种监视系统的应用程序度量外观，包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#production-ready-metrics-export-appoptics">AppOptics</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-atlas">阿特拉斯</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-datadog">数据狗</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-dynatrace">动态痕迹</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-elastic">有弹性</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-ganglia">神经节</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-graphite">石墨</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-humio">悍马</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-influx">涌入</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-jmx">JMX</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-kairos">Kairos数据库</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-newrelic">新遗物</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-prometheus">普罗米修斯</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-signalfx">信号交换</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-simple">简单（内存中）</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-statsd">统计数据</a></p>
</li>
<li>
<p><a href="#production-ready-metrics-export-wavefront">波前</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">要了解有关Micrometer功能的更多信息，请参阅其<a href="https://micrometer.io/docs">参考文档</a> ，特别是<a href="https://micrometer.io/docs/concepts">概念部分</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="production-ready-metrics-getting-started"><a class="anchor" href="#production-ready-metrics-getting-started"></a> 6.1。入门</h3>
<div class="paragraph">
<p>Spring Boot自动配置组合<code>MeterRegistry</code>并为它在类路径中找到的每个受支持的实现添加一个注册表到组合中。依赖<code>micrometer-registry-{system}</code>在运行时类路径中，Spring Boot足以配置注册表。</p>
</div>
<div class="paragraph">
<p>大多数注册表具有共同的特征。例如，即使Micrometer注册表实现位于类路径中，您也可以禁用特定的注册表。例如，禁用Datadog：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.datadog.enabled=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot还会将任何自动配置的注册表添加到以下位置的全局静态复合注册表中： <code>Metrics</code>除非您明确告诉它不要：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.use-global-registry=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以注册任意数量的<code>MeterRegistryCustomizer</code> Bean在注册表中注册任何计量器之前，可以进一步配置注册表，例如应用通用标签：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
MeterRegistryCustomizer&lt;MeterRegistry&gt; metricsCommonTags() {
    return registry -&gt; registry.config().commonTags("region", "us-east-1");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过更具体地了解通用类型，将自定义项应用于特定的注册表实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
MeterRegistryCustomizer&lt;GraphiteMeterRegistry&gt; graphiteMetricsNamingConvention() {
    return registry -&gt; registry.config().namingConvention(MY_CUSTOM_CONVENTION);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>完成该设置后，您就可以注入<code>MeterRegistry</code>在您的组件中并注册指标：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class SampleBean {

    private final Counter counter;

    public SampleBean(MeterRegistry registry) {
        this.counter = registry.counter("received.messages");
    }

    public void handleMessage(String message) {
        this.counter.increment();
        // handle message implementation
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot还<a href="#production-ready-metrics-meter">配置了内置工具</a> （即<code>MeterBinder</code>实施），您可以通过配置或专用注释标记进行控制。</p>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-metrics-export"><a class="anchor" href="#production-ready-metrics-export"></a> 6.2。支持的监控系统</h3>
<div class="sect3">
<h4 id="production-ready-metrics-export-appoptics"><a class="anchor" href="#production-ready-metrics-export-appoptics"></a> 6.2.1。AppOptics</h4>
<div class="paragraph">
<p>默认情况下，AppOptics注册表将指标推送到<code><a href="https://api.appoptics.com/v1/measurements" class="bare">api.appoptics.com/v1/measurements</a></code>定期地。要将指标导出到SaaS <a href="https://micrometer.io/docs/registry/appoptics">AppOptics</a> ，必须提供您的API令牌：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.appoptics.api-token=YOUR_TOKEN</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-atlas"><a class="anchor" href="#production-ready-metrics-export-atlas"></a> 6.2.2。阿特拉斯</h4>
<div class="paragraph">
<p>默认情况下，度量标准将导出到在本地计算机上运行的<a href="https://micrometer.io/docs/registry/atlas">Atlas</a> 。可以使用以下命令提供要使用的<a href="https://github.com/Netflix/atlas">Atlas服务器</a>的位置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.atlas.uri=https://atlas.example.com:7101/api/v1/publish</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-datadog"><a class="anchor" href="#production-ready-metrics-export-datadog"></a> 6.2.3。数据狗</h4>
<div class="paragraph">
<p>Datadog注册表<a href="https://www.datadoghq.com">会</a>定期将指标推送到<a href="https://www.datadoghq.com">datadoghq</a> 。要将指标导出到<a href="https://micrometer.io/docs/registry/datadog">Datadog</a> ，必须提供您的API密钥：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.datadog.api-key=YOUR_KEY</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以更改将度量标准发送到Datadog的时间间隔：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.datadog.step=30s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-dynatrace"><a class="anchor" href="#production-ready-metrics-export-dynatrace"></a> 6.2.4。动态痕迹</h4>
<div class="paragraph">
<p>Dynatrace注册表会定期将指标推送到配置的URI。要将度量导出到<a href="https://micrometer.io/docs/registry/dynatrace">Dynatrace</a> ，必须提供您的API令牌，设备ID和URI：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.dynatrace.api-token=YOUR_TOKEN
management.metrics.export.dynatrace.device-id=YOUR_DEVICE_ID
management.metrics.export.dynatrace.uri=YOUR_URI</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以更改将度量标准发送到Dynatrace的时间间隔：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.dynatrace.step=30s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-elastic"><a class="anchor" href="#production-ready-metrics-export-elastic"></a> 6.2.5。有弹性</h4>
<div class="paragraph">
<p>默认情况下，指标会导出到在本地计算机上运行的<a href="https://micrometer.io/docs/registry/elastic">Elastic</a> 。可以使用以下属性提供要使用的Elastic服务器的位置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.elastic.host=https://elastic.example.com:8086</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-ganglia"><a class="anchor" href="#production-ready-metrics-export-ganglia"></a> 6.2.6。神经节</h4>
<div class="paragraph">
<p>默认情况下，度量标准导出到在本地计算机上运行的<a href="https://micrometer.io/docs/registry/ganglia">Ganglia</a> 。可以使用以下命令提供要使用的<a href="http://ganglia.sourceforge.net">Ganglia服务器</a>主机和端口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.ganglia.host=ganglia.example.com
management.metrics.export.ganglia.port=9649</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-graphite"><a class="anchor" href="#production-ready-metrics-export-graphite"></a> 6.2.7。石墨</h4>
<div class="paragraph">
<p>默认情况下，指标会导出到本地计算机上运行的<a href="https://micrometer.io/docs/registry/graphite">Graphite</a> 。可以使用以下方式提供要使用的<a href="https://graphiteapp.org">Graphite服务器</a>主机和端口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.graphite.host=graphite.example.com
management.metrics.export.graphite.port=9004</code></pre>
</div>
</div>
<div class="paragraph">
<p>千分尺提供默认值<code>HierarchicalNameMapper</code>它控制如何将维度计量器ID <a href="https://micrometer.io/docs/registry/graphite#_hierarchical_name_mapping">映射到平面层次结构名称</a> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">要控制此行为，请定义您的<code>GraphiteMeterRegistry</code>并提供自己的<code>HierarchicalNameMapper</code> 。自动配置<code>GraphiteConfig</code>和<code>Clock</code>提供了bean，除非您定义自己的bean：</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public GraphiteMeterRegistry graphiteMeterRegistry(GraphiteConfig config, Clock clock) {
    return new GraphiteMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-humio"><a class="anchor" href="#production-ready-metrics-export-humio"></a> 6.2.8。悍马</h4>
<div class="paragraph">
<p>默认情况下，Humio注册表<a href="https://cloud.humio.com" class="bare">会</a>定期将指标推送到<a href="https://cloud.humio.com" class="bare">cloud.humio.com</a> 。要将指标导出到SaaS <a href="https://micrometer.io/docs/registry/humio">Humio</a> ，必须提供您的API令牌：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.humio.api-token=YOUR_TOKEN</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还应该配置一个或多个标记以标识将度量标准推送到的数据源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.humio.tags.alpha=a
management.metrics.export.humio.tags.bravo=b</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-influx"><a class="anchor" href="#production-ready-metrics-export-influx"></a> 6.2.9。涌入</h4>
<div class="paragraph">
<p>默认情况下，指标会导出到本地计算机上运行的<a href="https://micrometer.io/docs/registry/influx">Influx</a> 。可使用以下命令提供要使用的<a href="https://www.influxdata.com">Influx服务器</a>的位置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.influx.uri=https://influx.example.com:8086</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-jmx"><a class="anchor" href="#production-ready-metrics-export-jmx"></a> 6.2.10。JMX</h4>
<div class="paragraph">
<p>千分尺提供了到<a href="https://micrometer.io/docs/registry/jmx">JMX</a>的层次结构映射，主要是作为一种便宜且可移植的方式在本地查看指标。默认情况下，指标会导出到<code>metrics</code> JMX域。可以使用以下方式提供要使用的域：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.jmx.domain=com.example.app.metrics</code></pre>
</div>
</div>
<div class="paragraph">
<p>千分尺提供默认值<code>HierarchicalNameMapper</code>它控制如何将维度计量器ID <a href="https://micrometer.io/docs/registry/jmx#_hierarchical_name_mapping">映射到平面层次结构名称</a> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">要控制此行为，请定义您的<code>JmxMeterRegistry</code>并提供自己的<code>HierarchicalNameMapper</code> 。自动配置<code>JmxConfig</code>和<code>Clock</code>提供了bean，除非您定义自己的bean：</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public JmxMeterRegistry jmxMeterRegistry(JmxConfig config, Clock clock) {
    return new JmxMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-kairos"><a class="anchor" href="#production-ready-metrics-export-kairos"></a> 6.2.11。Kairos数据库</h4>
<div class="paragraph">
<p>默认情况下，度量标准将导出到在本地计算机上运行的<a href="https://micrometer.io/docs/registry/kairos">KairosDB</a> 。可以使用以下命令提供要使用的<a href="https://kairosdb.github.io/">KairosDB服务器</a>的位置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.kairos.uri=https://kairosdb.example.com:8080/api/v1/datapoints</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-newrelic"><a class="anchor" href="#production-ready-metrics-export-newrelic"></a> 6.2.12。新遗物</h4>
<div class="paragraph">
<p>New Relic注册表会定期将指标推送到<a href="https://micrometer.io/docs/registry/new-relic">New Relic</a> 。要将指标导出到<a href="https://newrelic.com">New Relic</a> ，必须提供您的API密钥和帐户ID：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.newrelic.api-key=YOUR_KEY
management.metrics.export.newrelic.account-id=YOUR_ACCOUNT_ID</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以更改将度量标准发送到新遗物的时间间隔：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.newrelic.step=30s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-prometheus"><a class="anchor" href="#production-ready-metrics-export-prometheus"></a> 6.2.13。普罗米修斯</h4>
<div class="paragraph">
<p><a href="https://micrometer.io/docs/registry/prometheus">Prometheus</a>希望抓取或轮询单个应用程序实例以获取指标。Spring Boot提供了一个执行器端点<code>/actuator/prometheus</code>展示具有适当格式的<a href="https://prometheus.io">Prometheus抓取图片</a> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">端点默认情况下不可用，必须公开，有关更多详细信息，请参见<a href="#production-ready-endpoints-exposing-endpoints">暴露端点</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>这是一个例子<code>scrape_config</code>添加到<code>prometheus.yml</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">scrape_configs:
  - job_name: 'spring'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['HOST:PORT']</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于短暂的或批处理的作业，其时间可能不够长，无法被<a href="https://github.com/prometheus/pushgateway">废弃，</a>可以使用<a href="https://github.com/prometheus/pushgateway">Prometheus Pushgateway</a>支持将其指标暴露给Prometheus。要启用Prometheus Pushgateway支持，请在项目中添加以下依赖项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.prometheus&lt;/groupId&gt;
    &lt;artifactId&gt;simpleclient_pushgateway&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>当在类路径中存在Prometheus Pushgateway依赖项时，Spring Boot会自动配置一个<code>PrometheusPushGatewayManager</code> bean 。这可以管理将指标推送到Prometheus Pushgateway。的<code>PrometheusPushGatewayManager</code>可以使用下面的属性进行调整<code>management.metrics.export.prometheus.pushgateway</code> 。对于高级配置，您还可以提供自己的<code>PrometheusPushGatewayManager</code> bean 。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-signalfx"><a class="anchor" href="#production-ready-metrics-export-signalfx"></a> 6.2.14。信号交换</h4>
<div class="paragraph">
<p>SignalFx注册表<a href="https://micrometer.io/docs/registry/signalfx">会</a>定期将指标推送到<a href="https://micrometer.io/docs/registry/signalfx">SignalFx</a> 。要将指标导出到<a href="https://www.signalfx.com">SignalFx</a> ，必须提供您的访问令牌：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.signalfx.access-token=YOUR_ACCESS_TOKEN</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以更改将度量标准发送到SignalFx的时间间隔：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.signalfx.step=30s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-simple"><a class="anchor" href="#production-ready-metrics-export-simple"></a> 6.2.15。简单</h4>
<div class="paragraph">
<p>千分尺附带一个简单的内存后端，如果未配置其他注册表，该后端将自动用作后备。这使您可以查看在<a href="#production-ready-metrics-endpoint">度量标准端点</a>中收集了哪些度量<a href="#production-ready-metrics-endpoint">标准</a> 。</p>
</div>
<div class="paragraph">
<p>使用任何其他可用后端时，内存后端都会自行禁用。您也可以显式禁用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.simple.enabled=false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-statsd"><a class="anchor" href="#production-ready-metrics-export-statsd"></a> 6.2.16。统计数据</h4>
<div class="paragraph">
<p>StatsD注册表急切地通过UDP将度量标准推送到StatsD代理。默认情况下，指标会导出到本地计算机上运行的<a href="https://micrometer.io/docs/registry/statsd">StatsD</a>代理。可以使用以下方式提供要使用的StatsD代理主机和端口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.statsd.host=statsd.example.com
management.metrics.export.statsd.port=9125</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以更改要使用的StatsD线路协议（默认为Datadog）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.statsd.flavor=etsy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-export-wavefront"><a class="anchor" href="#production-ready-metrics-export-wavefront"></a> 6.2.17。波前</h4>
<div class="paragraph">
<p>Wavefront注册表会定期将指标推送到<a href="https://micrometer.io/docs/registry/wavefront">Wavefront</a> 。如果直接将指标导出到<a href="https://www.wavefront.com/">Wavefront</a> ，则必须提供API令牌：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.wavefront.api-token=YOUR_API_TOKEN</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，您可以使用在您的环境中设置的Wavefront辅助工具或内部代理，将指标数据转发到Wavefront API主机：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.wavefront.uri=proxy://localhost:2878</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">如果将指标发布到Wavefront代理（如<a href="https://docs.wavefront.com/proxies_installing.html">文档</a>中<a href="https://docs.wavefront.com/proxies_installing.html">所述</a> ），则主机必须位于<code>proxy://HOST:PORT</code>格式。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您还可以更改将度量标准发送到Wavefront的时间间隔：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.export.wavefront.step=30s</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-metrics-meter"><a class="anchor" href="#production-ready-metrics-meter"></a> 6.3。支持的指标</h3>
<div class="paragraph">
<p>如果适用，Spring Boot将注册以下核心指标：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JVM指标，报告以下各项的利用率：</p>
<div class="ulist">
<ul>
<li>
<p>各种内存和缓冲池</p>
</li>
<li>
<p>与垃圾收集有关的统计数据</p>
</li>
<li>
<p>线程利用率</p>
</li>
<li>
<p>加载/卸载的类数</p>
</li>
</ul>
</div>
</li>
<li>
<p>CPU指标</p>
</li>
<li>
<p>文件描述符指标</p>
</li>
<li>
<p>卡夫卡消费者指标</p>
</li>
<li>
<p>Log4j2指标：记录每个级别记录到Log4j2的事件数</p>
</li>
<li>
<p>Logback指标：记录每个级别记录到Logback的事件数</p>
</li>
<li>
<p>正常运行时间指标：报告正常运行时间的量度和代表应用程序绝对启动时间的固定量度</p>
</li>
<li>
<p>Tomcat指标（ <code>server.tomcat.mbeanregistry.enabled</code>必须设置为<code>true</code>用于所有要注册的Tomcat指标）</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-integration/docs/5.2.1.RELEASE/reference/html/system-management.html#micrometer-integration">Spring集成</a>指标</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-spring-mvc"><a class="anchor" href="#production-ready-metrics-spring-mvc"></a> 6.3.1。Spring MVC指标</h4>
<div class="paragraph">
<p>通过自动配置，可以检测由Spring MVC处理的请求。什么时候<code>management.metrics.web.server.request.autotime.enabled</code>是<code>true</code> ，此检测适用于所有请求。或者，当设置为<code>false</code> ，您可以通过添加启用检测<code>@Timed</code>到请求处理方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
@Timed <i class="conum" data-value="1"></i><b>(1)</b>
public class MyController {

    @GetMapping("/api/people")
    @Timed(extraTags = { "region", "us-east-1" }) <i class="conum" data-value="2"></i><b>(2)</b>
    @Timed(value = "all.people", longTask = true) <i class="conum" data-value="3"></i><b>(3)</b>
    public List&lt;Person&gt; listPeople() { ... }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>控制器类，用于对控制器中的每个请求处理程序启用计时。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>一种启用单个端点的方法。如果您将它放在类中，则不必这样做，但可以用于进一步为此特定端点自定义计时器。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>一种方法<code>longTask = true</code>为该方法启用一个长任务计时器。长任务计时器需要一个单独的度量标准名称，并且可以与短任务计时器堆叠在一起。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>默认情况下，指标使用以下名称生成： <code>http.server.requests</code> 。可以通过设置名称来自定义名称<code>management.metrics.web.server.request.metric-name</code>属性。</p>
</div>
<div class="paragraph">
<p>默认情况下，与Spring MVC相关的指标带有以下信息标记：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">标签</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理请求时引发的任何异常的简单类名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的方法（例如， <code>GET</code>要么<code>POST</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于响应状态码的请求结果。1xx是<code>INFORMATIONAL</code> ，2xx是<code>SUCCESS</code> ，3xx是<code>REDIRECTION</code> ，4xx <code>CLIENT_ERROR</code> ，而5xx是<code>SERVER_ERROR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应的HTTP状态代码（例如， <code>200</code>要么<code>500</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果可能，请在替换变量之前使用请求的URI模板（例如， <code>/api/person/{id}</code> ）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要自定义标签，请提供一个<code>@Bean</code>实现<code>WebMvcTagsProvider</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-web-flux"><a class="anchor" href="#production-ready-metrics-web-flux"></a> 6.3.2。Spring WebFlux指标</h4>
<div class="paragraph">
<p>通过自动配置，可以检测WebFlux控制器和功能处理程序处理的所有请求。</p>
</div>
<div class="paragraph">
<p>默认情况下，使用以下名称生成指标<code>http.server.requests</code> 。您可以通过设置<code>management.metrics.web.server.request.metric-name</code>属性。</p>
</div>
<div class="paragraph">
<p>默认情况下，与WebFlux相关的度量标准标记有以下信息：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">标签</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理请求时引发的任何异常的简单类名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的方法（例如， <code>GET</code>要么<code>POST</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于响应状态码的请求结果。1xx是<code>INFORMATIONAL</code> ，2xx是<code>SUCCESS</code> ，3xx是<code>REDIRECTION</code> ，4xx <code>CLIENT_ERROR</code> ，而5xx是<code>SERVER_ERROR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应的HTTP状态代码（例如， <code>200</code>要么<code>500</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果可能，请在替换变量之前使用请求的URI模板（例如， <code>/api/person/{id}</code> ）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要自定义标签，请提供一个<code>@Bean</code>实现<code>WebFluxTagsProvider</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-jersey-server"><a class="anchor" href="#production-ready-metrics-jersey-server"></a> 6.3.3。泽西岛服务器指标</h4>
<div class="paragraph">
<p>当千分尺<code>micrometer-jersey2</code>模块位于类路径上，自动配置可启用由Jersey JAX-RS实现处理的请求的检测。什么时候<code>management.metrics.web.server.request.autotime.enabled</code>是<code>true</code> ，此检测适用于所有请求。或者，当设置为<code>false</code> ，您可以通过添加启用检测<code>@Timed</code>到请求处理方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
@Path("/api/people")
@Timed <i class="conum" data-value="1"></i><b>(1)</b>
public class Endpoint {
    @GET
    @Timed(extraTags = { "region", "us-east-1" }) <i class="conum" data-value="2"></i><b>(2)</b>
    @Timed(value = "all.people", longTask = true) <i class="conum" data-value="3"></i><b>(3)</b>
    public List&lt;Person&gt; listPeople() { ... }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>在资源类上，以对资源中的每个请求处理程序启用计时。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>关于启用单个端点的方法。如果您将它放在类中，则不必这样做，但可以用于进一步为此特定端点自定义计时器。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>在与<code>longTask = true</code>为该方法启用一个长任务计时器。长任务计时器需要一个单独的度量标准名称，并且可以与短任务计时器堆叠在一起。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>默认情况下，指标使用以下名称生成： <code>http.server.requests</code> 。可以通过设置名称来自定义名称<code>management.metrics.web.server.request.metric-name</code>属性。</p>
</div>
<div class="paragraph">
<p>默认情况下，Jersey服务器指标带有以下信息：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">标签</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理请求时引发的任何异常的简单类名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的方法（例如， <code>GET</code>要么<code>POST</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于响应状态码的请求结果。1xx是<code>INFORMATIONAL</code> ，2xx是<code>SUCCESS</code> ，3xx是<code>REDIRECTION</code> ，4xx <code>CLIENT_ERROR</code> ，而5xx是<code>SERVER_ERROR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应的HTTP状态代码（例如， <code>200</code>要么<code>500</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果可能，请在变量替换之前使用请求的URI模板（例如， <code>/api/person/{id}</code> ）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要自定义标签，请提供一个<code>@Bean</code>实现<code>JerseyTagsProvider</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-http-clients"><a class="anchor" href="#production-ready-metrics-http-clients"></a> 6.3.4。HTTP客户端指标</h4>
<div class="paragraph">
<p>Spring Boot Actuator管理两者的仪器<code>RestTemplate</code>和<code>WebClient</code> 。为此，您必须注入自动配置的构建器并使用它来创建实例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RestTemplateBuilder</code>对于<code>RestTemplate</code></p>
</li>
<li>
<p><code>WebClient.Builder</code>对于<code>WebClient</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>也可以手动应用负责该工具的定制程序，即<code>MetricsRestTemplateCustomizer</code>和<code>MetricsWebClientCustomizer</code> 。</p>
</div>
<div class="paragraph">
<p>默认情况下，指标使用以下名称生成： <code>http.client.requests</code> 。可以通过设置名称来自定义名称<code>management.metrics.web.client.request.metric-name</code>属性。</p>
</div>
<div class="paragraph">
<p>默认情况下，由检测的客户端生成的度量标准标记有以下信息：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">标签</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI的主机部分</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的方法（例如， <code>GET</code>要么<code>POST</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于响应状态码的请求结果。1xx是<code>INFORMATIONAL</code> ，2xx是<code>SUCCESS</code> ，3xx是<code>REDIRECTION</code> ，4xx <code>CLIENT_ERROR</code> ，而5xx是<code>SERVER_ERROR</code> ， <code>UNKNOWN</code>除此以外</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应的HTTP状态代码（如果有）（例如， <code>200</code>要么<code>500</code> ）， 要么<code>IO_ERROR</code>如果发生I / O问题， <code>CLIENT_ERROR</code>除此以外</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果可能，请在替换变量之前使用请求的URI模板（例如， <code>/api/person/{id}</code> ）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要自定义标签，并根据您选择的客户端，可以提供一个<code>@Bean</code>实现<code>RestTemplateExchangeTagsProvider</code>要么<code>WebClientExchangeTagsProvider</code> 。有便利静态函数<code>RestTemplateExchangeTags</code>和<code>WebClientExchangeTags</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-cache"><a class="anchor" href="#production-ready-metrics-cache"></a> 6.3.5。缓存指标</h4>
<div class="paragraph">
<p>自动配置可以检测所有可用的<code>Cache</code>在启动时以前缀为指标<code>cache</code> 。高速缓存检测针对一组基本指标进行了标准化。还提供其他特定于缓存的指标。</p>
</div>
<div class="paragraph">
<p>支持以下缓存库：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>咖啡因</p>
</li>
<li>
<p>高速缓存2</p>
</li>
<li>
<p>淡褐色</p>
</li>
<li>
<p>任何兼容的JCache（JSR-107）实现</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>指标由缓存名称和<code>CacheManager</code>从Bean名称派生的。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">只有启动时可用的缓存才绑定到注册表。对于在启动阶段后即时或以编程方式创建的缓存，需要显式注册。一种<code>CacheMetricsRegistrar</code>可以使用bean来简化该过程。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-jdbc"><a class="anchor" href="#production-ready-metrics-jdbc"></a> 6.3.6。数据源指标</h4>
<div class="paragraph">
<p>自动配置可以检测所有可用的<code>DataSource</code>指标以开头的对象<code>jdbc.connections</code> 。数据源检测产生的量规表示池中当前活动，空闲，最大允许和最小允许的连接。</p>
</div>
<div class="paragraph">
<p>指标还标有<code>DataSource</code>根据Bean名称计算。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">默认情况下，Spring Boot为所有支持的数据源提供元数据。您可以添加其他<code>DataSourcePoolMetadataProvider</code>如果您的收藏夹不支持您喜欢的数据源。看到<code>DataSourcePoolMetadataProvidersConfiguration</code>举些例子。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>此外，针对Hikari的指标还带有<code>hikaricp</code>字首。每个指标均标有“池”的名称（可以通过<code>spring.datasource.name</code> ）。</p>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-hibernate"><a class="anchor" href="#production-ready-metrics-hibernate"></a> 6.3.7。休眠指标</h4>
<div class="paragraph">
<p>自动配置可以检测所有可用的Hibernate <code>EntityManagerFactory</code>具有名为的指标的统计信息的实例<code>hibernate</code> 。</p>
</div>
<div class="paragraph">
<p>指标还标有<code>EntityManagerFactory</code>从Bean名称派生的。</p>
</div>
<div class="paragraph">
<p>要启用统计信息，请使用标准的JPA属性<code>hibernate.generate_statistics</code>必须设置为<code>true</code> 。您可以启用自动配置<code>EntityManagerFactory</code>如下例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">spring.jpa.properties.hibernate.generate_statistics=true</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-rabbitmq"><a class="anchor" href="#production-ready-metrics-rabbitmq"></a> 6.3.8。RabbitMQ指标</h4>
<div class="paragraph">
<p>自动配置将启用名为metric的所有可用RabbitMQ连接工厂的检测<code>rabbitmq</code> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-metrics-custom"><a class="anchor" href="#production-ready-metrics-custom"></a> 6.4。注册自定义指标</h3>
<div class="paragraph">
<p>要注册自定义指标，请注入<code>MeterRegistry</code>放入您的组件中，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class Dictionary {

    private final List&lt;String&gt; words = new CopyOnWriteArrayList&lt;&gt;();

    Dictionary(MeterRegistry registry) {
        registry.gaugeCollectionSize("dictionary.size", Tags.empty(), this.words);
    }

    // …

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您发现您在组件或应用程序中反复测试了一套指标，则可以将该套件封装在<code>MeterBinder</code>实施。默认情况下，所有指标<code>MeterBinder</code> bean将自动绑定到Spring管理的<code>MeterRegistry</code> 。</p>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-metrics-per-meter-properties"><a class="anchor" href="#production-ready-metrics-per-meter-properties"></a> 6.5。自定义单个指标</h3>
<div class="paragraph">
<p>如果您需要将自定义应用于特定<code>Meter</code>您可以使用的实例<code>io.micrometer.core.instrument.config.MeterFilter</code>接口。默认情况下，所有<code>MeterFilter</code> bean 将自动应用于千分尺<code>MeterRegistry.Config</code> 。</p>
</div>
<div class="paragraph">
<p>例如，如果您想重命名<code>mytag.region</code>标记到<code>mytag.area</code>对于以<code>com.example</code> ，您可以执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public MeterFilter renameRegionTagMeterFilter() {
    return MeterFilter.renameTag("com.example", "mytag.region", "mytag.area");
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="production-ready-metrics-common-tags"><a class="anchor" href="#production-ready-metrics-common-tags"></a> 6.5.1。常用标签</h4>
<div class="paragraph">
<p>通用标签通常用于在操作环境（例如主机，实例，区域，堆栈等）上进行维度深入分析。通用标签适用于所有仪表，可以按以下示例所示进行配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.tags.region=us-east-1
management.metrics.tags.stack=prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例添加<code>region</code>和<code>stack</code>标记值所有的仪表<code>us-east-1</code>和<code>prod</code>分别。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果使用Graphite，则常用标签的顺序很重要。由于使用这种方法无法保证通用标签的顺序，建议石墨用户定义自定义标签<code>MeterFilter</code>代替。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="per-meter-properties"><a class="anchor" href="#per-meter-properties"></a> 6.5.2。每米属性</h4>
<div class="paragraph">
<p>此外<code>MeterFilter</code> Bean，也可以使用属性在每米的基础上应用一组有限的自定义设置。每表定制适用于以给定名称开头的所有所有表ID。例如，以下将禁用所有ID以以下开头的仪表<code>example.remote</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.metrics.enable.example.remote=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下属性允许按米自定义：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表格1。每米自定义</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.enable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否拒绝仪表发出任何指标。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.percentiles-histogram</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否发布适合计算可凝集（跨维度）百分位数逼近的直方图。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.minimum-expected-value</code> ，<code>management.metrics.distribution.maximum-expected-value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过限制期望值的范围来发布较少的直方图桶。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.percentiles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发布在应用程序中计算的百分位值</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.sla</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发布包含您的SLA定义的存储桶的累积直方图。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>有关背后概念的更多详细信息<code>percentiles-histogram</code> ， <code>percentiles</code>和<code>sla</code>请参阅千分尺文档的<a href="https://micrometer.io/docs/concepts#_histograms_and_percentiles">“直方图和百分位数”部分</a> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-metrics-endpoint"><a class="anchor" href="#production-ready-metrics-endpoint"></a> 6.6。指标终点</h3>
<div class="paragraph">
<p>Spring Boot提供了一个<code>metrics</code>可用于诊断检查应用程序收集的指标的端点。端点默认情况下不可用，必须公开，有关更多详细信息，请参见<a href="#production-ready-endpoints-exposing-endpoints">暴露端点</a> 。</p>
</div>
<div class="paragraph">
<p>导航到<code>/actuator/metrics</code>显示可用仪表名称的列表。您可以通过提供特定仪表的名称作为选择器来深入查看其信息，例如<code>/actuator/metrics/jvm.memory.max</code> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p>您在此处使用的名称应与代码中使用的名称相匹配，而不是已针对其出厂的监视系统将其命名惯例标准化后的名称。换句话说，如果<code>jvm.memory.max</code>显示为<code>jvm_memory_max</code>在Prometheus中，由于其蛇形命名约定，您仍应使用<code>jvm.memory.max</code>在检查仪表时作为选择器<code>metrics</code>端点。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您也可以添加任意数量的<code>tag=KEY:VALUE</code>将查询参数查询到URL的末尾以按维度向下钻取仪表，例如<code>/actuator/metrics/jvm.memory.max?tag=area:nonheap</code> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p>报告的测量值是与仪表名称和已应用的任何标签相匹配的所有仪表的统计信息的<em>总和</em> 。因此，在上面的示例中，返回的“值”统计量是堆的“代码缓存”，“压缩类空间”和“元空间”区域的最大内存占用量的总和。如果您只想查看“ Metaspace”的最大大小，则可以添加其他<code>tag=id:Metaspace</code> ，即<code>/actuator/metrics/jvm.memory.max?tag=area:nonheap&tag=id:Metaspace</code> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-auditing"><a class="anchor" href="#production-ready-auditing"></a> 7。稽核</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一旦启动了Spring Security，Spring Boot Actuator将拥有一个灵活的审核框架来发布事件（默认情况下，“身份验证成功”，“失败”和“访问被拒绝”异常）。此功能对于基于身份验证失败的报告和实施锁定策略非常有用。</p>
</div>
<div class="paragraph">
<p>可以通过提供以下类型的bean来启用审核<code>AuditEventRepository</code>在应用程序的配置中。为了方便起见，Spring Boot提供了一个<code>InMemoryAuditEventRepository</code> 。
<code>InMemoryAuditEventRepository</code>功能有限，我们建议仅将其用于开发环境。对于生产环境，请考虑创建自己的替代方案<code>AuditEventRepository</code>实施。</p>
</div>
<div class="sect2">
<h3 id="production-ready-auditing-custom"><a class="anchor" href="#production-ready-auditing-custom"></a> 7.1。定制审核</h3>
<div class="paragraph">
<p>要自定义已发布的安全事件，您可以提供自己的实现<code>AbstractAuthenticationAuditListener</code>和<code>AbstractAuthorizationAuditListener</code> 。</p>
</div>
<div class="paragraph">
<p>您也可以将审核服务用于自己的业务事件。为此，请注入<code>AuditEventRepository</code> Bean放入您自己的组件中，并直接使用它或发布一个<code>AuditApplicationEvent</code>与春天<code>ApplicationEventPublisher</code> （通过实施<code>ApplicationEventPublisherAware</code> ）。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-http-tracing"><a class="anchor" href="#production-ready-http-tracing"></a> 8。HTTP追踪</h2>
<div class="sectionbody">
<div class="paragraph">
<p>通过提供以下类型的bean可以启用HTTP跟踪<code>HttpTraceRepository</code>在应用程序的配置中。为了方便起见，Spring Boot提供了一个<code>InMemoryHttpTraceRepository</code>默认情况下存储最后100次请求-响应交换的跟踪。
<code>InMemoryHttpTraceRepository</code>与其他跟踪解决方案相比，它受到限制，我们建议仅将其用于开发环境。对于生产环境，建议使用可用于生产的跟踪或可观察性解决方案，例如Zipkin或Spring Cloud Sleuth。或者，创建自己的<code>HttpTraceRepository</code>满足您的需求。</p>
</div>
<div class="paragraph">
<p>的<code>httptrace</code>端点可用于获取有关存储在服务器中的请求-响应交换的信息<code>HttpTraceRepository</code> 。</p>
</div>
<div class="sect2">
<h3 id="production-ready-http-tracing-custom"><a class="anchor" href="#production-ready-http-tracing-custom"></a> 8.1。自定义HTTP跟踪</h3>
<div class="paragraph">
<p>要自定义每个跟踪中包含的项目，请使用<code>management.trace.http.include</code>配置属性。对于高级定制，请考虑注册自己的<code>HttpExchangeTracer</code>实施。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-process-monitoring"><a class="anchor" href="#production-ready-process-monitoring"></a> 9。过程监控</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在里面<code>spring-boot</code>模块中，您可以找到两个类来创建通常对过程监视有用的文件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ApplicationPidFileWriter</code>在应用程序目录中创建一个包含应用程序PID的文件（默认情况下，文件名为<code>application.pid</code> ）。</p>
</li>
<li>
<p><code>WebServerPortFileWriter</code>在应用程序目录中创建一个包含运行Web服务器端口的文件（默认情况下，文件名为<code>application.port</code> ）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下，不会激活这些编写器，但是您可以启用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#production-ready-process-monitoring-configuration">通过扩展配置</a></p>
</li>
<li>
<p><a href="#production-ready-process-monitoring-programmatically">以编程方式</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="production-ready-process-monitoring-configuration"><a class="anchor" href="#production-ready-process-monitoring-configuration"></a> 9.1。扩展配置</h3>
<div class="paragraph">
<p>在里面<code>META-INF/spring.factories</code>文件，您可以激活写入PID文件的侦听器，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.springframework.context.ApplicationListener=\
org.springframework.boot.context.ApplicationPidFileWriter,\
org.springframework.boot.web.context.WebServerPortFileWriter</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-process-monitoring-programmatically"><a class="anchor" href="#production-ready-process-monitoring-programmatically"></a> 9.2。以编程方式</h3>
<div class="paragraph">
<p>您也可以通过调用<code>SpringApplication.addListeners(…​)</code>方法并通过适当的<code>Writer</code>宾语。此方法还允许您自定义文件名和路径<code>Writer</code>构造函数。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-cloudfoundry"><a class="anchor" href="#production-ready-cloudfoundry"></a> 10。Cloud Foundry支持</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Boot的执行器模块包括额外的支持，当您将其部署到兼容的Cloud Foundry实例时就会激活。的<code>/cloudfoundryapplication</code>路径为所有人提供了替代的安全路径<code>@Endpoint</code>beans。</p>
</div>
<div class="paragraph">
<p>扩展支持使Cloud Foundry管理UI（例如可用于查看已部署的应用程序的Web应用程序）增加了Spring Boot执行器信息。例如，应用程序状态页面可能包含完整的运行状况信息，而不是典型的“正在运行”或“已停止”状态。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">的<code>/cloudfoundryapplication</code>普通用户不能直接访问路径。为了使用端点，必须将有效的UAA令牌与请求一起传递。</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="production-ready-cloudfoundry-disable"><a class="anchor" href="#production-ready-cloudfoundry-disable"></a> 10.1。禁用扩展的Cloud Foundry执行器支持</h3>
<div class="paragraph">
<p>如果要完全禁用<code>/cloudfoundryapplication</code>端点，您可以将以下设置添加到您的<code>application.properties</code>文件：</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.cloudfoundry.enabled=false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="production-ready-cloudfoundry-ssl"><a class="anchor" href="#production-ready-cloudfoundry-ssl"></a> 10.2。Cloud Foundry自签名证书</h3>
<div class="paragraph">
<p>默认情况下，针对<code>/cloudfoundryapplication</code>端点对各种Cloud Foundry服务进行SSL调用。如果您的Cloud Foundry UAA或Cloud Controller服务使用自签名证书，则需要设置以下属性：</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">management.cloudfoundry.skip-ssl-validation=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-context-path"><a class="anchor" href="#custom-context-path"></a> 10.3。自定义上下文路径</h3>
<div class="paragraph">
<p>如果服务器的上下文路径已配置为除<code>/</code> ，则Cloud Foundry端点在应用程序的根目录将不可用。例如，如果<code>server.servlet.context-path=/app</code> ，Cloud Foundry端点将在以下位置可用<code>/app/cloudfoundryapplication/*</code> 。</p>
</div>
<div class="paragraph">
<p>如果您希望Cloud Foundry端点始终在以下位置可用<code>/cloudfoundryapplication/*</code> ，无论服务器的上下文路径如何，您都需要在应用程序中进行显式配置。配置将根据所使用的Web服务器而有所不同。对于Tomcat，可以添加以下配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public TomcatServletWebServerFactory servletWebServerFactory() {
    return new TomcatServletWebServerFactory() {

        @Override
        protected void prepareContext(Host host, ServletContextInitializer[] initializers) {
            super.prepareContext(host, initializers);
            StandardContext child = new StandardContext();
            child.addLifecycleListener(new Tomcat.FixContextListener());
            child.setPath("/cloudfoundryapplication");
            ServletContainerInitializer initializer = getServletContextInitializer(getContextPath());
            child.addServletContainerInitializer(initializer, Collections.emptySet());
            child.setCrossContext(true);
            host.addChild(child);
        }

    };
}

private ServletContainerInitializer getServletContextInitializer(String contextPath) {
    return (c, context) -&gt; {
        Servlet servlet = new GenericServlet() {

            @Override
            public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException {
                ServletContext context = req.getServletContext().getContext(contextPath);
                context.getRequestDispatcher("/cloudfoundryapplication").forward(req, res);
            }

        };
        context.addServlet("cloudfoundry", servlet).addMapping("/*");
    };
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready-whats-next"><a class="anchor" href="#production-ready-whats-next"></a> 11。接下来要读什么</h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果您想探索本章中讨论的一些概念，则可以查看执行器<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.1.RELEASE/spring-boot-samples">示例应用程序</a> 。您可能还想阅读有关<a href="https://graphiteapp.org">Graphite之类的</a>图形工具的信息。</p>
</div>
<div class="paragraph">
<p>否则，您可以继续阅读<a href="deployment.html#deployment">“部署选项”，</a>或者继续阅读有关Spring Boot的<em><a href="build-tool-plugins.html#build-tool-plugins">构建工具插件的</a></em>一些深入信息。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">最近更新时间2019-11-06 21:59:19 UTC</div>
</div>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
<link rel="stylesheet" href="js/highlight/styles/github.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>

</body></html>