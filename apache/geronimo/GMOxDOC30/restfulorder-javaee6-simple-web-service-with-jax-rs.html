<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="restfulorder-javaee6 - Simple Web Service with JAX-RS" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi restfulorder-javaee6 - Simple Web Service with JAX-RS" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: restfulorder-javaee6 - Simple Web Service with JAX-RS</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="reference.html">Reference</a>&nbsp;&gt;&nbsp;<a href="samples.html">Samples</a>&nbsp;&gt;&nbsp;<a href="java-ee-sample-applications.html">Java EE sample applications</a>&nbsp;&gt;&nbsp;<a href="restfulorder-javaee6-simple-web-service-with-jax-rs.html">restfulorder-javaee6 - Simple Web Service with JAX-RS</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">restfulorder-javaee6 - Simple Web Service with JAX-RS</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24192541">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24192541">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=24192541">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=24192541">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=24192541">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=24192541">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<h1 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-ApplicationOverviewapplication">Application Overview <parameter ac:name="">application</parameter></h1>
<p>This sample application demonstrates a simple order system which can get, delete, and edit ordering data using RESTful Web services. This RESTful Web services application works at XML message level. It uses the Asynchronous JavaScript and XML (Ajax) technique to combine Java technologies, XML, and JavaScript for the web service applications to uses client-side scripting to exchange data with the server. When a user creates a new order or edits an existing one, the resource data is converted into XML schema for processing. This web service is exposed as a Servlet in the Geronimo application server. See <a shape="rect" href="restful-web-services.html">RESTful Web services</a> for more information on the concept.</p>



<h1 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-Applicationcontents">Application contents</h1>

<p>The restfulorder-javaee6 application is deployed as a WAR to the application server. The overview of the structural content of this WAR file is given as follows.</p>

<parameter ac:name="borderColor">#FFFFFF</parameter><parameter ac:name="bgColor">#FFFFFF</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
|-restfulorder-javaee6.war
   +-index.html
   +-rest
	+- restfulorder
	+- Support.js
	+- showAll.html
   +-WEB-INF
	+- web.xml
        +- classes
               +- org.apache.geronimo.samples.javaee6.restfulorder
               +- META-INF
   +-META-INF
</plain-text-body>

<p>The <code>org.apache.geronimo.samples.javaee6.restfulorder</code> package consists of the following files.</p>

<parameter ac:name="borderColor">#FFFFFF</parameter><parameter ac:name="bgColor">#FFFFFF</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
+- org.apache.geronimo.samples.javaee6.restfulorder
   +-service
	+- RestfulordersResource.class
	+- RestfulorderResource.class
   +-config
	+- ApplicationConfig.class
   +-converter
	+- RestfulorderConverter.class
	+- RestfulordersConverter.class
   +-entities
	+- Restfulorder.class
   +-JPASessionBeans
</plain-text-body>

<p>where,</p>
<ul><li>The <strong>service</strong> folder contains the resource classes of the RESTful application.</li><li>The <strong>config</strong> folder contains the servlet class that extends <code>javax.ws.rs.core.Application</code> to configure the application classes within a JAX-RS runtime. The <code>javax.ws.rs.core.Application</code> class provides methods that can specify a set of root resources and providers accessible from a specified application path. This way users can specify several groups of resources in a single application.</li><li>The <strong>converter</strong> folder contains Java Architecture for XML Binding (JAXB) annotated classes to support the processing of XML in requests and responses.</li><li>The <strong>entities</strong> folder contains an entity class that represents the table of order information in the database.
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>


<p>When running the restfulorder-javaee6 application, <strong>index.html</strong> is launched as the welcome-file as specified in <strong>web.xml</strong>. From <strong>index.html</strong>, <strong>showAll.html</strong> is called. By clicking the <strong>Add a new order</strong> link on <strong>showAll.html</strong>, you are linked to <strong>addOrder.html</strong>. On this page, you can create a new order by inputting data into the fields. The order data is received by a <strong>Restfulorder</strong> JavaScript object which provides methods to record and configure the order resource into <code>String</code> type. Then, an <code>addItem</code> method provided by <strong>Restfulorders.js</strong> is called to add the new order resource into the database. The working process is as follows:</p>

<ol><li>The <code>addItem</code> method calls a <code>postJson</code> method to send a <code>XMLHttpRequest</code> containing the resource data in <code>application/json</code> type to the servlet class <strong>ApplicationConfig</strong>.</li><li>The <code>XMLHttpRequest</code> arrives at the servlet just like a <code>HttpServletRequest</code>. After parsing the request parameters, the servlet will invoke the necessary application logic. For this application, the request methods from <strong>RestfulordersResource</strong> and <strong>RestfulorderResource</strong> classes are called according to the request type.</li><li>The request methods handle resource data at XML message level by adopting a JAXB object instance of <strong>RestfulorderConverter</strong> or <strong>RestfulordersConverter</strong> to process resource data in XML format.</li><li>The order data is recorded into the database by accessing the <strong>Restfulorder</strong> entity class with a <strong>RestfulorderConverter</strong> or <strong>RestfulordersConverter</strong> object instance.</li></ol>



<h1 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-Applicationimplementation">Application implementation</h1>
<p>The <code>postJson</code> method, called to send a <code>XMLHttpRequest</code> to the servlet class, uses the Ajax technique provided in the following JavaScript <strong>support.js</strong>.</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">support.js</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
var rjsSupport = {

    proxy : "",
    
    getHttpProxy: function() {
        return this.proxy;
    },
    
    setHttpProxy: function(proxy_) {
        this.proxy = proxy_;
    },
    
    isSetHttpProxy: function() {
        return this.getHttpProxy().length &gt; 0;
    },

    getHttpRequest: function() {
        var xmlHttpReq;
        try
        {    // Firefox, Opera 8.0+, Safari, IE7.0+
            xmlHttpReq=new XMLHttpRequest();
        }
        catch (e)
        {    // Internet Explorer 6.0+, 5.0+
            try
            {
                xmlHttpReq=new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e)
            {
                try
                {
                    xmlHttpReq=new ActiveXObject("Microsoft.XMLHTTP");
                }
                catch (e)
                {
                    this.debug("Your browser does not support AJAX!");
                }
            }
        }
        return xmlHttpReq;
    },
    
    findUrl : function(url, method) {
        var url2 = url;
        if(this.isSetHttpProxy())
            url2 = this.getHttpProxy()+"?method="+method+"&amp;url="+url2;
        return url2;
    },

    findMethod : function(method) {
        var method2 = method;
        if(method != "GET" &amp;&amp; this.isSetHttpProxy())
            method2 = "POST";
        return method2;
    },

    open : function(method2, url2, mimeType, paramLen, async) {

        //Change url and method if using http proxy
        var url = this.findUrl(url2, method2);
        var method = this.findMethod(method2);

        //add timestamp to make url unique in case of IE7
        var timestamp = new Date().getTime();
        if(url.indexOf("?") != -1)
            url = url+"&amp;timestamp="+timestamp;
        else
            url = url+"?timestamp="+timestamp;

        var xmlHttpReq = this.getHttpRequest();
        if(xmlHttpReq == null) {
            this.debug('Error: Cannot create XMLHttpRequest');
            return null;
        }
        try {
            netscape.security.PrivilegeManager.enablePrivilege ("UniversalBrowserRead");
        } catch (e) {
        //this.debug("Permission UniversalBrowserRead denied.");
        }
        try {
            xmlHttpReq.open(method, url, async);
        } catch( e ) {
            this.debug('Error: XMLHttpRequest.open failed for: '+url+' Error name: '+e.name+' Error message: '+e.message);
            return null;
        }
        if (mimeType != null) {
            if(method == 'GET') {
                //this.debug("setting GET accept: "+mimeType);
                xmlHttpReq.setRequestHeader('Accept', mimeType);
            } else if(method == 'POST' || method == 'PUT'){
                //this.debug("setting content-type: "+mimeType);
                //Send the proper header information along with the request
                xmlHttpReq.setRequestHeader("Content-Type", mimeType);
                xmlHttpReq.setRequestHeader("Content-Length", paramLen);
                xmlHttpReq.setRequestHeader("Connection", "close");
            }
        }
        //For cache control on IE7
        xmlHttpReq.setRequestHeader("Cache-Control", "no-cache");
        xmlHttpReq.setRequestHeader("Pragma", "no-cache");
        xmlHttpReq.setRequestHeader("Expires", "-1");

        return xmlHttpReq;
    },

    loadXml : function(xmlStr) {
        var doc2;
        // code for IE
        if (window.ActiveXObject)
        {
            doc2=new ActiveXObject("Microsoft.XMLDOM");
            doc2.async="false";
            doc2.loadXML(xmlStr);
        }
        // code for Mozilla, Firefox, Opera, etc.
        else
        {
            var parser=new DOMParser();
            doc2=parser.parseFromString(xmlStr,getDefaultMime());
        }
        return doc2;
    },

    findIdFromUrl : function(u) {
        var li = u.lastIndexOf('/');
        if(li != -1) {
            var u2 = u.substring(0, li);      
            var li2 = u2.lastIndexOf('/');
            u2 = u.substring(0, li2);
            return u.substring(li2+1, li);
        }
        return -1;
    },

    get : function(url, mime) {
        var xmlHttpReq = this.open('GET', url, mime, 0, false);
        try {
            xmlHttpReq.send(null);
            if (xmlHttpReq.readyState == 4) {
                var rtext = xmlHttpReq.responseText;
                if(rtext == undefined || rtext == '' || rtext.indexOf('HTTP Status') != -1) {
                    if(rtext != undefined)
                        this.debug('Failed XHR(GET, '+url+'): Server returned --&gt; ' + rtext);
                    return '-1';
                }
                return rtext;
            }
        } catch( e ) {
            this.debug('Caught Exception; name: [' + e.name + '] message: [' + e.message+']');
        }
        return '-1';
    },

    post : function(url, mime, content) {
        var xmlHttpReq = this.open('POST', url, mime, content.length, false);

        try {
            xmlHttpReq.send(content);
            if (xmlHttpReq.readyState == 4) {
                var status = xmlHttpReq.status;
                if(status == 201) {
                    return true;
                } else {
                    this.debug('Failed XHR(POST, '+url+'): Server returned --&gt; ' + status);
                }
            }
        } catch( e ) {
            this.debug('Caught Exception; name: [' + e.name + '] message: [' + e.message+']');
        }
        return false;
    },

    put : function(url, mime, content) {
        var xmlHttpReq = this.open('PUT', url, mime, content.length, false);
        try {
            xmlHttpReq.send(content);
            if (xmlHttpReq.readyState == 4) {
                var status = xmlHttpReq.status;
                if(status == 204) {
                    return true;
                } else {
                    this.debug('Failed XHR(PUT, '+url+'): Server returned --&gt; ' + status);
                }
            }
        } catch( e ) {
            this.debug('Caught Exception; name: [' + e.name + '] message: [' + e.message+']');
        }
        return false;
    },

    delete_ : function(url) {
        var xmlHttpReq = this.open('DELETE', url, 'application/xml', 0, false);
        try {
            xmlHttpReq.send(null);
            if (xmlHttpReq.readyState == 4) {
                var status = xmlHttpReq.status;
                if(status == 204) {
                    return true;
                } else {
                    this.debug('Failed XHR(DELETE, '+url+'): Server returned --&gt; ' + status);
                }
            }
        } catch( e ) {
            this.debug('Caught Exception; name: [' + e.name + '] message: [' + e.message+']');
        }
        return false;
    },

    debug : function(message) {
        var dbgComp = document.getElementById("dbgComp");
        if(dbgComp == null) {
            dbgComp = document.createElement("div");
            dbgComp.setAttribute("id", "dbgComp");
            dbgComp.style.border = "#2574B7 1px solid";
            dbgComp.style.font = "12pt/14pt sans-serif";
            var br = document.createElement("div");
            document.getElementsByTagName("body")[0].appendChild(br);
            br.innerHTML = '&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;';
            document.getElementsByTagName("body")[0].appendChild(dbgComp);
            if((typeof rjsConfig!="undefined") &amp;&amp; rjsConfig.isDebug) {
                dbgComp.style.display = "";
            } else {
                dbgComp.style.display = "none";
            }
            var tab = 'width: 20px; border-right: #2574B7 1px solid; border-top: #2574B7 1px solid; border-left: #2574B7 1px solid; border-bottom: #2574B7 1px solid; color: #000000; text-align: center;';
            var addActionStr = '&lt;div style="'+tab+'"&gt;&lt;a style="text-decoration: none" href="javascript:rjsSupport.closeDebug()"&gt;&lt;span style="color: red"&gt;X&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;';        
            dbgComp.innerHTML = '&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;span style="color: blue"&gt;Rest Debug Window&lt;/span&gt;&lt;/td&gt;&lt;td&gt;'+addActionStr + '&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br/&gt;';
        }
        var s = dbgComp.innerHTML;
        var now = new Date();
        var dateStr = now.getHours()+':'+now.getMinutes()+':'+now.getSeconds();
        dbgComp.innerHTML = s + '&lt;span style="color: red"&gt;rest debug('+dateStr+'): &lt;/span&gt;' + message + "&lt;br/&gt;";
    },
    
    closeDebug : function() {
        var dbgComp = document.getElementById("dbgComp");
        if(dbgComp != null) {
            dbgComp.style.display = "none";
            dbgComp.innerHTML = '';
        }
    }
}
</plain-text-body>
<p>where,</p>
<ul><li><code>XMLHttpRequest</code> is a JavaScript object used to send HTTP or HTTPS requests directly to a web server and load the server response data directly back into the script. In this application, an <code>XMLHttpRequest</code> instance <code>xmlHttpReq</code> is created to help a client-side script perform HTTP requests. The HTTP method to use for the request, the destination URL, and the request content type are set on the <code>XMLHttpRequest</code> object with the <code>open</code> function when initializing the request.</li><li><code>open : function(method2, url2, mimeType, paramLen, async)</code> is the function that opens a connection to the server resource at the specified URL (<code>url2</code>) for the specified method (<code>method2</code>). This function initializes the HTTP and HTTPS requests of the <code>XMLHttpRequest</code> object and must be invoked prior to the actual sending of a request.</li><li><code>setRequestHeader</code> is a method of the <code>XMLHttpRequest</code> object that is used to set HTTP headers to be send with the request.</li><li><code>get</code>, <code>post</code>, <code>put</code> and <code>delete</code> are functions responsible for dispatching requests. Each function first obtains an instance of <code>XMLHttpRequest</code> and initialize it with <code>open</code>. Then the requests are sent to the web server and will arrive on the server just like any other HttpServletRequest.</li><li><code>send</code> is the function used to send requests to the web server. It accepts a single parameter that can contain the content to be sent with the request. The requests perform like HttpServletRequests on the web server and after parsing the request parameters, the servlet will invoke the necessary application logic. For this application, the <code>get</code>, <code>post</code>, <code>put</code> and <code>delete</code> request methods from <strong>RestfulordersResource</strong> and <strong>RestfulorderResource</strong> classes are called according to the request type.
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>


<p><strong>ApplicationConfig</strong> is a servlet that extends the <code>javax.ws.rs.core.Application</code> class to configure the application classes within a JAX-RS runtime.</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">ApplicationConfig.java</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
package org.apache.geronimo.samples.javaee6.restfulorder.config;

@javax.ws.rs.ApplicationPath("resources")
public class ApplicationConfig extends javax.ws.rs.core.Application {
}
</plain-text-body>
<p>where,</p>
<ul><li><code>@javax.ws.rs.ApplicationPath</code> is an annotation that helps to specify the resource path of the application. The value of this annotation is used as the servlet URL pattern. For example, the URI for the resource presented in this application can be <a shape="rect" class="external-link" href="http://localhost:8080/restfulorder-javaee6/resources/restfulorders/" rel="nofollow">http://localhost:8080/restfulorder-javaee6/resources/restfulorders/</a>, where <strong>/resources</strong> is the servlet URL. You can also specify this URL patterns in your <code>web.xml</code> file if this annotation is absent.</li><li><code>javax.ws.rs.core.Application</code> is a class that provides the <code>getClasses</code> and <code>getSingletons</code> methods that can specify a set of root resources and providers accessible from a specified application path respectively. The <strong>ApplicationConfig</strong> class uses the default implementations of <code>javax.ws.rs.core.Application</code> subclass <code>getClasses</code> and <code>getSingletons</code> methods that return empty sets. In this case, when both methods return empty sets, all root resource classes and providers packaged in the application are included in the published JAX-RS application.
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>



<p><strong>RestfulordersResource</strong> is a resource class that uses JAX-RS annotations to implement the corresponding Web resource. The request methods defined in this class are called when the server receives the corresponding HTTP requests.</p>

<parameter ac:name="">java</parameter><parameter ac:name="title">RestfulordersResource.java</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
package org.apache.geronimo.samples.javaee6.restfulorder.service;

import java.util.Collection;
import javax.ws.rs.Path;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Produces;
import javax.ws.rs.Consumes;
import javax.ws.rs.PathParam;
import javax.ws.rs.QueryParam;
import javax.ws.rs.DefaultValue;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.UriInfo;
import javax.persistence.EntityManager;
import org.apache.geronimo.samples.javaee6.restfulorder.converter.RestfulordersConverter;
import org.apache.geronimo.samples.javaee6.restfulorder.converter.RestfulorderConverter;
import javax.persistence.PersistenceContext;
import javax.ejb.Stateless;
import org.apache.geronimo.samples.javaee6.restfulorder.entities.Restfulorder;


@Path("/restfulorders/")
@Stateless
public class RestfulordersResource {
    @javax.ejb.EJB
    private RestfulorderResource restfulorderResource;
    @Context
    protected UriInfo uriInfo;
    @PersistenceContext(unitName = "RestfulProduct2PU")
    protected EntityManager em;
  
    /** Creates a new instance of RestfulordersResource */
    public RestfulordersResource() {
    }

    /**
     * Get method for retrieving a collection of Restfulorder instance in XML format.
     *
     * @return an instance of RestfulordersConverter
     */
    @GET
    @Produces({"application/xml", "application/json"})
    public RestfulordersConverter get(@QueryParam("start")
                                      @DefaultValue("0")
    int start, @QueryParam("max")
               @DefaultValue("10")
    int max, @QueryParam("expandLevel")
             @DefaultValue("1")
    int expandLevel, @QueryParam("query")
                     @DefaultValue("SELECT e FROM Restfulorder e")
    String query) {
        return new RestfulordersConverter(getEntities(start, max, query), uriInfo.getAbsolutePath(), expandLevel);
    }

    /**
     * Post method for creating an instance of Restfulorder using XML as the input format.
     *
     * @param data an RestfulorderConverter entity that is deserialized from an XML stream
     * @return an instance of RestfulorderConverter
     */
    @POST
    @Consumes({"application/xml", "application/json"})
    public Response post(RestfulorderConverter data) {
        System.out.println("before resolve,in post");
        Restfulorder entity = data.resolveEntity(em);
        createEntity(data.resolveEntity(em));
        return Response.created(uriInfo.getAbsolutePath().resolve(entity.getId() + "/")).build();
    }

    /**
     * Returns a dynamic instance of RestfulorderResource used for entity navigation.
     *
     * @return an instance of RestfulorderResource
     */
    @Path("{id}/")
    public RestfulorderResource getRestfulorderResource(@PathParam("id")
    Integer id) {
        restfulorderResource.setId(id);
        restfulorderResource.setEm(em);
        return restfulorderResource;
    }

    /**
     * Returns all the entities associated with this resource.
     *
     * @return a collection of Restfulorder instances
     */
    protected Collection&lt;Restfulorder&gt; getEntities(int start, int max, String query) {
        return em.createQuery(query).setFirstResult(start).setMaxResults(max).getResultList();
    }

    /**
     * Persist the given entity.
     *
     * @param entity the entity to persist
     */
    protected void createEntity(Restfulorder entity) {
        em.persist(entity);
    }
}
</plain-text-body>
<p>where,</p>
<ul><li><code>@Path("/restfulorders/")</code> is the annotation that defines the relative URI to your resource. The base URI is provided by the combination of your hostname, port, application context root, and any URI pattern mappings in the application's <code>web.xml</code> file. For example, the URI for the resource presented by this resource class can be <a shape="rect" class="external-link" href="http://localhost:8080/restfulorder-javaee6/resources/restfulorders/" rel="nofollow">http://localhost:8080/restfulorder-javaee6/resources/restfulorders/</a>.</li><li><code>@Path("{id}/")</code> annotates a sub-resource locator which returns a <code>RestfulorderResource</code> object to handle HTTP requests. The <code>id</code> parameter in this annotation defines the relative URI under <code>/restfulorders/<em>id</em></code> to the resource.</li><li><code>@Context</code> is used in this resource class to inject an instance of <code>UriInfo</code> into the class field.</li><li><code>UriInfo</code> instances can provide information on the components of a request URI.</li><li><code>@GET</code> and <code>@POST</code> are request method designators for annotating resource methods in a resource class. Other common request method designators include <code>@PUT</code>, <code>@DELETE</code>, and <code>@HEAD</code>.</li><li><code>@Consumes</code> and <code>@Produces</code> annotations are used to declare the supported request and response media types. In this resource class, the <code>post</code> and <code>get</code> methods both support <code>application/xml</code> and <code>application/json</code>.
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>




<p><strong>RestfulordersConverter</strong> is a Java Architecture for XML Binding (JAXB) annotated class that support the processing of XML in requests and responses.</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">RestfulordersConverter.java</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
package org.apache.geronimo.samples.javaee6.restfulorder.converter;

import java.net.URI;
import java.util.Collection;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlTransient;
import javax.xml.bind.annotation.XmlAttribute;
import java.util.ArrayList;
import org.apache.geronimo.samples.javaee6.restfulorder.entities.Restfulorder;

@XmlRootElement(name = "restfulorders")
public class RestfulordersConverter {
    private Collection&lt;Restfulorder&gt; entities;
    private Collection&lt;RestfulorderConverter&gt; items;
    private URI uri;
    private int expandLevel;
  
    /** Creates a new instance of RestfulordersConverter */
    public RestfulordersConverter() {
    }

    /**
     * Creates a new instance of RestfulordersConverter.
     *
     * @param entities associated entities
     * @param uri associated uri
     * @param expandLevel indicates the number of levels the entity graph should be expanded
     */
    public RestfulordersConverter(Collection&lt;Restfulorder&gt; entities, URI uri, int expandLevel) {
        this.entities = entities;
        this.uri = uri;
        this.expandLevel = expandLevel;
        getRestfulorder();
    }
......
</plain-text-body>
<p>where,</p>
<ul><li><code>@XmlRootElement(name = "restfulorders")</code> is an annotation that maps the class to the root of the XML document. In this application, when the user creates a new order with a unique <em>id</em>, for example 01, the XML document containing the corresponding data is located at <a shape="rect" class="external-link" href="http://localhost:8080/restfulorder-javaee6/resources/restfulorders/01" rel="nofollow">http://localhost:8080/restfulorder-javaee6/resources/restfulorders/01</a>.
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>





<h1 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-Getthesourcecode">Get the source code</h1>

<p>Please refer to <a shape="rect" href="java-ee-sample-applications.html">Samples General Information</a> for informations on obtaining and building the source for this and other samples.</p>

<h1 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-BuildtheRESTfulWebservicesapplication">Build the RESTful Web services application</h1>

<p>Once all the sources get checked out the next step is to build <strong>restfulorder-javaee6</strong> sample. It requires Maven 2 or above for building the binaries.</p>

<p>From the <strong>&lt;</strong><strong>restfulorder-javaee6</strong><strong>_home&gt;</strong> directory run the following command.</p>

<rich-text-body>
<p>mvn clean install</p></rich-text-body>
<p>This process will take a couple of minutes. The binaries will be generated in the corresponding <strong>target</strong> directory .</p>

<h2 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-DeploytheRESTfulWebservicesapplication">Deploy the RESTful Web services application</h2>

<p>Deploying sample application is pretty straight forward as we are going to use the Geronimo Console.</p>
<ol><li>Scroll down to <strong>Deploy New</strong> from the <strong>Console-&gt;Navigation panel</strong>.</li><li>Load <strong>restfulorder-javaee6-war-</strong><strong><em>version</em></strong><strong>.war</strong> from <strong>restfulorder-javaee6-war\target</strong> folder in to the <strong>Archive</strong> input box.</li><li>Press <strong>Install</strong> button to deploy application in the server.</li></ol>


<h2 id="restfulorder-javaee6-SimpleWebServicewithJAX-RS-TesttheRESTfulWebservicesapplication">Test the RESTful Web services application</h2>

<p>The application is visible at <a shape="rect" class="external-link" href="http://localhost:8080/restfulorder-javaee6" rel="nofollow">http://localhost:8080/restfulorder-javaee6</a>.</p>

<p>Click the <strong>Add a new order</strong> link to create a new order.  <br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-content-image-border" src="restfulorder-javaee6-simple-web-service-with-jax-rs.data/restfulorder1.jpg"></span></p>

<p>Click <strong>Save</strong> after inputting all the data for your order. You will see the added order on the next page.   <br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-content-image-border" src="restfulorder-javaee6-simple-web-service-with-jax-rs.data/restfulorder2.jpg"></span></p>

<p>You can also see the order resource at <a shape="rect" class="external-link" href="http://localhost:8080/restfulorder-javaee6/resources/restfulorders/id" rel="nofollow">http://localhost:8080/restfulorder-javaee6/resources/restfulorders/id</a> in XML format, where <em>id</em> is the unique id value you defined for your order. </p>


</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : restfulorder-javaee6 - Simple Web Service with JAX-RS';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
