<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Stateful Session Bean" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Stateful Session Bean" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Stateful Session Bean</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="developing.html">Developing</a>&nbsp;&gt;&nbsp;<a href="tutorials.html">Tutorials</a>&nbsp;&gt;&nbsp;<a href="developing-ejb-applications.html">Developing EJB applications</a>&nbsp;&gt;&nbsp;<a href="stateful-session-bean.html">Stateful Session Bean</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Stateful Session Bean</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645235">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645235">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645235">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645235">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645235">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645235">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>This application will take you through the basics of Stateful Session Bean. This application will demonstrate how annotations like @Stateful, @Resource, @PostConstruct, @PreDestroy, @PrePassivate, @PostActivate, @Remove are used in an EJB3 application.</p>

<p>Basically a Stateful Session EJB is used whenever there is a requirement to maintain a session. The example is a user registration process wherein the registration process is a two step process. First page prompts to enter your personal credentials and second page prompts to enter your billing and credit card information. The session is maintained till the user has filled up both the jsp pages. Later the complete information is populated on to a database. The application has a Controller servlet which routes the call received from the jsp client to the Bean class, setter methods and jsp pages.</p>

<p>To run this tutorial, as a minimum you will be required to have installed the following prerequisite software.</p>

<ul><li>Sun JDK 5.0+ (J2SE 1.5)</li><li>Eclipse 3.3.1.1 (Eclipse Classic package of Europa distribution), which is platform specific</li><li>Web Tools Platform (WTP) 2.0.1</li><li>Data Tools Platform (DTP) 1.5.1</li><li>Eclipse Modeling Framework (EMF) 2.3.1</li><li>Graphical Editing Framework (GEF) 3.3.1</li></ul>


<p>Details on installing eclipse are provided in the <a shape="rect" href="development-environment.html">Development environment</a> section. <br clear="none">
 This tutorial is organized in the following sections:</p>

<h1 id="StatefulSessionBean-CreatinganEJBproject">Creating an EJB project</h1>
<p>This section is organized in the following parts:</p>
<h2 id="StatefulSessionBean-Settinguptheprojectenvironment">Setting up the project environment</h2>
<ol><li>Right click Under <em>Project Explorer</em> and Select <strong>New-&gt;EJB Project</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb1.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the project as <em>StatefulBean</em>. Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb2.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Mark the fields as suggested in the screenshot and Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb3.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Uncheck <strong>Generate Deployment Descriptor</strong>. This is beacuse we are using annotations is our applications and so deployment descriptors are redundant entity. Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb4.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On next screen select all default values and Select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb5.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
This creates a skeleton for the EJB project. Next steps are adding the bean class, bean interface and setter/getter methods.</li><li>Right click on <strong>ejbModule</strong> in StatefulBean project and select <strong>New-&gt;class</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb6.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the class as <em>PersonalInfo</em> and package as <em>ejb.stateful</em>. Select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb7.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li></ol>


<h2 id="StatefulSessionBean-AddingJavaclassesandinterfaces">Adding Java classes and interfaces</h2>
<ol><li>Add the following code to <code>PersonalInfo.java</code>.
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">PersonalInfo.java</parameter><plain-text-body>
package ejb.stateful;

public class PersonalInfo implements java.io.Serializable {
private static final long serialVersionUID = 1L;

private String FirstName;
private String LastName;
private String UserName;
private String Password;
private String Nationality;

public void setFirstName(String FirstName)
{
	this.FirstName=FirstName;
}

public void setLastName(String LastName)
{
	this.LastName=LastName;
}
public void setUserName(String UserName)
{
	this.UserName=UserName;
}
public void setPassword(String Password)
{
	this.Password=Password;
}
public void setNationality(String Nationality)
{
	this.Nationality=Nationality;
}
public String getFirstName()
{
	return FirstName;
}

public String getLastName()
{
	return LastName;
}
public String getUserName()
{
	return UserName;
}
public String getPassword()
{
	return Password;
}
public String getNationality()
{
	return Nationality;
}

}
</plain-text-body>
<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Similarly create a class <code>BillingInfo.java</code> and add the following code.
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">BillingInfo.java</parameter><plain-text-body>
package ejb.stateful;

public class BillingInfo implements java.io.Serializable
{
	
	private static final long serialVersionUID = 1L;
	private String houseNo;
	private String street;
	private String city;
	private String pincode;
	private String country;
	private String bank;
	private String cardno;
	
	public void setBank(String bank)
	{
		this.bank=bank;
	}

	public void setCardno(String cardno)
	{
		this.cardno=cardno;
	}
	public void setHouseNo(String houseNo)
	{
		this.houseNo=houseNo;
	}

	public void setStreet(String street)
	{
		this.street=street;
	}
	public void setCity(String city)
	{
		this.city=city;
	}
	public void setPincode(String pincode)
	{
		this.pincode=pincode;
	}
	public void setCountry(String country)
	{
		this.country=country;
	}
	public String getBank()
	{
		return bank;
	}

	public String getCardno()
	{
		return cardno;
	}
	public String getHouseNo()
	{
		return houseNo;
	}

	public String getStreet()
	{
		return street;
	}
	public String getCity()
	{
		return city;
	}
	public String getPincode()
	{
		return pincode;
	}
	public String getCountry()
	{
		return country;
	}

}
</plain-text-body>
<code>PersonalInfo.java</code> and <code>BillingInfo.java</code> are classes for setting and getting the user information.</li><li>Now we will add the Business interface or bean interface. Right click on the package ejb.stateful and Select <strong>New-&gt;Interface</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb8.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the interface as <em>AccountCreator</em> and Select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb9.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Add the following code to <strong>AccountCreator</strong> interface.
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">AccountCreator.java</parameter><plain-text-body>
package ejb.stateful;
import javax.ejb.Remote;
@Remote
public interface AccountCreator {
void addPersonalInfo(PersonalInfo personalinfo);
void addBillingInfo(BillingInfo billinginfo);
void createAccount();
}
</plain-text-body>
<strong>Note</strong>: Once you enter this code you might see errors like @EJB can be resolved. Currently there are some limitations with the geronimo eclipse plugin which will resolved soon. We will soon suggest you how to get rid of those errors.</li><li>Next step is to add the implementation to the interface. Right click on <strong>ejb.stateful</strong> interface and select <strong>New-&gt;class</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb10.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the bean class as <em>AccountCreatorBean</em> and Select <strong>Finish</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb11.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Add the following code to <strong>AccountCreatorBean</strong>.
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">AccountCreatorBean.java</parameter><plain-text-body>
package ejb.stateful;

import java.sql.Connection;
import java.sql.Statement;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import javax.annotation.Resource;
import javax.ejb.PostActivate;
import javax.ejb.PrePassivate;
import javax.ejb.Remove;
import javax.ejb.Stateful;
import javax.sql.DataSource;


@Stateful
public class AccountCreatorBean implements AccountCreator{
@Resource(name="jdbc/userds")
private DataSource datasource;
private Connection connection;
private PersonalInfo personalinfo=new PersonalInfo();
private BillingInfo billinginfo=new BillingInfo();
	
	public AccountCreatorBean() {
	super();
}	


@PostConstruct
@PostActivate
public void openConnection()
{
	try{
	connection=datasource.getConnection();
	}
	catch(Exception e)
	{
		e.printStackTrace();
	}
}

@PreDestroy
@PrePassivate
public void closeConnection()
{
	connection=null;
}

public void addPersonalInfo(PersonalInfo personalinfo)
{
	this.personalinfo=personalinfo;
}

public void addBillingInfo(BillingInfo billinginfo)
{
	this.billinginfo=billinginfo;
}

@Remove
public void createAccount()
{
try{
	System.out.println(personalinfo.getFirstName());
	Statement statement = connection.createStatement();
    String sql = "INSERT INTO USERINFO(" + "FIRSTNAME, " + "LASTNAME, "
            + "USERNAME," + "PASSWORD, " + " PINCODE, " + " CARDNO ) VALUES (" + "'"
            + personalinfo.getFirstName() + "', " +

            "'" + personalinfo.getLastName() + "', " +

            "'" + personalinfo.getUserName() + "', "+  "'" + 
            
            personalinfo.getPassword() + "', "+  "'" + 
            
            billinginfo.getPincode() + "', "+  "'" +
            
            billinginfo.getCardno() + "'" + 

            ")";
    statement.execute(sql);
    statement.close();
	
}
catch(Exception e)
{
	e.printStackTrace();
}
}

}
</plain-text-body>
Once you have added the code you will see lot of errors but this can be resolved easily and is shown in next step. The errors in the code is due to missing classes from our server runtime.</li></ol>


<h2 id="StatefulSessionBean-Makingadditionalconfigurations">Making additional configurations</h2>
<p>Resolve the errors as follows.</p>
<ol><li>Right click on <strong>StatefulBean</strong> project and select <strong>Properties</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb12.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next screen select <strong>Java Build Path-&gt;Libraries-&gt;Add External Jars</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb13.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Browse to <code>&lt;GERONIMO_HOME&gt;/repository/org/apache/geronimo/specs/geronimo-ejb_3.0_spec/1.0.1</code> and select <strong>geronimo-ejb_3.0_spec-1.0.1.jar</strong>. Select <strong>Open</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb14.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Similarly browse to <strong>&lt;GERONIMO_HOME&gt;/repository/org/apache/geronimo/specs/geronimo-annotation_1.0_spec/1.1.1</strong> and add <code>geronimo-annotation_1.0_spec-1.1.1.jar</code>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb15.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Once done you can see both the jars enlisted. Select <strong>OK</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb16.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li></ol>


<p>Let us walk through the EJB bean class code.</p>
<ul><li>@Stateful public class AccountCreatorBean implements AccountCreator- @ Stateful annotation declares the Bean class as Stateful class.</li><li>@Resource(name="jdbc/userds") DataSource datasource;- This is a resource injection into the bean class wherin a datasource is injected using the @Resource annotation. We will shortly see how to create a datasource in geronimo.
	<ul><li>public AccountCreatorBean*-This is a constructor for the bean class and it will be used to create a bean instance whenever a request is received from new client connection.</li></ul>
	</li><li>@PostConstruct, @PostActivate public void openConnection()- @PostConstruct and @PostActivate are annotations which are basically called lifecycle callback annotation. The lifecycle for these annotation is as follows
	<ul><li>New bean instance is created using the default constructor.</li><li>Resources are injected</li><li>Now the <strong>PostConstruct</strong> method is called which in our case is to open a database connection.</li><li><strong>PostActivate</strong> is called on the bean instances which have been passivated and required to be reactivated. It goes on the same cycle as being followed by PostConstruct.</li><li>@PreDestroy @PrePassivate public void closeConnection()- Again @PreDestroy and @PrePassivate are Lifecycle callback annotation. The lifecycle of these annotation is as follows</li><li>Bean instances in the pool are used and business methods are invoked.</li><li>Once the client is idle for a period of time container passivates the bean instance. The closeConnection function is called just before container passivates the bean.</li><li>If the client does not invoke a passivated bean for a period of time it is destroyed.</li></ul>
	</li><li>public void addPersonalInfo(PersonalInfo personalinfo) and public void addBillingInfo(BillingInfo billinginfo)- These two functions are invoked to store client data across various calls.
	<ul><li>@Remove public void createAccount()- There are two ways in which a bean is destroyed and hence this where a client session ends in stateful bean. One is when a bean has been passivated and is not reinvoked by client hence the bean instance is destroyed. Another way is to use @Remove annotation. Once the client confirms and submits all the required information the data is populated into the database and that is where the session ends.</li></ul>
	</li></ul>


<h1 id="StatefulSessionBean-Creatingadatabaseusingtheadministrativeconsole">Creating a database using the administrative console</h1>
<ol><li>Start the server and lunch the administrative console using the URL <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http://localhost:8080/console</a>.</li><li>Enter default username and password.</li><li>In the welcome page, Under <em>Embedded DB</em>, Select <strong>DB Manager</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB1.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next page create a database named <em>userdbs</em> and Select <strong>Create</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB2.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Once done you can see the <strong>userdbs</strong> database listed in DB Viewer portlet under Databases. This confirms that the database has been successfully created.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB3.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>As shown in the figure under <em>Use DB</em>, select <strong>userdbs</strong> from the dropdown box.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB4.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Run the <code>userinfo.sql</code> script. Select <strong>Run Sql</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB5.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">userinfo.sql</parameter><plain-text-body>
create table userinfo(firstname varchar(20),lastname varchar(20),
username varchar(20), password varchar(20), pincode varchar(20),
cardno varchar(20))
</plain-text-body></li><li>To verify the table creation succeeded. Select <strong>Application</strong> as shown in the figure.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB6.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Next screen suggests the table has been successfully created. To view the contents of the table select <strong>VIEW CONTENTS</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB7.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>The table is currently empty as shown in the figure.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB8.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li></ol>


<h1 id="StatefulSessionBean-Creatingadatasourceusingtheadministrativeconsole">Creating a datasource using the administrative console</h1>
<ol><li>Start the server and launch the administrative console using the URL <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http://localhost:8080/console</a>.</li><li>Enter default username and password.</li><li>Once in the welcome page. In console navigation, Under <em>Services</em>, Select <strong>Database Pools</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next screen, Create a new database pool using Geronimo database pool wizard.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS2.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next screen give the name as suggested in the figure. This will initiate the process to create a Derby Embedded XA datasource.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS3.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Select the Driver jar and give the database name as <em>userdbs</em> (Remember this is the database we created in the previous step). Rest all fields can be set to default.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS4.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Select <strong>Deploy</strong> to deploy the connector plan.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS5.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Once done you can see the Database Pool <strong>jdbc/userds</strong> listed in the available database pools.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS6.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li></ol>


<h1 id="StatefulSessionBean-CreatingaWebbasedapplicationclient">Creating a Web based application client</h1>
<ol><li>Right click under <em>Project Explorer</em> and Select <strong>New-&gt;Dynamic Web Project.</strong><br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web1.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the project as <em>StatefulClient</em> and Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web2.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Keep the default settings as shown in the figure. Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web3.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next screen keep default values. Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web4.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Default values on this screen too. Select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web5.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Right click on the <strong>StatefulClient</strong> project and Select <strong>New-&gt;Servlet</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web6.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the package as <em>ejb.stateful</em> and Servlet as <em>Controller</em>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web7.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Keep the default values and Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web8.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Keep the default values and Select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web9.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Once the servlet is created it shows error. This is due to servlet api missing from the runtime. This can be easily resolved. Right click on <strong>StatefulClient</strong> project and Select <strong>Properties</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web10.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next screen select <strong>Java build path</strong> and select <strong>Libraries</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web11.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Select <strong>Add External jars</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web12.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Browse to your <code>&lt;GERONIMO_HOME&gt;\repository\org\apache\geronimo\specs\geronimo-servlet_2.5_spec\1.1.2</code> and select  <strong>geronimo-servlet_2.5_spec-1.1.2.jar</strong> and Select <strong>Open</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web13.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Select <strong>OK</strong> on the next screen this will remove all the errors.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web14.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Add the following code to <code>Controller.java</code> servlet.
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">Controller.java</parameter><plain-text-body>
package ejb.stateful;

import java.io.IOException;
import java.util.Properties;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * Servlet implementation class for Servlet: Controller
 *
 */
 public class Controller extends javax.servlet.http.HttpServlet implements javax.servlet.Servlet {
   static final long serialVersionUID = 1L;
   
   AccountCreator ac;
   
   
    /* (non-Java-doc)
	 * @see javax.servlet.http.HttpServlet#HttpServlet()
	 */
	public Controller() {
		super();
	}   	
	
	/* (non-Java-doc)
	 * @see javax.servlet.http.HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doProcess(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	
/*PrintWriter out =response.getWriter();
out.println(request.getRequestURI());*/
	try{
		Properties prop=new Properties();
		  prop.put(Context.INITIAL_CONTEXT_FACTORY, "org.apache.openejb.client.RemoteInitialContextFactory");
		  prop.put("java.naming.provider.url", "ejbd://localhost:4201");
		   Context context = new InitialContext(prop);
		   ac=(AccountCreator)context.lookup("AccountCreatorBeanRemote");
		}
		catch(Exception e)
		{
			e.printStackTrace();
		}
	if ( (request.getRequestURI()).equals("/StatefulClient/Controller"))
	{
		PersonalInfo personalinfo=new PersonalInfo();
		personalinfo.setFirstName(request.getParameter("FirstName"));
		personalinfo.setLastName(request.getParameter("LastName"));
		personalinfo.setNationality(request.getParameter("Nationality"));
		personalinfo.setUserName(request.getParameter("UserName"));
		personalinfo.setPassword(request.getParameter("Password"));
		ac.addPersonalInfo(personalinfo);
		HttpSession hs= request.getSession(true);
		hs.setAttribute("handle", ac);
		RequestDispatcher rd=request.getRequestDispatcher("BillingInfo.jsp");
		rd.forward(request, response);
		
	}
	else
	{
		BillingInfo billingInfo=new BillingInfo();
		billingInfo.setBank(request.getParameter("Bank"));
		billingInfo.setCardno(request.getParameter("CardNo"));
		billingInfo.setCity(request.getParameter("City"));
		billingInfo.setCountry(request.getParameter("Country"));
		billingInfo.setHouseNo(request.getParameter("HouseNo"));
		billingInfo.setPincode(request.getParameter("PinCode"));
		billingInfo.setStreet(request.getParameter("Street"));
		HttpSession hs= request.getSession(true);
		ac=(AccountCreator)hs.getAttribute("handle");
		ac.addBillingInfo(billingInfo);
		ac.createAccount();
                  PrintWriter out=response.getWriter();
		out.println("Account successfully created");
	}
		
	}
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doProcess(request, response);
	}  	
	
	/* (non-Java-doc)
	 * @see javax.servlet.http.HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doProcess(request, response);
		// TODO Auto-generated method stub
	}   	  	    
}</plain-text-body>
<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
This servlet contains code referring to bean interface class and PersonalInfo and BilllingInfo class. We need to add these projects to the build path so that the classes can be compiled. </li><li>Right click on <strong>StatefulClient</strong> project and Select <strong>Properties-&gt;Java Build Path-&gt;Projects</strong>. Select <strong>Add</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web15.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Check <strong>StatefulBean</strong> and Select <strong>OK</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web16.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Once done the project will be visible in the build path. Select <strong>OK</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web17.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Next step is to add jsp pages to our client project. Right click on <strong>WebContent</strong> under <strong>StatefulClient</strong> project and Select <strong>New-&gt;jsp</strong>.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web18.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Name the jsp as <code>PersonalInfo.jsp</code> and Select <strong>Next</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web19.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>On the next screen select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web20.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Add the following code to <code>PersonalInfo.jsp</code>.
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">PersonalInfo.jsp</parameter><plain-text-body>
&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
&lt;title&gt;User Personal Information&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action="Controller"&gt;
&lt;h1&gt;Enter your personal information&lt;/h1&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;&lt;h3&gt;Name&lt;/h3&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FirstName&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="FirstName"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LastName&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="LastName"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;h3&gt;Nationality&lt;/h3&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Nationality&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="Nationality"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;h3&gt;Login&lt;/h3&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;UserName&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="UserName"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Password&lt;/td&gt;
&lt;td&gt;&lt;input type="password" name="Password"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;input type="submit" Name="Next"&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</plain-text-body>
<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Similarly add another jsp with the name <code>BillingInfo.jsp</code> and add the following code.<br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline">
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">BillingInfo.jsp</parameter><plain-text-body>
&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
&lt;title&gt;User Billing Information&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;form action="Controller1"&gt;
&lt;h1&gt;Enter your Billing information&lt;/h1&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;&lt;h3&gt;Address&lt;/h3&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;House No&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="HouseNo"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Street&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="Street"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;City&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="City"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PinCode&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="PinCode"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Country&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="Country"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;h3&gt;Credit Card Information&lt;/h3&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Bank&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="Bank"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Card No&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="CardNo"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;input type="submit" name="Submit"&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</plain-text-body></li></ol>


<p>Let's walk through the servlet and jsp code. First through Controller servlet code.</p>
<ol><li>
	<ul><li><strong>if ( (request.getRequestURI()).equals("/StatefulClient/Controller"))</strong>- This code act as a controller on the jsp which is making a request. This is possible only when the jsp's make a call to th servlet with different names. How this can be done will be illustrated in the next section.</li><li><strong>HttpSession hs= request.getSession(true); hs.setAttribute("handle", ac);</strong> This part of the code saves the remote interface handle and later in the second call same handle is used to make another call to bean methods.</li><li><strong>RequestDispatcher rd=request.getRequestDispatcher("BillingInfo.jsp")</strong>- This code section and the next line forwards the control to next jsp that is <strong>BillingInfo.jsp</strong>.</li><li>Rest of the servlet deals with calling the setter methods and later sets the object so as to persist the data between different calls.</li></ul>
	</li><li>Next walkthrough the jsp code.
	<ul><li>PersonalInfo.jsp has <strong>&lt;form action="Controller"&gt;</strong> whereas BillingInfo.jsp has <strong>&lt;form action="Controller1"&gt;</strong> as the action element but both internally calling the same servlet. This can be easily done by modifying <strong>web.xml</strong> this will be shown in the next section.</li></ul>
	</li></ol>


<h1 id="StatefulSessionBean-Modifyingopenejb-jar.xml,web.xmlandgeronimo-web.xml">Modifying openejb-jar.xml, web.xml and geronimo-web.xml</h1>
<ol><li>In <strong>StatefulBean</strong> project select <strong>META-INF/openejb-jar.xml</strong> and replace the existing code with following code
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">openejb-jar.xml</parameter><plain-text-body>
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar-2.2" xmlns:nam="http://geronimo.apache.org/xml/ns/naming-1.2" 
xmlns:pkgen="http://www.openejb.org/xml/ns/pkgen-2.0" 
xmlns:sec="http://geronimo.apache.org/xml/ns/security-1.2" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
    &lt;environment&gt;
        &lt;moduleId&gt;
            &lt;groupId&gt;default&lt;/groupId&gt;
            &lt;artifactId&gt;StatefulBean&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
            &lt;type&gt;car&lt;/type&gt;
        &lt;/moduleId&gt;
        &lt;sys:dependencies&gt;
            &lt;sys:dependency&gt;
                &lt;sys:groupId&gt;console.dbpool&lt;/sys:groupId&gt;
                &lt;sys:artifactId&gt;jdbc/userds&lt;/sys:artifactId&gt;
            &lt;/sys:dependency&gt;        
        &lt;/sys:dependencies&gt;
    &lt;/environment&gt;
&lt;/openejb-jar&gt;
</plain-text-body>
The above deployment plan is different from the above one in the following way
	<ul><li>The namespace generated by geronimo eclipse plugin are not to AG 2.1 level. This is due to some limitation which will be fixed soon.</li><li>Since the ejb bean class refers to jdbc/userds datasource a <strong>&lt;dependency&gt;</strong> element has to be added in EJB deployment plan.</li></ul>
	</li><li>In <strong>StatefulClient</strong> project select <strong>WEB-INF/web.xml</strong> and replace the existing code with the following
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">web.xml</parameter><plain-text-body>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xmlns="http://java.sun.com/xml/ns/javaee" 
xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
id="WebApp_ID" version="2.5"&gt;
  &lt;display-name&gt;StatefulClient&lt;/display-name&gt;
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;
    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;
    &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;
    &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;
  &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;Controller&lt;/display-name&gt;
    &lt;servlet-name&gt;Controller&lt;/servlet-name&gt;
    &lt;servlet-class&gt;ejb.stateful.Controller&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;Controller1&lt;/display-name&gt;
    &lt;servlet-name&gt;Controller1&lt;/servlet-name&gt;
    &lt;servlet-class&gt;ejb.stateful.Controller&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Controller&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Controller&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Controller1&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Controller1&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</plain-text-body></li><li>In <strong>StatefulClient</strong> project select <strong>WEB-INF/geronimo-web.xml</strong> and add a dependency element for the StatefulBean EJB project. THe final web deployment plan will look as follows
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">geronimo-web.xml</parameter><plain-text-body>
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;ns8:web-app xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2"
             xmlns:ns2="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2" 
             xmlns:ns3="http://geronimo.apache.org/xml/ns/naming-1.2"
             xmlns:ns4="http://geronimo.apache.org/xml/ns/j2ee/ejb/openejb-2.0"
             xmlns:ns5="http://geronimo.apache.org/xml/ns/j2ee/application-2.0"
             xmlns:ns6="http://geronimo.apache.org/xml/ns/security-2.0"  
             xmlns:ns7="http://java.sun.com/xml/ns/persistence"
             xmlns:ns8="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" 
             xmlns:ns9="http://geronimo.apache.org/xml/ns/j2ee/application-client-2.0"&gt;
    &lt;environment&gt;
        &lt;moduleId&gt;
            &lt;groupId&gt;default&lt;/groupId&gt;
            &lt;artifactId&gt;StatefulClient&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
            &lt;type&gt;car&lt;/type&gt;
        &lt;/moduleId&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;default&lt;/groupId&gt;
                &lt;artifactId&gt;StatefulBean&lt;/artifactId&gt;
                &lt;version&gt;1.0&lt;/version&gt;
                &lt;type&gt;car&lt;/type&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/environment&gt;
    &lt;ns8:context-root&gt;/StatefulClient&lt;/ns8:context-root&gt;
&lt;/ns8:web-app&gt;
</plain-text-body></li></ol>


<p>The above code is different from the original one in the sense that we have added another <strong>&lt;servlet&gt;</strong> for Controller1 which is mapped to the same servlet class. Similarly adding a <strong>&lt;servlet-mapping&gt;</strong> element for the Controller1 servlet. This feature is basically mapping of more than one servlet with same servlet class. This helps in routing each call from jsp in the Controller servlet.</p>

<h1 id="StatefulSessionBean-DeployandRun">Deploy and Run</h1>
<ol><li>Under project explorer right click on <strong>StatefulBean</strong> project and select <strong>Export-&gt;EJB jar file</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run1.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Browse to a destination and Select <strong>Finish</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run2.png"></span></li><li>Similarly export <strong>StatefulClient</strong> project.</li><li>Launch the administrative console with <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http://localhost:8080/console</a>. Under application select <strong>Deploy New</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run3.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Browse to the StatefulBean project and select <strong>Install</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run4.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Similarly deploy StatefulClient project.</li><li>Launch the application using the link <a shape="rect" class="external-link" href="http://localhost:8080/StatefulClient/PersonalInfo.jsp" rel="nofollow">http://localhost:8080/StatefulClient/PersonalInfo.jsp</a>. Fill up the form and select SubmitQuery.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run5.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Once you submitt the current page, next page will be displayed wherein you need to enter your Billing Information. Once done select SubmitQuery.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run6.png"></span><br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"> <br clear="none" class="atl-forced-newline"></li><li>Later you can verify the database which is populated with the user data.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run7.png"></span></li></ol></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Stateful Session Bean';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
