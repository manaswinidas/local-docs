<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Configuring multiple repositories" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Configuring multiple repositories" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Configuring multiple repositories</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="configuring-services.html">Configuring services</a>&nbsp;&gt;&nbsp;<a href="configuring-multiple-repositories.html">Configuring multiple repositories</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Configuring multiple repositories</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645461">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645461">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645461">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645461">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645461">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645461">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<rich-text-body>
<p>Regarding both Geronimo javaee6 and minimal release bundles. Full support for multiple repositories was completed in <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/GERONIMO-6270">GERONIMO-6270</a> and its sub-tasks. This support is available in the latest snapshots after March 1, 2012, and will be in the 3.0-beta-2 standard release. This documents how to setup multiple repositories after applying the changes from GERONIMO-6270.</p>

<p>For prior releases, this document can still be followed if the <code>org.ops4j.pax.url.mvn.defaultRepositories</code> property is set properly, described in this document.</p></rich-text-body>


<p><parameter ac:name="atlassian-macro-output-type">INLINE</parameter><rich-text-body><p>The advantage of having multiple repositories is that they can reside on different server instances.</p></rich-text-body> You can create multiple repositories on different server instances, deploy a single repository on a single server instance, and deploy applications on multiple repositories on a single server instance.</p>

<p>For multiple instance support within a single Geronimo installation, it is recommended that each instance have its own local repository for deploying to (i.e. <code>GERONIMO_SERVER/repository</code>). The primary shared repository (<code>GERONIMO_HOME/repository</code>) in a multiple instance configuration should remain read-only.</p>

<p>This topic includes the following information:</p>



<h1 id="Configuringmultiplerepositories-Creatingmultiplerepositoriesonasingleserverinstance">Creating multiple repositories on a single server instance</h1>

<p>You can create multiple repositories on Geronimo. You can add a second repository to deploy your applications and leave Geronimo in its default repository.</p>

<h2 id="Configuringmultiplerepositories-Creatingarepositorybesidesthedefaultrepository">Creating a repository besides the default repository</h2>

<p>To add a second repository besides the default repository, take the following steps:</p>

<ol><li>Start Geronimo.</li><li>Create a directory repo2 under <code>&lt;geronimo_home&gt;</code>, for example, <code>&lt;geronimo_home&gt;/repo2</code>.</li><li>Create a file <code>repo2.xml</code> under the <code>&lt;geronimo_home&gt;/repo2</code> directory, for example:
<parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">repo2.xml</parameter><plain-text-body>
&lt;module xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
 &lt;environment&gt;
  &lt;moduleId&gt;
   &lt;groupId&gt;org.example.configs&lt;/groupId&gt;
    &lt;artifactId&gt;myrepo&lt;/artifactId&gt;
    &lt;version&gt;2.2&lt;/version&gt;
    &lt;type&gt;car&lt;/type&gt;
  &lt;/moduleId&gt;
  &lt;dependencies&gt;
   &lt;dependency&gt;
    &lt;groupId&gt;org.apache.geronimo.framework&lt;/groupId&gt;
    &lt;artifactId&gt;j2ee-system&lt;/artifactId&gt;
    &lt;type&gt;car&lt;/type&gt;
   &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;hidden-classes/&gt;
  &lt;non-overridable-classes/&gt;
 &lt;/environment&gt;
 &lt;gbean name="Repo2" class="org.apache.geronimo.system.repository.Maven2Repository"&gt;
   &lt;attribute name="root"&gt;repo2/&lt;/attribute&gt;
   &lt;attribute name="resolveToServer"&gt;false&lt;/attribute&gt;
   &lt;reference name="ServerInfo"&gt;
    &lt;name&gt;ServerInfo&lt;/name&gt;
   &lt;/reference&gt;
 &lt;/gbean&gt;
 &lt;gbean name="Local2" class="org.apache.geronimo.system.configuration.RepositoryConfigurationStore"&gt;
  &lt;reference name="Repository"&gt;
   &lt;name&gt;Repo2&lt;/name&gt;
  &lt;/reference&gt;
 &lt;/gbean&gt;
&lt;/module&gt;
</plain-text-body></li><li>Deploy the <code>repo2.xml</code> from the command prompt:<br clear="none">
<strong><code>deploy(.bat) deploy &lt;GERONIMO_HOME&gt;/repo2/repo2.xml</code></strong><br clear="none">
.<br clear="none">
To verify that the repository is successfully deployed, you can list the targets on the current server with the command:<br clear="none">
<strong><code>deploy(.bat) list-targets</code></strong>, and you can see the following information:
<plain-text-body>
Available Targets:
  org.apache.geronimo.framework/j2ee-system/2.2/car?ServiceModule=org.apache.geronimo.framework/j2ee-system/2.2/car,j2eeType=ConfigurationStore,name=Local
  org.example.configs/myrepo/2.2/car?ServiceModule=org.example.configs/myrepo/2.2/car,j2eeType=ConfigurationStore,name=Local2
</plain-text-body></li><li>Update the <code>etc/org.ops4j.pax.url.mvn.cfg</code> file, add the new second repository to the <code>org.ops4j.pax.url.mvn.defaultRepositories</code> property<br clear="none">
The property <code>org.ops4j.pax.url.mvn.defaultRepositories</code> maintains a comma-delimited list of repositories that are used by the run-time server.<br clear="none">
The format is: <code>file:</code> &lt; <em>/absolute/path/to/repo2</em> &gt; <code>@snapshots</code><br clear="none">
And if a variable it used, the new repository just deployed would be defined as:
<plain-text-body>file:${org.apache.geronimo.server.dir}/repo2@snapshots</plain-text-body>
And the resulting property would be set to something that looks like this:
<plain-text-body>org.ops4j.pax.url.mvn.defaultRepositories=file:${karaf.home}/repository@snapshots,file:${org.apache.geronimo.server.dir}/repo2@snapshots</plain-text-body>
The first defined repository is the default and primary <strong>GERONIMO_HOME/repository</strong>, the second one is the new <strong>GERONIMO_HOME/repo2</strong> repository just created.</li></ol>



<h2 id="Configuringmultiplerepositories-Deployinganapplicationtotherepository">Deploying an application to the repository</h2>

<p>Here is an example of deploying a sample jsp application to the repository repo2.</p>

<ol><li>List the targets on the current server via the command: <strong><code>deploy(.bat) list-targets</code></strong>, and you can see the following information:
<plain-text-body>
Available Targets:
org.example.configs/myrepo/2.2/car?ServiceModule=org.example.configs/myrepo/2.2/car,j2eeType=ConfigurationStore,name=Local2
org.apache.geronimo.configs/j2ee-system/2.2/car?ServiceModule=org.apache.geronimo.configs/j2ee-system/2.2/car,j2eeType=ConfigurationStore,name=Local
</plain-text-body></li><li>Deploy the application to the repository repo2, named as "Local2" with the following deploy command:</li></ol>
<ul class="alternate"><li>On a Windows system:<br clear="none">
 <strong>deploy.bat deploy --targets Local2 &lt;SAMPLE_HOME&gt;/applications/geronimo-jsp-examples/target/geronimo-jsp-examples-2.2.war</strong></li><li>On a non-Windows system:<br clear="none">
 <strong>deploy deploy --targets Local2 &lt;SAMPLE_HOME&gt;/applications/geronimo-jsp-examples/target/geronimo-jsp-examples-2.2.war</strong><br clear="none">
where &lt;SAMPLE_HOME&gt; is the directory of your samples. Then, the jsp example is deployed to the new repository repo2. The following message is displayed:
<plain-text-body>
    Deployed org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war @ /jsp-examples
</plain-text-body></li></ul>
<ol><li>Access the application at http:// &lt; host &gt; : &lt; port &gt; /jsp-examples.</li></ol>


<ol><li>To undeploy the application from the repository repo2, run the following deploy (.bat) command:</li></ol>
<ul class="alternate"><li>On a Windows system:<br clear="none">
 <strong>deploy.bat undeploy "org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war"</strong></li><li>On a non-Windows system:<br clear="none">
 <strong>deploy undeploy "org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war"</strong>
<plain-text-body>
    Module org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war unloaded.
    Module org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war uninstalled.

    Undeployed org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war
</plain-text-body></li></ul>



<h1 id="Configuringmultiplerepositories-Creatingmultiplerepositoriesonmultipleserverinstances">Creating multiple repositories on multiple server instances</h1>

<p>Create several server instances, and start the server instances. For information about creating server instances, see <a shape="rect" href="running-multiple-geronimo-instances.html">Running multiple Geronimo instances</a>. Then you need to create several repositories on these server instances. You can test the repositories by deploying an application to these server instances and undeploying the application from these server instances.</p>


<h2 id="Configuringmultiplerepositories-Creatingarepositoryforserverinstance2">Creating a repository for server instance2</h2>

<p>After you create more than one server instance, you can create repositories and deploy the repositories to different server instances. For information about how to create and deploy a repository on a server instance, see the following example that creates repo22 and deploys it on server2:</p>
<ol><li>Create a directory repo22 under <code>&lt;geronimo_home&gt;/server2</code>, for example, <code>&lt;geronimo_home&gt;/server2/repo22</code>.</li><li>Create a file <code>repo22.xml</code> under the <code>&lt;geronimo_home&gt;/server2/repo22</code> directory. For detailed information about the file, see <a shape="rect" href="configuring-multiple-repositories.html">creating multiple repositories</a>.</li><li>Deploy the <code>repo22.xml</code> by running the following command from the command prompt:</li></ol>
<ul class="alternate"><li>using non-Windows:<br clear="none">
 <strong>export GERONIMO_SERVER=server2</strong><br clear="none">
 <strong><code>deploy -port <em>instance2_RMI_port</em> deploy $GERONIMO_HOME/server2/repo22/repo22.xml</code></strong></li><li>using Windows<br clear="none">
 <strong>set GERONIMO_SERVER "server2"</strong><br clear="none">
 <strong><code>deploy.bat -port <em>instance2_RMI_port</em> deploy %GERONIMO_HOME%/server2/repo22/repo22.xml</code></strong></li></ul>


<p>You can follow the same steps to create repositories for server instance3.</p>

<h2 id="Configuringmultiplerepositories-Deployingasampleapplicationtoandundeployingitfromtherepository">Deploying a sample application to and undeploying it from the repository</h2>

<p>To test the repository that you create, you can deploy a sample application to and undeploying it from the repository.</p>

<ol><li>Note the repository name for the repository repo22 that you have previously created. We'll assume the name is Local22.</li><li>Deploy the application to the repository repo22 with the following deploy(.bat) command:</li></ol>
<ul class="alternate"><li>On a non-Windows system:<br clear="none">
 <strong>export GERONIMO_SERVER=server2</strong><br clear="none">
 <strong>deploy -port <em>instance2_RMI_port</em> deploy --targets Local22 &lt;SAMPLE_HOME&gt;/applications/geronimo-jsp-examples/target/geronimo-jsp-examples-2.2.war</strong></li><li>On a Windows system:<br clear="none">
 <strong>set GERONIMO_SERVER "server2"</strong><br clear="none">
 <strong>deploy.bat -port <em>instance2_RMI_port</em> deploy --targets Local22 &lt;SAMPLE_HOME&gt;/applications/geronimo-jsp-examples/target/geronimo-jsp-examples-2.2.war</strong></li></ul>
<ol><li>Undeploy the jsp application from repo22 repository with the following command:</li></ol>
<ul class="alternate"><li>On a non-Windows system:<br clear="none">
 <strong>export GERONIMO_SERVER=server2</strong><br clear="none">
 <strong>deploy -port <em>instance2_RMI_port</em> undeploy org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war</strong></li><li>On a Windows system:<br clear="none">
 <strong>set GERONIMO_SERVER "server2"</strong><br clear="none">
 <strong>deploy.bat -port <em>instance2_RMI_port</em> undeploy org.apache.geronimo.applications.examples/geronimo-jsp-examples/2.2/war</strong> </li></ul>


<p>You can follow the same steps to deploy applications to and undeploy applications from repositories on server instance3.</p>
</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Configuring multiple repositories';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
