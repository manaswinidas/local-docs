<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Configuring your own Monitoring Plugin DataSource" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Configuring your own Monitoring Plugin DataSource" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Configuring your own Monitoring Plugin DataSource</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="monitoring-the-health-of-the-apache-geronimo-server.html">Monitoring the health of the Apache Geronimo server</a>&nbsp;&gt;&nbsp;<a href="monitoring-components-on-geronimo-server.html">Monitoring components on Geronimo Server</a>&nbsp;&gt;&nbsp;<a href="configuring-your-own-monitoring-plugin-datasource.html">Configuring your own Monitoring Plugin DataSource</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Configuring your own Monitoring Plugin DataSource</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645350">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645350">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645350">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645350">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645350">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645350">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>The basic information of the server can be captured and stored in a database that is supported by Geronimo. The Geronimo management node takes advantage of MBeans to collect the server's statistics for a given time, also called <strong>snapshots</strong>. These snapshots are all JSR-77 compatible. In this way the administrator can monitor the server status. </p>

<p><rich-text-body><p>By default, the datasources are used to connect an Apache Derby database (the reason for this is because the default DB that Geronimo uses is also Derby). However, since the datasources are all packaged into separate plugins, anyone is able to write their own datasource deployment descriptor, package it into a plugin, and use it instead of the one provided by default.</p></rich-text-body></p>

<p>In order to use your own database for the Monitoring Plugin you must ensure the following:</p>
<ul><li>Datasource for the Active Database must be named <strong>jdbc/ActiveDS</strong></li><li>Datasource for the Archive Database must be named <strong>jdbc/ArchiveDS</strong></li><li>Module ID must be <strong>org.apache.geronimo.plugins.monitoring/agent-ds//car</strong> because there is a dependency on this module ID in the plugin</li></ul>


<h2 id="ConfiguringyourownMonitoringPluginDataSource-Thedeploymentdescriptorfortheoriginaldatasource">The deployment descriptor for the original datasource</h2>
<p>Here is the original deployment descriptor for the datasources used for the Monitoring Plugin in <code>&lt;geronimo_home&gt;\repository\org\apache\geronimo\plugins\monitoring\agent-ds\&lt;version&gt;\agent-ds-&lt;version&gt;.car\META-INF</code>. </p>

<parameter ac:name="">xml</parameter><parameter ac:name="title">plan.xml</parameter><plain-text-body>
&lt;connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-${geronimoSchemaVersion}"&gt;
    &lt;environment&gt;
        &lt;moduleId&gt;
            &lt;groupId&gt;${pom.groupId}&lt;/groupId&gt;
            &lt;artifactId&gt;${pom.artifactId}&lt;/artifactId&gt;
            &lt;version&gt;${version}&lt;/version&gt;
            &lt;type&gt;car&lt;/type&gt;
        &lt;/moduleId&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
                &lt;artifactId&gt;system-database&lt;/artifactId&gt;
                &lt;type&gt;car&lt;/type&gt;
            &lt;/dependency&gt;
            &lt;!-- SQL files --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.geronimo.plugins.monitoring&lt;/groupId&gt;
                &lt;artifactId&gt;agent-sql&lt;/artifactId&gt;
                &lt;version&gt;${monitoringConsoleVersion}&lt;/version&gt;
                &lt;type&gt;jar&lt;/type&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/environment&gt;

    &lt;resourceadapter&gt;
        &lt;outbound-resourceadapter&gt;
            &lt;!-- Pool for Active Statistics --&gt;
            &lt;connection-definition&gt;
                &lt;connectionfactory-interface&gt;javax.sql.DataSource&lt;/connectionfactory-interface&gt;
                &lt;connectiondefinition-instance&gt;
                    &lt;name&gt;jdbc/ActiveDS&lt;/name&gt;
                    &lt;config-property-setting name="CreateDatabase"&gt;true&lt;/config-property-setting&gt;
                    &lt;config-property-setting name="Password"&gt;monitor&lt;/config-property-setting&gt;
                    &lt;config-property-setting name="UserName"&gt;monitor&lt;/config-property-setting&gt;
                    &lt;config-property-setting name="DatabaseName"&gt;ActiveMRCDB&lt;/config-property-setting&gt;
                    &lt;connectionmanager&gt;
                        &lt;local-transaction/&gt;
                        &lt;single-pool&gt;
                            &lt;max-size&gt;10&lt;/max-size&gt;
                            &lt;min-size&gt;0&lt;/min-size&gt;
                            &lt;match-one/&gt;
                        &lt;/single-pool&gt;
                    &lt;/connectionmanager&gt;
                &lt;/connectiondefinition-instance&gt;
             &lt;/connection-definition&gt;
             &lt;!-- Pool for Archived Statistics --&gt;
             &lt;connection-definition&gt;
                 &lt;connectionfactory-interface&gt;javax.sql.DataSource&lt;/connectionfactory-interface&gt;
                 &lt;connectiondefinition-instance&gt;
                     &lt;name&gt;jdbc/ArchiveDS&lt;/name&gt;
                     &lt;config-property-setting name="CreateDatabase"&gt;true&lt;/config-property-setting&gt;
                     &lt;config-property-setting name="Password"&gt;monitor&lt;/config-property-setting&gt;
                     &lt;config-property-setting name="UserName"&gt;monitor&lt;/config-property-setting&gt;
                     &lt;config-property-setting name="DatabaseName"&gt;ArchiveMRCDB&lt;/config-property-setting&gt;
                     &lt;connectionmanager&gt;
                         &lt;local-transaction/&gt;
                         &lt;single-pool&gt;
                             &lt;max-size&gt;10&lt;/max-size&gt;
                             &lt;min-size&gt;0&lt;/min-size&gt;
                             &lt;match-one/&gt;
                         &lt;/single-pool&gt;
                     &lt;/connectionmanager&gt;
                 &lt;/connectiondefinition-instance&gt;
             &lt;/connection-definition&gt;
         &lt;/outbound-resourceadapter&gt;
     &lt;/resourceadapter&gt;

     &lt;!-- These two GBeans will create the tables for the database automatically --&gt;
     &lt;gbean name="ActiveDSGBean" class="org.apache.geronimo.connector.DatabaseInitializationGBean"&gt;
         &lt;attribute name="testSQL"&gt;SELECT t.tablename FROM SYS.SYSTABLES t WHERE lower(t.tablename)='statistics'&lt;/attribute&gt;
         &lt;attribute name="path"&gt;META-INF/database/derby/createTables.sql&lt;/attribute&gt;
         &lt;reference name="DataSource"&gt;
             &lt;name&gt;jdbc/ActiveDS&lt;/name&gt;
         &lt;/reference&gt;
     &lt;/gbean&gt;
     &lt;gbean name="ArchiveDSGBean" class="org.apache.geronimo.connector.DatabaseInitializationGBean"&gt;
         &lt;attribute name="testSQL"&gt;SELECT t.tablename FROM SYS.SYSTABLES t WHERE lower(t.tablename)='statistics'&lt;/attribute&gt;
         &lt;attribute name="path"&gt;META-INF/database/derby/createTables.sql&lt;/attribute&gt;
         &lt;reference name="DataSource"&gt;
             &lt;name&gt;jdbc/ArchiveDS&lt;/name&gt;
         &lt;/reference&gt;
     &lt;/gbean&gt;
&lt;!--this ought to be in the agent plan but this realm is not always started before the credential-store, even with the dependency--&gt;
  &lt;gbean name="monitoring-runas-realm" class="org.apache.geronimo.security.realm.GenericSecurityRealm"&gt;
    &lt;attribute name="realmName"&gt;monitoring-runas-realm&lt;/attribute&gt;
    &lt;attribute name="global"&gt;false&lt;/attribute&gt;
    &lt;xml-reference name="LoginModuleConfiguration"&gt;
      &lt;lc:login-config xmlns:lc="http://geronimo.apache.org/xml/ns/loginconfig-1.2"&gt;
        &lt;lc:login-module control-flag="REQUIRED"&gt;
          &lt;lc:login-domain-name&gt;monitoring-runas-domain&lt;/lc:login-domain-name&gt;
          &lt;lc:login-module-class&gt;org.apache.geronimo.security.credentialstore.RunAsLoginModule&lt;/lc:login-module-class&gt;
          &lt;lc:option name="principalClass"&gt;org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal&lt;/lc:option&gt;
          &lt;lc:option name="principalNames"&gt;admin&lt;/lc:option&gt;
        &lt;/lc:login-module&gt;
      &lt;/lc:login-config&gt;
    &lt;/xml-reference&gt;
    &lt;!--&lt;reference name="ServerInfo"&gt;--&gt;
    &lt;!--&lt;name&gt;ServerInfo&lt;/name&gt;--&gt;
    &lt;!--&lt;/reference&gt;--&gt;
  &lt;/gbean&gt;
&lt;/connector&gt;
</plain-text-body>
<p><code>META-INF/database/derby</code> is the path of <code>createTables.sql</code> packaged in tha JAR file <code>&lt;geronimo_home&gt;\repository\org\apache\geronimo\plugins\monitoring\agent-sql\&lt;version&gt;\agent-sql-&lt;version&gt;.jar</code>, which is a dependency of the datasource.</p>

<p>The two gbeans at the end of the deployment descriptor is pointing to an SQL file <code>createTables.sql</code> in order to create the necessary tables under the condition that they do not exist. The elements of these two tables are described as the following:</p>
<ul><li>MBeans
	<ul><li><strong>id</strong> (Primary Key): id of the MBean.</li><li><strong>mbeanName</strong>: name of the MBean.</li><li><strong>statsNameList</strong>: comma separated strings to represent an MBean's statistics name.</li></ul>
	</li><li>Statistics
	<ul><li><strong>id</strong> (Primary Key): id of the statistics.</li><li><strong>mbeanId</strong> (Foreign Key): id of MBean.</li><li><strong>snapshot_time</strong>: the duration of time in between snapshots.</li><li><strong>statsValueList</strong>: comma separated strings to represent an MBean's statistics value.</li></ul>
	</li></ul>


<parameter ac:name="title">excerpt from createTables.sql</parameter><plain-text-body>
-----------------------------------------------------------------------------
-- MBEANS
-----------------------------------------------------------------------------

CREATE TABLE MBeans(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    mbeanName VARCHAR(256) NOT NULL,
    statsNameList VARCHAR(512) NOT NULL,
    PRIMARY KEY(id)
);

-----------------------------------------------------------------------------
-- STATISTICS
-----------------------------------------------------------------------------

CREATE TABLE Statistics (
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    mbeanId INT NOT NULL,
    snapshot_time BIGINT NOT NULL,
    statsValueList VARCHAR(512) NOT NULL,
    PRIMARY KEY(id),
    FOREIGN KEY (mbeanId) REFERENCES MBeans(id)
);
</plain-text-body>

<h2 id="ConfiguringyourownMonitoringPluginDataSource-AnExample">An Example</h2>
<p>In this example, we will replace the default Apache Derby plugin datasource in Geronimo 2.2 with a DB2 Express-C one.</p>

<h3 id="ConfiguringyourownMonitoringPluginDataSource-Prerequisites">Prerequisites</h3>
<p>Before we get started to replace the monitoring plugin datasource, we should install DB2 Express-C database and its driver JAR packages on Geronimo, and then configure a DB2 Express-C datasource for Geronimo to connect to that database.</p>
<ol><li>Download and install DB2 Express-C. See <a shape="rect" class="external-link" href="http://www.ibm.com/software/data/db2/express/" rel="nofollow">DB2 Express-C</a> for details about downloading and installing this database.</li><li>Install the driver JAR packages on Geronimo. See <a shape="rect" href="configuring-a-db2-datasource.html">Adding DB2 drivers to the repository</a> for detailed steps.</li><li>Deploy a datasource for DB2 Express-C. See <a shape="rect" href="configuring-a-db2-datasource.html">Creating a database connection pool using the wizard from the Geronimo Administration Console</a> for detailed information.</li></ol>


<h3 id="ConfiguringyourownMonitoringPluginDataSource-Replacingthedefaultmonitoringplugindatasouce">Replacing the default monitoring plugin datasouce</h3>
<p>Now that we have a DB2 monitoring plugin datasource, we have to create deployment descriptors for the datasource.</p>
<ol><li>Create the deployment plan <code><a shape="rect" href="configuring-your-own-monitoring-plugin-datasource.data/db2-agent-ds.xml?version=1&amp;modificationDate=1247529736000&amp;api=v2" data-linked-resource-id="20874297" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="db2-agent-ds.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="20645350" data-linked-resource-container-version="21">db2-agent-ds.xml</a></code> based on the default <code><a shape="rect" href="configuring-your-own-monitoring-plugin-datasource.html">plan.xml</a></code>.
<parameter ac:name="">xml</parameter><parameter ac:name="title">db2-agent-ds.xml</parameter><plain-text-body>
&lt;connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2"&gt;
  &lt;dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
    &lt;dep:moduleId&gt;
      &lt;dep:groupId&gt;org.apache.geronimo.plugins.monitoring&lt;/dep:groupId&gt;
      &lt;dep:artifactId&gt;db2-agent-ds&lt;/dep:artifactId&gt;
      &lt;dep:version&gt;2.2&lt;/dep:version&gt;
      &lt;dep:type&gt;car&lt;/dep:type&gt;
    &lt;/dep:moduleId&gt;

    &lt;dep:dependencies&gt;
      &lt;dep:dependency&gt;
        &lt;dep:groupId&gt;org.apache.geronimo.plugins.monitoring&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;agent-sql&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;2.2&lt;/dep:version&gt;
        &lt;dep:type&gt;jar&lt;/dep:type&gt;
      &lt;/dep:dependency&gt;
      &lt;dep:dependency&gt;
        &lt;dep:groupId&gt;com.ibm.db2&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;db2jcc&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;9.5.0&lt;/dep:version&gt;
        &lt;dep:type&gt;jar&lt;/dep:type&gt;
      &lt;/dep:dependency&gt;
      &lt;dep:dependency&gt;
        &lt;dep:groupId&gt;com.ibm.db2&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;db2jcc_license_cu&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;9.5.0&lt;/dep:version&gt;
        &lt;dep:type&gt;jar&lt;/dep:type&gt;
      &lt;/dep:dependency&gt;
    &lt;/dep:dependencies&gt;

    &lt;dep:hidden-classes/&gt;
    &lt;dep:non-overridable-classes/&gt;
    &lt;dep:private-classes/&gt;
  &lt;/dep:environment&gt;
 
 &lt;resourceadapter&gt;
    &lt;outbound-resourceadapter&gt;
      &lt;!--Pool for Active Statistics--&gt;
      &lt;connection-definition&gt;
        &lt;connectionfactory-interface&gt;javax.sql.DataSource&lt;/connectionfactory-interface&gt;
        &lt;connectiondefinition-instance&gt;
          &lt;name&gt;jdbc/ActiveDS&lt;/name&gt;
	   &lt;config-property-setting name="UserName"&gt;db2admin&lt;/config-property-setting&gt;
          &lt;config-property-setting name="Password"&gt;db2manager&lt;/config-property-setting&gt;
          &lt;config-property-setting name="PortNumber"&gt;50000&lt;/config-property-setting&gt;
          &lt;config-property-setting name="ServerName"&gt;localhost&lt;/config-property-setting&gt;
          &lt;config-property-setting name="DatabaseName"&gt;activedb&lt;/config-property-setting&gt;
          &lt;config-property-setting name="DriverType"&gt;4&lt;/config-property-setting&gt;          
          &lt;connectionmanager&gt;
            &lt;xa-transaction&gt;
                     &lt;transaction-caching/&gt;
            &lt;/xa-transaction&gt;

            &lt;single-pool&gt;
              &lt;max-size&gt;10&lt;/max-size&gt;
              &lt;min-size&gt;0&lt;/min-size&gt;
              &lt;match-one/&gt;
            &lt;/single-pool&gt;
          &lt;/connectionmanager&gt;
        &lt;/connectiondefinition-instance&gt;
      &lt;/connection-definition&gt;
      &lt;!--Pool for Archived Statistics--&gt;
      &lt;connection-definition&gt;
        &lt;connectionfactory-interface&gt;javax.sql.DataSource&lt;/connectionfactory-interface&gt;
        &lt;connectiondefinition-instance&gt;
          &lt;name&gt;jdbc/ArchiveDS&lt;/name&gt;
          &lt;config-property-setting name="UserName"&gt;db2admin&lt;/config-property-setting&gt;
          &lt;config-property-setting name="Password"&gt;db2manager&lt;/config-property-setting&gt;
          &lt;config-property-setting name="PortNumber"&gt;50000&lt;/config-property-setting&gt;
          &lt;config-property-setting name="ServerName"&gt;localhost&lt;/config-property-setting&gt;
          &lt;config-property-setting name="DatabaseName"&gt;archdb&lt;/config-property-setting&gt;
          &lt;config-property-setting name="DriverType"&gt;4&lt;/config-property-setting&gt;          
          &lt;connectionmanager&gt;
            &lt;xa-transaction&gt;
                     &lt;transaction-caching/&gt;
            &lt;/xa-transaction&gt;

            &lt;single-pool&gt;
              &lt;max-size&gt;10&lt;/max-size&gt;
              &lt;min-size&gt;0&lt;/min-size&gt;
              &lt;match-one/&gt;
            &lt;/single-pool&gt;
          &lt;/connectionmanager&gt;
        &lt;/connectiondefinition-instance&gt;
      &lt;/connection-definition&gt;
    &lt;/outbound-resourceadapter&gt;
  &lt;/resourceadapter&gt;
  &lt;!--These two GBeans will create the tables for the database automatically--&gt;
  &lt;gbean name="ActiveDSGBean" class="org.apache.geronimo.connector.DatabaseInitializationGBean"&gt;
    &lt;attribute name="testSQL"&gt;SELECT t.tablename FROM SYS.SYSTABLES t WHERE lower(t.tablename)='statistics'&lt;/attribute&gt;
    &lt;attribute name="path"&gt;META-INF/database/derby/createTables.sql&lt;/attribute&gt;
    &lt;reference name="DataSource"&gt;
      &lt;name&gt;jdbc/ActiveDS&lt;/name&gt;
    &lt;/reference&gt;
  &lt;/gbean&gt;
  &lt;gbean name="ArchiveDSGBean" class="org.apache.geronimo.connector.DatabaseInitializationGBean"&gt;
    &lt;attribute name="testSQL"&gt;SELECT t.tablename FROM SYS.SYSTABLES t WHERE lower(t.tablename)='statistics'&lt;/attribute&gt;
    &lt;attribute name="path"&gt;META-INF/database/derby/createTables.sql&lt;/attribute&gt;
    &lt;reference name="DataSource"&gt;
      &lt;name&gt;jdbc/ArchiveDS&lt;/name&gt;
    &lt;/reference&gt;
  &lt;/gbean&gt;
  &lt;!--this ought to be in the agent plan but this realm is not always started before the credential-store, even with the dependency--&gt;
  &lt;gbean name="monitoring-runas-realm" class="org.apache.geronimo.security.realm.GenericSecurityRealm"&gt;
    &lt;attribute name="realmName"&gt;monitoring-runas-realm&lt;/attribute&gt;
    &lt;attribute name="global"&gt;false&lt;/attribute&gt;
    &lt;xml-reference name="LoginModuleConfiguration"&gt;
      &lt;lc:login-config xmlns:lc="http://geronimo.apache.org/xml/ns/loginconfig-1.2"&gt;
        &lt;lc:login-module control-flag="REQUIRED"&gt;
          &lt;lc:login-domain-name&gt;monitoring-runas-domain&lt;/lc:login-domain-name&gt;
          &lt;lc:login-module-class&gt;org.apache.geronimo.security.credentialstore.RunAsLoginModule&lt;/lc:login-module-class&gt;
          &lt;lc:option name="principalClass"&gt;org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal&lt;/lc:option&gt;
          &lt;lc:option name="principalNames"&gt;admin&lt;/lc:option&gt;
        &lt;/lc:login-module&gt;
      &lt;/lc:login-config&gt;
    &lt;/xml-reference&gt;
    &lt;!--&lt;reference name="ServerInfo"&gt;--&gt;
    &lt;!--&lt;name&gt;ServerInfo&lt;/name&gt;--&gt;
    &lt;!--&lt;/reference&gt;--&gt;
  &lt;/gbean&gt;
&lt;/connector&gt;
</plain-text-body>
You have to make the following changes to <code>db2-agent-ds.xml</code>:
	<ul><li>Update &lt;dependencies&gt; section with drivers required by DB2 Express-C.</li><li>Change the username and password for the datasource, and add ServerName and portnumber settings.</li><li>The <strong>DatabaseName</strong> for <strong>jdbc/ActiveDS</strong> is <code>activedb</code>, and  the <strong>DatabaseName</strong> for <strong>jdbc/ArchiveDS</strong> is <code>archdb</code>.</li></ul>
	</li><li>Similarly, create <code><a shape="rect" href="configuring-your-own-monitoring-plugin-datasource.data/db2-mconsole-ds.xml?version=1&amp;modificationDate=1247529736000&amp;api=v2" data-linked-resource-id="20874298" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="db2-mconsole-ds.xml" data-nice-type="XML File" data-linked-resource-content-type="text/xml" data-linked-resource-container-id="20645350" data-linked-resource-container-version="21">db2-mconsole-ds.xml</a></code>. <strong>DatabaseName</strong> in this file is <code>mcdb</code>.</li><li>Create the corresponding databases in DB2 Express-C: <strong>activedb</strong>, <strong>archdb</strong> and <strong>mcdb</strong>.</li><li>Change <code>var\config\config.xml</code> for Geronimo to prevent the following modules from being launched at startup time. This can be done by adding a <code>Load="false"</code> to each module. This will prevent the configuration changes below from causing conflicts.
	<ul><li>org.apache.geronimo.plugins.monitoring/agent-ds/2.2/car</li><li>org.apache.geronimo.plugins.monitoring/agent/2.2/car</li><li>org.apache.geronimo.plugins.monitoring/mconsole-ds/2.2/car</li><li>org.apache.geronimo.plugins.monitoring/mconsole-tomcat/2.2/car</li></ul>
	</li><li>Start the server and deploy the plans using the deploy command.
<plain-text-body>
deploy.bat deploy ..\repository\org\tranql\tranql-connector-db2-xa\1.3\tranql-connector-db2-xa-1.3.rar &lt;plan_path&gt;:\db2-agent-ds.xml
deploy.bat deploy ..\repository\org\tranql\tranql-connector-db2-xa\1.3\tranql-connector-db2-xa-1.3.rar &lt;plan_path&gt;:\db2-mconsole-ds.xml
</plain-text-body>
where &lt;plan_path&gt; is the directory where your plans are placed.</li><li>Shutdown the server and change <code>var\config\artifact_aliases.properties</code> file to replace default modules. In this way Geronimo will load DB2 datasources at startup time instead of the default ones.
<plain-text-body>
org.apache.geronimo.plugins.monitoring/agent-ds/2.2/car=org.apache.geronimo.plugins.monitoring/db2-agent-ds/2.2/car 
org.apache.geronimo.plugins.monitoring/mconsole-ds/2.2/car=org.apache.geronimo.plugins.monitoring/db2-mconsole-ds/2.2/car
</plain-text-body></li><li>In <code>var\config\config.xml</code>, load <code>org.apache.geronimo.plugins.monitoring/agent/2.2/car</code> and <code>org.apache.geronimo.plugins.monitoring/mconsole-tomcat/2.2/car</code> at startup time. This can be done by removing the <code>Load="false"</code> for each module.</li></ol>



</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Configuring your own Monitoring Plugin DataSource';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
