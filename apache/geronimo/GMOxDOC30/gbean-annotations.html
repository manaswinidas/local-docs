<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="GBean Annotations" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi GBean Annotations" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: GBean Annotations</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="reference.html">Reference</a>&nbsp;&gt;&nbsp;<a href="geronimo-architecture.html">Geronimo Architecture</a>&nbsp;&gt;&nbsp;<a href="gbeans.html">GBeans</a>&nbsp;&gt;&nbsp;<a href="gbean-annotations.html">GBean Annotations</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">GBean Annotations</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645475">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645475">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645475">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645475">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645475">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645475">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">
<p>Definition of annotations streamlines the definition of <strong>GBeanInfo</strong>. With the help of GBean annotations, you will be freed from adding attributes, operations, and references in GBeanInfo.</p>

<p>Annotations for GBeans are defined as follows, and are defined in the package <code>org.apache.geronimo.gbean.annotation</code>.</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@GBean</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Optional annotation defining the name and j2eeType of a GBean. If this annotation is not specified, then the default name is assumed to be the class (simple) name and the default j2eeType is GBean. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@Priority</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Optional annotation defining the priority of a GBean. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@ParamSpecial</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Annotation defining a GBean special attribute to be injected.</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@ParamAttribute</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Annotation defining the GBean attribute to be injected. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@ParamReference</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Annotation defining the GBean reference to be injected. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@Persistent</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Annotation for setter methods turning the corresponding GBean attributes into persistent attributes. </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@Reference</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> Annotation for setter methods turning the corresponding GBean attribute into a GBean reference. </p></td></tr></tbody></table></div>


<p>Note that at most one constructor must be annotated with @ParamSpecial, @ParamAttribute or @ParamReference.</p>

<h1 id="GBeanAnnotations-DevelopingaGBeanusingAnnotations">Developing a GBean using Annotations</h1>
<p>For developing a GBean with annotations, you at least have to go through the following steps:</p>
<ol><li>Write a POJO class</li><li>Implement GbeanLifecycle inteface to use the Gbean Kernel lifecycle callback (Optional).</li></ol>


<h2 id="GBeanAnnotations-AsampleGBean">A sample GBean</h2>
<p>Here we rewrite the sample simpleServerGBean provided in <a shape="rect" href="developing-and-deploying-a-geronimo-gbean.html">Developing and Deploying a Geronimo GBean</a>, which references another GBean named <em>EchoMessageGBean</em>. </p>
<ul><li>The SimpleServerGBean refers to another GBean <strong>EchoMessageInterface</strong>, which is described in <a shape="rect" href="developing-and-deploying-a-geronimo-gbean.html">Referencing another GBean</a>.</li><li>The Plain Old Java Object (POJO) code comes with a different constructor annotated with <strong>@ParamSpecial</strong>, <strong>@ParamAttribute</strong> or <strong>@ParamReference</strong>.</li><li>There is no difference between the LifeCycle code implemented with and without annotations.</li><li>As the Geronimo kernel will recognize and invoke the attributes, operations, references and constructors defined with annotations, we have removed GBeanInfo implementation.
<br clear="none" class="atl-forced-newline">
<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>SimpleServerGBean</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
public class SimpleServerGBean implements GBeanLifecycle, InterfaceNamed {
    private final String gbeanName;
    private EchoMessageInterface echo;
    private int port;

    private boolean started = false;
    private ServerSocket serversocket;

   /* Different contructor */ 
   public SimpleServerGBean(@ParamAttribute(name = "gbeanName") String gbeanName, 
			    @ParamAttribute(name = "port") int port,
			    @ParamReference(name = "EchoMessageInterface") EchoMessageInterface echomsg){
			                 
        this.gbeanName = gbeanName;
	this.port = port;
	this.echo= echomsg;
    }

    public String getName() {
        return this.gbeanName;
    }

    public boolean isStarted() {
        return started;
    }

    private void printConsoleLog(String log) {
        System.out.println(" LOG : " + log);
    }


    public void doFail() {
        started = false;
        printConsoleLog("GBean " + gbeanName + " failed");
    }

    public void doStart() throws Exception {

	 serversocket = new ServerSocket(port);
	 started = true;

	 Thread simpleServerThread = new Thread(new Runnable() {

	 Socket socket;
	 InputStream is;
	 OutputStream os;

	 public void run() {

	     while (started) {
		 try {
	             socket = serversocket.accept();
		     is = socket.getInputStream();
		     os = socket.getOutputStream();

		     BufferedReader bufferedReader = new BufferedReader(
		     new InputStreamReader(is));

		     String appendMessage=echo.getEchoMessage();
		     String responseMessage = appendMessage + bufferedReader.readLine();

		     os.write(responseMessage.getBytes());

		     bufferedReader.close();
		     if (os != null) {
		         os.close();
		     }
			
                     if (socket != null &amp;&amp; !socket.isClosed()) {
			 socket.close();
		     }

		 } catch (Exception e) {

		     //ingore

		    }
	       }

	 }

    });

     simpleServerThread.start();

     printConsoleLog("GBean " + gbeanName
				+ " started and it's listening on port:" + port);

     }

     public void doStop() throws Exception {

	 started = false;
	 serversocket.close();
	 printConsoleLog("GBean " + gbeanName + " stopped");
     }

}
</pre>
</div></div></li></ul>


<p>The dployment plan for SimpleServerGBean has to be modified.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Excerpt from simpleServer_deployment_plan.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;gbean name="echoserver" class="org.apache.geronimo.sample.SimpleServerGBean"&gt;
    &lt;attribute name="port"&gt;7777&lt;/attribute&gt;
    &lt;attribute name="gbeanName"&gt;simpleServer&lt;/attribute&gt;
    &lt;reference name="EchoMessageInterface"&gt;
        &lt;name&gt;msgAppender&lt;/name&gt;
    &lt;/reference&gt;
&lt;/gbean&gt;
	
&lt;gbean name="msgAppender" class="org.apache.geronimo.sample.EchoMessageGBean"&gt;
    &lt;attribute name="msg"&gt;[Echo from server 1]:&lt;/attribute&gt;
&lt;/gbean&gt;
</pre>
</div></div>
<p><strong>Note</strong>: If you define the <strong>j2eeType</strong> attribute of the EchoMessageInterface GBean, you have to specify this attribute in the <strong>&lt;reference&gt;</strong> section of deployment plan so that Geronimo can recognize the GBean.</p>

<h2 id="GBeanAnnotations-FurtherReference">Further Reference</h2>
<p>Two examples extracted from Geronimo source are presented here for your reference.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
@GBean
public class AuthConfigProviderGBean implements GBeanLifecycle {

    private final String registrationID;

    public AuthConfigProviderGBean(@ParamAttribute(name = "config") String config, 
                                   @ParamSpecial(type = SpecialAttributeType.classLoader) ClassLoader classLoader) 
    throws AuthException, JAXBException, IOException, ParserConfigurationException, SAXException, XMLStreamException {

        ClassLoaderLookup classLoaderLookup = new ConstantClassLoaderLookup(classLoader);

        String messageLayer = null;
        String appContext = null;

        AuthConfigFactory authConfigFactory = AuthConfigFactory.getFactory();
        ConfigProviderType configProviderType = JaspiXmlUtil.loadConfigProvider(new StringReader(config));
        AuthConfigProvider authConfigProvider = JaspiUtil.wraptAuthConfigProvider(configProviderType, classLoaderLookup);
        registrationID = authConfigFactory.registerConfigProvider(authConfigProvider, messageLayer, appContext, null);
    }

    public void doStart() throws Exception {
    }

    public void doStop() throws Exception {
        AuthConfigFactory authConfigFactory = AuthConfigFactory.getFactory();
        authConfigFactory.removeRegistration(registrationID);
    }

    /**
     * Fails the GBean.  This informs the GBean that it is about to transition to the failed state.
     */
    public void doFail() {
    }
}
</pre>
</div></div>

<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
@GBean
public class JmxDiscoveryPublisher implements GBeanLifecycle {

    private final URI service;
    private final DiscoveryAgent discoveryAgent;

    public JmxDiscoveryPublisher(@ParamAttribute(name = "nodeName")String nodeName,
                                 @ParamAttribute(name = "clusterName")String clusterName,
                                 @ParamAttribute(name = "protocol")String protocol,
                                 @ParamAttribute(name = "urlPath")String urlPath,
                                 @ParamAttribute(name = "discoveryType")String discoveryType,
                                 @ParamReference(name = "DiscoveryAgent")DiscoveryAgent discoveryAgent,
                                 @ParamReference(name = "RMIRegistryService")RMIRegistryService rmiRegistryService
    ) throws URISyntaxException, IOException {
        this.discoveryAgent = discoveryAgent;
        String query = null;
        if (nodeName != null &amp;&amp; nodeName.length() &gt; 0) {
            query = "node=" + nodeName;
        }
        if (clusterName != null) {
            query = (query == null? "": query + "&amp;") + "cluster=" + clusterName;
        }
        service = new URI(discoveryType + ":" + protocol, null,  rmiRegistryService.getHost(),
                          rmiRegistryService.getPort(), "/" + urlPath , query, null);
        discoveryAgent.registerService(service);
    }

    public void doStart() throws Exception {
    }

    public void doStop() throws Exception {
        discoveryAgent.unregisterService(service);
    }

    public void doFail() {
        try {
            doStop();
        } catch (Exception e) {
            //ignore
        }
    }
}
</pre>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : GBean Annotations';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
