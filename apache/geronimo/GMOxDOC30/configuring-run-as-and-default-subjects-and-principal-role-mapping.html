<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Configuring run-as and Default Subjects, and principal-role mapping" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Configuring run-as and Default Subjects, and principal-role mapping" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: Configuring run-as and Default Subjects, and principal-role mapping</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="administering-security.html">Administering Security</a>&nbsp;&gt;&nbsp;<a href="configuring-run-as-and-default-subjects-and-principal-role-mapping.html">Configuring run-as and Default Subjects, and principal-role mapping</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Configuring run-as and Default Subjects, and principal-role mapping</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645468">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645468">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645468">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645468">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645468">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645468">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><h1 id="Configuringrun-asandDefaultSubjects,andprincipal-rolemapping-Introduction">Introduction</h1>

<p>Starting from version 2.0.1, Geronimo adopts the basic principle that all security flows from Subjects that result from logging in to a security realm.  In previous Geronimo releases, security information for run-as and default subjects was constructed entirely outside any security realm.  As a result of following the new principle, run-as and default identities can now participate fully in security using such features as named credentials to access such external systems as connectors and web services, and the JACC system is now more fully pluggable.</p>

<p>However, because run-as and default subjects now result from logging in to a security realm, to use such a subject you need to supply the login information for each such subject.  This information is encapsulated in a CredentialStore.  We supply a simple CredentialStore implementation using XML in your Geronimo plan.  Note that this includes plain text passwords for the run-as and default subjects.  This might not be a suitable implementation for many environments.</p>

<p>Each application can choose to use a default, global, credential store or specify a specific store, perhaps specific to that application.</p>

<h1 id="Configuringrun-asandDefaultSubjects,andprincipal-rolemapping-ConfiguringaSimpleCredentialStoreImpl">Configuring a SimpleCredentialStoreImpl</h1>

<p>For each Subject accessible through a credential store, you need to specify an id, the realm to log in to, and credentials, which depend on the security realm requirements but are typically the name and password.  The schema is as follows:</p>

Error rendering macro 'code': Invalid value specified for parameter 'java.lang.NullPointerException'<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
--&gt;

&lt;!-- $Rev$ $Date$ --&gt;

&lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            xmlns:cs="http://geronimo.apache.org/xml/ns/credentialstore-1.0"
            targetNamespace="http://geronimo.apache.org/xml/ns/credentialstore-1.0"
            elementFormDefault="qualified" attributeFormDefault="unqualified"
            version="1.0"&gt;

    &lt;xsd:annotation&gt;
        &lt;xsd:documentation&gt;
            This is an XML Schema Definition for credential store configuration.
            CredentialStore configuration is
            specified by the element credential-store with namespace
            specified as xmlns =
            "http://geronimo.apache.org/xml/ns/credentialstore-1.0".
        &lt;/xsd:documentation&gt;
    &lt;/xsd:annotation&gt;

    &lt;xsd:element name="credential-store" type="cs:credential-storeType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                The root element for Geronimo credential store configuration. This
                is a tree structure of realm, id, and sets of credentials such as name and password
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;
    &lt;/xsd:element&gt;

    &lt;xsd:complexType name="credential-storeType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                Defines the list of realms
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="realm" type="cs:realmType" minOccurs="0" maxOccurs="unbounded"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        The realm element contains the credentials for subjects in that realm.
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="realmType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="subject" type="cs:subjectType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"&gt;
            &lt;xsd:annotation&gt;
                &lt;xsd:documentation&gt;
                    The name attribute specifies the login realm name
                &lt;/xsd:documentation&gt;
            &lt;/xsd:annotation&gt;
        &lt;/xsd:attribute&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="subjectType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="id" type="xsd:string"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        The id element serves to identify the subject externally. For subjects with meaningful
                        names it might be convenient to use the name as id.
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
            &lt;xsd:element name="credential" type="cs:credentialType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="credentialType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="type" type="xsd:string"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        Class name or alias of the callback handler that will accept this credential
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
            &lt;xsd:element name="value" type="xsd:string"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        credential value as a string.
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;


&lt;/xsd:schema&gt;
</pre>


<p>At the moment, Geronimo supplies callback handlers for name and password.  For other security realm requirements (e.g. certificates), you will have to write a callback handler.</p>

<p>A simple example of credential store configuration would look like this:</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Credential Store Example</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
    &lt;gbean name="CredentialStore" class="org.apache.geronimo.security.credentialstore.SimpleCredentialStoreImpl"&gt;
        &lt;xml-attribute name="credentialStore"&gt;
            &lt;credential-store xmlns="http://geronimo.apache.org/xml/ns/credentialstore-1.0"&gt;
                &lt;realm name="my-properties-realm"&gt;
                    &lt;subject&gt;
                        &lt;id&gt;admin-run-as&lt;/id&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;system&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;manager&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                    &lt;subject&gt;
                        &lt;id&gt;user-run-as&lt;/id&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;user&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;user-password&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                    &lt;subject&gt;
                        &lt;id&gt;default&lt;/id&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;default&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;default&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                &lt;/realm&gt;
            &lt;/credential-store&gt;
        &lt;/xml-attribute&gt;
    &lt;/gbean&gt;

</pre>
</div></div>

<p>Again, note that the PasswordCallbackHandler value element contains a plain text password for the user.</p>

<h1 id="Configuringrun-asandDefaultSubjects,andprincipal-rolemapping-ConfiguringyourapplicationtouseaparticularCredentialStore">Configuring your application to use a particular CredentialStore</h1>

<p>Note that this aspect of Geronimo security is completely pluggable and only the default implementation is described here.</p>

<p>Geronimo security for JavaEE applications requires including a &lt;security&gt; element in (one of) the GHeronimo plans for your application.  This describes the principal-role mappings to connect the Subjects from your security realm to the roles used in the spec deployment descriptors (and annotations).  It also describes how to interpret run-as roles as subjects through specifying a credential store and the id and realm for each role used as a run-as.  Similarly a default subject can be specified in the credential store.</p>

<p>The schema for security configuration is as follows:</p>

Error rendering macro 'code': Invalid value specified for parameter 'java.lang.NullPointerException'<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
--&gt;

&lt;!-- $Rev$ $Date$ --&gt;

&lt;xsd:schema
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
        xmlns:geronimo="http://geronimo.apache.org/xml/ns/security-2.0"
        targetNamespace="http://geronimo.apache.org/xml/ns/security-2.0"
        xmlns:app="http://geronimo.apache.org/xml/ns/j2ee/application-2.0"
        xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"
        elementFormDefault="qualified"
        attributeFormDefault="unqualified"
        version="2.0"&gt;

    &lt;xsd:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="http://www.w3.org/2001/xml.xsd"/&gt;
    &lt;xsd:import namespace="http://geronimo.apache.org/xml/ns/j2ee/application-2.0" schemaLocation="geronimo-application-2.0.xsd"/&gt;
    &lt;xsd:import namespace="http://geronimo.apache.org/xml/ns/deployment-1.2"  schemaLocation="geronimo-module-1.2.xsd"/&gt;

    &lt;xsd:element name="security" type="geronimo:securityType" substitutionGroup="app:security"/&gt;
    &lt;xsd:element name="credential-store" type="sys:patternType"/&gt;
    &lt;xsd:element name="default-subject" type="geronimo:subject-infoType"/&gt;

    &lt;xsd:complexType name="securityType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                Security entries

                If this element is present, all web and EJB modules MUST make the
                appropriate access checks as outlined in the JACC spec.
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;
        &lt;xsd:complexContent&gt;
            &lt;xsd:extension base="app:abstract-securityType"&gt;

                &lt;xsd:sequence&gt;
                    &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0"
                                 maxOccurs="unbounded"/&gt;
                    &lt;xsd:element name="credential-store-ref" type="sys:patternType" minOccurs="0"/&gt;
                    &lt;xsd:element name="default-subject" type="geronimo:subject-infoType" minOccurs="0"/&gt;
                    &lt;xsd:element name="role-mappings" type="geronimo:role-mappingsType" minOccurs="0"/&gt;
                &lt;/xsd:sequence&gt;
                &lt;xsd:attribute name="doas-current-caller" type="xsd:boolean" default="false"&gt;
                    &lt;xsd:annotation&gt;
                        &lt;xsd:documentation&gt;
                            Set this attribute to "true" if the work is to be performed
                            as the calling Subject.
                        &lt;/xsd:documentation&gt;
                    &lt;/xsd:annotation&gt;
                &lt;/xsd:attribute&gt;
                &lt;xsd:attribute name="use-context-handler" type="xsd:boolean" default="false"&gt;
                    &lt;xsd:annotation&gt;
                        &lt;xsd:documentation&gt;
                            Set this attribute to "true" if the installed JACC policy
                            contexts will use PolicyContextHandlers.
                        &lt;/xsd:documentation&gt;
                    &lt;/xsd:annotation&gt;
                &lt;/xsd:attribute&gt;
                &lt;xsd:attribute name="default-role" type="xsd:string"&gt;
                    &lt;xsd:annotation&gt;
                        &lt;xsd:documentation&gt;
                            Used by the the Deployer to assign method permissions for
                            all of the unspecified methods, either by assigning them
                            to security roles, or by marking them as unchecked. If
                            the value of default-role is empty, then the unspecified
                            methods are marked unchecked
                        &lt;/xsd:documentation&gt;
                    &lt;/xsd:annotation&gt;
                &lt;/xsd:attribute&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:complexContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="descriptionType"&gt;
        &lt;xsd:simpleContent&gt;
            &lt;xsd:extension base="xsd:string"&gt;
                &lt;xsd:attribute ref="xml:lang"/&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:simpleContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="named-username-password-credentialType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="name" type="xsd:string"/&gt;
            &lt;xsd:element name="username" type="xsd:string"/&gt;
            &lt;xsd:element name="password" type="xsd:string"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="role-mappingsType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="role" type="geronimo:roleType" minOccurs="1" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="roleType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="run-as-subject" type="geronimo:subject-infoType" minOccurs="0"/&gt;
            &lt;xsd:element name="realm-principal" type="geronimo:realmPrincipalType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="login-domain-principal" type="geronimo:loginDomainPrincipalType" minOccurs="0"
                         maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="principal" type="geronimo:principalType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="distinguished-name" type="geronimo:distinguishedNameType" minOccurs="0"
                         maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="role-name" type="xsd:string" use="required"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="realmPrincipalType"&gt;
        &lt;xsd:complexContent&gt;
            &lt;xsd:extension base="geronimo:loginDomainPrincipalType"&gt;
                &lt;xsd:attribute name="realm-name" type="xsd:string" use="required"/&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:complexContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="loginDomainPrincipalType"&gt;
        &lt;xsd:complexContent&gt;
            &lt;xsd:extension base="geronimo:principalType"&gt;
                &lt;xsd:attribute name="domain-name" type="xsd:string" use="required"/&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:complexContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="principalType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="class" type="xsd:string" use="required"/&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="distinguishedNameType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="subject-infoType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="realm" type="xsd:string"/&gt;
            &lt;xsd:element name="id" type="xsd:string"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;!--&lt;xsd:complexType name="credential-storeType"&gt;--&gt;
        &lt;!--&lt;xsd:sequence&gt;--&gt;
            &lt;!--&lt;xsd:element name="pattern" type="sys:patternType"&gt;--&gt;
                &lt;!--&lt;xsd:annotation&gt;--&gt;
                    &lt;!--&lt;xsd:documentation&gt;--&gt;
                        &lt;!--The pattern element defines a components of the--&gt;
                        &lt;!--abstract name of GBean referred. It (optionally) includes--&gt;
                        &lt;!--the groupId, artifactId, version,--&gt;
                        &lt;!--module, type, and name of the GBean module.--&gt;
                    &lt;!--&lt;/xsd:documentation&gt;--&gt;
                &lt;!--&lt;/xsd:annotation&gt;--&gt;
            &lt;!--&lt;/xsd:element&gt;--&gt;
        &lt;!--&lt;/xsd:sequence&gt;--&gt;
    &lt;!--&lt;/xsd:complexType&gt;--&gt;

&lt;/xsd:schema&gt;
</pre>


<p>The credential store to use is specified in the credential-store-ref.  Normally you only need only supply the name component of the credential store name: for most purposes you are likely to include an app specific credential store in the application plan, but otherwise you need to assure that the credential store gbean is in the ancestor configurations of the application.</p>

<p>A default subject or each run-as role specifies the information needed to get the subject using a subject-infoType element.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Example Security Configuration</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
      &lt;security use-context-handler="false" xmlns="http://geronimo.apache.org/xml/ns/security-2.0"&gt;
        &lt;default-subject&gt;
          &lt;realm&gt;my-properties-realm&lt;/realm&gt;
          &lt;id&gt;default&lt;/id&gt;
        &lt;/default-subject&gt;
        &lt;role-mappings&gt;
          &lt;role role-name="Administrator"&gt;
            &lt;principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="system"/&gt;
          &lt;/role&gt;
          &lt;role role-name="User"&gt;
            &lt;run-as-subject&gt;
                &lt;realm&gt;my-properties-realm&lt;/realm&gt;
                &lt;id&gt;user-run-as&lt;/id&gt;
            &lt;/run-as-subject&gt;the loi
            &lt;principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;
          &lt;/role&gt;
        &lt;/role-mappings&gt;
      &lt;/security&gt;
</pre>
</div></div>

<p>The sample above shows the simplest principal-role mapping: you specify the principal class and name for each principal that maps to a certain role.  Normally this will be entirely sufficient to distinguish principals.  However, you might have several login modules or security realms that can produce the same principal but with different meanings.  In this case you can include the login domain name or realm name to distinguish the principals.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Additional principal specifications</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!-- normal, no domain or realm info --&gt;
&lt;principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;

&lt;!-- login domain name specified --&gt;
&lt;login-domain-principal domain-name="mydomain" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;

&lt;~-- realm name and login domain name specified&gt;
&lt;realm-principal realm-name="my-properties-realm" domain-name="mydomain" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;

</pre>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Configuring run-as and Default Subjects, and principal-role mapping';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
