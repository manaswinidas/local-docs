<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Developing and Deploying a Geronimo GBean" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Developing and Deploying a Geronimo GBean" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Developing and Deploying a Geronimo GBean</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="reference.html">Reference</a>&nbsp;&gt;&nbsp;<a href="geronimo-architecture.html">Geronimo Architecture</a>&nbsp;&gt;&nbsp;<a href="gbeans.html">GBeans</a>&nbsp;&gt;&nbsp;<a href="developing-and-deploying-a-geronimo-gbean.html">Developing and Deploying a Geronimo GBean</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Developing and Deploying a Geronimo GBean</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645474">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645474">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645474">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645474">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645474">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645474">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p>Geronimo is a system framework that can be used to build a variety of tailored infrastructure services, with <strong>GBean</strong> providing it with a loosely-coupled and configurable runtime environments. GBean is an implementation of Inversion of Control (IoC), or the dependency injection, which allows the automatic injection of references as they become available. This tutorial is organized as follows:</p>


<h1 id="DevelopingandDeployingaGeronimoGBean-GeronimoKernelandGBean">Geronimo Kernel and GBean</h1>

<h2 id="DevelopingandDeployingaGeronimoGBean-Geronimokernel">Geronimo kernel</h2>
<p>The Geronimo kernel is a framework for kernel services, and controls the basic server components with the following services:</p>
<ul><li>Component configuration</li><li>Component repository</li><li>Dependency management</li><li>Lifecycle management</li></ul>


<p>The basic server componenets, namely <strong>security</strong>, <strong>logging</strong>, <strong>transactions</strong>, and <strong>naming</strong>, work with the kernel services to build Java EE server components, such as Tomcat, Jetty, and OpenEJB. All these components, cooperate with the kernel to support Java EE applications. </p>

<h2 id="DevelopingandDeployingaGeronimoGBean-GBeans">GBeans</h2>
<p>Almost everything in Geronimo is a GBean: containers, connectors, adapters, applications and so on. A GBean is an atomic unit in Geronimo, consisting of the implementation classes (.jar) and a <em>plan</em>. </p>

<p>The <em>plan</em> is a configuration file through which a GBean relies on the kernel for IoC and dependency injection at runtime. Dependencies on other GBeans can be configured through the attributes and references in plans. Geronimo's configuration builders construct GBeans out of these plans, group them as <em>configurations</em>, and store them in the <em>configuration store</em>. </p>

<p>A <em>configuration</em> is a logically coupled collection of one or more GBeans and a classloader. The configurations are loaded with the server. The <em>configuration store</em> is the standard Geronimo storage mechanism. </p>

<p>Applications that run in a Java EE container, described by custom <em>deployment descriptors</em> and Java classes, will be parsed and converted into GBeans by the configuration builders of the Geronimo <strong>Deployer</strong>. These GBeans are also stored in the configuration store.</p>

<h3 id="DevelopingandDeployingaGeronimoGBean-GBeanLifecycle">GBean Lifecycle</h3>

<p>A GBean can be in any of the three states: stored, loaded, or running.</p>
<ul><li>Stored: The GBean exists in a plan, or configuration store.</li><li>Loaded: The GBean is mapped to a non-persistent name when loaded by the kernel, allowing multiple instances of the same GBean to exist.</li><li>Running: The GBean is in the running state, coordinating the application classes that it contains.</li></ul>


<p>To participate in the life cycle operations, GBeans implement a <em>GBeanLifecycle</em> interface. This interface defines three methods, <code>doStart()</code>, <code>doStop()</code> and <code>doFail()</code>. </p>
<ul><li>The <code>doStart()</code> method is used to start the GBean, and implement the GBean operations. It should not be used when the GBean is in a failed state.</li><li>The <code>doFail()</code> method is executed when the GBean fails to start, run or stop. It marks the GBean as failed, and always calls doStop() to stop it.</li><li>The <code>doStop()</code> menthods stops the GBean.
<parameter ac:name="">java</parameter><plain-text-body>
package org.apache.geronimo.gbean;

public interface GBeanLifecycle{
void doStart() throws Exception;
void doStop() throws Exception;
void doFail();
}
</plain-text-body>
If the optional interface GBeanLifecycle is implemented, the implementation will get lifecycle callbacks from the kernel.</li></ul>



<h3 id="DevelopingandDeployingaGeronimoGBean-GBeanmethods">GBean methods</h3>
<p>The class for a GBean should implement specific methods to support each feature of the GBean:</p>
<ul><li><strong>GBeanInfo</strong>: A GBean has a method called getGBeanInfo() that returns an instance of the GBeanInfo class. GBeanInfo defines the methods that should be exposed to the other subsystems, exposes attributes and references so that they can be injected at runtime, and define information about the GBean so that it can be located later. The GBeanInfo object is constructed in a static initializer.</li><li><strong>Constructor</strong>: The GBean constructor arguments should correspond to either attributes or references for the GBean. It is defined by the <strong>setConstructor</strong> method in GBeanInfo.</li><li><strong>Attributes</strong>: An attribute should have a setter method, a getter method, or both. The <strong>addAttribute</strong> method in GBeanInfo should define the name of the attribute, its type and whether or not it's persistent, so that the attribute can be injected via the Geronimo kernel.</li><li><strong>Operations</strong>: Any public method on the GBean that is not a getter or setter can be an operation. The operation methods should match the name and argument types listed by <strong>addOperation</strong> for the operations in the GBeanInfo.</li><li><strong>References</strong>: A reference, like an attribute, is injected at runtime. However, a reference is another GBean rather than a String or an integer.</li><li><strong>Interfaces</strong>: Adding a reference in GBeanInfo is a faster way of adding attributes or operations separately. All of the variables in the interface will be added as attributes and all of the methods will be added as operations.</li></ul>


<h1 id="DevelopingandDeployingaGeronimoGBean-DevelopingaGBean">Developing a GBean</h1>
<p>For developing a GBean, you at least have to go through the following steps:</p>
<ol><li>Write a POJO class</li><li>Adding the GBeanInfo part to expose attributes,methods, interfaces, and constructors</li><li>Implement GbeanLifecycle inteface to use the Gbean Kernel lifecycle callback (<strong>Optional</strong>)</li></ol>



<h2 id="DevelopingandDeployingaGeronimoGBean-AsampleGBean">A sample GBean</h2>
<p>The sample GBean SimpleServerGBean simply starts a socket on the Geronimo server, and retrieves the name of the GBean and the socket port. The following code snippet implements the Plain Old Java Object (POJO) section:</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">SimpleServerGBean POJO</parameter><plain-text-body>
public class SimpleServerGBean implements GBeanLifecycle, InterfaceNamed{

    private final String gbeanName;
    private int port;

    private boolean started = false;
    private ServerSocket serversocket;

    public SimpleServerGBean(String gbeanName, int port) {
	this.gbeanName= gbeanName;
	this.port = port;
    }

    public String getName() {

        return this.gbeanName;
    }

    public boolean isStarted() {

	 return started;
    }

    private void printConsoleLog(String log) {

	 System.out.println(" LOG : " + log);
    }
</plain-text-body>

<p>In the following code snippet, the GBean exposes its attributes, operations, interfaces and constructor for the GBEAN_INFO static initializer.</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">SimpleServerGBean GBeanInfo</parameter><plain-text-body> 
   
    private static final GBeanInfo GBEAN_INFO;

        static {
	    GBeanInfoBuilder infoFactory = new GBeanInfoBuilder(
	    SimpleServerGBean.class.getName(), SimpleServerGBean.class);

	    infoFactory.addAttribute("gbeanName", String.class, false);
	    infoFactory.addAttribute("port", int.class, true);

	    infoFactory.addOperation("isStarted", "String");

	    infoFactory.addInterface(InterfaceNamed.class);

	    infoFactory.setConstructor(new String[] { "gbeanName", "port" });

	    GBEAN_INFO = infoFactory.getBeanInfo();
        }

    public static GBeanInfo getGBeanInfo() {
		return GBEAN_INFO;
    }
</plain-text-body>


<p>The SimpleServerGBean Gbean is simple to start up and shutdown. During startup, it simply accepts an incoming socket connection requests, and sends out the echo message. When being stopped, the GBean closes the resouces that it consumes.</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">SimpleServerGBean Lifecycle</parameter><plain-text-body> 

    
    public void doFail() {
    
    started = false;
    printConsoleLog("GBean " + gbeanName+ " failed");
    
    }



    public void doStart() throws Exception {

        serversocket = new ServerSocket(port);
	started = true;

        Thread simpleServerThread = new Thread(new Runnable() {

	 Socket socket;
	 InputStream is;
	 OutputStream os;

	 public void run() {

	     while (started) {
  		 try {
  		     socket = serversocket.accept();
  		     is = socket.getInputStream();
  	             os = socket.getOutputStream();
  
  		     BufferedReader bufferedReader = new BufferedReader(
  		     new InputStreamReader(is));
  
  		     String responseMessage = "simpleServer response :"
  		         + bufferedReader.readLine();
  
  		     os.write(responseMessage.getBytes());
  
  		     bufferedReader.close();
  		     if (os != null) {
  		         os.close();
  		     }
  		     if (socket != null &amp;&amp; !socket.isClosed()) {
  			 socket.close();
  		     }

		 } catch (Exception e) {
		     //ingore

		 }
             }
         }
    });

        simpleServerThread.start();

	printConsoleLog("GBean " + gbeanName
	    + " started and it's listening on port:" + port);
    }



    public void doStop() throws Exception {
            started = false;
	    serversocket.close();
	    printConsoleLog("GBean " + gbeanName+ " stopped");
    } 

}  
</plain-text-body>

<p>For this sample, we still need a class to test the SimpleServerGBean. This section creates a socket and sends a connection request to the SimpleServerGBean. After the connection has been established, it sends out messages and retrieves the echo message from the simpleServerGBean server instance.</p>
<parameter ac:name="java:title">SimpleServerTest</parameter><plain-text-body>
package org.apache.geronimo.sample;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.InetSocketAddress;
import java.net.Socket;

import org.junit.Ignore;
import org.junit.Test;

public class SimpleServerTest {

    @Test
    @Ignore

        public void connectToSimpleServer() throws Exception {
		

        Socket socket = new Socket();
        socket.connect(new InetSocketAddress("127.0.0.1", 7777));
		
        OutputStream os = socket.getOutputStream();
        String requestMessage = "Hello simple server";
        os.write(requestMessage.getBytes());
        os.write("\n".getBytes());
        os.flush();

        InputStream is = socket.getInputStream();
        BufferedReader bufferReader = new BufferedReader(new InputStreamReader(is));
        String responseMessage = bufferReader.readLine();
        System.out.println(responseMessage);

        socket.close();
    }	

}
</plain-text-body>

<p>Before deploying your GBean, you still have to compile the GBean class and build a proper .jar file. <a shape="rect" class="external-link" href="http://maven.apache.org/">Maven</a> is used to build Geronimo, so it can be used to build your GBean project. You have to write a <code>pom.xml</code> file. See <a shape="rect" class="external-link" href="http://maven.apache.org/">Maven website</a> for more information about the file.</p>
<parameter ac:name="">xml</parameter><parameter ac:name="title">pom.xml</parameter><plain-text-body>
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;org.apache.geronimo.sample&lt;/groupId&gt;
    &lt;artifactId&gt;simpleServer&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;name&gt;sample GBean as a simple server&lt;/name&gt;


    &lt;dependencies&gt;
        &lt;dependency&gt;
	    &lt;groupId&gt;org.apache.geronimo.framework&lt;/groupId&gt;
	    &lt;artifactId&gt;geronimo-kernel&lt;/artifactId&gt;
	    &lt;version&gt;2.1.3&lt;/version&gt;
	&lt;/dependency&gt;

	&lt;dependency&gt;
	    &lt;groupId&gt;junit&lt;/groupId&gt;
	    &lt;artifactId&gt;junit&lt;/artifactId&gt;
	    &lt;version&gt;4.1&lt;/version&gt;
	    &lt;scope&gt;test&lt;/scope&gt;
	&lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
        
            &lt;plugin&gt;
	        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
		&lt;configuration&gt;
		    &lt;source&gt;1.5&lt;/source&gt;
		    &lt;target&gt;1.5&lt;/target&gt;
		&lt;/configuration&gt;
	    &lt;/plugin&gt;

        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</plain-text-body>
<p>In the POM file above, </p>
<ul><li>The only dependency you need to develop a GBean is
<parameter ac:name="">xml</parameter><plain-text-body>
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.geronimo.framework&lt;/groupId&gt;
        &lt;artifactId&gt;geronimo-kernel&lt;/artifactId&gt;
	&lt;version&gt;2.1.3&lt;/version&gt;
    &lt;/dependency&gt;
</plain-text-body> </li><li>We add following section to the POM only for the sake of the testing code.
<parameter ac:name="">xml</parameter><plain-text-body>
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
	&lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.1&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
	&lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
	        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
		&lt;configuration&gt;
		    &lt;source&gt;1.5&lt;/source&gt;
		    &lt;target&gt;1.5&lt;/target&gt;
		&lt;/configuration&gt;
	    &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</plain-text-body></li></ul>


<h1 id="DevelopingandDeployingaGeronimoGBean-DeployingtheGBean">Deploying the GBean</h1>
<p>Follow these steps to deploy your GBean to Geronimo.</p>
<ol><li>Deploy the GBean package. There are two methods to deploy a GBean package to Geronimo.
	<ul><li>Deploy the .jar to the server via the <strong>JAR repository</strong> portlet in Geronimo administrative console. For example, you can deploy the SimpleServerGBean with the following information:
		<ul><li><strong>GroupId</strong>: org.apache.geronimo.sample</li><li><strong>ArtifactId</strong>: simpleServer</li><li><strong>Version</strong>: 1.0</li><li><strong>Type</strong>: jar</li></ul>
		</li><li>Mannually copy the jar file to the GERONIMO_HOME/repository with a path and package name rule.
		<ul><li>Path : <code>GroupId/ArtifactId/Version/ArtifactId-Version.Type</code></li><li>Sample: <code>&lt;GERONIMO_HOME&gt;/repository/org/apache/geronimo/sample/simpleServer/1.0/simpleServer-1.0.jar</code><br clear="none">
<strong>Note</strong>: If the GBean depends on an external library, you have to deploy both .jars into the repository, and list both of them in the &lt;dependencies&gt; section of the deployment plan described below.</li></ul>
		</li></ul>
	</li><li>The next step is to develop a GBean deployment plan. A deployment plan is to define a Geronimo <em>module</em> as an .xml file that includes the descriptions of one or more instances of exsiting GBeans.
<parameter ac:name="">xml</parameter><parameter ac:name="title">simpleServer_deployment_plan.xml</parameter><plain-text-body>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
    &lt;environment&gt;
        &lt;moduleId&gt;
	    &lt;groupId&gt;org.apache.geronimo.sample&lt;/groupId&gt;
	        &lt;artifactId&gt;simpleServerModule&lt;/artifactId&gt;
		&lt;version&gt;1.0&lt;/version&gt;
		&lt;type&gt;car&lt;/type&gt;
	&lt;/moduleId&gt;

	&lt;dependencies&gt;
	    &lt;dependency&gt;
	        &lt;groupId&gt;org.apache.geronimo.sample&lt;/groupId&gt;
		&lt;artifactId&gt;simpleServer&lt;/artifactId&gt;
		&lt;version&gt;1.0&lt;/version&gt;
	    &lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;hidden-classes /&gt;

	&lt;non-overridable-classes /&gt;

    &lt;/environment&gt;

    &lt;gbean name="echoserver" class="org.apache.geronimo.sample.SimpleServerGBean"&gt;
        &lt;attribute name="port"&gt;7777&lt;/attribute&gt;
	 &lt;attribute name="gbeanName"&gt;simpleServer&lt;/attribute&gt;
    &lt;/gbean&gt;
&lt;/module&gt;
</plain-text-body>
Let's briefly go through this plan. 
	<ul><li>The <strong>&lt;moduleId&gt;</strong> element is used to provide the configuration name for the module as deployed in the Geronimo server. It contains elements for the <strong>groupId</strong>, <strong>artifactId</strong>, <strong>version</strong> and <strong>type</strong>. Module IDs are normally printed with slashes between the four components, such as <code>GroupID/ArtifactID/Version/Type</code>. In this example, The module ID will be <code>org.apache.geronimo.sample/simpleServer/1.0/car</code>.</li><li>The <strong>&lt;dependencies&gt;</strong> element is used to provide the configurations on which the module is dependent upon. In this example, the module is dependent on <code>org.apache.geronimo.sample/simpleServer/1.0</code>.</li></ul>
	</li><li>Deploy the deployment plan to the server. There are two methods to deploy a GBean Module with a plan to Geronimo.
	<ul><li>Using the <strong>Deploy New</strong> portlet in the administrative console.</li><li>Using the <a shape="rect" href="deploy.html">deployer</a> tools or <a shape="rect" class="unresolved" href="#">GShell</a> command.</li></ul>
	</li><li>If success, you can visit <a shape="rect" class="external-link" href="http://localhost:7777" rel="nofollow">http://localhost:7777</a> and will get an echo from the server.</li></ol>


<p><strong>Note</strong>: If a GBean implementation (possibly a .jar) already exisits in the Geronimo server, you only need to develop a deployment plan and deploy it to the server for the GBean instance to work.</p>

<h1 id="DevelopingandDeployingaGeronimoGBean-ReferencinganotherGBean">Referencing another GBean </h1>
<p>Other GBeans can be used in a GBean by injecting <strong>Reference</strong> methods. For instance, the GBean <em>SimpleServerGBean</em> can make use of another GBean named <em>EchoMessageGBean</em> with its POJO class and GBeanInfo implemented like the following:</p>
<parameter ac:name="">java</parameter><parameter ac:name="title">EchoMessageGBean</parameter><plain-text-body>
package org.apache.geronimo.sample;

import org.apache.geronimo.gbean.GBeanInfo;
import org.apache.geronimo.gbean.GBeanInfoBuilder;

public class EchoMessageGBean implements EchoMessageInterface {
    private final String msg;

    public EchoMessageGBean(String name) {
        this.msg = name;
    }

    private static final GBeanInfo GBEAN_INFO;

    static {
        GBeanInfoBuilder infoFactory = new GBeanInfoBuilder(
				EchoMessageGBean.class);

        infoFactory.addAttribute("msg", String.class, false);

        infoFactory.addInterface(EchoMessageInterface.class);

	infoFactory.setConstructor(new String[] { "msg" });

	GBEAN_INFO = infoFactory.getBeanInfo();
    }

    public static GBeanInfo getGBeanInfo() {
        return GBEAN_INFO;
    }

    public String getEchoMessage() {
	return msg;
    }
}
</plain-text-body>
<p>This EchoMessageGBean does not implement GbeanLifecycle for simplicity. It only exposes an interface <em>EchoMessageInterface</em> which retrieves predefined echo messages.</p>

<p>To reference the <em>EchoMessageGBean</em> in SimpleServerGBean, the following steps have to be taken:</p>
<ol><li>SimpleServerGBean now has  more private members and a different constructor:
<parameter ac:name="">java</parameter><parameter ac:name="title">Excerpt from SimpleServerGBean POJO</parameter><plain-text-body>
private final String gbeanName;
private int port;

/* A new private member */
private EchoMessageInterface echo;

private boolean started = false;
private ServerSocket serversocket;

/* Constructor changed */
public SimpleServerGBean(String gbeanName, int port, EchoMessageInterface echomsg) {
    this.gbeanName= gbeanName;
    this.port = port;
    this.echo= echomsg;
}
</plain-text-body></li><li>In doStart() of the SimpleServerGBean implementation, we now retrieves messages from EchoMessageGBean and reorganizes the reponse message:
<parameter ac:name="">java</parameter><parameter ac:name="title">Excerpt from SimpleServerGBean doStart()</parameter><plain-text-body>
String appendMessage = echo.getEchoMessage();
String responseMessage = appendMessage + bufferedReader.readLine();
</plain-text-body></li><li>Add a <strong>Reference</strong> method to GBeanInfo:
<parameter ac:name="">java</parameter><parameter ac:name="title">SimpleServerGBean GBeanInfo</parameter><plain-text-body>
private static final GBeanInfo GBEAN_INFO;

    static {
        GBeanInfoBuilder infoFactory = new GBeanInfoBuilder(
		SimpleServerGBean.class.getName(), SimpleServerGBean.class);

        infoFactory.addAttribute("gbeanName", String.class, false);
	infoFactory.addAttribute("port", int.class, true);
	infoFactory.addOperation("isStarted", "String");
	infoFactory.addInterface(InterfaceNamed.class);

        /* Add a reference */
	infoFactory.addReference("echoMessenger",EchoMessageInterface.class);

        /* A different constructor */
	infoFactory.setConstructor(new String[] { "gbeanName", "port", "echoMessenger"});

	GBEAN_INFO = infoFactory.getBeanInfo();
    }
</plain-text-body> </li><li>Correspondingly, the dployment plan for SimpleServerGBean has to be modified.
<parameter ac:name="">xml</parameter><parameter ac:name="title">Excerpt from simpleServer_deployment_plan.xml</parameter><plain-text-body>
&lt;gbean name="echoserver" class="org.apache.geronimo.sample.SimpleServerGBean"&gt;
    &lt;attribute name="port"&gt;7777&lt;/attribute&gt;
    &lt;attribute name="gbeanName"&gt;simpleServer&lt;/attribute&gt;
    &lt;reference name="echoMessenger"&gt;
        &lt;name&gt;msgAppender&lt;/name&gt;
    &lt;/reference&gt;
&lt;/gbean&gt;
	
&lt;gbean name="msgAppender" class="org.apache.geronimo.sample.EchoMessageGBean"&gt;
    &lt;attribute gbeanName="msg"&gt;[Echo from server]:&lt;/attribute&gt;
&lt;/gbean&gt;
</plain-text-body>
After we add the .jar file to the server, and deploy the plan, the test class which initiates a socket on port 7777 will get a reponse message from the server.<br clear="none">
<parameter ac:name="nopanel">true</parameter><plain-text-body>[Echo from server]: Hello simple server</plain-text-body></li></ol>


<p>The GBean SimpleServerGBean can reference different instances of EchoMessageGBean. For instance, the SimpleServerGBean listens on port 7778 instead, and gets messages from the instance <strong>msgAppender2</strong>.</p>
<parameter ac:name="">xml</parameter><parameter ac:name="title">Excerpt from simpleServer_deployment_plan2.xml</parameter><plain-text-body>
&lt;gbean name="echoserver" class="org.apache.geronimo.sample.SimpleServerGBean"&gt;
    &lt;attribute name="port"&gt;7778&lt;/attribute&gt;
    &lt;attribute name="gbeanName"&gt;simpleServer&lt;/attribute&gt;
    &lt;reference name="echoMessenger"&gt;

        &lt;!-- Reference another instance of EchoMessageGBean --&gt;
        &lt;name&gt;msgAppender2&lt;/name&gt;
    &lt;/reference&gt;
&lt;/gbean&gt;

&lt;gbean name="msgAppender" class="org.apache.geronimo.sample.EchoMessageGBean"&gt;
    &lt;attribute name="msg"&gt;[Echo from server]:&lt;/attribute&gt;

&lt;!--Another instance of EchoMessageGBean --&gt;
&lt;gbean name="msgAppender2" class="org.apache.geronimo.sample.EchoMessageGBean"&gt;
    &lt;attribute name="msg"&gt;[Echo from server 2]:&lt;/attribute&gt;
&lt;/gbean&gt;
</plain-text-body>
<p>When we deploy this plan (The .jar file does not have to be changed), the test class which starts a socket on port 7778 will gets the reponse from server 2. <parameter ac:name="nopanel">true</parameter><plain-text-body>[Echo from server 2]: Hello simple server</plain-text-body></p>


<h1 id="DevelopingandDeployingaGeronimoGBean-GeronimoBootstrap">Geronimo Bootstrap</h1>
<p>When Geronimo starts, the <code>&lt;GERONIMO_HOME&gt;/bin/server.jar</code> is executed with <code>org.apache.geronimo.cli.daemon.DaemonCLI</code> as the main class. This will boot the Geronimo kernel, and load initial GBeans from module <code>j2ee-system-2.1.3.car</code> into the kenel.</p>

</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Developing and Deploying a Geronimo GBean';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
