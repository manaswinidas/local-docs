<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Deploying and running JPA application client" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Deploying and running JPA application client" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Deploying and running JPA application client</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="developing.html">Developing</a>&nbsp;&gt;&nbsp;<a href="tutorials.html">Tutorials</a>&nbsp;&gt;&nbsp;<a href="developing-application-clients.html">Developing application clients</a>&nbsp;&gt;&nbsp;<a href="deploying-and-running-jpa-application-client.html">Deploying and running JPA application client</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Deploying and running JPA application client</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645241">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645241">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645241">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645241">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645241">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645241">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><p>The Java Persistence API (JPA) is a new programming model under EJB3.0 specification (JSR220) for the management of persistence and object/relational mapping with Java EE and Java SE. With JPA, developers can easily develop java applications that perform operations on relational database management systems using java objects and mapping. In that way, java applications developed using JPA are not only portable across different platforms, but also applications can be easily developed using simple yet powerful programming model provided by JPA. This greatly improves application maintainability against ever changing database world. JPA insulates applications from all the complexity and non-portable boilerplate code involved in database connectivity and operations.</p>

<p>Apache Geronimo uses <a shape="rect" class="external-link" href="http://openjpa.apache.org/">Apache OpenJPA</a> for providing Java Persistence API implementation to Java EE applications deployed in the server. Even though JPA is a part of EJB3 spec, it is independent of it. Hence, JPA can be used in JavaSE, web and ejb applications in the same uniform way. Think of a JPA implementation, e.g. Apache OpenJPA as a driver for JPA (JPA driver) similarly to what a JDBC driver is for JDBC.</p>

<p>The below section illustrates developing and deploying a JEE application client that uses JPA to access and manipulate database data residing in an embedded derby database.</p>

<p>In order to develop, deploy and run the application, the following environment is required.</p>

<ul><li>Sun JDK 5.0+ (J2SE 1.5)</li><li>Eclipse 3.3.1.1 (Eclipse Classic package of Europa distribution), which is platform specific</li><li>Web Tools Platform (WTP) 2.0.1</li><li>Data Tools Platform (DTP) 1.5.1</li><li>Eclipse Modeling Framework (EMF) 2.3.1</li><li>Graphical Editing Framework (GEF) 3.3.1</li></ul>


<p>The article has the following sections.</p>

<ul><li>Setting up Eclipse for Application development</li><li>Developing Entities and Client</li><li>Preparing Deployment Descriptors and Deployment Plans</li><li>Deploying the application client</li><li>Running the application client</li></ul>


<p>To download the complete application, click on <a shape="rect" href="deploying-and-running-jpa-application-client.data/JPAAppClient.jar?version=1&amp;modificationDate=1212102269000&amp;api=v2" data-linked-resource-id="20873571" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="JPAAppClient.jar" data-nice-type="Java Archive" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5">link</a></p>

<h2 id="DeployingandrunningJPAapplicationclient-SettingEclipseforApplicationdevelopment">Setting Eclipse for Application development</h2>

<p>1. Start the Eclipse IDE and create <code>ApplicationClientJPA</code> java project.<br clear="none">
   Right click on the <em>Project Explorer</em> Window and click on <em>New &gt; Java Project</em>.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/1.JPG" data-image-src="/confluence/download/attachments/20645241/1.JPG?version=1&amp;modificationDate=1211841431000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873567" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="1.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Provide <code>ApplicationClientJPA</code> as the name for the Java Project.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/2.JPG" data-image-src="/confluence/download/attachments/20645241/2.JPG?version=1&amp;modificationDate=1211841431000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873566" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="2.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Click on <em>Finish</em>.</p>

<p>   Right click on the Project and click on the <em>Properties</em> option which is the last option in the menu.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/11.JPG" data-image-src="/confluence/download/attachments/20645241/11.JPG?version=1&amp;modificationDate=1211841466000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873569" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="11.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   This will open up <em>Properties</em> Window. Click on <em>Java Build Path =&gt; Libraries</em> tab on the right hand side.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/12.JPG" data-image-src="/confluence/download/attachments/20645241/12.JPG?version=1&amp;modificationDate=1211841497000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873560" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="12.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Click on <em>Add External JARs</em> button and browse for <code>geronimo-jpa_3.0_spec-1.1.1.jar</code> file which should be in <code>&lt;geronimo_home&gt;/repository/org/apache/geronimo/specs/geronimo-jpa_3.0_spec/1.1.1</code>. The jar file is only to compile entity and entity client classes you're about to create. Geronimo provides the jar at runtime.<br clear="none">
   Select the file and click on the <em>Open</em> button. </p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/13.JPG" data-image-src="/confluence/download/attachments/20645241/13.JPG?version=1&amp;modificationDate=1211841497000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873561" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="13.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   This will add the library to the build path. Click on <em>OK</em>.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/14.JPG" data-image-src="/confluence/download/attachments/20645241/14.JPG?version=1&amp;modificationDate=1211841497000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873559" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="14.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>2. Create <code>META-INF</code> folder in the project. Right click on the project and click on <em>New &gt; Folder</em></p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/3.JPG" data-image-src="/confluence/download/attachments/20645241/3.JPG?version=1&amp;modificationDate=1211841431000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873557" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="3.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Provide <code>META-INF</code> for the folder name and click on <em>Finish</em>.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/4.JPG" data-image-src="/confluence/download/attachments/20645241/4.JPG?version=1&amp;modificationDate=1211841431000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873555" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="4.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>That's all! the setup required for developing the application client is over.</p>

<h2 id="DeployingandrunningJPAapplicationclient-DevelopingEntitiesandtheClient">Developing Entities and the Client </h2>
<p>    1.Right click on the project and create a <code>Account</code> java class as follows.</p>

<p>    <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/5.JPG" data-image-src="/confluence/download/attachments/20645241/5.JPG?version=1&amp;modificationDate=1211841431000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873574" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="5.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>     Provide name for the class as <code>Account</code> with a package name as <code>sample.jpa.appclient</code>. Click on <em>Finish</em>.</p>

<p>    <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/6.JPG" data-image-src="/confluence/download/attachments/20645241/6.JPG?version=1&amp;modificationDate=1211841466000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873564" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="6.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>    2. Copy the below contents to the <code>Account.java</code>.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Account.java</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package sample.jpa.appclient;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name=&quot;Account1&quot;)
public class Account implements Serializable{

 private static final long serialVersionUID = 1L;

 @Id
 public int accountNo;
 public String name;
 public String address;
 public int branchCode;
 public double balance;

 public Account(){
  this.accountNo = 0;
  this.name = &quot;DUMMY&quot;;
  this.address = &quot;DUMMY&quot;;
  this.branchCode = 0;
 }
	
 public int getAccountNo() {
  return accountNo;
 }
 
 public void setAccountNo(int accountNo) {
  this.accountNo = accountNo;
 }
 
 public String getName() {
  return name;
 }
 
 public void setName(String name) {
  this.name = name;
 }
 
 public String getAddress() {
  return address;
 }
 
 public void setAddress(String address) {
  this.address = address;
 }
 
 public int getBranchCode() {
  return branchCode;
 }

 public void setBranchCode(int branchCode) {
  this.branchCode = branchCode;
 }

 public double getBalance() {
  return balance;
 }

 public void setBalance(double balance) {
  this.balance = balance;
 }

}
]]></script>
</div></div>

<p> 3. Similarly, right click on the project and create another java class by name <code>AccountClient.java</code>. Also, provide the same package name <code>sample.jpa.appclient</code>.</p>

<p> 4.Copy the below contents to the <code>AccountClient.java</code>.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>AccountClient.java</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
package sample.jpa.appclient;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.Query;
import javax.persistence.EntityTransaction;

public class AccountClient {

    private EntityManager em;

    public AccountClient() {

        EntityManagerFactory emf = Persistence.createEntityManagerFactory(&quot;JPA-App-Client&quot;);
        if (emf == null) {
            throw new IllegalStateException(&quot;EntityManagerFactory is unavailable&quot;);
        }

        em = emf.createEntityManager();
        if (em == null) {
            throw new IllegalStateException(&quot;EntityManager is unavailable&quot;);
        }
    }

    public static void main(String[] args) {

        AccountClient client = new AccountClient();

        String opt = args[0];
        if (&quot;create&quot;.equals(opt)) {
            if (args.length != 6) {
                System.err.println(&quot;No values for accountNo, name, address, branchCode and balance. Exiting.&quot;);
                System.exit(0);
            } else {
                int accNo = Integer.parseInt(args[1]);
                String name = args[2];
                String address = args[3];
                int branchCode = Integer.parseInt(args[4]);
                double balance = Double.parseDouble(args[5]);
                client.createAccount(accNo, name, address, branchCode, balance);
            }
        } else if (&quot;list&quot;.equals(opt)) {
            List&lt;Account&gt; accounts = client.listAccounts();
            for (Account account: accounts) {
                System.out.println(&quot;_________________________________&quot;);
                System.out.println(account.getAccountNo());
                System.out.println(account.getName());
                System.out.println(account.getAddress());
                System.out.println(account.getBranchCode());
                System.out.println(account.getBalance());
                System.out.println(&quot;____________________________________________&quot;);
                System.out.println(&quot;&quot;);
            }
        } else if (&quot;update&quot;.equals(opt)) {
            if (args.length != 3) {
                System.out.println(&quot;No values for accountNo and new balace value. Exiting.&quot;);
                System.exit(0);
            } else {
                int accNo = Integer.parseInt(args[1]);
                double newbalance = Double.parseDouble(args[2]);
                client.updateAccountBalance(accNo, newbalance);
            }
        } else if (opt.equals(&quot;delete&quot;)) {
            if (args.length != 2) {
                System.out.println(&quot;No values for accountNo for delete. Exiting.&quot;);
                System.exit(0);
            } else {
                int accNo = Integer.parseInt(args[1]);
                client.deleteAccount(accNo);
            }
        }
        else {
            System.err.println(&quot;Unknown option (&quot; + opt + &quot;) selected&quot;);
        }

    }

    public Account createAccount(int accNo, String name, String address, int branchCode, double balance) {

        Account acc1 = em.find(Account.class, accNo);
        if (acc1 != null) {
            throw new IllegalArgumentException(&quot;Account already exists - account Number (&quot; + accNo + &quot;)&quot;);
        }
        Account acc = new Account();
        acc.setAccountNo(accNo);
        acc.setAddress(address);
        acc.setBalance(balance);
        acc.setBranchCode(branchCode);
        acc.setName(name);
        System.out.println(&quot;Persisting account entity (accNo = &quot; + accNo + &quot;)&quot;);
        EntityTransaction et = em.getTransaction();
        et.begin();
        em.persist(acc);
        et.commit();
        System.out.println(&quot;Persisted successfully account entity (accNo = &quot; + accNo + &quot;)&quot;);
        return acc;

    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public List&lt;Account&gt; listAccounts() {
        Query q = em.createQuery(&quot;SELECT a FROM Account a&quot;);
        List&lt;Account&gt; currList = q.getResultList();
        return currList;
    }

    public Account updateAccountBalance(int accNo, double newBalance) {
        Account acc = em.find(Account.class, accNo);
        if (acc == null) {
            throw new IllegalArgumentException(&quot;Account not found : Account Number (&quot; + accNo + &quot;)&quot;);
        }
        EntityTransaction et = em.getTransaction();
        et.begin();
        acc.setBalance(newBalance);
        et.commit();
        return acc;

    }

    public void deleteAccount(int accNo) {
        EntityTransaction et = em.getTransaction();
        et.begin();
        em.remove(em.getReference(Account.class, accNo));
        et.commit();
    }
}
]]></script>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The <code>AccountClient</code> obtains <code>EntityManagerFactory</code> object first and then creates an <code>EntityManager</code> object from the factory. The <code>EntityManager</code> object thus obtained is Application Managed EntityManager object. The Persistence scope of the EntityManager is by default <code>Extended</code>. Since the application client runs in a different JVM from the server, the transaction type is <code>RESOURCE_LOCAL</code>. Hence the <code>AccountClient</code> must use <code>EntityTransaction</code> to demarcate the transactions.</p></div></div>
<h2 id="DeployingandrunningJPAapplicationclient-PreparingDeploymentDescriptorsandDeploymentPlans">Preparing Deployment Descriptors and Deployment Plans</h2>

<p>1. Create <code>persistence.xml</code> file in the <code>META-INF</code> folder as follows.<br clear="none">
   Right click on the <code>META-INF</code> folder and click on <em>New =&gt; File</em>.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/7.JPG" data-image-src="/confluence/download/attachments/20645241/7.JPG?version=1&amp;modificationDate=1211841466000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873563" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="7.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Provide <code>persistence.xml</code> as the file name and click on <em>Finish</em>.</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/8.JPG" data-image-src="/confluence/download/attachments/20645241/8.JPG?version=1&amp;modificationDate=1211845658000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873556" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="8.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Copy the below contents to the <code>persistence.xml</code>.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot;
  version=&quot;1.0&quot; &gt;
  &lt;persistence-unit name=&quot;JPA-App-Client&quot;&gt;
    &lt;description&gt;JPA Application Client&lt;/description&gt;
    &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
    &lt;class&gt;sample.jpa.appclient.Account&lt;/class&gt;
    &lt;properties&gt;
      &lt;property name=&quot;openjpa.ConnectionURL&quot; value=&quot;jdbc:derby://localhost/AccountDB&quot; /&gt;
      &lt;property name=&quot;openjpa.ConnectionDriverName&quot; value=&quot;org.apache.derby.jdbc.ClientDriver&quot; /&gt;
      &lt;property name=&quot;ConnectionUserName&quot; value=&quot;app&quot; /&gt;
      &lt;property name=&quot;openjpa.jdbc.SynchronizeMappings&quot; value=&quot;false&quot; /&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;
]]></script>
</div></div>

<p>2. Similarly, create <code>application-client.xml</code> file in the <code>META-INF</code> folder as given the previous step and copy the below contents into the file.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>application-client.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;application-client xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; 
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/application-client_5.xsd&quot;
  version=&quot;5&quot;&gt;
&lt;/application-client&gt;
]]></script>
</div></div>

<p>Since we are using JPA annotations to declare the resources, we do not require any entries in the file.</p>

<p>3. Similarly, create <code>geronimo-application-client.xml</code> file under <code>META-INF</code> file and copy the below contents.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>geronimo-application-client.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;application-client xmlns=&quot;http://geronimo.apache.org/xml/ns/j2ee/application-client-2.0&quot; 
  xmlns:sys=&quot;http://geronimo.apache.org/xml/ns/deployment-1.2&quot;
  xmlns:naming=&quot;http://geronimo.apache.org/xml/ns/naming-1.2&quot; 
  xmlns:security=&quot;http://geronimo.apache.org/xml/ns/security-2.0&quot;
  xmlns:connector=&quot;http://geronimo.apache.org/xml/ns/j2ee/connector-1.2&quot;&gt;
  &lt;sys:client-environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;AccountJPA&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;AccountJPA-app-client&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;3.0&lt;/sys:version&gt;
      &lt;sys:type&gt;jar&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
    &lt;sys:dependencies&gt;
      &lt;sys:dependency&gt;
        &lt;sys:groupId&gt;org.apache.geronimo.configs&lt;/sys:groupId&gt;
        &lt;sys:artifactId&gt;transaction&lt;/sys:artifactId&gt;
        &lt;sys:version&gt;2.1&lt;/sys:version&gt;
        &lt;sys:type&gt;car&lt;/sys:type&gt;
      &lt;/sys:dependency&gt;
    &lt;/sys:dependencies&gt;
  &lt;/sys:client-environment&gt;
  &lt;sys:server-environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;AccountJPA&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;AccountJPA-app-client-server&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;3.0&lt;/sys:version&gt;
      &lt;sys:type&gt;jar&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
  &lt;/sys:server-environment&gt;
&lt;/application-client&gt;
]]></script>
</div></div>

<h2 id="DeployingandrunningJPAapplicationclient-Deployingtheapplicationclient">Deploying the application client</h2>

<p>1. Export the Java Project to a jar file Start the geronimo server and open the admin console <code><a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http://localhost:8080/console</a></code>.<br clear="none">
   Click on Embedded <em>DB =&gt; DB Manager</em> on the <em>Console Navigation</em> portlet. This will open up <em>DB Viewer</em> and <em>Run SQL</em> portlets on the right hand side as follows.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/19.JPG" data-image-src="/confluence/download/attachments/20645241/19.JPG?version=1&amp;modificationDate=1211851919000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873568" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="19.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>  Enter <em>AccountDB</em> in the <em>Create DB</em> text box and click on <em>Create</em> button. This will create a new Database <em>AccountDB</em> and will be listed in the <em>DB Viewer</em> portlet. </p>

<p>  In the textarea <em>SQL Command/s:</em> which is on the <em>Run SQL</em> portlet, enter the below SQL command, and select <em>AccountDB</em> in the <em>Use DB</em> combo box, and click on <em>Run SQL</em> button. This creates the <em>Account1</em> table in the <em>AccountDB</em> database.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Account1 table</b></div><div class="codeContent panelContent pdl">
<script class="brush: sql; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
create table ACCOUNT1 (ACCOUNTNO integer, NAME varchar(50), ADDRESS varchar(225), BRANCHCODE integer, BALANCE decimal(15,2));
]]></script>
</div></div>

<p>Insert some sample rows in the table using the below SQL statements by following the same outlined procedure above.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Account1 table</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
insert into Account1 values (1111, &#39;Joe&#39;, &#39;NewYork&#39;, 10, 30000.0);
insert into Account1 values (2222, &#39;John&#39;, &#39;NewJersy&#39;, 11, 31000.0);
insert into Account1 values (3333, &#39;Jane&#39;, &#39;Raleigh&#39;, 13, 32000.0);
]]></script>
</div></div>


<p>2. Export the Java project by name <code>ApplicationClientJPA.jar</code> as follows.<br clear="none">
   Right click on the java project and export it as jar file.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/15.JPG" data-image-src="/confluence/download/attachments/20645241/15.JPG?version=1&amp;modificationDate=1211841497000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873558" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="15.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>   Select <em>Java =&gt; jar</em></p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/16.JPG" data-image-src="/confluence/download/attachments/20645241/16.JPG?version=1&amp;modificationDate=1211841497000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873565" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="16.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>  Click on <em>Next</em> and provide the jar file name and destination folder as below and click on <em>Next</em>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/17.JPG" data-image-src="/confluence/download/attachments/20645241/17.JPG?version=1&amp;modificationDate=1211841530000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873573" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="17.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>  In the next screen click <em>Next</em>. In the <em>Jar Manifest Specification</em> wizard, select <code>sample.jpa.appclient.AccountClient</code> using <em>Browse</em> button. This is the class that has <code>public static void main(String[] args)</code> method which is the application entry point.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="deploying-and-running-jpa-application-client.data/18.JPG" data-image-src="/confluence/download/attachments/20645241/18.JPG?version=1&amp;modificationDate=1211841530000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="20873572" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="18.JPG" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="20645241" data-linked-resource-container-version="5"></span></p>

<p>Click <em>Finish</em>.</p>

<p>3. Deploy the application client as follows.</p>

<p>Change the directory to <code>&lt;geronimo_home&gt;\bin</code>.<br clear="none">
Submit the below command</p>
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>&lt;geronimo_home&gt;/bin&gt;deploy.bat --user system --password manager deploy &lt;location_of_the_ApplicationClientJPA.jar&gt;/ApplicationClientJPA.jar
</pre>
</div></div>

<h2 id="DeployingandrunningJPAapplicationclient-Runningtheapplicationclient">Running the application client</h2>

<p>1. Run the application client as follows.</p>

<p>The application performs the following operations. Use the script <code>client</code> (.bat or .sh) to run the application client.</p>

<ul><li>List : This option lists the accounts curently in the database. The command to list is as follows.
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>&lt;geronimo_home&gt;/bin&gt;client AccountJPA/AccountJPA-app-client/3.0/jar list
</pre>
</div></div></li></ul>


<ul><li>Create : This option creates an account in the database. The command to create is as follows.
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>&lt;geronimo_home&gt;/bin&gt;client.bat/sh AccountJPA/AccountJPA-app-client/3.0/jar create 2222 Joe NewYork BranchX 20000.0
</pre>
</div></div></li></ul>


<ul><li>Update : This option updates an account with a new balance in the database.<br clear="none">
  The command to update is as follows.
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>&lt;geronimo_home&gt;/bin&gt;client.bat/sh AccountJPA/AccountJPA-app-client/3.0/jar update 2222 30000.00
</pre>
</div></div></li></ul>


<ul><li>Delete : This option deletes an account in the database. The command to delete is as follows.
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>&lt;geronimo_home&gt;/bin&gt;client.bat/sh AccountJPA/AccountJPA-app-client/3.0/jar delete 2222.
</pre>
</div></div></li></ul>
</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Deploying and running JPA application client';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
