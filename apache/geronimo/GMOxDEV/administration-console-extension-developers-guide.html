<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Administration Console Extension Developer's Guide" />
    <META name="Keywords" content="Apache Geronimo development documentation Administration Console Extension Developer's Guide" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2009-01-06" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo Development : Administration Console Extension Developer's Guide</title>

  </head>

  <body onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="extensible-administration-console.html">Extensible Administration Console</a>&nbsp;&gt;&nbsp;<a href="administration-console-extension-developers-guide.html">Administration Console Extension Developer's Guide</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo Development</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Administration Console Extension Developer's Guide</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=63621">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=63621">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=63621">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=63621">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=63621">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=63621">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>Previous versions of Geronimo have included a noncustomizable, static administration console. Often times when a user installs Geronimo, the Administration Console will be the first place the go in order to configure their application server. For this reason, it is important that the administration console be a feature that provides users with the necessary functionality to easily manage plugins and components of the server.  This new administration console allows much more dynamic control over administration features. As such, it more closely reflects the highly flexible and pluggable underlying architecture of Geronimo. What we have done here is to provide a framework for plugin developers to include administration console extensions for their plugins. The aim has been to provide an easy and flexible solution with a simple architecture such that users of Geronimo can intuitively configure components, and developers can easily expand upon the foundation laid out here.</p>

<p>The purpose of this document is to provide developers with the necessary instructions to utilize the infrastructure provided by the administration console to add console extensions for their Apache Geronimo plugins. The first portion of this document will describe the plumbing of the system and how it works, and the latter portions will provide a solid example of what to expect in order to actually get your own functioning console extension.</p>


<p>This document is organized in the following sections:</p>


<h1 id="AdministrationConsoleExtensionDeveloper'sGuide-Architecture">Architecture</h1>
<p>Below we have a high level view of the interactions between a new plugin and Pluto. This is essentially the 'plumbing' beneath the administration console.</p>
<rich-text-body>
<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="administration-console-extension-developers-guide.data/HighLevelPluto.jpg"></span><br clear="none">
Figure 1 - High level view of Pluto's interaction with a deployable WAR</p></rich-text-body>

<p>We have a WAR file containing portlet information and the definition of an Administration Console Extension (ACE) GBean on the left. The ACE GBean is the way in which we can invoke operations on Pluto (this will be covered shortly).</p>

<p>The portlet container that we use is Apache Pluto 1.2. Pluto allows for dynamically adding and removing pages and portlets without restarting the portlet container. The approach is important from a user interface standpoint, because we are not forced into performance bottle necks by restarting server components unnecessarily.</p>

<p>The dashed box around Pluto and its Pluto's API is intended to describe the approach taken to decouple Pluto's implementation from our own. This is a design decision to allow Pluto to be replaced by a different portlet engine for possible future development. </p>

<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-UnderstandingThroughUsecases">Understanding Through Usecases</h2>
<p>Let's dig into the architecture a bit more now. It should be noted that the intended purpose of this architecture is to leverage Geronimo's flexible nature, as well as have the actual administration console be reflective of Geronimo's pluggability. The infrastructure should be simple to understand and easy to build on top of.</p>

<p>The first use case we will look at will also be used to describe the individual pieces that make administration console function.</p>
<rich-text-body>
<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="administration-console-extension-developers-guide.data/startcase.jpg"></span><br clear="none">
Figure 2 - Use case for adding features to the console</p></rich-text-body>

<p>On the left, we begin with a simple Geronimo deployment plan (geronimo-web.xml, for instance). This deployment plan is the same deployment plan included in any archive that you may wish to deploy into Geronimo. In this case, the deployment plan includes the definition for a special AdminConsoleExtensionGBean. The specifics of what goes into an AdminConsoleExtensionGBean will be described in more detail later.</p>

<p>On the right, we have Pluto. When Pluto starts, a PortalContainerServicesGBean is started. This is how we access Pluto. When we deploy our archive, an AdminConsoleExtensionGBean containing portlet configuration information is started (based on the configuration specified in the deployment descriptor). The AdminConsoleExtensionGBean is where the developer specifies the information for the portlets and pages they are adding to the administration console.</p>

<p>The AdminConsoleExtensionGBean implements GBeanLifecycle. When the AdminConsoleExtensionGBean is started, it asks the kernel for the PortalContainerServicesGBean (1). The AdminConsoleExtensionGBean gets the service (2) - now the AdminConsoleExtensionGBean can access Pluto through its API. We want to add a portlet to our administration console, so we invoke Pluto's addPortlet method, which will update Pluto's internal model.</p>

<p>In the above image, each of the grayed out GBeans is an AdminConsoleExtensionGBean instantiated by a deployment descriptor. Each AdminConsoleExtensionGBean modifies or adds exactly one page in the administration console. This essentially means that portlets may be added to an existing page by specifying the name of an existing page, or a separate page can be created if one with the specified name does not exist.</p>

<p>A deployment plan may also include definitions for multiple AdminConsoleExtensionGBeans. This means that a deployment plan, if it chooses to do so, may add as many pages to the console as it wants to.</p>
<rich-text-body>
<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="administration-console-extension-developers-guide.data/stopcase.jpg"></span><br clear="none">
Figure 3 - Use case for removing features from the console</p></rich-text-body>

<p>Removing pages (Figure 3) from the console follows a similar process. Because the AdminConsoleExtensionGBean implements the GBeanLifecycle, when the installed component is stopped, its AdminConsoleExtensionGBean will also be stopped. When this happens, we once more ask the kernel for the PortalContainerServiceGBean, which is used to call removePortlet on Pluto through its API. From the view of the administration console, the user will see the page has disappeared from the navigation menu (Figure 4). If the user starts the component again, the GBeanLifecycle's doStart calls addPortlet on Pluto Container, and the administration console extension reappears on the navigation menu (Figure 5).</p>

<rich-text-body>
<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="administration-console-extension-developers-guide.data/noext.jpg"></span><br clear="none">
Figure 4 - We see no administration extensions to the left for the stopped component</p>


<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="administration-console-extension-developers-guide.data/withext.jpg"></span><br clear="none">
Figure 5 - We see the administration feature for the HelloWorldPortlet appear in the navigation</p></rich-text-body>

<h1 id="AdministrationConsoleExtensionDeveloper'sGuide-Class/DependencyStructure">Class/Dependency Structure</h1>
<rich-text-body>
<p>Dependency relationship of the pieces</p>
<ul><li>PortalContainer
	<ul><li>PortalContainerServiceGBean
		<ul><li>AdminConsoleExtensionGBean</li></ul>
		</li><li>Pluto Portal
		<ul><li>Administration Console
			<ul><li>New Portlet</li></ul>
			</li></ul>
		</li></ul>
	</li></ul>
</rich-text-body>

<p>The PortalContainer is the base requirement for the administration console. The Pluto Portal and the PortalContainerServiceGBean are the base requirements to install anything into the framework of the console. The administration console and the AdminConsoleExtensionGBean depends on the PortalContainerServiceGBean and the Pluto Portal. In order to add new console extensions, all of the described components must be in place.</p>

<p>The key here is that the requirements for adding a console extention is an AdminConsoleExtensionGBean and the New Portlet files. This means that the required dependencies that need to be specified in the deployment descriptor are the Administration Console and the PortalContainerServicesGBean. </p>


<h1 id="AdministrationConsoleExtensionDeveloper'sGuide-HowtoDevelopanAdministratorConsoleExtension(ACE)">How to Develop an Administrator Console Extension (ACE)</h1>
<p>TODO: An intro should go here</p>

<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-Differentwaysofstructuring">Different ways of structuring</h2>
<p>The whole concept behind creating an ACE for Geronimo is that you are adding an extension in the form of portlets to the administrator console.  You can package this however you like.  Some options are as follows:</p>
<ol><li>Your portlets</li><li>Your portlets + your related component</li><li>Your portlets which declares a dependency on your related component</li></ol>


<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-Createaportlet">Create a portlet</h2>
<p>In their most fundamental state, an ACE defines where to place new/old portlets in your console.  Portlets are the fundamental building block of the administrator console.  We are using Pluto 2.x as our portal engine since it closely conforms to JSR 168 [<a shape="rect" class="unresolved" href="#">link to JSR 168</a>].  We will not go into the details of how to develop portlets since you can find many tutorials and tools that are much better at this.  [<a shape="rect" class="unresolved" href="#">many tutorial links here</a>].  You will need the appropriate "web.xml" and "portlet.xml" files defined. As a simple example, refer to the [<a shape="rect" class="unresolved" href="#">link to section</a>] HelloWorldPortlet defined at the end of this section.</p>

<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-AddanAdminConsoleExtensionGBean">Add an AdminConsoleExtensionGBean</h2>
<p>To add an AdminConsoleExtensionGBean to your deployable archive file, you need to include the following to your "geronimo-web.xml" deployment plan:  </p>
<ol><li>Declare a dependency on the "pluto-portal"
<parameter ac:name="">XML</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
&lt;dependencies&gt;
    ...
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.geronimo.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;pluto-support&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;/dependencies&gt;
</plain-text-body></li><li>Define an AdminConsoleExtensionGBean
<parameter ac:name="">XML</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
&lt;gbean name="example" class="org.apache.geronimo.pluto.AdminConsoleExtensionGBean"&gt;
    &lt;attribute name="pageTitle"&gt;Testing&lt;/attribute&gt;
    &lt;attribute name="portletContext"&gt;/HelloWorldPortlet&lt;/attribute&gt;
    &lt;attribute name="portletList"&gt;[HelloWorldPortlet]&lt;/attribute&gt;
&lt;/gbean&gt;
</plain-text-body>
where the attributes are defined as follows:</li></ol>
<ul><li>pageTitle: The name of the page to add these portlets to (new or existing)</li><li>portletContext: The context of where the portlets are installed.</li><li>portletList: A comma-delimited list of the portlets to be added to this page.</li></ul>


<parameter ac:name="">XML</parameter><parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">Sample geronimo-web.xml</parameter><plain-text-body>
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-1.2"&gt;
    &lt;environment&gt;
        &lt;moduleId&gt;
            &lt;groupId&gt;org.apache.geronimo.portals&lt;/groupId&gt;
            &lt;artifactId&gt;pluto-example&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
            &lt;type&gt;war&lt;/type&gt;
        &lt;/moduleId&gt;
        
        &lt;dependencies&gt;
            &lt;dependency&gt; &lt;!-- Put a dependancy on the hosting portal (pluto) --&gt;
                &lt;groupId&gt;org.apache.geronimo.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;pluto-support&lt;/artifactId&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/environment&gt;
    
    &lt;!-- This is where the files are accessed from. (aka - portletContext) --&gt;
    &lt;context-root&gt;/HelloWorldPortlet&lt;/context-root&gt;
    
    &lt;!-- Start off a ACEGBean, this is the lifecycle for the portlet --&gt;
    &lt;gbean name="PlutoTest" class="org.apache.geronimo.pluto.AdminConsoleExtensionGBean"&gt;
        &lt;attribute name="pageTitle"&gt;Hello&lt;/attribute&gt;
        &lt;attribute name="portletContext"&gt;/HelloWorldPortlet&lt;/attribute&gt;
        &lt;attribute name="portletList"&gt;[HelloWorldPortlet]&lt;/attribute&gt;
        &lt;reference name="PortalContainerServices"&gt;
            &lt;name&gt;PlutoPortalServices&lt;/name&gt;
        &lt;/reference&gt;
    &lt;/gbean&gt;
&lt;/web-app&gt;
</plain-text-body>

<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-Puttingittogether">Putting it together</h2>
<p>Add your modified "geronimo-web.xml" deployment plan to your WAR or CAR in the WEB-INF folder.  Also, if you are including portlets, your archive file should contain the appropriate class files as well as the "web.xml" and "portlet.xml" files.</p>
<parameter ac:name="title">What is an example structure for a simple war?</parameter><rich-text-body>
<ul><li>HelloWorldPortlet.war
	<ul><li>WEB-INF/
		<ul><li>classes/
			<ul><li>(portlet class files)</li></ul>
			</li><li>geronimo-web.xml</li><li>portlet.xml</li><li>web.xml</li></ul>
		</li></ul>
	</li></ul>
</rich-text-body>

<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-Deployingtheapplication">Deploying the application</h2>
<p>Deploy the archive as you normally would either using the "deploy" command or by using the Administrator Console's "Deploy New" or "Plugins".</p>
<ol><li><em>Command Line</em>: <code><strong>&lt;geronimo bin folder&gt;/deploy.bat deploy &lt;path to war&gt;</strong></code><br clear="none">
Example:<br clear="none">
<code><strong>cd c:/g/target/geronimo-tomcat6-minimal-2.0-SNAPSHOT/bin/</strong></code><br clear="none">
<code><strong>deploy.bat deploy c:/HelloWorldPortlet.war</strong></code></li><li><em>Using the Admin Console</em>:
<rich-text-body>
<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="administration-console-extension-developers-guide.data/InstApp.jpg"></span></p></rich-text-body></li></ol>



<h2 id="AdministrationConsoleExtensionDeveloper'sGuide-Verifyinginstallation">Verifying installation</h2>
<p>Go to <a shape="rect" class="external-link" href="http://localhost:8080/console/" rel="nofollow">http://localhost:8080/console/</a> to verify that the portlets were added to the correct page.  (You may need to refresh the browser if you deployed from the command line.)</p>

<h1 id="AdministrationConsoleExtensionDeveloper'sGuide-SampleExtension">Sample Extension</h1>
<p>This is a working simple example of an Administration Console Extension.<br clear="none">
<a shape="rect" href="administration-console-extension-developers-guide.data/example_extension.war?version=1&amp;modificationDate=1204602381000&amp;api=v2" data-linked-resource-id="59671571" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="example_extension.war" data-nice-type="Java Archive" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="63621" data-linked-resource-container-version="47">Download the example WAR</a></p>
<parameter ac:name="">JAVA</parameter><parameter ac:name="borderStyle">solid</parameter><parameter ac:name="title">HelloWorldPortlet.java</parameter><plain-text-body>
package org.apache.pluto.examples;

import java.io.IOException; 
import java.io.PrintWriter;

import javax.portlet.GenericPortlet;
import javax.portlet.PortletException;
import javax.portlet.RenderRequest;
import javax.portlet.RenderResponse;

/**
 * A very simple portlet example.
 * This portlet displays 'Hello World' to the end user
 */
public class HelloWorldPortlet extends GenericPortlet {

    // This function is called when a user requests to view this portlet (by
    // navigating to the webpage in Pluto)
    public void doView(RenderRequest request, RenderResponse response)
            throws PortletException, IOException {

        // Set the response to read HTML
        response.setContentType("text/html;charset=UTF-8");

        // Required call for use of getWriter() and getPortletOutputStream()
        PrintWriter out = response.getWriter();
        // Write content to the portlet
        out.println("&lt;h1&gt;Hello World&lt;/h1&gt;");
    }
}
</plain-text-body></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : Administration Console Extension Developer's Guide';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2011, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  </body>
</html>
