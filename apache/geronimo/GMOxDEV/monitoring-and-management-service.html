<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Monitoring and Management Service" />
    <META name="Keywords" content="Apache Geronimo development documentation Monitoring and Management Service" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2009-01-06" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo Development : Monitoring and Management Service</title>

  </head>

  <body onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="monitoring-and-management-service.html">Monitoring and Management Service</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo Development</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Monitoring and Management Service</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=64587">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=64587">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=64587">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=64587">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=64587">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=64587">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><h1 id="MonitoringandManagementService-Overview">Overview</h1>

<p>Currently, there is not a good way of surfacing Geronimo's server information so that an administrator can monitor the server's status. The architecture of using MBeans is established, but not fully exploited. This enhancement will take advantage of what Geronimo currently offers and extend it so that a server can tap into a cluster of servers and extract information from specific Geronimo servers or even aggregates of Geronimo servers.</p>

<h2 id="MonitoringandManagementService-Goal">Goal</h2>

<p>The goal is to have at least one machine be able to reach out to all Geronimo servers in order to fetch data or even alter their state. This will be especially useful in the case of someone having to monitor a large number of Geronimo servers.</p>

<h1 id="MonitoringandManagementService-Howitworks">How it works</h1>

<p>As part of the design, there are five major components.</p>

<p><strong>Management Node(s)</strong>: An instance of Geronimo that has sole purpose of managing and viewing information from Server Nodes, must include admin console.<br clear="none">
<strong>Management Plugin</strong>: Will reside on all Management Nodes and will handle the connection to the Remote Control Plugin to pull relevant information and control the machine.<br clear="none">
<strong>Connection Information DB</strong>: Resides on either a Management Node or a different database server, has Server Name, IP:Port information and remote authentication information for all Server Nodes. Management Nodes use this information to connect to the Server Nodes<br clear="none">
<strong>Server Node(s)</strong>: An instance of Geronimo that runs as usual, can be Little G with our MBean and anywhere up from there.<br clear="none">
<strong>Remote Control Plugin</strong>: Will be present on all Server Nodes, handle JSR-77 statistics collection, control the thread which takes snapshots of the server's current state.</p>

<p>The proposed solution would incorporate a scalable design, using the same methods to keep track of statistics and read them locally that it would be pulling them remotely from N machines. This is accomplished by creating a thin layer (Remote Control Plugin) that will work to be a tie-in point for all the statistics, taking a 'snapshot' of the current state of things every X minutes and recording in a database for a predetermined amount of time before there is rollover. With this thin layer serving as a relay point for this data, we can simply connect to it via remote OpenEJB authentication through the Management Plugin, or a different remote machine (i.e. a proposed 'management node') to pull the information, as well as gain control over functions such as simple start/stop/restart, or in the future could be expanded to deploying/uninstalling/redeploying across an entire cluster.</p>

<p>There will not be an active connection from the management node to the server nodes at all times, and will instead be an on-demand connection that will be used only when control or information is requested, resulting in little network overhead.<span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="monitoring-and-management-service.data/overview.jpg" data-image-src="/confluence/download/attachments/64587/overview.jpg?version=1&amp;modificationDate=1189690140000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59670704" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="overview.jpg" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64587" data-linked-resource-container-version="45"></span></p>

<h2 id="MonitoringandManagementService-ManagementPluginArchitecture">Management Plugin Architecture</h2>

<p>The management plugin resides on the <strong>management node</strong>, and serves as the user interface for requesting, processing, and then displaying statistical information from the <strong>server node(s)</strong>, as well as providing an interface for a significant degree of control over them, including</p>
<ul><li>Server group management
	<ul><li>Deploy/undeploy across multiple, set attributes across multiple, start/stop/restart multiple</li></ul>
	</li><li>Historical statistics view for 1-n servers</li><li>Ability to custom-define statistics collection per-machine, per-group, across entire cluster</li><li>Manipulate snapshot interval, retention period</li><li>Enable/disable archiving, define archiving time/retention</li></ul>



<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>There are two methods to collect statistics</p>
<ol><li>using MEJB (requires OpenEJB)</li><li>using pure JMX (does not require OpenEJB)</li></ol>
</div></div>

<h2 id="MonitoringandManagementService-CollectingStatisticsUsingMEJB(Method1)">Collecting Statistics Using MEJB (Method 1)</h2>

<p>The RCP, or collecting agent, will reside on the <strong>Server Node</strong> and will be in charge of preparing information for the <strong>Management Node.</strong> Since there are many statistics for different MBeans that the admin could track, we will use the MEJB component that is already implemented in Geronimo to contact these MBeans. <span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="monitoring-and-management-service.data/RCP.jpg" data-image-src="/confluence/download/attachments/64587/RCP.jpg?version=2&amp;modificationDate=1193988104000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="59670705" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="RCP.jpg" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="64587" data-linked-resource-container-version="45"></span><br clear="none">
The Master Controller is the collecting agent that will do the managerial tasks such as query the mbeans for their statistics and what not. Additionally, the Master Controller will set timers via the EJB TimerService in order to periodically capture "snapshots." This term will refer to the server's statistics for a given time. With the timers set, we can save the history of the server's statistics. Upon request, the Master Controller will gather all of the information (either by calling MEJB or looking into the server's history stored in a database) and respond by shipping the data back to the <strong>Management Node.</strong><br clear="none">
Note: All stats will be JSR-77 compliant.</p>

<h3 id="MonitoringandManagementService-Takingsnapshots">Taking snapshots</h3>

<p>As of now, the collecting agent will create EJB Timers, if it does not already exist, to capture the server's essential information. On each callback the snapshot information on the server itself will be stored to the local database residing on the <strong>Server Node</strong>. In order to preserve the history, there will be a monthly (default, but can be configured) archive of the server's information stored locally.</p>

<h2 id="MonitoringandManagementService-CollectingStatisticsUsingPureJMX(Method2)">Collecting Statistics Using Pure JMX (Method 2)</h2>

<p>There is a second flavor of a collecting agent. The second option is to use pure JMX, bypassing the retrieval of the MEJB mbean in the server. All of the functionality is the same, because EJB timers are replaced with threads. Therefore, stopping a snapshot querying may take longer because of the use of threads as opposed to EJB Timers.</p>

<h2 id="MonitoringandManagementService-MEJBMethodDependencies">MEJB Method Dependencies</h2>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
 agent-ejb                   // MEJB controller library
 agent-ds                    // datasource plugin
 agent-ear                   // packaging of agent-ejb and agent-jar
 agent-jar                   // common utility classes used to talk to the DB
 agent-sql                   // common sql commands to execute during deployment (used by agent-ds)
]]></script>
</div></div>

<h2 id="MonitoringandManagementService-PureJMXMethodDepenedencies">Pure JMX Method Depenedencies</h2>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
 agent-car-jmx               // JMX controller library
 agent-ds                    // datasource plugin
 agent-ear                   // packaging of agent-ejb and agent-jar
 agent-jar                   // common utility classes used to talk to the DB
 agent-sql                   // common sql commands to execute during deployment (used by agent-ds)
]]></script>
</div></div>

<h2 id="MonitoringandManagementService-UsingotherDatabasestostoresnapshotinformationontheServerNode">Using other Databases to store snapshot information on the Server Node</h2>

<p>The current architecture of the collecting agent really comes in a pair of plugins (one for the providing the thin layer, and the other for providing that thin layer with a couple datasources). By modularizing these different entities, if the admin would swap out the Datasource with his/her own, the admin could save the snapshot information into any database that is supported by Geronimo. Other examples of notable plugins that use this technique of having a Datasource as a plugin are Jetspeed and Roller. </p>

<h2 id="MonitoringandManagementService-DatabaseSchema(subjecttochangesoon)">Database Schema (subject to change soon)</h2>

<p>MBeans<br clear="none">
  -&gt; id (PK)<br clear="none">
  -&gt; mbeanName<br clear="none">
  -&gt; statsNameList<br clear="none">
Statistics<br clear="none">
  -&gt; id (PK)<br clear="none">
  -&gt; mbeanId (FK references MBeans.id)<br clear="none">
  -&gt; snapshot_time<br clear="none">
  -&gt; statsValueList</p>

<p>The values of MBeans.statsNameList and Statistics.statsValueList are CSV strings to represent an MBean's statistics name and value respectively. This is not the final design and will be changed.</p>

<h3 id="MonitoringandManagementService-CurrentlyImplemented">Currently Implemented</h3>

<ol><li>Archive snapshots every month</li><li>Return arbitrary number of snapshots' information</li><li>Ability to start/stop snapshot thread</li><li>Ability to specify the duration of time in between snapshots</li><li>Ability to fetch JSR-77 stats</li><li>Ability to modify mbean attributes</li><li>Ability to add additional mbeans to keep track of in the snapshot process</li><li>Ability to remove mbeans from the list that the snapshot process refers to to get take its snapshots</li><li>JSR-77 stats for Tomcat Connectors and Jetty Containers are surfaced</li><li>Turn statistics option on for all StatisticsProvider components.</li><li>Package collecting agent as a plugin (CAR) with a dependency on the MEJB module.</li><li>Provide support for Jetty Connector stats (in Geronimo's code-base)</li></ol>


<h3 id="MonitoringandManagementService-CurrentGoals">Current Goals</h3>

<ol><li>Restore statistics option (on or off) when the collecting agent is undeployed.</li><li>Provide ability to control the stopping/starting of components within server using StateManageable Objects (SMO).</li></ol>


<h3 id="MonitoringandManagementService-CurrentConcerns">Current Concerns</h3>

<ol><li>The connection between client and server requires for the server to have OpenEJB installed. This will tremendously limit the plugin to work only with Application Servers with OpenEJB. Perhaps JMX remoting is another option or alternative.</li></ol></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : Monitoring and Management Service';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2011, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  </body>
</html>
