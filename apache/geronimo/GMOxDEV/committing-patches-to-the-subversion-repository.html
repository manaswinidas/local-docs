<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Committing patches to the Subversion Repository" />
    <META name="Keywords" content="Apache Geronimo development documentation Committing patches to the Subversion Repository" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2009-01-06" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo Development : Committing patches to the Subversion Repository</title>

  </head>

  <body onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="committing-patches-to-the-subversion-repository.html">Committing patches to the Subversion Repository</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo Development</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Committing patches to the Subversion Repository</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=7771">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=7771">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=7771">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=7771">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=7771">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=7771">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><div class="confluence-information-macro confluence-information-macro-warning"><p class="title">Important</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Currently under construction! Don't use these instructions yet as these are currently based upon Derby's instructions from <a shape="rect" class="external-link" href="http://mail-archives.apache.org/mod_mbox/db-derby-dev/200603.mbox/%3c20060302115045.GA2590@atum01.norway.sun.com%3e">http://mail-archives.apache.org/mod_mbox/db-derby-dev/200603.mbox/%3c20060302115045.GA2590@atum01.norway.sun.com%3e</a> which may not be entirely suitable and requires discussion.</p></div></div>
<p>Committing contributions from others is not as straightforward as one might think. This mainly stems from the fact that there is an svn diff command, but there is no svn patch command (lack of symmetry - see this and this Subversion issue). There are a number of things to remember; if not done carefully, you might end up doing partial commits that may break the build. This page attempts to give a recipe for safely committing code contributions.</p>

<h2 id="CommittingpatchestotheSubversionRepository-1.Makesureyouhaveacleansandbox">1. Make sure you have a clean sandbox</h2>

<p> In the trunk directory, run svn status - it should not list anything. If it does, you may want to run svn revert -R . to remove all local modifications, or use/check out a different sandbox.</p>

<p>Do we need to run maven clean ?</p>

<h2 id="CommittingpatchestotheSubversionRepository-2.Checkyoursandbox'svnrevisionwithsvninfo">2. Check your sandbox' svn revision with svn info</h2>

<p>example goes here..&#160;</p>

<h2 id="CommittingpatchestotheSubversionRepository-3.Alignyousandbox'svnrevisionwiththepatch's">3. Align you sandbox' svn revision with the patch's</h2>

<p> 1. If the contributor has indicated on which revision the patch was created (with svn diff), run svn update -r REVISION.</p>

<p> 2. Otherwise, you may choose to run svn update -r { DATE }, using the date of the contribution of the patch. NOTE: svn is very picky about date formats. See <a shape="rect" class="external-link" href="http://svnbook.red-bean.com/en/1.0/ch03s03.html" rel="nofollow">http://svnbook.red-bean.com/en/1.0/ch03s03.html</a> and scan down for valid date formats.<br clear="none">
 3. If you think there has been no changes in the patch's area since it was contributed, you can try on the head: svn update.</p>

<h2 id="CommittingpatchestotheSubversionRepository-4.Applythepatchinthetrunkdirectory">4. Apply the patch in the trunk directory</h2>

<p>patch -p0 &lt; PATCH_FILE.</p>

<h2 id="CommittingpatchestotheSubversionRepository-5.Ensuretherewerenoconflictswhenapplyingthepatch">5. Ensure there were no conflicts when applying the patch</h2>

<p> On unix, you can run find . -name "*.rej" -print. If a *.rej file is found, you should either resolve the conflict or ask the submitter to submit a new patch against the newest revision. If you omit this step, you'll still catch this problem before committing (when you compare your svn status output to the contributor's), but it's a good idea to catch this early on.</p>

<h2 id="CommittingpatchestotheSubversionRepository-6.Runsvnstatus">6. Run svn status</h2>

<p>&#160;example..</p>

<h2 id="CommittingpatchestotheSubversionRepository-7.AddNewlyAddedFiles">7. Add Newly Added Files</h2>

<p>Newly added files will show up with ?, indicating that Subversion does not know anything about them. You will have to add these yourself using svn add.</p>

<h2 id="CommittingpatchestotheSubversionRepository-8.Ensuresvnpropertiesaresetfornewlyaddedfiles">8. Ensure svn properties are set for newly added files&#160;</h2>

<p>You will have to set svn properties for added files. In particular for all text files. Run svn propset svn:eol-style native FILE(S). If you have your subversion configuration setting this should be done automatically. Add this list to your ~/.subversion/config file, as described in ( TBD need to move from old wiki ).</p>

<h2 id="CommittingpatchestotheSubversionRepository-9.Compareyoursandboxtocontributor's">9. Compare your sandbox to contributor's&#160;</h2>

<p>Now compare your sandbox to the contributor's.</p>

<h3 id="CommittingpatchestotheSubversionRepository-Comparecontributorsstatusfilewithyours">Compare contributors status file with yours&#160;</h3>

<p>run svn status | diff - CONTRIBUTOR'S_SVN_STATUS_FILE. This should be clean, except that the ordering may be different. You can overcome this by sorting both your own svn status output and the contributor's file with sort before comparing: svn status | sort &gt; MY_SVN_STATUS_FILE; cat CONTRIBUTOR'S_SVN_STATUS_FILE | sort | diff - MY_SVN_STATUS_FILE.<br clear="none">
 1. If the svn status output was made on Windows vs. Unix, you may need to adjust formatting such as spacing and forward versus backward slashes.</p>

<p> 2. If the diff contains new, empty files, patch will not create them for you; you will have to create them yourself using touch FILENAME.<br clear="none">
1. After creating such new, empty files, you will have to add them, too, with svn add.</p>
<h3 id="CommittingpatchestotheSubversionRepository-Compareyourdifferencestothepatchfile">Compare your differences to the patch file</h3>

<p>By now your svn status should be equal to the contributor's. Now compare the diff by running svn diff | diff - PATCH_FILE.</p>

<p>The diffs you see could be the following:<br clear="none">
 1. Revision numbers, if your sandbox was not aligned with the contributor's (see above)</p>

<p> 2. Subversion file properties: You will have to set svn properties for added files (see above). Do not automatically take for granted the properties in the contributor's patch file, he/she may have got it wrong; use your own judgement.</p>

<p> 3. Actual code diffs: Inspect and figure out what/why.<br clear="none">
 1. Files may be examined in different order by svn diff on your machine and the contributor's; not sure if there's anything we can do about that.</p>

<h2 id="CommittingpatchestotheSubversionRepository-10Updatetotheheadwithsvnupdate">10 Update to the head with svn update</h2>

<p>Check that there are no conflicts.</p>

<h2 id="CommittingpatchestotheSubversionRepository-11.Buildthecode,runningtests">11. Build the code, running tests</h2>

<p>more detailed instructions here..&#160;</p>

<p>Run tests if you are not confident that the contributor's/reviewer's actions are sufficient.<br clear="none">
 1. Check that tests pass. If they do not:<br clear="none">
 1. Check if the same failure is in the continum build reports (if so the problem wasn't introduced by the patch).</p>

<p> 2. Verify that the failure is not caused by the patch.</p>

<h2 id="CommittingpatchestotheSubversionRepository-12.Committhepatch">12. Commit the patch&#160;</h2>

<p>Commit the patch with svn commit. Use either --message, --file or --editor-cmd<br clear="none">
 1. Include the following in the commit message:</p>

<p> 1. The ID of the JIRA issue. Make sure you use the format GERONIMO-NNN so that JIRA picks it up.</p>

<p> 2. Some text explaining what the patch does (typically snipped from the JIRA issue).</p>

<p> 3. The contributor's name/email.</p>

<h2 id="CommittingpatchestotheSubversionRepository-13Sendoutemail">13 Send out email</h2>

<p>Send out an email to let people know you have committed the patch.</p></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : Committing patches to the Subversion Repository';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2011, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  </body>
</html>
