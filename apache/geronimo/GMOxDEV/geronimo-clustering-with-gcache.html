<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Geronimo Clustering with Gcache" />
    <META name="Keywords" content="Apache Geronimo development documentation Geronimo Clustering with Gcache" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2009-01-06" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo Development : Geronimo Clustering with Gcache</title>

  </head>

  <body onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="clustering.html">Clustering</a>&nbsp;&gt;&nbsp;<a href="geronimo-clustering-with-gcache.html">Geronimo Clustering with Gcache</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo Development</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Geronimo Clustering with Gcache</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=31368">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=31368">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=31368">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=31368">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=31368">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=31368">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<h1 id="GeronimoClusteringwithGcache-GeronimoClusteringwithGcache">Geronimo Clustering with Gcache</h1>


<h2 id="GeronimoClusteringwithGcache-Overview">Overview</h2>

<p>Gcache provides a generic caching framework suitable for many different uses. This article explores using Gcache as part of an overall clustering solution for Geronimo.</p>

<h2 id="GeronimoClusteringwithGcache-Background-ClusteringConcepts">Background - Clustering Concepts</h2>

<p>Here is a quick description of basic clustering concepts:</p>
<ul><li>Load Balancer - software/hardware that distributes client requests among the available cluster members</li><li>Session - server side state data associated with a particular client that can span multiple requests</li><li>State Replication - a mechanism for retaining session state across a cluster</li><li>Failover - mechanism that allows one cluster member to recover the session state of a failed cluster member and continue on with no interruption to the end user</li><li>Session Affinity (a.k.a. Sticky Session) - a mechanism that allows multiple requests for the same session to be routed to the same cluster member.</li><li>Cluster member discovery - method for automatically adding a cluster member to a cluster</li><li>Heartbeat - mechanism that allows clients/servers to keep track of availability of each other</li><li>Farming - Hot Deployment of an application across a cluster</li></ul>


<h2 id="GeronimoClusteringwithGcache-GcacheScope">Gcache Scope </h2>
<p>Gcache is a general purpose caching technology that can be used in a variety of environments.  Though from the perspective of Geronimo clustering, Gcache will provide State Replication, Cluster Member discovery and Heartbeat.  Note that other technologies can be used in conjuction with Gcache to support many of the other clustering concepts on the above list.  The "Geronimo Clustering Setup" section below will provide more details on setting up the overall clustering environment.</p>

<p>The Gcache development is staged with the following priorities:<br clear="none">
1) Clustering EJB artifacts (i.e. Stateful Session Beans and Entity Beans)<br clear="none">
2) Web Tier clustering of httpsessions</p>

<p>The initial Gcache implementation for Geronimo provides a replicated cache that provides redundancy for state data.</p>

<h2 id="GeronimoClusteringwithGcache-ClusterMemberdiscoveryandheartbeat">Cluster Member discovery and heartbeat</h2>

<p>The following diagram illustrates the cluster member discovery process as well as the heartbeat mechanism.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="geronimo-clustering-with-gcache.data/discovery1.jpg"></span></p>

<h4 id="GeronimoClusteringwithGcache-Discovery/HeartbeatDescription">Discovery/Heartbeat Description </h4>

<p>In this example, the Gcache server consists of a single master and a single slave process. Note that the topology<br clear="none">
for the Gcache sever is quite flexible and allows for the Gcache server to either exist in the same physical machine and JVM<br clear="none">
as the client or it can be a separate process on a different machine. For this example, we will assume the<br clear="none">
Gcache server is a separate java process on a different machine.</p>

<p>Each Gcache server broadcasts its availability on a a pre-configured multicast address. </p>

<p>Optionally the Gcache server can also send a pre-configured ordinal value that denotes the relative priority of the Gcache server in the cluster.</p>

<p>Each client (in this case, a Geronimo server) listens for these broadcasts and keeps track of the available Gcache servers<br clear="none">
as well as determining the current Master (the lowest ordinal value).  Note that it is also possible to preconfigure the Gcache server ordinals in each client (Geronimo server). </p>

<p>When a client (Geronimo server) first arrives on the network, it makes a determination as to who the Gcache master is and authenticates itself with the Gcache server. </p>

<h2 id="GeronimoClusteringwithGcache-StateDatareplication">State Data replication</h2>

<p>Whenever a cluster member needs to save state data (a.k.a session data), it communicates with the GCcache master<br clear="none">
to save away it's state. This communication is provided in the geronimo server by the pluggable GCache Client API<br clear="none">
that is leveraged whenever state data needs to be saved. &lt;Add more details on pluggable Session Manager here&gt;.</p>

<p>The diagram below shows the basic data flow associated with saving state data in the replicated Gcache server.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="geronimo-clustering-with-gcache.data/replication1.jpg"></span></p>

<h4 id="GeronimoClusteringwithGcache-StateDatareplicationdescription">State Data replication description</h4>

<p>When the geronimo server decides that it needs to save session state, it will invoke the GCache client API<br clear="none">
which will send the state data to the Gcache master. For added redundancy, the Gcache master will then replicate<br clear="none">
this state to the Gcache slaves. Note that it is possible to optionally configure the Gcache server to send acknowledgements for<br clear="none">
all data transmissions.</p>

<p>Also, the Gcache master can optionally send the replicated data to the other Geronimo servers in the cluster.<br clear="none">
For clusters that do not have session affinity, this allows the state data to be immediately available in any<br clear="none">
geronimo server that may get the next request for this data. However, this also has the disadvantage of<br clear="none">
sending more data onto the network as well as increasing the memory usage for each cluster member since each cluster<br clear="none">
member will contain all of the sessons in the cluster.</p>

<p>For clusters that can guarantee session affinity, it is possible to turn off the transmission of state data to the other<br clear="none">
Geronimo servers and simply keep the state data only in the Gcache. This solution will cut down on traffic and<br clear="none">
will likely scale better. If a cluster member were to fail, then sessions associated with that cluster member<br clear="none">
would be failed over to a different cluster member. The new cluster member would be able to retrieve the necessary<br clear="none">
session data from the Gcache.</p>

<h2 id="GeronimoClusteringwithGcache-GeronimoClusteringSetup">Geronimo Clustering Setup</h2>
<p>Add the detailed setup instructions here </p>

<ul><li>Install Gcache plugin</li><li>Configure Gcache settings</li><li>Adding a cluster member to the cluster</li><li>Installing applications</li><li>SLSB (Getting Initial Context, setting up load balancing/failover, etc.)</li><li>Web Tier (Configuring mod-jk, setting up load balancing/failover, configuring sticky session, etc.)</li></ul>


<h2 id="GeronimoClusteringwithGcache-TestingReplicationandfailover">Testing Replication and failover</h2>
<p>Add the specific steps here..</p>


<h2 id="GeronimoClusteringwithGcache-GcacheImplementationdetails">Gcache Implementation details</h2>
<p>Add the details here..</p>
<ul><li>Byte data only over wire (not objects)</li><li>Session Manager plugin</li><li>Underlying technologies</li><li>ehCache</li><li>authentication</li><li>MINA</li></ul>


<h2 id="GeronimoClusteringwithGcache-AuthorIssues/Questions/Concerns">Author Issues/Questions/Concerns</h2>
<ul><li>Add nodeid to session cookie so that modjk can provide sticky session??</li></ul>

</div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : Geronimo Clustering with Gcache';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2011, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  </body>
</html>
