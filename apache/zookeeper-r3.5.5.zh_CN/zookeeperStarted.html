<html dir="ltr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
    <title>ZooKeeper：因为协调分布式系统是动物园</title>
    <link type="text/css" href="skin/basic.css" rel="stylesheet"></link>
    <link type="text/css" href="skin/screen.css" rel="stylesheet" media="screen"></link>
    <link type="text/css" href="skin/print.css" rel="stylesheet" media="print"></link>
    <link type="text/css" href="skin/profile.css" rel="stylesheet"></link>
    <script src="skin/getBlank.js" type="text/javascript" language="javascript"></script>
    <script src="skin/getMenu.js" type="text/javascript" language="javascript"></script>
    <script src="skin/init.js" type="text/javascript" language="javascript"></script>
    <link rel="shortcut icon" href="images/favicon.ico"></link>
</head>
<body dir="ltr" onload="init();">
<div id="top">
    <div class="breadtrail">
        <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://zookeeper.apache.org/">ZooKeeper</a>
    </div>
    <div class="header">
        <div class="grouplogo">
            <a href="http://hadoop.apache.org/"><img class="logoImage" alt="Hadoop的" src="images/hadoop-logo.jpg" title="Apache Hadoop"></a>
        </div>
        <div class="projectlogo">
            <a href="http://zookeeper.apache.org/"><img class="logoImage" alt="动物园管理员" src="images/zookeeper_small.gif" title="ZooKeeper：分布式协调"></a>
        </div>
        <div class="searchbox">
            <form action="http://www.google.com/search" method="get">
                <input value="zookeeper.apache.org" name="sitesearch" type="hidden"><input size="25" name="q" id="query" type="text" value="用谷歌搜索网站" onfocus="getBlank (this, &#39;Search the site with google&#39;);"> 
                <input name="Search" value="搜索" type="submit">
            </form>
        </div>
        <ul id="tabs">
            <li>
                <a class="unselected" href="http://zookeeper.apache.org/">项目</a>
            </li>
            <li>
                <a class="unselected" href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/">维基</a>
            </li>
            <li class="current">
                <a class="selected" href="index.html">ZooKeeper 3.5文档</a>
            </li>
        </ul>
    </div>
</div>
<div id="main">
    <div id="publishedStrip">
        <div id="level2tabs"></div>
        <script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
    </div>
    <div class="breadtrail">
         
    </div>
    <div id="menu">
        <div onclick="SwitchMenu('menu_1', 'skin/')" id="menu_1Title" class="menutitle">Overview</div>
        <div id="menu_1" class="menuitemgroup">
            <div class="menuitem">
                <a href="index.html">欢迎</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperOver.html">概观</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperStarted.html">入门</a>
            </div>
            <div class="menuitem">
                <a href="releasenotes.html">发行说明</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_2', 'skin/')" id="menu_2Title" class="menutitle">Developer</div>
        <div id="menu_2" class="menuitemgroup">
            <div class="menuitem">
                <a href="api/index.html">API文档</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperProgrammers.html">程序员指南</a>
            </div>
            <div class="menuitem">
                <a href="javaExample.html">Java示例</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperTutorial.html">障碍和队列教程</a>
            </div>
            <div class="menuitem">
                <a href="recipes.html">食谱</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_3', 'skin/')" id="menu_3Title" class="menutitle">Admin &amp; Ops</div>
        <div id="menu_3" class="menuitemgroup">
            <div class="menuitem">
                <a href="zookeeperAdmin.html">管理员指南</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperQuotas.html">配额指南</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperJMX.html">JMX</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperObservers.html">观察员指南</a>
            </div>
            <div class="menuitem">
                <a href="zookeeperReconfig.html">动态重新配置</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_4', 'skin/')" id="menu_4Title" class="menutitle">Contributor</div>
        <div id="menu_4" class="menuitemgroup">
            <div class="menuitem">
                <a href="zookeeperInternals.html">ZooKeeper Internals</a>
            </div>
        </div>
        <div onclick="SwitchMenu('menu_5', 'skin/')" id="menu_5Title" class="menutitle">Miscellaneous</div>
        <div id="menu_5" class="menuitemgroup">
            <div class="menuitem">
                <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER">维基</a>
            </div>
            <div class="menuitem">
                <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/FAQ">常问问题</a>
            </div>
            <div class="menuitem">
                <a href="http://zookeeper.apache.org/mailing_lists.html">邮件列表</a>
            </div>
        </div>
    </div>
    <div id="content">
<!--
Copyright 2002-2004 The Apache Software Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
//--><h1>ZooKeeper入门指南</h1>
<ul>
  <li><a href="#getting-started-coordinating-distributed-applications-with-zooKeeper">入门：使用ZooKeeper协调分布式应用程序</a>
  <ul>
    <li><a href="#sc_Prerequisites">先决条件</a></li>
    <li><a href="#sc_Download">下载</a></li>
    <li><a href="#sc_InstallingSingleMode">独立操作</a></li>
    <li><a href="#sc_FileManagement">管理ZooKeeper存储</a></li>
    <li><a href="#sc_ConnectingToZooKeeper">连接到ZooKeeper</a></li>
    <li><a href="#sc_ProgrammingToZooKeeper">编程到ZooKeeper</a></li>
    <li><a href="#sc_RunningReplicatedZooKeeper">运行复制的ZooKeeper</a></li>
    <li><a href="#other-optimizations">其他优化</a></li>
  </ul></li>
</ul><p><a name="getting-started-coordinating-distributed-applications-with-zooKeeper"></a></p><h2>入门：使用ZooKeeper协调分布式应用程序</h2><p>本文档包含有助于您快速使用ZooKeeper的信息。它主要针对希望尝试它的开发人员，包含一个ZooKeeper服务器的简单安装说明，一些验证它正在运行的命令，以及一个简单的编程示例。最后，为方便起见，有一些部分涉及更复杂的安装，例如运行复制部署和优化事务日志。但是，有关商业部署的完整说明，请参阅<a href="zookeeperAdmin.html">ZooKeeper管理员指南</a> 。</p><p><a name="sc_Prerequisites"></a></p><h3>先决条件</h3><p>请参阅<a href="zookeeperAdmin.html#sc_systemReq">管理指南</a>中的<a href="zookeeperAdmin.html#sc_systemReq">系统要求</a> 。</p><p><a name="sc_Download"></a></p><h3>下载</h3><p>要获取ZooKeeper发行版，请从其中一个Apache下载镜像下载最新的<a href="http://zookeeper.apache.org/releases.html">稳定</a>版本。</p><p><a name="sc_InstallingSingleMode"></a></p><h3>独立操作</h3><p>在独立模式下设置ZooKeeper服务器非常简单。服务器包含在单个JAR文件中，因此安装包括创建配置。</p><p>下载完一个稳定的ZooKeeper版本后，将其解压缩并cd到root</p><p>要启动ZooKeeper，您需要一个配置文件。这是一个示例，在<strong>conf / zoo.cfg中</strong>创建它：</p>
<pre><code>tickTime = 2000 dataDir = / var / lib / zookeeper clientPort = 2181</code></pre><p>这个文件可以被称为任何东西，但为了这个讨论，请将其命名为<strong>conf / zoo.cfg</strong> 。更改<strong>dataDir</strong>的值以指定现有（从空开始）目录。以下是每个字段的含义：</p>
<ul>
  <li><p><strong><em>tickTime</em></strong> ：ZooKeeper使用的基本时间单位（以毫秒为单位）。它用于做心跳，最小会话超时将是tickTime的两倍。</p></li>
  <li><p><strong><em>dataDir</em></strong> ：存储内存数据库快照的位置，除非另有说明，否则为数据库更新的事务日志。</p></li>
  <li><p><strong><em>clientPort</em></strong> ：侦听客户端连接的端口</p></li>
</ul><p>现在您已创建配置文件，您可以启动ZooKeeper：</p>
<pre><code>bin / zkServer.sh启动</code></pre><p>ZooKeeper使用log4j记录消息 - 更多详细信息，请参阅Programmer's Guide的<a href="zookeeperProgrammers.html#Logging">Logging</a>部分。您将看到日志消息进入控制台（默认）和/或日志文件，具体取决于log4j配置。</p><p>此处列出的步骤在独立模式下运行ZooKeeper。没有复制，因此如果ZooKeeper进程失败，服务将关闭。这适用于大多数开发情况，但要在复制模式下运行ZooKeeper，请参阅<a href="#sc_RunningReplicatedZooKeeper">运行Replicated ZooKeeper</a> 。</p><p><a name="sc_FileManagement"></a></p><h3>管理ZooKeeper存储</h3><p>对于长期运行的生产系统，必须在外部管理ZooKeeper存储（dataDir和logs）。有关详细信息，请参阅<a href="zookeeperAdmin.html#sc_maintenance">维护</a>部分。</p><p><a name="sc_ConnectingToZooKeeper"></a></p><h3>连接到ZooKeeper</h3>
<pre><code>$ bin / zkCli.sh -server 127.0.0.1:2181</code></pre><p>这使您可以执行简单的文件操作。</p><p>连接后，您应该看到类似的内容：</p>
<pre><code>连接到localhost：2181 log4j：WARN没有为logger找到appender（org.apache.zookeeper。动物园管理员）。log4j：WARN请正确初始化log4j系统。欢迎来到ZooKeeper！启用了JLine支持[zkshell：0]</code></pre><p>在shell中，键入<code>help</code>以获取可从客户端执行的命令列表，如下所示：</p>
<pre><code>[zkshell：0]帮助ZooKeeper主机：port cmd args get path [watch] ls path [watch] set path data [version] delquota [-n | -b] path quit printwatches on | off create path data acl stat path [watch ] listquota path history setAcl path acl getAcl path sync path redo cmdno addauth scheme auth delete path [version] deleteall path setquota -n | -b val path</code></pre><p>从这里，您可以尝试一些简单的命令来感受这个简单的命令行界面。首先，通过发出list命令开始，如在<code>ls</code> ，产生：</p>
<pre><code>[zkshell：8] ls / [zookeeper]</code></pre><p>接下来，通过运行<code>create /zk_test my_data</code>创建一个新的<code>create /zk_test my_data</code> 。这将创建一个新的znode并将字符串“my_data”与节点相关联。你应该看到：</p>
<pre><code>[zkshell：9] create / zk_test my_data Created / zk_test</code></pre><p>发出另一个<code>ls /</code>命令来查看目录的样子：</p>
<pre><code>[zkshell：11] ls / [zookeeper，zk_test]</code></pre><p>请注意，现在已创建zk_test目录。</p><p>接下来，通过运行<code>get</code>命令验证数据是否与znode相关联，如下所示：</p>
<pre><code>[zkshell：12] get / zk_test my_data cZxid = 5 ctime = Fri Jun 05 13:57:06 PDT 2009 mZxid = 5 mtime = Fri Jun 05 13:57:06 PDT 2009 pZxid = 5 cversion = 0 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0 dataLength = 7 numChildren = 0</code></pre><p>我们可以通过发出<code>set</code>命令来更改与zk_test相关的数据，如下所示：</p>
<pre><code>[zkshell：14] set / zk_test junk cZxid = 5 ctime = Fri Jun 05 13:57:06 PDT 2009 mZxid = 6 mtime = Fri Jun 05 14:01:52 PDT 2009 pZxid = 5 cversion = 0 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0 dataLength = 4 numChildren = 0 [zkshell：15] get / zk_test junk cZxid = 5 ctime = Fri Jun 05 13:57:06 PDT 2009 mZxid = 6 mtime = Fri Jun 05 14:01:52 PDT 2009 pZxid = 5 cversion = 0 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0 dataLength = 4 numChildren = 0</code></pre><p>（注意我们在设置数据之后做了一个<code>get</code>的确，确实改变了。</p><p>最后，让我们通过发出以下命令来<code>delete</code>节点：</p>
<pre><code>[zkshell：16] delete / zk_test [zkshell：17] ls / [zookeeper] [zkshell：18]</code></pre><p>这就是现在。要了解更多信息，请继续阅读本文档的其余部分，并参阅“ <a href="zookeeperProgrammers.html">程序员指南”</a> 。</p><p><a name="sc_ProgrammingToZooKeeper"></a></p><h3>编程到ZooKeeper</h3><p>ZooKeeper具有Java绑定和C绑定。它们在功能上是等价的。C绑定有两种变体：单线程和多线程。这些仅在消息传递循环的完成方式上有所不同。有关更多信息，请参阅<a href="zookeeperProgrammers.html#ch_programStructureWithExample">ZooKeeper程序员指南中</a>的<a href="zookeeperProgrammers.html#ch_programStructureWithExample">编程示例</a> ，了解使用不同API的示例代码。</p><p><a name="sc_RunningReplicatedZooKeeper"></a></p><h3>运行复制的ZooKeeper</h3><p>在独立模式下运行ZooKeeper便于评估，开发和测试。但在生产中，您应该以复制模式运行ZooKeeper。同一应用程序中的复制服务器组称为<em>仲裁</em> ，在复制模式下，仲裁中的所有服务器都具有相同配置文件的副本。</p><h6>注意</h6>
<blockquote><p>对于复制模式，至少需要三台服务器，强烈建议您使用奇数个服务器。如果您只有两台服务器，那么您处于这样的情况：如果其中一台服务器出现故障，则没有足够的机器来构成多数仲裁。两台服务器本质上<strong>不如</strong>单一服务器稳定，因为有两个单点故障。</p>
</blockquote><p>复制模式所需的<strong>conf / zoo.cfg</strong>文件类似于独立模式中使用的文件，但有一些差异。这是一个例子：</p>
<pre><code>tickTime = 2000 dataDir = / var / lib / zookeeper clientPort = 2181 initLimit = 5 syncLimit = 2 server.1 = zoo1：2888：3888 server.2 = zoo2：2888：3888 server.3 = zoo3：2888：3888</code></pre><p>新条目<strong>initLimit</strong>是暂停ZooKeeper用于限制仲裁中ZooKeeper服务器连接到领导者的时间长度。条目<strong>syncLimit</strong>限制服务器与领导者的过期时间。</p><p>使用这两个超时，您可以使用<strong>tickTime</strong>指定时间<strong>单位</strong> 。在这个例子中，initLimit的超时是2000个milleseconds（滴答）或10秒的5个滴答。</p><p>表单<em>服务器的条目<em>。X</em>列出构成ZooKeeper服务的服务器。当服务器启动时，它通过在数据目录中查找文件<em>myid</em>来知道它是哪个服务器。该文件包含服务器编号，ASCII格式。</p><p>最后，记下每个服务器名称后面的两个端口号：“2888”和“3888”。对等方使用以前的端口连接到其他对等方。这种连接是必要的，以便对等方可以进行通信，例如，就更新的顺序达成一致。更具体地说，ZooKeeper服务器使用此端口将关注者连接到领导者。当新的领导者出现时，跟随者使用此端口打开与领导者的TCP连接。由于默认的领导者选举也使用TCP，我们目前需要另一个端口进行领导者选举。这是服务器条目中的第二个端口。</p><h6>注意</h6>
<blockquote><p>如果要在一台计算机上测试多个服务器，请将servername指定为<em>localhost，</em>并为每个服务器指定唯一的仲裁和领导者选举端口（即上例中的2888：3888,2889：3889,2890：3890）。服务器配置文件中的X.当然，单独的_dataDir_s和distinct _clientPort_s也是必需的（在上面复制的例子中，在单个<em>localhost</em>上运行，你仍然会有三个配置文件）。</p><p>请注意，在一台计算机上设置多台服务器不会产生任何冗余。如果发生导致机器死亡的事情，所有zookeeper服务器都将脱机。完全冗余要求每台服务器都有自己的机器。它必须是完全独立的物理服务器。同一物理主机上的多个虚拟机仍然容易受到该主机的完全故障的影响。</p>
</blockquote><p><a name="other-optimizations"></a></p><h3>其他优化</h3><p>还有一些其他配置参数可以大大提高性能：</p>
<ul>
  <li>要在更新时获得较低的延迟，请务必拥有专用的事务日志目录。默认情况下，事务日志与数据快照和<em>myid</em>文件放在同一目录中。dataLogDir参数指示用于事务日志的不同目录。</li>
  <li><em>[tbd：其他配置参数是什么？]</em></li>
</ul></div>
<div class="clearboth"> </div>
</div>
<div id="footer">
    <div class="lastmodified">
        <script type="text/javascript">
        <!--
            document.write("Last Published: " + document.lastModified);
        //  -->
        </script>
    </div>
    <div class="copyright">版权所有© <a href="http://www.apache.org/licenses/">Apache Software Foundation。</a>
    </div>
    <div id="logos"></div>
</div>
</body>
</html>