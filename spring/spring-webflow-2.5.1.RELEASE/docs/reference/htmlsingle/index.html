<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Spring Web Flow Reference Guide</title><link rel="stylesheet" type="text/css" href="css/manual-singlepage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book"><div class="titlepage"><div><div><h1 class="title"><a name="spring-framework-reference"></a>Spring Web Flow Reference Guide</h1></div><div><div class="authorgroup"><h2>Authors</h2>
			<span class="author"><span class="firstname">Keith</span> <span class="surname">Donald</span></span>
			, <span class="author"><span class="firstname">Erwin</span> <span class="surname">Vervaet</span></span>
			, <span class="author"><span class="firstname">Jeremy</span> <span class="surname">Grelle</span></span>
			, <span class="author"><span class="firstname">Scott</span> <span class="surname">Andrews</span></span>
			, <span class="author"><span class="firstname">Rossen</span> <span class="surname">Stoyanchev</span></span>
			, <span class="author"><span class="firstname">Phillip</span> <span class="surname">Webb</span></span>
		</div></div><div><p class="releaseinfo">Version 2.5.1.RELEASE</p></div><div><div class="legalnotice"><a name="d5e33" href="#d5e33"></a>
			<p>
				Copies of this document may be made for your own use and for
				distribution to others, provided that you do not charge any
				fee for such copies and further provided that each copy
				contains this Copyright Notice, whether distributed in print
				or electronically.
			</p>
		</div></div><div><p class="pubdate"></p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="sect1"><a href="#manual-overview">1.1. What this guide covers</a></span></dt><dt><span class="sect1"><a href="#system-requirements">1.2. What Web Flow requires to run</a></span></dt><dt><span class="sect1"><a href="#resources">1.3. Resources</a></span></dt><dt><span class="sect1"><a href="#jars-mvn-central">1.4. How to access Web Flow artifacts from Maven Central</a></span></dt><dt><span class="sect1"><a href="#d5e66">1.5. How to access nightly builds and milestone releases</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e69">1.5.1. Accessing snapshots and milestones with Maven</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#whatsnew">2. What's New</a></span></dt><dd><dl><dt><span class="sect1"><a href="#whatsnew-swf-250">2.1. Spring Web Flow 2.5</a></span></dt><dt><span class="sect1"><a href="#whatsnew-swf-240">2.2. Spring Web Flow 2.4</a></span></dt><dd><dl><dt><span class="sect2"><a href="#whatsnew-swf-java-config">2.2.1. Java-based Configuration</a></span></dt><dt><span class="sect2"><a href="#whatsnew-swf-mvcflash">2.2.2. Spring MVC Flash Scope Integration</a></span></dt><dt><span class="sect2"><a href="#whatsnew-partial-validation">2.2.3. Partial JSR-303 Bean Validation</a></span></dt><dt><span class="sect2"><a href="#whatsnew-hibernate4">2.2.4. Hibernate Support</a></span></dt><dt><span class="sect2"><a href="#whatsnew-tiles3">2.2.5. Tiles 3 Support</a></span></dt><dt><span class="sect2"><a href="#whatsnew-swf-jsf20">2.2.6. Minimum JSF 2.0 Requirement</a></span></dt><dt><span class="sect2"><a href="#whatsnew-swf-jsf20-portlet">2.2.7. Portlet API 2.0 and JSF 2.0 support</a></span></dt><dt><span class="sect2"><a href="#whatsnew-deprecation">2.2.8. Deprecations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#whatsnew-swf-230">2.3. Spring Web Flow 2.3</a></span></dt><dd><dl><dt><span class="sect2"><a href="#whatsnew-swf-embedded-flow">2.3.1. Embedding A Flow On A Page</a></span></dt><dt><span class="sect2"><a href="#whatsnew-jsr303">2.3.2. Support For JSR-303 Bean Validation</a></span></dt><dt><span class="sect2"><a href="#whatsnew-pc-propagation">2.3.3. Flow-Managed Persistence Context Propagation</a></span></dt><dt><span class="sect2"><a href="#whatsnew-portlet-resource-requests">2.3.4. Portlet 2.0 Resource Requests</a></span></dt><dt><span class="sect2"><a href="#whatsnew-conversation-manager">2.3.5. Custom ConversationManager</a></span></dt><dt><span class="sect2"><a href="#whatsnew-redirect-in-same-state">2.3.6. Redirect In Same State</a></span></dt><dt><span class="sect2"><a href="#whatsnew-samples">2.3.7. Samples</a></span></dt></dl></dd><dt><span class="sect1"><a href="#whatsnew-swf-220">2.4. Spring Web Flow 2.2</a></span></dt><dd><dl><dt><span class="sect2"><a href="#whatsnew-jsf2">2.4.1. JSF 2 Support</a></span></dt><dd><dl><dt><span class="sect3"><a href="#d5e180">Comprehensive JSF 2 Support</a></span></dt><dt><span class="sect3"><a href="#d5e187">Travel Sample With the PrimeFaces Components</a></span></dt></dl></dd><dt><span class="sect2"><a href="#whatsnew-sec">2.4.2. Spring Security Facelets Tag Library</a></span></dt><dt><span class="sect2"><a href="#whatsnew-versions">2.4.3. Spring JavaScript Updates</a></span></dt><dd><dl><dt><span class="sect3"><a href="#d5e200">Deprecated ResourcesServlet</a></span></dt><dt><span class="sect3"><a href="#d5e204">Dojo 1.5 and dojox</a></span></dt><dt><span class="sect3"><a href="#d5e209">Two Spring JS artifacts</a></span></dt><dt><span class="sect3"><a href="#d5e219">Client resources moved into META-INF/web-resources</a></span></dt></dl></dd><dt><span class="sect2"><a href="#whatsnew-jsf-portlet">2.4.4. JSF Portlet Support</a></span></dt><dd><dl><dt><span class="sect3"><a href="#d5e226">Portlet API 2.0 and JSF 1.2 support</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#defining-flows">3. Defining Flows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#defining-flows-introduction">3.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-overview">3.2. What is a flow?</a></span></dt><dt><span class="sect1"><a href="#flow-makeup">3.3. What is the makeup of a typical flow?</a></span></dt><dt><span class="sect1"><a href="#flow-authoring">3.4. How are flows authored?</a></span></dt><dt><span class="sect1"><a href="#essential-flow-elements">3.5. Essential language elements</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-element">3.5.1. flow</a></span></dt><dt><span class="sect2"><a href="#view-state-element">3.5.2. view-state</a></span></dt><dt><span class="sect2"><a href="#transition-element">3.5.3. transition</a></span></dt><dt><span class="sect2"><a href="#end-state-element">3.5.4. end-state</a></span></dt><dt><span class="sect2"><a href="#checkpoint-essential-language-elements">3.5.5. Checkpoint: Essential language elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-actions">3.6. Actions</a></span></dt><dd><dl><dt><span class="sect2"><a href="#evaluate-element">3.6.1. evaluate</a></span></dt><dd><dl><dt><span class="sect3"><a href="#evaluate-element-result">Assigning an evaluate result</a></span></dt><dt><span class="sect3"><a href="#evaluate-element-result-type">Converting an evaluate result</a></span></dt></dl></dd><dt><span class="sect2"><a href="#checkpoint-actions">3.6.2. Checkpoint: flow actions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-inputoutput">3.7. Input/Output Mapping</a></span></dt><dd><dl><dt><span class="sect2"><a href="#input-element">3.7.1. input</a></span></dt><dd><dl><dt><span class="sect3"><a href="#input-element-type">Declaring an input type</a></span></dt><dt><span class="sect3"><a href="#input-element-value">Assigning an input value</a></span></dt><dt><span class="sect3"><a href="#input-element-required">Marking an input as required</a></span></dt></dl></dd><dt><span class="sect2"><a href="#output-element">3.7.2. output</a></span></dt><dd><dl><dt><span class="sect3"><a href="#output-element-value">Specifying the source of an output value</a></span></dt></dl></dd><dt><span class="sect2"><a href="#checkpoint-input-output">3.7.3. Checkpoint: input/output mapping</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-variables">3.8. Variables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#var-element">3.8.1. var</a></span></dt></dl></dd><dt><span class="sect1"><a href="#scopes">3.9. Variable Scopes</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e398">3.9.1. Flow Scope</a></span></dt><dt><span class="sect2"><a href="#d5e401">3.9.2. View Scope</a></span></dt><dt><span class="sect2"><a href="#d5e407">3.9.3. Request Scope</a></span></dt><dt><span class="sect2"><a href="#d5e410">3.9.4. Flash Scope</a></span></dt><dt><span class="sect2"><a href="#d5e413">3.9.5. Conversation Scope</a></span></dt></dl></dd><dt><span class="sect1"><a href="#calling-subflows">3.10. Calling subflows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#subflow-state-element">3.10.1. subflow-state</a></span></dt><dd><dl><dt><span class="sect3"><a href="#subflow-state-element-input">Passing a subflow input</a></span></dt><dt><span class="sect3"><a href="#subflow-state-element-output">Mapping subflow output</a></span></dt></dl></dd><dt><span class="sect2"><a href="#checkpoint-subflow">3.10.2. Checkpoint: calling subflows</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#el">4. Expression Language (EL)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#el-introduction">4.1. Introduction</a></span></dt><dd><dl><dt><span class="sect2"><a href="#el-types">4.1.1. Expression types</a></span></dt><dd><dl><dt><span class="sect3"><a href="#el-types-eval">Standard Expressions</a></span></dt><dt><span class="sect3"><a href="#el-types-template">Template expressions</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#el-language-choices">4.2. EL Implementations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#el-spring-el">4.2.1. Spring EL</a></span></dt><dt><span class="sect2"><a href="#el-unified-el">4.2.2. Unified EL</a></span></dt></dl></dd><dt><span class="sect1"><a href="#el-portability">4.3. EL portability</a></span></dt><dt><span class="sect1"><a href="#el-variables">4.4. Special EL variables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#el-variable-flowScope">4.4.1. flowScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-viewScope">4.4.2. viewScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-requestScope">4.4.3. requestScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-flashScope">4.4.4. flashScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-conversationScope">4.4.5. conversationScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-requestParameters">4.4.6. requestParameters</a></span></dt><dt><span class="sect2"><a href="#el-variable-currentEvent">4.4.7. currentEvent</a></span></dt><dt><span class="sect2"><a href="#el-variable-currentUser">4.4.8. currentUser</a></span></dt><dt><span class="sect2"><a href="#el-variable-messageContext">4.4.9. messageContext</a></span></dt><dt><span class="sect2"><a href="#el-variable-resourceBundle">4.4.10. resourceBundle</a></span></dt><dt><span class="sect2"><a href="#el-variable-requestContext">4.4.11. flowRequestContext</a></span></dt><dt><span class="sect2"><a href="#el-variable-flowExecutionContext">4.4.12. flowExecutionContext</a></span></dt><dt><span class="sect2"><a href="#el-variable-flowExecutionUrl">4.4.13. flowExecutionUrl</a></span></dt><dt><span class="sect2"><a href="#el-variable-externalContext">4.4.14. externalContext</a></span></dt></dl></dd><dt><span class="sect1"><a href="#el-scope-searching">4.5. Scope searching algorithm</a></span></dt></dl></dd><dt><span class="chapter"><a href="#views">5. Rendering views</a></span></dt><dd><dl><dt><span class="sect1"><a href="#views-introduction">5.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#view-convention">5.2. Defining view states</a></span></dt><dt><span class="sect1"><a href="#view-explicit">5.3. Specifying view identifiers</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-explicit-flowrelative">5.3.1. Flow relative view ids</a></span></dt><dt><span class="sect2"><a href="#view-explicit-absolute">5.3.2. Absolute view ids</a></span></dt><dt><span class="sect2"><a href="#view-explicit-logical">5.3.3. Logical view ids</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-scope">5.4. View scope</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-scope-var">5.4.1. Allocating view variables</a></span></dt><dt><span class="sect2"><a href="#view-scope-actions">5.4.2. Assigning a viewScope variable</a></span></dt><dt><span class="sect2"><a href="#view-scope-ajax">5.4.3. Manipulating objects in view scope</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-on-render">5.5. Executing render actions</a></span></dt><dt><span class="sect1"><a href="#view-model">5.6. Binding to a model</a></span></dt><dt><span class="sect1"><a href="#view-type-conversion">5.7. Performing type conversion</a></span></dt><dd><dl><dt><span class="sect2"><a href="#converter-options">5.7.1. Type Conversion Options</a></span></dt><dt><span class="sect2"><a href="#converter-upgrade-to-spring-3">5.7.2. Upgrading to Spring 3 Type Conversion And Formatting</a></span></dt><dt><span class="sect2"><a href="#converter-configuration">5.7.3. Configuring Type Conversion and Formatting</a></span></dt><dt><span class="sect2"><a href="#converter-working-with">5.7.4. Working With Spring 3 Type Conversion And Formatting</a></span></dt><dt><span class="sect2"><a href="#converter-formatting-annotations">5.7.5. Formatting Annotations</a></span></dt><dt><span class="sect2"><a href="#converter-dates">5.7.6. Working With Dates</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-bind">5.8. Suppressing binding</a></span></dt><dt><span class="sect1"><a href="#view-binder">5.9. Specifying bindings explicitly</a></span></dt><dt><span class="sect1"><a href="#view-validate">5.10. Validating a model</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-validation-jsr303">5.10.1. JSR-303 Bean Validation</a></span></dt><dd><dl><dt><span class="sect3"><a href="#view-validation-jsr303-partial">Partial Validation</a></span></dt></dl></dd><dt><span class="sect2"><a href="#view-validation-programmatic">5.10.2. Programmatic validation</a></span></dt><dd><dl><dt><span class="sect3"><a href="#view-validation-programmatic-validate-method">Implementing a model validate method</a></span></dt><dt><span class="sect3"><a href="#view-validation-programmatic-validator">Implementing a Validator</a></span></dt><dt><span class="sect3"><a href="#default-validate-method">Default validate method</a></span></dt></dl></dd><dt><span class="sect2"><a href="#view-validation-context">5.10.3. ValidationContext</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-validation-suppression">5.11. Suppressing validation</a></span></dt><dt><span class="sect1"><a href="#view-transitions">5.12. Executing view transitions</a></span></dt><dd><dl><dt><span class="sect2"><a href="#transition-actions">5.12.1. Transition actions</a></span></dt><dt><span class="sect2"><a href="#event-handlers-global">5.12.2. Global transitions</a></span></dt><dt><span class="sect2"><a href="#simple-event-handlers">5.12.3. Event handlers</a></span></dt><dt><span class="sect2"><a href="#event-handlers-render">5.12.4. Rendering fragments</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-messages">5.13. Working with messages</a></span></dt><dd><dl><dt><span class="sect2"><a href="#plain-text-message">5.13.1. Adding plain text messages</a></span></dt><dt><span class="sect2"><a href="#plain-text-message-intl">5.13.2. Adding internationalized messages</a></span></dt><dt><span class="sect2"><a href="#message-bundles">5.13.3. Using message bundles</a></span></dt><dt><span class="sect2"><a href="#message-generation">5.13.4. Understanding system generated messages</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-popup">5.14. Displaying popups</a></span></dt><dt><span class="sect1"><a href="#view-backtracking">5.15. View backtracking</a></span></dt><dd><dl><dt><span class="sect2"><a href="#history-discard">5.15.1. Discarding history</a></span></dt><dt><span class="sect2"><a href="#history-invalidate">5.15.2. Invalidating history</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#actions">6. Executing actions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#actions-introduction">6.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#action-state">6.2. Defining action states</a></span></dt><dt><span class="sect1"><a href="#decision-state">6.3. Defining decision states</a></span></dt><dt><span class="sect1"><a href="#action-outcome-events">6.4. Action outcome event mappings</a></span></dt><dt><span class="sect1"><a href="#action-implementations">6.5. Action implementations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1045">6.5.1. Invoking a POJO action</a></span></dt><dt><span class="sect2"><a href="#d5e1049">6.5.2. Invoking a custom Action implementation</a></span></dt><dt><span class="sect2"><a href="#d5e1053">6.5.3. Invoking a MultiAction implementation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#action-exceptions">6.6. Action exceptions</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1060">6.6.1. Handling a business exception with a POJO action</a></span></dt><dt><span class="sect2"><a href="#d5e1065">6.6.2. Handling a business exception with a MultiAction</a></span></dt><dt><span class="sect2"><a href="#d5e1071">6.6.3. Using an exception-handler element</a></span></dt></dl></dd><dt><span class="sect1"><a href="#action-examples">6.7. Other Action execution examples</a></span></dt><dd><dl><dt><span class="sect2"><a href="#action-on-start">6.7.1. on-start</a></span></dt><dt><span class="sect2"><a href="#action-on-state-entry">6.7.2. on-entry</a></span></dt><dt><span class="sect2"><a href="#action-on-state-exit">6.7.3. on-exit</a></span></dt><dt><span class="sect2"><a href="#on-end">6.7.4. on-end</a></span></dt><dt><span class="sect2"><a href="#action-on-render">6.7.5. on-render</a></span></dt><dt><span class="sect2"><a href="#action-on-transition">6.7.6. on-transition</a></span></dt><dt><span class="sect2"><a href="#named-actions">6.7.7. Named actions</a></span></dt><dt><span class="sect2"><a href="#streaming-actions">6.7.8. Streaming actions</a></span></dt><dt><span class="sect2"><a href="#file-upload">6.7.9. Handling File Uploads</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#flow-managed-persistence">7. Flow Managed Persistence</a></span></dt><dd><dl><dt><span class="sect1"><a href="#flow-managed-persistence-introduction">7.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flowScopedPersistenceContext">7.2. FlowScoped PersistenceContext</a></span></dt><dt><span class="sect1"><a href="#flow-managed-persistence-propagation">7.3. Flow Managed Persistence And Sub-Flows</a></span></dt></dl></dd><dt><span class="chapter"><a href="#flow-security">8. Securing Flows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#flow-security-introduction">8.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-security-how-to">8.2. How do I secure a flow?</a></span></dt><dt><span class="sect1"><a href="#flow-security-secured-element">8.3. The secured element</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-security-secured-element-attributes">8.3.1. Security attributes</a></span></dt><dt><span class="sect2"><a href="#flow-security-secured-element-match">8.3.2. Matching type</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-security-listener">8.4. The SecurityFlowExecutionListener</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-security-listener-adm">8.4.1. Custom Access Decision Managers</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-security-configuration">8.5. Configuring Spring Security</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-security-configuration-spring">8.5.1. Spring configuration</a></span></dt><dt><span class="sect2"><a href="#flow-security-configuration-web">8.5.2. web.xml Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#flow-inheritance">9. Flow Inheritance</a></span></dt><dd><dl><dt><span class="sect1"><a href="#flow-inheritance-introduction">9.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-inheritance-java-comparison">9.2. Is flow inheritance like Java inheritance?</a></span></dt><dt><span class="sect1"><a href="#flow-inheritance-levels">9.3. Types of Flow Inheritance</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-inheritance-level-flow">9.3.1. Flow level inheritance</a></span></dt><dt><span class="sect2"><a href="#flow-inheritance-level-state">9.3.2. State level inheritance</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-inheritance-abstract">9.4. Abstract flows</a></span></dt><dt><span class="sect1"><a href="#flow-inheritance-algorithm">9.5. Inheritance Algorithm</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-inheritance-algorithm-mergeable">9.5.1. Mergeable Elements</a></span></dt><dt><span class="sect2"><a href="#flow-inheritance-nonmergeable">9.5.2. Non-mergeable Elements</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#system-setup">10. System Setup</a></span></dt><dd><dl><dt><span class="sect1"><a href="#system-setup-introduction">10.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#system-config-options">10.2. Java Config and XML Namespace</a></span></dt><dt><span class="sect1"><a href="#system-config-basic">10.3. Basic system configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#basic-setup-flow-registry">10.3.1. FlowRegistry</a></span></dt><dt><span class="sect2"><a href="#basic-setup-flow-executor">10.3.2. FlowExecutor</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-registry">10.4. flow-registry options</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-registry-location">10.4.1. Specifying flow locations</a></span></dt><dt><span class="sect2"><a href="#flow-registry-location-id">10.4.2. Assigning custom flow identifiers</a></span></dt><dt><span class="sect2"><a href="#flow-registry-location-attributes">10.4.3. Assigning flow meta-attributes</a></span></dt><dt><span class="sect2"><a href="#flow-registry-patterns">10.4.4. Registering flows using a location pattern</a></span></dt><dt><span class="sect2"><a href="#flow-registry-base-path">10.4.5. Flow location base path</a></span></dt><dt><span class="sect2"><a href="#flow-registry-parent">10.4.6. Configuring FlowRegistry hierarchies</a></span></dt><dt><span class="sect2"><a href="#flow-registry-builder-services">10.4.7. Configuring custom FlowBuilder services</a></span></dt><dd><dl><dt><span class="sect3"><a href="#builder-service-conversion">conversion-service</a></span></dt><dt><span class="sect3"><a href="#builder-service-expression-parser">expression-parser</a></span></dt><dt><span class="sect3"><a href="#builder-service-view-factory-creator">view-factory-creator</a></span></dt><dt><span class="sect3"><a href="#builder-development">development</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#flow-executor">10.5. flow-executor options</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-executor-execution-listeners">10.5.1. Attaching flow execution listeners</a></span></dt><dt><span class="sect2"><a href="#tuning-flow-execution-repository">10.5.2. Tuning FlowExecution persistence</a></span></dt><dd><dl><dt><span class="sect3"><a href="#repository-max-executions">max-executions</a></span></dt><dt><span class="sect3"><a href="#repository-max-snapshots">max-execution-snapshots</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#spring-mvc">11. Spring MVC Integration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spring-mvc-introduction">11.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-config-web.xml">11.2. Configuring web.xml</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-config-spring-url-mapping">11.3. Dispatching to flows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1532">11.3.1. Registering the FlowHandlerAdapter</a></span></dt><dt><span class="sect2"><a href="#d5e1537">11.3.2. Defining flow mappings</a></span></dt><dt><span class="sect2"><a href="#d5e1545">11.3.3. Flow handling workflow</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-mvc-config-flow-handlers">11.4. Implementing custom FlowHandlers</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-mvc-flow-handler-example">11.4.1. Example FlowHandler</a></span></dt><dt><span class="sect2"><a href="#d5e1600">11.4.2. Deploying a custom FlowHandler</a></span></dt><dt><span class="sect2"><a href="#spring-mvc-flow-handler-redirects">11.4.3. FlowHandler Redirects</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-mvc-config-spring-view-resolution">11.5. View Resolution</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-resuming-on-event">11.6. Signaling an event from a View</a></span></dt><dd><dl><dt><span class="sect2"><a href="#webflow-event-named-html-button">11.6.1. Using a named HTML button to signal an event</a></span></dt><dt><span class="sect2"><a href="#webflow-event-hidden-parameter">11.6.2. Using a hidden HTML form parameter to signal an event</a></span></dt><dt><span class="sect2"><a href="#webflow-event-link">11.6.3. Using a HTML link to signal an event</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-mvc-embedded-flow">11.7. Embedding A Flow On A Page</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-mvc-embedded-flow-alternatives">11.7.1. Embedded Mode Vs Default Redirect Behavior</a></span></dt><dt><span class="sect2"><a href="#spring-mvc-embedded-flow-examples">11.7.2. Embedded Flow Examples</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-mvc-flash-output">11.8. Saving Flow Output to MVC Flash Scope</a></span></dt></dl></dd><dt><span class="chapter"><a href="#spring-js">12. Spring JavaScript Quick Reference</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spring-js-introduction">12.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#spring-js-resource-servlet">12.2. Serving Javascript Resources</a></span></dt><dt><span class="sect1"><a href="#spring-js-includes">12.3. Including Spring Javascript in a Page</a></span></dt><dt><span class="sect1"><a href="#spring-js-decorations">12.4. Spring Javascript Decorations</a></span></dt><dt><span class="sect1"><a href="#spring-js-ajax">12.5. Handling Ajax Requests</a></span></dt><dd><dl><dt><span class="sect2"><a href="#custom-ajax-handler">12.5.1. Providing a Library-Specific AjaxHandler</a></span></dt><dt><span class="sect2"><a href="#spring-js-ajax-mvc">12.5.2. Handling Ajax Requests with Spring MVC Controllers</a></span></dt><dt><span class="sect2"><a href="#spring-js-ajax-mvc-webflow">12.5.3. Handling Ajax Requests with Spring MVC + Spring Web Flow</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#spring-faces">13. JSF Integration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spring-faces-introduction">13.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#spring-faces-config-web.xml">13.2. Configuring web.xml</a></span></dt><dt><span class="sect1"><a href="#spring-faces-webflow-config">13.3. Configuring Web Flow for use with JSF</a></span></dt><dt><span class="sect1"><a href="#spring-faces-managed-beans">13.4. Replacing the JSF Managed Bean Facility</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-faces-flow-variables">13.4.1. Using Flow Variables</a></span></dt><dt><span class="sect2"><a href="#spring-faces-spring-beans">13.4.2. Using Scoped Spring Beans</a></span></dt><dt><span class="sect2"><a href="#faces-manipulating-model">13.4.3. Manipulating The Model</a></span></dt><dt><span class="sect2"><a href="#faces-data-model-implementations">13.4.4. Data Model Implementations</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-faces-event-handling">13.5. Handling JSF Events With Spring Web Flow</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-faces-in-page-events">13.5.1. Handling JSF In-page Action Events</a></span></dt><dt><span class="sect2"><a href="#spring-faces-action-events">13.5.2. Handling JSF Action Events</a></span></dt><dt><span class="sect2"><a href="#spring-faces-model-validation">13.5.3. Performing Model Validation</a></span></dt><dt><span class="sect2"><a href="#spring-faces-ajax-events-jsf2">13.5.4. Handling Ajax Events In JSF</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-faces-embedded-mode">13.6. Embedding a Flow On a Page</a></span></dt><dt><span class="sect1"><a href="#spring-faces-redirect-in-same-state">13.7. Redirect In Same State</a></span></dt><dt><span class="sect1"><a href="#spring-faces-file-upload">13.8. Handling File Uploads with JSF</a></span></dt><dd><dl><dt><span class="sect2"><a href="#d5e1950">13.8.1. File Uploads with PrimeFaces</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-faces-security-taglib">13.9. Using the Spring Security Facelets Tag Library</a></span></dt><dt><span class="sect1"><a href="#spring-faces-component-libraries">13.10. Third-Party Component Library Integration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testing">14. Testing flows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#testing-introduction">14.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#extending-abstractflowexecutiontest">14.2. Extending AbstractXmlFlowExecutionTests</a></span></dt><dt><span class="sect1"><a href="#override-getResource">14.3. Specifying the path to the flow to test</a></span></dt><dt><span class="sect1"><a href="#override-configureFlowBuilderContext">14.4. Registering flow dependencies</a></span></dt><dt><span class="sect1"><a href="#testing-flowstartup">14.5. Testing flow startup</a></span></dt><dt><span class="sect1"><a href="#testing-flowevents">14.6. Testing flow event handling</a></span></dt><dt><span class="sect1"><a href="#testing-mockingsubflows">14.7. Mocking a subflow</a></span></dt></dl></dd><dt><span class="appendix"><a href="#field-mappings">A. Flow Definition Language 1.0 to 2.0 Mappings</a></span></dt></dl></div>

	

	

	<div class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface" href="#preface"></a>Preface</h1></div></div></div>
		
		<p>
			Many web applications require the same sequence of steps to execute in different contexts.
			Often these sequences are merely components of a larger task the user is trying to accomplish.
			Such a reusable sequence is called a flow.
		</p>
		<p>
			Consider a typical shopping cart application.
			User registration, login, and cart checkout are all examples of flows that can be invoked from several places in this type of application.
		</p>
		<p>
			Spring Web Flow is the module of Spring for implementing flows.
			The Web Flow engine plugs into the Spring Web MVC platform and provides declarative flow definition language.
			This reference guide shows you how to use and extend Spring Web Flow.
		</p>
	</div>

	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="introduction" href="#introduction"></a>1.&nbsp;Introduction</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manual-overview" href="#manual-overview"></a>1.1.&nbsp;What this guide covers</h2></div></div></div>
		
		<p>
			This guide covers all aspects of Spring Web Flow.
			It covers implementing flows in end-user applications and working with the feature set.
			It also covers extending the framework and the overall architectural model.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-requirements" href="#system-requirements"></a>1.2.&nbsp;What Web Flow requires to run</h2></div></div></div>
		
		<p>
			Java 1.8 or higher.
		</p>
		<p>
			Spring 5.0 or higher.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources" href="#resources"></a>1.3.&nbsp;Resources</h2></div></div></div>
		
		<p>
			You can ask questions and interact on StackOverflow using the designated tags,
			see <a class="ulink" href="https://spring.io/questions" target="_top">Spring at StackOverflow</a>.
		</p>
		<p>
			Report bugs and make requests using the
			<a class="ulink" href="http://jira.spring.io" target="_top">Spring Issue Tracker</a>.
		</p>
		<p>
			Submit pull requests and work with the source code  ,
			see <a class="ulink" href="https://github.com/spring-projects/spring-webflow" target="_top">Web Flow on Github</a>.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jars-mvn-central" href="#jars-mvn-central"></a>1.4.&nbsp;How to access Web Flow artifacts from Maven Central</h2></div></div></div>
		
		<p>
			Each jar in the Web Flow distribution is available in the <a class="ulink" href="http://search.maven.org" target="_top">Maven Central Repository</a>.
			This allows you to easily integrate Web Flow into your application if you are already using Maven as the
			build system for your web development project.
		</p>
		<p>
			To access Web Flow jars from Maven Central, declare the following dependency in your pom:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>org.springframework.webflow<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>spring-webflow<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>x.y.z.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
<span class="hl-tag">&lt;/dependency&gt;</span>

		</pre>
		<p>
			If using JavaServer Faces, declare the following dependency in your pom
			(includes transitive dependencies "spring-binding", "spring-webflow"):
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>org.springframework.webflow<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>spring-faces<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>x.y.z.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
<span class="hl-tag">&lt;/dependency&gt;</span>

		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e66" href="#d5e66"></a>1.5.&nbsp;How to access nightly builds and milestone releases</h2></div></div></div>
		
		<p>
			Nightly snapshots of Web Flow development branches are available using Maven.
			These snapshot builds are useful for testing out fixes you depend on in advance of the next release, and provide a convenient way for you to provide feedback about whether a fix meets your needs.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e69" href="#d5e69"></a>1.5.1.&nbsp;Accessing snapshots and milestones with Maven</h3></div></div></div>
			
			<p>
				For milestones and snapshots you'll need to use the SpringSource repository.
				Add the following repository to your Maven pom.xml:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;repository&gt;</span>
    <span class="hl-tag">&lt;id&gt;</span>spring<span class="hl-tag">&lt;/id&gt;</span>
    <span class="hl-tag">&lt;name&gt;</span>Spring Repository<span class="hl-tag">&lt;/name&gt;</span>
    <span class="hl-tag">&lt;url&gt;</span>http://repo.spring.io/snapshot<span class="hl-tag">&lt;/url&gt;</span>
<span class="hl-tag">&lt;/repository&gt;</span>
			</pre>
			<p>
				Then declare the following dependencies:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>org.springframework.webflow<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>spring-webflow<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>x.y.z.BUILD-SNAPSHOT<span class="hl-tag">&lt;/version&gt;</span>
<span class="hl-tag">&lt;/dependency&gt;</span>
			</pre>
			<p>
				And if using JSF:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>org.springframework.webflow<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>spring-faces<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>x.y.z.BUILD-SNAPSHOT<span class="hl-tag">&lt;/version&gt;</span>
<span class="hl-tag">&lt;/dependency&gt;</span>
			</pre>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="whatsnew" href="#whatsnew"></a>2.&nbsp;What's New</h1></div></div></div>
	

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-swf-250" href="#whatsnew-swf-250"></a>2.1.&nbsp;Spring Web Flow 2.5</h2></div></div></div>
		
		<p>
			This release provides an upgrade path to Spring Framework 5 that in turn requires
			Java 8+, Servlet 3.1, Hibernate 5, Tiles 3. See the
			<a class="ulink" href="https://github.com/spring-projects/spring-framework/wiki/What%27s-New-in-Spring-Framework-5.x" target="_top">Spring Framework wiki</a>
			for more details. The <a class="ulink" href="https://github.com/spring-projects/spring-webflow-samples" target="_top">samples repository</a>
			has been upgraded to Spring Web Flow 2.5.
		</p>
		<p>
			As of 2.5 there is no longer a <span class="emphasis"><em>spring-js</em></span> module. The classes from that module
			have been kept but moved to new packages in the <span class="emphasis"><em>spring-webflow</em></span> module.
			The <span class="emphasis"><em>spring-js-resources</em></span> module is available as an optional module that
			must be included explicitly.
		</p>
		<p>This release requires JSF 2.2 or higher.</p>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-swf-240" href="#whatsnew-swf-240"></a>2.2.&nbsp;Spring Web Flow 2.4</h2></div></div></div>
		
		<p>This release requires JDK 1.6.</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-swf-java-config" href="#whatsnew-swf-java-config"></a>2.2.1.&nbsp;Java-based Configuration</h3></div></div></div>
			
			<p>
				Web Flow now supports a Java-based alternative for its system configuration.
				See the updated <a class="xref" href="#system-setup" title="10.&nbsp;System Setup">Chapter&nbsp;10, <i>System Setup</i></a>.
			</p>
			<p>
				Also see the
				<a class="ulink" href="https://github.com/spring-projects/spring-webflow-samples/tree/master/booking-mvc" target="_top">booking-mvc</a> and
				<a class="ulink" href="https://github.com/spring-projects/spring-webflow-samples/tree/master/booking-faces" target="_top">booking-faces</a>
				samples that have been updated to use all Java config.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-swf-mvcflash" href="#whatsnew-swf-mvcflash"></a>2.2.2.&nbsp;Spring MVC Flash Scope Integration</h3></div></div></div>
			
			<p>
				When a flow ends it can now redirect to a Spring MVC controller after saving
				attributes in Spring MVC's flash scope for the controller to access.
			</p>
			<p>
				See <a class="xref" href="#spring-mvc-flash-output" title="11.8.&nbsp;Saving Flow Output to MVC Flash Scope">Section&nbsp;11.8, &#8220;Saving Flow Output to MVC Flash Scope&#8221;</a>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-partial-validation" href="#whatsnew-partial-validation"></a>2.2.3.&nbsp;Partial JSR-303 Bean Validation</h3></div></div></div>
			
			<p>
				A flow definition can apply partial validation on the model through the validation-hints
				attribute supported on view state and transition elements.
			</p>
			<p>
				See <a class="xref" href="#view-validation-jsr303-partial" title="Partial Validation">the section called &#8220;Partial Validation&#8221;</a>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-hibernate4" href="#whatsnew-hibernate4"></a>2.2.4.&nbsp;Hibernate Support</h3></div></div></div>
			
			<p>
				The <code class="classname">HibernateFlowExecutionListener</code> now supports Hibernate 4 in addition to Hibernate 3.
			</p>
			<p>
				As of 2.4.4 the <code class="classname">HibernateFlowExecutionListener</code> also works with Hibernate 5.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-tiles3" href="#whatsnew-tiles3"></a>2.2.5.&nbsp;Tiles 3 Support</h3></div></div></div>
			
			<p>
				The <code class="classname">AjaxTilesView</code> now supports Tiles 3 in addition to Tiles 2.2.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-swf-jsf20" href="#whatsnew-swf-jsf20"></a>2.2.6.&nbsp;Minimum JSF 2.0 Requirement</h3></div></div></div>
			
			<p>
				Java ServerFaces version 1.2 and earlier are no longer supported by Spring Web Flow, if you have not done so already you will need to upgrade to JSF 2.0 or above.
				In addition the Spring Faces components that were previously provided with JSF 1.2 for progressive AJAX enhancements have been removed in this release.
			</p>
			<p>
				See <a class="xref" href="#">???</a>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-swf-jsf20-portlet" href="#whatsnew-swf-jsf20-portlet"></a>2.2.7.&nbsp;Portlet API 2.0 and JSF 2.0 support</h3></div></div></div>
			
			<p>
				The internal Portlet integration introduced in Spring Web Flow 2.2 has been upgraded for JSF 2.0 compatibility.
				Some of the more advanced JSF 2.0 features, such as partial state saving, are not supported in a Portlet environment, however, existing application can now upgrade to the minimum required JSF version.
				Upgraded projects will need to ensure that the <code class="code">&lt;faces:resources&gt;</code> elements is
				included as part of their Spring configuration.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-deprecation" href="#whatsnew-deprecation"></a>2.2.8.&nbsp;Deprecations</h3></div></div></div>
			
			<p>
				This release deprecates <span class="emphasis"><em>Spring.js</em></span>. The deprecation includes the entire
				<span class="emphasis"><em>spring-js-resources</em></span> module including <span class="emphasis"><em>Spring.js</em></span> and
				<span class="emphasis"><em>Spring-Dojo.js</em></span> and the bundled Dojo and CSS Framework.
				Also deprecated is the <code class="classname">SpringJavascriptAjaxHandler</code>
				from the <span class="emphasis"><em>spring-js</em></span> module. The rest of <span class="emphasis"><em>spring-js</em></span>,
				e.g. <code class="classname">AjaxHandler</code>, <code class="classname">AjaxTilesView</code>, will be
				folded into <span class="emphasis"><em>spring-webflow</em></span> in a future release.
			</p>
			<p>
				OGNL support is now deprecated.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-swf-230" href="#whatsnew-swf-230"></a>2.3.&nbsp;Spring Web Flow 2.3</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-swf-embedded-flow" href="#whatsnew-swf-embedded-flow"></a>2.3.1.&nbsp;Embedding A Flow On A Page</h3></div></div></div>
			
			<p>
				By default Web Flow does a client-side redirect upon entering every view state.
				That makes it impossible to embed a flow on a page or within a modal dialog and execute more than one view state without causing a full-page refresh.
				Web Flow now supports launching a flow in "embedded" mode.
				In this mode a flow can transition to other view states without a client-side redirect during Ajax requests.
				See <a class="xref" href="#spring-mvc-embedded-flow" title="11.7.&nbsp;Embedding A Flow On A Page">Section&nbsp;11.7, &#8220;Embedding A Flow On A Page&#8221;</a> and <a class="xref" href="#spring-faces-embedded-mode" title="13.6.&nbsp;Embedding a Flow On a Page">Section&nbsp;13.6, &#8220;Embedding a Flow On a Page&#8221;</a>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-jsr303" href="#whatsnew-jsr303"></a>2.3.2.&nbsp;Support For JSR-303 Bean Validation</h3></div></div></div>
			
			<p>
				Support for the JSR-303 Bean Validation API is now available building on equivalent support available in Spring MVC.
				See <a class="xref" href="#view-validate" title="5.10.&nbsp;Validating a model">Section&nbsp;5.10, &#8220;Validating a model&#8221;</a> for more details.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-pc-propagation" href="#whatsnew-pc-propagation"></a>2.3.3.&nbsp;Flow-Managed Persistence Context Propagation</h3></div></div></div>
			
			<p>
				Starting with Web Flow 2.3 a flow managed <code class="code">PersistenceContext</code> is automatically extended (propagated) to sub-flows assuming the subflow also has the feature enabled as well.
				See <a class="xref" href="#flow-managed-persistence-propagation" title="7.3.&nbsp;Flow Managed Persistence And Sub-Flows">Section&nbsp;7.3, &#8220;Flow Managed Persistence And Sub-Flows&#8221;</a>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-portlet-resource-requests" href="#whatsnew-portlet-resource-requests"></a>2.3.4.&nbsp;Portlet 2.0 Resource Requests</h3></div></div></div>
			
			<p>
				Support for Portlet 2.0 resource requests has now been added enabling Ajax requests with partial rendering.
				URLs for such requests can be prepared with the <code class="code">&lt;portlet:resourceURL&gt;</code> tag in JSP pages.
				Server-side processing is similar to a combined an action and a render requests but combined in a single request.
				Unlike a render request, the response from a resource request includes content from the target portlet only.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-conversation-manager" href="#whatsnew-conversation-manager"></a>2.3.5.&nbsp;Custom ConversationManager</h3></div></div></div>
			
			<p>
				The <code class="code">&lt;flow-execution-repository&gt;</code> element now provides a conversation-manager attribute accepting a reference to a ConversationManager instance.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-redirect-in-same-state" href="#whatsnew-redirect-in-same-state"></a>2.3.6.&nbsp;Redirect In Same State</h3></div></div></div>
			
			<p>
		    	By default Web Flow does a client-side redirect when remaining in the same view state as long as the current request is not an Ajax request.
		    	This is useful after form validation failure.
		    	Hitting Refresh or Back won't result in browser warnings.
				Hence this behavior is usually desirable.
				However a new flow execution attribute makes it possible to disable it and that may also be necessary in some cases specific to JSF applications.
				See <a class="xref" href="#spring-faces-redirect-in-same-state" title="13.7.&nbsp;Redirect In Same State">Section&nbsp;13.7, &#8220;Redirect In Same State&#8221;</a>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-samples" href="#whatsnew-samples"></a>2.3.7.&nbsp;Samples</h3></div></div></div>
			
			<p>
				The process for building the samples included with the distribution has been simplified.
				Maven can be used to build all samples in one step.
				Eclipse settings include source code references to simplify debugging.
			</p>
			<p>
				Additional samples can be accessed as follows:
</p><pre class="programlisting">mkdir spring-samples
cd spring-samples
svn co https://src.springframework.org/svn/spring-samples/webflow-primefaces-showcase
cd webflow-primefaces-showcase
mvn package
# import into Eclipse
</pre><p>

</p><pre class="programlisting">mkdir spring-samples
cd spring-samples
svn co https://src.springframework.org/svn/spring-samples/webflow-showcase
cd webflow-showcase
mvn package
# import into Eclipse
</pre><p>
			</p>
		</div>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-swf-220" href="#whatsnew-swf-220"></a>2.4.&nbsp;Spring Web Flow 2.2</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-jsf2" href="#whatsnew-jsf2"></a>2.4.1.&nbsp;JSF 2 Support</h3></div></div></div>
			
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e180" href="#d5e180"></a>Comprehensive JSF 2 Support</h4></div></div></div>
				
				<p>
					Building on 2.1, Spring Web Flow version 2.2 adds support for core JSF 2 features
					The following features that were not supported in 2.1 are now available:
					partial state saving, JSF 2 resource request, handling, and JSF 2 Ajax requests.
					At this point support for JSF 2 is considered
					comprehensive although not covering every JSF 2 feature --
					excluded are mostly features that overlap with the core value Web Flow provides
					such as those relating to navigation and state management.
				</p>
				<p>
					See <a class="xref" href="#spring-faces-webflow-config" title="13.3.&nbsp;Configuring Web Flow for use with JSF">Section&nbsp;13.3, &#8220;Configuring Web Flow for use with JSF&#8221;</a> for important configuration changes.
					Note that partial state saving is only supported with Sun Mojarra 2.0.3 or later.
					It is not yet supported with Apache MyFaces. This is due to the
					fact MyFaces was not as easy to customize with regards to how component state is stored.
					We will work with Apache MyFaces to provide this support. In the mean time you will need to use
					the <code class="code">javax.faces.PARTIAL_STATE_SAVING</code> context parameter in <code class="code">web.xml</code>
					to disable partial state saving with Apache MyFaces.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e187" href="#d5e187"></a>Travel Sample With the PrimeFaces Components</h4></div></div></div>
				
				<p>
					The main Spring Travel sample demonstrating Spring Web Flow and JSF support
					is now built on JSF 2 and components from the PrimeFaces component library.
					Please check out the booking-faces sample in the distribution.
				</p>
				<p>
					Additional samples can be found at the Spring Web Flow - Prime Faces
					<a class="ulink" href="https://src.springframework.org/svn/spring-samples/webflow-primefaces-showcase" target="_top">
						Showcase</a>, an SVN repository within the
						<a class="ulink" href="https://src.springframework.org/svn/spring-samples" target="_top">spring-samples</a>
						repository. Use these commands to check out and build:
				</p>
	<pre class="programlisting">svn co https://src.springframework.org/svn/spring-samples/webflow-primefaces-showcase
	cd webflow-primefaces-showcase
	mvn package
	</pre>

			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-sec" href="#whatsnew-sec"></a>2.4.2.&nbsp;Spring Security Facelets Tag Library</h3></div></div></div>
			
			<p>
				A new Spring Security tag library is available for use with with JSF 2.0 or with JSF 1.2 Facelets views.
				It provides an &lt;authorize&gt; tag as well as several EL functions.
				See <a class="xref" href="#spring-faces-security-taglib" title="13.9.&nbsp;Using the Spring Security Facelets Tag Library">Section&nbsp;13.9, &#8220;Using the Spring Security Facelets Tag Library&#8221;</a> for more details.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-versions" href="#whatsnew-versions"></a>2.4.3.&nbsp;Spring JavaScript Updates</h3></div></div></div>
			
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e200" href="#d5e200"></a>Deprecated ResourcesServlet</h4></div></div></div>
				
				<p>
					Starting with Spring 3.0.4, the Spring Framework includes
					a replacement for the ResourcesServlet. Please see
					the Spring Framework documentation for details on the custom mvc namespace,
					specifically the new
					<a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/mvc.html#mvc-static-resources" target="_top">"resources"</a>
					element.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e204" href="#d5e204"></a>Dojo 1.5 and dojox</h4></div></div></div>
				
				<p>
					The bundled custom Dojo build is upgraded to version 1.5. It now includes dojox.
				</p>
				<p>
					Note that applications are generally encouraged to prepare their own custom
					Dojo build for optimized performance depending on what parts of Dojo are
					commonly used together. For examples see the
					<a class="ulink" href="https://src.springframework.org/svn/spring-webflow/branches/spring-webflow-2.2-maintenance/spring-js-resources/scripts/dojo" target="_top">scripts</a>
					used by Spring Web Flow to prepare its own custom Dojo build.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e209" href="#d5e209"></a>Two Spring JS artifacts</h4></div></div></div>
				
				<p>
					The <code class="code">spring-js</code> artifact has been split in two -- the new artifact
					(<code class="code">spring-js-resources</code>) contains client side resource (.js, .css, etc.) while
					the existing artifact (<code class="code">spring-js</code>) contains server-side Java code only.
				</p>
				<p>
					Applications preparing their own custom Dojo build have an option now to
					avoid including <code class="code">spring-js-resources</code> and put <code class="code">Spring.js</code> and
					<code class="code">Spring-Dojo.js</code> directly under the root of their web application.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e219" href="#d5e219"></a>Client resources moved into META-INF/web-resources</h4></div></div></div>
				
				<p>
					Bundled client resources (.js, .css, etc.)
					have been moved to <code class="code">META-INF/web-resources</code> from their previous location
					under <code class="code">META-INF</code>. This change is transparent for applications but will result
					in simpler and safer configuration when using the new resource handling
					mechanism available in Spring 3.0.4.
				</p>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="whatsnew-jsf-portlet" href="#whatsnew-jsf-portlet"></a>2.4.4.&nbsp;JSF Portlet Support</h3></div></div></div>
			
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="d5e226" href="#d5e226"></a>Portlet API 2.0 and JSF 1.2 support</h4></div></div></div>
				
				<p>
					In previous versions of Spring Web Flow support for JSF Portlets relied on
					a Portlet Bridge for JSF implementation and was considered experimental.
					Spring Web Flow 2.2 adds support for JSF Portlets based on its own internal
					Portlet integration targeting Portlet API 2.0 and JSF 1.2 environments.
					See <a class="xref" href="#">???</a> for more details.
					The Spring Web Flow Travel JSF Portlets sample has been successfully
					tested on the Apache Pluto portal container.
				</p>
			</div>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="defining-flows" href="#defining-flows"></a>3.&nbsp;Defining Flows</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="defining-flows-introduction" href="#defining-flows-introduction"></a>3.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter begins the Users Section.
			It shows how to implement flows using the flow definition language.
			By the end of this chapter you should have a good understanding of language constructs, and be capable of authoring a flow definition.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-overview" href="#flow-overview"></a>3.2.&nbsp;What is a flow?</h2></div></div></div>
		
		<p>
			A flow encapsulates a reusable sequence of steps that can execute in different contexts.
			Below is a <a class="ulink" href="http://www.jjg.net/ia/visvocab/" target="_top">Garrett Information Architecture</a> diagram illustrating a reference to a flow that encapsulates the steps of a hotel booking process:
		</p>
		<div class="mediaobject" align="center"><img src="images/hotels-site.png" align="middle"><div class="caption">
				<p>Site Map illustrating a reference to a flow</p>
			</div></div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-makeup" href="#flow-makeup"></a>3.3.&nbsp;What is the makeup of a typical flow?</h2></div></div></div>
		
		<p>
			In Spring Web Flow, a flow consists of a series of steps called "states".
			Entering a state typically results in a view being displayed to the user.
			On that view, user events occur that are handled by the state.
			These events can trigger transitions to other states which result in view navigations.
		</p>
		<p>
			The example below shows the structure of the book hotel flow referenced in the previous diagram:
		</p>
		<div class="mediaobject" align="center"><img src="images/hotels-site-bookhotel-flow.png" align="middle"><div class="caption">
				<p>Flow diagram</p>
			</div></div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-authoring" href="#flow-authoring"></a>3.4.&nbsp;How are flows authored?</h2></div></div></div>
		
		<p>
			Flows are authored by web application developers using a simple XML-based flow definition language.
			The next steps of this guide will walk you through the elements of this language.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="essential-flow-elements" href="#essential-flow-elements"></a>3.5.&nbsp;Essential language elements</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-element" href="#flow-element"></a>3.5.1.&nbsp;flow</h3></div></div></div>
			
			<p>
				Every flow begins with the following root element:
			</p>
			<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				All states of the flow are defined within this element.
				The first state defined becomes the flow's starting point.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-state-element" href="#view-state-element"></a>3.5.2.&nbsp;view-state</h3></div></div></div>
			
			<p>
				Use the <code class="code">view-state</code> element to define a step of the flow that renders a view:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				By convention, a view-state maps its id to a view template in the directory where the flow is located.
				For example, the state above might render <code class="filename">/WEB-INF/hotels/booking/enterBookingDetails.xhtml</code>
				if the flow itself was located in the <code class="filename">/WEB-INF/hotels/booking</code> directory.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="transition-element" href="#transition-element"></a>3.5.3.&nbsp;transition</h3></div></div></div>
			
			<p>
				Use the <code class="code">transition</code> element to handle events that occur within a state:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
			<p>
				These transitions drive view navigations.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="end-state-element" href="#end-state-element"></a>3.5.4.&nbsp;end-state</h3></div></div></div>
			
			<p>
				Use the <code class="code">end-state</code> element to define a flow outcome:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				When a flow transitions to a end-state it terminates and the outcome is returned.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-essential-language-elements" href="#checkpoint-essential-language-elements"></a>3.5.5.&nbsp;Checkpoint: Essential language elements</h3></div></div></div>
			
			<p>
				With the three elements <code class="code">view-state</code>, <code class="code">transition</code>, and <code class="code">end-state</code>, you can quickly express your view navigation logic.
				Teams often do this before adding flow behaviors so they can focus on developing the user interface of the application with end users first.
				Below is a sample flow that implements its view navigation logic using these elements:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-actions" href="#flow-actions"></a>3.6.&nbsp;Actions</h2></div></div></div>
		
		<p>
			Most flows need to express more than just view navigation logic.
			Typically they also need to invoke business services of the application or other actions.
		</p>
		<p>
			Within a flow, there are several points where you can execute actions.  These points are:
			</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>On flow start</p></li><li class="listitem"><p>On state entry</p></li><li class="listitem"><p>On view render</p></li><li class="listitem"><p>On transition execution</p></li><li class="listitem"><p>On state exit</p></li><li class="listitem"><p>On flow end</p></li></ul></div><p>
		</p>
		<p>
			Actions are defined using a concise expression language.  Spring Web Flow uses the Unified EL by default.
			The next few sections will cover the essential language elements for defining actions.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="evaluate-element" href="#evaluate-element"></a>3.6.1.&nbsp;evaluate</h3></div></div></div>
			
			<p>
				The action element you will use most often is the <code class="code">evaluate</code> element.
				Use the <code class="code">evaluate</code> element to evaluate an expression at a point within your flow.
				With this single tag you can invoke methods on Spring beans or any other flow variable.
				For example:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"entityManager.persist(booking)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="evaluate-element-result" href="#evaluate-element-result"></a>Assigning an evaluate result</h4></div></div></div>
				
				<p>
					If the expression returns a value, that value can be saved in the flow's data model called <code class="code">flowScope</code>:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotels"</span><span class="hl-tag"> /&gt;</span>
				</pre>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="evaluate-element-result-type" href="#evaluate-element-result-type"></a>Converting an evaluate result</h4></div></div></div>
				
				<p>
					If the expression returns a value that may need to be converted, specify the desired type using the <code class="code">result-type</code> attribute:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotels"</span>
          <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag">/&gt;</span>
				</pre>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-actions" href="#checkpoint-actions"></a>3.6.2.&nbsp;Checkpoint: flow actions</h3></div></div></div>
			
			<p>
				Now review the sample booking flow with actions added:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;on-start&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-start&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				This flow now creates a Booking object in flow scope when it starts.
				The id of the hotel to book is obtained from a flow input attribute.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inputoutput" href="#flow-inputoutput"></a>3.7.&nbsp;Input/Output Mapping</h2></div></div></div>
		
		<p>
			Each flow has a well-defined input/output contract.
			Flows can be passed input attributes when they start, and can return output attributes when they end.
			In this respect, calling a flow is conceptually similar to calling a method with the following signature:
		</p>
		<pre class="programlisting">
FlowOutcome flowId(Map&lt;String, Object&gt; inputAttributes);
		</pre>
		<p>
			... where a <code class="code">FlowOutcome</code> has the following signature:
		</p>
		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FlowOutcome {
   <span class="hl-keyword">public</span> String getName();
   <span class="hl-keyword">public</span> Map&lt;String, Object&gt; getOutputAttributes();
}
		</pre>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="input-element" href="#input-element"></a>3.7.1.&nbsp;input</h3></div></div></div>
			
			<p>
				Use the <code class="code">input</code> element to declare a flow input attribute:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				Input values are saved in flow scope under the name of the attribute.
				For example, the input above would be saved under the name <code class="code">hotelId</code>.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-type" href="#input-element-type"></a>Declaring an input type</h4></div></div></div>
				
				<p>
					Use the <code class="code">type</code> attribute to declare the input attribute's type:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					If an input value does not match the declared type, a type conversion will be attempted.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-value" href="#input-element-value"></a>Assigning an input value</h4></div></div></div>
				
				<p>
					Use the <code class="code">value</code> attribute to specify an expression to assign the input value to:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"flowScope.myParameterObject.hotelId"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					If the expression's value type can be determined, that metadata will be used for type coersion if no <code class="code">type</code> attribute is specified.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-required" href="#input-element-required"></a>Marking an input as required</h4></div></div></div>
				
				<p>
					Use the <code class="code">required</code> attribute to enforce the input is not null or empty:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"flowScope.hotelId"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
				</pre>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="output-element" href="#output-element"></a>3.7.2.&nbsp;output</h3></div></div></div>
			
			<p>
				Use the <code class="code">output</code> element to declare a flow output attribute.
				Output attributes are declared within end-states that represent specific flow outcomes.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/end-state&gt;</span>
			</pre>
			<p>
				Output values are obtained from flow scope under the name of the attribute.
				For example, the output above would be assigned the value of the <code class="code">bookingId</code> variable.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="output-element-value" href="#output-element-value"></a>Specifying the source of an output value</h4></div></div></div>
				
				<p>
					Use the <code class="code">value</code> attribute to denote a specific output value expression:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"confirmationNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.confirmationNumber"</span><span class="hl-tag"> /&gt;</span>
				</pre>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-input-output" href="#checkpoint-input-output"></a>3.7.3.&nbsp;Checkpoint: input/output mapping</h3></div></div></div>
			
			<p>
				Now review the sample booking flow with input/output mapping:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;on-start&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-start&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> &gt;</span>
        <span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.id"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/end-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				The flow now accepts a <code class="code">hotelId</code> input attribute and returns a <code class="code">bookingId</code> output attribute
				when a new booking is confirmed.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-variables" href="#flow-variables"></a>3.8.&nbsp;Variables</h2></div></div></div>
		
		<p>
			A flow may declare one or more instance variables.
			These variables are allocated when the flow starts.
			Any <code class="code">@Autowired</code> transient references the variable holds are also rewired when the flow resumes.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="var-element" href="#var-element"></a>3.8.1.&nbsp;var</h3></div></div></div>
			
			<p>
				Use the <code class="code">var</code> element to declare a flow variable:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span><span class="hl-tag">/&gt;</span>
			</pre>
			<p>
				Make sure your variable's class implements <code class="code">java.io.Serializable</code>, as the instance state is saved between flow requests.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scopes" href="#scopes"></a>3.9.&nbsp;Variable Scopes</h2></div></div></div>
		
		<p>
			Web Flow can store variables in one of several scopes: 
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e398" href="#d5e398"></a>3.9.1.&nbsp;Flow Scope</h3></div></div></div>
			
			<p>
				Flow scope gets allocated when a flow starts and destroyed when the flow ends.
				With the default implementation, any objects stored in flow scope need to be Serializable.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e401" href="#d5e401"></a>3.9.2.&nbsp;View Scope</h3></div></div></div>
			
			<p>
				View scope gets allocated when a <code class="code">view-state</code> enters and destroyed when the state exits.
				View scope is <span class="emphasis"><em>only</em></span> referenceable from within a <code class="code">view-state</code>.  With the
                default implementation, any objects stored in view scope need to be Serializable.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e407" href="#d5e407"></a>3.9.3.&nbsp;Request Scope</h3></div></div></div>
			
			<p>
				Request scope gets allocated when a flow is called and destroyed when the flow returns.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e410" href="#d5e410"></a>3.9.4.&nbsp;Flash Scope</h3></div></div></div>
			
			<p>
				Flash scope gets allocated when a flow starts, cleared after every view render, and destroyed when the
                flow ends.  With the default implementation, any objects stored in flash scope need to be Serializable.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e413" href="#d5e413"></a>3.9.5.&nbsp;Conversation Scope</h3></div></div></div>
			
			<p>
				Conversation scope gets allocated when a top-level flow starts and destroyed when the top-level flow ends.
				Conversation scope is shared by a top-level flow and all of its subflows.  With the default
                implementation, conversation scoped objects are stored in the HTTP session and should generally be
                Serializable to account for typical session replication.
			</p>
		</div>		
		<p>
			The scope to use is often determined contextually, for example depending on where a
			variable is defined -- at the start of the flow definition (flow scope), inside a
			a view state (view scope), etc. In other cases, for example in EL expressions and
			Java code, it needs to be specified explicitly. Subsequent sections explain
			how this is done.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="calling-subflows" href="#calling-subflows"></a>3.10.&nbsp;Calling subflows</h2></div></div></div>
		
		<p>
			A flow may call another flow as a subflow.  The flow will wait until the subflow returns, then respond to the subflow outcome.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="subflow-state-element" href="#subflow-state-element"></a>3.10.1.&nbsp;subflow-state</h3></div></div></div>
			
			<p>
				Use the <code class="code">subflow-state</code> element to call another flow as a subflow:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/transition&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"creationCancelled"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/subflow-state&gt;</span>
			</pre>
			<p>
				The above example calls the <code class="code">createGuest</code> flow, then waits for it to return.
				When the flow returns with a <code class="code">guestCreated</code> outcome, the new guest is added to the booking's guest list.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="subflow-state-element-input" href="#subflow-state-element-input"></a>Passing a subflow input</h4></div></div></div>
				
				<p>
					Use the <code class="code">input</code> element to pass input to the subflow:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/subflow-state&gt;</span>
				</pre>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="subflow-state-element-output" href="#subflow-state-element-output"></a>Mapping subflow output</h4></div></div></div>
				
				<p>
					When a subflow completes, its end-state id is returned to the calling flow as
					the event to use to continue navigation.
				</p>
				<p>
					The subflow can also create output attributes to which the calling flow can refer
					within an outcome transition as follows:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
				</pre>
				<p>
					In the above example, <code class="code">guest</code> is the name of an output attribute returned by the <code class="code">guestCreated</code> outcome.
				</p>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-subflow" href="#checkpoint-subflow"></a>3.10.2.&nbsp;Checkpoint: calling subflows</h3></div></div></div>
			
			<p>
				Now review the sample booking flow calling a subflow:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;on-start&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-start&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"addGuest"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/transition&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"creationCancelled"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/subflow-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> &gt;</span>
        <span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.id"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/end-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				The flow now calls a <code class="code">createGuest</code> subflow to add a new guest to the guest list.
			</p>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="el" href="#el"></a>4.&nbsp;Expression Language (EL)</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-introduction" href="#el-introduction"></a>4.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			Web Flow uses EL to access its data model and to invoke actions.
			This chapter will familiarize you with EL syntax, configuration, and special EL variables you can reference from your flow definition.
		</p>
		<p>
			EL is used for many things within a flow including:
		</p>
		<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Access client data such as declaring flow inputs or referencing request parameters.</p></li><li class="listitem"><p>Access data in Web Flow's <code class="code">RequestContext</code> such as <code class="code">flowScope</code> or <code class="code">currentEvent</code>.</p></li><li class="listitem"><p>Invoke methods on Spring-managed objects through actions.</p></li><li class="listitem"><p>Resolve expressions such as state transition criteria, subflow ids, and view names.</p></li></ol></div>
 		<p>
 			EL is also used to bind form parameters to model objects and reversely to render formatted form fields from the properties of a model object.
 			That however does not apply when using Web Flow with JSF in which case the standard JSF component lifecyle applies.
 		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-types" href="#el-types"></a>4.1.1.&nbsp;Expression types</h3></div></div></div>
			
			<p>
				An important concept to understand is there are two types of expressions in Web Flow: standard expressions and template expressions.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="el-types-eval" href="#el-types-eval"></a>Standard Expressions</h4></div></div></div>
				
				<p>
					The first and most common type of expression is the <span class="emphasis"><em>standard expression</em></span>.
					Such expressions are evaluated directly by the EL and need not be enclosed in delimiters like <code class="code">#{}</code>.
					For example:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					The expression above is a standard expression that invokes the <code class="code">nextPage</code> method on the <code class="code">searchCriteria</code> variable when evaluated.
					If you attempt to enclose this expression in a special delimiter like <code class="code">#{}</code> you will get an <code class="code">IllegalArgumentException</code>.
					In this context the delimiter is seen as redundant.
					The only acceptable value for the <code class="code">expression</code> attribute is an single expression string.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="el-types-template" href="#el-types-template"></a>Template expressions</h4></div></div></div>
				
				<p>
					The second type of expression is a <span class="emphasis"><em>template expression</em></span>.
					A template expression allows mixing of literal text with one or more standard expressions.
					Each standard expression block is explicitly surrounded with the <code class="code">#{}</code> delimiters.
					For example:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"error"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"error-#{externalContext.locale}.xhtml"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					The expression above is a template expression.
					The result of evaluation will be a string that concatenates literal text such as <code class="code">error-</code> and <code class="code">.xhtml</code> with the result of evaluating <code class="code">externalContext.locale</code>.
					As you can see, explicit delimiters are necessary here to demarcate standard expression blocks within the template.
				</p>
				<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
					<p>
						See the Web Flow XML schema for a complete listing of those XML attributes that accept standard expressions and those that accept template expressions.
						You can also use F2 in Eclipse (or equivalent shortcut in other IDEs) to access available documentation when typing out specific flow definition attributes.
					</p>
				</td></tr></table></div>
			</div>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-language-choices" href="#el-language-choices"></a>4.2.&nbsp;EL Implementations</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-spring-el" href="#el-spring-el"></a>4.2.1.&nbsp;Spring EL</h3></div></div></div>
			
			<p>
				Web Flow uses the <a class="ulink" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html" target="_top">Spring Expression Language</a> (Spring EL).
				Spring EL was created to provide a single, well-supported expression language for use across all the products in the Spring portfolio.
				It is distributed as a separate jar <code class="code">org.springframework.expression</code> in the Spring Framework.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-unified-el" href="#el-unified-el"></a>4.2.2.&nbsp;Unified EL</h3></div></div></div>
			
			<p>
				Use of <a class="ulink" href="http://en.wikipedia.org/wiki/Unified_Expression_Language" target="_top">Unified EL</a>
				also implies a dependency on <code class="code">el-api</code> although that is typically <span class="emphasis"><em>provided</em></span>
				by your web container.
				Although Spring EL is the default and recommended expression language to use,
				it is possible to replace it with Unified EL if you wish to do so.
				You need the following Spring configuration to plug in the <code class="code">WebFlowELExpressionParser</code> to the <code class="code">flow-builder-services</code>:
				</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.expression.el.WebFlowELExpressionParser"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jboss.el.ExpressionFactoryImpl"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
                </pre><p>
                Note that if your application is registering custom converters it's important to ensure the WebFlowELExpressionParser is configured with the conversion service that has those custom converters.
				</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.expression.el.WebFlowELExpressionParser"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jboss.el.ExpressionFactoryImpl"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"conversionService"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"somepackage.ApplicationConversionService"</span><span class="hl-tag">/&gt;</span>
                </pre><p>
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-portability" href="#el-portability"></a>4.3.&nbsp;EL portability</h2></div></div></div>
		
		<p>
			In general, you will find Spring EL and Unified EL to have a very similar syntax.
		</p>
		<p>
			Note however there are some advantages to Spring EL.
			For example Spring EL is closely integrated with the type conversion of Spring 3 and that allows you to take full advantage of its features.
			Specifically the automatic detection of generic types as well as the use of formatting annotations is currently supported with Spring EL only.
		</p>
		<p>
			There are some minor changes to keep in mind when upgrading to Spring EL from Unified EL as follows:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Expressions deliniated with <code class="code">${}</code> in flow definitions must be changed to <code class="code">#{}</code>.</p></li><li class="listitem"><p>Expressions testing the current event <code class="code">#{currentEvent == 'submit'}</code> must be changed to <code class="code">#{currentEvent.id == 'submit'}</code>.</p></li><li class="listitem">
					<p>
						Resolving properties such as <code class="code">#{currentUser.name}</code> may cause NullPointerException without any checks such as <code class="code">#{currentUser != null ? currentUser.name : null}</code>.
						A much better alternative though is the safe navigation operator <code class="code">#{currentUser?.name}</code>.
					</p>
				</li></ol></div><p>
			For more information on Spring EL syntax please refer to the <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/expressions.html#expressions-language-ref" target="_top">Language Reference</a> section in the Spring Documentation.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-variables" href="#el-variables"></a>4.4.&nbsp;Special EL variables</h2></div></div></div>
		
		<p>
			There are several implicit variables you may reference from within a flow.
			These variables are discussed in this section.
		</p>
		<p>
			Keep in mind this general rule.
			Variables referring to data scopes (flowScope, viewScope, requestScope, etc.) should only be used when assigning a new variable to one of the scopes.
		</p>
		<p>
			For example when assigning the result of the call to <code class="code">bookingService.findHotels(searchCriteria)</code> to a new variable called "hotels" you must prefix it with a scope variable in order to let Web Flow know where you want it stored:
			</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span> <span class="hl-attribute">...</span><span class="hl-tag"> &gt;</span>

	<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.SearchCriteria"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;on-render&gt;</span>
			<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/on-render&gt;</span>
	<span class="hl-tag">&lt;/view-state&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre><p>
			However when setting an existing variable such as "searchCriteria" in the example below, you reference the variable directly without prefixing it with any scope variables:
			</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span> <span class="hl-attribute">...</span><span class="hl-tag"> &gt;</span>

	<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.SearchCriteria"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"sort"</span><span class="hl-tag">&gt;</span>
			<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria.sortBy"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.sortBy"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;/view-state&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre><p>
		</p>
		<p>
			The following is the list of implicit variables you can reference within a flow definition:
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowScope" href="#el-variable-flowScope"></a>4.4.1.&nbsp;flowScope</h3></div></div></div>
			
			<p>
				Use <code class="code">flowScope</code> to assign a flow variable.
				Flow scope gets allocated when a flow starts and destroyed when the flow ends.  With the default
                implementation, any objects stored in flow scope need to be Serializable.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotel(hotelId)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotel"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-viewScope" href="#el-variable-viewScope"></a>4.4.2.&nbsp;viewScope</h3></div></div></div>
			
			<p>
				Use <code class="code">viewScope</code> to assign a view variable.
				View scope gets allocated when a <code class="code">view-state</code> enters and destroyed when the state exits.
				View scope is <span class="emphasis"><em>only</em></span> referenceable from within a <code class="code">view-state</code>.  With the
                default implementation, any objects stored in view scope need to be Serializable.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span>
              <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestScope" href="#el-variable-requestScope"></a>4.4.3.&nbsp;requestScope</h3></div></div></div>
			
			<p>
				Use <code class="code">requestScope</code> to assign a request variable.
				Request scope gets allocated when a flow is called and destroyed when the flow returns.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flashScope" href="#el-variable-flashScope"></a>4.4.4.&nbsp;flashScope</h3></div></div></div>
			
			<p>
				Use <code class="code">flashScope</code> to assign a flash variable.
				Flash scope gets allocated when a flow starts, cleared after every view render, and destroyed when the
                flow ends.  With the default implementation, any objects stored in flash scope need to be Serializable.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flashScope.statusMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"'Booking confirmed'"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-conversationScope" href="#el-variable-conversationScope"></a>4.4.5.&nbsp;conversationScope</h3></div></div></div>
			
			<p>
				Use <code class="code">conversationScope</code> to assign a conversation variable.
				Conversation scope gets allocated when a top-level flow starts and destroyed when the top-level flow ends.
				Conversation scope is shared by a top-level flow and all of its subflows.  With the default
                implementation, conversation scoped objects are stored in the HTTP session and should generally be
                Serializable to account for typical session replication.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotel(hotelId)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"conversationScope.hotel"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestParameters" href="#el-variable-requestParameters"></a>4.4.6.&nbsp;requestParameters</h3></div></div></div>
			
			<p>
				Use <code class="code">requestParameters</code> to access a client request parameter:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-currentEvent" href="#el-variable-currentEvent"></a>4.4.7.&nbsp;currentEvent</h3></div></div></div>
			
			<p>
				Use <code class="code">currentEvent</code> to access attributes of the current <code class="code">Event</code>:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-currentUser" href="#el-variable-currentUser"></a>4.4.8.&nbsp;currentUser</h3></div></div></div>
			
			<p>
				Use <code class="code">currentUser</code> to access the authenticated <code class="code">Principal</code>:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
          <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-messageContext" href="#el-variable-messageContext"></a>4.4.9.&nbsp;messageContext</h3></div></div></div>
			
			<p>
				Use <code class="code">messageContext</code> to access a context for retrieving and creating flow execution messages, including error and success messages.
				See the <code class="code">MessageContext</code> Javadocs for more information.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingValidator.validate(booking, messageContext)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-resourceBundle" href="#el-variable-resourceBundle"></a>4.4.10.&nbsp;resourceBundle</h3></div></div></div>
			
			<p>
				Use <code class="code">resourceBundle</code> to access a message resource.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flashScope.successMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"resourceBundle.successMessage"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestContext" href="#el-variable-requestContext"></a>4.4.11.&nbsp;flowRequestContext</h3></div></div></div>
			
			<p>
				Use <code class="code">flowRequestContext</code> to access the <code class="code">RequestContext</code> API, which is a representation of the current flow request.
				See the API Javadocs for more information.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowExecutionContext" href="#el-variable-flowExecutionContext"></a>4.4.12.&nbsp;flowExecutionContext</h3></div></div></div>
			
			<p>
				Use <code class="code">flowExecutionContext</code> to access the <code class="code">FlowExecutionContext</code> API, which is a representation of the current flow state.
				See the API Javadocs for more information.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowExecutionUrl" href="#el-variable-flowExecutionUrl"></a>4.4.13.&nbsp;flowExecutionUrl</h3></div></div></div>
			
			<p>
				Use <code class="code">flowExecutionUrl</code> to access the context-relative URI for the current flow execution view-state.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-externalContext" href="#el-variable-externalContext"></a>4.4.14.&nbsp;externalContext</h3></div></div></div>
			
			<p>
				Use <code class="code">externalContext</code> to access the client environment, including user session attributes.
				See the <code class="code">ExternalContext</code> API JavaDocs for more information.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.suggestHotels(externalContext.sessionMap.userProfile)"</span>
          <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-scope-searching" href="#el-scope-searching"></a>4.5.&nbsp;Scope searching algorithm</h2></div></div></div>
		
		<p>
			As mentioned earlier in this section when assigning a variable in one of the flow scopes, referencing that scope is required.
			For example:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
		</pre>
		<p>
			When simply accessing a variable in one of the scopes, referencing the scope is optional.
			For example:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"entityManager.persist(booking)"</span><span class="hl-tag"> /&gt;</span>
		</pre>
		<p>
			When no scope is specified, like in the use of <code class="code">booking</code> above, a scope searching algorithm is used.
			The algorithm will look in request, flash, view, flow, and conversation scope for the variable.
			If no such variable is found, an <code class="code">EvaluationException</code> will be thrown.
		</p>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="views" href="#views"></a>5.&nbsp;Rendering views</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="views-introduction" href="#views-introduction"></a>5.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter shows you how to use the <code class="code">view-state</code> element to render views within a flow.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-convention" href="#view-convention"></a>5.2.&nbsp;Defining view states</h2></div></div></div>
		
		<p>
			Use the <code class="code">view-state</code> element to define a step of the flow that renders a view and waits for a user event to resume:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<p>
			By convention, a view-state maps its id to a view template in the directory where the flow is located.
			For example, the state above might render <code class="filename">/WEB-INF/hotels/booking/enterBookingDetails.xhtml</code>
			if the flow itself was located in the <code class="filename">/WEB-INF/hotels/booking</code> directory.
		</p>
		<p>
			Below is a sample directory structure showing views and other resources like message bundles co-located with their flow definition:
		</p>
		<div class="mediaobject" align="center"><img src="images/flow-view-packaging.png" align="middle"><div class="caption">
				<p>Flow Packaging</p>
			</div></div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-explicit" href="#view-explicit"></a>5.3.&nbsp;Specifying view identifiers</h2></div></div></div>
		
		<p>
			Use the <code class="code">view</code> attribute to specify the id of the view to render explicitly.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-flowrelative" href="#view-explicit-flowrelative"></a>5.3.1.&nbsp;Flow relative view ids</h3></div></div></div>
			
			<p>
				The view id may be a relative path to view resource in the flow's working directory:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"bookingDetails.xhtml"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-absolute" href="#view-explicit-absolute"></a>5.3.2.&nbsp;Absolute view ids</h3></div></div></div>
			
			<p>
				The view id may be a absolute path to a view resource in the webapp root directory:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"/WEB-INF/hotels/booking/bookingDetails.xhtml"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-logical" href="#view-explicit-logical"></a>5.3.3.&nbsp;Logical view ids</h3></div></div></div>
			
			<p>
				With some view frameworks, such as Spring MVC's view framework, the view id may also be a logical identifier resolved by the framework:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"bookingDetails"</span><span class="hl-tag">&gt;</span>
			</pre>
			<p>
				See the Spring MVC integration section for more information on how to integrate with the MVC <code class="code">ViewResolver</code> infrastructure.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-scope" href="#view-scope"></a>5.4.&nbsp;View scope</h2></div></div></div>
		
		<p>
			A view-state allocates a new <code class="code">viewScope</code> when it enters.
			This scope may be referenced within the view-state to assign variables that should live for the duration of the state.
			This scope is useful for manipulating objects over a series of requests from the same view, often Ajax requests.
			A view-state destroys its viewScope when it exits.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-var" href="#view-scope-var"></a>5.4.1.&nbsp;Allocating view variables</h3></div></div></div>
			
			<p>
				Use the <code class="code">var</code> tag to declare a view variable.
				Like a flow variable, any <code class="code">@Autowired</code> references are automatically restored when the view state resumes.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.SearchCriteria"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-actions" href="#view-scope-actions"></a>5.4.2.&nbsp;Assigning a viewScope variable</h3></div></div></div>
			
			<p>
				Use the <code class="code">on-render</code> tag to assign a variable from an action result before the view renders:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-ajax" href="#view-scope-ajax"></a>5.4.3.&nbsp;Manipulating objects in view scope</h3></div></div></div>
			
			<p>
				Objects in view scope are often manipulated over a series of requests from the same view.
				The following example pages through a search results list.
				The list is updated in view scope before each render.
				Asynchronous event handlers modify the current data page, then request re-rendering of the search results fragment.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchResults"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;on-render&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-render&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/transition&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"previous"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.previousPage()"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-on-render" href="#view-on-render"></a>5.5.&nbsp;Executing render actions</h2></div></div></div>
		
		<p>
			Use the <code class="code">on-render</code> element to execute one or more actions before view rendering.
			Render actions are executed on the initial render as well as any subsequent refreshes, including any partial re-renderings of the view.
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
	    </pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-model" href="#view-model"></a>5.6.&nbsp;Binding to a model</h2></div></div></div>
		
		<p>
			Use the <code class="code">model</code> attribute to declare a model object the view binds to.
			This attribute is typically used in conjunction with views that render data controls, such as forms.
			It enables form data binding and validation behaviors to be driven from metadata on your model object.
		</p>
		<p>
			The following example declares an <code class="code">enterBookingDetails</code> state manipulates the <code class="code">booking</code> model:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
	    </pre>
	    <p>
			The model may be an object in any accessible scope, such as <code class="code">flowScope</code> or <code class="code">viewScope</code>.
			Specifying a <code class="code">model</code> triggers the following behavior when a view event occurs:
		</p>
		<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>View-to-model binding.  On view postback, user input values are bound to model object properties for you.</p></li><li class="listitem"><p>Model validation.  After binding, if the model object requires validation that validation logic will be invoked.</p></li></ol></div>
		<p>
			For a flow event to be generated that can drive a view state transition, model binding must complete successfully.
			If model binding fails, the view is re-rendered to allow the user to revise their edits.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-type-conversion" href="#view-type-conversion"></a>5.7.&nbsp;Performing type conversion</h2></div></div></div>
		
		<p>
			When request parameters are used to populate the model (commonly referred to as data binding), type conversion is required to parse String-based request parameter values before setting target model properties.
			Default type conversion is available for many common Java types such as numbers, primitives, enums, and Dates.
			Users also have the ability to register their own type conversion logic for user-defined types, and to override the default Converters.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-options" href="#converter-options"></a>5.7.1.&nbsp;Type Conversion Options</h3></div></div></div>
			
			<p>
				Starting with version 2.1 Spring Web Flow uses the <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/validation.html#core-convert" target="_top">type conversion</a> and <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/validation.html#format" target="_top">formatting</a> system introduced in Spring 3 for nearly all type conversion needs.
				Previously Web Flow applications used a type conversion mechanism that was different from the one in Spring MVC, which relied on the <code class="code">java.beans.PropertyEditor</code> abstraction.
				Spring 3 offers a modern type conversion alternative to PropertyEditors that was actually influenced by Web Flow's own type conversion system.
				Hence Web Flow users should find it natural to work with the new Spring 3 type conversion.
				Another obvious and very important benefit of this change is that a single type conversion mechanism can now be used across Spring MVC And Spring Web Flow.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-upgrade-to-spring-3" href="#converter-upgrade-to-spring-3"></a>5.7.2.&nbsp;Upgrading to Spring 3 Type Conversion And Formatting</h3></div></div></div>
			
			<p>
				What does this practically mean for existing applications?
				Existing applications are likely registering their own converters of type <code class="code">org.springframework.binding.convert.converters.Converter</code> through a sub-class of <code class="code">DefaultConversionService</code> available in Spring Binding.
				Those converters can continue to be registered as before.
				They will be adapted as Spring 3 <code class="code">GenericConverter</code> types and registered with a Spring 3 <code class="code">org.springframework.core.convert.ConversionService</code> instance.
				In other words existing converters will be invoked through Spring's type conversion service.
			</p>
			<p>
				The only exception to this rule are named converters, which can be referenced from a <code class="code">binding</code> element in a <code class="code">view-state</code>:
				</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ApplicationConversionService <span class="hl-keyword">extends</span> DefaultConversionService {
    <span class="hl-keyword">public</span> ApplicationConversionService() {
        addDefaultConverters();
        addDefaultAliases();
        addConverter(<span class="hl-string">"customConverter"</span>, <span class="hl-keyword">new</span> CustomConverter());
    }
}
				</pre><p>
				</p><pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"customConverter"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
				</pre><p>
				Named converters are not supported and cannot be used with the type conversion service available in Spring 3.
				Therefore such converters will not be adapted and will continue to work as before, i.e. will not involve the Spring 3 type conversion.
				However, this mechanism is deprecated and applications are encouraged to favor Spring 3 type conversion and formatting features.
			</p>
			<p>
				Also note that the existing Spring Binding <code class="code">DefaultConversionService</code> no longer registers any default converters.
				Instead Web Flow now relies on the default type converters and formatters in Spring 3.
			</p>
			<p>
				In summary the Spring 3 type conversion and formatting is now used almost exclusively in Web Flow.
				Although existing applications will work without any changes, we encourage moving towards unifying the type conversion needs of Spring MVC and Spring Web Flow parts of applications.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-configuration" href="#converter-configuration"></a>5.7.3.&nbsp;Configuring Type Conversion and Formatting</h3></div></div></div>
			
			<p>
				In Spring MVC an instance of a <code class="code">FormattingConversionService</code> is created automatically through the custom MVC namespace:
				</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;mvc:annotation-driven/&gt;</span>

				</pre><p>
				Internally that is done with the help of <code class="code">FormattingConversionServiceFactoryBean</code>, which registers a default set of converters and formatters.
				You can customize the conversion service instance used in Spring MVC through the <code class="code">conversion-service</code> attribute:
				</p><pre class="programlisting">
<span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"applicationConversionService"</span><span class="hl-tag"> /&gt;</span>
				</pre><p>
			</p>
			<p>
				In Web Flow an instance of a Spring Binding <code class="code">DefaultConversionService</code> is created automatically, which does not register any converters.
				Instead it delegates to a <code class="code">FormattingConversionService</code> instance for all type conversion needs.
				By default this is not the same <code class="code">FormattingConversionService</code> instance as the one used in Spring 3.
				However that won't make a practical difference until you start registering your own formatters.
			</p>
			<p>
				The <code class="code">DefaultConversionService</code> used in Web Flow can be customized through the flow-builder-services element:
				</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"defaultConversionService"</span><span class="hl-tag"> /&gt;</span>
				</pre><p>
			</p>
			<p>
				Connecting the dots in order to register your own formatters for use in both Spring MVC and in Spring Web Flow you can do the following.
				Create a class to register your custom formatters:
				</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ApplicationConversionServiceFactoryBean <span class="hl-keyword">extends</span> FormattingConversionServiceFactoryBean {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> installFormatters(FormatterRegistry registry) {
        <span class="hl-comment">// ...</span>
    }

}

				</pre><p>
				Configure it for use in Spring MVC:
				</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"applicationConversionService"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-comment">&lt;!--
    	Alternatively if you prefer annotations for DI:
    	  1. Add @Component to the factory bean.
    	  2. Add a component-scan element (from the context custom namespace) here.
    	  3. Remove XML bean declaration below.
      --&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"applicationConversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"somepackage.ApplicationConversionServiceFactoryBean"</span><span class="hl-tag">&gt;</span>


				</pre><p>
				Connection the Web Flow <code class="code">DefaultConversionService</code> to the same "applicationConversionService" bean used in Spring MVC:
				</p><pre class="programlisting">
    <span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">...</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"defaultConversionService"</span> <span class="hl-attribute">...</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultConversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.binding.convert.service.DefaultConversionService"</span><span class="hl-tag">&gt;</span>
    	<span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"applicationConversionSevice"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
				</pre><p>
				Of course it is also possible to mix and match.
				Register new Spring 3 <code class="code">Formatter</code> types through the "applicationConversionService".
				Register existing Spring Binding <code class="code">Converter</code> types through the "defaultConversionService".
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-working-with" href="#converter-working-with"></a>5.7.4.&nbsp;Working With Spring 3 Type Conversion And Formatting</h3></div></div></div>
			
			<p>
				An important concept to understand is the difference between type converters and formatters.
			</p>
			<p>
				Type converters in Spring 3, provided in <code class="code">org.springframework.core</code>, are for general-purpose type conversion between any two object types.
				In addition to the most simple <code class="code">Converter</code> type, two other interfaces are <code class="code">ConverterFactory</code> and <code class="code">GenericConverter</code>.
			</p>
			<p>
				Formatters in Spring 3, provided in <code class="code">org.springframework.context</code>, have the more specialized purpose of representing Objects as Strings.
				The <code class="code">Formatter</code> interface extends the <code class="code">Printer</code> and <code class="code">Parser</code> interfaces for converting an Object to a String and turning a String into an Object.
			</p>
			<p>
				Web developers will find the <code class="code">Formatter</code> interface most relevant because it fits the needs of web applications for type conversion.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
					<p>
						An important point to be made is that Object-to-Object conversion is a generalization of the more specific Object-to-String conversion.
						In fact in the end <code class="code">Formatters</code> are reigstered as <code class="code">GenericConverter</code> types with Spring's <code class="code">GenericConversionService</code> making them equal to any other converter.
					</p>
				</td></tr></table></div><p>
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-formatting-annotations" href="#converter-formatting-annotations"></a>5.7.5.&nbsp;Formatting Annotations</h3></div></div></div>
			
			<p>
				One of the best features of the new type conversion is the ability to use annotations for a better control over formatting in a concise manner.
				Annotations can be placed on model attributes and on arguments of @Controller methods that are mapped to requests.
				Out of the box Spring provides two annotations <code class="code">NumberFormat</code> and <code class="code">DateTimeFormat</code> but you can create your own and have them registered along with the associated formatting logic.
				You can see examples of the <code class="code">DateTimeFormat</code> annotation in the <a class="ulink" href="https://src.springframework.org/svn/spring-samples/travel" target="_top">Spring Travel</a> and in the <a class="ulink" href="https://src.springframework.org/svn/spring-samples/petcare" target="_top">Petcare</a> along with other samples in the <a class="ulink" href="https://src.springframework.org/svn/spring-samples" target="_top">Spring Samples</a> repository.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-dates" href="#converter-dates"></a>5.7.6.&nbsp;Working With Dates</h3></div></div></div>
			
			<p>
				The <code class="code">DateTimeFormat</code> annotation implies use of <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">Joda Time</a>.
				If that is present on the classpath the use of this annotation is enabled automatically.
				By default neither Spring MVC nor Web Flow register any other date formatters or converters.
				Therefore it is important for applications to register a custom formatter to specify the default way for printing and parsing dates.
				The <code class="code">DateTimeFormat</code> annotation on the other hand provides more fine-grained control where it is necessary to deviate from the default.
			</p>
			<p>
				For more information on working with Spring 3 type conversion and formatting please refer to the relevant sections of the <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/index.html" target="_top">Spring documentation</a>.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-bind" href="#view-bind"></a>5.8.&nbsp;Suppressing binding</h2></div></div></div>
		
		<p>
			Use the <code class="code">bind</code> attribute to suppress model binding and validation for particular view events.
			The following example suppresses binding when the <code class="code">cancel</code> event occurs:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-binder" href="#view-binder"></a>5.9.&nbsp;Specifying bindings explicitly</h2></div></div></div>
		
		<p>
			Use the <code class="code">binder</code> element to configure the exact set of model properties to
			apply data binding to. This is useful to restrict the set of "allowed fields" per view.
			Not using this could lead to a security issue, depending on the application domain and actual users,
			since by default if the binder element is not specified all public properties of the model are
			eligible for data binding by the view. By contrast when the <code class="code">binder</code> element is specified,
			only the explicitly configured bindings are allowed. Below is an example:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>

		</pre>
		<p>
			Each binding may also apply a converter to format the model property value for display in a custom manner.
			If no converter is specified, the default converter for the model property's type will be used.
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkoutDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>

		</pre>
		<p>
			In the example above, the <code class="code">shortDate</code> converter is bound to the
			<code class="code">checkinDate</code> and <code class="code">checkoutDate</code> properties.
			Custom converters may be registered with the application's ConversionService.
		</p>
		<p>
			Each binding may also apply a required check that will generate a validation error
			if the user provided value is null on form postback:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkoutDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<p>
			In the example above, all of the bindings are required.
			If one or more blank input values are bound, validation errors will be generated and the view will re-render with those errors.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-validate" href="#view-validate"></a>5.10.&nbsp;Validating a model</h2></div></div></div>
		
		<p>
			Model validation is driven by constraints specified against a model object.
			Web Flow supports enforcing such constraints programatically as well as
			declaratively with JSR-303 Bean Validation annotations.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-jsr303" href="#view-validation-jsr303"></a>5.10.1.&nbsp;JSR-303 Bean Validation</h3></div></div></div>
			
			<p>
				Web Flow provides built-in support for the JSR-303 Bean Validation API
				building on equivalent support available in Spring MVC.
				To enable JSR-303 validation configure the flow-builder-services with
				Spring MVC's <code class="code">LocalValidatorFactoryBean</code>:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">validator</span>=<span class="hl-value">"validator"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"validator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span><span class="hl-tag"> /&gt;</span>
			</pre>

			<p>
				With the above in place, the configured validator will be applied to
				all model attributes after data binding.
			</p>

			<p>
				Note that JSR-303 bean validation and validation by convention
				(explained in the next section) are not mutually exclusive.
				In other words Web Flow will apply all available validation
				mechanisms.
			</p>

			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation-jsr303-partial" href="#view-validation-jsr303-partial"></a>Partial Validation</h4></div></div></div>
				
				<p>
					JSR-303 Bean Validation supports partial validation through validation groups. For example:

</p><pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@NotNull</span></em>
<em><span class="hl-annotation" style="color: gray">@Size(min = 2, max = 30, groups = State1.class)</span></em>
<span class="hl-keyword">private</span> String name;
</pre><p>
					In a flow definition you can specify validation hints on a view state
					or on a transition and those will be resolved to validation groups.
					For example:
</p><pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"state1"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"myModel"</span> <span class="hl-attribute">validation-hints</span>=<span class="hl-value">"'group1,group2'"</span><span class="hl-tag">&gt;</span>

</pre><p>
					The <span class="emphasis"><em>validation-hints</em></span> attribute is an expression
					that in the above example resolves to a comma-delimited String consisting
					of the hints "group1" and "group2". A <code class="classname">ValidationHintResolver</code>
					is used to resolve these hints. The <code class="classname">BeanValidationHintResolver</code>
					used by default tries to resolve these strings to Class-based bean validation
					groups. To do that it looks for matching inner types in the model or its parent.
				</p>
				<p>
					For example given <code class="classname">org.example.MyModel</code> with inner types
					<code class="classname">Group1</code> and <code class="classname">Group2</code> it is
					sufficient to supply the simple type names, i.e. "group1" and "group2".
					You can also provide fully qualified type names.
				</p>
				<p>
					A hint with the value "default" has a special meaning and is translated
					to the default validation group in Bean Validation
					<code class="classname">javax.validation.groups.Default</code>.
				</p>
				<p>
					A custom <code class="classname">ValidationHintResolver</code>
					can be configured if necessary through the validationHintResolver property
					of the flow-builder-services element:
			</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">validator</span>=<span class="hl-value">".."</span> <span class="hl-attribute">validation-hint-resolver</span>=<span class="hl-value">".."</span><span class="hl-tag"> /&gt;</span>
</pre><p>
				</p>
			</div>

		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-programmatic" href="#view-validation-programmatic"></a>5.10.2.&nbsp;Programmatic validation</h3></div></div></div>
			
			<p>
				There are two ways to perform model validation programatically.
				The first is to implement validation logic in your model object.
				The second is to implement an external <code class="code">Validator</code>.
				Both ways provide you with a <code class="code">ValidationContext</code> to record error messages and access information about the current user.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation-programmatic-validate-method" href="#view-validation-programmatic-validate-method"></a>Implementing a model validate method</h4></div></div></div>
				
				<p>
					Defining validation logic in your model object is the simplest way to validate its state.
					Once such logic is structured according to Web Flow conventions, Web Flow will automatically invoke that logic during the view-state postback lifecycle.
					Web Flow conventions have you structure model validation logic by view-state, allowing you to easily validate the subset of model properties that are editable on that view.
					To do this, simply create a public method with the name <code class="code">validate${state}</code>, where <code class="code">${state}</code> is the id of your view-state where you want validation to run.
					For example:
					</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Booking {
    <span class="hl-keyword">private</span> Date checkinDate;
    <span class="hl-keyword">private</span> Date checkoutDate;
    ...

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(ValidationContext context) {
        MessageContext messages = context.getMessageContext();
        <span class="hl-keyword">if</span> (checkinDate.before(today())) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkinDate"</span>).
                defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (!checkinDate.before(checkoutDate)) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkoutDate"</span>).
                defaultText(<span class="hl-string">"Check out date must be later than check in date"</span>).build());
        }
    }
}

					</pre><p>
				</p>
				<p>
					In the example above, when a transition is triggered in a <code class="code">enterBookingDetails</code> view-state that is editing a <code class="code">Booking</code> model,
					Web Flow will invoke the <code class="code">validateEnterBookingDetails(ValidationContext)</code> method automatically unless validation has been suppressed for that transition.
					An example of such a view-state is shown below:
					</p><pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
					</pre><p>
				</p>
				<p>
					Any number of validation methods are defined.  Generally, a flow edits a model over a series of views.  In that case, a validate method would be defined
					for each view-state where validation needs to run.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation-programmatic-validator" href="#view-validation-programmatic-validator"></a>Implementing a Validator</h4></div></div></div>
				
				<p>
					The second way is to define a separate object, called a <span class="emphasis"><em>Validator</em></span>, which validates your model object.
					To do this, first create a class whose name has the pattern ${model}Validator, where <code class="code">${model}</code> is the capitialized form of the model expression, such as <code class="code">booking</code>.
					Then define a public method with the name <code class="code">validate${state}</code>, where <code class="code">${state}</code> is the id of your view-state, such as <code class="code">enterBookingDetails</code>.
					The class should then be deployed as a Spring bean.  Any number of validation methods can be defined.
					For example:
				</p>
				<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(Booking booking, ValidationContext context) {
        MessageContext messages = context.getMessageContext();
        <span class="hl-keyword">if</span> (booking.getCheckinDate().before(today())) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkinDate"</span>).
                defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (!booking.getCheckinDate().before(booking.getCheckoutDate())) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkoutDate"</span>).
                defaultText(<span class="hl-string">"Check out date must be later than check in date"</span>).build());
        }
    }
}
				</pre>
				<p>
					In the example above, when a transition is triggered in a <code class="code">enterBookingDetails</code> view-state that is editing a <code class="code">Booking</code> model,
					Web Flow will invoke the <code class="code">validateEnterBookingDetails(Booking, ValidationContext)</code> method automatically unless validation has been suppressed for that transition.
				</p>
				<p>
					A Validator can also accept a Spring MVC <code class="code">Errors</code> object, which is required for invoking existing Spring Validators.
				</p>
				<p>
					Validators must be registered as Spring beans employing the naming convention <code class="code">${model}Validator</code> to be detected and invoked automatically.
					In the example above, Spring 2.5 classpath-scanning would detect the <code class="code">@Component</code> and automatically register it as a bean with the name <code class="code">bookingValidator</code>.
					Then, anytime the <code class="code">booking</code> model needs to be validated, this <code class="code">bookingValidator</code> instance would be invoked for you.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="default-validate-method" href="#default-validate-method"></a>Default validate method</h4></div></div></div>
				
				<p>
					A <span class="emphasis"><em>Validator</em></span> class can also define a method called <code class="code">validate</code> not associated (by convention) with any specific view-state.
				</p>
				<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Booking booking, ValidationContext context) {
        <span class="hl-comment">//...</span>
    }
}
				</pre>
				<p>
					In the above code sample the method <code class="code">validate</code> will be called every time a Model of type <code class="code">Booking</code> is validated (unless validation has been suppressed for that transition).
					If needed the default method can also be called in addition to an existing state-specific method. Consider the following example:
				</p>
				<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Booking booking, ValidationContext context) {
        <span class="hl-comment">//...</span>
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(Booking booking, ValidationContext context) {
        <span class="hl-comment">//...</span>
    }
}
				</pre>
				<p>
					In above code sample the method <code class="code">validateEnterBookingDetails</code> will be called first.
					The default <code class="code">validate</code> method will be called next.
				</p>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-context" href="#view-validation-context"></a>5.10.3.&nbsp;ValidationContext</h3></div></div></div>
			
			<p>
				A ValidationContext allows you to obtain a <code class="code">MessageContext</code> to record messages during validation.
				It also exposes information about the current user, such as the signaled <code class="code">userEvent</code> and the current user's <code class="code">Principal</code> identity.
				This information can be used to customize validation logic based on what button or link was activated in the UI, or who is authenticated.
				See the API Javadocs for <code class="code">ValidationContext</code> for more information.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-validation-suppression" href="#view-validation-suppression"></a>5.11.&nbsp;Suppressing validation</h2></div></div></div>
		
		<p>
			Use the <code class="code">validate</code> attribute to suppress model validation for particular view events:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"chooseAmenities"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"back"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">validate</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<p>
			In this example, data binding will still occur on <code class="code">back</code> but validation will be suppressed.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-transitions" href="#view-transitions"></a>5.12.&nbsp;Executing view transitions</h2></div></div></div>
		
		<p>
			Define one or more <code class="code">transition</code> elements to handle user events that may occur on the view.
			A transition may take the user to another view, or it may simply execute an action and re-render the current view.
			A transition may also request the rendering of parts of a view called "fragments" when handling an Ajax event.
			Finally, "global" transitions that are shared across all views may also be defined.
		</p>
		<p>
			Implementing view transitions is illustrated in the following sections.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="transition-actions" href="#transition-actions"></a>5.12.1.&nbsp;Transition actions</h3></div></div></div>
			
			<p>
				A view-state transition can execute one or more actions before executing.
				These actions may return an error result to prevent the transition from exiting the
				current view-state. If an error result occurs, the view will re-render and should display
				an appropriate message to the user.
			</p>
			<p>
				If the transition action invokes a plain Java method, the invoked method may return a boolean
				whose value, true or false, indicates whether the transition should take place or be prevented
				from executing. A method may also return a String where the literal values "success", "yes", or
				"true" indicate the transition should occur, and any other value means the opposite.
				This technique can be used to handle exceptions thrown by service-layer methods.
				The example below invokes an action that calls a service and handles an exceptional situation:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingAction.makeBooking(booking, messageContext)"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingAction {
   <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> makeBooking(Booking booking, MessageContext context) {
       <span class="hl-keyword">try</span> {
           bookingService.make(booking);
           <span class="hl-keyword">return</span> true;
       } <span class="hl-keyword">catch</span> (RoomNotAvailableException e) {
           context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().
               .defaultText(<span class="hl-string">"No room is available at this hotel"</span>).build());
           <span class="hl-keyword">return</span> false;
       }
   }
}
			</pre>
			<p>
				When there is more than one action defined on a transition, if one returns an error result the
				remaining actions in the set will <span class="emphasis"><em>not</em></span> be executed. If you need to ensure one
				transition action's result cannot impact the execution of another, define a single transition
				action that invokes a method that encapsulates all the action logic.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="event-handlers-global" href="#event-handlers-global"></a>5.12.2.&nbsp;Global transitions</h3></div></div></div>
			
			<p>
				Use the flow's <code class="code">global-transitions</code> element to create transitions that apply across all views.
				Global-transitions are often used to handle global menu links that are part of the layout.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;global-transitions&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"login"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"login"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"logout"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"logout"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/global-transitions&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="simple-event-handlers" href="#simple-event-handlers"></a>5.12.3.&nbsp;Event handlers</h3></div></div></div>
			
			<p>
				From a view-state, transitions without targets can also be defined.  Such transitions are called "event handlers":
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"event"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- Handle event --&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>
			<p>
				These event handlers do not change the state of the flow.
				They simply execute their actions and re-render the current view or one or more fragments of the current view.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="event-handlers-render" href="#event-handlers-render"></a>5.12.4.&nbsp;Rendering fragments</h3></div></div></div>
			
			<p>
				Use the <code class="code">render</code> element within a transition to request partial re-rendering of the current view after handling the event:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>
			<p>
				The fragments attribute should reference the id(s) of the view element(s) you wish to re-render.
				Specify multiple elements to re-render by separating them with a comma delimiter.
			</p>
			<p>
				Such partial rendering is often used with events signaled by Ajax to update a specific zone of the view.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-messages" href="#view-messages"></a>5.13.&nbsp;Working with messages</h2></div></div></div>
		
		<p>
			Spring Web Flow's <code class="code">MessageContext</code> is an API for recording messages during the course of flow executions.
			Plain text messages can be added to the context, as well as internationalized messages resolved by a Spring <code class="code">MessageSource</code>.
			Messages are renderable by views and automatically survive flow execution redirects.
			Three distinct message severities are provided: <code class="code">info</code>, <code class="code">warning</code>, and <code class="code">error</code>.
			In addition, a convenient <code class="code">MessageBuilder</code> exists for fluently constructing messages.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="plain-text-message" href="#plain-text-message"></a>5.13.1.&nbsp;Adding plain text messages</h3></div></div></div>
			
			<pre class="programlisting">
MessageContext context = ...
MessageBuilder builder = <span class="hl-keyword">new</span> MessageBuilder();
context.addMessage(builder.error().source(<span class="hl-string">"checkinDate"</span>)
    .defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
context.addMessage(builder.warn().source(<span class="hl-string">"smoking"</span>)
    .defaultText(<span class="hl-string">"Smoking is bad for your health"</span>).build());
context.addMessage(builder.info()
    .defaultText(<span class="hl-string">"We have processed your reservation - thank you and enjoy your stay"</span>).build());
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="plain-text-message-intl" href="#plain-text-message-intl"></a>5.13.2.&nbsp;Adding internationalized messages</h3></div></div></div>
			
			<pre class="programlisting">
MessageContext context = ...
MessageBuilder builder = <span class="hl-keyword">new</span> MessageBuilder();
context.addMessage(builder.error().source(<span class="hl-string">"checkinDate"</span>).code(<span class="hl-string">"checkinDate.notFuture"</span>).build());
context.addMessage(builder.warn().source(<span class="hl-string">"smoking"</span>).code(<span class="hl-string">"notHealthy"</span>)
    .resolvableArg(<span class="hl-string">"smoking"</span>).build());
context.addMessage(builder.info().code(<span class="hl-string">"reservationConfirmation"</span>).build());
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="message-bundles" href="#message-bundles"></a>5.13.3.&nbsp;Using message bundles</h3></div></div></div>
			
			<p>
				Internationalized messages are defined in message bundles accessed by a Spring <code class="code">MessageSource</code>.
				To create a flow-specific message bundle, simply define <code class="code">messages.properties</code> file(s) in your flow's directory.
				Create a default <code class="code">messages.properties</code> file and a .properties file for each additional <code class="code">Locale</code> you need to support.
			</p>
			<pre class="programlisting">
#messages.properties
checkinDate=Check in date must be a future date
notHealthy={0} is bad for your health
reservationConfirmation=We have processed your reservation - thank you and enjoy your stay
			</pre>
			<p>
				From within a view or a flow, you may also access message resources using the <code class="code">resourceBundle</code> EL variable:
			</p>
			<pre class="programlisting">
&lt;h:outputText value="#{resourceBundle.reservationConfirmation}" /&gt;
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="message-generation" href="#message-generation"></a>5.13.4.&nbsp;Understanding system generated messages</h3></div></div></div>
			
			<p>
				There are several places where Web Flow itself will generate messages to display to the user.
				One important place this occurs is during view-to-model data binding.
				When a binding error occurs, such as a type conversion error, Web Flow will map that error to a message retrieved from your resource bundle automatically.
				To lookup the message to display, Web Flow tries resource keys that contain the binding error code and target property name.
			</p>
			<p>
				As an example, consider a binding to a <code class="code">checkinDate</code> property of a <code class="code">Booking</code> object.
				Suppose the user typed in a alphabetic string.
				In this case, a type conversion error will be raised.
				Web Flow will map the 'typeMismatch' error code to a message by first querying your resource bundle for a message with the following key:
			</p>
			<pre class="programlisting">
booking.checkinDate.typeMismatch
			</pre>
			<p>
				The first part of the key is the model class's short name.
				The second part of the key is the property name. The third part is the error code.
				This allows for the lookup of a unique message to display to the user when a binding fails on a model property.
				Such a message might say:
			</p>
			<pre class="programlisting">
booking.checkinDate.typeMismatch=The check in date must be in the format yyyy-mm-dd.
			</pre>
			<p>
				If no such resource key can be found of that form, a more generic key will be tried.
				This key is simply the error code.  The field name of the property is provided as a message argument.
			</p>
			<pre class="programlisting">
typeMismatch=The {0} field is of the wrong type.
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-popup" href="#view-popup"></a>5.14.&nbsp;Displaying popups</h2></div></div></div>
		
		<p>
			Use the <code class="code">popup</code> attribute to render a view in a modal popup dialog:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
		</pre>
		<p>
			When using Web Flow with the Spring Javascript, no client side code is necessary for the popup to display.
			Web Flow will send a response to the client requesting a redirect to the view from a popup, and the client will honor the request.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-backtracking" href="#view-backtracking"></a>5.15.&nbsp;View backtracking</h2></div></div></div>
		
		<p>
			By default, when you exit a view state and transition to a new view state, you can go back to the previous state using the browser back button.
			These view state history policies are configurable on a per-transition basis by using the <code class="code">history</code> attribute.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="history-discard" href="#history-discard"></a>5.15.1.&nbsp;Discarding history</h3></div></div></div>
			
			<p>
				Set the history attribute to <code class="code">discard</code> to prevent backtracking to a view:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">history</span>=<span class="hl-value">"discard"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="history-invalidate" href="#history-invalidate"></a>5.15.2.&nbsp;Invalidating history</h3></div></div></div>
			
			<p>
				Set the history attribute to <code class="code">invalidate</code> to prevent backtracking to a view as well all previously displayed views:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> <span class="hl-attribute">history</span>=<span class="hl-value">"invalidate"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="actions" href="#actions"></a>6.&nbsp;Executing actions</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-introduction" href="#actions-introduction"></a>6.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter shows you how to use the <code class="code">action-state</code> element to control the execution of an action at a point within a flow.
			It will also show how to use the <code class="code">decision-state</code> element to make a flow routing decision.
			Finally, several examples of invoking actions from the various points possible within a flow will be discussed.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-state" href="#action-state"></a>6.2.&nbsp;Defining action states</h2></div></div></div>
		
		<p>
			Use the <code class="code">action-state</code> element when you wish to invoke an action, then transition to another state based on the action's outcome:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"answerQuestions"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"no"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/action-state&gt;</span>
		</pre>
		<p>
			The full example below illustrates a interview flow that uses the action-state above to determine if more answers are needed to complete the interview:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
	  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
						  http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;on-start&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interviewFactory.createInterview()"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.interview"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-start&gt;</span>

	<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"answerQuestions"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"questionSet"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;on-entry&gt;</span>
			<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.getNextQuestionSet()"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.questionSet"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/on-entry&gt;</span>
		<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submitAnswers"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"moreAnswersNeeded"</span><span class="hl-tag">&gt;</span>
			<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.recordAnswers(questionSet)"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;/view-state&gt;</span>

	<span class="hl-tag">&lt;action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"answerQuestions"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"no"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/action-state&gt;</span>

	<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"finish"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
		<p>
			After the execution of each action, the action-state checks the result to see if matches a declared
			transition to another state. That means if more than one action is configured they are executed in
			an ordered chain until one returns a result event that matches a state transition out of the
			action-state while the rest are ignored. This is a form of the Chain of Responsibility (CoR) pattern.
		</p>
		<p>
			The result of an action's execution is typically the criteria for a transition out of this state.
			Additional information in the current RequestContext may also be tested as part of custom
			transitional criteria allowing for sophisticated transition expressions that reason on contextual
			state.
		</p>
		<p>
			Note also that an action-state just like any other state can have one more on-entry actions
			that are executed as a list from start to end.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="decision-state" href="#decision-state"></a>6.3.&nbsp;Defining decision states</h2></div></div></div>
		
		<p>
			Use the <code class="code">decision-state</code> element as an alternative to the action-state to make a routing decision using a convenient if/else syntax.
			The example below shows the <code class="code">moreAnswersNeeded</code> state above now implemented as a decision state instead of an action-state:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;decision-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;if</span> <span class="hl-attribute">test</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span> <span class="hl-attribute">then</span>=<span class="hl-value">"answerQuestions"</span> <span class="hl-attribute">else</span>=<span class="hl-value">"finish"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/decision-state&gt;</span>
			</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-outcome-events" href="#action-outcome-events"></a>6.4.&nbsp;Action outcome event mappings</h2></div></div></div>
		
		<p>
			Actions often invoke methods on plain Java objects.
			When called from action-states and decision-states, these method return values can be used to drive state transitions.
			Since transitions are triggered by events, a method return value must first be mapped to an Event object.
			The following table describes how common return value types are mapped to Event objects:
		</p>
		<div class="table"><a name="event-mapping-table" href="#event-mapping-table"></a><p class="title"><b>Table&nbsp;6.1.&nbsp;Action method return value to event id mappings</b></p><div class="table-contents">
			
			<table summary="Action method return value to event id mappings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="Method return type"><col class="Event identifier"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">Method return type</th><th style="border-bottom: 0.5pt solid ; ">Mapped Event identifier expression</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">java.lang.String</td><td style="border-bottom: 0.5pt solid ; ">the String value</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">java.lang.Boolean</td><td style="border-bottom: 0.5pt solid ; ">yes (for true), no (for false)</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">java.lang.Enum</td><td style="border-bottom: 0.5pt solid ; ">the Enum name</td></tr><tr><td style="border-right: 0.5pt solid ; ">any other type</td><td style="">success</td></tr></tbody></table>
		</div></div><br class="table-break">
		<p>
			This is illustrated in the example action state below, which invokes a method that returns a boolean value:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"answerQuestions"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"no"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/action-state&gt;</span>
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-implementations" href="#action-implementations"></a>6.5.&nbsp;Action implementations</h2></div></div></div>
		
		<p>
			While writing action code as POJO logic is the most common, there are several other action implementation options.
			Sometimes you need to write action code that needs access to the flow context.
			You can always invoke a POJO and pass it the flowRequestContext as an EL variable.
			Alternatively, you may implement the <code class="code">Action</code> interface or extend from the <code class="code">MultiAction</code> base class.
			These options provide stronger type safety when you have a natural coupling between your action code and Spring Web Flow APIs.
			Examples of each of these approaches are shown below.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1045" href="#d5e1045"></a>6.5.1.&nbsp;Invoking a POJO action</h3></div></div></div>
			
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"pojoAction.method(flowRequestContext)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PojoAction {
	<span class="hl-keyword">public</span> String method(RequestContext context) {
		...
	}
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1049" href="#d5e1049"></a>6.5.2.&nbsp;Invoking a custom Action implementation</h3></div></div></div>
			
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"customAction"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomAction <span class="hl-keyword">implements</span> Action {
	<span class="hl-keyword">public</span> Event execute(RequestContext context) {
		...
	}
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1053" href="#d5e1053"></a>6.5.3.&nbsp;Invoking a MultiAction implementation</h3></div></div></div>
			
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"multiAction.actionMethod1"</span><span class="hl-tag"> /&gt;</span>

			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomMultiAction <span class="hl-keyword">extends</span> MultiAction {
	<span class="hl-keyword">public</span> Event actionMethod1(RequestContext context) {
		...
	}

	<span class="hl-keyword">public</span> Event actionMethod2(RequestContext context) {
		...
	}

	...
}
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-exceptions" href="#action-exceptions"></a>6.6.&nbsp;Action exceptions</h2></div></div></div>
		
		<p>
			Actions often invoke services that encapsulate complex business logic.
			These services may throw business exceptions that the action code should handle.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1060" href="#d5e1060"></a>6.6.1.&nbsp;Handling a business exception with a POJO action</h3></div></div></div>
			
			<p>
				The following example invokes an action that catches a business exception, adds a error message to the context, and returns a result event identifier.
				The result is treated as a flow event which the calling flow can then respond to.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingAction.makeBooking(booking, flowRequestContext)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingAction {
<span class="hl-keyword">public</span> String makeBooking(Booking booking, RequestContext context) {
	   <span class="hl-keyword">try</span> {
		   BookingConfirmation confirmation = bookingService.make(booking);
		   context.getFlowScope().put(<span class="hl-string">"confirmation"</span>, confirmation);
		   <span class="hl-keyword">return</span> <span class="hl-string">"success"</span>;
	   } <span class="hl-keyword">catch</span> (RoomNotAvailableException e) {
		   context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().
			   .defaultText(<span class="hl-string">"No room is available at this hotel"</span>).build());
		   <span class="hl-keyword">return</span> <span class="hl-string">"error"</span>;
	   }
}
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1065" href="#d5e1065"></a>6.6.2.&nbsp;Handling a business exception with a MultiAction</h3></div></div></div>
			
			<p>
				The following example is functionally equivlant to the last, but implemented as a MultiAction instead of a POJO action.
				The MultiAction requires its action methods to be of the signature <code class="code">Event ${methodName}(RequestContext)</code>, providing stronger type safety, while a POJO action allows for more freedom.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingAction.makeBooking"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingAction <span class="hl-keyword">extends</span> MultiAction {
<span class="hl-keyword">public</span> Event makeBooking(RequestContext context) {
	   <span class="hl-keyword">try</span> {
		   Booking booking = (Booking) context.getFlowScope().get(<span class="hl-string">"booking"</span>);
		   BookingConfirmation confirmation = bookingService.make(booking);
		   context.getFlowScope().put(<span class="hl-string">"confirmation"</span>, confirmation);
		   <span class="hl-keyword">return</span> success();
	   } <span class="hl-keyword">catch</span> (RoomNotAvailableException e) {
		   context.getMessageContext().addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().
			   .defaultText(<span class="hl-string">"No room is available at this hotel"</span>).build());
		   <span class="hl-keyword">return</span> error();
	   }
}
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1071" href="#d5e1071"></a>6.6.3.&nbsp;Using an exception-handler element</h3></div></div></div>
			
			<p>
				In general it is recommended to catch exceptions in actions and return result
				events that drive standard transitions, it is also possible to add an
				<code class="code">exception-handler</code> sub-element to any state type with a
				<code class="code">bean</code> attribute referencing a bean of type
				<code class="classname">FlowExecutionExceptionHandler</code>. This is an advanced
				option that if used incorrectly can leave the flow execution in an invalid state.
				Consider the build-in <code class="classname">TransitionExecutingFlowExecutionExceptionHandler</code>
				as example of a correct implementation. 
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-examples" href="#action-examples"></a>6.7.&nbsp;Other Action execution examples</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-start" href="#action-on-start"></a>6.7.1.&nbsp;on-start</h3></div></div></div>
			
			<p>
				The following example shows an action that creates a new Booking object by invoking a method on a service:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
	  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
						  http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-tag">&lt;on-start&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
				  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-start&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-state-entry" href="#action-on-state-entry"></a>6.7.2.&nbsp;on-entry</h3></div></div></div>
			
			<p>
				The following example shows a state entry action that sets the special <code class="code">fragments</code> variable that causes the view-state to render a partial fragment of its view:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-entry&gt;</span>
		<span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotelSearchForm"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-entry&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-state-exit" href="#action-on-state-exit"></a>6.7.3.&nbsp;on-exit</h3></div></div></div>
			
			<p>
				The following example shows a state exit action that releases a lock on a record being edited:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"editOrder"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-entry&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.selectForUpdate(orderId, currentUser)"</span>
				  <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.order"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-entry&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"save"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.update(order, currentUser)"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;on-exit&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.releaseLock(order, currentUser)"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-exit&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="on-end" href="#on-end"></a>6.7.4.&nbsp;on-end</h3></div></div></div>
			
			<p>
				The following example shows the equivalent object locking behavior using flow start and end actions:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
	  <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	  <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
						  http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"orderId"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-tag">&lt;on-start&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.selectForUpdate(orderId, currentUser)"</span>
				  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.order"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-start&gt;</span>

	<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"editOrder"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"save"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span><span class="hl-tag">&gt;</span>
			<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.update(order, currentUser)"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;/view-state&gt;</span>

	<span class="hl-tag">&lt;on-end&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.releaseLock(order, currentUser)"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-end&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-render" href="#action-on-render"></a>6.7.5.&nbsp;on-render</h3></div></div></div>
			
			<p>
				The following example shows a render action that loads a list of hotels to display before the view is rendered:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-render&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
				  <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-render&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"select"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotel"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowScope.hotel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"hotels.selectedRow"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-transition" href="#action-on-transition"></a>6.7.6.&nbsp;on-transition</h3></div></div></div>
			
			<p>
				The following example shows a transition action adds a subflow outcome event attribute to a collection:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guestList.add(currentEvent.attributes.newGuest)"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/subfow-state&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="named-actions" href="#named-actions"></a>6.7.7.&nbsp;Named actions</h3></div></div></div>
			
			<p>
				The following example shows how to execute a chain of actions in an action-state.
				The name of each action becomes a qualifier for the action's result event.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"doTwoThings"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"service.thingOne()"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"thingOne"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/evaluate&gt;</span>
	<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"service.thingTwo()"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"thingTwo"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/evaluate&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"thingTwo.success"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"showResults"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/action-state&gt;</span>
			</pre>
			<p>
				In this example, the flow will transition to <code class="code">showResults</code> when <code class="code">thingTwo</code>
				completes successfully.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="streaming-actions" href="#streaming-actions"></a>6.7.8.&nbsp;Streaming actions</h3></div></div></div>
			
			<p>
				Sometimes an Action needs to stream a custom response back to the client.
				An example might be a flow that renders a PDF document when handling a print event.
				This can be achieved by having the action stream the content then record "Response Complete" status on the ExternalContext.
				The responseComplete flag tells the pausing view-state not to render the response because another object has taken care of it.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewItinerary"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"print"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"printBoardingPassAction"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PrintBoardingPassAction <span class="hl-keyword">extends</span> AbstractAction {
	<span class="hl-keyword">public</span> Event doExecute(RequestContext context) {
		<span class="hl-comment">// stream PDF content here...</span>
		<span class="hl-comment">// - Access HttpServletResponse by calling context.getExternalContext().getNativeResponse();</span>
		<span class="hl-comment">// - Mark response complete by calling context.getExternalContext().recordResponseComplete();</span>
		<span class="hl-keyword">return</span> success();
	}
}
			</pre>
			<p>
				In this example, when the print event is raised the flow will call the printBoardingPassAction.
				The action will render the PDF then mark the response as complete.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="file-upload" href="#file-upload"></a>6.7.9.&nbsp;Handling File Uploads</h3></div></div></div>
			
			<p>
				Another common task is to use Web Flow to handle multipart file uploads in combination with Spring MVC's
				<code class="code">MultipartResolver</code>.  Once the resolver is set up correctly <a class="ulink" href="http://static.springsource.org/spring/docs/2.5.x/reference/mvc.html#mvc-multipart" target="_top">as described here</a> and the submitting
				HTML form is configured with <code class="code">enctype="multipart/form-data"</code>, you can easily handle the file upload in a
				transition action.
			</p>
			<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
				<p>
					The file upload example below below is not relevant when using Web Flow with JSF. See
					<a class="xref" href="#spring-faces-file-upload" title="13.8.&nbsp;Handling File Uploads with JSF">Section&nbsp;13.8, &#8220;Handling File Uploads with JSF&#8221;</a> for details of how to upload files using JSF.
				</p>
			</td></tr></table></div>
			<p>
				Given a form such as:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;form:form</span> <span class="hl-attribute">modelAttribute</span>=<span class="hl-value">"fileUploadHandler"</span> <span class="hl-attribute">enctype</span>=<span class="hl-value">"multipart/form-data"</span><span class="hl-tag">&gt;</span>
	Select file: <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"file"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"file"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_upload"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Upload"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span>
			</pre>
			<p>
				and a backing object for handling the upload such as:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">package</span> org.springframework.webflow.samples.booking;

<span class="hl-keyword">import</span> org.springframework.web.multipart.MultipartFile;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadHandler {

	<span class="hl-keyword">private</span> <span class="hl-keyword">transient</span> MultipartFile file;

	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processFile() {
		<span class="hl-comment">//Do something with the MultipartFile here</span>
	}

	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(MultipartFile file) {
		<span class="hl-keyword">this</span>.file = file;
	}
}
			</pre>
			<p>
				you can process the upload using a transition action as in the following example:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"uploadFile"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"uploadFileHandler"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fileUploadHandler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.FileUploadHandler"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"upload"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span><span class="hl-tag"> &gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"fileUploadHandler.processFile()"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
			<p>
				The <code class="code">MultipartFile</code> will be bound to the <code class="code">FileUploadHandler</code> bean as
				part of the normal form binding process so that it will be available to process during the
				execution of the transition action.
			</p>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="flow-managed-persistence" href="#flow-managed-persistence"></a>7.&nbsp;Flow Managed Persistence</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-managed-persistence-introduction" href="#flow-managed-persistence-introduction"></a>7.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			Most applications access data in some way.
			Many modify data shared by multiple users and therefore require transactional data access properties.
			They often transform relational data sets into domain objects to support application processing.
			Web Flow offers "flow managed persistence" where a flow can create, commit, and close a object persistence context for you.
			Web Flow integrates both Hibernate and JPA object persistence technologies.
		</p>
		<p>
			Apart from flow-managed persistence, there is the pattern of fully encapsulating PersistenceContext management within the service layer of your application.
			In that case, the web layer does not get involved with persistence, instead it works entirely with detached objects that are passed to and returned by your service layer.
			This chapter will focus on the flow-managed persistence, exploring how and when to use this feature.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flowScopedPersistenceContext" href="#flowScopedPersistenceContext"></a>7.2.&nbsp;FlowScoped PersistenceContext</h2></div></div></div>
		
		<p>
			This pattern creates a <code class="code">PersistenceContext</code> in <code class="code">flowScope</code> on flow startup,
			uses that context for data access during the course of flow execution, and commits changes made to persistent entities at the end.
			This pattern provides isolation of intermediate edits by only committing changes to the database at the end of flow execution.
			This pattern is often used in conjunction with an optimistic locking strategy to protect the integrity of data modified in parallel by multiple users.
			To support saving and restarting the progress of a flow over an extended period of time, a durable store for flow state must be used.
			If a save and restart capability is not required, standard HTTP session-based storage of flow state is sufficient.
			In that case, session expiration or termination before commit could potentially result in changes being lost.
		</p>
		<p>
			To use the FlowScoped PersistenceContext pattern, first mark your flow as a <code class="code">persistence-context</code>:
		</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;persistence-context /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
</pre>
		<p>
			Then configure the correct <code class="code">FlowExecutionListener</code> to apply this pattern to your flow.
			If using Hibernate, register the <code class="code">HibernateFlowExecutionListener</code>.  If using JPA, register the <code class="code">JpaFlowExecutionListener</code>.
		</p>
<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-execution-listeners&gt;</span>
        <span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jpaFlowExecutionListener"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/webflow:flow-execution-listeners&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-executor&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jpaFlowExecutionListener"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.persistence.JpaFlowExecutionListener"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"entityManagerFactory"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
</pre>
		<p>
			To trigger a commit at the end, annotate your end-state with the commit attribute:
		</p>
		<p>
</p><pre class="programlisting">
<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span> <span class="hl-attribute">commit</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
</pre><p>
		</p>
		<p>
			That is it.  When your flow starts, the listener will handle allocating a new <code class="code">EntityManager</code> in <code class="code">flowScope</code>.
			Reference this EntityManager at anytime from within your flow by using the special <code class="code">persistenceContext</code> variable.
			In addition, any data access that occurs using a Spring managed data access object will use this EntityManager automatically.
			Such data access operations should always execute non transactionally or in read-only transactions to maintain isolation of intermediate edits.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-managed-persistence-propagation" href="#flow-managed-persistence-propagation"></a>7.3.&nbsp;Flow Managed Persistence And Sub-Flows</h2></div></div></div>
		
		<p>
			A flow managed <code class="code">PersistenceContext</code> is automatically extended
			(propagated) to subflows assuming the subflow also has the <code class="code">&lt;perstistence-context/&gt;</code>
			variable. When a subflow re-uses the <code class="code">PersistenceContext</code> started by its parent it ignores
			commit flags when an end state is reached thereby deferring the final decision (to commit or not) to
			its parent.
		</p>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="flow-security" href="#flow-security"></a>8.&nbsp;Securing Flows</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-introduction" href="#flow-security-introduction"></a>8.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			Security is an important concept for any application.
			End users should not be able to access any portion of a site simply by guessing the URL.
			Areas of a site that are sensitive must ensure that only authorized requests are processed.
			Spring Security is a proven security platform that can integrate with your application at multiple levels.
			This section will focus on securing flow execution.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-how-to" href="#flow-security-how-to"></a>8.2.&nbsp;How do I secure a flow?</h2></div></div></div>
		
		<p>
			Securing flow execution is a three step process:
			</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Configure Spring Security with authentication and authorization rules</p></li><li class="listitem"><p>Annotate the flow definition with the secured element to define the security rules</p></li><li class="listitem"><p>Add the SecurityFlowExecutionListener to process the security rules.</p></li></ul></div><p>
		</p>
		<p>
			Each of these steps must be completed or else flow security rules will not be applied.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-secured-element" href="#flow-security-secured-element"></a>8.3.&nbsp;The secured element</h2></div></div></div>
		
		<p>
			The secured element designates that its containing element should apply the authorization check before fully entering.
			This may not occur more then once per stage of the flow execution that is secured.
		</p>
		<p>
			Three phases of flow execution can be secured: flows, states and transitions.
			In each case the syntax for the secured element is identical.
			The secured element is located inside the element it is securing.
			For example, to secure a state the secured element occurs directly inside that state:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"secured-view"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;secured</span> <span class="hl-attribute">attributes</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    ...
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-secured-element-attributes" href="#flow-security-secured-element-attributes"></a>8.3.1.&nbsp;Security attributes</h3></div></div></div>
			
			<p>
				The <code class="code">attributes</code> attribute is a comma separated list of Spring Security authorization attributes.
				Often, these are specific security roles.
				The attributes are compared against the user's granted attributes by a Spring Security access decision manager.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;secured</span> <span class="hl-attribute">attributes</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				By default, a role based access decision manager is used to determine if the user is allowed access.
				This will need to be overridden if your application is not using authorization roles.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-secured-element-match" href="#flow-security-secured-element-match"></a>8.3.2.&nbsp;Matching type</h3></div></div></div>
			
			<p>
				There are two types of matching available: <code class="code">any</code> and <code class="code">all</code>.
				Any, allows access if at least one of the required security attributes is granted to the user.
				All, allows access only if each of the required security attributes are granted to the user.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;secured</span> <span class="hl-attribute">attributes</span>=<span class="hl-value">"ROLE_USER, ROLE_ANONYMOUS"</span> <span class="hl-attribute">match</span>=<span class="hl-value">"any"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				This attribute is optional.
				If not defined, the default value is <code class="code">any</code>.
			</p>
			<p>
				The <code class="code">match</code> attribute will only be respected if the default access decision manager is used.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-listener" href="#flow-security-listener"></a>8.4.&nbsp;The SecurityFlowExecutionListener</h2></div></div></div>
		
		<p>
			Defining security rules in the flow by themselves will not protect the flow execution.
			A <code class="code">SecurityFlowExecutionListener</code> must also be defined in the webflow configuration and applied to the flow executor.
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-execution-listeners&gt;</span>
        <span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityFlowExecutionListener"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/webflow:flow-execution-listeners&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-executor&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityFlowExecutionListener"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.security.SecurityFlowExecutionListener"</span><span class="hl-tag"> /&gt;</span>
		</pre>
		<p>
			If access is denied to a portion of the application an <code class="code">AccessDeniedException</code> will be thrown.
			This exception will later be caught by Spring Security and used to prompt the user to authenticate.
			It is important that this exception be allowed to travel up the execution stack uninhibited, otherwise the end user may not be prompted to authenticate.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-listener-adm" href="#flow-security-listener-adm"></a>8.4.1.&nbsp;Custom Access Decision Managers</h3></div></div></div>
			
			<p>
				If your application is using authorities that are not role based, you will need to configure a custom <code class="code">AccessDecisionManager</code>.
				You can override the default decision manager by setting the <code class="code">accessDecisionManager</code> property on the security listener.
				Please consult the <a class="ulink" href="http://static.springframework.org/spring-security/site/reference.html" target="_top">Spring Security reference documentation</a> to learn more about decision managers.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityFlowExecutionListener"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.security.SecurityFlowExecutionListener"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accessDecisionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myCustomAccessDecisionManager"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-configuration" href="#flow-security-configuration"></a>8.5.&nbsp;Configuring Spring Security</h2></div></div></div>
		
		<p>
			Spring Security has robust configuration options available.
			As every application and environment has its own security requirements, the <a class="ulink" href="http://static.springframework.org/spring-security/site/reference.html" target="_top">Spring Security reference documentation</a> is the best place to learn the available options.
		</p>
		<p>
			Both the <code class="code">booking-faces</code> and <code class="code">booking-mvc</code> sample applications are configured to use Spring Security.
			Configuration is needed at both the Spring and web.xml levels.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-configuration-spring" href="#flow-security-configuration-spring"></a>8.5.1.&nbsp;Spring configuration</h3></div></div></div>
			
			<p>
				The Spring configuration defines <code class="code">http</code> specifics (such as protected URLs and login/logout mechanics) and the <code class="code">authentication-provider</code>.
				For the sample applications, a local authentication provider is configured.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;security:http</span> <span class="hl-attribute">auto-config</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;security:form-login</span> <span class="hl-attribute">login-page</span>=<span class="hl-value">"/spring/login"</span>
                         <span class="hl-attribute">login-processing-url</span>=<span class="hl-value">"/spring/loginProcess"</span>
                         <span class="hl-attribute">default-target-url</span>=<span class="hl-value">"/spring/main"</span>
                         <span class="hl-attribute">authentication-failure-url</span>=<span class="hl-value">"/spring/login?login_error=1"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;security:logout</span> <span class="hl-attribute">logout-url</span>=<span class="hl-value">"/spring/logout"</span> <span class="hl-attribute">logout-success-url</span>=<span class="hl-value">"/spring/logout-success"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/security:http&gt;</span>

<span class="hl-tag">&lt;security:authentication-provider&gt;</span>
    <span class="hl-tag">&lt;security:password-encoder</span> <span class="hl-attribute">hash</span>=<span class="hl-value">"md5"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;security:user-service&gt;</span>
        <span class="hl-tag">&lt;security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keith"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"417c7382b16c395bc25b5da1398cf076"</span>
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER,ROLE_SUPERVISOR"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"erwin"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"12430911a8af075c6f41c6976af22b09"</span>
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER,ROLE_SUPERVISOR"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jeremy"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"57c6cbff0d421449be820763f03139eb"</span>
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"scott"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"942f2339bf50796de535a384f0d1af3e"</span>
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/security:user-service&gt;</span>
<span class="hl-tag">&lt;/security:authentication-provider&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-configuration-web" href="#flow-security-configuration-web"></a>8.5.2.&nbsp;web.xml Configuration</h3></div></div></div>
			
			<p>
				In the <code class="code">web.xml</code> file, a <code class="code">filter</code> is defined to intercept all requests.
				This filter will listen for login/logout requests and process them accordingly.
				It will also catch <code class="code">AccesDeniedException</code>s and redirect the user to the login page.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;filter&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>

<span class="hl-tag">&lt;filter-mapping&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span>
			</pre>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="flow-inheritance" href="#flow-inheritance"></a>9.&nbsp;Flow Inheritance</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-introduction" href="#flow-inheritance-introduction"></a>9.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			Flow inheritance allows one flow to inherit the configuration of another flow.
			Inheritance can occur at both the flow and state levels.
			A common use case is for a parent flow to define global transitions and exception handlers, then each child flow can inherit those settings.
		</p>
		<p>
			In order for a parent flow to be found, it must be added to the <code class="code">flow-registry</code> just like any other flow.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-java-comparison" href="#flow-inheritance-java-comparison"></a>9.2.&nbsp;Is flow inheritance like Java inheritance?</h2></div></div></div>
		
		<p>
			Flow inheritance is similar to Java inheritance in that elements defined in a parent are exposed via the child, however, there are key differences.
		</p>
		<p>
			A child flow cannot override an element from a parent flow.
			Similar elements between the parent and child flows will be merged.
			Unique elements in the parent flow will be added to the child.
		</p>
		<p>
			A child flow can inherit from multiple parent flows.
			Java inheritance is limited to a single class.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-levels" href="#flow-inheritance-levels"></a>9.3.&nbsp;Types of Flow Inheritance</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-level-flow" href="#flow-inheritance-level-flow"></a>9.3.1.&nbsp;Flow level inheritance</h3></div></div></div>
			
			<p>
				Flow level inheritance is defined by the <code class="code">parent</code> attribute on the <code class="code">flow</code> element.
				The attribute contains a comma separated list of flow identifiers to inherit from.
				The child flow will inherit from each parent in the order it is listed adding elements and content to the resulting flow.
				The resulting flow from the first merge will be considered the child in the second merge, and so on.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"common-transitions, common-states"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-level-state" href="#flow-inheritance-level-state"></a>9.3.2.&nbsp;State level inheritance</h3></div></div></div>
			
			<p>
				State level inheritance is similar to flow level inheritance, except only one state inherits from the parent, instead of the entire flow.
			</p>
			<p>
				Unlike flow inheritance, only a single parent is allowed.
				Additionally, the identifier of the flow state to inherit from must also be defined.
				The identifiers for the flow and the state within that flow are separated by a #.
			</p>
			<p>
				The parent and child states must be of the same type.
				For instance a view-state cannot inherit from an end-state, only another view-state.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"child-state"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"parent-flow#parent-view-state"</span><span class="hl-tag">&gt;</span>
			</pre>
			<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
				<p>
					The intent for flow-level inheritance is to define common states to be
					added to and shared among multiple flow definitions while the intent
					for state-level inheritance is to extend from and merge with a single
					parent state. Flow-level inheritance is a good fit for composition
					and multiple inheritance but at the state level you can still only
					inherit from a single parent state.
				</p>
			</td></tr></table></div>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-abstract" href="#flow-inheritance-abstract"></a>9.4.&nbsp;Abstract flows</h2></div></div></div>
		
		<p>
			Often parent flows are not designed to be executed directly.
			In order to protect these flows from running, they can be marked as <code class="code">abstract</code>.
			If an abstract flow attempts to run, a <code class="code">FlowBuilderException</code> will be thrown.
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-algorithm" href="#flow-inheritance-algorithm"></a>9.5.&nbsp;Inheritance Algorithm</h2></div></div></div>
		
		<p>
			When a child flow inherits from it's parent, essentially what happens is that the parent and child are merged together to create a new flow.
			There are rules for every element in the Web Flow definition language that govern how that particular element is merged.
		</p>
		<p>
			There are two types of elements: <span class="emphasis"><em>mergeable</em></span> and <span class="emphasis"><em>non-mergeable</em></span>.
			Mergeable elements will always attempt to merge together if the elements are similar.
			Non-mergeable elements in a parent or child flow will always be contained in the resulting flow intact.
			They will not be modified as part of the merge process.
		</p>
		<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
			<p>
				Paths to external resources in the parent flow should be absolute.
				Relative paths will break when the two flows are merged unless the parent and child flow are in the same directory.
				Once merged, all relative paths in the parent flow will become relative to the child flow.
			</p>
		</td></tr></table></div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-algorithm-mergeable" href="#flow-inheritance-algorithm-mergeable"></a>9.5.1.&nbsp;Mergeable Elements</h3></div></div></div>
			
			<p>
				If the elements are of the same type and their keyed attribute are identical, the content of the parent element will be merged with the child element.
				The merge algorithm will continue to merge each sub-element of the merging parent and child.
				Otherwise the parent element is added as a new element to the child.
			</p>
			<p>
				In most cases, elements from a parent flow that are added will be added after elements in the child flow.
				Exceptions to this rule include action elements (evaluate, render and set) which will be added at the beginning.
				This allows for the results of parent actions to be used by child actions.
			</p>
			<p>
				Mergeable elements are:
				</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
						<p>action-state: id</p>
					</li><li class="listitem">
						<p>attribute: name</p>
					</li><li class="listitem">
						<p>decision-state: id</p>
					</li><li class="listitem">
						<p>end-state: id</p>
					</li><li class="listitem">
						<p>flow: always merges</p>
					</li><li class="listitem">
						<p>if: test</p>
					</li><li class="listitem">
						<p>on-end: always merges</p>
					</li><li class="listitem">
						<p>on-entry: always merges</p>
					</li><li class="listitem">
						<p>on-exit: always merges</p>
					</li><li class="listitem">
						<p>on-render: always merges</p>
					</li><li class="listitem">
						<p>on-start: always merges</p>
					</li><li class="listitem">
						<p>input: name</p>
					</li><li class="listitem">
						<p>output: name</p>
					</li><li class="listitem">
						<p>secured: attributes</p>
					</li><li class="listitem">
						<p>subflow-state: id</p>
					</li><li class="listitem">
						<p>transition: on and on-exception</p>
					</li><li class="listitem">
						<p>view-state: id</p>
					</li></ul></div><p>
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-nonmergeable" href="#flow-inheritance-nonmergeable"></a>9.5.2.&nbsp;Non-mergeable Elements</h3></div></div></div>
			
			<p>
				Non-mergeable elements are:
				</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
						<p>bean-import</p>
					</li><li class="listitem">
						<p>evaluate</p>
					</li><li class="listitem">
						<p>exception-handler</p>
					</li><li class="listitem">
						<p>persistence-context</p>
					</li><li class="listitem">
						<p>render</p>
					</li><li class="listitem">
						<p>set</p>
					</li><li class="listitem">
						<p>var</p>
					</li></ul></div><p>
			</p>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="system-setup" href="#system-setup"></a>10.&nbsp;System Setup</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-setup-introduction" href="#system-setup-introduction"></a>10.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter shows you how to setup the Web Flow system for use in any web environment.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-config-options" href="#system-config-options"></a>10.2.&nbsp;Java Config and XML Namespace</h2></div></div></div>
		
		<p>
			Web Flow provides dedicated configuration support for both Java and
			XML-based configuration.
		</p>
		<p>
			To get started with XML based configuration declare the webflow config XML namespace:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:webflow</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow-config"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/webflow-config
           http://www.springframework.org/schema/webflow-config/spring-webflow-config.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- Setup Web Flow here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
		</pre>
		<p>
			To get started with Java configuration extend
			<code class="classname">AbstractFlowConfiguration</code> in an
			<code class="classname">@Configuration</code> class:
		</p>
		<pre class="programlisting">
<span class="hl-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hl-keyword">import</span> org.springframework.webflow.config.AbstractFlowConfiguration;

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebFlowConfig <span class="hl-keyword">extends</span> AbstractFlowConfiguration {

}
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-config-basic" href="#system-config-basic"></a>10.3.&nbsp;Basic system configuration</h2></div></div></div>
		
		<p>
			The next section shows the minimal configuration required to set up the Web Flow system in your application.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="basic-setup-flow-registry" href="#basic-setup-flow-registry"></a>10.3.1.&nbsp;FlowRegistry</h3></div></div></div>
			
			<p>
				Register your flows in a <code class="code">FlowRegistry</code> in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				Register your flows in a <code class="code">FlowRegistry</code> in Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
    <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
        .build();
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="basic-setup-flow-executor" href="#basic-setup-flow-executor"></a>10.3.2.&nbsp;FlowExecutor</h3></div></div></div>
			
			<p>
				Deploy a FlowExecutor, the central service for executing flows in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				Deploy a FlowExecutor, the central service for executing flows in Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry()).build();
}
			</pre>
			<p>
				See the Spring MVC and Spring Faces sections of this guide on how to integrate the Web Flow system with the MVC and JSF environment, respectively.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-registry" href="#flow-registry"></a>10.4.&nbsp;flow-registry options</h2></div></div></div>
		
		<p>
			This section explores flow-registry configuration options.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location" href="#flow-registry-location"></a>10.4.1.&nbsp;Specifying flow locations</h3></div></div></div>
			
			<p>
				Use the <code class="code">location</code> element to specify paths to flow definitions to register.
				By default, flows will be assigned registry identifiers equal to their filenames minus
				the file extension, unless a registry bath path is defined.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location-id" href="#flow-registry-location-id"></a>10.4.2.&nbsp;Assigning custom flow identifiers</h3></div></div></div>
			
			<p>
				Specify an id to assign a custom registry identifier to a flow in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookHotel"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				Specify an id to assign a custom registry identifier to a flow in Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>, <span class="hl-string">"bookHotel"</span>)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location-attributes" href="#flow-registry-location-attributes"></a>10.4.3.&nbsp;Assigning flow meta-attributes</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-definition-attributes</code> element to assign custom meta-attributes to a registered flow.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-definition-attributes&gt;</span>
        <span class="hl-tag">&lt;webflow:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"caption"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Books a hotel"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/webflow:flow-definition-attributes&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-location&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
Map&lt;String, Object&gt; attrs = ... ;

<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>, null, attrs)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-patterns" href="#flow-registry-patterns"></a>10.4.4.&nbsp;Registering flows using a location pattern</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-location-patterns</code> element to register flows that match a specific resource location pattern:
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location-pattern</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/flows/**/*-flow.xml"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocationPattern(<span class="hl-string">"/WEB-INF/flows/**/*-flow.xml"</span>)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-base-path" href="#flow-registry-base-path"></a>10.4.5.&nbsp;Flow location base path</h3></div></div></div>
			
			<p>
				Use the <code class="code">base-path</code> attribute to define a base location for all flows in the application.
				All flow locations are then relative to the base path.
				The base path can be a resource path such as '/WEB-INF' or a location on the classpath like 'classpath:org/springframework/webflow/samples'.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">base-path</span>=<span class="hl-value">"/WEB-INF"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/hotels/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .setBasePath(<span class="hl-string">"/WEB-INF"</span>)
        .addFlowLocationPattern(<span class="hl-string">"/hotels/booking/booking.xml"</span>)
        .build();
			</pre>
			<p>
				With a base path defined, the algorithm that assigns flow identifiers changes slightly.
				Flows will now be assigned registry identifiers equal to the the path segment between their base path and file name.
				For example, if a flow definition is located at '/WEB-INF/hotels/booking/booking-flow.xml' and the base path is '/WEB-INF' the remaining path to this flow is 'hotels/booking' which becomes the flow id.
			</p>
			<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Directory per flow definition"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Directory per flow definition</th></tr><tr><td align="left" valign="top">
				
				<p>
					Recall it is a best practice to package each flow definition in a unique directory.
					This improves modularity, allowing dependent resources to be packaged with the flow definition.
					It also prevents two flows from having the same identifiers when using the convention.
				</p>
			</td></tr></table></div>
			<p>
				If no base path is not specified or if the flow definition is directly on the base path, flow id assignment from the filename (minus the extension) is used.
				For example, if a flow definition file is 'booking.xml', the flow identifier is simply 'booking'.
			</p>
			<p>
				Location patterns are particularly powerful when combined with a registry base path.
				Instead of the flow identifiers becoming '*-flow', they will be based on the directory path.
				For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">base-path</span>=<span class="hl-value">"/WEB-INF"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location-pattern</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/**/*-flow.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .setBasePath(<span class="hl-string">"/WEB-INF"</span>)
        .addFlowLocationPattern(<span class="hl-string">"/**/*-flow.xml"</span>)
        .build();
			</pre>
			<p>
				In the above example, suppose you had flows located in <code class="code">/user/login</code>, <code class="code">/user/registration</code>, <code class="code">/hotels/booking</code>, and <code class="code">/flights/booking</code> directories within <code class="code">WEB-INF</code>,
				you'd end up with flow ids of <code class="code">user/login</code>, <code class="code">user/registration</code>, <code class="code">hotels/booking</code>, and <code class="code">flights/booking</code>, respectively.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-parent" href="#flow-registry-parent"></a>10.4.6.&nbsp;Configuring FlowRegistry hierarchies</h3></div></div></div>
			
			<p>
				Use the <code class="code">parent</code> attribute to link two flow registries together in a hierarchy.
				When the child registry is queried, if it cannot find the requested flow it will delegate to its parent.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-comment">&lt;!-- my-system-config.xml --&gt;</span>
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"sharedFlowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>

<span class="hl-comment">&lt;!-- shared-config.xml --&gt;</span>
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sharedFlowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- Global flows shared by several applications --&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebFlowConfig <span class="hl-keyword">extends</span> AbstractFlowConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> SharedConfig sharedConfig;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
        <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
                .setParent(<span class="hl-keyword">this</span>.sharedConfig.sharedFlowRegistry())
                .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
                .build();
    }
}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SharedConfig <span class="hl-keyword">extends</span> AbstractFlowConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FlowDefinitionRegistry sharedFlowRegistry() {
        <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
                .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/shared.xml"</span>)
                .build();
    }
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-builder-services" href="#flow-registry-builder-services"></a>10.4.7.&nbsp;Configuring custom FlowBuilder services</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-builder-services</code> attribute to customize the services and settings used to build flows in a flow-registry.
				If no flow-builder-services tag is specified, the default service implementations are used.
				When the tag is defined, you only need to reference the services you want to customize.
			</p>
			<p>In XML:</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>In Java:</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
	<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder(flowBuilderServices())
            .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
            .build();
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowBuilderServices flowBuilderServices() {
    <span class="hl-keyword">return</span> getFlowBuilderServicesBuilder().build();
}
			</pre>
			<p>
				The configurable services are the <code class="code">conversion-service</code>, <code class="code">expression-parser</code>, and <code class="code">view-factory-creator</code>.
				These services are configured by referencing custom beans you define.
			</p>
			<p>
				For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span>
    <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span>
    <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span>
    <span class="hl-attribute">view-factory-creator</span>=<span class="hl-value">"viewFactoryCreator"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewFactoryCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>In Java:</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowBuilderServices flowBuilderServices() {
    <span class="hl-keyword">return</span> getFlowBuilderServicesBuilder()
            .setConversionService(conversionService())
            .setExpressionParser(expressionParser)
            .setViewFactoryCreator(mvcViewFactoryCreator())
            .build();
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> ConversionService conversionService() {
    <span class="hl-comment">// ...</span>
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> ExpressionParser expressionParser() {
    <span class="hl-comment">// ...</span>
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> ViewFactoryCreator viewFactoryCreator() {
    <span class="hl-comment">// ...</span>
}
			</pre>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-conversion" href="#builder-service-conversion"></a>conversion-service</h4></div></div></div>
				
				<p>
					Use the <code class="code">conversion-service</code> attribute to customize the <code class="code">ConversionService</code> used by the Web Flow system.
					Type conversion is used to convert from one type to another when required during flow execution such as when processing request parameters, invoking actions, and so on.
					Many common object types such as numbers, classes, and enums are supported.
					However you'll probably need to provide your own type conversion and formatting logic for custom data types.
					Please read <a class="xref" href="#view-type-conversion" title="5.7.&nbsp;Performing type conversion">Section&nbsp;5.7, &#8220;Performing type conversion&#8221;</a> for important information on how to provide custom type conversion logic.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-expression-parser" href="#builder-service-expression-parser"></a>expression-parser</h4></div></div></div>
				
				<p>
					Use the <code class="code">expression-parser</code> attribute to customize the <code class="code">ExpressionParser</code> used by the Web Flow system.
					The default ExpressionParser uses the Unified EL if available on the classpath, otherwise Spring EL is used.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-view-factory-creator" href="#builder-service-view-factory-creator"></a>view-factory-creator</h4></div></div></div>
				
				<p>
					Use the <code class="code">view-factory-creator</code> attribute to customize the <code class="code">ViewFactoryCreator</code> used by the Web Flow system.
					The default ViewFactoryCreator produces Spring MVC ViewFactories capable of rendering JSP, Velocity, and Freemarker views.
				</p>
				<p>
					The configurable settings are <code class="code">development</code>.
					These settings are global configuration attributes that can be applied during the flow construction process.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-development" href="#builder-development"></a>development</h4></div></div></div>
				
				<p>
					Set this to <code class="code">true</code> to switch on flow <span class="emphasis"><em>development mode</em></span>.
					Development mode switches on hot-reloading of flow definition changes, including changes to dependent flow resources such as message bundles.
				</p>
			</div>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-executor" href="#flow-executor"></a>10.5.&nbsp;flow-executor options</h2></div></div></div>
		
		<p>
			This section explores flow-executor configuration options.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-executor-execution-listeners" href="#flow-executor-execution-listeners"></a>10.5.1.&nbsp;Attaching flow execution listeners</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-execution-listeners</code> element to register listeners that observe the lifecycle
				of flow executions. For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-execution-listeners&gt;</span>
    <span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityListener"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"persistenceListener"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-execution-listeners&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
            .addFlowExecutionListener(securityListener())
            .addFlowExecutionListener(persistenceListener())
            .build();
}
			</pre>
			<p>
				You may also configure a listener to observe only certain flows. For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityListener"</span> <span class="hl-attribute">criteria</span>=<span class="hl-value">"securedFlow1,securedFlow2"</span><span class="hl-tag">/&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
            .addFlowExecutionListener(securityListener(), <span class="hl-string">"securedFlow1,securedFlow2"</span>)
            .build();
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tuning-flow-execution-repository" href="#tuning-flow-execution-repository"></a>10.5.2.&nbsp;Tuning FlowExecution persistence</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-execution-repository</code> element to tune flow execution persistence settings.
				For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-execution-repository</span> <span class="hl-attribute">max-executions</span>=<span class="hl-value">"5"</span> <span class="hl-attribute">max-execution-snapshots</span>=<span class="hl-value">"30"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-executor&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
            .setMaxFlowExecutions(<span class="hl-number">5</span>)
            .setMaxFlowExecutionSnapshots(<span class="hl-number">30</span>)
            .build();
}
			</pre>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="repository-max-executions" href="#repository-max-executions"></a>max-executions</h4></div></div></div>
				
				<p>
					Tune the <code class="code">max-executions</code> attribute to place a cap on the number of flow executions that can be created per user session.
					When the maximum number of executions is exceeded, the oldest execution is removed.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
						<p>
							The <code class="code">max-executions</code> attribute is per user session, i.e. it works across instances of any flow definition.
						</p>
					</td></tr></table></div><p>
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="repository-max-snapshots" href="#repository-max-snapshots"></a>max-execution-snapshots</h4></div></div></div>
				
				<p>
					Tune the <code class="code">max-execution-snapshots</code> attribute to place a cap on the number of history snapshots that can be taken per flow execution.
					To disable snapshotting, set this value to 0.  To enable an unlimited number of snapshots, set this value to -1.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
						<p>
							History snapshots enable browser back button support.
							When snapshotting is disabled pressing the browser back button will not work.
							It will result in using an execution key that points to a snapshot that has not be recorded.
						</p>
					</td></tr></table></div><p>
				</p>
			</div>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="spring-mvc" href="#spring-mvc"></a>11.&nbsp;Spring MVC Integration</h1></div></div></div>


<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-introduction" href="#spring-mvc-introduction"></a>11.1.&nbsp;Introduction</h2></div></div></div>
	

	<p>This chapter shows how to integrate Web Flow into a Spring MVC web
	application. The <code class="code">booking-mvc</code> sample application is a good
	reference for Spring MVC with Web Flow. This application is a simplified
	travel site that allows users to search for and book hotel rooms.</p>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-web.xml" href="#spring-mvc-config-web.xml"></a>11.2.&nbsp;Configuring web.xml</h2></div></div></div>
	

	<p>The first step to using Spring MVC is to configure the
	<code class="code">DispatcherServlet</code> in <code class="code">web.xml</code>. You typically do
	this once per web application.</p>

	<p>The example below maps all requests that begin with
	<code class="code">/spring/</code> to the DispatcherServlet. An <code class="code">init-param</code>
	is used to provide the <code class="code">contextConfigLocation</code>. This is the
	configuration file for the web application.</p>

	<pre class="programlisting">
<span class="hl-tag">&lt;servlet&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
	<span class="hl-tag">&lt;init-param&gt;</span>
		<span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
		<span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/web-application-config.xml<span class="hl-tag">&lt;/param-value&gt;</span>
	<span class="hl-tag">&lt;/init-param&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;url-pattern&gt;</span>/spring/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span></pre>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-spring-url-mapping" href="#spring-mvc-config-spring-url-mapping"></a>11.3.&nbsp;Dispatching to flows</h2></div></div></div>
	

	<p>The <code class="code">DispatcherServlet</code> maps requests for application
	resources to handlers. A flow is one type of handler.</p>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1532" href="#d5e1532"></a>11.3.1.&nbsp;Registering the FlowHandlerAdapter</h3></div></div></div>
		

		<p>The first step to dispatching requests to flows is to enable flow
		handling within Spring MVC. To this, install the
		<code class="code">FlowHandlerAdapter</code>:</p>

		<pre class="programlisting">
<span class="hl-comment">&lt;!-- Enables FlowHandler URL mapping --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowHandlerAdapter"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
			</pre>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1537" href="#d5e1537"></a>11.3.2.&nbsp;Defining flow mappings</h3></div></div></div>
		

		<p>Once flow handling is enabled, the next step is to map specific
		application resources to your flows. The simplest way to do this is to
		define a <code class="code">FlowHandlerMapping</code>:</p>

		<pre class="programlisting">
<span class="hl-comment">&lt;!-- Maps request paths to flows in the flowRegistry;
	e.g. a path of /hotels/booking looks for a flow with id "hotels/booking" --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowHandlerMapping"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"0"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
			</pre>

		<p>Configuring this mapping allows the Dispatcher to map application
		resource paths to flows in a flow registry. For example, accessing the
		resource path <code class="code">/hotels/booking</code> would result in a registry
		query for the flow with id <code class="code">hotels/booking</code>. If a flow is
		found with that id, that flow will handle the request. If no flow is
		found, the next handler mapping in the Dispatcher's ordered chain will
		be queried or a "noHandlerFound" response will be returned.</p>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1545" href="#d5e1545"></a>11.3.3.&nbsp;Flow handling workflow</h3></div></div></div>
		

		<p>When a valid flow mapping is found, the
		<code class="code">FlowHandlerAdapter</code> figures out whether to start a new
		execution of that flow or resume an existing execution based on
		information present the HTTP request. There are a number of defaults
		related to starting and resuming flow executions the adapter
		employs:</p>

		<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
			<p>HTTP request parameters are made available in the input map of
			all starting flow executions.</p>
		</li><li class="listitem">
			<p>When a flow execution ends without sending a final response,
			the default handler will attempt to start a new execution in the
			same request.</p>
		</li><li class="listitem">
			<p>Unhandled exceptions are propagated to the Dispatcher unless
			the exception is a NoSuchFlowExecutionException. The default handler
			will attempt to recover from a NoSuchFlowExecutionException by
			starting over a new execution.</p>
		</li></ul></div>

		<p>Consult the API documentation for <code class="code">FlowHandlerAdapter</code>
		for more information. You may override these defaults by subclassing or
		by implementing your own FlowHandler, discussed in the next
		section.</p>
	</div>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-flow-handlers" href="#spring-mvc-config-flow-handlers"></a>11.4.&nbsp;Implementing custom FlowHandlers</h2></div></div></div>
	

	<p><code class="code">FlowHandler</code> is the extension point that can be used to
	customize how flows are executed in a HTTP servlet environment. A
	<code class="code">FlowHandler</code> is used by the <code class="code">FlowHandlerAdapter</code>
	and is responsible for:</p>

	<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
		<p>Returning the <code class="code">id</code> of a flow definition to
		execute</p>
		</li><li class="listitem">
		<p>Creating the input to pass new executions of that flow as they
		are started</p>
		</li><li class="listitem">
		<p>Handling outcomes returned by executions of that flow as they
		end</p>
		</li><li class="listitem">
		<p>Handling any exceptions thrown by executions of that flow as
		they occur</p>
		</li></ul></div>

	<p>These responsibilities are illustrated in the definition of the
	<code class="code">org.springframework.mvc.servlet.FlowHandler</code> interface:</p>

	<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FlowHandler {

	<span class="hl-keyword">public</span> String getFlowId();

	<span class="hl-keyword">public</span> MutableAttributeMap createExecutionInputMap(HttpServletRequest request);

	<span class="hl-keyword">public</span> String handleExecutionOutcome(FlowExecutionOutcome outcome,
		HttpServletRequest request, HttpServletResponse response);

	<span class="hl-keyword">public</span> String handleException(FlowException e,
		HttpServletRequest request, HttpServletResponse response);
}
		</pre>

	<p>To implement a FlowHandler, subclass
	<code class="code">AbstractFlowHandler</code>. All these operations are optional, and
	if not implemented the defaults will apply. You only need to override the
	methods that you need. Specifically:</p>

	<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
		<p>Override <code class="code">getFlowId(HttpServletRequest)</code> when the id
		of your flow cannot be directly derived from the HTTP request. By
		default, the id of the flow to execute is derived from the pathInfo
		portion of the request URI. For example,
		<code class="code">http://localhost/app/hotels/booking?hotelId=1</code> results in
		a flow id of <code class="code">hotels/booking</code> by default.</p>
		</li><li class="listitem">
		<p>Override
		<code class="code">createExecutionInputMap(HttpServletRequest)</code> when you need
		fine-grained control over extracting flow input parameters from the
		HttpServletRequest. By default, all request parameters are treated as
		flow input parameters.</p>
		</li><li class="listitem">
		<p>Override <code class="code">handleExecutionOutcome</code> when you need to
		handle specific flow execution outcomes in a custom manner. The
		default behavior sends a redirect to the ended flow's URL to restart a
		new execution of the flow.</p>
		</li><li class="listitem">
		<p>Override <code class="code">handleException</code> when you need fine-grained
		control over unhandled flow exceptions. The default behavior attempts
		to restart the flow when a client attempts to access an ended or
		expired flow execution. Any other exception is rethrown to the Spring
		MVC ExceptionResolver infrastructure by default.</p>
		</li></ul></div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-flow-handler-example" href="#spring-mvc-flow-handler-example"></a>11.4.1.&nbsp;Example FlowHandler</h3></div></div></div>
		

		<p>A common interaction pattern between Spring MVC And Web Flow is
		for a Flow to redirect to a @Controller when it ends. FlowHandlers allow
		this to be done without coupling the flow definition itself with a
		specific controller URL. An example FlowHandler that redirects to a
		Spring MVC Controller is shown below:</p>

		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingFlowHandler <span class="hl-keyword">extends</span> AbstractFlowHandler {
	<span class="hl-keyword">public</span> String handleExecutionOutcome(FlowExecutionOutcome outcome,
										HttpServletRequest request, HttpServletResponse response) {
		<span class="hl-keyword">if</span> (outcome.getId().equals(<span class="hl-string">"bookingConfirmed"</span>)) {
			<span class="hl-keyword">return</span> <span class="hl-string">"/booking/show?bookingId="</span> + outcome.getOutput().get(<span class="hl-string">"bookingId"</span>);
		} <span class="hl-keyword">else</span> {
			<span class="hl-keyword">return</span> <span class="hl-string">"/hotels/index"</span>;
		}
	}
}
			</pre>

		<p>Since this handler only needs to handle flow execution outcomes in
		a custom manner, nothing else is overridden. The
		<code class="code">bookingConfirmed</code> outcome will result in a redirect to show
		the new booking. Any other outcome will redirect back to the hotels
		index page.</p>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1600" href="#d5e1600"></a>11.4.2.&nbsp;Deploying a custom FlowHandler</h3></div></div></div>
		

		<p>To install a custom FlowHandler, simply deploy it as a bean. The
		bean name must match the id of the flow the handler should apply
		to.</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotels/booking"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.BookingFlowHandler"</span><span class="hl-tag"> /&gt;</span>
			</pre>

		<p>With this configuration, accessing the resource
		<code class="code">/hotels/booking</code> will launch the <code class="code">hotels/booking</code>
		flow using the custom BookingFlowHandler. When the booking flow ends,
		the FlowHandler will process the flow execution outcome and redirect to
		the appropriate controller.</p>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-flow-handler-redirects" href="#spring-mvc-flow-handler-redirects"></a>11.4.3.&nbsp;FlowHandler Redirects</h3></div></div></div>
		

		<p>A FlowHandler handling a FlowExecutionOutcome or FlowException
		returns a <code class="code">String</code> to indicate the resource to redirect to
		after handling. In the previous example, the
		<code class="code">BookingFlowHandler</code> redirects to the
		<code class="code">booking/show</code> resource URI for <code class="code">bookingConfirmed</code>
		outcomes, and the <code class="code">hotels/index</code> resource URI for all other
		outcomes.</p>

		<p>By default, returned resource locations are relative to the
		current servlet mapping. This allows for a flow handler to redirect to
		other Controllers in the application using relative paths. In addition,
		explicit redirect prefixes are supported for cases where more control is
		needed.</p>

		<p>The explicit redirect prefixes supported are:</p>

		<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
			<p><code class="code">servletRelative:</code> - redirect to a resource
			relative to the current servlet</p>
		</li><li class="listitem">
			<p><code class="code">contextRelative:</code> - redirect to a resource
			relative to the current web application context path</p>
		</li><li class="listitem">
			<p><code class="code">serverRelative:</code> - redirect to a resource relative
			to the server root</p>
		</li><li class="listitem">
			<p><code class="code">http://</code> or <code class="code">https://</code> - redirect to a
			fully-qualified resource URI</p>
		</li></ul></div>

		<p>These same redirect prefixes are also supported within a flow
		definition when using the <code class="code">externalRedirect:</code> directive in
		conjunction with a view-state or end-state; for example,
		<code class="code">view="externalRedirect:http://springframework.org"</code></p>
	</div>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-spring-view-resolution" href="#spring-mvc-config-spring-view-resolution"></a>11.5.&nbsp;View Resolution</h2></div></div></div>
	

	<p>Web Flow 2 maps selected view identifiers to files located within
	the flow's working directory unless otherwise specified. For existing
	Spring MVC + Web Flow applications, an external <code class="code">ViewResolver</code>
	is likely already handling this mapping for you. Therefore, to continue
	using that resolver and to avoid having to change how your existing flow
	views are packaged, configure Web Flow as follows:</p>

	<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;webflow:location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/hotels/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">view-factory-creator</span>=<span class="hl-value">"mvcViewFactoryCreator"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mvcViewFactoryCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.builder.MvcViewFactoryCreator"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewResolvers"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myExistingViewResolverToUseForFlows"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
		</pre>

	<p>The MvcViewFactoryCreator is the factory that allows you to
	configure how the Spring MVC view system is used inside Spring Web Flow.
	Use it to configure existing ViewResolvers, as well as other services such
	as a custom MessageCodesResolver. You may also enable data binding use
	Spring MVC's native BeanWrapper by setting the
	<code class="code">useSpringBinding</code> flag to true. This is an alternative to
	using the Unified EL for view-to-model data binding. See the
	JavaDoc API of this class for more information.</p>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-resuming-on-event" href="#spring-mvc-resuming-on-event"></a>11.6.&nbsp;Signaling an event from a View</h2></div></div></div>
	

	<p>When a flow enters a view-state it pauses, redirects the user to its
	execution URL, and waits for a user event to resume. Events are generally
	signaled by activating buttons, links, or other user interface commands.
	How events are decoded server-side is specific to the view technology in
	use. This section shows how to trigger events from HTML-based views
	generated by templating engines such as JSP, Velocity, or
	Freemarker.</p>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="webflow-event-named-html-button" href="#webflow-event-named-html-button"></a>11.6.1.&nbsp;Using a named HTML button to signal an event</h3></div></div></div>
		

		<p>The example below shows two buttons on the same form that signal
		<code class="code">proceed</code> and <code class="code">cancel</code> events when clicked,
		respectively.</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_proceed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_cancel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Cancel"</span><span class="hl-tag"> /&gt;</span>
			</pre>

		<p>When a button is pressed Web Flow finds a request parameter name
		beginning with <code class="code">_eventId_</code> and treats the remaining substring
		as the event id. So in this example, submitting
		<code class="code">_eventId_proceed</code> becomes <code class="code">proceed</code>. This style
		should be considered when there are several different events that can be
		signaled from the same form.</p>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="webflow-event-hidden-parameter" href="#webflow-event-hidden-parameter"></a>11.6.2.&nbsp;Using a hidden HTML form parameter to signal an event</h3></div></div></div>
		

		<p>The example below shows a form that signals the
		<code class="code">proceed</code> event when submitted:</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"hidden"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"proceed"</span><span class="hl-tag"> /&gt;</span>
			</pre>

		<p>Here, Web Flow simply detects the special <code class="code">_eventId</code>
		parameter and uses its value as the event id. This style should only be
		considered when there is one event that can be signaled on the
		form.</p>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="webflow-event-link" href="#webflow-event-link"></a>11.6.3.&nbsp;Using a HTML link to signal an event</h3></div></div></div>
		

		<p>The example below shows a link that signals the
		<code class="code">cancel</code> event when activated:</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;a</span> <span class="hl-attribute">href</span>=<span class="hl-value">"${flowExecutionUrl}&amp;_eventId=cancel"</span><span class="hl-tag">&gt;</span>Cancel<span class="hl-tag">&lt;/a&gt;</span>
			</pre>

		<p>Firing an event results in a HTTP request being sent back to the
		server. On the server-side, the flow handles decoding the event from
		within its current view-state. How this decoding process works is
		specific to the view implementation. Recall a Spring MVC view
		implementation simply looks for a request parameter named
		<code class="code">_eventId</code>. If no <code class="code">_eventId</code> parameter is found,
		the view will look for a parameter that starts with
		<code class="code">_eventId_</code> and will use the remaining substring as the event
		id. If neither cases exist, no flow event is triggered.</p>
	</div>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-embedded-flow" href="#spring-mvc-embedded-flow"></a>11.7.&nbsp;Embedding A Flow On A Page</h2></div></div></div>
	

	<p>By default when a flow enters a view state, it executes a
	client-side redirect before rendering the view. This approach is known as
	POST-REDIRECT-GET. It has the advantage of separating the form processing
	for one view from the rendering of the next view. As a result the browser
	Back and Refresh buttons work seamlessly without causing any browser
	warnings.</p>

	<p>Normally the client-side redirect is transparent from a user's
	perspective. However, there are situations where POST-REDIRECT-GET may not
	bring the same benefits. For example a flow may be embedded on a page and driven via
	Ajax requests refreshing only the area of the page that belongs to the flow.
	Not only is it unnecessary to use client-side redirects in this case, it
	is also not the desired behavior with regards to keeping the surrounding
	content of the page intact.</p>

	<p>The <a class="xref" href="#spring-js-ajax" title="12.5.&nbsp;Handling Ajax Requests">Section&nbsp;12.5, &#8220;Handling Ajax Requests&#8221;</a> explains how to do
	partial rendering during Ajax requests. The focus of this section is to
	explain how to control flow execution redirect behavior during
	Ajax requests. To indicate a flow should execute in "page embedded" mode all
	you need to do is append an extra parameter when launching the
	flow:</p>

	<pre class="programlisting">/hotels/booking?mode=embedded</pre>

	<p>When launched in "page embedded" mode a flow will not issue
	flow execution redirects during Ajax requests. The mode=embedded parameter
	only needs to be passed when launching the flow. Your only other concern is
	to use Ajax requests and to render only the content required to update
	the portion of the page displaying the flow.</p>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-embedded-flow-alternatives" href="#spring-mvc-embedded-flow-alternatives"></a>11.7.1.&nbsp;Embedded Mode Vs Default Redirect Behavior</h3></div></div></div>
		
		<p>
			By default Web Flow does a client-side redirect upon entering every view state.
			However if you remain in the same view state -- for example a transition without a "to" attribute -- during an Ajax request there will not be a client-side redirect.
			This behavior should be quite familiar to Spring Web Flow 2 users.
			It is appropriate for a top-level flow that supports the browser back button while still taking advantage of Ajax and partial rendering for use cases where you remain in the same view such as form validation, paging trough search results, and others.
			However transitions to a new view state are always followed with a client-side redirect.
			That makes it impossible to embed a flow on a page or within a modal dialog and execute more than one view state without causing a full-page refresh.
			Hence if your use case requires embedding a flow you can launch it in "embedded" mode.
		</p>
	</div>

	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-embedded-flow-examples" href="#spring-mvc-embedded-flow-examples"></a>11.7.2.&nbsp;Embedded Flow Examples</h3></div></div></div>
		
		<p>If you'd like to see examples of a flow embedded on a page and within
		a modal dialog please refer to the webflow-showcase project. You can check out
		the source code locally, build it as you would a Maven project, and import
		it into Eclipse:</p>

		<pre class="programlisting">cd some-directory
svn co https://src.springframework.org/svn/spring-samples/webflow-showcase
cd webflow-showcase
mvn package
# import into Eclipse</pre><p>
		</p>
	</div>
</div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-flash-output" href="#spring-mvc-flash-output"></a>11.8.&nbsp;Saving Flow Output to MVC Flash Scope</h2></div></div></div>
	
		<p>Flow output can be automatically saved to MVC flash scope when an <code class="code">end-state</code>
		performs an internal redirect. This is particularly useful when displaying a summary
		screen at the end of a flow. For backwards compatibility this feature is disabled by
		default, to enable set <code class="code">saveOutputToFlashScopeOnRedirect</code> on your
		<code class="code">FlowHandlerAdapter</code> to <code class="code">true</code>.</p>

		<pre class="programlisting">
<span class="hl-comment">&lt;!-- Enables FlowHandler URL mapping --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowHandlerAdapter"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"saveOutputToFlashScopeOnRedirect"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
		</pre>

		<p>The following example will add <code class="code">confirmationNumber</code> to the MVC flash scope
		before redirecting to the <code class="code">summary</code> screen.</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"finish"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"externalRedirect:summary"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"confirmationNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.confirmationNumber"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/end-state&gt;</span>
		</pre>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="spring-js" href="#spring-js"></a>12.&nbsp;Spring JavaScript Quick Reference</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-introduction" href="#spring-js-introduction"></a>12.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			The <span class="emphasis"><em>spring-js-resources</em></span> module is a legacy module that is no longer recommended for use
			but is provided still as an optional module for backwards compatibility. Its original aim is to provide a
			client-side programming model for progressively enhancing a web page with behavior and Ajax remoting.
		</p>
		<p>
			Use of the Spring JS API is demonstrated in the
			<a class="ulink" href="https://github.com/spring-projects/spring-webflow-samples" target="_top">samples repository</a>.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-resource-servlet" href="#spring-js-resource-servlet"></a>12.2.&nbsp;Serving Javascript Resources</h2></div></div></div>
		
		<p>
			The Spring Framework provides a mechanism for serving static resources.
			See the
			<a class="ulink" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-static-resources" target="_top">Spring Framework documentation</a>).
			With the new &lt;mvc:resources&gt; element resource requests (.js, .css) are handled by the<code class="code">DispatcherSevlet</code>.
			Here is example configuration in XML (Java config is also available):
		</p>
		<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
	<span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
	<span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;mvc:annotation-driven/&gt;</span>

	<span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">"/resources/**"</span> <span class="hl-attribute">location</span>=<span class="hl-value">"/, classpath:/META-INF/web-resources/"</span><span class="hl-tag"> /&gt;</span>

	...

<span class="hl-tag">&lt;/beans&gt;</span>

		</pre>
		<p>
			This incoming maps requests for <code class="code">/resources</code> to resources found under
			<code class="code">/META-INF/web-resources</code> on the classpath. That's where Spring JavaScript resources
			are bundled. However, you can modify the location attribute in the above configuration in order
			to serve resources from any classpath or web application relative location.
		</p>
		<p>
			Note that the full resource URL depends on how your DispatcherServlet is mapped.
			In the mvc-booking sample we've chosen to map it with the default servlet mapping '/':
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;servlet&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>DispatcherServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>DispatcherServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;url-pattern&gt;</span>/<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span>

		</pre>
		<p>
			That means the full URL to load <code class="code">Spring.js</code> is <code class="code">/myapp/resources/spring/Spring.js</code>.
			If your <code class="code">DispatcherServlet</code> was instead mapped to <code class="code">/main/*</code> then the full
			URL would be <code class="code">/myapp/main/resources/spring/Spring.js</code>.
		</p>
		<p>
			When using of the default servlet mapping it is also recommended to add this to your Spring MVC
			configuration, which ensures that any resource requests not handled by your Spring MVC mappings
			will be delegated back to the Servlet container.
		</p>
		<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
	<span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
	<span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

	...

	<span class="hl-tag">&lt;mvc:default-servlet-handler /&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>

		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-includes" href="#spring-js-includes"></a>12.3.&nbsp;Including Spring Javascript in a Page</h2></div></div></div>
		
		<p>
			Spring JS is designed such that an implementation of its API can be built for any of the popular Javascript toolkits.
			The initial implementation of Spring.js builds on the Dojo toolkit.
		</p>
		<p>
			Using Spring Javascript in a page requires including the underlying toolkit as normal,
			the <code class="code">Spring.js</code> base interface file, and the <code class="code">Spring-(library implementation).js</code> file for the underlying toolkit.
			As an example, the following includes obtain the Dojo implementation of Spring.js using the <code class="code">ResourceServlet</code>:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"&lt;c:url value="</span><span class="hl-tag">/r</span>esources/dojo/dojo.js" /&gt;"&gt; <span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"&lt;c:url value="</span><span class="hl-tag">/r</span>esources/spring/Spring.js" /&gt;"&gt; <span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"&lt;c:url value="</span><span class="hl-tag">/r</span>esources/spring/Spring-Dojo.js" /&gt;"&gt; <span class="hl-tag">&lt;/script&gt;</span>
		</pre>
		<p>
			When using the widget system of an underlying library, typically you must also include some CSS resources to obtain the desired look and feel.
			For the booking-mvc reference application, Dojo's <code class="code">tundra.css</code> is included:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;link</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"&lt;c:url value="</span><span class="hl-tag">/r</span>esources/dijit/themes/tundra/tundra.css" /&gt;" /&gt;
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-decorations" href="#spring-js-decorations"></a>12.4.&nbsp;Spring Javascript Decorations</h2></div></div></div>
		
		<p>
			A central concept in Spring Javascript is the notion of applying decorations to existing DOM nodes.
			This technique is used to progressively enhance a web page such that the page will still be functional in a less capable browser.
			The <code class="code">addDecoration</code> method is used to apply decorations.
		</p>
		<p>
			 The following example illustrates enhancing a Spring MVC <code class="code">&lt;form:input&gt;</code> tag with rich suggestion behavior:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchString"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"searchString"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span><span class="hl-tag">&gt;</span>
	Spring.addDecoration(new Spring.ElementDecoration({
		elementId: "searchString",
		widgetType: "dijit.form.ValidationTextBox",
		widgetAttrs: { promptMessage : "Search hotels by name, address, city, or zip." }}));
<span class="hl-tag">&lt;/script&gt;</span>
		</pre>
		<p>
			The <code class="code">ElementDecoration</code> is used to apply rich widget behavior to an existing DOM node.
			This decoration type does not aim to completely hide the underlying toolkit, so the toolkit's native widget type and attributes are used directly.
			This approach allows you to use a common decoration model to integrate any widget from the underlying toolkit in a consistent manner.
			See the <code class="code">booking-mvc</code> reference application for more examples of applying decorations to do things from suggestions to client-side validation.
		</p>
		<p>
			When using the <code class="code">ElementDecoration</code> to apply widgets that have rich validation behavior, a common need is to prevent the form from being submitted to the server until validation passes.
			This can be done with the <code class="code">ValidateAllDecoration</code>:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_proceed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span><span class="hl-tag">&gt;</span>
	Spring.addDecoration(new Spring.ValidateAllDecoration({ elementId:'proceed', event:'onclick' }));
<span class="hl-tag">&lt;/script&gt;</span>
		</pre>
		<p>
			This decorates the "Proceed" button with a special onclick event handler that fires the client side validators and does not allow the form to submit until they pass successfully.
		</p>
		<p>
			An <code class="code">AjaxEventDecoration</code> applies a client-side event listener that fires a remote Ajax request to the server.  It also auto-registers a callback function to link in the response:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;a</span> <span class="hl-attribute">id</span>=<span class="hl-value">"prevLink"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"search?searchString=${criteria.searchString}&amp;page=${criteria.page - 1}"</span><span class="hl-tag">&gt;</span>Previous<span class="hl-tag">&lt;/a&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span><span class="hl-tag">&gt;</span>
	Spring.addDecoration(new Spring.AjaxEventDecoration({
		elementId: "prevLink",
		event: "onclick",
		params: { fragments: "body" }
	}));
<span class="hl-tag">&lt;/script&gt;</span>
		</pre>
		<p>
			This decorates the onclick event of the "Previous Results" link with an Ajax call, passing along a special parameter that specifies the fragment to be re-rendered in the response.
			Note that this link would still be fully functional if Javascript was unavailable in the client.
			(See <a class="xref" href="#spring-js-ajax" title="12.5.&nbsp;Handling Ajax Requests">Section&nbsp;12.5, &#8220;Handling Ajax Requests&#8221;</a> for details on how this request is handled on the server.)
		</p>
		<p>
			It is also possible to apply more than one decoration to an element.
			The following example shows a button being decorated with Ajax and validate-all submit suppression:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_proceed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span><span class="hl-tag">&gt;</span>
	Spring.addDecoration(new Spring.ValidateAllDecoration({elementId:'proceed', event:'onclick'}));
	Spring.addDecoration(new Spring.AjaxEventDecoration({elementId:'proceed', event:'onclick',formId:'booking', params:{fragments:'messages'}}));
<span class="hl-tag">&lt;/script&gt;</span>
		</pre>
		<p>
			It is also possible to apply a decoration to multiple elements in a single statement using Dojo's query API.
			The following example decorates a set of checkbox elements as Dojo Checkbox widgets:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;div</span> <span class="hl-attribute">id</span>=<span class="hl-value">"amenities"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"amenities"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"OCEAN_VIEW"</span> <span class="hl-attribute">label</span>=<span class="hl-value">"Ocean View"</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/li&gt;</span>
<span class="hl-tag">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"amenities"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"LATE_CHECKOUT"</span> <span class="hl-attribute">label</span>=<span class="hl-value">"Late Checkout"</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/li&gt;</span>
<span class="hl-tag">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">"amenities"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"MINIBAR"</span> <span class="hl-attribute">label</span>=<span class="hl-value">"Minibar"</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/li&gt;</span>
<span class="hl-tag">&lt;script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span><span class="hl-tag">&gt;</span>
	dojo.query("#amenities input[type='checkbox']").forEach(function(element) {
		Spring.addDecoration(new Spring.ElementDecoration({
			elementId: element.id,
			widgetType : "dijit.form.CheckBox",
			widgetAttrs : { checked : element.checked }
		}));
	});
<span class="hl-tag">&lt;/script&gt;</span>
<span class="hl-tag">&lt;/div&gt;</span>
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-ajax" href="#spring-js-ajax"></a>12.5.&nbsp;Handling Ajax Requests</h2></div></div></div>
		
		<p>
			Spring Javascript's client-side Ajax response handling is built upon the notion of receiving "fragments" back from the server.
			These fragments are just standard HTML that is meant to replace portions of the existing page.
			The key piece needed on the server is a way to determine which pieces of a full response need to be pulled out for partial rendering.
		</p>
		<p>
			In order to be able to render partial fragments of a full response, the full response must be built using a
			templating technology that allows the use of composition for constructing the response, and for the member
			parts of the composition to be referenced and rendered individually.
			Spring Javascript provides some simple Spring MVC extensions that make use of Tiles to achieve this.
			The same technique could theoretically be used with any templating system supporting composition.
		</p>
		<p>
			Spring Javascript's Ajax remoting functionality is built upon the notion that the core handling code for an
			Ajax request should not differ from a standard browser request, thus no special knowledge of an Ajax request
			is needed directly in the code and the same hanlder can be used for both styles of request.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="custom-ajax-handler" href="#custom-ajax-handler"></a>12.5.1.&nbsp;Providing a Library-Specific AjaxHandler</h3></div></div></div>
			
			<p>
				The key interface for integrating various Ajax libraries with the Ajax-aware behavior of Web Flow (such as not redirecting for a
				partial page update) is <code class="code">org.springframework.js.AjaxHandler</code>.  A <code class="code">SpringJavascriptAjaxHandler</code> is configured by default that is able to
				detect an Ajax request submitted via the Spring JS client-side API and can respond appropriately in the case where a redirect is required.  In
				order to integrate a different Ajax library (be it a pure JavaScript library, or a higher-level abstraction such as an Ajax-capable JSF
				component library), a custom <code class="code">AjaxHandler</code> can be injected into the <code class="code">FlowHandlerAdapter</code> or <code class="code">FlowController</code>.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-js-ajax-mvc" href="#spring-js-ajax-mvc"></a>12.5.2.&nbsp;Handling Ajax Requests with Spring MVC Controllers</h3></div></div></div>
			
			<p>
				In order to handle Ajax requests with Spring MVC controllers, all that is needed is the configuration of
				the provided Spring MVC extensions in your Spring application context for rendering the partial response
				(note that these extensions require the use of Tiles for templating):
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tilesViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.view.AjaxUrlBasedViewResolver"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.webflow.mvc.view.FlowAjaxTiles3View"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
			</pre>
			<p>
				This configures the <code class="code">AjaxUrlBasedViewResolver</code> which in turn interprets Ajax requests and creates <code class="code">FlowAjaxTilesView</code> objects to handle rendering of the appropriate fragments.
				Note that <code class="code">FlowAjaxTilesView</code> is capable of handling the rendering for both Web Flow and pure Spring MVC requests.
				The fragments correspond to individual attributes of a Tiles view definition. For example, take the following Tiles view definition:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;definition</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotels/index"</span> <span class="hl-attribute">extends</span>=<span class="hl-value">"standardLayout"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;put-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"body"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"index.body"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/definition&gt;</span>

<span class="hl-tag">&lt;definition</span> <span class="hl-attribute">name</span>=<span class="hl-value">"index.body"</span> <span class="hl-attribute">template</span>=<span class="hl-value">"/WEB-INF/hotels/index.jsp"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;put-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelSearchForm"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/hotels/hotelSearchForm.jsp"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;put-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingsTable"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/hotels/bookingsTable.jsp"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/definition&gt;</span>
			</pre>
			<p>
				An Ajax request could specify the "body", "hotelSearchForm" or "bookingsTable" to be rendered as fragments in the request.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-js-ajax-mvc-webflow" href="#spring-js-ajax-mvc-webflow"></a>12.5.3.&nbsp;Handling Ajax Requests with Spring MVC + Spring Web Flow</h3></div></div></div>
			
			<p>
				Spring Web Flow handles the optional rendering of fragments directly in the flow definition language through use of the <code class="code">render</code> element.
				The benefit of this approach is that the selection of fragments is completely decoupled from client-side code, such that no special parameters need to be passed with the request the way they
				currently must be with the pure Spring MVC controller approach.
				For example, if you wanted to render the "hotelSearchForm" fragment from the previous example Tiles view into a rich Javascript popup:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-entry&gt;</span>
		<span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotelSearchForm"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-entry&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"search"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.resetPage()"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="spring-faces" href="#spring-faces"></a>13.&nbsp;JSF Integration</h1></div></div></div>
	

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-introduction" href="#spring-faces-introduction"></a>13.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			Spring Web Flow provides a JSF integration that lets you use the JSF UI
			Component Model with Spring Web Flow controllers. Web Flow also provides
			a Spring Security tag library for use in JSF environments,
			see <a class="xref" href="#spring-faces-security-taglib" title="13.9.&nbsp;Using the Spring Security Facelets Tag Library">Section&nbsp;13.9, &#8220;Using the Spring Security Facelets Tag Library&#8221;</a> for more details.
		</p>
		<p>Spring Web Flow 2.5 requires JSF 2.2 or higher.</p>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-config-web.xml" href="#spring-faces-config-web.xml"></a>13.2.&nbsp;Configuring web.xml</h2></div></div></div>
		

		<p>The first step is to route requests to the
		<code class="code">DispatcherServlet</code> in the <code class="code">web.xml</code> file. In this
		example, we map all URLs that begin with <code class="code">/spring/</code> to the
		servlet. The servlet needs to be configured. An <code class="code">init-param</code> is
		used in the servlet to pass the <code class="code">contextConfigLocation</code>. This
		is the location of the Spring configuration for your web
		application.</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;servlet&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
	<span class="hl-tag">&lt;init-param&gt;</span>
		<span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
		<span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/web-application-config.xml<span class="hl-tag">&lt;/param-value&gt;</span>
	<span class="hl-tag">&lt;/init-param&gt;</span>
	<span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;url-pattern&gt;</span>/spring/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span>
		</pre>

		<p>In order for JSF to bootstrap correctly, the
		<code class="code">FacesServlet</code> must be configured in <code class="code">web.xml</code> as it
		normally would even though you generally will not need to route requests
		through it at all when using JSF with Spring Web Flow.</p>

		<pre class="programlisting">
<span class="hl-comment">&lt;!-- Just here so the JSF implementation can initialize, *not* used at runtime --&gt;</span>
<span class="hl-tag">&lt;servlet&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;servlet-class&gt;</span>javax.faces.webapp.FacesServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
	<span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-comment">&lt;!-- Just here so the JSF implementation can initialize --&gt;</span>
<span class="hl-tag">&lt;servlet-mapping&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
	<span class="hl-tag">&lt;url-pattern&gt;</span>*.faces<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span>
		</pre>

		<p>The use of Facelets instead of JSP typically requires this in
		web.xml:</p>

		<pre class="programlisting">
!-- Use JSF view templates saved as *.xhtml, for use with Facelets --&gt;
<span class="hl-tag">&lt;context-param&gt;</span>
	<span class="hl-tag">&lt;param-name&gt;</span>javax.faces.DEFAULT_SUFFIX<span class="hl-tag">&lt;/param-name&gt;</span>
	<span class="hl-tag">&lt;param-value&gt;</span>.xhtml<span class="hl-tag">&lt;/param-value&gt;</span>
<span class="hl-tag">&lt;/context-param&gt;</span>
		</pre>

	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-webflow-config" href="#spring-faces-webflow-config"></a>13.3.&nbsp;Configuring Web Flow for use with JSF</h2></div></div></div>
		

		<p>This section explains how to configure Web Flow with JSF.
		Both Java and XML style configuration are supported.
		The following is sample configuration for Web Flow and JSF in XML:</p>

		<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
	<span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="hl-attribute">xmlns:webflow</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow-config"</span>
	<span class="hl-attribute">xmlns:faces</span>=<span class="hl-value">"http://www.springframework.org/schema/faces"</span>
	<span class="hl-attribute">si:schemaLocation</span>=<span class="hl-value">"
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/webflow-config
		http://www.springframework.org/schema/webflow-config/spring-webflow-config.xsd
		http://www.springframework.org/schema/faces
		http://www.springframework.org/schema/faces/spring-faces.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-comment">&lt;!-- Executes flows: the central entry point into the Spring Web Flow system --&gt;</span>
	<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;webflow:flow-execution-listeners&gt;</span>
			<span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"facesContextListener"</span><span class="hl-tag">/&gt;</span>
		<span class="hl-tag">&lt;/webflow:flow-execution-listeners&gt;</span>
	<span class="hl-tag">&lt;/webflow:flow-executor&gt;</span>

	<span class="hl-comment">&lt;!-- The registry of executable flow definitions --&gt;</span>
	<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">base-path</span>=<span class="hl-value">"/WEB-INF"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;webflow:flow-location-pattern</span> <span class="hl-attribute">value</span>=<span class="hl-value">"**/*-flow.xml"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>

	<span class="hl-comment">&lt;!-- Configures the Spring Web Flow JSF integration --&gt;</span>
	<span class="hl-tag">&lt;faces:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-comment">&lt;!-- A listener maintain one FacesContext instance per Web Flow request. --&gt;</span>
	<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"facesContextListener"</span>
		<span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.faces.webflow.FlowFacesContextLifecycleListener"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
		</pre>

		<p>
			The following is an example of the same in Java configuration:
		</p>

		<pre class="programlisting">
<span class="hl-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hl-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hl-keyword">import</span> org.springframework.faces.config.*;

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebFlowConfig <span class="hl-keyword">extends</span> AbstractFacesFlowConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
        <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
                .addFlowExecutionListener(<span class="hl-keyword">new</span> FlowFacesContextLifecycleListener())
                .build();
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
        <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
                .setBasePath(<span class="hl-string">"/WEB-INF"</span>)
                .addFlowLocationPattern(<span class="hl-string">"**/*-flow.xml"</span>).build();

}
		</pre>

		<p>The main points are the installation of a
		<code class="code">FlowFacesContextLifecycleListener</code> that manages a single
		FacesContext for the duration of Web Flow request and the use of the
		<code class="code">flow-builder-services</code> element from the <code class="code">faces</code>
		custom namespace to configure rendering for a JSF environment.</p>

		<p>In a JSF environment you'll also need this Spring MVC related
		configuration:</p>

		<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
		 <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
		 <span class="hl-attribute">xmlns:faces</span>=<span class="hl-value">"http://www.springframework.org/schema/faces"</span>
		 <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
			 http://www.springframework.org/schema/beans
			 http://www.springframework.org/schema/beans/spring-beans.xsd
			 http://www.springframework.org/schema/faces
			 http://www.springframework.org/schema/faces/spring-faces.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;faces:resources /&gt;</span>

	<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.faces.webflow.JsfFlowHandlerAdapter"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
		</pre>

		<p>The <code class="code">resources</code> custom namespace element delegates JSF
		resource requests to the JSF resource API. The
		<code class="code">JsfFlowHandlerAdapter</code> is a replacement for the
		<code class="code">FlowHandlerAdapter</code> normally used with Web Flow. This adapter
		initializes itself with a <code class="code">JsfAjaxHandler</code> instead of the
		<code class="code">SpringJavaSciprtAjaxHandler</code>.</p>

		<p>When using Java config, the <code class="classname">AbstractFacesFlowConfiguration</code>
		base class automatically registers <code class="classname">JsfResourceRequestHandler</code>
		so there is nothing further to do.
		</p>

	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-managed-beans" href="#spring-faces-managed-beans"></a>13.4.&nbsp;Replacing the JSF Managed Bean Facility</h2></div></div></div>
		

		<p>When using JSF with Spring Web Flow you can completely replace the
		JSF managed bean facility with a combination of Web Flow managed variables
		and Spring managed beans. It gives you a good deal more control over the
		lifecycle of your managed objects with well-defined hooks for
		initialization and execution of your domain model. Additionally, since you
		are presumably already using Spring for your business layer, it reduces
		the conceptual overhead of having to maintain two different managed bean
		models.</p>

		<p>In doing pure JSF development, you will quickly find that request
		scope is not long-lived enough for storing conversational model objects
		that drive complex event-driven views. In JSF the usual option is to begin
		putting things into session scope, with the extra
		burden of needing to clean the objects up before progressing to another
		view or functional area of the application. What is really needed is a
		managed scope that is somewhere between request and session scope. JSF
		provides flash and view scopes that can be accessed programmatically via
		UIViewRoot.getViewMap(). Spring Web Flow provides access to flash, view,
		flow, and conversation scopes. These scopes are seamlessly integrated
		through JSF variable resolvers and work the same in all JSF
		applications.</p>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-flow-variables" href="#spring-faces-flow-variables"></a>13.4.1.&nbsp;Using Flow Variables</h3></div></div></div>
			

			<p>The easiest and most natural way to declare and manage the model
			is through the use of <a class="link" href="#flow-variables" title="3.8.&nbsp;Variables">flow
			variables</a>. You can declare these variables at the beginning of
			the flow:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span><span class="hl-tag">/&gt;</span>
			</pre>

			<p>and then reference this variable in one of the flow's JSF view
			templates through EL:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;h:inputText</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchString"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{searchCriteria.searchString}"</span><span class="hl-tag">/&gt;</span>
			</pre>

			<p>Note that you do not need to prefix the variable with its scope
			when referencing it from the template (though you can do so if you need
			to be more specific). As with standard JSF beans, all available scopes
			will be searched for a matching variable, so you could change the scope
			of the variable in your flow definition without having to modify the EL
			expressions that reference it.</p>

			<p>You can also define view instance variables that are scoped to the
			current view and get cleaned up automatically upon transitioning to
			another view. This is quite useful with JSF as views are often
			constructed to handle multiple in-page events across many requests
			before transitioning to another view.</p>

			<p>To define a view instance variable, you can use the
			<code class="code">var</code> element inside a <code class="code">view-state</code>
			definition:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterSearchCriteria"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-spring-beans" href="#spring-faces-spring-beans"></a>13.4.2.&nbsp;Using Scoped Spring Beans</h3></div></div></div>
			

			<p>Though defining autowired flow instance variables provides nice
			modularization and readability, occasions may arise where you want to
			utilize the other capabilities of the Spring container such as AOP. In
			these cases, you can define a bean in your Spring ApplicationContext and
			give it a specific web flow scope:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"flow"</span><span class="hl-tag">/&gt;</span>
			</pre>

			<p>The major difference with this approach is that the bean will not
			be fully initialized until it is first accessed via an EL expression.
			This sort of lazy instantiation via EL is quite similar to how JSF
			managed beans are typically allocated.</p>
		</div>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="faces-manipulating-model" href="#faces-manipulating-model"></a>13.4.3.&nbsp;Manipulating The Model</h3></div></div></div>
			

			<p>The need to initialize the model before view rendering (such as by
			loading persistent entities from a database) is quite common, but JSF by
			itself does not provide any convenient hooks for such initialization.
			The flow definition language provides a natural facility for this
			through its <a class="link" href="#flow-actions" title="3.6.&nbsp;Actions">Actions</a> . Spring Web
			Flow provides some extra conveniences for converting the outcome of an
			action into a JSF-specific data structure. For example:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
	<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findBookings(currentUser.name)"</span>
				<span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.bookings"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
			</pre>

			<p>This will take the result of the
			<code class="code">bookingService.findBookings</code> method an wrap it in a custom
			JSF DataModel so that the list can be used in a standard JSF DataTable
			component:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;h:dataTable</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookings"</span> <span class="hl-attribute">styleClass</span>=<span class="hl-value">"summary"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{bookings}"</span> <span class="hl-attribute">var</span>=<span class="hl-value">"booking"</span>
			<span class="hl-attribute">rendered</span>=<span class="hl-value">"#{bookings.rowCount &gt; 0}"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;h:column&gt;</span>
		<span class="hl-tag">&lt;f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span><span class="hl-tag">&gt;</span>Name<span class="hl-tag">&lt;/f:facet&gt;</span>
		#{booking.hotel.name}
	<span class="hl-tag">&lt;/h:column&gt;</span>
	<span class="hl-tag">&lt;h:column&gt;</span>
	<span class="hl-tag">&lt;f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span><span class="hl-tag">&gt;</span>Confirmation number<span class="hl-tag">&lt;/f:facet&gt;</span>
		#{booking.id}
		<span class="hl-tag">&lt;/h:column&gt;</span>
	<span class="hl-tag">&lt;h:column&gt;</span>
		<span class="hl-tag">&lt;f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span><span class="hl-tag">&gt;</span>Action<span class="hl-tag">&lt;/f:facet&gt;</span>
		<span class="hl-tag">&lt;h:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Cancel"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"cancelBooking"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/h:column&gt;</span>
<span class="hl-tag">&lt;/h:dataTable&gt;</span>
			</pre>
		</div>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="faces-data-model-implementations" href="#faces-data-model-implementations"></a>13.4.4.&nbsp;Data Model Implementations</h3></div></div></div>
			

			<p>In the example above result-type="dataModel" results in the
			wrapping of List&lt;Booking&gt; with custom
			<code class="classname">DataModel</code> type. The custom
			<code class="classname">DataModel</code> provides extra conveniences such as
			being serializable for storage beyond request scope as well as access to
			the currently selected row in EL expressions. For example, on postback
			from a view where the action event was fired by a component within a
			DataTable, you can take action on the selected row's model
			instance:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancelBooking"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.cancelBooking(bookings.selectedRow)"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>

			<p>Spring Web Flow provides two custom DataModel types:
			<code class="classname">OneSelectionTrackingListDataModel</code> and
			<code class="classname">ManySelectionTrackingListDataModel</code>. As the names
			indicate they keep track of one or multiple selected rows. This is done
			with the help of a
			<code class="classname">SelectionTrackingActionListener</code> listener, which
			responds to JSF action events and invokes the appopriate methods on the
			<code class="classname">SelectinAware</code> data models to record the currently
			clicked row.</p>

			<p>To understand how this is configured, keep in mind the
			<code class="classname">FacesConversionService</code> registers a
			<code class="classname">DataModelConverter</code> against the alias "dataModel"
			on startup. When result-type="dataModel" is used in a flow definition it
			causes the <code class="classname">DataModelConverter</code> to be used. The
			converter then wraps the given List with an instance of
			<code class="classname">OneSelectionTrackingListDataModel</code>. To use the
			<code class="classname">ManySelectionTrackingListDataModel</code> you will need
			to register your own custom converter.</p>
		</div>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-event-handling" href="#spring-faces-event-handling"></a>13.5.&nbsp;Handling JSF Events With Spring Web Flow</h2></div></div></div>
		

		<p>Spring Web Flow allows you to handle JSF action events in a
		decoupled way, requiring no direct dependencies in your Java code on JSF
		API's. In fact, these events can often be handled completely in the flow
		definiton language without requiring any custom Java action code at all.
		This allows for a more agile development process since the artifacts being
		manipulated in wiring up events (JSF view templates and SWF flow
		definitions) are instantly refreshable without requiring a build and
		re-deploy of the whole application.</p>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-in-page-events" href="#spring-faces-in-page-events"></a>13.5.1.&nbsp;Handling JSF In-page Action Events</h3></div></div></div>
			

			<p>A simple but common case in JSF is the need to signal an event
			that causes manipulation of the model in some way and then redisplays
			the same view to reflect the changed state of the model. The flow
			definition language has special support for this in the
			<code class="code">transition</code> element.</p>

			<p>A good example of this is a table of paged list results. Suppose
			you want to be able to load and display only a portion of a large result
			list, and allow the user to page through the results. The initial
			<code class="code">view-state</code> definition to load and display the list would
			be:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-render&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
					<span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-render&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>

			<p>You construct a JSF DataTable that displays the current
			<code class="code">hotels</code> list, and then place a "More Results" link below the
			table:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;h:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"nextPageLink"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"More Results"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"next"</span><span class="hl-tag">/&gt;</span>
			</pre>

			<p>This commandLink signals a "next" event from its action attribute.
			You can then handle the event by adding to the <code class="code">view-state</code>
			definition:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-render&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
			<span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-render&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>

			<p>Here you handle the "next" event by incrementing the page count on
			the searchCriteria instance. The <code class="code">on-render</code> action is then
			called again with the updated criteria, which causes the next page of
			results to be loaded into the DataModel. The same view is re-rendered
			since there was no <code class="code">to</code> attribute on the
			<code class="code">transition</code> element, and the changes in the model are
			reflected in the view.</p>
		</div>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-action-events" href="#spring-faces-action-events"></a>13.5.2.&nbsp;Handling JSF Action Events</h3></div></div></div>
			

			<p>The next logical level beyond in-page events are events that
			require navigation to another view, with some manipulation of the model
			along the way. Achieving this with pure JSF would require adding a
			navigation rule to faces-config.xml and likely some intermediary Java
			code in a JSF managed bean (both tasks requiring a re-deploy). With the
			flow defintion language, you can handle such a case concisely in one
			place in a quite similar way to how in-page events are handled.</p>

			<p>Continuing on with our use case of manipulating a paged list of
			results, suppose we want each row in the displayed DataTable to contain
			a link to a detail page for that row instance. You can add a column to
			the table containing the following <code class="code">commandLink</code>
			component:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;h:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewHotelLink"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"View Hotel"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"select"</span><span class="hl-tag">/&gt;</span>
			</pre>

			<p>This raises the "select" event which you can then handle by adding
			another <code class="code">transition</code> element to the existing
			<code class="code">view-state</code> :</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-render&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
			<span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-render&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"select"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotel"</span><span class="hl-tag">&gt;</span>
			<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowScope.hotel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"hotels.selectedRow"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>

			<p>Here the "select" event is handled by pushing the currently
			selected hotel instance from the DataTable into flow scope, so that it
			may be referenced by the "reviewHotel" <code class="code">view-state</code> .</p>
		</div>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-model-validation" href="#spring-faces-model-validation"></a>13.5.3.&nbsp;Performing Model Validation</h3></div></div></div>
			

			<p>JSF provides useful facilities for validating input at field-level
			before changes are applied to the model, but when you need to then
			perform more complex validation at the model-level after the updates
			have been applied, you are generally left with having to add more custom
			code to your JSF action methods in the managed bean. Validation of this
			sort is something that is generally a responsibility of the domain model
			itself, but it is difficult to get any error messages propagated back to
			the view without introducing an undesirable dependency on the JSF API in
			your domain layer.</p>

			<p>With Web Flow, you can utilize the generic and low-level
			<code class="code">MessageContext</code> in your business code and any messages added
			there will then be available to the <code class="code">FacesContext</code> at render
			time.</p>

			<p>For example, suppose you have a view where the user enters the
			necessary details to complete a hotel booking, and you need to ensure
			the Check In and Check Out dates adhere to a given set of business
			rules. You can invoke such model-level validation from a
			<code class="code">transition</code> element:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.validateEnterBookingDetails(messageContext)"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>

			<p>Here the "proceed" event is handled by invoking a model-level
			validation method on the booking instance, passing the generic
			<code class="code">MessageContext</code> instance so that messages may be recorded.
			The messages can then be displayed along with any other JSF messages
			with the <code class="code">h:messages</code> component,</p>

			<p></p>
		</div>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-ajax-events-jsf2" href="#spring-faces-ajax-events-jsf2"></a>13.5.4.&nbsp;Handling Ajax Events In JSF</h3></div></div></div>
			

			<p>JSF provides built-in support for sending Ajax requests and
			performing partial processing and rendering on the server-side. You can
			specify a list of id's for partial rendering through the &lt;f:ajax&gt;
			facelets tag.</p>

			<p>In Spring Web Flow you also have the option to specify the ids to
			use for partial rendering on the server side with the render
			action:</p>

			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;on-render&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
					<span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/on-render&gt;</span>
	<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotels:searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
	<span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-embedded-mode" href="#spring-faces-embedded-mode"></a>13.6.&nbsp;Embedding a Flow On a Page</h2></div></div></div>
		

		<p>By default when a flow enters a view state, it executes a
		client-side redirect before rendering the view. This approach is known as
		POST-REDIRECT-GET. It has the advantage of separating the form processing
		for one view from the rendering of the next view. As a result the browser
		Back and Refresh buttons work seamlessly without causing any browser
		warnings.</p>

		<p>Normally the client-side redirect is transparent from a user's
		perspective. However, there are situations where POST-REDIRECT-GET may not
		bring the same benefits. For example sometimes it may be useful to embed
		a flow on a page and drive it via Ajax requests refreshing only the area
		of the page where the flow is rendered. Not only is it unnecessary to use
		client-side redirects in this case, it is also not the desired behavior
		with regards to keeping the surrounding content of the page intact.</p>

		<p>To indicate a flow should execute in "page embedded" mode all
		you need to do is pass an extra flow input attribute called "mode"
		with a value of "embedded". Below is an example of a top-level
		container flow invoking a sub-flow in an embedded mode:</p>

		<pre class="programlisting">
<span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookHotel"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mode"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"'embedded'"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/subflow-state&gt;</span>
		</pre>

		<p>When launched in "page embedded" mode the sub-flow will not issue
		flow execution redirects during Ajax requests.</p>

		<p>If you'd like to see examples of an embedded flow please refer to
		the webflow-primefaces-showcase project. You can check out
		the source code locally, build it as you would a Maven project, and import
		it into Eclipse:</p>

		<pre class="programlisting">cd some-directory
svn co https://src.springframework.org/svn/spring-samples/webflow-primefaces-showcase
cd webflow-primefaces-showcase
mvn package
# import into Eclipse</pre>

		<p>The specific example you need to look at is under the "Advanced Ajax"
			tab and is called "Top Flow with Embedded Sub-Flow".</p>

	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-redirect-in-same-state" href="#spring-faces-redirect-in-same-state"></a>13.7.&nbsp;Redirect In Same State</h2></div></div></div>
		

		<p>
			By default Web Flow does a client-side redirect even it it remains in the same view state as long as the current request is not an Ajax request.
			This is quite useful after form validation failures for example.
			If the user hits Refresh or Back they won't see any browser warnings.
			They would if the Web Flow didn't do a redirect.
		</p>
		<p>
			This can lead to a problem specific to JSF environments where a specific Sun Mojarra listener component caches the FacesContext assuming the same instance is available throughout the JSF lifecycle.
			In Web Flow however the render phase is temporarily put on hold and a client-side redirect executed.
		</p>
		<p>
			The default behavior of Web Flow is desirable and it is unlikely JSF applications will experience the issue.
			This is because Ajax is often enabled the default in JSF component libraries and Web Flow does not redirect during Ajax requests.
			However if you experience this issue you can disable client-side redirects within the same view as follows:
			</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;webflow:flow-execution-attributes&gt;</span>
		<span class="hl-tag">&lt;webflow:redirect-in-same-state</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
	<span class="hl-tag">&lt;/webflow:flow-execution-attributes&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-executor&gt;</span>
			</pre><p>
		</p>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-file-upload" href="#spring-faces-file-upload"></a>13.8.&nbsp;Handling File Uploads with JSF</h2></div></div></div>
		

		<p>Most JSF component providers include some form of 'file upload' component. Generally when working
		with these components JSF must take complete control of parsing multi-part requests and Spring MVC's
		<code class="code">MultipartResolver</code> cannot be used.</p>

		<p>Spring Web Flow has been tested with file upload components from PrimeFaces. Check the
		documentation of your JSF component library for other providers to see how to configure file upload.</p>

		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e1950" href="#d5e1950"></a>13.8.1.&nbsp;File Uploads with PrimeFaces</h3></div></div></div>
			
			<p>PrimeFaces provides a <code class="code">&lt;p:fileUpload&gt;</code> component for uploading files. In order
			to use the component you need to configure the <code class="code">org.primefaces.webapp.filter.FileUploadFilter</code>
			servlet filter. The filter needs to be configured against Spring MVC's
			<code class="code">DispatcherServlet</code> in your <code class="code">web.xml</code>:</p>
			<pre class="programlisting"><span class="hl-tag">&lt;filter&gt;</span>
	<span class="hl-tag">&lt;filter-name&gt;</span>PrimeFaces FileUpload Filter<span class="hl-tag">&lt;/filter-name&gt;</span>
	<span class="hl-tag">&lt;filter-class&gt;</span>org.primefaces.webapp.filter.FileUploadFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>
<span class="hl-tag">&lt;filter-mapping&gt;</span>
	<span class="hl-tag">&lt;filter-name&gt;</span>PrimeFaces FileUpload Filter<span class="hl-tag">&lt;/filter-name&gt;</span>
	<span class="hl-tag">&lt;servlet-name&gt;</span>Spring MVC Dispatcher Servlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span>

<span class="hl-tag">&lt;context-param&gt;</span>
	<span class="hl-tag">&lt;param-name&gt;</span>primefaces.UPLOADER<span class="hl-tag">&lt;/param-name&gt;</span>
	<span class="hl-tag">&lt;param-value&gt;</span>commons<span class="hl-tag">&lt;/param-value&gt;</span>
<span class="hl-tag">&lt;/context-param&gt;</span>
			</pre>
			<p>For more details refer to the
			<a class="ulink" href="http://primefaces.org/documentation.html" target="_top">PrimeFaces documentation</a>.</p>
		</div>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-security-taglib" href="#spring-faces-security-taglib"></a>13.9.&nbsp;Using the Spring Security Facelets Tag Library</h2></div></div></div>
		

		<p>To use the library you'll need to create a <code class="code">.taglib.xml</code>
		file and register it in <code class="code">web.xml</code>.</p>

		<p>Create the file
		<code class="code">/WEB-INF/springsecurity.taglib.xml</code> with the following
		content:</p>

		<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0"?&gt;</span>
<strong class="hl-tag" style="color: blue">&lt;!DOCTYPE facelet-taglib PUBLIC
"-//Sun Microsystems, Inc.//DTD Facelet Taglib 1.0//EN"
"http://java.sun.com/dtd/facelet-taglib_1_0.dtd"&gt;</strong>
<span class="hl-tag">&lt;facelet-taglib&gt;</span>
	<span class="hl-tag">&lt;namespace&gt;</span>http://www.springframework.org/security/tags<span class="hl-tag">&lt;/namespace&gt;</span>
	<span class="hl-tag">&lt;tag&gt;</span>
		<span class="hl-tag">&lt;tag-name&gt;</span>authorize<span class="hl-tag">&lt;/tag-name&gt;</span>
		<span class="hl-tag">&lt;handler-class&gt;</span>org.springframework.faces.security.FaceletsAuthorizeTagHandler<span class="hl-tag">&lt;/handler-class&gt;</span>
	<span class="hl-tag">&lt;/tag&gt;</span>
	<span class="hl-tag">&lt;function&gt;</span>
		<span class="hl-tag">&lt;function-name&gt;</span>areAllGranted<span class="hl-tag">&lt;/function-name&gt;</span>
		<span class="hl-tag">&lt;function-class&gt;</span>org.springframework.faces.security.FaceletsAuthorizeTagUtils<span class="hl-tag">&lt;/function-class&gt;</span>
		<span class="hl-tag">&lt;function-signature&gt;</span>boolean areAllGranted(java.lang.String)<span class="hl-tag">&lt;/function-signature&gt;</span>
	<span class="hl-tag">&lt;/function&gt;</span>
	<span class="hl-tag">&lt;function&gt;</span>
		<span class="hl-tag">&lt;function-name&gt;</span>areAnyGranted<span class="hl-tag">&lt;/function-name&gt;</span>
		<span class="hl-tag">&lt;function-class&gt;</span>org.springframework.faces.security.FaceletsAuthorizeTagUtils<span class="hl-tag">&lt;/function-class&gt;</span>
		<span class="hl-tag">&lt;function-signature&gt;</span>boolean areAnyGranted(java.lang.String)<span class="hl-tag">&lt;/function-signature&gt;</span>
	<span class="hl-tag">&lt;/function&gt;</span>
	<span class="hl-tag">&lt;function&gt;</span>
		<span class="hl-tag">&lt;function-name&gt;</span>areNotGranted<span class="hl-tag">&lt;/function-name&gt;</span>
		<span class="hl-tag">&lt;function-class&gt;</span>org.springframework.faces.security.FaceletsAuthorizeTagUtils<span class="hl-tag">&lt;/function-class&gt;</span>
		<span class="hl-tag">&lt;function-signature&gt;</span>boolean areNotGranted(java.lang.String)<span class="hl-tag">&lt;/function-signature&gt;</span>
	<span class="hl-tag">&lt;/function&gt;</span>
	<span class="hl-tag">&lt;function&gt;</span>
		<span class="hl-tag">&lt;function-name&gt;</span>isAllowed<span class="hl-tag">&lt;/function-name&gt;</span>
		<span class="hl-tag">&lt;function-class&gt;</span>org.springframework.faces.security.FaceletsAuthorizeTagUtils<span class="hl-tag">&lt;/function-class&gt;</span>
		<span class="hl-tag">&lt;function-signature&gt;</span>boolean isAllowed(java.lang.String, java.lang.String)<span class="hl-tag">&lt;/function-signature&gt;</span>
	<span class="hl-tag">&lt;/function&gt;</span>
<span class="hl-tag">&lt;/facelet-taglib&gt;</span>
		</pre>

		<p>Next, register the above file taglib in web.xml:</p>

		<pre class="programlisting"><span class="hl-tag">&lt;context-param&gt;</span>
	<span class="hl-tag">&lt;param-name&gt;</span>javax.faces.FACELETS_LIBRARIES<span class="hl-tag">&lt;/param-name&gt;</span>
	<span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/springsecurity.taglib.xml<span class="hl-tag">&lt;/param-value&gt;</span>
<span class="hl-tag">&lt;/context-param&gt;</span>
		</pre>

		<p>Now you are ready to use the tag library in your views. You can use
		the authorize tag to include nested content conditionally:</p>

		<pre class="programlisting"><strong class="hl-tag" style="color: blue">&lt;!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</strong>
<span class="hl-tag">&lt;ui:composition</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.w3.org/1999/xhtml"</span>
	<span class="hl-attribute">xmlns:ui</span>=<span class="hl-value">"http://java.sun.com/jsf/facelets"</span>
	<span class="hl-attribute">xmlns:h</span>=<span class="hl-value">"http://java.sun.com/jsf/html"</span>
	<span class="hl-attribute">xmlns:sec</span>=<span class="hl-value">"http://www.springframework.org/security/tags"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;sec:authorize</span> <span class="hl-attribute">ifAllGranted</span>=<span class="hl-value">"ROLE_FOO, ROLE_BAR"</span><span class="hl-tag">&gt;</span>
		Lorem ipsum dolor sit amet
	<span class="hl-tag">&lt;/sec:authorize&gt;</span>

	<span class="hl-tag">&lt;sec:authorize</span> <span class="hl-attribute">ifNotGranted</span>=<span class="hl-value">"ROLE_FOO, ROLE_BAR"</span><span class="hl-tag">&gt;</span>
		Lorem ipsum dolor sit amet
	<span class="hl-tag">&lt;/sec:authorize&gt;</span>

	<span class="hl-tag">&lt;sec:authorize</span> <span class="hl-attribute">ifAnyGranted</span>=<span class="hl-value">"ROLE_FOO, ROLE_BAR"</span><span class="hl-tag">&gt;</span>
		Lorem ipsum dolor sit amet
	<span class="hl-tag">&lt;/sec:authorize&gt;</span>

<span class="hl-tag">&lt;/ui:composition&gt;</span>
		</pre>

		<p>You can also use one of several EL functions in the rendered or
		other attribute of any JSF component:</p>

		<pre class="programlisting"><strong class="hl-tag" style="color: blue">&lt;!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</strong>
<span class="hl-tag">&lt;ui:composition</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.w3.org/1999/xhtml"</span>
	<span class="hl-attribute">xmlns:ui</span>=<span class="hl-value">"http://java.sun.com/jsf/facelets"</span>
	<span class="hl-attribute">xmlns:h</span>=<span class="hl-value">"http://java.sun.com/jsf/html"</span>
	<span class="hl-attribute">xmlns:sec</span>=<span class="hl-value">"http://www.springframework.org/security/tags"</span><span class="hl-tag">&gt;</span>

	<span class="hl-comment">&lt;!-- Rendered only if user has all of the listed roles --&gt;</span>
	<span class="hl-tag">&lt;h:outputText</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Lorem ipsum dolor sit amet"</span> <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{sec:areAllGranted('ROLE_FOO, ROLE_BAR')}"</span><span class="hl-tag">/&gt;</span>

	<span class="hl-comment">&lt;!-- Rendered only if user does not have any of the listed roles --&gt;</span>
	<span class="hl-tag">&lt;h:outputText</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Lorem ipsum dolor sit amet"</span> <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{sec:areNotGranted('ROLE_FOO, ROLE_BAR')}"</span><span class="hl-tag">/&gt;</span>

	<span class="hl-comment">&lt;!-- Rendered only if user has any of the listed roles --&gt;</span>
	<span class="hl-tag">&lt;h:outputText</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Lorem ipsum dolor sit amet"</span> <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{sec:areAnyGranted('ROLE_FOO, ROLE_BAR')}"</span><span class="hl-tag">/&gt;</span>

	<span class="hl-comment">&lt;!-- Rendered only if user has access to given HTTP method/URL as defined in Spring Security configuration --&gt;</span>
	<span class="hl-tag">&lt;h:outputText</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Lorem ipsum dolor sit amet"</span> <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{sec:isAllowed('/secured/foo', 'POST')}"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/ui:composition&gt;</span>
		</pre>
	</div>

	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-component-libraries" href="#spring-faces-component-libraries"></a>13.10.&nbsp;Third-Party Component Library Integration</h2></div></div></div>
		

		<p>The Spring Web Flow JSF integration strives to be compatible with
		any third-party JSF component library. By honoring all of the standard
		semantics of the JSF specification within the SWF-driven JSF lifecycle,
		third-party libraries in general should "just work". The main thing to
		remember is that configuration in web.xml will change slightly since Web
		Flow requests are not routed through the standard FacesServlet. Typically,
		anything that is traditionally mapped to the FacesServlet should be mapped
		to the Spring DispatcherServlet instead. (You can also map to both if for
		example you are migrating a legacy JSF application page-by-page.).</p>
	</div>
</div>
	<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="testing" href="#testing"></a>14.&nbsp;Testing flows</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-introduction" href="#testing-introduction"></a>14.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter shows you how to test flows.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extending-abstractflowexecutiontest" href="#extending-abstractflowexecutiontest"></a>14.2.&nbsp;Extending AbstractXmlFlowExecutionTests</h2></div></div></div>
		
		<p>
			To test the execution of a XML-based flow definition, extend <code class="code">AbstractXmlFlowExecutionTests</code>:
		</p>
		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingFlowExecutionTests <span class="hl-keyword">extends</span> AbstractXmlFlowExecutionTests {

}
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="override-getResource" href="#override-getResource"></a>14.3.&nbsp;Specifying the path to the flow to test</h2></div></div></div>
		
		<p>
			At a minimum, you must override <code class="code">getResource(FlowDefinitionResourceFactory)</code> to return the path to the flow you wish to test:
		</p>
		<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> FlowDefinitionResource getResource(FlowDefinitionResourceFactory resourceFactory) {
	<span class="hl-keyword">return</span> resourceFactory.createFileResource(<span class="hl-string">"src/main/webapp/WEB-INF/hotels/booking/booking.xml"</span>);
}
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="override-configureFlowBuilderContext" href="#override-configureFlowBuilderContext"></a>14.4.&nbsp;Registering flow dependencies</h2></div></div></div>
		
		<p>
			If your flow has dependencies on externally managed services,
			also override <code class="code">configureFlowBuilderContext(MockFlowBuilderContext)</code> to register stubs or mocks of those services:
		</p>
		<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configureFlowBuilderContext(MockFlowBuilderContext builderContext) {
	builderContext.registerBean(<span class="hl-string">"bookingService"</span>, <span class="hl-keyword">new</span> StubBookingService());
}
		</pre>
		<p>
			If your flow extends from another flow, or has states that extend other states,
			also override <code class="code">getModelResources(FlowDefinitionResourceFactory)</code> to return the path to the parent flows.
		</p>
		<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">protected</span> FlowDefinitionResource[] getModelResources(FlowDefinitionResourceFactory resourceFactory) {
<span class="hl-keyword">return</span> <span class="hl-keyword">new</span> FlowDefinitionResource[] {
	   resourceFactory.createFileResource(<span class="hl-string">"src/main/webapp/WEB-INF/common/common.xml"</span>)
};
}
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-flowstartup" href="#testing-flowstartup"></a>14.5.&nbsp;Testing flow startup</h2></div></div></div>
		
		<p>
			Have your first test exercise the startup of your flow:
		</p>
		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testStartBookingFlow() {

	Booking booking = createTestBooking();

	MutableAttributeMap input = <span class="hl-keyword">new</span> LocalAttributeMap();
	input.put(<span class="hl-string">"hotelId"</span>, <span class="hl-string">"1"</span>);
	MockExternalContext context = <span class="hl-keyword">new</span> MockExternalContext();
	context.setCurrentUser(<span class="hl-string">"keith"</span>);
	startFlow(input, context);

	assertCurrentStateEquals(<span class="hl-string">"enterBookingDetails"</span>);
	assertTrue(getRequiredFlowAttribute(<span class="hl-string">"booking"</span>) <span class="hl-keyword">instanceof</span> Booking);
}
		</pre>
		<p>
			Assertions generally verify the flow is in the correct state you expect.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-flowevents" href="#testing-flowevents"></a>14.6.&nbsp;Testing flow event handling</h2></div></div></div>
		
		<p>
			Define additional tests to exercise flow event handling behavior.
			You goal should be to exercise all paths through the flow.
			You can use the convenient <code class="code">setCurrentState(String)</code> method to jump to the flow state where you wish to begin your test.
		</p>
		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testEnterBookingDetails_Proceed() {

	setCurrentState(<span class="hl-string">"enterBookingDetails"</span>);

	getFlowScope().put(<span class="hl-string">"booking"</span>, createTestBooking());

	MockExternalContext context = <span class="hl-keyword">new</span> MockExternalContext();
	context.setEventId(<span class="hl-string">"proceed"</span>);
	resumeFlow(context);

	assertCurrentStateEquals(<span class="hl-string">"reviewBooking"</span>);
}
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-mockingsubflows" href="#testing-mockingsubflows"></a>14.7.&nbsp;Mocking a subflow</h2></div></div></div>
		
		<p>
			To test calling a subflow, register a mock implementation of the subflow that asserts input was passed in correctly and
			returns the correct outcome for your test scenario.
		</p>
		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testBookHotel() {

	setCurrentState(<span class="hl-string">"reviewHotel"</span>);

	Hotel hotel = <span class="hl-keyword">new</span> Hotel();
	hotel.setId(<span class="hl-number">1L</span>);
	hotel.setName(<span class="hl-string">"Jameson Inn"</span>);
	getFlowScope().put(<span class="hl-string">"hotel"</span>, hotel);

	getFlowDefinitionRegistry().registerFlowDefinition(createMockBookingSubflow());

	MockExternalContext context = <span class="hl-keyword">new</span> MockExternalContext();
	context.setEventId(<span class="hl-string">"book"</span>);
	resumeFlow(context);

	<span class="hl-comment">// verify flow ends on 'bookingConfirmed'</span>
	assertFlowExecutionEnded();
	assertFlowExecutionOutcomeEquals(<span class="hl-string">"finish"</span>);
}

<span class="hl-keyword">public</span> Flow createMockBookingSubflow() {
	Flow mockBookingFlow = <span class="hl-keyword">new</span> Flow(<span class="hl-string">"booking"</span>);
	mockBookingFlow.setInputMapper(<span class="hl-keyword">new</span> Mapper() {
		<span class="hl-keyword">public</span> MappingResults map(Object source, Object target) {
			<span class="hl-comment">// assert that 1L was passed in as input</span>
			assertEquals(<span class="hl-number">1L</span>, ((AttributeMap) source).get(<span class="hl-string">"hotelId"</span>));
			<span class="hl-keyword">return</span> null;
		}
	});
	<span class="hl-comment">// immediately return the bookingConfirmed outcome so the caller can respond</span>
	<span class="hl-keyword">new</span> EndState(mockBookingFlow, <span class="hl-string">"bookingConfirmed"</span>);
	<span class="hl-keyword">return</span> mockBookingFlow;
}
		</pre>
	</div>
</div>
	<div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="field-mappings" href="#field-mappings"></a>Appendix&nbsp;A.&nbsp;Flow Definition Language 1.0 to 2.0 Mappings</h1></div></div></div>
	
	<p>
		The flow definition language has changed since the 1.0 release.
		This is a listing of the language elements in the 1.0 release, and how they map to elements in the 2.0 release.
		While most of the changes are semantic, there are a few structural changes.
		Please see the upgrade guide for more details about changes between Web Flow 1.0 and 2.0.
	</p>
	<div class="table"><a name="field-mappings-table" href="#field-mappings-table"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Mappings</b></p><div class="table-contents">
		
		<table summary="Mappings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="1.0-element"><col class="1.0-attribute"><col class="2.0-element"><col class="2.0-attribute"><col class="comments"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						SWF 1.0
					</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						SWF 2.0
					</th><th style="border-bottom: 0.5pt solid ; ">
						Comments
					</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>action</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						method
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>action-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>action-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>argument</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate expression="func(arg1, arg2, ...)"/&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						expression
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parameter-type
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>attribute</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>attribute</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>attribute-mapper</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						input and output elements can be in flows or subflows directly
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						now subflow-attribute-mapper attribute on subflow-state
					</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>bean-action</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						method
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>decision-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>decision-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>end-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-end</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>end-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>end-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						commit
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>entry-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-entry</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>evaluate-action</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>evaluate</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						expression
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						expression
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate ...&gt; &lt;attribute name=&#8221;name&#8221; value="..." /&gt; &lt;/evaluate&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						result
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						result-type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>evaluation-result</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate result="..." /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>exception-handler</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>exception-handler</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>exit-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-exit</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>flow</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>flow</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						start-state
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						abstract
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>global-transitions</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>global-transitions</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>if</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>if</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						test
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						test
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						then
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						then
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						else
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						else
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>import</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>bean-import</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						resource
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						resource
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>inline-flow</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						convert to new top-level flow
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input-attribute</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						prefix name with scope &lt;input name="flowScope.foo" /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input-mapper</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						inputs can be in flows and subflows directly
					</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>mapping</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input or output</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						source
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name or value
					</td><td style="border-bottom: 0.5pt solid ; ">
						name when in flow element, value when in subflow-state element
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						target
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name or value
					</td><td style="border-bottom: 0.5pt solid ; ">
						value when in flow element, name when in subflow-state element
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						target-collection
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						no longer supported
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						from
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						detected automatically
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						to
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>method-argument</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate expression="func(arg1, arg2, ...)"/&gt;
					</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>method-result</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate result="..." /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>output-attribute</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>output</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						prefix name with scope &lt;output name="flowScope.foo" /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>output-mapper</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						output can be in flows and subflows directly
					</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>render-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-render</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>set</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>set</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						attribute
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						prefix name with scope &lt;set name="flowScope.foo" /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;set ...&gt; &lt;attribute name=&#8221;name&#8221; value="..." /&gt; &lt;/set&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>start-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-start</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>start-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						now &lt;flow start-state="..."&gt;, or defaults to the first state in the flow
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						idref
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>subflow-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>subflow-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						flow
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						subflow
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						subflow-attribute-mapper
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>transition</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>transition</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on-exception
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on-exception
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						to
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						to
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bind
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						validate
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						history
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>value</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>value</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>var</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>var</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						class
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						class
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						always flow scope
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						all Spring beans can be resolved with EL
					</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>view-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>view-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						redirect
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						popup
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						model
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						history
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>persistence-context</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>render</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						fragments
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>secured</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						attributes
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						match
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody></table>
	</div></div><br class="table-break">
</div>

</div></body></html>