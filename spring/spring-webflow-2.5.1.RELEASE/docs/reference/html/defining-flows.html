<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>3.&nbsp;Defining Flows</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Web Flow Reference Guide"><link rel="up" href="index.html" title="Spring Web Flow Reference Guide"><link rel="prev" href="whatsnew.html" title="2.&nbsp;What's New"><link rel="next" href="el.html" title="4.&nbsp;Expression Language (EL)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.&nbsp;Defining Flows</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="whatsnew.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="el.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="defining-flows" href="#defining-flows"></a>3.&nbsp;Defining Flows</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="defining-flows-introduction" href="#defining-flows-introduction"></a>3.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter begins the Users Section.
			It shows how to implement flows using the flow definition language.
			By the end of this chapter you should have a good understanding of language constructs, and be capable of authoring a flow definition.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-overview" href="#flow-overview"></a>3.2.&nbsp;What is a flow?</h2></div></div></div>
		
		<p>
			A flow encapsulates a reusable sequence of steps that can execute in different contexts.
			Below is a <a class="ulink" href="http://www.jjg.net/ia/visvocab/" target="_top">Garrett Information Architecture</a> diagram illustrating a reference to a flow that encapsulates the steps of a hotel booking process:
		</p>
		<div class="mediaobject" align="center"><img src="images/hotels-site.png" align="middle"><div class="caption">
				<p>Site Map illustrating a reference to a flow</p>
			</div></div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-makeup" href="#flow-makeup"></a>3.3.&nbsp;What is the makeup of a typical flow?</h2></div></div></div>
		
		<p>
			In Spring Web Flow, a flow consists of a series of steps called "states".
			Entering a state typically results in a view being displayed to the user.
			On that view, user events occur that are handled by the state.
			These events can trigger transitions to other states which result in view navigations.
		</p>
		<p>
			The example below shows the structure of the book hotel flow referenced in the previous diagram:
		</p>
		<div class="mediaobject" align="center"><img src="images/hotels-site-bookhotel-flow.png" align="middle"><div class="caption">
				<p>Flow diagram</p>
			</div></div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-authoring" href="#flow-authoring"></a>3.4.&nbsp;How are flows authored?</h2></div></div></div>
		
		<p>
			Flows are authored by web application developers using a simple XML-based flow definition language.
			The next steps of this guide will walk you through the elements of this language.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="essential-flow-elements" href="#essential-flow-elements"></a>3.5.&nbsp;Essential language elements</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-element" href="#flow-element"></a>3.5.1.&nbsp;flow</h3></div></div></div>
			
			<p>
				Every flow begins with the following root element:
			</p>
			<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				All states of the flow are defined within this element.
				The first state defined becomes the flow's starting point.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-state-element" href="#view-state-element"></a>3.5.2.&nbsp;view-state</h3></div></div></div>
			
			<p>
				Use the <code class="code">view-state</code> element to define a step of the flow that renders a view:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				By convention, a view-state maps its id to a view template in the directory where the flow is located.
				For example, the state above might render <code class="filename">/WEB-INF/hotels/booking/enterBookingDetails.xhtml</code>
				if the flow itself was located in the <code class="filename">/WEB-INF/hotels/booking</code> directory.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="transition-element" href="#transition-element"></a>3.5.3.&nbsp;transition</h3></div></div></div>
			
			<p>
				Use the <code class="code">transition</code> element to handle events that occur within a state:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
			<p>
				These transitions drive view navigations.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="end-state-element" href="#end-state-element"></a>3.5.4.&nbsp;end-state</h3></div></div></div>
			
			<p>
				Use the <code class="code">end-state</code> element to define a flow outcome:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				When a flow transitions to a end-state it terminates and the outcome is returned.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-essential-language-elements" href="#checkpoint-essential-language-elements"></a>3.5.5.&nbsp;Checkpoint: Essential language elements</h3></div></div></div>
			
			<p>
				With the three elements <code class="code">view-state</code>, <code class="code">transition</code>, and <code class="code">end-state</code>, you can quickly express your view navigation logic.
				Teams often do this before adding flow behaviors so they can focus on developing the user interface of the application with end users first.
				Below is a sample flow that implements its view navigation logic using these elements:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-actions" href="#flow-actions"></a>3.6.&nbsp;Actions</h2></div></div></div>
		
		<p>
			Most flows need to express more than just view navigation logic.
			Typically they also need to invoke business services of the application or other actions.
		</p>
		<p>
			Within a flow, there are several points where you can execute actions.  These points are:
			</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>On flow start</p></li><li class="listitem"><p>On state entry</p></li><li class="listitem"><p>On view render</p></li><li class="listitem"><p>On transition execution</p></li><li class="listitem"><p>On state exit</p></li><li class="listitem"><p>On flow end</p></li></ul></div><p>
		</p>
		<p>
			Actions are defined using a concise expression language.  Spring Web Flow uses the Unified EL by default.
			The next few sections will cover the essential language elements for defining actions.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="evaluate-element" href="#evaluate-element"></a>3.6.1.&nbsp;evaluate</h3></div></div></div>
			
			<p>
				The action element you will use most often is the <code class="code">evaluate</code> element.
				Use the <code class="code">evaluate</code> element to evaluate an expression at a point within your flow.
				With this single tag you can invoke methods on Spring beans or any other flow variable.
				For example:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"entityManager.persist(booking)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="evaluate-element-result" href="#evaluate-element-result"></a>Assigning an evaluate result</h4></div></div></div>
				
				<p>
					If the expression returns a value, that value can be saved in the flow's data model called <code class="code">flowScope</code>:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotels"</span><span class="hl-tag"> /&gt;</span>
				</pre>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="evaluate-element-result-type" href="#evaluate-element-result-type"></a>Converting an evaluate result</h4></div></div></div>
				
				<p>
					If the expression returns a value that may need to be converted, specify the desired type using the <code class="code">result-type</code> attribute:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotels"</span>
          <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag">/&gt;</span>
				</pre>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-actions" href="#checkpoint-actions"></a>3.6.2.&nbsp;Checkpoint: flow actions</h3></div></div></div>
			
			<p>
				Now review the sample booking flow with actions added:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;on-start&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-start&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				This flow now creates a Booking object in flow scope when it starts.
				The id of the hotel to book is obtained from a flow input attribute.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inputoutput" href="#flow-inputoutput"></a>3.7.&nbsp;Input/Output Mapping</h2></div></div></div>
		
		<p>
			Each flow has a well-defined input/output contract.
			Flows can be passed input attributes when they start, and can return output attributes when they end.
			In this respect, calling a flow is conceptually similar to calling a method with the following signature:
		</p>
		<pre class="programlisting">
FlowOutcome flowId(Map&lt;String, Object&gt; inputAttributes);
		</pre>
		<p>
			... where a <code class="code">FlowOutcome</code> has the following signature:
		</p>
		<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FlowOutcome {
   <span class="hl-keyword">public</span> String getName();
   <span class="hl-keyword">public</span> Map&lt;String, Object&gt; getOutputAttributes();
}
		</pre>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="input-element" href="#input-element"></a>3.7.1.&nbsp;input</h3></div></div></div>
			
			<p>
				Use the <code class="code">input</code> element to declare a flow input attribute:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				Input values are saved in flow scope under the name of the attribute.
				For example, the input above would be saved under the name <code class="code">hotelId</code>.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-type" href="#input-element-type"></a>Declaring an input type</h4></div></div></div>
				
				<p>
					Use the <code class="code">type</code> attribute to declare the input attribute's type:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					If an input value does not match the declared type, a type conversion will be attempted.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-value" href="#input-element-value"></a>Assigning an input value</h4></div></div></div>
				
				<p>
					Use the <code class="code">value</code> attribute to specify an expression to assign the input value to:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"flowScope.myParameterObject.hotelId"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					If the expression's value type can be determined, that metadata will be used for type coersion if no <code class="code">type</code> attribute is specified.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-required" href="#input-element-required"></a>Marking an input as required</h4></div></div></div>
				
				<p>
					Use the <code class="code">required</code> attribute to enforce the input is not null or empty:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"flowScope.hotelId"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
				</pre>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="output-element" href="#output-element"></a>3.7.2.&nbsp;output</h3></div></div></div>
			
			<p>
				Use the <code class="code">output</code> element to declare a flow output attribute.
				Output attributes are declared within end-states that represent specific flow outcomes.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/end-state&gt;</span>
			</pre>
			<p>
				Output values are obtained from flow scope under the name of the attribute.
				For example, the output above would be assigned the value of the <code class="code">bookingId</code> variable.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="output-element-value" href="#output-element-value"></a>Specifying the source of an output value</h4></div></div></div>
				
				<p>
					Use the <code class="code">value</code> attribute to denote a specific output value expression:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"confirmationNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.confirmationNumber"</span><span class="hl-tag"> /&gt;</span>
				</pre>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-input-output" href="#checkpoint-input-output"></a>3.7.3.&nbsp;Checkpoint: input/output mapping</h3></div></div></div>
			
			<p>
				Now review the sample booking flow with input/output mapping:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;on-start&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-start&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> &gt;</span>
        <span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.id"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/end-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				The flow now accepts a <code class="code">hotelId</code> input attribute and returns a <code class="code">bookingId</code> output attribute
				when a new booking is confirmed.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-variables" href="#flow-variables"></a>3.8.&nbsp;Variables</h2></div></div></div>
		
		<p>
			A flow may declare one or more instance variables.
			These variables are allocated when the flow starts.
			Any <code class="code">@Autowired</code> transient references the variable holds are also rewired when the flow resumes.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="var-element" href="#var-element"></a>3.8.1.&nbsp;var</h3></div></div></div>
			
			<p>
				Use the <code class="code">var</code> element to declare a flow variable:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span><span class="hl-tag">/&gt;</span>
			</pre>
			<p>
				Make sure your variable's class implements <code class="code">java.io.Serializable</code>, as the instance state is saved between flow requests.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scopes" href="#scopes"></a>3.9.&nbsp;Variable Scopes</h2></div></div></div>
		
		<p>
			Web Flow can store variables in one of several scopes: 
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e398" href="#d5e398"></a>3.9.1.&nbsp;Flow Scope</h3></div></div></div>
			
			<p>
				Flow scope gets allocated when a flow starts and destroyed when the flow ends.
				With the default implementation, any objects stored in flow scope need to be Serializable.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e401" href="#d5e401"></a>3.9.2.&nbsp;View Scope</h3></div></div></div>
			
			<p>
				View scope gets allocated when a <code class="code">view-state</code> enters and destroyed when the state exits.
				View scope is <span class="emphasis"><em>only</em></span> referenceable from within a <code class="code">view-state</code>.  With the
                default implementation, any objects stored in view scope need to be Serializable.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e407" href="#d5e407"></a>3.9.3.&nbsp;Request Scope</h3></div></div></div>
			
			<p>
				Request scope gets allocated when a flow is called and destroyed when the flow returns.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e410" href="#d5e410"></a>3.9.4.&nbsp;Flash Scope</h3></div></div></div>
			
			<p>
				Flash scope gets allocated when a flow starts, cleared after every view render, and destroyed when the
                flow ends.  With the default implementation, any objects stored in flash scope need to be Serializable.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d5e413" href="#d5e413"></a>3.9.5.&nbsp;Conversation Scope</h3></div></div></div>
			
			<p>
				Conversation scope gets allocated when a top-level flow starts and destroyed when the top-level flow ends.
				Conversation scope is shared by a top-level flow and all of its subflows.  With the default
                implementation, conversation scoped objects are stored in the HTTP session and should generally be
                Serializable to account for typical session replication.
			</p>
		</div>		
		<p>
			The scope to use is often determined contextually, for example depending on where a
			variable is defined -- at the start of the flow definition (flow scope), inside a
			a view state (view scope), etc. In other cases, for example in EL expressions and
			Java code, it needs to be specified explicitly. Subsequent sections explain
			how this is done.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="calling-subflows" href="#calling-subflows"></a>3.10.&nbsp;Calling subflows</h2></div></div></div>
		
		<p>
			A flow may call another flow as a subflow.  The flow will wait until the subflow returns, then respond to the subflow outcome.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="subflow-state-element" href="#subflow-state-element"></a>3.10.1.&nbsp;subflow-state</h3></div></div></div>
			
			<p>
				Use the <code class="code">subflow-state</code> element to call another flow as a subflow:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/transition&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"creationCancelled"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/subflow-state&gt;</span>
			</pre>
			<p>
				The above example calls the <code class="code">createGuest</code> flow, then waits for it to return.
				When the flow returns with a <code class="code">guestCreated</code> outcome, the new guest is added to the booking's guest list.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="subflow-state-element-input" href="#subflow-state-element-input"></a>Passing a subflow input</h4></div></div></div>
				
				<p>
					Use the <code class="code">input</code> element to pass input to the subflow:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/subflow-state&gt;</span>
				</pre>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="subflow-state-element-output" href="#subflow-state-element-output"></a>Mapping subflow output</h4></div></div></div>
				
				<p>
					When a subflow completes, its end-state id is returned to the calling flow as
					the event to use to continue navigation.
				</p>
				<p>
					The subflow can also create output attributes to which the calling flow can refer
					within an outcome transition as follows:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
				</pre>
				<p>
					In the above example, <code class="code">guest</code> is the name of an output attribute returned by the <code class="code">guestCreated</code> outcome.
				</p>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-subflow" href="#checkpoint-subflow"></a>3.10.2.&nbsp;Checkpoint: calling subflows</h3></div></div></div>
			
			<p>
				Now review the sample booking flow calling a subflow:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;on-start&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-start&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"addGuest"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/view-state&gt;</span>

    <span class="hl-tag">&lt;subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/transition&gt;</span>
        <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"creationCancelled"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/subflow-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag"> &gt;</span>
        <span class="hl-tag">&lt;output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.id"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/end-state&gt;</span>

    <span class="hl-tag">&lt;end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre>
			<p>
				The flow now calls a <code class="code">createGuest</code> subflow to add a new guest to the guest list.
			</p>
		</div>
	</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="whatsnew.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="el.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.&nbsp;What's New&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;4.&nbsp;Expression Language (EL)</td></tr></table></div></body></html>