<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>10.&nbsp;System Setup</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Web Flow Reference Guide"><link rel="up" href="index.html" title="Spring Web Flow Reference Guide"><link rel="prev" href="flow-inheritance.html" title="9.&nbsp;Flow Inheritance"><link rel="next" href="spring-mvc.html" title="11.&nbsp;Spring MVC Integration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.&nbsp;System Setup</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="flow-inheritance.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="spring-mvc.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="system-setup" href="#system-setup"></a>10.&nbsp;System Setup</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-setup-introduction" href="#system-setup-introduction"></a>10.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter shows you how to setup the Web Flow system for use in any web environment.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-config-options" href="#system-config-options"></a>10.2.&nbsp;Java Config and XML Namespace</h2></div></div></div>
		
		<p>
			Web Flow provides dedicated configuration support for both Java and
			XML-based configuration.
		</p>
		<p>
			To get started with XML based configuration declare the webflow config XML namespace:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:webflow</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow-config"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/webflow-config
           http://www.springframework.org/schema/webflow-config/spring-webflow-config.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- Setup Web Flow here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span>
		</pre>
		<p>
			To get started with Java configuration extend
			<code class="classname">AbstractFlowConfiguration</code> in an
			<code class="classname">@Configuration</code> class:
		</p>
		<pre class="programlisting">
<span class="hl-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hl-keyword">import</span> org.springframework.webflow.config.AbstractFlowConfiguration;

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebFlowConfig <span class="hl-keyword">extends</span> AbstractFlowConfiguration {

}
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-config-basic" href="#system-config-basic"></a>10.3.&nbsp;Basic system configuration</h2></div></div></div>
		
		<p>
			The next section shows the minimal configuration required to set up the Web Flow system in your application.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="basic-setup-flow-registry" href="#basic-setup-flow-registry"></a>10.3.1.&nbsp;FlowRegistry</h3></div></div></div>
			
			<p>
				Register your flows in a <code class="code">FlowRegistry</code> in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				Register your flows in a <code class="code">FlowRegistry</code> in Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
    <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
        .build();
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="basic-setup-flow-executor" href="#basic-setup-flow-executor"></a>10.3.2.&nbsp;FlowExecutor</h3></div></div></div>
			
			<p>
				Deploy a FlowExecutor, the central service for executing flows in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				Deploy a FlowExecutor, the central service for executing flows in Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry()).build();
}
			</pre>
			<p>
				See the Spring MVC and Spring Faces sections of this guide on how to integrate the Web Flow system with the MVC and JSF environment, respectively.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-registry" href="#flow-registry"></a>10.4.&nbsp;flow-registry options</h2></div></div></div>
		
		<p>
			This section explores flow-registry configuration options.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location" href="#flow-registry-location"></a>10.4.1.&nbsp;Specifying flow locations</h3></div></div></div>
			
			<p>
				Use the <code class="code">location</code> element to specify paths to flow definitions to register.
				By default, flows will be assigned registry identifiers equal to their filenames minus
				the file extension, unless a registry bath path is defined.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location-id" href="#flow-registry-location-id"></a>10.4.2.&nbsp;Assigning custom flow identifiers</h3></div></div></div>
			
			<p>
				Specify an id to assign a custom registry identifier to a flow in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookHotel"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				Specify an id to assign a custom registry identifier to a flow in Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>, <span class="hl-string">"bookHotel"</span>)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location-attributes" href="#flow-registry-location-attributes"></a>10.4.3.&nbsp;Assigning flow meta-attributes</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-definition-attributes</code> element to assign custom meta-attributes to a registered flow.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-definition-attributes&gt;</span>
        <span class="hl-tag">&lt;webflow:attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"caption"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Books a hotel"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/webflow:flow-definition-attributes&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-location&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
Map&lt;String, Object&gt; attrs = ... ;

<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>, null, attrs)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-patterns" href="#flow-registry-patterns"></a>10.4.4.&nbsp;Registering flows using a location pattern</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-location-patterns</code> element to register flows that match a specific resource location pattern:
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-location-pattern</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/flows/**/*-flow.xml"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .addFlowLocationPattern(<span class="hl-string">"/WEB-INF/flows/**/*-flow.xml"</span>)
        .build();
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-base-path" href="#flow-registry-base-path"></a>10.4.5.&nbsp;Flow location base path</h3></div></div></div>
			
			<p>
				Use the <code class="code">base-path</code> attribute to define a base location for all flows in the application.
				All flow locations are then relative to the base path.
				The base path can be a resource path such as '/WEB-INF' or a location on the classpath like 'classpath:org/springframework/webflow/samples'.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">base-path</span>=<span class="hl-value">"/WEB-INF"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/hotels/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .setBasePath(<span class="hl-string">"/WEB-INF"</span>)
        .addFlowLocationPattern(<span class="hl-string">"/hotels/booking/booking.xml"</span>)
        .build();
			</pre>
			<p>
				With a base path defined, the algorithm that assigns flow identifiers changes slightly.
				Flows will now be assigned registry identifiers equal to the the path segment between their base path and file name.
				For example, if a flow definition is located at '/WEB-INF/hotels/booking/booking-flow.xml' and the base path is '/WEB-INF' the remaining path to this flow is 'hotels/booking' which becomes the flow id.
			</p>
			<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Directory per flow definition"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Directory per flow definition</th></tr><tr><td align="left" valign="top">
				
				<p>
					Recall it is a best practice to package each flow definition in a unique directory.
					This improves modularity, allowing dependent resources to be packaged with the flow definition.
					It also prevents two flows from having the same identifiers when using the convention.
				</p>
			</td></tr></table></div>
			<p>
				If no base path is not specified or if the flow definition is directly on the base path, flow id assignment from the filename (minus the extension) is used.
				For example, if a flow definition file is 'booking.xml', the flow identifier is simply 'booking'.
			</p>
			<p>
				Location patterns are particularly powerful when combined with a registry base path.
				Instead of the flow identifiers becoming '*-flow', they will be based on the directory path.
				For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">base-path</span>=<span class="hl-value">"/WEB-INF"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location-pattern</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/**/*-flow.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
        .setBasePath(<span class="hl-string">"/WEB-INF"</span>)
        .addFlowLocationPattern(<span class="hl-string">"/**/*-flow.xml"</span>)
        .build();
			</pre>
			<p>
				In the above example, suppose you had flows located in <code class="code">/user/login</code>, <code class="code">/user/registration</code>, <code class="code">/hotels/booking</code>, and <code class="code">/flights/booking</code> directories within <code class="code">WEB-INF</code>,
				you'd end up with flow ids of <code class="code">user/login</code>, <code class="code">user/registration</code>, <code class="code">hotels/booking</code>, and <code class="code">flights/booking</code>, respectively.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-parent" href="#flow-registry-parent"></a>10.4.6.&nbsp;Configuring FlowRegistry hierarchies</h3></div></div></div>
			
			<p>
				Use the <code class="code">parent</code> attribute to link two flow registries together in a hierarchy.
				When the child registry is queried, if it cannot find the requested flow it will delegate to its parent.
			</p>
			<p>
				In XML:
			</p>
			<pre class="programlisting">
<span class="hl-comment">&lt;!-- my-system-config.xml --&gt;</span>
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"sharedFlowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>

<span class="hl-comment">&lt;!-- shared-config.xml --&gt;</span>
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sharedFlowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- Global flows shared by several applications --&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebFlowConfig <span class="hl-keyword">extends</span> AbstractFlowConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> SharedConfig sharedConfig;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
        <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
                .setParent(<span class="hl-keyword">this</span>.sharedConfig.sharedFlowRegistry())
                .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
                .build();
    }
}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SharedConfig <span class="hl-keyword">extends</span> AbstractFlowConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FlowDefinitionRegistry sharedFlowRegistry() {
        <span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder()
                .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/shared.xml"</span>)
                .build();
    }
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-builder-services" href="#flow-registry-builder-services"></a>10.4.7.&nbsp;Configuring custom FlowBuilder services</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-builder-services</code> attribute to customize the services and settings used to build flows in a flow-registry.
				If no flow-builder-services tag is specified, the default service implementations are used.
				When the tag is defined, you only need to reference the services you want to customize.
			</p>
			<p>In XML:</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-registry&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>In Java:</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowDefinitionRegistry flowRegistry() {
	<span class="hl-keyword">return</span> getFlowDefinitionRegistryBuilder(flowBuilderServices())
            .addFlowLocation(<span class="hl-string">"/WEB-INF/flows/booking/booking.xml"</span>)
            .build();
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowBuilderServices flowBuilderServices() {
    <span class="hl-keyword">return</span> getFlowBuilderServicesBuilder().build();
}
			</pre>
			<p>
				The configurable services are the <code class="code">conversion-service</code>, <code class="code">expression-parser</code>, and <code class="code">view-factory-creator</code>.
				These services are configured by referencing custom beans you define.
			</p>
			<p>
				For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span>
    <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span>
    <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span>
    <span class="hl-attribute">view-factory-creator</span>=<span class="hl-value">"viewFactoryCreator"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewFactoryCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>
			</pre>
			<p>In Java:</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowBuilderServices flowBuilderServices() {
    <span class="hl-keyword">return</span> getFlowBuilderServicesBuilder()
            .setConversionService(conversionService())
            .setExpressionParser(expressionParser)
            .setViewFactoryCreator(mvcViewFactoryCreator())
            .build();
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> ConversionService conversionService() {
    <span class="hl-comment">// ...</span>
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> ExpressionParser expressionParser() {
    <span class="hl-comment">// ...</span>
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> ViewFactoryCreator viewFactoryCreator() {
    <span class="hl-comment">// ...</span>
}
			</pre>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-conversion" href="#builder-service-conversion"></a>conversion-service</h4></div></div></div>
				
				<p>
					Use the <code class="code">conversion-service</code> attribute to customize the <code class="code">ConversionService</code> used by the Web Flow system.
					Type conversion is used to convert from one type to another when required during flow execution such as when processing request parameters, invoking actions, and so on.
					Many common object types such as numbers, classes, and enums are supported.
					However you'll probably need to provide your own type conversion and formatting logic for custom data types.
					Please read <a class="xref" href="views.html#view-type-conversion" title="5.7.&nbsp;Performing type conversion">Section&nbsp;5.7, &#8220;Performing type conversion&#8221;</a> for important information on how to provide custom type conversion logic.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-expression-parser" href="#builder-service-expression-parser"></a>expression-parser</h4></div></div></div>
				
				<p>
					Use the <code class="code">expression-parser</code> attribute to customize the <code class="code">ExpressionParser</code> used by the Web Flow system.
					The default ExpressionParser uses the Unified EL if available on the classpath, otherwise Spring EL is used.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-view-factory-creator" href="#builder-service-view-factory-creator"></a>view-factory-creator</h4></div></div></div>
				
				<p>
					Use the <code class="code">view-factory-creator</code> attribute to customize the <code class="code">ViewFactoryCreator</code> used by the Web Flow system.
					The default ViewFactoryCreator produces Spring MVC ViewFactories capable of rendering JSP, Velocity, and Freemarker views.
				</p>
				<p>
					The configurable settings are <code class="code">development</code>.
					These settings are global configuration attributes that can be applied during the flow construction process.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="builder-development" href="#builder-development"></a>development</h4></div></div></div>
				
				<p>
					Set this to <code class="code">true</code> to switch on flow <span class="emphasis"><em>development mode</em></span>.
					Development mode switches on hot-reloading of flow definition changes, including changes to dependent flow resources such as message bundles.
				</p>
			</div>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-executor" href="#flow-executor"></a>10.5.&nbsp;flow-executor options</h2></div></div></div>
		
		<p>
			This section explores flow-executor configuration options.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="flow-executor-execution-listeners" href="#flow-executor-execution-listeners"></a>10.5.1.&nbsp;Attaching flow execution listeners</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-execution-listeners</code> element to register listeners that observe the lifecycle
				of flow executions. For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-execution-listeners&gt;</span>
    <span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityListener"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"persistenceListener"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-execution-listeners&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
            .addFlowExecutionListener(securityListener())
            .addFlowExecutionListener(persistenceListener())
            .build();
}
			</pre>
			<p>
				You may also configure a listener to observe only certain flows. For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityListener"</span> <span class="hl-attribute">criteria</span>=<span class="hl-value">"securedFlow1,securedFlow2"</span><span class="hl-tag">/&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
            .addFlowExecutionListener(securityListener(), <span class="hl-string">"securedFlow1,securedFlow2"</span>)
            .build();
}
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tuning-flow-execution-repository" href="#tuning-flow-execution-repository"></a>10.5.2.&nbsp;Tuning FlowExecution persistence</h3></div></div></div>
			
			<p>
				Use the <code class="code">flow-execution-repository</code> element to tune flow execution persistence settings.
				For example in XML:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;webflow:flow-execution-repository</span> <span class="hl-attribute">max-executions</span>=<span class="hl-value">"5"</span> <span class="hl-attribute">max-execution-snapshots</span>=<span class="hl-value">"30"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/webflow:flow-executor&gt;</span>
			</pre>
			<p>
				In Java:
			</p>
			<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> FlowExecutor flowExecutor() {
    <span class="hl-keyword">return</span> getFlowExecutorBuilder(flowRegistry())
            .setMaxFlowExecutions(<span class="hl-number">5</span>)
            .setMaxFlowExecutionSnapshots(<span class="hl-number">30</span>)
            .build();
}
			</pre>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="repository-max-executions" href="#repository-max-executions"></a>max-executions</h4></div></div></div>
				
				<p>
					Tune the <code class="code">max-executions</code> attribute to place a cap on the number of flow executions that can be created per user session.
					When the maximum number of executions is exceeded, the oldest execution is removed.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
						<p>
							The <code class="code">max-executions</code> attribute is per user session, i.e. it works across instances of any flow definition.
						</p>
					</td></tr></table></div><p>
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="repository-max-snapshots" href="#repository-max-snapshots"></a>max-execution-snapshots</h4></div></div></div>
				
				<p>
					Tune the <code class="code">max-execution-snapshots</code> attribute to place a cap on the number of history snapshots that can be taken per flow execution.
					To disable snapshotting, set this value to 0.  To enable an unlimited number of snapshots, set this value to -1.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
						<p>
							History snapshots enable browser back button support.
							When snapshotting is disabled pressing the browser back button will not work.
							It will result in using an execution key that points to a snapshot that has not be recorded.
						</p>
					</td></tr></table></div><p>
				</p>
			</div>
		</div>
	</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="flow-inheritance.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="spring-mvc.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">9.&nbsp;Flow Inheritance&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;11.&nbsp;Spring MVC Integration</td></tr></table></div></body></html>