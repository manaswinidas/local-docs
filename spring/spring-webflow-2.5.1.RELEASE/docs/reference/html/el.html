<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>4.&nbsp;Expression Language (EL)</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Web Flow Reference Guide"><link rel="up" href="index.html" title="Spring Web Flow Reference Guide"><link rel="prev" href="defining-flows.html" title="3.&nbsp;Defining Flows"><link rel="next" href="views.html" title="5.&nbsp;Rendering views"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.&nbsp;Expression Language (EL)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="defining-flows.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="views.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="el" href="#el"></a>4.&nbsp;Expression Language (EL)</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-introduction" href="#el-introduction"></a>4.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			Web Flow uses EL to access its data model and to invoke actions.
			This chapter will familiarize you with EL syntax, configuration, and special EL variables you can reference from your flow definition.
		</p>
		<p>
			EL is used for many things within a flow including:
		</p>
		<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Access client data such as declaring flow inputs or referencing request parameters.</p></li><li class="listitem"><p>Access data in Web Flow's <code class="code">RequestContext</code> such as <code class="code">flowScope</code> or <code class="code">currentEvent</code>.</p></li><li class="listitem"><p>Invoke methods on Spring-managed objects through actions.</p></li><li class="listitem"><p>Resolve expressions such as state transition criteria, subflow ids, and view names.</p></li></ol></div>
 		<p>
 			EL is also used to bind form parameters to model objects and reversely to render formatted form fields from the properties of a model object.
 			That however does not apply when using Web Flow with JSF in which case the standard JSF component lifecyle applies.
 		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-types" href="#el-types"></a>4.1.1.&nbsp;Expression types</h3></div></div></div>
			
			<p>
				An important concept to understand is there are two types of expressions in Web Flow: standard expressions and template expressions.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="el-types-eval" href="#el-types-eval"></a>Standard Expressions</h4></div></div></div>
				
				<p>
					The first and most common type of expression is the <span class="emphasis"><em>standard expression</em></span>.
					Such expressions are evaluated directly by the EL and need not be enclosed in delimiters like <code class="code">#{}</code>.
					For example:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					The expression above is a standard expression that invokes the <code class="code">nextPage</code> method on the <code class="code">searchCriteria</code> variable when evaluated.
					If you attempt to enclose this expression in a special delimiter like <code class="code">#{}</code> you will get an <code class="code">IllegalArgumentException</code>.
					In this context the delimiter is seen as redundant.
					The only acceptable value for the <code class="code">expression</code> attribute is an single expression string.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="el-types-template" href="#el-types-template"></a>Template expressions</h4></div></div></div>
				
				<p>
					The second type of expression is a <span class="emphasis"><em>template expression</em></span>.
					A template expression allows mixing of literal text with one or more standard expressions.
					Each standard expression block is explicitly surrounded with the <code class="code">#{}</code> delimiters.
					For example:
				</p>
				<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"error"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"error-#{externalContext.locale}.xhtml"</span><span class="hl-tag"> /&gt;</span>
				</pre>
				<p>
					The expression above is a template expression.
					The result of evaluation will be a string that concatenates literal text such as <code class="code">error-</code> and <code class="code">.xhtml</code> with the result of evaluating <code class="code">externalContext.locale</code>.
					As you can see, explicit delimiters are necessary here to demarcate standard expression blocks within the template.
				</p>
				<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
					<p>
						See the Web Flow XML schema for a complete listing of those XML attributes that accept standard expressions and those that accept template expressions.
						You can also use F2 in Eclipse (or equivalent shortcut in other IDEs) to access available documentation when typing out specific flow definition attributes.
					</p>
				</td></tr></table></div>
			</div>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-language-choices" href="#el-language-choices"></a>4.2.&nbsp;EL Implementations</h2></div></div></div>
		
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-spring-el" href="#el-spring-el"></a>4.2.1.&nbsp;Spring EL</h3></div></div></div>
			
			<p>
				Web Flow uses the <a class="ulink" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html" target="_top">Spring Expression Language</a> (Spring EL).
				Spring EL was created to provide a single, well-supported expression language for use across all the products in the Spring portfolio.
				It is distributed as a separate jar <code class="code">org.springframework.expression</code> in the Spring Framework.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-unified-el" href="#el-unified-el"></a>4.2.2.&nbsp;Unified EL</h3></div></div></div>
			
			<p>
				Use of <a class="ulink" href="http://en.wikipedia.org/wiki/Unified_Expression_Language" target="_top">Unified EL</a>
				also implies a dependency on <code class="code">el-api</code> although that is typically <span class="emphasis"><em>provided</em></span>
				by your web container.
				Although Spring EL is the default and recommended expression language to use,
				it is possible to replace it with Unified EL if you wish to do so.
				You need the following Spring configuration to plug in the <code class="code">WebFlowELExpressionParser</code> to the <code class="code">flow-builder-services</code>:
				</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.expression.el.WebFlowELExpressionParser"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jboss.el.ExpressionFactoryImpl"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
                </pre><p>
                Note that if your application is registering custom converters it's important to ensure the WebFlowELExpressionParser is configured with the conversion service that has those custom converters.
				</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.expression.el.WebFlowELExpressionParser"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.jboss.el.ExpressionFactoryImpl"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"conversionService"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"somepackage.ApplicationConversionService"</span><span class="hl-tag">/&gt;</span>
                </pre><p>
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-portability" href="#el-portability"></a>4.3.&nbsp;EL portability</h2></div></div></div>
		
		<p>
			In general, you will find Spring EL and Unified EL to have a very similar syntax.
		</p>
		<p>
			Note however there are some advantages to Spring EL.
			For example Spring EL is closely integrated with the type conversion of Spring 3 and that allows you to take full advantage of its features.
			Specifically the automatic detection of generic types as well as the use of formatting annotations is currently supported with Spring EL only.
		</p>
		<p>
			There are some minor changes to keep in mind when upgrading to Spring EL from Unified EL as follows:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Expressions deliniated with <code class="code">${}</code> in flow definitions must be changed to <code class="code">#{}</code>.</p></li><li class="listitem"><p>Expressions testing the current event <code class="code">#{currentEvent == 'submit'}</code> must be changed to <code class="code">#{currentEvent.id == 'submit'}</code>.</p></li><li class="listitem">
					<p>
						Resolving properties such as <code class="code">#{currentUser.name}</code> may cause NullPointerException without any checks such as <code class="code">#{currentUser != null ? currentUser.name : null}</code>.
						A much better alternative though is the safe navigation operator <code class="code">#{currentUser?.name}</code>.
					</p>
				</li></ol></div><p>
			For more information on Spring EL syntax please refer to the <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/expressions.html#expressions-language-ref" target="_top">Language Reference</a> section in the Spring Documentation.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-variables" href="#el-variables"></a>4.4.&nbsp;Special EL variables</h2></div></div></div>
		
		<p>
			There are several implicit variables you may reference from within a flow.
			These variables are discussed in this section.
		</p>
		<p>
			Keep in mind this general rule.
			Variables referring to data scopes (flowScope, viewScope, requestScope, etc.) should only be used when assigning a new variable to one of the scopes.
		</p>
		<p>
			For example when assigning the result of the call to <code class="code">bookingService.findHotels(searchCriteria)</code> to a new variable called "hotels" you must prefix it with a scope variable in order to let Web Flow know where you want it stored:
			</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span> <span class="hl-attribute">...</span><span class="hl-tag"> &gt;</span>

	<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.SearchCriteria"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;on-render&gt;</span>
			<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/on-render&gt;</span>
	<span class="hl-tag">&lt;/view-state&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre><p>
			However when setting an existing variable such as "searchCriteria" in the example below, you reference the variable directly without prefixing it with any scope variables:
			</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span> <span class="hl-attribute">...</span><span class="hl-tag"> &gt;</span>

	<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.SearchCriteria"</span><span class="hl-tag"> /&gt;</span>

	<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span><span class="hl-tag">&gt;</span>
		<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"sort"</span><span class="hl-tag">&gt;</span>
			<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria.sortBy"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.sortBy"</span><span class="hl-tag"> /&gt;</span>
		<span class="hl-tag">&lt;/transition&gt;</span>
	<span class="hl-tag">&lt;/view-state&gt;</span>

<span class="hl-tag">&lt;/flow&gt;</span>
			</pre><p>
		</p>
		<p>
			The following is the list of implicit variables you can reference within a flow definition:
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowScope" href="#el-variable-flowScope"></a>4.4.1.&nbsp;flowScope</h3></div></div></div>
			
			<p>
				Use <code class="code">flowScope</code> to assign a flow variable.
				Flow scope gets allocated when a flow starts and destroyed when the flow ends.  With the default
                implementation, any objects stored in flow scope need to be Serializable.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotel(hotelId)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotel"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-viewScope" href="#el-variable-viewScope"></a>4.4.2.&nbsp;viewScope</h3></div></div></div>
			
			<p>
				Use <code class="code">viewScope</code> to assign a view variable.
				View scope gets allocated when a <code class="code">view-state</code> enters and destroyed when the state exits.
				View scope is <span class="emphasis"><em>only</em></span> referenceable from within a <code class="code">view-state</code>.  With the
                default implementation, any objects stored in view scope need to be Serializable.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span>
              <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestScope" href="#el-variable-requestScope"></a>4.4.3.&nbsp;requestScope</h3></div></div></div>
			
			<p>
				Use <code class="code">requestScope</code> to assign a request variable.
				Request scope gets allocated when a flow is called and destroyed when the flow returns.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flashScope" href="#el-variable-flashScope"></a>4.4.4.&nbsp;flashScope</h3></div></div></div>
			
			<p>
				Use <code class="code">flashScope</code> to assign a flash variable.
				Flash scope gets allocated when a flow starts, cleared after every view render, and destroyed when the
                flow ends.  With the default implementation, any objects stored in flash scope need to be Serializable.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flashScope.statusMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"'Booking confirmed'"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-conversationScope" href="#el-variable-conversationScope"></a>4.4.5.&nbsp;conversationScope</h3></div></div></div>
			
			<p>
				Use <code class="code">conversationScope</code> to assign a conversation variable.
				Conversation scope gets allocated when a top-level flow starts and destroyed when the top-level flow ends.
				Conversation scope is shared by a top-level flow and all of its subflows.  With the default
                implementation, conversation scoped objects are stored in the HTTP session and should generally be
                Serializable to account for typical session replication.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotel(hotelId)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"conversationScope.hotel"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestParameters" href="#el-variable-requestParameters"></a>4.4.6.&nbsp;requestParameters</h3></div></div></div>
			
			<p>
				Use <code class="code">requestParameters</code> to access a client request parameter:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-currentEvent" href="#el-variable-currentEvent"></a>4.4.7.&nbsp;currentEvent</h3></div></div></div>
			
			<p>
				Use <code class="code">currentEvent</code> to access attributes of the current <code class="code">Event</code>:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-currentUser" href="#el-variable-currentUser"></a>4.4.8.&nbsp;currentUser</h3></div></div></div>
			
			<p>
				Use <code class="code">currentUser</code> to access the authenticated <code class="code">Principal</code>:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span>
          <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-messageContext" href="#el-variable-messageContext"></a>4.4.9.&nbsp;messageContext</h3></div></div></div>
			
			<p>
				Use <code class="code">messageContext</code> to access a context for retrieving and creating flow execution messages, including error and success messages.
				See the <code class="code">MessageContext</code> Javadocs for more information.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingValidator.validate(booking, messageContext)"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-resourceBundle" href="#el-variable-resourceBundle"></a>4.4.10.&nbsp;resourceBundle</h3></div></div></div>
			
			<p>
				Use <code class="code">resourceBundle</code> to access a message resource.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flashScope.successMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"resourceBundle.successMessage"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestContext" href="#el-variable-requestContext"></a>4.4.11.&nbsp;flowRequestContext</h3></div></div></div>
			
			<p>
				Use <code class="code">flowRequestContext</code> to access the <code class="code">RequestContext</code> API, which is a representation of the current flow request.
				See the API Javadocs for more information.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowExecutionContext" href="#el-variable-flowExecutionContext"></a>4.4.12.&nbsp;flowExecutionContext</h3></div></div></div>
			
			<p>
				Use <code class="code">flowExecutionContext</code> to access the <code class="code">FlowExecutionContext</code> API, which is a representation of the current flow state.
				See the API Javadocs for more information.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowExecutionUrl" href="#el-variable-flowExecutionUrl"></a>4.4.13.&nbsp;flowExecutionUrl</h3></div></div></div>
			
			<p>
				Use <code class="code">flowExecutionUrl</code> to access the context-relative URI for the current flow execution view-state.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-externalContext" href="#el-variable-externalContext"></a>4.4.14.&nbsp;externalContext</h3></div></div></div>
			
			<p>
				Use <code class="code">externalContext</code> to access the client environment, including user session attributes.
				See the <code class="code">ExternalContext</code> API JavaDocs for more information.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.suggestHotels(externalContext.sessionMap.userProfile)"</span>
          <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-scope-searching" href="#el-scope-searching"></a>4.5.&nbsp;Scope searching algorithm</h2></div></div></div>
		
		<p>
			As mentioned earlier in this section when assigning a variable in one of the flow scopes, referencing that scope is required.
			For example:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span><span class="hl-tag"> /&gt;</span>
		</pre>
		<p>
			When simply accessing a variable in one of the scopes, referencing the scope is optional.
			For example:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"entityManager.persist(booking)"</span><span class="hl-tag"> /&gt;</span>
		</pre>
		<p>
			When no scope is specified, like in the use of <code class="code">booking</code> above, a scope searching algorithm is used.
			The algorithm will look in request, flash, view, flow, and conversation scope for the variable.
			If no such variable is found, an <code class="code">EvaluationException</code> will be thrown.
		</p>
	</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="defining-flows.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="views.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.&nbsp;Defining Flows&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;5.&nbsp;Rendering views</td></tr></table></div></body></html>