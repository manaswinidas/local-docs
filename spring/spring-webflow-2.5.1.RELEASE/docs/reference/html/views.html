<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>5.&nbsp;Rendering views</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Web Flow Reference Guide"><link rel="up" href="index.html" title="Spring Web Flow Reference Guide"><link rel="prev" href="el.html" title="4.&nbsp;Expression Language (EL)"><link rel="next" href="actions.html" title="6.&nbsp;Executing actions"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.&nbsp;Rendering views</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="el.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="actions.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="views" href="#views"></a>5.&nbsp;Rendering views</h1></div></div></div>
	
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="views-introduction" href="#views-introduction"></a>5.1.&nbsp;Introduction</h2></div></div></div>
		
		<p>
			This chapter shows you how to use the <code class="code">view-state</code> element to render views within a flow.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-convention" href="#view-convention"></a>5.2.&nbsp;Defining view states</h2></div></div></div>
		
		<p>
			Use the <code class="code">view-state</code> element to define a step of the flow that renders a view and waits for a user event to resume:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<p>
			By convention, a view-state maps its id to a view template in the directory where the flow is located.
			For example, the state above might render <code class="filename">/WEB-INF/hotels/booking/enterBookingDetails.xhtml</code>
			if the flow itself was located in the <code class="filename">/WEB-INF/hotels/booking</code> directory.
		</p>
		<p>
			Below is a sample directory structure showing views and other resources like message bundles co-located with their flow definition:
		</p>
		<div class="mediaobject" align="center"><img src="images/flow-view-packaging.png" align="middle"><div class="caption">
				<p>Flow Packaging</p>
			</div></div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-explicit" href="#view-explicit"></a>5.3.&nbsp;Specifying view identifiers</h2></div></div></div>
		
		<p>
			Use the <code class="code">view</code> attribute to specify the id of the view to render explicitly.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-flowrelative" href="#view-explicit-flowrelative"></a>5.3.1.&nbsp;Flow relative view ids</h3></div></div></div>
			
			<p>
				The view id may be a relative path to view resource in the flow's working directory:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"bookingDetails.xhtml"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-absolute" href="#view-explicit-absolute"></a>5.3.2.&nbsp;Absolute view ids</h3></div></div></div>
			
			<p>
				The view id may be a absolute path to a view resource in the webapp root directory:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"/WEB-INF/hotels/booking/bookingDetails.xhtml"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-logical" href="#view-explicit-logical"></a>5.3.3.&nbsp;Logical view ids</h3></div></div></div>
			
			<p>
				With some view frameworks, such as Spring MVC's view framework, the view id may also be a logical identifier resolved by the framework:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"bookingDetails"</span><span class="hl-tag">&gt;</span>
			</pre>
			<p>
				See the Spring MVC integration section for more information on how to integrate with the MVC <code class="code">ViewResolver</code> infrastructure.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-scope" href="#view-scope"></a>5.4.&nbsp;View scope</h2></div></div></div>
		
		<p>
			A view-state allocates a new <code class="code">viewScope</code> when it enters.
			This scope may be referenced within the view-state to assign variables that should live for the duration of the state.
			This scope is useful for manipulating objects over a series of requests from the same view, often Ajax requests.
			A view-state destroys its viewScope when it exits.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-var" href="#view-scope-var"></a>5.4.1.&nbsp;Allocating view variables</h3></div></div></div>
			
			<p>
				Use the <code class="code">var</code> tag to declare a view variable.
				Like a flow variable, any <code class="code">@Autowired</code> references are automatically restored when the view state resumes.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.SearchCriteria"</span><span class="hl-tag"> /&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-actions" href="#view-scope-actions"></a>5.4.2.&nbsp;Assigning a viewScope variable</h3></div></div></div>
			
			<p>
				Use the <code class="code">on-render</code> tag to assign a variable from an action result before the view renders:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-ajax" href="#view-scope-ajax"></a>5.4.3.&nbsp;Manipulating objects in view scope</h3></div></div></div>
			
			<p>
				Objects in view scope are often manipulated over a series of requests from the same view.
				The following example pages through a search results list.
				The list is updated in view scope before each render.
				Asynchronous event handlers modify the current data page, then request re-rendering of the search results fragment.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchResults"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;on-render&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span>
                  <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/on-render&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/transition&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"previous"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.previousPage()"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/transition&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-on-render" href="#view-on-render"></a>5.5.&nbsp;Executing render actions</h2></div></div></div>
		
		<p>
			Use the <code class="code">on-render</code> element to execute one or more actions before view rendering.
			Render actions are executed on the initial render as well as any subsequent refreshes, including any partial re-renderings of the view.
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;on-render&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/on-render&gt;</span>
	    </pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-model" href="#view-model"></a>5.6.&nbsp;Binding to a model</h2></div></div></div>
		
		<p>
			Use the <code class="code">model</code> attribute to declare a model object the view binds to.
			This attribute is typically used in conjunction with views that render data controls, such as forms.
			It enables form data binding and validation behaviors to be driven from metadata on your model object.
		</p>
		<p>
			The following example declares an <code class="code">enterBookingDetails</code> state manipulates the <code class="code">booking</code> model:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
	    </pre>
	    <p>
			The model may be an object in any accessible scope, such as <code class="code">flowScope</code> or <code class="code">viewScope</code>.
			Specifying a <code class="code">model</code> triggers the following behavior when a view event occurs:
		</p>
		<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>View-to-model binding.  On view postback, user input values are bound to model object properties for you.</p></li><li class="listitem"><p>Model validation.  After binding, if the model object requires validation that validation logic will be invoked.</p></li></ol></div>
		<p>
			For a flow event to be generated that can drive a view state transition, model binding must complete successfully.
			If model binding fails, the view is re-rendered to allow the user to revise their edits.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-type-conversion" href="#view-type-conversion"></a>5.7.&nbsp;Performing type conversion</h2></div></div></div>
		
		<p>
			When request parameters are used to populate the model (commonly referred to as data binding), type conversion is required to parse String-based request parameter values before setting target model properties.
			Default type conversion is available for many common Java types such as numbers, primitives, enums, and Dates.
			Users also have the ability to register their own type conversion logic for user-defined types, and to override the default Converters.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-options" href="#converter-options"></a>5.7.1.&nbsp;Type Conversion Options</h3></div></div></div>
			
			<p>
				Starting with version 2.1 Spring Web Flow uses the <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/validation.html#core-convert" target="_top">type conversion</a> and <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/validation.html#format" target="_top">formatting</a> system introduced in Spring 3 for nearly all type conversion needs.
				Previously Web Flow applications used a type conversion mechanism that was different from the one in Spring MVC, which relied on the <code class="code">java.beans.PropertyEditor</code> abstraction.
				Spring 3 offers a modern type conversion alternative to PropertyEditors that was actually influenced by Web Flow's own type conversion system.
				Hence Web Flow users should find it natural to work with the new Spring 3 type conversion.
				Another obvious and very important benefit of this change is that a single type conversion mechanism can now be used across Spring MVC And Spring Web Flow.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-upgrade-to-spring-3" href="#converter-upgrade-to-spring-3"></a>5.7.2.&nbsp;Upgrading to Spring 3 Type Conversion And Formatting</h3></div></div></div>
			
			<p>
				What does this practically mean for existing applications?
				Existing applications are likely registering their own converters of type <code class="code">org.springframework.binding.convert.converters.Converter</code> through a sub-class of <code class="code">DefaultConversionService</code> available in Spring Binding.
				Those converters can continue to be registered as before.
				They will be adapted as Spring 3 <code class="code">GenericConverter</code> types and registered with a Spring 3 <code class="code">org.springframework.core.convert.ConversionService</code> instance.
				In other words existing converters will be invoked through Spring's type conversion service.
			</p>
			<p>
				The only exception to this rule are named converters, which can be referenced from a <code class="code">binding</code> element in a <code class="code">view-state</code>:
				</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ApplicationConversionService <span class="hl-keyword">extends</span> DefaultConversionService {
    <span class="hl-keyword">public</span> ApplicationConversionService() {
        addDefaultConverters();
        addDefaultAliases();
        addConverter(<span class="hl-string">"customConverter"</span>, <span class="hl-keyword">new</span> CustomConverter());
    }
}
				</pre><p>
				</p><pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"customConverter"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
				</pre><p>
				Named converters are not supported and cannot be used with the type conversion service available in Spring 3.
				Therefore such converters will not be adapted and will continue to work as before, i.e. will not involve the Spring 3 type conversion.
				However, this mechanism is deprecated and applications are encouraged to favor Spring 3 type conversion and formatting features.
			</p>
			<p>
				Also note that the existing Spring Binding <code class="code">DefaultConversionService</code> no longer registers any default converters.
				Instead Web Flow now relies on the default type converters and formatters in Spring 3.
			</p>
			<p>
				In summary the Spring 3 type conversion and formatting is now used almost exclusively in Web Flow.
				Although existing applications will work without any changes, we encourage moving towards unifying the type conversion needs of Spring MVC and Spring Web Flow parts of applications.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-configuration" href="#converter-configuration"></a>5.7.3.&nbsp;Configuring Type Conversion and Formatting</h3></div></div></div>
			
			<p>
				In Spring MVC an instance of a <code class="code">FormattingConversionService</code> is created automatically through the custom MVC namespace:
				</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

	<span class="hl-tag">&lt;mvc:annotation-driven/&gt;</span>

				</pre><p>
				Internally that is done with the help of <code class="code">FormattingConversionServiceFactoryBean</code>, which registers a default set of converters and formatters.
				You can customize the conversion service instance used in Spring MVC through the <code class="code">conversion-service</code> attribute:
				</p><pre class="programlisting">
<span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"applicationConversionService"</span><span class="hl-tag"> /&gt;</span>
				</pre><p>
			</p>
			<p>
				In Web Flow an instance of a Spring Binding <code class="code">DefaultConversionService</code> is created automatically, which does not register any converters.
				Instead it delegates to a <code class="code">FormattingConversionService</code> instance for all type conversion needs.
				By default this is not the same <code class="code">FormattingConversionService</code> instance as the one used in Spring 3.
				However that won't make a practical difference until you start registering your own formatters.
			</p>
			<p>
				The <code class="code">DefaultConversionService</code> used in Web Flow can be customized through the flow-builder-services element:
				</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"defaultConversionService"</span><span class="hl-tag"> /&gt;</span>
				</pre><p>
			</p>
			<p>
				Connecting the dots in order to register your own formatters for use in both Spring MVC and in Spring Web Flow you can do the following.
				Create a class to register your custom formatters:
				</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ApplicationConversionServiceFactoryBean <span class="hl-keyword">extends</span> FormattingConversionServiceFactoryBean {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> installFormatters(FormatterRegistry registry) {
        <span class="hl-comment">// ...</span>
    }

}

				</pre><p>
				Configure it for use in Spring MVC:
				</p><pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">"http://www.springframework.org/schema/mvc"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"applicationConversionService"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-comment">&lt;!--
    	Alternatively if you prefer annotations for DI:
    	  1. Add @Component to the factory bean.
    	  2. Add a component-scan element (from the context custom namespace) here.
    	  3. Remove XML bean declaration below.
      --&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"applicationConversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"somepackage.ApplicationConversionServiceFactoryBean"</span><span class="hl-tag">&gt;</span>


				</pre><p>
				Connection the Web Flow <code class="code">DefaultConversionService</code> to the same "applicationConversionService" bean used in Spring MVC:
				</p><pre class="programlisting">
    <span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">...</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"defaultConversionService"</span> <span class="hl-attribute">...</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultConversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.binding.convert.service.DefaultConversionService"</span><span class="hl-tag">&gt;</span>
    	<span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"applicationConversionSevice"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
				</pre><p>
				Of course it is also possible to mix and match.
				Register new Spring 3 <code class="code">Formatter</code> types through the "applicationConversionService".
				Register existing Spring Binding <code class="code">Converter</code> types through the "defaultConversionService".
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-working-with" href="#converter-working-with"></a>5.7.4.&nbsp;Working With Spring 3 Type Conversion And Formatting</h3></div></div></div>
			
			<p>
				An important concept to understand is the difference between type converters and formatters.
			</p>
			<p>
				Type converters in Spring 3, provided in <code class="code">org.springframework.core</code>, are for general-purpose type conversion between any two object types.
				In addition to the most simple <code class="code">Converter</code> type, two other interfaces are <code class="code">ConverterFactory</code> and <code class="code">GenericConverter</code>.
			</p>
			<p>
				Formatters in Spring 3, provided in <code class="code">org.springframework.context</code>, have the more specialized purpose of representing Objects as Strings.
				The <code class="code">Formatter</code> interface extends the <code class="code">Printer</code> and <code class="code">Parser</code> interfaces for converting an Object to a String and turning a String into an Object.
			</p>
			<p>
				Web developers will find the <code class="code">Formatter</code> interface most relevant because it fits the needs of web applications for type conversion.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
					<p>
						An important point to be made is that Object-to-Object conversion is a generalization of the more specific Object-to-String conversion.
						In fact in the end <code class="code">Formatters</code> are reigstered as <code class="code">GenericConverter</code> types with Spring's <code class="code">GenericConversionService</code> making them equal to any other converter.
					</p>
				</td></tr></table></div><p>
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-formatting-annotations" href="#converter-formatting-annotations"></a>5.7.5.&nbsp;Formatting Annotations</h3></div></div></div>
			
			<p>
				One of the best features of the new type conversion is the ability to use annotations for a better control over formatting in a concise manner.
				Annotations can be placed on model attributes and on arguments of @Controller methods that are mapped to requests.
				Out of the box Spring provides two annotations <code class="code">NumberFormat</code> and <code class="code">DateTimeFormat</code> but you can create your own and have them registered along with the associated formatting logic.
				You can see examples of the <code class="code">DateTimeFormat</code> annotation in the <a class="ulink" href="https://src.springframework.org/svn/spring-samples/travel" target="_top">Spring Travel</a> and in the <a class="ulink" href="https://src.springframework.org/svn/spring-samples/petcare" target="_top">Petcare</a> along with other samples in the <a class="ulink" href="https://src.springframework.org/svn/spring-samples" target="_top">Spring Samples</a> repository.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="converter-dates" href="#converter-dates"></a>5.7.6.&nbsp;Working With Dates</h3></div></div></div>
			
			<p>
				The <code class="code">DateTimeFormat</code> annotation implies use of <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">Joda Time</a>.
				If that is present on the classpath the use of this annotation is enabled automatically.
				By default neither Spring MVC nor Web Flow register any other date formatters or converters.
				Therefore it is important for applications to register a custom formatter to specify the default way for printing and parsing dates.
				The <code class="code">DateTimeFormat</code> annotation on the other hand provides more fine-grained control where it is necessary to deviate from the default.
			</p>
			<p>
				For more information on working with Spring 3 type conversion and formatting please refer to the relevant sections of the <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/index.html" target="_top">Spring documentation</a>.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-bind" href="#view-bind"></a>5.8.&nbsp;Suppressing binding</h2></div></div></div>
		
		<p>
			Use the <code class="code">bind</code> attribute to suppress model binding and validation for particular view events.
			The following example suppresses binding when the <code class="code">cancel</code> event occurs:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-binder" href="#view-binder"></a>5.9.&nbsp;Specifying bindings explicitly</h2></div></div></div>
		
		<p>
			Use the <code class="code">binder</code> element to configure the exact set of model properties to
			apply data binding to. This is useful to restrict the set of "allowed fields" per view.
			Not using this could lead to a security issue, depending on the application domain and actual users,
			since by default if the binder element is not specified all public properties of the model are
			eligible for data binding by the view. By contrast when the <code class="code">binder</code> element is specified,
			only the explicitly configured bindings are allowed. Below is an example:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>

		</pre>
		<p>
			Each binding may also apply a converter to format the model property value for display in a custom manner.
			If no converter is specified, the default converter for the model property's type will be used.
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkoutDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>

		</pre>
		<p>
			In the example above, the <code class="code">shortDate</code> converter is bound to the
			<code class="code">checkinDate</code> and <code class="code">checkoutDate</code> properties.
			Custom converters may be registered with the application's ConversionService.
		</p>
		<p>
			Each binding may also apply a required check that will generate a validation error
			if the user provided value is null on form postback:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;binder&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkoutDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/binder&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<p>
			In the example above, all of the bindings are required.
			If one or more blank input values are bound, validation errors will be generated and the view will re-render with those errors.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-validate" href="#view-validate"></a>5.10.&nbsp;Validating a model</h2></div></div></div>
		
		<p>
			Model validation is driven by constraints specified against a model object.
			Web Flow supports enforcing such constraints programatically as well as
			declaratively with JSR-303 Bean Validation annotations.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-jsr303" href="#view-validation-jsr303"></a>5.10.1.&nbsp;JSR-303 Bean Validation</h3></div></div></div>
			
			<p>
				Web Flow provides built-in support for the JSR-303 Bean Validation API
				building on equivalent support available in Spring MVC.
				To enable JSR-303 validation configure the flow-builder-services with
				Spring MVC's <code class="code">LocalValidatorFactoryBean</code>:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">validator</span>=<span class="hl-value">"validator"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"validator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span><span class="hl-tag"> /&gt;</span>
			</pre>

			<p>
				With the above in place, the configured validator will be applied to
				all model attributes after data binding.
			</p>

			<p>
				Note that JSR-303 bean validation and validation by convention
				(explained in the next section) are not mutually exclusive.
				In other words Web Flow will apply all available validation
				mechanisms.
			</p>

			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation-jsr303-partial" href="#view-validation-jsr303-partial"></a>Partial Validation</h4></div></div></div>
				
				<p>
					JSR-303 Bean Validation supports partial validation through validation groups. For example:

</p><pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@NotNull</span></em>
<em><span class="hl-annotation" style="color: gray">@Size(min = 2, max = 30, groups = State1.class)</span></em>
<span class="hl-keyword">private</span> String name;
</pre><p>
					In a flow definition you can specify validation hints on a view state
					or on a transition and those will be resolved to validation groups.
					For example:
</p><pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"state1"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"myModel"</span> <span class="hl-attribute">validation-hints</span>=<span class="hl-value">"'group1,group2'"</span><span class="hl-tag">&gt;</span>

</pre><p>
					The <span class="emphasis"><em>validation-hints</em></span> attribute is an expression
					that in the above example resolves to a comma-delimited String consisting
					of the hints "group1" and "group2". A <code class="classname">ValidationHintResolver</code>
					is used to resolve these hints. The <code class="classname">BeanValidationHintResolver</code>
					used by default tries to resolve these strings to Class-based bean validation
					groups. To do that it looks for matching inner types in the model or its parent.
				</p>
				<p>
					For example given <code class="classname">org.example.MyModel</code> with inner types
					<code class="classname">Group1</code> and <code class="classname">Group2</code> it is
					sufficient to supply the simple type names, i.e. "group1" and "group2".
					You can also provide fully qualified type names.
				</p>
				<p>
					A hint with the value "default" has a special meaning and is translated
					to the default validation group in Bean Validation
					<code class="classname">javax.validation.groups.Default</code>.
				</p>
				<p>
					A custom <code class="classname">ValidationHintResolver</code>
					can be configured if necessary through the validationHintResolver property
					of the flow-builder-services element:
			</p><pre class="programlisting">
<span class="hl-tag">&lt;webflow:flow-registry</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">validator</span>=<span class="hl-value">".."</span> <span class="hl-attribute">validation-hint-resolver</span>=<span class="hl-value">".."</span><span class="hl-tag"> /&gt;</span>
</pre><p>
				</p>
			</div>

		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-programmatic" href="#view-validation-programmatic"></a>5.10.2.&nbsp;Programmatic validation</h3></div></div></div>
			
			<p>
				There are two ways to perform model validation programatically.
				The first is to implement validation logic in your model object.
				The second is to implement an external <code class="code">Validator</code>.
				Both ways provide you with a <code class="code">ValidationContext</code> to record error messages and access information about the current user.
			</p>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation-programmatic-validate-method" href="#view-validation-programmatic-validate-method"></a>Implementing a model validate method</h4></div></div></div>
				
				<p>
					Defining validation logic in your model object is the simplest way to validate its state.
					Once such logic is structured according to Web Flow conventions, Web Flow will automatically invoke that logic during the view-state postback lifecycle.
					Web Flow conventions have you structure model validation logic by view-state, allowing you to easily validate the subset of model properties that are editable on that view.
					To do this, simply create a public method with the name <code class="code">validate${state}</code>, where <code class="code">${state}</code> is the id of your view-state where you want validation to run.
					For example:
					</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Booking {
    <span class="hl-keyword">private</span> Date checkinDate;
    <span class="hl-keyword">private</span> Date checkoutDate;
    ...

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(ValidationContext context) {
        MessageContext messages = context.getMessageContext();
        <span class="hl-keyword">if</span> (checkinDate.before(today())) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkinDate"</span>).
                defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (!checkinDate.before(checkoutDate)) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkoutDate"</span>).
                defaultText(<span class="hl-string">"Check out date must be later than check in date"</span>).build());
        }
    }
}

					</pre><p>
				</p>
				<p>
					In the example above, when a transition is triggered in a <code class="code">enterBookingDetails</code> view-state that is editing a <code class="code">Booking</code> model,
					Web Flow will invoke the <code class="code">validateEnterBookingDetails(ValidationContext)</code> method automatically unless validation has been suppressed for that transition.
					An example of such a view-state is shown below:
					</p><pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
					</pre><p>
				</p>
				<p>
					Any number of validation methods are defined.  Generally, a flow edits a model over a series of views.  In that case, a validate method would be defined
					for each view-state where validation needs to run.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation-programmatic-validator" href="#view-validation-programmatic-validator"></a>Implementing a Validator</h4></div></div></div>
				
				<p>
					The second way is to define a separate object, called a <span class="emphasis"><em>Validator</em></span>, which validates your model object.
					To do this, first create a class whose name has the pattern ${model}Validator, where <code class="code">${model}</code> is the capitialized form of the model expression, such as <code class="code">booking</code>.
					Then define a public method with the name <code class="code">validate${state}</code>, where <code class="code">${state}</code> is the id of your view-state, such as <code class="code">enterBookingDetails</code>.
					The class should then be deployed as a Spring bean.  Any number of validation methods can be defined.
					For example:
				</p>
				<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(Booking booking, ValidationContext context) {
        MessageContext messages = context.getMessageContext();
        <span class="hl-keyword">if</span> (booking.getCheckinDate().before(today())) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkinDate"</span>).
                defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (!booking.getCheckinDate().before(booking.getCheckoutDate())) {
            messages.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkoutDate"</span>).
                defaultText(<span class="hl-string">"Check out date must be later than check in date"</span>).build());
        }
    }
}
				</pre>
				<p>
					In the example above, when a transition is triggered in a <code class="code">enterBookingDetails</code> view-state that is editing a <code class="code">Booking</code> model,
					Web Flow will invoke the <code class="code">validateEnterBookingDetails(Booking, ValidationContext)</code> method automatically unless validation has been suppressed for that transition.
				</p>
				<p>
					A Validator can also accept a Spring MVC <code class="code">Errors</code> object, which is required for invoking existing Spring Validators.
				</p>
				<p>
					Validators must be registered as Spring beans employing the naming convention <code class="code">${model}Validator</code> to be detected and invoked automatically.
					In the example above, Spring 2.5 classpath-scanning would detect the <code class="code">@Component</code> and automatically register it as a bean with the name <code class="code">bookingValidator</code>.
					Then, anytime the <code class="code">booking</code> model needs to be validated, this <code class="code">bookingValidator</code> instance would be invoked for you.
				</p>
			</div>
			<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="default-validate-method" href="#default-validate-method"></a>Default validate method</h4></div></div></div>
				
				<p>
					A <span class="emphasis"><em>Validator</em></span> class can also define a method called <code class="code">validate</code> not associated (by convention) with any specific view-state.
				</p>
				<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Booking booking, ValidationContext context) {
        <span class="hl-comment">//...</span>
    }
}
				</pre>
				<p>
					In the above code sample the method <code class="code">validate</code> will be called every time a Model of type <code class="code">Booking</code> is validated (unless validation has been suppressed for that transition).
					If needed the default method can also be called in addition to an existing state-specific method. Consider the following example:
				</p>
				<pre class="programlisting">
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Booking booking, ValidationContext context) {
        <span class="hl-comment">//...</span>
    }
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(Booking booking, ValidationContext context) {
        <span class="hl-comment">//...</span>
    }
}
				</pre>
				<p>
					In above code sample the method <code class="code">validateEnterBookingDetails</code> will be called first.
					The default <code class="code">validate</code> method will be called next.
				</p>
			</div>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-context" href="#view-validation-context"></a>5.10.3.&nbsp;ValidationContext</h3></div></div></div>
			
			<p>
				A ValidationContext allows you to obtain a <code class="code">MessageContext</code> to record messages during validation.
				It also exposes information about the current user, such as the signaled <code class="code">userEvent</code> and the current user's <code class="code">Principal</code> identity.
				This information can be used to customize validation logic based on what button or link was activated in the UI, or who is authenticated.
				See the API Javadocs for <code class="code">ValidationContext</code> for more information.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-validation-suppression" href="#view-validation-suppression"></a>5.11.&nbsp;Suppressing validation</h2></div></div></div>
		
		<p>
			Use the <code class="code">validate</code> attribute to suppress model validation for particular view events:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"chooseAmenities"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"back"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">validate</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/view-state&gt;</span>
		</pre>
		<p>
			In this example, data binding will still occur on <code class="code">back</code> but validation will be suppressed.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-transitions" href="#view-transitions"></a>5.12.&nbsp;Executing view transitions</h2></div></div></div>
		
		<p>
			Define one or more <code class="code">transition</code> elements to handle user events that may occur on the view.
			A transition may take the user to another view, or it may simply execute an action and re-render the current view.
			A transition may also request the rendering of parts of a view called "fragments" when handling an Ajax event.
			Finally, "global" transitions that are shared across all views may also be defined.
		</p>
		<p>
			Implementing view transitions is illustrated in the following sections.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="transition-actions" href="#transition-actions"></a>5.12.1.&nbsp;Transition actions</h3></div></div></div>
			
			<p>
				A view-state transition can execute one or more actions before executing.
				These actions may return an error result to prevent the transition from exiting the
				current view-state. If an error result occurs, the view will re-render and should display
				an appropriate message to the user.
			</p>
			<p>
				If the transition action invokes a plain Java method, the invoked method may return a boolean
				whose value, true or false, indicates whether the transition should take place or be prevented
				from executing. A method may also return a String where the literal values "success", "yes", or
				"true" indicate the transition should occur, and any other value means the opposite.
				This technique can be used to handle exceptions thrown by service-layer methods.
				The example below invokes an action that calls a service and handles an exceptional situation:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingAction.makeBooking(booking, messageContext)"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>
			<pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingAction {
   <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> makeBooking(Booking booking, MessageContext context) {
       <span class="hl-keyword">try</span> {
           bookingService.make(booking);
           <span class="hl-keyword">return</span> true;
       } <span class="hl-keyword">catch</span> (RoomNotAvailableException e) {
           context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().
               .defaultText(<span class="hl-string">"No room is available at this hotel"</span>).build());
           <span class="hl-keyword">return</span> false;
       }
   }
}
			</pre>
			<p>
				When there is more than one action defined on a transition, if one returns an error result the
				remaining actions in the set will <span class="emphasis"><em>not</em></span> be executed. If you need to ensure one
				transition action's result cannot impact the execution of another, define a single transition
				action that invokes a method that encapsulates all the action logic.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="event-handlers-global" href="#event-handlers-global"></a>5.12.2.&nbsp;Global transitions</h3></div></div></div>
			
			<p>
				Use the flow's <code class="code">global-transitions</code> element to create transitions that apply across all views.
				Global-transitions are often used to handle global menu links that are part of the layout.
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;global-transitions&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"login"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"login"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"logout"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"logout"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/global-transitions&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="simple-event-handlers" href="#simple-event-handlers"></a>5.12.3.&nbsp;Event handlers</h3></div></div></div>
			
			<p>
				From a view-state, transitions without targets can also be defined.  Such transitions are called "event handlers":
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"event"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- Handle event --&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>
			<p>
				These event handlers do not change the state of the flow.
				They simply execute their actions and re-render the current view or one or more fragments of the current view.
			</p>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="event-handlers-render" href="#event-handlers-render"></a>5.12.4.&nbsp;Rendering fragments</h3></div></div></div>
			
			<p>
				Use the <code class="code">render</code> element within a transition to request partial re-rendering of the current view after handling the event:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/transition&gt;</span>
			</pre>
			<p>
				The fragments attribute should reference the id(s) of the view element(s) you wish to re-render.
				Specify multiple elements to re-render by separating them with a comma delimiter.
			</p>
			<p>
				Such partial rendering is often used with events signaled by Ajax to update a specific zone of the view.
			</p>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-messages" href="#view-messages"></a>5.13.&nbsp;Working with messages</h2></div></div></div>
		
		<p>
			Spring Web Flow's <code class="code">MessageContext</code> is an API for recording messages during the course of flow executions.
			Plain text messages can be added to the context, as well as internationalized messages resolved by a Spring <code class="code">MessageSource</code>.
			Messages are renderable by views and automatically survive flow execution redirects.
			Three distinct message severities are provided: <code class="code">info</code>, <code class="code">warning</code>, and <code class="code">error</code>.
			In addition, a convenient <code class="code">MessageBuilder</code> exists for fluently constructing messages.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="plain-text-message" href="#plain-text-message"></a>5.13.1.&nbsp;Adding plain text messages</h3></div></div></div>
			
			<pre class="programlisting">
MessageContext context = ...
MessageBuilder builder = <span class="hl-keyword">new</span> MessageBuilder();
context.addMessage(builder.error().source(<span class="hl-string">"checkinDate"</span>)
    .defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
context.addMessage(builder.warn().source(<span class="hl-string">"smoking"</span>)
    .defaultText(<span class="hl-string">"Smoking is bad for your health"</span>).build());
context.addMessage(builder.info()
    .defaultText(<span class="hl-string">"We have processed your reservation - thank you and enjoy your stay"</span>).build());
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="plain-text-message-intl" href="#plain-text-message-intl"></a>5.13.2.&nbsp;Adding internationalized messages</h3></div></div></div>
			
			<pre class="programlisting">
MessageContext context = ...
MessageBuilder builder = <span class="hl-keyword">new</span> MessageBuilder();
context.addMessage(builder.error().source(<span class="hl-string">"checkinDate"</span>).code(<span class="hl-string">"checkinDate.notFuture"</span>).build());
context.addMessage(builder.warn().source(<span class="hl-string">"smoking"</span>).code(<span class="hl-string">"notHealthy"</span>)
    .resolvableArg(<span class="hl-string">"smoking"</span>).build());
context.addMessage(builder.info().code(<span class="hl-string">"reservationConfirmation"</span>).build());
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="message-bundles" href="#message-bundles"></a>5.13.3.&nbsp;Using message bundles</h3></div></div></div>
			
			<p>
				Internationalized messages are defined in message bundles accessed by a Spring <code class="code">MessageSource</code>.
				To create a flow-specific message bundle, simply define <code class="code">messages.properties</code> file(s) in your flow's directory.
				Create a default <code class="code">messages.properties</code> file and a .properties file for each additional <code class="code">Locale</code> you need to support.
			</p>
			<pre class="programlisting">
#messages.properties
checkinDate=Check in date must be a future date
notHealthy={0} is bad for your health
reservationConfirmation=We have processed your reservation - thank you and enjoy your stay
			</pre>
			<p>
				From within a view or a flow, you may also access message resources using the <code class="code">resourceBundle</code> EL variable:
			</p>
			<pre class="programlisting">
&lt;h:outputText value="#{resourceBundle.reservationConfirmation}" /&gt;
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="message-generation" href="#message-generation"></a>5.13.4.&nbsp;Understanding system generated messages</h3></div></div></div>
			
			<p>
				There are several places where Web Flow itself will generate messages to display to the user.
				One important place this occurs is during view-to-model data binding.
				When a binding error occurs, such as a type conversion error, Web Flow will map that error to a message retrieved from your resource bundle automatically.
				To lookup the message to display, Web Flow tries resource keys that contain the binding error code and target property name.
			</p>
			<p>
				As an example, consider a binding to a <code class="code">checkinDate</code> property of a <code class="code">Booking</code> object.
				Suppose the user typed in a alphabetic string.
				In this case, a type conversion error will be raised.
				Web Flow will map the 'typeMismatch' error code to a message by first querying your resource bundle for a message with the following key:
			</p>
			<pre class="programlisting">
booking.checkinDate.typeMismatch
			</pre>
			<p>
				The first part of the key is the model class's short name.
				The second part of the key is the property name. The third part is the error code.
				This allows for the lookup of a unique message to display to the user when a binding fails on a model property.
				Such a message might say:
			</p>
			<pre class="programlisting">
booking.checkinDate.typeMismatch=The check in date must be in the format yyyy-mm-dd.
			</pre>
			<p>
				If no such resource key can be found of that form, a more generic key will be tried.
				This key is simply the error code.  The field name of the property is provided as a message argument.
			</p>
			<pre class="programlisting">
typeMismatch=The {0} field is of the wrong type.
			</pre>
		</div>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-popup" href="#view-popup"></a>5.14.&nbsp;Displaying popups</h2></div></div></div>
		
		<p>
			Use the <code class="code">popup</code> attribute to render a view in a modal popup dialog:
		</p>
		<pre class="programlisting">
<span class="hl-tag">&lt;view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
		</pre>
		<p>
			When using Web Flow with the Spring Javascript, no client side code is necessary for the popup to display.
			Web Flow will send a response to the client requesting a redirect to the view from a popup, and the client will honor the request.
		</p>
	</div>
	<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-backtracking" href="#view-backtracking"></a>5.15.&nbsp;View backtracking</h2></div></div></div>
		
		<p>
			By default, when you exit a view state and transition to a new view state, you can go back to the previous state using the browser back button.
			These view state history policies are configurable on a per-transition basis by using the <code class="code">history</code> attribute.
		</p>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="history-discard" href="#history-discard"></a>5.15.1.&nbsp;Discarding history</h3></div></div></div>
			
			<p>
				Set the history attribute to <code class="code">discard</code> to prevent backtracking to a view:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">history</span>=<span class="hl-value">"discard"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
		<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="history-invalidate" href="#history-invalidate"></a>5.15.2.&nbsp;Invalidating history</h3></div></div></div>
			
			<p>
				Set the history attribute to <code class="code">invalidate</code> to prevent backtracking to a view as well all previously displayed views:
			</p>
			<pre class="programlisting">
<span class="hl-tag">&lt;transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> <span class="hl-attribute">history</span>=<span class="hl-value">"invalidate"</span><span class="hl-tag">&gt;</span>
			</pre>
		</div>
	</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="el.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="actions.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.&nbsp;Expression Language (EL)&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;6.&nbsp;Executing actions</td></tr></table></div></body></html>