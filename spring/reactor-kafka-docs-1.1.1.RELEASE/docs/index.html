<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Rajini Sivaram, Mark Pollack, Oleh Dokuka">
<title>Reactor Kafka Reference Guide</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Montserrat:400,700);
@import url(https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.6.2/semantic.min.css);


/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css);

article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
    display: block;
}

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video {
    display: inline-block;
}

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) {
    display: none;
    height: 0;
}

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template {
    display: none;
}

script {
    display: none !important;
}

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html {
    font-family: sans-serif; /* 1 */
    -ms-text-size-adjust: 100%; /* 2 */
    -webkit-text-size-adjust: 100%; /* 2 */
}

/** Remove default margin. */
body {
    margin: 0;
}

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a {
    background: transparent;
}

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus {
    outline: thin dotted;
}

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover {
    outline: 0;
}

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 {
    font-size: 2em;
    margin: 1.2em 0;
}

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] {
    border-bottom: 1px dotted;
}

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong {
    font-weight: bold;
}

/** Address styling not present in Safari 5 and Chrome. */
dfn {
    font-style: italic;
}

/** Address differences between Firefox and other browsers. */
hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/** Address styling not present in IE 8/9. */
mark {
    background: #ff0;
    color: #000;
}

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp {
    font-family: monospace, serif;
    font-size: 1em;
}

/** Improve readability of pre-formatted text in all browsers. */
pre {
    white-space: pre-wrap;
}

/** Set consistent quote types. */
q {
    quotes: "\201C" "\201D" "\2018" "\2019";
}

/** Address inconsistent and variable font size in all browsers. */
small {
    font-size: 80%;
}

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img {
    border: 0;
}

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) {
    overflow: hidden;
}

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure {
    margin: 0;
}

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend {
    border: 0; /* 1 */
    padding: 0; /* 2 */
}

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea {
    font-family: inherit; /* 1 */
    font-size: 100%; /* 2 */
    margin: 0; /* 3 */
}

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input {
    line-height: normal;
}

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select {
    text-transform: none;
}

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
}

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] {
    cursor: default;
}

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
}

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table {
    border-collapse: collapse;
    border-spacing: 0;
}

meta.foundation-mq-small {
    font-family: "only screen and (min-width: 768px)";
    width: 768px;
}

meta.foundation-mq-medium {
    font-family: "only screen and (min-width:1280px)";
    width: 1280px;
}

meta.foundation-mq-large {
    font-family: "only screen and (min-width:1440px)";
    width: 1440px;
}

*, *:before, *:after {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

html, body {
    font-size: 100%;
}

body {
    background: white;
    color: #34302d;
    padding: 0;
    margin: 0;
    font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    line-height: 1.8em;
    position: relative;
    cursor: auto;
}

#content, #content p {
    line-height: 1.8em;
}

a:hover {
    cursor: pointer;
}

img, object, embed {
    max-width: 100%;
    height: auto;
}

object, embed {
    height: 100%;
}

img {
    -ms-interpolation-mode: bicubic;
}

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object {
    max-width: none !important;
}

.left {
    float: left !important;
}

.right {
    float: right !important;
}

.text-left {
    text-align: left !important;
}

.text-right {
    text-align: right !important;
}

.text-center {
    text-align: center !important;
}

.text-justify {
    text-align: justify !important;
}

.hide {
    display: none;
}

.antialiased, body {
    -webkit-font-smoothing: antialiased;
}

img {
    display: inline-block;
    vertical-align: middle;
}

textarea {
    height: auto;
    min-height: 50px;
}

select {
    width: 100%;
}

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: 1.21875em;
}

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption {
    color: #6db33f;
    font-weight: 300;
    margin-top: 0.2em;
    margin-bottom: 0.5em;
}

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td {
    margin: 0;
    padding: 0;
    direction: ltr;
}

/* Default Link Styles */
a {
    color: #6db33f;
    line-height: inherit;
    text-decoration: none;
}

a:hover, a:focus {
    color: #6db33f;
    text-decoration: underline;
}

a img {
    border: none;
}

/* Default paragraph styles */
p {
    font-family: inherit;
    font-weight: normal;
    font-size: 1em;
    margin-bottom: 1.25em;
    text-rendering: optimizeLegibility;
}

p aside {
    font-size: 0.875em;
    font-style: italic;
}

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
    font-family: "Montserrat", Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    color: #34302d;
    text-rendering: optimizeLegibility;
    margin-top: 1.6em;
    margin-bottom: 0.6em;
}

h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small {
    font-size: 60%;
    color: #6db33f;
    line-height: 0;
}

h1 {
    font-size: 2.125em;
}

h2 {
    font-size: 1.6875em;
}

h3, #toctitle, .sidebarblock > .content > .title {
    font-size: 1.375em;
}

h4 {
    font-size: 1.125em;
}

h5 {
    font-size: 1.125em;
}

h6 {
    font-size: 1em;
}

hr {
    border: solid #dcd2c9;
    border-width: 1px 0 0;
    clear: both;
    margin: 1.25em 0 1.1875em;
    height: 0;
}

/* Helpful Typography Defaults */
em, i {
    font-style: italic;
    line-height: inherit;
}

strong, b {
    font-weight: bold;
    line-height: inherit;
}

small {
    font-size: 60%;
    line-height: inherit;
}

code {
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    font-weight: bold;
    color: #305CB5;
}

/* Lists */
ul, ol, dl {
    font-size: 1em;
    margin-bottom: 1.25em;
    list-style-position: outside;
    font-family: inherit;
}

ul, ol {
    margin-left: 1.5em;
}

ul.no-bullet, ol.no-bullet {
    margin-left: 1.5em;
}

/* Unordered Lists */
ul li ul, ul li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
    font-size: 1em; /* Override nested font-size change */
}

ul.square li ul, ul.circle li ul, ul.disc li ul {
    list-style: inherit;
}

ul.square {
    list-style-type: square;
}

ul.circle {
    list-style-type: circle;
}

ul.disc {
    list-style-type: disc;
}

ul.no-bullet {
    list-style: none;
}

/* Ordered Lists */
ol li ul, ol li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
}

/* Definition Lists */
dl dt {
    margin-bottom: 0.3125em;
    font-weight: bold;
}

dl dd {
    margin-bottom: 1.25em;
}

/* Abbreviations */
abbr, acronym {
    text-transform: uppercase;
    font-size: 90%;
    color: #34302d;
    border-bottom: 1px dotted #dddddd;
    cursor: help;
}

abbr {
    text-transform: none;
}

/* Blockquotes */
blockquote {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 1px solid #dddddd;
}

blockquote cite {
    display: block;
    font-size: 0.8125em;
    color: #655241;
}

blockquote cite:before {
    content: "\2014 \0020";
}

blockquote cite a, blockquote cite a:visited {
    color: #655241;
}

blockquote, blockquote p {
    color: #34302d;
}

/* Microformats */
.vcard {
    display: inline-block;
    margin: 0 0 1.25em 0;
    border: 1px solid #dddddd;
    padding: 0.625em 0.75em;
}

.vcard li {
    margin: 0;
    display: block;
}

.vcard .fn {
    font-weight: bold;
    font-size: 0.9375em;
}

.vevent .summary {
    font-weight: bold;
}

.vevent abbr {
    cursor: auto;
    text-decoration: none;
    font-weight: bold;
    border: none;
    padding: 0 0.0625em;
}

@media only screen and (min-width: 768px) {
    h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
    }

    h1 {
        font-size: 2.75em;
    }

    h2 {
        font-size: 2.3125em;
    }

    h3, #toctitle, .sidebarblock > .content > .title {
        font-size: 1.6875em;
    }

    h4 {
        font-size: 1.4375em;
    }
}

/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only {
    display: none !important;
}

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a, a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
        content: "";
    }

    pre, blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr, img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p, h2, h3, #toctitle, .sidebarblock > .content > .title {
        orphans: 3;
        widows: 3;
    }

    h2, h3, #toctitle, .sidebarblock > .content > .title {
        page-break-after: avoid;
    }

    .hide-on-print {
        display: none !important;
    }

    .print-only {
        display: block !important;
    }

    .hide-for-print {
        display: none !important;
    }

    .show-for-print {
        display: inherit !important;
    }
}

/* Tables */
table {
    background: white;
    margin-bottom: 1.25em;
    border: solid 1px #34302d;
}

table thead, table tfoot {
    font-weight: bold;
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
    padding: 0.5em 0.625em 0.625em;
    font-size: inherit;
    color: #34302d;
    text-align: left;
}

table thead tr th {
    color: white;
    background: #34302d;
}

table tr th, table tr td {
    padding: 0.5625em 0.625em;
    font-size: inherit;
    color: #34302d;
    border: 0 none;
}

table tr.even, table tr.alt, table tr:nth-of-type(even) {
    background: #f2F2F2;
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
    display: table-cell;
}

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after {
    content: " ";
    display: table;
}

.clearfix:after, .float-group:after {
    clear: both;
}

*:not(pre) > code {
    font-size: inherit;
    padding: 0;
    white-space: nowrap;
    background-color: inherit;
    border: 0 solid #dddddd;
    -webkit-border-radius: 6px;
    border-radius: 6px;
    text-shadow: none;
}

pre, pre > code {
    color: black;
    font-family: monospace, serif;
    font-weight: normal;
}

.keyseq {
    color: #774417;
}

kbd:not(.keyseq) {
    display: inline-block;
    color: #211306;
    font-size: 0.75em;
    background-color: #F7F7F7;
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    margin: -0.15em 0.15em 0 0.15em;
    padding: 0.2em 0.6em 0.2em 0.5em;
    vertical-align: middle;
    white-space: nowrap;
}

.keyseq kbd:first-child {
    margin-left: 0;
}

.keyseq kbd:last-child {
    margin-right: 0;
}

.menuseq, .menu {
    color: black;
}

b.button:before, b.button:after {
    position: relative;
    top: -1px;
    font-weight: normal;
}

b.button:before {
    content: "[";
    padding: 0 3px 0 2px;
}

b.button:after {
    content: "]";
    padding: 0 2px 0 3px;
}

p a > code:hover {
    color: #541312;
}

#header, #content, #footnotes, #footer {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;
    margin-bottom: 0;
    max-width: 62.5em;
    *zoom: 1;
    position: relative;
    padding-left: 4em;
    padding-right: 4em;
}

#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after {
    content: " ";
    display: table;
}

#header:after, #content:after, #footnotes:after, #footer:after {
    clear: both;
}

#header {
    margin-bottom: 2.5em;
}

#header > h1 {
    color: #34302d;
    font-weight: 400;
}

#header span {
    color: #34302d;
}

#header #revnumber {
    text-transform: capitalize;
}

#header br {
    display: none;
}

#header br + span {
}

#revdate {
    display: block;
}

#toc {
    border-bottom: 1px solid #e6dfd8;
    padding-bottom: 1.25em;
}

#toc > ul {
    margin-left: 0.25em;
}

#toc ul.sectlevel0 > li > a {
    font-style: italic;
}

#toc ul.sectlevel0 ul.sectlevel1 {
    margin-left: 0;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}

#toc ul {
    list-style-type: none;
}

#toctitle {
    color: #385dbd;
}

@media only screen and (min-width: 768px) {
    body.toc2 {
        padding-left: 15em;
        padding-right: 0;
    }

    #toc.toc2 {
        position: fixed;
        width: 15em;
        left: 0;
        border-bottom: 0;
        z-index: 1000;
        padding: 1em;
        height: 100%;
        top: 0px;
        background: #F1F1F1;
        overflow: auto;

        -moz-transition-property: top;
        -o-transition-property: top;
        -webkit-transition-property: top;
        transition-property: top;
        -moz-transition-duration: 0.4s;
        -o-transition-duration: 0.4s;
        -webkit-transition-duration: 0.4s;
        transition-duration: 0.4s;
    }

    #reactor-header {
        position: fixed;
        top: -75px;
        left: 0;
        right: 0;
        height: 75px;


        -moz-transition-property: top;
        -o-transition-property: top;
        -webkit-transition-property: top;
        transition-property: top;
        -moz-transition-duration: 0.4s;
        -o-transition-duration: 0.4s;
        -webkit-transition-duration: 0.4s;
        transition-duration: 0.4s;
    }

    body.head-show #toc.toc2 {
        top: 75px;
    }
    body.head-show #reactor-header {
        top: 0;
    }

    #toc.toc2 a {
        color: #34302d;
        font-family: Montserrat;
    }

    #toc.toc2 #toctitle {
        margin-top: 0;
        font-size: 1.2em;
    }

    #toc.toc2 > ul {
        font-size: .90em;
    }

    #toc.toc2 ul ul {
        margin-left: 0;
        padding-left: 0.4em;
    }

    #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
        padding-left: 0;
        margin-top: 0.5em;
        margin-bottom: 0.5em;
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 15em;
    }

    body.toc2.toc-right #toc.toc2 {
        border-right: 0;
        border-left: 1px solid #e6dfd8;
        left: auto;
        right: 0;
    }
}

@media only screen and (min-width: 1280px) {
    body.toc2 {
        padding-left: 20em;
        padding-right: 0;
    }

    #toc.toc2 {
        width: 20em;
    }

    #toc.toc2 #toctitle {
        font-size: 1.375em;
    }

    #toc.toc2 > ul {
        font-size: 0.95em;
    }

    #toc.toc2 ul ul {
        padding-left: 1.25em;
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 20em;
    }
}

#content #toc {
    border-style: solid;
    border-width: 1px;
    border-color: #d9d9d9;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #f2f2f2;
    border-width: 0;
    -webkit-border-radius: 6px;
    border-radius: 6px;
}

#content #toc > :first-child {
    margin-top: 0;
}

#content #toc > :last-child {
    margin-bottom: 0;
}

#content #toc a {
    text-decoration: none;
}

#content #toctitle {
    font-weight: bold;
    font-family: "Montserrat", Arial, sans-serif;
    font-size: 1em;
    padding-left: 0.125em;
}

#footer {
    max-width: 100%;
    background-color: white;
    padding: 1.25em;
    color: #CCC;
    border-top: 3px solid #F1F1F1;
}

#footer-text {
    color: #444;
    line-height: 1.44;
}

.sect1 {
    padding-bottom: 1.25em;
}

.sect1 + .sect1 {
    border-top: 1px solid #e6dfd8;
}

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor {
    position: absolute;
    width: 1em;
    margin-left: -1em;
    display: block;
    text-decoration: none;
    visibility: hidden;
    text-align: center;
    font-weight: normal;
}

#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before {
    content: '\00A7';
    font-size: .85em;
    vertical-align: text-top;
    display: block;
    margin-top: 0.05em;
}

#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover {
    visibility: visible;
}

#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link {
    color: #34302d;
    text-decoration: none;
}

#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover {
    color: #34302d;
}

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock {
    margin-bottom: 1.25em;
    margin-top: 1.25em;
}

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title {
    text-align: left;
    font-weight: bold;
}

.tableblock > caption {
    text-align: left;
    font-weight: bold;
    white-space: nowrap;
    overflow: visible;
    max-width: 0;
}

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: inherit;
}

.admonitionblock > table {
    border: 0;
    background: none;
    width: 100%;
}

.admonitionblock > table td.icon {
    text-align: center;
    width: 80px;
}

.admonitionblock > table td.icon img {
    max-width: none;
}

.admonitionblock > table td.icon .title {
    font-weight: bold;
    text-transform: uppercase;
}

.admonitionblock > table td.content {
    padding-left: 1.125em;
    padding-right: 1.25em;
    border-left: 1px solid #dcd2c9;
    color: #34302d;
}

.admonitionblock > table td.content > :last-child > :last-child {
    margin-bottom: 0;
}

.exampleblock > .content {
    border-style: solid;
    border-width: 1px;
    border-color: #f3e0ce;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: white;
    -webkit-border-radius: 6px;
    border-radius: 6px;
}

.exampleblock > .content > :first-child {
    margin-top: 0;
}

.exampleblock > .content > :last-child {
    margin-bottom: 0;
}

.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p {
    color: #333333;
}

.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 {
    margin-bottom: 0.625em;
}

.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader {
}

.exampleblock.result > .content {
    -webkit-box-shadow: 0 1px 8px #d9d9d9;
    box-shadow: 0 1px 8px #d9d9d9;
}

.sidebarblock {
    padding: 1.25em 2em;
    background: #F1F1F1;
    margin: 2em -2em;

}

.sidebarblock > :first-child {
    margin-top: 0;
}

.sidebarblock > :last-child {
    margin-bottom: 0;
}

.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p {
    color: #333333;
}

.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 {
    margin-bottom: 0.625em;
}

.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader {
}

.sidebarblock > .content > .title {
    color: #6db33f;
    margin-top: 0;
    font-size: 1.2em;
}

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child {
    margin-bottom: 0;
}

.literalblock pre:not([class]), .listingblock pre:not([class]) {
    background: url('../images/golo/pre-bg.png?1370460826');
}

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
    border-width: 1px;
    border-style: solid;
    border-color: rgba(21, 35, 71, 0.1);
    -webkit-border-radius: 6px;
    border-radius: 6px;
    padding: 0.8em;
    word-wrap: break-word;
}

.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap {
    overflow-x: auto;
    white-space: pre;
    word-wrap: normal;
}

.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code {
    display: block;
}

@media only screen {
    .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
        font-size: 0.72em;
    }
}

@media only screen and (min-width: 768px) {
    .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
        font-size: 0.81em;
    }
}

@media only screen and (min-width: 1280px) {
    .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] {
        font-size: 0.9em;
    }
}

.listingblock pre.highlight {
    padding: 0;
    line-height: 1em;
}

.listingblock pre.highlight > code {
    padding: 0.8em;
}

.listingblock > .content {
    position: relative;
}

.listingblock:hover code[class*=" language-"]:before {
    text-transform: uppercase;
    font-size: 0.9em;
    color: #999;
    position: absolute;
    top: 0.375em;
    right: 0.375em;
}

.listingblock:hover code.asciidoc:before {
    content: "asciidoc";
}

.listingblock:hover code.clojure:before {
    content: "clojure";
}

.listingblock:hover code.css:before {
    content: "css";
}

.listingblock:hover code.groovy:before {
    content: "groovy";
}

.listingblock:hover code.html:before {
    content: "html";
}

.listingblock:hover code.java:before {
    content: "java";
}

.listingblock:hover code.javascript:before {
    content: "javascript";
}

.listingblock:hover code.python:before {
    content: "python";
}

.listingblock:hover code.ruby:before {
    content: "ruby";
}

.listingblock:hover code.sass:before {
    content: "sass";
}

.listingblock:hover code.scss:before {
    content: "scss";
}

.listingblock:hover code.xml:before {
    content: "xml";
}

.listingblock:hover code.yaml:before {
    content: "yaml";
}

.listingblock.terminal pre .command:before {
    content: attr(data-prompt);
    padding-right: 0.5em;
    color: #999;
}

.listingblock.terminal pre .command:not([data-prompt]):before {
    content: '$';
}

table.pyhltable {
    border: 0;
    margin-bottom: 0;
}

table.pyhltable td {
    vertical-align: top;
    padding-top: 0;
    padding-bottom: 0;
}

table.pyhltable td.code {
    padding-left: .75em;
    padding-right: 0;
}

.highlight.pygments .lineno, table.pyhltable td:not(.code) {
    color: #999;
    padding-left: 0;
    padding-right: .5em;
    border-right: 1px solid #dcd2c9;
}

.highlight.pygments .lineno {
    display: inline-block;
    margin-right: .25em;
}

table.pyhltable .linenodiv {
    background-color: transparent !important;
    padding-right: 0 !important;
}

.quoteblock {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 3px solid #dddddd;
}

.quoteblock blockquote {
    margin: 0 0 1.25em 0;
    padding: 0 0 0.5625em 0;
    border: 0;
}

.quoteblock blockquote > .paragraph:last-child p {
    margin-bottom: 0;
}

.quoteblock .attribution {
    margin-top: -.25em;
    padding-bottom: 0.5625em;
    font-size: 0.8125em;
}

.quoteblock .attribution br {
    display: none;
}

.quoteblock .attribution cite {
    display: block;
    margin-bottom: 0.625em;
}

table thead th, table tfoot th {
    font-weight: bold;
}

table.tableblock.grid-all {
    border-collapse: separate;
    border-radius: 6px;
    border-top: 1px solid #34302d;
    border-bottom: 1px solid #34302d;
}

table.tableblock.frame-topbot, table.tableblock.frame-none {
    border-left: 0;
    border-right: 0;
}

table.tableblock.frame-sides, table.tableblock.frame-none {
    border-top: 0;
    border-bottom: 0;
}

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child {
    margin-bottom: 0;
}

th.tableblock.halign-left, td.tableblock.halign-left {
    text-align: left;
}

th.tableblock.halign-right, td.tableblock.halign-right {
    text-align: right;
}

th.tableblock.halign-center, td.tableblock.halign-center {
    text-align: center;
}

th.tableblock.valign-top, td.tableblock.valign-top {
    vertical-align: top;
}

th.tableblock.valign-bottom, td.tableblock.valign-bottom {
    vertical-align: bottom;
}

th.tableblock.valign-middle, td.tableblock.valign-middle {
    vertical-align: middle;
}

tbody tr th {
    display: table-cell;
    background: rgba(105, 60, 22, 0.25);
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
    color: #211306;
    font-weight: bold;
}

td > div.verse {
    white-space: pre;
}

ol {
    margin-left: 1.75em;
}

ul li ol {
    margin-left: 1.5em;
}

dl dd {
    margin-left: 1.125em;
}

dl dd:last-child, dl dd:last-child > :last-child {
    margin-bottom: 0;
}

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist {
    margin-bottom: 0.625em;
}

ul.unstyled, ol.unnumbered, ul.checklist, ul.none {
    list-style-type: none;
}

ul.unstyled, ol.unnumbered, ul.checklist {
    margin-left: 0.625em;
}

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
    margin-right: 0.25em;
}

ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
    position: relative;
    top: 1px;
}

ul.inline {
    margin: 0 auto 0.625em auto;
    margin-left: -1.375em;
    margin-right: 0;
    padding: 0;
    list-style: none;
    overflow: hidden;
}

ul.inline > li {
    list-style: none;
    float: left;
    margin-left: 1.375em;
    display: block;
}

ul.inline > li > * {
    display: block;
}

.unstyled dl dt {
    font-weight: normal;
    font-style: normal;
}

ol.arabic {
    list-style-type: decimal;
}

ol.decimal {
    list-style-type: decimal-leading-zero;
}

ol.loweralpha {
    list-style-type: lower-alpha;
}

ol.upperalpha {
    list-style-type: upper-alpha;
}

ol.lowerroman {
    list-style-type: lower-roman;
}

ol.upperroman {
    list-style-type: upper-roman;
}

ol.lowergreek {
    list-style-type: lower-greek;
}

.hdlist > table, .colist > table {
    border: 0;
    background: none;
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
    background: none;
}

td.hdlist1 {
    padding-right: .75em;
    font-weight: bold;
}

td.hdlist1, td.hdlist2 {
    vertical-align: top;
}

.literalblock + .colist, .listingblock + .colist {
    margin-top: -0.5em;
}

.colist > table tr > td:first-of-type {
    padding: 0 .75em;
}

.colist > table tr > td:last-of-type {
    padding: 0.25em 0;
}

.qanda > ol > li > p > em:only-child {
    color: #063f40;
}

.thumb, .th {
    line-height: 0;
    display: inline-block;
    border: solid 4px white;
    -webkit-box-shadow: 0 0 0 1px #dddddd;
    box-shadow: 0 0 0 1px #dddddd;
}

.imageblock.left, .imageblock[style*="float: left"] {
    margin: 0.25em 0.625em 1.25em 0;
}

.imageblock.right, .imageblock[style*="float: right"] {
    margin: 0.25em 0 1.25em 0.625em;
}

.imageblock > .title {
    margin-bottom: 0;
}

.imageblock.thumb, .imageblock.th {
    border-width: 6px;
}

.imageblock.thumb > .title, .imageblock.th > .title {
    padding: 0 0.125em;
}

.image.left, .image.right {
    margin-top: 0.25em;
    margin-bottom: 0.25em;
    display: inline-block;
    line-height: 0;
}

.image.left {
    margin-right: 0.625em;
}

.image.right {
    margin-left: 0.625em;
}

a.image {
    text-decoration: none;
}

span.footnote, span.footnoteref {
    vertical-align: super;
    font-size: 0.875em;
}

span.footnote a, span.footnoteref a {
    text-decoration: none;
}

#footnotes {
    padding-top: 0.75em;
    padding-bottom: 0.75em;
    margin-bottom: 0.625em;
}

#footnotes hr {
    width: 20%;
    min-width: 6.25em;
    margin: -.25em 0 .75em 0;
    border-width: 1px 0 0 0;
}

#footnotes .footnote {
    padding: 0 0.375em;
    font-size: 0.875em;
    margin-left: 1.2em;
    text-indent: -1.2em;
    margin-bottom: .2em;
}

#footnotes .footnote a:first-of-type {
    font-weight: bold;
    text-decoration: none;
}

#footnotes .footnote:last-of-type {
    margin-bottom: 0;
}

#content #footnotes {
    margin-top: -0.625em;
    margin-bottom: 0;
    padding: 0.75em 0;
}

.gist .file-data > table {
    border: none;
    background: #fff;
    width: 100%;
    margin-bottom: 0;
}

.gist .file-data > table td.line-data {
    width: 99%;
}

div.unbreakable {
    page-break-inside: avoid;
}

.big {
    font-size: larger;
}

.small {
    font-size: smaller;
}

.underline {
    text-decoration: underline;
}

.overline {
    text-decoration: overline;
}

.line-through {
    text-decoration: line-through;
}

.aqua {
    color: #00bfbf;
}

.aqua-background {
    background-color: #00fafa;
}

.black {
    color: black;
}

.black-background {
    background-color: black;
}

.blue {
    color: #0000bf;
}

.blue-background {
    background-color: #0000fa;
}

.fuchsia {
    color: #bf00bf;
}

.fuchsia-background {
    background-color: #fa00fa;
}

.gray {
    color: #606060;
}

.gray-background {
    background-color: #7d7d7d;
}

.green {
    color: #006000;
}

.green-background {
    background-color: #007d00;
}

.lime {
    color: #00bf00;
}

.lime-background {
    background-color: #00fa00;
}

.maroon {
    color: #600000;
}

.maroon-background {
    background-color: #7d0000;
}

.navy {
    color: #000060;
}

.navy-background {
    background-color: #00007d;
}

.olive {
    color: #606000;
}

.olive-background {
    background-color: #7d7d00;
}

.purple {
    color: #600060;
}

.purple-background {
    background-color: #7d007d;
}

.red {
    color: #bf0000;
}

.red-background {
    background-color: #fa0000;
}

.silver {
    color: #909090;
}

.silver-background {
    background-color: #bcbcbc;
}

.teal {
    color: #006060;
}

.teal-background {
    background-color: #007d7d;
}

.white {
    color: #bfbfbf;
}

.white-background {
    background-color: #fafafa;
}

.yellow {
    color: #bfbf00;
}

.yellow-background {
    background-color: #fafa00;
}

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] {
    cursor: default;
}

.admonitionblock td.icon [class^="icon-"]:before {
    font-size: 2.5em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    cursor: default;
}

.admonitionblock td.icon .icon-note:before {
    content: "\f05a";
    color: #095557;
    color: #064042;
}

.admonitionblock td.icon .icon-tip:before {
    content: "\f0eb";
    text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8);
    color: #111;
}

.admonitionblock td.icon .icon-warning:before {
    content: "\f071";
    color: #bf6900;
}

.admonitionblock td.icon .icon-caution:before {
    content: "\f06d";
    color: #bf3400;
}

.admonitionblock td.icon .icon-important:before {
    content: "\f06a";
    color: #bf0000;
}

.conum {
    display: inline-block;
    color: white !important;
    background-color: #211306;
    -webkit-border-radius: 100px;
    border-radius: 100px;
    text-align: center;
    width: 20px;
    height: 20px;
    font-size: 12px;
    font-weight: bold;
    line-height: 20px;
    font-family: Arial, sans-serif;
    font-style: normal;
    position: relative;
    top: -2px;
    letter-spacing: -1px;
}

.conum * {
    color: white !important;
}

.conum + b {
    display: none;
}

.conum:after {
    content: attr(data-value);
}

.conum:not([data-value]):empty {
    display: none;
}

body {
    padding-top: 60px;
}

#toc.toc2 ul ul {
    padding-left: 1em;
}
#toc.toc2 ul ul.sectlevel2 {
}

#toctitle {
    color: #34302d;
    display: none;
}

#header h1 {
    font-weight: bold;
    position: relative;
    left: -0.0625em;
}

#header h1 span.lo {
    color: #dc9424;
}

#content h2, #content h3, #content #toctitle, #content .sidebarblock > .content > .title, #content h4, #content h5, #content #toctitle {
    font-weight: normal;
    position: relative;
    left: -0.0625em;
}

#content h2 {
    font-weight: bold;
}

.literalblock .content pre.highlight, .listingblock .content pre.highlight {
    background: url('../images/golo/pre-bg.png?1370460826');
}

.admonitionblock > table td.content {
    border-color: #e6dfd8;
}

table.tableblock.grid-all {
    -webkit-border-radius: 0;
    border-radius: 0;
}

#footer {
    background-color: #while;
    color: #34302d;
}

.imageblock .title {
    text-align: center;
}

#content h1.sect0 {
    font-size: 48px;
}

#toc > ul > li > a {
    font-size: large;
}




@import url(https://fonts.googleapis.com/css?family=Montserrat:400,700|Karla:400,700);
body {
}
#reactor-header {
    background: #34302d;
    border-top: 4px solid #6db33f;
    z-index: 2000;
    font-family: 'Montserrat';
    height: 75px;
}

#reactor-header h1#logo {
    margin: 7px 0 0 10px;
    padding: 0;
    float: left;
}

#reactor-header h1#logo a {
    display: block;
    background: url(images/logo-2x.png) no-repeat 0 0;
    background-size: 253px 80px;
    height: 40px;
    width: 253px;
    text-indent: -6000em;
    margin: 8px 0;
}
#reactor-header h1#logo a:hover strong {
    filter: progid:DXImageTransform.Microsoft.Alpha(enabled=false);
    opacity: 1;
}
#reactor-header h1#logo a strong {
    display: block;
    background: url(images/logo-2x.png) no-repeat 0 -30px;
    background-size: 190px 60px;
    height: 30px;
    width: 190px;
    text-indent: -6000em;
    margin: 8px 0;
    -moz-transition-property: opacity;
    -o-transition-property: opacity;
    -webkit-transition-property: opacity;
    transition-property: opacity;
    -moz-transition-duration: 0.2s;
    -o-transition-duration: 0.2s;
    -webkit-transition-duration: 0.2s;
    transition-duration: 0.2s;
    filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);
    opacity: 0;
}

#nav, #nav ul {
    display: block;
    margin: 0;
    padding: 0;
}
#nav {
    float: right;
    margin-right: 10px;
}
#nav ul li {
    display: block;
    float: left;
    list-style: none;
    margin: 0;
    padding: 0;
}
#nav ul li a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    display: block;
    text-transform: uppercase;
    font-size: 13.5px;
    line-height: 71px;
    margin: 0;
    padding: 0 12px;
    -moz-transition-property: background-color;
    -o-transition-property: background-color;
    -webkit-transition-property: background-color;
    transition-property: background-color;
    -moz-transition-duration: 0.2s;
    -o-transition-duration: 0.2s;
    -webkit-transition-duration: 0.2s;
    transition-duration: 0.2s;
}
#nav ul li a:hover {
    background: #6db33f;
}
#nav ul li a.active {
    background: #6db33f;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Reactor Kafka Reference Guide</h1>
<div class="details">
<span id="author" class="author">Rajini Sivaram, Mark Pollack, Oleh Dokuka</span><br>
<span id="revdate">1.1.1.RELEASE</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#apache-kafka">1.1. Apache Kafka</a></li>
<li><a href="#_project_reactor">1.2. Project Reactor</a></li>
<li><a href="#_reactive_api_for_kafka">1.3. Reactive API for Kafka</a></li>
</ul>
</li>
<li><a href="#_motivation">2. Motivation</a>
<ul class="sectlevel2">
<li><a href="#motivation-functional">2.1. Functional interface for Kafka</a></li>
<li><a href="#back-pressure">2.2. Non-blocking Back-pressure</a></li>
<li><a href="#end-to-end-reactive">2.3. End-to-end Reactive Pipeline</a></li>
<li><a href="#comparison">2.4. Comparisons with other Kafka APIs</a>
<ul class="sectlevel3">
<li><a href="#_kafka_producer_and_consumer_apis">2.4.1. Kafka Producer and Consumer APIs</a></li>
<li><a href="#_kafka_connect_api">2.4.2. Kafka Connect API</a></li>
<li><a href="#_kafka_streams_api">2.4.3. Kafka Streams API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_getting_started">3. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#requirements">3.1. Requirements</a></li>
<li><a href="#_quick_start">3.2. Quick Start</a>
<ul class="sectlevel3">
<li><a href="#_start_kafka">3.2.1. Start Kafka</a></li>
<li><a href="#_run_reactor_kafka_samples">3.2.2. Run Reactor Kafka Samples</a>
<ul class="sectlevel4">
<li><a href="#_sample_producer">Sample Producer</a></li>
<li><a href="#_sample_consumer">Sample Consumer</a></li>
</ul>
</li>
<li><a href="#_building_reactor_kafka_applications">3.2.3. Building Reactor Kafka Applications</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_additional_resources">4. Additional Resources</a>
<ul class="sectlevel2">
<li><a href="#support">4.1. Getting help</a></li>
<li><a href="#resources">4.2. Resources</a></li>
</ul>
</li>
<li><a href="#_new_noteworthy">5. New &amp; Noteworthy</a>
<ul class="sectlevel2">
<li><a href="#new">5.1. What&#8217;s new in Reactor Kafka 1.0.0.RELEASE</a></li>
<li><a href="#_what_s_new_in_reactor_kafka_1_0_1_release">5.2. What&#8217;s new in Reactor Kafka 1.0.1.RELEASE</a></li>
<li><a href="#_what_s_new_in_reactor_kafka_1_1_0_release">5.3. What&#8217;s new in Reactor Kafka 1.1.0.RELEASE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_reference_documentation">Reference Documentation</a>
<ul class="sectlevel1">
<li><a href="#_reactor_kafka_api">6. Reactor Kafka API</a>
<ul class="sectlevel2">
<li><a href="#api-guide-overview">6.1. Overview</a></li>
<li><a href="#api-guide-sender">6.2. Reactive Kafka Sender</a>
<ul class="sectlevel3">
<li><a href="#_error_handling">6.2.1. Error handling</a></li>
<li><a href="#_send_without_result_metadata">6.2.2. Send without result metadata</a></li>
<li><a href="#_threading_model">6.2.3. Threading model</a></li>
<li><a href="#_non_blocking_back_pressure">6.2.4. Non-blocking back-pressure</a></li>
<li><a href="#_closing_the_kafkasender">6.2.5. Closing the KafkaSender</a></li>
<li><a href="#_access_to_the_underlying_code_kafkaproducer_code">6.2.6. Access to the underlying <code>KafkaProducer</code></a></li>
</ul>
</li>
<li><a href="#api-guide-receiver">6.3. Reactive Kafka Receiver</a>
<ul class="sectlevel3">
<li><a href="#_subscribing_to_wildcard_patterns">6.3.1. Subscribing to wildcard patterns</a></li>
<li><a href="#_manual_assignment_of_topic_partitions">6.3.2. Manual assignment of topic partitions</a></li>
<li><a href="#_controlling_commit_frequency">6.3.3. Controlling commit frequency</a></li>
<li><a href="#_auto_acknowledgement_of_batches_of_records">6.3.4. Auto-acknowledgement of batches of records</a></li>
<li><a href="#_disabling_automatic_commits">6.3.5. Disabling automatic commits</a></li>
<li><a href="#_at_most_once_delivery">6.3.6. At-most-once delivery</a></li>
<li><a href="#_partition_assignment_and_revocation_listeners">6.3.7. Partition assignment and revocation listeners</a></li>
<li><a href="#_controlling_start_offsets_for_consuming_records">6.3.8. Controlling start offsets for consuming records</a></li>
<li><a href="#_consumer_lifecycle">6.3.9. Consumer lifecycle</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_sample_scenarios">7. Sample Scenarios</a>
<ul class="sectlevel2">
<li><a href="#sample-producer">7.1. Sending records to Kafka</a></li>
<li><a href="#sample-consumer">7.2. Replaying records from Kafka topics</a></li>
<li><a href="#kafka-sink">7.3. Reactive pipeline with Kafka sink</a></li>
<li><a href="#kafka-source">7.4. Reactive pipeline with Kafka source</a></li>
<li><a href="#kafka-source-sink">7.5. Reactive pipeline with Kafka source and sink</a></li>
<li><a href="#at-most-once">7.6. At-most-once delivery</a></li>
<li><a href="#fan-out">7.7. Fan-out with Multiple Streams</a></li>
<li><a href="#concurrent-ordered">7.8. Concurrent Processing with Partition-Based Ordering</a></li>
<li><a href="#transactional-sender">7.9. Transactional send</a></li>
<li><a href="#exactly-once">7.10. Exactly-once delivery</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction" class="sect0">Introduction</h1>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="apache-kafka">1.1. Apache Kafka</h3>
<div class="paragraph">
<p><a href="https://kafka.apache.org">Kafka</a> is a scalable, high-performance distributed messaging engine.
Low latency, high throughput messaging capability combined with fault-tolerance have made Kafka a popular
messaging service as well as a powerful streaming platform for processing real-time streams of events.</p>
</div>
<div class="paragraph">
<p>Apache Kafka provides three main APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Producer/Consumer API to publish messages to Kafka topics and consume messages from Kafka topics</p>
</li>
<li>
<p>Connector API to pull data from existing data storage systems to Kafka or push data from Kafka topics to other data systems</p>
</li>
<li>
<p>Streams API for transforming and analyzing real-time streams of events published to Kafka</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_project_reactor">1.2. Project Reactor</h3>
<div class="paragraph">
<p><a href="https://projectreactor.io">Reactor</a> is a highly optimized reactive library for building efficient, non-blocking
applications on the JVM based on the <a href="https://github.com/reactive-streams/reactive-streams-jvm">Reactive Streams Specification</a>.
Reactor based applications can sustain very high throughput message rates and operate with a very low memory footprint,
making it suitable for building efficient event-driven applications using the microservices architecture.</p>
</div>
<div class="paragraph">
<p>Reactor implements two publishers <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux&lt;T&gt;</a> and
<a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono&lt;T&gt;</a>, both of which support non-blocking back-pressure.
This enables exchange of data between threads with well-defined memory usage, avoiding unnecessary intermediate buffering or blocking.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reactive_api_for_kafka">1.3. Reactive API for Kafka</h3>
<div class="paragraph">
<p><a href="../api/index.html">Reactor Kafka</a> is a reactive API for Kafka based on Reactor and the Kafka Producer/Consumer API.
Reactor Kafka API enables messages to be published to Kafka and consumed from Kafka using functional APIs
with non-blocking back-pressure and very low overheads. This enables applications using Reactor to use
Kafka as a message bus or streaming platform and integrate with other systems to provide an end-to-end reactive pipeline.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">2. Motivation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="motivation-functional">2.1. Functional interface for Kafka</h3>
<div class="paragraph">
<p>Reactor Kafka is a functional Java API for Kafka. For applications that are written in functional style,
this API enables Kafka interactions to be integrated easily without requiring non-functional
asynchronous produce or consume APIs to be incorporated into the application logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="back-pressure">2.2. Non-blocking Back-pressure</h3>
<div class="paragraph">
<p>The Reactor Kafka API benefits from non-blocking back-pressure provided by Reactor. For example, in a pipeline, where
messages received from an external source (e.g. an HTTP proxy) are published to Kafka, back-pressure can be applied easily to the
whole pipeline, limiting the number of messages in-flight and controlling memory usage. Messages flow through
the pipeline as they are available, with Reactor taking care of limiting the flow rate to avoid overflow,
keeping application logic simple.</p>
</div>
</div>
<div class="sect2">
<h3 id="end-to-end-reactive">2.3. End-to-end Reactive Pipeline</h3>
<div class="paragraph">
<p>The value proposition for Reactor Kafka is the efficient utilization of resources in applications with multiple
external interactions where Kafka is one of the external systems. End-to-end reactive pipelines benefit from
non-blocking back-pressure and efficient use of threads, enabling a large number of concurrent requests to be
processed efficiently. The optimizations provided by Project Reactor enable development of reactive applications
with very low overheads and predictable capacity planning to deliver low-latency, high-throughput pipelines.</p>
</div>
</div>
<div class="sect2">
<h3 id="comparison">2.4. Comparisons with other Kafka APIs</h3>
<div class="paragraph">
<p>Reactor Kafka is not intended to replace any of the existing Kafka APIs. Instead, it is aimed at providing
an alternative API for reactive event-driven applications.</p>
</div>
<div class="sect3">
<h4 id="_kafka_producer_and_consumer_apis">2.4.1. Kafka Producer and Consumer APIs</h4>
<div class="paragraph">
<p>For non-reactive applications, Kafka&#8217;s Producer/Consumer API provides a low latency interface to publish
messages to Kafka and consume messages from Kafka.</p>
</div>
<div class="paragraph">
<p>Applications using Kafka as a message bus using this API may consider switching to Reactor Kafka if
the application is implemented in a functional style.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_connect_api">2.4.2. Kafka Connect API</h4>
<div class="paragraph">
<p><a href="https://kafka.apache.org/documentation#connect">Kafka Connect</a> provides a simple interface to migrate messages
from an external data system (e.g. a database) to one or more Kafka topics. Using existing connectors,
this migration can be performed without writing any new code.</p>
</div>
<div class="paragraph">
<p>Applications using the connector API may consider using Reactor Kafka if a reactive API is available for
the external data system and transformations are required for the data. When transformations involve
other I/O (e.g. to obtain additional information from another database), a reactive pipeline
benefits from end-to-end non-blocking back-pressure provided by Reactor. Messages from/to different Kafka
partitions can be processed in parallel, improving throughput by avoiding blocking for I/O.
The pull model in Reactor controls the pace of messages flowing through the pipeline, enabling efficient
use of threads and memory without the need for overflow handling in the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_streams_api">2.4.3. Kafka Streams API</h4>
<div class="paragraph">
<p><a href="https://kafka.apache.org/documentation#streams">Kafka Streams</a> provides lightweight APIs to build stream processing
applications that process data stored in Kafka using standard streaming concepts and transformation primitives.
Using a simple threading model, the streams API avoids the need for back-pressure. This model works well in cases
where transformations do not involve external interactions.</p>
</div>
<div class="paragraph">
<p>Reactor Kafka is useful for streams applications which process data from Kafka and use external interactions
(e.g. get additional data for records from a database) for transformations. In this case, Reactor can provide end-to-end
non-blocking back-pressure combined with better utilization of resources if all external interactions use the reactive model.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">3. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="requirements">3.1. Requirements</h3>
<div class="paragraph">
<p>You need Java JRE installed (Java 8 or later).</p>
</div>
<div class="paragraph">
<p>You need <a href="https://kafka.apache.org">Apache Kafka</a> installed (1.0.0 or later). Kafka can be downloaded
from <a href="https://kafka.apache.org/downloads.html" class="bare">kafka.apache.org/downloads.html</a>. Note that the Apache Kafka client library used with
Reactor Kafka should be 2.0.0 or later and the broker version should be 1.0.0 or higher.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quick_start">3.2. Quick Start</h3>
<div class="paragraph">
<p>This quick start tutorial sets up a single node Zookeeper and Kafka and runs the sample reactive producer and
consumer. Instructions to set up multi-broker clusters are available <a href="https://kafka.apache.org/documentation#quickstart_multibroker">here</a>.</p>
</div>
<div class="sect3">
<h4 id="_start_kafka">3.2.1. Start Kafka</h4>
<div class="paragraph">
<p>If you haven&#8217;t yet downloaded Kafka, download Kafka version <a href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.0.0/kafka_2.11-2.0.0.tgz">2.0.0</a> or higher.</p>
</div>
<div class="paragraph">
<p>Unzip the release and set KAFKA_DIR to the installation directory. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; tar -zxf kafka_2.11-2.0.0.tgz -C /opt
&gt; export KAFKA_DIR=/opt/kafka_2.11-2.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start a single-node Zookeeper instance using the Zookeeper installation included in the Kafka download:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; $KAFKA_DIR/bin/zookeeper-server-start.sh $KAFKA_DIR/config/zookeeper.properties &gt; /tmp/zookeeper.log &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start a single-node Kafka instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; $KAFKA_DIR/bin/kafka-server-start.sh $KAFKA_DIR/config/server.properties &gt; /tmp/kafka.log &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a Kafka topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; $KAFKA_DIR/bin/kafka-topics.sh --zookeeper localhost:2181 --create --replication-factor 1 --partitions 2 --topic demo-topic
Created topic "demo-topic".</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that Kafka topic was created successfully:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; $KAFKA_DIR/bin/kafka-topics.sh --zookeeper localhost:2181 --describe
Topic: demo-topic	PartitionCount:2		ReplicationFactor:1	Configs:
Topic: demo-topic	Partition: 0	Leader: 0	Replicas: 0		Isr: 0
Topic: demo-topic	Partition: 1	Leader: 0	Replicas: 0		Isr: 0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_reactor_kafka_samples">3.2.2. Run Reactor Kafka Samples</h4>
<div class="paragraph">
<p>Download and build Reactor Kafka from <a href="https://github.com/reactor/reactor-kafka/" class="bare">github.com/reactor/reactor-kafka/</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; git clone https://github.com/reactor/reactor-kafka
&gt; cd reactor-kafka
&gt; ./gradlew jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set <code>CLASSPATH</code> for running reactor-kafka samples. <code>CLASSPATH</code> can be obtained using the classpath task of the samples sub-project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; export CLASSPATH=`./gradlew -q :reactor-kafka-samples:classpath`</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_sample_producer">Sample Producer</h5>
<div class="paragraph">
<p>See <a href="https://github.com/reactor/reactor-kafka/blob/master/reactor-kafka-samples/src/main/java/reactor/kafka/samples/SampleProducer.java" class="bare">github.com/reactor/reactor-kafka/blob/master/reactor-kafka-samples/src/main/java/reactor/kafka/samples/SampleProducer.java</a> for sample producer code.</p>
</div>
<div class="paragraph">
<p>Run sample producer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; $KAFKA_DIR/bin/kafka-run-class.sh reactor.kafka.samples.SampleProducer
Message 2 sent successfully, topic-partition=demo-topic-1 offset=0 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 3 sent successfully, topic-partition=demo-topic-1 offset=1 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 4 sent successfully, topic-partition=demo-topic-1 offset=2 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 6 sent successfully, topic-partition=demo-topic-1 offset=3 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 7 sent successfully, topic-partition=demo-topic-1 offset=4 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 10 sent successfully, topic-partition=demo-topic-1 offset=5 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 11 sent successfully, topic-partition=demo-topic-1 offset=6 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 12 sent successfully, topic-partition=demo-topic-1 offset=7 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 13 sent successfully, topic-partition=demo-topic-1 offset=8 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 14 sent successfully, topic-partition=demo-topic-1 offset=9 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 16 sent successfully, topic-partition=demo-topic-1 offset=10 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 17 sent successfully, topic-partition=demo-topic-1 offset=11 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 20 sent successfully, topic-partition=demo-topic-1 offset=12 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 1 sent successfully, topic-partition=demo-topic-0 offset=0 timestamp=13:33:16:712 GMT 30 Nov 2016
Message 5 sent successfully, topic-partition=demo-topic-0 offset=1 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 8 sent successfully, topic-partition=demo-topic-0 offset=2 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 9 sent successfully, topic-partition=demo-topic-0 offset=3 timestamp=13:33:16:716 GMT 30 Nov 2016
Message 15 sent successfully, topic-partition=demo-topic-0 offset=4 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 18 sent successfully, topic-partition=demo-topic-0 offset=5 timestamp=13:33:16:717 GMT 30 Nov 2016
Message 19 sent successfully, topic-partition=demo-topic-0 offset=6 timestamp=13:33:16:717 GMT 30 Nov 2016</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample producer sends 20 messages to Kafka topic <code>demo-topic</code> using the default partitioner. The partition
and offset of each published message is output to console. As shown in the sample output above, the order of
results may be different from the order of messages published. Results are delivered in order for each partition,
but results from different partitions may be interleaved. In the sample, message index is included as
correlation metadata to match each result to its corresponding message.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sample_consumer">Sample Consumer</h5>
<div class="paragraph">
<p>See <a href="https://github.com/reactor/reactor-kafka/blob/master/reactor-kafka-samples/src/main/java/reactor/kafka/samples/SampleConsumer.java" class="bare">github.com/reactor/reactor-kafka/blob/master/reactor-kafka-samples/src/main/java/reactor/kafka/samples/SampleConsumer.java</a> for sample consumer code.</p>
</div>
<div class="paragraph">
<p>Run sample consumer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&gt; $KAFKA_DIR/bin/kafka-run-class.sh reactor.kafka.samples.SampleConsumer
Received message: topic-partition=demo-topic-1 offset=0 timestamp=13:33:16:716 GMT 30 Nov 2016 key=2 value=Message_2
Received message: topic-partition=demo-topic-1 offset=1 timestamp=13:33:16:716 GMT 30 Nov 2016 key=3 value=Message_3
Received message: topic-partition=demo-topic-1 offset=2 timestamp=13:33:16:716 GMT 30 Nov 2016 key=4 value=Message_4
Received message: topic-partition=demo-topic-1 offset=3 timestamp=13:33:16:716 GMT 30 Nov 2016 key=6 value=Message_6
Received message: topic-partition=demo-topic-1 offset=4 timestamp=13:33:16:716 GMT 30 Nov 2016 key=7 value=Message_7
Received message: topic-partition=demo-topic-1 offset=5 timestamp=13:33:16:716 GMT 30 Nov 2016 key=10 value=Message_10
Received message: topic-partition=demo-topic-1 offset=6 timestamp=13:33:16:716 GMT 30 Nov 2016 key=11 value=Message_11
Received message: topic-partition=demo-topic-1 offset=7 timestamp=13:33:16:717 GMT 30 Nov 2016 key=12 value=Message_12
Received message: topic-partition=demo-topic-1 offset=8 timestamp=13:33:16:717 GMT 30 Nov 2016 key=13 value=Message_13
Received message: topic-partition=demo-topic-1 offset=9 timestamp=13:33:16:717 GMT 30 Nov 2016 key=14 value=Message_14
Received message: topic-partition=demo-topic-1 offset=10 timestamp=13:33:16:717 GMT 30 Nov 2016 key=16 value=Message_16
Received message: topic-partition=demo-topic-1 offset=11 timestamp=13:33:16:717 GMT 30 Nov 2016 key=17 value=Message_17
Received message: topic-partition=demo-topic-1 offset=12 timestamp=13:33:16:717 GMT 30 Nov 2016 key=20 value=Message_20
Received message: topic-partition=demo-topic-0 offset=0 timestamp=13:33:16:712 GMT 30 Nov 2016 key=1 value=Message_1
Received message: topic-partition=demo-topic-0 offset=1 timestamp=13:33:16:716 GMT 30 Nov 2016 key=5 value=Message_5
Received message: topic-partition=demo-topic-0 offset=2 timestamp=13:33:16:716 GMT 30 Nov 2016 key=8 value=Message_8
Received message: topic-partition=demo-topic-0 offset=3 timestamp=13:33:16:716 GMT 30 Nov 2016 key=9 value=Message_9
Received message: topic-partition=demo-topic-0 offset=4 timestamp=13:33:16:717 GMT 30 Nov 2016 key=15 value=Message_15
Received message: topic-partition=demo-topic-0 offset=5 timestamp=13:33:16:717 GMT 30 Nov 2016 key=18 value=Message_18
Received message: topic-partition=demo-topic-0 offset=6 timestamp=13:33:16:717 GMT 30 Nov 2016 key=19 value=Message_19</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample consumer consumes messages from topic <code>demo-topic</code> and outputs the messages to console. The 20 messages
published by the Producer sample should appear on the console. As shown in the output above, messages are consumed
in order for each partition, but messages from different partitions may be interleaved.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_reactor_kafka_applications">3.2.3. Building Reactor Kafka Applications</h4>
<div class="paragraph">
<p>To build your own application using the Reactor Kafka API, you need to include a dependency to Reactor Kafka.</p>
</div>
<div class="paragraph">
<p>For gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>dependencies {
    compile "io.projectreactor.kafka:reactor-kafka:1.1.0.RELEASE"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;io.projectreactor.kafka&lt;/groupId&gt;
    &lt;artifactId&gt;reactor-kafka&lt;/artifactId&gt;
    &lt;version&gt;1.1.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources">4. Additional Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="support">4.1. Getting help</h3>
<div class="paragraph">
<p>If you are having trouble with Reactor Kafka, we&#8217;d like to help.</p>
</div>
<div class="paragraph">
<p>Report bugs in Reactor Kafka at <a href="https://github.com/reactor/reactor-kafka/issues" class="bare">github.com/reactor/reactor-kafka/issues</a>.</p>
</div>
<div class="paragraph">
<p>Reactor Kafka is open source and the code and documentation are available at <a href="https://github.com/reactor/reactor-kafka" class="bare">github.com/reactor/reactor-kafka</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources">4.2. Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/reactor/reactor-kafka">Reactor Kafka on github</a></p>
</li>
<li>
<p><a href="https://kafka.apache.org/documentation.html">Apache Kafka</a></p>
</li>
<li>
<p><a href="https://projectreactor.io/">Project Reactor</a></p>
</li>
<li>
<p><a href="https://github.com/reactor/reactor-core">Reactor Core</a></p>
</li>
<li>
<p><a href="https://github.com/reactive-streams/reactive-streams-jvm">Reactive Streams Specification</a></p>
</li>
<li>
<p><a href="https://spring.io/blog/2016/04/19/understanding-reactive-types">Understanding Reactive types</a></p>
</li>
<li>
<p><a href="https://github.com/reactor/lite-rx-api-hands-on">Lite Rx API Hands-on</a></p>
</li>
<li>
<p><a href="https://www.infoq.com/articles/reactor-by-example">Reactor by Example</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_noteworthy">5. New &amp; Noteworthy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="new">5.1. What&#8217;s new in Reactor Kafka 1.0.0.RELEASE</h3>
<div class="ulist">
<ul>
<li>
<p>First release of Reactor Kafka</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_what_s_new_in_reactor_kafka_1_0_1_release">5.2. What&#8217;s new in Reactor Kafka 1.0.1.RELEASE</h3>
<div class="ulist">
<ul>
<li>
<p>Update to Apache Kafka 1.0.2 client 🎉</p>
</li>
<li>
<p>Update to Reactor 3.1.8.RELEASE 🎉</p>
</li>
<li>
<p>Fixes for a <a href="https://github.com/reactor/reactor-kafka/milestone/1?closed=1">list</a> of
significant issues</p>
</li>
<li>
<p>Performance tuning and optimization of Reactor 3 usage 🤟</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_what_s_new_in_reactor_kafka_1_1_0_release">5.3. What&#8217;s new in Reactor Kafka 1.1.0.RELEASE</h3>
<div class="paragraph">
<p>This release is a maintenance release. The following are the major updates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Align with Reactor 3.2.0.RELEASE version</p>
</li>
<li>
<p>Update to Apache Kafka 2.0.0 client</p>
</li>
<li>
<p>Stabilize test-suite</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_reference_documentation" class="sect0">Reference Documentation</h1>
<div class="sect1">
<h2 id="_reactor_kafka_api">6. Reactor Kafka API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="api-guide-overview">6.1. Overview</h3>
<div class="paragraph">
<p>This section describes the reactive API for producing and consuming messages using Apache Kafka.
There are two main interfaces in Reactor Kafka:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>reactor.kafka.sender.KafkaSender</code> for publishing messages to Kafka</p>
</li>
<li>
<p><code>reactor.kafka.receiver.KafkaReceiver</code> for consuming messages from Kafka</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Full API for Reactor Kafka is available in the <a href="../api/index.html">javadocs</a>.</p>
</div>
<div class="paragraph">
<p>The project uses <a href="https://github.com/reactor/reactor-core">Reactor Core</a> to expose a <a href="https://github.com/reactive-streams/reactive-streams-jvm">"Reactive Streams"</a> API.</p>
</div>
</div>
<div class="sect2">
<h3 id="api-guide-sender">6.2. Reactive Kafka Sender</h3>
<div class="paragraph">
<p>Outbound messages are sent to Kafka using <code>reactor.kafka.sender.KafkaSender</code>. Senders are thread-safe and can be shared
across multiple threads to improve throughput. A <code>KafkaSender</code> is associated with one <code>KafkaProducer</code> that is used
to transport messages to Kafka.</p>
</div>
<div class="paragraph">
<p>A KafkaSender is created with an instance of sender configuration options <code>reactor.kafka.sender.SenderOptions</code>.
Changes made to <code>SenderOptions</code> after the creation of <code>KafkaSender</code> will not be used by the KafkaSender.
The properties of SenderOptions such as a list of bootstrap Kafka brokers and serializers are passed down
to the underlying <code>KafkaProducer</code>. The properties may be configured on the SenderOptions instance at creation time
or by using the setter <code>SenderOptions#producerProperty</code>. Other configuration options for the reactive KafkaSender like
the maximum number of in-flight messages can also be configured before the KafkaSender instance is created.</p>
</div>
<div class="paragraph">
<p>The generic types of <code>SenderOptions&lt;K, V&gt;</code> and <code>KafkaSender&lt;K, V&gt;</code> are the key and value types of producer records
published using the KafkaSender and corresponding serializers must be set on the SenderOptions instance before
the KafkaSender is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; producerProps = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
producerProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
producerProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, IntegerSerializer.class);
producerProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);

SenderOptions&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; senderOptions =
    SenderOptions.&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;create(producerProps)       <i class="conum" data-value="1"></i><b>(1)</b>
                 .maxInFlight(<span class="integer">1024</span>);                           <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify properties for underlying <code>KafkaProducer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure options for reactive KafkaSender</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the required options have been configured on the options instance, a new <code>KafkaSender</code> instance
can be created with the options already configured in <code>senderOptions</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">KafkaSender&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; sender = KafkaSender.create(senderOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The KafkaSender is now ready to send messages to Kafka.
The underlying <code>KafkaProducer</code> instance is created lazily when the first message is ready to be sent.
At this point, a <code>KafkaSender</code> instance has been created, but no connections to Kafka have been made yet.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now create a sequence of messages to send to Kafka. Each outbound message to be sent to Kafka
is represented as a <code>SenderRecord</code>.  A <code>SenderRecord</code> is a Kafka
<a href="https://kafka.apache.org/0102/javadoc/org/apache/kafka/clients/producer/ProducerRecord.html">ProducerRecord</a>
with additional correlation metadata for matching send results to records. <code>ProducerRecord</code> consists of a key/value pair
to send to Kafka and the name of the Kafka topic to send the message to. Producer records may also optionally
specify a partition to send the message to or use the configured partitioner to choose a partition. Timestamp may
also be optionally specified in the record and if not specified, the current timestamp will be assigned by the Producer.
The additional correlation metadata included in <code>SenderRecord</code> is not sent to Kafka, but is included in the
<code>SendResult</code> generated for the record when the send operation completes or fails. Since results of sends to
different partitions may be interleaved, the correlation metadata enables results to be matched to their corresponding record.</p>
</div>
<div class="paragraph">
<p>A <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux&lt;SenderRecord&gt;</a> of records
is created for sending to Kafka. For beginners, <a href="https://github.com/reactor/lite-rx-api-hands-on">Lite Rx API Hands-on</a>
provides a hands-on tutorial on using the Reactor classes <code>Flux</code> and <code>Mono</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;SenderRecord&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;&gt; outboundFlux =
    Flux.range(<span class="integer">1</span>, <span class="integer">10</span>)
        .map(i -&gt; SenderRecord.create(topic, partition, timestamp, i, <span class="string"><span class="delimiter">&quot;</span><span class="content">Message_</span><span class="delimiter">&quot;</span></span> + i, i));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code segment above creates a sequence of messages to send to Kafka, using the message index as
correlation metadata in each <code>SenderRecord</code>. The outbound Flux can now be sent to Kafka using the
<code>KafkaSender</code> created earlier.</p>
</div>
<div class="paragraph">
<p>The code segment below sends the records to Kafka and prints out the response metadata received from Kafka
and the correlation metadata for each record.  The final <code>subscribe()</code> in the code block
requests upstream to send the records to Kafka and the response metadata received from Kafka flow downstream.
As each result is received, the record metadata from Kafka along with the correlation metadata identifying the
record is printed out to console by the <code>onNext</code> handler. The response from Kafka includes the partition to which
the record was sent as well as the offset at the which the record was appended, if available.
When records are sent to multiple partitions, responses arrive in order
for each partition, but responses from different partitions may be interleaved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.send(outboundFlux)                          <i class="conum" data-value="1"></i><b>(1)</b>
      .doOnError(e-&gt; log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Send failed</span><span class="delimiter">&quot;</span></span>, e))  <i class="conum" data-value="2"></i><b>(2)</b>
      .doOnNext(r -&gt; <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message #%d send response: %s</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, r.correlationMetadata(), r.recordMetadata())) <i class="conum" data-value="3"></i><b>(3)</b>
      .subscribe();    <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reactive send operation for the outbound Flux</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If Kafka send fails, log an error</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Print metadata returned by Kafka and the message index in <code>correlationMetadata()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Subscribe to trigger the actual flow of records from <code>outboundFlux</code> to Kafka.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/reactor/reactor-kafka/blob/master/reactor-kafka-samples/src/main/java/reactor/kafka/samples/SampleProducer.java" class="bare">github.com/reactor/reactor-kafka/blob/master/reactor-kafka-samples/src/main/java/reactor/kafka/samples/SampleProducer.java</a>  for the full code listing of a sample producer.</p>
</div>
<div class="sect3">
<h4 id="_error_handling">6.2.1. Error handling</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> SenderOptions&lt;K, V&gt; stopOnError(<span class="type">boolean</span> stopOnError);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SenderOptions#stopOnError()</code> specifies whether each send sequence should fail immediately if one
record could not delivered to Kafka after the configured number of retries or wait until all records
have been processed. This can be used along with <code>ProducerConfig#ACKS_CONFIG</code>
and <code>ProducerConfig#RETRIES_CONFIG</code> to configure the required quality of service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;T&gt; Flux&lt;SenderResult&lt;T&gt;&gt; send(Publisher&lt;SenderRecord&lt;K, V, T&gt;&gt; outboundRecords);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>stopOnError</code> is false, a success or error response is returned for each outgoing record.
For error responses, the exception from Kafka indicating the reason for send failure is set on <code>SenderResult</code>
and can be retrieved using <code>SenderResult#exception()</code>. The Flux fails with an error after attempting to send
all records published on <code>outboundRecords</code>. If <code>outboundRecords</code> is a non-terminating <code>Flux</code>, send continues to send
records published on this <code>Flux</code> until the result <code>Flux</code> is explicitly cancelled by the user.</p>
</div>
<div class="paragraph">
<p>If <code>stopOnError</code> is true, a response is returned for the first failed send and the result Flux is terminated
immediately with an error. Since multiple outbound messages may be in-flight at any time, it is possible that
some messages are delivered successfully to Kafka after the first failure is detected. <code>SenderOptions#maxInFlight()</code>
option may be configured to limit the number of messages in-flight at any time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_send_without_result_metadata">6.2.2. Send without result metadata</h4>
<div class="paragraph">
<p>If individual results are not required for each send request, <code>ProducerRecord</code> can be sent to Kafka
without providing correlation metadata using the <code>KafkaOutbound</code> interface. <code>KafkaOutbound</code> is a fluent
interface that enables sends to be chained together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">KafkaOutbound&lt;K, V&gt; send(Publisher&lt;? <span class="directive">extends</span> ProducerRecord&lt;K, V&gt;&gt; outboundRecords);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The send sequence is initiated by subscribing to the Mono obtained from <code>KafkaOutbound#then()</code>.
The returned Mono completes successfully if all the outbound records are delivered successfully. The Mono
terminates on the first send failure. If <code>outboundRecords</code> is a non-terminating Flux, records continue to
be sent to Kafka unless a send fails or the returned Mono is cancelled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.createOutbound()
      .send(Flux.range(<span class="integer">1</span>,  <span class="integer">10</span>)
                .map(i -&gt; <span class="keyword">new</span> ProducerRecord&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;(topic, i, <span class="string"><span class="delimiter">&quot;</span><span class="content">Message_</span><span class="delimiter">&quot;</span></span> + i))) <i class="conum" data-value="1"></i><b>(1)</b>
      .then()                                                    <i class="conum" data-value="2"></i><b>(2)</b>
      .doOnError(e -&gt; e.printStackTrace())                       <i class="conum" data-value="3"></i><b>(3)</b>
      .doOnSuccess(s -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sends succeeded</span><span class="delimiter">&quot;</span></span>))   <i class="conum" data-value="4"></i><b>(4)</b>
      .subscribe();                                              <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create <code>ProducerRecord</code> Flux. Records are not wrapped in <code>SenderRecord</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the <code>Mono</code> to subscribe to for starting the message flow</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Error indicates failure to send one or more records</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Success indicates all records were published, individual partitions or offsets not returned</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Subscribe to request the actual sends</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Multiple sends can be chained together using a sequence of sends on <code>KafkaOutbound</code>.
When the Mono returned from <code>KafkaOutbound#then()</code> is subscribed to, the sends are invoked
in sequence in the declaration order. The sequence is cancelled if any of the sends fail
after the configured number of retries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.createOutbound()
      .send(flux1)                                               <i class="conum" data-value="1"></i><b>(1)</b>
      .send(flux2)
      .send(flux3)
      .then()                                                    <i class="conum" data-value="2"></i><b>(2)</b>
      .doOnError(e -&gt; e.printStackTrace())                       <i class="conum" data-value="3"></i><b>(3)</b>
      .doOnSuccess(s -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sends succeeded</span><span class="delimiter">&quot;</span></span>))   <i class="conum" data-value="4"></i><b>(4)</b>
      .subscribe();                                              <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sends <code>flux1</code>, <code>flux2</code> and <code>flux3</code> in order</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the <code>Mono</code> to subscribe to for starting the message flow sequence</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Error indicates failure to send one or more records from any of the sends in the chain</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Success indicates successful send of all records from the whole chain</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Subscribe to initiate the sequence of sends in the chain</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that in all cases the retries configured for the <code>KafkaProducer</code> are attempted and failures returned by
the reactive <code>KafkaSender</code> indicate a failure to send after the configured number of retry attempts. Retries
can result in messages being delivered out of order. The producer property
<code>ProducerConfig#MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION</code> may be set to one to avoid re-ordering.</p>
</div>
</div>
<div class="sect3">
<h4 id="_threading_model">6.2.3. Threading model</h4>
<div class="paragraph">
<p><code>KafkaProducer</code> uses a separate network thread for sending requests and processing responses. To ensure
that the producer network thread is never blocked by applications while processing results, <code>KafkaSender</code>
delivers responses to applications on a separate scheduler. By default, this is a single threaded
pooled scheduler that is freed when no longer required. The scheduler can be overridden if required, for instance,
to use a parallel scheduler when the Kafka sends are part of a larger pipeline. This is done on the <code>SenderOptions</code>
instance before the KafkaSender instance is created using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> SenderOptions&lt;K, V&gt; scheduler(Scheduler scheduler);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_non_blocking_back_pressure">6.2.4. Non-blocking back-pressure</h4>
<div class="paragraph">
<p>The number of in-flight sends can be controlled using the <code>maxInFlight</code> option. Requests for more elements from
upstream are limited by the configured <code>maxInFlight</code> to ensure that the total number of requests at any time for which
responses are pending are limited. Along with <code>buffer.memory</code> and <code>max.block.ms</code> options on <code>KafkaProducer</code>,
<code>maxInFlight</code> enables control of memory and thread usage when <code>KafkaSender</code> is used in a reactive pipeline. This option
can be configured on <code>SenderOptions</code> before the KafkaSender is created. Default value is 256. For small messages,
 a higher value will improve throughput.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> SenderOptions&lt;K, V&gt; maxInFlight(<span class="type">int</span> maxInFlight);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closing_the_kafkasender">6.2.5. Closing the KafkaSender</h4>
<div class="paragraph">
<p>When the KafkaSender is no longer required, the KafkaSender instance can be closed. The underlying <code>KafkaProducer</code> is closed,
closing all client connections and freeing all memory used by the producer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.close();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_access_to_the_underlying_code_kafkaproducer_code">6.2.6. Access to the underlying <code>KafkaProducer</code></h4>
<div class="paragraph">
<p>Reactive applications may sometimes require access to the underlying producer instance to perform actions that are not
exposed by the <code>KafkaSender</code> interface. For example, an application might need to know the number of partitions in a topic
in order to choose the partition to send a record to. Operations that are not provided directly by <code>KafkaSender</code> like <code>send</code>
can be run on the underlying <code>KafkaProducer</code> using <code>KafkaSender#doOnProducer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sender.doOnProducer(producer -&gt; producer.partitionsFor(topic))
      .doOnSuccess(partitions -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Partitions </span><span class="delimiter">&quot;</span></span> + partitions))
      .subscribe();</code></pre>
</div>
</div>
<div class="paragraph">
<p>User provided methods are executed asynchronously.
A <code>Mono</code> is returned by <code>doOnProducer</code> which completes with the value returned by the user-provided function.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-guide-receiver">6.3. Reactive Kafka Receiver</h3>
<div class="paragraph">
<p>Messages stored in Kafka topics are consumed using the reactive receiver <code>reactor.kafka.receiver.KafkaReceiver</code>.
Each instance of <code>KafkaReceiver</code> is associated with a single instance of <code>KafkaConsumer</code>. <code>KafkaReceiver</code> is not thread-safe
since the underlying <code>KafkaConsumer</code> cannot be accessed concurrently by multiple threads.</p>
</div>
<div class="paragraph">
<p>A receiver is created with an instance of receiver configuration options <code>reactor.kafka.receiver.ReceiverOptions</code>.
Changes made to <code>ReceiverOptions</code> after the creation of the receiver instance will not be used by the <code>KafkaReceiver</code>.
The properties of ReceiverOptions such as a list of bootstrap Kafka brokers and de-serializers are passed down
to the underlying <code>KafkaConsumer</code>. These properties may be configured on the ReceiverOptions instance at creation time
or by using the setter <code>ReceiverOptions#consumerProperty</code>. Other configuration options for the reactive
KafkaReceiver including subscription topics must be added to options before the KafkaReceiver instance is created.</p>
</div>
<div class="paragraph">
<p>The generic types of <code>ReceiverOptions&lt;K, V&gt;</code> and <code>KafkaReceiver&lt;K, V&gt;</code> are the key and value types of consumer records
consumed using the receiver and corresponding de-serializers must be set on the ReceiverOptions instance before
the KafkaReceiver is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; consumerProps = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
consumerProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
consumerProps.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">sample-group</span><span class="delimiter">&quot;</span></span>);
consumerProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, IntegerDeserializer.class);
consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);

ReceiverOptions&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; receiverOptions =
    ReceiverOptions.&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;create(consumerProps)         <i class="conum" data-value="1"></i><b>(1)</b>
                   .subscription(<span class="predefined-type">Collections</span>.singleton(topic));    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify properties to be provided to <code>KafkaConsumer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Topics to subscribe to</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the required configuration options have been configured on the options instance, a new <code>KafkaReceiver</code> instance
can be created with these options to consume inbound messages.
The code block below creates a receiver instance and creates an inbound Flux for the receiver.
The underlying <code>KafkaConsumer</code> instance is created lazily later when the inbound Flux is subscribed to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux&lt;ReceiverRecord&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;&gt; inboundFlux =
    KafkaReceiver.create(receiverOptions)
                 .receive();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The inbound Kafka Flux is ready to be consumed. Each inbound message delivered by the Flux is represented
as a <code>ReceiverRecord</code>. Each receiver record is a
<a href="https://kafka.apache.org/0102/javadoc/org/apache/kafka/clients/consumer/ConsumerRecord.html">ConsumerRecord</a>
returned by <code>KafkaConsumer</code> along with a committable <code>ReceiverOffset</code> instance. The offset must be acknowledged
after the message is processed since unacknowledged offsets will not be committed.
If commit interval or commit batch size are configured, acknowledged offsets will be committed periodically.
Offsets may also be committed manually using <code>ReceiverOffset#commit()</code> if finer grained control of commit
operations is required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">inboundFlux.subscribe(r -&gt; {
    <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received message: %s</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, r);           <i class="conum" data-value="1"></i><b>(1)</b>
    r.receiverOffset().acknowledge();                         <i class="conum" data-value="2"></i><b>(2)</b>
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prints each consumer record from Kafka</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Acknowledges that the record has been processed so that the offset may be committed</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_subscribing_to_wildcard_patterns">6.3.1. Subscribing to wildcard patterns</h4>
<div class="paragraph">
<p>The example above subscribed to a single Kafka topic. The same API can be used to subscribe to
more than one topic by specifying multiple topics in the collection provided to <code>ReceiverOptions#subscription()</code>.
Subscription can also be made to a wildcard pattern by specifying a pattern to subscribe to. Group
management in <code>KafkaConsumer</code> dynamically updates topic assignment when topics matching the pattern
are created or deleted and assigns partitions of matching topics to available consumer instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiverOptions = receiverOptions.subscription(<span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">demo.*</span><span class="delimiter">&quot;</span></span>));  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Consume records from all topics starting with "demo"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Changes to <code>ReceiverOptions</code> must be made before the receiver instance is created. Altering the subscription
deletes any existing subscriptions on the options instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manual_assignment_of_topic_partitions">6.3.2. Manual assignment of topic partitions</h4>
<div class="paragraph">
<p>Partitions may be manually assigned to the receiver without using Kafka consumer group management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiverOptions = receiverOptions.assignment(<span class="predefined-type">Collections</span>.singleton(<span class="keyword">new</span> TopicPartition(topic, <span class="integer">0</span>))); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Consume from partition 0 of specified topic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Existing subscriptions and assignments on the options instance are deleted when a new assignment
is specified. Every receiver created from this options instance with manual assignment consumes messages
from all the specified partitions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_controlling_commit_frequency">6.3.3. Controlling commit frequency</h4>
<div class="paragraph">
<p>Commit frequency can be controlled using a combination of commit interval
and commit batch size. Commits are performed when either the interval or batch size is reached. One or both
of these options may be set on <code>ReceiverOptions</code> before the receiver instance is created. If commit interval
is configured, at least one commit is scheduled within that interval if any records were
consumed. If commit batch size is configured, a commit is scheduled when the configured number of records
are consumed and acknowledged.</p>
</div>
<div class="paragraph">
<p>Manual acknowledgement of consumed records after processing along with automatic commits based on
the configured commit frequency provides at-least-once delivery semantics. Messages are re-delivered
if the consuming application crashes after message was dispatched but before it was processed and
acknowledged. Only offsets explicitly acknowledged using <code>ReceiverOffset#acknowledge()</code> are committed.
Note that acknowledging an offset acknowledges all previous offsets on the same partition. All
acknowledged offsets are committed when partitions are revoked during rebalance and when the receive
Flux is terminated.</p>
</div>
<div class="paragraph">
<p>Applications which require fine-grained control over the timing of commit operations
can disable periodic commits and explicitly invoke <code>ReceiverOffset#commit()</code> when required to trigger
a commit. This commit is asynchronous by default, but the application many invoke <code>Mono#block()</code>
on the returned Mono to implement synchronous commits. Applications may batch commits by acknowledging
messages as they are consumed and invoking commit() periodically to commit acknowledged offsets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiver.receive()
        .doOnNext(r -&gt; {
                process(r);
                r.receiverOffset().commit().block();
            });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that committing an offset acknowledges and commits all previous offsets on that partition. All
acknowledged offsets are committed when partitions are revoked during rebalance and when the receive
Flux is terminated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_auto_acknowledgement_of_batches_of_records">6.3.4. Auto-acknowledgement of batches of records</h4>
<div class="paragraph">
<p><code>KafkaReceiver#receiveAutoAck</code> returns a <code>Flux</code> of batches of records returned by each <code>KafkaConsumer#poll()</code>.
The records in each batch are automatically acknowledged when the Flux corresponding to the batch terminates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">KafkaReceiver.create(receiverOptions)
             .receiveAutoAck()
             .concatMap(r -&gt; r)                                      <i class="conum" data-value="1"></i><b>(1)</b>
             .subscribe(r -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received: </span><span class="delimiter">&quot;</span></span> + r));  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Concatenate in order</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Print out each consumer record received, no explicit ack required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The maximum number of records in each batch can be controlled using the <code>KafkaConsumer</code> property
<code>MAX_POLL_RECORDS</code>. This is used together with the fetch size and wait times configured on the
KafkaConsumer to control the amount of data fetched from Kafka brokers in each poll. Each batch is
returned as a Flux that is acknowledged after the Flux terminates. Acknowledged records are committed periodically
based on the configured commit interval and batch size. This mode is simple to use since applications
do not need to perform any acknowledge or commit actions. It is efficient as well and can be used
for at-least-once delivery of messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_automatic_commits">6.3.5. Disabling automatic commits</h4>
<div class="paragraph">
<p>Applications which don&#8217;t require offset commits to Kafka may disable automatic commits by not acknowledging
any records consumed using <code>KafkaReceiver#receive()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiverOptions = ReceiverOptions.&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;create()
        .commitInterval(<span class="predefined-type">Duration</span>.ZERO)             <i class="conum" data-value="1"></i><b>(1)</b>
        .commitBatchSize(<span class="integer">0</span>);                       <i class="conum" data-value="2"></i><b>(2)</b>
KafkaReceiver.create(receiverOptions)
             .receive()
             .subscribe(r -&gt; process(r));          <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disable periodic commits</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Disable commits based on batch size</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Process records, but don&#8217;t acknowledge</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_at_most_once_delivery">6.3.6. At-most-once delivery</h4>
<div class="paragraph">
<p>Applications may disable automatic commits to avoid re-delivery of records. <code>ConsumerConfig#AUTO_OFFSET_RESET_CONFIG</code>
can be configured to "latest" to consume only new records. But this could mean that an unpredictable
number of records are not consumed if an application fails and restarts.</p>
</div>
<div class="paragraph">
<p><code>KafkaReceiver#receiveAtmostOnce</code> can be used to consume records with at-most-once semantics with a configurable
number of records-per-partition that may be lost if the application fails or crashes. Offsets are committed
synchronously before the corresponding record is dispatched. Records are guaranteed not to be re-delivered
even if the consuming application fails, but some records may not be processed if an application fails
after the commit before the records could be processed.</p>
</div>
<div class="paragraph">
<p>This mode is expensive since each record is committed individually and records are not delivered until
the commit operation succeeds. <code>ReceiverOptions#atmostOnceCommitCommitAheadSize</code> may be configured
to reduce the cost of commits and avoid blocking before dispatch if the offset of the record has already
been committed. By default, commit-ahead is disabled and at-most one record is lost per-partition if
an application crashes. If commit-ahead is configured, the maximum number of records that may be
lost per-partition is <code>ReceiverOptions#atmostOnceCommitCommitAheadSize + 1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">KafkaReceiver.create(receiverOptions)
             .receiveAtmostOnce()
             .subscribe(r -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received: </span><span class="delimiter">&quot;</span></span> + r));  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Process each consumer record, this record is not re-delivered if the processing fails</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_partition_assignment_and_revocation_listeners">6.3.7. Partition assignment and revocation listeners</h4>
<div class="paragraph">
<p>Applications can enable assignment and revocation listeners to perform any actions when
partitions are assigned or revoked from a consumer.</p>
</div>
<div class="paragraph">
<p>When group management is used, assignment listeners are invoked whenever partitions are assigned
to the consumer after a rebalance operation.  When manual assignment is used, assignment listeners
are invoked when the consumer is started. Assignment listeners can be used to seek to particular offsets
in the assigned partitions so that messages are consumed from the specified offset.</p>
</div>
<div class="paragraph">
<p>When group management is used, revocation listeners are invoked whenever partitions are revoked
from a consumer after a rebalance operation. When manual assignment is used, revocation listeners
are invoked before the consumer is closed. Revocation listeners can be used to commit processed
offsets when manual commits are used. Acknowledged offsets are automatically committed on revocation
if automatic commits are enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="_controlling_start_offsets_for_consuming_records">6.3.8. Controlling start offsets for consuming records</h4>
<div class="paragraph">
<p>By default, receivers start consuming records from the last committed offset of each assigned partition.
If a committed offset is not available, the offset reset strategy <code>ConsumerConfig#AUTO_OFFSET_RESET_CONFIG</code>
configured for the <code>KafkaConsumer</code> is used to set the start offset to the earliest or latest offset on the partition.
Applications can override offsets by seeking to new offsets in an assignment listener. Methods are provided on
<code>ReceiverPartition</code> to seek to the earliest, latest or a specific offset in the partition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> seekToBeginning();
<span class="type">void</span> seekToEnd();
<span class="type">void</span> seek(<span class="type">long</span> offset);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following code block starts consuming messages from the latest offset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiverOptions = receiverOptions
            .addAssignListener(partitions -&gt; partitions.forEach(p -&gt; p.seekToEnd())) <i class="conum" data-value="1"></i><b>(1)</b>
            .subscription(<span class="predefined-type">Collections</span>.singleton(topic));
KafkaReceiver.create(receiverOptions).receive().subscribe();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Seek to the last offset in each assigned partition</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_consumer_lifecycle">6.3.9. Consumer lifecycle</h4>
<div class="paragraph">
<p>Each <code>KafkaReceiver</code> instance is associated with a <code>KafkaConsumer</code> that is created when the inbound
Flux returned by one of the receive methods in <code>KafkaReceiver</code> is subscribed to. The consumer is kept alive until
the Flux completes. When the Flux completes, all acknowledged offsets are committed and the
underlying consumer is closed.</p>
</div>
<div class="paragraph">
<p>Only one receive operation may be active in a <code>KafkaReceiver</code> at any one time. Any of the receive
methods can be invoked after the receive Flux corresponding to the last receive is terminated.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sample_scenarios">7. Sample Scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section shows sample code segments for typical scenarios where Reactor Kafka API
may be used. Full code listing for these scenarios are included in the
<a href="https://github.com/reactor/reactor-kafka/tree/master/reactor-kafka-samples">samples sub-project</a>.</p>
</div>
<div class="sect2">
<h3 id="sample-producer">7.1. Sending records to Kafka</h3>
<div class="paragraph">
<p>See <a href="#api-guide-sender">KafkaSender API</a> for details on the KafkaSender API for sending outbound records
to Kafka. The following code segment creates a simple pipeline that sends records to Kafka and
processes the responses. The outbound flow is triggered when the returned Flux is subscribed to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">KafkaSender.create(SenderOptions.&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;create(producerProps).maxInFlight(<span class="integer">512</span>))   <i class="conum" data-value="1"></i><b>(1)</b>
           .send(outbound.map(r -&gt; senderRecord(r)))                                        <i class="conum" data-value="2"></i><b>(2)</b>
           .doOnNext(result -&gt; processResponse(result))                                     <i class="conum" data-value="3"></i><b>(3)</b>
           .doOnError(e -&gt; processError(e));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a sender with maximum 512 messages in-flight</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send a sequence of sender records</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Process send result when onNext is triggered</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sample-consumer">7.2. Replaying records from Kafka topics</h3>
<div class="paragraph">
<p>See <a href="#api-guide-receiver">KafkaReceiver API</a> for details on the KafkaReceiver API for consuming records
from Kafka topics. The following code segment creates a Flux that replays all records on a topic
and commits offsets after processing the messages. Manual acknowledgement provides
at-least-once delivery semantics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ReceiverOptions&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; options =
    ReceiverOptions.&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;create(consumerProps)
                   .consumerProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">earliest</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
                   .commitBatchSize(<span class="integer">10</span>)                                                    <i class="conum" data-value="2"></i><b>(2)</b>
                   .subscription(<span class="predefined-type">Collections</span>.singleton(<span class="string"><span class="delimiter">&quot;</span><span class="content">demo-topic</span><span class="delimiter">&quot;</span></span>));                     <i class="conum" data-value="3"></i><b>(3)</b>
KafkaReceiver.create(options)
             .receive()
             .doOnNext(r -&gt; {
                     processRecord(r);                   <i class="conum" data-value="4"></i><b>(4)</b>
                     r.receiverOffset().acknowledge();   <i class="conum" data-value="5"></i><b>(5)</b>
                 });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start consuming from first available offset on each partition if committed offsets are not available</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Commit every 10 acknowledged messages</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Topics to consume from</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Process consumer record from Kafka</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Acknowledge that record has been consumed</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kafka-sink">7.3. Reactive pipeline with Kafka sink</h3>
<div class="paragraph">
<p>The code segment below consumes messages from an external source, performs some transformation
and stores the output records in Kafka. Large number of retry attempts are configured
on the Kafka producer so that transient failures don&#8217;t impact the pipeline. Source commits are
performed only after records are successfully written to Kafka.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">senderOptions = senderOptions
    .producerProperty(ProducerConfig.ACKS_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>)                  <i class="conum" data-value="1"></i><b>(1)</b>
    .producerProperty(ProducerConfig.RETRIES_CONFIG, <span class="predefined-type">Integer</span>.MAX_VALUE)   <i class="conum" data-value="2"></i><b>(2)</b>
    .maxInFlight(<span class="integer">128</span>);                                                    <i class="conum" data-value="3"></i><b>(3)</b>
KafkaSender.create(senderOptions)
           .send(source.flux().map(r -&gt; transform(r)))                      <i class="conum" data-value="4"></i><b>(4)</b>
           .doOnError(e-&gt; log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Send failed, terminating.</span><span class="delimiter">&quot;</span></span>, e))        <i class="conum" data-value="5"></i><b>(5)</b>
           .doOnNext(r -&gt; source.commit(r.correlationMetadata()));          <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send is acknowledged by Kafka for acks=all after message is delivered to all in-sync replicas</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Large number of retries in the producer to cope with transient failures in brokers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Low in-flight count to avoid filling up producer buffer and blocking the pipeline, default stopOnError=true</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Receive from external source, transform and send to Kafka</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If a send fails, it indicates catastrophic error, fail the whole pipeline</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use correlation metadata in the sender record to commit source record</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kafka-source">7.4. Reactive pipeline with Kafka source</h3>
<div class="paragraph">
<p>The code segment below consumes records from Kafka topics, transforms the record
and sends the output to an external sink. Kafka consumer offsets are committed after
records are successfully output to sink.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiverOptions = receiverOptions
    .commitInterval(<span class="predefined-type">Duration</span>.ZERO)              <i class="conum" data-value="1"></i><b>(1)</b>
    .commitBatchSize(<span class="integer">0</span>)                         <i class="conum" data-value="2"></i><b>(2)</b>
    .subscription(<span class="predefined-type">Pattern</span>.compile(topics));     <i class="conum" data-value="3"></i><b>(3)</b>
KafkaReceiver.create(receiverOptions)
             .receive()
             .publishOn(Schedulers.newSingle(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>))
             .concatMap(m -&gt; sink.store(transform(m))                                   <i class="conum" data-value="4"></i><b>(4)</b>
                               .doOnSuccess(r -&gt; m.receiverOffset().commit().block())); <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disable periodic commits</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Disable commits by batch size</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Wildcard subscription</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Tranform Kafka record and store in external sink</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Synchronous commit after record is successfully delivered to sink</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kafka-source-sink">7.5. Reactive pipeline with Kafka source and sink</h3>
<div class="paragraph">
<p>The code segment below consumes messages from Kafka topic, performs some transformation
on the incoming messages and stores the result in some Kafka topics. Manual acknowledgement
mode provides at-least-once semantics with messages acknowledged after the output records
are delivered to Kafka. Acknowledged offsets are committed periodically based on the
configured commit interval.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiverOptions = receiverOptions
    .commitInterval(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">10</span>))        <i class="conum" data-value="1"></i><b>(1)</b>
    .subscription(<span class="predefined-type">Pattern</span>.compile(topics));
sender.send(KafkaReceiver.create(receiverOptions)
                         .receive()
                         .map(m -&gt; SenderRecord.create(transform(m.value()), m.receiverOffset())))  <i class="conum" data-value="2"></i><b>(2)</b>
      .doOnNext(m -&gt; m.correlationMetadata().acknowledge());  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure interval for automatic commits</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Transform incoming record and create outbound record with transformed data in the payload and inbound offset as correlation metadata</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Acknowledge the inbound offset using the offset instance in correlation metadata after outbound record is delivered to Kafka</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="at-most-once">7.6. At-most-once delivery</h3>
<div class="paragraph">
<p>The code segment below demonstrates a flow with at-most once delivery. Producer does not wait for acks and
does not perform any retries. Messages that cannot be delivered to Kafka on the first attempt
are dropped. <code>KafkaReceiver</code> commits offsets before delivery to the application to ensure that if the consumer
restarts, messages are not redelivered. With replication factor 1 for topic partitions,
this code can be used for at-most-once delivery.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">senderOptions = senderOptions
    .producerProperty(ProducerConfig.ACKS_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>)     <i class="conum" data-value="1"></i><b>(1)</b>
    .producerProperty(ProducerConfig.RETRIES_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="2"></i><b>(2)</b>
    .stopOnError(<span class="predefined-constant">false</span>);                                   <i class="conum" data-value="3"></i><b>(3)</b>
receiverOptions = receiverOptions
    .subscription(<span class="predefined-type">Collections</span>.singleton(sourceTopic));
KafkaSender.create(senderOptions)
            .send(KafkaReceiver.create(receiverOptions)
                               .receiveAtmostOnce()                   <i class="conum" data-value="4"></i><b>(4)</b>
                               .map(cr -&gt; SenderRecord.create(transform(cr.value()), cr.offset())));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send with acks=0 completes when message is buffered locally, before it is delivered to Kafka broker</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>No retries in producer</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Ignore any error and continue to send remaining records</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>At-most-once receive</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="fan-out">7.7. Fan-out with Multiple Streams</h3>
<div class="paragraph">
<p>The code segment below demonstrates fan-out with the same records processed in multiple independent
streams. Each stream is processed on a different thread and which transforms the input record
and stores the output in a Kafka topic.</p>
</div>
<div class="paragraph">
<p>Reactor&#8217;s <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/EmitterProcessor.html">EmitterProcessor</a>
is used to broadcast the input records from Kafka to multiple subscribers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmitterProcessor&lt;Person&gt; processor = EmitterProcessor.create();         <i class="conum" data-value="1"></i><b>(1)</b>
BlockingSink&lt;Person&gt; incoming = processor.connectSink();                <i class="conum" data-value="2"></i><b>(2)</b>
inputRecords = KafkaReceiver.create(receiverOptions)
                            .receive()
                            .doOnNext(m -&gt; incoming.emit(m.value()));   <i class="conum" data-value="3"></i><b>(3)</b>

outputRecords1 = processor.publishOn(scheduler1).map(p -&gt; process1(p)); <i class="conum" data-value="4"></i><b>(4)</b>
outputRecords2 = processor.publishOn(scheduler2).map(p -&gt; process2(p)); <i class="conum" data-value="5"></i><b>(5)</b>

Flux.merge(sender.send(outputRecords1), sender.send(outputRecords2))
    .doOnSubscribe(s -&gt; inputRecords.subscribe())
    .subscribe();                                                       <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create publish/subscribe EmitterProcessor for fan-out of Kafka inbound records</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create BlockingSink to which records are emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Receive from Kafka and emit to BlockingSink</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Consume records on a scheduler, process and generate output records to send to Kafka</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add another processor for the same input data on a different scheduler</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Merge the streams and subscribe to start the flow</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="concurrent-ordered">7.8. Concurrent Processing with Partition-Based Ordering</h3>
<div class="paragraph">
<p>The code segment below demonstrates a flow where messages are consumed from a Kafka topic, processed
by multiple threads and the results stored in another Kafka topic. Messages are grouped
by partition to guarantee ordering in message processing and commit operations. Messages
from each partition are processed on a single thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Scheduler scheduler = Schedulers.newElastic(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>, <span class="integer">60</span>, <span class="predefined-constant">true</span>);
KafkaReceiver.create(receiverOptions)
             .receive()
             .groupBy(m -&gt; m.receiverOffset().topicPartition())                  <i class="conum" data-value="1"></i><b>(1)</b>
             .flatMap(partitionFlux -&gt;
                 partitionFlux.publishOn(scheduler)
                              .map(r -&gt; processRecord(partitionFlux.key(), r))
                              .sample(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">5000</span>))                   <i class="conum" data-value="2"></i><b>(2)</b>
                              .concatMap(offset -&gt; offset.commit()));            <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Group by partition to guarantee ordering</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Commit periodically</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Commit in sequence using concatMap</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="transactional-sender">7.9. Transactional send</h3>
<div class="paragraph">
<p>The code segment below consumes messages from an external source, performs some transformation
and stores multiple transformed records in different Kafka topics within a transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">senderOptions = senderOptions
    .producerProperty(ProducerConfig.TRANSACTIONAL_ID_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleTxn</span><span class="delimiter">&quot;</span></span>);       <i class="conum" data-value="1"></i><b>(1)</b>
KafkaSender.create(senderOptions)
           .sendTransactionally(source.map(r -&gt; Flux.fromIterable(transform(r)))) <i class="conum" data-value="2"></i><b>(2)</b>
           .concatMap(r -&gt; r)
           .doOnError(e-&gt; log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Send failed, terminating.</span><span class="delimiter">&quot;</span></span>, e))
           .doOnNext(r -&gt; log.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">Send completed {}</span><span class="delimiter">&quot;</span></span>, r.correlationMetadata());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure transactional id for producer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Send multiple records generated from each source record within a transaction</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="exactly-once">7.10. Exactly-once delivery</h3>
<div class="paragraph">
<p>The code segment below demonstrates a flow with exactly once delivery. Source records
received from a Kafka topic are transformed and sent to Kafka. Each batch of records
is delivered to the application in a new transaction. Offsets of the source records
of each batch are automatically committed within its transaction. Each transaction
is committed by the application after the transformed records of the batch are
successfully delivered to the destination topic. Next batch of records is delivered
to the application in a new transaction after the current transaction is committed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">senderOptions = senderOptions
    .producerProperty(ProducerConfig.TRANSACTIONAL_ID_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleTxn</span><span class="delimiter">&quot;</span></span>);    <i class="conum" data-value="1"></i><b>(1)</b>
receiverOptions = receiverOptions
    .consumerProperty(ConsumerConfig.ISOLATION_LEVEL_CONFIG, <span class="string"><span class="delimiter">&quot;</span><span class="content">read_committed</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    .subscription(<span class="predefined-type">Collections</span>.singleton(sourceTopic));
sender = KafkaSender.create(senderOptions);
transactionManager = sender.transactionManager();
receiver.receiveExactlyOnce(transactionManager)                                <i class="conum" data-value="3"></i><b>(3)</b>
        .concatMap(f -&gt; sender.send(f.map(r -&gt; transform(r)))                  <i class="conum" data-value="4"></i><b>(4)</b>
                              .concatWith(transactionManager.commit()))        <i class="conum" data-value="5"></i><b>(5)</b>
        .onErrorResume(e -&gt; transactionManager.abort().then(Mono.error(e)))    <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure transactional id for producer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Consume only committed messages</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Receive exactly once within transactions, offsets are auto-committed when transaction is committed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send transformed records within the same transaction as source record offsets</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Commit transaction after sends complete successfully</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Abort transaction if send fails and propagate error</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-05-06 09:33:08 UTC
</div>
</div>
</body>
</html>