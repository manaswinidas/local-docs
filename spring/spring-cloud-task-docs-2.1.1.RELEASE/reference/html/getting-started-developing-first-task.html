<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>6.&nbsp;Developing Your First Spring Cloud Task Application</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Task Reference Guide"><link rel="up" href="getting-started.html" title="Part&nbsp;II.&nbsp;Getting started"><link rel="prev" href="getting-started-system-requirements.html" title="5.&nbsp;System Requirements"><link rel="next" href="features.html" title="Part&nbsp;III.&nbsp;Features"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.&nbsp;Developing Your First Spring Cloud Task Application</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="getting-started-system-requirements.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;II.&nbsp;Getting started</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="features.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="getting-started-developing-first-task" href="#getting-started-developing-first-task"></a>6.&nbsp;Developing Your First Spring Cloud Task Application</h2></div></div></div><p>A good place to start is with a simple &#8220;Hello, World!&#8221; application, so we create the
Spring Cloud Task equivalent to highlight the features of the framework. Most IDEs have
good support for Apache Maven, so we use it as the build tool for this project.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The spring.io web site contains many <a class="link" href="https://spring.io/guides" target="_top">&#8220;<code class="literal">Getting Started</code>&#8221;
guides</a> that use Spring Boot. If you need to solve a specific problem, check there first.
You can shortcut the following steps by going to the
<a class="link" href="http://start.spring.io/" target="_top">Spring Initializr</a> and creating a new project. Doing so
automatically generates a new project structure so that you can start coding right away.
We recommend experimenting with the Spring Initializr to become familiar with it.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="getting-started-creating-project" href="#getting-started-creating-project"></a>6.1&nbsp;Creating the Spring Task Project using Spring Initializr</h2></div></div></div><p>Now we can create and test an application that prints <code class="literal">Hello, World!</code> to the console.</p><p>To do so:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Visit the <a class="link" href="https://start.spring.io/" target="_top">Spring Initialzr</a> site.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Create a new Maven project with a <span class="strong"><strong>Group</strong></span> name of <code class="literal">io.spring.demo</code> and an <span class="strong"><strong>Artifact</strong></span> name of <code class="literal">helloworld</code>.</li><li class="listitem">In the Dependencies text box, type <code class="literal">task</code> and then select the <code class="literal">Cloud Task</code> dependency.</li><li class="listitem">In the Dependencies text box, type <code class="literal">jdbc</code> and then select the <code class="literal">JDBC</code> dependency.</li><li class="listitem">In the Dependencies text box, type <code class="literal">h2</code> and then select the <code class="literal">H2</code>. (or your favorite database)</li><li class="listitem">Click the <span class="strong"><strong>Generate Project</strong></span> button</li></ol></div></li><li class="listitem">Unzip the timestamp.zip file and import the project into your favorite IDE.</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="getting-started-writing-the-code" href="#getting-started-writing-the-code"></a>6.2&nbsp;Writing the Code</h2></div></div></div><p>To finish our application, we need to update the generated <code class="literal">HelloworldApplication</code> with the following contents so that it launches a Task.</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">package</span> io.spring.demo.helloworld;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.SpringApplication;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.context.annotation.Bean;

<em><span class="hl-annotation" style="color: gray">@SpringBootApplication</span></em>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> HelloworldApplication {
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> SampleTask {

	<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> CommandLineRunner commandLineRunner() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> HelloWorldCommandLineRunner();
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> main(String[] args) {
		SpringApplication.run(HelloworldApplication.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>, args);
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> HelloWorldCommandLineRunner <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> CommandLineRunner {

		<em><span class="hl-annotation" style="color: gray">@Override</span></em>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> run(String... strings) <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
			System.out.println(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello, World!"</span>);
		}
	}
}</pre><p>While it may seem small, quite a bit is going on. For more about Spring
Boot specifics, see the
<a class="link" href="http://docs.spring.io/spring-boot/docs/current/reference/html/" target="_top">Spring Boot reference documentation</a>.</p><p>Now we can open the <code class="literal">application.properties</code> file in <code class="literal">src/main/resources</code>.
We need to configure two properties in <code class="literal">application.properties</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">application.name</code>: To set the application name (which is translated to the task name)</li><li class="listitem"><code class="literal">logging.level</code>: To set the logging for Spring Cloud Task to <code class="literal">DEBUG</code> in order to
get a view of what is going on.</li></ul></div><p>The following example shows how to do both:</p><pre class="screen">logging.level.org.springframework.cloud.task=DEBUG
spring.application.name=helloWorld</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="getting-started-at-task" href="#getting-started-at-task"></a>6.2.1&nbsp;Task Auto Configuration</h3></div></div></div><p>When including Spring Cloud Task Starter dependency, Task auto configures all beans to bootstrap it&#8217;s functionality.
Part of this configuration registers the <code class="literal">TaskRepository</code> and the infrastructure for its use.</p><p>In our demo, the <code class="literal">TaskRepository</code> uses an embedded H2 database to record the results
of a task. This H2 embedded database is not a practical solution for a production environment, since
the H2 DB goes away once the task ends. However, for a quick getting-started
experience, we can use this in our example as well as echoing to the logs what is being updated
in that repository. In the <a class="xref" href="features-configuration.html" title="8.&nbsp;Configuration">Chapter&nbsp;8, <i>Configuration</i></a> section (later in this
documentation), we cover how to customize the configuration of the pieces provided by
Spring Cloud Task.</p><p>When our sample application runs, Spring Boot launches our <code class="literal">HelloWorldCommandLineRunner</code>
and outputs our &#8220;Hello, World!&#8221; message to standard out. The <code class="literal">TaskLifecycleListener</code>
records the start of the task and the end of the task in the repository.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="getting-started-main-method" href="#getting-started-main-method"></a>6.2.2&nbsp;The main method</h3></div></div></div><p>The main method serves as the entry point to any java application.  Our main method
delegates to Spring Boot&#8217;s <a class="link" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html" target="_top">SpringApplication</a> class.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="getting-started-clr" href="#getting-started-clr"></a>6.2.3&nbsp;The CommandLineRunner</h3></div></div></div><p>Spring includes many ways to bootstrap an application&#8217;s logic. Spring Boot provides
a convenient method of doing so in an organized manner through its <code class="literal">*Runner</code> interfaces
(<code class="literal">CommandLineRunner</code> or <code class="literal">ApplicationRunner</code>). A well behaved task can bootstrap any
logic by using one of these two runners.</p><p>The lifecycle of a task is considered from before the <code class="literal">*Runner#run</code> methods are executed
to once they are all complete. Spring Boot lets an application use multiple
<code class="literal">*Runner</code> implementations, as does Spring Cloud Task.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Any processing bootstrapped from mechanisms other than a <code class="literal">CommandLineRunner</code> or
<code class="literal">ApplicationRunner</code> (by using <code class="literal">InitializingBean#afterPropertiesSet</code> for example) is not
 recorded by Spring Cloud Task.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="getting-started-running-the-example" href="#getting-started-running-the-example"></a>6.3&nbsp;Running the Example</h2></div></div></div><p>At this point, our application should work.  Since this application is Spring Boot-based,
we can run it from the command line by using <code class="literal">$ mvn spring-boot:run</code> from the root
of our application, as shown (with its output) in the following example:</p><pre class="screen">$ mvn clean spring-boot:run
....... . . .
....... . . . (Maven log output here)
....... . . .

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.0.3.RELEASE)

2018-07-23 17:44:34.426  INFO 1978 --- [           main] i.s.d.helloworld.HelloworldApplication   : Starting HelloworldApplication on Glenns-MBP-2.attlocal.net with PID 1978 (/Users/glennrenfro/project/helloworld/target/classes started by glennrenfro in /Users/glennrenfro/project/helloworld)
2018-07-23 17:44:34.430  INFO 1978 --- [           main] i.s.d.helloworld.HelloworldApplication   : No active profile set, falling back to default profiles: default
2018-07-23 17:44:34.472  INFO 1978 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@1d24f32d: startup date [Mon Jul 23 17:44:34 EDT 2018]; root of context hierarchy
2018-07-23 17:44:35.280  INFO 1978 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2018-07-23 17:44:35.410  INFO 1978 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2018-07-23 17:44:35.419 DEBUG 1978 --- [           main] o.s.c.t.c.SimpleTaskConfiguration        : Using org.springframework.cloud.task.configuration.DefaultTaskConfigurer TaskConfigurer
2018-07-23 17:44:35.420 DEBUG 1978 --- [           main] o.s.c.t.c.DefaultTaskConfigurer          : No EntityManager was found, using DataSourceTransactionManager
2018-07-23 17:44:35.522 DEBUG 1978 --- [           main] o.s.c.t.r.s.TaskRepositoryInitializer    : Initializing task schema for h2 database
2018-07-23 17:44:35.525  INFO 1978 --- [           main] o.s.jdbc.datasource.init.ScriptUtils     : Executing SQL script from class path resource [org/springframework/cloud/task/schema-h2.sql]
2018-07-23 17:44:35.558  INFO 1978 --- [           main] o.s.jdbc.datasource.init.ScriptUtils     : Executed SQL script from class path resource [org/springframework/cloud/task/schema-h2.sql] in 33 ms.
2018-07-23 17:44:35.728  INFO 1978 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2018-07-23 17:44:35.730  INFO 1978 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Bean with name 'dataSource' has been autodetected for JMX exposure
2018-07-23 17:44:35.733  INFO 1978 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean 'dataSource': registering with JMX server as MBean [com.zaxxer.hikari:name=dataSource,type=HikariDataSource]
2018-07-23 17:44:35.738  INFO 1978 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
2018-07-23 17:44:35.762 DEBUG 1978 --- [           main] o.s.c.t.r.support.SimpleTaskRepository   : Creating: TaskExecution{executionId=0, parentExecutionId=null, exitCode=null, taskName='application', startTime=Mon Jul 23 17:44:35 EDT 2018, endTime=null, exitMessage='null', externalExecutionId='null', errorMessage='null', arguments=[]}
2018-07-23 17:44:35.772  INFO 1978 --- [           main] i.s.d.helloworld.HelloworldApplication   : Started HelloworldApplication in 1.625 seconds (JVM running for 4.764)
Hello, World!
2018-07-23 17:44:35.782 DEBUG 1978 --- [           main] o.s.c.t.r.support.SimpleTaskRepository   : Updating: TaskExecution with executionId=1 with the following {exitCode=0, endTime=Mon Jul 23 17:44:35 EDT 2018, exitMessage='null', errorMessage='null'}</pre><p>The preceding output has three lines that of interest to us here:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">SimpleTaskRepository</code> logged the creation of the entry in the <code class="literal">TaskRepository</code>.</li><li class="listitem">The execution of our <code class="literal">CommandLineRunner</code>, demonstrated by the &#8220;Hello, World!&#8221; output.</li><li class="listitem"><code class="literal">SimpleTaskRepository</code> logs the completion of the task in the <code class="literal">TaskRepository</code>.</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>A simple task application can be found in the samples module of the Spring Cloud
Task Project
<a class="link" href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/timestamp" target="_top">here</a>.</p></td></tr></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="getting-started-system-requirements.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="getting-started.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="features.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.&nbsp;System Requirements&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Part&nbsp;III.&nbsp;Features</td></tr></table></div></body></html>