<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>13.&nbsp;Launching a Task from a Spring Cloud Stream</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Task Reference Guide"><link rel="up" href="stream-integration.html" title="Part&nbsp;V.&nbsp;Spring Cloud Stream Integration"><link rel="prev" href="stream-integration.html" title="Part&nbsp;V.&nbsp;Spring Cloud Stream Integration"><link rel="next" href="stream-integration-events.html" title="14.&nbsp;Spring Cloud Task Events"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.&nbsp;Launching a Task from a Spring Cloud Stream</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="stream-integration.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;V.&nbsp;Spring Cloud Stream Integration</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="stream-integration-events.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="stream-integration-launching-sink" href="#stream-integration-launching-sink"></a>13.&nbsp;Launching a Task from a Spring Cloud Stream</h2></div></div></div><p>You can launch tasks from a stream. To do so, create a sink that listens for a message
that contains a <code class="literal">TaskLaunchRequest</code> as its payload. The <code class="literal">TaskLaunchRequest</code> contains:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">uri</code>: To the task artifact that is to be executed.</li><li class="listitem"><code class="literal">applicationName</code>: The name that is associated with the task. If no
applicationName is set, the <code class="literal">TaskLaunchRequest</code> generates a task name
comprised of the following: <code class="literal">Task-&lt;UUID&gt;</code>.</li><li class="listitem"><code class="literal">commandLineArguments</code>: A list containing the command line arguments for the task.</li><li class="listitem"><code class="literal">environmentProperties</code>: A map containing the environment variables to be used by the
task.</li><li class="listitem"><code class="literal">deploymentProperties</code>: A map containing the properties that are used by the deployer to
deploy the task.</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If the payload is of a different type, the sink throws an exception.</p></td></tr></table></div><p>For example, a stream can be created that has a processor that takes in data from an
HTTP source and creates a <code class="literal">GenericMessage</code> that contains the <code class="literal">TaskLaunchRequest</code> and sends
the message to its output channel. The task sink would then receive the message from its
input channnel and then launch the task.</p><p>To create a taskSink, you need only create a Spring Boot application that includes the
<code class="literal">EnableTaskLauncher</code> annotation, as shown in the following example:</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@SpringBootApplication</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableTaskLauncher</span></em>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> TaskSinkApplication {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> main(String[] args) {
		SpringApplication.run(TaskSinkApplication.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>, args);
	}
}</pre><p>The <a class="link" href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples" target="_top">samples
module</a> of the Spring Cloud Task project contains a sample Sink and Processor. To install
these samples into your local maven repository, run a maven build from the
<code class="literal">spring-cloud-task-samples</code> directory with the <code class="literal">skipInstall</code> property set to <code class="literal">false</code>, as
shown in the following example:</p><p><code class="literal">mvn clean install</code></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">maven.remoteRepositories.springRepo.url</code> property must be set to the location
of the remote repository in which the &uuml;ber-jar is located. If not set, there is no remote
repository, so it relies upon the local repository only.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="stream-integration-launching-sink-dataflow" href="#stream-integration-launching-sink-dataflow"></a>13.1&nbsp;Spring Cloud Data Flow</h2></div></div></div><p>To create a stream in Spring Cloud Data Flow, you must first register the Task Sink
Application we created. In the following example, we are registering the Processor and
Sink sample applications by using the Spring Cloud Data Flow shell:</p><pre class="programlisting">app register --name taskSink --<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">type</span> sink --uri maven://io.spring.cloud:tasksink:&lt;version&gt;
app register --name taskProcessor --<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">type</span> processor --uri maven:io.spring.cloud:taskprocessor:&lt;version&gt;</pre><p>The following example shows how to create a stream from the Spring Cloud Data Flow shell:</p><pre class="programlisting">stream create foo --definition <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"http --server.port=9000|taskProcessor|taskSink"</span> --deploy</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="stream-integration.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="stream-integration.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="stream-integration-events.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;V.&nbsp;Spring Cloud Stream Integration&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;14.&nbsp;Spring Cloud Task Events</td></tr></table></div></body></html>