<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>7.&nbsp;The lifecycle of a Spring Cloud Task</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Task Reference Guide"><link rel="up" href="features.html" title="Part&nbsp;III.&nbsp;Features"><link rel="prev" href="features.html" title="Part&nbsp;III.&nbsp;Features"><link rel="next" href="features-configuration.html" title="8.&nbsp;Configuration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.&nbsp;The lifecycle of a Spring Cloud Task</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="features.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;III.&nbsp;Features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="features-configuration.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="features-lifecycle" href="#features-lifecycle"></a>7.&nbsp;The lifecycle of a Spring Cloud Task</h2></div></div></div><p>In most cases, the modern cloud environment is designed around the execution of processes
that are not expected to end. If they do end, they are typically restarted. While most
platforms do have some way to run a process that is not restarted when it ends, the
results of that run are typically not maintained in a consumable way. Spring Cloud
Task offers the ability to execute short-lived processes in an environment and record the
results. Doing so allows for a microservices architecture around short-lived processes as
well as longer running services through the integration of tasks by messages.</p><p>While this functionality is useful in a cloud environment, the same issues can arise in a
traditional deployment model as well. When running Spring Boot applications with a
scheduler such as cron, it can be useful to be able to monitor the results of the
application after its completion.</p><p>Spring Cloud Task takes the approach that a Spring Boot application can have a start and
an end and still be successful. Batch applications are one example of how processes that
are expected to end (and that are often short-lived) can be helpful.</p><p>Spring Cloud Task records the lifecycle events of a given task. Most long-running
processes, typified by most web applications, do not save their lifecycle events. The
tasks at the heart of Spring Cloud Task do.</p><p>The lifecycle consists of a single task execution. This is a physical execution of a
Spring Boot application configured to be a task (that is, it has the Sprint Cloud Task dependencies).</p><p>At the beginning of a task, before any <code class="literal">CommandLineRunner</code> or <code class="literal">ApplicationRunner</code>
implementations have been run, an entry in the <code class="literal">TaskRepository</code> that records the start
event is created. This event is triggered through <code class="literal">SmartLifecycle#start</code> being triggered
by the Spring Framework. This indicates to the system that all beans are ready for use and
comes before running any of the <code class="literal">CommandLineRunner</code> or <code class="literal">ApplicationRunner</code> implementations
provided by Spring Boot.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The recording of a task only occurs upon the successful bootstrapping of an
<code class="literal">ApplicationContext</code>. If the context fails to bootstrap at all, the task&#8217;s run is not
recorded.</p></td></tr></table></div><p>Upon completion of all of the <code class="literal">*Runner#run</code> calls from Spring Boot or the failure of an
<code class="literal">ApplicationContext</code> (indicated by an <code class="literal">ApplicationFailedEvent</code>), the task execution is
updated in the repository with the results.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If the application requires the <code class="literal">ApplicationContext</code> to be closed at the
completion of a task (all <code class="literal">*Runner#run</code> methods have been called and the task
repository has been updated), set the property <code class="literal">spring.cloud.task.closecontext_enabled</code>
to true.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="features-task-execution-details" href="#features-task-execution-details"></a>7.1&nbsp;The TaskExecution</h2></div></div></div><p>The information stored in the <code class="literal">TaskRepository</code> is modeled in the <code class="literal">TaskExecution</code> class and
consists of the following information:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Field</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">executionid</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The unique ID for the task&#8217;s run.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">exitCode</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The exit code generated from an <code class="literal">ExitCodeExceptionMapper</code> implementation. If there is no
exit code generated but an <code class="literal">ApplicationFailedEvent</code> is thrown, 1 is set.  Otherwise, it is
assumed to be 0.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">taskName</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name for the task, as determined by the configured <code class="literal">TaskNameResolver</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">startTime</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The time the task was started, as indicated by the <code class="literal">SmartLifecycle#start</code> call.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">endTime</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The time the task was completed, as indicated by the <code class="literal">ApplicationReadyEvent</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">exitMessage</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Any information available at the time of exit. This can programmatically be set by a
<code class="literal">TaskExecutionListener</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">errorMessage</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>If an exception is the cause of the end of the task (as indicated by an
<code class="literal">ApplicationFailedEvent</code>), the stack trace for that exception is stored here.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">arguments</code></p></td><td style="" align="left" valign="top"><p>A <code class="literal">List</code> of the string command line arguments as they were passed into the executable
boot application.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="features-lifecycle-exit-codes" href="#features-lifecycle-exit-codes"></a>7.2&nbsp;Mapping Exit Codes</h2></div></div></div><p>When a task completes, it tries to return an exit code to the OS. If we take a look
at our <a class="link" href="getting-started-developing-first-task.html" title="6.&nbsp;Developing Your First Spring Cloud Task Application">original example</a>, we can see that we are
not controlling that aspect of our application. So, if an exception is thrown, the JVM
returns a code that may or may not be of any use to you in debugging.</p><p>Consequently, Spring Boot provides an interface, <code class="literal">ExitCodeExceptionMapper</code>, that lets you
map uncaught exceptions to exit codes. Doing so lets you indicate, at the level of exit
codes, what went wrong. Also, by mapping exit codes in this manner, Spring Cloud Task
records the returned exit code.</p><p>If the task terminates with a SIG-INT or a SIG-TERM, the exit code is zero unless
otherwise specified within the code.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>While the task is running, the exit code is stored as a null in the repository.
Once the task completes, the appropriate exit code is stored based on the guidelines described
earlier in this section.</p></td></tr></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="features.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="features.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="features-configuration.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;III.&nbsp;Features&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;8.&nbsp;Configuration</td></tr></table></div></body></html>