<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>84.&nbsp;Data Access</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="howto.html" title="Part&nbsp;IX.&nbsp;&#8216;How-to&#8217; guides"><link rel="prev" href="howto-logging.html" title="83.&nbsp;Logging"><link rel="next" href="howto-database-initialization.html" title="85.&nbsp;Database Initialization"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">84.&nbsp;Data Access</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="howto-logging.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IX.&nbsp;&#8216;How-to&#8217; guides</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="howto-database-initialization.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="howto-data-access" href="#howto-data-access"></a>84.&nbsp;Data Access</h2></div></div></div><p>Spring Boot includes a number of starters for working with data sources. This section
answers questions related to doing so.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-a-datasource" href="#howto-configure-a-datasource"></a>84.1&nbsp;Configure a Custom DataSource</h2></div></div></div><p>To configure your own <code class="literal">DataSource</code>, define a <code class="literal">@Bean</code> of that type in your configuration.
Spring Boot reuses your <code class="literal">DataSource</code> anywhere one is required, including database
initialization. If you need to externalize some settings, you can bind your
<code class="literal">DataSource</code> to the environment (see
&#8220;<a class="xref" href="boot-features-external-config.html#boot-features-external-config-3rd-party-configuration" title="24.8.1&nbsp;Third-party Configuration">Section&nbsp;24.8.1, &#8220;Third-party Configuration&#8221;</a>&#8221;).</p><p>The following example shows how to define a data source in a bean:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties(prefix="app.datasource")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DataSource dataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> FancyDataSource();
}</pre><p>The following example shows how to define a data source by setting properties:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.url</span>=jdbc:h2:mem:mydb
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.username</span>=sa
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.pool-size</span>=30</pre><p>Assuming that your <code class="literal">FancyDataSource</code> has regular JavaBean properties for the URL, the
username, and the pool size, these settings are bound automatically before the
<code class="literal">DataSource</code> is made available to other components. The regular
<a class="link" href="howto-database-initialization.html#howto-initialize-a-database-using-spring-jdbc" title="85.3&nbsp;Initialize a Database">database initialization</a> also happens
(so the relevant sub-set of <code class="literal">spring.datasource.*</code> can still be used with your custom
configuration).</p><p>Spring Boot also provides a utility builder class, called <code class="literal">DataSourceBuilder</code>, that can
be used to create one of the standard data sources (if it is on the classpath). The
builder can detect the one to use based on what&#8217;s available on the classpath. It also
auto-detects the driver based on the JDBC URL.</p><p>The following example shows how to create a data source by using a <code class="literal">DataSourceBuilder</code>:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DataSource dataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> DataSourceBuilder.create().build();
}</pre><p>To run an app with that <code class="literal">DataSource</code>, all you need is the connection
information. Pool-specific settings can also be provided. Check the implementation that
is going to be used at runtime for more details.</p><p>The following example shows how to define a JDBC data source by setting properties:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.url</span>=jdbc:mysql://localhost/test
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.username</span>=dbuser
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.password</span>=dbpass
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.pool-size</span>=30</pre><p>However, there is a catch. Because the actual type of the connection pool is not exposed,
no keys are generated in the metadata for your custom <code class="literal">DataSource</code> and no completion is
available in your IDE (because the <code class="literal">DataSource</code> interface exposes no properties). Also, if
you happen to have Hikari on the classpath, this basic setup does not work, because Hikari
has no <code class="literal">url</code> property (but does have a <code class="literal">jdbcUrl</code> property). In that case, you must rewrite
your configuration as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.jdbc-url</span>=jdbc:mysql://localhost/test
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.username</span>=dbuser
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.password</span>=dbpass
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.maximum-pool-size</span>=30</pre><p>You can fix that by forcing the connection pool to use and return a dedicated
implementation rather than <code class="literal">DataSource</code>. You cannot change the implementation
at runtime, but the list of options will be explicit.</p><p>The following example shows how create a <code class="literal">HikariDataSource</code> with <code class="literal">DataSourceBuilder</code>:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> HikariDataSource dataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> DataSourceBuilder.create().type(HikariDataSource.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).build();
}</pre><p>You can even go further by leveraging what <code class="literal">DataSourceProperties</code> does for you&#8201;&#8212;&#8201;that is,
by providing a default embedded database with a sensible username and password if no URL
is provided. You can easily initialize a <code class="literal">DataSourceBuilder</code> from the state of any
<code class="literal">DataSourceProperties</code> object, so you could also inject the DataSource that Spring Boot
creates automatically. However, that would split your configuration into two namespaces:
<code class="literal">url</code>, <code class="literal">username</code>, <code class="literal">password</code>, <code class="literal">type</code>, and <code class="literal">driver</code> on <code class="literal">spring.datasource</code> and the rest on
your custom namespace (<code class="literal">app.datasource</code>). To avoid that, you can redefine a custom
<code class="literal">DataSourceProperties</code> on your custom namespace, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Primary</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DataSourceProperties dataSourceProperties() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> DataSourceProperties();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.configuration")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> HikariDataSource dataSource(DataSourceProperties properties) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> properties.initializeDataSourceBuilder().type(HikariDataSource.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>)
			.build();
}</pre><p>This setup puts you <span class="emphasis"><em>in sync</em></span> with what Spring Boot does for you by default, except that
a dedicated connection pool is chosen (in code) and its settings are exposed in the
<code class="literal">app.datasource.configuration</code> sub namespace. Because <code class="literal">DataSourceProperties</code> is taking
care of the <code class="literal">url</code>/<code class="literal">jdbcUrl</code> translation for you, you can configure it as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.url</span>=jdbc:mysql://localhost/test
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.username</span>=dbuser
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.password</span>=dbpass
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.configuration.maximum-pool-size</span>=30</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring Boot will expose Hikari-specific settings to <code class="literal">spring.datasource.hikari</code>. This
example uses a more generic <code class="literal">configuration</code> sub namespace as the example does not support
multiple datasource implementations.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Because your custom configuration chooses to go with Hikari, <code class="literal">app.datasource.type</code>
has no effect. In practice, the builder is initialized with whatever value you
might set there and then overridden by the call to <code class="literal">.type()</code>.</p></td></tr></table></div><p>See &#8220;<a class="xref" href="boot-features-sql.html#boot-features-configure-datasource" title="31.1&nbsp;Configure a DataSource">Section&nbsp;31.1, &#8220;Configure a DataSource&#8221;</a>&#8221; in the
&#8220;Spring Boot features&#8221; section and the
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java" target="_top"><code class="literal">DataSourceAutoConfiguration</code></a>
class for more details.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-two-datasources" href="#howto-two-datasources"></a>84.2&nbsp;Configure Two DataSources</h2></div></div></div><p>If you need to configure multiple data sources, you can apply the same tricks that are
described in the previous section. You must, however, mark one of the <code class="literal">DataSource</code>
instances as <code class="literal">@Primary</code>, because various auto-configurations down the road expect to be
able to get one by type.</p><p>If you create your own <code class="literal">DataSource</code>, the auto-configuration backs off. In the following
example, we provide the <span class="emphasis"><em>exact</em></span> same feature set as the auto-configuration provides
on the primary data source:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Primary</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.first")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DataSourceProperties firstDataSourceProperties() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> DataSourceProperties();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Primary</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.first.configuration")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> HikariDataSource firstDataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> firstDataSourceProperties().initializeDataSourceBuilder()
			.type(HikariDataSource.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).build();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.second")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> BasicDataSource secondDataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> DataSourceBuilder.create().type(BasicDataSource.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).build();
}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><code class="literal">firstDataSourceProperties</code> has to be flagged as <code class="literal">@Primary</code> so that the database
initializer feature uses your copy (if you use the initializer).</p></td></tr></table></div><p>Both data sources are also bound for advanced customizations. For instance, you could
configure them as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.first.url</span>=jdbc:mysql://localhost/first
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.first.username</span>=dbuser
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.first.password</span>=dbpass
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.first.configuration.maximum-pool-size</span>=30

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.second.url</span>=jdbc:mysql://localhost/second
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.second.username</span>=dbuser
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.second.password</span>=dbpass
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">app.datasource.second.max-total</span>=30</pre><p>You can apply the same concept to the secondary <code class="literal">DataSource</code> as well, as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Primary</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.first")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DataSourceProperties firstDataSourceProperties() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> DataSourceProperties();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Primary</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.first.configuration")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> HikariDataSource firstDataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> firstDataSourceProperties().initializeDataSourceBuilder()
			.type(HikariDataSource.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).build();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.second")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DataSourceProperties secondDataSourceProperties() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> DataSourceProperties();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ConfigurationProperties("app.datasource.second.configuration")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> BasicDataSource secondDataSource() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> secondDataSourceProperties().initializeDataSourceBuilder()
			.type(BasicDataSource.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).build();
}</pre><p>The preceding example configures two data sources on custom namespaces with the same
logic as Spring Boot would use in auto-configuration. Note that each <code class="literal">configuration</code> sub
namespace provides advanced settings based on the chosen implementation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-spring-data-repositories" href="#howto-use-spring-data-repositories"></a>84.3&nbsp;Use Spring Data Repositories</h2></div></div></div><p>Spring Data can create implementations of <code class="literal">@Repository</code> interfaces of various flavors.
Spring Boot handles all of that for you, as long as those <code class="literal">@Repositories</code> are included in
the same package (or a sub-package) of your <code class="literal">@EnableAutoConfiguration</code> class.</p><p>For many applications, all you need is to put the right Spring Data dependencies on
your classpath (there is a <code class="literal">spring-boot-starter-data-jpa</code> for JPA and a
<code class="literal">spring-boot-starter-data-mongodb</code> for Mongodb) and create some repository interfaces to
handle your <code class="literal">@Entity</code> objects. Examples are in the
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-samples/spring-boot-sample-data-jpa" target="_top">JPA sample</a> and the
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-samples/spring-boot-sample-data-mongodb" target="_top">Mongodb sample</a>.</p><p>Spring Boot tries to guess the location of your <code class="literal">@Repository</code> definitions, based on the
<code class="literal">@EnableAutoConfiguration</code> it finds. To get more control, use the <code class="literal">@EnableJpaRepositories</code>
annotation (from Spring Data JPA).</p><p>For more about Spring Data, see the <a class="link" href="https://projects.spring.io/spring-data/" target="_top">Spring Data project page</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-separate-entity-definitions-from-spring-configuration" href="#howto-separate-entity-definitions-from-spring-configuration"></a>84.4&nbsp;Separate @Entity Definitions from Spring Configuration</h2></div></div></div><p>Spring Boot tries to guess the location of your <code class="literal">@Entity</code> definitions, based on the
<code class="literal">@EnableAutoConfiguration</code> it finds. To get more control, you can use the <code class="literal">@EntityScan</code>
annotation, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EnableAutoConfiguration</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EntityScan(basePackageClasses=City.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Application {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">//...</span>

}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-jpa-properties" href="#howto-configure-jpa-properties"></a>84.5&nbsp;Configure JPA Properties</h2></div></div></div><p>Spring Data JPA already provides some vendor-independent configuration options (such as
those for SQL logging), and Spring Boot exposes those options and a few more for Hibernate
as external configuration properties. Some of them are automatically detected according to
the context so you should not have to set them.</p><p>The <code class="literal">spring.jpa.hibernate.ddl-auto</code> is a special case, because, depending on runtime
conditions, it has different defaults. If an embedded database is used and no schema
manager (such as Liquibase or Flyway) is handling the <code class="literal">DataSource</code>, it defaults to
<code class="literal">create-drop</code>. In all other cases, it defaults to <code class="literal">none</code>.</p><p>The dialect to use is also automatically detected based on the current <code class="literal">DataSource</code>, but
you can set <code class="literal">spring.jpa.database</code> yourself if you want to be explicit and bypass that
check on startup.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Specifying a <code class="literal">database</code> leads to the configuration of a well-defined Hibernate
dialect. Several databases have more than one <code class="literal">Dialect</code>, and this may not suit your needs.
In that case, you can either set <code class="literal">spring.jpa.database</code> to <code class="literal">default</code> to let Hibernate
figure things out or set the dialect by setting the <code class="literal">spring.jpa.database-platform</code>
property.</p></td></tr></table></div><p>The most common options to set are shown in the following example:</p><pre class="screen">spring.jpa.hibernate.naming.physical-strategy=com.example.MyPhysicalNamingStrategy
spring.jpa.show-sql=true</pre><p>In addition, all properties in <code class="literal">spring.jpa.properties.*</code> are passed through as normal
JPA properties (with the prefix stripped) when the local <code class="literal">EntityManagerFactory</code> is
created.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you need to apply advanced customization to Hibernate properties, consider
registering a <code class="literal">HibernatePropertiesCustomizer</code> bean that will be invoked prior to creating
the <code class="literal">EntityManagerFactory</code>. This takes precedence to anything that is applied by the
auto-configuration.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-hibernate-naming-strategy" href="#howto-configure-hibernate-naming-strategy"></a>84.6&nbsp;Configure Hibernate Naming Strategy</h2></div></div></div><p>Hibernate uses <a class="link" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#naming" target="_top">two different naming strategies</a> to map
names from the object model to the corresponding database names. The fully qualified
class name of the physical and the implicit strategy implementations can be configured by
setting the <code class="literal">spring.jpa.hibernate.naming.physical-strategy</code> and
<code class="literal">spring.jpa.hibernate.naming.implicit-strategy</code> properties, respectively. Alternatively,
if <code class="literal">ImplicitNamingStrategy</code> or <code class="literal">PhysicalNamingStrategy</code> beans are available in the
application context, Hibernate will be automatically configured to use them.</p><p>By default, Spring Boot configures the physical naming strategy with
<code class="literal">SpringPhysicalNamingStrategy</code>. This implementation provides the same table structure as
Hibernate 4: all dots are replaced by underscores and camel casing is replaced by
underscores as well. By default, all table names are generated in lower case, but it is
possible to override that flag if your schema requires it.</p><p>For example, a <code class="literal">TelephoneNumber</code> entity is mapped to the <code class="literal">telephone_number</code> table.</p><p>If you prefer to use Hibernate 5&#8217;s default instead, set the following property:</p><pre class="screen">spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</pre><p>Alternatively, you can configure the following bean:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> PhysicalNamingStrategy physicalNamingStrategy() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> PhysicalNamingStrategyStandardImpl();
}</pre><p>See <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java" target="_top"><code class="literal">HibernateJpaAutoConfiguration</code></a>
and <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java" target="_top"><code class="literal">JpaBaseConfiguration</code></a>
for more details.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-hibernate-second-level-caching" href="#howto-configure-hibernate-second-level-caching"></a>84.7&nbsp;Configure Hibernate Second-Level Caching</h2></div></div></div><p>Hibernate <a class="link" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#caching" target="_top">second-level cache</a> can be configured for a
range of cache providers. Rather than configuring Hibernate to lookup the cache provider
again, it is better to provide the one that is available in the context whenever possible.</p><p>If you&#8217;re using JCache, this is pretty easy. First, make sure that
<code class="literal">org.hibernate:hibernate-jcache</code> is available on the classpath. Then, add a
<code class="literal">HibernatePropertiesCustomizer</code> bean as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> HibernateSecondLevelCacheExample {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> HibernatePropertiesCustomizer hibernateSecondLevelCacheCustomizer(
			JCacheCacheManager cacheManager) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> (properties) -&gt; properties.put(ConfigSettings.CACHE_MANAGER,
				cacheManager.getCacheManager());

	}

}</pre><p>This customizer will configure Hibernate to use the same <code class="literal">CacheManager</code> as the one that
the application uses. It is also possible to use separate <code class="literal">CacheManager</code> instances. For
details, refer to <a class="link" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache" target="_top">the Hibernate user
guide</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-dependency-injection-hibernate-components" href="#howto-use-dependency-injection-hibernate-components"></a>84.8&nbsp;Use Dependency Injection in Hibernate Components</h2></div></div></div><p>By default, Spring Boot registers a <code class="literal">BeanContainer</code> implementation that uses the
<code class="literal">BeanFactory</code> so that converters and entity listeners can use regular dependency
injection.</p><p>You can disable or tune this behaviour by registering a <code class="literal">HibernatePropertiesCustomizer</code>
that removes or changes the <code class="literal">hibernate.resource.beans.container</code> property.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-custom-entity-manager" href="#howto-use-custom-entity-manager"></a>84.9&nbsp;Use a Custom EntityManagerFactory</h2></div></div></div><p>To take full control of the configuration of the <code class="literal">EntityManagerFactory</code>, you need to add
a <code class="literal">@Bean</code> named &#8216;entityManagerFactory&#8217;. Spring Boot auto-configuration switches off its
entity manager in the presence of a bean of that type.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-two-entity-managers" href="#howto-use-two-entity-managers"></a>84.10&nbsp;Use Two EntityManagers</h2></div></div></div><p>Even if the default <code class="literal">EntityManagerFactory</code> works fine, you need to define a new one.
Otherwise, the presence of the second bean of that type switches off the
default. To make it easy to do, you can use the convenient <code class="literal">EntityManagerBuilder</code>
provided by Spring Boot. Alternatively, you can just the
<code class="literal">LocalContainerEntityManagerFactoryBean</code> directly from Spring ORM, as shown in the
following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// add two data sources configured as above</span>

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> LocalContainerEntityManagerFactoryBean customerEntityManagerFactory(
		EntityManagerFactoryBuilder builder) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> builder
			.dataSource(customerDataSource())
			.packages(Customer.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>)
			.persistenceUnit(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"customers"</span>)
			.build();
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> LocalContainerEntityManagerFactoryBean orderEntityManagerFactory(
		EntityManagerFactoryBuilder builder) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> builder
			.dataSource(orderDataSource())
			.packages(Order.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>)
			.persistenceUnit(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"orders"</span>)
			.build();
}</pre><p>The configuration above almost works on its own. To complete the picture, you need to
configure <code class="literal">TransactionManagers</code> for the two <code class="literal">EntityManagers</code> as well. If you mark one of
them as <code class="literal">@Primary</code>, it could be picked up by the default <code class="literal">JpaTransactionManager</code> in Spring
Boot. The other would have to be explicitly injected into a new instance. Alternatively,
you might be able to use a JTA transaction manager that spans both.</p><p>If you use Spring Data, you need to configure <code class="literal">@EnableJpaRepositories</code> accordingly,
as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EnableJpaRepositories(basePackageClasses = Customer.class,
		entityManagerFactoryRef = "customerEntityManagerFactory")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> CustomerConfiguration {
	...
}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EnableJpaRepositories(basePackageClasses = Order.class,
		entityManagerFactoryRef = "orderEntityManagerFactory")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> OrderConfiguration {
	...
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-traditional-persistence-xml" href="#howto-use-traditional-persistence-xml"></a>84.11&nbsp;Use a Traditional <code class="literal">persistence.xml</code> File</h2></div></div></div><p>Spring Boot will not search for or use a <code class="literal">META-INF/persistence.xml</code> by default. If you
prefer to use a traditional <code class="literal">persistence.xml</code>, you need to define your own <code class="literal">@Bean</code> of
type <code class="literal">LocalEntityManagerFactoryBean</code> (with an ID of &#8216;entityManagerFactory&#8217;) and set the
persistence unit name there.</p><p>See
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java" target="_top"><code class="literal">JpaBaseConfiguration</code></a>
for the default settings.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-spring-data-jpa--and-mongo-repositories" href="#howto-use-spring-data-jpa--and-mongo-repositories"></a>84.12&nbsp;Use Spring Data JPA and Mongo Repositories</h2></div></div></div><p>Spring Data JPA and Spring Data Mongo can both automatically create <code class="literal">Repository</code>
implementations for you. If they are both present on the classpath, you might have to do
some extra configuration to tell Spring Boot which repositories to create. The most
explicit way to do that is to use the standard Spring Data <code class="literal">@EnableJpaRepositories</code> and
<code class="literal">@EnableMongoRepositories</code> annotations and provide the location of your <code class="literal">Repository</code>
interfaces.</p><p>There are also flags (<code class="literal">spring.data.*.repositories.enabled</code> and
<code class="literal">spring.data.*.repositories.type</code>) that you can use to switch the auto-configured
repositories on and off in external configuration. Doing so is useful, for instance, in
case you want to switch off the Mongo repositories and still use the auto-configured
<code class="literal">MongoTemplate</code>.</p><p>The same obstacle and the same features exist for other auto-configured Spring Data
repository types (Elasticsearch, Solr, and others). To work with them, change the names of
the annotations and flags accordingly.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-customize-spring-datas-web-support" href="#howto-use-customize-spring-datas-web-support"></a>84.13&nbsp;Customize Spring Data&#8217;s Web Support</h2></div></div></div><p>Spring Data provides web support that simplifies the use of Spring Data repositories in a
web application. Spring Boot provides properties in the <code class="literal">spring.data.web</code> namespace
for customizing its configuration. Note that if you are using Spring Data REST, you must
use the properties in the <code class="literal">spring.data.rest</code> namespace instead.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-exposing-spring-data-repositories-rest-endpoint" href="#howto-use-exposing-spring-data-repositories-rest-endpoint"></a>84.14&nbsp;Expose Spring Data Repositories as REST Endpoint</h2></div></div></div><p>Spring Data REST can expose the <code class="literal">Repository</code> implementations as REST endpoints for you,
provided Spring MVC has been enabled for the application.</p><p>Spring Boot exposes a set of useful properties (from the <code class="literal">spring.data.rest</code> namespace)
that customize the
<a class="link" href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest/core/config/RepositoryRestConfiguration.html" target="_top"><code class="literal">RepositoryRestConfiguration</code></a>.
If you need to provide additional customization, you should use a
<a class="link" href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest/webmvc/config/RepositoryRestConfigurer.html" target="_top"><code class="literal">RepositoryRestConfigurer</code></a>
bean.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you do not specify any order on your custom <code class="literal">RepositoryRestConfigurer</code>, it runs
after the one Spring Boot uses internally. If you need to specify an order, make sure it
is higher than 0.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-a-component-that-is-used-by-JPA" href="#howto-configure-a-component-that-is-used-by-JPA"></a>84.15&nbsp;Configure a Component that is Used by JPA</h2></div></div></div><p>If you want to configure a component that JPA uses, then you need to ensure
that the component is initialized before JPA. When the component is auto-configured,
Spring Boot takes care of this for you. For example, when Flyway is auto-configured,
Hibernate is configured to depend upon Flyway so that Flyway has a chance to
initialize the database before Hibernate tries to use it.</p><p>If you are configuring a component yourself, you can use an
<code class="literal">EntityManagerFactoryDependsOnPostProcessor</code> subclass as a convenient way of setting up
the necessary dependencies. For example, if you use Hibernate Search with
Elasticsearch as its index manager, any <code class="literal">EntityManagerFactory</code> beans must be
configured to depend on the <code class="literal">elasticsearchClient</code> bean, as shown in the following example:</p><pre class="programlisting"><xslthl:doccomment xmlns:xslthl="http://xslthl.sourceforge.net/">/**
 * {@link EntityManagerFactoryDependsOnPostProcessor} that ensures that
 * {@link EntityManagerFactory} beans depend on the {@code elasticsearchClient} bean.
 */</xslthl:doccomment>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ElasticsearchJpaDependencyConfiguration
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> EntityManagerFactoryDependsOnPostProcessor {

	ElasticsearchJpaDependencyConfiguration() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">super</span>(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"elasticsearchClient"</span>);
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-jOOQ-with-multiple-datasources" href="#howto-configure-jOOQ-with-multiple-datasources"></a>84.16&nbsp;Configure jOOQ with Two DataSources</h2></div></div></div><p>If you need to use jOOQ with multiple data sources, you should create your own
<code class="literal">DSLContext</code> for each one. Refer to
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jooq/JooqAutoConfiguration.java" target="_top">JooqAutoConfiguration</a>
for more details.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>In particular, <code class="literal">JooqExceptionTranslator</code> and <code class="literal">SpringTransactionProvider</code> can be
reused to provide similar features to what the auto-configuration does with a single
<code class="literal">DataSource</code>.</p></td></tr></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="howto-logging.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="howto.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="howto-database-initialization.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">83.&nbsp;Logging&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;85.&nbsp;Database Initialization</td></tr></table></div></body></html>