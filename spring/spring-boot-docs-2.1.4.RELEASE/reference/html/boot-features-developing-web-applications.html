<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>29.&nbsp;Developing Web Applications</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="boot-features.html" title="Part&nbsp;IV.&nbsp;Spring Boot features"><link rel="prev" href="boot-features-json.html" title="28.&nbsp;JSON"><link rel="next" href="boot-features-security.html" title="30.&nbsp;Security"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.&nbsp;Developing Web Applications</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="boot-features-json.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Spring Boot features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="boot-features-security.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="boot-features-developing-web-applications" href="#boot-features-developing-web-applications"></a>29.&nbsp;Developing Web Applications</h2></div></div></div><p>Spring Boot is well suited for web application development. You can create a
self-contained HTTP server by using embedded Tomcat, Jetty, Undertow, or Netty. Most web
applications use the <code class="literal">spring-boot-starter-web</code> module to get up and running quickly. You
can also choose to build reactive web applications by using the
<code class="literal">spring-boot-starter-webflux</code> module.</p><p>If you have not yet developed a Spring Boot web application, you can follow the
"Hello World!" example in the
<span class="emphasis"><em><a class="link" href="getting-started-first-application.html" title="11.&nbsp;Developing Your First Spring Boot Application">Getting started</a></em></span> section.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-spring-mvc" href="#boot-features-spring-mvc"></a>29.1&nbsp;The &#8220;Spring Web MVC Framework&#8221;</h2></div></div></div><p>The <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc" target="_top">Spring Web MVC framework</a> (often referred to as simply
&#8220;Spring MVC&#8221;) is a rich &#8220;model view controller&#8221; web framework. Spring MVC lets you
create special <code class="literal">@Controller</code> or <code class="literal">@RestController</code> beans to handle incoming HTTP requests.
Methods in your controller are mapped to HTTP by using <code class="literal">@RequestMapping</code> annotations.</p><p>The following code shows a typical <code class="literal">@RestController</code> that serves JSON data:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RestController</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RequestMapping(value="/users")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyRestController {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RequestMapping(value="/{user}", method=RequestMethod.GET)</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> User getUser(<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@PathVariable</xslthl:annotation> Long user) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RequestMapping(value="/{user}/customers", method=RequestMethod.GET)</xslthl:annotation>
	List&lt;Customer&gt; getUserCustomers(<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@PathVariable</xslthl:annotation> Long user) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RequestMapping(value="/{user}", method=RequestMethod.DELETE)</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> User deleteUser(<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@PathVariable</xslthl:annotation> Long user) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><p>Spring MVC is part of the core Spring Framework, and detailed information is available in
the  <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc" target="_top">reference documentation</a>. There are also several
guides that cover Spring MVC available at <a class="link" href="https://spring.io/guides" target="_top">spring.io/guides</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-auto-configuration" href="#boot-features-spring-mvc-auto-configuration"></a>29.1.1&nbsp;Spring MVC Auto-configuration</h3></div></div></div><p>Spring Boot provides auto-configuration for Spring MVC that works well with most
applications.</p><p>The auto-configuration adds the following features on top of Spring&#8217;s defaults:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Inclusion of <code class="literal">ContentNegotiatingViewResolver</code> and <code class="literal">BeanNameViewResolver</code> beans.</li><li class="listitem">Support for serving static resources, including support for WebJars (covered
<a class="link" href="boot-features-developing-web-applications.html#boot-features-spring-mvc-static-content" title="29.1.5&nbsp;Static Content">later in this document</a>)).</li><li class="listitem">Automatic registration of <code class="literal">Converter</code>, <code class="literal">GenericConverter</code>, and <code class="literal">Formatter</code> beans.</li><li class="listitem">Support for <code class="literal">HttpMessageConverters</code> (covered
<a class="link" href="boot-features-developing-web-applications.html#boot-features-spring-mvc-message-converters" title="29.1.2&nbsp;HttpMessageConverters">later in this document</a>).</li><li class="listitem">Automatic registration of <code class="literal">MessageCodesResolver</code> (covered
<a class="link" href="boot-features-developing-web-applications.html#boot-features-spring-message-codes" title="29.1.4&nbsp;MessageCodesResolver">later in this document</a>).</li><li class="listitem">Static <code class="literal">index.html</code> support.</li><li class="listitem">Custom <code class="literal">Favicon</code> support (covered <a class="link" href="boot-features-developing-web-applications.html#boot-features-spring-mvc-favicon" title="29.1.7&nbsp;Custom Favicon">later in this
document</a>).</li><li class="listitem">Automatic use of a <code class="literal">ConfigurableWebBindingInitializer</code> bean (covered
<a class="link" href="boot-features-developing-web-applications.html#boot-features-spring-mvc-web-binding-initializer" title="29.1.9&nbsp;ConfigurableWebBindingInitializer">later in this document</a>).</li></ul></div><p>If you want to keep Spring Boot MVC features and you want to add additional
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc" target="_top">MVC configuration</a> (interceptors, formatters, view
controllers, and other features), you can add your own <code class="literal">@Configuration</code> class of type
<code class="literal">WebMvcConfigurer</code> but <span class="strong"><strong>without</strong></span> <code class="literal">@EnableWebMvc</code>. If you wish to provide custom
instances of <code class="literal">RequestMappingHandlerMapping</code>, <code class="literal">RequestMappingHandlerAdapter</code>, or
<code class="literal">ExceptionHandlerExceptionResolver</code>, you can declare a <code class="literal">WebMvcRegistrationsAdapter</code>
instance to provide such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code class="literal">@Configuration</code>
annotated with <code class="literal">@EnableWebMvc</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-message-converters" href="#boot-features-spring-mvc-message-converters"></a>29.1.2&nbsp;HttpMessageConverters</h3></div></div></div><p>Spring MVC uses the <code class="literal">HttpMessageConverter</code> interface to convert HTTP requests and
responses. Sensible defaults are included out of the box. For example, objects can be
automatically converted to JSON (by using the Jackson library) or XML (by using the
Jackson XML extension, if available, or by using JAXB if the Jackson XML extension is not
available). By default, strings are encoded in <code class="literal">UTF-8</code>.</p><p>If you need to add or customize converters, you can use Spring Boot&#8217;s
<code class="literal">HttpMessageConverters</code> class, as shown in the following listing:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.autoconfigure.http.HttpMessageConverters;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.context.annotation.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.http.converter.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> HttpMessageConverters customConverters() {
		HttpMessageConverter&lt;?&gt; additional = ...
		HttpMessageConverter&lt;?&gt; another = ...
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> HttpMessageConverters(additional, another);
	}

}</pre><p>Any <code class="literal">HttpMessageConverter</code> bean that is present in the context is added to the list of
converters. You can also override default converters in the same way.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-json-components" href="#boot-features-json-components"></a>29.1.3&nbsp;Custom JSON Serializers and Deserializers</h3></div></div></div><p>If you use Jackson to serialize and deserialize JSON data, you might want to write your
own <code class="literal">JsonSerializer</code> and <code class="literal">JsonDeserializer</code> classes. Custom serializers are usually
<a class="link" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers" target="_top">registered with Jackson through
a module</a>, but Spring Boot provides an alternative <code class="literal">@JsonComponent</code> annotation that makes
it easier to directly register Spring Beans.</p><p>You can use the <code class="literal">@JsonComponent</code> annotation directly on <code class="literal">JsonSerializer</code> or
<code class="literal">JsonDeserializer</code> implementations. You can also use it on classes that contain
serializers/deserializers as inner classes, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> java.io.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> com.fasterxml.jackson.core.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> com.fasterxml.jackson.databind.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.jackson.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@JsonComponent</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Example {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Serializer <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> JsonSerializer&lt;SomeObject&gt; {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Deserializer <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> JsonDeserializer&lt;SomeObject&gt; {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><p>All <code class="literal">@JsonComponent</code> beans in the <code class="literal">ApplicationContext</code> are automatically registered with
Jackson. Because <code class="literal">@JsonComponent</code> is meta-annotated with <code class="literal">@Component</code>, the usual
component-scanning rules apply.</p><p>Spring Boot also provides
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectSerializer.java" target="_top"><code class="literal">JsonObjectSerializer</code></a> and
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectDeserializer.java" target="_top"><code class="literal">JsonObjectDeserializer</code></a> base
classes that provide useful alternatives to the standard Jackson versions when
serializing objects. See
<a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/jackson/JsonObjectSerializer.html" target="_top"><code class="literal">JsonObjectSerializer</code></a>
and <a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/jackson/JsonObjectDeserializer.html" target="_top"><code class="literal">JsonObjectDeserializer</code></a> in
the Javadoc for details.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-message-codes" href="#boot-features-spring-message-codes"></a>29.1.4&nbsp;MessageCodesResolver</h3></div></div></div><p>Spring MVC has a strategy for generating error codes for rendering error messages from
binding errors: <code class="literal">MessageCodesResolver</code>. If you set the
<code class="literal">spring.mvc.message-codes-resolver.format</code> property <code class="literal">PREFIX_ERROR_CODE</code> or
<code class="literal">POSTFIX_ERROR_CODE</code>, Spring Boot creates one for you (see the enumeration in
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.Format.html" target="_top"><code class="literal">DefaultMessageCodesResolver.Format</code></a>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-static-content" href="#boot-features-spring-mvc-static-content"></a>29.1.5&nbsp;Static Content</h3></div></div></div><p>By default, Spring Boot serves static content from a directory called <code class="literal">/static</code> (or
<code class="literal">/public</code> or <code class="literal">/resources</code> or <code class="literal">/META-INF/resources</code>) in the classpath or from the root of
the <code class="literal">ServletContext</code>.  It uses the <code class="literal">ResourceHttpRequestHandler</code> from Spring MVC so that
you can modify that behavior by adding your own <code class="literal">WebMvcConfigurer</code> and overriding the
<code class="literal">addResourceHandlers</code> method.</p><p>In a stand-alone web application, the default servlet from the container is also enabled
and acts as a fallback, serving content from the root of the <code class="literal">ServletContext</code> if Spring
decides not to handle it. Most of the time, this does not happen (unless you modify the
default MVC configuration), because Spring can always handle requests through the
<code class="literal">DispatcherServlet</code>.</p><p>By default, resources are mapped on <code class="literal">/**</code>, but you can tune that with the
<code class="literal">spring.mvc.static-path-pattern</code> property. For instance, relocating all resources to
<code class="literal">/resources/**</code> can be achieved as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.static-path-pattern</span>=/resources/**</pre><p>You can also customize the static resource locations by using the
<code class="literal">spring.resources.static-locations</code> property (replacing the default values with a list of
directory locations). The root Servlet context path, <code class="literal">"/"</code>, is automatically added as a
location as well.</p><p>In addition to the &#8220;standard&#8221; static resource locations mentioned earlier, a special
case is made for <a class="link" href="https://www.webjars.org/" target="_top">Webjars content</a>. Any resources with a path in
<code class="literal">/webjars/**</code> are served from jar files if they are packaged in the Webjars format.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Do not use the <code class="literal">src/main/webapp</code> directory if your application is packaged as a jar.
Although this directory is a common standard, it works <span class="strong"><strong>only</strong></span> with war packaging, and it
is silently ignored by most build tools if you generate a jar.</p></td></tr></table></div><p>Spring Boot also supports the advanced resource handling features provided by Spring MVC,
allowing use cases such as cache-busting static resources or using version agnostic URLs
for Webjars.</p><p>To use version agnostic URLs for Webjars, add the <code class="literal">webjars-locator-core</code> dependency.
Then declare your Webjar. Using jQuery as an example, adding
<code class="literal">"/webjars/jquery/jquery.min.js"</code> results in
<code class="literal">"/webjars/jquery/x.y.z/jquery.min.js"</code>. where <code class="literal">x.y.z</code> is the Webjar version.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you use JBoss, you need to declare the <code class="literal">webjars-locator-jboss-vfs</code>
dependency instead of the <code class="literal">webjars-locator-core</code>. Otherwise, all Webjars resolve as a
<code class="literal">404</code>.</p></td></tr></table></div><p>To use cache busting, the following configuration configures a cache busting solution for
all static resources, effectively adding a content hash, such as
<code class="literal">&lt;link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css"/&gt;</code>, in URLs:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.content.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.content.paths</span>=/**</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Links to resources are rewritten in templates at runtime, thanks to a
<code class="literal">ResourceUrlEncodingFilter</code> that is auto-configured for Thymeleaf and FreeMarker. You
should manually declare this filter when using JSPs. Other template engines are currently
not automatically supported but can be with custom template macros/helpers and the use of
the
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceUrlProvider.html" target="_top"><code class="literal">ResourceUrlProvider</code></a>.</p></td></tr></table></div><p>When loading resources dynamically with, for example, a JavaScript module loader,
renaming files is not an option. That is why other strategies are also supported and can
be combined. A "fixed" strategy adds a static version string in the URL without changing
the file name, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.content.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.content.paths</span>=/**
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.fixed.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.fixed.paths</span>=/js/lib/
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.resources.chain.strategy.fixed.version</span>=v12</pre><p>With this configuration, JavaScript modules located under <code class="literal">"/js/lib/"</code> use a fixed
versioning strategy (<code class="literal">"/v12/js/lib/mymodule.js"</code>), while other resources still use the
content one (<code class="literal">&lt;link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css"/&gt;</code>).</p><p>See <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ResourceProperties.java" target="_top"><code class="literal">ResourceProperties</code></a>
for more supported options.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This feature has been thoroughly described in a dedicated
<a class="link" href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources" target="_top">blog
post</a> and in Spring Framework&#8217;s
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc-config-static-resources" target="_top">reference documentation</a>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-welcome-page" href="#boot-features-spring-mvc-welcome-page"></a>29.1.6&nbsp;Welcome Page</h3></div></div></div><p>Spring Boot supports both static and templated welcome pages. It first looks for an
<code class="literal">index.html</code> file in the configured static content locations. If one is not found, it
then looks for an <code class="literal">index</code> template. If either is found, it is automatically used as the
welcome page of the application.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-favicon" href="#boot-features-spring-mvc-favicon"></a>29.1.7&nbsp;Custom Favicon</h3></div></div></div><p>Spring Boot looks for a <code class="literal">favicon.ico</code> in the configured static content locations and the
root of the classpath (in that order). If such a file is present, it is automatically
used as the favicon of the application.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-pathmatch" href="#boot-features-spring-mvc-pathmatch"></a>29.1.8&nbsp;Path Matching and Content Negotiation</h3></div></div></div><p>Spring MVC can map incoming HTTP requests to handlers by looking at the request path and
matching it to the mappings defined in your application (for example, <code class="literal">@GetMapping</code>
annotations on Controller methods).</p><p>Spring Boot chooses to disable suffix pattern matching by default, which means that
requests like <code class="literal">"GET /projects/spring-boot.json"</code> won&#8217;t be matched to
<code class="literal">@GetMapping("/projects/spring-boot")</code> mappings.
This is considered as a
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match" target="_top">best practice
for Spring MVC applications</a>. This feature was mainly useful in the past for HTTP
clients which did not send proper "Accept" request headers; we needed to make sure
to send the correct Content Type to the client. Nowadays, Content Negotiation
is much more reliable.</p><p>There are other ways to deal with HTTP clients that don&#8217;t consistently send proper
"Accept" request headers. Instead of using suffix matching, we can use a query
parameter to ensure that requests like <code class="literal">"GET /projects/spring-boot?format=json"</code>
will be mapped to <code class="literal">@GetMapping("/projects/spring-boot")</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.contentnegotiation.favor-parameter</span>=true

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment"># We can change the parameter name, which is "format" by default:</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment"># spring.mvc.contentnegotiation.parameter-name=myparam</span>

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment"># We can also register additional file extensions/media types with:</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.contentnegotiation.media-types.markdown</span>=text/markdown</pre><p>If you understand the caveats and would still like your application to use
suffix pattern matching, the following configuration is required:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.contentnegotiation.favor-path-extension</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.pathmatch.use-suffix-pattern</span>=true</pre><p>Alternatively, rather than open all suffix patterns, it&#8217;s more secure to just support
registered suffix patterns:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.contentnegotiation.favor-path-extension</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.mvc.pathmatch.use-registered-suffix-pattern</span>=true

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment"># You can also register additional file extensions/media types with:</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment"># spring.mvc.contentnegotiation.media-types.adoc=text/asciidoc</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-web-binding-initializer" href="#boot-features-spring-mvc-web-binding-initializer"></a>29.1.9&nbsp;ConfigurableWebBindingInitializer</h3></div></div></div><p>Spring MVC uses a <code class="literal">WebBindingInitializer</code> to initialize a <code class="literal">WebDataBinder</code> for a
particular request. If you create your own <code class="literal">ConfigurableWebBindingInitializer</code> <code class="literal">@Bean</code>,
Spring Boot automatically configures Spring MVC to use it.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-mvc-template-engines" href="#boot-features-spring-mvc-template-engines"></a>29.1.10&nbsp;Template Engines</h3></div></div></div><p>As well as REST web services, you can also use Spring MVC to serve dynamic HTML content.
Spring MVC supports a variety of templating technologies, including Thymeleaf,
FreeMarker, and JSPs. Also, many other templating engines include their own Spring MVC
integrations.</p><p>Spring Boot includes auto-configuration support for the following templating engines:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://freemarker.apache.org/docs/" target="_top">FreeMarker</a></li><li class="listitem"><a class="link" href="http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine" target="_top">Groovy</a></li><li class="listitem"><a class="link" href="https://www.thymeleaf.org" target="_top">Thymeleaf</a></li><li class="listitem"><a class="link" href="https://mustache.github.io/" target="_top">Mustache</a></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If possible, JSPs should be avoided. There are several
<a class="link" href="boot-features-developing-web-applications.html#boot-features-jsp-limitations" title="29.4.5&nbsp;JSP Limitations">known limitations</a> when using them with embedded
servlet containers.</p></td></tr></table></div><p>When you use one of these templating engines with the default configuration, your
templates are picked up automatically from <code class="literal">src/main/resources/templates</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Depending on how you run your application, IntelliJ IDEA orders the classpath
differently. Running your application in the IDE from its main method results in a
different ordering than when you run your application by using Maven or Gradle or from
its packaged jar. This can cause Spring Boot to fail to find the templates on the
classpath. If you have this problem, you can reorder the classpath in the IDE to place
the module&#8217;s classes and resources first. Alternatively, you can configure the template
prefix to search every <code class="literal">templates</code> directory on the classpath, as follows:
<code class="literal">classpath*:/templates/</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-error-handling" href="#boot-features-error-handling"></a>29.1.11&nbsp;Error Handling</h3></div></div></div><p>By default, Spring Boot provides an <code class="literal">/error</code> mapping that handles all errors in a
sensible way, and it is registered as a &#8220;global&#8221; error page in the servlet container.
For machine clients, it produces a JSON response with details of the error, the HTTP
status, and the exception message. For browser clients, there is a &#8220;whitelabel&#8221; error
view that renders the same data in HTML format (to customize it, add a <code class="literal">View</code> that
resolves to <code class="literal">error</code>). To replace the default behavior completely, you can implement
<code class="literal">ErrorController</code> and register a bean definition of that type or add a bean of type
<code class="literal">ErrorAttributes</code> to use the existing mechanism but replace the contents.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">BasicErrorController</code> can be used as a base class for a custom
<code class="literal">ErrorController</code>. This is particularly useful if you want to add a handler for a new
content type (the default is to handle <code class="literal">text/html</code> specifically and provide a fallback
for everything else). To do so, extend <code class="literal">BasicErrorController</code>, add a public method with a
<code class="literal">@RequestMapping</code> that has a <code class="literal">produces</code> attribute, and create a bean of your new type.</p></td></tr></table></div><p>You can also define a class annotated with <code class="literal">@ControllerAdvice</code> to customize the JSON
document to return for a particular controller and/or exception type, as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ControllerAdvice(basePackageClasses = AcmeController.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> AcmeControllerAdvice <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> ResponseEntityExceptionHandler {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ExceptionHandler(YourException.class)</xslthl:annotation>
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ResponseBody</xslthl:annotation>
	ResponseEntity&lt;?&gt; handleControllerException(HttpServletRequest request, Throwable ex) {
		HttpStatus status = getStatus(request);
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> ResponseEntity&lt;&gt;(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> CustomErrorType(status.value(), ex.getMessage()), status);
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> HttpStatus getStatus(HttpServletRequest request) {
		Integer statusCode = (Integer) request.getAttribute(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"javax.servlet.error.status_code"</span>);
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">if</span> (statusCode == null) {
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> HttpStatus.INTERNAL_SERVER_ERROR;
		}
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> HttpStatus.valueOf(statusCode);
	}

}</pre><p>In the preceding example, if <code class="literal">YourException</code> is thrown by a controller defined in the
same package as <code class="literal">AcmeController</code>, a JSON representation of the <code class="literal">CustomErrorType</code> POJO is
used instead of the <code class="literal">ErrorAttributes</code> representation.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-error-handling-custom-error-pages" href="#boot-features-error-handling-custom-error-pages"></a>Custom Error Pages</h4></div></div></div><p>If you want to display a custom HTML error page for a given status code, you can add a
file to an <code class="literal">/error</code> folder. Error pages can either be static HTML (that is, added under
any of the static resource folders) or be built by using templates. The name of the file
should be the exact status code or a series mask.</p><p>For example, to map <code class="literal">404</code> to a static HTML file, your folder structure would be as
follows:</p><pre class="screen">src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;</pre><p>To map all <code class="literal">5xx</code> errors by using a FreeMarker template, your folder structure would be as
follows:</p><pre class="screen">src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.ftl
             +- &lt;other templates&gt;</pre><p>For more complex mappings, you can also add beans that implement the <code class="literal">ErrorViewResolver</code>
interface, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyErrorViewResolver <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> ErrorViewResolver {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> ModelAndView resolveErrorView(HttpServletRequest request,
			HttpStatus status, Map&lt;String, Object&gt; model) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// Use the request or status to optionally return a ModelAndView</span>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> ...
	}

}</pre><p>You can also use regular Spring MVC features such as
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers" target="_top"><code class="literal">@ExceptionHandler</code> methods</a> and
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice" target="_top"><code class="literal">@ControllerAdvice</code></a>. The
<code class="literal">ErrorController</code> then picks up any unhandled exceptions.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-error-handling-mapping-error-pages-without-mvc" href="#boot-features-error-handling-mapping-error-pages-without-mvc"></a>Mapping Error Pages outside of Spring MVC</h4></div></div></div><p>For applications that do not use Spring MVC, you can use the <code class="literal">ErrorPageRegistrar</code>
interface to directly register <code class="literal">ErrorPages</code>. This abstraction works directly with the
underlying embedded servlet container and works even if you do not have a Spring MVC
<code class="literal">DispatcherServlet</code>.</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> ErrorPageRegistrar errorPageRegistrar(){
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> MyErrorPageRegistrar();
}

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyErrorPageRegistrar <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> ErrorPageRegistrar {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> registerErrorPages(ErrorPageRegistry registry) {
		registry.addErrorPages(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> ErrorPage(HttpStatus.BAD_REQUEST, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/400"</span>));
	}

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you register an <code class="literal">ErrorPage</code> with a path that ends up being handled by a <code class="literal">Filter</code>
(as is common with some non-Spring web frameworks, like Jersey and Wicket), then the
<code class="literal">Filter</code> has to be explicitly registered as an <code class="literal">ERROR</code> dispatcher, as shown in the
following example:</p></td></tr></table></div><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> FilterRegistrationBean myFilter() {
	FilterRegistrationBean registration = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> FilterRegistrationBean();
	registration.setFilter(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> MyFilter());
	...
	registration.setDispatcherTypes(EnumSet.allOf(DispatcherType.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>));
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> registration;
}</pre><p>Note that the default <code class="literal">FilterRegistrationBean</code> does not include the <code class="literal">ERROR</code> dispatcher
type.</p><p><a name="boot-features-error-handling-websphere" href="#boot-features-error-handling-websphere"></a>CAUTION:When deployed to a servlet container, Spring Boot uses its error page filter to
forward a request with an error status to the appropriate error page. The request can only
be forwarded to the correct error page if the response has not already been committed. By
default, WebSphere Application Server 8.0 and later commits the response upon successful
completion of a servlet&#8217;s service method. You should disable this behavior by setting
<code class="literal">com.ibm.ws.webcontainer.invokeFlushAfterService</code> to <code class="literal">false</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-spring-hateoas" href="#boot-features-spring-hateoas"></a>29.1.12&nbsp;Spring HATEOAS</h3></div></div></div><p>If you develop a RESTful API that makes use of hypermedia, Spring Boot provides
auto-configuration for Spring HATEOAS that works well with most applications. The
auto-configuration replaces the need to use <code class="literal">@EnableHypermediaSupport</code> and registers a
number of beans to ease building hypermedia-based applications, including a
<code class="literal">LinkDiscoverers</code> (for client side support) and an <code class="literal">ObjectMapper</code> configured to correctly
marshal responses into the desired representation. The <code class="literal">ObjectMapper</code> is customized by
setting the various <code class="literal">spring.jackson.*</code> properties or, if one exists, by a
<code class="literal">Jackson2ObjectMapperBuilder</code> bean.</p><p>You can take control of Spring HATEOAS&#8217;s configuration by using
<code class="literal">@EnableHypermediaSupport</code>. Note that doing so disables the <code class="literal">ObjectMapper</code> customization
described earlier.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-cors" href="#boot-features-cors"></a>29.1.13&nbsp;CORS Support</h3></div></div></div><p><a class="link" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_top">Cross-origin resource sharing</a>
(CORS) is a <a class="link" href="https://www.w3.org/TR/cors/" target="_top">W3C specification</a> implemented by
<a class="link" href="https://caniuse.com/#feat=cors" target="_top">most browsers</a> that lets you specify in a flexible
way what kind of cross-domain requests are authorized, instead of using some less secure
and less powerful approaches such as IFRAME or JSONP.</p><p>As of version 4.2, Spring MVC <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#cors" target="_top">supports CORS</a>.
Using <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#controller-method-cors-configuration" target="_top">controller method
CORS configuration</a> with
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html" target="_top"><code class="literal">@CrossOrigin</code></a>
annotations in your Spring Boot application does not require any specific configuration.
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#global-cors-configuration" target="_top">Global CORS configuration</a> can be
defined by registering a <code class="literal">WebMvcConfigurer</code> bean with a customized
<code class="literal">addCorsMappings(CorsRegistry)</code> method, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> WebMvcConfigurer corsConfigurer() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> WebMvcConfigurer() {
			<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> addCorsMappings(CorsRegistry registry) {
				registry.addMapping(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/api/**"</span>);
			}
		};
	}
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-webflux" href="#boot-features-webflux"></a>29.2&nbsp;The &#8220;Spring WebFlux Framework&#8221;</h2></div></div></div><p>Spring WebFlux is the new reactive web framework introduced in Spring Framework 5.0.
Unlike Spring MVC, it does not require the Servlet API, is fully asynchronous and
non-blocking, and implements the <a class="link" href="https://www.reactive-streams.org/" target="_top">Reactive Streams</a>
specification through <a class="link" href="https://projectreactor.io/" target="_top">the Reactor project</a>.</p><p>Spring WebFlux comes in two flavors: functional and annotation-based. The
annotation-based one is quite close to the Spring MVC model, as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RestController</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RequestMapping("/users")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyRestController {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@GetMapping("/{user}")</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> Mono&lt;User&gt; getUser(<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@PathVariable</xslthl:annotation> Long user) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@GetMapping("/{user}/customers")</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> Flux&lt;Customer&gt; getUserCustomers(<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@PathVariable</xslthl:annotation> Long user) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DeleteMapping("/{user}")</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> Mono&lt;User&gt; deleteUser(<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@PathVariable</xslthl:annotation> Long user) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><p>&#8220;WebFlux.fn&#8221;, the functional variant, separates the routing configuration from the
actual handling of the requests, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> RoutingConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> RouterFunction&lt;ServerResponse&gt; monoRouterFunction(UserHandler userHandler) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> route(GET(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/{user}"</span>).and(accept(APPLICATION_JSON)), userHandler::getUser)
				.andRoute(GET(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/{user}/customers"</span>).and(accept(APPLICATION_JSON)), userHandler::getUserCustomers)
				.andRoute(DELETE(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/{user}"</span>).and(accept(APPLICATION_JSON)), userHandler::deleteUser);
	}

}

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> UserHandler {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> Mono&lt;ServerResponse&gt; getUser(ServerRequest request) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> Mono&lt;ServerResponse&gt; getUserCustomers(ServerRequest request) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> Mono&lt;ServerResponse&gt; deleteUser(ServerRequest request) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}
}</pre><p>WebFlux is part of the Spring Framework and detailed information is available in its
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn" target="_top">reference documentation</a>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can define as many <code class="literal">RouterFunction</code> beans as you like to modularize the
definition of the router. Beans can be ordered if you need to apply a precedence.</p></td></tr></table></div><p>To get started, add the <code class="literal">spring-boot-starter-webflux</code> module to your application.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Adding both <code class="literal">spring-boot-starter-web</code> and <code class="literal">spring-boot-starter-webflux</code> modules in
your application results in Spring Boot auto-configuring Spring MVC, not WebFlux. This
behavior has been chosen because many Spring developers add <code class="literal">spring-boot-starter-webflux</code>
to their Spring MVC application to use the reactive <code class="literal">WebClient</code>. You can still enforce
your choice by setting the chosen application type to
<code class="literal">SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)</code>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-webflux-auto-configuration" href="#boot-features-webflux-auto-configuration"></a>29.2.1&nbsp;Spring WebFlux Auto-configuration</h3></div></div></div><p>Spring Boot provides auto-configuration for Spring WebFlux that works well with most
applications.</p><p>The auto-configuration adds the following features on top of Spring&#8217;s defaults:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring codecs for <code class="literal">HttpMessageReader</code> and <code class="literal">HttpMessageWriter</code> instances (described
<a class="link" href="boot-features-developing-web-applications.html#boot-features-webflux-httpcodecs" title="29.2.2&nbsp;HTTP Codecs with HttpMessageReaders and HttpMessageWriters">later in this document</a>).</li><li class="listitem">Support for serving static resources, including support for WebJars (described
<a class="link" href="boot-features-developing-web-applications.html#boot-features-spring-mvc-static-content" title="29.1.5&nbsp;Static Content">later in this document</a>).</li></ul></div><p>If you want to keep Spring Boot WebFlux features and you want to add additional
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#web-reactive" target="_top">WebFlux configuration</a>, you can add your own
<code class="literal">@Configuration</code> class of type <code class="literal">WebFluxConfigurer</code> but <span class="strong"><strong>without</strong></span> <code class="literal">@EnableWebFlux</code>.</p><p>If you want to take complete control of Spring WebFlux, you can add your own
<code class="literal">@Configuration</code> annotated with <code class="literal">@EnableWebFlux</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-webflux-httpcodecs" href="#boot-features-webflux-httpcodecs"></a>29.2.2&nbsp;HTTP Codecs with HttpMessageReaders and HttpMessageWriters</h3></div></div></div><p>Spring WebFlux uses the <code class="literal">HttpMessageReader</code> and <code class="literal">HttpMessageWriter</code> interfaces to convert
HTTP requests and responses. They are configured with <code class="literal">CodecConfigurer</code> to have sensible
defaults by looking at the libraries available in your classpath.</p><p>Spring Boot applies further customization by using <code class="literal">CodecCustomizer</code> instances. For
example, <code class="literal">spring.jackson.*</code> configuration keys are applied to the Jackson codec.</p><p>If you need to add or customize codecs, you can create a custom <code class="literal">CodecCustomizer</code>
component, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.web.codec.CodecCustomizer;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> CodecCustomizer myCodecCustomizer() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> codecConfigurer -&gt; {
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
		}
	}

}</pre><p>You can also leverage <a class="link" href="boot-features-developing-web-applications.html#boot-features-json-components" title="29.1.3&nbsp;Custom JSON Serializers and Deserializers">Boot&#8217;s custom JSON serializers and
deserializers</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-webflux-static-content" href="#boot-features-webflux-static-content"></a>29.2.3&nbsp;Static Content</h3></div></div></div><p>By default, Spring Boot serves static content from a directory called <code class="literal">/static</code> (or
<code class="literal">/public</code> or <code class="literal">/resources</code> or <code class="literal">/META-INF/resources</code>) in the classpath. It uses the
<code class="literal">ResourceWebHandler</code> from Spring WebFlux so that you can modify that behavior by adding
your own <code class="literal">WebFluxConfigurer</code> and overriding the <code class="literal">addResourceHandlers</code> method.</p><p>By default, resources are mapped on <code class="literal">/**</code>, but you can tune that by setting the
<code class="literal">spring.webflux.static-path-pattern</code> property. For instance, relocating all resources to
<code class="literal">/resources/**</code> can be achieved as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.webflux.static-path-pattern</span>=/resources/**</pre><p>You can also customize the static resource locations by using
<code class="literal">spring.resources.static-locations</code>. Doing so replaces the default values with a list of
directory locations. If you do so, the default welcome page detection switches to your
custom locations. So, if there is an <code class="literal">index.html</code> in any of your locations on startup, it
is the home page of the application.</p><p>In addition to the &#8220;standard&#8221; static resource locations listed earlier, a special case
is made for <a class="link" href="https://www.webjars.org/" target="_top">Webjars content</a>. Any resources with a path in
<code class="literal">/webjars/**</code> are served from jar files if they are packaged in the Webjars format.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring WebFlux applications do not strictly depend on the Servlet API, so they
cannot be deployed as war files and do not use the <code class="literal">src/main/webapp</code> directory.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-webflux-template-engines" href="#boot-features-webflux-template-engines"></a>29.2.4&nbsp;Template Engines</h3></div></div></div><p>As well as REST web services, you can also use Spring WebFlux to serve dynamic HTML
content. Spring WebFlux supports a variety of templating technologies, including
Thymeleaf, FreeMarker, and Mustache.</p><p>Spring Boot includes auto-configuration support for the following templating engines:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://freemarker.apache.org/docs/" target="_top">FreeMarker</a></li><li class="listitem"><a class="link" href="https://www.thymeleaf.org" target="_top">Thymeleaf</a></li><li class="listitem"><a class="link" href="https://mustache.github.io/" target="_top">Mustache</a></li></ul></div><p>When you use one of these templating engines with the default configuration, your
templates are picked up automatically from <code class="literal">src/main/resources/templates</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-webflux-error-handling" href="#boot-features-webflux-error-handling"></a>29.2.5&nbsp;Error Handling</h3></div></div></div><p>Spring Boot provides a <code class="literal">WebExceptionHandler</code> that handles all errors in a sensible way.
Its position in the processing order is immediately before the handlers provided by
WebFlux, which are considered last. For machine clients, it produces a JSON response
with details of the error, the HTTP status, and the exception message. For browser
clients, there is a &#8220;whitelabel&#8221; error handler that renders the same data in HTML
format. You can also provide your own HTML templates to display errors (see the
<a class="link" href="boot-features-developing-web-applications.html#boot-features-webflux-error-handling-custom-error-pages" title="Custom Error Pages">next section</a>).</p><p>The first step to customizing this feature often involves using the existing mechanism
but replacing or augmenting the error contents. For that, you can add a bean of type
<code class="literal">ErrorAttributes</code>.</p><p>To change the error handling behavior, you can implement <code class="literal">ErrorWebExceptionHandler</code> and
register a bean definition of that type. Because a <code class="literal">WebExceptionHandler</code> is quite
low-level, Spring Boot also provides a convenient <code class="literal">AbstractErrorWebExceptionHandler</code> to
let you handle errors in a WebFlux functional way, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> CustomErrorWebExceptionHandler <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> AbstractErrorWebExceptionHandler {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// Define constructor here</span>

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">protected</span> RouterFunction&lt;ServerResponse&gt; getRoutingFunction(ErrorAttributes errorAttributes) {

		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> RouterFunctions
				.route(aPredicate, aHandler)
				.andRoute(anotherPredicate, anotherHandler);
	}

}</pre><p>For a more complete picture, you can also subclass <code class="literal">DefaultErrorWebExceptionHandler</code>
directly and override specific methods.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-webflux-error-handling-custom-error-pages" href="#boot-features-webflux-error-handling-custom-error-pages"></a>Custom Error Pages</h4></div></div></div><p>If you want to display a custom HTML error page for a given status code, you can add a
file to an <code class="literal">/error</code> folder. Error pages can either be static HTML (that is, added under
any of the static resource folders) or built with templates. The name of the file should
be the exact status code or a series mask.</p><p>For example, to map <code class="literal">404</code> to a static HTML file, your folder structure would be as
follows:</p><pre class="screen">src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;</pre><p>To map all <code class="literal">5xx</code> errors by using a Mustache template, your folder structure would be as
follows:</p><pre class="screen">src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.mustache
             +- &lt;other templates&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-webflux-web-filters" href="#boot-features-webflux-web-filters"></a>29.2.6&nbsp;Web Filters</h3></div></div></div><p>Spring WebFlux provides a <code class="literal">WebFilter</code> interface that can be implemented to filter HTTP
request-response exchanges. <code class="literal">WebFilter</code> beans found in the application context will
be automatically used to filter each exchange.</p><p>Where the order of the filters is important they can implement <code class="literal">Ordered</code> or be annotated
with <code class="literal">@Order</code>. Spring Boot auto-configuration may configure web filters for you. When it
does so, the orders shown in the following table will be used:</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Web Filter</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Order</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">MetricsWebFilter</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Ordered.HIGHEST_PRECEDENCE + 1</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">WebFilterChainProxy</code> (Spring Security)</p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">-100</code></p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">HttpTraceWebFilter</code></p></td><td style="" align="left" valign="top"><p><code class="literal">Ordered.LOWEST_PRECEDENCE - 10</code></p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-jersey" href="#boot-features-jersey"></a>29.3&nbsp;JAX-RS and Jersey</h2></div></div></div><p>If you prefer the JAX-RS programming model for REST endpoints, you can use one of the
available implementations instead of Spring MVC. <a class="link" href="https://jersey.github.io/" target="_top">Jersey</a> and
<a class="link" href="https://cxf.apache.org/" target="_top">Apache CXF</a> work quite well out of the box. CXF requires you to
register its <code class="literal">Servlet</code> or <code class="literal">Filter</code> as a <code class="literal">@Bean</code> in your application context. Jersey has
some native Spring support, so we also provide auto-configuration support for it in
Spring Boot, together with a starter.</p><p>To get started with Jersey, include the <code class="literal">spring-boot-starter-jersey</code> as a dependency
and then you need one <code class="literal">@Bean</code> of type <code class="literal">ResourceConfig</code> in which you register all the
endpoints, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> JerseyConfig <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> ResourceConfig {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> JerseyConfig() {
		register(Endpoint.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>);
	}

}</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>Jersey&#8217;s support for scanning executable archives is rather limited. For example,
it cannot scan for endpoints in a package found in a <a class="link" href="deployment-install.html" title="64.&nbsp;Installing Spring Boot Applications">fully executable jar file</a> or in <code class="literal">WEB-INF/classes</code> when running an executable war file.
To avoid this limitation, the <code class="literal">packages</code> method should not be used, and endpoints should
be registered individually by using the <code class="literal">register</code> method, as shown in the preceding
example.</p></td></tr></table></div><p>For more advanced customizations, you can also register an arbitrary number of beans that
implement <code class="literal">ResourceConfigCustomizer</code>.</p><p>All the registered endpoints should be <code class="literal">@Components</code> with HTTP resource annotations
(<code class="literal">@GET</code> and others), as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Path("/hello")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Endpoint {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@GET</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> String message() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello"</span>;
	}

}</pre><p>Since the <code class="literal">Endpoint</code> is a Spring <code class="literal">@Component</code>, its lifecycle is managed by Spring and you
can use the <code class="literal">@Autowired</code> annotation to inject dependencies and use the <code class="literal">@Value</code>
annotation to inject external configuration. By default, the Jersey servlet is registered
and mapped to <code class="literal">/*</code>. You can change the mapping by adding <code class="literal">@ApplicationPath</code> to your
<code class="literal">ResourceConfig</code>.</p><p>By default, Jersey is set up as a Servlet in a <code class="literal">@Bean</code> of type <code class="literal">ServletRegistrationBean</code>
named <code class="literal">jerseyServletRegistration</code>. By default, the servlet is initialized lazily, but you
can customize that behavior by setting <code class="literal">spring.jersey.servlet.load-on-startup</code>. You can
disable or override that bean by creating one of your own with the same name. You can
also use a filter instead of a servlet by setting <code class="literal">spring.jersey.type=filter</code> (in which
case, the <code class="literal">@Bean</code> to replace or override is <code class="literal">jerseyFilterRegistration</code>). The filter has
an <code class="literal">@Order</code>, which you can set with <code class="literal">spring.jersey.filter.order</code>. Both the servlet and
the filter registrations can be given init parameters by using <code class="literal">spring.jersey.init.*</code> to
specify a map of properties.</p><p>There is a <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-samples/spring-boot-sample-jersey" target="_top">Jersey sample</a> so
that you can see how to set things up.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-embedded-container" href="#boot-features-embedded-container"></a>29.4&nbsp;Embedded Servlet Container Support</h2></div></div></div><p>Spring Boot includes support for embedded <a class="link" href="https://tomcat.apache.org/" target="_top">Tomcat</a>,
<a class="link" href="https://www.eclipse.org/jetty/" target="_top">Jetty</a>, and
<a class="link" href="https://github.com/undertow-io/undertow" target="_top">Undertow</a> servers. Most developers use the
appropriate &#8220;Starter&#8221; to obtain a fully configured instance. By default, the embedded
server listens for HTTP requests on port <code class="literal">8080</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-embedded-container-servlets-filters-listeners" href="#boot-features-embedded-container-servlets-filters-listeners"></a>29.4.1&nbsp;Servlets, Filters, and listeners</h3></div></div></div><p>When using an embedded servlet container, you can register servlets, filters, and all the
listeners (such as <code class="literal">HttpSessionListener</code>) from the Servlet spec, either by using Spring
beans or by scanning for Servlet components.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-embedded-container-servlets-filters-listeners-beans" href="#boot-features-embedded-container-servlets-filters-listeners-beans"></a>Registering Servlets, Filters, and Listeners as Spring Beans</h4></div></div></div><p>Any <code class="literal">Servlet</code>, <code class="literal">Filter</code>, or servlet <code class="literal">*Listener</code> instance that is a Spring bean is
registered with the embedded container. This can be particularly convenient if you want
to refer to a value from your <code class="literal">application.properties</code> during configuration.</p><p>By default, if the context contains only a single Servlet, it is mapped to <code class="literal">/</code>. In the
case of multiple servlet beans, the bean name is used as a path prefix. Filters map to
<code class="literal">/*</code>.</p><p>If convention-based mapping is not flexible enough, you can use the
<code class="literal">ServletRegistrationBean</code>, <code class="literal">FilterRegistrationBean</code>, and
<code class="literal">ServletListenerRegistrationBean</code> classes for complete control.</p><p>Spring Boot ships with many auto-configurations that may define Filter beans. Here are a
few examples of Filters and their respective order (lower order value means higher
precedence):</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Servlet Filter</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Order</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">OrderedCharacterEncodingFilter</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Ordered.HIGHEST_PRECEDENCE</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">WebMvcMetricsFilter</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Ordered.HIGHEST_PRECEDENCE + 1</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">ErrorPageFilter</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">Ordered.HIGHEST_PRECEDENCE + 1</code></p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">HttpTraceFilter</code></p></td><td style="" align="left" valign="top"><p><code class="literal">Ordered.LOWEST_PRECEDENCE - 10</code></p></td></tr></tbody></table></div><p>It is usually safe to leave Filter beans unordered.</p><p>If a specific order is required, you should avoid configuring a Filter that reads the
request body at <code class="literal">Ordered.HIGHEST_PRECEDENCE</code>, since it might go against the character
encoding configuration of your application. If a Servlet filter wraps the request, it
should be configured with an order that is less than or equal to
<code class="literal">OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-embedded-container-context-initializer" href="#boot-features-embedded-container-context-initializer"></a>29.4.2&nbsp;Servlet Context Initialization</h3></div></div></div><p>Embedded servlet containers do not directly execute the Servlet 3.0+
<code class="literal">javax.servlet.ServletContainerInitializer</code> interface or Spring&#8217;s
<code class="literal">org.springframework.web.WebApplicationInitializer</code> interface. This is an intentional
design decision intended to reduce the risk that third party libraries designed to run
inside a war may break Spring Boot applications.</p><p>If you need to perform servlet context initialization in a Spring Boot application, you
should register a bean that implements the
<code class="literal">org.springframework.boot.web.servlet.ServletContextInitializer</code> interface. The
single <code class="literal">onStartup</code> method provides access to the <code class="literal">ServletContext</code> and, if necessary, can
easily be used as an adapter to an existing <code class="literal">WebApplicationInitializer</code>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-embedded-container-servlets-filters-listeners-scanning" href="#boot-features-embedded-container-servlets-filters-listeners-scanning"></a>Scanning for Servlets, Filters, and listeners</h4></div></div></div><p>When using an embedded container, automatic registration of classes annotated with
<code class="literal">@WebServlet</code>, <code class="literal">@WebFilter</code>, and <code class="literal">@WebListener</code> can be enabled by using
<code class="literal">@ServletComponentScan</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><code class="literal">@ServletComponentScan</code> has no effect in a standalone container, where the
container&#8217;s built-in discovery mechanisms are used instead.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-embedded-container-application-context" href="#boot-features-embedded-container-application-context"></a>29.4.3&nbsp;The ServletWebServerApplicationContext</h3></div></div></div><p>Under the hood, Spring Boot uses a different type of <code class="literal">ApplicationContext</code> for embedded
servlet container support.  The <code class="literal">ServletWebServerApplicationContext</code> is a special type of
<code class="literal">WebApplicationContext</code> that bootstraps itself by searching for a single
<code class="literal">ServletWebServerFactory</code> bean. Usually a <code class="literal">TomcatServletWebServerFactory</code>,
<code class="literal">JettyServletWebServerFactory</code>, or <code class="literal">UndertowServletWebServerFactory</code>
has been auto-configured.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You usually do not need to be aware of these implementation classes. Most
applications are auto-configured, and the appropriate <code class="literal">ApplicationContext</code> and
<code class="literal">ServletWebServerFactory</code> are created on your behalf.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-customizing-embedded-containers" href="#boot-features-customizing-embedded-containers"></a>29.4.4&nbsp;Customizing Embedded Servlet Containers</h3></div></div></div><p>Common servlet container settings can be configured by using Spring <code class="literal">Environment</code>
properties. Usually, you would define the properties in your <code class="literal">application.properties</code>
file.</p><p>Common server settings include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Network settings: Listen port for incoming HTTP requests (<code class="literal">server.port</code>), interface
address to bind to <code class="literal">server.address</code>, and so on.</li><li class="listitem">Session settings: Whether the session is persistent (<code class="literal">server.servlet.session.persistence</code>),
session timeout (<code class="literal">server.servlet.session.timeout</code>), location of session data
(<code class="literal">server.servlet.session.store-dir</code>), and session-cookie configuration
(<code class="literal">server.servlet.session.cookie.*</code>).</li><li class="listitem">Error management: Location of the error page (<code class="literal">server.error.path</code>) and so on.</li><li class="listitem"><a class="link" href="howto-embedded-web-servers.html#howto-configure-ssl" title="78.7&nbsp;Configure SSL">SSL</a></li><li class="listitem"><a class="link" href="howto-embedded-web-servers.html#how-to-enable-http-response-compression" title="78.6&nbsp;Enable HTTP Response Compression">HTTP compression</a></li></ul></div><p>Spring Boot tries as much as possible to expose common settings, but this is not always
possible. For those cases, dedicated namespaces offer server-specific customizations (see
<code class="literal">server.tomcat</code> and <code class="literal">server.undertow</code>). For instance,
<a class="link" href="howto-embedded-web-servers.html#howto-configure-accesslogs" title="78.11&nbsp;Configure Access Logging">access logs</a> can be configured with specific
features of the embedded servlet container.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>See the
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_top"><code class="literal">ServerProperties</code></a> class
for a complete list.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-programmatic-embedded-container-customization" href="#boot-features-programmatic-embedded-container-customization"></a>Programmatic Customization</h4></div></div></div><p>If you need to programmatically configure your embedded servlet container, you can
register a Spring bean that implements the <code class="literal">WebServerFactoryCustomizer</code> interface.
<code class="literal">WebServerFactoryCustomizer</code> provides access to the
<code class="literal">ConfigurableServletWebServerFactory</code>, which includes numerous customization setter
methods. The following example shows programmatically setting the port:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.stereotype.Component;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> CustomizationBean <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> customize(ConfigurableServletWebServerFactory server) {
		server.setPort(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">9000</xslthl:number>);
	}

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">TomcatServletWebServerFactory</code>, <code class="literal">JettyServletWebServerFactory</code> and <code class="literal">UndertowServletWebServerFactory</code>
are dedicated variants of <code class="literal">ConfigurableServletWebServerFactory</code> that have additional customization setter methods
for Tomcat, Jetty and Undertow respectively.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-customizing-configurableservletwebserverfactory-directly" href="#boot-features-customizing-configurableservletwebserverfactory-directly"></a>Customizing ConfigurableServletWebServerFactory Directly</h4></div></div></div><p>If the preceding customization techniques are too limited, you can register the
<code class="literal">TomcatServletWebServerFactory</code>, <code class="literal">JettyServletWebServerFactory</code>, or
<code class="literal">UndertowServletWebServerFactory</code> bean yourself.</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> ConfigurableServletWebServerFactory webServerFactory() {
	TomcatServletWebServerFactory factory = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> TomcatServletWebServerFactory();
	factory.setPort(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">9000</xslthl:number>);
	factory.setSessionTimeout(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">10</xslthl:number>, TimeUnit.MINUTES);
	factory.addErrorPages(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> ErrorPage(HttpStatus.NOT_FOUND, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/notfound.html"</span>));
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> factory;
}</pre><p>Setters are provided for many configuration options. Several protected method &#8220;hooks&#8221;
are also provided should you need to do something more exotic. See the
<a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/web/servlet/server/ConfigurableServletWebServerFactory.html" target="_top">source
code documentation</a> for details.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-jsp-limitations" href="#boot-features-jsp-limitations"></a>29.4.5&nbsp;JSP Limitations</h3></div></div></div><p>When running a Spring Boot application that uses an embedded servlet container (and is
packaged as an executable archive), there are some limitations in the JSP support.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">With Jetty and Tomcat, it should work if you use war packaging. An executable war will
work when launched with <code class="literal">java -jar</code>, and will also be deployable to any standard
container. JSPs are not supported when using an executable jar.</li><li class="listitem">Undertow does not support JSPs.</li><li class="listitem">Creating a custom <code class="literal">error.jsp</code> page does not override the default view for
<a class="link" href="boot-features-developing-web-applications.html#boot-features-error-handling" title="29.1.11&nbsp;Error Handling">error handling</a>.
<a class="link" href="boot-features-developing-web-applications.html#boot-features-error-handling-custom-error-pages" title="Custom Error Pages">Custom error pages</a> should be used
instead.</li></ul></div><p>There is a <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-samples/spring-boot-sample-web-jsp" target="_top">JSP sample</a> so
that you can see how to set things up.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-reactive-server" href="#boot-features-reactive-server"></a>29.5&nbsp;Embedded Reactive Server Support</h2></div></div></div><p>Spring Boot includes support for the following embedded reactive web servers:
Reactor Netty, Tomcat, Jetty, and Undertow. Most developers use the appropriate &#8220;Starter&#8221;
to obtain a fully configured instance. By default, the embedded server listens for HTTP
requests on port 8080.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-reactive-server-resources" href="#boot-features-reactive-server-resources"></a>29.6&nbsp;Reactive Server Resources Configuration</h2></div></div></div><p>When auto-configuring a Reactor Netty or Jetty server, Spring Boot will create specific
beans that will provide HTTP resources to the server instance: <code class="literal">ReactorResourceFactory</code>
or <code class="literal">JettyResourceFactory</code>.</p><p>By default, those resources will be also shared with the Reactor Netty and Jetty clients
for optimal performances, given:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">the same technology is used for server and client</li><li class="listitem">the client instance is built using the <code class="literal">WebClient.Builder</code> bean auto-configured by
Spring Boot</li></ul></div><p>Developers can override the resource configuration for Jetty and Reactor Netty by providing
a custom <code class="literal">ReactorResourceFactory</code> or <code class="literal">JettyResourceFactory</code> bean - this will be applied to
both clients and servers.</p><p>You can learn more about the resource configuration on the client side in the
<a class="link" href="boot-features-webclient.html#boot-features-webclient-runtime" title="36.1&nbsp;WebClient Runtime">WebClient Runtime section</a>.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="boot-features-json.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="boot-features.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="boot-features-security.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">28.&nbsp;JSON&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;30.&nbsp;Security</td></tr></table></div></body></html>