<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>57.&nbsp;Metrics</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="production-ready.html" title="Part&nbsp;V.&nbsp;Spring Boot Actuator: Production-ready features"><link rel="prev" href="production-ready-loggers.html" title="56.&nbsp;Loggers"><link rel="next" href="production-ready-auditing.html" title="58.&nbsp;Auditing"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">57.&nbsp;Metrics</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="production-ready-loggers.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;V.&nbsp;Spring Boot Actuator: Production-ready features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="production-ready-auditing.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="production-ready-metrics" href="#production-ready-metrics"></a>57.&nbsp;Metrics</h2></div></div></div><p>Spring Boot Actuator provides dependency management and auto-configuration for
<a class="link" href="https://micrometer.io" target="_top">Micrometer</a>, an application metrics facade that supports numerous
monitoring systems, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-appoptics" title="57.2.1&nbsp;AppOptics">AppOptics</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-atlas" title="57.2.2&nbsp;Atlas">Atlas</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-datadog" title="57.2.3&nbsp;Datadog">Datadog</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-dynatrace" title="57.2.4&nbsp;Dynatrace">Dynatrace</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-elastic" title="57.2.5&nbsp;Elastic">Elastic</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-ganglia" title="57.2.6&nbsp;Ganglia">Ganglia</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-graphite" title="57.2.7&nbsp;Graphite">Graphite</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-humio" title="57.2.8&nbsp;Humio">Humio</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-influx" title="57.2.9&nbsp;Influx">Influx</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-jmx" title="57.2.10&nbsp;JMX">JMX</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-kairos" title="57.2.11&nbsp;KairosDB">KairosDB</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-newrelic" title="57.2.12&nbsp;New Relic">New Relic</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-prometheus" title="57.2.13&nbsp;Prometheus">Prometheus</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-signalfx" title="57.2.14&nbsp;SignalFx">SignalFx</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-simple" title="57.2.15&nbsp;Simple">Simple (in-memory)</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-statsd" title="57.2.16&nbsp;StatsD">StatsD</a></li><li class="listitem"><a class="link" href="production-ready-metrics.html#production-ready-metrics-export-wavefront" title="57.2.17&nbsp;Wavefront">Wavefront</a></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>To learn more about Micrometer&#8217;s capabilities, please refer to its
<a class="link" href="https://micrometer.io/docs" target="_top">reference documentation</a>, in particular the
<a class="link" href="https://micrometer.io/docs/concepts" target="_top">concepts section</a>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-metrics-getting-started" href="#production-ready-metrics-getting-started"></a>57.1&nbsp;Getting started</h2></div></div></div><p>Spring Boot auto-configures a composite <code class="literal">MeterRegistry</code> and adds a registry to the
composite for each of the supported implementations that it finds on the classpath. Having
a dependency on <code class="literal">micrometer-registry-{system}</code> in your runtime classpath is enough for
Spring Boot to configure the registry.</p><p>Most registries share common features. For instance, you can disable a particular registry
even if the Micrometer registry implementation is on the classpath. For instance, to
disable Datadog:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.datadog.enabled</span>=false</pre><p>Spring Boot will also add any auto-configured registries to the global static composite
registry on the <code class="literal">Metrics</code> class unless you explicitly tell it not to:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.use-global-registry</span>=false</pre><p>You can register any number of <code class="literal">MeterRegistryCustomizer</code> beans to further configure the
registry, such as applying common tags, before any meters are registered with the
registry:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
MeterRegistryCustomizer&lt;MeterRegistry&gt; metricsCommonTags() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> registry -&gt; registry.config().commonTags(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"region"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"us-east-1"</span>);
}</pre><p>You can apply customizations to particular registry implementations by being more specific
about the generic type:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
MeterRegistryCustomizer&lt;GraphiteMeterRegistry&gt; graphiteMetricsNamingConvention() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> registry -&gt; registry.config().namingConvention(MY_CUSTOM_CONVENTION);
}</pre><p>With that setup in place you can inject <code class="literal">MeterRegistry</code> in your components and register
metrics:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> SampleBean {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">final</span> Counter counter;

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> SampleBean(MeterRegistry registry) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.counter = registry.counter(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"received.messages"</span>);
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> handleMessage(String message) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.counter.increment();
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// handle message implementation</span>
	}

}</pre><p>Spring Boot also <a class="link" href="production-ready-metrics.html#production-ready-metrics-meter" title="57.3&nbsp;Supported Metrics">configures built-in instrumentation</a>
(i.e. <code class="literal">MeterBinder</code> implementations) that you can control via configuration or dedicated
annotation markers.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-metrics-export" href="#production-ready-metrics-export"></a>57.2&nbsp;Supported monitoring systems</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-appoptics" href="#production-ready-metrics-export-appoptics"></a>57.2.1&nbsp;AppOptics</h3></div></div></div><p>By default, the AppOptics registry pushes metrics to
<a class="link" href="https://api.appoptics.com/v1/measurements" target="_top">api.appoptics.com/v1/measurements</a> periodically. To export metrics to SaaS
<a class="link" href="https://micrometer.io/docs/registry/appoptics" target="_top">AppOptics</a>, your API token must be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.appoptics.api-token</span>=YOUR_TOKEN</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-atlas" href="#production-ready-metrics-export-atlas"></a>57.2.2&nbsp;Atlas</h3></div></div></div><p>By default, metrics are exported to <a class="link" href="https://micrometer.io/docs/registry/atlas" target="_top">Atlas</a>
running on your local machine. The location of the
<a class="link" href="https://github.com/Netflix/atlas" target="_top">Atlas server</a> to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.atlas.uri</span>=https://atlas.example.com:7101/api/v1/publish</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-datadog" href="#production-ready-metrics-export-datadog"></a>57.2.3&nbsp;Datadog</h3></div></div></div><p>Datadog registry pushes metrics to <a class="link" href="https://www.datadoghq.com" target="_top">datadoghq</a> periodically. To
export metrics to <a class="link" href="https://micrometer.io/docs/registry/datadog" target="_top">Datadog</a>, your API key must
be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.datadog.api-key</span>=YOUR_KEY</pre><p>You can also change the interval at which metrics are sent to Datadog:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.datadog.step</span>=30s</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-dynatrace" href="#production-ready-metrics-export-dynatrace"></a>57.2.4&nbsp;Dynatrace</h3></div></div></div><p>Dynatrace registry pushes metrics to the configured URI periodically. To export metrics to
<a class="link" href="https://micrometer.io/docs/registry/dynatrace" target="_top">Dynatrace</a>, your API token, device ID, and
URI must be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.dynatrace.api-token</span>=YOUR_TOKEN
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.dynatrace.device-id</span>=YOUR_DEVICE_ID
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.dynatrace.uri</span>=YOUR_URI</pre><p>You can also change the interval at which metrics are sent to Dynatrace:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.dynatrace.step</span>=30s</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-elastic" href="#production-ready-metrics-export-elastic"></a>57.2.5&nbsp;Elastic</h3></div></div></div><p>By default, metrics are exported to <a class="link" href="https://micrometer.io/docs/registry/elastic" target="_top">Elastic</a>
running on your local machine. The location of the Elastic server to use can be provided
using the following property:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.elastic.host</span>=https://elastic.example.com:8086</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-ganglia" href="#production-ready-metrics-export-ganglia"></a>57.2.6&nbsp;Ganglia</h3></div></div></div><p>By default, metrics are exported to <a class="link" href="https://micrometer.io/docs/registry/ganglia" target="_top">Ganglia</a>
running on your local machine. The <a class="link" href="http://ganglia.sourceforge.net" target="_top">Ganglia server</a> host and
port to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.ganglia.host</span>=ganglia.example.com
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.ganglia.port</span>=9649</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-graphite" href="#production-ready-metrics-export-graphite"></a>57.2.7&nbsp;Graphite</h3></div></div></div><p>By default, metrics are exported to <a class="link" href="https://micrometer.io/docs/registry/graphite" target="_top">Graphite</a>
running on your local machine. The <a class="link" href="https://graphiteapp.org" target="_top">Graphite server</a> host and port
to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.graphite.host</span>=graphite.example.com
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.graphite.port</span>=9004</pre><p>Micrometer provides a default <code class="literal">HierarchicalNameMapper</code> that governs how a dimensional
meter id is <a class="link" href="https://micrometer.io/docs/registry/graphite#_hierarchical_name_mapping" target="_top">mapped
to flat hierarchical names</a>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>To take control over this behaviour, define your <code class="literal">GraphiteMeterRegistry</code> and supply
your own <code class="literal">HierarchicalNameMapper</code>. An auto-configured <code class="literal">GraphiteConfig</code> and <code class="literal">Clock</code> beans
are provided unless you define your own:</p></td></tr></table></div><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> GraphiteMeterRegistry graphiteMeterRegistry(GraphiteConfig config, Clock clock) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> GraphiteMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-humio" href="#production-ready-metrics-export-humio"></a>57.2.8&nbsp;Humio</h3></div></div></div><p>By default, the Humio registry pushes metrics to <a class="link" href="https://cloud.humio.com" target="_top">cloud.humio.com</a> periodically. To
export metrics to SaaS <a class="link" href="https://micrometer.io/docs/registry/humio" target="_top">Humio</a>, your API token
must be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.humio.api-token</span>=YOUR_TOKEN</pre><p>You should also configure one or more tags to identify the data source to which metrics
will be pushed:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.humio.tags.alpha</span>=a
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.humio.tags.bravo</span>=b</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-influx" href="#production-ready-metrics-export-influx"></a>57.2.9&nbsp;Influx</h3></div></div></div><p>By default, metrics are exported to <a class="link" href="https://micrometer.io/docs/registry/influx" target="_top">Influx</a>
running on your local machine. The location of the <a class="link" href="https://www.influxdata.com" target="_top">Influx
server</a> to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.influx.uri</span>=https://influx.example.com:8086</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-jmx" href="#production-ready-metrics-export-jmx"></a>57.2.10&nbsp;JMX</h3></div></div></div><p>Micrometer provides a hierarchical mapping to
<a class="link" href="https://micrometer.io/docs/registry/jmx" target="_top">JMX</a>, primarily as a cheap and portable way to
view metrics locally. By default, metrics are exported to the <code class="literal">metrics</code> JMX domain. The
domain to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.jmx.domain</span>=com.example.app.metrics</pre><p>Micrometer provides a default <code class="literal">HierarchicalNameMapper</code> that governs how a dimensional
meter id is <a class="link" href="https://micrometer.io/docs/registry/jmx#_hierarchical_name_mapping" target="_top">mapped to
flat hierarchical names</a>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>To take control over this behaviour, define your <code class="literal">JmxMeterRegistry</code> and supply your
own <code class="literal">HierarchicalNameMapper</code>. An auto-configured <code class="literal">JmxConfig</code> and <code class="literal">Clock</code> beans are
provided unless you define your own:</p></td></tr></table></div><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> JmxMeterRegistry jmxMeterRegistry(JmxConfig config, Clock clock) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> JmxMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-kairos" href="#production-ready-metrics-export-kairos"></a>57.2.11&nbsp;KairosDB</h3></div></div></div><p>By default, metrics are exported to <a class="link" href="https://micrometer.io/docs/registry/kairos" target="_top">KairosDB</a>
running on your local machine. The location of the <a class="link" href="https://kairosdb.github.io/" target="_top">KairosDB
server</a> to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.kairos.uri</span>=https://kairosdb.example.com:8080/api/v1/datapoints</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-newrelic" href="#production-ready-metrics-export-newrelic"></a>57.2.12&nbsp;New Relic</h3></div></div></div><p>New Relic registry pushes metrics to <a class="link" href="https://micrometer.io/docs/registry/new-relic" target="_top">New
Relic</a> periodically. To export metrics to <a class="link" href="https://newrelic.com" target="_top">New Relic</a>, your API key
and account id must be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.newrelic.api-key</span>=YOUR_KEY
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.newrelic.account-id</span>=YOUR_ACCOUNT_ID</pre><p>You can also change the interval at which metrics are sent to New Relic:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.newrelic.step</span>=30s</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-prometheus" href="#production-ready-metrics-export-prometheus"></a>57.2.13&nbsp;Prometheus</h3></div></div></div><p><a class="link" href="https://micrometer.io/docs/registry/prometheus" target="_top">Prometheus</a> expects to scrape or poll
individual app instances for metrics. Spring Boot provides an actuator endpoint available
at <code class="literal">/actuator/prometheus</code> to present a <a class="link" href="https://prometheus.io" target="_top">Prometheus scrape</a> with the
appropriate format.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The endpoint is not available by default and must be exposed, see
<a class="link" href="production-ready-endpoints.html#production-ready-endpoints-exposing-endpoints" title="53.2&nbsp;Exposing Endpoints">exposing endpoints</a> for more details.</p></td></tr></table></div><p>Here is an example <code class="literal">scrape_config</code> to add to <code class="literal">prometheus.yml</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">scrape_configs</span>:
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">  - job_name</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'spring'</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">	metrics_path</span>: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'/actuator/prometheus'</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">	static_configs</span>:
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">	  - targets</span>: [<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'HOST:PORT'</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">]</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-signalfx" href="#production-ready-metrics-export-signalfx"></a>57.2.14&nbsp;SignalFx</h3></div></div></div><p>SignalFx registry pushes metrics to <a class="link" href="https://micrometer.io/docs/registry/signalfx" target="_top">SignalFx</a>
periodically. To export metrics to <a class="link" href="https://signalfx.com" target="_top">SignalFx</a>, your access token must
be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.signalfx.access-token</span>=YOUR_ACCESS_TOKEN</pre><p>You can also change the interval at which metrics are sent to SignalFx:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.signalfx.step</span>=30s</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-simple" href="#production-ready-metrics-export-simple"></a>57.2.15&nbsp;Simple</h3></div></div></div><p>Micrometer ships with a simple, in-memory backend that is automatically used as a fallback
if no other registry is configured. This allows you to see what metrics are collected in
the <a class="link" href="production-ready-metrics.html#production-ready-metrics-endpoint" title="57.6&nbsp;Metrics endpoint">metrics endpoint</a>.</p><p>The in-memory backend disables itself as soon as you&#8217;re using any of the other available
backend. You can also disable it explicitly:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.simple.enabled</span>=false</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-statsd" href="#production-ready-metrics-export-statsd"></a>57.2.16&nbsp;StatsD</h3></div></div></div><p>The StatsD registry pushes metrics over UDP to a StatsD agent eagerly. By default, metrics
are exported to a <a class="link" href="https://micrometer.io/docs/registry/statsd" target="_top">StatsD</a> agent running on your
local machine. The StatsD agent host and port to use can be provided using:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.statsd.host</span>=statsd.example.com
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.statsd.port</span>=9125</pre><p>You can also change the StatsD line protocol to use (default to Datadog):</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.statsd.flavor</span>=etsy</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-export-wavefront" href="#production-ready-metrics-export-wavefront"></a>57.2.17&nbsp;Wavefront</h3></div></div></div><p>Wavefront registry pushes metrics to
<a class="link" href="https://micrometer.io/docs/registry/wavefront" target="_top">Wavefront</a> periodically. If you are
exporting metrics to <a class="link" href="https://www.wavefront.com/" target="_top">Wavefront</a> directly, your API token must
be provided:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.wavefront.api-token</span>=YOUR_API_TOKEN</pre><p>Alternatively, you may use a Wavefront sidecar or an internal proxy set up in your
environment that forwards metrics data to the Wavefront API host:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.wavefront.uri</span>=proxy://localhost:2878</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If publishing metrics to a Wavefront proxy (as described in
<a class="link" href="https://docs.wavefront.com/proxies_installing.html" target="_top">the documentation</a>), the host must be
in the <code class="literal">proxy://HOST:PORT</code> format.</p></td></tr></table></div><p>You can also change the interval at which metrics are sent to Wavefront:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.export.wavefront.step</span>=30s</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-metrics-meter" href="#production-ready-metrics-meter"></a>57.3&nbsp;Supported Metrics</h2></div></div></div><p>Spring Boot registers the following core metrics when applicable:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">JVM metrics, report utilization of:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Various memory and buffer pools</li><li class="listitem">Statistics related to garbage collection</li><li class="listitem">Threads utilization</li><li class="listitem">Number of classes loaded/unloaded</li></ul></div></li><li class="listitem">CPU metrics</li><li class="listitem">File descriptor metrics</li><li class="listitem">Kafka consumer metrics</li><li class="listitem">Log4j2 metrics: record the number of events logged to Log4j2 at each level</li><li class="listitem">Logback metrics: record the number of events logged to Logback at each level</li><li class="listitem">Uptime metrics: report a gauge for uptime and a fixed gauge representing the
application&#8217;s absolute start time</li><li class="listitem">Tomcat metrics</li><li class="listitem"><a class="link" href="https://docs.spring.io/spring-integration/docs/current/reference/html/system-management-chapter.html#micrometer-integration" target="_top">Spring Integration</a> metrics</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-spring-mvc" href="#production-ready-metrics-spring-mvc"></a>57.3.1&nbsp;Spring MVC Metrics</h3></div></div></div><p>Auto-configuration enables the instrumentation of requests handled by Spring MVC. When
<code class="literal">management.metrics.web.server.auto-time-requests</code> is <code class="literal">true</code>, this instrumentation occurs
for all requests. Alternatively, when set to <code class="literal">false</code>, you can enable instrumentation by
adding <code class="literal">@Timed</code> to a request-handling method:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RestController</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Timed</xslthl:annotation> <a name="CO1-1" href="#CO1-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyController {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@GetMapping("/api/people")</xslthl:annotation>
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Timed(extraTags = { "region", "us-east-1" })</xslthl:annotation> <a name="CO1-2" href="#CO1-2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Timed(value = "all.people", longTask = true)</xslthl:annotation> <a name="CO1-3" href="#CO1-3"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> List&lt;Person&gt; listPeople() { ... }

}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>A controller class to enable timings on every request handler in the controller.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>A method to enable for an individual endpoint. This is not necessary if you have it on
the class, but can be used to further customize the timer for this particular endpoint.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-3"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>A method with <code class="literal">longTask = true</code> to enable a long task timer for the method. Long task
timers require a separate metric name, and can be stacked with a short task timer.</p></td></tr></table></div><p>By default, metrics are generated with the name, <code class="literal">http.server.requests</code>. The name can be
customized by setting the <code class="literal">management.metrics.web.server.requests-metric-name</code> property.</p><p>By default, Spring MVC-related metrics are tagged with the following information:</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Tag</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">exception</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Simple class name of any exception that was thrown while handling the request.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Request&#8217;s method (for example, <code class="literal">GET</code> or <code class="literal">POST</code>)</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">outcome</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Request&#8217;s outcome based on the status code of the response. 1xx is
<code class="literal">INFORMATIONAL</code>, 2xx is <code class="literal">SUCCESS</code>, 3xx is <code class="literal">REDIRECTION</code>, 4xx <code class="literal">CLIENT_ERROR</code>, and 5xx is
<code class="literal">SERVER_ERROR</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">status</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Response&#8217;s HTTP status code (for example, <code class="literal">200</code> or <code class="literal">500</code>)</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">uri</code></p></td><td style="" align="left" valign="top"><p>Request&#8217;s URI template prior to variable substitution, if possible (for example,
<code class="literal">/api/person/{id}</code>)</p></td></tr></tbody></table></div><p>To customize the tags, provide a <code class="literal">@Bean</code> that implements <code class="literal">WebMvcTagsProvider</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-web-flux" href="#production-ready-metrics-web-flux"></a>57.3.2&nbsp;Spring WebFlux Metrics</h3></div></div></div><p>Auto-configuration enables the instrumentation of all requests handled by WebFlux
controllers and functional handlers.</p><p>By default, metrics are generated with the name <code class="literal">http.server.requests</code>. You can customize
the name by setting the <code class="literal">management.metrics.web.server.requests-metric-name</code> property.</p><p>By default, WebFlux-related metrics are tagged with the following information:</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Tag</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">exception</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Simple class name of any exception that was thrown while handling the request.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Request&#8217;s method (for example, <code class="literal">GET</code> or <code class="literal">POST</code>)</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">outcome</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Request&#8217;s outcome based on the status code of the response. 1xx is
<code class="literal">INFORMATIONAL</code>, 2xx is <code class="literal">SUCCESS</code>, 3xx is <code class="literal">REDIRECTION</code>, 4xx <code class="literal">CLIENT_ERROR</code>, and 5xx is
<code class="literal">SERVER_ERROR</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">status</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Response&#8217;s HTTP status code (for example, <code class="literal">200</code> or <code class="literal">500</code>)</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">uri</code></p></td><td style="" align="left" valign="top"><p>Request&#8217;s URI template prior to variable substitution, if possible (for example,
<code class="literal">/api/person/{id}</code>)</p></td></tr></tbody></table></div><p>To customize the tags, provide a <code class="literal">@Bean</code> that implements <code class="literal">WebFluxTagsProvider</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-jersey-server" href="#production-ready-metrics-jersey-server"></a>57.3.3&nbsp;Jersey Server Metrics</h3></div></div></div><p>Auto-configuration enables the instrumentation of requests handled by the Jersey JAX-RS
implementation. When <code class="literal">management.metrics.web.server.auto-time-requests</code> is <code class="literal">true</code>, this
instrumentation occurs for all requests. Alternatively, when set to <code class="literal">false</code>, you can
enable instrumentation by adding <code class="literal">@Timed</code> to a request-handling method:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Path("/api/people")</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Timed</xslthl:annotation> <a name="CO2-1" href="#CO2-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Endpoint {
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@GET</xslthl:annotation>
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Timed(extraTags = { "region", "us-east-1" })</xslthl:annotation> <a name="CO2-2" href="#CO2-2"></a><span><img src="images/callouts/2.png" alt="2" border="0"></span>
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Timed(value = "all.people", longTask = true)</xslthl:annotation> <a name="CO2-3" href="#CO2-3"></a><span><img src="images/callouts/3.png" alt="3" border="0"></span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> List&lt;Person&gt; listPeople() { ... }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>On a resource class to enable timings on every request handler in the resource.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-2"><span><img src="images/callouts/2.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left"><p>On a method to enable for an individual endpoint. This is not necessary if you have it on
the class, but can be used to further customize the timer for this particular endpoint.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-3"><span><img src="images/callouts/3.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left"><p>On a method with <code class="literal">longTask = true</code> to enable a long task timer for the method. Long task
timers require a separate metric name, and can be stacked with a short task timer.</p></td></tr></table></div><p>By default, metrics are generated with the name, <code class="literal">http.server.requests</code>. The name can be
customized by setting the <code class="literal">management.metrics.web.server.requests-metric-name</code> property.</p><p>By default, Jersey server metrics are tagged with the following information:</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Tag</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">exception</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Simple class name of any exception that was thrown while handling the request.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">method</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Request&#8217;s method (for example, <code class="literal">GET</code> or <code class="literal">POST</code>)</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">outcome</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Request&#8217;s outcome based on the status code of the response. 1xx is
<code class="literal">INFORMATIONAL</code>, 2xx is <code class="literal">SUCCESS</code>, 3xx is <code class="literal">REDIRECTION</code>, 4xx <code class="literal">CLIENT_ERROR</code>, and 5xx is
<code class="literal">SERVER_ERROR</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">status</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Response&#8217;s HTTP status code (for example, <code class="literal">200</code> or <code class="literal">500</code>)</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">uri</code></p></td><td style="" align="left" valign="top"><p>Request&#8217;s URI template prior to variable substitution, if possible (for example,
<code class="literal">/api/person/{id}</code>)</p></td></tr></tbody></table></div><p>To customize the tags, provide a <code class="literal">@Bean</code> that implements <code class="literal">JerseyTagsProvider</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-http-clients" href="#production-ready-metrics-http-clients"></a>57.3.4&nbsp;HTTP Client Metrics</h3></div></div></div><p>Spring Boot Actuator manages the instrumentation of both <code class="literal">RestTemplate</code> and <code class="literal">WebClient</code>.
For that, you have to get injected with an auto-configured builder
and use it to create instances:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">RestTemplateBuilder</code> for <code class="literal">RestTemplate</code></li><li class="listitem"><code class="literal">WebClient.Builder</code> for <code class="literal">WebClient</code></li></ul></div><p>It is also possible to apply manually the customizers responsible for this instrumentation,
namely <code class="literal">MetricsRestTemplateCustomizer</code> and <code class="literal">MetricsWebClientCustomizer</code>.</p><p>By default, metrics are generated with the name, <code class="literal">http.client.requests</code>. The name can be
customized by setting the <code class="literal">management.metrics.web.client.requests-metric-name</code> property.</p><p>By default, metrics generated by an instrumented client are tagged with the
following information:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">method</code>, the request&#8217;s method (for example, <code class="literal">GET</code> or <code class="literal">POST</code>).</li><li class="listitem"><code class="literal">uri</code>,  the request&#8217;s URI template prior to variable substitution, if possible (for
example, <code class="literal">/api/person/{id}</code>).</li><li class="listitem"><code class="literal">status</code>, the response&#8217;s HTTP status code (for example, <code class="literal">200</code> or <code class="literal">500</code>).</li><li class="listitem"><code class="literal">clientName</code>, the host portion of the URI.</li></ul></div><p>To customize the tags, and depending on your choice of client, you can provide
a <code class="literal">@Bean</code> that implements <code class="literal">RestTemplateExchangeTagsProvider</code> or
<code class="literal">WebClientExchangeTagsProvider</code>. There are convenience static functions in
<code class="literal">RestTemplateExchangeTags</code> and <code class="literal">WebClientExchangeTags</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-cache" href="#production-ready-metrics-cache"></a>57.3.5&nbsp;Cache Metrics</h3></div></div></div><p>Auto-configuration enables the instrumentation of all available <code class="literal">Cache</code>s on startup
with metrics prefixed with <code class="literal">cache</code>. Cache instrumentation is standardized for a basic set
of metrics. Additional, cache-specific metrics are also available.</p><p>The following cache libraries are supported:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Caffeine</li><li class="listitem">EhCache 2</li><li class="listitem">Hazelcast</li><li class="listitem">Any compliant JCache (JSR-107) implementation</li></ul></div><p>Metrics are tagged by the name of the cache and by the name of the <code class="literal">CacheManager</code> that is
derived from the bean name.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Only caches that are available on startup are bound to the registry. For caches
created on-the-fly or programmatically after the startup phase, an explicit registration
is required. A <code class="literal">CacheMetricsRegistrar</code> bean is made available to make that process easier.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-jdbc" href="#production-ready-metrics-jdbc"></a>57.3.6&nbsp;DataSource Metrics</h3></div></div></div><p>Auto-configuration enables the instrumentation of all available <code class="literal">DataSource</code> objects with
a metric named <code class="literal">jdbc</code>. Data source instrumentation results in gauges representing the
currently active, maximum allowed, and minimum allowed connections in the pool. Each of
these gauges has a name that is prefixed by <code class="literal">jdbc</code>.</p><p>Metrics are also tagged by the name of the <code class="literal">DataSource</code> computed based on the bean name.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>By default, Spring Boot provides metadata for all supported data sources; you can
add additional <code class="literal">DataSourcePoolMetadataProvider</code> beans if your favorite data source isn&#8217;t
supported out of the box. See <code class="literal">DataSourcePoolMetadataProvidersConfiguration</code> for examples.</p></td></tr></table></div><p>Also, Hikari-specific metrics are exposed with a <code class="literal">hikaricp</code> prefix. Each metric is tagged
by the name of the Pool (can be controlled with <code class="literal">spring.datasource.name</code>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-hibernate" href="#production-ready-metrics-hibernate"></a>57.3.7&nbsp;Hibernate Metrics</h3></div></div></div><p>Auto-configuration enables the instrumentation of all available Hibernate
<code class="literal">EntityManagerFactory</code> instances that have statistics enabled with a metric named
<code class="literal">hibernate</code>.</p><p>Metrics are also tagged by the name of the <code class="literal">EntityManagerFactory</code> that is derived from
the bean name.</p><p>To enable statistics, the standard JPA property <code class="literal">hibernate.generate_statistics</code> must be
set to <code class="literal">true</code>. You can enable that on the auto-configured <code class="literal">EntityManagerFactory</code> as shown
in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.jpa.properties.hibernate.generate_statistics</span>=true</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-rabbitmq" href="#production-ready-metrics-rabbitmq"></a>57.3.8&nbsp;RabbitMQ Metrics</h3></div></div></div><p>Auto-configuration will enable the instrumentation of all available RabbitMQ connection
factories with a metric named <code class="literal">rabbitmq</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-metrics-custom" href="#production-ready-metrics-custom"></a>57.4&nbsp;Registering custom metrics</h2></div></div></div><p>To register custom metrics, inject <code class="literal">MeterRegistry</code> into your component, as shown in the
following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Dictionary {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">final</span> List&lt;String&gt; words = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> CopyOnWriteArrayList&lt;&gt;();

	Dictionary(MeterRegistry registry) {
		registry.gaugeCollectionSize(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"dictionary.size"</span>, Tags.empty(), <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.words);
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// &#8230;</span>

}</pre><p>If you find that you repeatedly instrument a suite of metrics across components or
applications, you may encapsulate this suite in a <code class="literal">MeterBinder</code> implementation. By
default, metrics from all <code class="literal">MeterBinder</code> beans will be automatically bound to
the Spring-managed <code class="literal">MeterRegistry</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-metrics-per-meter-properties" href="#production-ready-metrics-per-meter-properties"></a>57.5&nbsp;Customizing individual metrics</h2></div></div></div><p>If you need to apply customizations to specific <code class="literal">Meter</code> instances you can use the
<code class="literal">io.micrometer.core.instrument.config.MeterFilter</code> interface. By default, all
<code class="literal">MeterFilter</code> beans will be automatically applied to the micrometer
<code class="literal">MeterRegistry.Config</code>.</p><p>For example, if you want to rename the <code class="literal">mytag.region</code> tag to <code class="literal">mytag.area</code> for
all meter IDs beginning with <code class="literal">com.example</code>, you can do the following:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> MeterFilter renameRegionTagMeterFilter() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> MeterFilter.renameTag(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"com.example"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"mytag.region"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"mytag.area"</span>);
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="production-ready-metrics-common-tags" href="#production-ready-metrics-common-tags"></a>57.5.1&nbsp;Common tags</h3></div></div></div><p>Common tags are generally used for dimensional drill-down on the operating environment like
host, instance, region, stack, etc. Commons tags are applied to all meters and can be
configured as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.tags.region</span>=us-east-1
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.tags.stack</span>=prod</pre><p>The example above adds <code class="literal">region</code> and <code class="literal">stack</code> tags to all meters with a value of
<code class="literal">us-east-1</code> and <code class="literal">prod</code> respectively.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The order of common tags is important if you are using Graphite. As the order of
common tags cannot be guaranteed using this approach, Graphite users are advised to define
a custom <code class="literal">MeterFilter</code> instead.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_per_meter_properties" href="#_per_meter_properties"></a>57.5.2&nbsp;Per-meter properties</h3></div></div></div><p>In addition to <code class="literal">MeterFilter</code> beans, it&#8217;s also possible to apply a limited set of
customization on a per-meter basis using properties. Per-meter customizations apply to
any all meter IDs that start with the given name. For example, the following will disable
any meters that have an ID starting with <code class="literal">example.remote</code></p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.metrics.enable.example.remote</span>=false</pre><p>The following properties allow per-meter customization:</p><div class="table"><a name="d0e18774" href="#d0e18774"></a><p class="title"><b>Table&nbsp;57.1.&nbsp;Per-meter customizations</b></p><div class="table-contents"><table class="table" summary="Per-meter customizations" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Property</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">management.metrics.enable</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Whether to deny meters from emitting any metrics.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">management.metrics.distribution.percentiles-histogram</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Whether to publish a histogram suitable for computing aggregable (across dimension)
percentile approximations.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">management.metrics.distribution.minimum-expected-value</code>,
  <code class="literal">management.metrics.distribution.maximum-expected-value</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Publish less histogram buckets by clamping the range of expected values.</p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">management.metrics.distribution.percentiles</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p>Publish percentile values computed in your application</p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p><code class="literal">management.metrics.distribution.sla</code></p></td><td style="" align="left" valign="top"><p>Publish a cumulative histogram with buckets defined by your SLAs.</p></td></tr></tbody></table></div></div><br class="table-break"><p>For more details on concepts behind <code class="literal">percentiles-histogram</code>, <code class="literal">percentiles</code> and <code class="literal">sla</code>
refer to the <a class="link" href="https://micrometer.io/docs/concepts#_histograms_and_percentiles" target="_top">"Histograms
and percentiles" section</a> of the micrometer documentation.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-metrics-endpoint" href="#production-ready-metrics-endpoint"></a>57.6&nbsp;Metrics endpoint</h2></div></div></div><p>Spring Boot provides a <code class="literal">metrics</code> endpoint that can be used diagnostically to examine the
metrics collected by an application. The endpoint is not available by default and must be
exposed, see <a class="link" href="production-ready-endpoints.html#production-ready-endpoints-exposing-endpoints" title="53.2&nbsp;Exposing Endpoints">exposing endpoints</a> for more
details.</p><p>Navigating to <code class="literal">/actuator/metrics</code> displays a list of available meter names. You can drill
down to view information about a particular meter by providing its name as a selector,
e.g. <code class="literal">/actuator/metrics/jvm.memory.max</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The name you use here should match the name used in the code, not the name after it has
been naming-convention normalized for a monitoring system it is shipped to. In other
words, if <code class="literal">jvm.memory.max</code> appears as <code class="literal">jvm_memory_max</code> in Prometheus because of its snake
case naming convention, you should still use <code class="literal">jvm.memory.max</code> as the selector when
inspecting the meter in the <code class="literal">metrics</code> endpoint.</p></td></tr></table></div><p>You can also add any number of <code class="literal">tag=KEY:VALUE</code> query parameters to the end of the URL to
dimensionally drill down on a meter, e.g.
<code class="literal">/actuator/metrics/jvm.memory.max?tag=area:nonheap</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The reported measurements are the <span class="emphasis"><em>sum</em></span> of the statistics of all meters matching the meter
name and any tags that have been applied. So in the example above, the returned "Value"
statistic is the sum of the maximum memory footprints of "Code Cache",
"Compressed Class Space", and "Metaspace" areas of the heap. If you just wanted to see the
maximum size for the "Metaspace", you could add an additional <code class="literal">tag=id:Metaspace</code>, i.e.
<code class="literal">/actuator/metrics/jvm.memory.max?tag=area:nonheap&amp;tag=id:Metaspace</code>.</p></td></tr></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="production-ready-loggers.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="production-ready.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="production-ready-auditing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">56.&nbsp;Loggers&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;58.&nbsp;Auditing</td></tr></table></div></body></html>