<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>30.&nbsp;Security</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="boot-features.html" title="Part&nbsp;IV.&nbsp;Spring Boot features"><link rel="prev" href="boot-features-developing-web-applications.html" title="29.&nbsp;Developing Web Applications"><link rel="next" href="boot-features-sql.html" title="31.&nbsp;Working with SQL Databases"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">30.&nbsp;Security</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="boot-features-developing-web-applications.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Spring Boot features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="boot-features-sql.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="boot-features-security" href="#boot-features-security"></a>30.&nbsp;Security</h2></div></div></div><p>If <a class="link" href="https://projects.spring.io/spring-security/" target="_top">Spring Security</a> is on the classpath, then web applications are
secured by default. Spring Boot relies on Spring Security&#8217;s content-negotiation strategy
to determine whether to use <code class="literal">httpBasic</code> or <code class="literal">formLogin</code>. To add method-level security to a
web application, you can also add <code class="literal">@EnableGlobalMethodSecurity</code> with your desired
settings. Additional information can be found in the
<a class="link" href="https://docs.spring.io/spring-security/site/docs/5.1.5.RELEASE/reference/htmlsingle#jc-method" target="_top">Spring Security Reference Guide</a>.</p><p>The default <code class="literal">UserDetailsService</code> has a single user. The user name is <code class="literal">user</code>, and the
password is random and is printed at INFO level when the application starts, as shown in
the following example:</p><pre class="screen">Using generated security password: 78fa095d-3f4c-48b1-ad50-e24c31d5cf35</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you fine-tune your logging configuration, ensure that the
<code class="literal">org.springframework.boot.autoconfigure.security</code> category is set to log <code class="literal">INFO</code>-level
messages. Otherwise, the default password is not printed.</p></td></tr></table></div><p>You can change the username and password by providing a <code class="literal">spring.security.user.name</code> and
<code class="literal">spring.security.user.password</code>.</p><p>The basic features you get by default in a web application are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">A <code class="literal">UserDetailsService</code> (or <code class="literal">ReactiveUserDetailsService</code> in case of a WebFlux application)
bean with in-memory store and a single user with a generated password (see
<a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/autoconfigure/security/SecurityProperties.User.html" target="_top"><code class="literal">SecurityProperties.User</code></a>
for the properties of the user).</li><li class="listitem">Form-based login or HTTP Basic security (depending on the <code class="literal">Accept</code> header in the request) for
the entire application (including actuator endpoints if actuator is on the classpath).</li><li class="listitem">A <code class="literal">DefaultAuthenticationEventPublisher</code> for publishing authentication events.</li></ul></div><p>You can provide a different <code class="literal">AuthenticationEventPublisher</code> by adding a bean for it.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-security-mvc" href="#boot-features-security-mvc"></a>30.1&nbsp;MVC Security</h2></div></div></div><p>The default security configuration is implemented in <code class="literal">SecurityAutoConfiguration</code> and
<code class="literal">UserDetailsServiceAutoConfiguration</code>. <code class="literal">SecurityAutoConfiguration</code> imports
<code class="literal">SpringBootWebSecurityConfiguration</code> for web security and
<code class="literal">UserDetailsServiceAutoConfiguration</code> configures authentication, which is also
relevant in non-web applications. To switch off the default web application security
configuration completely, you can add a bean of type <code class="literal">WebSecurityConfigurerAdapter</code> (doing
so does not disable the <code class="literal">UserDetailsService</code> configuration or Actuator&#8217;s security).</p><p>To also switch off the <code class="literal">UserDetailsService</code> configuration, you can add a bean of type
<code class="literal">UserDetailsService</code>, <code class="literal">AuthenticationProvider</code>, or <code class="literal">AuthenticationManager</code>.
There are several secure applications in the <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-samples/" target="_top">Spring
Boot samples</a> to get you started with common use cases.</p><p>Access rules can be overridden by adding a custom <code class="literal">WebSecurityConfigurerAdapter</code>. Spring
Boot provides convenience methods that can be used to override access rules for actuator
endpoints and static resources. <code class="literal">EndpointRequest</code> can be used to create a <code class="literal">RequestMatcher</code>
that is based on the <code class="literal">management.endpoints.web.base-path</code> property.
<code class="literal">PathRequest</code> can be used to create a <code class="literal">RequestMatcher</code> for resources in
commonly used locations.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-security-webflux" href="#boot-features-security-webflux"></a>30.2&nbsp;WebFlux Security</h2></div></div></div><p>Similar to Spring MVC applications, you can secure your WebFlux applications by adding
the <code class="literal">spring-boot-starter-security</code> dependency. The default security configuration is
implemented in <code class="literal">ReactiveSecurityAutoConfiguration</code> and
<code class="literal">UserDetailsServiceAutoConfiguration</code>. <code class="literal">ReactiveSecurityAutoConfiguration</code> imports
<code class="literal">WebFluxSecurityConfiguration</code> for web security and <code class="literal">UserDetailsServiceAutoConfiguration</code>
configures authentication, which is also relevant in non-web applications. To switch off the default web application security
configuration completely, you can add a bean of type <code class="literal">WebFilterChainProxy</code> (doing so does
not disable the <code class="literal">UserDetailsService</code> configuration or Actuator&#8217;s security).</p><p>To also switch off the <code class="literal">UserDetailsService</code> configuration, you can add a bean of type
<code class="literal">ReactiveUserDetailsService</code> or <code class="literal">ReactiveAuthenticationManager</code>.</p><p>Access rules can be configured by adding a custom <code class="literal">SecurityWebFilterChain</code>. Spring
Boot provides convenience methods that can be used to override access rules for actuator
endpoints and static resources. <code class="literal">EndpointRequest</code> can be used to create a
<code class="literal">ServerWebExchangeMatcher</code> that is based on the <code class="literal">management.endpoints.web.base-path</code>
property.</p><p><code class="literal">PathRequest</code> can be used to create a <code class="literal">ServerWebExchangeMatcher</code> for resources in
commonly used locations.</p><p>For example, you can customize your security configuration by adding something like:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> http
		.authorizeExchange()
			.matchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()
			.pathMatchers(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/foo"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/bar"</span>)
				.authenticated().and()
			.formLogin().and()
		.build();
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-security-oauth2" href="#boot-features-security-oauth2"></a>30.3&nbsp;OAuth2</h2></div></div></div><p><a class="link" href="https://oauth.net/2/" target="_top">OAuth2</a> is a widely used authorization framework that is supported by
Spring.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-security-oauth2-client" href="#boot-features-security-oauth2-client"></a>30.3.1&nbsp;Client</h3></div></div></div><p>If you have <code class="literal">spring-security-oauth2-client</code> on your classpath, you can take advantage of
some auto-configuration to make it easy to set up an OAuth2/Open ID Connect clients. This configuration
makes use of the properties under <code class="literal">OAuth2ClientProperties</code>. The same properties are applicable to both servlet and reactive applications.</p><p>You can register multiple OAuth2 clients and providers under the
<code class="literal">spring.security.oauth2.client</code> prefix, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.client-id</span>=abcd
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.client-secret</span>=password
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.client-name</span>=Client for user scope
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.provider</span>=my-oauth-provider
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.scope</span>=user
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.redirect-uri-template</span>=https://my-redirect-uri.com
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.client-authentication-method</span>=basic
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type</span>=authorization_code

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.client-id</span>=abcd
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.client-secret</span>=password
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.client-name</span>=Client for email scope
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.provider</span>=my-oauth-provider
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.scope</span>=email
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.redirect-uri-template</span>=https://my-redirect-uri.com
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.client-authentication-method</span>=basic
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type</span>=authorization_code

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri</span>=http://my-auth-server/oauth/authorize
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.my-oauth-provider.token-uri</span>=http://my-auth-server/oauth/token
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri</span>=http://my-auth-server/userinfo
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method</span>=header
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri</span>=http://my-auth-server/token_keys
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute</span>=name</pre><p>For OpenID Connect providers that support <a class="link" href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_top">OpenID Connect discovery</a>,
the configuration can be further simplified. The provider needs to be configured with an <code class="literal">issuer-uri</code> which is the
URI that the it asserts as its Issuer Identifier. For example, if the
<code class="literal">issuer-uri</code> provided is "https://example.com", then an <code class="literal">OpenID Provider Configuration Request</code>
will be made to "https://example.com/.well-known/openid-configuration". The result is expected
to be an <code class="literal">OpenID Provider Configuration Response</code>. The following example shows how an OpenID Connect
Provider can be configured with the <code class="literal">issuer-uri</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.provider.oidc-provider.issuer-uri</span>=https://dev-123456.oktapreview.com/oauth2/default/</pre><p>By default, Spring Security&#8217;s <code class="literal">OAuth2LoginAuthenticationFilter</code> only processes URLs
matching <code class="literal">/login/oauth2/code/*</code>. If you want to customize the <code class="literal">redirect-uri</code> to
use a different pattern, you need to provide configuration to process that custom pattern.
For example, for servlet applications, you can add your own <code class="literal">WebSecurityConfigurerAdapter</code> that resembles the
following:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> OAuth2LoginSecurityConfig <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> WebSecurityConfigurerAdapter {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">protected</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> configure(HttpSecurity http) <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		http
			.authorizeRequests()
				.anyRequest().authenticated()
				.and()
			.oauth2Login()
				.redirectionEndpoint()
					.baseUri(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/custom-callback"</span>);
	}
}</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-security-oauth2-common-providers" href="#boot-features-security-oauth2-common-providers"></a>OAuth2 client registration for common providers</h4></div></div></div><p>For common OAuth2 and OpenID providers, including Google, Github, Facebook, and Okta,
we provide a set of provider defaults (<code class="literal">google</code>, <code class="literal">github</code>, <code class="literal">facebook</code>, and <code class="literal">okta</code>,
respectively).</p><p>If you do not need to customize these providers, you can set the <code class="literal">provider</code> attribute to
the one for which you need to infer defaults. Also, if the key for the client registration matches a
default supported provider, Spring Boot infers that as well.</p><p>In other words, the two configurations in the following example use the Google provider:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client.client-id</span>=abcd
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client.client-secret</span>=password
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.my-client.provider</span>=google

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.google.client-id</span>=abcd
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.client.registration.google.client-secret</span>=password</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-security-oauth2-server" href="#boot-features-security-oauth2-server"></a>30.3.2&nbsp;Resource Server</h3></div></div></div><p>If you have <code class="literal">spring-security-oauth2-resource-server</code> on your classpath, Spring Boot can
set up an OAuth2 Resource Server as long as a JWK Set URI or OIDC Issuer URI is specified,
as shown in the following examples:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.resourceserver.jwt.jwk-set-uri</span>=https://example.com/oauth2/default/v1/keys</pre><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.security.oauth2.resourceserver.jwt.issuer-uri</span>=https://dev-123456.oktapreview.com/oauth2/default/</pre><p>The same properties are applicable for both servlet and reactive applications.</p><p>Alternatively, you can define your own <code class="literal">JwtDecoder</code> bean for servlet applications
or a <code class="literal">ReactiveJwtDecoder</code> for reactive applications.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_authorization_server" href="#_authorization_server"></a>30.3.3&nbsp;Authorization Server</h3></div></div></div><p>Currently, Spring Security does not provide support for implementing an OAuth 2.0
Authorization Server. However, this functionality is available from
the <a class="link" href="https://projects.spring.io/spring-security-oauth/" target="_top">Spring Security OAuth</a> project,
which will eventually be superseded by Spring Security completely. Until then, you can
use the <code class="literal">spring-security-oauth2-autoconfigure</code> module to easily set up an OAuth 2.0 authorization server;
see its <a class="link" href="https://docs.spring.io/spring-security-oauth2-boot" target="_top">documentation</a> for instructions.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-security-actuator" href="#boot-features-security-actuator"></a>30.4&nbsp;Actuator Security</h2></div></div></div><p>For security purposes, all actuators other than <code class="literal">/health</code> and <code class="literal">/info</code> are disabled by
default. The <code class="literal">management.endpoints.web.exposure.include</code> property can be used to enable
the actuators.</p><p>If Spring Security is on the classpath and no other WebSecurityConfigurerAdapter is
present, all actuators other than <code class="literal">/health</code> and <code class="literal">/info</code> are secured by Spring Boot
auto-configuration. If you define a custom <code class="literal">WebSecurityConfigurerAdapter</code>, Spring Boot
auto-configuration will back off and you will be in full control of actuator access rules.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Before setting the <code class="literal">management.endpoints.web.exposure.include</code>, ensure that the
exposed actuators do not contain sensitive information and/or are secured by placing them
behind a firewall or by something like Spring Security.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-security-csrf" href="#boot-features-security-csrf"></a>30.4.1&nbsp;Cross Site Request Forgery Protection</h3></div></div></div><p>Since Spring Boot relies on Spring Security&#8217;s defaults, CSRF protection is turned on by
default. This means that the actuator endpoints that require a <code class="literal">POST</code> (shutdown and
loggers endpoints), <code class="literal">PUT</code> or <code class="literal">DELETE</code> will get a 403 forbidden error when the default
security configuration is in use.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>We recommend disabling CSRF protection completely only if you are creating a service
that is used by non-browser clients.</p></td></tr></table></div><p>Additional information about CSRF protection can be found in the
<a class="link" href="https://docs.spring.io/spring-security/site/docs/5.1.5.RELEASE/reference/htmlsingle#csrf" target="_top">Spring Security Reference Guide</a>.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="boot-features-developing-web-applications.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="boot-features.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="boot-features-sql.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">29.&nbsp;Developing Web Applications&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;31.&nbsp;Working with SQL Databases</td></tr></table></div></body></html>