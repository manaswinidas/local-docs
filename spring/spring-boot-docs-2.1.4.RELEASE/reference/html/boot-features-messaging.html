<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>34.&nbsp;Messaging</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="boot-features.html" title="Part&nbsp;IV.&nbsp;Spring Boot features"><link rel="prev" href="boot-features-caching.html" title="33.&nbsp;Caching"><link rel="next" href="boot-features-resttemplate.html" title="35.&nbsp;Calling REST Services with RestTemplate"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">34.&nbsp;Messaging</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="boot-features-caching.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Spring Boot features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="boot-features-resttemplate.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="boot-features-messaging" href="#boot-features-messaging"></a>34.&nbsp;Messaging</h2></div></div></div><p>The Spring Framework provides extensive support for integrating with messaging systems,
from simplified use of the JMS API using <code class="literal">JmsTemplate</code> to a complete infrastructure to
receive messages asynchronously. Spring AMQP provides a similar feature set for the
Advanced Message Queuing Protocol. Spring Boot also provides auto-configuration
options for <code class="literal">RabbitTemplate</code> and RabbitMQ. Spring WebSocket natively includes support for
STOMP messaging, and Spring Boot has support for that through starters and a small amount
of auto-configuration. Spring Boot also has support for Apache Kafka.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-jms" href="#boot-features-jms"></a>34.1&nbsp;JMS</h2></div></div></div><p>The <code class="literal">javax.jms.ConnectionFactory</code> interface provides a standard method of creating a
<code class="literal">javax.jms.Connection</code> for interacting with a JMS broker. Although Spring needs a
<code class="literal">ConnectionFactory</code> to work with JMS, you generally need not use it directly yourself and
can instead rely on higher level messaging abstractions. (See the
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/integration.html#jms" target="_top">relevant section</a> of the Spring Framework
reference documentation for details.) Spring Boot also auto-configures the necessary
infrastructure to send and receive messages.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-activemq" href="#boot-features-activemq"></a>34.1.1&nbsp;ActiveMQ Support</h3></div></div></div><p>When <a class="link" href="https://activemq.apache.org/" target="_top">ActiveMQ</a> is available on the classpath, Spring Boot can
also configure a <code class="literal">ConnectionFactory</code>. If the broker is present, an embedded broker is
automatically started and configured (provided no broker URL is specified through
configuration).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you use <code class="literal">spring-boot-starter-activemq</code>, the necessary dependencies to connect or
embed an ActiveMQ instance are provided, as is the Spring infrastructure to integrate with
JMS.</p></td></tr></table></div><p>ActiveMQ configuration is controlled by external configuration properties in
<code class="literal">spring.activemq.*</code>. For example, you might declare the following section in
<code class="literal">application.properties</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.activemq.broker-url</span>=tcp://192.168.1.210:9876
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.activemq.user</span>=admin
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.activemq.password</span>=secret</pre><p>By default, a <code class="literal">CachingConnectionFactory</code> wraps the native <code class="literal">ConnectionFactory</code> with
sensible settings that you can control by external configuration properties in
<code class="literal">spring.jms.*</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.jms.cache.session-cache-size</span>=5</pre><p>If you&#8217;d rather use native pooling, you can do so by adding a dependency to
<code class="literal">org.messaginghub:pooled-jms</code> and configuring the <code class="literal">JmsPoolConnectionFactory</code> accordingly,
as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.activemq.pool.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.activemq.pool.max-connections</span>=50</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>See
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/activemq/ActiveMQProperties.java" target="_top"><code class="literal">ActiveMQProperties</code></a>
for more of the supported options. You can also register an arbitrary number of beans
that implement <code class="literal">ActiveMQConnectionFactoryCustomizer</code> for more advanced customizations.</p></td></tr></table></div><p>By default, ActiveMQ creates a destination if it does not yet exist so that destinations
are resolved against their provided names.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-artemis" href="#boot-features-artemis"></a>34.1.2&nbsp;Artemis Support</h3></div></div></div><p>Spring Boot can auto-configure a <code class="literal">ConnectionFactory</code> when it detects that
<a class="link" href="https://activemq.apache.org/artemis/" target="_top">Artemis</a> is available on the classpath. If the broker
is present, an embedded broker is automatically started and configured (unless the mode
property has been explicitly set). The supported modes are <code class="literal">embedded</code> (to make explicit
that an embedded broker is required and that an error should occur if the broker is not
available on the classpath) and <code class="literal">native</code> (to connect to a broker using the <code class="literal">netty</code>
transport protocol). When the latter is configured, Spring Boot configures a
<code class="literal">ConnectionFactory</code> that connects to a broker running on the local machine with the
default settings.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you use <code class="literal">spring-boot-starter-artemis</code>, the necessary dependencies to
connect to an existing Artemis instance are provided, as well as the Spring
infrastructure to integrate with JMS. Adding <code class="literal">org.apache.activemq:artemis-jms-server</code> to
your application lets you use embedded mode.</p></td></tr></table></div><p>Artemis configuration is controlled by external configuration properties in
<code class="literal">spring.artemis.*</code>. For example, you might declare the following section in
<code class="literal">application.properties</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.mode</span>=native
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.host</span>=192.168.1.210
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.port</span>=9876
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.user</span>=admin
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.password</span>=secret</pre><p>When embedding the broker, you can choose if you want to enable persistence and list the
destinations that should be made available. These can be specified as a comma-separated
list to create them with the default options, or you can define bean(s) of type
<code class="literal">org.apache.activemq.artemis.jms.server.config.JMSQueueConfiguration</code> or
<code class="literal">org.apache.activemq.artemis.jms.server.config.TopicConfiguration</code>, for advanced queue
and topic configurations, respectively.</p><p>By default, a <code class="literal">CachingConnectionFactory</code> wraps the native <code class="literal">ConnectionFactory</code> with
sensible settings that you can control by external configuration properties in
<code class="literal">spring.jms.*</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.jms.cache.session-cache-size</span>=5</pre><p>If you&#8217;d rather use native pooling, you can do so by adding a dependency to
<code class="literal">org.messaginghub:pooled-jms</code> and configuring the <code class="literal">JmsPoolConnectionFactory</code> accordingly,
as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.pool.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.artemis.pool.max-connections</span>=50</pre><p>See
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/artemis/ArtemisProperties.java" target="_top"><code class="literal">ArtemisProperties</code></a>
for more supported options.</p><p>No JNDI lookup is involved, and destinations are resolved against their names, using
either the <code class="literal">name</code> attribute in the Artemis configuration or the names provided through
configuration.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-jms-jndi" href="#boot-features-jms-jndi"></a>34.1.3&nbsp;Using a JNDI ConnectionFactory</h3></div></div></div><p>If you are running your application in an application server, Spring Boot tries to
locate a JMS <code class="literal">ConnectionFactory</code> by using JNDI. By default, the <code class="literal">java:/JmsXA</code> and
<code class="literal">java:/XAConnectionFactory</code> location are checked. You can use the <code class="literal">spring.jms.jndi-name</code>
property if you need to specify an alternative location, as shown in the following
example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.jms.jndi-name</span>=java:/MyConnectionFactory</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-using-jms-sending" href="#boot-features-using-jms-sending"></a>34.1.4&nbsp;Sending a Message</h3></div></div></div><p>Spring&#8217;s <code class="literal">JmsTemplate</code> is auto-configured, and you can autowire it directly into your own
beans, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.jms.core.JmsTemplate;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.stereotype.Component;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">final</span> JmsTemplate jmsTemplate;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> MyBean(JmsTemplate jmsTemplate) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.jmsTemplate = jmsTemplate;
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/javadoc-api/org/springframework/jms/core/JmsMessagingTemplate.html" target="_top"><code class="literal">JmsMessagingTemplate</code></a> can
be injected in a similar manner. If a <code class="literal">DestinationResolver</code> or a <code class="literal">MessageConverter</code> bean
is defined, it is associated automatically to the auto-configured <code class="literal">JmsTemplate</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-using-jms-receiving" href="#boot-features-using-jms-receiving"></a>34.1.5&nbsp;Receiving a Message</h3></div></div></div><p>When the JMS infrastructure is present, any bean can be annotated with <code class="literal">@JmsListener</code> to
create a listener endpoint. If no <code class="literal">JmsListenerContainerFactory</code> has been defined, a
default one is configured automatically. If a <code class="literal">DestinationResolver</code> or a
<code class="literal">MessageConverter</code> beans is defined, it is associated automatically to the default
factory.</p><p>By default, the default factory is transactional. If you run in an infrastructure where a
<code class="literal">JtaTransactionManager</code> is present, it is associated to the listener container by default.
If not, the <code class="literal">sessionTransacted</code> flag is enabled. In that latter scenario, you can
associate your local data store transaction to the processing of an incoming message by
adding <code class="literal">@Transactional</code> on your listener method (or a delegate thereof). This ensures that
the incoming message is acknowledged, once the local transaction has completed. This also
includes sending response messages that have been performed on the same JMS session.</p><p>The following component creates a listener endpoint on the <code class="literal">someQueue</code> destination:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@JmsListener(destination = "someQueue")</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> processMessage(String content) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>See <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/javadoc-api/org/springframework/jms/annotation/EnableJms.html" target="_top">the Javadoc of <code class="literal">@EnableJms</code></a>
for more details.</p></td></tr></table></div><p>If you need to create more <code class="literal">JmsListenerContainerFactory</code> instances or if you want to
override the default, Spring Boot provides a
<code class="literal">DefaultJmsListenerContainerFactoryConfigurer</code> that you can use to initialize a
<code class="literal">DefaultJmsListenerContainerFactory</code> with the same settings as the one that is
auto-configured.</p><p>For instance, the following example exposes another factory that uses a specific
<code class="literal">MessageConverter</code>:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> JmsConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> DefaultJmsListenerContainerFactory myFactory(
			DefaultJmsListenerContainerFactoryConfigurer configurer) {
		DefaultJmsListenerContainerFactory factory =
				<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> DefaultJmsListenerContainerFactory();
		configurer.configure(factory, connectionFactory());
		factory.setMessageConverter(myMessageConverter());
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> factory;
	}

}</pre><p>Then you can use the factory in any <code class="literal">@JmsListener</code>-annotated method as follows:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	@JmsListener(destination = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"someQueue"</span>, <span class="strong"><strong>containerFactory="myFactory"</strong></span>)
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> processMessage(String content) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-amqp" href="#boot-features-amqp"></a>34.2&nbsp;AMQP</h2></div></div></div><p>The Advanced Message Queuing Protocol (AMQP) is a platform-neutral, wire-level protocol
for message-oriented middleware. The Spring AMQP project applies core Spring concepts to
the development of AMQP-based messaging solutions. Spring Boot offers several conveniences
for working with AMQP through RabbitMQ, including the <code class="literal">spring-boot-starter-amqp</code>
&#8220;Starter&#8221;.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-rabbitmq" href="#boot-features-rabbitmq"></a>34.2.1&nbsp;RabbitMQ support</h3></div></div></div><p><a class="link" href="https://www.rabbitmq.com/" target="_top">RabbitMQ</a> is a lightweight, reliable, scalable, and portable
message broker based on the AMQP protocol. Spring uses <code class="literal">RabbitMQ</code> to communicate through
the AMQP protocol.</p><p>RabbitMQ configuration is controlled by external configuration properties in
<code class="literal">spring.rabbitmq.*</code>. For example, you might declare the following section in
<code class="literal">application.properties</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.rabbitmq.host</span>=localhost
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.rabbitmq.port</span>=5672
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.rabbitmq.username</span>=admin
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.rabbitmq.password</span>=secret</pre><p>If a <code class="literal">ConnectionNameStrategy</code> bean exists in the context, it will be automatically used to
name connections created by the auto-configured <code class="literal">ConnectionFactory</code>. See
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java" target="_top"><code class="literal">RabbitProperties</code></a> for more
of the supported options.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>See
<a class="link" href="https://spring.io/blog/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/" target="_top">Understanding
AMQP, the protocol used by RabbitMQ</a> for more details.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-using-amqp-sending" href="#boot-features-using-amqp-sending"></a>34.2.2&nbsp;Sending a Message</h3></div></div></div><p>Spring&#8217;s <code class="literal">AmqpTemplate</code> and <code class="literal">AmqpAdmin</code> are auto-configured, and you can autowire them
directly into your own beans, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.amqp.core.AmqpAdmin;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.amqp.core.AmqpTemplate;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.stereotype.Component;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">final</span> AmqpAdmin amqpAdmin;
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">final</span> AmqpTemplate amqpTemplate;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> MyBean(AmqpAdmin amqpAdmin, AmqpTemplate amqpTemplate) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.amqpAdmin = amqpAdmin;
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.amqpTemplate = amqpTemplate;
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><a class="link" href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp/rabbit/core/RabbitMessagingTemplate.html" target="_top"><code class="literal">RabbitMessagingTemplate</code></a>
can be injected in a similar manner. If a <code class="literal">MessageConverter</code> bean is defined, it is
associated automatically to the auto-configured <code class="literal">AmqpTemplate</code>.</p></td></tr></table></div><p>If necessary, any <code class="literal">org.springframework.amqp.core.Queue</code> that is defined as a bean is
automatically used to declare a corresponding queue on the RabbitMQ instance.</p><p>To retry operations, you can enable retries on the <code class="literal">AmqpTemplate</code> (for example, in the
event that the broker connection is lost):</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.rabbitmq.template.retry.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.rabbitmq.template.retry.initial-interval</span>=2s</pre><p>Retries are disabled by default. You can also customize the <code class="literal">RetryTemplate</code>
programmatically by declaring a <code class="literal">RabbitRetryTemplateCustomizer</code> bean.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-using-amqp-receiving" href="#boot-features-using-amqp-receiving"></a>34.2.3&nbsp;Receiving a Message</h3></div></div></div><p>When the Rabbit infrastructure is present, any bean can be annotated with
<code class="literal">@RabbitListener</code> to create a listener endpoint. If no <code class="literal">RabbitListenerContainerFactory</code>
has been defined, a default <code class="literal">SimpleRabbitListenerContainerFactory</code> is automatically
configured and you can switch to a direct container using the
<code class="literal">spring.rabbitmq.listener.type</code> property.  If a <code class="literal">MessageConverter</code> or a <code class="literal">MessageRecoverer</code>
bean is defined, it is automatically associated with the default factory.</p><p>The following sample component creates a listener endpoint on the <code class="literal">someQueue</code> queue:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RabbitListener(queues = "someQueue")</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> processMessage(String content) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>See <a class="link" href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp/rabbit/annotation/EnableRabbit.html" target="_top">the Javadoc of
<code class="literal">@EnableRabbit</code></a> for more details.</p></td></tr></table></div><p>If you need to create more <code class="literal">RabbitListenerContainerFactory</code> instances or if you want to
override the default, Spring Boot provides a
<code class="literal">SimpleRabbitListenerContainerFactoryConfigurer</code> and a
<code class="literal">DirectRabbitListenerContainerFactoryConfigurer</code> that you can use to initialize a
<code class="literal">SimpleRabbitListenerContainerFactory</code> and a <code class="literal">DirectRabbitListenerContainerFactory</code> with
the same settings as the factories used by the auto-configuration.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>It does not matter which container type you chose. Those two beans are exposed by
the auto-configuration.</p></td></tr></table></div><p>For instance, the following configuration class exposes another factory that uses a
specific <code class="literal">MessageConverter</code>:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> RabbitConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> SimpleRabbitListenerContainerFactory myFactory(
			SimpleRabbitListenerContainerFactoryConfigurer configurer) {
		SimpleRabbitListenerContainerFactory factory =
				<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> SimpleRabbitListenerContainerFactory();
		configurer.configure(factory, connectionFactory);
		factory.setMessageConverter(myMessageConverter());
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> factory;
	}

}</pre><p>Then you can use the factory in any <code class="literal">@RabbitListener</code>-annotated method, as follows:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	@RabbitListener(queues = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"someQueue"</span>, <span class="strong"><strong>containerFactory="myFactory"</strong></span>)
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> processMessage(String content) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><p>You can enable retries to handle situations where your listener throws an exception. By
default, <code class="literal">RejectAndDontRequeueRecoverer</code> is used, but you can define a <code class="literal">MessageRecoverer</code>
of your own. When retries are exhausted, the message is rejected and either dropped or
routed to a dead-letter exchange if the broker is configured to do so. By default,
retries are disabled. You can also customize the <code class="literal">RetryTemplate</code> programmatically by
declaring a <code class="literal">RabbitRetryTemplateCustomizer</code> bean.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>By default, if retries are disabled and the listener throws an exception, the
delivery is retried indefinitely. You can modify this behavior in two ways: Set the
<code class="literal">defaultRequeueRejected</code> property to <code class="literal">false</code> so that zero re-deliveries are attempted or
throw an <code class="literal">AmqpRejectAndDontRequeueException</code> to signal the message should be rejected.
The latter is the mechanism used when retries are enabled and the maximum number of
delivery attempts is reached.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-kafka" href="#boot-features-kafka"></a>34.3&nbsp;Apache Kafka Support</h2></div></div></div><p><a class="link" href="https://kafka.apache.org/" target="_top">Apache Kafka</a> is supported by providing auto-configuration of
the <code class="literal">spring-kafka</code> project.</p><p>Kafka configuration is controlled by external configuration properties in
<code class="literal">spring.kafka.*</code>. For example, you might declare the following section in
<code class="literal">application.properties</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.bootstrap-servers</span>=localhost:9092
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.consumer.group-id</span>=myGroup</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>To create a topic on startup, add a bean of type <code class="literal">NewTopic</code>. If the topic already
exists, the bean is ignored.</p></td></tr></table></div><p>See <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaProperties.java" target="_top"><code class="literal">KafkaProperties</code></a>
for more supported options.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-kafka-sending-a-message" href="#boot-features-kafka-sending-a-message"></a>34.3.1&nbsp;Sending a Message</h3></div></div></div><p>Spring&#8217;s <code class="literal">KafkaTemplate</code> is auto-configured, and you can autowire it directly in your own
beans, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">final</span> KafkaTemplate kafkaTemplate;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> MyBean(KafkaTemplate kafkaTemplate) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.kafkaTemplate = kafkaTemplate;
	}

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If the property <code class="literal">spring.kafka.producer.transaction-id-prefix</code> is defined, a
<code class="literal">KafkaTransactionManager</code> is automatically configured. Also, if a <code class="literal">RecordMessageConverter</code>
bean is defined, it is automatically associated to the auto-configured <code class="literal">KafkaTemplate</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-kafka-receiving-a-message" href="#boot-features-kafka-receiving-a-message"></a>34.3.2&nbsp;Receiving a Message</h3></div></div></div><p>When the Apache Kafka infrastructure is present, any bean can be annotated with
<code class="literal">@KafkaListener</code> to create a listener endpoint. If no <code class="literal">KafkaListenerContainerFactory</code> has
been defined, a default one is automatically configured with keys defined in
<code class="literal">spring.kafka.listener.*</code>.</p><p>The following component creates a listener endpoint on the <code class="literal">someTopic</code> topic:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyBean {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@KafkaListener(topics = "someTopic")</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> processMessage(String content) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre><p>If a <code class="literal">KafkaTransactionManager</code> bean is defined, it is automatically associated to the
container factory. Similarly, if a <code class="literal">RecordMessageConverter</code>, <code class="literal">ErrorHandler</code> or
<code class="literal">AfterRollbackProcessor</code> bean is defined, it is automatically associated to the default
factory.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A custom <code class="literal">ChainedKafkaTransactionManager</code> must be marked <code class="literal">@Primary</code> as it usually
references the auto-configured <code class="literal">KafkaTransactionManager</code> bean.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-kafka-streams" href="#boot-features-kafka-streams"></a>34.3.3&nbsp;Kafka Streams</h3></div></div></div><p>Spring for Apache Kafka provides a factory bean to create a <code class="literal">StreamsBuilder</code> object and
manage the lifecycle of its streams. Spring Boot auto-configures the required
<code class="literal">KafkaStreamsConfiguration</code> bean as long as <code class="literal">kafka-streams</code> is on the classpath and Kafka
Streams is enabled via the <code class="literal">@EnableKafkaStreams</code> annotation.</p><p>Enabling Kafka Streams means that the application id and bootstrap servers must be set.
The former can be configured using <code class="literal">spring.kafka.streams.application-id</code>, defaulting to
<code class="literal">spring.application.name</code> if not set. The latter can be set globally or
specifically overridden just for streams.</p><p>Several additional properties are available using dedicated properties; other arbitrary
Kafka properties can be set using the <code class="literal">spring.kafka.streams.properties</code> namespace. See
also <a class="xref" href="boot-features-messaging.html#boot-features-kafka-extra-props" title="34.3.4&nbsp;Additional Kafka Properties">Section&nbsp;34.3.4, &#8220;Additional Kafka Properties&#8221;</a> for more information.</p><p>To use the factory bean, simply wire <code class="literal">StreamsBuilder</code> into your <code class="literal">@Bean</code> as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EnableKafkaStreams</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> KafkaStreamsExampleConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> KStream&lt;Integer, String&gt; kStream(StreamsBuilder streamsBuilder) {
		KStream&lt;Integer, String&gt; stream = streamsBuilder.stream(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"ks1In"</span>);
		stream.map((k, v) -&gt; <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> KeyValue&lt;&gt;(k, v.toUpperCase())).to(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"ks1Out"</span>,
				Produced.with(Serdes.Integer(), <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> JsonSerde&lt;&gt;()));
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> stream;
	}

}</pre><p>By default, the streams managed by the <code class="literal">StreamBuilder</code> object it creates are started
automatically. You can customize this behaviour using the
<code class="literal">spring.kafka.streams.auto-startup</code> property.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-kafka-extra-props" href="#boot-features-kafka-extra-props"></a>34.3.4&nbsp;Additional Kafka Properties</h3></div></div></div><p>The properties supported by auto configuration are shown in
<a class="xref" href="common-application-properties.html" title="Appendix&nbsp;A.&nbsp;Common application properties">Appendix&nbsp;A, <i>Common application properties</i></a>. Note that, for the most part, these properties
(hyphenated or camelCase) map directly to the Apache Kafka dotted properties. Refer to the
Apache Kafka documentation for details.</p><p>The first few of these properties apply to all components (producers, consumers, admins,
and streams) but can be
specified at the component level if you wish to use different values.
Apache Kafka designates properties with an importance of HIGH, MEDIUM, or LOW. Spring Boot
auto-configuration supports all HIGH importance properties, some selected MEDIUM and LOW
properties, and any properties that do not have a default value.</p><p>Only a subset of the properties supported by Kafka are available directly through the
<code class="literal">KafkaProperties</code> class. If you wish to configure the producer or consumer with additional
properties that are not directly supported, use the following properties:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.properties.prop.one</span>=first
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.admin.properties.prop.two</span>=second
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.consumer.properties.prop.three</span>=third
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.producer.properties.prop.four</span>=fourth
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.streams.properties.prop.five</span>=fifth</pre><p>This sets the common <code class="literal">prop.one</code> Kafka property to <code class="literal">first</code> (applies to producers,
consumers and admins), the <code class="literal">prop.two</code> admin property to <code class="literal">second</code>, the <code class="literal">prop.three</code>
consumer property to <code class="literal">third</code>, the <code class="literal">prop.four</code> producer property to <code class="literal">fourth</code> and the
<code class="literal">prop.five</code> streams property to <code class="literal">fifth</code>.</p><p>You can also configure the Spring Kafka <code class="literal">JsonDeserializer</code> as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.consumer.value-deserializer</span>=org.springframework.kafka.support.serializer.JsonDeserializer
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.consumer.properties.spring.json.value.default.type</span>=com.example.Invoice
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.consumer.properties.spring.json.trusted.packages</span>=com.example,org.acme</pre><p>Similarly, you can disable the <code class="literal">JsonSerializer</code> default behavior of sending type
information in headers:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.producer.value-serializer</span>=org.springframework.kafka.support.serializer.JsonSerializer
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.kafka.producer.properties.spring.json.add.type.headers</span>=false</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Properties set in this way override any configuration item that Spring Boot
explicitly supports.</p></td></tr></table></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="boot-features-caching.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="boot-features.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="boot-features-resttemplate.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">33.&nbsp;Caching&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;35.&nbsp;Calling REST Services with <code class="literal">RestTemplate</code></td></tr></table></div></body></html>