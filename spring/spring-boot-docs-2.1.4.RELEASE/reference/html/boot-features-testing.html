<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>46.&nbsp;Testing</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="boot-features.html" title="Part&nbsp;IV.&nbsp;Spring Boot features"><link rel="prev" href="boot-features-jmx.html" title="45.&nbsp;Monitoring and Management over JMX"><link rel="next" href="boot-features-websockets.html" title="47.&nbsp;WebSockets"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">46.&nbsp;Testing</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="boot-features-jmx.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Spring Boot features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="boot-features-websockets.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="boot-features-testing" href="#boot-features-testing"></a>46.&nbsp;Testing</h2></div></div></div><p>Spring Boot provides a number of utilities and annotations to help when testing your
application. Test support is provided by two modules: <code class="literal">spring-boot-test</code> contains core
items, and <code class="literal">spring-boot-test-autoconfigure</code> supports auto-configuration for tests.</p><p>Most developers use the <code class="literal">spring-boot-starter-test</code> &#8220;Starter&#8221;, which imports both Spring
Boot test modules as well as JUnit, AssertJ, Hamcrest, and a number of other useful
libraries.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-test-scope-dependencies" href="#boot-features-test-scope-dependencies"></a>46.1&nbsp;Test Scope Dependencies</h2></div></div></div><p>The <code class="literal">spring-boot-starter-test</code> &#8220;Starter&#8221; (in the <code class="literal">test</code> <code class="literal">scope</code>) contains
the following provided libraries:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="https://junit.org" target="_top">JUnit</a>: The de-facto standard for unit testing Java applications.</li><li class="listitem"><a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#integration-testing" target="_top">Spring Test</a> &amp; Spring Boot Test:
Utilities and integration test support for Spring Boot applications.</li><li class="listitem"><a class="link" href="https://joel-costigliola.github.io/assertj/" target="_top">AssertJ</a>: A fluent assertion library.</li><li class="listitem"><a class="link" href="https://github.com/hamcrest/JavaHamcrest" target="_top">Hamcrest</a>: A library of matcher objects (also
known as constraints or predicates).</li><li class="listitem"><a class="link" href="https://mockito.github.io" target="_top">Mockito</a>: A Java mocking framework.</li><li class="listitem"><a class="link" href="https://github.com/skyscreamer/JSONassert" target="_top">JSONassert</a>: An assertion library for JSON.</li><li class="listitem"><a class="link" href="https://github.com/jayway/JsonPath" target="_top">JsonPath</a>: XPath for JSON.</li></ul></div><p>We generally find these common libraries to be useful when writing tests. If these
libraries do not suit your needs, you can add additional test dependencies of your own.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-testing-spring-applications" href="#boot-features-testing-spring-applications"></a>46.2&nbsp;Testing Spring Applications</h2></div></div></div><p>One of the major advantages of dependency injection is that it should make your code
easier to unit test. You can instantiate objects by using the <code class="literal">new</code> operator without
even involving Spring. You can also use <span class="emphasis"><em>mock objects</em></span> instead of real dependencies.</p><p>Often, you need to move beyond unit testing and start integration testing (with
a Spring <code class="literal">ApplicationContext</code>). It is useful to be able to perform integration testing
without requiring deployment of your application or needing to connect to other
infrastructure.</p><p>The Spring Framework includes a dedicated test module for such integration testing. You
can declare a dependency directly to <code class="literal">org.springframework:spring-test</code> or use the
<code class="literal">spring-boot-starter-test</code> &#8220;Starter&#8221; to pull it in transitively.</p><p>If you have not used the <code class="literal">spring-test</code> module before, you should start by reading the
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#testing" target="_top">relevant section</a> of the Spring Framework
reference documentation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-testing-spring-boot-applications" href="#boot-features-testing-spring-boot-applications"></a>46.3&nbsp;Testing Spring Boot Applications</h2></div></div></div><p>A Spring Boot application is a Spring <code class="literal">ApplicationContext</code>, so nothing very special has
to be done to test it beyond what you would normally do with a vanilla Spring context.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>External properties, logging, and other features of Spring Boot are installed in the
context by default only if you use <code class="literal">SpringApplication</code> to create it.</p></td></tr></table></div><p>Spring Boot provides a <code class="literal">@SpringBootTest</code> annotation, which can be used as an alternative
to the standard <code class="literal">spring-test</code> <code class="literal">@ContextConfiguration</code> annotation when you need Spring
Boot features. The annotation works by
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-detecting-config" title="46.3.2&nbsp;Detecting Test Configuration">creating the
<code class="literal">ApplicationContext</code> used in your tests through <code class="literal">SpringApplication</code></a>. In addition to
<code class="literal">@SpringBootTest</code> a number of other annotations are also provided for
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" title="46.3.8&nbsp;Auto-configured Tests">testing more
specific slices</a> of an application.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you are using JUnit 4, don&#8217;t forget to also add <code class="literal">@RunWith(SpringRunner.class)</code> to
your test, otherwise the annotations will be ignored. If you are using JUnit 5, there&#8217;s no
need to add the equivalent <code class="literal">@ExtendWith(SpringExtension.class)</code> as <code class="literal">@SpringBootTest</code> and
the other <code class="literal">@&#8230;Test</code> annotations are already annotated with it.</p></td></tr></table></div><p>By default, <code class="literal">@SpringBootTest</code> will not start a server. You can use the <code class="literal">webEnvironment</code>
attribute of <code class="literal">@SpringBootTest</code> to further refine how your tests run:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">MOCK</code>(Default) : Loads a web <code class="literal">ApplicationContext</code> and provides a mock web
environment. Embedded servers are not started when using this annotation. If a web
environment is not available on your classpath, this mode transparently falls back to
creating a regular non-web <code class="literal">ApplicationContext</code>. It can be used in conjunction with
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-with-mock-environment" title="46.3.4&nbsp;Testing with a mock environment"><code class="literal">@AutoConfigureMockMvc</code> or <code class="literal">@AutoConfigureWebTestClient</code></a> for mock-based testing of your
web application.</li><li class="listitem"><code class="literal">RANDOM_PORT</code>: Loads a <code class="literal">WebServerApplicationContext</code> and provides a real web
environment. Embedded servers are started and listen on a random port.</li><li class="listitem"><code class="literal">DEFINED_PORT</code>: Loads a <code class="literal">WebServerApplicationContext</code> and provides a real web
environment. Embedded servers are started and listen on a defined port (from your
<code class="literal">application.properties</code>) or on the default port of <code class="literal">8080</code>.</li><li class="listitem"><code class="literal">NONE</code>: Loads an <code class="literal">ApplicationContext</code> by using <code class="literal">SpringApplication</code> but does not provide
<span class="emphasis"><em>any</em></span> web environment (mock or otherwise).</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If your test is <code class="literal">@Transactional</code>, it rolls back the transaction at the end of each
test method by default. However, as using this arrangement with either <code class="literal">RANDOM_PORT</code> or
<code class="literal">DEFINED_PORT</code> implicitly provides a real servlet environment, the HTTP client and server
run in separate threads and, thus, in separate transactions. Any transaction initiated on
the server does not roll back in this case.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">@SpringBootTest</code> with <code class="literal">webEnvironment = WebEnvironment.RANDOM_PORT</code> will also
start the management server on a separate random port if your application uses a different
port for the management server.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-detecting-web-app-type" href="#boot-features-testing-spring-boot-applications-detecting-web-app-type"></a>46.3.1&nbsp;Detecting Web Application Type</h3></div></div></div><p>If Spring MVC is available, a regular MVC-based application context is configured. If you
have only Spring WebFlux, we&#8217;ll detect that and configure a WebFlux-based application
context instead.</p><p>If both are present, Spring MVC takes precedence. If you want to test a reactive web
application in this scenario, you must set the <code class="literal">spring.main.web-application-type</code>
property:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(properties = "spring.main.web-application-type=reactive")</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyWebFluxTests { ... }</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-detecting-config" href="#boot-features-testing-spring-boot-applications-detecting-config"></a>46.3.2&nbsp;Detecting Test Configuration</h3></div></div></div><p>If you are familiar with the Spring Test Framework, you may be used to using
<code class="literal">@ContextConfiguration(classes=&#8230;&#8203;)</code> in order to specify which Spring <code class="literal">@Configuration</code> to
load. Alternatively, you might have often used nested <code class="literal">@Configuration</code> classes within
your test.</p><p>When testing Spring Boot applications, this is often not required. Spring Boot&#8217;s <code class="literal">@*Test</code>
annotations search for your primary configuration automatically whenever you do not
explicitly define one.</p><p>The search algorithm works up from the package that contains the test until it finds a
class annotated with <code class="literal">@SpringBootApplication</code> or <code class="literal">@SpringBootConfiguration</code>. As long as
you <a class="link" href="using-boot-structuring-your-code.html" title="14.&nbsp;Structuring Your Code">structured your code</a> in a sensible way, your
main configuration is usually found.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you use a
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" title="46.3.8&nbsp;Auto-configured Tests">test
annotation to test a more specific slice of your application</a>, you should avoid adding
configuration settings that are specific to a particular area on the
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-user-configuration" title="46.3.23&nbsp;User Configuration and Slicing">main
method&#8217;s application class</a>.</p><p>The underlying component scan configuration of <code class="literal">@SpringBootApplication</code> defines exclude
filters that are used to make sure slicing works as expected. If you are using an explicit
<code class="literal">@ComponentScan</code> directive on your <code class="literal">@SpringBootApplication</code>-annotated class, be aware that
those filters will be disabled. If you are using slicing, you should define them again.</p></td></tr></table></div><p>If you want to customize the primary configuration, you can use a nested
<code class="literal">@TestConfiguration</code> class. Unlike a nested <code class="literal">@Configuration</code> class, which would be used
instead of your application&#8217;s primary configuration, a nested <code class="literal">@TestConfiguration</code> class
is used in addition to your application&#8217;s primary configuration.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring&#8217;s test framework caches application contexts between tests. Therefore, as
long as your tests share the same configuration (no matter how it is discovered), the
potentially time-consuming process of loading the context happens only once.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-excluding-config" href="#boot-features-testing-spring-boot-applications-excluding-config"></a>46.3.3&nbsp;Excluding Test Configuration</h3></div></div></div><p>If your application uses component scanning (for example, if you use
<code class="literal">@SpringBootApplication</code> or <code class="literal">@ComponentScan</code>), you may find top-level configuration
classes that you created only for specific tests accidentally get picked up everywhere.</p><p>As we <a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-detecting-config" title="46.3.2&nbsp;Detecting Test Configuration">have seen
earlier</a>, <code class="literal">@TestConfiguration</code> can be used on an inner class of a test to customize the
primary configuration. When placed on a top-level class, <code class="literal">@TestConfiguration</code> indicates
that classes in <code class="literal">src/test/java</code> should not be picked up by scanning. You can then import
that class explicitly where it is required, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Import(MyTestsConfiguration.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() {
		...
	}

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you directly use <code class="literal">@ComponentScan</code> (that is, not through
<code class="literal">@SpringBootApplication</code>) you need to register the <code class="literal">TypeExcludeFilter</code> with it. See
<a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/context/TypeExcludeFilter.html" target="_top">the Javadoc</a> for details.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-with-mock-environment" href="#boot-features-testing-spring-boot-applications-testing-with-mock-environment"></a>46.3.4&nbsp;Testing with a mock environment</h3></div></div></div><p>By default, <code class="literal">@SpringBootTest</code> does not start the server. If you have web endpoints that
you want to test against this mock environment, you can additionally configure
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference//testing.html#spring-mvc-test-framework" target="_top"><code class="literal">MockMvc</code></a> as shown in the
following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.web.servlet.MockMvc;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@AutoConfigureMockMvc</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MockMvcExampleTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> MockMvc mvc;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.mvc.perform(get(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/"</span>)).andExpect(status().isOk())
				.andExpect(content().string(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello World"</span>));
	}

}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you want to focus only on the web layer and not start a complete
<code class="literal">ApplicationContext</code>, consider
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests" title="46.3.10&nbsp;Auto-configured Spring MVC Tests">using
<code class="literal">@WebMvcTest</code> instead</a>.</p></td></tr></table></div><p>Alternatively, you can configure a
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#webtestclient-tests" target="_top"><code class="literal">WebTestClient</code></a> as shown in the
following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@AutoConfigureWebTestClient</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MockWebTestClientExampleTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> WebTestClient webClient;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.webClient.get().uri(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/"</span>).exchange().expectStatus().isOk()
				.expectBody(String.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello World"</span>);
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-with-running-server" href="#boot-features-testing-spring-boot-applications-testing-with-running-server"></a>46.3.5&nbsp;Testing with a running server</h3></div></div></div><p>If you need to start a full running server, we recommend that you use random ports.
If you use <code class="literal">@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>, an
available port is picked at random each time your test runs.</p><p>The <code class="literal">@LocalServerPort</code> annotation can be used to
<a class="link" href="howto-embedded-web-servers.html#howto-discover-the-http-port-at-runtime" title="78.5&nbsp;Discover the HTTP Port at Runtime">inject the actual port used</a> into your test.
For convenience, tests that need to make REST calls to the started server can
additionally <code class="literal">@Autowire</code> a
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#webtestclient-tests" target="_top"><code class="literal">WebTestClient</code></a>, which resolves
relative links to the running server and comes with a dedicated API for verifying
responses, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> RandomPortWebTestClientExampleTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> WebTestClient webClient;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.webClient.get().uri(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/"</span>).exchange().expectStatus().isOk()
				.expectBody(String.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello World"</span>);
	}

}</pre><p>This setup requires <code class="literal">spring-webflux</code> on the classpath. If you can&#8217;t or won&#8217;t add webflux,
Spring Boot also provides a <code class="literal">TestRestTemplate</code> facility:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.web.client.TestRestTemplate;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.assertj.core.api.Assertions.assertThat;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> RandomPortTestRestTemplateExampleTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> TestRestTemplate restTemplate;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() {
		String body = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.restTemplate.getForObject(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/"</span>, String.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>);
		assertThat(body).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello World"</span>);
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-jmx" href="#boot-features-testing-spring-boot-applications-jmx"></a>46.3.6&nbsp;Using JMX</h3></div></div></div><p>As the test context framework caches context, JMX is disabled by default to prevent
identical components to register on the same domain. If such test needs access to an
<code class="literal">MBeanServer</code>, consider marking it dirty as well:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(properties = "spring.jmx.enabled=true")</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DirtiesContext</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> SampleJmxTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> MBeanServer mBeanServer;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-mocking-beans" href="#boot-features-testing-spring-boot-applications-mocking-beans"></a>46.3.7&nbsp;Mocking and Spying Beans</h3></div></div></div><p>When running tests, it is sometimes necessary to mock certain components within your
application context. For example, you may have a facade over some remote service that is
unavailable during development. Mocking can also be useful when you want to simulate
failures that might be hard to trigger in a real environment.</p><p>Spring Boot includes a <code class="literal">@MockBean</code> annotation that can be used to define a Mockito mock
for a bean inside your <code class="literal">ApplicationContext</code>. You can use the annotation to add new beans
or replace a single existing bean definition. The annotation can be used directly on test
classes, on fields within your test, or on <code class="literal">@Configuration</code> classes and fields. When used
on a field, the instance of the created mock is also injected. Mock beans are
automatically reset after each test method.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If your test uses one of Spring Boot&#8217;s test annotations (such as <code class="literal">@SpringBootTest</code>), this
feature is automatically enabled. To use this feature with a different
arrangement, a listener must be explicitly added, as shown in the following example:</p><pre class="programlisting">@TestExecutionListeners(MockitoTestExecutionListener.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>)</pre></td></tr></table></div><p>The following example replaces an existing <code class="literal">RemoteService</code> bean with a mock
implementation:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.mock.mockito.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.*;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.assertj.core.api.Assertions.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.mockito.BDDMockito.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@MockBean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> RemoteService remoteService;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> Reverser reverser;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> exampleTest() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// RemoteService has been injected into the reverser bean</span>
		given(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.remoteService.someCall()).willReturn(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"mock"</span>);
		String reverse = reverser.reverseSomeCall();
		assertThat(reverse).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"kcom"</span>);
	}

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">@MockBean</code> cannot be used to mock the behavior of a bean that&#8217;s exercised during
application context refresh. By the time the test is executed, the application context refresh
has completed and it is too late to configure the mocked behavior. We recommend using a <code class="literal">@Bean</code>
method to create and configure the mock in this situation.</p></td></tr></table></div><p>Additionally, you can use <code class="literal">@SpyBean</code> to wrap any existing bean with a Mockito <code class="literal">spy</code>. See
the <a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/test/mock/mockito/SpyBean.html" target="_top">Javadoc</a> for full details.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>While Spring&#8217;s test framework caches application contexts between tests and reuses
a context for tests sharing the same configuration, the use of <code class="literal">@MockBean</code> or <code class="literal">@SpyBean</code>
influences the cache key, which will most likely increase the number of contexts.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you are using <code class="literal">@SpyBean</code> to spy on a bean with <code class="literal">@Cacheable</code> methods that refer
to parameters by name, your application must be compiled with <code class="literal">-parameters</code>. This
ensures that the parameter names are available to the caching infrastructure once the
bean has been spied upon.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests"></a>46.3.8&nbsp;Auto-configured Tests</h3></div></div></div><p>Spring Boot&#8217;s auto-configuration system works well for applications but can sometimes be
a little too much for tests. It often helps to load only the parts of the configuration
that are required to test a &#8220;slice&#8221; of your application. For example, you might want to
test that Spring MVC controllers are mapping URLs correctly, and you do not want to
involve database calls in those tests, or you might want to test JPA entities, and you
are not interested in the web layer when those tests run.</p><p>The <code class="literal">spring-boot-test-autoconfigure</code> module includes a number of annotations that can be
used to automatically configure such &#8220;slices&#8221;. Each of them works in a similar way,
providing a <code class="literal">@&#8230;&#8203;Test</code> annotation that loads the <code class="literal">ApplicationContext</code> and one or
more <code class="literal">@AutoConfigure&#8230;&#8203;</code> annotations that can be used to customize auto-configuration
settings.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Each slice restricts component scan to appropriate components and loads a very
restricted set of auto-configuration classes. If you need to exclude one of them,
most <code class="literal">@&#8230;&#8203;Test</code> annotations provide an <code class="literal">excludeAutoConfiguration</code> attribute.
Alternatively, you can use <code class="literal">@ImportAutoConfiguration#exclude</code>.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Including multiple &#8220;slices&#8221; by using several <code class="literal">@&#8230;&#8203;Test</code> annotations in one test is
not supported. If you need multiple &#8220;slices&#8221;, pick one of the <code class="literal">@&#8230;&#8203;Test</code> annotations
and include the <code class="literal">@AutoConfigure&#8230;&#8203;</code> annotations of the other &#8220;slices&#8221; by hand.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>It is also possible to use the <code class="literal">@AutoConfigure&#8230;&#8203;</code> annotations with the standard
<code class="literal">@SpringBootTest</code> annotation. You can use this combination if you are not interested in
&#8220;slicing&#8221; your application but you want some of the auto-configured test beans.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-json-tests" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-json-tests"></a>46.3.9&nbsp;Auto-configured JSON Tests</h3></div></div></div><p>To test that object JSON serialization and deserialization is working as expected, you can
use the <code class="literal">@JsonTest</code> annotation. <code class="literal">@JsonTest</code> auto-configures the available supported JSON
mapper, which can be one of the following libraries:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Jackson <code class="literal">ObjectMapper</code>, any <code class="literal">@JsonComponent</code> beans and any Jackson <code class="literal">Module</code>s</li><li class="listitem"><code class="literal">Gson</code></li><li class="listitem"><code class="literal">Jsonb</code></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configurations that are enabled by <code class="literal">@JsonTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>If you need to configure elements of the auto-configuration, you can use the
<code class="literal">@AutoConfigureJsonTesters</code> annotation.</p><p>Spring Boot includes AssertJ-based helpers that work with the JSONAssert and JsonPath
libraries to check that JSON appears as expected. The <code class="literal">JacksonTester</code>, <code class="literal">GsonTester</code>,
<code class="literal">JsonbTester</code>, and <code class="literal">BasicJsonTester</code> classes can be used for Jackson, Gson, Jsonb, and
Strings respectively. Any helper fields on the test class can be <code class="literal">@Autowired</code> when using
<code class="literal">@JsonTest</code>. The following example shows a test class for Jackson:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.json.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.json.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.*;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.assertj.core.api.Assertions.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@JsonTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyJsonTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> JacksonTester&lt;VehicleDetails&gt; json;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testSerialize() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		VehicleDetails details = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> VehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Civic"</span>);
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// Assert against a `.json` file in the same package as the test</span>
		assertThat(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.json.write(details)).isEqualToJson(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"expected.json"</span>);
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// Or use JSON path based assertions</span>
		assertThat(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.json.write(details)).hasJsonPathStringValue(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"@.make"</span>);
		assertThat(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.json.write(details)).extractingJsonPathStringValue(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"@.make"</span>)
				.isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda"</span>);
	}

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testDeserialize() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		String content = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"{\"make\":\"Ford\",\"model\":\"Focus\"}"</span>;
		assertThat(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.json.parse(content))
				.isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> VehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Ford"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Focus"</span>));
		assertThat(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.json.parseObject(content).getMake()).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Ford"</span>);
	}

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>JSON helper classes can also be used directly in standard unit tests. To do so,
call the <code class="literal">initFields</code> method of the helper in your <code class="literal">@Before</code> method if you do not use
<code class="literal">@JsonTest</code>.</p></td></tr></table></div><p>If you&#8217;re using Spring Boot&#8217;s AssertJ-based helpers to assert on a number value
at a given JSON path, you might not be able to use <code class="literal">isEqualTo</code> depending on the type.
Instead, you can use AssertJ&#8217;s <code class="literal">satisfies</code> to assert that the value matches the given
condition. For instance, the following example asserts that the actual number is a float
value close to <code class="literal">0.15</code> within an offset of <code class="literal">0.01</code>.</p><pre class="programlisting">assertThat(json.write(message))
    .extractingJsonPathNumberValue(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"@.test.numberValue"</span>)
    .satisfies((number) -&gt; assertThat(number.floatValue()).isCloseTo(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">0.15f</xslthl:number>, within(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">0.01f</xslthl:number>)));</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests"></a>46.3.10&nbsp;Auto-configured Spring MVC Tests</h3></div></div></div><p>To test whether Spring MVC controllers are working as expected, use the <code class="literal">@WebMvcTest</code>
annotation. <code class="literal">@WebMvcTest</code> auto-configures the Spring MVC infrastructure and limits
scanned beans to <code class="literal">@Controller</code>, <code class="literal">@ControllerAdvice</code>, <code class="literal">@JsonComponent</code>, <code class="literal">Converter</code>,
<code class="literal">GenericConverter</code>, <code class="literal">Filter</code>, <code class="literal">WebMvcConfigurer</code>, and <code class="literal">HandlerMethodArgumentResolver</code>.
Regular <code class="literal">@Component</code> beans are not scanned when using this annotation.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@WebMvcTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you need to register extra components, such as the Jackson <code class="literal">Module</code>, you can
import additional configuration classes by using <code class="literal">@Import</code> on your test.</p></td></tr></table></div><p>Often, <code class="literal">@WebMvcTest</code> is limited to a single controller and is used in combination with
<code class="literal">@MockBean</code> to provide mock implementations for required collaborators.</p><p><code class="literal">@WebMvcTest</code> also auto-configures <code class="literal">MockMvc</code>. Mock MVC offers a powerful way to quickly
test MVC controllers without needing to start a full HTTP server.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can also auto-configure <code class="literal">MockMvc</code> in a non-<code class="literal">@WebMvcTest</code> (such as
<code class="literal">@SpringBootTest</code>) by annotating it with <code class="literal">@AutoConfigureMockMvc</code>. The following example
uses <code class="literal">MockMvc</code>:</p></td></tr></table></div><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.mock.mockito.*;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.assertj.core.api.Assertions.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.mockito.BDDMockito.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@WebMvcTest(UserVehicleController.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyControllerTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> MockMvc mvc;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@MockBean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> UserVehicleService userVehicleService;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testExample() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		given(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.userVehicleService.getVehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"sboot"</span>))
				.willReturn(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> VehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Civic"</span>));
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.mvc.perform(get(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/sboot/vehicle"</span>).accept(MediaType.TEXT_PLAIN))
				.andExpect(status().isOk()).andExpect(content().string(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda Civic"</span>));
	}

}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you need to configure elements of the auto-configuration (for example, when
servlet filters should be applied) you can use attributes in the <code class="literal">@AutoConfigureMockMvc</code>
annotation.</p></td></tr></table></div><p>If you use HtmlUnit or Selenium, auto-configuration also provides an HTMLUnit <code class="literal">WebClient</code>
bean and/or a <code class="literal">WebDriver</code> bean. The following example uses HtmlUnit:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> com.gargoylesoftware.htmlunit.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.mock.mockito.*;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.assertj.core.api.Assertions.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.mockito.BDDMockito.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@WebMvcTest(UserVehicleController.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyHtmlUnitTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> WebClient webClient;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@MockBean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> UserVehicleService userVehicleService;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testExample() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		given(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.userVehicleService.getVehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"sboot"</span>))
				.willReturn(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> VehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Civic"</span>));
		HtmlPage page = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.webClient.getPage(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/sboot/vehicle.html"</span>);
		assertThat(page.getBody().getTextContent()).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda Civic"</span>);
	}

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>By default, Spring Boot puts <code class="literal">WebDriver</code> beans in a special &#8220;scope&#8221; to ensure
that the driver exits after each test and that a new instance is injected. If you do
not want this behavior, you can add <code class="literal">@Scope("singleton")</code> to your <code class="literal">WebDriver</code> <code class="literal">@Bean</code>
definition.</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">webDriver</code> scope created by Spring Boot will replace any user defined scope
of the same name. If you define your own <code class="literal">webDriver</code> scope you may find it stops working
when you use <code class="literal">@WebMvcTest</code>.</p></td></tr></table></div><p>If you have Spring Security on the classpath, <code class="literal">@WebMvcTest</code> will also scan <code class="literal">WebSecurityConfigurer</code>
beans. Instead of disabling security completely for such tests, you can use Spring Security&#8217;s test support.
More details on how to use Spring Security&#8217;s <code class="literal">MockMvc</code> support can be found in
this <span class="emphasis"><em><a class="xref" href="howto-use-test-with-spring-security.html" title="80.&nbsp;Testing With Spring Security">Chapter&nbsp;80, <i>Testing With Spring Security</i></a></em></span> how-to section.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Sometimes writing Spring MVC tests is not enough; Spring Boot can help you run
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-with-running-server" title="46.3.5&nbsp;Testing with a running server">full end-to-end tests with an actual server</a>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests"></a>46.3.11&nbsp;Auto-configured Spring WebFlux Tests</h3></div></div></div><p>To test that <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference//web-reactive.html" target="_top">Spring WebFlux</a> controllers are
working as expected, you can use the <code class="literal">@WebFluxTest</code> annotation. <code class="literal">@WebFluxTest</code>
auto-configures the Spring WebFlux infrastructure and limits scanned beans to
<code class="literal">@Controller</code>, <code class="literal">@ControllerAdvice</code>, <code class="literal">@JsonComponent</code>, <code class="literal">Converter</code>, <code class="literal">GenericConverter</code>, and
<code class="literal">WebFluxConfigurer</code>. Regular <code class="literal">@Component</code> beans are not scanned when the <code class="literal">@WebFluxTest</code>
annotation is used.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configurations that are enabled by <code class="literal">@WebFluxTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If you need to register extra components, such as Jackson <code class="literal">Module</code>, you can import
additional configuration classes using <code class="literal">@Import</code> on your test.</p></td></tr></table></div><p>Often, <code class="literal">@WebFluxTest</code> is limited to a single controller and used in combination with the
<code class="literal">@MockBean</code> annotation to provide mock implementations for required collaborators.</p><p><code class="literal">@WebFluxTest</code> also auto-configures
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#webtestclient" target="_top"><code class="literal">WebTestClient</code></a>, which offers
a powerful way to quickly test WebFlux controllers without needing to start a full HTTP
server.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can also auto-configure <code class="literal">WebTestClient</code> in a non-<code class="literal">@WebFluxTest</code> (such as
<code class="literal">@SpringBootTest</code>) by annotating it with <code class="literal">@AutoConfigureWebTestClient</code>. The following
example shows a class that uses both <code class="literal">@WebFluxTest</code> and a <code class="literal">WebTestClient</code>:</p></td></tr></table></div><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.http.MediaType;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@WebFluxTest(UserVehicleController.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyControllerTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> WebTestClient webClient;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@MockBean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> UserVehicleService userVehicleService;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testExample() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		given(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.userVehicleService.getVehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"sboot"</span>))
				.willReturn(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> VehicleDetails(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Civic"</span>));
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.webClient.get().uri(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/sboot/vehicle"</span>).accept(MediaType.TEXT_PLAIN)
				.exchange()
				.expectStatus().isOk()
				.expectBody(String.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Honda Civic"</span>);
	}

}</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This setup is only supported by WebFlux applications as using <code class="literal">WebTestClient</code> in a
mocked web application only works with WebFlux at the moment.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">@WebFluxTest</code> cannot detect routes registered via the functional web framework. For
testing <code class="literal">RouterFunction</code> beans in the context, consider importing your <code class="literal">RouterFunction</code>
yourself via <code class="literal">@Import</code> or using <code class="literal">@SpringBootTest</code>.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">@WebFluxTest</code> cannot detect custom security configuration registered via a <code class="literal">@Bean</code>
of type <code class="literal">SecurityWebFilterChain</code>. To include that in your test, you will need to import
the configuration that registers the bean via <code class="literal">@Import</code> or use <code class="literal">@SpringBootTest</code>.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Sometimes writing Spring WebFlux tests is not enough; Spring Boot can help you run
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-with-running-server" title="46.3.5&nbsp;Testing with a running server">full end-to-end tests with an actual server</a>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test"></a>46.3.12&nbsp;Auto-configured Data JPA Tests</h3></div></div></div><p>You can use the <code class="literal">@DataJpaTest</code> annotation to test JPA applications. By default, it
configures an in-memory embedded database, scans for <code class="literal">@Entity</code> classes, and configures
Spring Data JPA repositories. Regular <code class="literal">@Component</code> beans are not loaded into the
<code class="literal">ApplicationContext</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@DataJpaTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>By default, data JPA tests are transactional and roll back at the end of each test. See
the <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_top">relevant section</a>
in the Spring Framework Reference Documentation for more details. If that is not what you
want, you can disable transaction management for a test or for the whole class as
follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.transaction.annotation.Propagation;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataJpaTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Transactional(propagation = Propagation.NOT_SUPPORTED)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleNonTransactionalTests {

}</pre><p>Data JPA tests may also inject a
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.java" target="_top"><code class="literal">TestEntityManager</code></a>
bean, which provides an alternative to the standard JPA <code class="literal">EntityManager</code> that is
specifically designed for tests. If you want to use <code class="literal">TestEntityManager</code> outside of
<code class="literal">@DataJpaTest</code> instances, you can also use the <code class="literal">@AutoConfigureTestEntityManager</code>
annotation. A <code class="literal">JdbcTemplate</code> is also available if you need that. The following example
shows the <code class="literal">@DataJpaTest</code> annotation in use:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.orm.jpa.*;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.assertj.core.api.Assertions.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataJpaTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleRepositoryTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> TestEntityManager entityManager;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> UserRepository repository;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testExample() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.entityManager.persist(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> User(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"sboot"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"1234"</span>));
		User user = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.repository.findByUsername(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"sboot"</span>);
		assertThat(user.getUsername()).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"sboot"</span>);
		assertThat(user.getVin()).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"1234"</span>);
	}

}</pre><p>In-memory embedded databases generally work well for tests, since they are fast and do
not require any installation. If, however, you prefer to run tests against a real
database you can use the <code class="literal">@AutoConfigureTestDatabase</code> annotation, as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataJpaTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@AutoConfigureTestDatabase(replace=Replace.NONE)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleRepositoryTests {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test"></a>46.3.13&nbsp;Auto-configured JDBC Tests</h3></div></div></div><p><code class="literal">@JdbcTest</code> is similar to <code class="literal">@DataJpaTest</code> but is for tests that only require a
<code class="literal">DataSource</code> and do not use Spring Data JDBC. By default, it configures an in-memory
embedded database and a <code class="literal">JdbcTemplate</code>. Regular <code class="literal">@Component</code> beans are not loaded into
the <code class="literal">ApplicationContext</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configurations that are enabled by <code class="literal">@JdbcTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>By default, JDBC tests are transactional and roll back at the end of each test. See the
<a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_top">relevant section</a> in
the Spring Framework Reference Documentation for more details. If that is not what you
want, you can disable transaction management for a test or for the whole class, as
follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.jdbc.JdbcTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.transaction.annotation.Propagation;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@JdbcTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Transactional(propagation = Propagation.NOT_SUPPORTED)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleNonTransactionalTests {

}</pre><p>If you prefer your test to run against a real database, you can use the
<code class="literal">@AutoConfigureTestDatabase</code> annotation in the same way as for <code class="literal">DataJpaTest</code>. (See
"<a class="xref" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" title="46.3.12&nbsp;Auto-configured Data JPA Tests">Section&nbsp;46.3.12, &#8220;Auto-configured Data JPA Tests&#8221;</a>".)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-data-jdbc-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-data-jdbc-test"></a>46.3.14&nbsp;Auto-configured Data JDBC Tests</h3></div></div></div><p><code class="literal">@DataJdbcTest</code> is similar to <code class="literal">@JdbcTest</code> but is for tests that use Spring Data JDBC
repositories. By default, it configures an in-memory embedded database, a <code class="literal">JdbcTemplate</code>,
and Spring Data JDBC repositories. Regular <code class="literal">@Component</code> beans are not loaded into
the <code class="literal">ApplicationContext</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configurations that are enabled by <code class="literal">@DataJdbcTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>By default, Data JDBC tests are transactional and roll back at the end of each test. See
the <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_top">relevant section</a>
in the Spring Framework Reference Documentation for more details. If that is not what you
want, you can disable transaction management for a test or for the whole test class as
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" title="46.3.13&nbsp;Auto-configured JDBC Tests">shown
in the JDBC example</a>.</p><p>If you prefer your test to run against a real database, you can use the
<code class="literal">@AutoConfigureTestDatabase</code> annotation in the same way as for <code class="literal">DataJpaTest</code>. (See
"<a class="xref" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" title="46.3.12&nbsp;Auto-configured Data JPA Tests">Section&nbsp;46.3.12, &#8220;Auto-configured Data JPA Tests&#8221;</a>".)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-jooq-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-jooq-test"></a>46.3.15&nbsp;Auto-configured jOOQ Tests</h3></div></div></div><p>You can use <code class="literal">@JooqTest</code> in a similar fashion as <code class="literal">@JdbcTest</code> but for jOOQ-related tests.
As jOOQ relies heavily on a Java-based schema that corresponds with the database schema,
the existing <code class="literal">DataSource</code> is used. If you want to replace it with an in-memory database,
you can use <code class="literal">@AutoConfigureTestDatabase</code> to override those settings. (For more about using
jOOQ with Spring Boot, see "<a class="xref" href="boot-features-sql.html#boot-features-jooq" title="31.6&nbsp;Using jOOQ">Section&nbsp;31.6, &#8220;Using jOOQ&#8221;</a>", earlier in this chapter.) Regular
<code class="literal">@Component</code> beans are not loaded into the <code class="literal">ApplicationContext</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configurations that are enabled by <code class="literal">@JooqTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p><code class="literal">@JooqTest</code> configures a <code class="literal">DSLContext</code>. Regular <code class="literal">@Component</code> beans are not loaded into the
<code class="literal">ApplicationContext</code>. The following example shows the <code class="literal">@JooqTest</code> annotation in use:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.jooq.DSLContext;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.jooq.JooqTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@JooqTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleJooqTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> DSLContext dslContext;
}</pre><p>JOOQ tests are transactional and roll back at the end of each test by default. If that is
not what you want, you can disable transaction management for a test or for the whole
test class as
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" title="46.3.13&nbsp;Auto-configured JDBC Tests">shown
in the JDBC example</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-mongo-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-mongo-test"></a>46.3.16&nbsp;Auto-configured Data MongoDB Tests</h3></div></div></div><p>You can use <code class="literal">@DataMongoTest</code> to test MongoDB applications. By default, it configures an
in-memory embedded MongoDB (if available), configures a <code class="literal">MongoTemplate</code>, scans for
<code class="literal">@Document</code> classes, and configures Spring Data MongoDB repositories. Regular
<code class="literal">@Component</code> beans are not loaded into the <code class="literal">ApplicationContext</code>. (For more about using
MongoDB with Spring Boot, see "<a class="xref" href="boot-features-nosql.html#boot-features-mongodb" title="32.2&nbsp;MongoDB">Section&nbsp;32.2, &#8220;MongoDB&#8221;</a>", earlier in this chapter.)</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@DataMongoTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>The following class shows the <code class="literal">@DataMongoTest</code> annotation in use:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataMongoTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleDataMongoTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> MongoTemplate mongoTemplate;

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">//</span>
}</pre><p>In-memory embedded MongoDB generally works well for tests, since it is fast and does not
require any developer installation. If, however, you prefer to run tests against a real
MongoDB server, you should exclude the embedded MongoDB auto-configuration, as shown in
the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
 <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataMongoTest(excludeAutoConfiguration = EmbeddedMongoAutoConfiguration.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleDataMongoNonEmbeddedTests {

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test"></a>46.3.17&nbsp;Auto-configured Data Neo4j Tests</h3></div></div></div><p>You can use <code class="literal">@DataNeo4jTest</code> to test Neo4j applications. By default, it uses an in-memory
embedded Neo4j (if the embedded driver is available), scans for <code class="literal">@NodeEntity</code> classes, and
configures Spring Data Neo4j repositories. Regular <code class="literal">@Component</code> beans are not loaded into
the <code class="literal">ApplicationContext</code>. (For more about using Neo4J with Spring Boot, see
"<a class="xref" href="boot-features-nosql.html#boot-features-neo4j" title="32.3&nbsp;Neo4j">Section&nbsp;32.3, &#8220;Neo4j&#8221;</a>", earlier in this chapter.)</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@DataNeo4jTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>The following example shows a typical setup for using Neo4J tests in Spring Boot:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataNeo4jTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleDataNeo4jTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> YourRepository repository;

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">//</span>
}</pre><p>By default, Data Neo4j tests are transactional and roll back at the end of each test.
See the <a class="link" href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_top">relevant
section</a> in the Spring Framework Reference Documentation for more details. If that is not
what you want, you can disable transaction management for a test or for the whole class,
as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.neo4j.DataNeo4jTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.transaction.annotation.Propagation;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataNeo4jTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Transactional(propagation = Propagation.NOT_SUPPORTED)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleNonTransactionalTests {

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-redis-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-redis-test"></a>46.3.18&nbsp;Auto-configured Data Redis Tests</h3></div></div></div><p>You can use <code class="literal">@DataRedisTest</code> to test Redis applications. By default, it scans for
<code class="literal">@RedisHash</code> classes and configures Spring Data Redis repositories. Regular <code class="literal">@Component</code>
beans are not loaded into the <code class="literal">ApplicationContext</code>. (For more about using Redis with
Spring Boot, see "<a class="xref" href="boot-features-nosql.html#boot-features-redis" title="32.1&nbsp;Redis">Section&nbsp;32.1, &#8220;Redis&#8221;</a>", earlier in this chapter.)</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@DataRedisTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>The following example shows the <code class="literal">@DataRedisTest</code> annotation in use:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.redis.DataRedisTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataRedisTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleDataRedisTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> YourRepository repository;

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">//</span>
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-ldap-test" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-ldap-test"></a>46.3.19&nbsp;Auto-configured Data LDAP Tests</h3></div></div></div><p>You can use <code class="literal">@DataLdapTest</code> to test LDAP applications. By default, it configures an
in-memory embedded LDAP (if available), configures an <code class="literal">LdapTemplate</code>, scans for <code class="literal">@Entry</code>
classes, and configures Spring Data LDAP repositories. Regular <code class="literal">@Component</code> beans are not
loaded into the <code class="literal">ApplicationContext</code>. (For more about using LDAP with
Spring Boot, see "<a class="xref" href="boot-features-nosql.html#boot-features-ldap" title="32.9&nbsp;LDAP">Section&nbsp;32.9, &#8220;LDAP&#8221;</a>", earlier in this chapter.)</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@DataLdapTest</code> can be
<a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>The following example shows the <code class="literal">@DataLdapTest</code> annotation in use:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.ldap.core.LdapTemplate;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataLdapTest</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleDataLdapTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> LdapTemplate ldapTemplate;

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">//</span>
}</pre><p>In-memory embedded LDAP generally works well for tests, since it is fast and does not
require any developer installation. If, however, you prefer to run tests against a real
LDAP server, you should exclude the embedded LDAP auto-configuration, as shown in the
following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.data.ldap.DataLdapTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@DataLdapTest(excludeAutoConfiguration = EmbeddedLdapAutoConfiguration.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleDataLdapNonEmbeddedTests {

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-client" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-client"></a>46.3.20&nbsp;Auto-configured REST Clients</h3></div></div></div><p>You can use the <code class="literal">@RestClientTest</code> annotation to test REST clients. By default, it
auto-configures Jackson, GSON, and Jsonb support, configures a <code class="literal">RestTemplateBuilder</code>, and
adds support for <code class="literal">MockRestServiceServer</code>. Regular <code class="literal">@Component</code> beans are not loaded into
the <code class="literal">ApplicationContext</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>A list of the auto-configuration settings that are enabled by <code class="literal">@RestClientTest</code> can
be <a class="link" href="test-auto-configuration.html" title="Appendix&nbsp;D.&nbsp;Test auto-configuration annotations">found in the appendix</a>.</p></td></tr></table></div><p>The specific beans that you want to test should be specified by using the <code class="literal">value</code> or
<code class="literal">components</code> attribute of <code class="literal">@RestClientTest</code>, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RestClientTest(RemoteVehicleDetailsService.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleRestClientTest {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> RemoteVehicleDetailsService service;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> MockRestServiceServer server;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> getVehicleDetailsWhenResultIsSuccessShouldReturnDetails()
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.server.expect(requestTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/greet/details"</span>))
				.andRespond(withSuccess(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"hello"</span>, MediaType.TEXT_PLAIN));
		String greeting = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.service.callRestService();
		assertThat(greeting).isEqualTo(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"hello"</span>);
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs"></a>46.3.21&nbsp;Auto-configured Spring REST Docs Tests</h3></div></div></div><p>You can use the <code class="literal">@AutoConfigureRestDocs</code> annotation to use <a class="link" href="https://projects.spring.io/spring-restdocs/" target="_top">Spring REST
Docs</a> in your tests with Mock MVC, REST Assured, or WebTestClient. It removes the need for
the JUnit rule in Spring REST Docs.</p><p><code class="literal">@AutoConfigureRestDocs</code> can be used to override the default output directory
(<code class="literal">target/generated-snippets</code> if you are using Maven or <code class="literal">build/generated-snippets</code> if you
are using Gradle). It can also be used to configure the host, scheme, and port that
appears in any documented URIs.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-mock-mvc" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-mock-mvc"></a>Auto-configured Spring REST Docs Tests with Mock MVC</h4></div></div></div><p><code class="literal">@AutoConfigureRestDocs</code> customizes the <code class="literal">MockMvc</code> bean to use Spring REST Docs. You can
inject it by using <code class="literal">@Autowired</code> and use it in your tests as you normally would when using
Mock MVC and Spring REST Docs, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.http.MediaType;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.web.servlet.MockMvc;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@WebMvcTest(UserController.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@AutoConfigureRestDocs</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> UserDocumentationTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> MockMvc mvc;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> listUsers() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.mvc.perform(get(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/users"</span>).accept(MediaType.TEXT_PLAIN))
				.andExpect(status().isOk())
				.andDo(document(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"list-users"</span>));
	}

}</pre><p>If you require more control over Spring REST Docs configuration than offered by the
attributes of <code class="literal">@AutoConfigureRestDocs</code>, you can use a
<code class="literal">RestDocsMockMvcConfigurationCustomizer</code> bean, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@TestConfiguration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> CustomizationConfiguration
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> RestDocsMockMvcConfigurationCustomizer {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> customize(MockMvcRestDocumentationConfigurer configurer) {
		configurer.snippets().withTemplateFormat(TemplateFormats.markdown());
	}

}</pre><p>If you want to make use of Spring REST Docs support for a parameterized output directory,
you can create a <code class="literal">RestDocumentationResultHandler</code> bean. The auto-configuration calls
<code class="literal">alwaysDo</code> with this result handler, thereby causing each <code class="literal">MockMvc</code> call to automatically
generate the default snippets. The following example shows a
<code class="literal">RestDocumentationResultHandler</code> being defined:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@TestConfiguration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ResultHandlerConfiguration {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> RestDocumentationResultHandler restDocumentation() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> MockMvcRestDocumentation.document(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"{method-name}"</span>);
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-web-test-client" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-web-test-client"></a>Auto-configured Spring REST Docs Tests with WebTestClient</h4></div></div></div><p><code class="literal">@AutoConfigureRestDocs</code> can also be used with <code class="literal">WebTestClient</code>. You can inject it by using
<code class="literal">@Autowired</code> and use it in your tests as you normally would when using <code class="literal">@WebFluxTest</code> and
Spring REST Docs, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.jupiter.api.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.WebFluxTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.restdocs.webtestclient.WebTestClientRestDocumentation.document;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@WebFluxTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@AutoConfigureRestDocs</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> UsersDocumentationTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> WebTestClient webTestClient;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> listUsers() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.webTestClient.get().uri(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/"</span>).exchange().expectStatus().isOk().expectBody()
				.consumeWith(document(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"list-users"</span>));
	}

}</pre><p>If you require more control over Spring REST Docs configuration than offered by the
attributes of <code class="literal">@AutoConfigureRestDocs</code>, you can use a
<code class="literal">RestDocsWebTestClientConfigurationCustomizer</code> bean, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@TestConfiguration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> CustomizationConfiguration
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> RestDocsWebTestClientConfigurationCustomizer {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> customize(WebTestClientRestDocumentationConfigurer configurer) {
		configurer.snippets().withEncoding(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"UTF-8"</span>);
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-rest-assured" href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-rest-docs-rest-assured"></a>Auto-configured Spring REST Docs Tests with REST Assured</h4></div></div></div><p><code class="literal">@AutoConfigureRestDocs</code> makes a <code class="literal">RequestSpecification</code> bean, preconfigured to use Spring
REST Docs, available to your tests. You can inject it by using <code class="literal">@Autowired</code> and use it in
your tests as you normally would when using REST Assured and Spring REST Docs, as shown
in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> io.restassured.specification.RequestSpecification;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.runner.RunWith;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.web.server.LocalServerPort;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> io.restassured.RestAssured.given;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.hamcrest.CoreMatchers.is;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.springframework.restdocs.restassured3.RestAssuredRestDocumentation.document;

<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@AutoConfigureRestDocs</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> UserDocumentationTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@LocalServerPort</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">int</span> port;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> RequestSpecification documentationSpec;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> listUsers() {
		given(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.documentationSpec).filter(document(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"list-users"</span>)).when()
				.port(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.port).get(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/"</span>).then().assertThat().statusCode(is(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">200</xslthl:number>));
	}

}</pre><p>If you require more control over Spring REST Docs configuration than offered by the
attributes of <code class="literal">@AutoConfigureRestDocs</code>, a <code class="literal">RestDocsRestAssuredConfigurationCustomizer</code>
bean can be used, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@TestConfiguration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> CustomizationConfiguration
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> RestDocsRestAssuredConfigurationCustomizer {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> customize(RestAssuredRestDocumentationConfigurer configurer) {
		configurer.snippets().withTemplateFormat(TemplateFormats.markdown());
	}

}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-auto-configured-additional-auto-config" href="#boot-features-testing-spring-boot-applications-testing-auto-configured-additional-auto-config"></a>46.3.22&nbsp;Additional Auto-configuration and Slicing</h3></div></div></div><p>Each slice provides one or more <code class="literal">@AutoConfigure&#8230;&#8203;</code> annotations that namely defines the
auto-configurations that should be included as part of a slice. Additional
auto-configurations can be added by creating a custom <code class="literal">@AutoConfigure&#8230;&#8203;</code> annotation or
simply by adding <code class="literal">@ImportAutoConfiguration</code> to the test as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@JdbcTest</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ImportAutoConfiguration(IntegrationAutoConfiguration.class)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> ExampleJdbcTests {

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Make sure to not use the regular <code class="literal">@Import</code> annotation to import auto-configurations
as they are handled in a specific way by Spring Boot.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-testing-user-configuration" href="#boot-features-testing-spring-boot-applications-testing-user-configuration"></a>46.3.23&nbsp;User Configuration and Slicing</h3></div></div></div><p>If you <a class="link" href="using-boot-structuring-your-code.html" title="14.&nbsp;Structuring Your Code">structure your code</a> in a sensible way, your
<code class="literal">@SpringBootApplication</code> class is
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-detecting-config" title="46.3.2&nbsp;Detecting Test Configuration">used by default</a> as
the configuration of your tests.</p><p>It then becomes important not to litter the application&#8217;s main class with configuration
settings that are specific to a particular area of its functionality.</p><p>Assume that you are using Spring Batch and you rely on the auto-configuration for it.
You could define your <code class="literal">@SpringBootApplication</code> as follows:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootApplication</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EnableBatchProcessing</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> SampleApplication { ... }</pre><p>Because this class is the source configuration for the test, any slice test actually
tries to start Spring Batch, which is definitely not what you want to do. A recommended
approach is to move that area-specific configuration to a separate <code class="literal">@Configuration</code> class
at the same level as your application, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@EnableBatchProcessing</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> BatchConfiguration { ... }</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Depending on the complexity of your application, you may either have a single
<code class="literal">@Configuration</code> class for your customizations or one class per domain area. The latter
approach lets you enable it in one of your tests, if necessary, with the <code class="literal">@Import</code>
annotation.</p></td></tr></table></div><p>Test slices exclude <code class="literal">@Configuration</code> classes from scanning. For example, for a <code class="literal">@WebMvcTest</code>,
the following configuration will not include the given <code class="literal">WebMvcConfigurer</code> bean in the application
context loaded by the test slice:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Configuration</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> WebConfiguration {
	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> WebMvcConfigurer testConfigurer() {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> WebMvcConfigurer() {
			...
		};
	}
}</pre><p>The configuration below will, however, cause the custom <code class="literal">WebMvcConfigurer</code> to be loaded
by the test slice.</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> TestWebMvcConfigurer <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">extends</span> WebMvcConfigurer {
	...
}</pre><p>Another source of confusion is classpath scanning. Assume that, while you structured your
code in a sensible way, you need to scan an additional package. Your application may
resemble the following code:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootApplication</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@ComponentScan({ "com.example.app", "org.acme.another" })</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> SampleApplication { ... }</pre><p>Doing so effectively overrides the default component scan directive with the side effect
of scanning those two packages regardless of the slice that you chose. For instance, a
<code class="literal">@DataJpaTest</code> seems to suddenly scan components and user configurations of your
application. Again, moving the custom directive to a separate class is a good way to fix
this issue.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>If this is not an option for you, you can create a <code class="literal">@SpringBootConfiguration</code>
somewhere in the hierarchy of your test so that it is used instead. Alternatively, you
can specify a source for your test, which disables the behavior of finding a default one.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-testing-spring-boot-applications-with-spock" href="#boot-features-testing-spring-boot-applications-with-spock"></a>46.3.24&nbsp;Using Spock to Test Spring Boot Applications</h3></div></div></div><p>If you wish to use Spock to test a Spring Boot application, you should add a dependency
on Spock&#8217;s <code class="literal">spock-spring</code> module to your application&#8217;s build. <code class="literal">spock-spring</code> integrates
Spring&#8217;s test framework into Spock. It is recommended that you use Spock 1.2 or later to
benefit from a number of improvements to Spock&#8217;s Spring Framework and Spring Boot
integration. See <a class="link" href="http://spockframework.org/spock/docs/1.2/modules.html#_spring_module" target="_top">the
documentation for Spock&#8217;s Spring module</a> for further details.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="boot-features-test-utilities" href="#boot-features-test-utilities"></a>46.4&nbsp;Test Utilities</h2></div></div></div><p>A few test utility classes that are generally useful when testing your application are
packaged as part of <code class="literal">spring-boot</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-configfileapplicationcontextinitializer-test-utility" href="#boot-features-configfileapplicationcontextinitializer-test-utility"></a>46.4.1&nbsp;ConfigFileApplicationContextInitializer</h3></div></div></div><p><code class="literal">ConfigFileApplicationContextInitializer</code> is an <code class="literal">ApplicationContextInitializer</code> that you
can apply to your tests to load Spring Boot <code class="literal">application.properties</code> files. You can use
it when you do not need the full set of features provided by <code class="literal">@SpringBootTest</code>, as shown
in the following example:</p><pre class="programlisting">@ContextConfiguration(classes = Config.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>,
	initializers = ConfigFileApplicationContextInitializer.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Using <code class="literal">ConfigFileApplicationContextInitializer</code> alone does not provide support for
<code class="literal">@Value("${&#8230;&#8203;}")</code> injection. Its only job is to ensure that <code class="literal">application.properties</code>
files are loaded into Spring&#8217;s <code class="literal">Environment</code>. For <code class="literal">@Value</code> support, you need to either
additionally configure a <code class="literal">PropertySourcesPlaceholderConfigurer</code> or use <code class="literal">@SpringBootTest</code>,
which auto-configures one for you.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-test-property-values" href="#boot-features-test-property-values"></a>46.4.2&nbsp;TestPropertyValues</h3></div></div></div><p><code class="literal">TestPropertyValues</code> lets you quickly add properties to a
<code class="literal">ConfigurableEnvironment</code> or <code class="literal">ConfigurableApplicationContext</code>. You can call it with
<code class="literal">key=value</code> strings, as follows:</p><pre class="programlisting">TestPropertyValues.of(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"org=Spring"</span>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"name=Boot"</span>).applyTo(env);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-output-capture-test-utility" href="#boot-features-output-capture-test-utility"></a>46.4.3&nbsp;OutputCapture</h3></div></div></div><p><code class="literal">OutputCapture</code> is a JUnit <code class="literal">Rule</code> that you can use to capture <code class="literal">System.out</code> and
<code class="literal">System.err</code> output. You can declare the capture as a <code class="literal">@Rule</code> and then use <code class="literal">toString()</code>
for assertions, as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Rule;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.junit.Test;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> org.springframework.boot.test.rule.OutputCapture;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.hamcrest.Matchers.*;
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">import</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> org.junit.Assert.*;

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyTest {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Rule</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> OutputCapture capture = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> OutputCapture();

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testName() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		System.out.println(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"Hello World!"</span>);
		assertThat(capture.toString(), containsString(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"World"</span>));
	}

}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="boot-features-rest-templates-test-utility" href="#boot-features-rest-templates-test-utility"></a>46.4.4&nbsp;TestRestTemplate</h3></div></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring Framework 5.0 provides a new <code class="literal">WebTestClient</code> that works for
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests" title="46.3.11&nbsp;Auto-configured Spring WebFlux Tests">WebFlux integration tests</a> and both
<a class="link" href="boot-features-testing.html#boot-features-testing-spring-boot-applications-testing-with-running-server" title="46.3.5&nbsp;Testing with a running server">WebFlux and MVC end-to-end testing</a>. It provides a fluent API for assertions,
unlike <code class="literal">TestRestTemplate</code>.</p></td></tr></table></div><p><code class="literal">TestRestTemplate</code> is a convenience alternative to Spring&#8217;s <code class="literal">RestTemplate</code> that is useful
in integration tests. You can get a vanilla template or one that sends Basic HTTP
authentication (with a username and password). In either case, the template behaves in a
test-friendly way by not throwing exceptions on server-side errors. It is recommended,
but not mandatory, to use the Apache HTTP Client (version 4.3.2 or better). If you have
that on your classpath, the <code class="literal">TestRestTemplate</code> responds by configuring the client
appropriately. If you do use Apache&#8217;s HTTP client, some additional test-friendly features
are enabled:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Redirects are not followed (so you can assert the response location).</li><li class="listitem">Cookies are ignored (so the template is stateless).</li></ul></div><p><code class="literal">TestRestTemplate</code> can be instantiated directly in your integration tests, as shown in
the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyTest {

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> TestRestTemplate template = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> TestRestTemplate();

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testRequest() <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> Exception {
		HttpHeaders headers = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.template.getForEntity(
				<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"https://myhost.example.com/example"</span>, String.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>).getHeaders();
		assertThat(headers.getLocation()).hasHost(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"other.example.com"</span>);
	}

}</pre><p>Alternatively, if you use the <code class="literal">@SpringBootTest</code> annotation with
<code class="literal">WebEnvironment.RANDOM_PORT</code> or <code class="literal">WebEnvironment.DEFINED_PORT</code>, you can inject a
fully configured <code class="literal">TestRestTemplate</code> and start using it. If necessary, additional
customizations can be applied through the <code class="literal">RestTemplateBuilder</code> bean. Any URLs that do
not specify a host and port automatically connect to the embedded server, as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> SampleWebClientTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> TestRestTemplate template;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Test</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> testRequest() {
		HttpHeaders headers = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">this</span>.template.getForEntity(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/example"</span>, String.<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span>)
				.getHeaders();
		assertThat(headers.getLocation()).hasHost(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"other.example.com"</span>);
	}

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@TestConfiguration</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">static</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> Config {

		<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> RestTemplateBuilder restTemplateBuilder() {
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> RestTemplateBuilder().setConnectTimeout(Duration.ofSeconds(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">1</xslthl:number>))
					.setReadTimeout(Duration.ofSeconds(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">1</xslthl:number>));
		}

	}

}</pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="boot-features-jmx.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="boot-features.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="boot-features-websockets.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">45.&nbsp;Monitoring and Management over JMX&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;47.&nbsp;WebSockets</td></tr></table></div></body></html>