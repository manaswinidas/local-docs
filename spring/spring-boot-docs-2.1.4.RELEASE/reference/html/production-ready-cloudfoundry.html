<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>61.&nbsp;Cloud Foundry Support</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="production-ready.html" title="Part&nbsp;V.&nbsp;Spring Boot Actuator: Production-ready features"><link rel="prev" href="production-ready-process-monitoring.html" title="60.&nbsp;Process Monitoring"><link rel="next" href="production-ready-whats-next.html" title="62.&nbsp;What to Read Next"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">61.&nbsp;Cloud Foundry Support</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="production-ready-process-monitoring.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;V.&nbsp;Spring Boot Actuator: Production-ready features</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="production-ready-whats-next.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="production-ready-cloudfoundry" href="#production-ready-cloudfoundry"></a>61.&nbsp;Cloud Foundry Support</h2></div></div></div><p>Spring Boot&#8217;s actuator module includes additional support that is activated when you
deploy to a compatible Cloud Foundry instance. The <code class="literal">/cloudfoundryapplication</code> path
provides an alternative secured route to all <code class="literal">@Endpoint</code> beans.</p><p>The extended support lets Cloud Foundry management UIs (such as the web application that
you can use to view deployed applications) be augmented with Spring Boot actuator
information. For example, an application status page may include full health information
instead of the typical &#8220;running&#8221; or &#8220;stopped&#8221; status.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">/cloudfoundryapplication</code> path is not directly accessible to regular users.
In order to use the endpoint, a valid UAA token must be passed with the request.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-cloudfoundry-disable" href="#production-ready-cloudfoundry-disable"></a>61.1&nbsp;Disabling Extended Cloud Foundry Actuator Support</h2></div></div></div><p>If you want to fully disable the <code class="literal">/cloudfoundryapplication</code> endpoints, you can add the
following setting to your <code class="literal">application.properties</code> file:</p><p><b>application.properties.&nbsp;</b>
</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.cloudfoundry.enabled</span>=false</pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="production-ready-cloudfoundry-ssl" href="#production-ready-cloudfoundry-ssl"></a>61.2&nbsp;Cloud Foundry Self-signed Certificates</h2></div></div></div><p>By default, the security verification for <code class="literal">/cloudfoundryapplication</code> endpoints makes SSL
calls to various Cloud Foundry services. If your Cloud Foundry UAA or Cloud Controller
services use self-signed certificates, you need to set the following property:</p><p><b>application.properties.&nbsp;</b>
</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">management.cloudfoundry.skip-ssl-validation</span>=true</pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_custom_context_path" href="#_custom_context_path"></a>61.3&nbsp;Custom context path</h2></div></div></div><p>If the server&#8217;s context-path has been configured to anything other than <code class="literal">/</code>, the Cloud
Foundry endpoints will not be available at the root of the application. For example, if
<code class="literal">server.servlet.context-path=/app</code>, Cloud Foundry endpoints will be available at
<code class="literal">/app/cloudfoundryapplication/*</code>.</p><p>If you expect the Cloud Foundry endpoints to always be available at
<code class="literal">/cloudfoundryapplication/*</code>, regardless of the server&#8217;s context-path, you will need to
explicitly configure that in your application. The configuration will differ depending on
the web server in use. For Tomcat, the following configuration can be added:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> TomcatServletWebServerFactory servletWebServerFactory() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> TomcatServletWebServerFactory() {

		<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">protected</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> prepareContext(Host host,
				ServletContextInitializer[] initializers) {
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">super</span>.prepareContext(host, initializers);
			StandardContext child = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> StandardContext();
			child.addLifecycleListener(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> Tomcat.FixContextListener());
			child.setPath(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/cloudfoundryapplication"</span>);
			ServletContainerInitializer initializer = getServletContextInitializer(
					getContextPath());
			child.addServletContainerInitializer(initializer, Collections.emptySet());
			child.setCrossContext(true);
			host.addChild(child);
		}

	};
}

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> ServletContainerInitializer getServletContextInitializer(String contextPath) {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> (c, context) -&gt; {
		Servlet servlet = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> GenericServlet() {

			<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> service(ServletRequest req, ServletResponse res)
					<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throws</span> ServletException, IOException {
				ServletContext context = req.getServletContext()
						.getContext(contextPath);
				context.getRequestDispatcher(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/cloudfoundryapplication"</span>).forward(req,
						res);
			}

		};
		context.addServlet(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"cloudfoundry"</span>, servlet).addMapping(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"/*"</span>);
	};
}</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="production-ready-process-monitoring.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="production-ready.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="production-ready-whats-next.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">60.&nbsp;Process Monitoring&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;62.&nbsp;What to Read Next</td></tr></table></div></body></html>