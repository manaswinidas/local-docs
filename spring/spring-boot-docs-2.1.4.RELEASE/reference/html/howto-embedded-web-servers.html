<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>78.&nbsp;Embedded Web Servers</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Spring Boot Reference Guide"><link rel="up" href="howto.html" title="Part&nbsp;IX.&nbsp;&#8216;How-to&#8217; guides"><link rel="prev" href="howto-properties-and-configuration.html" title="77.&nbsp;Properties and Configuration"><link rel="next" href="howto-spring-mvc.html" title="79.&nbsp;Spring MVC"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">78.&nbsp;Embedded Web Servers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="howto-properties-and-configuration.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IX.&nbsp;&#8216;How-to&#8217; guides</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="howto-spring-mvc.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="howto-embedded-web-servers" href="#howto-embedded-web-servers"></a>78.&nbsp;Embedded Web Servers</h2></div></div></div><p>Each Spring Boot web application includes an embedded web server. This feature leads to a
number of how-to questions, including how to change the embedded server and how to
configure the embedded server. This section answers those questions.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-another-web-server" href="#howto-use-another-web-server"></a>78.1&nbsp;Use Another Web Server</h2></div></div></div><p>Many Spring Boot starters include default embedded containers.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">For servlet stack applications, the <code class="literal">spring-boot-starter-web</code> includes Tomcat by including
<code class="literal">spring-boot-starter-tomcat</code>, but you can use <code class="literal">spring-boot-starter-jetty</code> or
<code class="literal">spring-boot-starter-undertow</code> instead.</li><li class="listitem">For reactive stack applications, the <code class="literal">spring-boot-starter-webflux</code> includes  Reactor Netty
by including <code class="literal">spring-boot-starter-reactor-netty</code>, but you can use <code class="literal">spring-boot-starter-tomcat</code>,
<code class="literal">spring-boot-starter-jetty</code>, or <code class="literal">spring-boot-starter-undertow</code> instead.</li></ul></div><p>When switching to a different HTTP server, you need to exclude the default dependencies
in addition to including the one you need. Spring Boot provides separate starters for
HTTP servers to help make this process as easy as possible.</p><p>The following Maven example shows how to exclude Tomcat and include Jetty for Spring MVC:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;properties&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;servlet-api.version&gt;</span>3.1.0<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/servlet-api.version&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/properties&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;dependency&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;groupId&gt;</span>org.springframework.boot<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/groupId&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/artifactId&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;exclusions&gt;</span>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">&lt;!-- Exclude the Tomcat dependency --&gt;</span>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;exclusion&gt;</span>
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;groupId&gt;</span>org.springframework.boot<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/groupId&gt;</span>
			<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/artifactId&gt;</span>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/exclusion&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/exclusions&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/dependency&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">&lt;!-- Use Jetty instead --&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;dependency&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;groupId&gt;</span>org.springframework.boot<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/groupId&gt;</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;artifactId&gt;</span>spring-boot-starter-jetty<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/artifactId&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/dependency&gt;</span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The version of the Servlet API has been overridden as, unlike Tomcat 9 and Undertow
2.0, Jetty 9.4 does not support Servlet 4.0.</p></td></tr></table></div><p>The following Gradle example shows how to exclude Netty and include Undertow for Spring
WebFlux:</p><pre class="programlisting">configurations {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// exclude Reactor Netty</span>
	compile.exclude module: <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'spring-boot-starter-reactor-netty'</span>
}

dependencies {
	compile <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'org.springframework.boot:spring-boot-starter-webflux'</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// Use Undertow instead</span>
	compile <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'org.springframework.boot:spring-boot-starter-undertow'</span>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">spring-boot-starter-reactor-netty</code> is required to use the <code class="literal">WebClient</code> class, so
you may need to keep a dependency on Netty even when you need to include a different HTTP
server.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-disable-web-server" href="#howto-disable-web-server"></a>78.2&nbsp;Disabling the Web Server</h2></div></div></div><p>If your classpath contains the necessary bits to start a web server, Spring Boot will
automatically start it. To disable this behaviour configure the <code class="literal">WebApplicationType</code> in
your <code class="literal">application.properties</code>, as shown in the following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">spring.main.web-application-type</span>=none</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-change-the-http-port" href="#howto-change-the-http-port"></a>78.3&nbsp;Change the HTTP Port</h2></div></div></div><p>In a standalone application, the main HTTP port defaults to <code class="literal">8080</code> but can be set with
<code class="literal">server.port</code> (for example, in <code class="literal">application.properties</code> or as a System property). Thanks
to relaxed binding of <code class="literal">Environment</code> values, you can also use <code class="literal">SERVER_PORT</code> (for example,
as an OS environment variable).</p><p>To switch off the HTTP endpoints completely but still create a <code class="literal">WebApplicationContext</code>,
use <code class="literal">server.port=-1</code>. (Doing so is sometimes useful for testing.)</p><p>For more details, see
&#8220;<a class="xref" href="boot-features-developing-web-applications.html#boot-features-customizing-embedded-containers" title="29.4.4&nbsp;Customizing Embedded Servlet Containers">Section&nbsp;29.4.4, &#8220;Customizing Embedded Servlet Containers&#8221;</a>&#8221;
in the &#8216;Spring Boot features&#8217; section, or the
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_top"><code class="literal">ServerProperties</code></a> source
code.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-user-a-random-unassigned-http-port" href="#howto-user-a-random-unassigned-http-port"></a>78.4&nbsp;Use a Random Unassigned HTTP Port</h2></div></div></div><p>To scan for a free port (using OS natives to prevent clashes) use <code class="literal">server.port=0</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-discover-the-http-port-at-runtime" href="#howto-discover-the-http-port-at-runtime"></a>78.5&nbsp;Discover the HTTP Port at Runtime</h2></div></div></div><p>You can access the port the server is running on from log output or from the
<code class="literal">ServletWebServerApplicationContext</code> through its <code class="literal">WebServer</code>. The best way to get that and
be sure that it has been initialized is to add a <code class="literal">@Bean</code> of type
<code class="literal">ApplicationListener&lt;ServletWebServerInitializedEvent&gt;</code> and pull the container
out of the event when it is published.</p><p>Tests that use <code class="literal">@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code> can
also inject the actual port into a field by using the <code class="literal">@LocalServerPort</code> annotation, as
shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@RunWith(SpringJUnit4ClassRunner.class)</xslthl:annotation>
<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyWebIntegrationTests {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Autowired</xslthl:annotation>
	ServletWebServerApplicationContext server;

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@LocalServerPort</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">int</span> port;

	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// ...</span>

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">@LocalServerPort</code> is a meta-annotation for <code class="literal">@Value("${local.server.port}")</code>. Do not try
to inject the port in a regular application. As we just saw, the value is set only after
the container has been initialized. Contrary to a test, application code callbacks are
processed early (before the value is actually available).</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="how-to-enable-http-response-compression" href="#how-to-enable-http-response-compression"></a>78.6&nbsp;Enable HTTP Response Compression</h2></div></div></div><p>HTTP response compression is supported by Jetty, Tomcat, and Undertow. It can be enabled
in <code class="literal">application.properties</code>, as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.compression.enabled</span>=true</pre><p>By default, responses must be at least 2048 bytes in length for compression to be
performed. You can configure this behavior by setting the
<code class="literal">server.compression.min-response-size</code> property.</p><p>By default, responses are compressed only if their content type is one of the
following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">text/html</code></li><li class="listitem"><code class="literal">text/xml</code></li><li class="listitem"><code class="literal">text/plain</code></li><li class="listitem"><code class="literal">text/css</code></li><li class="listitem"><code class="literal">text/javascript</code></li><li class="listitem"><code class="literal">application/javascript</code></li><li class="listitem"><code class="literal">application/json</code></li><li class="listitem"><code class="literal">application/xml</code></li></ul></div><p>You can configure this behavior by setting the <code class="literal">server.compression.mime-types</code> property.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-ssl" href="#howto-configure-ssl"></a>78.7&nbsp;Configure SSL</h2></div></div></div><p>SSL can be configured declaratively by setting the various <code class="literal">server.ssl.*</code> properties,
typically in <code class="literal">application.properties</code> or <code class="literal">application.yml</code>. The following example shows
setting SSL properties in <code class="literal">application.properties</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.port</span>=8443
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.ssl.key-store</span>=classpath:keystore.jks
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.ssl.key-store-password</span>=secret
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.ssl.key-password</span>=another-secret</pre><p>See <a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/server/Ssl.java" target="_top"><code class="literal">Ssl</code></a> for details of all of the
supported properties.</p><p>Using configuration such as the preceding example means the application no longer supports
a plain HTTP connector at port 8080. Spring Boot does not support the configuration of
both an HTTP connector and an HTTPS connector through <code class="literal">application.properties</code>. If you
want to have both, you need to configure one of them programmatically. We recommend using
<code class="literal">application.properties</code> to configure HTTPS, as the HTTP connector is the easier of the
two to configure programmatically. See the
<a class="link" href="https://github.com/spring-projects/spring-boot/tree/v2.1.4.RELEASE/spring-boot-samples/spring-boot-sample-tomcat-multi-connectors" target="_top"><code class="literal">spring-boot-sample-tomcat-multi-connectors</code></a>
sample project for an example.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-http2" href="#howto-configure-http2"></a>78.8&nbsp;Configure HTTP/2</h2></div></div></div><p>You can enable HTTP/2 support in your Spring Boot application with the
<code class="literal">server.http2.enabled</code> configuration property. This support depends on the chosen web
server and the application environment, since that protocol is not supported
out-of-the-box by JDK8.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Spring Boot does not support <code class="literal">h2c</code>, the cleartext version of the HTTP/2 protocol. So you
must <a class="link" href="howto-embedded-web-servers.html#howto-configure-ssl" title="78.7&nbsp;Configure SSL">configure SSL first</a>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-configure-http2-undertow" href="#howto-configure-http2-undertow"></a>78.8.1&nbsp;HTTP/2 with Undertow</h3></div></div></div><p>As of Undertow 1.4.0+, HTTP/2 is supported without any additional requirement on JDK8.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-configure-http2-jetty" href="#howto-configure-http2-jetty"></a>78.8.2&nbsp;HTTP/2 with Jetty</h3></div></div></div><p>As of Jetty 9.4.8, HTTP/2 is also supported with the
<a class="link" href="https://www.conscrypt.org/" target="_top">Conscrypt library</a>.
To enable that support, your application needs to have two additional dependencies:
<code class="literal">org.eclipse.jetty:jetty-alpn-conscrypt-server</code> and <code class="literal">org.eclipse.jetty.http2:http2-server</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-configure-http2-tomcat" href="#howto-configure-http2-tomcat"></a>78.8.3&nbsp;HTTP/2 with Tomcat</h3></div></div></div><p>Spring Boot ships by default with Tomcat 9.0.x which supports HTTP/2 out of the box when
using JDK 9 or later. Alternatively, HTTP/2 can be used on JDK 8 if the <code class="literal">libtcnative</code>
library and its dependencies are installed on the host operating system.</p><p>The library folder must be made available, if not already, to the JVM library path. You
can do so with a JVM argument such as
<code class="literal">-Djava.library.path=/usr/local/opt/tomcat-native/lib</code>. More on this in the
<a class="link" href="https://tomcat.apache.org/tomcat-9.0-doc/apr.html" target="_top">official Tomcat documentation</a>.</p><p>Starting Tomcat 9.0.x on JDK 8 without that native support logs the following error:</p><pre class="screen">ERROR 8787 --- [           main] o.a.coyote.http11.Http11NioProtocol      : The upgrade handler [org.apache.coyote.http2.Http2Protocol] for [h2] only supports upgrade via ALPN but has been configured for the ["https-jsse-nio-8443"] connector that does not support ALPN.</pre><p>This error is not fatal, and the application still starts with HTTP/1.1 SSL support.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-configure-http2-netty" href="#howto-configure-http2-netty"></a>78.8.4&nbsp;HTTP/2 with Reactor Netty</h3></div></div></div><p>The <code class="literal">spring-boot-webflux-starter</code> is using by default Reactor Netty as a server.
Reactor Netty can be configured for HTTP/2 using the JDK support with JDK 9 or later.
For JDK 8 environments, or for optimal runtime performance, this server also supports
HTTP/2 with native libraries. To enable that, your application needs to have an
additional dependency.</p><p>Spring Boot manages the version for the
<code class="literal">io.netty:netty-tcnative-boringssl-static</code> "uber jar", containing native libraries for
all platforms. Developers can choose to import only the required dependencies using
a classifier (see <a class="link" href="https://netty.io/wiki/forked-tomcat-native.html" target="_top">the Netty official
documentation</a>).</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-webserver" href="#howto-configure-webserver"></a>78.9&nbsp;Configure the Web Server</h2></div></div></div><p>Generally, you should first consider using one of the many available configuration keys
and customize your web server by adding new entries in your <code class="literal">application.properties</code> (or
<code class="literal">application.yml</code>, or environment, etc. see
&#8220;<a class="xref" href="howto-properties-and-configuration.html#howto-discover-build-in-options-for-external-properties" title="77.8&nbsp;Discover Built-in Options for External Properties">Section&nbsp;77.8, &#8220;Discover Built-in Options for External Properties&#8221;</a>&#8221;). The <code class="literal">server.*</code>
namespace is quite useful here, and it includes namespaces like <code class="literal">server.tomcat.*</code>,
<code class="literal">server.jetty.*</code> and others, for server-specific features.
See the list of <a class="xref" href="common-application-properties.html" title="Appendix&nbsp;A.&nbsp;Common application properties">Appendix&nbsp;A, <i>Common application properties</i></a>.</p><p>The previous sections covered already many common use cases, such as compression, SSL
or HTTP/2. However, if a configuration key doesn&#8217;t exist for your use case, you should
then look at
<a class="link" href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/api/org/springframework/boot/web/server/WebServerFactoryCustomizer.html" target="_top"><code class="literal">WebServerFactoryCustomizer</code></a>.
You can declare such a component and get access to the server factory relevant to your
choice: you should select the variant for the chosen Server (Tomcat, Jetty, Reactor Netty,
Undertow) and the chosen web stack (Servlet or Reactive).</p><p>The example below is for Tomcat with the <code class="literal">spring-boot-starter-web</code> (Servlet stack):</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Component</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">class</span> MyTomcatWebServerCustomizer
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">implements</span> WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; {

	<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> customize(TomcatServletWebServerFactory factory) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-comment">// customize the factory here</span>
	}
}</pre><p>In addition Spring Boot provides:</p><div class="informaltable"><a name="howto-configure-webserver-customizers" href="#howto-configure-webserver-customizers"></a><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Server</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top">Servlet stack</th><th style="border-bottom: 1px solid ; " align="left" valign="top">Reactive stack</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p>Tomcat</p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">TomcatServletWebServerFactory</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">TomcatReactiveWebServerFactory</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p>Jetty</p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">JettyServletWebServerFactory</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">JettyReactiveWebServerFactory</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p>Undertow</p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">UndertowServletWebServerFactory</code></p></td><td style="border-bottom: 1px solid ; " align="left" valign="top"><p><code class="literal">UndertowReactiveWebServerFactory</code></p></td></tr><tr><td style="border-right: 1px solid ; " align="left" valign="top"><p>Reactor</p></td><td style="border-right: 1px solid ; " align="left" valign="top"><p>N/A</p></td><td style="" align="left" valign="top"><p><code class="literal">NettyReactiveWebServerFactory</code></p></td></tr></tbody></table></div><p>Once you&#8217;ve got access to a <code class="literal">WebServerFactory</code>, you can often add customizers to it to
configure specific parts, like connectors, server resources, or the server itself - all
using server-specific APIs.</p><p>As a last resort, you can also declare your own <code class="literal">WebServerFactory</code> component, which will
override the one provided by Spring Boot. In this case, you can&#8217;t rely on configuration
properties in the <code class="literal">server</code> namespace anymore.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-add-a-servlet-filter-or-listener" href="#howto-add-a-servlet-filter-or-listener"></a>78.10&nbsp;Add a Servlet, Filter, or Listener to an Application</h2></div></div></div><p>In a servlet stack application, i.e. with the <code class="literal">spring-boot-starter-web</code>, there are two
ways to add <code class="literal">Servlet</code>, <code class="literal">Filter</code>, <code class="literal">ServletContextListener</code>, and the other listeners
supported by the Servlet API to your application:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="xref" href="howto-embedded-web-servers.html#howto-add-a-servlet-filter-or-listener-as-spring-bean" title="78.10.1&nbsp;Add a Servlet, Filter, or Listener by Using a Spring Bean">Section&nbsp;78.10.1, &#8220;Add a Servlet, Filter, or Listener by Using a Spring Bean&#8221;</a></li><li class="listitem"><a class="xref" href="howto-embedded-web-servers.html#howto-add-a-servlet-filter-or-listener-using-scanning" title="78.10.2&nbsp;Add Servlets, Filters, and Listeners by Using Classpath Scanning">Section&nbsp;78.10.2, &#8220;Add Servlets, Filters, and Listeners by Using Classpath Scanning&#8221;</a></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-add-a-servlet-filter-or-listener-as-spring-bean" href="#howto-add-a-servlet-filter-or-listener-as-spring-bean"></a>78.10.1&nbsp;Add a Servlet, Filter, or Listener by Using a Spring Bean</h3></div></div></div><p>To add a <code class="literal">Servlet</code>, <code class="literal">Filter</code>, or Servlet <code class="literal">*Listener</code> by using a Spring bean, you must
provide a <code class="literal">@Bean</code> definition for it. Doing so can be very useful when you want to inject
configuration or dependencies. However, you must be very careful that they do not cause
eager initialization of too many other beans, because they have to be installed in the
container very early in the application lifecycle. (For example, it is not a good idea to
have them depend on your <code class="literal">DataSource</code> or JPA configuration.) You can work around such
restrictions by initializing the beans lazily when first used instead of on
initialization.</p><p>In the case of <code class="literal">Filters</code> and <code class="literal">Servlets</code>, you can also add mappings and init parameters by
adding a <code class="literal">FilterRegistrationBean</code> or a <code class="literal">ServletRegistrationBean</code> instead of or in
addition to the underlying component.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If no <code class="literal">dispatcherType</code> is specified on a filter registration, <code class="literal">REQUEST</code> is used. This
aligns with the Servlet Specification&#8217;s default dispatcher type.</p></td></tr></table></div><p>Like any other Spring bean, you can define the order of Servlet filter beans; please
make sure to check the
&#8220;<a class="xref" href="boot-features-developing-web-applications.html#boot-features-embedded-container-servlets-filters-listeners-beans" title="Registering Servlets, Filters, and Listeners as Spring Beans">the section called &#8220;Registering Servlets, Filters, and Listeners as Spring Beans&#8221;</a>&#8221;
section.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="howto-disable-registration-of-a-servlet-or-filter" href="#howto-disable-registration-of-a-servlet-or-filter"></a>Disable Registration of a Servlet or Filter</h4></div></div></div><p>As <a class="link" href="howto-embedded-web-servers.html#howto-add-a-servlet-filter-or-listener-as-spring-bean" title="78.10.1&nbsp;Add a Servlet, Filter, or Listener by Using a Spring Bean">described earlier</a>, any
<code class="literal">Servlet</code> or <code class="literal">Filter</code> beans are registered with the servlet container automatically. To
disable registration of a particular <code class="literal">Filter</code> or <code class="literal">Servlet</code> bean, create a registration
bean for it and mark it as disabled, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> FilterRegistrationBean registration(MyFilter filter) {
	FilterRegistrationBean registration = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> FilterRegistrationBean(filter);
	registration.setEnabled(false);
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> registration;
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-add-a-servlet-filter-or-listener-using-scanning" href="#howto-add-a-servlet-filter-or-listener-using-scanning"></a>78.10.2&nbsp;Add Servlets, Filters, and Listeners by Using Classpath Scanning</h3></div></div></div><p><code class="literal">@WebServlet</code>, <code class="literal">@WebFilter</code>, and <code class="literal">@WebListener</code> annotated classes can be automatically
registered with an embedded servlet container by annotating a <code class="literal">@Configuration</code> class
with <code class="literal">@ServletComponentScan</code> and specifying the package(s) containing the components
that you want to register. By default, <code class="literal">@ServletComponentScan</code> scans from the package
of the annotated class.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-configure-accesslogs" href="#howto-configure-accesslogs"></a>78.11&nbsp;Configure Access Logging</h2></div></div></div><p>Access logs can be configured for Tomcat, Undertow, and Jetty through their respective
namespaces.</p><p>For instance, the following settings log access on Tomcat with a
<a class="link" href="https://tomcat.apache.org/tomcat-8.5-doc/config/valve.html#Access_Logging" target="_top">custom pattern</a>.</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.tomcat.basedir</span>=my-tomcat
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.tomcat.accesslog.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.tomcat.accesslog.pattern</span>=%t %a "%r" %s (%D ms)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The default location for logs is a <code class="literal">logs</code> directory relative to the Tomcat base
directory. By default, the <code class="literal">logs</code> directory is a temporary directory, so you may want to
fix Tomcat&#8217;s base directory or use an absolute path for the logs. In the preceding
example, the logs are available in <code class="literal">my-tomcat/logs</code> relative to the working directory of
the application.</p></td></tr></table></div><p>Access logging for Undertow can be configured in a similar fashion, as shown in the
following example:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.undertow.accesslog.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.undertow.accesslog.pattern</span>=%t %a "%r" %s (%D ms)</pre><p>Logs are stored in a <code class="literal">logs</code> directory relative to the working directory of the
application. You can customize this location by setting the
<code class="literal">server.undertow.accesslog.directory</code> property.</p><p>Finally, access logging for Jetty can also be configured as follows:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.jetty.accesslog.enabled</span>=true
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-attribute">server.jetty.accesslog.filename</span>=/var/log/jetty-access.log</pre><p>By default, logs are redirected to <code class="literal">System.err</code>. For more details, see
<a class="link" href="https://www.eclipse.org/jetty/documentation/9.4.x/configuring-jetty-request-logs.html" target="_top">the Jetty documentation</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-tomcat-behind-a-proxy-server" href="#howto-use-tomcat-behind-a-proxy-server"></a>78.12&nbsp;Running Behind a Front-end Proxy Server</h2></div></div></div><p>Your application might need to send <code class="literal">302</code> redirects or render content with absolute links
back to itself. When running behind a proxy, the caller wants a link to the proxy and not
to the physical address of the machine hosting your app. Typically, such situations are
handled through a contract with the proxy, which adds headers to tell the back end how to
construct links to itself.</p><p>If the proxy adds conventional <code class="literal">X-Forwarded-For</code> and <code class="literal">X-Forwarded-Proto</code> headers (most
proxy servers do so), the absolute links should be rendered correctly, provided
<code class="literal">server.use-forward-headers</code> is set to <code class="literal">true</code> in your <code class="literal">application.properties</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If your application runs in Cloud Foundry or Heroku, the
<code class="literal">server.use-forward-headers</code> property defaults to <code class="literal">true</code>. In all
other instances, it defaults to <code class="literal">false</code>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="howto-customize-tomcat-behind-a-proxy-server" href="#howto-customize-tomcat-behind-a-proxy-server"></a>78.12.1&nbsp;Customize Tomcat&#8217;s Proxy Configuration</h3></div></div></div><p>If you use Tomcat, you can additionally configure the names of the headers used to
carry &#8220;forwarded&#8221; information, as shown in the following example:</p><pre class="screen">server.tomcat.remote-ip-header=x-your-remote-ip-header
server.tomcat.protocol-header=x-your-protocol-header</pre><p>Tomcat is also configured with a default regular expression that matches internal
proxies that are to be trusted. By default, IP addresses in <code class="literal">10/8</code>, <code class="literal">192.168/16</code>,
<code class="literal">169.254/16</code> and <code class="literal">127/8</code> are trusted. You can customize the valve&#8217;s configuration by
adding an entry to <code class="literal">application.properties</code>, as shown in the following example:</p><pre class="screen">server.tomcat.internal-proxies=192\\.168\\.\\d{1,3}\\.\\d{1,3}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The double backslashes are required only when you use a properties file for
configuration. If you use YAML, single backslashes are sufficient, and a value
equivalent to that shown in the preceding example would be <code class="literal">192\.168\.\d{1,3}\.\d{1,3}</code>.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can trust all proxies by setting the <code class="literal">internal-proxies</code> to empty (but do not do
so in production).</p></td></tr></table></div><p>You can take complete control of the configuration of Tomcat&#8217;s <code class="literal">RemoteIpValve</code> by
switching the automatic one off (to do so, set <code class="literal">server.use-forward-headers=false</code>) and
adding a new valve instance in a <code class="literal">TomcatServletWebServerFactory</code> bean.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-enable-multiple-connectors-in-tomcat" href="#howto-enable-multiple-connectors-in-tomcat"></a>78.13&nbsp;Enable Multiple Connectors with Tomcat</h2></div></div></div><p>You can add an <code class="literal">org.apache.catalina.connector.Connector</code> to the
<code class="literal">TomcatServletWebServerFactory</code>, which can allow multiple connectors, including HTTP and
HTTPS connectors, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> ServletWebServerFactory servletContainer() {
	TomcatServletWebServerFactory tomcat = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> TomcatServletWebServerFactory();
	tomcat.addAdditionalTomcatConnectors(createSslConnector());
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> tomcat;
}

<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">private</span> Connector createSslConnector() {
	Connector connector = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> Connector(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"org.apache.coyote.http11.Http11NioProtocol"</span>);
	Http11NioProtocol protocol = (Http11NioProtocol) connector.getProtocolHandler();
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">try</span> {
		File keystore = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> ClassPathResource(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"keystore"</span>).getFile();
		File truststore = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> ClassPathResource(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"keystore"</span>).getFile();
		connector.setScheme(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"https"</span>);
		connector.setSecure(true);
		connector.setPort(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">8443</xslthl:number>);
		protocol.setSSLEnabled(true);
		protocol.setKeystoreFile(keystore.getAbsolutePath());
		protocol.setKeystorePass(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"changeit"</span>);
		protocol.setTruststoreFile(truststore.getAbsolutePath());
		protocol.setTruststorePass(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"changeit"</span>);
		protocol.setKeyAlias(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"apitester"</span>);
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> connector;
	}
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">catch</span> (IOException ex) {
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">throw</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> IllegalStateException(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"can't access keystore: ["</span> + <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"keystore"</span>
				+ <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"] or truststore: ["</span> + <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"keystore"</span> + <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"]"</span>, ex);
	}
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-use-tomcat-legacycookieprocessor" href="#howto-use-tomcat-legacycookieprocessor"></a>78.14&nbsp;Use Tomcat&#8217;s LegacyCookieProcessor</h2></div></div></div><p>By default, the embedded Tomcat used by Spring Boot does not support "Version 0" of the
Cookie format, so you may see the following error:</p><pre class="screen">java.lang.IllegalArgumentException: An invalid character [32] was present in the Cookie value</pre><p>If at all possible, you should consider updating your code to only store values
compliant with later Cookie specifications. If, however, you cannot change the
way that cookies are written, you can instead configure Tomcat to use a
<code class="literal">LegacyCookieProcessor</code>. To switch to the <code class="literal">LegacyCookieProcessor</code>, use an
<code class="literal">WebServerFactoryCustomizer</code> bean that adds a <code class="literal">TomcatContextCustomizer</code>, as shown
in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; cookieProcessorCustomizer() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> (factory) -&gt; factory.addContextCustomizers(
			(context) -&gt; context.setCookieProcessor(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> LegacyCookieProcessor()));
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-enable-multiple-listeners-in-undertow" href="#howto-enable-multiple-listeners-in-undertow"></a>78.15&nbsp;Enable Multiple Listeners with Undertow</h2></div></div></div><p>Add an <code class="literal">UndertowBuilderCustomizer</code> to the <code class="literal">UndertowServletWebServerFactory</code> and
add a listener to the <code class="literal">Builder</code>, as shown in the following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> UndertowServletWebServerFactory servletWebServerFactory() {
	UndertowServletWebServerFactory factory = <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> UndertowServletWebServerFactory();
	factory.addBuilderCustomizers(<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> UndertowBuilderCustomizer() {

		<xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Override</xslthl:annotation>
		<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">void</span> customize(Builder builder) {
			builder.addHttpListener(<xslthl:number xmlns:xslthl="http://xslthl.sourceforge.net/">8080</xslthl:number>, <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">"0.0.0.0"</span>);
		}

	});
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> factory;
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="howto-create-websocket-endpoints-using-serverendpoint" href="#howto-create-websocket-endpoints-using-serverendpoint"></a>78.16&nbsp;Create WebSocket Endpoints Using @ServerEndpoint</h2></div></div></div><p>If you want to use <code class="literal">@ServerEndpoint</code> in a Spring Boot application that used an embedded
container, you must declare a single <code class="literal">ServerEndpointExporter</code> <code class="literal">@Bean</code>, as shown in the
following example:</p><pre class="programlisting"><xslthl:annotation xmlns:xslthl="http://xslthl.sourceforge.net/">@Bean</xslthl:annotation>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">public</span> ServerEndpointExporter serverEndpointExporter() {
	<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">return</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">new</span> ServerEndpointExporter();
}</pre><p>The bean shown in the preceding example registers any <code class="literal">@ServerEndpoint</code> annotated beans
with the underlying WebSocket container. When deployed to a standalone servlet container,
this role is performed by a servlet container initializer, and the
<code class="literal">ServerEndpointExporter</code> bean is not required.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="howto-properties-and-configuration.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="howto.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="howto-spring-mvc.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">77.&nbsp;Properties and Configuration&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;79.&nbsp;Spring MVC</td></tr></table></div></body></html>