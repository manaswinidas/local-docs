<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Arjen Poutsma, Rick Evans, Tareq Abed Rabbo, Greg Turnquist">
<title>Spring Web Services Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>Spring Web Services Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Arjen Poutsma, Rick Evans, Tareq Abed Rabbo, Greg Turnquist</span><br>
<span id="revnumber">version 3.0.7.RELEASE,</span>
<span id="revdate">2019-04-24</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2005-2017 The original authors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
</td>
</tr>
</table>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview">Preface</a></li>
<li><a href="#_i_introduction">I. Introduction</a>
<ul class="sectlevel1">
<li><a href="#what-is-spring-ws">1. What is Spring Web Services?</a>
<ul class="sectlevel2">
<li><a href="#_introduction">1.1. Introduction</a>
<ul class="sectlevel3">
<li><a href="#_powerful_mappings">1.1.1. Powerful mappings</a></li>
<li><a href="#_xml_api_support">1.1.2. XML API support</a></li>
<li><a href="#_flexible_xml_marshalling">1.1.3. Flexible XML Marshalling</a></li>
<li><a href="#_reuses_your_spring_expertise">1.1.4. Reuses your Spring expertise</a></li>
<li><a href="#_supports_ws_security">1.1.5. Supports WS-Security</a></li>
<li><a href="#_integrates_with_spring_security">1.1.6. Integrates with Spring Security</a></li>
<li><a href="#_apache_license">1.1.7. Apache license</a></li>
</ul>
</li>
<li><a href="#_runtime_environment">1.2. Runtime environment</a></li>
<li><a href="#_supported_standards">1.3. Supported standards</a></li>
</ul>
</li>
<li><a href="#why-contract-first">2. Why Contract First?</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">2.1. Introduction</a></li>
<li><a href="#_object_xml_impedance_mismatch">2.2. Object/XML Impedance Mismatch</a>
<ul class="sectlevel3">
<li><a href="#_xsd_extensions">2.2.1. XSD extensions</a></li>
<li><a href="#_unportable_types">2.2.2. Unportable types</a></li>
<li><a href="#_cyclic_graphs">2.2.3. Cyclic graphs</a></li>
</ul>
</li>
<li><a href="#_contract_first_versus_contract_last">2.3. Contract-first versus Contract-last</a>
<ul class="sectlevel3">
<li><a href="#_fragility">2.3.1. Fragility</a></li>
<li><a href="#_performance">2.3.2. Performance</a></li>
<li><a href="#_reusability">2.3.3. Reusability</a></li>
<li><a href="#_versioning">2.3.4. Versioning</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tutorial">3. Writing Contract-First Web Services</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">3.1. Introduction</a></li>
<li><a href="#_messages">3.2. Messages</a>
<ul class="sectlevel3">
<li><a href="#_holiday">3.2.1. Holiday</a></li>
<li><a href="#_employee">3.2.2. Employee</a></li>
<li><a href="#_holidayrequest">3.2.3. HolidayRequest</a></li>
</ul>
</li>
<li><a href="#tutorial.xsd">3.3. Data Contract</a></li>
<li><a href="#tutorial-service-contract">3.4. Service contract</a></li>
<li><a href="#tutorial-creating-project">3.5. Creating the project</a></li>
<li><a href="#tutorial.implementing.endpoint">3.6. Implementing the Endpoint</a>
<ul class="sectlevel3">
<li><a href="#_handling_the_xml_message">3.6.1. Handling the XML Message</a></li>
<li><a href="#_routing_the_message_to_the_endpoint">3.6.2. Routing the Message to the Endpoint</a></li>
<li><a href="#_providing_the_service_and_stub_implementation">3.6.3. Providing the Service and Stub implementation</a></li>
</ul>
</li>
<li><a href="#tutorial-publishing-wsdl">3.7. Publishing the WSDL</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ii_reference">II. Reference</a>
<ul class="sectlevel1">
<li><a href="#common">4. Shared components</a>
<ul class="sectlevel2">
<li><a href="#web-service-messages">4.1. Web service messages</a>
<ul class="sectlevel3">
<li><a href="#web-service-message">4.1.1. <code>WebServiceMessage</code></a></li>
<li><a href="#soap-message">4.1.2. <code>SoapMessage</code></a></li>
<li><a href="#message-factories">4.1.3. Message Factories</a></li>
<li><a href="#message-context">4.1.4. <code>MessageContext</code></a></li>
</ul>
</li>
<li><a href="#transport-context">4.2. <code>TransportContext</code></a></li>
<li><a href="#xpath">4.3. Handling XML With XPath</a>
<ul class="sectlevel3">
<li><a href="#xpath-expression">4.3.1. <code>XPathExpression</code></a></li>
<li><a href="#xpath-template">4.3.2. <code>XPathTemplate</code></a></li>
</ul>
</li>
<li><a href="#logging">4.4. Message Logging and Tracing</a></li>
</ul>
</li>
<li><a href="#server">5. Creating a Web service with Spring-WS</a>
<ul class="sectlevel2">
<li><a href="#ws-introduction">5.1. Introduction</a></li>
<li><a href="#_the_code_messagedispatcher_code">5.2. The <code>MessageDispatcher</code></a></li>
<li><a href="#_transports">5.3. Transports</a>
<ul class="sectlevel3">
<li><a href="#message-dispatcher-servlet">5.3.1. <code>MessageDispatcherServlet</code></a></li>
<li><a href="#_wiring_up_spring_ws_in_a_code_dispatcherservlet_code">5.3.2. Wiring up Spring-WS in a <code>DispatcherServlet</code></a></li>
<li><a href="#_jms_transport">5.3.3. JMS transport</a></li>
<li><a href="#_email_transport">5.3.4. Email transport</a></li>
<li><a href="#_embedded_http_server_transport">5.3.5. Embedded HTTP Server transport</a></li>
<li><a href="#_xmpp_transport">5.3.6. XMPP transport</a></li>
<li><a href="#_mtom">5.3.7. MTOM</a></li>
</ul>
</li>
<li><a href="#server-endpoints">5.4. Endpoints</a>
<ul class="sectlevel3">
<li><a href="#server-atEndpoint-methods">5.4.1. <code>@Endpoint</code> handling methods</a></li>
</ul>
</li>
<li><a href="#server-endpoint-mapping">5.5. Endpoint mappings</a>
<ul class="sectlevel3">
<li><a href="#server-ws-addressing">5.5.1. WS-Addressing</a></li>
<li><a href="#server-endpoint-interceptor">5.5.2. Intercepting requests - the <code>EndpointInterceptor</code> interface</a></li>
</ul>
</li>
<li><a href="#server-endpoint-exception-resolver">5.6. Handling Exceptions</a>
<ul class="sectlevel3">
<li><a href="#_code_soapfaultmappingexceptionresolver_code">5.6.1. <code>SoapFaultMappingExceptionResolver</code></a></li>
<li><a href="#_code_soapfaultannotationexceptionresolver_code">5.6.2. <code>SoapFaultAnnotationExceptionResolver</code></a></li>
</ul>
</li>
<li><a href="#_server_side_testing">5.7. Server-side testing</a>
<ul class="sectlevel3">
<li><a href="#_writing_server_side_integration_tests">5.7.1. Writing server-side integration tests</a></li>
<li><a href="#server-test-request-creator">5.7.2. <code>RequestCreator</code> and <code>RequestCreators</code></a></li>
<li><a href="#server-test-response-matcher">5.7.3. <code>ResponseMatcher</code> and <code>ResponseMatchers</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#client">6. Using Spring Web Services on the Client</a>
<ul class="sectlevel2">
<li><a href="#_introduction_4">6.1. Introduction</a></li>
<li><a href="#_using_the_client_side_api">6.2. Using the client-side API</a>
<ul class="sectlevel3">
<li><a href="#client-web-service-template">6.2.1. <code>WebServiceTemplate</code></a></li>
<li><a href="#_sending_and_receiving_a_code_webservicemessage_code">6.2.2. Sending and receiving a <code>WebServiceMessage</code></a></li>
<li><a href="#_sending_and_receiving_pojos_marshalling_and_unmarshalling">6.2.3. Sending and receiving POJOs - marshalling and unmarshalling</a></li>
<li><a href="#_code_webservicemessagecallback_code">6.2.4. <code>WebServiceMessageCallback</code></a></li>
<li><a href="#_code_webservicemessageextractor_code">6.2.5. <code>WebServiceMessageExtractor</code></a></li>
</ul>
</li>
<li><a href="#_client_side_testing">6.3. Client-side testing</a>
<ul class="sectlevel3">
<li><a href="#_writing_client_side_integration_tests">6.3.1. Writing client-side integration tests</a></li>
<li><a href="#client-test-request-matcher">6.3.2. <code>RequestMatcher</code> and <code>RequestMatchers</code></a></li>
<li><a href="#client-test-response-creator">6.3.3. <code>ResponseCreator</code> and <code>ResponseCreators</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security">7. Securing your Web services with Spring-WS</a>
<ul class="sectlevel2">
<li><a href="#security-introduction">7.1. Introduction</a></li>
<li><a href="#security-xws-security-interceptor">7.2. <code>XwsSecurityInterceptor</code></a>
<ul class="sectlevel3">
<li><a href="#keystore">7.2.1. Keystores</a></li>
<li><a href="#_authentication">7.2.2. Authentication</a></li>
<li><a href="#_digital_signatures">7.2.3. Digital Signatures</a></li>
<li><a href="#_encryption_and_decryption">7.2.4. Encryption and Decryption</a></li>
<li><a href="#security-xws-exception-handling">7.2.5. Security Exception Handling</a></li>
</ul>
</li>
<li><a href="#security-wss4j-security-interceptor">7.3. <code>Wss4jSecurityInterceptor</code></a>
<ul class="sectlevel3">
<li><a href="#_configuring_code_wss4jsecurityinterceptor_code">7.3.1. Configuring <code>Wss4jSecurityInterceptor</code></a></li>
<li><a href="#_handling_digital_certificates">7.3.2. Handling Digital Certificates</a></li>
<li><a href="#_authentication_2">7.3.3. Authentication</a></li>
<li><a href="#_security_timestamps">7.3.4. Security Timestamps</a></li>
<li><a href="#security-wss4j-digital-signatures">7.3.5. Digital Signatures</a></li>
<li><a href="#_encryption_and_decryption_2">7.3.6. Encryption and Decryption</a></li>
<li><a href="#_security_exception_handling">7.3.7. Security Exception Handling</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#resources">III. Other Resources</a>
<ul class="sectlevel1">
<li><a href="#_bibliography">Bibliography</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the current age of Service Oriented Architectures, more and more people are using Web Services to connect previously unconnected systems. Initially, Web services were considered to be just another way to do a Remote Procedure Call (RPC). Over time however, people found out that there is a big difference between RPCs and Web services. Especially when interoperability with other platforms is important, it is often better to send encapsulated XML documents, containing all the data necessary to process the request. Conceptually, XML-based Web services are better off being compared to message queues rather than remoting solutions. Overall, XML should be considered the platform-neutral representation of data, the  <strong>interlingua</strong> of SOA. When developing or using Web services, the focus should be on this XML, and not on Java.</p>
</div>
<div class="paragraph">
<p>Spring Web Services focuses on creating these document-driven Web services. Spring Web Services facilitates contract-first SOAP service development, allowing for the creation of flexible web services using one of the many ways to manipulate XML payloads. Spring-WS provides a powerful <a href="#server">message dispatching framework</a>, a <a href="#security">WS-Security</a> solution that integrates with your existing application security solution, and a <a href="#client">Client-side API</a> that follows the familiar Spring template pattern.</p>
</div>
</div>
</div>
<h1 id="_i_introduction" class="sect0"><a class="anchor" href="#_i_introduction"></a>I. Introduction</h1>
<div class="openblock partintro">
<div class="content">
This first part of the reference documentation <a href="#what-is-spring-ws">is an overview</a> of Spring Web Services and the underlying concepts. Spring-WS is then introduced, and <a href="#why-contract-first">the concepts</a> behind contract-first Web service development are explained.
</div>
</div>
<div class="sect1">
<h2 id="what-is-spring-ws"><a class="anchor" href="#what-is-spring-ws"></a>1. What is Spring Web Services?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction"><a class="anchor" href="#_introduction"></a>1.1. Introduction</h3>
<div class="paragraph">
<p>Spring Web Services (Spring-WS) is a product of the Spring community focused on creating document-driven Web services. Spring Web Services aims to facilitate contract-first SOAP service development, allowing for the creation of flexible web services using one of the many ways to manipulate XML payloads. The product is based on Spring itself, which means you can use the Spring concepts such as dependency injection as an integral part of your Web service.</p>
</div>
<div class="paragraph">
<p>People use Spring-WS for many reasons, but most are drawn to it after finding alternative SOAP stacks lacking when it comes to following Web service best practices. Spring-WS makes the best practice an easy practice. This includes practices such as the WS-I basic profile, Contract-First development, and having a loose coupling between contract and implementation. The other key features of Spring Web services are:</p>
</div>
<div class="sect3">
<h4 id="_powerful_mappings"><a class="anchor" href="#_powerful_mappings"></a>1.1.1. Powerful mappings</h4>
<div class="paragraph">
<p>You can distribute incoming XML requests to any object, depending on message payload, SOAP Action header, or an XPath expression.</p>
</div>
</div>
<div class="sect3">
<h4 id="_xml_api_support"><a class="anchor" href="#_xml_api_support"></a>1.1.2. XML API support</h4>
<div class="paragraph">
<p>Incoming XML messages can be handled not only with standard JAXP APIs such as DOM, SAX, and StAX, but also JDOM, dom4j, XOM, or even marshalling technologies.</p>
</div>
</div>
<div class="sect3">
<h4 id="_flexible_xml_marshalling"><a class="anchor" href="#_flexible_xml_marshalling"></a>1.1.3. Flexible XML Marshalling</h4>
<div class="paragraph">
<p>Spring Web Services builds on the Object/XML Mapping module in the Spring Framework, which supports JAXB 1 and 2, Castor, XMLBeans, JiBX, and XStream.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reuses_your_spring_expertise"><a class="anchor" href="#_reuses_your_spring_expertise"></a>1.1.4. Reuses your Spring expertise</h4>
<div class="paragraph">
<p>Spring-WS uses Spring application contexts for all configuration, which should help Spring developers get up-to-speed nice and quickly. Also, the architecture of Spring-WS resembles that of Spring-MVC.</p>
</div>
</div>
<div class="sect3">
<h4 id="_supports_ws_security"><a class="anchor" href="#_supports_ws_security"></a>1.1.5. Supports WS-Security</h4>
<div class="paragraph">
<p>WS-Security allows you to sign SOAP messages, encrypt and decrypt them, or authenticate against them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_integrates_with_spring_security"><a class="anchor" href="#_integrates_with_spring_security"></a>1.1.6. Integrates with Spring Security</h4>
<div class="paragraph">
<p>The WS-Security implementation of Spring Web Services provides integration with Spring Security. This means you can use your existing Spring Security configuration for your SOAP service as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_apache_license"><a class="anchor" href="#_apache_license"></a>1.1.7. Apache license</h4>
<div class="paragraph">
<p>You can confidently use Spring-WS in your project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_environment"><a class="anchor" href="#_runtime_environment"></a>1.2. Runtime environment</h3>
<div class="paragraph">
<p>Spring Web Services requires a standard Java 7 Runtime Environment. Java 8 is also supported. Spring-WS is built on Spring Framework 4.0.9, but higher versions are supported.</p>
</div>
<div class="paragraph">
<p>Spring-WS consists of a number of modules, which are described in the remainder of this section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The XML module (<code>spring-xml.jar</code>) contains various XML support classes for Spring Web Services. This module is mainly intended for the Spring-WS framework itself, and not a Web service  developers.</p>
</li>
<li>
<p>The Core module (<code>spring-ws-core.jar</code>) is the central part of the Spring&#8217;s Web services functionality. It provides the central <a href="#web-service-messages"><code>WebServiceMessage</code></a> and <a href="#soap-message"><code>SoapMessage</code></a> interfaces, the <a href="#server">server-side</a> framework, with powerful message dispatching, and the various support classes for implementing Web service endpoints; and the <a href="#client">client-side</a> <code>WebServiceTemplate</code>.</p>
</li>
<li>
<p>The Support module (<code>spring-ws-support.jar</code>) contains additional transports (JMS, Email, and others).</p>
</li>
<li>
<p>The <a href="#security">Security</a> package (<code>spring-ws-security.jar</code>) provides a WS-Security implementation that integrates with the core Web service package. It allows you to add principal tokens, sign, and decrypt and encrypt SOAP messages. Additionally, it allows you to leverage your existing Spring Security security implementation for authentication and authorization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure illustrates the Spring-WS modules and the dependencies between them. Arrows indicate dependencies, i.e. Spring-WS Core depends on Spring-XML and the OXM module found in Spring 3 and higher.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/spring-deps.png" alt="spring deps">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_supported_standards"><a class="anchor" href="#_supported_standards"></a>1.3. Supported standards</h3>
<div class="paragraph">
<p>Spring Web Services supports the following standards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SOAP 1.1 and 1.2</p>
</li>
<li>
<p>WSDL 1.1 and 2.0 (XSD-based generation only supported for WSDL 1.1)</p>
</li>
<li>
<p>WS-I Basic Profile 1.0, 1.1, 1.2 and 2.0</p>
</li>
<li>
<p>WS-Addressing 1.0 and the August 2004 draft</p>
</li>
<li>
<p>SOAP Message Security 1.1, Username Token Profile 1.1, X.509 Certificate Token Profile 1.1, SAML Token Profile 1.1, Kerberos Token Profile 1.1, Basic Security Profile 1.1</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why-contract-first"><a class="anchor" href="#why-contract-first"></a>2. Why Contract First?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>2.1. Introduction</h3>
<div class="paragraph">
<p>When creating Web services, there are two development styles: <strong>Contract Last</strong> and <strong>Contract First</strong>. When using a contract-last approach, you start with the Java code, and let the Web service contract (<strong>WSDL</strong>, see sidebar) be generated from that. When using contract-first, you start with the WSDL contract, and use Java to implement said contract.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>What is WSDL?</strong></p>
</div>
<div class="paragraph">
<p>WSDL stands for Web Services Description Language. A WSDL file is an XML document that describes a Web service. It specifies the location of the service and the operations (or methods) the service exposes. For more information about WSDL, refer to the <a href="https://www.w3.org/TR/wsdl">WSDL specification</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Spring-WS only supports the contract-first development style, and this section explains why.</p>
</div>
</div>
<div class="sect2">
<h3 id="_object_xml_impedance_mismatch"><a class="anchor" href="#_object_xml_impedance_mismatch"></a>2.2. Object/XML Impedance Mismatch</h3>
<div class="paragraph">
<p>Similar to the field of ORM, where we have an <a href="https://en.wikipedia.org/wiki/Object-Relational_impedance_mismatch">Object/Relational impedance mismatch</a>, there is a similar problem when converting Java objects to XML. At first glance, the O/X mapping problem appears simple: create an XML element for each Java object, converting all Java properties and fields to sub-elements or attributes. However, things are not as  simple as they appear: there is a fundamental difference between hierarchical languages such as XML (and especially XSD) and the graph model of Java<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="sect3">
<h4 id="_xsd_extensions"><a class="anchor" href="#_xsd_extensions"></a>2.2.1. XSD extensions</h4>
<div class="paragraph">
<p>In Java, the only way to change the behavior of a class is to subclass it, adding the new behavior to that subclass. In XSD, you can extend a data type by restricting it: that is, constraining the valid values for the elements and attributes. For instance, consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;simpleType name="AirportCode"&gt;
  &lt;restriction base="string"&gt;
      &lt;pattern value="[A-Z][A-Z][A-Z]"/&gt;
  &lt;/restriction&gt;
&lt;/simpleType&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type restricts a XSD string by ways of a regular expression, allowing only three upper case letters. If this type is converted to Java, we will end up with an ordinary  <code>java.lang.String</code>; the regular expression is lost in the conversion process, because Java does not allow for these sorts of extensions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_unportable_types"><a class="anchor" href="#_unportable_types"></a>2.2.2. Unportable types</h4>
<div class="paragraph">
<p>One of the most important goals of a Web service is to be interoperable: to support multiple platforms such as Java, .NET, Python, etc. Because all of these languages have different class libraries, you must use some common, interlingual format to communicate between them. That format is XML, which is supported by all of these languages.</p>
</div>
<div class="paragraph">
<p>Because of this conversion, you must make sure that you use portable types in your service implementation. Consider, for example, a service that returns a  <code>java.util.TreeMap</code>, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public Map getFlights() {
  // use a tree map, to make sure it's sorted
  TreeMap map = new TreeMap();
  map.put("KL1117", "Stockholm");
  ...
  return map;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Undoubtedly, the contents of this map can be converted into some sort of XML, but since there is no <strong>standard</strong> way to describe a map in XML, it will be proprietary. Also, even if it can be converted to XML, many platforms do not have a data structure  similar to the <code>TreeMap</code>. So when a .NET client accesses your Web service, it will probably end up with a <code>System.Collections.Hashtable</code>, which has different semantics.</p>
</div>
<div class="paragraph">
<p>This problem is also present when working on the client side. Consider the following XSD snippet, which describes a service contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;element name="GetFlightsRequest"&gt;
  &lt;complexType&gt;
    &lt;all&gt;
      &lt;element name="departureDate" type="date"/&gt;
      &lt;element name="from" type="string"/&gt;
      &lt;element name="to" type="string"/&gt;
    &lt;/all&gt;
  &lt;/complexType&gt;
&lt;/element&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This contract defines a request that takes an <code>date</code>, which is a XSD datatype representing a year, month, and day. If we call this service from Java, we will probably use  either a <code>java.util.Date</code> or <code>java.util.Calendar</code>. However, both of these classes actually describe times, rather than dates. So, we will actually end up sending data that represents the fourth of April 2007 at midnight (<code>2007-04-04T00:00:00</code>), which is not the same as <code>2007-04-04</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cyclic_graphs"><a class="anchor" href="#_cyclic_graphs"></a>2.2.3. Cyclic graphs</h4>
<div class="paragraph">
<p>Imagine we have the following simple class structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class Flight {
  private String number;
  private List&lt;Passenger&gt; passengers;

  // getters and setters omitted
}

public class Passenger {
  private String name;
  private Flight flight;

  // getters and setters omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a cyclic graph: the <code>Flight</code> refers to the <code>Passenger</code>, which refers to the <code>Flight</code> again. Cyclic graphs like these are quite common in Java. If we took a naive approach to converting this to XML, we will end up with something  like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;flight number="KL1117"&gt;
  &lt;passengers&gt;
    &lt;passenger&gt;
      &lt;name&gt;Arjen Poutsma&lt;/name&gt;
      &lt;flight number="KL1117"&gt;
        &lt;passengers&gt;
          &lt;passenger&gt;
            &lt;name&gt;Arjen Poutsma&lt;/name&gt;
            &lt;flight number="KL1117"&gt;
              &lt;passengers&gt;
                &lt;passenger&gt;
                   &lt;name&gt;Arjen Poutsma&lt;/name&gt;
                   ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will take a pretty long time to finish, because there is no stop condition for this loop.</p>
</div>
<div class="paragraph">
<p>One way to solve this problem is to use references to objects that were already marshalled, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;flight number="KL1117"&gt;
  &lt;passengers&gt;
    &lt;passenger&gt;
      &lt;name&gt;Arjen Poutsma&lt;/name&gt;
      &lt;flight href="KL1117" /&gt;
    &lt;/passenger&gt;
    ...
  &lt;/passengers&gt;
&lt;/flight&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This solves the recursiveness problem, but introduces new ones. For one, you cannot use an XML validator to validate this structure. Another issue is that the standard way to use these references in SOAP (RPC/encoded) has been deprecated in favor of document/literal (see WS-I <a href="http://www.ws-i.org/Profiles/BasicProfile-1.1.html#SOAP_encodingStyle_Attribute">Basic Profile</a>).</p>
</div>
<div class="paragraph">
<p>These are just a few of the problems when dealing with O/X mapping. It is important to respect these issues when writing Web services. The best way to respect them is to focus on the XML completely, while using Java as an implementation language. This is what contract-first is all about.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_contract_first_versus_contract_last"><a class="anchor" href="#_contract_first_versus_contract_last"></a>2.3. Contract-first versus Contract-last</h3>
<div class="paragraph">
<p>Besides the Object/XML Mapping issues mentioned in the previous section, there are other reasons for preferring a contract-first development style.</p>
</div>
<div class="sect3">
<h4 id="_fragility"><a class="anchor" href="#_fragility"></a>2.3.1. Fragility</h4>
<div class="paragraph">
<p>As mentioned earlier, the contract-last development style results in your web service contract (WSDL and your XSD) being generated from your Java contract (usually an interface). If you are using  this approach, you will have no guarantee that the contract stays constant over time. Each time you change your Java contract and redeploy it, there might be subsequent changes to the web service contract.</p>
</div>
<div class="paragraph">
<p>Aditionally, not all SOAP stacks generate the same web service contract from a Java contract. This means changing your current SOAP stack for a different one (for whatever reason), might also change your web service contract.</p>
</div>
<div class="paragraph">
<p>When a web service contract changes, users of the contract will have to be instructed to obtain the new contract and potentially change their code to accommodate for any changes in the contract.</p>
</div>
<div class="paragraph">
<p>In order for a contract to be useful, it must remain constant for as long as possible. If a contract changes, you will have to contact all of the users of your service, and instruct them to get the new  version of the contract.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performance"><a class="anchor" href="#_performance"></a>2.3.2. Performance</h4>
<div class="paragraph">
<p>When Java is automatically transformed into XML, there is no way to be sure as to what is sent across the wire. An object might reference another object, which refers to another, etc. In the end, half of  the objects on the heap in your virtual machine might be converted into XML, which will result in slow response times.</p>
</div>
<div class="paragraph">
<p>When using contract-first, you explicitly describe what XML is sent where, thus making sure that it is exactly what you want.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reusability"><a class="anchor" href="#_reusability"></a>2.3.3. Reusability</h4>
<div class="paragraph">
<p>Defining your schema in a separate file allows you to reuse that file in different scenarios. If you define an <code>AirportCode</code> in a file called <code>airline.xsd</code>, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;simpleType name="AirportCode"&gt;
    &lt;restriction base="string"&gt;
        &lt;pattern value="[A-Z][A-Z][A-Z]"/&gt;
    &lt;/restriction&gt;
&lt;/simpleType&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can reuse this definition in other schemas, or even WSDL files, using an <code>import</code> statement.</p>
</div>
</div>
<div class="sect3">
<h4 id="_versioning"><a class="anchor" href="#_versioning"></a>2.3.4. Versioning</h4>
<div class="paragraph">
<p>Even though a contract must remain constant for as long as possible, they <strong>do</strong> need to be changed sometimes. In Java, this typically results in a new Java interface, such as  <code>AirlineService2</code>, and a (new) implementation of that interface. Of course, the old service must be kept around, because there might be clients who have not migrated  yet.</p>
</div>
<div class="paragraph">
<p>If using contract-first, we can have a looser coupling between contract and implementation. Such a looser coupling allows us to implement both versions of the contract in one class. We could, for  instance, use an XSLT stylesheet to convert any "old-style" messages to the "new-style" messages.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial"><a class="anchor" href="#tutorial"></a>3. Writing Contract-First Web Services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a>3.1. Introduction</h3>
<div class="paragraph">
<p>This tutorial shows you how to write <a href="#why-contract-first">contract-first Web services</a>, that is, developing web services that start with the XML Schema/WSDL contract first followed by the Java code second. Spring-WS focuses on this development style, and this tutorial will help you get started. Note that the first part of this tutorial contains almost no Spring-WS specific information: it is mostly about XML, XSD, and WSDL. The <a href="#tutorial-creating-project">second part</a> focuses on implementing this contract using Spring-WS .</p>
</div>
<div class="paragraph">
<p>The most important thing when doing contract-first Web service development is to try and think in terms of XML. This means that Java-language concepts are of lesser importance. It is the XML that is sent across the wire, and you should focus on that. The fact that Java is used to implement the Web service is an implementation detail. An important detail, but a detail nonetheless.</p>
</div>
<div class="paragraph">
<p>In this tutorial, we will define a Web service that is created by a Human Resources department. Clients can send holiday request forms to this service to book a holiday.</p>
</div>
</div>
<div class="sect2">
<h3 id="_messages"><a class="anchor" href="#_messages"></a>3.2. Messages</h3>
<div class="paragraph">
<p>In this section, we will focus on the actual XML messages that are sent to and from the Web service. We will start out by determining what these messages look like.</p>
</div>
<div class="sect3">
<h4 id="_holiday"><a class="anchor" href="#_holiday"></a>3.2.1. Holiday</h4>
<div class="paragraph">
<p>In the scenario, we have to deal with holiday requests, so it makes sense to determine what a holiday looks like in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;Holiday xmlns="http://mycompany.com/hr/schemas"&gt;
    &lt;StartDate&gt;2006-07-03&lt;/StartDate&gt;
    &lt;EndDate&gt;2006-07-07&lt;/EndDate&gt;
&lt;/Holiday&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A holiday consists of a start date and an end date. We have also decided to use the standard <a href="https://www.cl.cam.ac.uk/~mgk25/iso-time.html">ISO 8601</a> date format for the dates, because that will save a lot of parsing hassle. We have also added a namespace to the element, to make sure our elements can used within other XML documents.</p>
</div>
</div>
<div class="sect3">
<h4 id="_employee"><a class="anchor" href="#_employee"></a>3.2.2. Employee</h4>
<div class="paragraph">
<p>There is also the notion of an employee in the scenario. Here is what it looks like in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;Employee xmlns="http://mycompany.com/hr/schemas"&gt;
    &lt;Number&gt;42&lt;/Number&gt;
    &lt;FirstName&gt;Arjen&lt;/FirstName&gt;
    &lt;LastName&gt;Poutsma&lt;/LastName&gt;
&lt;/Employee&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have used the same namespace as before. If this <code>&lt;Employee/&gt;</code> element could be used in other scenarios, it might make sense to use a different namespace, such as <code><a href="http://mycompany.com/employees/schemas" class="bare">http://mycompany.com/employees/schemas</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_holidayrequest"><a class="anchor" href="#_holidayrequest"></a>3.2.3. HolidayRequest</h4>
<div class="paragraph">
<p>Both the holiday and employee element can be put in a <code>&lt;HolidayRequest/&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;HolidayRequest xmlns="http://mycompany.com/hr/schemas"&gt;
    &lt;Holiday&gt;
        &lt;StartDate&gt;2006-07-03&lt;/StartDate&gt;
        &lt;EndDate&gt;2006-07-07&lt;/EndDate&gt;
    &lt;/Holiday&gt;
    &lt;Employee&gt;
        &lt;Number&gt;42&lt;/Number&gt;
        &lt;FirstName&gt;Arjen&lt;/FirstName&gt;
        &lt;LastName&gt;Poutsma&lt;/LastName&gt;
    &lt;/Employee&gt;
&lt;/HolidayRequest&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The order of the two elements does not matter: <code>&lt;Employee/&gt;</code> could have been the first element just as well. What is important is that all of the data is there. In fact, the data is the only thing that is important: we are taking a <strong>data-driven</strong> approach.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorial.xsd"><a class="anchor" href="#tutorial.xsd"></a>3.3. Data Contract</h3>
<div class="paragraph">
<p>Now that we have seen some examples of the XML data that we will use, it makes sense to formalize this into a schema. This data contract defines the message format we accept. There are four different ways of defining such a contract for XML:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DTDs</p>
</li>
<li>
<p><a href="https://www.w3.org/XML/Schema">XML Schema (XSD)</a></p>
</li>
<li>
<p><a href="http://www.relaxng.org/">RELAX NG</a></p>
</li>
<li>
<p><a href="http://www.schematron.com/">Schematron</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DTDs have limited namespace support, so they are not suitable for Web services. Relax NG and Schematron certainly are easier than XML Schema. Unfortunately, they are not so widely supported across platforms. We will use XML Schema.</p>
</div>
<div class="paragraph">
<p>By far the easiest way to create an XSD is to infer it from sample documents. Any good XML editor or Java IDE offers this functionality. Basically, these tools use some sample XML documents, and generate a schema from it that validates them all. The end result certainly needs to be polished up, but it&#8217;s a great starting point.</p>
</div>
<div class="paragraph">
<p>Using the sample described above, we end up with the following generated schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
        elementFormDefault="qualified"
        targetNamespace="http://mycompany.com/hr/schemas"
        xmlns:hr="http://mycompany.com/hr/schemas"&gt;
    &lt;xs:element name="HolidayRequest"&gt;
        &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
                &lt;xs:element ref="hr:Holiday"/&gt;
                &lt;xs:element ref="hr:Employee"/&gt;
            &lt;/xs:sequence&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
    &lt;xs:element name="Holiday"&gt;
        &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
                &lt;xs:element ref="hr:StartDate"/&gt;
                &lt;xs:element ref="hr:EndDate"/&gt;
            &lt;/xs:sequence&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
    &lt;xs:element name="StartDate" type="xs:NMTOKEN"/&gt;
    &lt;xs:element name="EndDate" type="xs:NMTOKEN"/&gt;
    &lt;xs:element name="Employee"&gt;
        &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
                &lt;xs:element ref="hr:Number"/&gt;
                &lt;xs:element ref="hr:FirstName"/&gt;
                &lt;xs:element ref="hr:LastName"/&gt;
            &lt;/xs:sequence&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
    &lt;xs:element name="Number" type="xs:integer"/&gt;
    &lt;xs:element name="FirstName" type="xs:NCName"/&gt;
    &lt;xs:element name="LastName" type="xs:NCName"/&gt;
&lt;/xs:schema&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This generated schema obviously can be improved. The first thing to notice is that every type has a root-level element declaration. This means that the Web service should be able to accept all of these elements as data. This is not desirable: we only want to accept a <code>&lt;HolidayRequest/&gt;</code>. By removing the wrapping element tags (thus keeping the types), and inlining the results, we can accomplish this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:hr="http://mycompany.com/hr/schemas"
        elementFormDefault="qualified"
        targetNamespace="http://mycompany.com/hr/schemas"&gt;
    &lt;xs:element name="HolidayRequest"&gt;
        &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
                &lt;xs:element name="Holiday" type="hr:HolidayType"/&gt;
                &lt;xs:element name="Employee" type="hr:EmployeeType"/&gt;
            &lt;/xs:sequence&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
    &lt;xs:complexType name="HolidayType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name="StartDate" type="xs:NMTOKEN"/&gt;
            &lt;xs:element name="EndDate" type="xs:NMTOKEN"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
    &lt;xs:complexType name="EmployeeType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name="Number" type="xs:integer"/&gt;
            &lt;xs:element name="FirstName" type="xs:NCName"/&gt;
            &lt;xs:element name="LastName" type="xs:NCName"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The schema still has one problem: with a schema like this, you can expect the following messages to validate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;HolidayRequest xmlns="http://mycompany.com/hr/schemas"&gt;
    &lt;Holiday&gt;
        &lt;StartDate&gt;this is not a date&lt;/StartDate&gt;
        &lt;EndDate&gt;neither is this&lt;/EndDate&gt;
    &lt;/Holiday&gt;
    PlainText Section qName:lineannotation level:4, chunks:[&lt;, !-- ... --, &gt;] attrs:[:]
&lt;/HolidayRequest&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clearly, we must make sure that the start and end date are really dates. XML Schema has an excellent built-in <code>date</code> type which we can use. We also change the <code>NCName</code> s to <code>string</code> s. Finally, we change the <code>sequence</code> in <code>&lt;HolidayRequest/&gt;</code> to <code>all</code>. This tells the XML parser that the order of <code>&lt;Holiday/&gt;</code> and <code>&lt;Employee/&gt;</code> is not significant. Our final XSD now looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:hr="http://mycompany.com/hr/schemas"
        elementFormDefault="qualified"
        targetNamespace="http://mycompany.com/hr/schemas"&gt;
    &lt;xs:element name="HolidayRequest"&gt;
        &lt;xs:complexType&gt;
            &lt;xs:all&gt;
                &lt;xs:element name="Holiday" type="hr:HolidayType"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
                &lt;xs:element name="Employee" type="hr:EmployeeType"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
            &lt;/xs:all&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
    &lt;xs:complexType name="HolidayType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name="StartDate" type="xs:date"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
            &lt;xs:element name="EndDate" type="xs:date"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
    &lt;xs:complexType name="EmployeeType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name="Number" type="xs:integer"/&gt;
            &lt;xs:element name="FirstName" type="xs:string"/&gt; <i class="conum" data-value="3"></i><b>(3)</b>
            &lt;xs:element name="LastName" type="xs:string"/&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>all</code> tells the XML parser that the order of <code>&lt;Holiday/&gt;</code> and <code>&lt;Employee/&gt;</code> is not significant.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use the <code>xs:date</code> data type, which consist of a year, month, and day, for <code>&lt;StartDate/&gt;</code> and <code>&lt;EndDate/&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>xs:string</code> is used for the first and last name.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We store this file as <code>hr.xsd</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tutorial-service-contract"><a class="anchor" href="#tutorial-service-contract"></a>3.4. Service contract</h3>
<div class="paragraph">
<p>A service contract is generally expressed as a <a href="https://www.w3.org/TR/wsdl">WSDL</a> file. Note that in Spring-WS, <em>writing the WSDL by hand is not required</em>. Based on the XSD and some conventions, Spring-WS can create the WSDL for you, as explained in the section entitled <a href="#tutorial.implementing.endpoint">Implementing the Endpoint</a>. You can skip to <a href="#tutorial-creating-project">the next section</a> if you want to; the remainder of this section will show you how to write your own WSDL by hand.</p>
</div>
<div class="paragraph">
<p>We start our WSDL with the standard preamble, and by importing our existing XSD. To separate the schema from the definition, we will use a separate namespace for the WSDL definitions: <code><a href="http://mycompany.com/hr/definitions" class="bare">http://mycompany.com/hr/definitions</a></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;wsdl:definitions xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
                  xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
                  xmlns:schema="http://mycompany.com/hr/schemas"
                  xmlns:tns="http://mycompany.com/hr/definitions"
                  targetNamespace="http://mycompany.com/hr/definitions"&gt;
    &lt;wsdl:types&gt;
        &lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
            &lt;xsd:import namespace="http://mycompany.com/hr/schemas" schemaLocation="hr.xsd"/&gt;
        &lt;/xsd:schema&gt;
    &lt;/wsdl:types&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we add our messages based on the written schema types. We only have one message: one with the <code>&lt;HolidayRequest/&gt;</code> we put in the schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">    &lt;wsdl:message name="HolidayRequest"&gt;
        &lt;wsdl:part element="schema:HolidayRequest" name="HolidayRequest"/&gt;
    &lt;/wsdl:message&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We add the message to a port type as an operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">    &lt;wsdl:portType name="HumanResource"&gt;
        &lt;wsdl:operation name="Holiday"&gt;
            &lt;wsdl:input message="tns:HolidayRequest" name="HolidayRequest"/&gt;
        &lt;/wsdl:operation&gt;
    &lt;/wsdl:portType&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That finished the abstract part of the WSDL (the interface, as it were), and leaves the concrete part. The concrete part consists of a <code>binding</code>, which tells the client <strong>how</strong> to invoke the operations you&#8217;ve just defined; and a <code>service</code>, which tells it <em>where</em> to invoke it.</p>
</div>
<div class="paragraph">
<p>Adding a concrete part is pretty standard: just refer to the abstract part you defined previously, make sure you use <strong>document/literal</strong> for the <code>soap:binding</code> elements (<code>rpc/encoded</code> is deprecated), pick a <code>soapAction</code> for the operation (in this case <code><a href="http://mycompany.com/RequestHoliday" class="bare">http://mycompany.com/RequestHoliday</a></code>, but any URI will do), and determine the <code>location</code> URL where you want request to come in (in this case <code><a href="http://mycompany.com/humanresources" class="bare">http://mycompany.com/humanresources</a></code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;wsdl:definitions xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
                  xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
                  xmlns:schema="http://mycompany.com/hr/schemas"
                  xmlns:tns="http://mycompany.com/hr/definitions"
                  targetNamespace="http://mycompany.com/hr/definitions"&gt;
    &lt;wsdl:types&gt;
        &lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
            &lt;xsd:import namespace="http://mycompany.com/hr/schemas"              <i class="conum" data-value="1"></i><b>(1)</b>
                schemaLocation="hr.xsd"/&gt;
        &lt;/xsd:schema&gt;
    &lt;/wsdl:types&gt;
    &lt;wsdl:message name="HolidayRequest"&gt;                                         <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;wsdl:part element="schema:HolidayRequest" name="HolidayRequest"/&gt;       <i class="conum" data-value="3"></i><b>(3)</b>
    &lt;/wsdl:message&gt;
    &lt;wsdl:portType name="HumanResource"&gt;                                         <i class="conum" data-value="4"></i><b>(4)</b>
        &lt;wsdl:operation name="Holiday"&gt;
            &lt;wsdl:input message="tns:HolidayRequest" name="HolidayRequest"/&gt;     <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;/wsdl:operation&gt;
    &lt;/wsdl:portType&gt;
    &lt;wsdl:binding name="HumanResourceBinding" type="tns:HumanResource"&gt;          <i class="conum" data-value="4"></i><b>(4)</b><i class="conum" data-value="5"></i><b>(5)</b>
        &lt;soap:binding style="document"                                           <i class="conum" data-value="6"></i><b>(6)</b>
            transport="http://schemas.xmlsoap.org/soap/http"/&gt;                   <i class="conum" data-value="7"></i><b>(7)</b>
        &lt;wsdl:operation name="Holiday"&gt;
            &lt;soap:operation soapAction="http://mycompany.com/RequestHoliday"/&gt;   <i class="conum" data-value="8"></i><b>(8)</b>
            &lt;wsdl:input name="HolidayRequest"&gt;
                &lt;soap:body use="literal"/&gt;                                       <i class="conum" data-value="6"></i><b>(6)</b>
            &lt;/wsdl:input&gt;
        &lt;/wsdl:operation&gt;
    &lt;/wsdl:binding&gt;
    &lt;wsdl:service name="HumanResourceService"&gt;
        &lt;wsdl:port binding="tns:HumanResourceBinding" name="HumanResourcePort"&gt;  <i class="conum" data-value="5"></i><b>(5)</b>
            &lt;soap:address location="http://localhost:8080/holidayService/"/&gt;     <i class="conum" data-value="9"></i><b>(9)</b>
        &lt;/wsdl:port&gt;
    &lt;/wsdl:service&gt;
&lt;/wsdl:definitions&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the schema defined in <a href="#tutorial.xsd">Data Contract</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We define the <code>HolidayRequest</code> message, which gets used in the <code>portType</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>HolidayRequest</code> type is defined in the schema.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We define the <code>HumanResource</code> port type, which gets used in the <code>binding</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We define the <code>HumanResourceBinding</code> binding, which gets used in the <code>port</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We use a document/literal style.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The literal <code><a href="http://schemas.xmlsoap.org/soap/http" class="bare">http://schemas.xmlsoap.org/soap/http</a></code> signifies a HTTP transport.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The <code>soapAction</code> attribute signifies the <code>SOAPAction</code> HTTP header that will be sent with every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The <code><a href="http://localhost:8080/holidayService/" class="bare">http://localhost:8080/holidayService/</a></code> address is the URL where the Web service can be invoked.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the final WSDL. We will describe how to implement the resulting schema and WSDL in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="tutorial-creating-project"><a class="anchor" href="#tutorial-creating-project"></a>3.5. Creating the project</h3>
<div class="paragraph">
<p>In this section, we will be using <a href="https://maven.apache.org/">Maven3</a> to create the initial project structure for us. Doing so is not required, but greatly reduces the amount of code we have to write to setup our HolidayService.</p>
</div>
<div class="paragraph">
<p>The following command creates a Maven3 web application project for us, using the Spring-WS archetype (that is, project template)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn archetype:create -DarchetypeGroupId=org.springframework.ws \
  -DarchetypeArtifactId=spring-ws-archetype \
  -DarchetypeVersion= \
  -DgroupId=com.mycompany.hr \
  -DartifactId=holidayService</pre>
</div>
</div>
<div class="paragraph">
<p>This command will create a new directory called <code>holidayService</code>. In this directory, there is a <code>'src/main/webapp'</code> directory, which will contain the root of the WAR file. You will find the standard web application deployment descriptor <code>'WEB-INF/web.xml'</code> here, which defines a Spring-WS <code>MessageDispatcherServlet</code> and maps all incoming requests to this servlet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
             http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
         version="2.4"&gt;

    &lt;display-name&gt;MyCompany HR Holiday Service&lt;/display-name&gt;

    <em>&lt;!-- take special notice of the name of this servlet --&gt;</em>
    &lt;servlet&gt;
        &lt;servlet-name&gt;<strong><em>spring-ws</em></strong>&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.ws.transport.http.MessageDispatcherServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the above <code>'WEB-INF/web.xml'</code> file, you will also need another, Spring-WS-specific configuration file, named <code>'WEB-INF/spring-ws-servlet.xml'</code>. This file contains all of the Spring-WS-specific beans such as <code>EndPoints</code>, <code>WebServiceMessageReceivers</code>, and suchlike, and is used to create a new Spring container. The name of this file is derived from the name of the attendant servlet (in this case <code>'spring-ws'</code>) with <code>'-servlet.xml'</code> appended to it. So if you defined a <code>MessageDispatcherServlet</code> with the name <code>'dynamite'</code>, the name of the Spring-WS-specific configuration file would be <code>'WEB-INF/dynamite-servlet.xml'</code>.</p>
</div>
<div class="paragraph">
<p>(You can see the contents of the <code>'WEB-INF/spring-ws-servlet.xml'</code> file for this example in <a href="#tutorial.example.sws-conf-file">[tutorial.example.sws-conf-file]</a>.)</p>
</div>
<div class="paragraph">
<p>Once you had the project structure created, you can put the schema and wsdl from previous section into <code>'WEB-INF/'</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="tutorial.implementing.endpoint"><a class="anchor" href="#tutorial.implementing.endpoint"></a>3.6. Implementing the Endpoint</h3>
<div class="paragraph">
<p>In Spring-WS, you will implement <em>Endpoints</em> to handle incoming XML messages. An endpoint is typically created by annotating a class with the <code>@Endpoint</code> annotation. In this endpoint class, you will create one or more methods that handle incoming request. The method signatures can be quite flexible: you can include just about any sort of parameter type related to the incoming XML message, as will be explained later.</p>
</div>
<div class="sect3">
<h4 id="_handling_the_xml_message"><a class="anchor" href="#_handling_the_xml_message"></a>3.6.1. Handling the XML Message</h4>
<div class="paragraph">
<p>In this sample application, we are going to use <a href="http://www.jdom.org/">JDom 2</a> to handle the XML message. We are also using <a href="https://www.w3.org/TR/xpath20/">XPath</a>, because it allows us to select particular parts of the XML JDOM tree, without requiring strict schema conformance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.mycompany.hr.ws;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Date;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.server.endpoint.annotation.RequestPayload;

import com.mycompany.hr.service.HumanResourceService;
import org.jdom2.Element;
import org.jdom2.JDOMException;
import org.jdom2.Namespace;
import org.jdom2.filter.Filters;
import org.jdom2.xpath.XPathExpression;
import org.jdom2.xpath.XPathFactory;

@Endpoint                                                                                     <i class="conum" data-value="1"></i><b>(1)</b>
public class HolidayEndpoint {

    private static final String NAMESPACE_URI = "http://mycompany.com/hr/schemas";

    private XPathExpression&lt;Element&gt; startDateExpression;

    private XPathExpression&lt;Element&gt; endDateExpression;

    private XPathExpression&lt;Element&gt; firstNameExpression;

    private XPathExpression&lt;Element&gt; lastNameExpression;

    private HumanResourceService humanResourceService;

    @Autowired                                                                                <i class="conum" data-value="2"></i><b>(2)</b>
    public HolidayEndpoint(HumanResourceService humanResourceService) throws JDOMException {
        this.humanResourceService = humanResourceService;

        Namespace namespace = Namespace.getNamespace("hr", NAMESPACE_URI);
        XPathFactory xPathFactory = XPathFactory.instance();
        startDateExpression = xPathFactory.compile("//hr:StartDate", Filters.element(), null, namespace);
        endDateExpression = xPathFactory.compile("//hr:EndDate", Filters.element(), null, namespace);
        firstNameExpression = xPathFactory.compile("//hr:FirstName", Filters.element(), null, namespace);
        lastNameExpression = xPathFactory.compile("//hr:LastName", Filters.element(), null, namespace);
    }

    @PayloadRoot(namespace = NAMESPACE_URI, localPart = "HolidayRequest")                      <i class="conum" data-value="3"></i><b>(3)</b>
    public void handleHolidayRequest(@RequestPayload Element holidayRequest) throws Exception {<i class="conum" data-value="4"></i><b>(4)</b>
        Date startDate = parseDate(startDateExpression, holidayRequest);
        Date endDate = parseDate(endDateExpression, holidayRequest);
        String name = firstNameExpression.evaluateFirst(holidayRequest).getText() + " " + lastNameExpression.evaluateFirst(holidayRequest).getText();

        humanResourceService.bookHoliday(startDate, endDate, name);
    }

    private Date parseDate(XPathExpression&lt;Element&gt; expression, Element element) throws ParseException {
        Element result = expression.evaluateFirst(element);
        if (result != null) {
            SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
            return dateFormat.parse(result.getText());
        } else {
            throw new IllegalArgumentException("Could not evaluate [" + expression + "] on [" + element + "]");
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>HolidayEndpoint</code> is annotated with <code>@Endpoint</code>. This marks the class as a special sort of <code>@Component</code>, suitable for handling XML messages in Spring-WS, and also making it eligible for suitable for component scanning.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>HolidayEndpoint</code> requires the <code>HumanResourceService</code> business service to operate, so we inject the dependency via the constructor and annotate it with <code>@Autowired</code>.
Next, we set up XPath expressions using the JDOM2 API. There are four expressions: <code>//hr:StartDate</code> for extracting the <code>&lt;StartDate&gt;</code> text value, <code>//hr:EndDate</code> for extracting the end date and two for extracting the names of the employee.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@PayloadRoot</code> annotation tells Spring-WS that the <code>handleHolidayRequest</code> method is suitable for handling XML messages. The sort of message that this method can handle is indicated by the annotation values, in this case, it can
handle XML elements that have the <code>HolidayRequest</code> local part and the <code><a href="http://mycompany.com/hr/schemas" class="bare">http://mycompany.com/hr/schemas</a></code> namespace.
More information about mapping messages to endpoints is provided in the next section.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>handleHolidayRequest(..)</code> method is the main handling method method, which gets passed with the <code>&lt;HolidayRequest/&gt;</code>
element from the incoming XML message. The <code>@RequestPayload</code> annotation indicates that the <code>holidayRequest</code> parameter should be mapped to the payload of the
request message. We use the XPath expressions to extract the string values from the XML messages, and convert these values to <code>Date</code> objects using a
<code>SimpleDateFormat</code> (the <code>parseData</code> method). With these values, we invoke a method on the business service.
Typically, this will result in a database transaction being started, and some records being altered in the database.
Finally, we define a <code>void</code> return type, which indicates to Spring-WS that we do not want to send a response message.
If we wanted a response message, we could have returned a JDOM Element that represents the payload of the response message.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using JDOM is just one of the options to handle the XML: other options include DOM, dom4j, XOM, SAX, and StAX, but also marshalling techniques like JAXB, Castor, XMLBeans, JiBX, and XStream, as is explained in the next chapter. We chose JDOM because it gives us access to the raw XML, and because it is based on classes (not interfaces and factory methods as with W3C DOM and dom4j), which makes the code less verbose. We use XPath because it is less fragile than marshalling technologies: we don&#8217;t care for strict schema conformance, as long as we can find the dates and the name.</p>
</div>
<div class="paragraph">
<p>Because we use JDOM, we must add some dependencies to the Maven <code>pom.xml</code>, which is in the root of our project directory. Here is the relevant section of the POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.ws&lt;/groupId&gt;
        &lt;artifactId&gt;spring-ws-core&lt;/artifactId&gt;
        &lt;version&gt;&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;jdom&lt;/groupId&gt;
        &lt;artifactId&gt;jdom&lt;/artifactId&gt;
        &lt;version&gt;2.0.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;jaxen&lt;/groupId&gt;
        &lt;artifactId&gt;jaxen&lt;/artifactId&gt;
        &lt;version&gt;1.1&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how we would configure these classes in our <code>spring-ws-servlet.xml</code> Spring XML configuration file, by using component scanning. We also instruct Spring-WS to use annotation-driven endpoints, with the <code>&lt;sws:annotation-driven&gt;</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:context="http://www.springframework.org/schema/context"
  xmlns:sws="http://www.springframework.org/schema/web-services"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
  http://www.springframework.org/schema/web-services http://www.springframework.org/schema/web-services/web-services-2.0.xsd
  http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;

  &lt;context:component-scan base-package="com.mycompany.hr"/&gt;

  &lt;sws:annotation-driven/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_routing_the_message_to_the_endpoint"><a class="anchor" href="#_routing_the_message_to_the_endpoint"></a>3.6.2. Routing the Message to the Endpoint</h4>
<div class="paragraph">
<p>As part of writing the endpoint, we also used the <code>@PayloadRoot</code> annotation to indicate which sort of messages can be handled by the <code>handleHolidayRequest</code> method. In Spring-WS, this process is the responsibility of an <code>EndpointMapping</code>. Here we route messages based on their content, by using a <code>PayloadRootAnnotationMethodEndpointMapping</code>. The annotation used above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@PayloadRoot(namespace = "http://mycompany.com/hr/schemas", localPart = "HolidayRequest")</code></pre>
</div>
</div>
<div class="paragraph">
<p>basically means that whenever an XML message is received with the namespace <code><a href="http://mycompany.com/hr/schemas" class="bare">http://mycompany.com/hr/schemas</a></code> and the <code>HolidayRequest</code> local name, it will be routed to the <code>handleHolidayRequest</code> method. By using the <code>&lt;sws:annotation-driven&gt;</code> element in our configuration, we enable the detection of the <code>@PayloadRoot</code> annotations. It is possible (and quite common) to have multiple, related handling methods in an endpoint, each of them handling different XML messages.</p>
</div>
<div class="paragraph">
<p>There are also other ways to map endpoints to XML messages, which will be described in the next chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_providing_the_service_and_stub_implementation"><a class="anchor" href="#_providing_the_service_and_stub_implementation"></a>3.6.3. Providing the Service and Stub implementation</h4>
<div class="paragraph">
<p>Now that we have the <strong>Endpoint</strong>, we need <code>HumanResourceService</code> and its implementation for use by <code>HolidayEndpoint</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.mycompany.hr.service;

import java.util.Date;

public interface HumanResourceService {
    void bookHoliday(Date startDate, Date endDate, String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For tutorial purposes, we will use a simple stub implementation of the <code>HumanResourceService</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.mycompany.hr.service;

import java.util.Date;

import org.springframework.stereotype.Service;

@Service                                                                 <i class="conum" data-value="1"></i><b>(1)</b>
public class StubHumanResourceService implements HumanResourceService {
    public void bookHoliday(Date startDate, Date endDate, String name) {
        System.out.println("Booking holiday for [" + startDate + "-" + endDate + "] for [" + name + "] ");
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>StubHumanResourceService</code> is annotated with <code>@Service</code>. This marks the class as a business facade, which makes this a candidate for injection by <code>@Autowired</code> in <code>HolidayEndpoint</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tutorial-publishing-wsdl"><a class="anchor" href="#tutorial-publishing-wsdl"></a>3.7. Publishing the WSDL</h3>
<div class="paragraph">
<p>Finally, we need to publish the WSDL. As stated in <a href="#tutorial-service-contract">Service contract</a>, we don&#8217;t need to write a WSDL ourselves; Spring-WS can generate one for us based on some conventions. Here is how we define the generation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;sws:dynamic-wsdl id="holiday"                                <i class="conum" data-value="1"></i><b>(1)</b>
    portTypeName="HumanResource"                              <i class="conum" data-value="3"></i><b>(3)</b>
    locationUri="/holidayService/"                            <i class="conum" data-value="4"></i><b>(4)</b>
    targetNamespace="http://mycompany.com/hr/definitions"&gt;    <i class="conum" data-value="5"></i><b>(5)</b>
  &lt;sws:xsd location="/WEB-INF/hr.xsd"/&gt;                       <i class="conum" data-value="2"></i><b>(2)</b>
&lt;/sws:dynamic-wsdl&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The id determines the URL where the WSDL can be retrieved. In this case, the id is <code>holiday</code>, which means that the WSDL can be retrieved
as <code>holiday.wsdl</code> in the servlet context. The full URL will typically be <code><a href="http://localhost:8080/holidayService/holiday.wsdl" class="bare">http://localhost:8080/holidayService/holiday.wsdl</a></code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Next, we set the WSDL port type to be <code>HumanResource</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We set the location where the service can be reached: <code>/holidayService/</code>. We use a relative URI and we instruct the framework to transform it
dynamically to an absolute URI. Hence, if the service is deployed to different contexts we don&#8217;t have to change the URI manually.
For more information, please refer to <a href="#server-automatic-wsdl-exposure">the section called “Automatic WSDL exposure”</a>. For the location transformation to work, we need to add an init parameter to <code>spring-ws</code>
servlet in <code>web.xml</code> (shown below).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We define the target namespace for the WSDL definition itself. Setting this attribute is not required. If not set, the WSDL will have the same namespace as the XSD schema.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>xsd</code> element refers to the human resource schema we defined in <a href="#tutorial.xsd">Data Contract</a>. We simply placed the schema in the <code>WEB-INF</code> directory of the application.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;init-param&gt;
  &lt;param-name&gt;transformWsdlLocations&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/init-param&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create a WAR file using <strong>mvn install</strong>. If you deploy the application (to Tomcat, Jetty, etc.), and point your browser at <a href="http://localhost:8080/holidayService/holiday.wsdl">this location</a>, you will see the generated WSDL. This WSDL is ready to be used by clients, such as <a href="http://www.soapui.org/">soapUI</a>, or other SOAP frameworks.</p>
</div>
<div class="paragraph">
<p>That concludes this tutorial. The tutorial code can be found in the full distribution of Spring-WS. The next step would be to look at the echo sample application that is part of the distribution. After that, look at the airline sample, which is a bit more complicated, because it uses JAXB, WS-Security, Hibernate, and a transactional service layer. Finally, you can read the rest of the reference documentation.</p>
</div>
</div>
</div>
</div>
<h1 id="_ii_reference" class="sect0"><a class="anchor" href="#_ii_reference"></a>II. Reference</h1>
<div class="openblock partintro">
<div class="content">
This part of the reference documentation details the various components that comprise Spring Web Services. This includes <a href="#common">a chapter</a> that discusses the parts common to both client- and server-side WS, a chapter devoted to the specifics of <a href="#server">writing server-side Web services</a>, a chapter about using Web services on <a href="#client">the client-side</a>, and a chapters on using <a href="#security">WS-Security</a>.
</div>
</div>
<div class="sect1">
<h2 id="common"><a class="anchor" href="#common"></a>4. Shared components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter, we will explore the components which are shared between client- and server-side Spring-WS development. These interfaces and classes represent the building blocks of Spring-WS, so it is important to understand what they do, even if you do not use them directly.</p>
</div>
<div class="sect2">
<h3 id="web-service-messages"><a class="anchor" href="#web-service-messages"></a>4.1. Web service messages</h3>
<div class="sect3">
<h4 id="web-service-message"><a class="anchor" href="#web-service-message"></a>4.1.1. <code>WebServiceMessage</code></h4>
<div class="paragraph">
<p>One of the core interfaces of Spring Web Services is the <code>WebServiceMessage</code>. This interface represents a protocol-agnostic XML message. The interface contains methods that provide access to the payload of the message, in the form of a <code>javax.xml.transform.Source</code> or a <code>javax.xml.transform.Result</code>. <code>Source</code> and <code>Result</code> are tagging interfaces that represent an abstraction over XML input and output. Concrete implementations wrap various XML representations, as indicated in the following table.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Source/Result implementation</th>
<th class="tableblock halign-left valign-top">Wraps XML representation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.dom.DOMSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.w3c.dom.Node</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.dom.DOMResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.w3c.dom.Node</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.sax.SAXSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.xml.sax.InputSource</code> and <code>org.xml.sax.XMLReader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.sax.SAXResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.xml.sax.ContentHandler</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.stream.StreamSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.io.File</code>, <code>java.io.InputStream</code>, or <code>java.io.Reader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.stream.StreamResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.io.File</code>, <code>java.io.OutputStream</code>, or <code>java.io.Writer</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to reading from and writing to the payload, a Web service message can write itself to an output stream.</p>
</div>
</div>
<div class="sect3">
<h4 id="soap-message"><a class="anchor" href="#soap-message"></a>4.1.2. <code>SoapMessage</code></h4>
<div class="paragraph">
<p>The <code>SoapMessage</code> is a subclass of <code>WebServiceMessage</code>. It contains SOAP-specific methods, such as getting SOAP Headers, SOAP Faults, etc. Generally, your code should not be dependent on <code>SoapMessage</code>, because the content of the SOAP Body (the payload of the message) can be obtained via <code>getPayloadSource()</code> and <code>getPayloadResult()</code> in the <code>WebServiceMessage</code>. Only when it is necessary to perform SOAP-specific actions, such as adding a header, getting an attachment, etc., should you need to cast <code>WebServiceMessage</code> to <code>SoapMessage</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-factories"><a class="anchor" href="#message-factories"></a>4.1.3. Message Factories</h4>
<div class="paragraph">
<p>Concrete message implementations are created by a <code>WebServiceMessageFactory</code>. This factory can create an empty message, or read a message based on an input stream. There are two concrete implementations of <code>WebServiceMessageFactory</code>; one is based on SAAJ, the SOAP with Attachments API for Java, the other based on Axis 2&#8217;s AXIOM, the AXis Object Model.</p>
</div>
<div class="sect4">
<h5 id="_code_saajsoapmessagefactory_code"><a class="anchor" href="#_code_saajsoapmessagefactory_code"></a><code>SaajSoapMessageFactory</code></h5>
<div class="paragraph">
<p>The <code>SaajSoapMessageFactory</code> uses the SOAP with Attachments API for Java to create <code>SoapMessage</code> implementations. <strong>SAAJ</strong> is part of <strong>J2EE</strong> 1.4, so it should be supported under most modern application servers. Here is an overview of the <strong>SAAJ</strong> versions supplied by common application servers:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Application Server</th>
<th class="tableblock halign-left valign-top"><strong>SAAJ</strong> Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEA WebLogic 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BEA WebLogic 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1/1.2<sup>1</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IBM WebSphere 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUN Glassfish 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><sup>1</sup>Weblogic 9 has a known bug in the <strong>SAAJ</strong> 1.2 implementation: it implement all the 1.2 interfaces, but throws a <code>UnsupportedOperationException</code> when called. Spring Web Services has a workaround: it uses <strong>SAAJ</strong> 1.1 when operating on WebLogic 9.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additionally, Java SE 6 includes <strong>SAAJ</strong> 1.3. You wire up a <code>SaajSoapMessageFactory</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory" /&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>SAAJ</strong> is based on DOM, the Document Object Model. This means that all SOAP messages are stored <strong>in memory</strong>. For larger SOAP messages, this may not be very performant. In that case, the <code>AxiomSoapMessageFactory</code> might be more applicable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_code_axiomsoapmessagefactory_code"><a class="anchor" href="#_code_axiomsoapmessagefactory_code"></a><code>AxiomSoapMessageFactory</code></h5>
<div class="paragraph">
<p>The <code>AxiomSoapMessageFactory</code> uses the AXis 2 Object Model to create <code>SoapMessage</code> implementations. <strong>AXIOM</strong> is based on <strong>StAX</strong>, the Streaming API for XML. StAX provides a pull-based mechanism for reading XML messages, which can be more efficient for larger messages.</p>
</div>
<div class="paragraph">
<p>To increase reading performance on the <code>AxiomSoapMessageFactory</code>, you can set the <code>payloadCaching</code> property to false (default is true). This will read the contents of the SOAP body directly from the socket stream. When this setting is enabled, the payload can only be read once. This means that you have to make sure that any pre-processing (logging etc.) of the message does not consume it.</p>
</div>
<div class="paragraph">
<p>You use the <code>AxiomSoapMessageFactory</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="messageFactory" class="org.springframework.ws.soap.axiom.AxiomSoapMessageFactory"&gt;
    &lt;property name="payloadCaching" value="true"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to payload caching, <strong>AXIOM</strong> also supports full streaming messages, as defined in the <code>StreamingWebServiceMessage</code>. This means that the payload can be directly set on the response message, rather than being written to a DOM tree or buffer.</p>
</div>
<div class="paragraph">
<p>Full streaming for <strong>AXIOM</strong> is used when a handler method returns a <strong>JAXB2</strong>-supported object. It will automatically set this marshalled object into the response message, and write it out to the outgoing socket stream when the response is going out.</p>
</div>
<div class="paragraph">
<p>For more information about full streaming, refer to the class-level Javadoc for <code>StreamingWebServiceMessage</code> and <code>StreamingPayload</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="soap_11_or_12"><a class="anchor" href="#soap_11_or_12"></a><strong>SOAP</strong> 1.1 or 1.2</h5>
<div class="paragraph">
<p>Both the <code>SaajSoapMessageFactory</code> and the <code>AxiomSoapMessageFactory</code> have a <code>soapVersion</code> property, where you can inject a <code>SoapVersion</code> constant. By default, the version is 1.1, but you can set it to 1.2 like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/util
       http://www.springframework.org/schema/util/spring-util-2.0.xsd"&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"&gt;
        &lt;property name="soapVersion"&gt;
            &lt;util:constant static-field="org.springframework.ws.soap.SoapVersion.SOAP_12"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we define a <code>SaajSoapMessageFactory</code> that only accepts <strong>SOAP</strong> 1.2 messages.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even though both versions of <strong>SOAP</strong> are quite similar in format, the 1.2 version is not backwards compatible with 1.1 because it uses a different XML namespace. Other major differences between <strong>SOAP</strong> 1.1 and 1.2 include the different structure of a Fault, and the fact that <code>SOAPAction</code> HTTP headers are effectively deprecated, thought they still work.</p>
</div>
<div class="paragraph">
<p>One important thing to note with <strong>SOAP</strong> version numbers, or WS-* specification version numbers in general, is that the latest version of a specification is generally not the most popular version. For <strong>SOAP</strong>, this means that currently, the best version to use is 1.1. Version 1.2 might become more popular in the future, but currently 1.1 is the safest bet.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="message-context"><a class="anchor" href="#message-context"></a>4.1.4. <code>MessageContext</code></h4>
<div class="paragraph">
<p>Typically, messages come in pairs: a request and a response. A request is created on the client-side, which is sent over some transport to the server-side, where a response is generated. This response gets sent back to the client, where it is read.</p>
</div>
<div class="paragraph">
<p>In Spring Web Services, such a conversation is contained in a <code>MessageContext</code>, which has properties to get request and response messages. On the client-side, the message context is created by the <a href="#client-web-service-template"><code>WebServiceTemplate</code></a>. On the server-side, the message context is read from the transport-specific input stream. For example, in HTTP, it is read from the <code>HttpServletRequest</code> and the response is written back to the <code>HttpServletResponse</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transport-context"><a class="anchor" href="#transport-context"></a>4.2. <code>TransportContext</code></h3>
<div class="paragraph">
<p>One of the key properties of the SOAP protocol is that it tries to be transport-agnostic. This is why, for instance, Spring-WS does not support mapping messages to endpoints by HTTP request URL, but rather by mesage content.</p>
</div>
<div class="paragraph">
<p>However, sometimes it is necessary to get access to the underlying transport, either on the client or server side. For this, Spring Web Services has the <code>TransportContext</code>. The transport context allows access to the underlying <code>WebServiceConnection</code>, which typically is a <code>HttpServletConnection</code> on the server side; or a <code>HttpUrlConnection</code> or <code>CommonsHttpConnection</code> on the client side. For example, you can obtain the IP address of the current request in a server-side endpoint or interceptor like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">TransportContext context = TransportContextHolder.getTransportContext();
HttpServletConnection connection = (HttpServletConnection )context.getConnection();
HttpServletRequest request = connection.getHttpServletRequest();
String ipAddress = request.getRemoteAddr();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xpath"><a class="anchor" href="#xpath"></a>4.3. Handling XML With XPath</h3>
<div class="paragraph">
<p>One of the best ways to handle XML is to use XPath. Quoting <a href="#effective-xml">[effective-xml]</a>, item 35:</p>
</div>
<div class="quoteblock">
<blockquote>
XPath is a fourth generation declarative language that allows you to specify which nodes you want to process without specifying exactly how the processor is supposed to navigate to those nodes. XPath&#8217;s data model is very well designed to support exactly what almost all developers want from XML. For instance, it merges all adjacent text including that in CDATA sections, allows values to be calculated that skip over comments and processing instructions` and include text from child and descendant elements, and requires all external entity references to be resolved. In practice, XPath expressions tend to be much more robust against unexpected but perhaps insignificant changes in the input document.
</blockquote>
<div class="attribution">
&#8212; Elliotte Rusty Harold
</div>
</div>
<div class="paragraph">
<p>Spring Web Services has two ways to use XPath within your application: the faster <code>XPathExpression</code> or the more flexible <code>XPathTemplate</code>.</p>
</div>
<div class="sect3">
<h4 id="xpath-expression"><a class="anchor" href="#xpath-expression"></a>4.3.1. <code>XPathExpression</code></h4>
<div class="paragraph">
<p>The <code>XPathExpression</code> is an abstraction over a compiled XPath expression, such as the Java 5 <code>javax.xml.xpath.XPathExpression</code>, or the Jaxen <code>XPath</code> class. To construct an expression in an application context, there is the <code>XPathExpressionFactoryBean</code>. Here is an example which uses this factory bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"&gt;

    &lt;bean id="nameExpression" class="org.springframework.xml.xpath.XPathExpressionFactoryBean"&gt;
        &lt;property name="expression" value="/Contacts/Contact/Name"/&gt;
    &lt;/bean&gt;

    &lt;bean id="myEndpoint" class="sample.MyXPathClass"&gt;
        &lt;constructor-arg ref="nameExpression"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above does not use namespaces, but we could set those using the <code>namespaces</code> property of the factory bean. The expression can be used in the code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package sample;

public class MyXPathClass {

    private final XPathExpression nameExpression;

    public MyXPathClass(XPathExpression nameExpression) {
        this.nameExpression = nameExpression;
    }

    public void doXPath(Document document) {
        String name = nameExpression.evaluateAsString(document.getDocumentElement());
        System.out.println("Name: " + name);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a more flexible approach, you can use a <code>NodeMapper</code>, which is similar to the <code>RowMapper</code> in Spring&#8217;s JDBC support. The following example shows how we can use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package sample;

public class MyXPathClass  {

   private final XPathExpression contactExpression;

   public MyXPathClass(XPathExpression contactExpression) {
      this.contactExpression = contactExpression;
   }

   public void doXPath(Document document) {
      List contacts = contactExpression.evaluate(document,
        new NodeMapper() {
           public Object mapNode(Node node, int nodeNum) throws DOMException {
              Element contactElement = (Element) node;
              Element nameElement = (Element) contactElement.getElementsByTagName("Name").item(0);
              Element phoneElement = (Element) contactElement.getElementsByTagName("Phone").item(0);
              return new Contact(nameElement.getTextContent(), phoneElement.getTextContent());
           }
        });
      PlainText Section qName:lineannotation level:5, chunks:[// do something with list of Contact objects] attrs:[:]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to mapping rows in Spring JDBC&#8217;s <code>RowMapper</code>, each result node is mapped using an anonymous inner class. In this case, we create a <code>Contact</code> object, which we use later on.</p>
</div>
</div>
<div class="sect3">
<h4 id="xpath-template"><a class="anchor" href="#xpath-template"></a>4.3.2. <code>XPathTemplate</code></h4>
<div class="paragraph">
<p>The <code>XPathExpression</code> only allows you to evaluate a single, pre-compiled expression. A more flexible, though slower, alternative is the <code>XpathTemplate</code>. This class follows the common template pattern used throughout Spring (JdbcTemplate, JmsTemplate, etc.). Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package sample;

public class MyXPathClass {

    private XPathOperations template = new Jaxp13XPathTemplate();

    public void doXPath(Source source) {
        String name = template.evaluateAsString("/Contacts/Contact/Name", request);
        <em>// do something with name</em>
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>4.4. Message Logging and Tracing</h3>
<div class="paragraph">
<p>When developing or debugging a Web service, it can be quite useful to look at the content of a (SOAP) message when it arrives, or just before it is sent. Spring Web Services offer this functionality, via the standard Commons Logging interface.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure to use Commons Logging version 1.1 or higher. Earlier versions have class loading issues, and do not integrate with the Log4J TRACE level.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To log all server-side messages, simply set the <code>org.springframework.ws.server.MessageTracing</code> logger to level DEBUG or TRACE. On the debug level, only the payload root element is logged; on the TRACE level, the entire message content. If you only want to log sent messages, use the <code>org.springframework.ws.server.MessageTracing.sent</code> logger; or <code>org.springframework.ws.server.MessageTracing.received</code> to log received messages.</p>
</div>
<div class="paragraph">
<p>On the client-side, similar loggers exist: <code>org.springframework.ws.client.MessageTracing.sent</code> and <code>org.springframework.ws.client.MessageTracing.received</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example <code>log4j.properties</code> configuration, logging the full content of sent messages on the client side, and only the payload root element for client-side received messages. On the server-side, the payload root is logged for both sent and received messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>log4j.rootCategory=INFO, stdout
log4j.logger.org.springframework.ws.client.MessageTracing.sent=TRACE
log4j.logger.org.springframework.ws.client.MessageTracing.received=DEBUG

log4j.logger.org.springframework.ws.server.MessageTracing=DEBUG

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%p [%c{3}] %m%n</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, a typical output will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TRACE [client.MessageTracing.sent] Sent request [&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="...
DEBUG [server.MessageTracing.received] Received request [SaajSoapMessage {http://example.com}request] ...
DEBUG [server.MessageTracing.sent] Sent response [SaajSoapMessage {http://example.com}response] ...
DEBUG [client.MessageTracing.received] Received response [SaajSoapMessage {http://example.com}response] ...</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server"><a class="anchor" href="#server"></a>5. Creating a Web service with Spring-WS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ws-introduction"><a class="anchor" href="#ws-introduction"></a>5.1. Introduction</h3>
<div class="paragraph">
<p>Spring-WS&#8217;s server-side support is designed around a <code>MessageDispatcher</code> that dispatches incoming messages to endpoints, with configurable endpoint mappings, response generation, and endpoint interception. Endpoints are typically annotated with the <code>@Endpoint</code> annotation, and have one or more handling methods. These methods handle incoming XML request messages by inspecting parts of the message (typically the payload), and create some sort of response. You annotate the method with another annotation, typically <code>@PayloadRoot</code>, to indicate what sort of messages it can handle.</p>
</div>
<div class="paragraph">
<p>Spring-WS&#8217;s XML handling is extremely flexible. An endpoint can choose from a large amount of XML handling libraries supported by Spring-WS, including the DOM family (W3C DOM, JDOM, dom4j, and XOM), SAX or StAX for faster performance, XPath to extract information from the message, or even marshalling techniques (JAXB, Castor, XMLBeans, JiBX, or XStream) to convert the XML to objects and vice-versa.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_code_messagedispatcher_code"><a class="anchor" href="#_the_code_messagedispatcher_code"></a>5.2. The <code>MessageDispatcher</code></h3>
<div class="paragraph">
<p>The server-side of Spring-WS is designed around a central class that dispatches incoming XML messages to endpoints. Spring-WS&#8217;s <code>MessageDispatcher</code> is extremely flexible, allowing you to use any sort of class as an endpoint, as long as it can be configured in the Spring IoC container. In a way, the message dispatcher resembles Spring&#8217;s <code>DispatcherServlet</code>, the
"Front Controller" used in Spring Web MVC.</p>
</div>
<div class="paragraph">
<p>The processing and dispatching flow of the <code>MessageDispatcher</code> is illustrated in the following sequence diagram.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/sequence.png" alt="sequence">
</div>
</div>
<div class="paragraph">
<p>When a <code>MessageDispatcher</code> is set up for use and a request comes in for that specific dispatcher, said <code>MessageDispatcher</code> starts processing the request. The list below describes the complete process a request goes through when handled by a <code>MessageDispatcher</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An appropriate endpoint is searched for using the configured <code>EndpointMapping(s)</code>. If an endpoint is found, the invocation chain associated with the endpoint (pre-processors, post-processors, and endpoints) will be executed in order to create a response.</p>
</li>
<li>
<p>An appropriate adapter is searched for the endpoint. The <code>MessageDispatcher</code> delegates to this adapter to invoke the endpoint.</p>
</li>
<li>
<p>If a response is returned, it is sent on its way. If no response is returned (which could be due to a pre- or post-processor intercepting the request, for example, for security reasons), no response is sent.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Exceptions that are thrown during handling of the request get picked up by any of the endpoint exception resolvers that are declared in the application context. Using these exception resolvers allows you to define custom behaviors (such as returning a SOAP Fault) in case such exceptions get thrown.</p>
</div>
<div class="paragraph">
<p>The <code>MessageDispatcher</code> has several properties, for setting endpoint adapters, <a href="#server-endpoint-mapping">mappings</a>, <a href="#server-endpoint-exception-resolver">exception resolvers</a>. However, setting these properties is not required, since the dispatcher will automatically detect all of these types that are registered in the application context. Only when detection needs to be overriden, should these properties be set.</p>
</div>
<div class="paragraph">
<p>The message dispatcher operates on a <a href="#message-context">message context</a>, and not transport-specific input stream and output stream. As a result, transport specific requests need to read into a <code>MessageContext</code>. For HTTP, this is done with a <code>WebServiceMessageReceiverHandlerAdapter</code>, which is a Spring Web <code>HandlerInterceptor</code>, so that the <code>MessageDispatcher</code> can be wired in a standard <code>DispatcherServlet</code>. There is a more convenient way to do this, however, which is shown in <a href="#message-dispatcher-servlet"><code>MessageDispatcherServlet</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transports"><a class="anchor" href="#_transports"></a>5.3. Transports</h3>
<div class="paragraph">
<p>Spring Web Services supports multiple transport protocols. The most common is the HTTP transport, for which a custom servlet is supplied, but it is also possible to send messages over JMS, and even email.</p>
</div>
<div class="sect3">
<h4 id="message-dispatcher-servlet"><a class="anchor" href="#message-dispatcher-servlet"></a>5.3.1. <code>MessageDispatcherServlet</code></h4>
<div class="paragraph">
<p>The <code>MessageDispatcherServlet</code> is a standard <code>Servlet</code> which conveniently extends from the standard Spring Web <code>DispatcherServlet</code>, and wraps a <code>MessageDispatcher</code>. As such, it combines the attributes of these into one: as a <code>MessageDispatcher</code>, it follows the same request handling flow as described in the previous section. As a servlet, the <code>MessageDispatcherServlet</code> is configured in the <code>web.xml</code> of your web application. Requests that you want the <code>MessageDispatcherServlet</code> to handle will have to be mapped using a URL mapping in the same <code>web.xml</code> file. This is standard Java EE servlet configuration; an example of such a <code>MessageDispatcherServlet</code> declaration and mapping can be found below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;web-app&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.ws.transport.http.MessageDispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, all requests will be handled by the <code>'spring-ws'</code> <code>MessageDispatcherServlet</code>. This is only the first step in setting up Spring Web Services, because the various component beans used by the Spring-WS framework also need to be configured; this configuration consists of standard Spring XML <code>&lt;bean/&gt;</code> definitions. Because the <code>MessageDispatcherServlet</code> is a standard Spring <code>DispatcherServlet</code>, it will
<em>look for a file named [servlet-name]-servlet.xml</em> in the <code>WEB-INF</code> directory of your web application and create the beans defined there in a Spring container. In the example above, that means that it looks for &#8216;/WEB-INF/spring-ws-servlet.xml&#8217;. This file will contain all of the Spring Web Services beans such as endpoints, marshallers and suchlike.</p>
</div>
<div class="paragraph">
<p>As an alternative for <code>web.xml</code>, if you are running on a Servlet 3+ environment, you can configure Spring-WS programmatically. For this purpose, Spring-WS provides a number of abstract base classes that extend the <code>WebApplicationInitializer</code> interface found in the Spring Framework. If you are also using <code>@Configuration</code> classes for your bean definitions, you are best of extending the <code>AbstractAnnotationConfigMessageDispatcherServletInitializer</code>, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class MyServletInitializer
    extends AbstractAnnotationConfigMessageDispatcherServletInitializer {

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return new Class[]{MyRootConfig.class};
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        return new Class[]{MyEndpointConfig.class};
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we tell Spring that endpoint bean definitions can be found in the <code>MyEndpointConfig</code> class (which is a <code>@Configuration</code> class). Other bean definitions (typically services, repositories, etc.) can be found in the <code>MyRootConfig</code> class. By default, the <code>AbstractAnnotationConfigMessageDispatcherServletInitializer</code> maps the servlet to two patterns: <code>/services</code> and <code>*.wsdl</code>, though this can be changed by overriding the <code>getServletMappings()</code> method. For more details on the programmatic configuration of the <code>MessageDispatcherServlet</code>, refer to the Javadoc of <code>AbstractMessageDispatcherServletInitializer</code> and <code>AbstractAnnotationConfigMessageDispatcherServletInitializer</code>.</p>
</div>
<div class="sect4">
<h5 id="server-automatic-wsdl-exposure"><a class="anchor" href="#server-automatic-wsdl-exposure"></a>Automatic WSDL exposure</h5>
<div class="paragraph">
<p>The <code>MessageDispatcherServlet</code> will automatically detect any <code>WsdlDefinition</code> beans defined in it&#8217;s Spring container. All such <code>WsdlDefinition</code> beans that are detected will also be exposed via a <code>WsdlDefinitionHandlerAdapter</code>; this is a very convenient way to expose your WSDL to clients simply by just defining some beans.</p>
</div>
<div class="paragraph">
<p>By way of an example, consider the following <code>&lt;static-wsdl&gt;`definition, defined in the Spring-WS configuration file (</code>/WEB-INF/[servlet-name]-servlet.xml`). Take notice of the value of the &#8216;id&#8217; attribute, because this will be used when exposing the WSDL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;sws:static-wsdl id="orders" location="orders.wsdl"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or as <code>@Bean</code> method in a <code>@Configuration</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
public SimpleWsdl11Definition orders() {
	return new SimpleWsdl11Definition(new ClassPathResource("orders.wsdl"));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The WSDL defined in the &#8216;orders.wsdl&#8217; file on the classpath can then be accessed via <code>GET</code> requests to a URL of the following form (substitute the host, port and servlet context path as appropriate).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>http://localhost:8080/spring-ws/orders.wsdl</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All <code>WsdlDefinition</code> bean definitions are exposed by the <code>MessageDispatcherServlet</code> under their bean name with the suffix <code>.wsdl</code>. So if the bean name is <code>echo</code>, the host name is "server", and the Servlet context (war name) is "spring-ws", the WSDL can be obtained via <code><a href="http://server/spring-ws/echo.wsdl" class="bare">http://server/spring-ws/echo.wsdl</a></code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another nice feature of the <code>MessageDispatcherServlet</code> (or more correctly the <code>WsdlDefinitionHandlerAdapter</code>) is that it is able to transform the value of the &#8216;location&#8217; of all the WSDL that it exposes to reflect the URL of the incoming request.</p>
</div>
<div class="paragraph">
<p>Please note that this &#8216;location&#8217; transformation feature is <strong>off</strong> by default.To switch this feature on, you just need to specify an initialization parameter to the <code>MessageDispatcherServlet</code>, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;web-app&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.ws.transport.http.MessageDispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;transformWsdlLocations&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;spring-ws&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use the <code>AbstractAnnotationConfigMessageDispatcherServletInitializer</code>, enabling transformation is as simple as overriding the <code>isTransformWsdlLocations()</code> method to return <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Consult the class-level Javadoc on the <code>WsdlDefinitionHandlerAdapter</code> class to learn more about the whole transformation process.</p>
</div>
<div class="paragraph">
<p>As an alternative to writing the WSDL by hand, and exposing it with <code>&lt;static-wsdl&gt;</code>, Spring Web Services can also generate a WSDL from an XSD schema. This is the approach shown in <a href="#tutorial-publishing-wsdl">Publishing the WSDL</a>. The next application context snippet shows how to create such a dynamic WSDL file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;sws:dynamic-wsdl id="orders"
    portTypeName="Orders"
    locationUri="http://localhost:8080/ordersService/"&gt;
  &lt;sws:xsd location="Orders.xsd"/&gt;
&lt;/sws:dynamic-wsdl&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, as <code>@Bean</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
public DefaultWsdl11Definition orders() {
    DefaultWsdl11Definition definition = new DefaultWsdl11Definition();
    definition.setPortTypeName("Orders");
    definition.setLocationUri("http://localhost:8080/ordersService/");
    definition.setSchema(new SimpleXsdSchema(new ClassPathResource("echo.xsd")));

    return definition;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;dynamic-wsdl&gt;</code> element depends on the <code>DefaultWsdl11Definition</code> class. This definition class uses WSDL providers in the <code>org.springframework.ws.wsdl.wsdl11.provider</code> package and the <code>ProviderBasedWsdl4jDefinition</code> to generate a WSDL the first time it is requested. Refer to the class-level Javadoc of these classes to see how you can extend this mechanism, if necessary.</p>
</div>
<div class="paragraph">
<p>The <code>DefaultWsdl11Definition</code> (and therefore, the <code>&lt;dynamic-wsdl&gt;</code> tag) builds a WSDL from a XSD schema by using conventions. It iterates over all <code>element</code> elements found in the schema, and creates a <code>message</code> for all elements. Next, it creates WSDL <code>operation</code> for all messages that end with the defined request or response suffix. The default request suffix is <code>Request</code>; the default response suffix is <code>Response</code>, though these can be changed by setting the <code>requestSuffix</code> and <code>responseSuffix</code> attributes on <code>&lt;dynamic-wsdl /&gt;</code>, respectively. It also builds a <code>portType</code>, <code>binding</code>, and <code>service</code> based on the operations.</p>
</div>
<div class="paragraph">
<p>For instance, if our <code>Orders.xsd</code> schema defines the <code>GetOrdersRequest</code> and <code>GetOrdersResponse</code> elements, <code>&lt;dynamic-wsdl&gt;</code> will create a <code>GetOrdersRequest</code> and <code>GetOrdersResponse</code> message, and a <code>GetOrders</code> operation, which is put in a <code>Orders</code> port type.</p>
</div>
<div class="paragraph">
<p>If you want to use multiple schemas, either by includes or imports, you will want to put Commons XMLSchema on the class path. If Commons XMLSchema is on the class path, the above <code>&lt;dynamic-wsdl&gt;</code> element will follow all XSD imports and includes, and will inline them in the WSDL as a single XSD. This greatly simplifies the deployment of the schemas, which still making it possible to edit them separately.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Even though it can be quite handy to create the WSDL at runtime from your XSDs, there are a couple of drawbacks to this approach. First off, though we try to keep the WSDL generation process consistent between releases, there is still the possibility that it changes (slightly). Second, the generation is a bit slow, though once generated, the WSDL is cached for later reference.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is therefore recommended to only use <code>&lt;dynamic-wsdl&gt;</code> during the development stages of your project. Then, we recommend to use your browser to download the generated WSDL, store it in the project, and expose it with <code>&lt;static-wsdl&gt;</code>. This is the only way to be really sure that the WSDL does not change over time.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wiring_up_spring_ws_in_a_code_dispatcherservlet_code"><a class="anchor" href="#_wiring_up_spring_ws_in_a_code_dispatcherservlet_code"></a>5.3.2. Wiring up Spring-WS in a <code>DispatcherServlet</code></h4>
<div class="paragraph">
<p>As an alternative to the <code>MessageDispatcherServlet</code>, you can wire up a <code>MessageDispatcher</code> in a standard, Spring-Web MVC <code>DispatcherServlet</code>. By default, the <code>DispatcherServlet</code> can only delegate to <code>Controllers</code>, but we can instruct it to delegate to a <code>MessageDispatcher</code> by adding a <code>WebServiceMessageReceiverHandlerAdapter</code> to the servlet&#8217;s web application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean class="org.springframework.ws.transport.http.WebServiceMessageReceiverHandlerAdapter"/&gt;

    &lt;bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
        &lt;property name="defaultHandler" ref="messageDispatcher"/&gt;
    &lt;/bean

    &lt;bean id="messageDispatcher" class="org.springframework.ws.soap.server.SoapMessageDispatcher"/&gt;

    ...

    &lt;bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that by explicitly adding the <code>WebServiceMessageReceiverHandlerAdapter</code>, the dispatcher servlet does not load the default adapters, and is unable to handle standard Spring-MVC <code>@Controllers</code>. Therefore, we add the <code>RequestMappingHandlerAdapter</code> at the end.</p>
</div>
<div class="paragraph">
<p>In a similar fashion, you can wire up a <code>WsdlDefinitionHandlerAdapter</code> to make sure the <code>DispatcherServlet</code> can handle implementations of the <code>WsdlDefinition</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean class="org.springframework.ws.transport.http.WebServiceMessageReceiverHandlerAdapter"/&gt;

    <strong>&lt;bean class="org.springframework.ws.transport.http.WsdlDefinitionHandlerAdapter"/&gt;</strong>

    &lt;bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"&gt;
        &lt;property name="mappings"&gt;
           &lt;props&gt;
             <strong>&lt;prop key="*.wsdl"&gt;myServiceDefinition&lt;/prop&gt;</strong>
           &lt;/props&gt;
        &lt;/property&gt;
        &lt;property name="defaultHandler" ref="messageDispatcher"/&gt;
    &lt;/bean&gt;

    &lt;bean id="messageDispatcher" class="org.springframework.ws.soap.server.SoapMessageDispatcher"/&gt;

    <strong>&lt;bean id="myServiceDefinition" class="org.springframework.ws.wsdl.wsdl11.SimpleWsdl11Definition"&gt;
       &lt;prop name="wsdl" value="/WEB-INF/myServiceDefintion.wsdl"/&gt;
    &lt;/bean&gt;</strong>

    ...

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jms_transport"><a class="anchor" href="#_jms_transport"></a>5.3.3. JMS transport</h4>
<div class="paragraph">
<p>Spring Web Services supports server-side JMS handling through the JMS functionality provided in the Spring framework. Spring Web Services provides the <code>WebServiceMessageListener</code> to plug in to a <code>MessageListenerContainer</code>. This message listener requires a <code>WebServiceMessageFactory</code> to and <code>MessageDispatcher</code> to operate. The following piece of configuration shows this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
        &lt;property name="brokerURL" value="vm://localhost?broker.persistent=false"/&gt;
    &lt;/bean&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean class="org.springframework.jms.listener.DefaultMessageListenerContainer"&gt;
        &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
        &lt;property name="destinationName" value="RequestQueue"/&gt;
        &lt;property name="messageListener"&gt;
            &lt;bean class="org.springframework.ws.transport.jms.WebServiceMessageListener"&gt;
                &lt;property name="messageFactory" ref="messageFactory"/&gt;
                &lt;property name="messageReceiver" ref="messageDispatcher"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="messageDispatcher" class="org.springframework.ws.soap.server.SoapMessageDispatcher"&gt;
        &lt;property name="endpointMappings"&gt;
            &lt;bean
              class="org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping"&gt;
                &lt;property name="defaultEndpoint"&gt;
                    &lt;bean class="com.example.MyEndpoint"/&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_email_transport"><a class="anchor" href="#_email_transport"></a>5.3.4. Email transport</h4>
<div class="paragraph">
<p>In addition to HTTP and JMS, Spring Web Services also provides server-side email handling. This functionality is provided through the <code>MailMessageReceiver</code> class. This class monitors a POP3 or IMAP folder, converts the email to a <code>WebServiceMessage</code>, sends any response using SMTP. The host names can be configured through the <code>storeUri</code>, which indicates the mail folder to monitor for requests (typically a POP3 or IMAP folder), and a <code>transportUri</code>, which indicates the server to use for sending responses (typically a SMTP server).</p>
</div>
<div class="paragraph">
<p>How the <code>MailMessageReceiver</code> monitors incoming messages can be configured with a pluggable strategy: the <code>MonitoringStrategy</code>. By default, a polling strategy is used, where the incoming folder is polled for new messages every five minutes. This interval can be changed by setting the <code>pollingInterval</code> property on the strategy. By default, all <code>MonitoringStrategy</code> implementations delete the handled messages; this can be changed by setting the <code>deleteMessages</code> property.</p>
</div>
<div class="paragraph">
<p>As an alternative to the polling approaches, which are quite inefficient, there is a monitoring strategy that uses IMAP <strong>IDLE</strong>. The <strong>IDLE</strong> command is an optional expansion of the IMAP email protocol that allows the mail server to send new message updates to the <code>MailMessageReceiver</code> asynchronously. If you use a IMAP server that supports the <strong>IDLE</strong> command, you can plug in the <code>ImapIdleMonitoringStrategy</code> into the <code>monitoringStrategy</code> property. In addition to a supporting server, you will need to use JavaMail version 1.4.1 or higher.</p>
</div>
<div class="paragraph">
<p>The following piece of configuration shows how to use the server-side email support, overiding the default polling interval to a value which checks every 30 seconds (30.000 milliseconds):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="messagingReceiver" class="org.springframework.ws.transport.mail.MailMessageReceiver"&gt;
        &lt;property name="messageFactory" ref="messageFactory"/&gt;
        &lt;property name="from" value="Spring-WS SOAP Server &amp;lt;server@example.com&amp;gt;"/&gt;
        &lt;property name="storeUri" value="imap://server:s04p@imap.example.com/INBOX"/&gt;
        &lt;property name="transportUri" value="smtp://smtp.example.com"/&gt;
        &lt;property name="messageReceiver" ref="messageDispatcher"/&gt;
        &lt;property name="monitoringStrategy"&gt;
            &lt;bean class="org.springframework.ws.transport.mail.monitor.PollingMonitoringStrategy"&gt;
                &lt;property name="pollingInterval" value="30000"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="messageDispatcher" class="org.springframework.ws.soap.server.SoapMessageDispatcher"&gt;
        &lt;property name="endpointMappings"&gt;
            &lt;bean
              class="org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping"&gt;
                &lt;property name="defaultEndpoint"&gt;
                    &lt;bean class="com.example.MyEndpoint"/&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_embedded_http_server_transport"><a class="anchor" href="#_embedded_http_server_transport"></a>5.3.5. Embedded HTTP Server transport</h4>
<div class="paragraph">
<p>Spring Web Services provides a transport based on Sun&#8217;s JRE 1.6 <a href="http://java.sun.com/javase/6/docs/jre/api/net/httpserver/spec/index.html">HTTP server</a>. The embedded HTTP Server is a standalone server that is simple to configure. It lends itself to a lighter  alternative to conventional servlet containers.</p>
</div>
<div class="paragraph">
<p>When using the embedded HTTP server, no external deployment descriptor is needed (<code>web.xml</code>). You only need to define an instance of the server and configure it to handle incoming requests. The remoting module in the Core Spring Framework contains a convenient factory bean for the HTTP server: the <code>SimpleHttpServerFactoryBean</code>. The most important property is <code>contexts</code>, which maps context paths to corresponding `HttpHandler`s.</p>
</div>
<div class="paragraph">
<p>Spring Web Services provides 2 implementations of the <code>HttpHandler</code> interface: <code>WsdlDefinitionHttpHandler</code> and <code>WebServiceMessageReceiverHttpHandler</code>. The former maps an incoming GET request to a <code>WsdlDefinition</code>. The latter is responsible for handling POST requests for web services messages and thus needs a <code>WebServiceMessageFactory</code> (typically a <code>SaajSoapMessageFactory</code>) and a <code>WebServiceMessageReceiver</code> (typically the <code>SoapMessageDispatcher</code>) to accomplish its task.</p>
</div>
<div class="paragraph">
<p>To draw parallels with the servlet world, the <code>contexts</code> property plays the role of servlet mappings in <code>web.xml</code> and the <code>WebServiceMessageReceiverHttpHandler</code> is the equivalent of a <code>MessageDispatcherServlet</code>.</p>
</div>
<div class="paragraph">
<p>The following snippet shows a simple configuration example of the HTTP server transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="messageReceiver" class="org.springframework.ws.soap.server.SoapMessageDispatcher"&gt;
        &lt;property name="endpointMappings" ref="endpointMapping"/&gt;
    &lt;/bean&gt;

    &lt;bean id="endpointMapping" class="org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping"&gt;
        &lt;property name="defaultEndpoint" ref="stockEndpoint"/&gt;
    &lt;/bean&gt;

    &lt;bean id="httpServer" class="org.springframework.remoting.support.SimpleHttpServerFactoryBean"&gt;
        &lt;property name="contexts"&gt;
            &lt;map&gt;
                &lt;entry key="/StockService.wsdl" value-ref="wsdlHandler"/&gt;
                &lt;entry key="/StockService" value-ref="soapHandler"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id="soapHandler" class="org.springframework.ws.transport.http.WebServiceMessageReceiverHttpHandler"&gt;
        &lt;property name="messageFactory" ref="messageFactory"/&gt;
        &lt;property name="messageReceiver" ref="messageReceiver"/&gt;
    &lt;/bean&gt;

    &lt;bean id="wsdlHandler" class="org.springframework.ws.transport.http.WsdlDefinitionHttpHandler"&gt;
        &lt;property name="definition" ref="wsdlDefinition"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the <code>SimpleHttpServerFactoryBean</code>, refer to the <a href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/remoting/support/SimpleHttpServerFactoryBean.html">Javadoc</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_xmpp_transport"><a class="anchor" href="#_xmpp_transport"></a>5.3.6. XMPP transport</h4>
<div class="paragraph">
<p>Finally, Spring Web Services 2.0 introduced support for XMPP, otherwise known as Jabber. The support is based on the <a href="https://www.igniterealtime.org/projects/smack/index.jsp">Smack</a> library.</p>
</div>
<div class="paragraph">
<p>Spring Web Services support for XMPP is very similar to the other transports: there is a a <code>XmppMessageSender</code> for the <code>WebServiceTemplate</code> and and a <code>XmppMessageReceiver</code> to use with the <code>MessageDispatcher</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set up the server-side XMPP components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="connection" class="org.springframework.ws.transport.xmpp.support.XmppConnectionFactoryBean"&gt;
        &lt;property name="host" value="jabber.org"/&gt;
        &lt;property name="username" value="username"/&gt;
        &lt;property name="password" value="password"/&gt;
    &lt;/bean&gt;

    &lt;bean id="messagingReceiver" class="org.springframework.ws.transport.xmpp.XmppMessageReceiver"&gt;
        &lt;property name="messageFactory" ref="messageFactory"/&gt;
        &lt;property name="connection" ref="connection"/&gt;
        &lt;property name="messageReceiver" ref="messageDispatcher"/&gt;
    &lt;/bean&gt;

    &lt;bean id="messageDispatcher" class="org.springframework.ws.soap.server.SoapMessageDispatcher"&gt;
        &lt;property name="endpointMappings"&gt;
            &lt;bean
              class="org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping"&gt;
                &lt;property name="defaultEndpoint"&gt;
                    &lt;bean class="com.example.MyEndpoint"/&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mtom"><a class="anchor" href="#_mtom"></a>5.3.7. MTOM</h4>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Message_Transmission_Optimization_Mechanism">MTOM</a> is the mechanism of sending binary data to and from Web Services. You can look at how to implement this with Spring WS through the <a href="https://github.com/spring-projects/spring-ws-samples/tree/master/mtom">MTOM sample</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-endpoints"><a class="anchor" href="#server-endpoints"></a>5.4. Endpoints</h3>
<div class="paragraph">
<p>Endpoints are the central concept in Spring-WS&#8217;s server-side support. Endpoints provide access to the application behavior which is typically defined by a business service interface. An endpoint interprets the XML request message and uses that input to invoke a method on the business service (typically). The result of that service invocation is represented as a response message. Spring-WS has a wide variety of endpoints, using various ways to handle the XML message, and to create a response.</p>
</div>
<div class="paragraph">
<p>You create an endpoint by annotating a class with the <code>@Endpoint</code> annotation. In the class, you define one or more methods that handle the incoming XML request, by using a wide variety of parameter types (such as DOM elements, JAXB2 objects, etc). You indicate the sort of messages a method can handle by using another annotation (typically <code>@PayloadRoot</code>).</p>
</div>
<div class="paragraph">
<p>Consider the following sample endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package samples;

import org.w3c.dom.Element;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.soap.SoapHeader;

@Endpoint                                                                                      <i class="conum" data-value="1"></i><b>(1)</b>
public class AnnotationOrderEndpoint {

  private final OrderService orderService;

  @Autowired                                                                                   <i class="conum" data-value="2"></i><b>(2)</b>
  public AnnotationOrderEndpoint(OrderService orderService) {
      this.orderService = orderService;
  }

  @PayloadRoot(localPart = "order", namespace = "http://samples")                              <i class="conum" data-value="5"></i><b>(5)</b>
  public void order(@RequestPayload Element orderElement) {                                    <i class="conum" data-value="3"></i><b>(3)</b>
    Order order = createOrder(orderElement);
    orderService.createOrder(order);
  }

  @PayloadRoot(localPart = "orderRequest", namespace = "http://samples")                       <i class="conum" data-value="5"></i><b>(5)</b>
  @ResponsePayload
  public Order getOrder(@RequestPayload OrderRequest orderRequest, SoapHeader header) {        <i class="conum" data-value="4"></i><b>(4)</b>
    checkSoapHeaderForSomething(header);
    return orderService.getOrder(orderRequest.getId());
  }

  ...

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with <code>@Endpoint</code>, marking it as a Spring-WS endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constructor is marked with <code>@Autowired</code>, so that the <code>OrderService</code> business service is injected into this endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>order</code> method takes an <code>Element</code> as a parameter, annotated with <code>@RequestPayload</code>. This means that the payload of the message is passed on this method as a DOM element. The method has a <code>void</code> return type, indicating that no response message is sent.
For more information about endpoint methods, refer to <a href="#server-atEndpoint-methods"><code>@Endpoint</code> handling methods</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>getOrder</code> method takes a <code>OrderRequest</code> as a parameter, annotated with <code>@RequestPayload</code> as well. This parameter is a JAXB2-supported object (it is annotated with <code>@XmlRootElement</code>). This means that the payload of the message is passed on to this method as a unmarshalled object. The <code>SoapHeader</code> type is also given as a parameter. On invocation, this parameter will contain the SOAP header of the request message. The method is also annotated with <code>@ResponsePayload</code>, indicating that the return value (the <code>Order</code>) is used as the payload of the response message.
For more information about endpoint methods, refer to <a href="#server-atEndpoint-methods"><code>@Endpoint</code> handling methods</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The two handling methods of this endpoint are marked with <code>@PayloadRoot</code>, indicating what sort of request messages can be handled by the method: the <code>getOrder</code> method will be invoked for requests with a <code>orderRequest</code> local name and a <code><a href="http://samples" class="bare">http://samples</a></code> namespace URI; the order method for requests with a <code>order</code> local name.
For more information about <code>@PayloadRoot</code>, refer to <a href="#server-endpoint-mapping">Endpoint mappings</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable the support for <code>@Endpoint</code> and related Spring-WS annotations, you will need to add the following to your Spring application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  <strong>xmlns:sws="http://www.springframework.org/schema/web-services"</strong>
  xsi:schemaLocation="http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
    <strong>http://www.springframework.org/schema/web-services
      http://www.springframework.org/schema/web-services/web-services.xsd"&gt;

  &lt;sws:annotation-driven /&gt;</strong>

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, if you are using <code>@Configuration</code> classes instead of Spring XML, you can annotate your configuration class with <code>@EnableWs</code>, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java"><strong>@EnableWs</strong>
@Configuration
public class EchoConfig {

    // @Bean definitions go here

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To customize the <code>@EnableWs</code> configuration, you can implement <code>WsConfigurer</code>, or better yet extend the <code>WsConfigurerAdapter</code>. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Configuration
@EnableWs
@ComponentScan(basePackageClasses = { MyConfiguration.class })
public class MyConfiguration extends WsConfigurerAdapter {

  @Override
  public void addInterceptors(List&lt;EndpointInterceptor&gt; interceptors) {
    interceptors.add(new MyInterceptor());
  }

  @Override
  public void addArgumentResolvers(List&lt;MethodArgumentResolver&gt; argumentResolvers) {
    argumentResolvers.add(new MyArgumentResolver());
  }

  // More overridden methods ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next couple of sections, a more elaborate description of the <code>@Endpoint</code> programming model is given.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Endpoints, like any other Spring Bean, are scoped as a singleton by default, i.e. one instance of the bean definition is created per container. Being a singleton implies that more than one thread can use it at the same time, so the endpoint has to be thread safe. If you want to use a different scope, such as prototype, refer to the <a href="http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-scopes">Spring Reference documentation</a>.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>Note that all abstract base classes provided in Spring-WS are thread safe, unless otherwise indicated in the class-level Javadoc.</pre>
</div>
</div>
<div class="sect3">
<h4 id="server-atEndpoint-methods"><a class="anchor" href="#server-atEndpoint-methods"></a>5.4.1. <code>@Endpoint</code> handling methods</h4>
<div class="paragraph">
<p>In order for an endpoint to actually handle incoming XML messages, it needs to have one or more handling methods. Handling methods can take wide range of parameters and return types, but typically they have one parameter that will contain the message payload, and they return the payload of the response message (if any). You will learn which parameter and return types are supported in this section.</p>
</div>
<div class="paragraph">
<p>To indicate what sort of messages a method can handle, the method is typically annotated with either the <code>@PayloadRoot</code> or <code>@SoapAction</code> annotation. You will learn more about these annotations in <a href="#server-endpoint-mapping">Endpoint mappings</a>.</p>
</div>
<div class="paragraph">
<p>Here is an example of a handling method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@PayloadRoot(localPart = "order", namespace = "http://samples")
public void order(@RequestPayload Element orderElement) {
  Order order = createOrder(orderElement);
  orderService.createOrder(order);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>order</code> method takes a <code>Element</code> as a parameter, annotated with <code>@RequestPayload</code>. This means that the payload of the message is passed on this method as a DOM element. The method has a <code>void</code> return type, indicating that no response message is sent.</p>
</div>
<div class="sect4">
<h5 id="_handling_method_parameters"><a class="anchor" href="#_handling_method_parameters"></a>Handling method parameters</h5>
<div class="paragraph">
<p>The handling method typically has one or more parameters that refer to various parts of the incoming XML message. Most commonly, the handling method will have a single parameter that will map to the payload of the message, but it is also possible to map to other parts of the request message, such as a SOAP header. This section will describe the parameters you can use in your handling method signatures.</p>
</div>
<div class="paragraph">
<p>To map a parameter to the payload of the request message, you will need to annotate this parameter with the <code>@RequestPayload</code> annotation. This annotation tells Spring-WS that the parameter needs to be bound to the request payload.</p>
</div>
<div class="paragraph">
<p>The following table describes the supported parameter types. It shows the supported types, whether the parameter should be annotated with <code>@RequestPayload</code>, and any additional notes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Supported parameter types</th>
<th class="tableblock halign-left valign-top"><code>@RequestPayload</code> required?</th>
<th class="tableblock halign-left valign-top">Additional notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TrAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.Source</code> and sub-interfaces (<code>DOMSource</code>, <code>SAXSource</code>, <code>StreamSource</code>, and <code>StAXSource</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">W3C DOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.w3c.dom.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dom4j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.dom4j.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when dom4j is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jdom.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when JDOM is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nu.xom.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when XOM is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.stream.XMLStreamReader</code> and <code>javax.xml.stream.XMLEventReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when StAX is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any boolean, double, <code>String</code>, <code>org.w3c.Node</code>, <code>org.w3c.dom.NodeList</code>, or type that can be converted from a <code>String</code> by a Spring 3 <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/validation.html#core-convert">conversion service</a>, and that is annotated with <code>@XPathParam</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default, see <a href="#server-xpath-param">the section called <code>XPathParam</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.springframework.ws.context.MessageContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.springframework.ws.soap.SoapMessage</code>, <code>org.springframework.ws.soap.SoapBody</code>, <code>org.springframework.ws.soap.SoapEnvelope</code>, <code>org.springframework.ws.soap.SoapHeader</code>, and <code>org.springframework.ws.soap.SoapHeaderElement`s when used in combination with the `@SoapHeader</code> annotation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAXB2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that is annotated with <code>javax.xml.bind.annotation.XmlRootElement</code>, and <code>javax.xml.bind.JAXBElement</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when JAXB2 is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OXM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type supported by a Spring OXM <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/oxm.html#d0e26164"><code>Unmarshaller</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when the <code>unmarshaller</code> attribute of <code>&lt;sws:annotation-driven/&gt;</code> is specified.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are some examples of possible method signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void handle(@RequestPayload Element element)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will be invoked with the payload of the request message as a DOM <code>org.w3c.dom.Element</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void handle(@RequestPayload DOMSource domSource, SoapHeader header)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will be invoked with the payload of the request message as a <code>javax.xml.transform.dom.DOMSource</code>. The <strong>header</strong> parameter will be bound to the SOAP header of the request message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void handle(@RequestPayload MyJaxb2Object requestObject, @RequestPayload Element element, Message messageContext)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will be invoked with the payload of the request message unmarshalled into a <code>MyJaxb2Object</code> (which is annotated with <code>@XmlRootElement</code>). The payload of the message is also given as a DOM <code>Element</code>. The whole <a href="#message-context">message context</a> is passed on as the third parameter.</p>
</div>
<div class="paragraph">
<p>As you can see, there are a lot of possibilities when it comes to defining handling method signatures. It is even possible to extend this mechanism, and to support your own parameter types. Refer to the class-level Javadoc of <code>DefaultMethodEndpointAdapter</code> and <code>MethodArgumentResolver</code> to see how.</p>
</div>
<div class="sect5">
<h6 id="server-xpath-param"><a class="anchor" href="#server-xpath-param"></a><code>@XPathParam</code></h6>
<div class="paragraph">
<p>One parameter type needs some extra explanation: <code>@XPathParam</code>. The idea here is that you simply annotate one or more method parameter with an XPath expression, and that each such annotated parameter will be bound to the evaluation of the expression. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package samples;

import javax.xml.transform.Source;

import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.Namespace;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.server.endpoint.annotation.XPathParam;

@Endpoint
public class AnnotationOrderEndpoint {

  private final OrderService orderService;

  public AnnotationOrderEndpoint(OrderService orderService) {
    this.orderService = orderService;
  }

  @PayloadRoot(localPart = "orderRequest", namespace = "http://samples")
  <strong>@Namespace(prefix = "s", uri="http://samples")</strong>
  public Order getOrder(<strong>@XPathParam("/s:orderRequest/@id") int orderId</strong>) {
    Order order = orderService.getOrder(orderId);
    // create Source from order and return it
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we use the prefix <code>s</code> in our XPath expression, we must bind it to the <code><a href="http://samples" class="bare">http://samples</a></code> namespace. This is accomplished with the <code>@Namespace</code> annotation. Alternatively, we could have placed this annotation on the type-level to use the same namespace mapping for all handler methods, or even the package-level (in <code>package-info.java</code>) to use it for multiple endpoints.</p>
</div>
<div class="paragraph">
<p>Using the <code>@XPathParam</code>, you can bind to all the data types supported by XPath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>boolean</code> or <code>Boolean</code></p>
</li>
<li>
<p><code>double</code> or <code>Double</code></p>
</li>
<li>
<p><code>String</code></p>
</li>
<li>
<p><code>Node</code></p>
</li>
<li>
<p><code>NodeList</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to this list, you can use any type that can be converted from a <code>String</code> by a Spring 3 <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/validation.html#core-convert">conversion service</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_handling_method_return_types"><a class="anchor" href="#_handling_method_return_types"></a>Handling method return types</h5>
<div class="paragraph">
<p>To send a response message, the handling needs to specify a return type. If no response message is required, the method can simply declare a <code>void</code> return type. Most commonly, the return type is used to create the payload of the response message, but it is also possible to map to other parts of the response message. This section will describe the return types you can use in your handling method signatures.</p>
</div>
<div class="paragraph">
<p>To map the return value to the payload of the response message, you will need to annotate the method with the <code>@ResponsePayload</code> annotation. This annotation tells Spring-WS that the return value needs to be bound to the response payload.</p>
</div>
<div class="paragraph">
<p>The following table describes the supported return types. It shows the supported types, whether the parameter should be annotated with <code>@ResponsePayload</code>, and any additional notes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Supported return types</th>
<th class="tableblock halign-left valign-top"><code>@ResponsePayload</code> required?</th>
<th class="tableblock halign-left valign-top">Additional notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TrAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.Source</code> and sub-interfaces (<code>DOMSource</code>, <code>SAXSource</code>, <code>StreamSource</code>, and <code>StAXSource</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">W3C DOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.w3c.dom.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dom4j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.dom4j.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when dom4j is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.jdom.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when JDOM is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nu.xom.Element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when XOM is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAXB2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that is annotated with <code>javax.xml.bind.annotation.XmlRootElement</code>, and <code>javax.xml.bind.JAXBElement</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when JAXB2 is on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OXM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type supported by a Spring OXM <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/oxm.html#d0e26096"><code>Marshaller</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when the <code>marshaller</code> attribute of <code>&lt;sws:annotation-driven/&gt;</code> is specified.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see, there are a lot of possibilities when it comes to defining handling method signatures. It is even possible to extend this mechanism, and to support your own parameter types. Refer to the class-level Javadoc of <code>DefaultMethodEndpointAdapter</code> and <code>MethodReturnValueHandler</code> to see how.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-endpoint-mapping"><a class="anchor" href="#server-endpoint-mapping"></a>5.5. Endpoint mappings</h3>
<div class="paragraph">
<p>The endpoint mapping is responsible for mapping incoming messages to appropriate endpoints. There are some endpoint mappings that are enabled out of the box, for example, the <code>PayloadRootAnnotationMethodEndpointMapping</code> or the <code>SoapActionAnnotationMethodEndpointMapping</code>, but let&#8217;s first examine the general concept of an <code>EndpointMapping</code>.</p>
</div>
<div class="paragraph">
<p>An <code>EndpointMapping</code> delivers a <code>EndpointInvocationChain</code>, which contains the endpoint that matches the incoming request, and may also contain a list of endpoint interceptors that will be applied to the request and response. When a request comes in, the <code>MessageDispatcher</code> will hand it over to the endpoint mapping to let it inspect the request and come up with an appropriate <code>EndpointInvocationChain</code>. Then the <code>MessageDispatcher</code> will invoke the endpoint and any interceptors in the chain.</p>
</div>
<div class="paragraph">
<p>The concept of configurable endpoint mappings that can optionally contain interceptors (which can manipulate the request or the response, or both) is extremely powerful. A lot of supporting functionality can be built into custom `EndpointMapping`s. For example, there could be a custom endpoint mapping that chooses an endpoint not only based on the contents of a message, but also on a specific SOAP header (or indeed multiple SOAP headers).</p>
</div>
<div class="paragraph">
<p>Most endpoint mappings inherit from the <code>AbstractEndpointMapping</code>, which offers an &#8216;interceptors&#8217; property, which is the list of interceptors to use. <code>EndpointInterceptors</code> are discussed in <a href="#server-endpoint-interceptor">Intercepting requests - the <code>EndpointInterceptor</code> interface</a>. Additionally, there is the &#8216;defaultEndpoint&#8217;, which is the default endpoint to use when this endpoint mapping does not result in a matching endpoint.</p>
</div>
<div class="paragraph">
<p>As explained in <a href="#server-endpoints">Endpoints</a>, the <code>@Endpoint</code> style allows you to handle multiple requests in one endpoint class. This is the responsibility of the <code>MethodEndpointMapping</code>. This mapping determines which method is to be invoked for an incoming request message.</p>
</div>
<div class="paragraph">
<p>There are two endpoint mappings that can direct requests to methods: the <code>PayloadRootAnnotationMethodEndpointMapping</code> and the <code>SoapActionAnnotationMethodEndpointMapping</code>, both of which are enabled by using <code>&lt;sws:annotation-driven/&gt;</code> in your application context.</p>
</div>
<div class="paragraph">
<p>The <code>PayloadRootAnnotationMethodEndpointMapping</code> uses the <code>@PayloadRoot</code> annotation, with the <code>localPart</code> and <code>namespace</code> elements, to mark methods with a particular qualified name. Whenever a message comes in which has this qualified name for the payload root element, the method will be invoked. For an example, see <a href="#server-payload-root-annotation">above</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the <code>SoapActionAnnotationMethodEndpointMapping</code> uses the <code>@SoapAction</code> annotation to mark methods with a particular SOAP Action. Whenever a message comes in which has this <code>SOAPAction</code> header, the method will be invoked.</p>
</div>
<div class="sect3">
<h4 id="server-ws-addressing"><a class="anchor" href="#server-ws-addressing"></a>5.5.1. WS-Addressing</h4>
<div class="paragraph">
<p>WS-Addressing specifies a transport-neutral routing mechanism. It is based on a <code>To</code> and <code>Action</code> SOAP header, which indicate the destination and intent of the SOAP message, respectively. Additionally, WS-Addressing allows you to define a return address (for normal messages and for faults), and a unique message identifier which can be used for correlation <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup>. Here is an example of a WS-Addressing message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://www.w3.org/2003/05/soap-envelope"
    xmlns:wsa="http://www.w3.org/2005/08/addressing"&gt;
  &lt;SOAP-ENV::Header&gt;
    &lt;wsa:MessageID&gt;urn:uuid:21363e0d-2645-4eb7-8afd-2f5ee1bb25cf&lt;/wsa:MessageID&gt;
    &lt;wsa:ReplyTo&gt;
      &lt;wsa:Address&gt;http://example.com/business/client1&lt;/wsa:Address&gt;
    &lt;/wsa:ReplyTo&gt;
    &lt;wsa:To S:mustUnderstand="true"&gt;http://example/com/fabrikam&lt;/wsa:To&gt;
    &lt;wsa:Action&gt;http://example.com/fabrikam/mail/Delete&lt;/wsa:Action&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;f:Delete xmlns:f="http://example.com/fabrikam"&gt;
      &lt;f:maxCount&gt;42&lt;/f:maxCount&gt;
    &lt;/f:Delete&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the destination is set to <code><a href="http://example/com/fabrikam" class="bare">http://example/com/fabrikam</a></code>, while the action is set to <code><a href="http://example.com/fabrikam/mail/Delete" class="bare">http://example.com/fabrikam/mail/Delete</a></code>. Additionally, there is a message identifier, and an reply-to address. By default, this address is the "anonymous" address, indicating that a response should be sent using the same channel as the request (i.e. the HTTP response), but it can also be another address, as indicated in this example.</p>
</div>
<div class="paragraph">
<p>In Spring Web Services, WS-Addressing is implemented as an endpoint mapping. Using this mapping, you associate WS-Addressing actions with endpoints, similar to the <code>SoapActionAnnotationMethodEndpointMapping</code> described above.</p>
</div>
<div class="sect4">
<h5 id="_code_annotationactionendpointmapping_code"><a class="anchor" href="#_code_annotationactionendpointmapping_code"></a><code>AnnotationActionEndpointMapping</code></h5>
<div class="paragraph">
<p>The <code>AnnotationActionEndpointMapping</code> is similar to the <code>SoapActionAnnotationMethodEndpointMapping</code>, but uses WS-Addressing headers instead of the SOAP Action transport header.</p>
</div>
<div class="paragraph">
<p>To use the <code>AnnotationActionEndpointMapping</code>, annotate the handling methods with the <code>@Action</code> annotation, similar to the <code>@PayloadRoot</code> and <code>@SoapAction</code> annotations described in <a href="#server-atEndpoint-methods"><code>@Endpoint</code> handling methods</a> and <a href="#server-endpoint-mapping">Endpoint mappings</a>. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package samples;

import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.soap.addressing.server.annotation.Action

@Endpoint
public class AnnotationOrderEndpoint {
    private final OrderService orderService;

    public AnnotationOrderEndpoint(OrderService orderService) {
        this.orderService = orderService;
    }

    @Action("http://samples/RequestOrder")
    public Order getOrder(OrderRequest orderRequest) {
        return orderService.getOrder(orderRequest.getId());
    }

    @Action("http://samples/CreateOrder")
    public void order(Order order) {
        orderService.createOrder(order);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping above routes requests which have a WS-Addressing <code>Action</code> of <code><a href="http://samples/RequestOrder" class="bare">http://samples/RequestOrder</a></code> to the <code>getOrder</code> method. Requests with <code><a href="http://samples/CreateOrder" class="bare">http://samples/CreateOrder</a></code> will be routed to the <code>order</code> method..</p>
</div>
<div class="paragraph">
<p>By default, the <code>AnnotationActionEndpointMapping</code> supports both the 1.0 (May 2006), and the August 2004 editions of WS-Addressing. These two versions are most popular, and are interoperable with Axis 1 and 2, JAX-WS, XFire, Windows Communication Foundation (WCF), and Windows Services Enhancements (WSE) 3.0. If necessary, specific versions of the spec can be injected into the <code>versions</code> property.</p>
</div>
<div class="paragraph">
<p>In addition to the <code>@Action</code> annotation, you can annotate the class with the <code>@Address</code> annotation. If set, the value is compared to the <code>To</code> header property of the incoming message.</p>
</div>
<div class="paragraph">
<p>Finally, there is the <code>messageSenders</code> property, which is required for sending  response messages to non-anonymous, out-of-bound addresses. You can set <code>MessageSender</code> implementations in this property, the same as you would on the <code>WebServiceTemplate</code>. See <a href="#client-transports">URIs and Transports</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="server-endpoint-interceptor"><a class="anchor" href="#server-endpoint-interceptor"></a>5.5.2. Intercepting requests - the <code>EndpointInterceptor</code> interface</h4>
<div class="paragraph">
<p>The endpoint mapping mechanism has the notion of endpoint interceptors. These can be extremely useful when you want to apply specific functionality to certain requests, for example, dealing with security-related SOAP headers, or the logging of request and response message.</p>
</div>
<div class="paragraph">
<p>Endpoint interceptors are typically defined by using a <code>&lt;sws:interceptors&gt;</code> element in your application context. In this element, you can simply define endpoint interceptor beans that apply to all endpoints defined in that application context. Alternatively, you can use <code>&lt;sws:payloadRoot&gt;</code> or <code>&lt;sws:soapAction&gt;</code> elements to specify for which payload root name or SOAP action the interceptor should apply. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;sws:interceptors&gt;
  &lt;bean class="samples.MyGlobalInterceptor"/&gt;
  &lt;sws:payloadRoot namespaceUri="http://www.example.com"&gt;
    &lt;bean class="samples.MyPayloadRootInterceptor"/&gt;
  &lt;/sws:payloadRoot&gt;
  &lt;sws:soapAction value="http://www.example.com/SoapAction"&gt;
    &lt;bean class="samples.MySoapActionInterceptor1"/&gt;
    &lt;ref bean="mySoapActionInterceptor2"/&gt;
  &lt;/sws:soapAction&gt;
&lt;/sws:interceptors&gt;

&lt;bean id="mySoapActionInterceptor2" class="samples.MySoapActionInterceptor2"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we define one 'global' interceptor (<code>MyGlobalInterceptor</code>) that intercepts all request and responses. We also define an interceptor that only applies to XML messages that have the <code><a href="http://www.example.com" class="bare">http://www.example.com</a></code> as a payload root namespace. Here, we could have defined a <code>localPart</code> attribute in addition to the <code>namespaceUri</code> to further limit the messages the interceptor applies to. Finally, we define two interceptors that apply when the message has a <code><a href="http://www.example.com/SoapAction" class="bare">http://www.example.com/SoapAction</a></code> SOAP action. Notice how the second interceptor is actually a reference to a bean definition outside of the <code>&lt;interceptors&gt;</code> element. You can use bean references anywhere inside the <code>&lt;interceptors&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>When using <code>@Configuration</code> classes, you can extend from <code>WsConfigurerAdapter</code> to add interceptors. Like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Configuration
@EnableWs
public class MyWsConfiguration extends WsConfigurerAdapter {

  @Override
  public void addInterceptors(List&lt;EndpointInterceptor&gt; interceptors) {
    interceptors.add(new MyPayloadRootInterceptor());
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interceptors must implement the <code>EndpointInterceptor</code> interface from the <code>org.springframework.ws.server</code> package. This interface defines three methods, one that can be used for handling the request message <strong>before</strong> the actual endpoint will be executed, one that can be used for handling a normal response message, and one that can be used for handling fault messages, both of which will be called <strong>after</strong> the endpoint is executed. These three methods should provide enough flexibility to do all kinds of pre- and post-processing.</p>
</div>
<div class="paragraph">
<p>The <code>handleRequest(..)</code> method on the interceptor returns a boolean value. You can use this method to interrupt or continue the processing of the invocation chain. When this method returns <code>true</code>, the endpoint execution chain will continue, when it returns <code>false</code>, the <code>MessageDispatcher</code> interprets this to mean that the interceptor itself has taken care of things and does not continue executing the other interceptors and the actual endpoint in the invocation chain. The <code>handleResponse(..)</code> and <code>handleFault(..)</code> methods also have a boolean return value. When these methods return <code>false</code>, the response will not be sent back to the client.</p>
</div>
<div class="paragraph">
<p>There are a number of standard <code>EndpointInterceptor</code> implementations you can use in your Web service. Additionally, there is the <code>XwsSecurityInterceptor</code>, which is described in <a href="#security-xws-security-interceptor"><code>XwsSecurityInterceptor</code></a>.</p>
</div>
<div class="sect4">
<h5 id="_code_payloadlogginginterceptor_code_and_code_soapenvelopelogginginterceptor_code"><a class="anchor" href="#_code_payloadlogginginterceptor_code_and_code_soapenvelopelogginginterceptor_code"></a><code>PayloadLoggingInterceptor</code> and <code>SoapEnvelopeLoggingInterceptor</code></h5>
<div class="paragraph">
<p>When developing a Web service, it can be useful to log the incoming and outgoing XML messages. SWS facilitates this with the <code>PayloadLoggingInterceptor</code> and <code>SoapEnvelopeLoggingInterceptor</code> classes. The former logs just the payload of the message to the Commons Logging Log; the latter logs the entire SOAP envelope, including SOAP headers. The following example shows you how to define them in an endpoint mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;sws:interceptors&gt;
    &lt;bean class="org.springframework.ws.server.endpoint.interceptor.PayloadLoggingInterceptor"/&gt;
  &lt;/sws:interceptors&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of these interceptors have two properties: &#8216;logRequest&#8217; and &#8216;logResponse&#8217;, which can be set to <code>false</code> to disable logging for either request or response messages.</p>
</div>
<div class="paragraph">
<p>Of course, you could use the <code>WsConfigurerAdapter</code> approach, as described above, for the <code>PayloadLoggingInterceptor</code> as well.</p>
</div>
</div>
<div class="sect4">
<h5 id="_code_payloadvalidatinginterceptor_code"><a class="anchor" href="#_code_payloadvalidatinginterceptor_code"></a><code>PayloadValidatingInterceptor</code></h5>
<div class="paragraph">
<p>One of the benefits of using a contract-first development style is that we can use the schema to validate incoming and outgoing XML messages. Spring-WS facilitates this with the <code>PayloadValidatingInterceptor</code>. This interceptor requires a reference to one or more W3C XML or RELAX NG schemas, and can be set to validate requests or responses, or both.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that request validation may sound like a good idea, but makes the resulting Web service very strict. Usually, it is not really important whether the request validates, only if the endpoint can get sufficient information to fullfill a request. Validating the response <strong>is</strong> a good idea, because the endpoint should adhere to its schema. Remember Postel&#8217;s Law:
"Be conservative in what you do; be liberal in what you accept from others."
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example that uses the <code>PayloadValidatingInterceptor</code>; in this example, we use the schema in <code>/WEB-INF/orders.xsd</code> to validate the response, but not the request. Note that the <code>PayloadValidatingInterceptor</code> can also accept multiple schemas using the <code>schemas</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="validatingInterceptor"
        class="org.springframework.ws.soap.server.endpoint.interceptor.PayloadValidatingInterceptor"&gt;
    &lt;property name="schema" value="/WEB-INF/orders.xsd"/&gt;
    &lt;property name="validateRequest" value="false"/&gt;
    &lt;property name="validateResponse" value="true"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you could use the <code>WsConfigurerAdapter</code> approach, as described above, for the <code>PayloadValidatingInterceptor</code> as well.</p>
</div>
</div>
<div class="sect4">
<h5 id="_code_payloadtransforminginterceptor_code"><a class="anchor" href="#_code_payloadtransforminginterceptor_code"></a><code>PayloadTransformingInterceptor</code></h5>
<div class="paragraph">
<p>To transform the payload to another XML format, Spring Web Services offers the <code>PayloadTransformingInterceptor</code>. This endpoint interceptor is based on XSLT style sheets, and is especially useful when supporting multiple versions of a Web service: you can transform the older message format to the newer format. Here is an example to use the <code>PayloadTransformingInterceptor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="transformingInterceptor"
        class="org.springframework.ws.server.endpoint.interceptor.PayloadTransformingInterceptor"&gt;
    &lt;property name="requestXslt" value="/WEB-INF/oldRequests.xslt"/&gt;
    &lt;property name="responseXslt" value="/WEB-INF/oldResponses.xslt"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are simply transforming requests using <code>/WEB-INF/oldRequests.xslt</code>, and response messages using <code>/WEB-INF/oldResponses.xslt</code>. Note that, since endpoint interceptors are registered at the endpoint mapping level, you can simply create a endpoint mapping that applies to the "old style" messages, and add the interceptor to that mapping. Hence, the transformation will apply only to these "old style" message.</p>
</div>
<div class="paragraph">
<p>Of course, you could use the <code>WsConfigurerAdapter</code> approach, as described above, for the <code>PayloadTransformingInterceptor</code> as well.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-endpoint-exception-resolver"><a class="anchor" href="#server-endpoint-exception-resolver"></a>5.6. Handling Exceptions</h3>
<div class="paragraph">
<p>Spring-WS provides <code>EndpointExceptionResolvers</code> to ease the pain of unexpected exceptions occurring while your message is being processed by an endpoint which matched the request. Endpoint exception resolvers somewhat resemble the exception mappings that can be defined in the web application descriptor <code>web.xml</code>. However, they provide a more flexible way to handle exceptions. They provide information about what endpoint was invoked when the exception was thrown. Furthermore, a programmatic way of handling exceptions gives you many more options for how to respond appropriately. Rather than expose the innards of your application by giving an exception and stack trace, you can handle the exception any way you want, for example by returning a SOAP fault with a specific fault code and string.</p>
</div>
<div class="paragraph">
<p>Endpoint exception resolvers are automatically picked up by the <code>MessageDispatcher</code>, so no explicit configuration is necessary.</p>
</div>
<div class="paragraph">
<p>Besides implementing the <code>EndpointExceptionResolver</code> interface, which is only a matter of implementing the <code>resolveException(MessageContext, endpoint, Exception)</code> method, you may also use one of the provided implementations. The simplest implementation is the <code>SimpleSoapExceptionResolver</code>, which just creates a SOAP 1.1 Server or SOAP 1.2 Receiver Fault, and uses the exception message as the fault string. The <code>SimpleSoapExceptionResolver</code> is the default, but it can be overriden by explicitly adding another resolver.</p>
</div>
<div class="sect3">
<h4 id="_code_soapfaultmappingexceptionresolver_code"><a class="anchor" href="#_code_soapfaultmappingexceptionresolver_code"></a>5.6.1. <code>SoapFaultMappingExceptionResolver</code></h4>
<div class="paragraph">
<p>The <code>SoapFaultMappingExceptionResolver</code> is a more sophisticated implementation. This resolver enables you to take the class name of any exception that might be thrown and map it to a SOAP Fault, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="exceptionResolver"
        class="org.springframework.ws.soap.server.endpoint.SoapFaultMappingExceptionResolver"&gt;
        &lt;property name="defaultFault" value="SERVER"/&gt;
        &lt;property name="exceptionMappings"&gt;
            &lt;value&gt;
                org.springframework.oxm.ValidationFailureException=CLIENT,Invalid request
            &lt;/value&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key values and default endpoint use the format <code>faultCode,faultString,locale</code>, where only the fault code is required. If the fault string is not set, it will default to the exception message. If the language is not set, it will default to English. The above configuration will map exceptions of type <code>ValidationFailureException</code> to a client-side SOAP Fault with a fault string <code>"Invalid request"</code>, as can be seen in the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;SOAP-ENV:Body&gt;
       <strong>&lt;SOAP-ENV:Fault&gt;
           &lt;faultcode&gt;SOAP-ENV:Client&lt;/faultcode&gt;
           &lt;faultstring&gt;Invalid request&lt;/faultstring&gt;
       &lt;/SOAP-ENV:Fault&gt;</strong>
    &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If any other exception occurs, it will return the default fault: a server-side fault with the exception message as fault string.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_soapfaultannotationexceptionresolver_code"><a class="anchor" href="#_code_soapfaultannotationexceptionresolver_code"></a>5.6.2. <code>SoapFaultAnnotationExceptionResolver</code></h4>
<div class="paragraph">
<p>Finally, it is also possible to annotate exception classes with the <code>@SoapFault</code> annotation, to indicate the SOAP Fault that should be returned whenever that exception is thrown. In order for these annotations to be picked up, you need to add the <code>SoapFaultAnnotationExceptionResolver</code> to your application context.  The elements of the annotation include a fault code enumeration, fault string or reason, and language. Here is an example exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package samples;

import org.springframework.ws.soap.server.endpoint.annotation.FaultCode;
import org.springframework.ws.soap.server.endpoint.annotation.SoapFault;

@SoapFault(faultCode = FaultCode.SERVER)
public class MyBusinessException extends Exception {

    public MyClientException(String message) {
        super(message);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever the <code>MyBusinessException</code> is thrown with the constructor string <code>"Oops!"</code> during endpoint invocation, it will result in the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;SOAP-ENV:Body&gt;
       &lt;SOAP-ENV:Fault&gt;
           &lt;faultcode&gt;SOAP-ENV:Server&lt;/faultcode&gt;
           &lt;faultstring&gt;Oops!&lt;/faultstring&gt;
       &lt;/SOAP-ENV:Fault&gt;
    &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_side_testing"><a class="anchor" href="#_server_side_testing"></a>5.7. Server-side testing</h3>
<div class="paragraph">
<p>When it comes to testing your Web service endpoints, there are two possible approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write <strong>Unit Tests</strong>, where you provide (mock) arguments for your endpoint to consume.</p>
<div class="paragraph">
<p>The advantage of this approach is that it&#8217;s quite easy to accomplish (especially for classes annotated with <code>@Endpoint</code>); the disadvantage is that you are not really testing the exact content of the XML messages that are sent over the wire.</p>
</div>
</li>
<li>
<p>Write <strong>Integrations Tests</strong>, which do test the contents of the message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first approach can easily be accomplished with mocking frameworks such as EasyMock, JMock, etc. The next section will focus on writing integration tests, using the test features introduced in Spring Web Services 2.0.</p>
</div>
<div class="sect3">
<h4 id="_writing_server_side_integration_tests"><a class="anchor" href="#_writing_server_side_integration_tests"></a>5.7.1. Writing server-side integration tests</h4>
<div class="paragraph">
<p>Spring Web Services 2.0 introduced support for creating endpoint integration tests. In this context, an endpoint is class handles (SOAP) messages (see <a href="#server-endpoints">Endpoints</a>).</p>
</div>
<div class="paragraph">
<p>The integration test support lives in the <code>org.springframework.ws.test.server</code> package. The core class in that package is the <code>MockWebServiceClient</code>. The underlying idea is that this client creates a request message, and then sends it over to the endpoint(s) that are configured in a standard <code>MessageDispatcherServlet</code> application context (see <a href="#message-dispatcher-servlet"><code>MessageDispatcherServlet</code></a>). These endpoints will handle the message, and create a response. The client then receives this response, and verifies it against registered expectations.</p>
</div>
<div class="paragraph">
<p>The typical usage of the <code>MockWebServiceClient</code> is: .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>MockWebServiceClient</code> instance by calling <code>MockWebServiceClient.createClient(ApplicationContext)</code> or <code>MockWebServiceClient.createClient(WebServiceMessageReceiver, WebServiceMessageFactory)</code>.</p>
</li>
<li>
<p>Send request messages by calling <code>sendRequest(RequestCreator)</code>, possibly by using the default <code>RequestCreator</code> implementations provided in <code>RequestCreators</code> (which can be statically imported).</p>
</li>
<li>
<p>Set up response expectations by calling <code>andExpect(ResponseMatcher)</code>, possibly by using the default <code>ResponseMatcher</code> implementations provided in <code>ResponseMatchers</code> (which can be statically imported). Multiple expectations can be set up by chaining <code>andExpect(ResponseMatcher)</code> calls.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the <code>MockWebServiceClient</code> (and related classes) offers a 'fluent' API, so you can typically use the Code Completion features (i.e. ctrl-space) in your IDE to guide you through the process of setting up the mock server.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Also note that you rely on the standard logging features available in Spring Web Services in your unit tests. Sometimes it might be useful to inspect the request or response message to find out why a particular tests failed. See <a href="#logging">Message Logging and Tracing</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Consider, for example, this simple Web service endpoint class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.RequestPayload;
import org.springframework.ws.server.endpoint.annotation.ResponsePayload;

@Endpoint                                                                <i class="conum" data-value="1"></i><b>(1)</b>
public class CustomerEndpoint {

  @ResponsePayload                                                       <i class="conum" data-value="2"></i><b>(2)</b>
  public CustomerCountResponse getCustomerCount(                         <i class="conum" data-value="2"></i><b>(2)</b>
      @RequestPayload CustomerCountRequest request) {                    <i class="conum" data-value="2"></i><b>(2)</b>
    CustomerCountResponse response = new CustomerCountResponse();
    response.setCustomerCount(10);
    return response;
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>CustomerEndpoint</code> in annotated with <code>@Endpoint</code>. See <a href="#server-endpoints">Endpoints</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>getCustomerCount()</code> method takes a <code>CustomerCountRequest</code> as argument, and returns a <code>CustomerCountResponse</code>. Both of these classes are objects supported by a marshaller. For instance, they can have a <code>@XmlRootElement</code> annotation to be supported by JAXB2.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A typical test for <code>CustomerEndpoint</code> would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import javax.xml.transform.Source;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.xml.transform.StringSource;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;

import org.springframework.ws.test.server.MockWebServiceClient;                       <i class="conum" data-value="1"></i><b>(1)</b>
import static org.springframework.ws.test.server.RequestCreators.*;                   <i class="conum" data-value="1"></i><b>(1)</b>
import static org.springframework.ws.test.server.ResponseMatchers.*;                  <i class="conum" data-value="1"></i><b>(1)</b>

@RunWith(SpringJUnit4ClassRunner.class)                                               <i class="conum" data-value="2"></i><b>(2)</b>
@ContextConfiguration("spring-ws-servlet.xml")                                        <i class="conum" data-value="2"></i><b>(2)</b>
public class CustomerEndpointIntegrationTest {

  @Autowired
  private ApplicationContext applicationContext;                                      <i class="conum" data-value="3"></i><b>(3)</b>

  private MockWebServiceClient mockClient;

  @Before
  public void createClient() {
    mockClient = MockWebServiceClient.createClient(applicationContext);               <i class="conum" data-value="4"></i><b>(4)</b>
  }

  @Test
  public void customerEndpoint() throws Exception {
    Source requestPayload = new StringSource(
      "&lt;customerCountRequest xmlns='http://springframework.org/spring-ws'&gt;" +
        "&lt;customerName&gt;John Doe&lt;/customerName&gt;" +
      "&lt;/customerCountRequest&gt;");
    Source responsePayload = new StringSource(
      "&lt;customerCountResponse xmlns='http://springframework.org/spring-ws'&gt;" +
        "&lt;customerCount&gt;10&lt;/customerCount&gt;" +
      "&lt;/customerCountResponse&gt;");

    mockClient.sendRequest(withPayload(requestPayload)).                              <i class="conum" data-value="5"></i><b>(5)</b>
      andExpect(payload(responsePayload));                                            <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>CustomerEndpointIntegrationTest</code> imports the <code>MockWebServiceClient</code>, and statically imports <code>RequestCreators</code> and <code>ResponseMatchers</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This test uses the standard testing facilities provided in the Spring Framework. This is not required, but is generally the easiest way to set up the test.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The application context is a standard Spring-WS application context (see <a href="#message-dispatcher-servlet"><code>MessageDispatcherServlet</code></a>), read from <code>spring-ws-servlet.xml</code>. In this case, the application context will contain a bean definition for <code>CustomerEndpoint</code> (or a perhaps a <code>&lt;context:component-scan /&gt;</code> is used).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In a <code>@Before</code> method, we create a <code>MockWebServiceClient</code> by using the <code>createClient</code> factory method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We send a request by calling <code>sendRequest()</code> with a <code>withPayload()</code> <code>RequestCreator</code> provided by the statically imported <code>RequestCreators</code> (see <a href="#server-test-request-creator"><code>RequestCreator</code> and <code>RequestCreators</code></a>).
<div class="paragraph">
<p>We also set up response expectations by calling <code>andExpect()</code> with a <code>payload()</code> <code>ResponseMatcher</code> provided by the statically imported <code>ResponseMatchers</code> (see <a href="#server-test-response-matcher"><code>ResponseMatcher</code> and <code>ResponseMatchers</code></a>).</p>
</div>
<div class="paragraph">
<p>This part of the test might look a bit confusing, but the Code Completion features of your IDE are of great help. After typing <code>sendRequest(</code>, simply type ctrl-space, and your IDE will provide you with a list of possible request creating strategies, provided you statically imported <code>RequestCreators</code>. The same applies to <code>andExpect(</code>, provided you statically imported <code>ResponseMatchers</code>.</p>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="server-test-request-creator"><a class="anchor" href="#server-test-request-creator"></a>5.7.2. <code>RequestCreator</code> and <code>RequestCreators</code></h4>
<div class="paragraph">
<p>Initially, the <code>MockWebServiceClient</code> will need to create a request message for the endpoint to consume. The client uses the <code>RequestCreator</code> strategy interface for this purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface RequestCreator {

  WebServiceMessage createRequest(WebServiceMessageFactory messageFactory)
    throws IOException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write your own implementations of this interface, creating a request message by using the message factory, but you certainly do not have to. The <code>RequestCreators</code> class provides a way to create a <code>RequestCreator</code> based on a given payload in the <code>withPayload()</code> method. You will typically statically import <code>RequestCreators</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="server-test-response-matcher"><a class="anchor" href="#server-test-response-matcher"></a>5.7.3. <code>ResponseMatcher</code> and <code>ResponseMatchers</code></h4>
<div class="paragraph">
<p>When the request message has been processed by the endpoint, and a response has been received, the <code>MockWebServiceClient</code> can verify whether this response message meets certain expectations. The client uses the <code>ResponseMatcher</code> strategy interface for this purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface ResponseMatcher {

    void match(WebServiceMessage request,
               WebServiceMessage response)
      throws IOException, AssertionError;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again you can write your own implementations of this interface, throwing <code>AssertionError`s when the message does not meet your expectations, but you certainly do not have to, as the `ResponseMatchers</code> class provides standard <code>ResponseMatcher</code> implementations for you to use in your tests. You will typically statically import this class.</p>
</div>
<div class="paragraph">
<p>The <code>ResponseMatchers</code> class provides the following response matchers:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>ResponseMatchers</code> method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a given response payload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validPayload()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects the response payload to validate against given XSD schema(s).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xpath()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a given XPath expression to exist, not exist, or evaluate to a given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>soapHeader()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a given SOAP header to exist in the response message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>noFault()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects that the response message does not contain a SOAP Fault.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mustUnderstandFault()</code>, <code>clientOrSenderFault()</code>, <code>serverOrReceiverFault()</code>, and <code>versionMismatchFault()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects the response message to contain a specific SOAP Fault.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can set up multiple response expectations by chaining <code>andExpect()</code> calls, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">mockClient.sendRequest(...).
 andExpect(payload(expectedResponsePayload)).
 andExpect(validPayload(schemaResource));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the response matchers provided by <code>ResponseMatchers</code>, refer to the class level Javadoc.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client"><a class="anchor" href="#client"></a>6. Using Spring Web Services on the Client</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>Spring-WS provides a client-side Web service API that allows for consistent, XML-driven access to Web services. It also caters for the use of marshallers and unmarshallers so that your service tier code can deal exclusively with Java objects.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.ws.client.core</code> package provides the core functionality for using the client-side access API. It contains template classes that simplify the use of Web services, much like the core Spring <code>JdbcTemplate</code> does for JDBC. The design principle common to Spring template classes is to provide helper methods to perform common operations, and for more sophisticated usage, delegate to user implemented callback interfaces. The Web service template follows the same design. The classes offer various convenience methods for the sending and receiving of XML messages, marshalling objects to XML before sending, and allows for multiple transport options.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_client_side_api"><a class="anchor" href="#_using_the_client_side_api"></a>6.2. Using the client-side API</h3>
<div class="sect3">
<h4 id="client-web-service-template"><a class="anchor" href="#client-web-service-template"></a>6.2.1. <code>WebServiceTemplate</code></h4>
<div class="paragraph">
<p>The <code>WebServiceTemplate</code> is the core class for client-side Web service access in Spring-WS. It contains methods for sending <code>Source</code> objects, and receiving response messages as either <code>Source</code> or <code>Result</code>. Additionally, it can marshal objects to XML before sending them across a transport, and unmarshal any response XML into an object again.</p>
</div>
<div class="sect4">
<h5 id="client-transports"><a class="anchor" href="#client-transports"></a>URIs and Transports</h5>
<div class="paragraph">
<p>The <code>WebServiceTemplate</code> class uses an URI as the message destination. You can either set a <code>defaultUri</code> property on the template itself, or supply an URI explicitly when calling a method on the template. The URI will be resolved into a <code>WebServiceMessageSender</code>, which is responsible for sending the XML message across a transport layer. You can set one or more message senders using the <code>messageSender</code> or <code>messageSenders</code> properties of the <code>WebServiceTemplate</code> class.</p>
</div>
<div class="sect5">
<h6 id="_http_transports"><a class="anchor" href="#_http_transports"></a>HTTP transports</h6>
<div class="paragraph">
<p>There are two implementations of the <code>WebServiceMessageSender</code> interface for sending messages via HTTP. The default implementation is the <code>HttpUrlConnectionMessageSender</code>, which uses the facilities provided by Java itself. The alternative is the <code>HttpComponentsMessageSender</code>, which uses the <a href="https://hc.apache.org/httpcomponents-client-ga">Apache HttpComponents HttpClient</a>. Use the latter if you need more advanced and easy-to-use functionality (such as authentication, HTTP connection pooling, and so forth).</p>
</div>
<div class="paragraph">
<p>To use the HTTP transport, either set the <code>defaultUri</code> to something like <code><a href="http://example.com/services" class="bare">http://example.com/services</a></code>, or supply the <strong>uri</strong> parameter for one of the methods.</p>
</div>
<div class="paragraph">
<p>The following example shows how the default configuration can be used for HTTP transports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate"&gt;
        &lt;constructor-arg ref="messageFactory"/&gt;
        &lt;property name="defaultUri" value="http://example.com/WebService"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how override the default configuration, and to use Apache HttpClient to authenticate using HTTP authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate"&gt;
    &lt;constructor-arg ref="messageFactory"/&gt;
    &lt;property name="messageSender"&gt;
        &lt;bean class="org.springframework.ws.transport.http.HttpComponentsMessageSender"&gt;
            &lt;property name="credentials"&gt;
                &lt;bean class="org.apache.http.auth.UsernamePasswordCredentials"&gt;
                    &lt;constructor-arg value="john:secret"/&gt;
                &lt;/bean&gt;
            &lt;/property&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="defaultUri" value="http://example.com/WebService"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jms_transport_2"><a class="anchor" href="#_jms_transport_2"></a>JMS transport</h6>
<div class="paragraph">
<p>For sending messages over JMS, Spring Web Services provides the <code>JmsMessageSender</code>. This class uses the facilities of the Spring framework to transform the <code>WebServiceMessage</code> into a JMS <code>Message</code>, send it on its way on a <code>Queue</code> or <code>Topic</code>, and receive a response (if any).</p>
</div>
<div class="paragraph">
<p>To use the <code>JmsMessageSender</code>, you need to set the <code>defaultUri</code> or <strong>uri</strong> parameter to a JMS URI, which - at a minimum - consists of the <code>jms:</code> prefix and a destination name. Some examples of JMS URIs are: <code>jms:SomeQueue</code>, <code>jms:SomeTopic?priority=3&amp;deliveryMode=NON_PERSISTENT</code>, and <code>jms:RequestQueue?replyToName=ResponseName</code>. For more information on this URI syntax, refer to the class level Javadoc of the <code>JmsMessageSender</code>.</p>
</div>
<div class="paragraph">
<p>By default, the <code>JmsMessageSender</code> send JMS <code>BytesMessage</code>, but this can be overriden to use <code>TextMessages</code> by using the <code>messageType</code> parameter on the JMS URI. For example: <code>jms:Queue?messageType=TEXT_MESSAGE</code>. Note that <code>BytesMessages</code> are the preferred type, because <code>TextMessages</code> do not support attachments and character encodings reliably.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the JMS transport in combination with an ActiveMQ connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
        &lt;property name="brokerURL" value="vm://localhost?broker.persistent=false"/&gt;
    &lt;/bean&gt;

    &lt;bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate"&gt;
        &lt;constructor-arg ref="messageFactory"/&gt;
        &lt;property name="messageSender"&gt;
            &lt;bean class="org.springframework.ws.transport.jms.JmsMessageSender"&gt;
                &lt;property name="connectionFactory" ref="connectionFactory"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="defaultUri" value="jms:RequestQueue?deliveryMode=NON_PERSISTENT"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_email_transport_2"><a class="anchor" href="#_email_transport_2"></a>Email transport</h6>
<div class="paragraph">
<p>Spring Web Services also provides an email transport, which can be used to send web service messages via SMTP, and retrieve them via either POP3 or IMAP. The client-side email functionality is contained in the <code>MailMessageSender</code> class. This class creates an email message from the request <code>WebServiceMessage</code>, and sends it via SMTP. It then waits for a response message to arrive in the incoming POP3 or IMAP server.</p>
</div>
<div class="paragraph">
<p>To use the <code>MailMessageSender</code>, set the <code>defaultUri</code> or <strong>uri</strong> parameter to a <code>mailto</code> URI. Here are some URI examples: <code>mailto:john@example.com</code>, and <code>mailto:server@localhost?subject=SOAP%20Test</code>. Make sure that the message sender is properly configured with a <code>transportUri</code>, which indicates the server to use for sending requests (typically a SMTP server), and a <code>storeUri</code>, which indicates the server to poll for responses (typically a POP3 or IMAP server).</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the email transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate"&gt;
        &lt;constructor-arg ref="messageFactory"/&gt;
        &lt;property name="messageSender"&gt;
            &lt;bean class="org.springframework.ws.transport.mail.MailMessageSender"&gt;
                &lt;property name="from" value="Spring-WS SOAP Client &amp;lt;client@example.com&amp;gt;"/&gt;
                &lt;property name="transportUri" value="smtp://client:s04p@smtp.example.com"/&gt;
                &lt;property name="storeUri" value="imap://client:s04p@imap.example.com/INBOX"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="defaultUri" value="mailto:server@example.com?subject=SOAP%20Test"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_xmpp_transport_2"><a class="anchor" href="#_xmpp_transport_2"></a>XMPP transport</h6>
<div class="paragraph">
<p>Spring Web Services 2.0 introduced an XMPP (Jabber) transport, which can be used to send and receive web service messages via XMPP. The client-side XMPP functionality is contained in the <code>XmppMessageSender</code> class. This class creates an XMPP message from the request <code>WebServiceMessage</code>, and sends it via XMPP. It then listens for a response message to arrive.</p>
</div>
<div class="paragraph">
<p>To use the <code>XmppMessageSender</code>, set the <code>defaultUri</code> or <strong>uri</strong> parameter to a <code>xmpp</code> URI, for example <code>xmpp:johndoe@jabber.org</code>. The sender also requires an <code>XMPPConnection</code> to work, which can be conveniently created using the <code>org.springframework.ws.transport.xmpp.support.XmppConnectionFactoryBean</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the xmpp transport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;

    &lt;bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory"/&gt;

    &lt;bean id="connection" class="org.springframework.ws.transport.xmpp.support.XmppConnectionFactoryBean"&gt;
        &lt;property name="host" value="jabber.org"/&gt;
        &lt;property name="username" value="username"/&gt;
        &lt;property name="password" value="password"/&gt;
    &lt;/bean&gt;

    &lt;bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate"&gt;
        &lt;constructor-arg ref="messageFactory"/&gt;
        &lt;property name="messageSender"&gt;
            &lt;bean class="org.springframework.ws.transport.xmpp.XmppMessageSender"&gt;
                &lt;property name="connection" ref="connection"/&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name="defaultUri" value="xmpp:user@jabber.org"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_message_factories"><a class="anchor" href="#_message_factories"></a>Message factories</h5>
<div class="paragraph">
<p>In addition to a message sender, the <code>WebServiceTemplate</code> requires a Web service message factory. There are two message factories for SOAP: <code>SaajSoapMessageFactory</code> and <code>AxiomSoapMessageFactory</code>. If no message factory is specified (via the <code>messageFactory</code> property), Spring-WS will use the <code>SaajSoapMessageFactory</code> by default.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sending_and_receiving_a_code_webservicemessage_code"><a class="anchor" href="#_sending_and_receiving_a_code_webservicemessage_code"></a>6.2.2. Sending and receiving a <code>WebServiceMessage</code></h4>
<div class="paragraph">
<p>The <code>WebServiceTemplate</code> contains many convenience methods to send and receive web service messages. There are methods that accept and return a <code>Source</code> and those that return a <code>Result</code>. Additionally, there are methods which marshal and unmarshal objects to XML. Here is an example that sends a simple XML message to a Web service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">import java.io.StringReader;
import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;

import org.springframework.ws.WebServiceMessageFactory;
import org.springframework.ws.client.core.WebServiceTemplate;
import org.springframework.ws.transport.WebServiceMessageSender;

public class WebServiceClient {

    private static final String MESSAGE =
        "&lt;message xmlns=\"http://tempuri.org\"&gt;Hello Web Service World&lt;/message&gt;";

    private final WebServiceTemplate webServiceTemplate = new WebServiceTemplate();

    public void setDefaultUri(String defaultUri) {
        webServiceTemplate.setDefaultUri(defaultUri);
    }

    <em>// send to the configured default URI</em>
    public void simpleSendAndReceive() {
        StreamSource source = new StreamSource(new StringReader(MESSAGE));
        StreamResult result = new StreamResult(System.out);
        webServiceTemplate.sendSourceAndReceiveToResult(source, result);
    }

    <em>// send to an explicit URI</em>
    public void customSendAndReceive() {
        StreamSource source = new StreamSource(new StringReader(MESSAGE));
        StreamResult result = new StreamResult(System.out);
        webServiceTemplate.sendSourceAndReceiveToResult("http://localhost:8080/AnotherWebService",
            source, result);
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"&gt;

    &lt;bean id="webServiceClient" class="WebServiceClient"&gt;
        &lt;property name="defaultUri" value="http://localhost:8080/WebService"/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses the <code>WebServiceTemplate</code> to send a hello world message to the web service located at <code><a href="http://localhost:8080/WebService" class="bare">http://localhost:8080/WebService</a></code> (in the case of the <code>simpleSendAndReceive()</code> method), and writes the result to the console. The <code>WebServiceTemplate</code> is injected with the default URI, which is used because no URI was supplied explicitly in the Java code.</p>
</div>
<div class="paragraph">
<p>Please note that the <code>WebServiceTemplate</code> class is thread-safe once configured (assuming that all of it&#8217;s dependencies are thread-safe too, which is the case for all of the dependencies that ship with Spring-WS), and so multiple objects can use the same shared <code>WebServiceTemplate</code> instance if so desired. The <code>WebServiceTemplate</code> exposes a zero argument constructor and <code>messageFactory</code>/<code>messageSender</code> bean properties which can be used for constructing the instance (using a Spring container or plain Java code). Alternatively, consider deriving from Spring-WS&#8217;s <code>WebServiceGatewaySupport</code> convenience base class, which exposes convenient bean properties to enable easy configuration. (You do <strong>not</strong> have to extend this base class&#8230;&#8203; it is provided as a convenience class only.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_sending_and_receiving_pojos_marshalling_and_unmarshalling"><a class="anchor" href="#_sending_and_receiving_pojos_marshalling_and_unmarshalling"></a>6.2.3. Sending and receiving POJOs - marshalling and unmarshalling</h4>
<div class="paragraph">
<p>In order to facilitate the sending of plain Java objects, the <code>WebServiceTemplate</code> has a number of <code>send(..)</code> methods that take an <code>Object</code> as an argument for a message&#8217;s data content. The method <code>marshalSendAndReceive(..)</code> in the <code>WebServiceTemplate</code> class delegates the conversion of the request object to XML to a <code>Marshaller</code>, and the conversion of the response XML to an object to an <code>Unmarshaller</code>. (For more information about marshalling and unmarshaller, refer to <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/oxm.html">the Spring documentation</a>.) By using the marshallers, your application code can focus on the business object that is being sent or received and not be concerned with the details of how it is represented as XML. In order to use the marshalling functionality, you have to set a marshaller and unmarshaller with the <code>marshaller</code>/<code>unmarshaller</code> properties of the <code>WebServiceTemplate</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_webservicemessagecallback_code"><a class="anchor" href="#_code_webservicemessagecallback_code"></a>6.2.4. <code>WebServiceMessageCallback</code></h4>
<div class="paragraph">
<p>To accommodate the setting of SOAP headers and other settings on the message, the <code>WebServiceMessageCallback</code> interface gives you access to the message <strong>after</strong> it has been created, but <strong>before</strong> it is sent. The example below demonstrates how to set the SOAP Action header on a message that is created by marshalling an object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void marshalWithSoapActionHeader(MyObject o) {

    webServiceTemplate.marshalSendAndReceive(o, new WebServiceMessageCallback() {

        public void doWithMessage(WebServiceMessage message) {
            ((SoapMessage)message).setSoapAction("http://tempuri.org/Action");
        }
    });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that you can also use the <code>org.springframework.ws.soap.client.core.SoapActionCallback</code> to set the SOAP Action header.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_ws_addressing"><a class="anchor" href="#_ws_addressing"></a>WS-Addressing</h5>
<div class="paragraph">
<p>In addition to the <a href="#server-ws-addressing">server-side WS-Addressing</a> support, Spring Web Services also has support for this specification on the client-side.</p>
</div>
<div class="paragraph">
<p>For setting WS-Addressing headers on the client, you can use the <code>org.springframework.ws.soap.addressing.client.ActionCallback</code>. This callback takes the desired Action header as a parameter. It also has constructors for specifying the WS-Addressing version, and a <code>To</code> header. If not specified, the <code>To</code> header will default to the URL of the connection being made.</p>
</div>
<div class="paragraph">
<p>Here is an example of setting the <code>Action</code> header to <code><a href="http://samples/RequestOrder" class="bare">http://samples/RequestOrder</a></code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">webServiceTemplate.marshalSendAndReceive(o, new ActionCallback("http://samples/RequestOrder"));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_webservicemessageextractor_code"><a class="anchor" href="#_code_webservicemessageextractor_code"></a>6.2.5. <code>WebServiceMessageExtractor</code></h4>
<div class="paragraph">
<p>The <code>WebServiceMessageExtractor</code> interface is a low-level callback interface that allows you to have full control over the process to extract an <code>Object</code> from a received <code>WebServiceMessage</code>. The <code>WebServiceTemplate</code> will invoke the <code>extractData(..)</code> method on a supplied <code>WebServiceMessageExtractor</code> <strong>while the underlying connection to the serving resource is still open</strong>. The following example illustrates the <code>WebServiceMessageExtractor</code> in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void marshalWithSoapActionHeader(final Source s) {
    final Transformer transformer = transformerFactory.newTransformer();
    webServiceTemplate.sendAndReceive(new WebServiceMessageCallback() {
        public void doWithMessage(WebServiceMessage message) {
            transformer.transform(s, message.getPayloadResult());
        },
        new WebServiceMessageExtractor() {
            public Object extractData(WebServiceMessage message) throws IOException
                <em>// do your own transforms with message.getPayloadResult()
                //     or message.getPayloadSource()</em>
            }
        });
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_client_side_testing"><a class="anchor" href="#_client_side_testing"></a>6.3. Client-side testing</h3>
<div class="paragraph">
<p>When it comes to testing your Web service clients (i.e. classes that uses the <code>WebServiceTemplate</code> to access a Web service), there are two possible approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write <strong>Unit Tests</strong>, which simply mock away the <code>WebServiceTemplate</code> class, <code>WebServiceOperations</code> interface, or the complete client class.</p>
<div class="paragraph">
<p>The advantage of this approach is that it&#8217;s quite easy to accomplish; the disadvantage is that you are not really testing the exact content of the XML messages that are sent over the wire, especially when mocking out the entire client class.</p>
</div>
</li>
<li>
<p>Write <strong>Integrations Tests</strong>, which do test the contents of the message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first approach can easily be accomplished with mocking frameworks such as EasyMock, JMock, etc. The next section will focus on writing integration tests, using the test features introduced in Spring Web Services 2.0.</p>
</div>
<div class="sect3">
<h4 id="_writing_client_side_integration_tests"><a class="anchor" href="#_writing_client_side_integration_tests"></a>6.3.1. Writing client-side integration tests</h4>
<div class="paragraph">
<p>Spring Web Services 2.0 introduced support for creating Web service client integration tests. In this context, a client is a class that uses the <code>WebServiceTemplate</code> to access a Web service.</p>
</div>
<div class="paragraph">
<p>The integration test support lives in the <code>org.springframework.ws.test.client</code> package. The core class in that package is the <code>MockWebServiceServer</code>. The underlying idea is that the web service template connects to this mock server, sends it request message, which the mock server then verifies against the registered expectations. If the expectations are met, the mock server then prepares a response message, which is send back to the template.</p>
</div>
<div class="paragraph">
<p>The typical usage of the <code>MockWebServiceServer</code> is: .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>MockWebServiceServer</code> instance by calling <code>MockWebServiceServer.createServer(WebServiceTemplate)</code>, <code>MockWebServiceServer.createServer(WebServiceGatewaySupport)</code>, or <code>MockWebServiceServer.createServer(ApplicationContext)</code>.</p>
</li>
<li>
<p>Set up request expectations by calling <code>expect(RequestMatcher)</code>, possibly by using the default <code>RequestMatcher</code> implementations provided in <code>RequestMatchers</code> (which can be statically imported). Multiple expectations can be set up by chaining <code>andExpect(RequestMatcher)</code> calls.</p>
</li>
<li>
<p>Create an appropriate response message by calling <code>andRespond(ResponseCreator)</code>, possibly by using the default <code>ResponseCreator</code> implementations provided in <code>ResponseCreators</code> (which can be statically imported).</p>
</li>
<li>
<p>Use the <code>WebServiceTemplate</code> as normal, either directly of through client code.</p>
</li>
<li>
<p>Call <code>MockWebServiceServer.verify()</code> to make sure that all expectations have been met.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the <code>MockWebServiceServer</code> (and related classes) offers a 'fluent' API, so you can typically use the Code Completion features (i.e. ctrl-space) in your IDE to guide you through the process of setting up the mock server.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Also note that you rely on the standard logging features available in Spring Web Services in your unit tests. Sometimes it might be useful to inspect the request or response message to find out why a particular tests failed. See <a href="#logging">Message Logging and Tracing</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Consider, for example, this Web service client class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.springframework.ws.client.core.support.WebServiceGatewaySupport;

public class CustomerClient extends WebServiceGatewaySupport {                          <i class="conum" data-value="1"></i><b>(1)</b>

  public int getCustomerCount() {
    CustomerCountRequest request = new CustomerCountRequest();                          <i class="conum" data-value="2"></i><b>(2)</b>
    request.setCustomerName("John Doe");

    CustomerCountResponse response =
      (CustomerCountResponse) getWebServiceTemplate().marshalSendAndReceive(request);   <i class="conum" data-value="3"></i><b>(3)</b>

    return response.getCustomerCount();
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>CustomerClient</code> extends <code>WebServiceGatewaySupport</code>, which provides it with a webServiceTemplate property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>CustomerCountRequest</code> is an object supported by a marshaller. For instance, it can have a <code>@XmlRootElement</code> annotation to be supported by JAXB2.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>CustomerClient</code> uses the <code>WebServiceTemplate</code> offered by <code>WebServiceGatewaySupport</code> to marshal the request object into a SOAP message, and sends that to the web service. The response object is unmarshalled into a <code>CustomerCountResponse</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A typical test for <code>CustomerClient</code> would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import javax.xml.transform.Source;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.xml.transform.StringSource;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;

import static org.junit.Assert.assertEquals;

import org.springframework.ws.test.client.MockWebServiceServer;                         <i class="conum" data-value="1"></i><b>(1)</b>
import static org.springframework.ws.test.client.RequestMatchers.*;                     <i class="conum" data-value="1"></i><b>(1)</b>
import static org.springframework.ws.test.client.ResponseCreators.*;                    <i class="conum" data-value="1"></i><b>(1)</b>

@RunWith(SpringJUnit4ClassRunner.class)                                                 <i class="conum" data-value="2"></i><b>(2)</b>
@ContextConfiguration("integration-test.xml")                                           <i class="conum" data-value="2"></i><b>(2)</b>
public class CustomerClientIntegrationTest {

  @Autowired
  private CustomerClient client;                                                        <i class="conum" data-value="3"></i><b>(3)</b>

  private MockWebServiceServer mockServer;                                              <i class="conum" data-value="4"></i><b>(4)</b>

  @Before
  public void createServer() throws Exception {
    mockServer = MockWebServiceServer.createServer(client);
  }

  @Test
  public void customerClient() throws Exception {
    Source requestPayload = new StringSource(
      "&lt;customerCountRequest xmlns='http://springframework.org/spring-ws'&gt;" +
        "&lt;customerName&gt;John Doe&lt;/customerName&gt;" +
      "&lt;/customerCountRequest&gt;");
    Source responsePayload = new StringSource(
      "&lt;customerCountResponse xmlns='http://springframework.org/spring-ws'&gt;" +
        "&lt;customerCount&gt;10&lt;/customerCount&gt;" +
      "&lt;/customerCountResponse&gt;");

    mockServer.expect(payload(requestPayload)).andRespond(withPayload(responsePayload));<i class="conum" data-value="5"></i><b>(5)</b>

    int result = client.getCustomerCount();                                             <i class="conum" data-value="6"></i><b>(6)</b>
    assertEquals(10, result);                                                           <i class="conum" data-value="6"></i><b>(6)</b>

    mockServer.verify();                                                                <i class="conum" data-value="7"></i><b>(7)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>CustomerClientIntegrationTest</code> imports the <code>MockWebServiceServer</code>, and statically imports <code>RequestMatchers</code> and <code>ResponseCreators</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This test uses the standard testing facilities provided in the Spring Framework. This is not required, but is generally the easiest way to set up the test.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>CustomerClient</code> is configured in <code>integration-test.xml</code>, and wired into this test using <code>@Autowired</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In a <code>@Before</code> method, we create a <code>MockWebServiceServer</code> by using the <code>createServer</code> factory method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We define expectations by calling <code>expect()</code> with a <code>payload()</code> <code>RequestMatcher</code> provided by the statically imported <code>RequestMatchers</code> (see <a href="#client-test-request-matcher"><code>RequestMatcher</code> and <code>RequestMatchers</code></a>).
<div class="paragraph">
<p>We also set up a response by calling <code>andRespond()</code> with a <code>withPayload()</code> <code>ResponseCreator</code> provided by the statically imported <code>ResponseCreators</code> (see <a href="#client-test-response-creator"><code>ResponseCreator</code> and <code>ResponseCreators</code></a>).</p>
</div>
<div class="paragraph">
<p>This part of the test might look a bit confusing, but the Code Completion features of your IDE are of great help. After typing <code>expect(</code>, simply type ctrl-space, and your IDE will provide you with a list of possible request matching strategies, provided you statically imported <code>RequestMatchers</code>. The same applies to <code>andRespond(</code>, provided you statically imported <code>ResponseCreators</code>.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We call <code>getCustomerCount()</code> on the <code>CustomerClient</code>, thus using the <code>WebServiceTemplate</code>. The template has been set up for 'testing mode' by now, so no real (HTTP) connection is made by this method call. We also make some JUnit assertions based on the result of the method call.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We call <code>verify()</code> on the <code>MockWebServiceServer</code>, thus verifying that the expected message was actually received.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="client-test-request-matcher"><a class="anchor" href="#client-test-request-matcher"></a>6.3.2. <code>RequestMatcher</code> and <code>RequestMatchers</code></h4>
<div class="paragraph">
<p>To verify whether the request message meets certain expectations, the <code>MockWebServiceServer</code> uses the <code>RequestMatcher</code> strategy interface. The contract defined by this interface is quite simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface RequestMatcher {

  void match(URI uri,
             WebServiceMessage request)
    throws IOException,
           AssertionError;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write your own implementations of this interface, throwing <code>AssertionError`s when the message does not meet your expectations, but you certainly do not have to. The `RequestMatchers</code> class provides standard <code>RequestMatcher</code> implementations for you to use in your tests. You will typically statically import this class.</p>
</div>
<div class="paragraph">
<p>The <code>RequestMatchers</code> class provides the following request matchers:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>RequestMatchers</code> method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>anything()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects any sort of request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a given request payload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validPayload()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects the request payload to validate against given XSD schema(s).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xpath()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a given XPath expression to exist, not exist, or evaluate to a given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>soapHeader()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a given SOAP header to exist in the request message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connectionTo()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expects a connection to the given URL.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can set up multiple request expectations by chaining <code>andExpect()</code> calls, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">mockServer.expect(connectionTo("http://example.com")).
 andExpect(payload(expectedRequestPayload)).
 andExpect(validPayload(schemaResource)).
 andRespond(...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the request matchers provided by <code>RequestMatchers</code>, refer to the class level Javadoc.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-test-response-creator"><a class="anchor" href="#client-test-response-creator"></a>6.3.3. <code>ResponseCreator</code> and <code>ResponseCreators</code></h4>
<div class="paragraph">
<p>When the request message has been verified and meets the defined expectations, the <code>MockWebServiceServer</code> will create a response message for the <code>WebServiceTemplate</code> to consume. The server uses the <code>ResponseCreator</code> strategy interface for this purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface ResponseCreator {

  WebServiceMessage createResponse(URI uri,
                                   WebServiceMessage request,
                                   WebServiceMessageFactory messageFactory)
    throws IOException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again you can write your own implementations of this interface, creating a response message by using the message factory, but you certainly do not have to, as the <code>ResponseCreators</code> class provides standard <code>ResponseCreator</code> implementations for you to use in your tests. You will typically statically import this class.</p>
</div>
<div class="paragraph">
<p>The <code>ResponseCreators</code> class provides the following responses:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>ResponseCreators</code> method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>withPayload()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a response message with a given payload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>withError()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates an error in the response connection. This method gives you the opportunity to test your error handling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>withException()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throws an exception when reading from the response connection. This method gives you the opportunity to test your exception handling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>withMustUnderstandFault()</code>, <code>withClientOrSenderFault()</code>, <code>withServerOrReceiverFault()</code>, and <code>withVersionMismatchFault()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a response message with a given SOAP fault. This method gives you the opportunity to test your Fault handling.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information on the request matchers provided by <code>RequestMatchers</code>, refer to the class level Javadoc.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security"><a class="anchor" href="#security"></a>7. Securing your Web services with Spring-WS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="security-introduction"><a class="anchor" href="#security-introduction"></a>7.1. Introduction</h3>
<div class="paragraph">
<p>This chapter explains how to add WS-Security aspects to your Web services. We will focus on the three different areas of WS-Security, namely:</p>
</div>
<div class="paragraph">
<p><strong>Authentication.</strong> This is the process of determining whether a <strong>principal</strong> is who they claim to be. In this context, a "principal" generally means a user, device or some other system which can perform an action in your application.</p>
</div>
<div class="paragraph">
<p><strong>Digital signatures.</strong> The digital signature of a message is a piece of information based on both the document and the signer&#8217;s private key. It is created through the use of a hash function and a private signing function (encrypting with the signer&#8217;s private key).</p>
</div>
<div class="paragraph">
<p><strong>Encryption and Decryption.</strong> <em>Encryption</em> is the process of transforming data into a form that is impossible to read without the appropriate key. It is mainly used to keep information hidden from anyone for whom it is not intended. <strong>Decryption</strong> is the reverse of encryption; it is the process of transforming of encrypted data back into an readable form.</p>
</div>
<div class="paragraph">
<p>All of these three areas are implemented using the <code>XwsSecurityInterceptor</code> or <code>Wss4jSecurityInterceptor</code>, which we will describe in <a href="#security-xws-security-interceptor"><code>XwsSecurityInterceptor</code></a> and <a href="#security-wss4j-security-interceptor"><code>Wss4jSecurityInterceptor</code></a>, respectively</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that WS-Security (especially encryption and signing) requires substantial amounts of memory, and will also decrease performance. If performance is important to you, you might want to consider not using WS-Security, or simply use HTTP-based security.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="security-xws-security-interceptor"><a class="anchor" href="#security-xws-security-interceptor"></a>7.2. <code>XwsSecurityInterceptor</code></h3>
<div class="paragraph">
<p>The <code>XwsSecurityInterceptor</code> is an <code>EndpointInterceptor</code> (see <a href="#server-endpoint-interceptor">Intercepting requests - the <code>EndpointInterceptor</code> interface</a>) that is based on SUN&#8217;s XML and Web Services Security package (XWSS). This WS-Security implementation is part of the Java Web Services Developer Pack (<a href="http://java.sun.com/webservices/"><em>Java WSDP</em></a>).</p>
</div>
<div class="paragraph">
<p>Like any other endpoint interceptor, it is defined in the endpoint mapping (see <a href="#server-endpoint-mapping">Endpoint mappings</a>). This means that you can be selective about adding WS-Security support: some endpoint mappings require it, while others do not.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that XWSS requires both a SUN 1.5 JDK and the SUN SAAJ reference implementation. The WSS4J interceptor does not have these requirements (see <a href="#security-wss4j-security-interceptor"><code>Wss4jSecurityInterceptor</code></a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>XwsSecurityInterceptor</code> requires a <strong>security policy file</strong> to operate. This XML file tells the interceptor what security aspects to require from incoming SOAP messages, and what aspects to add to outgoing messages. The basic format of the policy file will be explained in the following sections, but you can find a more in-depth tutorial <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp564887"><em>here</em></a>. You can set the policy with the <code>policyConfiguration</code> property, which requires a Spring resource. The policy file can contain multiple elements, e.g. require a username token on incoming messages, and sign all outgoing messages. It contains a <code>SecurityConfiguration</code> element as root (not a <code>JAXRPCSecurity</code> element).</p>
</div>
<div class="paragraph">
<p>Additionally, the security interceptor requires one or more`CallbackHandler`s to operate. These handlers are used to retrieve certificates, private keys, validate user credentials, etc. Spring-WS offers handlers for most common security concerns, e.g. authenticating against a Spring Security authentication manager, signing outgoing messages based on a X509 certificate. The following sections will indicate what callback handler to use for which security concern. You can set the callback handlers using the <code>callbackHandler</code> or <code>callbackHandlers</code> property.</p>
</div>
<div class="paragraph">
<p>Here is an example that shows how to wire the <code>XwsSecurityInterceptor</code> up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="wsSecurityInterceptor"
        class="org.springframework.ws.soap.security.xwss.XwsSecurityInterceptor"&gt;
        &lt;property name="policyConfiguration" value="classpath:securityPolicy.xml"/&gt;
        &lt;property name="callbackHandlers"&gt;
            &lt;list&gt;
                &lt;ref bean="certificateHandler"/&gt;
                &lt;ref bean="authenticationHandler"/&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    ...
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interceptor is configured using the <code>securityPolicy.xml</code> file on the classpath. It uses two callback handlers which are defined further on in the file.</p>
</div>
<div class="sect3">
<h4 id="keystore"><a class="anchor" href="#keystore"></a>7.2.1. Keystores</h4>
<div class="paragraph">
<p>For most cryptographic operations, you will use the standard <code>java.security.KeyStore</code> objects. These operations include certificate verification, message signing, signature verification, and encryption, but excludes username and time-stamp verification. This section aims to give you some background knowledge on keystores, and the Java tools that you can use to store keys and certificates in a keystore file. This information is mostly not related to Spring-WS, but to the general cryptographic features of Java.</p>
</div>
<div class="paragraph">
<p>The <code>java.security.KeyStore</code> class represents a storage facility for cryptographic keys and certificates. It can contain three different sort of elements:</p>
</div>
<div class="paragraph">
<p><strong>Private Keys.</strong> These keys are used for self-authentication. The private key is accompanied by certificate chain for the corresponding public key. Within the field of WS-Security, this accounts to message signing and message decryption.</p>
</div>
<div class="paragraph">
<p><strong>Symmetric Keys.</strong> Symmetric (or secret) keys are used for message encryption and decryption as well. The difference being that both sides (sender and recipient) share the same, secret key.</p>
</div>
<div class="paragraph">
<p><strong>Trusted certificates.</strong> These X509 certificates are called a <strong>trusted certificate</strong> because the keystore owner trusts that the public key in the certificates indeed belong to the owner of the certificate. Within WS-Security, these certificates are used for certificate validation, signature verification, and encryption.</p>
</div>
<div class="sect4">
<h5 id="_keytool"><a class="anchor" href="#_keytool"></a>KeyTool</h5>
<div class="paragraph">
<p>Supplied with your Java Virtual Machine is the <strong>keytool</strong> program, a key and certificate management utility. You can use this tool to create new keystores, add new private keys and certificates to them, etc. It is beyond the scope of this document to provide a full reference of the <strong>keytool</strong> command, but you can find a reference <a href="http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/keytool.html"><em>here</em></a> , or by giving the command <code>keytool -help</code> on the command line.</p>
</div>
</div>
<div class="sect4">
<h5 id="_keystorefactorybean"><a class="anchor" href="#_keystorefactorybean"></a>KeyStoreFactoryBean</h5>
<div class="paragraph">
<p>To easily load a keystore using Spring configuration, you can use the <code>KeyStoreFactoryBean</code>. It has a resource location property, which you can set to point to the path of the keystore to load. A password may be given to check the integrity of the keystore data. If a password is not given, integrity checking is not performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="keyStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
    &lt;property name="password" value="password"/&gt;
    &lt;property name="location" value="classpath:org/springframework/ws/soap/security/xwss/test-keystore.jks"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you don&#8217;t specify the location property, a new, empty keystore will be created, which is most likely not what you want.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="security-key-store-callback-handler"><a class="anchor" href="#security-key-store-callback-handler"></a>KeyStoreCallbackHandler</h5>
<div class="paragraph">
<p>To use the keystores within a <code>XwsSecurityInterceptor</code>, you will need to define a <code>KeyStoreCallbackHandler</code>. This callback has three properties with type keystore: (<code>keyStore</code>,<code>trustStore</code>, and <code>symmetricStore</code>). The exact stores used by the handler depend on the cryptographic operations that are to be performed by this handler. For private key operation, the <code>keyStore</code> is used, for symmetric key operations the <code>symmetricStore</code>, and for determining trust relationships, the <code>trustStore</code>. The following table indicates this:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cryptographic operation</th>
<th class="tableblock halign-left valign-top">Keystore used</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">first the <code>keyStore</code>, then the <code>trustStore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decryption based on private key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyStore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decryption based on symmetric key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>symmetricStore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption based on public key certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trustStore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption based on symmetric key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>symmetricStore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keyStore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature verification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trustStore</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additionally, the <code>KeyStoreCallbackHandler</code> has a <code>privateKeyPassword</code> property, which should be set to unlock the private key(s) contained in the`keyStore`.</p>
</div>
<div class="paragraph">
<p>If the <code>symmetricStore</code> is not set, it will default to the <code>keyStore</code>. If the key or trust store is not set, the callback handler will use the standard Java mechanism to load or create it. Refer to the JavaDoc of the <code>KeyStoreCallbackHandler</code> to know how this mechanism works.</p>
</div>
<div class="paragraph">
<p>For instance, if you want to use the <code>KeyStoreCallbackHandler</code> to validate incoming certificates or signatures, you would use a trust store, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="trustStore" ref="trustStore"/&gt;
    &lt;/bean&gt;

    &lt;bean id="trustStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:truststore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use it to decrypt incoming certificates or sign outgoing messages, you would use a key store, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="keyStore" ref="keyStore"/&gt;
        &lt;property name="privateKeyPassword" value="changeit"/&gt;
    &lt;/bean&gt;

    &lt;bean id="keyStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:keystore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sections will indicate where the <code>KeyStoreCallbackHandler</code> can be used, and which properties to set for particular cryptographic operations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentication"><a class="anchor" href="#_authentication"></a>7.2.2. Authentication</h4>
<div class="paragraph">
<p>As stated in the introduction, <strong>authentication</strong> is the task of determining whether a principal is who they claim to be. Within WS-Security, authentication can take two forms: using a username and password token (using either a plain text password or a password digest), or using a X509 certificate.</p>
</div>
<div class="sect4">
<h5 id="_plain_text_username_authentication"><a class="anchor" href="#_plain_text_username_authentication"></a>Plain Text Username Authentication</h5>
<div class="paragraph">
<p>The simplest form of username authentication uses*plain text passwords*. In this scenario, the SOAP message will contain a <code>UsernameToken</code> element, which itself contains a <code>Username</code> element and a <code>Password</code> element which contains the plain text password. Plain text authentication can be compared to the Basic Authentication provided by HTTP servers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Note that plain text passwords are not very secure. Therefore, you should always add additional security measures to your transport layer if you are using them (using HTTPS instead of plain HTTP, for instance).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To require that every incoming message contains a <code>UsernameToken</code> with a plain text password, the security policy file should contain a <code>RequireUsernameToken</code> element, with the <code>passwordDigestRequired</code> attribute set to`false`. You can find a reference of possible child elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp567459"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
    ...
    &lt;xwss:RequireUsernameToken passwordDigestRequired="false" nonceRequired="false"/&gt;
    ...
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the username token is not present, the <code>XwsSecurityInterceptor</code> will return a SOAP Fault to the sender. If it is present, it will fire a <code>PasswordValidationCallback</code> with a <code>PlainTextPasswordRequest</code> to the registered handlers. Within Spring-WS, there are three classes which handle this particular callback.</p>
</div>
<div class="sect5">
<h6 id="security-simple-password-validation-callback-handler"><a class="anchor" href="#security-simple-password-validation-callback-handler"></a>SimplePasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p>The simplest password validation handler is the <code>SimplePasswordValidationCallbackHandler</code>. This handler validates passwords against an in-memory <code>Properties</code> object, which you can specify using the <code>users</code> property, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="passwordValidationHandler"
    class="org.springframework.ws.soap.security.xwss.callback.SimplePasswordValidationCallbackHandler"&gt;
    &lt;property name="users"&gt;
        &lt;props&gt;
            &lt;prop key="Bert"&gt;Ernie&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, we are only allowing the user "Bert" to log in using the password "Ernie".</p>
</div>
</div>
<div class="sect5">
<h6 id="_springplaintextpasswordvalidationcallbackhandler"><a class="anchor" href="#_springplaintextpasswordvalidationcallbackhandler"></a>SpringPlainTextPasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>SpringPlainTextPasswordValidationCallbackHandler</code> uses <a href="https://spring.io/projects/spring-security"><em>Spring Security</em></a> to authenticate users. It is beyond the scope of this document to describe Spring Security, but suffice it to say that it is a full-fledged security framework. You can read more about it in the <a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/"><em>Spring Security reference documentation</em></a>.</p>
</div>
<div class="paragraph">
<p>The <code>SpringPlainTextPasswordValidationCallbackHandler</code> requires an <code>AuthenticationManager</code> to operate. It uses this manager to authenticate against a <code>UsernamePasswordAuthenticationToken</code> that it creates. If authentication is successful, the token is stored in the <code>SecurityContextHolder</code>. You can set the authentication manager using the `authenticationManager`property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
  &lt;bean id="springSecurityHandler"
      class="org.springframework.ws.soap.security.xwss.callback.SpringPlainTextPasswordValidationCallbackHandler"&gt;
    &lt;property name="authenticationManager" ref="authenticationManager"/&gt;
  &lt;/bean&gt;

  &lt;bean id="authenticationManager" class="org.springframework.security.providers.ProviderManager"&gt;
      &lt;property name="providers"&gt;
          &lt;bean class="org.springframework.security.providers.dao.DaoAuthenticationProvider"&gt;
              &lt;property name="userDetailsService" ref="userDetailsService"/&gt;
          &lt;/bean&gt;
      &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="userDetailsService" class="com.mycompany.app.dao.UserDetailService" /&gt;
  ...
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jaasplaintextpasswordvalidationcallbackhandler"><a class="anchor" href="#_jaasplaintextpasswordvalidationcallbackhandler"></a>JaasPlainTextPasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>JaasPlainTextPasswordValidationCallbackHandler</code> is based on the standard <a href="http://java.sun.com/products/jaas/"><em>Java Authentication and Authorization Service</em></a>. It is beyond the scope of this document to provide a full introduction into JAAS, but there is a <a href="http://www.javaworld.com/javaworld/jw-09-2002/jw-0913-jaas.html"><em>good tutorial</em></a> available.</p>
</div>
<div class="paragraph">
<p>The <code>JaasPlainTextPasswordValidationCallbackHandler</code> requires only a <code>loginContextName</code> to operate. It creates a new JAAS <code>LoginContext</code> using this name, and handles the standard JAAS <code>NameCallback</code> and <code>PasswordCallback</code> using the username and password provided in the SOAP message. This means that this callback handler integrates with any JAAS <code>LoginModule</code> that fires these callbacks during the <code>login()</code> phase, which is standard behavior.</p>
</div>
<div class="paragraph">
<p>You can wire up a <code>JaasPlainTextPasswordValidationCallbackHandler</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="jaasValidationHandler"
    class="org.springframework.ws.soap.security.xwss.callback.jaas.JaasPlainTextPasswordValidationCallbackHandler"&gt;
    &lt;property name="loginContextName" value="MyLoginModule" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the callback handler uses the <code>LoginContext</code> named "MyLoginModule". This module should be defined in your <code>jaas.config</code> file, as explained in the abovementioned tutorial.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_digest_username_authentication"><a class="anchor" href="#_digest_username_authentication"></a>Digest Username Authentication</h5>
<div class="paragraph">
<p>When using password digests, the SOAP message also contains a <code>UsernameToken</code> element, which itself contains a <code>Username</code> element and a <code>Password</code> element. The difference is that the password is not sent as plain text, but as a <strong>digest</strong>. The recipient compares this digest to the digest he calculated from the known password of the user, and if they are the same, the user is authenticated. It can be compared to the Digest Authentication provided by HTTP servers.</p>
</div>
<div class="paragraph">
<p>To require that every incoming message contains a <code>UsernameToken</code> element with a password digest, the security policy file should contain a <code>RequireUsernameToken</code> element, with the <code>passwordDigestRequired</code> attribute set to`true`. Additionally, the <code>nonceRequired</code> should be set to`true`: You can find a reference of possible child elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp567459"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
    ...
    &lt;xwss:RequireUsernameToken passwordDigestRequired="true" nonceRequired="true"/&gt;
    ...
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the username token is not present, the <code>XwsSecurityInterceptor</code> will return a SOAP Fault to the sender. If it is present, it will fire a <code>PasswordValidationCallback</code> with a <code>DigestPasswordRequest</code> to the registered handlers. Within Spring-WS, there are two classes which handle this particular callback.</p>
</div>
<div class="sect5">
<h6 id="_simplepasswordvalidationcallbackhandler"><a class="anchor" href="#_simplepasswordvalidationcallbackhandler"></a>SimplePasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>SimplePasswordValidationCallbackHandler</code> can handle both plain text passwords as well as password digests. It is described in <a href="#security-simple-password-validation-callback-handler">SimplePasswordValidationCallbackHandler</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_springdigestpasswordvalidationcallbackhandler"><a class="anchor" href="#_springdigestpasswordvalidationcallbackhandler"></a>SpringDigestPasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>SpringDigestPasswordValidationCallbackHandler</code> requires an Spring Security <code>UserDetailService</code> to operate. It uses this service to retrieve the password of the user specified in the token. The digest of the password contained in this details object is then compared with the digest in the message. If they are equal, the user has successfully authenticated, and a <code>UsernamePasswordAuthenticationToken</code> is stored in the <code>SecurityContextHolder</code>. You can set the service using the <code>userDetailsService</code>. Additionally, you can set a <code>userCache</code> property, to cache loaded user details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean class="org.springframework.ws.soap.security.xwss.callback.SpringDigestPasswordValidationCallbackHandler"&gt;
        &lt;property name="userDetailsService" ref="userDetailsService"/&gt;
    &lt;/bean&gt;

    &lt;bean id="userDetailsService" class="com.mycompany.app.dao.UserDetailService" /&gt;
    ...
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="security-certificate-authentication"><a class="anchor" href="#security-certificate-authentication"></a>Certificate Authentication</h5>
<div class="paragraph">
<p>A more secure way of authentication uses X509 certificates. In this scenerario, the SOAP message contains a`BinarySecurityToken`, which contains a Base 64-encoded version of a X509 certificate. The certificate is used by the recipient to authenticate. The certificate stored in the message is also used to sign the message (see <a href="#security-verifying-signatures">Verifying Signatures</a>).</p>
</div>
<div class="paragraph">
<p>To make sure that all incoming SOAP messages carry a`BinarySecurityToken`, the security policy file should contain a <code>RequireSignature</code> element. This element can further carry other elements, which will be covered in <a href="#security-verifying-signatures">Verifying Signatures</a>. You can find a reference of possible child elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp565769"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
    ...
    &lt;xwss:RequireSignature requireTimestamp="false"&gt;
    ...
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a message arrives that carries no certificate, the <code>XwsSecurityInterceptor</code> will return a SOAP Fault to the sender. If it is present, it will fire a <code>CertificateValidationCallback</code>. There are three handlers within Spring-WS which handle this callback for authentication purposes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In most cases, certificate <strong>authentication</strong> should be preceded by certificate <strong>validation</strong>, since you only want to authenticate against valid certificates. Invalid certificates such as certificates for which the expiration date has passed, or which are not in your store of trusted certificates, should be ignored.</p>
</div>
<div class="paragraph">
<p>In Spring-WS terms, this means that the <code>SpringCertificateValidationCallbackHandler</code> or <code>JaasCertificateValidationCallbackHandler</code> should be preceded by <code>KeyStoreCallbackHandler</code>. This can be accomplished by setting the order of the <code>callbackHandlers</code> property in the configuration of the <code>XwsSecurityInterceptor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="wsSecurityInterceptor"
    class="org.springframework.ws.soap.security.xwss.XwsSecurityInterceptor"&gt;
    &lt;property name="policyConfiguration" value="classpath:securityPolicy.xml"/&gt;
    &lt;property name="callbackHandlers"&gt;
        &lt;list&gt;
            &lt;ref bean="keyStoreHandler"/&gt;
            &lt;ref bean="springSecurityHandler"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this setup, the interceptor will first determine if the certificate in the message is valid using the keystore, and then authenticate against it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_keystorecallbackhandler"><a class="anchor" href="#_keystorecallbackhandler"></a>KeyStoreCallbackHandler</h6>
<div class="paragraph">
<p>The <code>KeyStoreCallbackHandler</code> uses a standard Java keystore to validate certificates. This certificate validation process consists of the following steps: .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, the handler will check whether the certificate is in the private <code>keyStore</code>. If it is, it is valid.</p>
</li>
<li>
<p>If the certificate is not in the private keystore, the handler will check whether the current date and time are within the validity period given in the certificate. If they are not, the certificate is invalid; if it is, it will continue with the final step.</p>
</li>
<li>
<p>Finally, a <strong>certification path</strong> for the certificate is created. This basically means that the handler will determine whether the certificate has been issued by any of the certificate authorities in the`trustStore`. If a certification path can be built successfully, the certificate is valid. Otherwise, the certificate is not.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To use the <code>KeyStoreCallbackHandler</code> for certificate validation purposes, you will most likely set only the <code>trustStore</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="trustStore" ref="trustStore"/&gt;
    &lt;/bean&gt;

    &lt;bean id="trustStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:truststore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this setup, the certificate that is to be validated must either be in the trust store itself, or the trust store must contain a certificate authority that issued the certificate.</p>
</div>
</div>
<div class="sect5">
<h6 id="_springcertificatevalidationcallbackhandler"><a class="anchor" href="#_springcertificatevalidationcallbackhandler"></a>SpringCertificateValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>SpringCertificateValidationCallbackHandler</code> requires an Spring Security <code>AuthenticationManager</code> to operate. It uses this manager to authenticate against a <code>X509AuthenticationToken</code> that it creates. The configured authentication manager is expected to supply a provider which can handle this token (usually an instance of <code>X509AuthenticationProvider</code>). If authentication is succesful, the token is  stored in the <code>SecurityContextHolder</code>. You can set the authentication manager using the <code>authenticationManager</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="springSecurityCertificateHandler"
        class="org.springframework.ws.soap.security.xwss.callback.SpringCertificateValidationCallbackHandler"&gt;
        &lt;property name="authenticationManager" ref="authenticationManager"/&gt;
    &lt;/bean&gt;

    &lt;bean id="authenticationManager"
        class="org.springframework.security.providers.ProviderManager"&gt;
        &lt;property name="providers"&gt;
            &lt;bean class="org.springframework.ws.soap.security.x509.X509AuthenticationProvider"&gt;
                &lt;property name="x509AuthoritiesPopulator"&gt;
                    &lt;bean class="org.springframework.ws.soap.security.x509.populator.DaoX509AuthoritiesPopulator"&gt;
                        &lt;property name="userDetailsService" ref="userDetailsService"/&gt;
                    &lt;/bean&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

  &lt;bean id="userDetailsService" class="com.mycompany.app.dao.UserDetailService" /&gt;
  ...
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, we are using a custom user details service to obtain authentication details based on the certificate. Refer to the <a href="http://www.springframework.org/security"><em>Spring Security reference documentation</em></a> for more information about authentication against X509 certificates.</p>
</div>
</div>
<div class="sect5">
<h6 id="_jaascertificatevalidationcallbackhandler"><a class="anchor" href="#_jaascertificatevalidationcallbackhandler"></a>JaasCertificateValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>JaasCertificateValidationCallbackHandler</code> requires a <code>loginContextName</code> to operate. It creates a new JAAS <code>LoginContext</code> using this name and with the <code>X500Principal</code> of the certificate. This means that this callback handler integrates with any JAAS <code>LoginModule</code> that handles X500 principals.</p>
</div>
<div class="paragraph">
<p>You can wire up a <code>JaasCertificateValidationCallbackHandler</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="jaasValidationHandler"
    class="org.springframework.ws.soap.security.xwss.callback.jaas.JaasCertificateValidationCallbackHandler"&gt;
    &lt;property name="loginContextName"&gt;MyLoginModule&lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the callback handler uses the <code>LoginContext</code> named "MyLoginModule". This module should be defined in your <code>jaas.config</code> file, and should be able to authenticate against X500 principals.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_digital_signatures"><a class="anchor" href="#_digital_signatures"></a>7.2.3. Digital Signatures</h4>
<div class="paragraph">
<p>The <strong>digital signature</strong> of a message is a piece of information based on both the document and the signer&#8217;s private key. There are two main tasks related to signatures in WS-Security: verifying signatures and signing messages.</p>
</div>
<div class="sect4">
<h5 id="security-verifying-signatures"><a class="anchor" href="#security-verifying-signatures"></a>Verifying Signatures</h5>
<div class="paragraph">
<p>Just like <a href="#security-certificate-authentication">certificate-based authentication</a>, a signed message contains a <code>BinarySecurityToken</code>, which contains the certificate used to sign the message. Additionally, it contains a <code>SignedInfo</code> block, which indicates what part of the message was signed.</p>
</div>
<div class="paragraph">
<p>To make sure that all incoming SOAP messages carry a`BinarySecurityToken`, the security policy file should contain a <code>RequireSignature</code> element. It can also contain a <code>SignatureTarget</code> element, which specifies the target message part which was expected to be signed, and various other subelements. You can also define the private key alias to use, whether to use a symmetric instead of a private key, and many other properties. You can find a reference of possible child elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp565769"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
    &lt;xwss:RequireSignature requireTimestamp="false"/&gt;
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the signature is not present, the <code>XwsSecurityInterceptor</code> will return a SOAP Fault to the sender. If it is present, it will fire a <code>SignatureVerificationKeyCallback</code> to the registered handlers. Within Spring-WS, there are is one class which handles this particular callback: the <code>KeyStoreCallbackHandler</code>.</p>
</div>
<div class="sect5">
<h6 id="_keystorecallbackhandler_2"><a class="anchor" href="#_keystorecallbackhandler_2"></a>KeyStoreCallbackHandler</h6>
<div class="paragraph">
<p>As described in <a href="#security-key-store-callback-handler">KeyStoreCallbackHandler</a>, the <code>KeyStoreCallbackHandler</code> uses a <code>java.security.KeyStore</code> for handling various cryptographic callbacks, including signature verification. For signature verification, the handler uses the <code>trustStore</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="trustStore" ref="trustStore"/&gt;
    &lt;/bean&gt;

    &lt;bean id="trustStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:org/springframework/ws/soap/security/xwss/test-truststore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_signing_messages"><a class="anchor" href="#_signing_messages"></a>Signing Messages</h5>
<div class="paragraph">
<p>When signing a message, the <code>XwsSecurityInterceptor</code> adds the <code>BinarySecurityToken</code> to the message, and a <code>SignedInfo</code> block, which indicates what part of the message was signed.</p>
</div>
<div class="paragraph">
<p>To sign all outgoing SOAP messages, the security policy file should contain a <code>Sign</code> element. It can also contain a <code>SignatureTarget</code> element, which specifies the target message part which was expected to be signed, and various other subelements. You can also define the private key alias to use, whether to use a symmetric instead of a private key, and many other properties. You can find a reference of possible child elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp565497"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
	&lt;xwss:Sign includeTimestamp="false" /&gt;
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>XwsSecurityInterceptor</code> will fire a <code>SignatureKeyCallback</code> to the registered handlers. Within Spring-WS, there are is one class which handles this particular callback: the <code>KeyStoreCallbackHandler</code>.</p>
</div>
<div class="sect5">
<h6 id="_keystorecallbackhandler_3"><a class="anchor" href="#_keystorecallbackhandler_3"></a>KeyStoreCallbackHandler</h6>
<div class="paragraph">
<p>As described in <a href="#security-key-store-callback-handler">KeyStoreCallbackHandler</a>, the <code>KeyStoreCallbackHandler</code> uses a <code>java.security.KeyStore</code> for handling various cryptographic callbacks, including signing messages. For adding signatures, the handler uses the <code>keyStore</code> property. Additionally, you must set the <code>privateKeyPassword</code> property to unlock the private key used for signing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="keyStore" ref="keyStore"/&gt;
        &lt;property name="privateKeyPassword" value="changeit"/&gt;
    &lt;/bean&gt;

    &lt;bean id="keyStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:keystore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_encryption_and_decryption"><a class="anchor" href="#_encryption_and_decryption"></a>7.2.4. Encryption and Decryption</h4>
<div class="paragraph">
<p>When <strong>encrypting</strong>, the message is transformed into a form that can only be read with the appropriate key. The message can be <strong>decrypted</strong> to reveal the original, readable message.</p>
</div>
<div class="sect4">
<h5 id="_decryption"><a class="anchor" href="#_decryption"></a>Decryption</h5>
<div class="paragraph">
<p>To decrypt incoming SOAP messages, the security policy file should contain a <code>RequireEncryption</code> element. This element can further carry a <code>EncryptionTarget</code> element which indicates which part of the message should be encrypted, and a <code>SymmetricKey</code> to indicate that a shared secret instead of the regular private key should be used to decrypt the message. You can read a description of the other elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp565951"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
    &lt;xwss:RequireEncryption /&gt;
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an incoming message is not encrypted, the <code>XwsSecurityInterceptor</code> will return a SOAP Fault to the sender. If it is present, it will fire a <code>DecryptionKeyCallback</code> to the registered handlers. Within Spring-WS, there is one class which handled this particular callback: the`KeyStoreCallbackHandler`.</p>
</div>
<div class="sect5">
<h6 id="_keystorecallbackhandler_4"><a class="anchor" href="#_keystorecallbackhandler_4"></a>KeyStoreCallbackHandler</h6>
<div class="paragraph">
<p>As described in <a href="#security-key-store-callback-handler">KeyStoreCallbackHandler</a>, the <code>KeyStoreCallbackHandler</code> uses a <code>java.security.KeyStore</code> for handling various cryptographic callbacks, including decryption. For decryption, the handler uses the <code>keyStore</code> property. Additionally, you must set the <code>privateKeyPassword</code> property to unlock the private key used for decryption. For decryption based on symmetric keys, it will use the <code>symmetricStore</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="keyStore" ref="keyStore"/&gt;
        &lt;property name="privateKeyPassword" value="changeit"/&gt;
    &lt;/bean&gt;

    &lt;bean id="keyStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:keystore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_encryption"><a class="anchor" href="#_encryption"></a>Encryption</h5>
<div class="paragraph">
<p>To encrypt outgoing SOAP messages, the security policy file should contain a <code>Encrypt</code> element. This element can further carry a <code>EncryptionTarget</code> element which indicates which part of the message should be encrypted, and a <code>SymmetricKey</code> to indicate that a shared secret instead of the regular public key should be used to encrypt the message. You can read a description of the other elements <a href="http://java.sun.com/webservices/docs/1.6/tutorial/doc/XWS-SecurityIntro4.html#wp565951"><em>here</em></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xwss:SecurityConfiguration xmlns:xwss="http://java.sun.com/xml/ns/xwss/config"&gt;
    &lt;xwss:Encrypt /&gt;
&lt;/xwss:SecurityConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>XwsSecurityInterceptor</code> will fire a <code>EncryptionKeyCallback</code> to the registered handlers in order to retrieve the encryption information. Within Spring-WS, there is one class which handled this particular callback: the <code>KeyStoreCallbackHandler</code>.</p>
</div>
<div class="sect5">
<h6 id="_keystorecallbackhandler_5"><a class="anchor" href="#_keystorecallbackhandler_5"></a>KeyStoreCallbackHandler</h6>
<div class="paragraph">
<p>As described in <a href="#security-key-store-callback-handler">KeyStoreCallbackHandler</a>, the <code>KeyStoreCallbackHandler</code> uses a <code>java.security.KeyStore</code> for handling various cryptographic callbacks, including encryption. For encryption based on public keys, the handler uses the <code>trustStore</code> property. For encryption based on symmetric keys, it will use the`symmetricStore`.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean id="keyStoreHandler" class="org.springframework.ws.soap.security.xwss.callback.KeyStoreCallbackHandler"&gt;
        &lt;property name="trustStore" ref="trustStore"/&gt;
    &lt;/bean&gt;

    &lt;bean id="trustStore" class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
        &lt;property name="location" value="classpath:truststore.jks"/&gt;
        &lt;property name="password" value="changeit"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="security-xws-exception-handling"><a class="anchor" href="#security-xws-exception-handling"></a>7.2.5. Security Exception Handling</h4>
<div class="paragraph">
<p>When a securement or validation action fails, the <code>XwsSecurityInterceptor</code> will throw a <code>WsSecuritySecurementException</code> or <code>WsSecurityValidationException</code> respectively. These exceptions bypass the <a href="#server-endpoint-exception-resolver">standard exception handling mechanism</a>, but are handled in the interceptor itself.</p>
</div>
<div class="paragraph">
<p><code>WsSecuritySecurementException</code> exceptions are handled in the <code>handleSecurementException</code> method of the <code>XwsSecurityInterceptor</code>. By default, this method will simply log an error, and stop further processing of the message.</p>
</div>
<div class="paragraph">
<p>Similarly, <code>WsSecurityValidationException</code> exceptions are handled in the <code>handleValidationException</code> method of the <code>XwsSecurityInterceptor</code>. By default, this method will create a SOAP 1.1 Client or SOAP 1.2 Sender Fault, and send that back as a response.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both <code>handleSecurementException</code> and <code>handleValidationException</code> are protected methods, which you can override to change their default behavior.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-wss4j-security-interceptor"><a class="anchor" href="#security-wss4j-security-interceptor"></a>7.3. <code>Wss4jSecurityInterceptor</code></h3>
<div class="paragraph">
<p>The <code>Wss4jSecurityInterceptor</code> is an <code>EndpointInterceptor</code> (see <a href="#server-endpoint-interceptor">Intercepting requests - the <code>EndpointInterceptor</code> interface</a>) that is based on <a href="https://ws.apache.org/wss4j/">Apache&#8217;s WSS4J</a>.</p>
</div>
<div class="paragraph">
<p>WSS4J implements the following standards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OASIS Web Serives Security: SOAP Message Security 1.0 Standard 200401, March 2004</p>
</li>
<li>
<p>Username Token profile V1.0</p>
</li>
<li>
<p>X.509 Token Profile V1.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This interceptor supports messages created by the <code>AxiomSoapMessageFactory</code> and the <code>SaajSoapMessageFactory</code>.</p>
</div>
<div class="sect3">
<h4 id="_configuring_code_wss4jsecurityinterceptor_code"><a class="anchor" href="#_configuring_code_wss4jsecurityinterceptor_code"></a>7.3.1. Configuring <code>Wss4jSecurityInterceptor</code></h4>
<div class="paragraph">
<p>WSS4J uses no external configuration file; the interceptor is entirely configured by properties. The validation and securement actions executed by this interceptor are specified via <code>validationActions</code> and <code>securementActions</code> properties, respectively. Actions are passed as a space-separated strings. Here is an example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="UsernameToken Encrypt"/&gt;
    ...
    &lt;property name="securementActions" value="Encrypt"/&gt;
    ...
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Validation actions are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Validation action</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UsernameToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates username token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates the timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Encrypt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decrypts the message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Signature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates the signature</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NoSecurity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No action performed</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Securement actions are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Securement action</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UsernameToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a username token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UsernameTokenSignature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a username token and a signature username token secret key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Encrypt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encrypts the response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Signature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signs the response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NoSecurity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No action performed</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The order of the actions is significant and is enforced by the interceptor. The interceptor will reject an incoming SOAP message if its security actions were performed in a different order than the one specified by`validationActions`.</p>
</div>
</div>
<div class="sect3">
<h4 id="_handling_digital_certificates"><a class="anchor" href="#_handling_digital_certificates"></a>7.3.2. Handling Digital Certificates</h4>
<div class="paragraph">
<p>For cryptographic operations requiring interaction with a keystore or certificate handling (signature, encryption and decryption operations), WSS4J requires an instance of`org.apache.ws.security.components.crypto.Crypto`.</p>
</div>
<div class="paragraph">
<p><code>Crypto</code> instances can be obtained from WSS4J&#8217;s <code>CryptoFactory</code> or more conveniently with the Spring-WS`CryptoFactoryBean`.</p>
</div>
<div class="sect4">
<h5 id="_cryptofactorybean"><a class="anchor" href="#_cryptofactorybean"></a>CryptoFactoryBean</h5>
<div class="paragraph">
<p>Spring-WS provides a convenient factory bean, <code>CryptoFactoryBean</code> that constructs and configures <code>Crypto</code> instances via strong-typed properties (prefered) or through a <code>Properties</code> object.</p>
</div>
<div class="paragraph">
<p>By default, <code>CryptoFactoryBean</code> returns instances of <code>org.apache.ws.security.components.crypto.Merlin</code>. This can be changed by setting the <code>cryptoProvider</code> property (or its equivalent <code>org.apache.ws.security.crypto.provider</code> string property).</p>
</div>
<div class="paragraph">
<p>Here is a simple example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
    &lt;property name="keyStorePassword" value="mypassword"/&gt;
    &lt;property name="keyStoreLocation" value="file:/path_to_keystore/keystore.jks"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_2"><a class="anchor" href="#_authentication_2"></a>7.3.3. Authentication</h4>
<div class="sect4">
<h5 id="_validating_username_token"><a class="anchor" href="#_validating_username_token"></a>Validating Username Token</h5>
<div class="paragraph">
<p>Spring-WS provides a set of callback handlers to integrate with Spring Security. Additionally, a simple callback handler <code>SimplePasswordValidationCallbackHandler</code> is provided to configure users and passwords with an in-memory <code>Properties</code> object.</p>
</div>
<div class="paragraph">
<p>Callback handlers are configured via <code>Wss4jSecurityInterceptor&#8217;s `validationCallbackHandler</code> property.</p>
</div>
<div class="sect5">
<h6 id="_simplepasswordvalidationcallbackhandler_2"><a class="anchor" href="#_simplepasswordvalidationcallbackhandler_2"></a>SimplePasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p><code>SimplePasswordValidationCallbackHandler</code> validates plain text and digest username tokens against an in-memory <code>Properties</code> object. It is configured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="callbackHandler"
    class="org.springframework.ws.soap.security.wss4j.callback.SimplePasswordValidationCallbackHandler"&gt;
    &lt;property name="users"&gt;
        &lt;props&gt;
            &lt;prop key="Bert"&gt;Ernie&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_springsecuritypasswordvalidationcallbackhandler"><a class="anchor" href="#_springsecuritypasswordvalidationcallbackhandler"></a>SpringSecurityPasswordValidationCallbackHandler</h6>
<div class="paragraph">
<p>The <code>SpringSecurityPasswordValidationCallbackHandler</code> validates plain text and digest passwords using a Spring Security <code>UserDetailService</code> to operate. It uses this service to retrieve the (digest of ) the password of the user specified in the token. The (digest of) the password contained in this details object is then compared with the digest in the message. If they are equal, the user has successfully authenticated, and a <code>UsernamePasswordAuthenticationToken</code> is stored in the`SecurityContextHolder`. You can set the service using the <code>userDetailsService</code>. Additionally, you can set a <code>userCache</code> property, to cache loaded user details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
    &lt;bean class="org.springframework.ws.soap.security.wss4j.callback.SpringDigestPasswordValidationCallbackHandler"&gt;
        &lt;property name="userDetailsService" ref="userDetailsService"/&gt;
    &lt;/bean&gt;

    &lt;bean id="userDetailsService" class="com.mycompany.app.dao.UserDetailService" /&gt;
    ...
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adding_username_token"><a class="anchor" href="#_adding_username_token"></a>Adding Username Token</h5>
<div class="paragraph">
<p>Adding a username token to an outgoing message is as simple as adding <code>UsernameToken</code> to the <code>securementActions</code> property of the <code>Wss4jSecurityInterceptor</code> and specifying <code>securementUsername</code> and`securementPassword`.</p>
</div>
<div class="paragraph">
<p>The password type can be set via the <code>securementPasswordType</code> property. Possible values are <code>PasswordText</code> for plain text passwords or <code>PasswordDigest</code> for digest passwords, which is the default.</p>
</div>
<div class="paragraph">
<p>The following example generates a username token with a digest password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="UsernameToken"/&gt;
    &lt;property name="securementUsername" value="Ernie"/&gt;
    &lt;property name="securementPassword" value="Bert"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If plain text password type is chosen, it is possible to instruct the interceptor to add <code>Nonce</code> and/or <code>Created</code> elements using the <code>securementUsernameTokenElements</code> property. The value must be a list containing the desired elements' names separated by spaces (case sensitive).</p>
</div>
<div class="paragraph">
<p>The next example generates a username token with a plain text password, a <code>Nonce</code> and a <code>Created</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="UsernameToken"/&gt;
    &lt;property name="securementUsername" value="Ernie"/&gt;
    &lt;property name="securementPassword" value="Bert"/&gt;
    &lt;property name="securementPasswordType" value="PasswordText"/&gt;
    &lt;property name="securementUsernameTokenElements" value="Nonce Created"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_certificate_authentication"><a class="anchor" href="#_certificate_authentication"></a>Certificate Authentication</h5>
<div class="paragraph">
<p>As certificate authentication is akin to digital signatures, WSS4J handles it as part of the signature validation and securement. Specifically, the <code>securementSignatureKeyIdentifier</code> property must be set to <code>DirectReference</code> in order to instruct WSS4J to generate a <code>BinarySecurityToken</code> element containing the X509 certificate and to include it in the outgoing message. The certificate&#8217;s name and password are passed through the <code>securementUsername</code> and <code>securementPassword</code> properties respectively. See the next example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="Signature"/&gt;
    &lt;property name="securementSignatureKeyIdentifier" value="DirectReference"/&gt;
    &lt;property name="securementUsername" value="mycert"/&gt;
    &lt;property name="securementPassword" value="certpass"/&gt;
    &lt;property name="securementSignatureCrypto"&gt;
      &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
        &lt;property name="keyStorePassword" value="123456"/&gt;
        &lt;property name="keyStoreLocation" value="classpath:/keystore.jks"/&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the certificate validation, regular signature validation applies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="Signature"/&gt;
    &lt;property name="validationSignatureCrypto"&gt;
      &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
        &lt;property name="keyStorePassword" value="123456"/&gt;
        &lt;property name="keyStoreLocation" value="classpath:/keystore.jks"/&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the end of the validation, the interceptor will automatically verify the validity of the certificate by delegating to the default WSS4J implementation. If needed, this behavior can be changed by redefining the <code>verifyCertificateTrust</code> method.</p>
</div>
<div class="paragraph">
<p>For more details, please refer to <a href="#security-wss4j-digital-signatures">Digital Signatures</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_timestamps"><a class="anchor" href="#_security_timestamps"></a>7.3.4. Security Timestamps</h4>
<div class="paragraph">
<p>This section describes the various timestamp options available in the <code>Wss4jSecurityInterceptor</code>.</p>
</div>
<div class="sect4">
<h5 id="_validating_timestamps"><a class="anchor" href="#_validating_timestamps"></a>Validating Timestamps</h5>
<div class="paragraph">
<p>To validate timestamps add <code>Timestamp</code> to the <code>validationActions</code> property. It is possible to override timestamp semantics specified by the initiator of the SOAP message by setting <code>timestampStrict</code> to <code>true</code> and specifying a server-side time to live in seconds (defaults to 300) via the <code>timeToLive</code> property <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup> .</p>
</div>
<div class="paragraph">
<p>In the following example, the interceptor will limit the timestamp validity window to 10 seconds, rejecting any valid timestamp token outside that window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="Timestamp"/&gt;
    &lt;property name="timestampStrict" value="true"/&gt;
    &lt;property name="timeToLive" value="10"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adding_timestamps"><a class="anchor" href="#_adding_timestamps"></a>Adding Timestamps</h5>
<div class="paragraph">
<p>Adding <code>Timestamp</code> to the <code>securementActions</code> property generates a timestamp header in outgoing messages. The <code>timestampPrecisionInMilliseconds</code> property specifies whether the precision of the generated timestamp is in milliseconds. The default value is`true`.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="Timestamp"/&gt;
    &lt;property name="timestampPrecisionInMilliseconds" value="true"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="security-wss4j-digital-signatures"><a class="anchor" href="#security-wss4j-digital-signatures"></a>7.3.5. Digital Signatures</h4>
<div class="paragraph">
<p>This section describes the various signature options available in the <code>Wss4jSecurityInterceptor</code>.</p>
</div>
<div class="sect4">
<h5 id="_verifying_signatures"><a class="anchor" href="#_verifying_signatures"></a>Verifying Signatures</h5>
<div class="paragraph">
<p>To instruct the`Wss4jSecurityInterceptor`, <code>validationActions</code> must contain the <code>Signature</code> action. Additionally, the <code>validationSignatureCrypto</code> property must point to the keystore containing the public certificates of the initiator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="wsSecurityInterceptor" class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="Signature"/&gt;
    &lt;property name="validationSignatureCrypto"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
            &lt;property name="keyStorePassword" value="123456"/&gt;
            &lt;property name="keyStoreLocation" value="classpath:/keystore.jks"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_signing_messages_2"><a class="anchor" href="#_signing_messages_2"></a>Signing Messages</h5>
<div class="paragraph">
<p>Signing outgoing messages is enabled by adding <code>Signature</code> action to the`securementActions`. The alias and the password of the private key to use are specified by the <code>securementUsername</code> and <code>securementPassword</code> properties respectively. <code>securementSignatureCrypto</code> must point to the keystore containing the private key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="Signature"/&gt;
    &lt;property name="securementUsername" value="mykey"/&gt;
    &lt;property name="securementPassword" value="123456"/&gt;
    &lt;property name="securementSignatureCrypto"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
            &lt;property name="keyStorePassword" value="123456"/&gt;
            &lt;property name="keyStoreLocation" value="classpath:/keystore.jks"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Furthermore, the signature algorithm can be defined via the <code>securementSignatureAlgorithm</code>.</p>
</div>
<div class="paragraph">
<p>The key identifier type to use can be customized via the <code>securementSignatureKeyIdentifier</code> property. Only <code>IssuerSerial</code> and <code>DirectReference</code> are valid for signature.</p>
</div>
<div class="paragraph">
<p><code>securementSignatureParts</code> property controls which part of the message shall be signed. The value of this property is a list of semi-colon separated element names that identify the elements to sign. The general form of a signature part is <code>{}{namespace}Element</code> <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup> . The default behavior is to sign the SOAP body.</p>
</div>
<div class="paragraph">
<p>As an example, here is how to sign the <code>echoResponse</code> element in the Spring Web Services echo sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;property name="securementSignatureParts"
    value="{}{http://www.springframework.org/spring-ws/samples/echo}echoResponse"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify an element without a namespace use the string <code>Null</code> as the namespace name (case sensitive).</p>
</div>
<div class="paragraph">
<p>If there is no other element in the request with a local name of <code>Body</code> then the SOAP namespace identifier can be empty (<code>{}</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_signature_confirmation"><a class="anchor" href="#_signature_confirmation"></a>Signature Confirmation</h5>
<div class="paragraph">
<p>Signature confirmation is enabled by setting <code>enableSignatureConfirmation</code> to <code>true</code>. Note that signature confirmation action spans over the request and the response. This implies that <code>secureResponse</code> and <code>validateRequest</code> must be set to true (which is the default value) even if there are no corresponding security actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="Signature"/&gt;
    &lt;property name="enableSignatureConfirmation" value="true"/&gt;
    &lt;property name="validationSignatureCrypto"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
            &lt;property name="keyStorePassword" value="123456"/&gt;
            &lt;property name="keyStoreLocation" value="file:/keystore.jks"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_encryption_and_decryption_2"><a class="anchor" href="#_encryption_and_decryption_2"></a>7.3.6. Encryption and Decryption</h4>
<div class="paragraph">
<p>This section describes the various encryption and descryption options available in the <code>Wss4jSecurityInterceptor</code>.</p>
</div>
<div class="sect4">
<h5 id="_decryption_2"><a class="anchor" href="#_decryption_2"></a>Decryption</h5>
<div class="paragraph">
<p>Decryption of incoming SOAP messages requires <code>Encrypt</code> action be added to the <code>validationActions</code> property. The rest of the configuration depends on the key information that appears in the message <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup> .</p>
</div>
<div class="paragraph">
<p>To decrypt messages with an embedded encypted symmetric key ( <code>xenc:EncryptedKey</code> element), <code>validationDecryptionCrypto</code> needs to point to a keystore containing the decryption private key. Additionally, <code>validationCallbackHandler</code> has to be injected with a <code>org.springframework.ws.soap.security.wss4j.callback.KeyStoreCallbackHandler</code> specifying the key&#8217;s password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="Encrypt"/&gt;
    &lt;property name="validationDecryptionCrypto"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
            &lt;property name="keyStorePassword" value="123456"/&gt;
            &lt;property name="keyStoreLocation" value="classpath:/keystore.jks"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="validationCallbackHandler"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.callback.KeyStoreCallbackHandler"&gt;
            &lt;property name="privateKeyPassword" value="mykeypass"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To support decryption of messages with an embedded <strong>key name</strong> ( <code>ds:KeyName</code> element), configure a <code>KeyStoreCallbackHandler</code> that points to the keystore with the symmetric secret key. The property <code>symmetricKeyPassword</code> indicates the key&#8217;s password, the key name being the one specified by <code>ds:KeyName</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="validationActions" value="Encrypt"/&gt;
    &lt;property name="validationCallbackHandler"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.callback.KeyStoreCallbackHandler"&gt;
            &lt;property name="keyStore"&gt;
                &lt;bean class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
                    &lt;property name="location" value="classpath:keystore.jks"/&gt;
                    &lt;property name="type" value="JCEKS"/&gt;
                    &lt;property name="password" value="123456"/&gt;
                &lt;/bean&gt;
            &lt;/property&gt;
            &lt;property name="symmetricKeyPassword" value="mykeypass"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_encryption_2"><a class="anchor" href="#_encryption_2"></a>Encryption</h5>
<div class="paragraph">
<p>Adding <code>Encrypt</code> to the <code>securementActions</code> enables encryption of outgoing messages. The certifacte&#8217;s alias to use for the encryption is set via the <code>securementEncryptionUser</code> property. The keystore where the certificate reside is accessed using the <code>securementEncryptionCrypto</code> property. As encryption relies on public certificates, no password needs to be passed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="Encrypt"/&gt;
    &lt;property name="securementEncryptionUser" value="mycert"/&gt;
    &lt;property name="securementEncryptionCrypto"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.support.CryptoFactoryBean"&gt;
            &lt;property name="keyStorePassword" value="123456"/&gt;
            &lt;property name="keyStoreLocation" value="file:/keystore.jks"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Encryption can be customized in several ways: The key identifier type to use is defined by`securementEncryptionKeyIdentifier`. Possible values are`IssuerSerial`,<code>X509KeyIdentifier</code>, <code>DirectReference</code>,<code>Thumbprint</code>, <code>SKIKeyIdentifier</code> or`EmbeddedKeyName`.</p>
</div>
<div class="paragraph">
<p>If the <code>EmbeddedKeyName</code> type is chosen, you need to specify the <strong>secret key</strong> to use for the encryption. The alias of the key is set via the <code>securementEncryptionUser</code> property just as for the other key identifier types. However, WSS4J requires a callback handler to fetch the secret key. Thus, <code>securementCallbackHandler</code> must be provided with a <code>KeyStoreCallbackHandler</code> pointing to the appropriate keystore. By default, the <code>ds:KeyName</code> element in the resulting WS-Security header takes the value of the <code>securementEncryptionUser</code> property. To indicate a different name, set the <code>securementEncryptionEmbeddedKeyName</code> with the desired value. In the next example, the outgoing message will be encrypted with a key aliased <code>secretKey</code> whereas <code>myKey</code> will appear in <code>ds:KeyName</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor"&gt;
    &lt;property name="securementActions" value="Encrypt"/&gt;
    &lt;property name="securementEncryptionKeyIdentifier" value="EmbeddedKeyName"/&gt;
    &lt;property name="securementEncryptionUser" value="secretKey"/&gt;
    &lt;property name="securementEncryptionEmbeddedKeyName" value="myKey"/&gt;
    &lt;property name="securementCallbackHandler"&gt;
        &lt;bean class="org.springframework.ws.soap.security.wss4j.callback.KeyStoreCallbackHandler"&gt;
            &lt;property name="symmetricKeyPassword" value="keypass"/&gt;
            &lt;property name="keyStore"&gt;
                &lt;bean class="org.springframework.ws.soap.security.support.KeyStoreFactoryBean"&gt;
                    &lt;property name="location" value="file:/keystore.jks"/&gt;
                    &lt;property name="type" value="jceks"/&gt;
                    &lt;property name="password" value="123456"/&gt;
                &lt;/bean&gt;
            &lt;/property&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>securementEncryptionKeyTransportAlgorithm</code> property defines which algorithm to use to encrypt the generated symmetric key. Supported values are <code><a href="http://www.w3.org/2001/04/xmlenc#rsa-1_5" class="bare">http://www.w3.org/2001/04/xmlenc#rsa-1_5</a></code>, which is the default, and <code><a href="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p" class="bare">http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p</a></code>.</p>
</div>
<div class="paragraph">
<p>The symmetric encryption algorithm to use can be set via the <code>securementEncryptionSymAlgorithm</code> property. Supported values are <code><a href="http://www.w3.org/2001/04/xmlenc#aes128-cbc" class="bare">http://www.w3.org/2001/04/xmlenc#aes128-cbc</a></code> (default value), <code><a href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc" class="bare">http://www.w3.org/2001/04/xmlenc#tripledes-cbc</a></code>, <code><a href="http://www.w3.org/2001/04/xmlenc#aes256-cbc" class="bare">http://www.w3.org/2001/04/xmlenc#aes256-cbc</a></code>, <code><a href="http://www.w3.org/2001/04/xmlenc#aes192-cbc" class="bare">http://www.w3.org/2001/04/xmlenc#aes192-cbc</a></code>.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>securementEncryptionParts</code> property defines which parts of the message will be encrypted. The value of this property is a list of semi-colon separated element names that identify the elements to encrypt. An encryption mode specifier and a namespace identification, each inside a pair of curly brackets, may precede each element name. The encryption mode specifier is either <code>{Content}</code> or <code>{Element}</code> <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup> . The following example identifies the <code>echoResponse</code> from the echo sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;property name="securementEncryptionParts"
    value="{Content}{http://www.springframework.org/spring-ws/samples/echo}echoResponse"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be aware that the element name, the namespace identifier, and the encryption modifier are case sensitive. The encryption modifier and the namespace identifier can be omitted. In this case the encryption mode defaults to <code>Content</code> and the namespace is set to the SOAP namespace.</p>
</div>
<div class="paragraph">
<p>To specify an element without a namespace use the value <code>Null</code> as the namespace name (case sensitive). If no list is specified, the handler encrypts the SOAP Body in <code>Content</code> mode by default.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_exception_handling"><a class="anchor" href="#_security_exception_handling"></a>7.3.7. Security Exception Handling</h4>
<div class="paragraph">
<p>The exception handling of the <code>Wss4jSecurityInterceptor</code> is identical to that of the <code>XwsSecurityInterceptor</code>. See <a href="#security-xws-exception-handling">Security Exception Handling</a> for more information.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="resources" class="sect0"><a class="anchor" href="#resources"></a>III. Other Resources</h1>
<div class="openblock partintro">
<div class="content">
In addition to this reference documentation, there exist a number of other resources that may help you learn how to use Spring Web Services. These additional, third-party resources are enumerated in this section.
</div>
</div>
<div class="sect1">
<h2 id="_bibliography"><a class="anchor" href="#_bibliography"></a>Bibliography</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="waldo-94"></a>[waldo-94] Jim Waldo, Ann Wollrath, and Sam Kendall. <em>A Note on Distributed Computing</em>. Springer Verlag. 1994</p>
</li>
<li>
<p><a id="alpine"></a>[alpine] Steve Loughran &amp; Edmund Smith. <em>Rethinking the Java SOAP Stack</em>. May 17, 2005. &#169; 2005 IEEE Telephone Laboratories, Inc.</p>
</li>
<li>
<p><a id="effective-enterprise-java"></a>[effective-enterprise-java] Ted Neward. Scott Meyers. <em>Effective Enterprise Java</em>. Addison-Wesley. 2004</p>
</li>
<li>
<p><a id="effective-xml"></a>[effective-xml] Elliotte Rusty Harold. Scott Meyers. <em>Effective XML</em>. Addison-Wesley. 2004</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Most of the contents in this section was inspired by <a href="#alpine">[alpine]</a> and <a href="#effective-enterprise-java">[effective-enterprise-java]</a>.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. For more information on WS-Addressing, see <a href="https://en.wikipedia.org/wiki/WS-Addressing" class="bare">https://en.wikipedia.org/wiki/WS-Addressing</a>.
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. The interceptor will always reject already expired timestamps whatever the value of <code>timeToLive</code> is.
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. The first empty brackets are used for encryption parts only.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. This is because WSS4J needs only a Crypto for encypted keys, whereas embedded key name validation is delegated to a callback handler.
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. Please refer to the W3C XML Encryption specification about the differences between Element and Content encryption.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.0.7.RELEASE<br>
Last updated 2019-04-24 21:41:32 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>