<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0">
<meta name="author" content="Mattias Hellborg Arthursson, Ulrik Sandberg, Eric Dalquist, Keith Barlow, Rob Winch">
<title>Spring LDAP Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-check-square-o:first-child,ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after,a[href^="mailto:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring LDAP Reference</h1>
<div class="details">
<span id="author" class="author">Mattias Hellborg Arthursson</span><br>
<span id="author2" class="author">Ulrik Sandberg</span><br>
<span id="author3" class="author">Eric Dalquist</span><br>
<span id="author4" class="author">Keith Barlow</span><br>
<span id="author5" class="author">Rob Winch</span><br>
<span id="revnumber">version 2.3.2.RELEASE</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#preface">Preface</a>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#overview">1.1. Overview</a></li>
<li><a href="#traditional-java-ldap-v-s-ldaptemplate">1.2. Traditional Java LDAP v/s LdapTemplate</a></li>
<li><a href="#what-s-new-in-2-2">1.3. What&#8217;s new in 2.2?</a></li>
<li><a href="#what-s-new-in-2-1">1.4. What&#8217;s new in 2.1?</a></li>
<li><a href="#what-s-new-in-2-0">1.5. What&#8217;s new in 2.0?</a></li>
<li><a href="#packaging-overview">1.6. Packaging overview</a></li>
<li><a href="#getting-started">1.7. Getting Started</a></li>
<li><a href="#support">1.8. Support</a></li>
<li><a href="#acknowledgements">1.9. Acknowledgements</a></li>
</ul>
</li>
<li><a href="#basic-usage">2. Basic Usage</a>
<ul class="sectlevel2">
<li><a href="#search-and-lookup-using-attributesmapper">2.1. Search and Lookup Using AttributesMapper</a></li>
<li><a href="#basic-queries">2.2. Building LDAP Queries</a></li>
<li><a href="#ldap-names">2.3. Dynamically Building Distinguished Names</a></li>
<li><a href="#binding-and-unbinding">2.4. Binding and Unbinding</a></li>
<li><a href="#updating">2.5. Updating</a></li>
</ul>
</li>
<li><a href="#dirobjectfactory">3. Simplifying Attribute Access and Manipulation with DirContextAdapter</a>
<ul class="sectlevel2">
<li><a href="#introduction-2">3.1. Introduction</a></li>
<li><a href="#search-and-lookup-using-contextmapper">3.2. Search and Lookup Using ContextMapper</a></li>
<li><a href="#adding-and-updating-data-using-dircontextadapter">3.3. Adding and Updating Data Using DirContextAdapter</a></li>
<li><a href="#dns-as-attribute-values">3.4. DirContextAdapter and Distinguished Names as Attribute Values.</a></li>
<li><a href="#a-complete-personrepository-class">3.5. A Complete PersonRepository Class</a></li>
</ul>
</li>
<li><a href="#odm">4. Object-Directory Mapping (ODM)</a>
<ul class="sectlevel2">
<li><a href="#introduction-3">4.1. Introduction</a></li>
<li><a href="#annotations">4.2. Annotations</a></li>
<li><a href="#execution">4.3. Execution</a></li>
<li><a href="#odm-dn-attributes">4.4. ODM and Distinguished Names as Attribute Values.</a></li>
</ul>
</li>
<li><a href="#query-builder-advanced">5. Advanced LDAP Queries</a>
<ul class="sectlevel2">
<li><a href="#ldap-query-builder-parameters">5.1. LDAP Query Builder Parameters</a></li>
<li><a href="#filter-criteria">5.2. Filter Criteria</a></li>
<li><a href="#hardcoded-filters">5.3. Hardcoded Filters</a></li>
</ul>
</li>
<li><a href="#configuration">6. Configuration</a>
<ul class="sectlevel2">
<li><a href="#introduction-4">6.1. Introduction</a></li>
<li><a href="#contextsource-configuration">6.2. ContextSource Configuration</a></li>
<li><a href="#ldaptemplate-configuration">6.3. LdapTemplate Configuration</a></li>
<li><a href="#base-context-configuration">6.4. Obtaining a reference to the base LDAP path</a></li>
</ul>
</li>
<li><a href="#repositories">7. Spring LDAP Repositories</a>
<ul class="sectlevel2">
<li><a href="#overview-2">7.1. Overview</a></li>
<li><a href="#querydsl-support">7.2. QueryDSL support</a></li>
</ul>
</li>
<li><a href="#pooling">8. Pooling Support</a>
<ul class="sectlevel2">
<li><a href="#introduction-5">8.1. Introduction</a></li>
<li><a href="#dircontext-validation">8.2. DirContext Validation</a></li>
<li><a href="#pool-configuration">8.3. Pool Configuration</a></li>
<li><a href="#pool2-configuration">8.4. Pool2 Configuration</a></li>
<li><a href="#configuration-2">8.5. Configuration</a></li>
<li><a href="#known-issues">8.6. Known Issues</a></li>
</ul>
</li>
<li><a href="#adding-missing-overloaded-api-methods">9. Adding Missing Overloaded API Methods</a>
<ul class="sectlevel2">
<li><a href="#implementing-custom-search-methods">9.1. Implementing Custom Search Methods</a></li>
<li><a href="#implementing-other-custom-context-methods">9.2. Implementing Other Custom Context Methods</a></li>
</ul>
</li>
<li><a href="#processing-the-dircontext">10. Processing the DirContext</a>
<ul class="sectlevel2">
<li><a href="#custom-dircontext-pre-postprocessing">10.1. Custom DirContext Pre/Postprocessing</a></li>
<li><a href="#implementing-a-request-control-dircontextprocessor">10.2. Implementing a Request Control DirContextProcessor</a></li>
<li><a href="#paged-search-results">10.3. Paged Search Results</a></li>
</ul>
</li>
<li><a href="#transaction-support">11. Transaction Support</a>
<ul class="sectlevel2">
<li><a href="#introduction-6">11.1. Introduction</a></li>
<li><a href="#configuration-3">11.2. Configuration</a></li>
<li><a href="#jdbc-transaction-integration">11.3. JDBC Transaction Integration</a></li>
<li><a href="#ldap-compensating-transactions-explained">11.4. LDAP Compensating Transactions Explained</a></li>
</ul>
</li>
<li><a href="#user-authentication">12. User Authentication using Spring LDAP</a>
<ul class="sectlevel2">
<li><a href="#basic-authentication">12.1. Basic Authentication</a></li>
<li><a href="#operationsOnAuthenticatedContext">12.2. Performing Operations on the Authenticated Context</a></li>
<li><a href="#obsolete-authentication-methods">12.3. Obsolete authentication methods</a></li>
<li><a href="#use-spring-security">12.4. Use Spring Security</a></li>
</ul>
</li>
<li><a href="#ldif-parsing">13. LDIF Parsing</a>
<ul class="sectlevel2">
<li><a href="#introduction-7">13.1. Introduction</a></li>
<li><a href="#object-representation">13.2. Object Representation</a></li>
<li><a href="#the-parser">13.3. The Parser</a></li>
<li><a href="#schema-validation">13.4. Schema Validation</a></li>
<li><a href="#spring-batch-integration">13.5. Spring Batch Integration</a></li>
</ul>
</li>
<li><a href="#utilities">14. Utilities</a>
<ul class="sectlevel2">
<li><a href="#incremental-retrieval-of-multi-valued-attributes">14.1. Incremental Retrieval of Multi-Valued Attributes</a></li>
</ul>
</li>
<li><a href="#testing">15. Testing</a>
<ul class="sectlevel3">
<li><a href="#using-embedded-server">15.1. Using Embedded Server</a></li>
<li><a href="#apacheds">15.2. ApacheDS</a></li>
<li><a href="#unboundid">15.3. UnboundID</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring LDAP makes it easier to build Spring-based applications that use the Lightweight Directory Access Protocol.</p>
</div>
<div class="paragraph">
<p><em>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</em></p>
</div>
</div>
</div>
<h1 id="preface" class="sect0"><a class="anchor" href="#preface"></a>Preface</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The Java Naming and Directory Interface (JNDI) is for LDAP programming what Java Database Connectivity (JDBC) is for SQL programming. There are several similarities between JDBC and JNDI/LDAP (Java LDAP). Despite being two completely different APIs with different pros and cons, they share a number of less flattering characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They require extensive plumbing code, even to perform the simplest of tasks.</p>
</li>
<li>
<p>All resources need to be correctly closed, no matter what happens.</p>
</li>
<li>
<p>Exception handling is difficult.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above points often lead to massive code duplication in common usages of the APIs. As we all know, code duplication is one of the worst code smells. All in all, it boils down to this: JDBC and LDAP programming in Java are both incredibly dull and repetitive.</p>
</div>
<div class="paragraph">
<p>Spring JDBC, a core component of Spring Framework, provides excellent utilities for simplifying SQL programming. We need a similar framework for Java LDAP programming.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a>1.1. Overview</h3>
<div class="paragraph">
<p>Spring LDAP is designed to simplify LDAP programming in Java. Some of the features provided by the library are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/jdbc/core/JdbcTemplate.html">JdbcTemplate</a>-style template simplifications to LDAP programming.</p>
</li>
<li>
<p>JPA/Hibernate-style annotation-based object/directory mapping.</p>
</li>
<li>
<p>Spring Data repository support, including support for QueryDSL.</p>
</li>
<li>
<p>Utilities to simplify building LDAP queries and distinguished names.</p>
</li>
<li>
<p>Proper LDAP connection pooling.</p>
</li>
<li>
<p>Client-side LDAP compensating transaction support.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="traditional-java-ldap-v-s-ldaptemplate"><a class="anchor" href="#traditional-java-ldap-v-s-ldaptemplate"></a>1.2. Traditional Java LDAP v/s LdapTemplate</h3>
<div class="paragraph">
<p>Consider a method that should search some storage for all persons and return their names in a list.
Using JDBC, we would create a <em>connection</em> and execute a <em>query</em> using a <em>statement</em>. We would then loop over the <em>result set</em> and retrieve the <em>column</em> we want, adding it to a list.</p>
</div>
<div class="paragraph">
<p>Working against an LDAP database with JNDI, we would create a <em>context</em> and perform a <em>search</em> using a <em>search filter</em>. We would then loop over the resulting <em>naming enumeration</em> and retrieve the <em>attribute</em> we want, adding it to a list.</p>
</div>
<div class="paragraph">
<p>The traditional way of implementing this person name search method in Java LDAP looks like this. Note the code marked <strong>bold</strong> - this is the code that
actually performs tasks related to the business purpose of the method - the rest is just plumbing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repository;

public class TraditionalPersonRepoImpl implements PersonRepo {
   public List&lt;String&gt; getAllPersonNames() {
      Hashtable env = new Hashtable();
      env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
      env.put(Context.PROVIDER_URL, "ldap://localhost:389/dc=example,dc=com");

      DirContext ctx;
      try {
         ctx = new InitialDirContext(env);
      } catch (NamingException e) {
         throw new RuntimeException(e);
      }

      List&lt;String&gt; list = new LinkedList&lt;String&gt;();
      NamingEnumeration results = null;
      try {
         SearchControls controls = new SearchControls();
         controls.setSearchScope(SearchControls.SUBTREE_SCOPE);
         results = ctx.<strong>search</strong>("", <strong>"(objectclass=person)"</strong>, controls);

         while (results.hasMore()) {
            SearchResult searchResult = (SearchResult) results.next();
            Attributes attributes = searchResult.getAttributes();
            <strong>Attribute attr = attributes.get("cn");
            String cn = attr.get().toString();</strong>
            list.add(cn);
         }
      } catch (NameNotFoundException e) {
         // The base context was not found.
         // Just clean up and exit.
      } catch (NamingException e) {
         throw new RuntimeException(e);
      } finally {
         if (results != null) {
            try {
               results.close();
            } catch (Exception e) {
               // Never mind this.
            }
         }
         if (ctx != null) {
            try {
               ctx.close();
            } catch (Exception e) {
               // Never mind this.
            }
         }
      }
      <strong>return list;</strong>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By using the Spring LDAP classes <code>AttributesMapper</code> and <code>LdapTemplate</code>, we get the exact same functionality with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
import static org.springframework.ldap.query.LdapQueryBuilder.query;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;

   public void setLdapTemplate(LdapTemplate ldapTemplate) {
      this.ldapTemplate = ldapTemplate;
   }

   public List&lt;String&gt; getAllPersonNames() {
      return ldapTemplate.search(
         <strong>query().where("objectclass").is("person")</strong>,
         new AttributesMapper&lt;String&gt;() {
            public String mapFromAttributes(Attributes attrs)
               throws NamingException {
               <strong>return attrs.get("cn").get().toString();</strong>
            }
         });
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The amount of boilerplate code is significantly less than in the traditional example.
The <code>LdapTemplate</code> search method makes sure a <code>DirContext</code> instance is created, performs the search, maps the attributes to a string using the given <code>AttributesMapper</code>,
collects the strings in an internal list, and finally returns the list. It also makes sure that the <code>NamingEnumeration</code> and <code>DirContext</code> are properly closed and
takes care of any exceptions that might happen.</p>
</div>
<div class="paragraph">
<p>Naturally&#8201;&#8212;&#8201;this being a Spring Framework sub-project&#8201;&#8212;&#8201;we will use Spring to configure our application&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:ldap="http://www.springframework.org/schema/ldap"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/ldap http://www.springframework.org/schema/ldap/spring-ldap.xsd"&gt;

   &lt;ldap:context-source
          url="ldap://localhost:389"
          base="dc=example,dc=com"
          username="cn=Manager"
          password="secret" /&gt;

   &lt;ldap:ldap-template id="ldapTemplate" /&gt;

   &lt;bean id="personRepo" class="com.example.repo.PersonRepoImpl"&gt;
      &lt;property name="ldapTemplate" ref="ldapTemplate" /&gt;
   &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to use the custom XML namespace for configuring the Spring LDAP components you need to include references to this namespace in your XML declaration as in the example above.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="what-s-new-in-2-2"><a class="anchor" href="#what-s-new-in-2-2"></a>1.3. What&#8217;s new in 2.2?</h3>
<div class="paragraph">
<p>For complete details of 2.2 refer to the changelog <a href="https://github.com/spring-projects/spring-ldap/milestone/21?closed=1">2.2.0.RC1</a>.
The highlights of Spring LDAP 2.2 can be found below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/issues/415">#415</a> - Support Spring 5</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/pull/399">#399</a> - Embedded UnboundID LDAP Server support</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/pull/410">#410</a> - Add documentation for the Commons Pool 2 Support</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="what-s-new-in-2-1"><a class="anchor" href="#what-s-new-in-2-1"></a>1.4. What&#8217;s new in 2.1?</h3>
<div class="paragraph">
<p>For complete details of 2.1 refer to the changelog <a href="https://github.com/spring-projects/spring-ldap/issues?q=milestone%3A2.1.0.RC1">2.1.0.RC1</a> and <a href="https://github.com/spring-projects/spring-ldap/issues?utf8=%E2%9C%93&amp;q=milestone%3A2.1.0">2.1.0</a>
The highlights of Spring LDAP 2.1 can be found below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/pull/390">#390</a> - Spring Data Hopper Support</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/issues/351">#351</a> - Support for commons-pool2</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/issues/370">#370</a> - Support property placeholders in XML Namespace</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/pull/392">#392</a> - Document Testing Support</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-ldap/pull/400">#401</a> - Switch to assertj</p>
</li>
<li>
<p>Migrated from JIRA to <a href="https://github.com/spring-projects/spring-ldap/issues">GitHub Issues</a></p>
</li>
<li>
<p>Added <a href="https://gitter.im/spring-projects/spring-ldap">Gitter Chat</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="what-s-new-in-2-0"><a class="anchor" href="#what-s-new-in-2-0"></a>1.5. What&#8217;s new in 2.0?</h3>
<div class="paragraph">
<p>While quite significant modernizations have been made to the Spring LDAP API in version 2.0, great care has been taken to ensure backward compatibility as far as possible.
Code that works with Spring LDAP 1.3.x should with very few exceptions still compile and run using the 2.0 libraries without any modifications whatsoever.</p>
</div>
<div class="paragraph">
<p>The exception is a small number of classes that have been moved to new packages in order to make a couple of important refactorings possible.
The moved classes are typically not part of the intended public API, and the migration procedure should be very smooth - wherever a Spring LDAP class cannot be found after upgrade, just organize the imports in your IDE.</p>
</div>
<div class="paragraph">
<p>You will probably encounter some deprecation warnings though, and there are also a lot of other API improvements.
The recommendation for getting as much as possible out of the 2.0 version is to move away from the deprecated classes and methods and migrate to the new, improved API utilities.</p>
</div>
<div class="paragraph">
<p>Below is a list of the most important changes in Spring LDAP 2.0.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 6 is now required by Spring LDAP. Spring versions starting at 2.0 and up are still supported.</p>
</li>
<li>
<p>The central API has been updated with Java 5+ features such as generics and varargs.
As a consequence, the entire <code>spring-ldap-tiger</code> module has been deprecated and users are encouraged to migrate to use the core Spring LDAP classes.
The parameterization of the core interfaces will cause lots of compilation warnings on existing code, and users of the API are encouraged to take appropriate action to get rid of these warnings.</p>
</li>
<li>
<p>The ODM (Object-Directory Mapping) functionality has been moved to core and there are new methods in <code>LdapOperations</code>/<code>LdapTemplate</code> that use this automatic translation to/from ODM-annotated classes. See <a href="#odm">Object-Directory Mapping (ODM)</a> for more information.</p>
</li>
<li>
<p>A custom XML namespace is now (finally) provided to simplify configuration of Spring LDAP. See <a href="#configuration">Configuration</a> for more information.</p>
</li>
<li>
<p>Spring Data Repository and QueryDSL support is now provided in Spring LDAP. See <a href="#repositories">Spring LDAP Repositories</a> for more information.</p>
</li>
<li>
<p><code>Name</code> instances as attribute values are now handled properly with regards to distinguished name equality in <code>DirContextAdapter</code> and ODM.
See <a href="#dns-as-attribute-values">DirContextAdapter and Distinguished Names as Attribute Values.</a> and <a href="#odm-dn-attributes">ODM and Distinguished Names as Attribute Values.</a> for more information.</p>
</li>
<li>
<p><code>DistinguishedName</code> and associated classes have been deprecated in favor of standard Java <code>LdapName</code>.
See <a href="#ldap-names">Dynamically Building Distinguished Names</a> for information on how the library helps working with <code>LdapNames</code>.</p>
</li>
<li>
<p>Fluent LDAP query building support has been added. This makes for a more pleasant programming experience when working with LDAP searches in Spring LDAP.
See <a href="#basic-queries">Building LDAP Queries</a> and <a href="#query-builder-advanced">Advanced LDAP Queries</a> for more information about the LDAP query builder support.</p>
</li>
<li>
<p>The old <code>authenticate</code> methods in <code>LdapTemplate</code> have been deprecated in favor of a couple of new <code>authenticate</code> methods that work with <code>LdapQuery</code> objects and <em>throw exceptions</em> on authentication failure, making it easier for the user to find out what caused an authentication attempt to fail.</p>
</li>
<li>
<p>The <a href="https://github.com/spring-projects/spring-ldap/tree/master/samples">samples</a> have been polished and updated to make use of the features in 2.0.
Quite a bit of effort has been put into providing a useful example of an <a href="https://github.com/spring-projects/spring-ldap/tree/master/samples/user-admin">LDAP user management application</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="packaging-overview"><a class="anchor" href="#packaging-overview"></a>1.6. Packaging overview</h3>
<div class="paragraph">
<p>At a minimum, to use Spring LDAP you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>spring-ldap-core</em> (the Spring LDAP library)</p>
</li>
<li>
<p><em>spring-core</em> (miscellaneous utility classes used internally by the framework)</p>
</li>
<li>
<p><em>spring-beans</em> (contains interfaces and classes for manipulating Java beans)</p>
</li>
<li>
<p><em>spring-data-commons</em> (base infrastructure for repository suppport, etc.)</p>
</li>
<li>
<p><em>slf4j</em> (a simple logging facade, used internally)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to the required dependencies the following optional dependencies are required for certain functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>spring-context</em> (If your application is wired up using the Spring Application Context -  adds the ability for application objects to obtain resources using a consistent API. Definitely needed if you are  planning on using the BaseLdapPathBeanPostProcessor.)</p>
</li>
<li>
<p><em>spring-tx</em> (If you are planning to use the client side compensating transaction support)</p>
</li>
<li>
<p><em>spring-jdbc</em> (If you are planning to use the client side compensating transaction support)</p>
</li>
<li>
<p><em>commons-pool</em> (If you are planning to use the pooling functionality)</p>
</li>
<li>
<p><em>spring-batch</em> (If you are planning to use the LDIF parsing functionality together with Spring Batch)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="getting-started"><a class="anchor" href="#getting-started"></a>1.7. Getting Started</h3>
<div class="paragraph">
<p>The <a href="https://github.com/spring-projects/spring-ldap/tree/master/samples">samples</a> provide some useful examples on how to use Spring LDAP for common usecases.</p>
</div>
</div>
<div class="sect2">
<h3 id="support"><a class="anchor" href="#support"></a>1.8. Support</h3>
<div class="paragraph">
<p>The community support forum is located at <a href="http://forum.spring.io/forum/spring-projects/data/ldap" class="bare">http://forum.spring.io/forum/spring-projects/data/ldap</a>, and the project web page is <a href="http://spring.io/spring-ldap/" class="bare">http://spring.io/spring-ldap/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="acknowledgements"><a class="anchor" href="#acknowledgements"></a>1.9. Acknowledgements</h3>
<div class="paragraph">
<p>The initial effort when starting the Spring LDAP project was sponsored by <a href="http://www.jayway.com">Jayway</a>.
Current maintenance of the project is funded by <a href="http://www.gopivotal.com">Pivotal</a></p>
</div>
<div class="paragraph">
<p>Thanks to <a href="http://structure101.com/">Structure101</a> for providing an open source license that has come in handy for keeping the project structure in check.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-usage"><a class="anchor" href="#basic-usage"></a>2. Basic Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="search-and-lookup-using-attributesmapper"><a class="anchor" href="#search-and-lookup-using-attributesmapper"></a>2.1. Search and Lookup Using AttributesMapper</h3>
<div class="paragraph">
<p>In this example we will use an <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/core/AttributesMapper.html"><code>AttributesMapper</code></a> to easily build a List of all common names of all person objects.</p>
</div>
<div class="listingblock">
<div class="title">AttributesMapper that returns a single attribute</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
import static org.springframework.ldap.query.LdapQueryBuilder.query;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;

   public void setLdapTemplate(LdapTemplate ldapTemplate) {
      this.ldapTemplate = ldapTemplate;
   }

   public List&lt;String&gt; getAllPersonNames() {
      return ldapTemplate.search(
         query().where("objectclass").is("person"),
         <strong>new AttributesMapper&lt;String&gt;() {
            public String mapFromAttributes(Attributes attrs)
               throws NamingException {
               return (String) attrs.get("cn").get();
            }
         });
   }</strong>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The inline implementation of <code>AttributesMapper</code> just gets the desired attribute value from the <code>Attributes</code> and returns it. Internally, <code>LdapTemplate</code> iterates over all entries found, calling the given <code>AttributesMapper</code> for each entry, and collects the results in a list. The list is then returned by the <code>search</code> method.</p>
</div>
<div class="paragraph">
<p>Note that the <code>AttributesMapper</code> implementation could easily be modified to return a full <code>Person</code> object:</p>
</div>
<div class="listingblock">
<div class="title">AttributesMapper that returns a Person object</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
import static org.springframework.ldap.query.LdapQueryBuilder.query;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   <strong>private class PersonAttributesMapper implements AttributesMapper&lt;Person&gt; {
      public Person mapFromAttributes(Attributes attrs) throws NamingException {
         Person person = new Person();
         person.setFullName((String)attrs.get("cn").get());
         person.setLastName((String)attrs.get("sn").get());
         person.setDescription((String)attrs.get("description").get());
         return person;
      }
   }</strong>

   public List&lt;Person&gt; getAllPersons() {
      return ldapTemplate.search(query()
          .where("objectclass").is("person"), <strong>new PersonAttributesMapper()</strong>);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Entries in LDAP are uniquely identified by their distinguished name (DN).
If you have the DN of an entry, you can retrieve the entry directly without searching for it.
This is called a <em>lookup</em> in Java LDAP. The following example shows how a lookup for a <code>Person</code> object:</p>
</div>
<div class="listingblock">
<div class="title">A lookup resulting in a Person object</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   public Person findPerson(String dn) {
      return ldapTemplate.lookup(dn, new PersonAttributesMapper());
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will look up the specified dn and pass the found attributes to the supplied <code>AttributesMapper</code>, in this case resulting in a <code>Person</code> object.</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-queries"><a class="anchor" href="#basic-queries"></a>2.2. Building LDAP Queries</h3>
<div class="paragraph">
<p>LDAP searches involve a number of parameters, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base LDAP path - where in the LDAP tree should the search start.</p>
</li>
<li>
<p>Search scope - how deep in the LDAP tree should the search go.</p>
</li>
<li>
<p>Attributes to return</p>
</li>
<li>
<p>Search filter - The criteria to use when selecting elements within scope.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring LDAP provides an <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/query/LdapQueryBuilder.html"><code>LdapQueryBuilder</code></a> with a fluent API for building LDAP Queries.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say that we want to perform a search starting at the base DN <code>dc=261consulting,dc=com</code>,
limiting the returned attributes to "cn" and "sn", with the filter <code>(&amp;(objectclass=person)(sn=?))</code>, where we want the <code>?</code> to be replaced with the value of the parameter <code>lastName</code>.
This is how we do it using the <code>LdapQueryBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">Building a search filter dynamically</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
<strong>import static org.springframework.ldap.query.LdapQueryBuilder.query;</strong>

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   public List&lt;String&gt; getPersonNamesByLastName(String lastName) {

      <strong>LdapQuery query = query()
         .base("dc=261consulting,dc=com")
         .attributes("cn", "sn")
         .where("objectclass").is("person")
         .and("sn").is(lastName);</strong>

      return ldapTemplate.search(<strong>query</strong>,
         new AttributesMapper&lt;String&gt;() {
            public String mapFromAttributes(Attributes attrs)
               throws NamingException {

               return (String) attrs.get("cn").get();
            }
         });
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to simplifying building of complex search parameters, the <code>LdapQueryBuilder</code> and its associated classes also provide proper escaping of any unsafe characters in search filters. This prevents "ldap injection", where a user might use such characters to inject unwanted operations into your LDAP operations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are many overloaded methods in <code>LdapTemplate</code> for performing LDAP searches. This is in order to accommodate for as many different use cases and programming style preferences as possible. For the vast majority of use cases the ones that take an <code>LdapQuery</code> as input will be the recommended methods to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>AttributesMapper</code> is just one of the available callback interfaces to use when handling search and lookup data. See <a href="#dirobjectfactory">Simplifying Attribute Access and Manipulation with DirContextAdapter</a> for alternatives.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on the <code>LdapQueryBuilder</code> see <a href="#query-builder-advanced">Advanced LDAP Queries</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ldap-names"><a class="anchor" href="#ldap-names"></a>2.3. Dynamically Building Distinguished Names</h3>
<div class="paragraph">
<p>The standard Java implementation of Distinguished Name, <a href="http://docs.oracle.com/javase/6/docs/api/javax/naming/ldap/LdapName.html">LdapName</a>,
performs very well when it comes to parsing of Distinguished Names. However, in practical use this implementation has a number of shortcomings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>LdapName</code> implementation is mutable, which is badly suited for an object representing identity.</p>
</li>
<li>
<p>Despite its mutable nature, the API for dynamically building or modifying Distinguished Names using <code>LdapName</code> is cumbersome.
Extracting values of indexed or (particularly) named components is also a little bit awkward.</p>
</li>
<li>
<p>Many of the operations on <code>LdapName</code> throw checked Exceptions, requiring try-catch statements for situations where the error is typically fatal and cannot be repaired in a meaningful manner.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To simplify working with Distinguished Names, Spring LDAP provides an <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/support/LdapNameBuilder.html"><code>LdapNameBuilder</code></a>,
as well as a number of utility methods in <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/support/LdapUtils.html"><code>LdapUtils</code></a> that helps working with <code>LdapName</code>.</p>
</div>
<div class="sect3">
<h4 id="examples"><a class="anchor" href="#examples"></a>2.3.1. Examples</h4>
<div class="listingblock">
<div class="title">Dynamically building an LdapName using LdapNameBuilder</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
import org.springframework.ldap.support.LdapNameBuilder;
import javax.naming.Name;

public class PersonRepoImpl implements PersonRepo {
  public static final String BASE_DN = "dc=example,dc=com";

  protected Name buildDn(Person p) {
    <strong>return LdapNameBuilder.newInstance(BASE_DN)
      .add("c", p.getCountry())
      .add("ou", p.getCompany())
      .add("cn", p.getFullname())
      .build();</strong>
  }
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that a Person has the following attributes:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Attribute Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>country</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sweden</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>company</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some Company</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fullname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some Person</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The code above would then result in the following distinguished name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>cn=Some Person, ou=Some Company, c=Sweden, dc=example, dc=com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Extracting values from a distinguished name using LdapUtils</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
import org.springframework.ldap.support.LdapNameBuilder;
import javax.naming.Name;
public class PersonRepoImpl implements PersonRepo {
...
protected Person buildPerson(Name dn, Attributes attrs) {
  Person person = new Person();
  person.setCountry(<strong>LdapUtils.getStringValue(dn, "c")</strong>);
  person.setCompany(<strong>LdapUtils.getStringValue(dn, "ou")</strong>);
  person.setFullname(<strong>LdapUtils.getStringValue(dn, "cn")</strong>);
  // Populate rest of person object using attributes.

  return person;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Java version &lt;= 1.4 didn&#8217;t provide any public Distinguished Name implementation at all, Spring LDAP 1.x provided its own implementation, <code>DistinguishedName</code>.
This implementation suffered from a couple of shortcomings of its own, and has been deprecated in version 2.0. Users are now recommended to use <code>LdapName</code> along with the utilities described above instead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="binding-and-unbinding"><a class="anchor" href="#binding-and-unbinding"></a>2.4. Binding and Unbinding</h3>
<div class="sect3">
<h4 id="basic-binding-data"><a class="anchor" href="#basic-binding-data"></a>2.4.1. Adding Data</h4>
<div class="paragraph">
<p>Inserting data in Java LDAP is called binding. This is somewhat confusing, because in LDAP terminology 'bind' means something completely different.
A JNDI bind performs an LDAP Add operation, associating a new entry with a specified distinguished name with a set of attributes.
The following example shows how data is added using <code>LdapTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding data using Attributes</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   public void create(Person p) {
      Name dn = buildDn(p);
      <strong>ldapTemplate.bind(dn, null, buildAttributes(p));</strong>
   }

   private Attributes buildAttributes(Person p) {
      Attributes attrs = new BasicAttributes();
      BasicAttribute ocattr = new BasicAttribute("objectclass");
      ocattr.add("top");
      ocattr.add("person");
      attrs.put(ocattr);
      attrs.put("cn", "Some Person");
      attrs.put("sn", "Person");
      return attrs;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Manual Attributes building is&#8201;&#8212;&#8201;while dull and verbose&#8201;&#8212;&#8201;sufficient for many purposes. It is however possible to simplify the binding operation further, as described in <a href="#dirobjectfactory">Simplifying Attribute Access and Manipulation with DirContextAdapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="removing-data"><a class="anchor" href="#removing-data"></a>2.4.2. Removing Data</h4>
<div class="paragraph">
<p>Removing data in Java LDAP is called unbinding.
A JNDI unbind performs an LDAP Delete operation, removing the entry associated with a distinguished name from the LDAP tree.
The following example shows how data is removed using <code>LdapTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="title">Removing data</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   public void delete(Person p) {
      Name dn = buildDn(p);
      <strong>ldapTemplate.unbind(dn);</strong>
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating"><a class="anchor" href="#updating"></a>2.5. Updating</h3>
<div class="paragraph">
<p>In Java LDAP, data can be modified in two ways: either using <code>rebind</code> or <code>modifyAttributes</code>.</p>
</div>
<div class="sect3">
<h4 id="updating-using-rebind"><a class="anchor" href="#updating-using-rebind"></a>2.5.1. Updating using rebind</h4>
<div class="paragraph">
<p>A <code>rebind</code> is a very crude way to modify data. It&#8217;s basically an <code>unbind</code> followed by a <code>bind</code>.
The following example demonstrates the use of <code>rebind</code>:</p>
</div>
<div class="listingblock">
<div class="title">Modifying using rebind</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   public void update(Person p) {
      Name dn = buildDn(p);
      <strong>ldapTemplate.rebind(dn, null, buildAttributes(p));</strong>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="modify-modifyAttributes"><a class="anchor" href="#modify-modifyAttributes"></a>2.5.2. Updating using modifyAttributes</h4>
<div class="paragraph">
<p>A more sophisticated way of modifying data is to use <code>modifyAttributes</code>. This operation takes an array of explicit attribute modifications
and performs these on a specific entry:</p>
</div>
<div class="listingblock">
<div class="title">Modifying using modifyAttributes</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;
   ...
   public void updateDescription(Person p) {
      Name dn = buildDn(p);
      Attribute attr = new BasicAttribute("description", p.getDescription())
      ModificationItem item = new ModificationItem(DirContext.REPLACE_ATTRIBUTE, attr);
      <strong>ldapTemplate.modifyAttributes(dn, new ModificationItem[] {item});</strong>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Building <code>Attributes</code> and <code>ModificationItem</code> arrays is a lot of work, but as you will see in <a href="#dirobjectfactory">Simplifying Attribute Access and Manipulation with DirContextAdapter</a>
Spring LDAP provides more help for simplifying these operations.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dirobjectfactory"><a class="anchor" href="#dirobjectfactory"></a>3. Simplifying Attribute Access and Manipulation with DirContextAdapter</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-2"><a class="anchor" href="#introduction-2"></a>3.1. Introduction</h3>
<div class="paragraph">
<p>A little-known&#8201;&#8212;&#8201;and probably underestimated&#8201;&#8212;&#8201;feature of the Java LDAP API is the ability to register a <code>DirObjectFactory</code> to automatically create objects from found LDAP entries.
Spring LDAP makes use of this feature to return <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/core/DirContextAdapter.html"><code>DirContextAdapter</code></a> instances in certain search and lookup operations.</p>
</div>
<div class="paragraph">
<p><code>DirContextAdapter</code> is a very useful tool for working with LDAP attributes, particularly when adding or modifying data.</p>
</div>
</div>
<div class="sect2">
<h3 id="search-and-lookup-using-contextmapper"><a class="anchor" href="#search-and-lookup-using-contextmapper"></a>3.2. Search and Lookup Using ContextMapper</h3>
<div class="paragraph">
<p>Whenever an entry is found in the LDAP tree, its attributes and Distinguished Name (DN) will be used by Spring LDAP to construct a <code>DirContextAdapter</code>.
This enables us to use a <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/core/ContextMapper.html"><code>ContextMapper</code></a> instead of an <code>AttributesMapper</code>
to transform found values:</p>
</div>
<div class="listingblock">
<div class="title">Searching using a ContextMapper</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   ...
   <strong>private static class PersonContextMapper implements ContextMapper {
      public Object mapFromContext(Object ctx) {
         DirContextAdapter context = (DirContextAdapter)ctx;
         Person p = new Person();
         p.setFullName(context.getStringAttribute("cn"));
         p.setLastName(context.getStringAttribute("sn"));
         p.setDescription(context.getStringAttribute("description"));
         return p;
      }
   }</strong>

   public Person findByPrimaryKey(
      String name, String company, String country) {
      Name dn = buildDn(name, company, country);
      return ldapTemplate.lookup(dn, <strong>new PersonContextMapper()</strong>);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A shown above, we can retrieve the attribute values directly by name without having to go through the <code>Attributes</code> and <code>Attribute</code> classes.
This is particularly useful when working with multi-value attributes.
Extracting values from multi-value attributes normally requires looping through a <code>NamingEnumeration</code> of attribute values returned from the <code>Attributes</code> implementation.
<code>DirContextAdapter</code> does this for you
in the <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/core/DirContextAdapter.html#getStringAttributes(java.lang.String)"><code>getStringAttributes()</code></a>
or <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/core/DirContextAdapter.html#getObjectAttributes(java.lang.String)"><code>getObjectAttributes()</code></a> methods:</p>
</div>
<div class="listingblock">
<div class="title">Getting multi-value attribute values using getStringAttributes()</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private static class PersonContextMapper implements ContextMapper {
   public Object mapFromContext(Object ctx) {
      DirContextAdapter context = (DirContextAdapter)ctx;
      Person p = new Person();
      p.setFullName(context.getStringAttribute("cn"));
      p.setLastName(context.getStringAttribute("sn"));
      p.setDescription(context.getStringAttribute("description"));
      // The roleNames property of Person is an String array
      <strong>p.setRoleNames(context.getStringAttributes("roleNames"));</strong>
      return p;
   }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="the-abstractcontextmapper"><a class="anchor" href="#the-abstractcontextmapper"></a>3.2.1. The AbstractContextMapper</h4>
<div class="paragraph">
<p>Spring LDAP provides an abstract base implementation of <code>ContextMapper</code>,  <a href="http://docs.spring.io/spring-ldap/docs/current/apidocs/org/springframework/ldap/core/support/AbstractContextMapper.html"><code>AbstractContextMapper</code></a>.
This implementation automatically takes care of the casting of the supplied <code>Object</code> parameter to <code>DirContexOperations</code>.
Using <code>AbstractContextMapper</code>, the <code>PersonContextMapper</code> above can thus be re-written as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using an AbstractContextMapper</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private static class PersonContextMapper <strong>extends AbstractContextMapper</strong> {
  public Object <strong>doMapFromContext</strong>(DirContextOperations ctx) {
     Person p = new Person();
     p.setFullName(context.getStringAttribute("cn"));
     p.setLastName(context.getStringAttribute("sn"));
     p.setDescription(context.getStringAttribute("description"));
     return p;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-and-updating-data-using-dircontextadapter"><a class="anchor" href="#adding-and-updating-data-using-dircontextadapter"></a>3.3. Adding and Updating Data Using DirContextAdapter</h3>
<div class="paragraph">
<p>While very useful when extracting attribute values, <code>DirContextAdapter</code> is even more powerful for managing the details
involved in adding and updating data.</p>
</div>
<div class="sect3">
<h4 id="adding"><a class="anchor" href="#adding"></a>3.3.1. Adding</h4>
<div class="paragraph">
<p>Below is an example making use of <code>DirContextAdapter</code> to implement an improved implementation of the <code>create</code> repository method presented in <a href="#basic-binding-data">Adding Data</a>.</p>
</div>
<div id="example-binding-contextmapper" class="listingblock">
<div class="title">Binding using DirContextAdapter</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   ...
   public void create(Person p) {
      Name dn = buildDn(p);
      DirContextAdapter context = new DirContextAdapter(dn);

      <strong>context.setAttributeValues("objectclass", new String[] {"top", "person"});
      context.setAttributeValue("cn", p.getFullname());
      context.setAttributeValue("sn", p.getLastname());
      context.setAttributeValue("description", p.getDescription());</strong>

      ldapTemplate.bind(context);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we use the <code>DirContextAdapter</code> instance  as the second parameter to bind, which should be a <code>Context</code>.
The third parameter is <code>null</code>, since we are not specifying the attributes explicitly.</p>
</div>
<div class="paragraph">
<p>Also note the use of the <code>setAttributeValues()</code> method when setting the <code>objectclass</code> attribute values.
The <code>objectclass</code> attribute is multi-value, and similar to the troubles of extracting muti-value attribute data,
building multi-value attributes is tedious and verbose work. Using the <code>setAttributeValues()</code> mehtod you can have <code>DirContextAdapter</code> handle that work for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="updating-2"><a class="anchor" href="#updating-2"></a>3.3.2. Updating</h4>
<div class="paragraph">
<p>We previously saw that updating using <code>modifyAttributes</code> is the recommended approach, but that this requires us to perform
the task of calculating attribute modifications and constructing <code>ModificationItem</code> arrays accordingly.
<code>DirContextAdapter</code> can do all of this for us:</p>
</div>
<div id="modify-modifyAttributes" class="listingblock">
<div class="title">Updating using using DirContextAdapter</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   ...
   public void update(Person p) {
      Name dn = buildDn(p);
      <strong>DirContextOperations context = ldapTemplate.lookupContext(dn);</strong>

      context.setAttributeValue("cn", p.getFullname());
      context.setAttributeValue("sn", p.getLastname());
      context.setAttributeValue("description", p.getDescription());

      <strong>ldapTemplate.modifyAttributes(context);</strong>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When no mapper is passed to a <code>ldapTemplate.lookup()</code>, the result will be a <code>DirContextAdapter</code> instance.
While the <code>lookup</code> method returns an <code>Object</code>, the convenience method <code>lookupContext</code> method automatically casts the return value to a <code>DirContextOperations</code>
(the interface that <code>DirContextAdapter</code> implements).</p>
</div>
<div class="paragraph">
<p>The observant reader will see that we have duplicated code in the <code>create</code> and <code>update</code> methods. This code maps from a domain object to a context. It can be extracted to a separate method:</p>
</div>
<div class="listingblock">
<div class="title">Adding and modifying using DirContextAdapter</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;

   ...
   public void create(Person p) {
      Name dn = buildDn(p);
      DirContextAdapter context = new DirContextAdapter(dn);

      context.setAttributeValues("objectclass", new String[] {"top", "person"});
      mapToContext(p, context);
      ldapTemplate.bind(context);
   }

   public void update(Person p) {
      Name dn = buildDn(p);
      DirContextOperations context = ldapTemplate.lookupContext(dn);
      mapToContext(person, context);
      ldapTemplate.modifyAttributes(context);
   }

   protected void mapToContext (Person p, DirContextOperations context) {
      context.setAttributeValue("cn", p.getFullName());
      context.setAttributeValue("sn", p.getLastName());
      context.setAttributeValue("description", p.getDescription());
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dns-as-attribute-values"><a class="anchor" href="#dns-as-attribute-values"></a>3.4. DirContextAdapter and Distinguished Names as Attribute Values.</h3>
<div class="paragraph">
<p>When managing security groups in LDAP it is very common to have attribute values that represent
distinguished names. Since distinguished name equality differs from String equality (e.g. whitespace and case differences
are ignored in distinguished name equality), calculating attribute modifications using string equality will not work as expected.</p>
</div>
<div class="paragraph">
<p>For instance, if a <code>member</code> attribute has the value <code>cn=John Doe,ou=People</code> and we call <code>ctx.addAttributeValue("member", "CN=John Doe, OU=People")</code>,
the attribute will now be considered to have two values, even though the strings actually represent the same
distinguished name.</p>
</div>
<div class="paragraph">
<p>As of Spring LDAP 2.0, supplying <code>javax.naming.Name</code> instances to the attribute modification methods will make <code>DirContextAdapter</code>
use distinguished name equality when calculating attribute modifications. If we modify the example above to:
<code>ctx.addAttributeValue("member", LdapUtils.newLdapName("CN=John Doe, OU=People"))</code>, this will <strong>not</strong> render a modification.</p>
</div>
<div class="listingblock">
<div class="title">Group Membership Modification using DirContextAdapter</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class GroupRepo implements BaseLdapNameAware {
    private LdapTemplate ldapTemplate;
    private LdapName baseLdapPath;

    public void setLdapTemplate(LdapTemplate ldapTemplate) {
        this.ldapTemplate = ldapTemplate;
    }

    public void setBaseLdapPath(LdapName baseLdapPath) {
        this.setBaseLdapPath(baseLdapPath);
    }

    public void addMemberToGroup(String groupName, Person p) {
        Name groupDn = buildGroupDn(groupName);
        Name userDn = buildPersonDn(
            person.getFullname(),
            person.getCompany(),
            person.getCountry());

        DirContextOperation ctx = ldapTemplate.lookupContext(groupDn);
        ctx.addAttributeValue("member", userDn);

        ldapTemplate.update(ctx);
    }

    public void removeMemberFromGroup(String groupName, Person p) {
        Name groupDn = buildGroupDn(String groupName);
        Name userDn = buildPersonDn(
            person.getFullname(),
            person.getCompany(),
            person.getCountry());

        DirContextOperation ctx = ldapTemplate.lookupContext(groupDn);
        ctx.removeAttributeValue("member", userDn);

        ldapTemplate.update(ctx);
    }

    private Name buildGroupDn(String groupName) {
        return LdapNameBuilder.newInstance("ou=Groups")
            .add("cn", groupName).build();
    }

    private Name buildPersonDn(String fullname, String company, String country) {
        return LdapNameBuilder.newInstance(baseLdapPath)
            .add("c", country)
            .add("ou", company)
            .add("cn", fullname)
            .build();
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we are implementing <code>BaseLdapNameAware</code>, in order to get hold of the base LDAP path as described in <a href="#base-context-configuration">Obtaining a reference to the base LDAP path</a>.
This is necessary because distinguished names as member attribute values must always be absolute from the directory root.</p>
</div>
</div>
<div class="sect2">
<h3 id="a-complete-personrepository-class"><a class="anchor" href="#a-complete-personrepository-class"></a>3.5. A Complete PersonRepository Class</h3>
<div class="paragraph">
<p>To illustrate the usefulness of Spring LDAP and <code>DirContextAdapter</code>, below is a complete Person Repository implementation for LDAP:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;
import java.util.List;

import javax.naming.Name;
import javax.naming.NamingException;
import javax.naming.directory.Attributes;
import javax.naming.ldap.LdapName;

import org.springframework.ldap.core.AttributesMapper;
import org.springframework.ldap.core.ContextMapper;
import org.springframework.ldap.core.LdapTemplate;
import org.springframework.ldap.core.DirContextAdapter;
import org.springframework.ldap.filter.AndFilter;
import org.springframework.ldap.filter.EqualsFilter;
import org.springframework.ldap.filter.WhitespaceWildcardsFilter;

import static org.springframework.ldap.query.LdapQueryBuilder.query;

public class PersonRepoImpl implements PersonRepo {
   private LdapTemplate ldapTemplate;

   public void setLdapTemplate(LdapTemplate ldapTemplate) {
      this.ldapTemplate = ldapTemplate;
   }

   public void create(Person person) {
      DirContextAdapter context = new DirContextAdapter(buildDn(person));
      mapToContext(person, context);
      ldapTemplate.bind(context);
   }

   public void update(Person person) {
      Name dn = buildDn(person);
      DirContextOperations context = ldapTemplate.lookupContext(dn);
      mapToContext(person, context);
      ldapTemplate.modifyAttributes(context);
   }

   public void delete(Person person) {
      ldapTemplate.unbind(buildDn(person));
   }

   public Person findByPrimaryKey(String name, String company, String country) {
      Name dn = buildDn(name, company, country);
      return ldapTemplate.lookup(dn, getContextMapper());
   }

   public List findByName(String name) {
      LdapQuery query = query()
         .where("objectclass").is("person")
         .and("cn").whitespaceWildcardsLike("name");

      return ldapTemplate.search(query, getContextMapper());
   }

   public List findAll() {
      EqualsFilter filter = new EqualsFilter("objectclass", "person");
      return ldapTemplate.search(LdapUtils.emptyPath(), filter.encode(), getContextMapper());
   }

   protected ContextMapper getContextMapper() {
      return new PersonContextMapper();
   }

   protected Name buildDn(Person person) {
      return buildDn(person.getFullname(), person.getCompany(), person.getCountry());
   }

   protected Name buildDn(String fullname, String company, String country) {
      return LdapNameBuilder.newInstance()
        .add("c", country)
        .add("ou", company)
        .add("cn", fullname)
        .build();
   }

   protected void mapToContext(Person person, DirContextOperations context) {
      context.setAttributeValues("objectclass", new String[] {"top", "person"});
      context.setAttributeValue("cn", person.getFullName());
      context.setAttributeValue("sn", person.getLastName());
      context.setAttributeValue("description", person.getDescription());
   }

   private static class PersonContextMapper extends AbstractContextMapper&lt;Person&gt; {
      public Person doMapFromContext(DirContextOperations context) {
         Person person = new Person();
         person.setFullName(context.getStringAttribute("cn"));
         person.setLastName(context.getStringAttribute("sn"));
         person.setDescription(context.getStringAttribute("description"));
         return person;
      }
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In several cases the Distinguished Name (DN) of an object is constructed using properties of the object.
E.g. in the above example, the country, company and full name of the <code>Person</code> are used in the DN, which means that updating any of these properties will actually require moving the entry in the LDAP tree using the <code>rename()</code> operation in addition to updating the <code>Attribute</code> values.
Since this is highly implementation specific this is something you&#8217;ll need to keep track of yourself - either by disallowing the user to change these properties or performing the <code>rename()</code> operation in your <code>update()</code> method if needed.
Note that using <a href="#odm">Object-Directory Mapping (ODM)</a>, the the library can automatically handle this for you if you annotate your domain classes appropriately.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="odm"><a class="anchor" href="#odm"></a>4. Object-Directory Mapping (ODM)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-3"><a class="anchor" href="#introduction-3"></a>4.1. Introduction</h3>
<div class="paragraph">
<p>Object-relational mapping frameworks like Hibernate and JPA offers developers the ability to use annotations to map relational database tables to Java objects.
Spring LDAP project offers a similar ability with respect to LDAP directories through a number of methods: in <code>LdapOperations</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;T&gt; T findByDn(Name dn, Class&lt;T&gt; clazz)</code></p>
</li>
<li>
<p><code>&lt;T&gt; T findOne(LdapQuery query, Class&lt;T&gt; clazz)</code></p>
</li>
<li>
<p><code>&lt;T&gt; List&lt;T&gt; find(LdapQuery query, Class&lt;T&gt; clazz)</code></p>
</li>
<li>
<p><code>&lt;T&gt; List&lt;T&gt; findAll(Class&lt;T&gt; clazz)</code></p>
</li>
<li>
<p><code>&lt;T&gt; List&lt;T&gt; findAll(Name base, SearchControls searchControls, Class&lt;T&gt; clazz)</code></p>
</li>
<li>
<p><code>&lt;T&gt; List&lt;T&gt; findAll(Name base, Filter filter, SearchControls searchControls, Class&lt;T&gt; clazz)</code></p>
</li>
<li>
<p><code>void create(Object entry)</code></p>
</li>
<li>
<p><code>void update(Object entry)</code></p>
</li>
<li>
<p><code>void delete(Object entry)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="annotations"><a class="anchor" href="#annotations"></a>4.2. Annotations</h3>
<div class="paragraph">
<p>Entity classes managed used with the object mapping methods are required to be annotated with annotations from the <code>org.springframework.ldap.odm.annotations</code> package. The available annotations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Entry</code> - Class level annotation indicating the <code>objectClass</code> definitions to which the entity maps.<em> (required)</em></p>
</li>
<li>
<p><code>@Id</code> - Indicates the entity DN; the field declaring this attribute must be a derivative of the <code>javax.naming.Name</code> class. <em>(required)</em></p>
</li>
<li>
<p><code>@Attribute</code> - Indicates the mapping of a directory attribute to the object class field.</p>
</li>
<li>
<p><code>@DnAttribute</code> - Indicates the mapping of a dn attribute to the object class field.</p>
</li>
<li>
<p><code>@Transient</code> - Indicates the field is not persistent and should be ignored by the <code>OdmManager</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Entry</code> and <code>@Id</code> annotations are required to be declared on managed classes.
<code>@Entry</code> is used to specify which object classes the entity maps to and (optionally) the directory root of the LDAP entries represented by the class.
All object classes for which fields are mapped are required to be declared. Note that when creating new entries of the managed class,
only the declared objectclasses will be used.</p>
</div>
<div class="paragraph">
<p>In order for a directory entry to be considered a match to the managed entity, all object classes declared by the directory entry must match be declared by in the <code>@Entry</code> annotation.
For example: let&#8217;s assume that you have entries in your LDAP tree that have the objectclasses <code>inetOrgPerson,organizationalPerson,person,top</code>.
If you are only interested in changing the attributes defined in the <code>person</code> objectclass, your <code>@Entry</code> annotation can be <code>@Entry(objectClasses = { "person", "top" })</code>.
However, if you want to manage attributes defined in the <code>inetOrgPerson</code> objectclass you&#8217;ll need to use the full monty: <code>@Entry(objectClasses = { "inetOrgPerson", "organizationalPerson", "person", "top" })</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Id</code> annotation is used to map the distinguished name of the entry to a field. The field must be an instance of <code>javax.naming.Name</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Attribute</code> annotation is used to map object class fields to entity fields.
<code>@Attribute</code> is required to declare the name of the object class property to which the field maps and may optionally declare the syntax OID of the LDAP attribute, to guarantee exact matching.
<code>@Attribute</code> also provides the type declaration which allows you to indicate whether the attribute is regarded as binary based or string based by the LDAP JNDI provider.</p>
</div>
<div class="paragraph">
<p>The <code>@DnAttribute</code> annotation is used to map object class fields to and from components in the distinguished name of an entry.
Fields annotated with <code>@DnAttribute</code> will automatically be populated with the appropriate value from the distinguished name when an entry is read from the directory tree.
If the <code>index</code> attribute of all <code>@DnAttribute</code> annotations in a class is specified, the DN will also be automatically calculated when creating and updating entries.
For update scenarios, this will also automatically take care of moving entries in the tree if attributes that are part of the distinguished name have changed.</p>
</div>
<div class="paragraph">
<p>The <code>@Transient</code> annotation is used to indicate the field should be ignored by the object directory mapping and not mapped to an underlying LDAP property. Note that if a <code>@DnAttribute</code> is not to be bound to an Attribute, i.e. it is only part of the Distinguished Name and not represented by an object attibute, it must also be annotated with <code>@Transient</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="execution"><a class="anchor" href="#execution"></a>4.3. Execution</h3>
<div class="paragraph">
<p>When all components have been properly configured and annotated, the object mapping methods of <code>LdapTemplate</code> can be used as follows:</p>
</div>
<div class="listingblock">
<div class="title">Execution</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Entry(objectClasses = { "person", "top" }, base="ou=someOu")
public class Person {
   @Id
   private Name dn;

   @Attribute(name="cn")
   @DnAttribute(value="cn", index=1)
   private String fullName;

   // No @Attribute annotation means this will be bound to the LDAP attribute
   // with the same value
   private String description;

   @DnAttribute(value="ou", index=0)
   @Transient
   private String company;

   @Transient
   private String someUnmappedField;
   // ...more attributes below
}


public class OdmPersonRepo {
   @Autowired
   private LdapTemplate ldapTemplate;

   public Person create(Person person) {
      ldapTemplate.create(person);
      return person;
   }

   public Person findByUid(String uid) {
      return ldapTemplate.findOne(query().where("uid").is(uid), Person.class);
   }

   public void update(Person person) {
      ldapTemplate.update(person);
   }

   public void delete(Person person) {
      ldapTemplate.delete(person);
   }

   public List&lt;Person&gt; findAll() {
      return ldapTemplate.findAll(Person.class);
   }

   public List&lt;Person&gt; findByLastName(String lastName) {
      return ldapTemplate.find(query().where("sn").is(lastName), Person.class);
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="odm-dn-attributes"><a class="anchor" href="#odm-dn-attributes"></a>4.4. ODM and Distinguished Names as Attribute Values.</h3>
<div class="paragraph">
<p>Security groups in LDAP commonly contains a multi-value attribute where each of the values is the distinguished name
of a user in the system. The difficulties involved when handling these kinds of attributes are discussed in <a href="#dns-as-attribute-values">DirContextAdapter and Distinguished Names as Attribute Values.</a>.</p>
</div>
<div class="paragraph">
<p>ODM also has support for <code>javax.naming.Name</code> attribute values, making group modifications very easy:</p>
</div>
<div class="listingblock">
<div class="title">Example Group representation</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Entry(objectClasses = {"top", "groupOfUniqueNames"}, base = "cn=groups")
public class Group {

    @Id
    private Name dn;

    @Attribute(name="cn")
    @DnAttribute("cn")
    private String name;

    @Attribute(name="uniqueMember")
    private Set&lt;Name&gt; members;

    public Name getDn() {
        return dn;
    }

    public void setDn(Name dn) {
        this.dn = dn;
    }

    public Set&lt;Name&gt; getMembers() {
        return members;
    }

    public void setMembers(Set&lt;Name&gt; members) {
        this.members = members;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void addMember(Name member) {
        members.add(member);
    }

    public void removeMember(Name member) {
        members.remove(member);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modifying group members using <code>setMembers</code>, <code>addMember</code> and <code>removeMember</code> above, and then calling <code>ldapTemplate.update()</code>,
attribute modifications will be calculated using distinguished name equality, meaning that the text formatting of
distinguished names will be disregarded when figuring out whether they are equal.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-builder-advanced"><a class="anchor" href="#query-builder-advanced"></a>5. Advanced LDAP Queries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ldap-query-builder-parameters"><a class="anchor" href="#ldap-query-builder-parameters"></a>5.1. LDAP Query Builder Parameters</h3>
<div class="paragraph">
<p>The <code>LdapQueryBuilder</code> and its associated classes are intended to support all parameters that can be supplied to an LDAP search.
The following parameters are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>base</code> - specifies the root DN in the LDAP tree where the search should start.</p>
</li>
<li>
<p><code>searchScope</code> - specifies how deep into the LDAP tree the search should traverse.</p>
</li>
<li>
<p><code>attributes</code> - specifies the attributes to return from the search. Default is all.</p>
</li>
<li>
<p><code>countLimit</code> - specifies the maximum number of entries to return from the search.</p>
</li>
<li>
<p><code>timeLimit</code> - specifies the maximum time that the search may take.</p>
</li>
<li>
<p>Search filter - the conditions that the entries we are looking for must meet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code>LdapQueryBuilder</code> is created with a call to the <code>query</code> method of <code>LdapQueryBuilder</code>. It&#8217;s intended as a fluent builder API, where the base parameters are defined first, followed by the filter specification calls. Once filter conditions have been started to be defined with a call to the <code>where</code> method of <code>LdapQueryBuilder</code>, later attempts to call e.g. <code>base</code> will be rejected. The base search parameters are optional, but at least one filter specification call is required.</p>
</div>
<div class="listingblock">
<div class="title">Search for all entries with objectclass person</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import static org.springframework.ldap.query.LdapQueryBuilder.query;
...

List&lt;Person&gt; persons = ldapTemplate.search(
      query().where("objectclass").is("person"),
      new PersonAttributesMapper());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Search for all entries with objectclass person and cn=John Doe</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import static org.springframework.ldap.query.LdapQueryBuilder.query;
...

List&lt;Person&gt; persons = ldapTemplate.search(
      query().where("objectclass").is("person")
             .and("cn").is("John Doe"),
      new PersonAttributesMapper());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Search for all entries with objectclass person starting at dc=261consulting,dc=com</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import static org.springframework.ldap.query.LdapQueryBuilder.query;
...

List&lt;Person&gt; persons = ldapTemplate.search(
      query().base("dc=261consulting,dc=com")
             .where("objectclass").is("person"),
      new PersonAttributesMapper());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Search for all entries with objectclass person starting at dc=261consulting,dc=com, only returning the cn attribute</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import static org.springframework.ldap.query.LdapQueryBuilder.query;
...

List&lt;Person&gt; persons = ldapTemplate.search(
      query().base("dc=261consulting,dc=com")
             .attributes("cn")
             .where("objectclass").is("person"),
      new PersonAttributesMapper());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Search with or criteria</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import static org.springframework.ldap.query.LdapQueryBuilder.query;
...
List&lt;Person&gt; persons = ldapTemplate.search(
      query().where("objectclass").is("person"),
             .and(query().where("cn").is("Doe").or("cn").is("Doo));
      new PersonAttributesMapper());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="filter-criteria"><a class="anchor" href="#filter-criteria"></a>5.2. Filter Criteria</h3>
<div class="paragraph">
<p>The examples above demonstrates simple equals conditions in LDAP filters. The LDAP query builder has support for the following criteria types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>is</code> - specifies an equals condition (=).</p>
</li>
<li>
<p><code>gte</code> - specifies a greater than or equals condition (&gt;=).</p>
</li>
<li>
<p><code>lte</code> - specifies a less than or equals condition (&lt; =).</p>
</li>
<li>
<p><code>like</code> - specifies a "like" condition where wildcards can be included in the query, e.g. <code>where("cn").like("J*hn Doe")</code> will result int the filter <code>(cn=J*hn Doe)</code>.</p>
</li>
<li>
<p><code>whitespaceWildcardsLike</code> - specifies a condition where all whitespace is replaced with wildcards, e.g. <code>where("cn").whitespaceWildcardsLike("John Doe")</code> will result in the filter <code>(cn=<strong>John*Doe</strong>)</code>.</p>
</li>
<li>
<p><code>isPresent</code> - specifies condition that checks for the presence of an attribute, e.g. <code>where("cn").isPresent()</code> will result in the filter <code>(cn=*)</code>.</p>
</li>
<li>
<p><code>not</code> - specifies that the current condition should be negated, e.g. <code>where("sn").not().is("Doe)</code> will result in the filter <code>(!(sn=Doe))</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hardcoded-filters"><a class="anchor" href="#hardcoded-filters"></a>5.3. Hardcoded Filters</h3>
<div class="paragraph">
<p>There are occasions when you will want to specify a hardcoded filter as input to an <code>LdapQuery</code>. <code>LdapQueryBuilder</code> has two methods for this purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>filter(String hardcodedFilter)</code> - uses the specified string as filter. Note that the specified input string will not be touched in any way, meaning that this method is not particularly well suited if you are building filters from user input.</p>
</li>
<li>
<p><code>filter(String filterFormat, String&#8230;&#8203; params)</code> - uses the specified string as input to <code>MessageFormat</code>, properly encoding the parameters and inserting them at the specified places in the filter string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You cannot mix the hardcoded filter methods with the <code>where</code> approach described above; it&#8217;s either one or the other. What this means is that if you specified a filter using <code>filter()</code> you will get an exception if you try to call <code>where</code> afterwards.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>6. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-4"><a class="anchor" href="#introduction-4"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>The recommended way of configuring Spring LDAP is using the custom XML configuration namespace. In order to make this available you need to include the Spring LDAP namespace declaration in your bean file, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       <strong>xmlns:ldap="http://www.springframework.org/schema/ldap"</strong>
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       <strong>http://www.springframework.org/schema/ldap http://www.springframework.org/schema/ldap/spring-ldap.xsd</strong>"&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contextsource-configuration"><a class="anchor" href="#contextsource-configuration"></a>6.2. ContextSource Configuration</h3>
<div class="paragraph">
<p>The <code>ContextSource</code> is defined using a <code>&lt;ldap:context-source&gt;</code> tag.
The simplest possible <code>context-source</code> declaration requires you to specify a server url, a username, and a password:</p>
</div>
<div class="listingblock">
<div class="title">Simplest possible context-source declaration</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">&lt;ldap:context-source
    username="cn=Administrator"
    password="secret"
    url="ldap://localhost:389" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create an <code>LdapContextSource</code> with default values (see below), and the url and authentication credentials as specified.
 The configurable attributes on context-source are as follows (required attributes marked with *):</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. ContextSource Configuration Attributes</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contextSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the created bean.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username (principal) to use when authenticating with the LDAP server.
   This will usually be the distinguished name of an admin user (e.g.<code>cn=Administrator</code>), but may differ depending on server and authentication method.
   Required if <code>authentication-source-ref</code> is not explicitly configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password (credentials) to use when authenticating with the LDAP server. Required if <code>authentication-source-ref</code> is not explicitly configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code> *</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the LDAP server to use. The URL should be in the format <code>ldap://myserver.example.com:389</code>.
   For SSL access, use the <code>ldaps</code> protocol and the appropriate port, e.g. <code>ldaps://myserver.example.com:636</code>.
   If fail-over functionality is desired, more than one URL can be specified, separated using comma (,).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LdapUtils.emptyLdapName()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base DN. When this attribute has been configured, all Distinguished Names supplied to and received from LDAP operations will be relative to the specified LDAP path.
   This can significantly simplify working against the LDAP tree; however there are several occasions when you will need to have access to the base path.
   For more information on this, please refer to <a href="#base-context-configuration">Obtaining a reference to the base LDAP path</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>anonymous-read-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether read-only operations will be performed using an anonymous (unauthenticated) context.
   <strong>Note</strong> that setting this parameter to <code>true</code> together with the compensating transaction support is not supported and will be rejected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>referral</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Defines the strategy to handle referrals, as described <a href="http://docs.oracle.com/javase/jndi/tutorial/ldap/referral/jndi.html">here</a>. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ignore</code></p>
</li>
<li>
<p><code>follow</code></p>
</li>
<li>
<p><code>throw</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>native-pooling</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify whether native Java LDAP connection pooling should be used. Consider using Spring LDAP connection pooling instead. See <a href="#pooling">Pooling Support</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authentication-source-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>SimpleAuthenticationSource</code> instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the AuthenticationSource instance to use (see below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authentication-strategy-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>SimpleDirContextAuthenticationStrategy</code> instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the DirContextAuthenticationStrategy instance to use (see below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-env-props-ref</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference to a Map of custom environment properties that should supplied with the environment sent to the <code>DirContext</code> on construction.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="dircontext-authentication"><a class="anchor" href="#dircontext-authentication"></a>6.2.1. DirContext Authentication</h4>
<div class="paragraph">
<p>When <code>DirContext</code> instances are created to be used for performing operations on an LDAP server these contexts often need to be authenticated.
There are different options for configuring this using Spring LDAP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section refers to authenticating contexts in the core functionality of the <code>ContextSource</code> - to construct <code>DirContext</code> instances for use by <code>LdapTemplate</code>. LDAP is commonly used for the sole purpose of user authentication, and the <code>ContextSource</code> may be used for that as well. This process is discussed in <a href="#user-authentication">User Authentication using Spring LDAP</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Authenticated contexts are created for both read-only and read-write operations by default. You specify <code>username</code> and <code>password</code> of the LDAP user to be used for authentication on the <code>context-source</code> element.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>username</code> is the dn of an LDAP user, it needs to be the full Distinguished Name (DN) of the user from the root of the LDAP tree, regardless of whether a <code>base</code> LDAP path has been specified on the <code>context-source</code> element.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some LDAP server setups allow anonymous read-only access. If you want to use anonymous Contexts for read-only operations, set the <code>anonymous-read-only</code> attribute to <code>true</code>.</p>
</div>
<div class="sect4">
<h5 id="custom-dircontext-authentication-processing"><a class="anchor" href="#custom-dircontext-authentication-processing"></a>Custom DirContext Authentication Processing</h5>
<div class="paragraph">
<p>The default authentication mechanism used in Spring LDAP is <code>SIMPLE</code> authentication. This means that the principal (as specified to the <code>username</code> attribute) and the credentials (as specified to the <code>password</code>) are set in the Hashtable sent to the <code>DirContext</code> implementation constructor.</p>
</div>
<div class="paragraph">
<p>There are many occasions when this processing is not sufficient. For instance, LDAP Servers are commonly set up to only accept communication on a secure TLS channel; there might be a need to use the particular LDAP Proxy Auth mechanism, etc.</p>
</div>
<div class="paragraph">
<p>It is possible to specify an alternative authentication mechanism by supplying a <code>DirContextAuthenticationStrategy</code> implementation reference to the <code>context-source</code> element using the <code>authentication-strategy-ref</code> attribute.</p>
</div>
<div class="sect5">
<h6 id="tls"><a class="anchor" href="#tls"></a>TLS</h6>
<div class="paragraph">
<p>Spring LDAP provides two different configuration options for LDAP servers requiring TLS secure channel communication: <code>DefaultTlsDirContextAuthenticationStrategy</code> and <code>ExternalTlsDirContextAuthenticationStrategy</code>.
Both these implementations will negotiate a TLS channel on the target connection, but they differ in the actual authentication mechanism.
Whereas the <code>DefaultTlsDirContextAuthenticationStrategy</code> will apply SIMPLE authentication on the secure channel (using the specified <code>username</code> and <code>password</code>), the <code>ExternalTlsDirContextAuthenticationStrategy</code> will use EXTERNAL SASL authentication, applying a client certificate configured using system properties for authentication.</p>
</div>
<div class="paragraph">
<p>Since different LDAP server implementations respond differently to explicit shutdown of the TLS channel (some servers require the connection be shutdown gracefully; others do not support it), the TLS <code>DirContextAuthenticationStrategy</code> implementations support specifying the shutdown behavior using the <code>shutdownTlsGracefully</code> parameter. If this property is set to <code>false</code> (the default), no explicit TLS shutdown will happen; if it is <code>true</code>, Spring LDAP will try to shutdown the TLS channel gracefully before closing the target context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When working with TLS connections you need to make sure that the native LDAP Pooling functionality (as specified using the <code>native-pooling</code> attribute is turned off. This is particularly important if <code>shutdownTlsGracefully</code> is set to <code>false</code>. However, since the TLS channel negotiation process is quite expensive, great performance benefits will be gained by using the Spring LDAP Pooling Support, described in <a href="#pooling">Pooling Support</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="custom-principal-and-credentials-managementusing-the"><a class="anchor" href="#custom-principal-and-credentials-managementusing-the"></a>Custom Principal and Credentials ManagementUsing the</h5>
<div class="paragraph">
<p>While the user name (i.e. user DN) and password used for creating an authenticated <code>Context</code> are statically defined by default - the ones defined in the <code>context-source</code> element configuration will be used throughout the lifetime of the <code>ContextSource</code> - there are several cases where this is not the desired behaviour. A common scenario is that the principal and credentials of the current user should be used when executing LDAP operations for that user. The default behaviour can be modified by supplying a reference to an <code>AuthenticationSource</code> implementation to the <code>context-source</code> element using the <code>authentication-source-ref</code> element, instead of explicitly specifying the <code>username</code> and <code>password</code>. The <code>AuthenticationSource</code> will be queried by the <code>ContextSource</code> for principal and credentials each time an authenticated <code>Context</code> is to be created.</p>
</div>
<div class="paragraph">
<p>If you are using <a href="http://spring.io/spring-security">Spring Security</a> you can make sure the principal and credentials of the currently logged in user is used at all times by configuring your <code>ContextSource</code> with an instance of the <code>SpringSecurityAuthenticationSource</code> shipped with Spring Security.</p>
</div>
<div class="listingblock">
<div class="title">Using the SpringSecurityAuthenticationSource</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">&lt;beans&gt;
...
    &lt;ldap:context-source
        url="ldap://localhost:389"
        authentication-source-ref="springSecurityAuthenticationSource/&gt;

    &lt;bean id="springSecurityAuthenticationSource"
        class="org.springframework.security.ldap.authentication.SpringSecurityAuthenticationSource" /&gt;
...
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We don&#8217;t specify any <code>username</code> or <code>password</code> to our <code>context-source</code> when using an <code>AuthenticationSource</code> - these properties are needed only when the default behaviour is used.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using the <code>SpringSecurityAuthenticationSource</code> you need to use Spring Security&#8217;s <code>LdapAuthenticationProvider</code> to authenticate the users against LDAP.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="native-java-ldap-pooling"><a class="anchor" href="#native-java-ldap-pooling"></a>6.2.2. Native Java LDAP Pooling</h4>
<div class="paragraph">
<p>The internal Java LDAP provider provides some very basic pooling capabilities. This  LDAP connection pooling can be turned on/off using the <code>pooled</code> flag on <code>AbstractContextSource</code>.  The default value is <code>false</code> (since release 1.3), i.e. the native Java LDAP pooling will be turned off. The configuration of LDAP connection pooling is managed using <code>System</code> properties, so this needs to be handled manually, outside of the Spring Context configuration. Details of the native pooling configuration can be found <a href="http://java.sun.com/products/jndi/tutorial/ldap/connect/config.html">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are several serious deficiencies in the built-in LDAP connection pooling,  which is why Spring LDAP provides a more sophisticated approach to LDAP connection pooling,  described in <a href="#pooling">Pooling Support</a>. If pooling functionality is required, this is the recommended approach.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Regardless of the pooling configuration, the <code>ContextSource#getContext(String principal, String credentials)</code> method will always explicitly <em>not</em> use native Java LDAP Pooling, in order for reset passwords to take effect as soon as possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="advanced-contextsource-configuration"><a class="anchor" href="#advanced-contextsource-configuration"></a>6.2.3. Advanced ContextSource Configuration</h4>
<div class="sect4">
<h5 id="custom-dircontext-environment-properties"><a class="anchor" href="#custom-dircontext-environment-properties"></a>Custom DirContext Environment Properties</h5>
<div class="paragraph">
<p>In some cases the user might want to specify additional environment setup properties in addition to the ones directly configurable on <code>context-source</code>. Such properties should be set in a <code>Map</code> and referenced in the <code>base-env-props-ref</code> attribute.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldaptemplate-configuration"><a class="anchor" href="#ldaptemplate-configuration"></a>6.3. LdapTemplate Configuration</h3>
<div class="paragraph">
<p>The <code>LdapTemplate</code> is defined using a <code>&lt;ldap:ldap-template&gt;</code> tag. The simplest possible <code>ldap-template</code> declaration is the simple tag:</p>
</div>
<div class="listingblock">
<div class="title">Simplest possible ldap-template declaration</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">&lt;ldap:ldap-template /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create an <code>LdapTemplate</code> instance with the default id, referencing the default <code>ContextSource</code>, which is expected to have the id <code>contextSource</code> (the default for the <code>context-source</code> element).</p>
</div>
<div class="paragraph">
<p>The configurable attributes on <code>ldap-template</code> are as follows:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. LdapTemplate Configuration Attributes</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldapTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The id of the created bean.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>context-source-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contextSource</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Id of the ContextSource instance to use.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The default count limit for searches. 0 means no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The default time limit for searches in milliseconds. 0 means no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>search-scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBTREE</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The default search scope for searches. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OBJECT</code></p>
</li>
<li>
<p><code>ONELEVEL</code></p>
</li>
<li>
<p><code>SUBTREE</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignore-name-not-found</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specifies whether NameNotFoundException should be ignored in searches. Setting this attribute to true will cause errors caused by invalid search base to be silently swallowed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignore-partial-result</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specifies whether PartialResultException should be ignored in searches. Some LDAP servers have problems with referrals; these should normally be followed automatically, but if this doesn&#8217;t work it will manifest itself with a PartialResultException. Setting this attribute to true presents a work-around to this problem.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odm-ref</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Id of the ObjectDirectoryMapper instance to use. Default is a default-configured DefaultObjectDirectoryMapper.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="base-context-configuration"><a class="anchor" href="#base-context-configuration"></a>6.4. Obtaining a reference to the base LDAP path</h3>
<div class="paragraph">
<p>As described above, a base LDAP path may be supplied to the <code>ContextSource</code>, specifying the root in the LDAP tree to which all operations will be relative. This means that you will only be working with relative distinguished names throughout your system, which is typically rather handy. There are however some cases in which you will need to have access to the base path in order to be able to construct full DNs, relative to the actual root of the LDAP tree. One example would be when working with LDAP groups (e.g. <code>groupOfNames</code> objectclass), in which case each group member attribute value will need to be the full DN of the referenced member.</p>
</div>
<div class="paragraph">
<p>For that reason, Spring LDAP has a mechanism by which any Spring controlled bean may be supplied the base path on startup.
For beans to be notified of the base path, two things need to be in place: First of all, the bean that wants the base path reference needs to implement the <code>BaseLdapNameAware</code> interface.
Secondly, a <code>BaseLdapPathBeanPostProcessor</code> needs to be defined in the application context:</p>
</div>
<div class="listingblock">
<div class="title">Implementing BaseLdapNameAware</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.service;
public class PersonService implements PersonService<strong>, BaseLdapNameAware</strong> {
   ...
   <strong>private LdapName basePath;

   public void setBaseLdapPath(LdapName basePath) {
      this.basePath = basePath;
   }</strong>
   ...
   private LdapName getFullPersonDn(Person person) {
      return LdapNameBuilder.newInstance(<strong>basePath</strong>)
          .add(person.getDn())
          .build();
   }
   ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Specifying a BaseLdapPathBeanPostProcessor in your ApplicationContext</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">&lt;beans&gt;
   ...
   &lt;ldap:context-source
          username="cn=Administrator"
          password="secret"
          url="ldap://localhost:389"
          base="dc=261consulting,dc=com" /&gt;
   ...
   <strong>&lt;bean class="org.springframework.ldap.core.support.BaseLdapPathBeanPostProcessor" /&gt;</strong>
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default behaviour of the <code>BaseLdapPathBeanPostProcessor</code> is to use the base path of the single defined <code>BaseLdapPathSource</code> (<code>AbstractContextSource</code>)in the <code>ApplicationContext</code>. If more than one <code>BaseLdapPathSource</code> is defined, you will need to specify which one to use with the <code>baseLdapPathSourceName</code> property.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repositories"><a class="anchor" href="#repositories"></a>7. Spring LDAP Repositories</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overview-2"><a class="anchor" href="#overview-2"></a>7.1. Overview</h3>
<div class="paragraph">
<p>Spring LDAP has built-in support for Spring Data repositories. The basic functionality and configuration is described <a href="http://docs.spring.io/spring-data/data-commons/docs/1.6.1.RELEASE/reference/html/repositories.html">here</a>. When working with Spring LDAP repositories, please note the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring LDAP repositories can be enabled using an <code>&lt;ldap:repositories&gt;</code> tag in your XML configuration or using an <code>@EnableLdapRepositories</code> annotation on a configuration class.</p>
</li>
<li>
<p>To include support for <code>LdapQuery</code> parameters in automatically generated repositories, have your interface extend <code>LdapRepository</code> rather than <code>CrudRepository</code>.</p>
</li>
<li>
<p>All Spring LDAP repositories must work with entities annotated with the ODM annotations, as described in <a href="#odm">Object-Directory Mapping (ODM)</a>.</p>
</li>
<li>
<p>Since all ODM managed classes must have a Distinguished Name as ID, all Spring LDAP repositories must have the ID type parameter set to <code>javax.naming.Name</code>.
Indeed, the built-in <code>LdapRepository</code> only takes one type parameter; the managed entity class, defaulting ID to <code>javax.naming.Name</code>.</p>
</li>
<li>
<p>Due to specifics of the LDAP protocol, paging and sorting is not supported for Spring LDAP repositories.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="querydsl-support"><a class="anchor" href="#querydsl-support"></a>7.2. QueryDSL support</h3>
<div class="paragraph">
<p>Basic QueryDSL support is included in Spring LDAP. This support includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An Annotation Processor, <code>LdapAnnotationProcessor</code>, for generating QueryDSL classes based on Spring LDAP ODM annotations. See <a href="#odm">Object-Directory Mapping (ODM)</a> for more information on the ODM annotations.</p>
</li>
<li>
<p>A Query implementation, <code>QueryDslLdapQuery</code>, for building and executing QueryDSL queries in code.</p>
</li>
<li>
<p>Spring Data repository support for QueryDSL predicates. <code>QueryDslPredicateExecutor</code> includes a number of additional methods with appropriate parameters; extend this interface along with <code>LdapRepository</code> to include this support in your repository.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pooling"><a class="anchor" href="#pooling"></a>8. Pooling Support</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-5"><a class="anchor" href="#introduction-5"></a>8.1. Introduction</h3>
<div class="paragraph">
<p>Pooling LDAP connections helps mitigate the overhead of creating a new LDAP connection for each LDAP interaction. While <a href="http://java.sun.com/products/jndi/tutorial/ldap/connect/pool.html">Java LDAP pooling support</a> exists it is limited in its configuration options and features, such as connection validation and pool maintenance. Spring LDAP provides support for detailed pool configuration on a per-<code>ContextSource</code> basis.</p>
</div>
<div class="paragraph">
<p>Pooling support is provided by supplying a <code>&lt;ldap:pooling /&gt;</code> sub-element to the <code>&lt;ldap:context-source /&gt;</code> element in the application context configuration. Read-only and read-write <code>DirContext</code> objects are pooled separately (if <code>anonymous-read-only</code> is specified. <a href="http://commons.apache.org/pool/index.html">Jakarta Commons-Pool</a> is used to provide the underlying pool implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="dircontext-validation"><a class="anchor" href="#dircontext-validation"></a>8.2. DirContext Validation</h3>
<div class="paragraph">
<p>Validation of pooled connections is the primary motivation for using a custom pooling library versus the JDK provided LDAP pooling functionality. Validation allows pooled <code>DirContext</code> connections to be checked to ensure they are still properly connected and configured when checking them out of the pool, in to the pool or while idle in the pool.</p>
</div>
<div class="paragraph">
<p>If connection validation is configured, pooled connections are validated using <code>DefaultDirContextValidator</code>.
<code>DefaultDirContextValidator</code> does a <code>DirContext.search(String, String, SearchControls)</code> , with an empty name, a filter of <code>"objectclass=*"</code> and <code>SearchControls</code> set to limit a single result with the only the objectclass attribute and a 500ms timeout. If the returned <code>NamingEnumeration</code> has results the <code>DirContext</code> passes validation, if no results are returned or an exception is thrown the <code>DirContext</code> fails validation.
The default settings should work with no configuration changes on most LDAP servers and provide the fastest way to validate the <code>DirContext</code>.
If customization is required this can be done using the validation configuration attributes, described below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Connections will be automatically invalidated if they throw an exception that is considered non-transient. E.g. if a <code>DirContext</code> instance throws a <code>javax.naming.CommunicationException</code>, this will be interpreted as a non-transient error and the instance will be automatically invalidated, without the overhead of an additional testOnReturn operation. The exceptions that are interpreted as non-transient are configured using the <code>nonTransientExceptions</code> property of the <code>PoolingContextSource</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pool-configuration"><a class="anchor" href="#pool-configuration"></a>8.3. Pool Configuration</h3>
<div class="paragraph">
<p>The following attributes are available on the <code>&lt;ldap:pooling /&gt;</code> element for configuration of the DirContext pool:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Pooling Configuration Attributes</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The maximum number of active connections of each type (read-only|read-write) that can be allocated from this pool at the same time, or non-positive for no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The overall maximum number of active connections (for all types) that can be allocated from this pool at the same time, or non-positive for no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-idle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The maximum number of active connections of each type (read-only|read-write) that can remain idle in the pool, without extra ones being released, or non-positive for no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-idle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The minimum number of active connections of each type (read-only|read-write) that can remain idle in the pool, without extra ones being created, or zero to create none.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-wait</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The maximum number of milliseconds that the pool will wait (when there are no available connections) for a connection to be returned before throwing an exception, or non-positive to wait indefinitely.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>when-exhausted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOCK</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specifies the behaviour when the pool is exhausted.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>FAIL</code> option will throw a <code>NoSuchElementException</code> when the pool is exhausted.</p>
</li>
<li>
<p>The <code>BLOCK</code> option will wait until a new object is available. If <code>max-wait</code> is positive a <code>NoSuchElementException</code> is thrown if no new object is available after the <code>max-wait</code> time expires.</p>
</li>
<li>
<p>The <code>GROW</code> option will create and return a new object (essentially making <code>max-active</code> meaningless).</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-on-borrow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated before being borrowed from the pool. If the object fails to validate, it will be dropped from the pool, and an attempt to borrow another will be made.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-on-return</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated before being returned to the pool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-while-idle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated by the idle object evictor (if any). If an object fails to validate, it will be dropped from the pool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eviction-run-interval-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The number of milliseconds to sleep between runs of the idle object evictor thread. When non-positive, no idle object evictor thread will be run.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tests-per-eviction-run</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The number of objects to examine during each run of the idle object evictor thread (if any).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-evictable-time-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 * 60 * 30</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The minimum amount of time an object may sit idle in the pool before it is eligible for eviction by the idle object evictor (if any).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validation-query-base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LdapUtils.emptyName()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The search base to be used when validating connections. Only used if <code>test-on-borrow</code>, <code>test-on-return</code>, or <code>test-while-idle</code> is specified</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validation-query-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>objectclass=*</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The search filter to be used when validating connections. Only used if <code>test-on-borrow</code>, <code>test-on-return</code>, or <code>test-while-idle</code> is specified</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validation-query-search-controls-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code>; default search control settings are described above.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Id of a SearchControls instance to be used when validating connections. Only used if <code>test-on-borrow</code>, <code>test-on-return</code>, or <code>test-while-idle</code> is specified</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>non-transient-exceptions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.naming.CommunicationException</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Comma-separated list of Exception classes. The listed exceptions will be considered non-transient with regards to eager invalidation. Should any of the listed exceptions (or subclasses of them) be thrown by a call to a pooled <code>DirContext</code> instance, that object will be automatically invalidated without any additional testOnReturn operation.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="pool2-configuration"><a class="anchor" href="#pool2-configuration"></a>8.4. Pool2 Configuration</h3>
<div class="paragraph">
<p>The following attributes are available on the <code>&lt;ldap:pooling2 /&gt;</code> element for configuration of the DirContext pool:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Pooling Configuration Attributes</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The overall maximum number of active connections (for all types) that can be allocated from this pool at the same time, or non-positive for no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-total-per-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The limit on the number of object instances allocated by the pool (checked out or idle), per key. When the limit is reached, the sub-pool is said to be exhausted. A negative value indicates no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-idle-per-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The maximum number of active connections of each type (read-only|read-write) that can remain idle in the pool, without extra ones being released, or non-positive for no limit.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-idle-per-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The minimum number of active connections of each type (read-only|read-write) that can remain idle in the pool, without extra ones being created, or zero to create none.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-wait</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The maximum number of milliseconds that the pool will wait (when there are no available connections) for a connection to be returned before throwing an exception, or non-positive to wait indefinitely.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>block-when-exhausted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Wait until a new object is available. If max-wait is positive a NoSuchElementException is thrown if no new object is available after the maxWait time expires.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-on-create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated before borrowing. If the object fails to validate, then borrowing will fail.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-on-borrow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated before being borrowed from the pool. If the object fails to validate, it will be dropped from the pool, and an attempt to borrow another will be made.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-on-return</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated before being returned to the pool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-while-idle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether objects will be validated by the idle object evictor (if any). If an object fails to validate, it will be dropped from the pool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eviction-run-interval-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The number of milliseconds to sleep between runs of the idle object evictor thread. When non-positive, no idle object evictor thread will be run.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tests-per-eviction-run</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The number of objects to examine during each run of the idle object evictor thread (if any).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-evictable-time-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 * 60 * 30</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The minimum amount of time an object may sit idle in the pool before it is eligible for eviction by the idle object evictor (if any).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>soft-min-evictable-time-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The minimum amount of time an object may sit idle in the pool before it is eligible for eviction by the idle object evictor , with the extra condition that at least minimum number of object instances per key remain in the pool. This settings is overridden by min-evictable-time-millis if it is set to a positive value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eviction-policy-class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.commons.pool2.impl.DefaultEvictionPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The eviction policy implementation that is used by this pool. The Pool will attempt to load the class using the thread context class loader. If that fails, the Pool will attempt to load the class using the class loader that loaded this class.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fairness</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The pool serves threads waiting to borrow connections fairly. True means that waiting threads are served as if waiting in a FIFO queue.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jmx-enable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>JMX will be enabled with the platform MBean server for the pool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jmx-name-base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The JMX name base that will be used as part of the name assigned to JMX enabled pools.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jmx-name-prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pool</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The JMX name prefix that will be used as part of the name assigned to JMX enabled pools.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lifo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The indication of whether the pool has LIFO (last in, first out) behaviour with respect to idle objects - always returning the most recently used object from the pool, or as a FIFO (first in, first out) queue, where the pool always returns the oldest object in the idle object pool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validation-query-base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LdapUtils.emptyPath()</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The base dn to use for validation searches.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validation-query-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>objectclass=*</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The filter to use for validation queries.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validation-query-search-controls-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code>; default search control settings are described above.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Id of a SearchControls instance to be used when validating connections. Only used if <code>test-on-borrow</code>, <code>test-on-return</code>, or <code>test-while-idle</code> is specified</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>non-transient-exceptions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.naming.CommunicationException</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Comma-separated list of Exception classes. The listed exceptions will be considered non-transient with regards to eager invalidation. Should any of the listed exceptions (or subclasses of them) be thrown by a call to a pooled <code>DirContext</code> instance, that object will be automatically invalidated without any additional testOnReturn operation.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="configuration-2"><a class="anchor" href="#configuration-2"></a>8.5. Configuration</h3>
<div class="paragraph">
<p>Configuring pooling requires adding an <code>&lt;ldap:pooling&gt;</code> element nested in the <code>&lt;ldap:context-source&gt;</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
   ...
    &lt;ldap:context-source
        password="secret" url="ldap://localhost:389" username="cn=Manager"&gt;
        &lt;ldap:pooling /&gt;
    &lt;/ldap:context-source&gt;
   ...
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a real world example you would probably configure the pool options and enable connection validation; the above serves as an example to demonstrate the general idea.</p>
</div>
<div class="sect3">
<h4 id="validation-configuration"><a class="anchor" href="#validation-configuration"></a>8.5.1. Validation Configuration</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
   ...
    &lt;ldap:context-source
        username="cn=Manager" password="secret" url="ldap://localhost:389" &gt;
        &lt;ldap:pooling
            test-on-borrow="true"
            test-while-idle="true" /&gt;
    &lt;/ldap:context-source&gt;
   ...
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will test each <code>DirContext</code> before it is passed to the client application and test `DirContext`s that have been sitting idle in the pool.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="known-issues"><a class="anchor" href="#known-issues"></a>8.6. Known Issues</h3>
<div class="sect3">
<h4 id="custom-authentication"><a class="anchor" href="#custom-authentication"></a>8.6.1. Custom Authentication</h4>
<div class="paragraph">
<p>The <code>PoolingContextSource</code> assumes that all <code>DirContext</code> objects retrieved from <code>ContextSource.getReadOnlyContext()</code> will have the same environment and likewise that all <code>DirContext</code> objects retrieved from <code>ContextSource.getReadWriteContext()</code> will have the same environment. This means that wrapping a <code>LdapContextSource</code> configured with an <code>AuthenticationSource</code> in a <code>PoolingContextSource</code> will not function as expected. The pool would be populated using the credentials of the first user and unless new connections were needed subsequent context requests would not be filled for the user specified by the <code>AuthenticationSource</code> for the requesting thread.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-missing-overloaded-api-methods"><a class="anchor" href="#adding-missing-overloaded-api-methods"></a>9. Adding Missing Overloaded API Methods</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="implementing-custom-search-methods"><a class="anchor" href="#implementing-custom-search-methods"></a>9.1. Implementing Custom Search Methods</h3>
<div class="paragraph">
<p>While <code>LdapTemplate</code> contains several overloaded versions of the most common operations in <code>DirContext</code>, we have not provided an alternative for each and every method signature, mostly because there are so many of them. We have, however, provided a means to call whichever <code>DirContext</code> method you want and still get the benefits that LdapTemplate provides.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say that you want to call the following <code>DirContext</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">NamingEnumeration search(Name name, String filterExpr, Object[] filterArgs, SearchControls ctls)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no corresponding overloaded method in LdapTemplate. The way to solve this is to use a custom <code>SearchExecutor</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface SearchExecutor {
   public NamingEnumeration executeSearch(DirContext ctx) throws NamingException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In your custom executor, you have access to a <code>DirContext</code> object, which you use to call the method you want. You then provide a handler that is responsible for mapping attributes and collecting the results. You can for example use one of the available implementations of <code>CollectingNameClassPairCallbackHandler</code>, which will collect the mapped results in an internal list. In order to actually execute the search, you call the <code>search</code>  method in LdapTemplate that takes an executor and a handler as arguments. Finally, you return whatever your handler has collected.</p>
</div>
<div class="listingblock">
<div class="title">A custom search method using SearchExecutor and AttributesMapper</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   ...
   public List search(final Name base, final String filter, final String[] params,
         final SearchControls ctls) {
      <strong>SearchExecutor executor = new SearchExecutor() {
         public NamingEnumeration executeSearch(DirContext ctx) {
            return ctx.search(base, filter, params, ctls);
         }
      };</strong>

      CollectingNameClassPairCallbackHandler handler =
         new AttributesMapperCallbackHandler(new PersonAttributesMapper());

      ldapTemplate.search(<strong>executor</strong>, handler);
      return handler.getList();
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer the <code>ContextMapper</code> to the <code>AttributesMapper</code>, this is what it would look like:</p>
</div>
<div class="listingblock">
<div class="title">A custom search method using SearchExecutor and ContextMapper</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   ...
   public List search(final Name base, final String filter, final String[] params,
         final SearchControls ctls) {
      SearchExecutor executor = new SearchExecutor() {
         public NamingEnumeration executeSearch(DirContext ctx) {
            return ctx.search(base, filter, params, ctls);
         }
      };

      CollectingNameClassPairCallbackHandler handler =
         <strong>new ContextMapperCallbackHandler(new PersonContextMapper()</strong>);

      ldapTemplate.search(executor, handler);
      return handler.getList();
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the <code>ContextMapperCallbackHandler</code> you must make sure that you have called <code>setReturningObjFlag(true)</code> on your <code>SearchControls</code> instance.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="implementing-other-custom-context-methods"><a class="anchor" href="#implementing-other-custom-context-methods"></a>9.2. Implementing Other Custom Context Methods</h3>
<div class="paragraph">
<p>In the same manner as for custom <code>search</code> methods, you can actually execute any method in <code>DirContext</code> by using a <code>ContextExecutor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface ContextExecutor {
   public Object executeWithContext(DirContext ctx) throws NamingException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When implementing a custom <code>ContextExecutor</code>, you can choose between using the <code>executeReadOnly()</code> or the <code>executeReadWrite()</code> method. Let&#8217;s say that we want to call this method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Object lookupLink(Name name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s available in <code>DirContext</code>, but there is no matching method in <code>LdapTemplate</code>. It&#8217;s a lookup method, so it should be read-only. We can implement it like this:</p>
</div>
<div class="listingblock">
<div class="title">A custom DirContext method using ContextExecutor</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.repo;

public class PersonRepoImpl implements PersonRepo {
   ...
   public Object lookupLink(final Name name) {
      ContextExecutor executor = new ContextExecutor() {
         public Object executeWithContext(DirContext ctx) {
            return ctx.lookupLink(name);
         }
      };

      return ldapTemplate.executeReadOnly(executor);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the same manner you can execute a read-write operation using the <code>executeReadWrite()</code> method.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="processing-the-dircontext"><a class="anchor" href="#processing-the-dircontext"></a>10. Processing the DirContext</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="custom-dircontext-pre-postprocessing"><a class="anchor" href="#custom-dircontext-pre-postprocessing"></a>10.1. Custom DirContext Pre/Postprocessing</h3>
<div class="paragraph">
<p>In some situations, one would like to perform operations on the <code>DirContext</code> before and after the search operation. The interface that is used for this is called <code>DirContextProcessor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface DirContextProcessor {
   public void preProcess(DirContext ctx) throws NamingException;
   public void postProcess(DirContext ctx) throws NamingException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LdapTemplate</code> class has a search method that takes a <code>DirContextProcessor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void search(SearchExecutor se, NameClassPairCallbackHandler handler,
   DirContextProcessor processor) throws DataAccessException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before the search operation, the <code>preProcess</code> method is called on the given <code>DirContextProcessor</code> instance. After the search has been executed and the resulting <code>NamingEnumeration</code> has been processed, the <code>postProcess</code> method is called. This enables a user to perform operations on the <code>DirContext</code> to be used in the search, and to check the <code>DirContext</code> when the search has been performed. This can be very useful for example when handling request and response controls.</p>
</div>
<div class="paragraph">
<p>There are also a few convenience methods for those that don&#8217;t need a custom <code>SearchExecutor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public void search(Name base, String filter,
   SearchControls controls, NameClassPairCallbackHandler handler, DirContextProcessor processor)

public void search(String base, String filter,
   SearchControls controls, NameClassPairCallbackHandler handler, DirContextProcessor processor)

public void search(Name base, String filter,
   SearchControls controls, AttributesMapper mapper, DirContextProcessor processor)

public void search(String base, String filter,
   SearchControls controls, AttributesMapper mapper, DirContextProcessor processor)

public void search(Name base, String filter,
   SearchControls controls, ContextMapper mapper, DirContextProcessor processor)

public void search(String base, String filter,
   SearchControls controls, ContextMapper mapper, DirContextProcessor processor)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-a-request-control-dircontextprocessor"><a class="anchor" href="#implementing-a-request-control-dircontextprocessor"></a>10.2. Implementing a Request Control DirContextProcessor</h3>
<div class="paragraph">
<p>The LDAPv3 protocol uses Controls to send and receive additional data to affect the behavior of predefined operations. In order to simplify the implementation of a request control <code>DirContextProcessor</code>, Spring LDAP provides the base class <code>AbstractRequestControlDirContextProcessor</code>. This class handles the retrieval of the current request controls from the <code>LdapContext</code>, calls a template method for creating a request control, and adds it to the <code>LdapContext</code>. All you have to do in the subclass is to implement the template method <code>createRequestControl</code>, and of course the <code>postProcess</code> method for performing whatever you need to do after the search.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public abstract class AbstractRequestControlDirContextProcessor implements
      DirContextProcessor {

   public void preProcess(DirContext ctx) throws NamingException {
      ...
   }

   public abstract Control createRequestControl();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A typical <code>DirContextProcessor</code> will be similar to the following:</p>
</div>
<div class="listingblock">
<div class="title">A request control DirContextProcessor implementation</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.example.control;

public class MyCoolRequestControl extends AbstractRequestControlDirContextProcessor {
   private static final boolean CRITICAL_CONTROL = true;
   private MyCoolCookie cookie;
   ...
   public MyCoolCookie getCookie() {
      return cookie;
   }

   public Control createRequestControl() {
      return new SomeCoolControl(cookie.getCookie(), CRITICAL_CONTROL);
   }

   public void postProcess(DirContext ctx) throws NamingException {
      LdapContext ldapContext = (LdapContext) ctx;
      Control[] responseControls = ldapContext.getResponseControls();

      for (int i = 0; i &lt; responseControls.length; i++) {
         if (responseControls[i] instanceof SomeCoolResponseControl) {
            SomeCoolResponseControl control = (SomeCoolResponseControl) responseControls[i];
            this.cookie = new MyCoolCookie(control.getCookie());
         }
      }
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure you use <code>LdapContextSource</code> when you use Controls. The <a href="http://download.oracle.com/javase/1.5.0/docs/api/javax/naming/ldap/Control.html"><code>Control</code></a> interface is specific for LDAPv3 and requires that <code>LdapContext</code> is used instead of <code>DirContext</code>. If an <code>AbstractRequestControlDirContextProcessor</code> subclass is called with an argument that is not an <code>LdapContext</code>, it will throw an <code>IllegalArgumentException</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="paged-search-results"><a class="anchor" href="#paged-search-results"></a>10.3. Paged Search Results</h3>
<div class="paragraph">
<p>Some searches may return large numbers of results. When there is no easy way to filter out a smaller amount, it would be convenient to have the server return only a certain number of results each time it is called. This is known as <em>paged search results</em>. Each "page" of the result could then be displayed at the time, with links to the next and previous page. Without this functionality, the client must either manually limit the search result into pages, or retrieve the whole result and then chop it into pages of suitable size. The former would be rather complicated, and the latter would be consuming unnecessary amounts of memory.</p>
</div>
<div class="paragraph">
<p>Some LDAP servers have support for the <code>PagedResultsControl</code>, which requests that the results of a search operation are returned by the LDAP server in pages of a specified size. The user controls the rate at which the pages are returned, simply by the rate at which the searches are called. However, the user must keep track of a <em>cookie</em> between the calls. The server uses this cookie to keep track of where it left off the previous time it was called with a paged results request.</p>
</div>
<div class="paragraph">
<p>Spring LDAP provides support for paged results by leveraging the concept for pre- and postprocessing of an <code>LdapContext</code> that was discussed in the previous sections. It does so using the class <code>PagedResultsDirContextProcessor</code>. The <code>PagedResultsDirContextProcessor</code> class creates a <code>PagedResultsControl</code> with the requested page size and adds it to the <code>LdapContext</code>. After the search, it gets the <code>PagedResultsResponseControl</code> and retrieves the paged results cookie, which is needed to keep the context between consecutive paged results requests.</p>
</div>
<div class="paragraph">
<p>Below is an example of how the paged search results functionality may be used:
<code>PagedResultsDirContextProcessor</code></p>
</div>
<div class="listingblock">
<div class="title">Paged results using PagedResultsDirContextProcessor</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public List&lt;String&gt; getAllPersonNames() {
  final SearchControls searchControls = new SearchControls();
  searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);

  final PagedResultsDirContextProcessor processor =
        new PagedResultsDirContextProcessor(PAGE_SIZE);

  return SingleContextSource.doWithSingleContext(
        contextSource, new LdapOperationsCallback&lt;List&lt;String&gt;&gt;() {

      @Override
      public List&lt;String&gt; doWithLdapOperations(LdapOperations operations) {
        List&lt;String&gt; result = new LinkedList&lt;String&gt;();

        do {
          List&lt;String&gt; oneResult = operations.search(
            "ou=People",
            "(&amp;(objectclass=person))",
            searchControls,
            CN_ATTRIBUTES_MAPPER,
            processor);
          result.addAll(oneResult);
        } while(processor.hasMore());

        return result;
      }
  });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order for a paged results cookie to continue being valid, it is imperative that the same underlying connection is used for each paged results call. This can be accomplished using the <code>SingleContextSource</code>, as demonstrated in the example.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transaction-support"><a class="anchor" href="#transaction-support"></a>11. Transaction Support</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-6"><a class="anchor" href="#introduction-6"></a>11.1. Introduction</h3>
<div class="paragraph">
<p>Programmers used to working with relational databases coming to the LDAP world often express surprise to the fact that there is no notion of transactions.
It is not specified in the protocol, and no LDAP servers support it.
Recognizing that this may be a major problem, Spring LDAP provides support for client-side,  compensating transactions on LDAP resources.</p>
</div>
<div class="paragraph">
<p>LDAP transaction support is provided by <code>ContextSourceTransactionManager</code>, a <code>PlatformTransactionManager</code> implementation that manages Spring transaction support for LDAP operations. Along with its collaborators it keeps track of the LDAP operations performed in a transaction, making record of the state before each operation and taking steps to  restore the initial state should the transaction need to be rolled back.</p>
</div>
<div class="paragraph">
<p>In addition to the actual transaction management, Spring LDAP transaction support also makes sure that the same <code>DirContext</code> instance will be used throughout the same transaction, i.e. the <code>DirContext</code> will not actually be closed until the transaction is finished, allowing for more efficient resources usage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to note that while the approach used by Spring LDAP to provide transaction support is sufficient for many cases it is by no means "real" transactions in the traditional sense.
The server is completely unaware of the transactions, so e.g. if the connection is broken there will  be no hope to rollback the transaction.
While this should be carefully considered it should also be noted that the alternative will be to operate without any transaction support whatsoever; this is pretty much as good as it gets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The client side transaction support will add some overhead in addition to the work required by the original operations.
While this overhead should not be something to worry about in most cases,
if your application will not perform several LDAP operations within the same transaction (e.g. a <code>modifyAttributes</code> followed by a <code>rebind</code>),
or if transaction synchronization with a JDBC data source is not required (see below) very little will be gained by using the LDAP transaction support.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-3"><a class="anchor" href="#configuration-3"></a>11.2. Configuration</h3>
<div class="paragraph">
<p>Configuring Spring LDAP transactions should look very familiar if you&#8217;re used to configuring Spring transactions. You will annotate your transacted classes with <code>@Transactional</code>, create a <code>TransactionManager</code> instance and include a <code>&lt;tx:annotation-driven&gt;</code> tag in your bean configuraion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;ldap:context-source
       url="ldap://localhost:389"
       base="dc=example,dc=com"
       username="cn=Manager"
       password="secret" /&gt;

&lt;ldap:ldap-template id="ldapTemplate" /&gt;
&lt;ldap:transaction-manager&gt;
    &lt;!--
    Note this default configuration will not work for more complex scenarios;
    see below for more information on RenamingStrategies.
    --&gt;
   &lt;ldap:default-renaming-strategy /&gt;
&lt;/ldap:transaction-manager&gt;

&lt;!--
   The MyDataAccessObject class is annotated with @Transactional.
--&gt;
&lt;bean id="myDataAccessObject" class="com.example.MyRepository"&gt;
  &lt;property name="ldapTemplate" ref="ldapTemplate" /&gt;
&lt;/bean&gt;

&lt;tx:annotation-driven /&gt;
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While this setup will work fine for most simple use cases, some more complex scenarios will require additional configuration;
more specifically if you will be creating or deleting subtrees within transactions, you will need to use an alternative <code>TempEntryRenamingStrategy</code>, as described in <a href="#renaming-strategies">Renaming Strategies</a> below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In a real world example you would probably apply the transactions on the service object level rather than the repositort level; the above serves as an example to demonstrate the general idea.</p>
</div>
</div>
<div class="sect2">
<h3 id="jdbc-transaction-integration"><a class="anchor" href="#jdbc-transaction-integration"></a>11.3. JDBC Transaction Integration</h3>
<div class="paragraph">
<p>A common use case when working against LDAP is that some of the data is stored in the LDAP tree, but other data is stored in a relational database. In this case, transaction support becomes even more important, since the update of the different resources should be synchronized.</p>
</div>
<div class="paragraph">
<p>While actual XA transactions is not supported, support is provided to conceptually wrap JDBC and LDAP access within the same transaction by supplying a <code>data-source-ref</code> attribute to the <code>&lt;ldap:transaction-manager&gt;</code> tag. This will create a <code>ContextSourceAndDataSourceTransactionManager</code>, which will then manage the two transactions, virtually as if they were one. When performing a commit, the LDAP part of the operation will always be performed first, allowing both transactions to be rolled back should the LDAP commit fail. The JDBC part of the transaction is managed exactly as in <code>DataSourceTransactionManager</code>, except that nested transactions is not supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">&lt;ldap:transaction-manager data-source-ref="dataSource" &gt;
  &lt;ldap:default-renaming-strategy /&gt;
&lt;ldap:transaction-manager /&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Once again it should be noted that the provided support is all client side.
The wrapped transaction is not an XA transaction. No two-phase as such commit is performed, as the LDAP server will be unable to vote on its outcome.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same thing can be accomplished for Hibernate integration by supplying a <code>session-factory-ref</code> attribute to the <code>&lt;ldap:transaction-manager&gt;</code> tag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;ldap:transaction-manager session-factory-ref="dataSource" &gt;
  &lt;ldap:default-renaming-strategy /&gt;
&lt;ldap:transaction-manager /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap-compensating-transactions-explained"><a class="anchor" href="#ldap-compensating-transactions-explained"></a>11.4. LDAP Compensating Transactions Explained</h3>
<div class="paragraph">
<p>Spring LDAP manages compensating transactions by making record of the state in the LDAP tree before each modifying operation (<code>bind</code>, <code>unbind</code>, <code>rebind</code>,  <code>modifyAttributes</code>, and <code>rename</code>).
This enables the system to perform compensating operations should the transaction need to be rolled back.</p>
</div>
<div class="paragraph">
<p>In many cases the compensating operation is pretty straightforward. E
.g. the compensating rollback operation for a  <code>bind</code> operation will quite obviously be to unbind the entry.
Other operations however require a different, more complicated approach because of some particular characteristics of LDAP databases.
Specifically, it is not always possible to get the values of all <code>Attributes</code> of an entry, making the above strategy insufficient for e.g. an <code>unbind</code> operation.</p>
</div>
<div class="paragraph">
<p>This is why each modifying operation performed within a Spring LDAP managed transaction is internally split up in four distinct operations - a recording operation,
a preparation operation, a commit operation,  and a rollback operation. The specifics for each LDAP operation is described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">LDAP Operation</th>
<th class="tableblock halign-left valign-top">Recording</th>
<th class="tableblock halign-left valign-top">Preparation</th>
<th class="tableblock halign-left valign-top">Commit</th>
<th class="tableblock halign-left valign-top">Rollback</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make record of the DN of the entry to bind.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind the entry.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unbind the entry using the recorded DN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rename</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make record of the original and target DN.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename the entry.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename the entry back to its original DN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unbind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make record of the original DN and calculate a temporary DN.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename the entry to the temporary location.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unbind the temporary entry.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename the entry from the temporary location back to its original DN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rebind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make record of the original DN and the new <code>Attributes</code>, and calculate a temporary DN.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename the entry to a temporary location.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind the new <code>Attributes</code> at the original DN, and unbind the original entry from its temporary location.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename the entry from the temporary location back to its original DN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyAttributes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make record of the DN of the entry to modify and calculate compensating `ModificationItem`s for the modifications to be done.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform the <code>modifyAttributes</code> operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform a <code>modifyAttributes</code> operation using the calculated compensating `ModificationItem`s.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A more detailed description of the internal workings of the Spring LDAP transaction support is available in the javadocs.</p>
</div>
<div class="sect3">
<h4 id="renaming-strategies"><a class="anchor" href="#renaming-strategies"></a>11.4.1. Renaming Strategies</h4>
<div class="paragraph">
<p>As described in the table above, the transaction management of some operations require the original entry affected by the operation to be temporarily renamed before the actual modification can be made in the commit. The manner in which the temporary DN of the entry is calculated is managed by a <code>TempEntryRenamingStrategy</code> specified in a sub-element to the <code>&lt;ldap:transaction-manager &gt;</code> declaration in the configuration. Two implementations are supplied with Spring LDAP:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DefaultTempEntryRenamingStrategy</code> (the default). Specified using a <code>&lt;ldap:default-renaming-strategy /&gt;</code> element. Adds a suffix to the least significant part of the entry DN. E.g. for the DN <code>cn=john doe, ou=users</code>, this strategy would return the temporary DN <code>cn=john doe_temp, ou=users</code>. The suffix is configurable using the <code>temp-suffix</code> attribute.</p>
</li>
<li>
<p><code>DifferentSubtreeTempEntryRenamingStrategy</code>. Specified using a <code>&lt;ldap:different-subtree-renaming-strategy /&gt;</code> element. Takes the least significant part of the DN and appends a subtree DN to this. This makes all temporary entries be placed at a specific location in the LDAP tree. The temporary subtree DN is configured using the <code>subtree-node</code> attribute. E.g., if <code>subtree-node</code> is <code>ou=tempEntries</code> and the original DN of the entry is <code>cn=john doe, ou=users</code>, the temporary DN will be <code>cn=john doe, ou=tempEntries</code>. Note that the configured subtree node needs to be present in the LDAP tree.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are some situations where the <code>DefaultTempEntryRenamingStrategy</code> will not work. E.g. if your are planning to do recursive deletes you&#8217;ll need to use <code>DifferentSubtreeTempEntryRenamingStrategy</code>. This is because the recursive delete operation actually consists of a depth-first delete of each node in the sub tree individually. Since it is not allowed to rename an entry that has any children, and <code>DefaultTempEntryRenamingStrategy</code> would leave each node in the same subtree (with a different name) in stead of actually removing it, this operation would fail. When in doubt, use <code>DifferentSubtreeTempEntryRenamingStrategy</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user-authentication"><a class="anchor" href="#user-authentication"></a>12. User Authentication using Spring LDAP</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic-authentication"><a class="anchor" href="#basic-authentication"></a>12.1. Basic Authentication</h3>
<div class="paragraph">
<p>While the core functionality of the <code>ContextSource</code> is to provide <code>DirContext</code> instances for use by <code>LdapTemplate</code>, it may also be used for authenticating users against an LDAP server. The <code>getContext(principal, credentials)</code> method of <code>ContextSource</code> will do exactly that; construct a <code>DirContext</code> instance according to the <code>ContextSource</code> configuration, authenticating the context using the supplied principal and credentials. A custom authenticate method could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public boolean authenticate(String userDn, String credentials) {
  DirContext ctx = null;
  try {
    ctx = contextSource.getContext(userDn, credentials);
    return true;
  } catch (Exception e) {
    // Context creation failed - authentication did not succeed
    logger.error("Login failed", e);
    return false;
  } finally {
    // It is imperative that the created DirContext instance is always closed
    LdapUtils.closeContext(ctx);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The userDn supplied to the <code>authenticate</code> method needs to be the full DN of the user to authenticate (regardless of the <code>base</code> setting on the <code>ContextSource</code>). You will typically need to perform an LDAP search based on e.g. the user name to get this DN:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private String getDnForUser(String uid) {
  List&lt;String&gt; result = ldapTemplate.search(
      query().where("uid").is(uid),
      new AbstractContextMapper() {
         protected String doMapFromContext(DirContextOperations ctx) {
            return ctx.getNameInNamespace();
         }
      });

  if(result.size() != 1) {
    throw new RuntimeException("User not found or not unique");
  }

  return result.get(0);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are some drawbacks to this approach. The user is forced to concern herself with the DN of the user, she can only search for the user&#8217;s uid, and the search always starts at the root of the tree (the empty path). A more flexible method would let the user specify the search base, the search filter, and the credentials. Spring LDAP includes an authenticate method in LdapTemplate that provide this functionality: <code>boolean authenticate(LdapQuery query, String password);</code></p>
</div>
<div class="paragraph">
<p>Using this method authentication becomes as simple as this:</p>
</div>
<div class="listingblock">
<div class="title">Authenticating a user using Spring LDAP.</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">ldapTemplate.authenticate(query().where("uid").is("john.doe"), "secret");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As described in below, some setups may require additional operations to be performed in order for actual authentication to occur. See <a href="#operationsOnAuthenticatedContext">Performing Operations on the Authenticated Context</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t write your own custom authenticate methods. Use the ones provided in Spring LDAP 1.3.x.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="operationsOnAuthenticatedContext"><a class="anchor" href="#operationsOnAuthenticatedContext"></a>12.2. Performing Operations on the Authenticated Context</h3>
<div class="paragraph">
<p>Some authentication schemes and LDAP servers require some operation to be performed on the created <code>DirContext</code> instance for the actual authentication to occur. You should test and make sure how your server setup and authentication schemes behave; failure to do so might result in that users will be admitted into your system regardless of the DN/credentials supplied. This is a naïve implementation of an authenticate method where a hard-coded <code>lookup</code> operation is performed on the authenticated context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public boolean authenticate(String userDn, String credentials) {
  DirContext ctx = null;
  try {
    ctx = contextSource.getContext(userDn, credentials);
    // Take care here - if a base was specified on the ContextSource
    // that needs to be removed from the user DN for the lookup to succeed.
    <strong>ctx.lookup(userDn);</strong>
    return true;
  } catch (Exception e) {
    // Context creation failed - authentication did not succeed
    logger.error("Login failed", e);
    return false;
  } finally {
    // It is imperative that the created DirContext instance is always closed
    LdapUtils.closeContext(ctx);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It would be better if the operation could be provided as an implementation of a callback interface, thus not limiting the operation to always be a <code>lookup</code>. Spring LDAP includes the callback interface <code>AuthenticatedLdapEntryContextMapper</code> and a corresponding <code>authenticate</code> method: <code>&lt;T&gt; T authenticate(LdapQuery query, String password, AuthenticatedLdapEntryContextMapper&lt;T&gt; mapper);</code></p>
</div>
<div class="paragraph">
<p>This opens up for any operation to be performed on the authenticated context:</p>
</div>
<div class="listingblock">
<div class="title">Performing an LDAP operation on the authenticated context using Spring LDAP.</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">AuthenticatedLdapEntryContextMapper&lt;DirContextOperations&gt; mapper = new AuthenticatedLdapEntryContextMapper&lt;DirContextOperations&gt;() {
  public DirContextOperations mapWithContext(DirContext ctx, LdapEntryIdentification ldapEntryIdentification) {
    try {
      return (DirContextOperations) ctx.lookup(ldapEntryIdentification.getRelativeName());
    }
    catch (NamingException e) {
      throw new RuntimeException("Failed to lookup " + ldapEntryIdentification.getRelativeName(), e);
    }
  }
};

ldapTemplate.authenticate(query().where("uid").is("john.doe"), "secret", mapper);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="obsolete-authentication-methods"><a class="anchor" href="#obsolete-authentication-methods"></a>12.3. Obsolete authentication methods</h3>
<div class="paragraph">
<p>In addition to the <code>authenticate</code> methods described above there are a number of deprecated methods that can be used for authentication. While these will work fine, the recommendation is to use the <code>LdapQuery</code> methods instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="use-spring-security"><a class="anchor" href="#use-spring-security"></a>12.4. Use Spring Security</h3>
<div class="paragraph">
<p>While the approach above may be sufficient for simple authentication scenarios, requirements in this area commonly expand rapidly. There is a multitude of aspects that apply, including authentication, authorization, web integration, user context management, etc. If you suspect that the requirements might expand beyond just simple authentication, you should definitely consider using <a href="http://spring.io/spring-security">Spring Security</a> for your security purposes instead. It is a full-blown, mature security framework addressing the above aspects as well as several others.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ldif-parsing"><a class="anchor" href="#ldif-parsing"></a>13. LDIF Parsing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction-7"><a class="anchor" href="#introduction-7"></a>13.1. Introduction</h3>
<div class="paragraph">
<p>LDAP Directory Interchange Format (LDIF) files are the standard medium for describing directory data in a flat file format. The most common uses of this format include information transfer and archival. However, the standard also defines a way to describe modifications to stored data in a flat file format. LDIFs of this later type are typically referred to as <em>changetype</em> or <em>modify</em> LDIFs.</p>
</div>
<div class="paragraph">
<p>The <code>org.springframework.ldap.ldif</code> package provides classes needed to parse LDIF files and deserialize them into tangible objects. The <code>LdifParser</code> is the main class of the <code>org.springframework.ldap.ldif</code> package and is capable of parsing files that are RFC 2849 compliant. This class reads lines from a resource and assembles them into an <code>LdapAttributes</code> object. The <code>LdifParser</code> currently ignores <em>changetype</em> LDIF entries as their usefulness in the context of an application has yet to be determined.</p>
</div>
</div>
<div class="sect2">
<h3 id="object-representation"><a class="anchor" href="#object-representation"></a>13.2. Object Representation</h3>
<div class="paragraph">
<p>Two classes in the <code>org.springframework.ldap.core</code> package provide the means to represent an LDIF in code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LdapAttribute</code> - Extends <code>javax.naming.directory.BasicAttribute</code> adding support for LDIF options as defined in RFC2849.</p>
</li>
<li>
<p><code>LdapAttributes</code> - Extends <code>javax.naming.directory.BasicAttributes</code> adding specialized support for DNs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>LdapAttribute</code> objects represent options as a <code>Set&lt;String&gt;</code>. The DN support added to the <code>LdapAttributes</code> object employs the <code>javax.naming.ldap.LdapName</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-parser"><a class="anchor" href="#the-parser"></a>13.3. The Parser</h3>
<div class="paragraph">
<p>The <code>Parser</code> interface provides the foundation for operation and employs three supporting policy definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SeparatorPolicy</code> - establishes the mechanism by which lines are assembled into attributes.</p>
</li>
<li>
<p><code>AttributeValidationPolicy</code> - ensures that attributes are correctly structured prior to parsing.</p>
</li>
<li>
<p><code>Specification</code> - provides a mechanism by which object structure can be validated after assembly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default implementations of these interfaces are the <code>org.springframework.ldap.ldif.parser.LdifParser</code>, the <code>org.springframework.ldap.ldif.support.SeparatorPolicy</code>, and the <code>org.springframework.ldap.ldif.support.DefaultAttributeValidationPolicy</code>, and the <code>org.springframework.ldap.schema.DefaultSchemaSpecification</code> respectively. Together, these 4 classes parse a resource line by line and translate the data into <code>LdapAttributes</code> objects.</p>
</div>
<div class="paragraph">
<p>The <code>SeparatorPolicy</code> determines how individual lines read from the source file should be interpreted as the LDIF specification allows attributes to span multiple lines. The default policy assess lines in the context of the order in which they were read to determine the nature of the line in consideration. <em>control</em> attributes and <em>changetype</em> records are ignored.</p>
</div>
<div class="paragraph">
<p>The <code>DefaultAttributeValidationPolicy</code> uses REGEX expressions to ensure each attribute conforms to a valid attribute format according to RFC 2849 once parsed. If an attribute fails validation, an <code>InvalidAttributeFormatException</code> is logged and the record is skipped (the parser returns null).</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-validation"><a class="anchor" href="#schema-validation"></a>13.4. Schema Validation</h3>
<div class="paragraph">
<p>A mechanism for validating parsed objects against a schema and is available via the <code>Specification</code> interface in the <code>org.springframework.ldap.schema</code> package. The <code>DefaultSchemaSpecification</code> does not do any validation and is available for instances where records are known to be valid and not required to be checked. This option saves the performance penalty that validation imposes. The <code>BasicSchemaSpecification</code> applies basic checks such as ensuring DN and object class declarations have been provided. Currently, validation against an actual schema requires implementation of the <code>Specification</code> interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-batch-integration"><a class="anchor" href="#spring-batch-integration"></a>13.5. Spring Batch Integration</h3>
<div class="paragraph">
<p>While the <code>LdifParser</code> can be employed by any application that requires parsing of LDIF files, Spring offers a batch processing framework that offers many file processing utilities for parsing delimited files such as CSV. The <code>org.springframework.ldap.ldif.batch</code> package offers the classes necessary for using the <code>LdifParser</code> as a valid configuration option in the Spring Batch framework.
There are 5 classes in this package which offer three basic use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Case 1: Read LDIF records from a file and return an <code>LdapAttributes</code> object.</p>
</li>
<li>
<p>Use Case 2: Read LDIF records from a file and map records to Java objects (POJOs).</p>
</li>
<li>
<p>Use Case 3: Write LDIF records to a file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first use case is accomplished with the LdifReader. This class extends Spring Batch&#8217;s <code>AbstractItemCountingItemSteamItemReader</code> and implements its <code>ResourceAwareItemReaderItemStream</code>. It fits naturally into the framework and can be used to read <code>LdapAttributes</code> objects from a file.</p>
</div>
<div class="paragraph">
<p>The <code>MappingLdifReader</code> can be used to map LDIF objects directly to any POJO. This class requires an implementation of the <code>RecordMapper</code> interface be provided. This implementation should implement the logic for mapping objects to POJOs.</p>
</div>
<div class="paragraph">
<p>The <code>RecordCallbackHandler</code> can be implemented and provided to either reader. This handler can be used to operate on skipped records. Consult the Spring Batch documentation for more information.</p>
</div>
<div class="paragraph">
<p>The last member of this package, the <code>LdifAggregator</code>, can be used to write LDIF records to a file. This class simply invokes the <code>toString()</code> method of the <code>LdapAttributes</code> object.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="utilities"><a class="anchor" href="#utilities"></a>14. Utilities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="incremental-retrieval-of-multi-valued-attributes"><a class="anchor" href="#incremental-retrieval-of-multi-valued-attributes"></a>14.1. Incremental Retrieval of Multi-Valued Attributes</h3>
<div class="paragraph">
<p>When there are a very large number of attribute values (&gt;1500) for a specific attribute, Active Directory will typically refuse to return all these values at once. Instead the attribute values will be returned according to the <a href="http://www.watersprings.org/pub/id/draft-kashi-incremental-00.txt">Incremental Retrieval of Multi-valued Properties</a> method. This requires the calling part to inspect the returned attribute for specific markers and, if necessary, make additional lookup requests until all values are found.</p>
</div>
<div class="paragraph">
<p>Spring LDAP&#8217;s <code>org.springframework.ldap.core.support.DefaultIncrementalAttributesMapper</code> helps working with this kind of attributes, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Object[] attrNames =  new Object[]{"oneAttribute", "anotherAttribute"};
Attributes attrs = DefaultIncrementalAttributeMapper.lookupAttributes(ldapTemplate, theDn, attrNames);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will parse any returned attribute range markers and make repeated requests as necessary until all values for all requested attributes have been retrieved.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a>15. Testing</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="using-embedded-server"><a class="anchor" href="#using-embedded-server"></a>15.1. Using Embedded Server</h4>
<div class="paragraph">
<p><code>spring-ldap-test</code> bring an embedded ldap server based on <a href="https://directory.apache.org/apacheds/">ApacheDS</a> or <a href="https://www.ldap.com/unboundid-ldap-sdk-for-java">UnboundID</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>spring-ldap-test</code> is compatible with ApacheDS 1.5.5. New versions of ApacheDS are not supported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Download the dependency below:</p>
</div>
<div class="paragraph">
<p>Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.ldap&lt;/groupId&gt;
    &lt;artifactId&gt;spring-ldap-test&lt;/artifactId&gt;
    &lt;version&gt;${version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">testCompile "org.springframework.ldap:spring-ldap-test:$version"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apacheds"><a class="anchor" href="#apacheds"></a>15.2. ApacheDS</h4>
<div class="paragraph">
<p>ApacheDS dependencies:</p>
</div>
<div class="paragraph">
<p>Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.directory.server&lt;/groupId&gt;
    &lt;artifactId&gt;apacheds-core&lt;/artifactId&gt;
    &lt;version&gt;1.5.5&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.directory.server&lt;/groupId&gt;
    &lt;artifactId&gt;apacheds-core-entry&lt;/artifactId&gt;
    &lt;version&gt;1.5.5&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.directory.server&lt;/groupId&gt;
    &lt;artifactId&gt;apacheds-protocol-shared&lt;/artifactId&gt;
    &lt;version&gt;1.5.5&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.directory.server&lt;/groupId&gt;
    &lt;artifactId&gt;apacheds-protocol-ldap&lt;/artifactId&gt;
    &lt;version&gt;1.5.5&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.directory.server&lt;/groupId&gt;
    &lt;artifactId&gt;apacheds-server-jndi&lt;/artifactId&gt;
    &lt;version&gt;1.5.5&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.directory.shared&lt;/groupId&gt;
    &lt;artifactId&gt;shared-ldap&lt;/artifactId&gt;
    &lt;version&gt;0.9.15&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">testCompile "org.apache.directory.server:apacheds-core:1.5.5",
            "org.apache.directory.server:apacheds-core-entry:1.5.5",
            "org.apache.directory.server:apacheds-protocol-shared:1.5.5",
            "org.apache.directory.server:apacheds-protocol-ldap:1.5.5",
            "org.apache.directory.server:apacheds-server-jndi:1.5.5",
            "org.apache.directory.shared:shared-ldap:0.9.15"</code></pre>
</div>
</div>
<div class="paragraph">
<p>An embedded ldap server is created using the bean below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="embeddedLdapServer" class="org.springframework.ldap.test.EmbeddedLdapServerFactoryBean"&gt;
    &lt;property name="partitionName" value="example"/&gt;
    &lt;property name="partitionSuffix" value="dc=261consulting,dc=com" /&gt;
    &lt;property name="port" value="9321" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>spring-ldap-test</code> provided a mechanism to populate the ldap server using <code>org.springframework.ldap.test.LdifPopulator</code>. Create the bean as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ldap.test.LdifPopulator" depends-on="embeddedLdapServer"&gt;
    &lt;property name="contextSource" ref="contextSource" /&gt;
    &lt;property name="resource" value="classpath:/setup_data.ldif" /&gt;
    &lt;property name="base" value="dc=jayway,dc=se" /&gt;
    &lt;property name="clean" value="true" /&gt;
    &lt;property name="defaultBase" value="dc=jayway,dc=se" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way to work against an embedded ldap server is using <code>org.springframework.ldap.test.TestContextSourceFactoryBean</code> which allow to use and populate it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="contextSource" class="org.springframework.ldap.test.TestContextSourceFactoryBean"&gt;
    &lt;property name="defaultPartitionSuffix" value="dc=jayway,dc=se" /&gt;
    &lt;property name="defaultPartitionName" value="jayway" /&gt;
    &lt;property name="principal" value="uid=admin,ou=system" /&gt;
    &lt;property name="password" value="secret" /&gt;
    &lt;property name="ldifFile" value="classpath:/setup_data.ldif" /&gt;
    &lt;property name="port" value="1888" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, <code>org.springframework.ldap.test.LdapTestUtils</code> provide methods to work with embedded ldap server programmatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="unboundid"><a class="anchor" href="#unboundid"></a>15.3. UnboundID</h4>
<div class="paragraph">
<p>UnboundID dependencies:</p>
</div>
<div class="paragraph">
<p>Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.unboundid&lt;/groupId&gt;
    &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;
    &lt;version&gt;3.1.1&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">testCompile "com.unboundid:unboundid-ldapsdk:3.1.1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>An embedded ldap server is created using the bean below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="embeddedLdapServer" class="org.springframework.ldap.test.unboundid.EmbeddedLdapServerFactoryBean"&gt;
    &lt;property name="partitionName" value="example"/&gt;
    &lt;property name="partitionSuffix" value="dc=261consulting,dc=com" /&gt;
    &lt;property name="port" value="9321" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>spring-ldap-test</code> provided a mechanism to populate the ldap server using <code>org.springframework.ldap.test.unboundid.LdifPopulator</code>. Create the bean as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean class="org.springframework.ldap.test.unboundid.LdifPopulator" depends-on="embeddedLdapServer"&gt;
    &lt;property name="contextSource" ref="contextSource" /&gt;
    &lt;property name="resource" value="classpath:/setup_data.ldif" /&gt;
    &lt;property name="base" value="dc=jayway,dc=se" /&gt;
    &lt;property name="clean" value="true" /&gt;
    &lt;property name="defaultBase" value="dc=jayway,dc=se" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way to work against an embedded ldap server is using <code>org.springframework.ldap.test.unboundid.TestContextSourceFactoryBean</code> which allow to use and populate it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;bean id="contextSource" class="org.springframework.ldap.test.unboundid.TestContextSourceFactoryBean"&gt;
    &lt;property name="defaultPartitionSuffix" value="dc=jayway,dc=se" /&gt;
    &lt;property name="defaultPartitionName" value="jayway" /&gt;
    &lt;property name="principal" value="uid=admin,ou=system" /&gt;
    &lt;property name="password" value="secret" /&gt;
    &lt;property name="ldifFile" value="classpath:/setup_data.ldif" /&gt;
    &lt;property name="port" value="1888" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, <code>org.springframework.ldap.test.unboundid.LdapTestUtils</code> provide methods to work with embedded ldap server programmatically.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.3.2.RELEASE<br>
Last updated 2017-10-06 20:33:51 +00:00
</div>
</div>
</body>
</html>