<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>ItemReaders and ItemWriters</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #34302d; padding: 0; margin: 0; font-family: "Varela Round", sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #0b0a0a; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #548e2e; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #487a28; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Montserrat, sans-serif; font-weight: 400; font-style: normal; color: #34302d; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #867c74; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #34302d; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #34302d; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #34302d; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #6b625c; }

kbd { font-family: Monaco, Menlo, Consolas, "Courier New", monospace; display: inline-block; color: #34302d; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #191715; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Montserrat, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #0b0a0a; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f1f1f1; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d7d7d7; margin-bottom: 1.25em; padding: 1.25em; background: #f1f1f1; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #34302d; padding: 1.25em; }

#footer-text { color: #cbcfd2; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #34302d; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #262321; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Varela Round", sans-serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Montserrat, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d7d7d7; margin-bottom: 1.25em; padding: 1.25em; background: #f1f1f1; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #0b0a0a; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: whitesmoke; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #dddddd; -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: whitesmoke; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #0b0a0a; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #34302d; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #3f6a22; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #34302d; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.admonitionblock { border-left: 4px solid #6db33f; background-color: #ebf1e7; padding: 1.2em 0; margin: 30px 0; width: auto; }

#toc a:hover { text-decoration: underline; }

.admonitionblock > table td.content { border-left: none; }

.js-download-widget-selector{display:inline;}.navbar{margin-bottom:0;}.item-slider-widget{display:inline-block;margin-left:15px;}.item-slider-widget .item--slider{height:32px;position:absolute;width:40px;border-radius:2px;margin-top:-4px;z-index:800;background:#68605a;background:-moz-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#68605a),color-stop(100%,#34302d),color-stop(100%,#020202));background:-webkit-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:-o-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:-ms-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:linear-gradient(to bottom,#68605a 0%,#34302d 100%,#020202 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#68605a',endColorstr='#020202',GradientType=0);cursor:pointer;transition:all 0.25s;-webkit-transition:all 0.25s;-moz-webkit-transition:all 0.25s;-ms--webkit-transition:all 0.25s;-o-webkit-transition:all 0.25s;}.item-slider-widget .item-slider--container{background-color:white;border:1px solid #999;padding:0 3px;}.item-slider-widget .item-slider--container .item{display:inline-block;color:#c3c3c3;font-family:"Montserrat",sans-serif;font-size:12px;line-height:12px;text-transform:uppercase;padding:7px 6px 5px;cursor:pointer;transition:color 0.25s;-webkit-transition:color 0.25s;-moz-webkit-transition:color 0.25s;-ms--webkit-transition:color 0.25s;-o-webkit-transition:color 0.25s;}.item-slider-widget .item-slider--container .item:hover{color:black;}.item-slider-widget .item-slider--container .item.js-active{z-index:801;position:relative;color:#f1f1f1;}

/* Styling for the toggle buttons */
/* Borrowed from http://jeremyworboys.com/writing/toggle-buttons-without-javascript */
/* Micro clearfix (http://nicolasgallagher.com/micro-clearfix-hack/) */
.cf:before,.cf:after{content:"";display:table}.cf:after{clear:both}.cf{zoom:1}

/* = Function = */

.docToggle-button input {
    display: none;
}
.docToggle-button label {
    background: #ccc;
    border: 1px solid #888;
    color: #666;
    padding: 5px 10px;
}
.docToggle-button label:hover {
    background-color: #ddd;
}
.docToggle-button label:active,
.docToggle-button input:focus + label {
    background-color: #aaa;
}
.docToggle-button input:checked + label {
    background-color: #b4b4b4;
}

.docToggle-button label {
    background-color: #f5f5f5;
    background-image: -webkit-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: -moz-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: -o-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: -ms-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: linear-gradient(top, #ffffff, #e6e6e6);
    background-repeat: repeat-x;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#e6e6e6', GradientType=0);
    border-color: #e6e6e6 #e6e6e6 #bfbfbf;
    border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
    border: 1px solid #cccccc;
    border-bottom-color: #b3b3b3;
    -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);
    -moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);
    color: #333333;
    cursor: pointer;
    display: inline-block;
    margin-bottom: 0;
    margin-left: -1px;
    padding: 4px 10px;
    font-size: 13px;
    line-height: 18px;
    text-align: center;
    text-shadow: 0 1px 1px rgba(255, 255, 255, 0.75);
    vertical-align: middle;
}
.docToggle-button label:hover {
    background-color: #e6e6e6;
    background-position: 0 -15px;
    color: #333333;
    text-decoration: none;
    -webkit-transition: background-position 0.1s linear;
    -moz-transition: background-position 0.1s linear;
    -ms-transition: background-position 0.1s linear;
    -o-transition: background-position 0.1s linear;
    transition: background-position 0.1s linear;
}
.docToggle-button label:active,
.docToggle-button input:focus + label {
    background-color: #d9d9d9;
    background-image: none;
    -webkit-box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    -moz-box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    outline: 0;
}

.docToggle-button input:checked + label {
    background: #404040;
    color: #ffffff;
    -webkit-box-shadow: inset 0 1px 6px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    -moz-box-shadow: inset 0 1px 6px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    box-shadow: inset 0 1px 6px rgba(0, 0, 0, 0.15), 0 1px 2px  rgba(0, 0, 0, 0.05);
}
.docToggle-button:first-child label {
  -webkit-border-top-left-radius: 4px;
  -moz-border-radius-topleft: 4px;
  border-top-left-radius: 4px;
  -webkit-border-bottom-left-radius: 4px;
  -moz-border-radius-bottomleft: 4px;
  border-bottom-left-radius: 4px;
  margin-left: 0;
}
.docToggle-button:last-child label {
  -webkit-border-top-right-radius: 4px;
  -moz-border-radius-topright: 4px;
  border-top-right-radius: 4px;
  -webkit-border-bottom-right-radius: 4px;
  -moz-border-radius-bottomright: 4px;
  border-bottom-right-radius: 4px;

  -webkit-border-top-left-radius: 4px;
  -moz-border-radius-topleft: 4px;
  border-top-left-radius: 4px;
  -webkit-border-bottom-left-radius: 4px;
  -moz-border-radius-bottomleft: 4px;
  border-bottom-left-radius: 4px;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>
  #tocbot a.toc-link.node-name--H1{ font-style: italic }
  @media screen{
    #tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
    #tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
      padding-left: 0 }
    #tocbot a.toc-link{ height:100% }
    .is-collapsible{ max-height:3000px; overflow:hidden; }
    .is-collapsed{ max-height:0 }
    .is-active-link{ font-weight:700 }
  }
  @media print{
    #tocbot a.toc-link.node-name--H4{ display:none }
  }
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#readersAndWriters">1. ItemReaders and ItemWriters</a>
<ul class="sectlevel2">
<li><a href="#itemReader">1.1. <code>ItemReader</code></a></li>
<li><a href="#itemWriter">1.2. <code>ItemWriter</code></a></li>
<li><a href="#itemProcessor">1.3. <code>ItemProcessor</code></a>
<ul class="sectlevel3">
<li><a href="#chainingItemProcessors">1.3.1. Chaining ItemProcessors</a></li>
<li><a href="#filteringRecords">1.3.2. Filtering Records</a></li>
<li><a href="#faultTolerant">1.3.3. Fault Tolerance</a></li>
</ul>
</li>
<li><a href="#itemStream">1.4. <code>ItemStream</code></a></li>
<li><a href="#delegatePatternAndRegistering">1.5. The Delegate Pattern and Registering with the Step</a></li>
<li><a href="#flatFiles">1.6. Flat Files</a>
<ul class="sectlevel3">
<li><a href="#fieldSet">1.6.1. The <code>FieldSet</code></a></li>
<li><a href="#flatFileItemReader">1.6.2. <code>FlatFileItemReader</code></a>
<ul class="sectlevel4">
<li><a href="#lineMapper"><code>LineMapper</code></a></li>
<li><a href="#lineTokenizer"><code>LineTokenizer</code></a></li>
<li><a href="#fieldSetMapper"><code>FieldSetMapper</code></a></li>
<li><a href="#defaultLineMapper"><code>DefaultLineMapper</code></a></li>
<li><a href="#simpleDelimitedFileReadingExample">Simple Delimited File Reading Example</a></li>
<li><a href="#mappingFieldsByName">Mapping Fields by Name</a></li>
<li><a href="#beanWrapperFieldSetMapper">Automapping FieldSets to Domain Objects</a></li>
<li><a href="#fixedLengthFileFormats">Fixed Length File Formats</a></li>
<li><a href="#prefixMatchingLineMapper">Multiple Record Types within a Single File</a></li>
<li><a href="#exceptionHandlingInFlatFiles">Exception Handling in Flat Files</a></li>
</ul>
</li>
<li><a href="#flatFileItemWriter">1.6.3. <code>FlatFileItemWriter</code></a>
<ul class="sectlevel4">
<li><a href="#lineAggregator"><code>LineAggregator</code></a></li>
<li><a href="#SimplifiedFileWritingExample">Simplified File Writing Example</a></li>
<li><a href="#FieldExtractor"><code>FieldExtractor</code></a></li>
<li><a href="#delimitedFileWritingExample">Delimited File Writing Example</a></li>
<li><a href="#fixedWidthFileWritingExample">Fixed Width File Writing Example</a></li>
<li><a href="#handlingFileCreation">Handling File Creation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xmlReadingWriting">1.7. XML Item Readers and Writers</a>
<ul class="sectlevel3">
<li><a href="#StaxEventItemReader">1.7.1. <code>StaxEventItemReader</code></a></li>
<li><a href="#StaxEventItemWriter">1.7.2. <code>StaxEventItemWriter</code></a></li>
</ul>
</li>
<li><a href="#jsonReadingWriting">1.8. JSON Item Readers And Writers</a>
<ul class="sectlevel3">
<li><a href="#JsonItemReader">1.8.1. <code>JsonItemReader</code></a></li>
<li><a href="#code-jsonfileitemwriter-code">1.8.2. <code>JsonFileItemWriter</code></a></li>
</ul>
</li>
<li><a href="#multiFileInput">1.9. Multi-File Input</a></li>
<li><a href="#database">1.10. Database</a>
<ul class="sectlevel3">
<li><a href="#cursorBasedItemReaders">1.10.1. Cursor-based <code>ItemReader</code> Implementations</a>
<ul class="sectlevel4">
<li><a href="#JdbcCursorItemReader"><code>JdbcCursorItemReader</code></a></li>
<li><a href="#HibernateCursorItemReader"><code>HibernateCursorItemReader</code></a></li>
<li><a href="#StoredProcedureItemReader"><code>StoredProcedureItemReader</code></a></li>
</ul>
</li>
<li><a href="#pagingItemReaders">1.10.2. Paging <code>ItemReader</code> Implementations</a>
<ul class="sectlevel4">
<li><a href="#JdbcPagingItemReader"><code>JdbcPagingItemReader</code></a></li>
<li><a href="#JpaPagingItemReader"><code>JpaPagingItemReader</code></a></li>
</ul>
</li>
<li><a href="#databaseItemWriters">1.10.3. Database ItemWriters</a></li>
</ul>
</li>
<li><a href="#reusingExistingServices">1.11. Reusing Existing Services</a></li>
<li><a href="#validatingInput">1.12. Validating Input</a></li>
<li><a href="#process-indicator">1.13. Preventing State Persistence</a></li>
<li><a href="#customReadersWriters">1.14. Creating Custom ItemReaders and ItemWriters</a>
<ul class="sectlevel3">
<li><a href="#customReader">1.14.1. Custom <code>ItemReader</code> Example</a>
<ul class="sectlevel4">
<li><a href="#restartableReader">Making the <code>ItemReader</code> Restartable</a></li>
</ul>
</li>
<li><a href="#customWriter">1.14.2. Custom <code>ItemWriter</code> Example</a>
<ul class="sectlevel4">
<li><a href="#restartableWriter">Making the <code>ItemWriter</code> Restartable</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#itemReaderAndWriterImplementations">1.15. Item Reader and Writer Implementations</a>
<ul class="sectlevel3">
<li><a href="#decorators">1.15.1. Decorators</a>
<ul class="sectlevel4">
<li><a href="#synchronizedItemStreamReader"><code>SynchronizedItemStreamReader</code></a></li>
<li><a href="#singleItemPeekableItemReader"><code>SingleItemPeekableItemReader</code></a></li>
<li><a href="#multiResourceItemWriter"><code>MultiResourceItemWriter</code></a></li>
<li><a href="#classifierCompositeItemWriter"><code>ClassifierCompositeItemWriter</code></a></li>
<li><a href="#classifierCompositeItemProcessor"><code>ClassifierCompositeItemProcessor</code></a></li>
</ul>
</li>
<li><a href="#messagingReadersAndWriters">1.15.2. Messaging Readers And Writers</a>
<ul class="sectlevel4">
<li><a href="#amqpItemReader"><code>AmqpItemReader</code></a></li>
<li><a href="#amqpItemWriter"><code>AmqpItemWriter</code></a></li>
<li><a href="#jmsItemReader"><code>JmsItemReader</code></a></li>
<li><a href="#jmsItemWriter"><code>JmsItemWriter</code></a></li>
</ul>
</li>
<li><a href="#databaseReaders">1.15.3. Database Readers</a>
<ul class="sectlevel4">
<li><a href="#Neo4jItemReader"><code>Neo4jItemReader</code></a></li>
<li><a href="#mongoItemReader"><code>MongoItemReader</code></a></li>
<li><a href="#hibernateCursorItemReader"><code>HibernateCursorItemReader</code></a></li>
<li><a href="#hibernatePagingItemReader"><code>HibernatePagingItemReader</code></a></li>
<li><a href="#repositoryItemReader"><code>RepositoryItemReader</code></a></li>
</ul>
</li>
<li><a href="#databaseWriters">1.15.4. Database Writers</a>
<ul class="sectlevel4">
<li><a href="#neo4jItemWriter"><code>Neo4jItemWriter</code></a></li>
<li><a href="#mongoItemWriter"><code>MongoItemWriter</code></a></li>
<li><a href="#repositoryItemWriter"><code>RepositoryItemWriter</code></a></li>
<li><a href="#hibernateItemWriter"><code>HibernateItemWriter</code></a></li>
<li><a href="#jdbcBatchItemWriter"><code>JdbcBatchItemWriter</code></a></li>
<li><a href="#jpaItemWriter"><code>JpaItemWriter</code></a></li>
<li><a href="#gemfireItemWriter"><code>GemfireItemWriter</code></a></li>
</ul>
</li>
<li><a href="#specializedReaders">1.15.5. Specialized Readers</a>
<ul class="sectlevel4">
<li><a href="#ldifReader"><code>LdifReader</code></a></li>
<li><a href="#mappingLdifReader"><code>MappingLdifReader</code></a></li>
</ul>
</li>
<li><a href="#specializedWriters">1.15.6. Specialized Writers</a>
<ul class="sectlevel4">
<li><a href="#simpleMailMessageItemWriter"><code>SimpleMailMessageItemWriter</code></a></li>
</ul>
</li>
<li><a href="#specializedProcessors">1.15.7. Specialized Processors</a>
<ul class="sectlevel4">
<li><a href="#scriptItemProcessor"><code>ScriptItemProcessor</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="readersAndWriters"><a class="anchor" href="#readersAndWriters"></a>1. ItemReaders and ItemWriters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>
<div>
  <script type="text/javascript" src="jsfiles/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="jsfiles/js.cookie.js"></script>
  <script type="text/javascript" src="jsfiles/DocumentToggle.js"></script>
  <div class="docToggle-button">
    <input id="xmlButton" type="radio" name="docToggle" value="XML"><label for="xmlButton">XML</label>
    <input id="javaButton" type="radio" name="docToggle" value="Java" checked><label for="javaButton">Java</label>
    <!-- <input id="bothButton" type="radio" name="docToggle" value="Both" checked><label for="bothButton">Both</label> -->
  </div>
</div>
</p>
</div>
<div class="paragraph">
<p>All batch processing can be described in its most simple form as reading in large amounts
of data, performing some type of calculation or transformation, and writing the result
out. Spring Batch provides three key interfaces to help perform bulk reading and writing:
<code>ItemReader</code>, <code>ItemProcessor</code>, and <code>ItemWriter</code>.</p>
</div>
<div class="sect2">
<h3 id="itemReader"><a class="anchor" href="#itemReader"></a>1.1. <code>ItemReader</code></h3>
<div class="paragraph">
<p>Although a simple concept, an <code>ItemReader</code> is the means for providing data from many
different types of input. The most general examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flat File: Flat-file item readers read lines of data from a flat file that typically
describes records with fields of data defined by fixed positions in the file or delimited
by some special character (such as a comma).</p>
</li>
<li>
<p>XML: XML <code>ItemReaders</code> process XML independently of technologies used for parsing,
mapping and validating objects. Input data allows for the validation of an XML file
against an XSD schema.</p>
</li>
<li>
<p>Database: A database resource is accessed to return resultsets which can be mapped to
objects for processing. The default SQL <code>ItemReader</code> implementations invoke a <code>RowMapper</code>
to return objects, keep track of the current row if restart is required, store basic
statistics, and provide some transaction enhancements that are explained later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are many more possibilities, but we focus on the basic ones for this chapter. A
complete list of all available <code>ItemReader</code> implementations can be found in
<a href="appendix.html#listOfReadersAndWriters">Appendix A</a>.</p>
</div>
<div class="paragraph">
<p><code>ItemReader</code> is a basic interface for generic
input operations, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemReader</span>&lt;T&gt; {

    T read() <span class="directive">throws</span> <span class="exception">Exception</span>, UnexpectedInputException, <span class="exception">ParseException</span>, NonTransientResourceException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>read</code> method defines the most essential contract of the <code>ItemReader</code>. Calling it
returns one item or <code>null</code> if no more items are left. An item might represent a line in a
file, a row in a database, or an element in an XML file. It is generally expected that
these are mapped to a usable domain object (such as <code>Trade</code>, <code>Foo</code>, or others), but there
is no requirement in the contract to do so.</p>
</div>
<div class="paragraph">
<p>It is expected that implementations of the <code>ItemReader</code> interface are forward only.
However, if the underlying resource is transactional (such as a JMS queue) then calling
<code>read</code> may return the same logical item on subsequent calls in a rollback scenario. It is
also worth noting that a lack of items to process by an <code>ItemReader</code> does not cause an
exception to be thrown. For example, a database <code>ItemReader</code> that is configured with a
query that returns 0 results returns <code>null</code> on the first invocation of read.</p>
</div>
</div>
<div class="sect2">
<h3 id="itemWriter"><a class="anchor" href="#itemWriter"></a>1.2. <code>ItemWriter</code></h3>
<div class="paragraph">
<p><code>ItemWriter</code> is similar in functionality to an <code>ItemReader</code> but with inverse operations.
Resources still need to be located, opened, and closed but they differ in that an
<code>ItemWriter</code> writes out, rather than reading in. In the case of databases or queues,
these operations may be inserts, updates, or sends. The format of the serialization of
the output is specific to each batch job.</p>
</div>
<div class="paragraph">
<p>As with <code>ItemReader</code>,
<code>ItemWriter</code> is a fairly generic interface, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemWriter</span>&lt;T&gt; {

    <span class="type">void</span> write(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> T&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>read</code> on <code>ItemReader</code>, <code>write</code> provides the basic contract of <code>ItemWriter</code>. It
attempts to write out the list of items passed in as long as it is open. Because it is
generally expected that items are 'batched' together into a chunk and then output, the
interface accepts a list of items, rather than an item by itself. After writing out the
list, any flushing that may be necessary can be performed before returning from the write
method. For example, if writing to a Hibernate DAO, multiple calls to write can be made,
one for each item. The writer can then call <code>flush</code> on the hibernate session before
returning.</p>
</div>
</div>
<div class="sect2">
<h3 id="itemProcessor"><a class="anchor" href="#itemProcessor"></a>1.3. <code>ItemProcessor</code></h3>
<div class="paragraph">
<p>The <code>ItemReader</code> and <code>ItemWriter</code> interfaces are both very useful for their specific
tasks, but what if you want to insert business logic before writing? One option for both
reading and writing is to use the composite pattern: Create an <code>ItemWriter</code> that contains
another <code>ItemWriter</code> or an <code>ItemReader</code> that contains another <code>ItemReader</code>. The following
code shows an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CompositeItemWriter</span>&lt;T&gt; <span class="directive">implements</span> ItemWriter&lt;T&gt; {

    ItemWriter&lt;T&gt; itemWriter;

    <span class="directive">public</span> CompositeItemWriter(ItemWriter&lt;T&gt; itemWriter) {
        <span class="local-variable">this</span>.itemWriter = itemWriter;
    }

    <span class="directive">public</span> <span class="type">void</span> write(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> T&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">//Add business logic here</span>
       itemWriter.write(items);
    }

    <span class="directive">public</span> <span class="type">void</span> setDelegate(ItemWriter&lt;T&gt; itemWriter){
        <span class="local-variable">this</span>.itemWriter = itemWriter;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding class contains another <code>ItemWriter</code> to which it delegates after having
provided some business logic. This pattern could easily be used for an <code>ItemReader</code> as
well, perhaps to obtain more reference data based upon the input that was provided by the
main <code>ItemReader</code>. It is also useful if you need to control the call to <code>write</code> yourself.
However, if you only want to 'transform' the item passed in for writing before it is
actually written, you need not <code>write</code> yourself. You can just modify the item. For this
scenario, Spring Batch provides the <code>ItemProcessor</code> interface, as shown in the following
interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemProcessor</span>&lt;I, O&gt; {

    O process(I item) <span class="directive">throws</span> <span class="exception">Exception</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>ItemProcessor</code> is simple. Given one object, transform it and return another. The
provided object may or may not be of the same type. The point is that business logic may
be applied within the process, and it is completely up to the developer to create that
logic. An <code>ItemProcessor</code> can be wired directly into a step. For example, assume an
<code>ItemReader</code> provides a class of type <code>Foo</code> and that it needs to be converted to type <code>Bar</code>
before being written out. The following example shows an <code>ItemProcessor</code> that performs
the conversion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Foo</span> {}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Bar</span> {
    <span class="directive">public</span> Bar(Foo foo) {}
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">FooProcessor</span> <span class="directive">implements</span> ItemProcessor&lt;Foo,Bar&gt;{
    <span class="directive">public</span> Bar process(Foo foo) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">//Perform simple transformation, convert a Foo to a Bar</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Bar(foo);
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">BarWriter</span> <span class="directive">implements</span> ItemWriter&lt;Bar&gt;{
    <span class="directive">public</span> <span class="type">void</span> write(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> Bar&gt; bars) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">//write bars</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, there is a class <code>Foo</code>, a class <code>Bar</code>, and a class
<code>FooProcessor</code> that adheres to the <code>ItemProcessor</code> interface. The transformation is
simple, but any type of transformation could be done here. The <code>BarWriter</code> writes <code>Bar</code>
objects, throwing an exception if any other type is provided. Similarly, the
<code>FooProcessor</code> throws an exception if anything but a <code>Foo</code> is provided. The
<code>FooProcessor</code> can then be injected into a <code>Step</code>, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ioSampleJob</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">processor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooProcessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barWriter</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job ioSampleJob() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">ioSampleJOb</span><span class="delimiter">&quot;</span></span>)
                                .start(step1())
                                .end()
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(fooReader())
                                .processor(fooProcessor())
                                .writer(barWriter())
                                .build();
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="chainingItemProcessors"><a class="anchor" href="#chainingItemProcessors"></a>1.3.1. Chaining ItemProcessors</h4>
<div class="paragraph">
<p>Performing a single transformation is useful in many scenarios, but what if you want to
'chain' together multiple <code>ItemProcessor</code> implementations? This can be accomplished using
the composite pattern mentioned previously. To update the previous, single
transformation, example, <code>Foo</code> is transformed to <code>Bar</code>, which is transformed to <code>Foobar</code>
and written out, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Foo</span> {}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Bar</span> {
    <span class="directive">public</span> Bar(Foo foo) {}
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Foobar</span> {
    <span class="directive">public</span> Foobar(Bar bar) {}
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">FooProcessor</span> <span class="directive">implements</span> ItemProcessor&lt;Foo,Bar&gt;{
    <span class="directive">public</span> Bar process(Foo foo) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">//Perform simple transformation, convert a Foo to a Bar</span>
        <span class="keyword">return</span> <span class="keyword">new</span> Bar(foo);
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">BarProcessor</span> <span class="directive">implements</span> ItemProcessor&lt;Bar,Foobar&gt;{
    <span class="directive">public</span> Foobar process(Bar bar) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> Foobar(bar);
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">FoobarWriter</span> <span class="directive">implements</span> ItemWriter&lt;Foobar&gt;{
    <span class="directive">public</span> <span class="type">void</span> write(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> Foobar&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">//write items</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>FooProcessor</code> and a <code>BarProcessor</code> can be 'chained' together to give the resultant
<code>Foobar</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CompositeItemProcessor&lt;Foo,Foobar&gt; compositeProcessor =
                                      <span class="keyword">new</span> CompositeItemProcessor&lt;Foo,Foobar&gt;();
<span class="predefined-type">List</span> itemProcessors = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>();
itemProcessors.add(<span class="keyword">new</span> FooTransformer());
itemProcessors.add(<span class="keyword">new</span> BarTransformer());
compositeProcessor.setDelegates(itemProcessors);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as with the previous example, the composite processor can be configured into the
<code>Step</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ioSampleJob</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">processor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositeItemProcessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foobarWriter</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositeItemProcessor</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.support.CompositeItemProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">delegates</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">..FooProcessor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">..BarProcessor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job ioSampleJob() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">ioSampleJob</span><span class="delimiter">&quot;</span></span>)
                                .start(step1())
                                .end()
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(fooReader())
                                .processor(compositeProcessor())
                                .writer(foobarWriter())
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> CompositeItemProcessor compositeProcessor() {
        <span class="predefined-type">List</span>&lt;ItemProcessor&gt; delegates = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(<span class="integer">2</span>);
        delegates.add(<span class="keyword">new</span> FooProcessor());
        delegates.add(<span class="keyword">new</span> BarProcessor());

        CompositeItemProcessor processor = <span class="keyword">new</span> CompositeItemProcessor();

        processor.setDelegates(delegates);

        <span class="keyword">return</span> processor;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="filteringRecords"><a class="anchor" href="#filteringRecords"></a>1.3.2. Filtering Records</h4>
<div class="paragraph">
<p>One typical use for an item processor is to filter out records before they are passed to
the <code>ItemWriter</code>. Filtering is an action distinct from skipping. Skipping indicates that
a record is invalid, while filtering simply indicates that a record should not be
written.</p>
</div>
<div class="paragraph">
<p>For example, consider a batch job that reads a file containing three different types of
records: records to insert, records to update, and records to delete. If record deletion
is not supported by the system, then we would not want to send any "delete" records to
the <code>ItemWriter</code>. But, since these records are not actually bad records, we would want to
filter them out rather than skip them. As a result, the <code>ItemWriter</code> would receive only
"insert" and "update" records.</p>
</div>
<div class="paragraph">
<p>To filter a record, you can return <code>null</code> from the <code>ItemProcessor</code>. The framework detects
that the result is <code>null</code> and avoids adding that item to the list of records delivered to
the <code>ItemWriter</code>. As usual, an exception thrown from the <code>ItemProcessor</code> results in a
skip.</p>
</div>
</div>
<div class="sect3">
<h4 id="faultTolerant"><a class="anchor" href="#faultTolerant"></a>1.3.3. Fault Tolerance</h4>
<div class="paragraph">
<p>When a chunk is rolled back, items that have been cached during reading may be
reprocessed.  If a step is configured to be fault tolerant (typically by using skip or
retry processing), any <code>ItemProcessor</code> used should be implemented in a way that is
idempotent.  Typically that would consist of performing no changes on the input item for
the <code>ItemProcessor</code> and only updating the
instance that is the result.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="itemStream"><a class="anchor" href="#itemStream"></a>1.4. <code>ItemStream</code></h3>
<div class="paragraph">
<p>Both <code>ItemReaders</code> and <code>ItemWriters</code> serve their individual purposes well, but there is a
common concern among both of them that necessitates another interface. In general, as
part of the scope of a batch job, readers and writers need to be opened, closed, and
require a mechanism for persisting state. The <code>ItemStream</code> interface serves that purpose,
as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemStream</span> {

    <span class="type">void</span> open(ExecutionContext executionContext) <span class="directive">throws</span> ItemStreamException;

    <span class="type">void</span> update(ExecutionContext executionContext) <span class="directive">throws</span> ItemStreamException;

    <span class="type">void</span> close() <span class="directive">throws</span> ItemStreamException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before describing each method, we should mention the <code>ExecutionContext</code>. Clients of an
<code>ItemReader</code> that also implement <code>ItemStream</code> should call <code>open</code> before any calls to
<code>read</code>, in order to open any resources such as files or to obtain connections. A similar
restriction applies to an <code>ItemWriter</code> that implements <code>ItemStream</code>. As mentioned in
Chapter 2, if expected data is found in the <code>ExecutionContext</code>, it may be used to start
the <code>ItemReader</code> or <code>ItemWriter</code> at a location other than its initial state. Conversely,
<code>close</code> is called to ensure that any resources allocated during open are released safely.
<code>update</code> is called primarily to ensure that any state currently being held is loaded into
the provided <code>ExecutionContext</code>. This method is called before committing, to ensure that
the current state is persisted in the database before commit.</p>
</div>
<div class="paragraph">
<p>In the special case where the client of an <code>ItemStream</code> is a <code>Step</code> (from the Spring
Batch Core), an <code>ExecutionContext</code> is created for each StepExecution to allow users to
store the state of a particular execution, with the expectation that it is returned if
the same <code>JobInstance</code> is started again. For those familiar with Quartz, the semantics
are very similar to a Quartz <code>JobDataMap</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="delegatePatternAndRegistering"><a class="anchor" href="#delegatePatternAndRegistering"></a>1.5. The Delegate Pattern and Registering with the Step</h3>
<div class="paragraph">
<p>Note that the <code>CompositeItemWriter</code> is an example of the delegation pattern, which is
common in Spring Batch. The delegates themselves might implement callback interfaces,
such as <code>StepListener</code>. If they do and if they are being used in conjunction with Spring
Batch Core as part of a <code>Step</code> in a <code>Job</code>, then they almost certainly need to be
registered manually with the <code>Step</code>. A reader, writer, or processor that is directly
wired into the <code>Step</code> gets registered automatically if it implements <code>ItemStream</code> or a
<code>StepListener</code> interface. However, because the delegates are not known to the <code>Step</code>,
they need to be injected as listeners or streams (or both if appropriate), as shown in
the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ioSampleJob</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">processor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooProcessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositeItemWriter</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;streams&gt;</span>
                    <span class="tag">&lt;stream</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barWriter</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/streams&gt;</span>
            <span class="tag">&lt;/chunk&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositeItemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...CustomCompositeItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">delegate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barWriter</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...BarWriter</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job ioSampleJob() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">ioSampleJob</span><span class="delimiter">&quot;</span></span>)
                                .start(step1())
                                .end()
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(fooReader())
                                .processor(fooProcessor())
                                .writer(compositeItemWriter())
                                .stream(barWriter())
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> CustomCompositeItemWriter compositeItemWriter() {

        CustomCompositeItemWriter writer = <span class="keyword">new</span> CustomCompositeItemWriter();

        writer.setDelegate(barWriter());

        <span class="keyword">return</span> writer;
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> BarWriter barWriter() {
        <span class="keyword">return</span> <span class="keyword">new</span> BarWriter();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flatFiles"><a class="anchor" href="#flatFiles"></a>1.6. Flat Files</h3>
<div class="paragraph">
<p>One of the most common mechanisms for interchanging bulk data has always been the flat
file. Unlike XML, which has an agreed upon standard for defining how it is structured
(XSD), anyone reading a flat file must understand ahead of time exactly how the file is
structured. In general, all flat files fall into two types: delimited and fixed length.
Delimited files are those in which fields are separated by a delimiter, such as a comma.
Fixed Length files have fields that are a set length.</p>
</div>
<div class="sect3">
<h4 id="fieldSet"><a class="anchor" href="#fieldSet"></a>1.6.1. The <code>FieldSet</code></h4>
<div class="paragraph">
<p>When working with flat files in Spring Batch, regardless of whether it is for input or
output, one of the most important classes is the <code>FieldSet</code>. Many architectures and
libraries contain abstractions for helping you read in from a file, but they usually
return a <code>String</code> or an array of <code>String</code> objects. This really only gets you halfway
there. A <code>FieldSet</code> is Spring Batch&#8217;s abstraction for enabling the binding of fields from
a file resource. It allows developers to work with file input in much the same way as
they would work with database input. A <code>FieldSet</code> is conceptually similar to a JDBC
<code>ResultSet</code>. A <code>FieldSet</code> requires only one argument: a <code>String</code> array of tokens.
Optionally, you can also configure the names of the fields so that the fields may be
accessed either by index or name as patterned after <code>ResultSet</code>, as shown in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span><span class="type">[]</span> tokens = <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>};
FieldSet fs = <span class="keyword">new</span> DefaultFieldSet(tokens);
<span class="predefined-type">String</span> name = fs.readString(<span class="integer">0</span>);
<span class="type">int</span> value = fs.readInt(<span class="integer">1</span>);
<span class="type">boolean</span> booleanValue = fs.readBoolean(<span class="integer">2</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are many more options on the <code>FieldSet</code> interface, such as <code>Date</code>, long,
<code>BigDecimal</code>, and so on. The biggest advantage of the <code>FieldSet</code> is that it provides
consistent parsing of flat file input. Rather than each batch job parsing differently in
potentially unexpected ways, it can be consistent, both when handling errors caused by a
format exception, or when doing simple data conversions.</p>
</div>
</div>
<div class="sect3">
<h4 id="flatFileItemReader"><a class="anchor" href="#flatFileItemReader"></a>1.6.2. <code>FlatFileItemReader</code></h4>
<div class="paragraph">
<p>A flat file is any type of file that contains at most two-dimensional (tabular) data.
Reading flat files in the Spring Batch framework is facilitated by the class called
<code>FlatFileItemReader</code>, which provides basic functionality for reading and parsing flat
files. The two most important required dependencies of <code>FlatFileItemReader</code> are
<code>Resource</code> and <code>LineMapper</code>. The <code>LineMapper</code> interface is explored more in the next
sections. The resource property represents a Spring Core <code>Resource</code>. Documentation
explaining how to create beans of this type can be found in
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#resources">Spring
Framework, Chapter 5. Resources</a>. Therefore, this guide does not go into the details of
creating <code>Resource</code> objects beyond showing the following simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Resource resource = <span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">resources/trades.csv</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In complex batch environments, the directory structures are often managed by the EAI
infrastructure, where drop zones for external interfaces are established for moving files
from FTP locations to batch processing locations and vice versa. File moving utilities
are beyond the scope of the Spring Batch architecture, but it is not unusual for batch
job streams to include file moving utilities as steps in the job stream. The batch
architecture only needs to know how to locate the files to be processed. Spring Batch
begins the process of feeding the data into the pipe from this starting point. However,
<a href="https://projects.spring.io/spring-integration/">Spring Integration</a> provides many
of these types of services.</p>
</div>
<div class="paragraph">
<p>The other properties in <code>FlatFileItemReader</code> let you further specify how your data is
interpreted, as described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. <code>FlatFileItemReader</code> Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies line prefixes that indicate comment rows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies what text encoding to use. The default is the value of <code>Charset.defaultCharset()</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lineMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LineMapper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts a <code>String</code> to an <code>Object</code> representing the item.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linesToSkip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of lines to ignore at the top of the file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recordSeparatorPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RecordSeparatorPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to determine where the line endings are
and do things like continue over a line ending if inside a quoted string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Resource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resource from which to read.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skippedLinesCallback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LineCallbackHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface that passes the raw line content of
the lines in the file to be skipped. If <code>linesToSkip</code> is set to 2, then this interface is
called twice.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strict</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In strict mode, the reader throws an exception on <code>ExecutionContext</code> if
the input resource does not exist. Otherwise, it logs the problem and continues.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="lineMapper"><a class="anchor" href="#lineMapper"></a><code>LineMapper</code></h5>
<div class="paragraph">
<p>As with <code>RowMapper</code>, which takes a low-level construct such as <code>ResultSet</code> and returns
an <code>Object</code>, flat file processing requires the same construct to convert a <code>String</code> line
into an <code>Object</code>, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">LineMapper</span>&lt;T&gt; {

    T mapLine(<span class="predefined-type">String</span> line, <span class="type">int</span> lineNumber) <span class="directive">throws</span> <span class="exception">Exception</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic contract is that, given the current line and the line number with which it is
associated, the mapper should return a resulting domain object. This is similar to
<code>RowMapper</code>, in that each line is associated with its line number, just as each row in a
<code>ResultSet</code> is tied to its row number. This allows the line number to be tied to the
resulting domain object for identity comparison or for more informative logging. However,
unlike <code>RowMapper</code>, the <code>LineMapper</code> is given a raw line which, as discussed above, only
gets you halfway there. The line must be tokenized into a <code>FieldSet</code>, which can then be
mapped to an object, as described later in this document.</p>
</div>
</div>
<div class="sect4">
<h5 id="lineTokenizer"><a class="anchor" href="#lineTokenizer"></a><code>LineTokenizer</code></h5>
<div class="paragraph">
<p>An abstraction for turning a line of input into a <code>FieldSet</code> is necessary because there
can be many formats of flat file data that need to be converted to a <code>FieldSet</code>. In
Spring Batch, this interface is the <code>LineTokenizer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">LineTokenizer</span> {

    FieldSet tokenize(<span class="predefined-type">String</span> line);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contract of a <code>LineTokenizer</code> is such that, given a line of input (in theory the
<code>String</code> could encompass more than one line), a <code>FieldSet</code> representing the line is
returned. This <code>FieldSet</code> can then be passed to a <code>FieldSetMapper</code>. Spring Batch contains
the following <code>LineTokenizer</code> implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DelimitedLineTokenizer</code>: Used for files where fields in a record are separated by a
delimiter. The most common delimiter is a comma, but pipes or semicolons are often used
as well.</p>
</li>
<li>
<p><code>FixedLengthTokenizer</code>: Used for files where fields in a record are each a "fixed
width". The width of each field must be defined for each record type.</p>
</li>
<li>
<p><code>PatternMatchingCompositeLineTokenizer</code>: Determines which <code>LineTokenizer</code> among a list of
tokenizers should be used on a particular line by checking against a pattern.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="fieldSetMapper"><a class="anchor" href="#fieldSetMapper"></a><code>FieldSetMapper</code></h5>
<div class="paragraph">
<p>The <code>FieldSetMapper</code> interface defines a single method, <code>mapFieldSet</code>, which takes a
<code>FieldSet</code> object and maps its contents to an object. This object may be a custom DTO, a
domain object, or an array, depending on the needs of the job. The <code>FieldSetMapper</code> is
used in conjunction with the <code>LineTokenizer</code> to translate a line of data from a resource
into an object of the desired type, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">FieldSetMapper</span>&lt;T&gt; {

    T mapFieldSet(FieldSet fieldSet) <span class="directive">throws</span> <span class="exception">BindException</span>;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pattern used is the same as the <code>RowMapper</code> used by <code>JdbcTemplate</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="defaultLineMapper"><a class="anchor" href="#defaultLineMapper"></a><code>DefaultLineMapper</code></h5>
<div class="paragraph">
<p>Now that the basic interfaces for reading in flat files have been defined, it becomes
clear that three basic steps are required:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read one line from the file.</p>
</li>
<li>
<p>Pass the <code>String</code> line into the <code>LineTokenizer#tokenize()</code> method to retrieve a
<code>FieldSet</code>.</p>
</li>
<li>
<p>Pass the <code>FieldSet</code> returned from tokenizing to a <code>FieldSetMapper</code>, returning the
result from the <code>ItemReader#read()</code> method.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The two interfaces described above represent two separate tasks: converting a line into a
<code>FieldSet</code> and mapping a <code>FieldSet</code> to a domain object. Because the input of a
<code>LineTokenizer</code> matches the input of the <code>LineMapper</code> (a line), and the output of a
<code>FieldSetMapper</code> matches the output of the <code>LineMapper</code>, a default implementation that
uses both a <code>LineTokenizer</code> and a <code>FieldSetMapper</code> is provided. The <code>DefaultLineMapper</code>,
shown in the following class definition, represents the behavior most users need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultLineMapper</span>&lt;T&gt; <span class="directive">implements</span> LineMapper&lt;&gt;, InitializingBean {

    <span class="directive">private</span> LineTokenizer tokenizer;

    <span class="directive">private</span> FieldSetMapper&lt;T&gt; fieldSetMapper;

    <span class="directive">public</span> T mapLine(<span class="predefined-type">String</span> line, <span class="type">int</span> lineNumber) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> fieldSetMapper.mapFieldSet(tokenizer.tokenize(line));
    }

    <span class="directive">public</span> <span class="type">void</span> setLineTokenizer(LineTokenizer tokenizer) {
        <span class="local-variable">this</span>.tokenizer = tokenizer;
    }

    <span class="directive">public</span> <span class="type">void</span> setFieldSetMapper(FieldSetMapper&lt;T&gt; fieldSetMapper) {
        <span class="local-variable">this</span>.fieldSetMapper = fieldSetMapper;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above functionality is provided in a default implementation, rather than being built
into the reader itself (as was done in previous versions of the framework) to allow users
greater flexibility in controlling the parsing process, especially if access to the raw
line is needed.</p>
</div>
</div>
<div class="sect4">
<h5 id="simpleDelimitedFileReadingExample"><a class="anchor" href="#simpleDelimitedFileReadingExample"></a>Simple Delimited File Reading Example</h5>
<div class="paragraph">
<p>The following example illustrates how to read a flat file with an actual domain scenario.
This particular batch job reads in football players from the following file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ID,lastName,firstName,position,birthYear,debutYear
"AbduKa00,Abdul-Jabbar,Karim,rb,1974,1996",
"AbduRa00,Abdullah,Rabih,rb,1975,1999",
"AberWa00,Abercrombie,Walter,rb,1959,1982",
"AbraDa00,Abramowicz,Danny,wr,1945,1967",
"AdamBo00,Adams,Bob,te,1946,1969",
"AdamCh00,Adams,Charlie,wr,1979,2003"</pre>
</div>
</div>
<div class="paragraph">
<p>The contents of this file are mapped to the following
<code>Player</code> domain object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Player</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> ID;
    <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="predefined-type">String</span> position;
    <span class="directive">private</span> <span class="type">int</span> birthYear;
    <span class="directive">private</span> <span class="type">int</span> debutYear;

    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">PLAYER:ID=</span><span class="delimiter">&quot;</span></span> + ID + <span class="string"><span class="delimiter">&quot;</span><span class="content">,Last Name=</span><span class="delimiter">&quot;</span></span> + lastName +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">,First Name=</span><span class="delimiter">&quot;</span></span> + firstName + <span class="string"><span class="delimiter">&quot;</span><span class="content">,Position=</span><span class="delimiter">&quot;</span></span> + position +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">,Birth Year=</span><span class="delimiter">&quot;</span></span> + birthYear + <span class="string"><span class="delimiter">&quot;</span><span class="content">,DebutYear=</span><span class="delimiter">&quot;</span></span> +
            debutYear;
    }

    <span class="comment">// setters and getters...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To map a <code>FieldSet</code> into a <code>Player</code> object, a <code>FieldSetMapper</code> that returns players needs
to be defined, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">PlayerFieldSetMapper</span> <span class="directive">implements</span> FieldSetMapper&lt;Player&gt; {
    <span class="directive">public</span> Player mapFieldSet(FieldSet fieldSet) {
        Player player = <span class="keyword">new</span> Player();

        player.setID(fieldSet.readString(<span class="integer">0</span>));
        player.setLastName(fieldSet.readString(<span class="integer">1</span>));
        player.setFirstName(fieldSet.readString(<span class="integer">2</span>));
        player.setPosition(fieldSet.readString(<span class="integer">3</span>));
        player.setBirthYear(fieldSet.readInt(<span class="integer">4</span>));
        player.setDebutYear(fieldSet.readInt(<span class="integer">5</span>));

        <span class="keyword">return</span> player;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file can then be read by correctly constructing a <code>FlatFileItemReader</code> and calling
<code>read</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FlatFileItemReader&lt;Player&gt; itemReader = <span class="keyword">new</span> FlatFileItemReader&lt;Player&gt;();
itemReader.setResource(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">resources/players.csv</span><span class="delimiter">&quot;</span></span>));
<span class="comment">//DelimitedLineTokenizer defaults to comma as its delimiter</span>
DefaultLineMapper&lt;Player&gt; lineMapper = <span class="keyword">new</span> DefaultLineMapper&lt;Player&gt;();
lineMapper.setLineTokenizer(<span class="keyword">new</span> DelimitedLineTokenizer());
lineMapper.setFieldSetMapper(<span class="keyword">new</span> PlayerFieldSetMapper());
itemReader.setLineMapper(lineMapper);
itemReader.open(<span class="keyword">new</span> ExecutionContext());
Player player = itemReader.read();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each call to <code>read</code> returns a new
        <code>Player</code> object from each line in the file. When the end of the file is
        reached, <code>null</code> is returned.</p>
</div>
</div>
<div class="sect4">
<h5 id="mappingFieldsByName"><a class="anchor" href="#mappingFieldsByName"></a>Mapping Fields by Name</h5>
<div class="paragraph">
<p>There is one additional piece of functionality that is allowed by both
<code>DelimitedLineTokenizer</code> and <code>FixedLengthTokenizer</code> and that is similar in function to a
JDBC <code>ResultSet</code>. The names of the fields can be injected into either of these
<code>LineTokenizer</code> implementations to increase the readability of the mapping function.
First, the column names of all fields in the flat file are injected into the tokenizer,
as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tokenizer.setNames(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">birthYear</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">debutYear</span><span class="delimiter">&quot;</span></span>});</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>FieldSetMapper</code> can use this information as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PlayerMapper</span> <span class="directive">implements</span> FieldSetMapper&lt;Player&gt; {
    <span class="directive">public</span> Player mapFieldSet(FieldSet fs) {

       <span class="keyword">if</span>(fs == <span class="predefined-constant">null</span>){
           <span class="keyword">return</span> <span class="predefined-constant">null</span>;
       }

       Player player = <span class="keyword">new</span> Player();
       player.setID(fs.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>));
       player.setLastName(fs.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>));
       player.setFirstName(fs.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>));
       player.setPosition(fs.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">position</span><span class="delimiter">&quot;</span></span>));
       player.setDebutYear(fs.readInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">debutYear</span><span class="delimiter">&quot;</span></span>));
       player.setBirthYear(fs.readInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthYear</span><span class="delimiter">&quot;</span></span>));

       <span class="keyword">return</span> player;
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="beanWrapperFieldSetMapper"><a class="anchor" href="#beanWrapperFieldSetMapper"></a>Automapping FieldSets to Domain Objects</h5>
<div class="paragraph">
<p>For many, having to write a specific <code>FieldSetMapper</code> is equally as cumbersome as writing
a specific <code>RowMapper</code> for a <code>JdbcTemplate</code>. Spring Batch makes this easier by providing
a <code>FieldSetMapper</code> that automatically maps fields by matching a field name with a setter
on the object using the JavaBean specification. Again using the football example, the
<code>BeanWrapperFieldSetMapper</code> configuration looks like the following snippet:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fieldSetMapper</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototypeBeanName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.Player</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FieldSetMapper fieldSetMapper() {
        BeanWrapperFieldSetMapper fieldSetMapper = <span class="keyword">new</span> BeanWrapperFieldSetMapper();

        fieldSetMapper.setPrototypeBeanName(<span class="string"><span class="delimiter">&quot;</span><span class="content">player</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> fieldSetMapper;
}

<span class="annotation">@Bean</span>
<span class="annotation">@Scope</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Player player() {
        <span class="keyword">return</span> <span class="keyword">new</span> Player();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each entry in the <code>FieldSet</code>, the mapper looks for a corresponding setter on a new
instance of the <code>Player</code> object (for this reason, prototype scope is required) in the
same way the Spring container looks for setters matching a property name. Each available
field in the <code>FieldSet</code> is mapped, and the resultant <code>Player</code> object is returned, with no
code required.</p>
</div>
</div>
<div class="sect4">
<h5 id="fixedLengthFileFormats"><a class="anchor" href="#fixedLengthFileFormats"></a>Fixed Length File Formats</h5>
<div class="paragraph">
<p>So far, only delimited files have been discussed in much detail. However, they represent
only half of the file reading picture. Many organizations that use flat files use fixed
length formats. An example fixed length file follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>UK21341EAH4121131.11customer1
UK21341EAH4221232.11customer2
UK21341EAH4321333.11customer3
UK21341EAH4421434.11customer4
UK21341EAH4521535.11customer5</pre>
</div>
</div>
<div class="paragraph">
<p>While this looks like one large field, it actually represent 4 distinct fields:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ISIN: Unique identifier for the item being ordered - 12 characters long.</p>
</li>
<li>
<p>Quantity: Number of the item being ordered - 3 characters long.</p>
</li>
<li>
<p>Price: Price of the item - 5 characters long.</p>
</li>
<li>
<p>Customer: ID of the customer ordering the item - 9 characters long.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When configuring the <code>FixedLengthLineTokenizer</code>, each of these lengths must be provided
in the form of ranges, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fixedLengthLineTokenizer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.io.file.transform.FixedLengthTokenizer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISIN,Quantity,Price,Customer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">columns</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1-12, 13-15, 16-20, 21-29</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph xmlContent">
<p>Because the <code>FixedLengthLineTokenizer</code> uses the same <code>LineTokenizer</code> interface as
discussed above, it returns the same <code>FieldSet</code> as if a delimiter had been used. This
allows the same approaches to be used in handling its output, such as using the
<code>BeanWrapperFieldSetMapper</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Supporting the above syntax for ranges requires that a specialized property editor,
<code>RangeArrayPropertyEditor</code>, be configured in the <code>ApplicationContext</code>. However, this bean
is automatically declared in an <code>ApplicationContext</code> where the batch namespace is used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FixedLengthTokenizer fixedLengthTokenizer() {
        FixedLengthTokenizer tokenizer = <span class="keyword">new</span> FixedLengthTokenizer();

        tokenizer.setNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ISIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Price</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Customer</span><span class="delimiter">&quot;</span></span>);
        tokenizer.setColumns(<span class="keyword">new</span> Range(<span class="integer">1</span>-<span class="integer">12</span>),
                                                <span class="keyword">new</span> Range(<span class="integer">13</span>-<span class="integer">15</span>),
                                                <span class="keyword">new</span> Range(<span class="integer">16</span>-<span class="integer">20</span>),
                                                <span class="keyword">new</span> Range(<span class="integer">21</span>-<span class="integer">29</span>));

        <span class="keyword">return</span> tokenizer;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <code>FixedLengthLineTokenizer</code> uses the same <code>LineTokenizer</code> interface as
discussed above, it returns the same <code>FieldSet</code> as if a delimiter had been used. This
lets the same approaches be used in handling its output, such as using the
<code>BeanWrapperFieldSetMapper</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="prefixMatchingLineMapper"><a class="anchor" href="#prefixMatchingLineMapper"></a>Multiple Record Types within a Single File</h5>
<div class="paragraph">
<p>All of the file reading examples up to this point have all made a key assumption for
simplicity&#8217;s sake: all of the records in a file have the same format. However, this may
not always be the case. It is very common that a file might have records with different
formats that need to be tokenized differently and mapped to different objects. The
following excerpt from a file illustrates this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>USER;Smith;Peter;;T;20014539;F
LINEA;1044391041ABC037.49G201XX1383.12H
LINEB;2134776319DEF422.99M005LI</pre>
</div>
</div>
<div class="paragraph">
<p>In this file we have three types of records, "USER", "LINEA", and "LINEB". A "USER" line
corresponds to a <code>User</code> object. "LINEA" and "LINEB" both correspond to <code>Line</code> objects,
though a "LINEA" has more information than a "LINEB".</p>
</div>
<div class="paragraph">
<p>The <code>ItemReader</code> reads each line individually, but we must specify different
<code>LineTokenizer</code> and <code>FieldSetMapper</code> objects so that the <code>ItemWriter</code> receives the
correct items. The <code>PatternMatchingCompositeLineMapper</code> makes this easy by allowing maps
of patterns to <code>LineTokenizer</code> instances and patterns to <code>FieldSetMapper</code> instances to be
configured, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderFileLineMapper</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...PatternMatchingCompositeLineMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tokenizers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userTokenizer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LINEA*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lineATokenizer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LINEB*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lineBTokenizer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fieldSetMappers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userFieldSetMapper</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LINE*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lineFieldSetMapper</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> PatternMatchingCompositeLineMapper orderFileLineMapper() {
        PatternMatchingCompositeLineMapper lineMapper =
                <span class="keyword">new</span> PatternMatchingCompositeLineMapper();

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, LineTokenizer&gt; tokenizers = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;(<span class="integer">3</span>);
        tokenizers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">USER*</span><span class="delimiter">&quot;</span></span>, userTokenizer());
        tokenizers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">LINEA*</span><span class="delimiter">&quot;</span></span>, lineATokenizer());
        tokenizers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">LINEB*</span><span class="delimiter">&quot;</span></span>, lineBTokenizer());

        lineMapper.setTokenizers(tokenizers);

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, FieldSetMapper&gt; mappers = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;(<span class="integer">2</span>);
        mappers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">USER*</span><span class="delimiter">&quot;</span></span>, userFieldSetMapper());
        mappers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">LINE*</span><span class="delimiter">&quot;</span></span>, lineFieldSetMapper());

        lineMapper.setFieldSetMappers(mappers);

        <span class="keyword">return</span> lineMapper;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, "LINEA" and "LINEB" have separate <code>LineTokenizer</code> instances, but they both use
the same <code>FieldSetMapper</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PatternMatchingCompositeLineMapper</code> uses the <code>PatternMatcher#match</code> method
in order to select the correct delegate for each line. The <code>PatternMatcher</code> allows for
two wildcard characters with special meaning: the question mark ("?") matches exactly one
character, while the asterisk ("*") matches zero or more characters. Note that, in the
preceding configuration, all patterns end with an asterisk, making them effectively
prefixes  to lines. The <code>PatternMatcher</code> always matches the most specific pattern
possible, regardless of the order in the configuration. So if "LINE*" and "LINEA*" were
both listed as patterns, "LINEA" would match pattern "LINEA*", while "LINEB" would match
pattern "LINE*". Additionally, a single asterisk ("*") can serve as a default by matching
any line not matched by any other pattern, as shown in the following example.</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultLineTokenizer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
tokenizers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, defaultLineTokenizer());
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a <code>PatternMatchingCompositeLineTokenizer</code> that can be used for tokenization
alone.</p>
</div>
<div class="paragraph">
<p>It is also common for a flat file to contain records that each span multiple lines. To
handle this situation, a more complex strategy is required. A demonstration of this
common pattern can be found in the <code>multiLineRecords</code> sample.</p>
</div>
</div>
<div class="sect4">
<h5 id="exceptionHandlingInFlatFiles"><a class="anchor" href="#exceptionHandlingInFlatFiles"></a>Exception Handling in Flat Files</h5>
<div class="paragraph">
<p>There are many scenarios when tokenizing a line may cause exceptions to be thrown. Many
flat files are imperfect and contain incorrectly formatted records. Many users choose to
skip these erroneous lines while logging the issue, the original line, and the line
number. These logs can later be inspected manually or by another batch job. For this
reason, Spring Batch provides a hierarchy of exceptions for handling parse exceptions:
<code>FlatFileParseException</code> and <code>FlatFileFormatException</code>. <code>FlatFileParseException</code> is
thrown by the <code>FlatFileItemReader</code> when any errors are encountered while trying to read a
file. <code>FlatFileFormatException</code> is thrown by implementations of the <code>LineTokenizer</code>
interface and indicates a more specific error encountered while tokenizing.</p>
</div>
<div class="sect5">
<h6 id="incorrectTokenCountException"><a class="anchor" href="#incorrectTokenCountException"></a><code>IncorrectTokenCountException</code></h6>
<div class="paragraph">
<p>Both <code>DelimitedLineTokenizer</code> and <code>FixedLengthLineTokenizer</code> have the ability to specify
column names that can be used for creating a <code>FieldSet</code>. However, if the number of column
names does not match the number of columns found while tokenizing a line, the <code>FieldSet</code>
cannot be created, and an <code>IncorrectTokenCountException</code> is thrown, which contains the
number of tokens encountered, and the number expected, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tokenizer.setNames(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">C</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span>});

<span class="keyword">try</span> {
    tokenizer.tokenize(<span class="string"><span class="delimiter">&quot;</span><span class="content">a,b,c</span><span class="delimiter">&quot;</span></span>);
}
<span class="keyword">catch</span>(IncorrectTokenCountException e){
    assertEquals(<span class="integer">4</span>, e.getExpectedCount());
    assertEquals(<span class="integer">3</span>, e.getActualCount());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the tokenizer was configured with 4 column names but only 3 tokens were found in
the file, an <code>IncorrectTokenCountException</code> was thrown.</p>
</div>
</div>
<div class="sect5">
<h6 id="incorrectLineLengthException"><a class="anchor" href="#incorrectLineLengthException"></a><code>IncorrectLineLengthException</code></h6>
<div class="paragraph">
<p>Files formatted in a fixed-length format have additional requirements when parsing
because, unlike a delimited format, each column must strictly adhere to its predefined
width. If the total line length does not equal the widest value of this column, an
exception is thrown, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tokenizer.setColumns(<span class="keyword">new</span> Range<span class="type">[]</span> { <span class="keyword">new</span> Range(<span class="integer">1</span>, <span class="integer">5</span>),
                                   <span class="keyword">new</span> Range(<span class="integer">6</span>, <span class="integer">10</span>),
                                   <span class="keyword">new</span> Range(<span class="integer">11</span>, <span class="integer">15</span>) });
<span class="keyword">try</span> {
    tokenizer.tokenize(<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>);
    fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Expected IncorrectLineLengthException</span><span class="delimiter">&quot;</span></span>);
}
<span class="keyword">catch</span> (IncorrectLineLengthException ex) {
    assertEquals(<span class="integer">15</span>, ex.getExpectedLength());
    assertEquals(<span class="integer">5</span>, ex.getActualLength());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configured ranges for the tokenizer above are: 1-5, 6-10, and 11-15. Consequently,
the total length of the line is 15. However, in the preceding example, a line of length 5
was passed in, causing an <code>IncorrectLineLengthException</code> to be thrown. Throwing an
exception here rather than only mapping the first column allows the processing of the
line to fail earlier and with more information than it would contain if it failed while
trying to read in column 2 in a <code>FieldSetMapper</code>. However, there are scenarios where the
length of the line is not always constant. For this reason, validation of line length can
be turned off via the 'strict' property, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tokenizer.setColumns(<span class="keyword">new</span> Range<span class="type">[]</span> { <span class="keyword">new</span> Range(<span class="integer">1</span>, <span class="integer">5</span>), <span class="keyword">new</span> Range(<span class="integer">6</span>, <span class="integer">10</span>) });
tokenizer.setStrict(<span class="predefined-constant">false</span>);
FieldSet tokens = tokenizer.tokenize(<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>);
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>, tokens.readString(<span class="integer">0</span>));
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, tokens.readString(<span class="integer">1</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example is almost identical to the one before it, except that
<code>tokenizer.setStrict(false)</code> was called. This setting tells the tokenizer to not enforce
line lengths when tokenizing the line. A <code>FieldSet</code> is now correctly created and
returned. However, it contains only empty tokens for the remaining values.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="flatFileItemWriter"><a class="anchor" href="#flatFileItemWriter"></a>1.6.3. <code>FlatFileItemWriter</code></h4>
<div class="paragraph">
<p>Writing out to flat files has the same problems and issues that reading in from a file
must overcome. A step must be able to write either delimited or fixed length formats in a
transactional manner.</p>
</div>
<div class="sect4">
<h5 id="lineAggregator"><a class="anchor" href="#lineAggregator"></a><code>LineAggregator</code></h5>
<div class="paragraph">
<p>Just as the <code>LineTokenizer</code> interface is necessary to take an item and turn it into a
<code>String</code>, file writing must have a way to aggregate multiple fields into a single string
for writing to a file. In Spring Batch, this is the <code>LineAggregator</code>, shown in the
following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">LineAggregator</span>&lt;T&gt; {

    <span class="directive">public</span> <span class="predefined-type">String</span> aggregate(T item);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LineAggregator</code> is the logical opposite of <code>LineTokenizer</code>.  <code>LineTokenizer</code> takes a
<code>String</code> and returns a <code>FieldSet</code>, whereas <code>LineAggregator</code> takes an <code>item</code> and returns a
<code>String</code>.</p>
</div>
<div class="sect5">
<h6 id="PassThroughLineAggregator"><a class="anchor" href="#PassThroughLineAggregator"></a><code>PassThroughLineAggregator</code></h6>
<div class="paragraph">
<p>The most basic implementation of the <code>LineAggregator</code> interface is the
<code>PassThroughLineAggregator</code>, which assumes that the object is already a string or that
its string representation is acceptable for writing, as shown in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PassThroughLineAggregator</span>&lt;T&gt; <span class="directive">implements</span> LineAggregator&lt;T&gt; {

    <span class="directive">public</span> <span class="predefined-type">String</span> aggregate(T item) {
        <span class="keyword">return</span> item.toString();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding implementation is useful if direct control of creating the string is
required but the advantages of a <code>FlatFileItemWriter</code>, such as transaction and restart
support, are necessary.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="SimplifiedFileWritingExample"><a class="anchor" href="#SimplifiedFileWritingExample"></a>Simplified File Writing Example</h5>
<div class="paragraph">
<p>Now that the <code>LineAggregator</code> interface and its most basic implementation,
<code>PassThroughLineAggregator</code>, have been defined, the basic flow of writing can be
explained:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The object to be written is passed to the <code>LineAggregator</code> in order to obtain a
<code>String</code>.</p>
</li>
<li>
<p>The returned <code>String</code> is written to the configured file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following excerpt from the <code>FlatFileItemWriter</code> expresses this in code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> write(T item) <span class="directive">throws</span> <span class="exception">Exception</span> {
    write(lineAggregator.aggregate(item) + LINE_SEPARATOR);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A simple configuration might look like the following:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...FlatFileItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:target/test-outputs/output.txt</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lineAggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...PassThroughLineAggregator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemWriter itemWriter() {
        <span class="keyword">return</span>  <span class="keyword">new</span> FlatFileItemWriterBuilder&lt;Foo&gt;()
                                   .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span>)
                                   .resource(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">target/test-outputs/output.txt</span><span class="delimiter">&quot;</span></span>))
                                   .lineAggregator(<span class="keyword">new</span> PassThroughLineAggregator&lt;&gt;())
                                   .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="FieldExtractor"><a class="anchor" href="#FieldExtractor"></a><code>FieldExtractor</code></h5>
<div class="paragraph">
<p>The preceding example may be useful for the most basic uses of a writing to a file.
However, most users of the <code>FlatFileItemWriter</code> have a domain object that needs to be
written out and, thus, must be converted into a line. In file reading, the following was
required:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read one line from the file.</p>
</li>
<li>
<p>Pass the line into the <code>LineTokenizer#tokenize()</code> method, in order to retrieve a
<code>FieldSet</code>.</p>
</li>
<li>
<p>Pass the <code>FieldSet</code> returned from tokenizing to a <code>FieldSetMapper</code>, returning the
result from the <code>ItemReader#read()</code> method.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>File writing has similar but inverse steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass the item to be written to the writer.</p>
</li>
<li>
<p>Convert the fields on the item into an array.</p>
</li>
<li>
<p>Aggregate the resulting array into a line.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because there is no way for the framework to know which fields from the object need to
be written out, a <code>FieldExtractor</code> must be written to accomplish the task of turning the
item into an array, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">FieldExtractor</span>&lt;T&gt; {

    <span class="predefined-type">Object</span><span class="type">[]</span> extract(T item);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementations of the <code>FieldExtractor</code> interface should create an array from the fields
of the provided object, which can then be written out with a delimiter between the
elements or as part of a fixed-width line.</p>
</div>
<div class="sect5">
<h6 id="PassThroughFieldExtractor"><a class="anchor" href="#PassThroughFieldExtractor"></a><code>PassThroughFieldExtractor</code></h6>
<div class="paragraph">
<p>There are many cases where a collection, such as an array, <code>Collection</code>, or <code>FieldSet</code>,
needs to be written out. "Extracting" an array from one of these collection types is very
straightforward. To do so, convert the collection to an array. Therefore, the
<code>PassThroughFieldExtractor</code> should be used in this scenario. It should be noted that, if
the object passed in is not a type of collection, then the <code>PassThroughFieldExtractor</code>
returns an array containing solely the item to be extracted.</p>
</div>
</div>
<div class="sect5">
<h6 id="BeanWrapperFieldExtractor"><a class="anchor" href="#BeanWrapperFieldExtractor"></a><code>BeanWrapperFieldExtractor</code></h6>
<div class="paragraph">
<p>As with the <code>BeanWrapperFieldSetMapper</code> described in the file reading section, it is
often preferable to configure how to convert a domain object to an object array, rather
than writing the conversion yourself. The <code>BeanWrapperFieldExtractor</code> provides this
functionality, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BeanWrapperFieldExtractor&lt;<span class="predefined-type">Name</span>&gt; extractor = <span class="keyword">new</span> BeanWrapperFieldExtractor&lt;<span class="predefined-type">Name</span>&gt;();
extractor.setNames(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> { <span class="string"><span class="delimiter">&quot;</span><span class="content">first</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">last</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">born</span><span class="delimiter">&quot;</span></span> });

<span class="predefined-type">String</span> first = <span class="string"><span class="delimiter">&quot;</span><span class="content">Alan</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">String</span> last = <span class="string"><span class="delimiter">&quot;</span><span class="content">Turing</span><span class="delimiter">&quot;</span></span>;
<span class="type">int</span> born = <span class="integer">1912</span>;

<span class="predefined-type">Name</span> n = <span class="keyword">new</span> <span class="predefined-type">Name</span>(first, last, born);
<span class="predefined-type">Object</span><span class="type">[]</span> values = extractor.extract(n);

assertEquals(first, values[<span class="integer">0</span>]);
assertEquals(last, values[<span class="integer">1</span>]);
assertEquals(born, values[<span class="integer">2</span>]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This extractor implementation has only one required property: the names of the fields to
map. Just as the <code>BeanWrapperFieldSetMapper</code> needs field names to map fields on the
<code>FieldSet</code> to setters on the provided object, the <code>BeanWrapperFieldExtractor</code> needs names
to map to getters for creating an object array. It is worth noting that the order of the
names determines the order of the fields within the array.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="delimitedFileWritingExample"><a class="anchor" href="#delimitedFileWritingExample"></a>Delimited File Writing Example</h5>
<div class="paragraph">
<p>The most basic flat file format is one in which all fields are separated by a delimiter.
This can be accomplished using a <code>DelimitedLineAggregator</code>. The following example writes
out a simple domain object that represents a credit to a customer account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerCredit</span> {

    <span class="directive">private</span> <span class="type">int</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> credit;

    <span class="comment">//getters and setters removed for clarity</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because a domain object is being used, an implementation of the <code>FieldExtractor</code>
interface must be provided, along with the delimiter to use, as shown in the following
example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputResource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lineAggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...DelimitedLineAggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">delimiter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fieldExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...BeanWrapperFieldExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name,credit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemWriter&lt;CustomerCredit&gt; itemWriter(Resource outputResource) <span class="directive">throws</span> <span class="exception">Exception</span> {
        BeanWrapperFieldExtractor&lt;CustomerCredit&gt; fieldExtractor = <span class="keyword">new</span> BeanWrapperFieldExtractor&lt;&gt;();
        fieldExtractor.setNames(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span>});
        fieldExtractor.afterPropertiesSet();

        DelimitedLineAggregator&lt;CustomerCredit&gt; lineAggregator = <span class="keyword">new</span> DelimitedLineAggregator&lt;&gt;();
        lineAggregator.setDelimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>);
        lineAggregator.setFieldExtractor(fieldExtractor);

        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemWriterBuilder&lt;CustomerCredit&gt;()
                                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreditWriter</span><span class="delimiter">&quot;</span></span>)
                                .resource(outputResource)
                                .lineAggregator(lineAggregator)
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example, the <code>BeanWrapperFieldExtractor</code> described earlier in this
chapter is used to turn the name and credit fields within <code>CustomerCredit</code> into an object
array, which is then written out with commas between each field.</p>
</div>
<div class="paragraph">
<p>It is also possible to use the <code>FlatFileItemWriterBuilder.DelimitedBuilder</code> to
automatically create the <code>BeanWrapperFieldExtractor</code> and <code>DelimitedLineAggregator</code>
as shown in the following example:</p>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemWriter&lt;CustomerCredit&gt; itemWriter(Resource outputResource) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemWriterBuilder&lt;CustomerCredit&gt;()
                                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreditWriter</span><span class="delimiter">&quot;</span></span>)
                                .resource(outputResource)
                                .delimited()
                                .delimiter(<span class="string"><span class="delimiter">&quot;</span><span class="content">|</span><span class="delimiter">&quot;</span></span>)
                                .names(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span>})
                                .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="fixedWidthFileWritingExample"><a class="anchor" href="#fixedWidthFileWritingExample"></a>Fixed Width File Writing Example</h5>
<div class="paragraph">
<p>Delimited is not the only type of flat file format. Many prefer to use a set width for
each column to delineate between fields, which is usually referred to as 'fixed width'.
Spring Batch supports this in file writing with the <code>FormatterLineAggregator</code>. Using the
same <code>CustomerCredit</code> domain object described above, it can be configured as follows:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputResource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lineAggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...FormatterLineAggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fieldExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...BeanWrapperFieldExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">names</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name,credit</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">%-9s%-2.0f</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemWriter&lt;CustomerCredit&gt; itemWriter(Resource outputResource) <span class="directive">throws</span> <span class="exception">Exception</span> {
        BeanWrapperFieldExtractor&lt;CustomerCredit&gt; fieldExtractor = <span class="keyword">new</span> BeanWrapperFieldExtractor&lt;&gt;();
        fieldExtractor.setNames(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span>});
        fieldExtractor.afterPropertiesSet();

        FormatterLineAggregator&lt;CustomerCredit&gt; lineAggregator = <span class="keyword">new</span> FormatterLineAggregator&lt;&gt;();
        lineAggregator.setFormat(<span class="string"><span class="delimiter">&quot;</span><span class="content">%-9s%-2.0f</span><span class="delimiter">&quot;</span></span>);
        lineAggregator.setFieldExtractor(fieldExtractor);

        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemWriterBuilder&lt;CustomerCredit&gt;()
                                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreditWriter</span><span class="delimiter">&quot;</span></span>)
                                .resource(outputResource)
                                .lineAggregator(lineAggregator)
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of the preceding example should look familiar. However, the value of the format
property is new and is shown in the following element:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">%-9s%-2.0f</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
FormatterLineAggregator&lt;CustomerCredit&gt; lineAggregator = <span class="keyword">new</span> FormatterLineAggregator&lt;&gt;();
lineAggregator.setFormat(<span class="string"><span class="delimiter">&quot;</span><span class="content">%-9s%-2.0f</span><span class="delimiter">&quot;</span></span>);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The underlying implementation is built using the same
<code>Formatter</code> added as part of Java 5. The Java
<code>Formatter</code> is based on the
<code>printf</code> functionality of the C programming
language. Most details on how to configure a formatter can be found in
the Javadoc of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html">Formatter</a>.</p>
</div>
<div class="paragraph">
<p>It is also possible to use the <code>FlatFileItemWriterBuilder.FormattedBuilder</code> to
automatically create the <code>BeanWrapperFieldExtractor</code> and <code>FormatterLineAggregator</code>
as shown in following example:</p>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemWriter&lt;CustomerCredit&gt; itemWriter(Resource outputResource) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemWriterBuilder&lt;CustomerCredit&gt;()
                                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreditWriter</span><span class="delimiter">&quot;</span></span>)
                                .resource(outputResource)
                                .formatted()
                                .format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%-9s%-2.0f</span><span class="delimiter">&quot;</span></span>)
                                .names(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span>})
                                .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="handlingFileCreation"><a class="anchor" href="#handlingFileCreation"></a>Handling File Creation</h5>
<div class="paragraph">
<p><code>FlatFileItemReader</code> has a very simple relationship with file resources. When the reader
is initialized, it opens the file (if it exists), and throws an exception if it does not.
File writing isn&#8217;t quite so simple. At first glance, it seems like a similar
straightforward contract should exist for <code>FlatFileItemWriter</code>: If the file already
exists, throw an exception, and, if it does not, create it and start writing. However,
potentially restarting a <code>Job</code> can cause issues. In normal restart scenarios, the
contract is reversed: If the file exists, start writing to it from the last known good
position, and, if it does not, throw an exception. However, what happens if the file name
for this job is always the same? In this case, you would want to delete the file if it
exists, unless it&#8217;s a restart. Because of this possibility, the <code>FlatFileItemWriter</code>
contains the property, <code>shouldDeleteIfExists</code>. Setting this property to true causes an
existing file with the same name to be deleted when the writer is opened.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xmlReadingWriting"><a class="anchor" href="#xmlReadingWriting"></a>1.7. XML Item Readers and Writers</h3>
<div class="paragraph">
<p>Spring Batch provides transactional infrastructure for both reading XML records and
mapping them to Java objects as well as writing Java objects as XML records.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Constraints on streaming XML</div>
<div class="paragraph">
<p>The StAX API is used for I/O, as other standard XML parsing APIs do not fit batch
processing requirements (DOM loads the whole input into memory at once and SAX controls
the parsing process by allowing the user to provide only callbacks).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need to consider how XML input and output works in Spring Batch. First, there are a
few concepts that vary from file reading and writing but are common across Spring Batch
XML processing. With XML processing, instead of lines of records (<code>FieldSet</code> instances) that need
to be tokenized, it is assumed an XML resource is a collection of 'fragments'
corresponding to individual records, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/xmlinput.png" alt="XML Input">
</div>
<div class="title">Figure 1. XML Input</div>
</div>
<div class="paragraph">
<p>The 'trade' tag is defined as the 'root element' in the scenario above. Everything
between '&lt;trade&gt;' and '&lt;/trade&gt;' is considered one 'fragment'. Spring Batch
uses Object/XML Mapping (OXM) to bind fragments to objects. However, Spring Batch is not
tied to any particular XML binding technology. Typical use is to delegate to
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#oxm">Spring OXM</a>, which
provides uniform abstraction for the most popular OXM technologies. The dependency on
Spring OXM is optional and you can choose to implement Spring Batch specific interfaces
if desired. The relationship to the technologies that OXM supports is shown in the
following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/oxm-fragments.png" alt="OXM Binding">
</div>
<div class="title">Figure 2. OXM Binding</div>
</div>
<div class="paragraph">
<p>With an introduction to OXM and how one can use XML fragments to represent records, we
can now more closely examine readers and writers.</p>
</div>
<div class="sect3">
<h4 id="StaxEventItemReader"><a class="anchor" href="#StaxEventItemReader"></a>1.7.1. <code>StaxEventItemReader</code></h4>
<div class="paragraph">
<p>The <code>StaxEventItemReader</code> configuration provides a typical setup for the processing of
records from an XML input stream. First, consider the following set of XML records that
the <code>StaxEventItemReader</code> can process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;records&gt;</span>
    <span class="tag">&lt;trade</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://springframework.org/batch/sample/io/oxm/domain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;isin&gt;</span>XYZ0001<span class="tag">&lt;/isin&gt;</span>
        <span class="tag">&lt;quantity&gt;</span>5<span class="tag">&lt;/quantity&gt;</span>
        <span class="tag">&lt;price&gt;</span>11.39<span class="tag">&lt;/price&gt;</span>
        <span class="tag">&lt;customer&gt;</span>Customer1<span class="tag">&lt;/customer&gt;</span>
    <span class="tag">&lt;/trade&gt;</span>
    <span class="tag">&lt;trade</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://springframework.org/batch/sample/io/oxm/domain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;isin&gt;</span>XYZ0002<span class="tag">&lt;/isin&gt;</span>
        <span class="tag">&lt;quantity&gt;</span>2<span class="tag">&lt;/quantity&gt;</span>
        <span class="tag">&lt;price&gt;</span>72.99<span class="tag">&lt;/price&gt;</span>
        <span class="tag">&lt;customer&gt;</span>Customer2c<span class="tag">&lt;/customer&gt;</span>
    <span class="tag">&lt;/trade&gt;</span>
    <span class="tag">&lt;trade</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://springframework.org/batch/sample/io/oxm/domain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;isin&gt;</span>XYZ0003<span class="tag">&lt;/isin&gt;</span>
        <span class="tag">&lt;quantity&gt;</span>9<span class="tag">&lt;/quantity&gt;</span>
        <span class="tag">&lt;price&gt;</span>99.99<span class="tag">&lt;/price&gt;</span>
        <span class="tag">&lt;customer&gt;</span>Customer3<span class="tag">&lt;/customer&gt;</span>
    <span class="tag">&lt;/trade&gt;</span>
<span class="tag">&lt;/records&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be able to process the XML records, the following is needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Root Element Name: The name of the root element of the fragment that constitutes the
object to be mapped. The example configuration demonstrates this with the value of trade.</p>
</li>
<li>
<p>Resource: A Spring Resource that represents the file to read.</p>
</li>
<li>
<p><code>Unmarshaller</code>: An unmarshalling facility provided by Spring OXM for mapping the XML
fragment to an object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to define a <code>StaxEventItemReader</code> that works with a root
element named <code>trade</code>, a resource of <code>org/springframework/batch/item/xml/domain/trades.xml</code>, and an unmarshaller
called <code>tradeMarshaller</code>.</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.xml.StaxEventItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fragmentRootElementName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org/springframework/batch/item/xml/domain/trades.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unmarshaller</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tradeMarshaller</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> StaxEventItemReader itemReader() {
        <span class="keyword">return</span> <span class="keyword">new</span> StaxEventItemReaderBuilder&lt;Trade&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">org/springframework/batch/item/xml/domain/trades.xml</span><span class="delimiter">&quot;</span></span>))
                        .addFragmentRootElements(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>)
                        .unmarshaller(tradeMarshaller())
                        .build();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, in this example, we have chosen to use an <code>XStreamMarshaller</code>, which accepts
an alias passed in as a map with the first key and value being the name of the fragment
(that is, a root element) and the object type to bind. Then, similar to a <code>FieldSet</code>, the
names of the other elements that map to fields within the object type are described as
key/value pairs in the map. In the configuration file, we can use a Spring configuration
utility to describe the required alias, as follows:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tradeMarshaller</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.oxm.xstream.XStreamMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aliases</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aliases</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.trade.Trade</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.math.BigDecimal</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/util:map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> XStreamMarshaller tradeMarshaller() {
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Class</span>&gt; aliases = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>, Trade.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">BigDecimal</span>.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class);

        XStreamMarshaller marshaller = <span class="keyword">new</span> XStreamMarshaller();

        marshaller.setAliases(aliases);

        <span class="keyword">return</span> marshaller;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On input, the reader reads the XML resource until it recognizes that a new fragment is
about to start. By default, the reader matches the element name to recognize that a new
fragment is about to start. The reader creates a standalone XML document from the
fragment and passes the document to a deserializer (typically a wrapper around a Spring
OXM <code>Unmarshaller</code>) to map the XML to a Java object.</p>
</div>
<div class="paragraph">
<p>In summary, this procedure is analogous to the following Java code, which uses the
injection provided by the Spring configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">StaxEventItemReader&lt;Trade&gt; xmlStaxEventItemReader = <span class="keyword">new</span> StaxEventItemReader&lt;&gt;();
Resource resource = <span class="keyword">new</span> ByteArrayResource(xmlResource.getBytes());

<span class="predefined-type">Map</span> aliases = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.trade.Trade</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.math.BigDecimal</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span>);
XStreamMarshaller unmarshaller = <span class="keyword">new</span> XStreamMarshaller();
unmarshaller.setAliases(aliases);
xmlStaxEventItemReader.setUnmarshaller(unmarshaller);
xmlStaxEventItemReader.setResource(resource);
xmlStaxEventItemReader.setFragmentRootElementName(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>);
xmlStaxEventItemReader.open(<span class="keyword">new</span> ExecutionContext());

<span class="type">boolean</span> hasNext = <span class="predefined-constant">true</span>;

Trade trade = <span class="predefined-constant">null</span>;

<span class="keyword">while</span> (hasNext) {
    trade = xmlStaxEventItemReader.read();
    <span class="keyword">if</span> (trade == <span class="predefined-constant">null</span>) {
        hasNext = <span class="predefined-constant">false</span>;
    }
    <span class="keyword">else</span> {
        <span class="predefined-type">System</span>.out.println(trade);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="StaxEventItemWriter"><a class="anchor" href="#StaxEventItemWriter"></a>1.7.2. <code>StaxEventItemWriter</code></h4>
<div class="paragraph">
<p>Output works symmetrically to input. The <code>StaxEventItemWriter</code> needs a <code>Resource</code>, a
marshaller, and a <code>rootTagName</code>. A Java object is passed to a marshaller (typically a
standard Spring OXM Marshaller) which writes to a <code>Resource</code> by using a custom event
writer that filters the <code>StartDocument</code> and <code>EndDocument</code> events produced for each
fragment by the OXM tools. The following example uses the
<code>StaxEventItemWriter</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.xml.StaxEventItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputResource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">marshaller</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tradeMarshaller</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rootTagName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">overwriteOutput</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> StaxEventItemWriter itemWriter(Resource outputResource) {
        <span class="keyword">return</span> <span class="keyword">new</span> StaxEventItemWriterBuilder&lt;Trade&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">tradesWriter</span><span class="delimiter">&quot;</span></span>)
                        .marshaller(tradeMarshaller())
                        .resource(outputResource)
                        .rootTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>)
                        .overwriteOutput(<span class="predefined-constant">true</span>)
                        .build();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding configuration sets up the three required properties and sets the optional
<code>overwriteOutput=true</code> attribute, mentioned earlier in this chapter for specifying whether
an existing file can be overwritten. It should be noted the marshaller used for the
writer in the following example is the exact same as the one used in the reading example
from earlier in the chapter:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreditMarshaller</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.oxm.xstream.XStreamMarshaller</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aliases</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aliases</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.trade.Trade</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.math.BigDecimal</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/util:map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> XStreamMarshaller customerCreditMarshaller() {
        XStreamMarshaller marshaller = <span class="keyword">new</span> XStreamMarshaller();

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Class</span>&gt; aliases = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>, Trade.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">BigDecimal</span>.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class);
        aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class);

        marshaller.setAliases(aliases);

        <span class="keyword">return</span> marshaller;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To summarize with a Java example, the following code illustrates all of the points
discussed, demonstrating the programmatic setup of the required properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FileSystemResource resource = <span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">data/outputFile.xml</span><span class="delimiter">&quot;</span></span>)

<span class="predefined-type">Map</span> aliases = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.trade.Trade</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.math.BigDecimal</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span>);
aliases.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span>);
Marshaller marshaller = <span class="keyword">new</span> XStreamMarshaller();
marshaller.setAliases(aliases);

StaxEventItemWriter staxItemWriter =
        <span class="keyword">new</span> StaxEventItemWriterBuilder&lt;Trade&gt;()
                                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">tradesWriter</span><span class="delimiter">&quot;</span></span>)
                                .marshaller(marshaller)
                                .resource(resource)
                                .rootTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">trade</span><span class="delimiter">&quot;</span></span>)
                                .overwriteOutput(<span class="predefined-constant">true</span>)
                                .build();

staxItemWriter.afterPropertiesSet();

ExecutionContext executionContext = <span class="keyword">new</span> ExecutionContext();
staxItemWriter.open(executionContext);
Trade trade = <span class="keyword">new</span> Trade();
trade.setPrice(<span class="float">11.39</span>);
trade.setIsin(<span class="string"><span class="delimiter">&quot;</span><span class="content">XYZ0001</span><span class="delimiter">&quot;</span></span>);
trade.setQuantity(<span class="integer">5L</span>);
trade.setCustomer(<span class="string"><span class="delimiter">&quot;</span><span class="content">Customer1</span><span class="delimiter">&quot;</span></span>);
staxItemWriter.write(trade);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jsonReadingWriting"><a class="anchor" href="#jsonReadingWriting"></a>1.8. JSON Item Readers And Writers</h3>
<div class="paragraph">
<p>Spring Batch provides support for reading and Writing JSON resources in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">123</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>: <span class="float">1.2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">isin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">456</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>: <span class="float">1.4</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is assumed that the JSON resource is an array of JSON objects corresponding to
individual items. Spring Batch is not tied to any particular JSON library.</p>
</div>
<div class="sect3">
<h4 id="JsonItemReader"><a class="anchor" href="#JsonItemReader"></a>1.8.1. <code>JsonItemReader</code></h4>
<div class="paragraph">
<p>The <code>JsonItemReader</code> delegates JSON parsing and binding to implementations of the
<code>org.springframework.batch.item.json.JsonObjectReader</code> interface. This interface
is intended to be implemented by using a streaming API to read JSON objects
in chunks. Two implementations are currently provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/FasterXML/jackson">Jackson</a> through the <code>org.springframework.batch.item.json.JacksonJsonObjectReader</code></p>
</li>
<li>
<p><a href="https://github.com/google/gson">Gson</a> through the <code>org.springframework.batch.item.json.GsonJsonObjectReader</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To be able to process JSON records, the following is needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Resource</code>: A Spring Resource that represents the JSON file to read.</p>
</li>
<li>
<p><code>JsonObjectReader</code>: A JSON object reader to parse and bind JSON objects to items</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to define a <code>JsonItemReader</code> that works with the
previous JSON resource <code>org/springframework/batch/item/json/trades.json</code> and a
<code>JsonObjectReader</code> based on Jackson:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JsonItemReader&lt;Trade&gt; jsonItemReader() {
   <span class="keyword">return</span> <span class="keyword">new</span> JsonItemReaderBuilder&lt;Trade&gt;()
                 .jsonObjectReader(<span class="keyword">new</span> JacksonJsonObjectReader&lt;&gt;(Trade.class))
                 .resource(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">trades.json</span><span class="delimiter">&quot;</span></span>))
                 .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">tradeJsonItemReader</span><span class="delimiter">&quot;</span></span>)
                 .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="code-jsonfileitemwriter-code"><a class="anchor" href="#code-jsonfileitemwriter-code"></a>1.8.2. <code>JsonFileItemWriter</code></h4>
<div class="paragraph">
<p>The <code>JsonFileItemWriter</code> delegates the marshalling of items to the
<code>org.springframework.batch.item.json.JsonObjectMarshaller</code> interface. The contract
of this interface is to take an object and marshall it to a JSON <code>String</code>.
Two implementations are currently provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/FasterXML/jackson">Jackson</a> through the <code>org.springframework.batch.item.json.JacksonJsonObjectMarshaller</code></p>
</li>
<li>
<p><a href="https://github.com/google/gson">Gson</a> through the <code>org.springframework.batch.item.json.GsonJsonObjectMarshaller</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To be able to write JSON records, the following is needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Resource</code>: A Spring <code>Resource</code> that represents the JSON file to write</p>
</li>
<li>
<p><code>JsonObjectMarshaller</code>: A JSON object marshaller to marshall objects to JSON format</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to define a <code>JsonFileItemWriter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JsonFileItemWriter&lt;Trade&gt; jsonFileItemWriter() {
   <span class="keyword">return</span> <span class="keyword">new</span> JsonFileItemWriterBuilder&lt;Trade&gt;()
                 .jsonObjectMarshaller(<span class="keyword">new</span> JacksonJsonObjectMarshaller&lt;&gt;())
                 .resource(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">trades.json</span><span class="delimiter">&quot;</span></span>))
                 .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">tradeJsonFileItemWriter</span><span class="delimiter">&quot;</span></span>)
                 .build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multiFileInput"><a class="anchor" href="#multiFileInput"></a>1.9. Multi-File Input</h3>
<div class="paragraph">
<p>It is a common requirement to process multiple files within a single <code>Step</code>. Assuming the
files all have the same formatting, the <code>MultiResourceItemReader</code> supports this type of
input for both XML and flat file processing. Consider the following files in a directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>file-1.txt  file-2.txt  ignored.txt</pre>
</div>
</div>
<div class="paragraph">
<p><code>file-1.txt</code> and <code>file-2.txt</code> are formatted the same and, for business reasons, should be
processed together. The <code>MultiResourceItemReader</code> can be used to read in both files by
using wildcards, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiResourceReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...MultiResourceItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resources</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:data/input/file-*.txt</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">delegate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> MultiResourceItemReader multiResourceReader() {
        <span class="keyword">return</span> <span class="keyword">new</span> MultiResourceItemReaderBuilder&lt;Foo&gt;()
                                        .delegate(flatFileItemReader())
                                        .resources(resources())
                                        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The referenced delegate is a simple <code>FlatFileItemReader</code>. The above configuration reads
input from both files, handling rollback and restart scenarios. It should be noted that,
as with any <code>ItemReader</code>, adding extra input (in this case a file) could cause potential
issues when restarting. It is recommended that batch jobs work with their own individual
directories until completed successfully.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Input resources are ordered by using <code>MultiResourceItemReader#setComparator(Comparator)</code>
 to make sure resource ordering is preserved between job runs in restart scenario.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="database"><a class="anchor" href="#database"></a>1.10. Database</h3>
<div class="paragraph">
<p>Like most enterprise application styles, a database is the central storage mechanism for
batch. However, batch differs from other application styles due to the sheer size of the
datasets with which the system must work. If a SQL statement returns 1 million rows, the
result set probably holds all returned results in memory until all rows have been read.
Spring Batch provides two types of solutions for this problem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#cursorBasedItemReaders">Cursor-based <code>ItemReader</code> Implementations</a></p>
</li>
<li>
<p><a href="#pagingItemReaders">Paging <code>ItemReader</code> Implementations</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cursorBasedItemReaders"><a class="anchor" href="#cursorBasedItemReaders"></a>1.10.1. Cursor-based <code>ItemReader</code> Implementations</h4>
<div class="paragraph">
<p>Using a database cursor is generally the default approach of most batch developers,
because it is the database&#8217;s solution to the problem of 'streaming' relational data. The
Java <code>ResultSet</code> class is essentially an object oriented mechanism for manipulating a
cursor. A <code>ResultSet</code> maintains a cursor to the current row of data. Calling <code>next</code> on a
<code>ResultSet</code> moves this cursor to the next row. The Spring Batch cursor-based <code>ItemReader</code>
implementation opens a cursor on initialization and moves the cursor forward one row for
every call to <code>read</code>, returning a mapped object that can be used for processing. The
<code>close</code> method is then called to ensure all resources are freed up. The Spring core
<code>JdbcTemplate</code> gets around this problem by using the callback pattern to completely map
all rows in a <code>ResultSet</code> and close before returning control back to the method caller.
However, in batch, this must wait until the step is complete. The following image shows a
generic diagram of how a cursor-based <code>ItemReader</code> works. Note that, while the example
uses SQL (because SQL is so widely known), any technology could implement the basic
approach.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cursorExample.png" alt="Cursor Example">
</div>
<div class="title">Figure 3. Cursor Example</div>
</div>
<div class="paragraph">
<p>This example illustrates the basic pattern. Given a 'FOO' table, which has three columns:
<code>ID</code>, <code>NAME</code>, and <code>BAR</code>, select all rows with an ID greater than 1 but less than 7. This
puts the beginning of the cursor (row 1) on ID 2. The result of this row should be a
completely mapped <code>Foo</code> object. Calling <code>read()</code> again moves the cursor to the next row,
which is the <code>Foo</code> with an ID of 3. The results of these reads are written out after each
<code>read</code>, allowing the objects to be garbage collected (assuming no instance variables are
maintaining references to them).</p>
</div>
<div class="sect4">
<h5 id="JdbcCursorItemReader"><a class="anchor" href="#JdbcCursorItemReader"></a><code>JdbcCursorItemReader</code></h5>
<div class="paragraph">
<p><code>JdbcCursorItemReader</code> is the JDBC implementation of the cursor-based technique. It works
directly with a <code>ResultSet</code> and requires an SQL statement to run against a connection
obtained from a <code>DataSource</code>. The following database schema is used as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> CUSTOMER (
   ID <span class="predefined-type">BIGINT</span> IDENTITY <span class="directive">PRIMARY</span> <span class="type">KEY</span>,
   NAME <span class="predefined-type">VARCHAR</span>(<span class="integer">45</span>),
   CREDIT <span class="predefined-type">FLOAT</span>
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many people prefer to use a domain object for each row, so the following example uses an
implementation of the <code>RowMapper</code> interface to map a <code>CustomerCredit</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerCreditRowMapper</span> <span class="directive">implements</span> <span class="predefined-type">RowMapper</span>&lt;CustomerCredit&gt; {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ID_COLUMN = <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NAME_COLUMN = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> CREDIT_COLUMN = <span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> CustomerCredit mapRow(<span class="predefined-type">ResultSet</span> rs, <span class="type">int</span> rowNum) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        CustomerCredit customerCredit = <span class="keyword">new</span> CustomerCredit();

        customerCredit.setId(rs.getInt(ID_COLUMN));
        customerCredit.setName(rs.getString(NAME_COLUMN));
        customerCredit.setCredit(rs.getBigDecimal(CREDIT_COLUMN));

        <span class="keyword">return</span> customerCredit;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>JdbcCursorItemReader</code> shares key interfaces with <code>JdbcTemplate</code>, it is useful to
see an example of how to read in this data with <code>JdbcTemplate</code>, in order to contrast it
with the <code>ItemReader</code>. For the purposes of this example, assume there are 1,000 rows in
the <code>CUSTOMER</code> database. The first example uses <code>JdbcTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//For simplicity sake, assume a dataSource has already been obtained</span>
JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);
<span class="predefined-type">List</span> customerCredits = jdbcTemplate.query(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT ID, NAME, CREDIT from CUSTOMER</span><span class="delimiter">&quot;</span></span>,
                                          <span class="keyword">new</span> CustomerCreditRowMapper());</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running the preceding code snippet, the <code>customerCredits</code> list contains 1,000
<code>CustomerCredit</code> objects. In the query method, a connection is obtained from the
<code>DataSource</code>, the provided SQL is run against it, and the <code>mapRow</code> method is called for
each row in the <code>ResultSet</code>. Contrast this with the approach of the
<code>JdbcCursorItemReader</code>, shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JdbcCursorItemReader itemReader = <span class="keyword">new</span> JdbcCursorItemReader();
itemReader.setDataSource(dataSource);
itemReader.setSql(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT ID, NAME, CREDIT from CUSTOMER</span><span class="delimiter">&quot;</span></span>);
itemReader.setRowMapper(<span class="keyword">new</span> CustomerCreditRowMapper());
<span class="type">int</span> counter = <span class="integer">0</span>;
ExecutionContext executionContext = <span class="keyword">new</span> ExecutionContext();
itemReader.open(executionContext);
<span class="predefined-type">Object</span> customerCredit = <span class="keyword">new</span> <span class="predefined-type">Object</span>();
<span class="keyword">while</span>(customerCredit != <span class="predefined-constant">null</span>){
    customerCredit = itemReader.read();
    counter++;
}
itemReader.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>After running the preceding code snippet, the counter equals 1,000. If the code above had
put the returned <code>customerCredit</code> into a list, the result would have been exactly the
same as with the <code>JdbcTemplate</code> example. However, the big advantage of the <code>ItemReader</code>
is that it allows items to be 'streamed'. The <code>read</code> method can be called once, the item
can be written out by an <code>ItemWriter</code>, and then the next item can be obtained with
<code>read</code>. This allows item reading and writing to be done in 'chunks' and committed
periodically, which is the essence of high performance batch processing. Furthermore, it
is very easily configured for injection into a Spring Batch <code>Step</code>, as shown in the
following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...JdbcCursorItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sql</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">select ID, NAME, CREDIT from CUSTOMER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.CustomerCreditRowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JdbcCursorItemReader&lt;CustomerCredit&gt; itemReader() {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcCursorItemReaderBuilder&lt;CustomerCredit&gt;()
                        .dataSource(<span class="local-variable">this</span>.dataSource)
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">creditReader</span><span class="delimiter">&quot;</span></span>)
                        .sql(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ID, NAME, CREDIT from CUSTOMER</span><span class="delimiter">&quot;</span></span>)
                        .rowMapper(<span class="keyword">new</span> CustomerCreditRowMapper())
                        .build();

}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="JdbcCursorItemReaderProperties"><a class="anchor" href="#JdbcCursorItemReaderProperties"></a>Additional Properties</h6>
<div class="paragraph">
<p>Because there are so many varying options for opening a cursor in Java, there are many
properties on the <code>JdbcCursorItemReader</code> that can be set, as described in the following
table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. JdbcCursorItemReader Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreWarnings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether or not SQLWarnings are logged or cause an exception.
The default is <code>true</code> (meaning that warnings are logged).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fetchSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives the JDBC driver a hint as to the number of rows that should be fetched
from the database when more rows are needed by the <code>ResultSet</code> object used by the
<code>ItemReader</code>. By default, no hint is given.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxRows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the limit for the maximum number of rows the underlying <code>ResultSet</code> can
hold at any one time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of seconds the driver waits for a <code>Statement</code> object to
run. If the limit is exceeded, a <code>DataAccessException</code> is thrown. (Consult your driver
vendor documentation for details).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verifyCursorPosition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Because the same <code>ResultSet</code> held by the <code>ItemReader</code> is passed to
the <code>RowMapper</code>, it is possible for users to call <code>ResultSet.next()</code> themselves, which
could cause issues with the reader&#8217;s internal count. Setting this value to <code>true</code> causes
an exception to be thrown if the cursor position is not the same after the <code>RowMapper</code>
call as it was before.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether or not the reader&#8217;s state should be saved in the
<code>ExecutionContext</code> provided by <code>ItemStream#update(ExecutionContext)</code>. The default is
<code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">driverSupportsAbsolute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the JDBC driver supports
setting the absolute row on a <code>ResultSet</code>. It is recommended that this is set to <code>true</code>
for JDBC drivers that support <code>ResultSet.absolute()</code>, as it may improve performance,
especially if a step fails while working with a large data set. Defaults to <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">setUseSharedExtendedConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the connection
used for the cursor should be used by all other processing, thus sharing the same
transaction. If this is set to <code>false</code>, then the cursor is opened with its own connection
and does not participate in any transactions started for the rest of the step processing.
If you set this flag to <code>true</code> then you must wrap the DataSource in an
<code>ExtendedConnectionDataSourceProxy</code> to prevent the connection from being closed and
released after each commit. When you set this option to <code>true</code>, the statement used to
open the cursor is created with both 'READ_ONLY' and 'HOLD_CURSORS_OVER_COMMIT' options.
This allows holding the cursor open over transaction start and commits performed in the
step processing. To use this feature, you need a database that supports this and a JDBC
driver supporting JDBC 3.0 or later. Defaults to <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="HibernateCursorItemReader"><a class="anchor" href="#HibernateCursorItemReader"></a><code>HibernateCursorItemReader</code></h5>
<div class="paragraph">
<p>Just as normal Spring users make important decisions about whether or not to use ORM
solutions, which affect whether or not they use a <code>JdbcTemplate</code> or a
<code>HibernateTemplate</code>, Spring Batch users have the same options.
<code>HibernateCursorItemReader</code> is the Hibernate implementation of the cursor technique.
Hibernate&#8217;s usage in batch has been fairly controversial. This has largely been because
Hibernate was originally developed to support online application styles. However, that
does not mean it cannot be used for batch processing. The easiest approach for solving
this problem is to use a <code>StatelessSession</code> rather than a standard session. This removes
all of the caching and dirty checking Hibernate employs and that can cause issues in a
batch scenario. For more information on the differences between stateless and normal
hibernate sessions, refer to the documentation of your specific hibernate release. The
<code>HibernateCursorItemReader</code> lets you declare an HQL statement and pass in a
<code>SessionFactory</code>, which will pass back one item per call to read in the same basic
fashion as the <code>JdbcCursorItemReader</code>. The following example configuration uses the same
'customer credit' example as the JDBC reader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HibernateCursorItemReader itemReader = <span class="keyword">new</span> HibernateCursorItemReader();
itemReader.setQueryString(<span class="string"><span class="delimiter">&quot;</span><span class="content">from CustomerCredit</span><span class="delimiter">&quot;</span></span>);
<span class="comment">//For simplicity sake, assume sessionFactory already obtained.</span>
itemReader.setSessionFactory(sessionFactory);
itemReader.setUseStatelessSession(<span class="predefined-constant">true</span>);
<span class="type">int</span> counter = <span class="integer">0</span>;
ExecutionContext executionContext = <span class="keyword">new</span> ExecutionContext();
itemReader.open(executionContext);
<span class="predefined-type">Object</span> customerCredit = <span class="keyword">new</span> <span class="predefined-type">Object</span>();
<span class="keyword">while</span>(customerCredit != <span class="predefined-constant">null</span>){
    customerCredit = itemReader.read();
    counter++;
}
itemReader.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configured <code>ItemReader</code> returns <code>CustomerCredit</code> objects in the exact same manner
as described by the <code>JdbcCursorItemReader</code>, assuming hibernate mapping files have been
created correctly for the <code>Customer</code> table. The 'useStatelessSession' property defaults
to true but has been added here to draw attention to the ability to switch it on or off.
It is also worth noting that the fetch size of the underlying cursor can be set via the
<code>setFetchSize</code> property. As with <code>JdbcCursorItemReader</code>, configuration is
straightforward, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.database.HibernateCursorItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queryString</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from CustomerCredit</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> HibernateCursorItemReader itemReader(SessionFactory sessionFactory) {
        <span class="keyword">return</span> <span class="keyword">new</span> HibernateCursorItemReaderBuilder&lt;CustomerCredit&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">creditReader</span><span class="delimiter">&quot;</span></span>)
                        .sessionFactory(sessionFactory)
                        .queryString(<span class="string"><span class="delimiter">&quot;</span><span class="content">from CustomerCredit</span><span class="delimiter">&quot;</span></span>)
                        .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="StoredProcedureItemReader"><a class="anchor" href="#StoredProcedureItemReader"></a><code>StoredProcedureItemReader</code></h5>
<div class="paragraph">
<p>Sometimes it is necessary to obtain the cursor data by using a stored procedure. The
<code>StoredProcedureItemReader</code> works like the <code>JdbcCursorItemReader</code>, except that, instead
of running a query to obtain a cursor, it runs a stored procedure that returns a cursor.
The stored procedure can return the cursor in three different ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As a returned <code>ResultSet</code> (used by SQL Server, Sybase, DB2, Derby, and MySQL).</p>
</li>
<li>
<p>As a ref-cursor returned as an out parameter (used by Oracle and PostgreSQL).</p>
</li>
<li>
<p>As the return value of a stored function call.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example configuration uses the same 'customer credit' example as earlier
examples:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.batch.item.database.StoredProcedureItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">procedureName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sp_customer_credit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.CustomerCreditRowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@Bean
public StoredProcedureItemReader reader(DataSource dataSource) {
        StoredProcedureItemReader reader = new StoredProcedureItemReader();

        reader.setDataSource(dataSource);
        reader.setProcedureName(&quot;sp_customer_credit&quot;);
        reader.setRowMapper(new CustomerCreditRowMapper());

        return reader;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example relies on the stored procedure to provide a <code>ResultSet</code> as a
returned result (option 1 from earlier).</p>
</div>
<div class="paragraph">
<p>If the stored procedure returned a <code>ref-cursor</code> (option 2), then we would need to provide
the position of the out parameter that is the returned <code>ref-cursor</code>. The following
example shows how to work with the first parameter being a ref-cursor:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.batch.item.database.StoredProcedureItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">procedureName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sp_customer_credit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refCursorPosition</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.CustomerCreditRowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> StoredProcedureItemReader reader(<span class="predefined-type">DataSource</span> dataSource) {
        StoredProcedureItemReader reader = <span class="keyword">new</span> StoredProcedureItemReader();

        reader.setDataSource(dataSource);
        reader.setProcedureName(<span class="string"><span class="delimiter">&quot;</span><span class="content">sp_customer_credit</span><span class="delimiter">&quot;</span></span>);
        reader.setRowMapper(<span class="keyword">new</span> CustomerCreditRowMapper());
        reader.setRefCursorPosition(<span class="integer">1</span>);

        <span class="keyword">return</span> reader;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the cursor was returned from a stored function (option 3), we would need to set the
property "<span class="maroon">function</span>" to <code>true</code>. It defaults to <code>false</code>. The following example
shows what that would look like:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.batch.item.database.StoredProcedureItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">procedureName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sp_customer_credit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">function</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.CustomerCreditRowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> StoredProcedureItemReader reader(<span class="predefined-type">DataSource</span> dataSource) {
        StoredProcedureItemReader reader = <span class="keyword">new</span> StoredProcedureItemReader();

        reader.setDataSource(dataSource);
        reader.setProcedureName(<span class="string"><span class="delimiter">&quot;</span><span class="content">sp_customer_credit</span><span class="delimiter">&quot;</span></span>);
        reader.setRowMapper(<span class="keyword">new</span> CustomerCreditRowMapper());
        reader.setFunction(<span class="predefined-constant">true</span>);

        <span class="keyword">return</span> reader;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In all of these cases, we need to define a <code>RowMapper</code> as well as a <code>DataSource</code> and the
actual procedure name.</p>
</div>
<div class="paragraph">
<p>If the stored procedure or function takes in parameters, then they must be declared and
set via the <code>parameters</code> property. The following example, for Oracle, declares three
parameters. The first one is the out parameter that returns the ref-cursor, and the
second and third are in parameters that takes a value of type <code>INTEGER</code>.</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.batch.item.database.StoredProcedureItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">procedureName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.cursor_func</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.core.SqlOutParameter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.jdbc.OracleTypes.CURSOR</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/constructor-arg&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.core.SqlParameter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Types.INTEGER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/constructor-arg&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.core.SqlParameter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custid</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.sql.Types.INTEGER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/constructor-arg&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refCursorPosition</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">preparedStatementSetter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameterSetter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> StoredProcedureItemReader reader(<span class="predefined-type">DataSource</span> dataSource) {
        <span class="predefined-type">List</span>&lt;SqlParameter&gt; parameters = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
        parameters.add(<span class="keyword">new</span> SqlOutParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">newId</span><span class="delimiter">&quot;</span></span>, OracleTypes.CURSOR));
        parameters.add(<span class="keyword">new</span> SqlParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Types</span>.INTEGER);
        parameters.add(<span class="keyword">new</span> SqlParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">custId</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Types</span>.INTEGER);

        StoredProcedureItemReader reader = <span class="keyword">new</span> StoredProcedureItemReader();

        reader.setDataSource(dataSource);
        reader.setProcedureName(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.cursor_func</span><span class="delimiter">&quot;</span></span>);
        reader.setParameters(parameters);
        reader.setRefCursorPosition(<span class="integer">1</span>);
        reader.setRowMapper(rowMapper());
        reader.setPreparedStatementSetter(parameterSetter());

        <span class="keyword">return</span> reader;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the parameter declarations, we need to specify a <code>PreparedStatementSetter</code>
implementation that sets the parameter values for the call. This works the same as for
the <code>JdbcCursorItemReader</code> above. All the additional properties listed in
<a href="#JdbcCursorItemReaderProperties">Additional Properties</a> apply to the <code>StoredProcedureItemReader</code> as well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pagingItemReaders"><a class="anchor" href="#pagingItemReaders"></a>1.10.2. Paging <code>ItemReader</code> Implementations</h4>
<div class="paragraph">
<p>An alternative to using a database cursor is running multiple queries where each query
fetches a portion of the results. We refer to this portion as a page. Each query must
specify the starting row number and the number of rows that we want returned in the page.</p>
</div>
<div class="sect4">
<h5 id="JdbcPagingItemReader"><a class="anchor" href="#JdbcPagingItemReader"></a><code>JdbcPagingItemReader</code></h5>
<div class="paragraph">
<p>One implementation of a paging <code>ItemReader</code> is the <code>JdbcPagingItemReader</code>. The
<code>JdbcPagingItemReader</code> needs a <code>PagingQueryProvider</code> responsible for providing the SQL
queries used to retrieve the rows making up a page. Since each database has its own
strategy for providing paging support, we need to use a different <code>PagingQueryProvider</code>
for each supported database type. There is also the <code>SqlPagingQueryProviderFactoryBean</code>
that auto-detects the database that is being used and determine the appropriate
<code>PagingQueryProvider</code> implementation. This simplifies the configuration and is the
recommended best practice.</p>
</div>
<div class="paragraph">
<p>The <code>SqlPagingQueryProviderFactoryBean</code> requires that you specify a <code>select</code> clause and a
<code>from</code> clause. You can also provide an optional <code>where</code> clause. These clauses and the
required <code>sortKey</code> are used to build an SQL statement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to have a unique key constraint on the <code>sortKey</code> to guarantee that
 no data is lost between executions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the reader has been opened, it passes back one item per call to <code>read</code> in the same
basic fashion as any other <code>ItemReader</code>. The paging happens behind the scenes when
additional rows are needed.</p>
</div>
<div class="paragraph">
<p>The following example configuration uses a similar 'customer credit' example as the
cursor-based <code>ItemReaders</code> shown previously:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...JdbcPagingItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queryProvider</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...SqlPagingQueryProviderFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">selectClause</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, credit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fromClause</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from customer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">whereClause</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">where status=:status</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sortKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parameterValues</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NEW</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pageSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JdbcPagingItemReader itemReader(<span class="predefined-type">DataSource</span> dataSource, PagingQueryProvider queryProvider) {
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; parameterValues = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        parameterValues.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">NEW</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> <span class="keyword">new</span> JdbcPagingItemReaderBuilder&lt;CustomerCredit&gt;()
                                           .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">creditReader</span><span class="delimiter">&quot;</span></span>)
                                           .dataSource(dataSource)
                                           .queryProvider(queryProvider)
                                           .parameterValues(parameterValues)
                                           .rowMapper(customerCreditMapper())
                                           .pageSize(<span class="integer">1000</span>)
                                           .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> SqlPagingQueryProviderFactoryBean queryProvider() {
        SqlPagingQueryProviderFactoryBean provider = <span class="keyword">new</span> SqlPagingQueryProviderFactoryBean();

        provider.setSelectClause(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, credit</span><span class="delimiter">&quot;</span></span>);
        provider.setFromClause(<span class="string"><span class="delimiter">&quot;</span><span class="content">from customer</span><span class="delimiter">&quot;</span></span>);
        provider.setWhereClause(<span class="string"><span class="delimiter">&quot;</span><span class="content">where status=:status</span><span class="delimiter">&quot;</span></span>);
        provider.setSortKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> provider;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configured <code>ItemReader</code> returns <code>CustomerCredit</code> objects using the <code>RowMapper</code>,
which must be specified. The 'pageSize' property determines the number of entities read
from the database for each query run.</p>
</div>
<div class="paragraph">
<p>The 'parameterValues' property can be used to specify a <code>Map</code> of parameter values for the
query. If you use named parameters in the <code>where</code> clause, the key for each entry should
match the name of the named parameter. If you use a traditional '?' placeholder, then the
key for each entry should be the number of the placeholder, starting with 1.</p>
</div>
</div>
<div class="sect4">
<h5 id="JpaPagingItemReader"><a class="anchor" href="#JpaPagingItemReader"></a><code>JpaPagingItemReader</code></h5>
<div class="paragraph">
<p>Another implementation of a paging <code>ItemReader</code> is the <code>JpaPagingItemReader</code>. JPA does
not have a concept similar to the Hibernate <code>StatelessSession</code>, so we have to use other
features provided by the JPA specification. Since JPA supports paging, this is a natural
choice when it comes to using JPA for batch processing. After each page is read, the
entities become detached and the persistence context is cleared, to allow the entities to
be garbage collected once the page is processed.</p>
</div>
<div class="paragraph">
<p>The <code>JpaPagingItemReader</code> lets you declare a JPQL statement and pass in a
<code>EntityManagerFactory</code>. It then passes back one item per call to read in the same basic
fashion as any other <code>ItemReader</code>. The paging happens behind the scenes when additional
entities are needed. The following example configuration uses the same 'customer credit'
example as the JDBC reader shown previously:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...JpaPagingItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queryString</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">select c from CustomerCredit c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pageSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JpaPagingItemReader itemReader() {
        <span class="keyword">return</span> <span class="keyword">new</span> JpaPagingItemReaderBuilder&lt;CustomerCredit&gt;()
                                           .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">creditReader</span><span class="delimiter">&quot;</span></span>)
                                           .entityManagerFactory(entityManagerFactory())
                                           .queryString(<span class="string"><span class="delimiter">&quot;</span><span class="content">select c from CustomerCredit c</span><span class="delimiter">&quot;</span></span>)
                                           .pageSize(<span class="integer">1000</span>)
                                           .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configured <code>ItemReader</code> returns <code>CustomerCredit</code> objects in the exact same manner as
described for the <code>JdbcPagingItemReader</code> above, assuming the <code>CustomerCredit</code> object has the
correct JPA annotations or ORM mapping file. The 'pageSize' property determines the
number of entities read from the database for each query execution.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="databaseItemWriters"><a class="anchor" href="#databaseItemWriters"></a>1.10.3. Database ItemWriters</h4>
<div class="paragraph">
<p>While both flat files and XML files have a specific <code>ItemWriter</code> instance, there is no exact equivalent
in the database world. This is because transactions provide all the needed functionality.
<code>ItemWriter</code> implementations are necessary for files because they must act as if they&#8217;re transactional,
keeping track of written items and flushing or clearing at the appropriate times.
Databases have no need for this functionality, since the write is already contained in a
transaction. Users can create their own DAOs that implement the <code>ItemWriter</code> interface or
use one from a custom <code>ItemWriter</code> that&#8217;s written for generic processing concerns. Either
way, they should work without any issues. One thing to look out for is the performance
and error handling capabilities that are provided by batching the outputs. This is most
common when using hibernate as an <code>ItemWriter</code> but could have the same issues when using
JDBC batch mode. Batching database output does not have any inherent flaws, assuming we
are careful to flush and there are no errors in the data. However, any errors while
writing can cause confusion, because there is no way to know which individual item caused
an exception or even if any individual item was responsible, as illustrated in the
following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/errorOnFlush.png" alt="Error On Flush">
</div>
<div class="title">Figure 4. Error On Flush</div>
</div>
<div class="paragraph">
<p>If items are buffered before being written, any errors are not thrown until the buffer is
flushed just before a commit. For example, assume that 20 items are written per chunk,
and the 15th item throws a <code>DataIntegrityViolationException</code>. As far as the <code>Step</code>
is concerned, all 20 item are written successfully, since there is no way to know that an
error occurs until they are actually written. Once <code>Session#flush()</code> is called, the
buffer is emptied and the exception is hit. At this point, there is nothing the <code>Step</code>
can do. The transaction must be rolled back. Normally, this exception might cause the
item to be skipped (depending upon the skip/retry policies), and then it is not written
again. However, in the batched scenario, there is no way to know which item caused the
issue. The whole buffer was being written when the failure happened. The only way to
solve this issue is to flush after each item, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/errorOnWrite.png" alt="Error On Write">
</div>
<div class="title">Figure 5. Error On Write</div>
</div>
<div class="paragraph">
<p>This is a common use case, especially when using Hibernate, and the simple guideline for
implementations of <code>ItemWriter</code> is to flush on each call to <code>write()</code>. Doing so allows
for items to be skipped reliably, with Spring Batch internally taking care of the
granularity of the calls to <code>ItemWriter</code> after an error.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reusingExistingServices"><a class="anchor" href="#reusingExistingServices"></a>1.11. Reusing Existing Services</h3>
<div class="paragraph">
<p>Batch systems are often used in conjunction with other application styles. The most
common is an online system, but it may also support integration or even a thick client
application by moving necessary bulk data that each application style uses. For this
reason, it is common that many users want to reuse existing DAOs or other services within
their batch jobs. The Spring container itself makes this fairly easy by allowing any
necessary class to be injected. However, there may be cases where the existing service
needs to act as an <code>ItemReader</code> or <code>ItemWriter</code>, either to satisfy the dependency of
another Spring Batch class or because it truly is the main <code>ItemReader</code> for a step. It is
fairly trivial to write an adapter class for each service that needs wrapping, but
because it is such a common concern, Spring Batch provides implementations:
<code>ItemReaderAdapter</code> and <code>ItemWriterAdapter</code>. Both classes implement the standard Spring
method by invoking the delegate pattern and are fairly simple to set up. The following
example uses the <code>ItemReaderAdapter</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.adapter.ItemReaderAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">generateFoo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.sample.FooService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> ItemReaderAdapter itemReader() {
        ItemReaderAdapter reader = <span class="keyword">new</span> ItemReaderAdapter();

        reader.setTargetObject(fooService());
        reader.setTargetMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">generateFoo</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> reader;
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> FooService fooService() {
        <span class="keyword">return</span> <span class="keyword">new</span> FooService();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One important point to note is that the contract of the <code>targetMethod</code> must be the same
as the contract for <code>read</code>: When exhausted, it returns <code>null</code>. Otherwise, it returns an
<code>Object</code>. Anything else prevents the framework from knowing when processing should end,
either causing an infinite loop or incorrect failure, depending upon the implementation
of the <code>ItemWriter</code>. The following example uses the <code>ItemWriterAdapter</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.adapter.ItemWriterAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">processFoo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.sample.FooService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> ItemWriterAdapter itemWriter() {
        ItemWriterAdapter writer = <span class="keyword">new</span> ItemWriterAdapter();

        writer.setTargetObject(fooService());
        writer.setTargetMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">processFoo</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> writer;
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> FooService fooService() {
        <span class="keyword">return</span> <span class="keyword">new</span> FooService();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validatingInput"><a class="anchor" href="#validatingInput"></a>1.12. Validating Input</h3>
<div class="paragraph">
<p>During the course of this chapter, multiple approaches to parsing input have been
discussed. Each major implementation throws an exception if it is not 'well-formed'. The
<code>FixedLengthTokenizer</code> throws an exception if a range of data is missing. Similarly,
attempting to access an index in a <code>RowMapper</code> or <code>FieldSetMapper</code> that does not exist or
is in a different format than the one expected causes an exception to be thrown. All of
these types of exceptions are thrown before <code>read</code> returns. However, they do not address
the issue of whether or not the returned item is valid. For example, if one of the fields
is an age, it obviously cannot be negative. It may parse correctly, because it exists and
is a number, but it does not cause an exception. Since there are already a plethora of
validation frameworks, Spring Batch does not attempt to provide yet another. Rather, it
provides a simple interface, called <code>Validator</code>, that can be implemented by any number of
frameworks, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Validator</span>&lt;T&gt; {

    <span class="type">void</span> validate(T value) <span class="directive">throws</span> ValidationException;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contract is that the <code>validate</code> method throws an exception if the object is invalid
and returns normally if it is valid. Spring Batch provides an out of the box
<code>ValidatingItemProcessor</code>, as shown in the following bean definition:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.validator.ValidatingItemProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.validator.SpringValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.domain.trade.internal.validator.TradeValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> ValidatingItemProcessor itemProcessor() {
        ValidatingItemProcessor processor = <span class="keyword">new</span> ValidatingItemProcessor();

        processor.setValidator(validator());

        <span class="keyword">return</span> processor;
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> SpringValidator validator() {
        SpringValidator validator = <span class="keyword">new</span> SpringValidator();

        validator.setValidator(<span class="keyword">new</span> TradeValidator());

        <span class="keyword">return</span> validator;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>BeanValidatingItemProcessor</code> to validate items annotated with
the Bean Validation API (JSR-303) annotations. For example, given the following type <code>Person</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Person</span> {

    <span class="annotation">@NotEmpty</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> Person(<span class="predefined-type">String</span> name) {
     <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
     <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
     <span class="local-variable">this</span>.name = name;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can validate items by declaring a <code>BeanValidatingItemProcessor</code> bean in your
application context and register it as a processor in your chunk-oriented step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> BeanValidatingItemProcessor&lt;Person&gt; beanValidatingItemProcessor() <span class="directive">throws</span> <span class="exception">Exception</span> {
    BeanValidatingItemProcessor&lt;Person&gt; beanValidatingItemProcessor = <span class="keyword">new</span> BeanValidatingItemProcessor&lt;&gt;();
    beanValidatingItemProcessor.setFilter(<span class="predefined-constant">true</span>);

    <span class="keyword">return</span> beanValidatingItemProcessor;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="process-indicator"><a class="anchor" href="#process-indicator"></a>1.13. Preventing State Persistence</h3>
<div class="paragraph">
<p>By default, all of the <code>ItemReader</code> and <code>ItemWriter</code> implementations store their current
state in the <code>ExecutionContext</code> before it is committed. However, this may not always be
the desired behavior. For example, many developers choose to make their database readers
'rerunnable' by using a process indicator. An extra column is added to the input data to
indicate whether or not it has been processed. When a particular record is being read (or
written) the processed flag is flipped from <code>false</code> to <code>true</code>. The SQL statement can then
contain an extra statement in the <code>where</code> clause, such as <code>where PROCESSED_IND = false</code>,
thereby ensuring that only unprocessed records are returned in the case of a restart. In
this scenario, it is preferable to not store any state, such as the current row number,
since it is irrelevant upon restart. For this reason, all readers and writers include the
'saveState' property, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerSummarizationSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...JdbcCursorItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rowMapper</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.PlayerSummaryMapper</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">saveState</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sql</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>
            SELECT games.player_id, games.year_no, SUM(COMPLETES),
            SUM(ATTEMPTS), SUM(PASSING_YARDS), SUM(PASSING_TD),
            SUM(INTERCEPTIONS), SUM(RUSHES), SUM(RUSH_YARDS),
            SUM(RECEPTIONS), SUM(RECEPTIONS_YARDS), SUM(TOTAL_TD)
            from games, players where players.player_id =
            games.player_id group by games.player_id, games.year_no
        <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JdbcCursorItemReader playerSummarizationSource(<span class="predefined-type">DataSource</span> dataSource) {
        <span class="keyword">return</span> <span class="keyword">new</span> JdbcCursorItemReaderBuilder&lt;PlayerSummary&gt;()
                                .dataSource(dataSource)
                                .rowMapper(<span class="keyword">new</span> PlayerSummaryMapper())
                                .saveState(<span class="predefined-constant">false</span>)
                                .sql(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT games.player_id, games.year_no, SUM(COMPLETES),</span><span class="delimiter">&quot;</span></span>
                                  + <span class="string"><span class="delimiter">&quot;</span><span class="content">SUM(ATTEMPTS), SUM(PASSING_YARDS), SUM(PASSING_TD),</span><span class="delimiter">&quot;</span></span>
                                  + <span class="string"><span class="delimiter">&quot;</span><span class="content">SUM(INTERCEPTIONS), SUM(RUSHES), SUM(RUSH_YARDS),</span><span class="delimiter">&quot;</span></span>
                                  + <span class="string"><span class="delimiter">&quot;</span><span class="content">SUM(RECEPTIONS), SUM(RECEPTIONS_YARDS), SUM(TOTAL_TD)</span><span class="delimiter">&quot;</span></span>
                                  + <span class="string"><span class="delimiter">&quot;</span><span class="content">from games, players where players.player_id =</span><span class="delimiter">&quot;</span></span>
                                  + <span class="string"><span class="delimiter">&quot;</span><span class="content">games.player_id group by games.player_id, games.year_no</span><span class="delimiter">&quot;</span></span>)
                                .build();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ItemReader</code> configured above does not make any entries in the <code>ExecutionContext</code> for
any executions in which it participates.</p>
</div>
</div>
<div class="sect2">
<h3 id="customReadersWriters"><a class="anchor" href="#customReadersWriters"></a>1.14. Creating Custom ItemReaders and ItemWriters</h3>
<div class="paragraph">
<p>So far, this chapter has discussed the basic contracts of reading and writing in Spring
Batch and some common implementations for doing so. However, these are all fairly
generic, and there are many potential scenarios that may not be covered by out-of-the-box
implementations. This section shows, by using a simple example, how to create a custom
<code>ItemReader</code> and <code>ItemWriter</code> implementation and implement their contracts correctly. The
<code>ItemReader</code> also implements <code>ItemStream</code>, in order to illustrate how to make a reader or
writer restartable.</p>
</div>
<div class="sect3">
<h4 id="customReader"><a class="anchor" href="#customReader"></a>1.14.1. Custom <code>ItemReader</code> Example</h4>
<div class="paragraph">
<p>For the purpose of this example, we create a simple <code>ItemReader</code> implementation that
reads from a provided list. We start by implementing the most basic contract of
<code>ItemReader</code>, the <code>read</code> method, as shown in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomItemReader</span>&lt;T&gt; <span class="directive">implements</span> ItemReader&lt;T&gt;{

    <span class="predefined-type">List</span>&lt;T&gt; items;

    <span class="directive">public</span> CustomItemReader(<span class="predefined-type">List</span>&lt;T&gt; items) {
        <span class="local-variable">this</span>.items = items;
    }

    <span class="directive">public</span> T read() <span class="directive">throws</span> <span class="exception">Exception</span>, UnexpectedInputException,
       NonTransientResourceException, <span class="exception">ParseException</span> {

        <span class="keyword">if</span> (!items.isEmpty()) {
            <span class="keyword">return</span> items.remove(<span class="integer">0</span>);
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding class takes a list of items and returns them one at a time, removing each
from the list. When the list is empty, it returns <code>null</code>, thus satisfying the most basic
requirements of an <code>ItemReader</code>, as illustrated in the following test code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; items = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;();
items.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
items.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>);
items.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>);

ItemReader itemReader = <span class="keyword">new</span> CustomItemReader&lt;<span class="predefined-type">String</span>&gt;(items);
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, itemReader.read());
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, itemReader.read());
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>, itemReader.read());
assertNull(itemReader.read());</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="restartableReader"><a class="anchor" href="#restartableReader"></a>Making the <code>ItemReader</code> Restartable</h5>
<div class="paragraph">
<p>The final challenge is to make the <code>ItemReader</code> restartable. Currently, if processing is
interrupted and begins again, the <code>ItemReader</code> must start at the beginning. This is
actually valid in many scenarios, but it is sometimes preferable that a batch job
restarts where it left off. The key discriminant is often whether the reader is stateful
or stateless. A stateless reader does not need to worry about restartability, but a
stateful one has to try to reconstitute its last known state on restart. For this reason,
we recommend that you keep custom readers stateless if possible, so you need not worry
about restartability.</p>
</div>
<div class="paragraph">
<p>If you do need to store state, then the <code>ItemStream</code> interface should be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomItemReader</span>&lt;T&gt; <span class="directive">implements</span> ItemReader&lt;T&gt;, ItemStream {

    <span class="predefined-type">List</span>&lt;T&gt; items;
    <span class="type">int</span> currentIndex = <span class="integer">0</span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> CURRENT_INDEX = <span class="string"><span class="delimiter">&quot;</span><span class="content">current.index</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> CustomItemReader(<span class="predefined-type">List</span>&lt;T&gt; items) {
        <span class="local-variable">this</span>.items = items;
    }

    <span class="directive">public</span> T read() <span class="directive">throws</span> <span class="exception">Exception</span>, UnexpectedInputException,
        <span class="exception">ParseException</span>, NonTransientResourceException {

        <span class="keyword">if</span> (currentIndex &lt; items.size()) {
            <span class="keyword">return</span> items.get(currentIndex++);
        }

        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="directive">public</span> <span class="type">void</span> open(ExecutionContext executionContext) <span class="directive">throws</span> ItemStreamException {
        <span class="keyword">if</span>(executionContext.containsKey(CURRENT_INDEX)){
            currentIndex = <span class="keyword">new</span> <span class="predefined-type">Long</span>(executionContext.getLong(CURRENT_INDEX)).intValue();
        }
        <span class="keyword">else</span>{
            currentIndex = <span class="integer">0</span>;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> update(ExecutionContext executionContext) <span class="directive">throws</span> ItemStreamException {
        executionContext.putLong(CURRENT_INDEX, <span class="keyword">new</span> <span class="predefined-type">Long</span>(currentIndex).longValue());
    }

    <span class="directive">public</span> <span class="type">void</span> close() <span class="directive">throws</span> ItemStreamException {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On each call to the <code>ItemStream</code> <code>update</code> method, the current index of the <code>ItemReader</code>
is stored in the provided <code>ExecutionContext</code> with a key of 'current.index'. When the
<code>ItemStream</code> <code>open</code> method is called, the <code>ExecutionContext</code> is checked to see if it
contains an entry with that key. If the key is found, then the current index is moved to
that location. This is a fairly trivial example, but it still meets the general contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExecutionContext executionContext = <span class="keyword">new</span> ExecutionContext();
((ItemStream)itemReader).open(executionContext);
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, itemReader.read());
((ItemStream)itemReader).update(executionContext);

<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; items = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;();
items.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
items.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>);
items.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>);
itemReader = <span class="keyword">new</span> CustomItemReader&lt;<span class="predefined-type">String</span>&gt;(items);

((ItemStream)itemReader).open(executionContext);
assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, itemReader.read());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most <code>ItemReaders</code> have much more sophisticated restart logic. The
<code>JdbcCursorItemReader</code>, for example, stores the row ID of the last processed row in the
cursor.</p>
</div>
<div class="paragraph">
<p>It is also worth noting that the key used within the <code>ExecutionContext</code> should not be
trivial. That is because the same <code>ExecutionContext</code> is used for all <code>ItemStreams</code> within
a <code>Step</code>. In most cases, simply prepending the key with the class name should be enough
to guarantee uniqueness. However, in the rare cases where two of the same type of
<code>ItemStream</code> are used in the same step (which can happen if two files are needed for
output), a more unique name is needed. For this reason, many of the Spring Batch
<code>ItemReader</code> and <code>ItemWriter</code> implementations have a <code>setName()</code> property that lets this
key name be overridden.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customWriter"><a class="anchor" href="#customWriter"></a>1.14.2. Custom <code>ItemWriter</code> Example</h4>
<div class="paragraph">
<p>Implementing a Custom <code>ItemWriter</code> is similar in many ways to the <code>ItemReader</code> example
above but differs in enough ways as to warrant its own example. However, adding
restartability is essentially the same, so it is not covered in this example. As with the
<code>ItemReader</code> example, a <code>List</code> is used in order to keep the example as simple as
possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomItemWriter</span>&lt;T&gt; <span class="directive">implements</span> ItemWriter&lt;T&gt; {

    <span class="predefined-type">List</span>&lt;T&gt; output = TransactionAwareProxyFactory.createTransactionalList();

    <span class="directive">public</span> <span class="type">void</span> write(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> T&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
        output.addAll(items);
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;T&gt; getOutput() {
        <span class="keyword">return</span> output;
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="restartableWriter"><a class="anchor" href="#restartableWriter"></a>Making the <code>ItemWriter</code> Restartable</h5>
<div class="paragraph">
<p>To make the <code>ItemWriter</code> restartable, we would follow the same process as for the
<code>ItemReader</code>, adding and implementing the <code>ItemStream</code> interface to synchronize the
execution context. In the example, we might have to count the number of items processed
and add that as a footer record. If we needed to do that, we could implement
<code>ItemStream</code> in our <code>ItemWriter</code> so that the counter was reconstituted from the execution
context if the stream was re-opened.</p>
</div>
<div class="paragraph">
<p>In many realistic cases, custom <code>ItemWriters</code> also delegate to another writer that itself
is restartable (for example, when writing to a file), or else it writes to a
transactional resource and so does not need to be restartable, because it is stateless.
When you have a stateful writer you should probably be sure to implement <code>ItemStream</code> as
well as <code>ItemWriter</code>. Remember also that the client of the writer needs to be aware of
the <code>ItemStream</code>, so you may need to register it as a stream in the configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="itemReaderAndWriterImplementations"><a class="anchor" href="#itemReaderAndWriterImplementations"></a>1.15. Item Reader and Writer Implementations</h3>
<div class="paragraph">
<p>In this section, we will introduce you to readers and writers that have not already been
discussed in the previous sections.</p>
</div>
<div class="sect3">
<h4 id="decorators"><a class="anchor" href="#decorators"></a>1.15.1. Decorators</h4>
<div class="paragraph">
<p>In some cases, a user needs specialized behavior to be appended to a pre-existing
<code>ItemReader</code>.   Spring Batch offers some out of the box decorators that can add
additional behavior to to your <code>ItemReader</code> and <code>ItemWriter</code> implementations.</p>
</div>
<div class="paragraph">
<p>Spring Batch includes the following decorators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#synchronizedItemStreamReader"><code>SynchronizedItemStreamReader</code></a></p>
</li>
<li>
<p><a href="#singleItemPeekableItemReader"><code>SingleItemPeekableItemReader</code></a></p>
</li>
<li>
<p><a href="#multiResourceItemWriter"><code>MultiResourceItemWriter</code></a></p>
</li>
<li>
<p><a href="#classifierCompositeItemWriter"><code>ClassifierCompositeItemWriter</code></a></p>
</li>
<li>
<p><a href="#classifierCompositeItemProcessor"><code>ClassifierCompositeItemProcessor</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="synchronizedItemStreamReader"><a class="anchor" href="#synchronizedItemStreamReader"></a><code>SynchronizedItemStreamReader</code></h5>
<div class="paragraph">
<p>When using an <code>ItemReader</code> that is not thread safe, Spring Batch offers the
<code>SynchronizedItemStreamReader</code> decorator, which can be used to make the <code>ItemReader</code>
thread safe. Spring Batch provides a <code>SynchronizedItemStreamReaderBuilder</code> to construct
an instance of the <code>SynchronizedItemStreamReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="singleItemPeekableItemReader"><a class="anchor" href="#singleItemPeekableItemReader"></a><code>SingleItemPeekableItemReader</code></h5>
<div class="paragraph">
<p>Spring Batch includes a decorator that adds a peek method to an <code>ItemReader</code>. This peek
method lets the user peek one item ahead.  Repeated calls to the peek returns the same
item, and this is the next item returned from the <code>read</code> method. Spring Batch provides a
<code>SingleItemPeekableItemReaderBuilder</code> to construct an instance of the
<code>SingleItemPeekableItemReader</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
SingleItemPeekableItemReader&#8217;s peek method is not thread-safe, because it would not
be possible to honor the peek in multiple threads. Only one of the threads that peeked
would get that item in the next call to read.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="multiResourceItemWriter"><a class="anchor" href="#multiResourceItemWriter"></a><code>MultiResourceItemWriter</code></h5>
<div class="paragraph">
<p>The <code>MultiResourceItemWriter</code> wraps a <code>ResourceAwareItemWriterItemStream</code> and creates a new
output resource when the count of items written in the current resource exceeds the
<code>itemCountLimitPerResource</code>. Spring Batch provides a <code>MultiResourceItemWriterBuilder</code> to
construct an instance of the <code>MultiResourceItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="classifierCompositeItemWriter"><a class="anchor" href="#classifierCompositeItemWriter"></a><code>ClassifierCompositeItemWriter</code></h5>
<div class="paragraph">
<p>The <code>ClassifierCompositeItemWriter</code> calls one of a collection of <code>ItemWriter</code>
implementations for each item, based on a router pattern implemented through the provided
<code>Classifier</code>.  The implementation is thread-safe if all delegates are thread-safe. Spring
Batch provides a <code>ClassifierCompositeItemWriterBuilder</code> to construct an instance of the
<code>ClassifierCompositeItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="classifierCompositeItemProcessor"><a class="anchor" href="#classifierCompositeItemProcessor"></a><code>ClassifierCompositeItemProcessor</code></h5>
<div class="paragraph">
<p>The <code>ClassifierCompositeItemProcessor</code> is an <code>ItemProcessor</code> that calls one of a
collection of <code>ItemProcessor</code> implementations, based on a router pattern implemented
through the provided <code>Classifier</code>. Spring Batch provides a
<code>ClassifierCompositeItemProcessorBuilder</code> to construct an instance of the
<code>ClassifierCompositeItemProcessor</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="messagingReadersAndWriters"><a class="anchor" href="#messagingReadersAndWriters"></a>1.15.2. Messaging Readers And Writers</h4>
<div class="paragraph">
<p>Spring Batch offers the following readers and writers for commonly used messaging systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#amqpItemReader"><code>AmqpItemReader</code></a></p>
</li>
<li>
<p><a href="#amqpItemWriter"><code>AmqpItemWriter</code></a></p>
</li>
<li>
<p><a href="#jmsItemReader"><code>JmsItemReader</code></a></p>
</li>
<li>
<p><a href="#jmsItemWriter"><code>JmsItemWriter</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="amqpItemReader"><a class="anchor" href="#amqpItemReader"></a><code>AmqpItemReader</code></h5>
<div class="paragraph">
<p>The <code>AmqpItemReader</code> is an <code>ItemReader</code> that uses an <code>AmqpTemplate</code> to receive or convert
messages from an exchange. Spring Batch provides a <code>AmqpItemReaderBuilder</code> to construct
an instance of the <code>AmqpItemReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="amqpItemWriter"><a class="anchor" href="#amqpItemWriter"></a><code>AmqpItemWriter</code></h5>
<div class="paragraph">
<p>The <code>AmqpItemWriter</code> is an <code>ItemWriter</code> that uses an <code>AmqpTemplate</code> to send messages to
an AMQP exchange. Messages are sent to the nameless exchange if the name not specified in
the provided <code>AmqpTemplate</code>.  Spring Batch provides an <code>AmqpItemWriterBuilder</code> to
construct an instance of the <code>AmqpItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jmsItemReader"><a class="anchor" href="#jmsItemReader"></a><code>JmsItemReader</code></h5>
<div class="paragraph">
<p>The <code>JmsItemReader</code> is an <code>ItemReader</code> for JMS that uses a <code>JmsTemplate</code>. The template
should have a default destination, which is used to provide items for the <code>read()</code>
method. Spring Batch provides a <code>JmsItemReaderBuilder</code> to construct an instance of the
<code>JmsItemReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jmsItemWriter"><a class="anchor" href="#jmsItemWriter"></a><code>JmsItemWriter</code></h5>
<div class="paragraph">
<p>The <code>JmsItemWriter</code> is an <code>ItemWriter</code> for JMS that uses a <code>JmsTemplate</code>. The template
should have a default destination, which is used to send items in <code>write(List)</code>. Spring
Batch provides a <code>JmsItemWriterBuilder</code> to construct an instance of the <code>JmsItemWriter</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="databaseReaders"><a class="anchor" href="#databaseReaders"></a>1.15.3. Database Readers</h4>
<div class="paragraph">
<p>Spring Batch offers the following database readers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Neo4jItemReader"><code>Neo4jItemReader</code></a></p>
</li>
<li>
<p><a href="#mongoItemReader"><code>MongoItemReader</code></a></p>
</li>
<li>
<p><a href="#hibernateCursorItemReader"><code>HibernateCursorItemReader</code></a></p>
</li>
<li>
<p><a href="#hibernatePagingItemReader"><code>HibernatePagingItemReader</code></a></p>
</li>
<li>
<p><a href="#repositoryItemReader"><code>RepositoryItemReader</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Neo4jItemReader"><a class="anchor" href="#Neo4jItemReader"></a><code>Neo4jItemReader</code></h5>
<div class="paragraph">
<p>The <code>Neo4jItemReader</code> is an <code>ItemReader</code> that reads objects from the graph database Neo4j
by using a paging technique. Spring Batch provides a <code>Neo4jItemReaderBuilder</code> to
construct an instance of the <code>Neo4jItemReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="mongoItemReader"><a class="anchor" href="#mongoItemReader"></a><code>MongoItemReader</code></h5>
<div class="paragraph">
<p>The <code>MongoItemReader</code> is an <code>ItemReader</code> that reads documents from MongoDB by using a
paging technique. Spring Batch provides a <code>MongoItemReaderBuilder</code> to construct an
instance of the <code>MongoItemReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hibernateCursorItemReader"><a class="anchor" href="#hibernateCursorItemReader"></a><code>HibernateCursorItemReader</code></h5>
<div class="paragraph">
<p>The <code>HibernateCursorItemReader</code> is an <code>ItemStreamReader</code> for reading database records
built on top of Hibernate. It executes the HQL query and then, when initialized, iterates
over the result set as the <code>read()</code> method is called, successively returning an object
corresponding to the current row. Spring Batch provides a
<code>HibernateCursorItemReaderBuilder</code> to construct an instance of the
<code>HibernateCursorItemReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hibernatePagingItemReader"><a class="anchor" href="#hibernatePagingItemReader"></a><code>HibernatePagingItemReader</code></h5>
<div class="paragraph">
<p>The <code>HibernatePagingItemReader</code> is an <code>ItemReader</code> for reading database records built on
top of Hibernate and reading only up to a fixed number of items at a time. Spring Batch
provides a <code>HibernatePagingItemReaderBuilder</code> to construct an instance of the
<code>HibernatePagingItemReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="repositoryItemReader"><a class="anchor" href="#repositoryItemReader"></a><code>RepositoryItemReader</code></h5>
<div class="paragraph">
<p>The <code>RepositoryItemReader</code> is an <code>ItemReader</code> that reads records by using a
<code>PagingAndSortingRepository</code>. Spring Batch provides a <code>RepositoryItemReaderBuilder</code> to
construct an instance of the <code>RepositoryItemReader</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="databaseWriters"><a class="anchor" href="#databaseWriters"></a>1.15.4. Database Writers</h4>
<div class="paragraph">
<p>Spring Batch offers the following database writers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#neo4jItemWriter"><code>Neo4jItemWriter</code></a></p>
</li>
<li>
<p><a href="#mongoItemWriter"><code>MongoItemWriter</code></a></p>
</li>
<li>
<p><a href="#repositoryItemWriter"><code>RepositoryItemWriter</code></a></p>
</li>
<li>
<p><a href="#hibernateItemWriter"><code>HibernateItemWriter</code></a></p>
</li>
<li>
<p><a href="#jdbcBatchItemWriter"><code>JdbcBatchItemWriter</code></a></p>
</li>
<li>
<p><a href="#jpaItemWriter"><code>JpaItemWriter</code></a></p>
</li>
<li>
<p><a href="#gemfireItemWriter"><code>GemfireItemWriter</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="neo4jItemWriter"><a class="anchor" href="#neo4jItemWriter"></a><code>Neo4jItemWriter</code></h5>
<div class="paragraph">
<p>The <code>Neo4jItemWriter</code> is an <code>ItemWriter</code> implementation that writes to a Neo4j database.
Spring Batch provides a <code>Neo4jItemWriterBuilder</code> to construct an instance of the
<code>Neo4jItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="mongoItemWriter"><a class="anchor" href="#mongoItemWriter"></a><code>MongoItemWriter</code></h5>
<div class="paragraph">
<p>The <code>MongoItemWriter</code> is an <code>ItemWriter</code> implementation that writes to a MongoDB store
using an implementation of Spring Data&#8217;s <code>MongoOperations</code>. Spring Batch provides a
<code>MongoItemWriterBuilder</code> to construct an instance of the <code>MongoItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="repositoryItemWriter"><a class="anchor" href="#repositoryItemWriter"></a><code>RepositoryItemWriter</code></h5>
<div class="paragraph">
<p>The <code>RepositoryItemWriter</code> is an <code>ItemWriter</code> wrapper for a <code>CrudRepository</code> from Spring
Data. Spring Batch provides a <code>RepositoryItemWriterBuilder</code> to construct an instance of
the <code>RepositoryItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="hibernateItemWriter"><a class="anchor" href="#hibernateItemWriter"></a><code>HibernateItemWriter</code></h5>
<div class="paragraph">
<p>The <code>HibernateItemWriter</code> is an <code>ItemWriter</code> that uses a Hibernate session to save or
update entities that are not part of the current Hibernate session. Spring Batch provides
a <code>HibernateItemWriterBuilder</code> to construct an instance of the <code>HibernateItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jdbcBatchItemWriter"><a class="anchor" href="#jdbcBatchItemWriter"></a><code>JdbcBatchItemWriter</code></h5>
<div class="paragraph">
<p>The <code>JdbcBatchItemWriter</code> is an <code>ItemWriter</code> that uses the batching features from
<code>NamedParameterJdbcTemplate</code> to execute a batch of statements for all items provided.
Spring Batch provides a <code>JdbcBatchItemWriterBuilder</code> to construct an instance of the
<code>JdbcBatchItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="jpaItemWriter"><a class="anchor" href="#jpaItemWriter"></a><code>JpaItemWriter</code></h5>
<div class="paragraph">
<p>The <code>JpaItemWriter</code> is an <code>ItemWriter</code> that uses a JPA <code>EntityManagerFactory</code> to merge
any entities that are not part of the persistence context. Spring Batch provides a
<code>JpaItemWriterBuilder</code> to construct an instance of the <code>JpaItemWriter</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="gemfireItemWriter"><a class="anchor" href="#gemfireItemWriter"></a><code>GemfireItemWriter</code></h5>
<div class="paragraph">
<p>The <code>GemfireItemWriter</code> is an <code>ItemWriter</code> that uses a <code>GemfireTemplate</code> that stores
items in GemFire as key/value pairs. Spring Batch provides a <code>GemfireItemWriterBuilder</code>
to construct an instance of the <code>GemfireItemWriter</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specializedReaders"><a class="anchor" href="#specializedReaders"></a>1.15.5. Specialized Readers</h4>
<div class="paragraph">
<p>Spring Batch offers the following specialized readers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ldifReader"><code>LdifReader</code></a></p>
</li>
<li>
<p><a href="#mappingLdifReader"><code>MappingLdifReader</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ldifReader"><a class="anchor" href="#ldifReader"></a><code>LdifReader</code></h5>
<div class="paragraph">
<p>The <code>LdifReader</code> reads LDIF (LDAP Data Interchange Format) records from a <code>Resource</code>,
parses them, and returns a <code>LdapAttribute</code> object for each <code>read</code> executed. Spring Batch
provides a <code>LdifReaderBuilder</code> to construct an instance of the <code>LdifReader</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="mappingLdifReader"><a class="anchor" href="#mappingLdifReader"></a><code>MappingLdifReader</code></h5>
<div class="paragraph">
<p>The <code>MappingLdifReader</code> reads LDIF (LDAP Data Interchange Format) records from a
<code>Resource</code>, parses them then maps each LDIF record to a POJO (Plain Old Java Object).
Each read returns a POJO. Spring Batch provides a <code>MappingLdifReaderBuilder</code> to construct
an instance of the <code>MappingLdifReader</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specializedWriters"><a class="anchor" href="#specializedWriters"></a>1.15.6. Specialized Writers</h4>
<div class="paragraph">
<p>Spring Batch offers the following specialized writers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#simpleMailMessageItemWriter"><code>SimpleMailMessageItemWriter</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="simpleMailMessageItemWriter"><a class="anchor" href="#simpleMailMessageItemWriter"></a><code>SimpleMailMessageItemWriter</code></h5>
<div class="paragraph">
<p>The <code>SimpleMailMessageItemWriter</code> is an <code>ItemWriter</code> that can send mail messages. It
delegates the actual sending of messages to an instance of <code>MailSender</code>. Spring Batch
provides a <code>SimpleMailMessageItemWriterBuilder</code> to construct an instance of the
<code>SimpleMailMessageItemWriter</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specializedProcessors"><a class="anchor" href="#specializedProcessors"></a>1.15.7. Specialized Processors</h4>
<div class="paragraph">
<p>Spring Batch offers the following specialized processors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#scriptItemProcessor"><code>ScriptItemProcessor</code></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="scriptItemProcessor"><a class="anchor" href="#scriptItemProcessor"></a><code>ScriptItemProcessor</code></h5>
<div class="paragraph">
<p>The <code>ScriptItemProcessor</code> is an <code>ItemProcessor</code> that passes the current item to process
to the provided script and the result of the script is returned by the processor. Spring
Batch provides a <code>ScriptItemProcessorBuilder</code> to construct an instance of the
<code>ScriptItemProcessor</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.1.2.RELEASE<br>
Last updated 2019-04-03 09:14:50 UTC
</div>
</div>
<script type="text/javascript" src="tocbot-3.0.2/tocbot.js"></script>
<script type="text/javascript" >

    // Tocbot dynamic TOC, works with tocbot 3.0.2
    // Source: https://github.com/asciidoctor/asciidoctor/issues/699#issuecomment-321066006

    var oldtoc = document.getElementById('toctitle').nextElementSibling;
    var newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);
    tocbot.init({ contentSelector: '#content',
        headingSelector: 'h1, h2, h3, h4, h5',
        smoothScroll: false });
    var handleTocRefresh = function() {
        tocbot.refresh();
    }
    var handleTocOnResize = function() {
        var width = window.innerWidth
                    || document.documentElement.clientWidth
                    || document.body.clientWidth;
        if (width < 768) {
            tocbot.refresh({ contentSelector: '#content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 6,
                activeLinkClass: 'ignoreactive',
                throttleTimeout: 1000,
                smoothScroll: false });
        }
        else {
            tocbot.refresh({ contentSelector: '#content',
                headingSelector: 'h1, h2, h3, h4, h5',
                smoothScroll: false });
        }
    };
    window.addEventListener('resize', handleTocOnResize);
    window.addEventListener('tocRefresh', handleTocRefresh);
    handleTocOnResize();

    var link = document.createElement("a");
    link.setAttribute("href", "index.html");
    link.innerHTML = "<i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp;Back to index";
    var p = document.createElement("p");
    p.setAttribute("id", "backToIndex");
    p.appendChild(link);
    var toc = document.getElementById('toc');
    toc.insertBefore(p, toctitle);

</script>
</body>
</html>