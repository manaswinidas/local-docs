<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Configuring a Step</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #34302d; padding: 0; margin: 0; font-family: "Varela Round", sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #0b0a0a; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #548e2e; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #487a28; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Montserrat, sans-serif; font-weight: 400; font-style: normal; color: #34302d; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #867c74; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #34302d; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #34302d; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #34302d; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #6b625c; }

kbd { font-family: Monaco, Menlo, Consolas, "Courier New", monospace; display: inline-block; color: #34302d; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #191715; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Montserrat, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #0b0a0a; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f1f1f1; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d7d7d7; margin-bottom: 1.25em; padding: 1.25em; background: #f1f1f1; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #34302d; padding: 1.25em; }

#footer-text { color: #cbcfd2; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #34302d; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #262321; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Varela Round", sans-serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Montserrat, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d7d7d7; margin-bottom: 1.25em; padding: 1.25em; background: #f1f1f1; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #0b0a0a; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: whitesmoke; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #dddddd; -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: whitesmoke; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #0b0a0a; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #34302d; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #3f6a22; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #34302d; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.admonitionblock { border-left: 4px solid #6db33f; background-color: #ebf1e7; padding: 1.2em 0; margin: 30px 0; width: auto; }

#toc a:hover { text-decoration: underline; }

.admonitionblock > table td.content { border-left: none; }

.js-download-widget-selector{display:inline;}.navbar{margin-bottom:0;}.item-slider-widget{display:inline-block;margin-left:15px;}.item-slider-widget .item--slider{height:32px;position:absolute;width:40px;border-radius:2px;margin-top:-4px;z-index:800;background:#68605a;background:-moz-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#68605a),color-stop(100%,#34302d),color-stop(100%,#020202));background:-webkit-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:-o-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:-ms-linear-gradient(top,#68605a 0%,#34302d 100%,#020202 100%);background:linear-gradient(to bottom,#68605a 0%,#34302d 100%,#020202 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#68605a',endColorstr='#020202',GradientType=0);cursor:pointer;transition:all 0.25s;-webkit-transition:all 0.25s;-moz-webkit-transition:all 0.25s;-ms--webkit-transition:all 0.25s;-o-webkit-transition:all 0.25s;}.item-slider-widget .item-slider--container{background-color:white;border:1px solid #999;padding:0 3px;}.item-slider-widget .item-slider--container .item{display:inline-block;color:#c3c3c3;font-family:"Montserrat",sans-serif;font-size:12px;line-height:12px;text-transform:uppercase;padding:7px 6px 5px;cursor:pointer;transition:color 0.25s;-webkit-transition:color 0.25s;-moz-webkit-transition:color 0.25s;-ms--webkit-transition:color 0.25s;-o-webkit-transition:color 0.25s;}.item-slider-widget .item-slider--container .item:hover{color:black;}.item-slider-widget .item-slider--container .item.js-active{z-index:801;position:relative;color:#f1f1f1;}

/* Styling for the toggle buttons */
/* Borrowed from http://jeremyworboys.com/writing/toggle-buttons-without-javascript */
/* Micro clearfix (http://nicolasgallagher.com/micro-clearfix-hack/) */
.cf:before,.cf:after{content:"";display:table}.cf:after{clear:both}.cf{zoom:1}

/* = Function = */

.docToggle-button input {
    display: none;
}
.docToggle-button label {
    background: #ccc;
    border: 1px solid #888;
    color: #666;
    padding: 5px 10px;
}
.docToggle-button label:hover {
    background-color: #ddd;
}
.docToggle-button label:active,
.docToggle-button input:focus + label {
    background-color: #aaa;
}
.docToggle-button input:checked + label {
    background-color: #b4b4b4;
}

.docToggle-button label {
    background-color: #f5f5f5;
    background-image: -webkit-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: -moz-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: -o-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: -ms-linear-gradient(top, #ffffff, #e6e6e6);
    background-image: linear-gradient(top, #ffffff, #e6e6e6);
    background-repeat: repeat-x;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#e6e6e6', GradientType=0);
    border-color: #e6e6e6 #e6e6e6 #bfbfbf;
    border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
    border: 1px solid #cccccc;
    border-bottom-color: #b3b3b3;
    -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);
    -moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05);
    color: #333333;
    cursor: pointer;
    display: inline-block;
    margin-bottom: 0;
    margin-left: -1px;
    padding: 4px 10px;
    font-size: 13px;
    line-height: 18px;
    text-align: center;
    text-shadow: 0 1px 1px rgba(255, 255, 255, 0.75);
    vertical-align: middle;
}
.docToggle-button label:hover {
    background-color: #e6e6e6;
    background-position: 0 -15px;
    color: #333333;
    text-decoration: none;
    -webkit-transition: background-position 0.1s linear;
    -moz-transition: background-position 0.1s linear;
    -ms-transition: background-position 0.1s linear;
    -o-transition: background-position 0.1s linear;
    transition: background-position 0.1s linear;
}
.docToggle-button label:active,
.docToggle-button input:focus + label {
    background-color: #d9d9d9;
    background-image: none;
    -webkit-box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    -moz-box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    outline: 0;
}

.docToggle-button input:checked + label {
    background: #404040;
    color: #ffffff;
    -webkit-box-shadow: inset 0 1px 6px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    -moz-box-shadow: inset 0 1px 6px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05);
    box-shadow: inset 0 1px 6px rgba(0, 0, 0, 0.15), 0 1px 2px  rgba(0, 0, 0, 0.05);
}
.docToggle-button:first-child label {
  -webkit-border-top-left-radius: 4px;
  -moz-border-radius-topleft: 4px;
  border-top-left-radius: 4px;
  -webkit-border-bottom-left-radius: 4px;
  -moz-border-radius-bottomleft: 4px;
  border-bottom-left-radius: 4px;
  margin-left: 0;
}
.docToggle-button:last-child label {
  -webkit-border-top-right-radius: 4px;
  -moz-border-radius-topright: 4px;
  border-top-right-radius: 4px;
  -webkit-border-bottom-right-radius: 4px;
  -moz-border-radius-bottomright: 4px;
  border-bottom-right-radius: 4px;

  -webkit-border-top-left-radius: 4px;
  -moz-border-radius-topleft: 4px;
  border-top-left-radius: 4px;
  -webkit-border-bottom-left-radius: 4px;
  -moz-border-radius-bottomleft: 4px;
  border-bottom-left-radius: 4px;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>
  #tocbot a.toc-link.node-name--H1{ font-style: italic }
  @media screen{
    #tocbot > ul.toc-list{ margin-bottom: 0.5em; margin-left: 0.125em }
    #tocbot ul.sectlevel0, #tocbot a.toc-link.node-name--H1 + ul{
      padding-left: 0 }
    #tocbot a.toc-link{ height:100% }
    .is-collapsible{ max-height:3000px; overflow:hidden; }
    .is-collapsed{ max-height:0 }
    .is-active-link{ font-weight:700 }
  }
  @media print{
    #tocbot a.toc-link.node-name--H4{ display:none }
  }
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#configureStep">1. Configuring a <code>Step</code></a>
<ul class="sectlevel2">
<li><a href="#chunkOrientedProcessing">1.1. Chunk-oriented Processing</a>
<ul class="sectlevel3">
<li><a href="#configuringAStep">1.1.1. Configuring a <code>Step</code></a></li>
<li><a href="#InheritingFromParentStep">1.1.2. Inheriting from a Parent <code>Step</code></a>
<ul class="sectlevel4">
<li><a href="#abstractStep">Abstract <code>Step</code></a></li>
<li><a href="#mergingListsOnStep">Merging Lists</a></li>
</ul>
</li>
<li><a href="#commitInterval">1.1.3. The Commit Interval</a></li>
<li><a href="#stepRestart">1.1.4. Configuring a <code>Step</code> for Restart</a>
<ul class="sectlevel4">
<li><a href="#startLimit">Setting a Start Limit</a></li>
<li><a href="#allowStartIfComplete">Restarting a Completed <code>Step</code></a></li>
<li><a href="#stepRestartExample"><code>Step</code> Restart Configuration Example</a></li>
</ul>
</li>
<li><a href="#configuringSkip">1.1.5. Configuring Skip Logic</a></li>
<li><a href="#retryLogic">1.1.6. Configuring Retry Logic</a></li>
<li><a href="#controllingRollback">1.1.7. Controlling Rollback</a>
<ul class="sectlevel4">
<li><a href="#transactionalReaders">Transactional Readers</a></li>
</ul>
</li>
<li><a href="#transactionAttributes">1.1.8. Transaction Attributes</a></li>
<li><a href="#registeringItemStreams">1.1.9. Registering <code>ItemStream</code> with a <code>Step</code></a></li>
<li><a href="#interceptingStepExecution">1.1.10. Intercepting <code>Step</code> Execution</a>
<ul class="sectlevel4">
<li><a href="#stepExecutionListener"><code>StepExecutionListener</code></a></li>
<li><a href="#chunkListener"><code>ChunkListener</code></a></li>
<li><a href="#itemReadListener"><code>ItemReadListener</code></a></li>
<li><a href="#itemProcessListener"><code>ItemProcessListener</code></a></li>
<li><a href="#itemWriteListener"><code>ItemWriteListener</code></a></li>
<li><a href="#skipListener"><code>SkipListener</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#taskletStep">1.2. <code>TaskletStep</code></a>
<ul class="sectlevel3">
<li><a href="#taskletAdapter">1.2.1. <code>TaskletAdapter</code></a></li>
<li><a href="#exampleTaskletImplementation">1.2.2. Example <code>Tasklet</code> Implementation</a></li>
</ul>
</li>
<li><a href="#controllingStepFlow">1.3. Controlling Step Flow</a>
<ul class="sectlevel3">
<li><a href="#SequentialFlow">1.3.1. Sequential Flow</a></li>
<li><a href="#conditionalFlow">1.3.2. Conditional Flow</a>
<ul class="sectlevel4">
<li><a href="#batchStatusVsExitStatus">Batch Status Versus Exit Status</a></li>
</ul>
</li>
<li><a href="#configuringForStop">1.3.3. Configuring for Stop</a>
<ul class="sectlevel4">
<li><a href="#endElement">Ending at a Step</a></li>
<li><a href="#failElement">Failing a Step</a></li>
<li><a href="#stopElement">Stopping a Job at a Given Step</a></li>
</ul>
</li>
<li><a href="#programmaticFlowDecisions">1.3.4. Programmatic Flow Decisions</a></li>
<li><a href="#split-flows">1.3.5. Split Flows</a></li>
<li><a href="#external-flows">1.3.6. Externalizing Flow Definitions and Dependencies Between Jobs</a></li>
</ul>
</li>
<li><a href="#late-binding">1.4. Late Binding of <code>Job</code> and <code>Step</code> Attributes</a>
<ul class="sectlevel3">
<li><a href="#step-scope">1.4.1. Step Scope</a></li>
<li><a href="#job-scope">1.4.2. Job Scope</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="configureStep"><a class="anchor" href="#configureStep"></a>1. Configuring a <code>Step</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>
<div>
  <script type="text/javascript" src="jsfiles/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="jsfiles/js.cookie.js"></script>
  <script type="text/javascript" src="jsfiles/DocumentToggle.js"></script>
  <div class="docToggle-button">
    <input id="xmlButton" type="radio" name="docToggle" value="XML"><label for="xmlButton">XML</label>
    <input id="javaButton" type="radio" name="docToggle" value="Java" checked><label for="javaButton">Java</label>
    <!-- <input id="bothButton" type="radio" name="docToggle" value="Both" checked><label for="bothButton">Both</label> -->
  </div>
</div>
</p>
</div>
<div class="paragraph">
<p>As discussed in <a href="domain.html#domainLanguageOfBatch">the domain chapter</a>, a <code>Step</code> is a
domain object that encapsulates an independent, sequential phase of a batch job and
contains all of the information necessary to define and control the actual batch
processing. This is a necessarily vague description because the contents of any given
<code>Step</code> are at the discretion of the developer writing a <code>Job</code>. A <code>Step</code> can be as simple
or complex as the developer desires. A simple <code>Step</code> might load data from a file into the
database, requiring little or no code (depending upon the implementations used). A more
complex <code>Step</code> might have complicated business rules that are applied as part of the
processing, as shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/step.png" alt="Step">
</div>
<div class="title">Figure 1. Step</div>
</div>
<div class="sect2">
<h3 id="chunkOrientedProcessing"><a class="anchor" href="#chunkOrientedProcessing"></a>1.1. Chunk-oriented Processing</h3>
<div class="paragraph">
<p>Spring Batch uses a 'Chunk-oriented' processing style within its most common
implementation. Chunk oriented processing refers to reading the data one at a time and
creating 'chunks' that are written out within a transaction boundary. One item is read in
from an <code>ItemReader</code>, handed to an <code>ItemProcessor</code>, and aggregated. Once the number of
items read equals the commit interval, the entire chunk is written out by the
<code>ItemWriter</code>, and then the transaction is committed. The following image shows the
process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/chunk-oriented-processing.png" alt="Chunk Oriented Processing">
</div>
<div class="title">Figure 2. Chunk-oriented Processing</div>
</div>
<div class="paragraph">
<p>The following code shows the same concepts shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span> items = <span class="keyword">new</span> Arraylist();
<span class="keyword">for</span>(<span class="type">int</span> i = <span class="integer">0</span>; i &lt; commitInterval; i++){
    <span class="predefined-type">Object</span> item = itemReader.read()
    <span class="predefined-type">Object</span> processedItem = itemProcessor.process(item);
    items.add(processedItem);
}
itemWriter.write(items);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="configuringAStep"><a class="anchor" href="#configuringAStep"></a>1.1.1. Configuring a <code>Step</code></h4>
<div class="paragraph">
<p>Despite the relatively short list of required dependencies for a <code>Step</code>, it is an
extremely complex class that can potentially contain many collaborators.</p>
</div>
<div class="paragraph xmlContent">
<p>In order to ease configuration, the Spring Batch namespace can be used, as shown in the
following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">job-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet</span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>When using java configuration, the Spring Batch builders can be used, as shown in the
following example:</p>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Note the JobRepository is typically autowired in and not needed to be explicitly
 * configured
 */</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> Job sampleJob(JobRepository jobRepository, Step sampleStep) {
    <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleJob</span><span class="delimiter">&quot;</span></span>)
                            .repository(jobRepository)
                .start(sampleStep)
                .build();
}

<span class="comment">/**
 * Note the TransactionManager is typically autowired in and not needed to be explicitly
 * configured
 */</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> Step sampleStep(PlatformTransactionManager transactionManager) {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleStep</span><span class="delimiter">&quot;</span></span>)
                                .transactionManager(transactionManager)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above includes the only required dependencies to create a item-oriented
step:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>reader</code>: The <code>ItemReader</code> that provides items for processing.</p>
</li>
<li>
<p><code>writer</code>: The <code>ItemWriter</code> that processes the items provided by the <code>ItemReader</code>.</p>
</li>
</ul>
</div>
<div class="ulist xmlContent">
<ul>
<li>
<p><code>transaction-manager</code>: Spring&#8217;s <code>PlatformTransactionManager</code> that begins and commits
transactions during processing.</p>
</li>
</ul>
</div>
<div class="ulist javaContent">
<ul>
<li>
<p><code>transactionManager</code>: Spring&#8217;s <code>PlatformTransactionManager</code> that begins and commits
transactions during processing.</p>
</li>
</ul>
</div>
<div class="ulist xmlContent">
<ul>
<li>
<p><code>job-repository</code>: The <code>JobRepository</code> that periodically stores the <code>StepExecution</code> and
<code>ExecutionContext</code> during processing (just before committing). For an in-line &lt;step/&gt;
(one defined within a &lt;job/&gt;), it is an attribute on the &lt;job/&gt; element. For a standalone
step, it is defined as an attribute of the &lt;tasklet/&gt;.</p>
</li>
</ul>
</div>
<div class="ulist javaContent">
<ul>
<li>
<p><code>repository</code>: The <code>JobRepository</code> that periodically stores the <code>StepExecution</code> and
<code>ExecutionContext</code> during processing (just before committing).</p>
</li>
</ul>
</div>
<div class="ulist xmlContent">
<ul>
<li>
<p><code>commit-interval</code>: The number of items to be processed before the transaction is
committed.</p>
</li>
</ul>
</div>
<div class="ulist javaContent">
<ul>
<li>
<p><code>chunk</code>: Indicates that this is an item based step and the number of items to be
processed before the transaction is committed.</p>
</li>
</ul>
</div>
<div class="paragraph xmlContent">
<p>It should be noted that <code>job-repository</code> defaults to <code>jobRepository</code> and
<code>transaction-manager</code> defaults to <code>transactionManger</code>. Also, the <code>ItemProcessor</code> is
optional, since the item could be directly passed from the reader to the writer.</p>
</div>
<div class="paragraph javaContent">
<p>It should be noted that <code>repository</code> defaults to <code>jobRepository</code> and <code>transactionManager</code>
defaults to <code>transactionManger</code> (all provided through the infrastructure from
<code>@EnableBatchProcessing</code>). Also, the <code>ItemProcessor</code> is optional, since the item could be
directly passed from the reader to the writer.</p>
</div>
</div>
<div class="sect3 xmlContent">
<h4 id="InheritingFromParentStep"><a class="anchor" href="#InheritingFromParentStep"></a>1.1.2. Inheriting from a Parent <code>Step</code></h4>
<div class="paragraph xmlContent">
<p>If a group of <code>Steps</code> share similar configurations, then it may be helpful to define a
"parent" <code>Step</code> from which the concrete <code>Steps</code> may inherit properties. Similar to class
inheritance in Java, the "child" <code>Step</code> combines its elements and attributes with the
parent&#8217;s. The child also overrides any of the parent&#8217;s <code>Steps</code>.</p>
</div>
<div class="paragraph xmlContent">
<p>In the following example, the <code>Step</code>, "concreteStep1", inherits from "parentStep". It is
instantiated with 'itemReader', 'itemProcessor', 'itemWriter', <code>startLimit=5</code>, and
<code>allowStartIfComplete=true</code>. Additionally, the <code>commitInterval</code> is '5', since it is
overridden by the "concreteStep1" <code>Step</code>, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parentStep</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet</span> <span class="attribute-name">allow-start-if-complete</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concreteStep1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parentStep</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet</span> <span class="attribute-name">start-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">processor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemProcessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph xmlContent">
<p>The <code>id</code> attribute is still required on the step within the job element. This is for two
reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>id</code> is used as the step name when persisting the <code>StepExecution</code>. If the same
standalone step is referenced in more than one step in the job, an error occurs.</p>
</li>
</ul>
</div>
<div class="ulist xmlContent">
<ul>
<li>
<p>When creating job flows, as described later in this chapter, the <code>next</code> attribute
should be referring to the step in the flow, not the standalone step.</p>
</li>
</ul>
</div>
<div class="sect4 xmlContent">
<h5 id="abstractStep"><a class="anchor" href="#abstractStep"></a>Abstract <code>Step</code></h5>
<div class="paragraph xmlContent">
<p>Sometimes, it may be necessary to define a parent <code>Step</code> that is not a complete <code>Step</code>
configuration. If, for instance, the <code>reader</code>, <code>writer</code>, and <code>tasklet</code> attributes are
left off of a <code>Step</code> configuration, then initialization fails. If a parent must be
defined without these properties, then the <code>abstract</code> attribute should be used. An
<code>abstract</code> <code>Step</code> is only extended, never instantiated.</p>
</div>
<div class="paragraph xmlContent">
<p>In the following example, the <code>Step</code> <code>abstractParentStep</code> would not be instantiated if it
were not declared to be abstract. The <code>Step</code>, "concreteStep2", has 'itemReader',
'itemWriter', and commit-interval=10.</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">abstractParentStep</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concreteStep2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">abstractParentStep</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4 xmlContent">
<h5 id="mergingListsOnStep"><a class="anchor" href="#mergingListsOnStep"></a>Merging Lists</h5>
<div class="paragraph xmlContent">
<p>Some of the configurable elements on <code>Steps</code> are lists, such as the <code>&lt;listeners/&gt;</code> element.
If both the parent and child <code>Steps</code> declare a <code>&lt;listeners/&gt;</code> element, then the
child&#8217;s list overrides the parent&#8217;s. In order to allow a child to add additional
listeners to the list defined by the parent, every list element has a <code>merge</code> attribute.
If the element specifies that <code>merge="true"</code>, then the child&#8217;s list is combined with the
parent&#8217;s instead of overriding it.</p>
</div>
<div class="paragraph xmlContent">
<p>In the following example, the <code>Step</code> "concreteStep3", is created with two listeners:
<code>listenerOne</code> and <code>listenerTwo</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">listenersParentStep</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">listenerOne</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concreteStep3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">listenersParentStep</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;listeners</span> <span class="attribute-name">merge</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">listenerTwo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="commitInterval"><a class="anchor" href="#commitInterval"></a>1.1.3. The Commit Interval</h4>
<div class="paragraph">
<p>As mentioned previously, a step reads in and writes out items, periodically committing
using the supplied <code>PlatformTransactionManager</code>. With a <code>commit-interval</code> of 1, it
commits after writing each individual item. This is less than ideal in many situations,
since beginning and committing a transaction is expensive. Ideally, it is preferable to
process as many items as possible in each transaction, which is completely dependent upon
the type of data being processed and the resources with which the step is interacting.
For this reason, the number of items that are processed within a commit can be
configured. The following example shows a <code>step</code> whose <code>tasklet</code> has a <code>commit-interval</code>
value of 10.</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleJob</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job sampleJob() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleJob</span><span class="delimiter">&quot;</span></span>)
                     .start(step1())
                     .end()
                     .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, 10 items are processed within each transaction. At the
beginning of processing, a transaction is begun. Also, each time <code>read</code> is called on the
<code>ItemReader</code>, a counter is incremented. When it reaches 10, the list of aggregated items
is passed to the <code>ItemWriter</code>, and the transaction is committed.</p>
</div>
</div>
<div class="sect3">
<h4 id="stepRestart"><a class="anchor" href="#stepRestart"></a>1.1.4. Configuring a <code>Step</code> for Restart</h4>
<div class="paragraph">
<p>In the "<a href="job.html#configureJob">Configuring and Running a Job</a>" section , restarting a
<code>Job</code> was discussed. Restart has numerous impacts on steps, and, consequently, may
require some specific configuration.</p>
</div>
<div class="sect4">
<h5 id="startLimit"><a class="anchor" href="#startLimit"></a>Setting a Start Limit</h5>
<div class="paragraph">
<p>There are many scenarios where you may want to control the number of times a <code>Step</code> may
be started. For example, a particular <code>Step</code> might need to be configured so that it only
runs once because it invalidates some resource that must be fixed manually before it can
be run again. This is configurable on the step level, since different steps may have
different requirements. A <code>Step</code> that may only be executed once can exist as part of the
same <code>Job</code> as a <code>Step</code> that can be run infinitely. The following code fragment shows an
example of a start limit configuration:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet</span> <span class="attribute-name">start-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .startLimit(<span class="integer">1</span>)
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step above can be run only once. Attempting to run it again causes a
<code>StartLimitExceededException</code> to be thrown. Note that the default value for the
start-limit is <code>Integer.MAX_VALUE</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="allowStartIfComplete"><a class="anchor" href="#allowStartIfComplete"></a>Restarting a Completed <code>Step</code></h5>
<div class="paragraph">
<p>In the case of a restartable job, there may be one or more steps that should always be
run, regardless of whether or not they were successful the first time. An example might
be a validation step or a <code>Step</code> that cleans up resources before processing. During
normal processing of a restarted job, any step with a status of 'COMPLETED', meaning it
has already been completed successfully, is skipped. Setting <code>allow-start-if-complete</code> to
"true" overrides this so that the step always runs, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet</span> <span class="attribute-name">allow-start-if-complete</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .allowStartIfComplete(<span class="predefined-constant">true</span>)
                                .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="stepRestartExample"><a class="anchor" href="#stepRestartExample"></a><code>Step</code> Restart Configuration Example</h5>
<div class="paragraph">
<p>The following example shows how to configure a job to have steps that can be restarted:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">footballJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restartable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerload</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gameLoad</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerWriter</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gameLoad</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerSummarization</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet</span> <span class="attribute-name">allow-start-if-complete</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gameFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gameWriter</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerSummarization</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tasklet</span> <span class="attribute-name">start-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">playerSummarizationSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">summaryWriter</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/tasklet&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job footballJob() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">footballJob</span><span class="delimiter">&quot;</span></span>)
                                .start(playerLoad())
                                .next(gameLoad())
                                .next(playerSummarization())
                                .end()
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step playerLoad() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">playerLoad</span><span class="delimiter">&quot;</span></span>)
                        .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                        .reader(playerFileItemReader())
                        .writer(playerWriter())
                        .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step gameLoad() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">gameLoad</span><span class="delimiter">&quot;</span></span>)
                        .allowStartIfComplete(<span class="predefined-constant">true</span>)
                        .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                        .reader(gameFileItemReader())
                        .writer(gameWriter())
                        .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step playerSummarization() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactor.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">playerSummarization</span><span class="delimiter">&quot;</span></span>)
                        .startLimit(<span class="integer">2</span>)
                        .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                        .reader(playerSummarizationSource())
                        .writer(summaryWriter())
                        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example configuration is for a job that loads in information about football
games and summarizes them. It contains three steps: <code>playerLoad</code>, <code>gameLoad</code>, and
<code>playerSummarization</code>. The <code>playerLoad</code> step loads player information from a flat file,
while the <code>gameLoad</code> step does the same for games. The final step,
<code>playerSummarization</code>, then summarizes the statistics for each player, based upon the
provided games. It is assumed that the file loaded by <code>playerLoad</code> must be loaded only
once, but that <code>gameLoad</code> can load any games found within a particular directory,
deleting them after they have been successfully loaded into the database. As a result,
the <code>playerLoad</code> step contains no additional configuration. It can be started any number
of times, and, if complete, is skipped. The <code>gameLoad</code> step, however, needs to be run
every time in case extra files have been added since it last ran. It has
'allow-start-if-complete' set to 'true' in order to always be started. (It is assumed
that the database tables games are loaded into has a process indicator on it, to ensure
new games can be properly found by the summarization step). The summarization step,
which is the most important in the job, is configured to have a start limit of 2. This
is useful because if the step continually fails, a new exit code is returned to the
operators that control job execution, and it can not start again until manual
intervention has taken place.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This job provides an example for this document and is not the same as the <code>footballJob</code>
found in the samples project.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The remainder of this section describes what happens for each of the three runs of the
<code>footballJob</code> example.</p>
</div>
<div class="paragraph">
<p>Run 1:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>playerLoad</code> runs and completes successfully, adding 400 players to the 'PLAYERS'
table.</p>
</li>
<li>
<p><code>gameLoad</code> runs and processes 11 files worth of game data, loading their contents
into the 'GAMES' table.</p>
</li>
<li>
<p><code>playerSummarization</code> begins processing and fails after 5 minutes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Run 2:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>playerLoad</code> does not run, since it has already completed successfully, and
<code>allow-start-if-complete</code> is 'false' (the default).</p>
</li>
<li>
<p><code>gameLoad</code> runs again and processes another 2 files, loading their contents into the
'GAMES' table as well (with a process indicator indicating they have yet to be
processed).</p>
</li>
<li>
<p><code>playerSummarization</code> begins processing of all remaining game data (filtering using the
process indicator) and fails again after 30 minutes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Run 3:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>playerLoad</code> does not run, since it has already completed successfully, and
<code>allow-start-if-complete</code> is 'false' (the default).</p>
</li>
<li>
<p><code>gameLoad</code> runs again and processes another 2 files, loading their contents into the
'GAMES' table as well (with a process indicator indicating they have yet to be
processed).</p>
</li>
<li>
<p><code>playerSummarization</code> is not started and the job is immediately killed, since this is
the third execution of <code>playerSummarization</code>, and its limit is only 2. Either the limit
must be raised or the <code>Job</code> must be executed as a new <code>JobInstance</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuringSkip"><a class="anchor" href="#configuringSkip"></a>1.1.5. Configuring Skip Logic</h4>
<div class="paragraph">
<p>There are many scenarios where errors encountered while processing should not result in
<code>Step</code> failure, but should be skipped instead. This is usually a decision that must be
made by someone who understands the data itself and what meaning it has. Financial data,
for example, may not be skippable because it results in money being transferred, which
needs to be completely accurate. Loading a list of vendors, on the other hand, might
allow for skips. If a vendor is not loaded because it was formatted incorrectly or was
missing necessary information, then there probably are not issues. Usually, these bad
records are logged as well, which is covered later when discussing listeners.</p>
</div>
<div class="paragraph">
<p>The following example shows an example of using a skip limit:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;tasklet&gt;</span>
      <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">skip-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;skippable-exception-classes&gt;</span>
            <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileParseException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/skippable-exception-classes&gt;</span>
      <span class="tag">&lt;/chunk&gt;</span>
   <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(flatFileItemReader())
                                .writer(itemWriter())
                                .faultTolerant()
                                .skipLimit(<span class="integer">10</span>)
                                .skip(FlatFileParseException.class)
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, a <code>FlatFileItemReader</code> is used. If, at any point, a
<code>FlatFileParseException</code> is thrown, the item is skipped and counted against the total
skip limit of 10. Separate counts are made of skips on read, process, and write inside
the step execution, but the limit applies across all skips. Once the skip limit is
reached, the next exception found causes the step to fail. In other words, the eleventh
skip triggers the exception, not the tenth.</p>
</div>
<div class="paragraph">
<p>One problem with the preceding example is that any other exception besides a
<code>FlatFileParseException</code> causes the <code>Job</code> to fail. In certain scenarios, this may be the
correct behavior. However, in other scenarios, it may be easier to identify which
exceptions should cause failure and skip everything else, as shown in the following
example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">skip-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;skippable-exception-classes&gt;</span>
                <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Exception</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;exclude</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.io.FileNotFoundException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/skippable-exception-classes&gt;</span>
        <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(flatFileItemReader())
                                .writer(itemWriter())
                                .faultTolerant()
                                .skipLimit(<span class="integer">10</span>)
                                .skip(<span class="exception">Exception</span>.class)
                                .noSkip(<span class="exception">FileNotFoundException</span>.class)
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By identifying <code>java.lang.Exception</code> as a skippable exception class, the configuration
indicates that all <code>Exceptions</code> are skippable. However, by 'excluding'
<code>java.io.FileNotFoundException</code>, the configuration refines the list of skippable
exception classes to be all <code>Exceptions</code> <em>except</em> <code>FileNotFoundException</code>. Any excluded
exception classes is fatal if encountered (that is, they are not skipped).</p>
</div>
<div class="paragraph">
<p>For any exception encountered, the skippability is determined by the nearest superclass
in the class hierarchy. Any unclassified exception is treated as 'fatal'.</p>
</div>
<div class="paragraph xmlContent">
<p>The order of the <code>&lt;include/&gt;</code> and <code>&lt;exclude/&gt;</code> elements does not matter.</p>
</div>
<div class="paragraph javaContent">
<p>The order of the <code>skip</code> and <code>noSkip</code> calls does not matter.</p>
</div>
</div>
<div class="sect3">
<h4 id="retryLogic"><a class="anchor" href="#retryLogic"></a>1.1.6. Configuring Retry Logic</h4>
<div class="paragraph">
<p>In most cases, you want an exception to cause either a skip or a <code>Step</code> failure. However,
not all exceptions are deterministic. If a <code>FlatFileParseException</code> is encountered while
reading, it is always thrown for that record. Resetting the <code>ItemReader</code> does not help.
However, for other exceptions, such as a <code>DeadlockLoserDataAccessException</code>, which
indicates that the current process has attempted to update a record that another process
holds a lock on, waiting and trying again might result in success. In this case, retry
should be configured as follows:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;tasklet&gt;</span>
      <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">retry-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;retryable-exception-classes&gt;</span>
            <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.dao.DeadlockLoserDataAccessException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
         <span class="tag">&lt;/retryable-exception-classes&gt;</span>
      <span class="tag">&lt;/chunk&gt;</span>
   <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .faultTolerant()
                                .retryLimit(<span class="integer">3</span>)
                                .retry(DeadlockLoserDataAccessException.class)
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Step</code> allows a limit for the number of times an individual item can be retried and a
list of exceptions that are 'retryable'. More details on how retry works can be found in
<a href="retry.html#retry">retry</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="controllingRollback"><a class="anchor" href="#controllingRollback"></a>1.1.7. Controlling Rollback</h4>
<div class="paragraph">
<p>By default, regardless of retry or skip, any exceptions thrown from the <code>ItemWriter</code>
cause the transaction controlled by the <code>Step</code> to rollback. If skip is configured as
described earlier, exceptions thrown from the <code>ItemReader</code> do not cause a rollback.
However, there are many scenarios in which exceptions thrown from the <code>ItemWriter</code> should
not cause a rollback, because no action has taken place to invalidate the transaction.
For this reason, the <code>Step</code> can be configured with a list of exceptions that should not
cause rollback, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;tasklet&gt;</span>
      <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;no-rollback-exception-classes&gt;</span>
         <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.validator.ValidationException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/no-rollback-exception-classes&gt;</span>
   <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .faultTolerant()
                                .noRollback(ValidationException.class)
                                .build();
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="transactionalReaders"><a class="anchor" href="#transactionalReaders"></a>Transactional Readers</h5>
<div class="paragraph">
<p>The basic contract of the <code>ItemReader</code> is that it is forward only. The step buffers
reader input, so that in the case of a rollback, the items do not need to be re-read
from the reader. However, there are certain scenarios in which the reader is built on
top of a transactional resource, such as a JMS queue. In this case, since the queue is
tied to the transaction that is rolled back, the messages that have been pulled from the
queue are put back on. For this reason, the step can be configured to not buffer the
items, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">is-reader-transactional-queue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .readerIsTransactionalQueue()
                                .build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="transactionAttributes"><a class="anchor" href="#transactionAttributes"></a>1.1.8. Transaction Attributes</h4>
<div class="paragraph">
<p>Transaction attributes can be used to control the <code>isolation</code>, <code>propagation</code>, and
<code>timeout</code> settings. More information on setting transaction attributes can be found in
the
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction">Spring
core documentation</a>. The following example sets the <code>isolation</code>, <code>propagation</code>, and
<code>timeout</code> transaction attributes:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;transaction-attributes</span> <span class="attribute-name">isolation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DEFAULT</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">propagation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">REQUIRED</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        DefaultTransactionAttribute attribute = <span class="keyword">new</span> DefaultTransactionAttribute();
        attribute.setPropagationBehavior(Propagation.REQUIRED.value());
        attribute.setIsolationLevel(Isolation.DEFAULT.value());
        attribute.setTimeout(<span class="integer">30</span>);

        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(itemReader())
                                .writer(itemWriter())
                                .transactionAttribute(attribute)
                                .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registeringItemStreams"><a class="anchor" href="#registeringItemStreams"></a>1.1.9. Registering <code>ItemStream</code> with a <code>Step</code></h4>
<div class="paragraph">
<p>The step has to take care of <code>ItemStream</code> callbacks at the necessary points in its
lifecycle (For more information on the <code>ItemStream</code> interface, see
<a href="readersAndWriters.html#itemStream">ItemStream</a>). This is vital if a step fails and might
need to be restarted, because the <code>ItemStream</code> interface is where the step gets the
information it needs about persistent state between executions.</p>
</div>
<div class="paragraph">
<p>If the <code>ItemReader</code>, <code>ItemProcessor</code>, or <code>ItemWriter</code> itself implements the <code>ItemStream</code>
interface, then these are registered automatically. Any other streams need to be
registered separately. This is often the case where indirect dependencies, such as
delegates, are injected into the reader and writer. A stream can be registered on the
<code>Step</code> through the 'streams' element, as illustrated in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">itemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositeWriter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;streams&gt;</span>
                <span class="tag">&lt;stream</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileItemWriter1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;stream</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileItemWriter2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/streams&gt;</span>
        <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;beans:bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositeWriter</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.support.CompositeItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;beans:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">delegates</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;beans:list&gt;</span>
            <span class="tag">&lt;beans:ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileItemWriter1</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;beans:ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileItemWriter2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/beans:list&gt;</span>
    <span class="tag">&lt;/beans:property&gt;</span>
<span class="tag">&lt;/beans:bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">2</span>)
                                .reader(itemReader())
                                .writer(compositeItemWriter())
                                .stream(fileItemWriter1())
                                .stream(fileItemWriter2())
                                .build();
}

<span class="comment">/**
 * In Spring Batch 4, the CompositeItemWriter implements ItemStream so this isn't
 * necessary, but used for an example.
 */</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> CompositeItemWriter compositeItemWriter() {
        <span class="predefined-type">List</span>&lt;ItemWriter&gt; writers = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(<span class="integer">2</span>);
        writers.add(fileItemWriter1());
        writers.add(fileItemWriter2());

        CompositeItemWriter itemWriter = <span class="keyword">new</span> CompositeItemWriter();

        itemWriter.setDelegates(writers);

        <span class="keyword">return</span> itemWriter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>CompositeItemWriter</code> is not an <code>ItemStream</code>, but both of its
delegates are. Therefore, both delegate writers must be explicitly registered as streams
in order for the framework to handle them correctly. The <code>ItemReader</code> does not need to be
explicitly registered as a stream because it is a direct property of the <code>Step</code>. The step
is now restartable, and the state of the reader and writer is correctly persisted in the
event of a failure.</p>
</div>
</div>
<div class="sect3">
<h4 id="interceptingStepExecution"><a class="anchor" href="#interceptingStepExecution"></a>1.1.10. Intercepting <code>Step</code> Execution</h4>
<div class="paragraph">
<p>Just as with the <code>Job</code>, there are many events during the execution of a <code>Step</code> where a
user may need to perform some functionality. For example, in order to write out to a flat
file that requires a footer, the <code>ItemWriter</code> needs to be notified when the <code>Step</code> has
been completed, so that the footer can be written. This can be accomplished with one of many
<code>Step</code> scoped listeners.</p>
</div>
<div class="paragraph">
<p>Any class that implements one of the extensions of <code>StepListener</code> (but not that interface
itself since it is empty) can be applied to a step through the <code>listeners</code> element.
The <code>listeners</code> element is valid inside a step, tasklet, or chunk declaration.  It is
recommended that you declare the listeners at the level at which its function applies,
or, if it is multi-featured (such as <code>StepExecutionListener</code> and <code>ItemReadListener</code>),
then declare it at the most granular level where it applies. The following example shows
a listener applied at the chunk level:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet&gt;</span>
        <span class="tag">&lt;chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;listeners&gt;</span>
            <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">chunkListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/listeners&gt;</span>
    <span class="tag">&lt;/tasklet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                                .&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;chunk(<span class="integer">10</span>)
                                .reader(reader())
                                .writer(writer())
                                .listener(chunkListener())
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>ItemReader</code>, <code>ItemWriter</code> or <code>ItemProcessor</code> that itself implements one of the
<code>StepListener</code> interfaces is registered automatically with the <code>Step</code> if using the
namespace <code>&lt;step&gt;</code> element or one of the the <code>*StepFactoryBean</code> factories. This only
applies to components directly injected into the <code>Step</code>. If the listener is nested inside
another component, it needs to be explicitly registered (as described previously under
<a href="#registeringItemStreams">Registering <code>ItemStream</code> with a <code>Step</code></a>).</p>
</div>
<div class="paragraph">
<p>In addition to the <code>StepListener</code> interfaces, annotations are provided to address the
same concerns. Plain old Java objects can have methods with these annotations that are
then converted into the corresponding <code>StepListener</code> type. It is also common to annotate
custom implementations of chunk components such as <code>ItemReader</code> or <code>ItemWriter</code> or
<code>Tasklet</code>. The annotations are analyzed by the XML parser for the <code>&lt;listener/&gt;</code> elements
as well as registered with the <code>listener</code> methods in the builders, so all you need to do
is use the XML namespace or builders to register the listeners with a step.</p>
</div>
<div class="sect4">
<h5 id="stepExecutionListener"><a class="anchor" href="#stepExecutionListener"></a><code>StepExecutionListener</code></h5>
<div class="paragraph">
<p><code>StepExecutionListener</code> represents the most generic listener for <code>Step</code> execution. It
allows for notification before a <code>Step</code> is started and after it ends, whether it ended
normally or failed, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">StepExecutionListener</span> <span class="directive">extends</span> StepListener {

    <span class="type">void</span> beforeStep(StepExecution stepExecution);

    ExitStatus afterStep(StepExecution stepExecution);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExitStatus</code> is the return type of <code>afterStep</code> in order to allow listeners the chance to
modify the exit code that is returned upon completion of a <code>Step</code>.</p>
</div>
<div class="paragraph">
<p>The annotations corresponding to this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BeforeStep</code></p>
</li>
<li>
<p><code>@AfterStep</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="chunkListener"><a class="anchor" href="#chunkListener"></a><code>ChunkListener</code></h5>
<div class="paragraph">
<p>A chunk is defined as the items processed within the scope of a transaction. Committing a
transaction, at each commit interval, commits a 'chunk'. A <code>ChunkListener</code> can be used to
perform logic before a chunk begins processing or after a chunk has completed
successfully, as shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ChunkListener</span> <span class="directive">extends</span> StepListener {

    <span class="type">void</span> beforeChunk(ChunkContext context);
    <span class="type">void</span> afterChunk(ChunkContext context);
    <span class="type">void</span> afterChunkError(ChunkContext context);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The beforeChunk method is called after the transaction is started but before read is
called on the <code>ItemReader</code>. Conversely, <code>afterChunk</code> is called after the chunk has been
committed (and not at all if there is a rollback).</p>
</div>
<div class="paragraph">
<p>The annotations corresponding to this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BeforeChunk</code></p>
</li>
<li>
<p><code>@AfterChunk</code></p>
</li>
<li>
<p><code>@AfterChunkError</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>ChunkListener</code> can be applied when there is no chunk declaration. The <code>TaskletStep</code> is
responsible for calling the <code>ChunkListener</code>, so it applies to a non-item-oriented tasklet
as well (it is called before and after the tasklet).</p>
</div>
</div>
<div class="sect4">
<h5 id="itemReadListener"><a class="anchor" href="#itemReadListener"></a><code>ItemReadListener</code></h5>
<div class="paragraph">
<p>When discussing skip logic previously, it was mentioned that it may be beneficial to log
the skipped records, so that they can be dealt with later. In the case of read errors,
this can be done with an <code>ItemReaderListener</code>, as shown in the following interface
definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemReadListener</span>&lt;T&gt; <span class="directive">extends</span> StepListener {

    <span class="type">void</span> beforeRead();
    <span class="type">void</span> afterRead(T item);
    <span class="type">void</span> onReadError(<span class="exception">Exception</span> ex);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>beforeRead</code> method is called before each call to read on the <code>ItemReader</code>. The
<code>afterRead</code> method is called after each successful call to read and is passed the item
that was read. If there was an error while reading, the <code>onReadError</code> method is called.
The exception encountered is provided so that it can be logged.</p>
</div>
<div class="paragraph">
<p>The annotations corresponding to this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BeforeRead</code></p>
</li>
<li>
<p><code>@AfterRead</code></p>
</li>
<li>
<p><code>@OnReadError</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="itemProcessListener"><a class="anchor" href="#itemProcessListener"></a><code>ItemProcessListener</code></h5>
<div class="paragraph">
<p>Just as with the <code>ItemReadListener</code>, the processing of an item can be 'listened' to, as
shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemProcessListener</span>&lt;T, S&gt; <span class="directive">extends</span> StepListener {

    <span class="type">void</span> beforeProcess(T item);
    <span class="type">void</span> afterProcess(T item, S result);
    <span class="type">void</span> onProcessError(T item, <span class="exception">Exception</span> e);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>beforeProcess</code> method is called before <code>process</code> on the <code>ItemProcessor</code> and is
handed the item that is to be processed. The <code>afterProcess</code> method is called after the
item has been successfully processed. If there was an error while processing, the
<code>onProcessError</code> method is called. The exception encountered and the item that was
attempted to be processed are provided, so that they can be logged.</p>
</div>
<div class="paragraph">
<p>The annotations corresponding to this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BeforeProcess</code></p>
</li>
<li>
<p><code>@AfterProcess</code></p>
</li>
<li>
<p><code>@OnProcessError</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="itemWriteListener"><a class="anchor" href="#itemWriteListener"></a><code>ItemWriteListener</code></h5>
<div class="paragraph">
<p>The writing of an item can be 'listened' to with the <code>ItemWriteListener</code>, as shown in the
following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ItemWriteListener</span>&lt;S&gt; <span class="directive">extends</span> StepListener {

    <span class="type">void</span> beforeWrite(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> S&gt; items);
    <span class="type">void</span> afterWrite(<span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> S&gt; items);
    <span class="type">void</span> onWriteError(<span class="exception">Exception</span> exception, <span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> S&gt; items);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>beforeWrite</code> method is called before <code>write</code> on the <code>ItemWriter</code> and is handed the
list of items that is written. The <code>afterWrite</code> method is called after the item has been
successfully written. If there was an error while writing, the <code>onWriteError</code> method is
called. The exception encountered and the item that was attempted to be written are
provided, so that they can be logged.</p>
</div>
<div class="paragraph">
<p>The annotations corresponding to this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BeforeWrite</code></p>
</li>
<li>
<p><code>@AfterWrite</code></p>
</li>
<li>
<p><code>@OnWriteError</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="skipListener"><a class="anchor" href="#skipListener"></a><code>SkipListener</code></h5>
<div class="paragraph">
<p><code>ItemReadListener</code>, <code>ItemProcessListener</code>, and <code>ItemWriteListener</code> all provide mechanisms
for being notified of errors, but none informs you that a record has actually been
skipped. <code>onWriteError</code>, for example, is called even if an item is retried and
successful. For this reason, there is a separate interface for tracking skipped items, as
shown in the following interface definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SkipListener</span>&lt;T,S&gt; <span class="directive">extends</span> StepListener {

    <span class="type">void</span> onSkipInRead(<span class="predefined-type">Throwable</span> t);
    <span class="type">void</span> onSkipInProcess(T item, <span class="predefined-type">Throwable</span> t);
    <span class="type">void</span> onSkipInWrite(S item, <span class="predefined-type">Throwable</span> t);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>onSkipInRead</code> is called whenever an item is skipped while reading. It should be noted
that rollbacks may cause the same item to be registered as skipped more than once.
<code>onSkipInWrite</code> is called when an item is skipped while writing. Because the item has
been read successfully (and not skipped), it is also provided the item itself as an
argument.</p>
</div>
<div class="paragraph">
<p>The annotations corresponding to this interface are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@OnSkipInRead</code></p>
</li>
<li>
<p><code>@OnSkipInWrite</code></p>
</li>
<li>
<p><code>@OnSkipInProcess</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="skipListenersAndTransactions"><a class="anchor" href="#skipListenersAndTransactions"></a>SkipListeners and Transactions</h6>
<div class="paragraph">
<p>One of the most common use cases for a <code>SkipListener</code> is to log out a skipped item, so
that another batch process or even human process can be used to evaluate and fix the
issue leading to the skip. Because there are many cases in which the original transaction
may be rolled back, Spring Batch makes two guarantees:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The appropriate skip method (depending on when the error happened) is called only once
per item.</p>
</li>
<li>
<p>The <code>SkipListener</code> is always called just before the transaction is committed. This is
to ensure that any transactional resources call by the listener are not rolled back by a
failure within the <code>ItemWriter</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="taskletStep"><a class="anchor" href="#taskletStep"></a>1.2. <code>TaskletStep</code></h3>
<div class="paragraph">
<p><a href="#chunkOrientedProcessing">Chunk-oriented processing</a> is not the only way to process in a
<code>Step</code>. What if a <code>Step</code> must consist of a simple stored procedure call? You could
implement the call as an <code>ItemReader</code> and return null after the procedure finishes.
However, doing so is a bit unnatural, since there would need to be a no-op <code>ItemWriter</code>.
Spring Batch provides the <code>TaskletStep</code> for this scenario.</p>
</div>
<div class="paragraph">
<p><code>Tasklet</code> is a simple interface that has one method, <code>execute</code>, which is called
repeatedly by the <code>TaskletStep</code> until it either returns <code>RepeatStatus.FINISHED</code> or throws
an exception to signal a failure. Each call to a <code>Tasklet</code> is wrapped in a transaction.
<code>Tasklet</code> implementors might call a stored procedure, a script, or a simple SQL update
statement.</p>
</div>
<div class="paragraph xmlContent">
<p>To create a <code>TaskletStep</code>, the 'ref' attribute of the
    &lt;tasklet/&gt; element should reference a bean that defines a
    <code>Tasklet</code> object. No &lt;chunk/&gt; element should be
    used within the &lt;tasklet/&gt;. The following example shows a simple tasklet:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tasklet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myTasklet</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>To create a <code>TaskletStep</code>, the bean passed to the <code>tasklet</code> method of the builder should
implement the <code>Tasklet</code> interface.  No call to <code>chunk</code> should be called when building a
<code>TaskletStep</code>.  The following example shows  a simple tasklet:</p>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Step step1() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span>)
                            .tasklet(myTasklet())
                            .build();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>TaskletStep</code> automatically registers the
      tasklet as a <code>StepListener</code> if it implements the <code>StepListener</code>
      interface.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="taskletAdapter"><a class="anchor" href="#taskletAdapter"></a>1.2.1. <code>TaskletAdapter</code></h4>
<div class="paragraph">
<p>As with other adapters for the <code>ItemReader</code> and <code>ItemWriter</code> interfaces, the <code>Tasklet</code>
interface contains an implementation that allows for adapting itself to any pre-existing
class: <code>TaskletAdapter</code>. An example where this may be useful is an existing DAO that is
used to update a flag on a set of records. The <code>TaskletAdapter</code> can be used to call this
class without having to write an adapter for the <code>Tasklet</code> interface, as shown in the
following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myTasklet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.b.core.step.tasklet.MethodInvokingTaskletAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetObject</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mycompany.FooDao</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">targetMethod</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">updateFoo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> MethodInvokingTaskletAdapter myTasklet() {
        MethodInvokingTaskletAdapter adapter = <span class="keyword">new</span> MethodInvokingTaskletAdapter();

        adapter.setTargetObject(fooDao());
        adapter.setTargetMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">updateFoo</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> adapter;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="exampleTaskletImplementation"><a class="anchor" href="#exampleTaskletImplementation"></a>1.2.2. Example <code>Tasklet</code> Implementation</h4>
<div class="paragraph">
<p>Many batch jobs contain steps that must be done before the main processing begins in
order to set up various resources or after processing has completed to cleanup those
resources. In the case of a job that works heavily with files, it is often necessary to
delete certain files locally after they have been uploaded successfully to another
location. The following example (taken from the
<a href="https://github.com/spring-projects/spring-batch/tree/master/spring-batch-samples">Spring
Batch samples project</a>) is a <code>Tasklet</code> implementation with just such a responsibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FileDeletingTasklet</span> <span class="directive">implements</span> Tasklet, InitializingBean {

    <span class="directive">private</span> Resource directory;

    <span class="directive">public</span> RepeatStatus execute(StepContribution contribution,
                                ChunkContext chunkContext) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">File</span> dir = directory.getFile();
        Assert.state(dir.isDirectory());

        <span class="predefined-type">File</span><span class="type">[]</span> files = dir.listFiles();
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; files.length; i++) {
            <span class="type">boolean</span> deleted = files[i].delete();
            <span class="keyword">if</span> (!deleted) {
                <span class="keyword">throw</span> <span class="keyword">new</span> UnexpectedJobExecutionException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not delete file </span><span class="delimiter">&quot;</span></span> +
                                                          files[i].getPath());
            }
        }
        <span class="keyword">return</span> RepeatStatus.FINISHED;
    }

    <span class="directive">public</span> <span class="type">void</span> setDirectoryResource(Resource directory) {
        <span class="local-variable">this</span>.directory = directory;
    }

    <span class="directive">public</span> <span class="type">void</span> afterPropertiesSet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        Assert.notNull(directory, <span class="string"><span class="delimiter">&quot;</span><span class="content">directory must be set</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding <code>Tasklet</code> implementation deletes all files within a given directory. It
should be noted that the <code>execute</code> method is called only once. All that is left is to
reference the <code>Tasklet</code> from the <code>Step</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskletJob</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">deleteFilesInDir</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;tasklet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileDeletingTasklet</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;beans:bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileDeletingTasklet</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.sample.tasklet.FileDeletingTasklet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;beans:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directoryResource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;beans:bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directory</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.core.io.FileSystemResource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;beans:constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target/test-outputs/test-dir</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/beans:bean&gt;</span>
    <span class="tag">&lt;/beans:property&gt;</span>
<span class="tag">&lt;/beans:bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job taskletJob() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">taskletJob</span><span class="delimiter">&quot;</span></span>)
                                .start(deleteFilesInDir())
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step deleteFilesInDir() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">deleteFilesInDir</span><span class="delimiter">&quot;</span></span>)
                                .tasklet(fileDeletingTasklet())
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> FileDeletingTasklet fileDeletingTasklet() {
        FileDeletingTasklet tasklet = <span class="keyword">new</span> FileDeletingTasklet();

        tasklet.setDirectoryResource(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">target/test-outputs/test-dir</span><span class="delimiter">&quot;</span></span>));

        <span class="keyword">return</span> tasklet;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controllingStepFlow"><a class="anchor" href="#controllingStepFlow"></a>1.3. Controlling Step Flow</h3>
<div class="paragraph">
<p>With the ability to group steps together within an owning job comes the need to be able
to control how the job "flows" from one step to another. The failure of a <code>Step</code> does not
necessarily mean that the <code>Job</code> should fail. Furthermore, there may be more than one type
of 'success' that determines which <code>Step</code> should be executed next. Depending upon how a
group of <code>Steps</code> is configured, certain steps may not even be processed at all.</p>
</div>
<div class="sect3">
<h4 id="SequentialFlow"><a class="anchor" href="#SequentialFlow"></a>1.3.1. Sequential Flow</h4>
<div class="paragraph">
<p>The simplest flow scenario is a job where all of the steps execute sequentially, as shown
in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/sequential-flow.png" alt="Sequential Flow">
</div>
<div class="title">Figure 3. Sequential Flow</div>
</div>
<div class="paragraph">
<p>This can be achieved by using the 'next' attribute of the step element, as shown in the
following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(stepA())
                                .next(stepB())
                                .next(stepC())
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the scenario above, 'step A' runs first because it is the first <code>Step</code> listed. If
'step A' completes normally, then 'step B' runs, and so on. However, if 'step A' fails,
then the entire <code>Job</code> fails and 'step B' does not execute.</p>
</div>
<div class="admonitionblock note xmlContent">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With the Spring Batch namespace, the first step listed in the
        configuration is <em>always</em> the first step
        run by the <code>Job</code>. The order of the other
        step elements does not matter, but the first step must always appear
        first in the xml.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="conditionalFlow"><a class="anchor" href="#conditionalFlow"></a>1.3.2. Conditional Flow</h4>
<div class="paragraph">
<p>In the example above, there are only two possibilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>Step</code> is successful and the next <code>Step</code> should be executed.</p>
</li>
<li>
<p>The <code>Step</code> failed and, thus, the <code>Job</code> should fail.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In many cases, this may be sufficient. However, what about a scenario in which the
failure of a <code>Step</code> should trigger a different <code>Step</code>, rather than causing failure? The
following image shows such a flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/conditional-flow.png" alt="Conditional Flow">
</div>
<div class="title">Figure 4. Conditional Flow</div>
</div>
<div id="nextElement" class="paragraph">
<p>In order to handle more complex scenarios, the Spring Batch namespace allows transition
elements to be defined within the step element. One such transition is the <code>next</code>
element. Like the <code>next</code> attribute, the <code>next</code> element tells the <code>Job</code> which <code>Step</code> to
execute next. However, unlike the attribute, any number of <code>next</code> elements are allowed on
a given <code>Step</code>, and there is no default behavior in the case of failure. This means that, if
transition elements are used, then all of the behavior for the <code>Step</code> transitions must be
defined explicitly. Note also that a single step cannot have both a <code>next</code> attribute and
a <code>transition</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>next</code> element specifies a pattern to match and the step to execute next, as shown in
the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(stepA())
                                .on(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>).to(stepB())
                                .from(stepA()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>).to(stepC())
                                .end()
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph xmlContent">
<p>When using XML configuration, the <code>on</code> attribute of a transition element uses a simple
pattern-matching scheme to match the <code>ExitStatus</code> that results from the execution of the
<code>Step</code>.</p>
</div>
<div class="paragraph javaContent">
<p>When using java configuration the <code>on</code> method uses a simple pattern-matching scheme to
match the <code>ExitStatus</code> that results from the execution of the <code>Step</code>.</p>
</div>
<div class="paragraph">
<p>Only two special characters are allowed in the pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"*" matches zero or more characters</p>
</li>
<li>
<p>"?" matches exactly one character</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, "c*t" matches "cat" and "count", while "c?t" matches "cat" but not "count".</p>
</div>
<div class="paragraph">
<p>While there is no limit to the number of transition elements on a <code>Step</code>, if the <code>Step</code>
execution results in an <code>ExitStatus</code> that is not covered by an element, then the
framework throws an exception and the <code>Job</code> fails. The framework automatically orders
transitions from most specific to least specific. This means that, even if the ordering
were swapped for "stepA" in the example above, an <code>ExitStatus</code> of "FAILED" would still go
to "stepC".</p>
</div>
<div class="sect4">
<h5 id="batchStatusVsExitStatus"><a class="anchor" href="#batchStatusVsExitStatus"></a>Batch Status Versus Exit Status</h5>
<div class="paragraph">
<p>When configuring a <code>Job</code> for conditional flow, it is important to understand the
difference between <code>BatchStatus</code> and <code>ExitStatus</code>. <code>BatchStatus</code> is an enumeration that
is a property of both <code>JobExecution</code> and <code>StepExecution</code> and is used by the framework to
record the status of a <code>Job</code> or <code>Step</code>. It can be one of the following values:
<code>COMPLETED</code>, <code>STARTING</code>, <code>STARTED</code>, <code>STOPPING</code>, <code>STOPPED</code>, <code>FAILED</code>, <code>ABANDONED</code>, or
<code>UNKNOWN</code>. Most of them are self explanatory: <code>COMPLETED</code> is the status set when a step
or job has completed successfully, <code>FAILED</code> is set when it fails, and so on.</p>
</div>
<div class="paragraph xmlContent">
<p>The following example contains the 'next' element when using XML configuration:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>The following example contains the 'on' element when using Java Configuration:</p>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
.from(stepA()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>).to(stepB())
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance, it would appear that 'on' references the <code>BatchStatus</code> of the <code>Step</code> to
which it belongs. However, it actually references the <code>ExitStatus</code> of the <code>Step</code>. As the
name implies, <code>ExitStatus</code> represents the status of a <code>Step</code> after it finishes execution.</p>
</div>
<div class="paragraph xmlContent">
<p>More specifically, when using XML configuration, the 'next' element shown in the
preceding XML configuration example references the exit code of <code>ExitStatus</code>.</p>
</div>
<div class="paragraph xmlContent">
<p>When using Java configuration, the 'on' method shown in the preceding
Java configuration example references the exit code of <code>ExitStatus</code>.</p>
</div>
<div class="paragraph">
<p>In English, it says: "go to stepB if the exit code is <code>FAILED</code> ". By default, the exit
code is always the same as the <code>BatchStatus</code> for the <code>Step</code>, which is why the entry above
works. However, what if the exit code needs to be different? A good example comes from
the skip sample job within the samples project:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED WITH SKIPS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errorPrint1</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                        .start(step1()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>).end()
                        .from(step1()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED WITH SKIPS</span><span class="delimiter">&quot;</span></span>).to(errorPrint1())
                        .from(step1()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>).to(step2())
                        .end()
                        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>step1</code> has three possibilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>Step</code> failed, in which case the job should fail.</p>
</li>
<li>
<p>The <code>Step</code> completed successfully.</p>
</li>
<li>
<p>The <code>Step</code> completed successfully but with an exit code of 'COMPLETED WITH SKIPS'. In
this case, a different step should be run to handle the errors.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above configuration works. However, something needs to change the exit code based on
the condition of the execution having skipped records, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SkipCheckingListener</span> <span class="directive">extends</span> StepExecutionListenerSupport {
    <span class="directive">public</span> ExitStatus afterStep(StepExecution stepExecution) {
        <span class="predefined-type">String</span> exitCode = stepExecution.getExitStatus().getExitCode();
        <span class="keyword">if</span> (!exitCode.equals(ExitStatus.FAILED.getExitCode()) &amp;&amp;
              stepExecution.getSkipCount() &gt; <span class="integer">0</span>) {
            <span class="keyword">return</span> <span class="keyword">new</span> ExitStatus(<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED WITH SKIPS</span><span class="delimiter">&quot;</span></span>);
        }
        <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code is a <code>StepExecutionListener</code> that first checks to make sure the <code>Step</code> was
successful and then checks to see if the skip count on the <code>StepExecution</code> is higher than
0. If both conditions are met, a new <code>ExitStatus</code> with an exit code of
<code>COMPLETED WITH SKIPS</code> is returned.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuringForStop"><a class="anchor" href="#configuringForStop"></a>1.3.3. Configuring for Stop</h4>
<div class="paragraph">
<p>After the discussion of <a href="#batchStatusVsExitStatus">BatchStatus and ExitStatus</a>,
one might wonder how the <code>BatchStatus</code> and <code>ExitStatus</code> are determined for the <code>Job</code>.
While these statuses are determined for the <code>Step</code> by the code that is executed, the
statuses for the <code>Job</code> are determined based on the configuration.</p>
</div>
<div class="paragraph">
<p>So far, all of the job configurations discussed have had at least one final <code>Step</code> with
no transitions. For example, after the following step executes, the <code>Job</code> ends, as shown
in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(step1())
                                .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no transitions are defined for a <code>Step</code>, then the status of the <code>Job</code> is defined as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code>Step</code> ends with <code>ExitStatus</code> FAILED, then the <code>BatchStatus</code> and <code>ExitStatus</code> of
the <code>Job</code> are both <code>FAILED</code>.</p>
</li>
<li>
<p>Otherwise, the <code>BatchStatus</code> and <code>ExitStatus</code> of the <code>Job</code> are both <code>COMPLETED</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this method of terminating a batch job is sufficient for some batch jobs, such as a
simple sequential step job, custom defined job-stopping scenarios may be required. For
this purpose, Spring Batch provides three transition elements to stop a <code>Job</code> (in
addition to the <a href="#nextElement"><code>next</code> element</a> that we discussed previously).
Each of these stopping elements stops a <code>Job</code> with a particular <code>BatchStatus</code>. It is
important to note that the stop transition elements have no effect on either the
<code>BatchStatus</code> or <code>ExitStatus</code> of any <code>Steps</code> in the <code>Job</code>. These elements affect only the
final statuses of the <code>Job</code>. For example, it is possible for every step in a job to have
a status of <code>FAILED</code> but for the job to have a status of <code>COMPLETED</code>.</p>
</div>
<div class="sect4">
<h5 id="endElement"><a class="anchor" href="#endElement"></a>Ending at a Step</h5>
<div class="paragraph">
<p>Configuring a step end instructs a <code>Job</code> to stop with a <code>BatchStatus</code> of <code>COMPLETED</code>. A
<code>Job</code> that has finished with status <code>COMPLETED</code> cannot be restarted (the framework throws
a <code>JobInstanceAlreadyCompleteException</code>).</p>
</div>
<div class="paragraph xmlContent">
<p>When using XML configuration, the 'end' element is used for this task.  The <code>end</code> element
also allows for an optional 'exit-code' attribute that can be used to customize the
<code>ExitStatus</code> of the <code>Job</code>. If no 'exit-code' attribute is given, then the <code>ExitStatus</code> is
<code>COMPLETED</code> by default, to match the <code>BatchStatus</code>.</p>
</div>
<div class="paragraph javaContent">
<p>When using Java configuration, the 'end' method is used for this task.  The <code>end</code> method
also allows for an optional 'exitStatus' parameter that can be used to customize the
<code>ExitStatus</code> of the <code>Job</code>. If no 'exitStatus' value is provided, then the <code>ExitStatus</code> is
<code>COMPLETED</code> by default, to match the <code>BatchStatus</code>.</p>
</div>
<div class="paragraph">
<p>In the following scenario, if <code>step2</code> fails, then the <code>Job</code> stops with a <code>BatchStatus</code> of
<code>COMPLETED</code> and an <code>ExitStatus</code> of <code>COMPLETED</code> and <code>step3</code> does not run. Otherwise,
execution moves to <code>step3</code>. Note that if <code>step2</code> fails, the <code>Job</code> is not restartable
(because the status is <code>COMPLETED</code>).</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(step1())
                                .next(step2())
                                .on(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>).end()
                                .from(step2()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>).to(step3())
                                .end()
                                .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="failElement"><a class="anchor" href="#failElement"></a>Failing a Step</h5>
<div class="paragraph">
<p>Configuring a step to fail at a given point instructs a <code>Job</code> to stop with a
<code>BatchStatus</code> of <code>FAILED</code>. Unlike end, the failure of a <code>Job</code> does not prevent the <code>Job</code>
from being restarted.</p>
</div>
<div class="paragraph xmlContent">
<p>When using XML configuration, the 'fail' element also allows for an optional 'exit-code'
attribute that can be used to customize the <code>ExitStatus</code> of the <code>Job</code>. If no 'exit-code'
attribute is given, then the <code>ExitStatus</code> is <code>FAILED</code> by default, to match the
<code>BatchStatus</code>.</p>
</div>
<div class="paragraph">
<p>In the following scenario, if <code>step2</code> fails, then the <code>Job</code> stops with a <code>BatchStatus</code> of
<code>FAILED</code> and an <code>ExitStatus</code> of <code>EARLY TERMINATION</code> and <code>step3</code> does not execute.
Otherwise, execution moves to <code>step3</code>. Additionally, if <code>step2</code> fails and the <code>Job</code> is
restarted, then execution begins again on <code>step2</code>.</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;fail</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EARLY TERMINATION</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                        .start(step1())
                        .next(step2()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>).fail()
                        .from(step2()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>).to(step3())
                        .end()
                        .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="stopElement"><a class="anchor" href="#stopElement"></a>Stopping a Job at a Given Step</h5>
<div class="paragraph">
<p>Configuring a job to stop at a particular step instructs a <code>Job</code> to stop with a
<code>BatchStatus</code> of <code>STOPPED</code>. Stopping a <code>Job</code> can provide a temporary break in processing,
so that the operator can take some action before restarting the <code>Job</code>.</p>
</div>
<div class="paragraph xmlContent">
<p>When using XML configuration 'stop' element requires a 'restart' attribute that specifies
the step where execution should pick up when the "Job is restarted".</p>
</div>
<div class="paragraph javaContent">
<p>When using java configuration, the <code>stopAndRestart</code> method requires a 'restart' attribute
that specifies the step where execution should pick up when the "Job is restarted".</p>
</div>
<div class="paragraph">
<p>In the following scenario, if <code>step1</code> finishes with <code>COMPLETE</code>, then the job stops.
Once it is restarted, execution begins on <code>step2</code>.</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;stop</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restart</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                        .start(step1()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>).stopAndRestart(step2())
                        .end()
                        .build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="programmaticFlowDecisions"><a class="anchor" href="#programmaticFlowDecisions"></a>1.3.4. Programmatic Flow Decisions</h4>
<div class="paragraph">
<p>In some situations, more information than the <code>ExitStatus</code> may be required to decide
which step to execute next. In this case, a <code>JobExecutionDecider</code> can be used to assist
in the decision, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDecider</span> <span class="directive">implements</span> JobExecutionDecider {
    <span class="directive">public</span> FlowExecutionStatus decide(JobExecution jobExecution, StepExecution stepExecution) {
        <span class="predefined-type">String</span> status;
        <span class="keyword">if</span> (someCondition()) {
            status = <span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">else</span> {
            status = <span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">return</span> <span class="keyword">new</span> FlowExecutionStatus(status);
    }
}</code></pre>
</div>
</div>
<div class="paragraph xmlContent">
<p>In the following sample job configuration, a <code>decision</code> specifies the decider to use as
well as all of the transitions:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decision</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

    <span class="tag">&lt;decision</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decision</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">decider</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decider</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;next</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">to</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/decision&gt;</span>

    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;beans:bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decider</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.MyDecider</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>In the following example, a bean implementing the <code>JobExecutionDecider</code> is passed
directly to the <code>next</code> call when using Java configuration.</p>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                        .start(step1())
                        .next(decider()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span>).to(step2())
                        .from(decider()).on(<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>).to(step3())
                        .end()
                        .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="split-flows"><a class="anchor" href="#split-flows"></a>1.3.5. Split Flows</h4>
<div class="paragraph">
<p>Every scenario described so far has involved a <code>Job</code> that executes its steps one at a
time in a linear fashion. In addition to this typical style, Spring Batch also allows
for a job to be configured with parallel flows.</p>
</div>
<div class="paragraph xmlContent">
<p>The XML namespace allows you to use the 'split' element. As the following example shows,
the 'split' element contains one or more 'flow' elements, where entire separate flows can
be defined. A 'split' element may also contain any of the previously discussed transition
elements, such as the 'next' attribute or the 'next', 'end' or 'fail' elements.</p>
</div>
<div class="listingblock xmlContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;split</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">split1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;flow&gt;</span>
        <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/flow&gt;</span>
    <span class="tag">&lt;flow&gt;</span>
        <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/flow&gt;</span>
<span class="tag">&lt;/split&gt;</span>
<span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s4</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>Java based configuration lets you configure splits through the provided builders. As the
following example shows, the 'split' element contains one or more 'flow' elements, where
entire separate flows can be defined. A 'split' element may also contain any of the
previously discussed transition elements, such as the 'next' attribute or the 'next',
'end' or 'fail' elements.</p>
</div>
<div class="listingblock javaContent">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        Flow flow1 = <span class="keyword">new</span> FlowBuilder&lt;SimpleFlow&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">flow1</span><span class="delimiter">&quot;</span></span>)
                        .start(step1())
                        .next(step2())
                        .build();
        Flow flow2 = <span class="keyword">new</span> FlowBuilder&lt;SimpleFlow&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">flow2</span><span class="delimiter">&quot;</span></span>)
                        .start(step3())
                        .build();

        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(flow1)
                                .split(<span class="keyword">new</span> SimpleAsyncTaskExecutor())
                                .add(flow2)
                                .next(step4())
                                .end()
                                .build();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="external-flows"><a class="anchor" href="#external-flows"></a>1.3.6. Externalizing Flow Definitions and Dependencies Between Jobs</h4>
<div class="paragraph">
<p>Part of the flow in a job can be externalized as a separate bean definition and then
re-used. There are two ways to do so. The first is to simply declare the flow as a
reference to one defined elsewhere, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job1.flow1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flow1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flow1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/flow&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(flow1())
                                .next(step3())
                                .end()
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Flow flow1() {
        <span class="keyword">return</span> <span class="keyword">new</span> FlowBuilder&lt;SimpleFlow&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">flow1</span><span class="delimiter">&quot;</span></span>)
                        .start(step1())
                        .next(step2())
                        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The effect of defining an external flow as shown in the preceding example is to insert
the steps from the external flow into the job as if they had been declared inline. In
this way, many jobs can refer to the same template flow and compose such templates into
different logical flows. This is also a good way to separate the integration testing of
the individual flows.</p>
</div>
<div class="paragraph">
<p>The other form of an externalized flow is to use a <code>JobStep</code>. A <code>JobStep</code> is similar to a
<code>FlowStep</code> but actually creates and launches a separate job execution for the steps in
the flow specified.</p>
</div>
<div class="paragraph xmlContent">
<p>The following XML snippet shows an example of a <code>JobStep</code>:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobStepJob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restartable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobStepJob.step1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;job</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">job-launcher</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobLauncher</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">job-parameters-extractor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobParametersExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restartable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/job&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobParametersExtractor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spr...DefaultJobParametersExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keys</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input.file</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>The following Java snippet shows an example of a <code>JobStep</code>:</p>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Job jobStepJob() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">jobStepJob</span><span class="delimiter">&quot;</span></span>)
                                .start(jobStepJobStep1(<span class="predefined-constant">null</span>))
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Step jobStepJobStep1(JobLauncher jobLauncher) {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stepBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">jobStepJobStep1</span><span class="delimiter">&quot;</span></span>)
                                .job(job())
                                .launcher(jobLauncher)
                                .parametersExtractor(jobParametersExtractor())
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> Job job() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jobBuilderFactory.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span>)
                                .start(step1())
                                .build();
}

<span class="annotation">@Bean</span>
<span class="directive">public</span> DefaultJobParametersExtractor jobParametersExtractor() {
        DefaultJobParametersExtractor extractor = <span class="keyword">new</span> DefaultJobParametersExtractor();

        extractor.setKeys(<span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">input.file</span><span class="delimiter">&quot;</span></span>});

        <span class="keyword">return</span> extractor;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The job parameters extractor is a strategy that determines how the <code>ExecutionContext</code> for
the <code>Step</code> is converted into <code>JobParameters</code> for the <code>Job</code> that is run. The <code>JobStep</code> is
useful when you want to have some more granular options for monitoring and reporting on
jobs and steps. Using <code>JobStep</code> is also often a good answer to the question: "How do I
create dependencies between jobs?" It is a good way to break up a large system into
smaller modules and control the flow of jobs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="late-binding"><a class="anchor" href="#late-binding"></a>1.4. Late Binding of <code>Job</code> and <code>Step</code> Attributes</h3>
<div class="paragraph">
<p>Both the XML and flat file examples shown earlier use the Spring <code>Resource</code> abstraction
to obtain a file. This works because <code>Resource</code> has a <code>getFile</code> method, which returns a
<code>java.io.File</code>. Both XML and flat file resources can be configured using standard Spring
constructs, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file://outputs/file.txt</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader() {
        FlatFileItemReader&lt;Foo&gt; reader = <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file://outputs/file.txt</span><span class="delimiter">&quot;</span></span>))
                        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding <code>Resource</code> loads the file from the specified file system location. Note
that absolute locations have to start with a double slash (<code>//</code>). In most Spring
applications, this solution is good enough, because the names of these resources are
known at compile time. However, in batch scenarios, the file name may need to be
determined at runtime as a parameter to the job. This can be solved using '-D' parameters
to read a system property.</p>
</div>
<div class="paragraph xmlContent">
<p>The following XML snippet shows how to read a file name from a property:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${input.file.name}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph javaContent">
<p>The following Java snippet shows how to read a file name from a property:</p>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${input.file.name}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All that would be required for this solution to work would be a system argument (such as
<code>-Dinput.file.name="file://outputs/file.txt"</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although a <code>PropertyPlaceholderConfigurer</code> can be used here, it is not
necessary if the system property is always set because the <code>ResourceEditor</code> in Spring
already filters and does placeholder replacement on system properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Often, in a batch setting, it is preferable to parametrize the file name in the
<code>JobParameters</code> of the job, instead of through system properties, and access them that
way. To accomplish this, Spring Batch allows for the late binding of various <code>Job</code> and
<code>Step</code> attributes, as shown in the following snippet:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobParameters['input.file.name']}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@StepScope</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobParameters['input.file.name']}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both the <code>JobExecution</code> and <code>StepExecution</code> level <code>ExecutionContext</code> can be accessed in
the same way, as shown in the following examples:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobExecutionContext['input.file.name']}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{stepExecutionContext['input.file.name']}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@StepScope</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobExecutionContext['input.file.name']}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@StepScope</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{stepExecutionContext['input.file.name']}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Any bean that uses late-binding must be declared with scope="step". See
<a href="#step-scope">Step Scope</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="step-scope"><a class="anchor" href="#step-scope"></a>1.4.1. Step Scope</h4>
<div class="paragraph">
<p>All of the late binding examples from above have a scope of "step" declared on the bean
definition, as shown in the following example:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.item.file.FlatFileItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobParameters[input.file.name]}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@StepScope</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobParameters[input.file.name]}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a scope of <code>Step</code> is required in order to use late binding, because the bean cannot
actually be instantiated until the <code>Step</code> starts, to allow the attributes to be found.
Because it is not part of the Spring container by default, the scope must be added
explicitly, by using the <code>batch</code> namespace or by including a bean definition explicitly
for the <code>StepScope</code>, or by using the <code>@EnableBatchProcessing</code> annotation. Use only one of
those methods.  The following example uses the <code>batch</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;batch:job</span> <span class="attribute-name">...</span><span class="tag">/&gt;</span>
...
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example includes the bean definition explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.core.scope.StepScope</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="job-scope"><a class="anchor" href="#job-scope"></a>1.4.2. Job Scope</h4>
<div class="paragraph">
<p><code>Job</code> scope, introduced in Spring Batch 3.0, is similar to <code>Step</code> scope in configuration
but is a Scope for the <code>Job</code> context, so that there is only one instance of such a bean
per running job. Additionally, support is provided for late binding of references
accessible from the <code>JobContext</code> using <code>#{..}</code> placeholders. Using this feature, bean
properties can be pulled from the job or job execution context and the job parameters, as
shown in the following examples:</p>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobParameters[input]}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock xmlContent">
<div class="title">XML Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">job</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobExecutionContext['input.name']}.txt</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JobScope</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobParameters[input]}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="listingblock javaContent">
<div class="title">Java Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JobScope</span>
<span class="annotation">@Bean</span>
<span class="directive">public</span> FlatFileItemReader flatFileItemReader(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jobExecutionContext['input.name']}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="keyword">new</span> FlatFileItemReaderBuilder&lt;Foo&gt;()
                        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">flatFileItemReader</span><span class="delimiter">&quot;</span></span>)
                        .resource(<span class="keyword">new</span> FileSystemResource(name))
                        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because it is not part of the Spring container by default, the scope must be added
explicitly, by using the <code>batch</code> namespace, by including a bean definition explicitly for
the JobScope, or using the <code>@EnableBatchProcessing</code> annotation (but not all of them).
The following example uses the <code>batch</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;batch:job</span> <span class="attribute-name">...</span><span class="tag">/&gt;</span>
...
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example includes a bean that explicitly defines the <code>JobScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.batch.core.scope.JobScope</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.1.2.RELEASE<br>
Last updated 2019-04-03 09:14:50 UTC
</div>
</div>
<script type="text/javascript" src="tocbot-3.0.2/tocbot.js"></script>
<script type="text/javascript" >

    // Tocbot dynamic TOC, works with tocbot 3.0.2
    // Source: https://github.com/asciidoctor/asciidoctor/issues/699#issuecomment-321066006

    var oldtoc = document.getElementById('toctitle').nextElementSibling;
    var newtoc = document.createElement('div');
    newtoc.setAttribute('id', 'tocbot');
    newtoc.setAttribute('class', 'js-toc');
    oldtoc.parentNode.replaceChild(newtoc, oldtoc);
    tocbot.init({ contentSelector: '#content',
        headingSelector: 'h1, h2, h3, h4, h5',
        smoothScroll: false });
    var handleTocRefresh = function() {
        tocbot.refresh();
    }
    var handleTocOnResize = function() {
        var width = window.innerWidth
                    || document.documentElement.clientWidth
                    || document.body.clientWidth;
        if (width < 768) {
            tocbot.refresh({ contentSelector: '#content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 6,
                activeLinkClass: 'ignoreactive',
                throttleTimeout: 1000,
                smoothScroll: false });
        }
        else {
            tocbot.refresh({ contentSelector: '#content',
                headingSelector: 'h1, h2, h3, h4, h5',
                smoothScroll: false });
        }
    };
    window.addEventListener('resize', handleTocOnResize);
    window.addEventListener('tocRefresh', handleTocRefresh);
    handleTocOnResize();

    var link = document.createElement("a");
    link.setAttribute("href", "index.html");
    link.innerHTML = "<i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp;Back to index";
    var p = document.createElement("p");
    p.setAttribute("id", "backToIndex");
    p.appendChild(link);
    var toc = document.getElementById('toc');
    toc.insertBefore(p, toctitle);

</script>
</body>
</html>