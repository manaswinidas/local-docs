<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;19.&nbsp;Environment setup</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><link rel="start" href="index.html" title="Good Relationships"><link rel="up" href="reference.html" title="Part&nbsp;II.&nbsp;Reference Documentation"><link rel="prev" href="programming-model.html" title="Chapter&nbsp;18.&nbsp;Programming model"><link rel="next" href="reference:cross-store.html" title="Chapter&nbsp;20.&nbsp;Cross-store persistence"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://static.springframework.org/spring-ws/site/" title="The Spring Framework - Spring Web Services"><img style="border:none;" src="images/xdev-spring_logo.jpg"></a><a style="border:none;" href="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="images/s2_box_logo.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="setup"></a>Chapter&nbsp;19.&nbsp;Environment setup</h2></div></div></div><p>
        Spring Data Graph dramatically simplifies development, but some setup is naturally required.
        For building the application, Maven needs to be configured to include the Spring Data Graph dependencies,
        and configure the AspectJ weaving. After the build setup is complete, the Spring application needs to be
        configured to make use of Spring Data Graph.
		
        
    </p><p>
        Spring Data Graph projects can be built using maven, we also added means to build them with gradle and ant/ivy.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2356"></a>19.1.&nbsp;Gradle configuration</h2></div></div></div><p>
            The necessary build plugin to build Spring Data Graph projects with gradle is available as part of the
            SDG distribution or on github which makes the usage as easy as:
        </p><div class="example"><a name="d0e2361"></a><p class="title"><b>Example&nbsp;19.1.&nbsp;Gradle Build Configuration</b></p><div class="example-contents"><pre class="programlisting">sourceCompatibility = 1.6
targetCompatibility = 1.6

springVersion = <span class="hl-string">"3.0.5.RELEASE"</span>
springDataGraphVersion = <span class="hl-string">"1.1.0"</span>
aspectjVersion = <span class="hl-string">"1.6.12.M1

apply from:'https://github.com/SpringSource/spring-data-graph/raw/master/build/
gradle/springdatagraph.gradle'

configurations {
    runtime
    testCompile
}
repositories {
    mavenCentral()
	mavenLocal()
	mavenRepo urls: "</span>http:<span class="hl-comment">//maven.springframework.org/release"</span>
}</pre></div></div><br class="example-break"><p>
            The actual springdatagraph.gradle is very simple just decorating the javac tasks with the iajc ant task.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2368"></a>19.2.&nbsp;Ant/Ivy configuration</h2></div></div></div><p>
            The supplied sample ant <a class="ulink" href="https://github.com/SpringSource/spring-data-graph/raw/master/build/ivy" target="_top">build configuration</a> is mainly about resolving
            the dependencies for Spring Data Graph and AspectJ using Ivy and integrating the iajc ant task in the build.
        </p><div class="example"><a name="d0e2376"></a><p class="title"><b>Example&nbsp;19.2.&nbsp;Ant/Ivy Build Configuration</b></p><div class="example-contents"><pre class="programlisting">	&lt;<span class="hl-tag">taskdef</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties"</span> <span class="hl-attribute">classpath</span>=<span class="hl-value">"${lib.dir}/aspectjtools.jar"</span>/&gt;

&lt;<span class="hl-tag">target</span> <span class="hl-attribute">name</span>=<span class="hl-value">"compile"</span> <span class="hl-attribute">description</span>=<span class="hl-value">"Compile production classes"</span> <span class="hl-attribute">depends</span>=<span class="hl-value">"lib.retrieve"</span>&gt;
	&lt;<span class="hl-tag">mkdir</span> <span class="hl-attribute">dir</span>=<span class="hl-value">"${main.target}"</span> /&gt;

	&lt;<span class="hl-tag">iajc</span> <span class="hl-attribute">sourceroots</span>=<span class="hl-value">"${main.src}"</span> <span class="hl-attribute">destDir</span>=<span class="hl-value">"${main.target}"</span> <span class="hl-attribute">classpathref</span>=<span class="hl-value">"path.libs"</span> <span class="hl-attribute">source</span>=<span class="hl-value">"1.6"</span>&gt;
		&lt;<span class="hl-tag">aspectpath</span>&gt;
			&lt;<span class="hl-tag">pathelement</span> <span class="hl-attribute">location</span>=<span class="hl-value">"${lib.dir}/spring-aspects.jar"</span>/&gt;
		&lt;<span class="hl-tag">/aspectpath</span>&gt;
		&lt;<span class="hl-tag">aspectpath</span>&gt;
			&lt;<span class="hl-tag">pathelement</span> <span class="hl-attribute">location</span>=<span class="hl-value">"${lib.dir}/spring-data-neo4j.jar"</span>/&gt;
		&lt;<span class="hl-tag">/aspectpath</span>&gt;
	&lt;<span class="hl-tag">/iajc</span>&gt;
&lt;<span class="hl-tag">/target</span>&gt;</pre></div></div><br class="example-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2381"></a>19.3.&nbsp;Maven configuration</h2></div></div></div><p>
			Spring Data Graph projects are easiest to build with Apache Maven. The main dependencies are: Spring
            Data Graph itself, Spring Data Commons, parts of the Spring Framework, and the Neo4j graph database.
		</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2386"></a>19.3.1.&nbsp;Repositories</h3></div></div></div><p>
                The milestone releases of Spring Data Graph are available from the dedicated milestone
                repository. Neo4j releases and milestones are available from Maven Central.
            </p><div class="example"><a name="d0e2391"></a><p class="title"><b>Example&nbsp;19.3.&nbsp;Spring milestone repository</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">repository</span>&gt;
    &lt;<span class="hl-tag">id</span>&gt;spring-maven-milestone&lt;<span class="hl-tag">/id</span>&gt;
    &lt;<span class="hl-tag">name</span>&gt;Springframework Maven Repository&lt;<span class="hl-tag">/name</span>&gt;
    &lt;<span class="hl-tag">url</span>&gt;http://maven.springframework.org/milestone&lt;<span class="hl-tag">/url</span>&gt;
&lt;<span class="hl-tag">/repository</span>&gt;
</pre></div></div><br class="example-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2396"></a>19.3.2.&nbsp;Dependencies</h3></div></div></div><p>
                The dependency on <code class="code">spring-data-neo4j</code> will transitively pull in the necessary parts of
                Spring Framework (core, context, aop, aspects, tx), Aspectj, Neo4j, and Spring Data Commons. If you
                already use these (or different versions of these) in your project, then include those dependencies
                on your own.
            </p><div class="example"><a name="d0e2404"></a><p class="title"><b>Example&nbsp;19.4.&nbsp;Maven dependencies</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.data&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;spring-data-neo4j&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;1.1.0&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt;

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.aspectj&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;aspectjrt&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;1.6.12.M1&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt;
</pre></div></div><br class="example-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2409"></a>19.3.3.&nbsp;AspectJ build configuration</h3></div></div></div><p>
                Since Spring Data Graph uses AspectJ for build-time aspect weaving of entities, it is necessary to
                hook in the AspectJ Maven plugin to the build process. The plugin also has its own dependencies. You
                also need to explicitly specify the aspect libraries (spring-aspects and spring-data-neo4j).
            </p><div class="example"><a name="d0e2414"></a><p class="title"><b>Example&nbsp;19.5.&nbsp;AspectJ configuration</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">plugin</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.codehaus.mojo&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;aspectj-maven-plugin&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;1.0&lt;<span class="hl-tag">/version</span>&gt;
    &lt;<span class="hl-tag">dependencies</span>&gt;
        &lt;<span class="hl-comment">!-- NB: You must use Maven 2.0.9 or above or these are ignored (see MNG-2972) --</span>&gt;
        &lt;<span class="hl-tag">dependency</span>&gt;
            &lt;<span class="hl-tag">groupId</span>&gt;org.aspectj&lt;<span class="hl-tag">/groupId</span>&gt;
            &lt;<span class="hl-tag">artifactId</span>&gt;aspectjrt&lt;<span class="hl-tag">/artifactId</span>&gt;
            &lt;<span class="hl-tag">version</span>&gt;1.6.12.M1&lt;<span class="hl-tag">/version</span>&gt;
        &lt;<span class="hl-tag">/dependency</span>&gt;
        &lt;<span class="hl-tag">dependency</span>&gt;
            &lt;<span class="hl-tag">groupId</span>&gt;org.aspectj&lt;<span class="hl-tag">/groupId</span>&gt;
            &lt;<span class="hl-tag">artifactId</span>&gt;aspectjtools&lt;<span class="hl-tag">/artifactId</span>&gt;
            &lt;<span class="hl-tag">version</span>&gt;1.6.12.M1&lt;<span class="hl-tag">/version</span>&gt;
        &lt;<span class="hl-tag">/dependency</span>&gt;
    &lt;<span class="hl-tag">/dependencies</span>&gt;
    &lt;<span class="hl-tag">executions</span>&gt;
        &lt;<span class="hl-tag">execution</span>&gt;
            &lt;<span class="hl-tag">goals</span>&gt;
                &lt;<span class="hl-tag">goal</span>&gt;compile&lt;<span class="hl-tag">/goal</span>&gt;
                &lt;<span class="hl-tag">goal</span>&gt;test-compile&lt;<span class="hl-tag">/goal</span>&gt;
            &lt;<span class="hl-tag">/goals</span>&gt;
        &lt;<span class="hl-tag">/execution</span>&gt;
    &lt;<span class="hl-tag">/executions</span>&gt;
    &lt;<span class="hl-tag">configuration</span>&gt;
        &lt;<span class="hl-tag">outxml</span>&gt;true&lt;<span class="hl-tag">/outxml</span>&gt;
        &lt;<span class="hl-tag">aspectLibraries</span>&gt;
            &lt;<span class="hl-tag">aspectLibrary</span>&gt;
                &lt;<span class="hl-tag">groupId</span>&gt;org.springframework&lt;<span class="hl-tag">/groupId</span>&gt;
                &lt;<span class="hl-tag">artifactId</span>&gt;spring-aspects&lt;<span class="hl-tag">/artifactId</span>&gt;
            &lt;<span class="hl-tag">/aspectLibrary</span>&gt;
            &lt;<span class="hl-tag">aspectLibrary</span>&gt;
                &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.data&lt;<span class="hl-tag">/groupId</span>&gt;
                &lt;<span class="hl-tag">artifactId</span>&gt;spring-datastore-neo4j&lt;<span class="hl-tag">/artifactId</span>&gt;
            &lt;<span class="hl-tag">/aspectLibrary</span>&gt;
        &lt;<span class="hl-tag">/aspectLibraries</span>&gt;
        &lt;<span class="hl-tag">source</span>&gt;1.6&lt;<span class="hl-tag">/source</span>&gt;
        &lt;<span class="hl-tag">target</span>&gt;1.6&lt;<span class="hl-tag">/target</span>&gt;
    &lt;<span class="hl-tag">/configuration</span>&gt;
&lt;<span class="hl-tag">/plugin</span>&gt;
</pre></div></div><br class="example-break"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e2419"></a>19.4.&nbsp;Spring configuration</h2></div></div></div><p>
            Users of Spring Data Graph have two ways of very concisely configuring it. Either they can use a
            Spring Data Graph XML configuration namespace, or they can use a Java-based bean configuration.
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2424"></a>19.4.1.&nbsp;XML namespace</h3></div></div></div><p>
                The XML namespace can be used to configure Spring Data Graph. The <code class="code">config</code> element
                provides an XML-based configuration of Spring Data Graph in one line. It has three attributes.
                <code class="code">graphDatabaseService</code> points out the Neo4j instance to use. For convenience,
                <code class="code">storeDirectory</code> can be set instead of <code class="code">graphDatabaseService</code> to
                point to a directory where a new <code class="code">EmbeddedGraphDatabase</code> will be created. For
                cross-store configuration, the <code class="code">entityManagerFactory</code> attribute needs to be
                configured.
            </p><div class="example"><a name="d0e2447"></a><p class="title"><b>Example&nbsp;19.6.&nbsp;XML configuration with store directory</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8" standalone="yes"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
        <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="hl-attribute">xmlns:datagraph</span>=<span class="hl-value">"http://www.springframework.org/schema/data/graph"</span>
        <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context-3.0.xsd
            http://www.springframework.org/schema/data/graph
            http://www.springframework.org/schema/data/graph/datagraph-1.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">context:annotation-config</span>/&gt;
    &lt;<span class="hl-tag">datagraph:config</span> <span class="hl-attribute">storeDirectory</span>=<span class="hl-value">"target/config-test"</span>/&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
</pre></div></div><br class="example-break"><div class="example"><a name="d0e2452"></a><p class="title"><b>Example&nbsp;19.7.&nbsp;XML configuration with bean</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">context:annotation-config</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"graphDatabaseService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.neo4j.kernel.EmbeddedGraphDatabase"</span>
        <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"shutdown"</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"target/config-test"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">datagraph:config</span> <span class="hl-attribute">graphDatabaseService</span>=<span class="hl-value">"graphDatabaseService"</span>/&gt;
</pre></div></div><br class="example-break"><div class="example"><a name="d0e2457"></a><p class="title"><b>Example&nbsp;19.8.&nbsp;XML configuration with cross-store</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">context:annotation-config</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>
        <span class="hl-attribute">id</span>=<span class="hl-value">"entityManagerFactory"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistenceXmlLocation"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:META-INF/persistence.xml"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">datagraph:config</span> <span class="hl-attribute">storeDirectory</span>=<span class="hl-value">"target/config-test"</span>
        <span class="hl-attribute">entityManagerFactory</span>=<span class="hl-value">"entityManagerFactory"</span>/&gt;
</pre></div></div><br class="example-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2462"></a>19.4.2.&nbsp;Java-based bean configuration</h3></div></div></div><p>
                You can also configure Spring Data Graph using Java-based bean metadata.
            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
                    For those not familiar with Java-based bean metadata in Spring, we recommend that you
                    read up on it first. The Spring documentation has a
                    <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/new-in-3.html#new-java-configuration" target="_top">high-level introduction</a>
                    as well as
                    <a class="ulink" href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-java-instantiating-container" target="_top">detailed documentation</a>
                    on it.
                </p></div><p>
                In order to configure Spring Data Graph with Java-based bean metadata, the class
                <code class="code">Neo4jConfiguration</code> is registered with the context. This is either done
                explicitly in the context configuration, or via classpath scanning for classes that
                have the @Configuration annotation. The only thing that must be provided is the
                <code class="code">GraphDatabaseService</code>.  The example below shows how to register the
                <code class="code">@Configuration Neo4jConfiguration</code> class, as well as Spring's
                <code class="code">ConfigurationClassPostProcessor</code> that transforms the
                <code class="code">@Configuration</code> class to bean definitions.
                </p><div class="example"><a name="d0e2493"></a><p class="title"><b>Example&nbsp;19.9.&nbsp;Java-based bean configuration</b></p><div class="example-contents"><pre class="programlisting">&lt;<span class="hl-tag">![CDATA[&lt;beans</span> <span class="hl-attribute">...&gt;</span>
    <span class="hl-attribute">...</span>
    <span class="hl-attribute">&lt;tx:annotation-driven</span> <span class="hl-attribute">mode</span>=<span class="hl-value">"aspectj"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"transactionManager"</span>/&gt;
    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.data.neo4j.config.Neo4jConfiguration"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.annotation.ConfigurationClassPostProcessor"</span>/&gt;

    &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"graphDatabaseService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.neo4j.kernel.EmbeddedGraphDatabase"</span>
          <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"shutdown"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"singleton"</span>&gt;
        &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"target/config-test"</span>/&gt;
    &lt;<span class="hl-tag">/bean</span>&gt;
    ...
&lt;<span class="hl-tag">/beans</span>&gt;
</pre></div></div><p><br class="example-break">

            </p></div></div></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="programming-model.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="reference:cross-store.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;18.&nbsp;Programming model&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource
                                        </a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;20.&nbsp;Cross-store persistence</td></tr></table></div></body></html>