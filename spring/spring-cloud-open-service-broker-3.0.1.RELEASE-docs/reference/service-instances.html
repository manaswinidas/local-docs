<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Service Instances</title>
<link rel="stylesheet" href="css//spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="service-instances"><a class="anchor" href="#service-instances"></a>1. Service Instances</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service brokers are responsible for provisioning the services advertised in their catalog and managing their lifecycle in the underlying cloud platform.
The services created by the broker are referred to as service instances.</p>
</div>
<div class="paragraph">
<p>Service brokers must implement the {scosb-api-services}ServiceInstanceService.html[<code>ServiceInstanceService</code>] interface and provide implementations of the required methods of that interface.
Each method receives a single Java object parameter containing all details of the request from the platform and returns a Java object value providing details of the operation to the platform.</p>
</div>
<div class="paragraph">
<p>The service instance create, update, and delete operations can be performed synchronously or asynchronously.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a service broker creates, updates, or deletes a service instance synchronously, the appropriate interface method should block and only return a response to the platform when the operation completes successfully or when a failure occurs.</p>
</li>
<li>
<p>When performing an operation asynchronously, the service broker can return a response to the platform before the operation is complete and indicate in the response that the operation is in progress.
The platform <a href="#service-instance-status">polls the service broker</a> to get the status of the operation when an asynchronous operation is indicated.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="service-instance-creation"><a class="anchor" href="#service-instance-creation"></a>1.1. Service Instance Creation</h3>
<div class="paragraph">
<p>The service broker must provide an implementation of the {scosb-api-services}ServiceInstanceService.html#createServiceInstance-org.springframework.cloud.servicebroker.model.instance.CreateServiceInstanceRequest-[createServiceInstance()].</p>
</div>
<div class="paragraph">
<p>Service brokers typically provision a resource in the platform or in another system when creating a service instance.
Service brokers are responsible for keeping track of any resources associated with a service instance for future retrieval, updating, or deletion.</p>
</div>
<div class="sect3">
<h4 id="event-registry"><a class="anchor" href="#event-registry"></a>1.1.1. Event Registry</h4>
<div class="paragraph">
<p>Service instance creation can be further customized by utilizing events. Autowire the {scosb-api-service-events}/EventFlowRegistries.html[EventFlowRegistries] bean and retrieve the {scosb-api-service-events}/CreateServiceInstanceEventFlowRegistry.html[CreateServiceInstanceEventFlowRegistry] via the {scosb-api-service-events}/EventFlowRegistries.html#getCreateInstanceRegistry--[getCreateInstanceRegistry()] accessor. Use the {scosb-api-service-events}/EventFlowRegistry.html#addInitializationFlow-I-[addInitializationFlow()], {scosb-api-service-events}/EventFlowRegistry.html#addCompletionFlow-C-[addCompletionFlow()] or {scosb-api-service-events}/EventFlowRegistry.html#addErrorFlow-E-[addErrorFlow()] methods to register custom reactive flows for execution during the various stages of creating a service instance.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-instance-updating"><a class="anchor" href="#service-instance-updating"></a>1.2. Service Instance Updating</h3>
<div class="paragraph">
<p>If the <code>plan_updateable</code> field is set to <code>true</code> in the services catalog, the service broker must provide an implementation of the {scosb-api-services}ServiceInstanceService.html#updateServiceInstance-org.springframework.cloud.servicebroker.model.instance.UpdateServiceInstanceRequest-[updateServiceInstance()].
Otherwise, this method is never called by the platform, and the default implementation in the interface can be used.</p>
</div>
<div class="paragraph">
<p>Services brokers can modify the configuration of an existing resource when updating a service instance or deploying a new resource.</p>
</div>
<div class="sect3">
<h4 id="event-registry-2"><a class="anchor" href="#event-registry-2"></a>1.2.1. Event Registry</h4>
<div class="paragraph">
<p>Service instance updates can be further customized by utilizing events. Autowire the {scosb-api-service-events}/EventFlowRegistries.html[EventFlowRegistries] bean and retrieve the {scosb-api-service-events}/UpdateServiceInstanceEventFlowRegistry.html[UpdateServiceInstanceEventFlowRegistry] via the {scosb-api-service-events}/EventFlowRegistries.html#getUpdateInstanceRegistry--[getUpdateInstanceRegistry()] accessor. Use the {scosb-api-service-events}/EventFlowRegistry.html#addInitializationFlow-I-[addInitializationFlow()], {scosb-api-service-events}/EventFlowRegistry.html#addCompletionFlow-C-[addCompletionFlow()] or {scosb-api-service-events}/EventFlowRegistry.html#addErrorFlow-E-[addErrorFlow()] methods to register custom reactive flows for execution during the various stages of updating a service instance.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-instance-deletion"><a class="anchor" href="#service-instance-deletion"></a>1.3. Service Instance Deletion</h3>
<div class="paragraph">
<p>An implementation of the
{scosb-api-services}ServiceInstanceService.html#deleteServiceInstance-org.springframework.cloud.servicebroker.model.instance.DeleteServiceInstanceRequest-[deleteServiceInstance()]
method must be provided by the service broker.</p>
</div>
<div class="paragraph">
<p>Any resources provisioned in the create operation should be deprovisioned by the delete operation.</p>
</div>
<div class="sect3">
<h4 id="event-registry-3"><a class="anchor" href="#event-registry-3"></a>1.3.1. Event Registry</h4>
<div class="paragraph">
<p>Service instance deletion can be further customized by utilizing events. Autowire the {scosb-api-service-events}/EventFlowRegistries.html[EventFlowRegistries] bean and retrieve the {scosb-api-service-events}/DeleteServiceInstanceEventFlowRegistry.html[DeleteServiceInstanceEventFlowRegistry] via the {scosb-api-service-events}/EventFlowRegistries.html#getDeleteInstanceRegistry--[getDeleteInstanceRegistry()] accessor. Use the {scosb-api-service-events}/EventFlowRegistry.html#addInitializationFlow-I-[addInitializationFlow()], {scosb-api-service-events}/EventFlowRegistry.html#addCompletionFlow-C-[addCompletionFlow()] or {scosb-api-service-events}/EventFlowRegistry.html#addErrorFlow-E-[addErrorFlow()] methods to register custom reactive flows for execution during the various stages of deleting a service instance.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-instance-status"><a class="anchor" href="#service-instance-status"></a>1.4. Service Instance Operation Status Retrieval</h3>
<div class="paragraph">
<p>If any create, update, or delete operation can return an asynchronous &#8220;operation in progress&#8221; response to the platform, the service broker must provide an implementation of the {scosb-api-services}ServiceInstanceService.html#getLastOperation-org.springframework.cloud.servicebroker.model.instance.GetLastServiceOperationRequest-[getLastOperation()]. Otherwise, this method is never called by the platform, and the default implementation in the interface can be used.</p>
</div>
<div class="paragraph">
<p>The platform polls this method of the service broker for a service instance that has an asynchronous operation in progress until the service broker indicates that the operation has completed successfully or a failure has occurred.</p>
</div>
<div class="sect3">
<h4 id="event-registry-4"><a class="anchor" href="#event-registry-4"></a>1.4.1. Event Registry</h4>
<div class="paragraph">
<p>Service instance last operation requests can be further customized by utilizing events. Autowire the {scosb-api-service-events}/EventFlowRegistries.html[EventFlowRegistries] bean and retrieve the {scosb-api-service-events}/AsyncOperationServiceInstanceEventFlowRegistry.html[AsyncOperationServiceInstanceEventFlowRegistry] via the {scosb-api-service-events}/EventFlowRegistries.html#getLastOperationInstanceRegistry--[getLastOperationInstanceRegistry()] accessor. Use the {scosb-api-service-events}/EventFlowRegistry.html#addInitializationFlow-I-[addInitializationFlow()], {scosb-api-service-events}/EventFlowRegistry.html#addCompletionFlow-C-[addCompletionFlow()] or {scosb-api-service-events}/EventFlowRegistry.html#addErrorFlow-E-[addErrorFlow()] methods to register custom reactive flows for execution during the various stages of last operation retrieval.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-instance-retrieval"><a class="anchor" href="#service-instance-retrieval"></a>1.5. Service Instance Retrieval</h3>
<div class="paragraph">
<p>If the <code>instances_retrievable</code> field is set to <code>true</code> in the services catalog, the service broker must provide an implementation of the
{scosb-api-services}ServiceInstanceService.html#getServiceInstance-org.springframework.cloud.servicebroker.model.instance.GetServiceInstanceRequest-[getServiceInstance()]. Otherwise, this method is never called by the platform, and the default implementation in the interface can be used.</p>
</div>
<div class="paragraph">
<p>Service brokers are responsible for maintaining any service instance state necessary to support the retrieval operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-implementation"><a class="anchor" href="#example-implementation"></a>1.6. Example Implementation</h3>
<div class="paragraph">
<p>The following example shows a service instance implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">Unresolved directive in service-instances.adoc - include::{examples-dir}/ExampleServiceInstanceService.java[]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-event-flow-configuration"><a class="anchor" href="#example-event-flow-configuration"></a>1.7. Example Event Flow Configuration</h3>
<div class="paragraph">
<p>The following example shows a configuration for service instance event flows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">Unresolved directive in service-instances.adoc - include::{examples-dir}/ExampleServiceInstanceEventFlowsConfiguration.java[]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
<link rel="stylesheet" href="js/highlight/styles/atom-one-dark-reasonable.min.css">
<script src="js/highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>