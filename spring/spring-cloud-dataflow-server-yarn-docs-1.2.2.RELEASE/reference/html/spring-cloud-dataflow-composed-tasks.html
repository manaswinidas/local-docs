<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>41.&nbsp;Composed Tasks</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Data Flow for Apache YARN"><link rel="up" href="spring-cloud-task.html" title="Part&nbsp;VI.&nbsp;Tasks"><link rel="prev" href="spring-cloud-dataflow-launch-tasks-from-stream.html" title="40.&nbsp;Launching Tasks from a Stream"><link rel="next" href="dashboard.html" title="Part&nbsp;VII.&nbsp;Dashboard"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">41.&nbsp;Composed Tasks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="spring-cloud-dataflow-launch-tasks-from-stream.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;VI.&nbsp;Tasks</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="dashboard.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="spring-cloud-dataflow-composed-tasks" href="#spring-cloud-dataflow-composed-tasks"></a>41.&nbsp;Composed Tasks</h2></div></div></div><p>Spring Cloud Data Flow allows a user to create a directed graph where each node
of the graph is a task application.  This is done by using the DSL for composed
tasks.  A composed task can be created via the RESTful API, the Spring Cloud
Data Flow Shell, or the Spring Cloud Data Flow UI.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_the_composed_task_runner_in_spring_cloud_data_flow" href="#_configuring_the_composed_task_runner_in_spring_cloud_data_flow"></a>41.1&nbsp;Configuring the Composed Task Runner in Spring Cloud Data Flow</h2></div></div></div><p>Composed tasks are executed via a task application called the <a class="link" href="https://github.com/spring-cloud-task-app-starters/composed-task-runner" target="_top">Composed Task Runner</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_registering_the_composed_task_runner_application" href="#_registering_the_composed_task_runner_application"></a>41.1.1&nbsp;Registering the Composed Task Runner application</h3></div></div></div><p>Out of the box the Composed Task Runner application is not registered with Spring Cloud Data Flow. So, to launch composed tasks we must first register the Composed
Task Runner as an application with Spring Cloud Data Flow as follows:</p><pre class="screen">app register --name composed-task-runner --type task --uri maven://org.springframework.cloud.task.app:composedtaskrunner-task:&lt;DESIRED_VERSION&gt;</pre><p>You can also configure Spring Cloud Data Flow to use a different task definition
name for the composed task runner.  This can be done by setting the
<code class="literal">spring.cloud.dataflow.task.composedTaskRunnerName</code> property to the name
of your choice.  You can then register the composed task runner application with
the name you set using that property.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_the_composed_task_runner_application" href="#_configuring_the_composed_task_runner_application"></a>41.1.2&nbsp;Configuring the Composed Task Runner application</h3></div></div></div><p>The Composed Task Runner application has a <code class="literal">dataflow.server.uri</code> property that is used for validation and for launching child tasks. This defaults
to <code class="literal"><a class="link" href="http://localhost:9393" target="_top">localhost:9393</a></code>. If you run a distributed Spring Cloud Data Flow server, like you would do if you deploy the server on Cloud Foundry,
YARN or Kubernetes, then you need to provide the URI that can be used to access the server. You can either provide this <code class="literal">dataflow.server.uri</code>
property for the Composed Task Runner application when launching a composed task, or you can provide a <code class="literal">spring.cloud.dataflow.server.uri</code> property
for the Spring Cloud Data Flow server when it is started. For the latter case the <code class="literal">dataflow.server.uri</code> Composed Task Runner application property
will be automatically set when a composed task is launched.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_creating_launching_and_destroying_a_composed_task" href="#_creating_launching_and_destroying_a_composed_task"></a>41.2&nbsp;Creating, Launching, and Destroying a Composed Task</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_creating_a_composed_task" href="#_creating_a_composed_task"></a>41.2.1&nbsp;Creating a Composed Task</h3></div></div></div><p>The DSL for the composed tasks is used when creating a task definition via the
task create command. For example:</p><pre class="screen">dataflow:&gt; app register --name timestamp --type task --uri maven://org.springframework.cloud.task.app:timestamp-task:&lt;DESIRED_VERSION&gt;
dataflow:&gt; app register --name mytaskapp --type task --uri file:///home/tasks/mytask.jar
dataflow:&gt; task create my-composed-task --definition "mytaskapp &amp;&amp; timestamp"
dataflow:&gt; task launch my-composed-task</pre><p>In the example above we assume that the applications to be used by our composed
task have not been registered yet.  So the first two steps we register two task
applications.  We then create our composed task definition by using the task
create command.  The composed task DSL in the example above will, when launched,
execute mytaskapp and then execute the timestamp application.</p><p>But before we launch the my-composed-task definition,  we can view what
Spring Cloud Data Flow generated for us.  This can be done by executing the
task list command.</p><pre class="screen">dataflow:&gt;task list
&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;
&#9553;        Task Name         &#9474;                      Task Definition
&#9568;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;
&#9553;my-composed-task          &#9474;mytaskapp &amp;&amp; timestamp
&#9553;my-composed-task-mytaskapp&#9474;mytaskapp
&#9553;my-composed-task-timestamp&#9474;timestamp</pre><p>Spring Cloud Data Flow created three task definitions, one for each of the
applications that comprises our composed task (<code class="literal">my-composed-task-mytaskapp</code> and
<code class="literal">my-composed-task-timestamp</code>) as well as the composed task (<code class="literal">my-composed-task</code>)
definition.  We also see that each of the generated
names for the child tasks is comprised of the name of the composed task and
the name of the application separated by a dash <code class="literal">-</code>.  i.e. <span class="emphasis"><em>my-composed-task</em></span> <code class="literal">-</code>
<span class="emphasis"><em>mytaskapp</em></span>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_task_application_parameters" href="#_task_application_parameters"></a>Task Application Parameters</h4></div></div></div><p>The task applications that comprise the composed task definition can also
contain parameters.  For example:</p><pre class="screen">dataflow:&gt; task create my-composed-task --definition "mytaskapp --displayMessage=hello &amp;&amp; timestamp --format=YYYY"</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_launching_a_composed_task" href="#_launching_a_composed_task"></a>41.2.2&nbsp;Launching a Composed Task</h3></div></div></div><p>Launching a composed task is done the same way as launching a stand-alone task.
i.e.</p><pre class="screen">task launch my-composed-task</pre><p>Once the task is launched and assuming all the tasks complete successfully you will
see three task executions when executing a <code class="literal">task execution list</code>.  For example:</p><pre class="screen">dataflow:&gt;task execution list
&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;
&#9553;        Task Name         &#9474;ID &#9474;         Start Time         &#9474;          End Time          &#9474;Exit Code&#9553;
&#9568;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9571;
&#9553;my-composed-task-timestamp&#9474;713&#9474;Wed Apr 12 16:43:07 EDT 2017&#9474;Wed Apr 12 16:43:07 EDT 2017&#9474;0        &#9553;
&#9553;my-composed-task-mytaskapp&#9474;712&#9474;Wed Apr 12 16:42:57 EDT 2017&#9474;Wed Apr 12 16:42:57 EDT 2017&#9474;0        &#9553;
&#9553;my-composed-task          &#9474;711&#9474;Wed Apr 12 16:42:55 EDT 2017&#9474;Wed Apr 12 16:43:15 EDT 2017&#9474;0        &#9553;
&#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;</pre><p>In the example above we see that my-compose-task launched and it also launched
the other tasks in sequential order and all of them executed successfully with
"Exit Code" as <code class="literal">0</code>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_exit_statuses" href="#_exit_statuses"></a>Exit Statuses</h4></div></div></div><p>The following list shows how the Exit Status will be set for each step (task)
contained in the composed task following each step execution.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">If the <code class="literal">TaskExecution</code> has an <code class="literal">ExitMessage</code> that will be used as the <code class="literal">ExitStatus</code></li><li class="listitem">If no <code class="literal">ExitMessage</code> is present and the <code class="literal">ExitCode</code> is set to zero then the <code class="literal">ExitStatus</code>
for the step will be <code class="literal">COMPLETED</code>.</li><li class="listitem">If no <code class="literal">ExitMessage</code> is present and the <code class="literal">ExitCode</code> is set to any non zero number
then the <code class="literal">ExitStatus</code> for the step will be <code class="literal">FAILED</code>.</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_destroying_a_composed_task" href="#_destroying_a_composed_task"></a>41.2.3&nbsp;Destroying a Composed Task</h3></div></div></div><p>The same command used to destroy a stand-alone task is the same as destroying a
composed task.  The only difference is that destroying a composed task will
also destroy the child tasks associated with it.   For example</p><pre class="screen">dataflow:&gt;task list
&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;
&#9553;        Task Name         &#9474;                      Task Definition
&#9568;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;
&#9553;my-composed-task          &#9474;mytaskapp &amp;&amp; timestamp
&#9553;my-composed-task-mytaskapp&#9474;mytaskapp
&#9553;my-composed-task-timestamp&#9474;timestamp

...
dataflow:&gt;task destroy my-composed-task
dataflow:&gt;task list
&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;
&#9553;        Task Name         &#9474;                      Task Definition
&#9568;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;
&#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_stopping_a_composed_task" href="#_stopping_a_composed_task"></a>41.2.4&nbsp;Stopping a Composed Task</h3></div></div></div><p>In cases where a composed task execution needs to be stopped.  This can be done
via the:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">RESTful API</li><li class="listitem">Spring Cloud Data Flow Dashboard by selecting the Job&#8217;s tab and then
clicking the stop button by the job execution that needs to be stopped.</li></ul></div><p>The composed task run will be stopped
when the currently running child task completes.  The step associated with the
child task that was running at the time that the composed task was stopped will
be marked as <code class="literal">STOPPED</code> as well as the composed task job execution.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_restarting_a_composed_task" href="#_restarting_a_composed_task"></a>41.2.5&nbsp;Restarting a Composed Task</h3></div></div></div><p>In cases where a composed task fails during execution and the status of the
composed task is <code class="literal">FAILED</code> then the task can be restarted.  This can be done
via the:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">RESTful API</li><li class="listitem">Shell by launching the task using the same parameters</li><li class="listitem">Spring Cloud Data Flow Dashboard by selecting the Job&#8217;s tab and then
clicking the restart button by the job execution that needs to be restarted.</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Restarting a Composed Task job that has been stopped (via the
Spring Cloud Data Flow Dashboard or RESTful API), will relaunch  the
<code class="literal">STOPPED</code> child task, and then launch the remaining (unlaunched) child tasks
in the specified order.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_composed_task_dsl" href="#_composed_task_dsl"></a>41.3&nbsp;Composed Task DSL</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_conditional_execution" href="#_conditional_execution"></a>41.3.1&nbsp;Conditional Execution</h3></div></div></div><p>Conditional execution is expressed using a double ampersand symbol <code class="literal">&amp;&amp;</code>.
This allows each task in the sequence to be launched only if the previous task
successfully completed. For example:</p><pre class="screen">task create my-composed-task --definition "foo &amp;&amp; bar"</pre><p>When the composed task my-composed-task is launched, it will launch the
task <code class="literal">foo</code> and if it completes successfully, then the task <code class="literal">bar</code> will be
launched. If the <code class="literal">foo</code> task fails, then the task <code class="literal">bar</code> will not launch.</p><p>You can also use the Spring Cloud Data Flow Dashboard to create your conditional
execution. By using the designer to drag and drop applications
that are required, and connecting them together to create your directed graph.
For example:</p><div class="figure"><a name="d0e3802" href="#d0e3802"></a><p class="title"><b>Figure&nbsp;41.1.&nbsp;Conditional Execution</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-conditional-execution.png" alt="Composed Task Conditional Execution"></div></div></div><br class="figure-break"><p>The diagram above is a screen capture of the directed graph as it being created
using the Spring Cloud Data Flow Dashboard.  We see that are 4 components
in the diagram that comprise a conditional execution:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Start icon - All directed graphs start from this symbol.  There will
only be one.</li><li class="listitem">Task icon - Represents each task in the directed graph.</li><li class="listitem">End icon - Represents the termination of a directed graph.</li><li class="listitem"><p class="simpara">Solid line arrow - Represents the flow conditional execution flow
between:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Two applications</li><li class="listitem">The start control node and an application</li><li class="listitem">An application and the end control node</li></ul></div></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can view a diagram of your directed graph by clicking the detail
button next to the composed task definition on the definitions tab.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_transitional_execution" href="#_transitional_execution"></a>41.3.2&nbsp;Transitional Execution</h3></div></div></div><p>The DSL supports fine grained control over the transitions taken during the
execution of the directed graph. Transitions are specified by providing a
condition for equality based on the exit status of the previous task.
A task transition is represented by the following symbol <code class="literal">-&gt;</code>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_basic_transition" href="#_basic_transition"></a>Basic Transition</h4></div></div></div><p>A basic transition would look like the following:</p><pre class="screen">task create my-transition-composed-task --definition "foo 'FAILED' -&gt; bar 'COMPLETED' -&gt; baz"</pre><p>In the example above <code class="literal">foo</code> would launch and if it had an exit status of <code class="literal">FAILED</code>,
then the <code class="literal">bar</code> task would launch. If the exit status of <code class="literal">foo</code> was <code class="literal">COMPLETED</code>
then <code class="literal">baz</code> would launch. All other statuses returned by <code class="literal">foo</code> will have no effect
and task would terminate normally.</p><p>Using the Spring Cloud Data Flow Dashboard to create  the same "basic
transition" would look like:</p><div class="figure"><a name="d0e3879" href="#d0e3879"></a><p class="title"><b>Figure&nbsp;41.2.&nbsp;Basic Transition</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-transition-basic.png" alt="Composed Task Basic Transition"></div></div></div><br class="figure-break"><p>The diagram above is a screen capture of the directed graph as it being created
using the Spring Cloud Data Flow Dashboard.  Notice that there are 2 different
types of connectors:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Dashed line - Is the line used to represent transitions from the application
to one of the possible destination applications.</li><li class="listitem">Solid line - Used to connect applications in a conditional execution or a
connection between the application and a control node (end, start).</li></ul></div><p>When creating a transition, link the application to each of possible
destination using the connector.  Once complete go to each connection and
select it by clicking it.  A bolt icon should appear, click that icon and
enter the exit status required for that connector.  The solid line for that
connector will turn to a dashed line.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_transition_with_a_wildcard" href="#_transition_with_a_wildcard"></a>Transition With a Wildcard</h4></div></div></div><p>Wildcards are supported for transitions by the DSL for example:</p><pre class="screen">task create my-transition-composed-task --definition "foo 'FAILED' -&gt; bar '*' -&gt; baz"</pre><p>In the example above <code class="literal">foo</code> would launch and if it had an exit status of <code class="literal">FAILED</code>,
then the <code class="literal">bar</code> task would launch. Any exit status of <code class="literal">foo</code> other than <code class="literal">FAILED</code>
then <code class="literal">baz</code> would launch.</p><p>Using the Spring Cloud Data Flow Dashboard to create the same
"transition with wildcard" would look like:</p><div class="figure"><a name="d0e3928" href="#d0e3928"></a><p class="title"><b>Figure&nbsp;41.3.&nbsp;Basic Transition With Wildcard</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-transition-basic-wildcard.png" alt="Composed Task Basic Transition with Wildcard"></div></div></div><br class="figure-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_transition_with_a_following_conditional_execution" href="#_transition_with_a_following_conditional_execution"></a>Transition With a Following Conditional Execution</h4></div></div></div><p>A transition can be followed by a conditional execution so long as the wildcard
is not used. For example:</p><pre class="screen">task create my-transition-conditional-execution-task --definition "foo 'FAILED' -&gt; bar 'UNKNOWN' -&gt; baz &amp;&amp; qux &amp;&amp; quux"</pre><p>In the example above <code class="literal">foo</code> would launch and if it had an exit status of <code class="literal">FAILED</code>,
then the <code class="literal">bar</code> task would launch.  If <code class="literal">foo</code> had an exit status of <code class="literal">UNKNOWN</code> then
<code class="literal">baz</code> would launch.  Any exit status of <code class="literal">foo</code> other than <code class="literal">FAILED</code> or <code class="literal">UNKNOWN</code>
then <code class="literal">qux</code> would launch and upon successful completion <code class="literal">quux</code> would launch.</p><p>Using the Spring Cloud Data Flow Dashboard to create the same
"transition with conditional execution" would look like:</p><div class="figure"><a name="d0e3981" href="#d0e3981"></a><p class="title"><b>Figure&nbsp;41.4.&nbsp;Transition With Conditional Execution</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-transition-conditional-execution.png" alt="Composed Task Transition with Conditional Execution"></div></div></div><br class="figure-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In this diagram we see the dashed line (transition) connecting the <code class="literal">foo</code> application
to the target applications, but a solid line connecting the conditional executions
between <code class="literal">foo</code>, <code class="literal">qux</code>, and  <code class="literal">quux</code>.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_split_execution" href="#_split_execution"></a>41.3.3&nbsp;Split Execution</h3></div></div></div><p>Splits allow for multiple tasks within a composed task to be run in parallel.
It is denoted by using angle brackets &lt;&gt; to group tasks and flows that are to
be run in parallel. These tasks and flows are separated by the double pipe <code class="literal">||</code>
. For example:</p><pre class="screen">task create my-split-task --definition "&lt;foo || bar || baz&gt;"</pre><p>The example above will launch tasks <code class="literal">foo</code>, <code class="literal">bar</code> and <code class="literal">baz</code> in parallel.</p><p>Using the Spring Cloud Data Flow Dashboard to create the same
"split execution" would look like:</p><div class="figure"><a name="d0e4028" href="#d0e4028"></a><p class="title"><b>Figure&nbsp;41.5.&nbsp;Split</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-split.png" alt="Composed Task Split"></div></div></div><br class="figure-break"><p>With the task DSL a user may also execute multiple split groups
in succession. For example:</p><pre class="screen">task create my-split-task --definition "&lt;foo || bar || baz&gt; &amp;&amp; &lt;qux || quux&gt;"</pre><p>In the example above tasks <code class="literal">foo</code>, <code class="literal">bar</code> and <code class="literal">baz</code> will be launched in parallel,
once they all complete then tasks <code class="literal">qux</code>, <code class="literal">quux</code> will be launched in parallel.
Once they complete the composed task will end.   However if <code class="literal">foo</code>, <code class="literal">bar</code>, or
<code class="literal">baz</code> fails then, the split containing <code class="literal">qux</code> and <code class="literal">quux</code> will not launch.</p><p>Using the Spring Cloud Data Flow Dashboard to create the same
"split with multiple groups" would look like:</p><div class="figure"><a name="d0e4075" href="#d0e4075"></a><p class="title"><b>Figure&nbsp;41.6.&nbsp;Split as a part of a conditional execution</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-multiple-splits.png" alt="Composed Task Split"></div></div></div><br class="figure-break"><p>Notice that there is a <code class="literal">SYNC</code> control node that is by the designer when
connecting two consecutive splits.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_split_containing_conditional_execution" href="#_split_containing_conditional_execution"></a>Split Containing Conditional Execution</h4></div></div></div><p>A split can also have a conditional execution within the angle brackets.  For
example:</p><pre class="screen">task create my-split-task --definition "&lt;foo &amp;&amp; bar || baz&gt;"</pre><p>In the example above we see that <code class="literal">foo</code> and <code class="literal">baz</code> will be launched in parallel,
however <code class="literal">bar</code> will not launch until <code class="literal">foo</code> completes successfully.</p><p>Using the Spring Cloud Data Flow Dashboard to create the same
"split containing conditional execution" would look like:</p><div class="figure"><a name="d0e4112" href="#d0e4112"></a><p class="title"><b>Figure&nbsp;41.7.&nbsp;Split with conditional execution</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-dataflow/v1.2.2.RELEASE/spring-cloud-dataflow-docs/src/main/asciidoc/images/dataflow-ctr-split-contains-conditional.png" alt="Composed Task Split With Conditional Execution"></div></div></div><br class="figure-break"></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring-cloud-dataflow-launch-tasks-from-stream.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-cloud-task.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="dashboard.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">40.&nbsp;Launching Tasks from a Stream&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Part&nbsp;VII.&nbsp;Dashboard</td></tr></table></div></body></html>