<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>38.&nbsp;Task Repository</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Data Flow for Apache YARN"><link rel="up" href="spring-cloud-task.html" title="Part&nbsp;VI.&nbsp;Tasks"><link rel="prev" href="_the_lifecycle_of_a_task.html" title="37.&nbsp;The Lifecycle of a task"><link rel="next" href="spring-cloud-dataflow-task-events.html" title="39.&nbsp;Subscribing to Task/Batch Events"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">38.&nbsp;Task Repository</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_the_lifecycle_of_a_task.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;VI.&nbsp;Tasks</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-dataflow-task-events.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="spring-cloud-dataflow-task-repository" href="#spring-cloud-dataflow-task-repository"></a>38.&nbsp;Task Repository</h2></div></div></div><p>Out of the box Spring Cloud Data Flow offers an embedded instance of the H2 database.
The H2 is good for development purposes but is not recommended for production use.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuring_the_task_execution_repository" href="#_configuring_the_task_execution_repository"></a>38.1&nbsp;Configuring the Task Execution Repository</h2></div></div></div><p>To add a driver for the database that will store the Task Execution information, a
dependency for the driver will need to be added to a maven pom file and the
Spring Cloud Data Flow will need to be rebuilt.  Since Spring Cloud Data Flow is comprised of an SPI for
each environment it supports, please review the SPI&#8217;s documentation on which POM should be
updated to add the dependency and how to build.  This document will cover how to setup the
dependency for local SPI.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_local" href="#_local"></a>38.1.1&nbsp;Local</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Open the spring-cloud-dataflow-server-local/pom.xml in your IDE.</li><li class="listitem">In the <code class="literal">dependencies</code> section add the dependency for the database driver required.  In
the sample below postgresql has been chosen.</li></ol></div><pre class="screen">&lt;dependencies&gt;
...
    &lt;dependency&gt;
        &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
        &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
    &lt;/dependency&gt;
...
&lt;/dependencies&gt;</pre><div class="orderedlist"><ol class="orderedlist" start="3" type="1"><li class="listitem">Save the changed pom.xml</li><li class="listitem">Build the application as described here: <a class="link" href="building.html" title="Appendix&nbsp;B.&nbsp;Building">Building Spring Cloud Data Flow</a></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_task_application_repository" href="#_task_application_repository"></a>38.1.2&nbsp;Task Application Repository</h3></div></div></div><p>When launching a task application be sure that the database driver that is being
used by Spring Cloud Data Flow is also a dependency on the task application. For
example if your Spring Cloud Data Flow is set to use Postgresql, be sure that
the task application <span class="emphasis"><em>also</em></span> has Postgresql as a dependency.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When executing tasks externally (i.e. command line) and you wish for
Spring Cloud Data Flow to show the TaskExecutions in its UI, be sure that
common datasource settings are shared among the both. By default
Spring Cloud Task will use a local H2 instance and the execution will
not be recorded to the database used by Spring Cloud Data Flow.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_datasource" href="#_datasource"></a>38.2&nbsp;Datasource</h2></div></div></div><p>To configure the datasource Add the following properties to the dataflow-server.yml or via
environment variables:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">spring.datasource.url</li><li class="listitem">spring.datasource.username</li><li class="listitem">spring.datasource.password</li><li class="listitem">spring.datasource.driver-class-name</li></ol></div><p>For example adding postgres would look something like this:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Environment variables:</li></ul></div><pre class="screen">export spring_datasource_url=jdbc:postgresql://localhost:5432/mydb
export spring_datasource_username=myuser
export spring_datasource_password=mypass
export spring_datasource_driver-class-name="org.postgresql.Driver"</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">dataflow-server.yml</li></ul></div><pre class="screen">spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/mydb
    username: myuser
    password: mypass
    driver-class-name:org.postgresql.Driver</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_the_lifecycle_of_a_task.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-cloud-task.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-dataflow-task-events.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">37.&nbsp;The Lifecycle of a task&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;39.&nbsp;Subscribing to Task/Batch Events</td></tr></table></div></body></html>