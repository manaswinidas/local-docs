<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>16.&nbsp;Deploying on AMBARI</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Data Flow for Apache YARN"><link rel="up" href="_spring_cloud_data_flow_runtime.html" title="Part&nbsp;IV.&nbsp;Spring Cloud Data Flow Runtime"><link rel="prev" href="yarn-deploying-on-yarn.html" title="15.&nbsp;Deploying on YARN"><link rel="next" href="yarn-configure-settings.html" title="17.&nbsp;Configuring Runtime Settings and Environment"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.&nbsp;Deploying on AMBARI</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="yarn-deploying-on-yarn.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Spring Cloud Data Flow Runtime</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="yarn-configure-settings.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="yarn-deploying-on-ambari" href="#yarn-deploying-on-ambari"></a>16.&nbsp;Deploying on AMBARI</h2></div></div></div><p>Ambari basically automates YARN installation instead of requiring user
to do it manually. Also a lot of other configuration steps are automated as
much as possible to easy overall installation process.</p><p>There is no difference on components deployed into ambari comparing of
a manual usage with a separate YARN cluster. With ambari we simply package
needed dataflow components into a rpm package so that it can be managed as
an ambari service. After that ambari really only manage a runtime
configuration of those components.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_install_ambari_server" href="#_install_ambari_server"></a>16.1&nbsp;Install Ambari Server</h2></div></div></div><p>Generally it is only needed to install <code class="literal">scdf-plugin-hdp</code> plugin into
ambari server which adds needed service definitions.</p><pre class="programlisting">[root@ambari-1 ~]# yum -y install ambari-server
[root@ambari-1 ~]# ambari-server setup -s
[root@ambari-1 ~]# wget -nv http://repo.spring.io/yum-release-local/scdf/1.2.2/scdf-release-1.2.2.repo -O /etc/yum.repos.d/scdf-release-1.2.2.repo
[root@ambari-1 ~]# yum -y install scdf-plugin-hdp
[root@ambari-1 ~]# ambari-server start</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Ambari plugin only works for redhat6/redhat7 and related centos based systems for now.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_deploy_data_flow" href="#_deploy_data_flow"></a>16.2&nbsp;Deploy Data Flow</h2></div></div></div><p>When you create your cluster and choose a stack, make sure that
<code class="literal">redhat6</code> or/and <code class="literal">redhat7</code> sections contains repository named
<code class="literal">SCDF-1.2.2</code> and that it points to
<code class="literal"><a class="link" href="http://repo.spring.io/yum-release-local/scdf/1.2.2" target="_top">repo.spring.io/yum-release-local/scdf/1.2.2</a></code>.</p><p><code class="literal">Ambari 2.4</code> contains major rewrites for stack definitions and how it
is possible to integrate with those from external contributions. Our
plugin will eventually integrate via extensions or management packs,
but for now you need to choose stack marked as a <span class="emphasis"><em>Default Version
Definition</em></span> which contains correct yum repository. For example with
<code class="literal">HDP 2.5</code> you have two default choices, <span class="emphasis"><em>HDP-2.5.0.0</em></span> and <span class="emphasis"><em>HDP-2.5
(Default Version Definition)</em></span>. As mentioned you need to pick latter.
With older ambari versions you don&#8217;t have these new options.</p><p>From services choose <code class="literal">Spring Cloud Data Flow</code> and <code class="literal">Kafka</code>. <code class="literal">Hdfs</code>,
<code class="literal">Yarn</code> and <code class="literal">Zookeeper</code> are forced dependencies.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>With <code class="literal">Kafka</code> you can do "one-click" installation while using <code class="literal">Rabbit</code>
you need to provide appropriate connection settings as <code class="literal">Rabbit</code> is not
part of a Ambari managed service.</p></td></tr></table></div><p>Then in <span class="emphasis"><em>Customize Services</em></span> what is really left for user to do is to
customise settings if needed. Everything else is automatically
configured. Technically it also allows you to switch to use rabbit by
leaving Kafka out and defining rabbit settings there. But generally
use of Kafka is a good choice.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>We also install H2 DB as service so that it can be accessed from every
node.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_configuration" href="#_using_configuration"></a>16.3&nbsp;Using Configuration</h2></div></div></div><p><code class="literal">servers.yml</code> file is also used to store common configuration with
Ambari. Settings in <span class="emphasis"><em>Advanced scdf-site</em></span> and <span class="emphasis"><em>Custom scdf-site</em></span> are
used to dynamically create a this file which is then copied over to
hdfs when needed application files are deployd.</p><p>Every additional entry added via <span class="emphasis"><em>Custom scdf-site</em></span> is added into
<code class="literal">servers.yml</code> as is and overrides everything else in it.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>If ambari configuration is modified, you need to delete
<code class="literal">/dataflow/apps/stream/app</code> and <code class="literal">/dataflow/apps/task/app</code> directories
from hdfs for new settings to get applied. Files in above directories
will not get overridden including generated <code class="literal">servers.yml</code> config file.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_change_datasource" href="#_change_datasource"></a>16.3.1&nbsp;Change Datasource</h3></div></div></div><p>Ambari managed service defaults to <code class="literal">H2</code> database. We currently support
using <code class="literal">MySQL</code>, <code class="literal">PostgreSQL</code> and <code class="literal">HSQLDB</code> as external datasources.
Custom datasource configuration can be applied via <span class="emphasis"><em>Custom scdf-site</em></span>
as shown in below screenshot. After these settings are modified, all
related services needs to be restarted.</p><div class="figure"><a name="d0e996" href="#d0e996"></a><p class="title"><b>Figure&nbsp;16.1.&nbsp;Custom Datasource Config</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/ambari-custom-scdf-site-dbconfig.png" alt="Custom Datasource Config"></div></div></div><br class="figure-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Managed service <span class="emphasis"><em>SCDF H2 Database</em></span> can be stopped and put in a
maintenance mode after custom datasource settings has been added.</p></td></tr></table></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="yarn-deploying-on-yarn.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="_spring_cloud_data_flow_runtime.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="yarn-configure-settings.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">15.&nbsp;Deploying on YARN&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;17.&nbsp;Configuring Runtime Settings and Environment</td></tr></table></div></body></html>