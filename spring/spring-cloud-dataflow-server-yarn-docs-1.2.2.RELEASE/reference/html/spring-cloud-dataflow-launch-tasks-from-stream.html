<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>40.&nbsp;Launching Tasks from a Stream</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Data Flow for Apache YARN"><link rel="up" href="spring-cloud-task.html" title="Part&nbsp;VI.&nbsp;Tasks"><link rel="prev" href="spring-cloud-dataflow-task-events.html" title="39.&nbsp;Subscribing to Task/Batch Events"><link rel="next" href="spring-cloud-dataflow-composed-tasks.html" title="41.&nbsp;Composed Tasks"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">40.&nbsp;Launching Tasks from a Stream</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="spring-cloud-dataflow-task-events.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;VI.&nbsp;Tasks</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-dataflow-composed-tasks.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="spring-cloud-dataflow-launch-tasks-from-stream" href="#spring-cloud-dataflow-launch-tasks-from-stream"></a>40.&nbsp;Launching Tasks from a Stream</h2></div></div></div><p>You can launch a task from a stream by using one of the available <code class="literal">task-launcher</code> sinks. Currently the platforms supported
via the <code class="literal">task-launcher</code> sinks are
<a class="link" href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-local" target="_top">local</a>,
<a class="link" href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-cloudfoundry" target="_top">Cloud Foundry</a>, and
<a class="link" href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-yarn" target="_top">Yarn</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><code class="literal">task-launcher-local</code> is meant for development purposes only.</p></td></tr></table></div><p>A <code class="literal">task-launcher</code> sink expects a message containing a <a class="link" href="https://github.com/spring-cloud/spring-cloud-task/blob/master/spring-cloud-task-stream/src/main/java/org/springframework/cloud/task/launcher/TaskLaunchRequest.java" target="_top">TaskLaunchRequest</a> object in its payload. From the <code class="literal">TaskLaunchRequest</code> object the <code class="literal">task-launcher</code> will obtain the URI of the artifact to be launched as well as the environment properties, command line arguments, deployment properties and application name to be used by the task.</p><p>The <a class="link" href="https://github.com/spring-cloud-stream-app-starters/tasklauncher-local/blob/v1.2.0.RELEASE/spring-cloud-starter-stream-sink-task-launcher-local/README.adoc" target="_top">task-launcher-local</a> can be added to the available sinks by executing the app register command as follows (for the Rabbit Binder):</p><pre class="screen">app register --name task-launcher-local --type sink --uri maven://org.springframework.cloud.stream.app:task-launcher-local-sink-rabbit:jar:1.2.0.RELEASE</pre><p>In the case of a maven based task that is to be launched, the <code class="literal">task-launcher</code> application is responsible for downloading the artifact.  You <span class="strong"><strong>must</strong></span> configure the <code class="literal">task-launcher</code> with the appropriate configuration of <a class="link" href="https://github.com/spring-cloud/spring-cloud-deployer/blob/master/spring-cloud-deployer-resource-maven/src/main/java/org/springframework/cloud/deployer/resource/maven/MavenProperties.java" target="_top">Maven Properties</a> such as <code class="literal">--maven.remote-repositories.repo1.url=http://repo.spring.io/libs-milestone"</code> to resolve artifacts, in this case against a milestone repo.  Note that this repo can be different than the one used to register the <code class="literal">task-launcher</code> application itself.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_triggertask" href="#_triggertask"></a>40.1&nbsp;TriggerTask</h2></div></div></div><p>One way to launch a task using the <code class="literal">task-launcher</code> is to use the <a class="link" href="https://github.com/spring-cloud-stream-app-starters/triggertask/blob/v1.2.0.RELEASE/spring-cloud-starter-stream-source-triggertask/README.adoc" target="_top">triggertask</a> source. The <code class="literal">triggertask</code> source
will emit a message with a <code class="literal">TaskLaunchRequest</code> object containing the required launch information.
The <code class="literal">triggertask</code> can be added to the available sources by executing the app register command as follows (for the Rabbit Binder):</p><pre class="screen">app register --type source --name triggertask --uri maven://org.springframework.cloud.stream.app:triggertask-source-rabbit:1.2.0.RELEASE</pre><p>An example of this would be to launch the timestamp task once every 60 seconds, the stream to implement this would look like:</p><pre class="screen">stream create foo --definition "triggertask --triggertask.uri=maven://org.springframework.cloud.task.app:timestamp-task:jar:1.2.0.RELEASE --trigger.fixed-delay=60 --triggertask.environment-properties=spring.datasource.url=jdbc:h2:tcp://localhost:19092/mem:dataflow,spring.datasource.username=sa | task-launcher-local --maven.remote-repositories.repo1.url=http://repo.spring.io/libs-release" --deploy</pre><p>If you execute <code class="literal">runtime apps</code> you can find the log file for the task launcher sink. Tailing that file you can find the log file for the launched tasks. The setting of <code class="literal">triggertask.environment-properties</code> is so that all the task executions can be collected in the same H2 database used in the local version of the Data Flow Server.  You can then see the list of task executions using the shell command <code class="literal">task execution list</code></p><pre class="screen">dataflow:&gt;task execution list
&#9556;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9572;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9559;
&#9553;     Task Name      &#9474;ID&#9474;         Start Time         &#9474;          End Time          &#9474;Exit Code&#9553;
&#9568;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9578;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9571;
&#9553;timestamp-task_26176&#9474;4 &#9474;Tue May 02 12:13:49 EDT 2017&#9474;Tue May 02 12:13:49 EDT 2017&#9474;0        &#9553;
&#9553;timestamp-task_32996&#9474;3 &#9474;Tue May 02 12:12:49 EDT 2017&#9474;Tue May 02 12:12:49 EDT 2017&#9474;0        &#9553;
&#9553;timestamp-task_58971&#9474;2 &#9474;Tue May 02 12:11:50 EDT 2017&#9474;Tue May 02 12:11:50 EDT 2017&#9474;0        &#9553;
&#9553;timestamp-task_13467&#9474;1 &#9474;Tue May 02 12:10:50 EDT 2017&#9474;Tue May 02 12:10:50 EDT 2017&#9474;0        &#9553;
&#9562;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9575;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9552;&#9565;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_tasklaunchrequest_transform" href="#_tasklaunchrequest_transform"></a>40.2&nbsp;TaskLaunchRequest-transform</h2></div></div></div><p>Another option to start a task using the <code class="literal">task-launcher</code> would be to create a stream using the
<a class="link" href="https://github.com/spring-cloud-stream-app-starters/tasklaunchrequest-transform" target="_top">Tasklaunchrequest-transform</a> processor to translate a message payload to a <code class="literal">TaskLaunchRequest</code>.</p><p>The <code class="literal">tasklaunchrequest-transform</code> can be added to the available processors by executing the app register command as follows (for the Rabbit Binder):</p><pre class="screen">app register --type processor --name tasklaunchrequest-transform --uri maven://org.springframework.cloud.stream.app:tasklaunchrequest-transform-processor-rabbit:1.2.0.RELEASE</pre><p>For example:</p><pre class="screen">stream create task-stream --definition "http --port=9000 | tasklaunchrequest-transform --uri=maven://org.springframework.cloud.task.app:timestamp-task:jar:1.2.0.RELEASE | task-launcher-local --maven.remote-repositories.repo1.url=http://repo.spring.io/libs-release"</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring-cloud-dataflow-task-events.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-cloud-task.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-dataflow-composed-tasks.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">39.&nbsp;Subscribing to Task/Batch Events&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;41.&nbsp;Composed Tasks</td></tr></table></div></body></html>