<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>16.&nbsp;Register a Stream App</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Cloud Data Flow Server for Apache Mesos"><link rel="up" href="streams.html" title="Part&nbsp;IV.&nbsp;Streams"><link rel="prev" href="_stream_dsl.html" title="15.&nbsp;Stream DSL"><link rel="next" href="spring-cloud-dataflow-create-stream.html" title="17.&nbsp;Creating a Stream"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.&nbsp;Register a Stream App</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="_stream_dsl.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;Streams</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-dataflow-create-stream.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="spring-cloud-dataflow-register-apps" href="#spring-cloud-dataflow-register-apps"></a>16.&nbsp;Register a Stream App</h2></div></div></div><p>Register a Stream App with the App Registry using the Spring Cloud Data Flow Shell
<code class="literal">app register</code> command. You must provide a unique name, application type, and a URI that can be
resolved to the app artifact. For the type, specify "source", "processor", or "sink".
Here are a few examples:</p><pre class="screen">dataflow:&gt;app register --name mysource --type source --uri maven://com.example:mysource:0.0.1-SNAPSHOT

dataflow:&gt;app register --name myprocessor --type processor --uri file:///Users/example/myprocessor-1.2.3.jar

dataflow:&gt;app register --name mysink --type sink --uri http://example.com/mysink-2.0.1.jar</pre><p>When providing a URI with the <code class="literal">maven</code> scheme, the format should conform to the following:</p><pre class="screen">maven://&lt;groupId&gt;:&lt;artifactId&gt;[:&lt;extension&gt;[:&lt;classifier&gt;]]:&lt;version&gt;</pre><p>For example, if you would like to register the snapshot versions of the <code class="literal">http</code> and <code class="literal">log</code>
applications built with the RabbitMQ binder, you could do the following:</p><pre class="screen">dataflow:&gt;app register --name http --type source --uri maven://org.springframework.cloud.stream.app:http-source-rabbit:1.0.0.BUILD-SNAPSHOT
dataflow:&gt;app register --name log --type sink --uri maven://org.springframework.cloud.stream.app:log-sink-rabbit:1.0.0.BUILD-SNAPSHOT</pre><p>If you would like to register multiple apps at one time, you can store them in a properties file
where the keys are formatted as <code class="literal">&lt;type&gt;.&lt;name&gt;</code> and the values are the URIs.</p><p>For example, if you would like to register the snapshot versions of the <code class="literal">http</code> and <code class="literal">log</code>
applications built with the RabbitMQ binder, you could have the following in a properties file [<span class="emphasis"><em>eg: stream-apps.properties</em></span>]:</p><pre class="screen">source.http=maven://org.springframework.cloud.stream.app:http-source-rabbit:1.0.0.BUILD-SNAPSHOT
sink.log=maven://org.springframework.cloud.stream.app:log-sink-rabbit:1.0.0.BUILD-SNAPSHOT</pre><p>Then to import the apps in bulk, use the <code class="literal">app import</code> command and provide the location of the properties file via <code class="literal">--uri</code>:</p><pre class="screen">dataflow:&gt;app import --uri file:///&lt;YOUR_FILE_LOCATION&gt;/stream-apps.properties</pre><p>For convenience, we have the static files with application-URIs (for both maven and docker) available for all the out-of-the-box
Stream app-starters. You can point to this file and import all the application-URIs in bulk. Otherwise, as explained in
previous paragraphs, you can register them individually or have your own custom property file with only the required application-URIs
in it. It is recommended, however, to have a "focused" list of desired application-URIs in a custom property file.</p><p>List of available static property files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Maven based Stream Applications with RabbitMQ Binder: <a class="link" href="http://bit.ly/stream-applications-rabbit-maven" target="_top">bit.ly/stream-applications-rabbit-maven</a></li><li class="listitem">Maven based Stream Applications with Kafka Binder: <a class="link" href="http://bit.ly/stream-applications-kafka-maven" target="_top">bit.ly/stream-applications-kafka-maven</a></li><li class="listitem">Docker based Stream Applications with RabbitMQ Binder: <a class="link" href="http://bit.ly/stream-applications-rabbit-docker" target="_top">bit.ly/stream-applications-rabbit-docker</a></li><li class="listitem">Docker based Stream Applications with Kafka Binder: <a class="link" href="http://bit.ly/stream-applications-kafka-docker" target="_top">bit.ly/stream-applications-kafka-docker</a></li></ul></div><p>For example, if you would like to register all out-of-the-box stream applications built with the RabbitMQ binder in bulk, you can with
the following command.</p><pre class="screen">dataflow:&gt;app import --uri http://bit.ly/stream-applications-rabbit-maven</pre><p>You can also pass the <code class="literal">--local</code> option (which is TRUE by default) to indicate whether the
properties file location should be resolved within the shell process itself. If the location should
be resolved from the Data Flow Server process, specify <code class="literal">--local false</code>.</p><p>When using either <code class="literal">app register</code> or <code class="literal">app import</code>, if a stream app is already registered with
the provided name and type, it will not be overridden by default. If you would like to override the
pre-existing stream app, then include the <code class="literal">--force</code> option.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In some cases the Resource is resolved on the server side, whereas in others the
URI will be passed to a runtime container instance where it is resolved. Consult
the specific documentation of each Data Flow Server for more detail.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-cloud-dataflow-stream-app-whitelisting" href="#spring-cloud-dataflow-stream-app-whitelisting"></a>16.1&nbsp;Whitelisting application properties</h2></div></div></div><p>Stream applications are Spring Boot applications which are aware of many <a class="link" href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties" target="_top">common application properties</a>, e.g. <code class="literal">server.port</code> but also families of properties such as those with the prefix <code class="literal">spring.jmx</code> and <code class="literal">logging</code>.  When creating your own application it is desirable to whitelist properties so that the shell and the UI can display them first as primary properties when presenting options via TAB completion or in drop-down boxes.</p><p>To whitelist application properties create a file named <code class="literal">spring-configuration-metadata-whitelist.properties</code> in the <code class="literal">META-INF</code> resource directory.  There are two property keys that can be used inside this file. The first key is named <code class="literal">configuration-properties.classes</code>.  The value is a comma separated list of fully qualified <code class="literal">@ConfigurationProperty</code> class names.  The second key is <code class="literal">configuration-properties.names</code> whose value is a comma separated list of property names.  This can contain the full name of property, such as <code class="literal">server.port</code> or a partial name to whitelist a category of property names, e.g. <code class="literal">spring.jmx</code>.</p><p>The <a class="link" href="https://github.com/spring-cloud/spring-cloud-stream-app-starters" target="_top">Spring Cloud Stream application starters</a> are a good place to look for examples of usage.  Here is a simple example of the file source&#8217;s <code class="literal">spring-configuration-metadata-whitelist.properties</code> file</p><pre class="screen">configuration.classes=org.springframework.cloud.stream.app.file.sink.FileSinkProperties</pre><p>If for some reason we also wanted to add <code class="literal">file.prefix</code> to this file, it would look like</p><pre class="screen">configuration.classes=org.springframework.cloud.stream.app.file.sink.FileSinkProperties
configuration-properties.names=server.port</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>As of Spring Cloud Data Flow <code class="literal">1.0.0.RELEASE</code> the whitelisting of application properties
is only explicitly supported for Spring Boot <code class="literal">1.3.x</code> based application. Milestone releases
of the upcoming Spring Boot <code class="literal">1.4.0</code> release are not explicitly supported, yet.</p><p>The <code class="literal">spring-boot-maven-plugin</code> used in <code class="literal">1.4.x</code> has a different approach in handling
the nested archives inside the <code class="literal">jar</code>. As a result you will notice that the application properties
are not listed using <code class="literal">app info</code> command at all. As a temporary workaround, you can override the managed
version of your app&#8217;s <code class="literal">spring-boot-maven-plugin</code>
explicitly and revert to a version of the latest 1.3.x release:</p><p>For example, if your app&#8217;s <code class="literal">pom.xml</code> specifies to use Spring Boot <code class="literal">1.4.0.M3</code>:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;parent&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/artifactId&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;groupId&gt;</span>org.springframework.boot<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/groupId&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;version&gt;</span>1.4.0.M3<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/version&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;relativePath&gt;</span><span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/relativePath&gt;</span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/parent&gt;</span></pre><p>Then you can override the managed version of the <code class="literal">spring-boot-maven-plugin</code> with:</p><pre class="programlisting"><span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;plugin&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;groupId&gt;</span>org.springframework.boot<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/groupId&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/artifactId&gt;</span>
  <span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;version&gt;</span>1.3.5.RELEASE<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/version&gt;</span>  <a name="CO1-1" href="#CO1-1"></a><span><img src="images/callouts/1.png" alt="1" border="0"></span>
<span xmlns:d="http://docbook.org/ns/docbook" class="hl-tag">&lt;/plugin&gt;</span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/callouts/1.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left"><p>Overriding the managed version <code class="literal">1.4.0.M3</code>.</p></td></tr></table></div><p>Also, if you have your own <code class="literal">dataflow</code> server built using <code class="literal">@EnableDataflowServer</code> and using Spring Boot <code class="literal">1.4.x</code> in that,
you would need to explicitly override the <code class="literal">spring-boot-maven-plugin</code> with any of <code class="literal">1.3.x</code> releases.</p></td></tr></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_stream_dsl.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="streams.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="spring-cloud-dataflow-create-stream.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">15.&nbsp;Stream DSL&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;17.&nbsp;Creating a Stream</td></tr></table></div></body></html>