<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. Configuring JWS Client-Server Communication with WebSocket</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_jws_client_server_communication_with_websocket"/>Chapter 9. Configuring JWS Client-Server Communication with WebSocket</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="about_websocket"/>About WebSocket</h1></div></div></div><p>
				WebSocket is a web technology that provides bi-directional, full duplex messages to be instantly distributed between a client and server over a single TCP socket connection. A full duplex communication allows two-way communication simultaneously.
			</p><p>
				The container provides an implementation of the WebSockets 1.0 JSR 356 API. To use the API, you must run Java 7 or later, and configure the APR or NIO2 HTTP/1.1 connectors of the web container.
			</p><p>
				JSR 356 is the standard for WebSocket API for Java. Developers can use the JSR 356 API for creating WebSocket applications independent of the implementation. The WebSocket API is purely event driven.
			</p><p>
				Developers can use the JSR 356 Java API for WebSocket to integrate WebSockets in applications on the server side as well as on the client side. Tomcat 7 and 8 implement the WebSocket protocol, which adheres to JSR-356 standard.
			</p><p>
				A Java client uses a JSR 356-compliant client implementation to connect to a WebSocket server. For web clients, WebSocket JavaScript API can be used to communicate with WebSocket server. The only difference between a WebSocket client and a WebSocket server is the method in which they are connected. A WebSocket client is a WebSocket point from which the connection to a peer originates. A WebSocket server is WebSocket endpoint which is already published and awaits connections from peers.
			</p><p>
				Some examples where WebSocket can be used include banking, chat, multiplayer, and social networking applications.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="implementing_websocket_on_tomcat"/>Implementing WebSocket on Tomcat</h1></div></div></div><p>
				Configuring WebSocket on Tomcat requires individual configuration of the following:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="configuring_jws_client_server_communication_with_websocket.html#websocket_config_write_timeout" title="Configuring Write Timeout">write timeout</a>
					</li><li class="listitem">
						<a class="link" href="configuring_jws_client_server_communication_with_websocket.html#websocket_config_incoming_binary" title="Configuring Incoming Binary Messages">incoming binary messages</a>
					</li><li class="listitem">
						<a class="link" href="configuring_jws_client_server_communication_with_websocket.html#websocket_config_incoming_text" title="Configuring Incoming Text Messages">incoming text messages</a>
					</li><li class="listitem">
						<a class="link" href="configuring_jws_client_server_communication_with_websocket.html#websocket_config_programmatic_deployment" title="Configuring Additional Programmatic Deployment">additional programmatic deployment</a>
					</li><li class="listitem">
						<a class="link" href="configuring_jws_client_server_communication_with_websocket.html#websocket_config_callbacks_asynchronous" title="Configuring Callbacks for Asynchronous Writes">callbacks for asynchronous writes</a>
					</li><li class="listitem">
						<a class="link" href="configuring_jws_client_server_communication_with_websocket.html#websocket_config_timeout_io" title="Configuring Timeout for IO Operations While Establishing the Connections">timeout for IO operations while establishing the connections</a>
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="websocket_config_write_timeout"/>Configuring Write Timeout</h2></div></div></div><p>
					You can change the write timeout in blocking mode by using the <code class="literal">org.apache.tomcat.websocket.BLOCKING_SEND_TIMEOUT</code> property. The property accepts values in milliseconds. The default value is <code class="literal">20000</code> (20 seconds).
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="websocket_config_incoming_binary"/>Configuring Incoming Binary Messages</h2></div></div></div><p>
					To configure incoming binary messages, <code class="literal">MessageHandler.Partial</code> must be defined. If <code class="literal">MessageHandler.Partial</code> is not defined, then incoming binary messages must be buffered so that the entire message is delivered in a single call to <code class="literal">MessageHandler.Whole</code>.
				</p><p>
					The default buffer size for binary messages is 8192 bytes. You can change the buffer size for a web application by changing the value of the servlet context initializing parameter <code class="literal">org.apache.tomcat.websocket.binaryBufferSize</code>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="websocket_config_incoming_text"/>Configuring Incoming Text Messages</h2></div></div></div><p>
					To configure incoming text messages, <code class="literal">MessageHandler.Partial</code> must be defined. If <code class="literal">MessageHandler.Partial</code> is not defined then incoming text messages must be buffered so that the entire message is delivered in a single call to <code class="literal">MessageHandler.Whole</code>.
				</p><p>
					The default buffer size for text messages is 8192 bytes. You can change the buffer size for a web application by changing the value of the servlet context initializing parameter <code class="literal">org.apache.tomcat.websocket.textBufferSize</code>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="websocket_config_programmatic_deployment"/>Configuring Additional Programmatic Deployment</h2></div></div></div><p>
					The Java WebSocket 1.0 specification does not allow programmatic deployment after the first endpoint has started a WebSocket handshake. However, Tomcat by default allows additional programmatic deployment. Additional programmatic deployment can be done by using the servlet context initialization parameter <code class="literal">org.apache.tomcat.websocket.noAddAfterHandshake</code>.
				</p><p>
					Set the system property <code class="literal">org.apache.tomcat.websocket.STRICT_SPEC_COMPLIANCE</code> to <code class="literal">true</code> to change the default setting.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="websocket_config_callbacks_asynchronous"/>Configuring Callbacks for Asynchronous Writes</h2></div></div></div><p>
					Callbacks for asynchronous writes need to be performed on a different thread to the thread that initiated the write. The container thread pool is not exposed via the Servlet API. Thus the WebSocket implementation has to provide its own thread pool.
				</p><p>
					The following servlet context initialization parameters control the thread pool:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">org.apache.tomcat.websocket.executorCoreSize</code> </span></dt><dd>
								The core size of the executor thread pool. If not set, the default of <code class="literal">0</code> (zero) is used.
							</dd><dt><span class="term"><code class="literal">org.apache.tomcat.websocket.executorMaxSize</code> </span></dt><dd>
								The maximum permitted size of the executor thread pool. If not set, the default of <code class="literal">10</code> is used.
							</dd><dt><span class="term"><code class="literal">org.apache.tomcat.websocket.executorKeepAliveTimeSeconds</code> </span></dt><dd>
								The maximum time an idle thread will remain in the executor thread pool until it is terminated. If not specified, the default of <code class="literal">60</code> seconds is used.
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="websocket_config_timeout_io"/>Configuring Timeout for IO Operations While Establishing the Connections</h2></div></div></div><p>
					The timeout for IO operations while establishing the connections is controlled by the <code class="literal">userProperties</code> of the provided <code class="literal">javax.websocket.ClientEndpointConfig</code>. You can change timeout by changing the <code class="literal">org.apache.tomcat.websocket.IO_TIMEOUT_MS</code> property. The property accepts the values in milliseconds. The default value is <code class="literal">5000</code> (5 seconds).
				</p><p>
					To connect a WebSocket client to secure server endpoints, the client SSL configuration is controlled by the <code class="literal">userProperties</code> of the provided <code class="literal">javax.websocket.ClientEndpointConfig</code>.
				</p><p>
					The following user properties are supported:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">org.apache.tomcat.websocket.SSL_CONTEXT</code>
						</li><li class="listitem">
							<code class="literal">org.apache.tomcat.websocket.SSL_PROTOCOLS</code>
						</li><li class="listitem">
							<code class="literal">org.apache.tomcat.websocket.SSL_TRUSTSTORE</code>
						</li><li class="listitem">
							<code class="literal">org.apache.tomcat.websocket.SSL_TRUSTSTORE_PWD</code>
						</li></ul></div><p>
					The default truststore password is <code class="literal">changeit</code>. The <code class="literal">org.apache.tomcat.websocket.SSL_TRUSTSTORE</code> and <code class="literal">org.apache.tomcat.websocket.SSL_TRUSTSTORE_PWD</code> properties are ignored if the <code class="literal">org.apache.tomcat.websocket.SSL_CONTEXT</code> property is set.
				</p></div></div></div></body></html>