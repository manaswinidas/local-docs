<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 7. Monitoring JBoss Web Server with JBoss Operations Network (ON)</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="monitoring_jboss_web_server_with_jboss_operations_network_on"/>Chapter 7. Monitoring JBoss Web Server with JBoss Operations Network (ON)</h1></div></div></div><p>
			JBoss Web Server can be monitored and managed by Red Hat JBoss Operations Network (JBoss ON).
		</p><p>
			To monitor JBoss Web Server using JBoss ON, you must install the <span class="emphasis"><em>Web Server Plugin Pack</em></span> on your JBoss ON server, and then configure Tomcat in JBoss Web Server to be monitored.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="downloading_the_web_server_plugin_pack_for_jboss_on"/>Downloading the Web Server Plugin Pack for JBoss ON</h1></div></div></div><p>
				To monitor JBoss Web Server using JBoss ON, you must first download and install the <span class="emphasis"><em>Web Server Plugin Pack</em></span> on your JBoss ON server.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						Open a web browser, and log in to the Red Hat Customer Portal: <a class="link" href="http://access.redhat.com">http://access.redhat.com</a>.
					</li><li class="listitem">
						Click <span class="strong"><strong>Downloads</strong></span>.
					</li><li class="listitem">
						Click <span class="strong"><strong>Red Hat JBoss Web Server</strong></span> in the <span class="strong"><strong>Product Downloads</strong></span> list.
					</li><li class="listitem">
						Select <span class="strong"><strong>JBoss ON for Web Server</strong></span> in the <span class="strong"><strong>Product</strong></span> drop-down menu.
					</li><li class="listitem">
						Find <span class="strong"><strong>Web Server Plugin Pack for Red Hat JBoss Operations Network</strong></span> in the list and click <span class="strong"><strong>Download</strong></span>.
					</li></ol></div><p>
				Consult the JBoss ON documentation for instructions on installing the plugin on your JBoss ON server.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_tomcat_for_jboss_on_monitoring"/>Configuring Tomcat for JBoss ON Monitoring</h1></div></div></div><p>
				To allow JBoss ON to monitor Tomcat in JBoss Web Server, you must configure Tomcat to allow JBoss ON discovery, as well as providing JBoss ON the required access.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					For Microsoft Windows, skip this step and proceed to <a class="link" href="monitoring_jboss_web_server_with_jboss_operations_network_on.html#configuring_tomcat_jon_monitoring" title="Configuring Tomcat for JBoss ON Monitoring">Configuring Tomcat for JBoss ON Monitoring</a>
				</p></div><p>
				The JBoss ON agent requires read and write permission to the Tomcat directories. As a user with root privileges, run the following command to add the user which runs the JBoss ON Agent to the <code class="literal">tomcat</code> group:
			</p><pre class="screen"># usermod -aG tomcat <span class="emphasis"><em>&lt;JBOSSON_AGENT_USER&gt;</em></span></pre><p><a id="configuring_tomcat_jon_monitoring"/></p><div class="title"><strong>Configuring Tomcat for JBoss ON Monitoring</strong></div><p>
					JBoss Web Server instances are auto-discovered on Linux and Unix platforms. However, you need to configure the instance’s JMX to allow for proper handling of authentication and accurate Tomcat monitoring.
				</p><p>
				To configure JMX to handle authentication:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Open the <code class="literal">startup</code> or the <code class="literal">setenv</code> file of the respective JBoss Web Server instance for editing:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								On Red Hat Enterprise Linux installed from a ZIP file, open <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>/bin/setenv.sh</code>.
							</li><li class="listitem">
								On Red Hat Enterprise Linux installed from RPMs, open <code class="literal">/usr/sbin/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span></code>.
							</li><li class="listitem">
								On Microsoft Windows open <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>\share\tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>\bin\setenv.bat</code>.
							</li><li class="listitem">
								On Solaris using <code class="literal">daemon.sh</code> to start Tomcat, open <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>/bin/setenv.sh</code>.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Define an available port for JMX monitoring. Ensure the port is not blocked by any firewall.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								On Red Hat Enterprise Linux and Solaris:
							</p><pre class="screen">JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.port=<span class="emphasis"><em>PORT_NUMBER</em></span> -Djava.rmi.server.hostname=<span class="emphasis"><em>IP_ADDRESS</em></span>"</pre></li><li class="listitem"><p class="simpara">
								On Microsoft Windows:
							</p><pre class="screen">set "JAVA_OPTS=%JAVA_OPTS% -Dcom.sun.management.jmxremote.port=<span class="emphasis"><em>PORT_NUMBER</em></span> -Djava.rmi.server.hostname=<span class="emphasis"><em>IP_ADDRESS</em></span>"</pre></li></ul></div></li><li class="listitem"><p class="simpara">
						In production environments, add the following lines to the JAVA_OPTS variable in the startup file to secure JMX with SSL, and restrict the access with a firewall:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								On Red Hat Enterprise Linux and Solaris:
							</p><pre class="screen">JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.access.file=<span class="emphasis"><em>JWS_HOME</em></span>/jmxremote.access"
JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.password.file=<span class="emphasis"><em>JWS_HOME</em></span>/jmxremote.password"</pre></li><li class="listitem"><p class="simpara">
								On Microsoft Windows:
							</p><pre class="screen">set "JAVA_OPTS=%JAVA_OPTS% -Dcom.sun.management.jmxremote.access.file=<span class="emphasis"><em>JWS_HOME</em></span>\jmxremote.access"
set "JAVA_OPTS=%JAVA_OPTS% -Dcom.sun.management.jmxremote.password.file=<span class="emphasis"><em>JWS_HOME</em></span>\jmxremote.password"</pre></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							If you want to disable authentication and SSL for development purposes, add the following lines to the JAVA_OPTS variable in the startup file:
						</p><pre class="screen">JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.ssl=false"
JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.authenticate=false"</pre></div></li><li class="listitem"><p class="simpara">
						Once the Tomcat server resource is discovered and imported into the JBoss ON inventory, it may be necessary to update the new resource’s connection settings.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								In the JBoss ON interface, <span class="strong"><strong>Connection Settings</strong></span> for the newly imported Tomcat server resource.
							</li><li class="listitem"><p class="simpara">
								Verify the value of the <span class="strong"><strong>Manager URL</strong></span> property to the RMI URL, to ensure it uses the correct JMX host name and port number as defined in the Tomcat server startup file. An example for this value is shown below:
							</p><pre class="screen">service:jmx:rmi:///jndi/rmi://$IP_ADDRESS:$PORT/jmxrmi</pre></li></ol></div></li></ol></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_jboss_on_monitoring_for_tomcat_installed_from_rpms"/>Configuring JBoss ON Monitoring for Tomcat Installed from RPMs</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							In a shell prompt become the root user.
						</li><li class="listitem"><p class="simpara">
							Configure the JMX JAVA_OPTS properties in the <code class="literal">/usr/sbin/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span></code> file in the <code class="literal">start</code> and <code class="literal">start-security</code> sections.
						</p><pre class="screen">if [ "$1" = "start" ]; then
JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.port=8100 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=true -Dcom.sun.management.jmxr
emote.access.file="/etc/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>/jmxremote.access" -Dcom.sun.management.jmxremote.password.file="/etc/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>/jmxremote.password""

  ${JAVACMD} $JAVA_OPTS $LOGGING_CONFIG $CATALINA_OPTS \
    -classpath "$CLASSPATH" \
    -Dcatalina.base="$CATALINA_BASE" \
    -Dcatalina.home="$CATALINA_HOME" \
    -Djava.endorsed.dirs="$JAVA_ENDORSED_DIRS" \
    -Djava.io.tmpdir="$CATALINA_TMPDIR" \
    org.apache.catalina.startup.Bootstrap start \
     &gt;&gt; ${CATALINA_BASE}/logs/catalina.out 2&gt;&amp;1 &amp;
    if [ ! -z "$CATALINA_PID" ]; then
      echo $! &gt; $CATALINA_PID
    fi
elif [ "$1" = "start-security" ]; then
JAVA_OPTS="${JAVA_OPTS} -Dcom.sun.management.jmxremote.port=8100 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=true -Dcom.sun.management.jmxr
emote.access.file="/etc/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>/jmxremote.access" -Dcom.sun.management.jmxremote.password.file="/etc/tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>/jmxremote.password""

  ${JAVACMD} $JAVA_OPTS $LOGGING_CONFIG $CATALINA_OPTS \
    -classpath "$CLASSPATH" \
    -Dcatalina.base="$CATALINA_BASE" \</pre></li><li class="listitem"><p class="simpara">
							Run the following command to start Tomcat:
						</p><pre class="screen">service tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span> start</pre></li><li class="listitem">
							Start the JBoss ON agent.
						</li><li class="listitem">
							In the JBoss ON Web UI, import the JBoss ON agent and Tomcat.
						</li><li class="listitem">
							In the JBoss ON Web UI, setup the Tomcat connection configuration (principal and credentials).
						</li><li class="listitem"><p class="simpara">
							In the JBoss ON Web UI, set the <span class="strong"><strong>Tomcat Control</strong></span> method configuration to <span class="strong"><strong>RPM System V init script</strong></span>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The <span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>Shutdown</strong></span> script may not be set because the Tomcat plugin always runs the <code class="literal">service tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span> start/stop</code> command for the <span class="strong"><strong>RPM System V init script</strong></span> configuration setting.
							</p></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_jboss_on_monitoring_for_tomcat_installed_as_a_windows_service"/>Configuring JBoss ON Monitoring for Tomcat Installed as a Windows Service</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Create the <code class="literal">jmxremote.access</code> file with <code class="literal">controlRole readwrite</code> in the <code class="literal">C:\jmx</code> directory.
						</li><li class="listitem"><p class="simpara">
							Create the <code class="literal">jmxremote.password</code> file with <code class="literal">controlRole pwd</code> in the <code class="literal">C:\jmx</code> directory.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Set the owner of <code class="literal">jmxremote.access</code> and <code class="literal">jmxremote.password</code> to SYSTEM, and restrict the access of <code class="literal">jmxremote.password</code> only to SYSTEM. The SYSTEM user must only have read access.
							</p></div></li><li class="listitem"><p class="simpara">
							Enable JMX for the Tomcat Windows service:
						</p><pre class="screen"><span class="emphasis"><em>JWS_HOME</em></span>\sbin\tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span>.exe //US//Tomcat<span class="emphasis"><em>&lt;VERSION&gt;</em></span> ++JvmOptions="-Dcom.sun.management.jmxremote.port=8100;-Dcom.sun.management.jmxremote.access.file="C:\jmx\jmxremote.access";-Dcom.sun.management.jmxremote.password.file="C:\jmx\jmxremote.password";-Dcom.sun.management.jmxremote.ssl=false;-Dcom.sun.management.jmxremote.authenticate=true"</pre></li><li class="listitem">
							Start the Tomcat Windows service, and verify that it is running.
						</li><li class="listitem">
							Install and configure the JBoss ON agent. Type <code class="literal">discovery</code> in the agent prompt to discover the Tomcat Windows service.
						</li><li class="listitem">
							In the JBoss ON Web UI, click <span class="strong"><strong>Inventory</strong></span>, then click <span class="strong"><strong>Discovery Queue</strong></span>, and select <span class="strong"><strong>import Tomcat and RHQ agent</strong></span>.
						</li><li class="listitem">
							In the JBoss ON Web UI, go to <span class="strong"><strong>Platforms</strong></span> and search for the agent name. Click on your agent.
						</li><li class="listitem">
							On the <span class="strong"><strong>Agent</strong></span> page, Tomcat Servers are listed. Select your Tomcat server by clicking it.
						</li><li class="listitem">
							In the JBoss ON Web UI, click on the <span class="strong"><strong>Inventory</strong></span> tab and then configure the Tomcat Server in <span class="strong"><strong>Connection Settings</strong></span>.
						</li><li class="listitem">
							Enter the Principal and Credentials information. Use the <code class="literal">controlRole</code> and password set in the <code class="literal">jmxremote</code> files.
						</li><li class="listitem"><p class="simpara">
							Set the control method to <span class="strong"><strong>RPM System V init script</strong></span>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								You cannot set <span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>Shutdown</strong></span> script fields.
							</p></div></li><li class="listitem">
							Click <span class="strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Update the connection settings of the Tomcat Server JVM, and set Principal and Credentials.
						</li></ol></div></div></div></div></body></html>