<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 4. Reference</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="jws_on_openshift_reference"/>Chapter 4. Reference</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="source_to_image_s2i"/>Source-to-Image (S2I)</h1></div></div></div><p>
				The Red Hat JBoss Web Server for OpenShift image includes <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/3.7/html/creating_images/creating-images-s2i">S2I scripts</a> and Maven.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jws-artifact-repository-mirrors-section"/>Using maven artifact repository mirrors with JWS for OpenShift</h2></div></div></div><p>
					A Maven repository holds build artifacts and dependencies, such as the project jars, library jars, plugins or any other project specific artifacts. It also defines locations to download artifacts from while performing the S2I build. Along with using the <a class="link" href="https://maven.apache.org/repository/index.html">Maven Central Repository</a>, some organizations also deploy a local custom repository (mirror).
				</p><p>
					Benefits of using a local mirror are:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Availability of a synchronized mirror, which is geographically closer and faster.
						</li><li class="listitem">
							Greater control over the repository content.
						</li><li class="listitem">
							Possibility to share artifacts across different teams (developers, CI), without the need to rely on public servers and repositories.
						</li><li class="listitem">
							Improved build times.
						</li></ul></div><p>
					A <a class="link" href="https://maven.apache.org/repository-management.html">Maven repository manager</a> can serve as local cache to a mirror. Assuming that the repository manager is already deployed and reachable externally at <span class="strong"><strong><span class="emphasis"><em>http://10.0.0.1:8080/repository/internal/</em></span></strong></span>, the S2I build can use this repository. To use an internal Maven repository, add the <code class="literal">MAVEN_MIRROR_URL</code> environment variable to the build configuration of the application.
				</p><p>
					For a new build configuration, use the <code class="literal">--build-env</code> option with <code class="literal">oc new-app</code> or <code class="literal">oc new-build</code>:
				</p><pre class="screen">$ oc new-app \
 <a class="link" href="https://github.com/jboss-openshift/openshift-quickstarts.git#master">https://github.com/jboss-openshift/openshift-quickstarts.git#master</a> \
 --image-stream=jboss-webserver31-tomcat8-openshift \
 --context-dir='tomcat-websocket-chat' \
<span class="strong"><strong> --build-env <span class="strong"><strong><span class="emphasis"><em>MAVEN_MIRROR_URL</em></span></strong></span>=<span class="strong"><strong><span class="emphasis"><em>http://10.0.0.1:8080/repository/internal/</em></span></strong></span></strong></span> \
 --name=jws-wsch-app</pre><p>
					For an existing build configuration:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Identify the build configuration which requires the <code class="literal">MAVEN_MIRROR_URL</code> variable:
						</p><pre class="screen">$ <span class="strong"><strong>oc get bc -o name</strong></span>

buildconfig/jws</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">MAVEN_MIRROR_URL</code> environment variable to <code class="literal">buildconfig/jws</code>:
						</p><a id="adding-s2i-env-vars"/><pre class="screen">$ <span class="strong"><strong>oc env bc/jws MAVEN_MIRROR_URL="http://10.0.0.1:8080/repository/internal/"</strong></span>

buildconfig "jws" updated</pre></li><li class="listitem"><p class="simpara">
							Verify the build configuration has updated:
						</p><pre class="screen">$ <span class="strong"><strong>oc env bc/jws --list</strong></span>

# buildconfigs jws
MAVEN_MIRROR_URL=http://10.0.0.1:8080/repository/internal/</pre></li><li class="listitem">
							Schedule a new build of the application using <code class="literal">oc start-build</code>
						</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						During application build, Maven dependencies are download from the repository manager, instead of the default public repositories. Once the build has finished, the mirror contains all the dependencies retrieved and used during the build.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="scripts_included_on_the_red_hat_jboss_web_server_for_openshift_image"/>Scripts included on the Red Hat JBoss Web Server for OpenShift image</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">run</code></span></dt><dd>
								runs Catalina (Tomcat)
							</dd><dt><span class="term"><code class="literal">assemble</code></span></dt><dd>
								uses Maven to build the source, create package (<code class="literal">.war</code>) and move it to the <code class="literal">$JWS_HOME/webapps</code> directory.
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jws_for_openshift_compatible_environment_variables"/>JWS for OpenShift compatible environment variables</h2></div></div></div><p>
					The build configuration can be modified by including environment variables to the Source-to-Image <code class="literal">build</code> command (see <a class="xref" href="jws_on_openshift_reference.html#jws-artifact-repository-mirrors-section" title="Using maven artifact repository mirrors with JWS for OpenShift">the section called “Using maven artifact repository mirrors with JWS for OpenShift”</a>). The valid environment variables for the Red Hat JBoss Web Server for OpenShift images are:
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Variable Name</th><th style="text-align: left" valign="top">Description</th><th style="text-align: left" valign="top">Example Value :leveloffset: +3</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>ARTIFACT_DIR</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<code class="literal">.war</code>, <code class="literal">.ear</code>, and <code class="literal">.jar</code> files from this directory will be copied into the <code class="literal">deployments</code> directory.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>target</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>HTTP_PROXY_HOST</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Hostname or IP address of a HTTP proxy for Maven to use.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>192.168.1.1</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>HTTP_PROXY_PORT</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									TCP Port of a HTTP proxy for Maven to use.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>8080</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>HTTP_PROXY_USERNAME</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									If supplied with <code class="literal">HTTP_PROXY_PASSWORD</code>, use credentials for HTTP proxy.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>myusername</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>HTTP_PROXY_PASSWORD</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									If supplied with <code class="literal">HTTP_PROXY_USERNAME</code>, use credentials for HTTP proxy.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>mypassword</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>HTTP_PROXY_NONPROXYHOSTS</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									If supplied, a configured HTTP proxy will ignore these hosts (a comma-separated lists of hosts, IP addresses or domains).
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong>*<span class="emphasis"><em>.example.net,some.example.org</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>MAVEN_ARGS</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Overrides the arguments supplied to Maven during build.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>-e -Popenshift -DskipTests -Dcom.redhat.xpaas.repo.redhatga package</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>MAVEN_ARGS_APPEND</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Appends user arguments supplied to Maven during build.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>-Dfoo=bar</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>MAVEN_MIRROR_URL</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									URL of a Maven mirror/repository manager to configure.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>http://10.0.0.1:8080/repository/internal/</em></span></strong></span>
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>MAVEN_CLEAR_REPO</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Optionally clear the local Maven repository after the build.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								 <p>

								</p>
								 <p>
									:leveloffset: 3
								</p>
								 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="valves_on_jws_for_openshift"/>Valves on JWS for OpenShift</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jws_for_openshift_compatible_environmental_variables_valve_component"/>JWS for OpenShift compatible environmental variables (valve component)</h2></div></div></div><p>
					You can define the following environment variables to insert the valve component into the request processing pipeline for the associated Catalina container.
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/></colgroup><thead><tr><th style="text-align: left" valign="top">Variable Name</th><th style="text-align: left" valign="top">Description</th><th style="text-align: left" valign="top">Example Value</th><th style="text-align: left" valign="top">Default Value</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>ENABLE_ACCESS_LOG</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Enable the Access Log Valve to log access messages to the standard output channel.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>true</em></span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="emphasis"><em>false</em></span></strong></span>
								</p>
								 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="checking_logs"/>Checking Logs</h1></div></div></div><p>
				To view the OpenShift logs or the logs provided by a running container’s console:
			</p><pre class="screen">$ oc logs -f &lt;pod_name&gt; &lt;container_name&gt;</pre><p>
				Access logs are stored in <span class="strong"><strong><span class="emphasis"><em>/opt/webserver/logs/</em></span></strong></span>.
			</p></div></div></body></html>