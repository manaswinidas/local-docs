<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Get Started</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="jws_on_openshift_get_started"/>Chapter 3. Get Started</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="initial_setup"/>Initial setup</h1></div></div></div><p>
				The instructions in this guide follow on from the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_middleware_for_openshift/3/html/openshift_primer/">OpenShift Primer</a>, assuming a supported OpenShift configuration or a non-production OpenShift instance like that described in the OpenShift Primer.
			</p><p>
				The JWS for OpenShift images are <a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/3.7/html/installation_and_configuration/install-config-imagestreams-templates">automatically created during the installation</a> of OpenShift, along with the other default image streams and templates.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The JWS for OpenShift application templates are distributed for Tomcat 7, and Tomcat 8.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-jws-s2i-process"/>Using the JWS for OpenShift Source-to-Image (S2I) process</h1></div></div></div><p>
				To run and configure the JWS for OpenShift images, use the OpenShift S2I process with the application template parameters and environment variables.
			</p><p>
				The S2I process for the JWS for OpenShift images works as follows:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						If there is a Maven <span class="strong"><strong><span class="emphasis"><em>settings.xml</em></span></strong></span> file in the <code class="literal"><span class="strong"><strong><span class="emphasis"><em>configuration/</em></span></strong></span></code> source directory, it is moved to <code class="literal"><span class="strong"><strong><span class="emphasis"><em>$HOME/.m2/</em></span></strong></span></code> of the new image.
					</p><p class="simpara">
						See the <a class="link" href="https://maven.apache.org/settings.html">Apache Maven Project website</a> for more information on Maven and the Maven <span class="strong"><strong><span class="emphasis"><em>settings.xml</em></span></strong></span> file.
					</p></li><li class="listitem"><p class="simpara">
						If there is a <span class="strong"><strong><span class="emphasis"><em>pom.xml</em></span></strong></span> file in the source repository, a Maven build is triggered using the contents of the <code class="literal"><span class="strong"><strong>$MAVEN_ARGS</strong></span></code> environment variable.
					</p><p class="simpara">
						By default, the <code class="literal"><span class="emphasis"><em>package</em></span></code> goal is used with the <code class="literal"><span class="emphasis"><em>openshift</em></span></code> profile, including the arguments for skipping tests (<code class="literal"><span class="strong"><strong>-DskipTests</strong></span></code>) and enabling the Red Hat GA repository (<code class="literal"><span class="strong"><strong>-Dcom.redhat.xpaas.repo.redhatga</strong></span></code>).
					</p></li><li class="listitem"><p class="simpara">
						The results of a successful Maven build are copied to <code class="literal"><span class="strong"><strong><span class="emphasis"><em>/opt/webserver/webapps/</em></span></strong></span></code>. This includes all WAR files from the source directory specified by the <code class="literal"><span class="strong"><strong>$ARTIFACT_DIR</strong></span></code> environment variable. The default value of <code class="literal"><span class="strong"><strong>$ARTIFACT_DIR</strong></span></code> is the <code class="literal"><span class="strong"><strong><span class="emphasis"><em>target/</em></span></strong></span></code> directory.
					</p><p class="simpara">
						Use the <code class="literal"><span class="strong"><strong><span class="emphasis"><em>MAVEN_ARGS_APPEND</em></span></strong></span></code> environment variable to modify the Maven arguments.
					</p></li><li class="listitem">
						All WAR files from the <code class="literal"><span class="strong"><strong><span class="emphasis"><em>deployments/</em></span></strong></span></code> source directory are copied to <code class="literal"><span class="strong"><strong><span class="emphasis"><em>/opt/webserver/webapps/</em></span></strong></span></code>.
					</li><li class="listitem">
						All files in the <code class="literal"><span class="strong"><strong><span class="emphasis"><em>configuration/</em></span></strong></span></code> source directory are copied to <code class="literal"><span class="strong"><strong><span class="emphasis"><em>/opt/webserver/conf/</em></span></strong></span></code> (excluding the Maven <span class="strong"><strong><span class="emphasis"><em>settings.xml</em></span></strong></span> file).
					</li><li class="listitem"><p class="simpara">
						All files in the <code class="literal"><span class="strong"><strong><span class="emphasis"><em>lib/</em></span></strong></span></code> source directory are copied to <code class="literal"><span class="strong"><strong><span class="emphasis"><em>/opt/webserver/lib/</em></span></strong></span></code>.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							If you want to use custom Tomcat configuration files, the file names should be the same as for a normal Tomcat installation. For example, <span class="strong"><strong><span class="emphasis"><em>context.xml</em></span></strong></span> and <span class="strong"><strong><span class="emphasis"><em>server.xml</em></span></strong></span>.
						</p></div></li></ul></div><p>
				See the <a class="link" href="jws_on_openshift_reference.html#jws-artifact-repository-mirrors-section" title="Using maven artifact repository mirrors with JWS for OpenShift">Artifact Repository Mirrors</a> section for guidance on configuring the S2I process to use a custom Maven artifacts repository mirror.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create-an-OpenShift-application-using-existing-maven-binaries"/>Create a JWS for OpenShift application using existing maven binaries</h2></div></div></div><p>
					Existing applications are deployed on OpenShift using the <a class="link" href="https://docs.openshift.com/container-platform/latest/dev_guide/builds/build_inputs.html#binary-source"><code class="literal">oc start-build</code></a> command.
				</p><p>
					<span class="emphasis"><em>Prerequisite:</em></span> An existing <code class="literal">.war</code>, <code class="literal">.ear</code>, or <code class="literal">.jar</code> of the application to deploy on JWS for OpenShift.
				</p><div class="orderedlist"><a id="directory-structure-binary-builds"/><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Prepare the directory structure on the local file system.
						</p><p class="simpara">
							Create a source directory containing any content required by your application not included in the binary (if required, see <a class="link" href="jws_on_openshift_get_started.html#using-jws-s2i-process" title="Using the JWS for OpenShift Source-to-Image (S2I) process">Using the JWS for OpenShift Source-to-Image (S2I) process</a>), then create a subdirectory <code class="literal"><span class="strong"><strong>deployments/</strong></span></code>:
						</p><pre class="screen">$ mkdir -p <span class="emphasis"><em>&lt;build_dir&gt;</em></span>/deployments</pre></li><li class="listitem"><p class="simpara">
							Copy the binaries (<code class="literal">.war</code>,<code class="literal">.ear</code>,<code class="literal">.jar</code>) to <code class="literal"><span class="strong"><strong>deployments/</strong></span></code>:
						</p><pre class="screen">$ cp <span class="emphasis"><em>/path/to/binary/&lt;filenames_with_extensions&gt;</em></span> <span class="emphasis"><em>&lt;build_dir&gt;</em></span>/deployments/</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Application archives in the <code class="literal"><span class="strong"><strong>deployments/</strong></span></code> subdirectory of the source directory are copied to the <code class="literal"><span class="strong"><strong>$JWS_HOME/webapps/</strong></span></code> directory of the image being built on OpenShift. For the application to deploy, the directory hierarchy containing the web application data must be structured correctly (see <a class="xref" href="jws_on_openshift_get_started.html#using-jws-s2i-process" title="Using the JWS for OpenShift Source-to-Image (S2I) process">the section called “Using the JWS for OpenShift Source-to-Image (S2I) process”</a>).
							</p></div></li><li class="listitem"><p class="simpara">
							Log in to the OpenShift instance:
						</p><pre class="screen">$ oc login <span class="emphasis"><em>&lt;url&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
							Create a new project if required:
						</p><pre class="screen">$ oc new-project <span class="emphasis"><em>&lt;project-name&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
							Identify the JWS for OpenShift image stream to use for your application with <code class="literal">oc get is -n openshift</code>:
						</p><pre class="screen">$ <span class="strong"><strong>oc get is -n openshift | grep ^jboss-webserver | cut -f1 -d ' '</strong></span>

jboss-webserver30-tomcat7-openshift
jboss-webserver30-tomcat8-openshift
jboss-webserver31-tomcat7-openshift
jboss-webserver31-tomcat8-openshift</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The option <code class="literal">-n openshift</code> specifies the project to use. <code class="literal">oc get is -n openshift</code> retrieves (<code class="literal">get</code>) the image stream resources (<code class="literal">is</code>) from the <code class="literal">openshift</code> project.
							</p></div></li><li class="listitem"><p class="simpara">
							Create the new build configuration, specifying image stream and application name:
						</p><pre class="screen">$ oc new-build --binary=true \
 --image-stream=jboss-webserver31-tomcat8-openshift \
 --name=<span class="emphasis"><em>&lt;my-jws-on-openshift-app&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
							Instruct OpenShift to use the source directory created <a class="link" href="jws_on_openshift_get_started.html#directory-structure-binary-builds">previously</a> for binary input of the OpenShift image build:
						</p><pre class="screen">$ oc start-build <span class="emphasis"><em>&lt;my-jws-on-openshift-app&gt;</em></span> --from-dir=./<span class="emphasis"><em>&lt;build_dir&gt;</em></span> --follow</pre></li><li class="listitem"><p class="simpara">
							Create a new OpenShift application based on the image:
						</p><pre class="screen">$ oc new-app <span class="emphasis"><em>&lt;my-jws-on-openshift-app&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
							Expose the service to make the application accessible to users:
						</p><pre class="screen"># to check the name of the service to expose
$ <span class="strong"><strong>oc get svc -o name</strong></span>

service/<span class="emphasis"><em>&lt;my-jws-on-openshift-app&gt;</em></span>

# to expose the service
$ <span class="strong"><strong>oc expose svc/my-jws-on-openshift-app</strong></span>

route "my-jws-on-openshift-app" exposed</pre></li><li class="listitem"><p class="simpara">
							Retrieve the address of the exposed route:
						</p><pre class="screen">oc get routes --no-headers -o custom-columns='host:spec.host' my-jws-on-openshift-app</pre></li><li class="listitem">
							To access the application in your browser: <span class="strong"><strong>http://<span class="emphasis"><em>&lt;address_of_exposed_route&gt;</em></span> / <span class="emphasis"><em>&lt;my-war-ear-jar-filename-without-extension&gt;</em></span></strong></span>
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="example_creating_a_jws_for_openshift_application_using_existing_maven_binaries"/>Example: Creating a JWS for OpenShift application using existing maven binaries</h2></div></div></div><p>
					The example below uses the <a class="link" href="https://github.com/jboss-openshift/openshift-quickstarts/tree/master/tomcat-websocket-chat">tomcat-websocket-chat</a> quickstart using the procedure from <a class="xref" href="jws_on_openshift_get_started.html#Create-an-OpenShift-application-using-existing-maven-binaries" title="Create a JWS for OpenShift application using existing maven binaries">the section called “Create a JWS for OpenShift application using existing maven binaries”</a>.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="prerequisites"/>Prerequisites:</h3></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								<span class="strong"><strong>Get the WAR application archive or build the application locally.</strong></span>
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										Clone the source code:
									</p><pre class="screen">$ git clone <a class="link" href="https://github.com/jboss-openshift/openshift-quickstarts.git">https://github.com/jboss-openshift/openshift-quickstarts.git</a></pre></li><li class="listitem">
										<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html/development_guide/using_maven_with_eap#use_the_maven_repository">Configure</a> the <a class="link" href="https://access.redhat.com/maven-repository">Red Hat JBoss Middleware Maven repository</a>,
									</li><li class="listitem"><p class="simpara">
										Build the application:
									</p><pre class="screen">$ cd openshift-quickstarts/tomcat-websocket-chat/</pre><pre class="screen">$ <span class="strong"><strong>mvn clean package</strong></span>

[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Tomcat websocket example 1.2.0.Final
[INFO] ------------------------------------------------------------------------
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 01:28 min
[INFO] Finished at: 2018-01-16T15:59:16+10:00
[INFO] Final Memory: 19M/271M
[INFO] ------------------------------------------------------------------------</pre></li></ul></div></li></ol></div><div class="orderedlist"><a id="directory-structure-binary-builds-example"/><ol class="orderedlist"><li class="listitem"><p class="simpara">
								<span class="strong"><strong>Prepare the directory structure on the local file system.</strong></span>
							</p><p class="simpara">
								Create the source directory for the binary build on your local file system and the <code class="literal"><span class="strong"><strong>deployments/</strong></span></code> subdirectory. Copy the WAR archive to <code class="literal"><span class="strong"><strong>deployments/</strong></span></code>:
							</p><pre class="screen">[tomcat-websocket-chat]$ <span class="strong"><strong>ls</strong></span>

pom.xml  README.md  src/  target/</pre><pre class="screen">$ mkdir -p ocp/deployments</pre><pre class="screen">$ cp target/websocket-chat.war ocp/deployments/</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="to_setup_the_example_application_on_openshift"/>To setup the example application on OpenShift</h3></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Log in to the OpenShift instance:
							</p><pre class="screen">$ oc login <span class="emphasis"><em>&lt;url&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
								Create a new project if required:
							</p><pre class="screen">$ oc new-project jws-bin-demo</pre></li><li class="listitem"><p class="simpara">
								Identify the JWS for OpenShift image stream to use for your application with <code class="literal">oc get is -n openshift</code>:
							</p><pre class="screen">$ <span class="strong"><strong>oc get is -n openshift | grep ^jboss-webserver | cut -f1 -d ' '</strong></span>

jboss-webserver30-tomcat7-openshift
jboss-webserver30-tomcat8-openshift
jboss-webserver31-tomcat7-openshift
jboss-webserver31-tomcat8-openshift</pre></li><li class="listitem"><p class="simpara">
								Create new build configuration, specifying image stream and application name:
							</p><pre class="screen">$ <span class="strong"><strong>oc new-build --binary=true \</strong></span>
 <span class="strong"><strong>--image-stream=jboss-webserver31-tomcat8-openshift \</strong></span>
 <span class="strong"><strong>--name=jws-wsch-app</strong></span>

--&gt; Found image 8c3b85b (4 weeks old) in image stream "openshift/jboss-webserver31-tomcat8-openshift" under tag "latest" for "jboss-webserver31-tomcat8-openshift"

    JBoss Web Server 3.1
    --------------------
    Platform for building and running web applications on JBoss Web Server 3.1 - Tomcat v8

    Tags: builder, java, tomcat8

    * A source build using binary input will be created
      * The resulting image will be pushed to image stream "jws-wsch-app:latest"
      * A binary build was created, use 'start-build --from-dir' to trigger a new build

--&gt; Creating resources with label build=jws-wsch-app ...
    imagestream "jws-wsch-app" created
    buildconfig "jws-wsch-app" created
--&gt; Success</pre></li><li class="listitem"><p class="simpara">
								Start the binary build. Instruct OpenShift to use source directory for the binary input for the OpenShift image build:
							</p><pre class="screen">$ <span class="strong"><strong>oc start-build jws-wsch-app --from-dir=./ocp --follow</strong></span>

Uploading directory "ocp" as binary input for the build ...
build "jws-wsch-app-1" started
Receiving source from STDIN as archive ...

Copying all deployments war artifacts from /home/jboss/source/deployments directory into /opt/webserver/webapps for later deployment...
'/home/jboss/source/deployments/websocket-chat.war' -&gt; '/opt/webserver/webapps/websocket-chat.war'


Pushing image 172.30.202.111:5000/jws-bin-demo/jws-wsch-app:latest ...
Pushed 0/7 layers, 7% complete
Pushed 1/7 layers, 14% complete
Pushed 2/7 layers, 29% complete
Pushed 3/7 layers, 49% complete
Pushed 4/7 layers, 62% complete
Pushed 5/7 layers, 92% complete
Pushed 6/7 layers, 100% complete
Pushed 7/7 layers, 100% complete
Push successful</pre></li><li class="listitem"><p class="simpara">
								Create a new OpenShift application based on the image:
							</p><pre class="screen">$ <span class="strong"><strong>oc new-app jws-wsch-app</strong></span>

--&gt; Found image e5f3a6b (About a minute old) in image stream "jws-bin-demo/jws-wsch-app" under tag "latest" for "jws-wsch-app"

    JBoss Web Server 3.1
    --------------------
    Platform for building and running web applications on JBoss Web Server 3.1 - Tomcat v8

    Tags: builder, java, tomcat8

    * This image will be deployed in deployment config "jws-wsch-app"
    * Ports 8080/tcp, 8443/tcp, 8778/tcp will be load balanced by service "jws-wsch-app"
      * Other containers can access this service through the hostname "jws-wsch-app"

--&gt; Creating resources ...
    deploymentconfig "jws-wsch-app" created
    service "jws-wsch-app" created
--&gt; Success
    Application is not exposed. You can expose services to the outside world by executing one or more of the commands below:
     'oc expose svc/jws-wsch-app'
    Run 'oc status' to view your app.</pre></li><li class="listitem"><p class="simpara">
								Expose the service to make the application accessible to users:
							</p><pre class="screen"># to check the name of the service to expose
$ <span class="strong"><strong>oc get svc -o name</strong></span>

service/jws-wsch-app

# to expose the service
$ <span class="strong"><strong>oc expose svc/jws-wsch-app</strong></span>

route "jws-wsch-app" exposed</pre></li><li class="listitem"><p class="simpara">
								Retrieve the address of the exposed route:
							</p><pre class="screen">oc get routes --no-headers -o custom-columns='host:spec.host' jws-wsch-app</pre></li><li class="listitem">
								Access the application in your browser: <span class="strong"><strong>http://<span class="emphasis"><em>&lt;address_of_exposed_route&gt;</em></span>/websocket-chat</strong></span>
							</li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="create_a_jws_for_openshift_application_from_source_code"/>Create a JWS for OpenShift application from source code</h2></div></div></div><p>
					For detailed instructions on creating new OpenShift applications from source code, see <a class="link" href="https://docs.openshift.com/container-platform/latest/dev_guide/application_lifecycle/new_app.html#using-the-cli">OpenShift.com - Creating an Application From Source Code</a>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Before proceeding, ensure that the applications' data is structured correctly (see <a class="xref" href="jws_on_openshift_get_started.html#using-jws-s2i-process" title="Using the JWS for OpenShift Source-to-Image (S2I) process">the section called “Using the JWS for OpenShift Source-to-Image (S2I) process”</a>).
					</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Log in to the OpenShift instance:
						</p><pre class="screen">$ oc login <span class="emphasis"><em>&lt;url&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
							Create a new project if required:
						</p><pre class="screen">$ oc new-project <span class="emphasis"><em>&lt;project-name&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
							Identify the JWS for OpenShift image stream to use for your application with <code class="literal">oc get is -n openshift</code>:
						</p><pre class="screen">$ <span class="strong"><strong>oc get is -n openshift | grep ^jboss-webserver | cut -f1 -d ' '</strong></span>

jboss-webserver30-tomcat7-openshift
jboss-webserver30-tomcat8-openshift
jboss-webserver31-tomcat7-openshift
jboss-webserver31-tomcat8-openshift</pre></li><li class="listitem"><p class="simpara">
							Create the new OpenShift application from source code using Red Hat JBoss Web Server for OpenShift images, use the <code class="literal">--image-stream</code> option:
						</p><pre class="screen">$ oc new-app \
 <span class="emphasis"><em>&lt;source_code_location&gt;</em></span> \
 <span class="strong"><strong><span class="strong"><strong>--image-stream=jboss-webserver31-tomcat8-openshift </strong></span></strong></span>\
 --name=<span class="emphasis"><em>&lt;openshift_application_name&gt;</em></span></pre><p class="simpara">
							For Example:
						</p><pre class="screen">$ oc new-app \
 <a class="link" href="https://github.com/jboss-openshift/openshift-quickstarts.git#master">https://github.com/jboss-openshift/openshift-quickstarts.git#master</a> \
 <span class="strong"><strong><span class="strong"><strong>--image-stream=jboss-webserver31-tomcat8-openshift </strong></span></strong></span>\
 --context-dir='tomcat-websocket-chat' \
 --name=jws-wsch-app</pre><p class="simpara">
							The source code is added to the image and the source code is compiled. The build configuration and services are also created.
						</p></li><li class="listitem"><p class="simpara">
							To expose the application:
						</p><pre class="screen"># to check the name of the service to expose
$ <span class="strong"><strong>oc get svc -o name</strong></span>

service/<span class="emphasis"><em>&lt;openshift_application_name&gt;</em></span>

# to expose the service
$ <span class="strong"><strong>oc expose svc/<span class="emphasis"><em>&lt;openshift_application_name&gt;</em></span></strong></span>

route "<span class="emphasis"><em>&lt;openshift_application_name&gt;</em></span>" exposed</pre></li><li class="listitem"><p class="simpara">
							To retrieve the address of the exposed route:
						</p><pre class="screen">oc get routes --no-headers -o custom-columns='host:spec.host' <span class="emphasis"><em>&lt;openshift_application_name&gt;</em></span></pre></li><li class="listitem">
							To access the application in your browser: http://<span class="emphasis"><em>&lt;address_of_exposed_route&gt;</em></span>/<span class="strong"><strong><span class="emphasis"><em>&lt;java_application_name&gt;</em></span></strong></span>
						</li></ol></div></div></div></div></body></html>