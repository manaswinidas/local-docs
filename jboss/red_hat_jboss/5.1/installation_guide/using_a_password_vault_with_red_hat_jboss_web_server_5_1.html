<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 7. Using a Password Vault with Red Hat JBoss Web Server 5.1</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="using_a_password_vault_with_red_hat_jboss_web_server_5_1"/>Chapter 7. Using a Password Vault with Red Hat JBoss Web Server 5.1</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_password_vault_with_JWS"/>Using a Password Vault with Red Hat JBoss Web Server 5.1</h1></div></div></div><p>
				A password vault is used to mask passwords and other sensitive strings, and store them in an encrypted Java keystore. This allows you to eliminate storing clear-text passwords in your Tomcat configuration files, as Tomcat can lookup passwords and other sensitive strings from a keystore using the vault.
			</p><h3><a id="installing_the_jboss_web_server_password_vault_from_zip_archive"/>Installing the JBoss Web Server password vault from .zip archive</h3><p>
				The tomcat password vault is pre-installed by the <code class="literal">jws-application-server-5.1.0.zip</code> file. The password vault can be used once configured and is located at: <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/lib/tomcat-vault.jar</code>.
			</p><h3><a id="installing_the_jboss_web_server_password_vault_on_red_hat_enterprise_linux_using_the_yum_package_manager"/>Installing the JBoss Web Server password vault on Red Hat Enterprise Linux using the YUM package manager</h3><p>
				Where the JBoss Web Server has been installed from RPMs on Red Hat Enterprise Linux, install the password vault as the root user by executing:
			</p><pre class="screen">yum install jws5-tomcat-vault</pre><p>
				The examples and commands below use <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span></code> as the JBoss Web Server installation directory. Replace <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span></code> with the path to your JBoss Web Server installation. Also, the paths below use <code class="literal">/</code> for directory separators.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="enabling_the_password_vault"/>Enabling the Password Vault</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Stop Tomcat if it is running.
						</li><li class="listitem">
							Edit <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/conf/catalina.properties</code>, and add the following line:
						</li></ol></div><pre class="screen">org.apache.tomcat.util.digester.PROPERTY_SOURCE=org.apache.tomcat.vault.util.PropertySourceVault</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_java_keystore"/>Creating a Java Keystore</h2></div></div></div><p>
					To use a password vault, you must first create a Java keystore. You can do this using the <code class="literal">keytool -genseckey</code> command. For example:
				</p><pre class="screen">$ keytool -genseckey -keystore JWS_HOME/tomcat/vault.keystore -alias my_vault  -storetype jceks -keyalg AES -keysize 128 -storepass <span class="emphasis"><em>&lt;vault_password&gt;</em></span> -keypass <span class="emphasis"><em>&lt;vault_password&gt;</em></span> -validity 730</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						The values above are examples only. Replace them with values specific to your environment.
					</p></div><p>
					For an explanation of the parameters, use the <code class="literal">keytool -genseckey -help</code> command.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="storing_the_tomcat_vault_literal_vault_properties_literal_file_outside_of_the_jws_home_directory"/>Storing the tomcat-vault <code class="literal">vault.properties</code> file outside of the JWS_HOME directory</h2></div></div></div><p>
					The <code class="literal">vault.properties</code> file for the <code class="literal">tomcat-vault</code> can be stored outside of <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/conf/</code> in a <code class="literal"><span class="emphasis"><em>CATALINA_BASE</em></span>/conf/</code> directory (if set).
				</p><p>
					To set the <span class="emphasis"><em>CATALINA_BASE</em></span> directory, follow the instructions in the section '<span class="strong"><strong>Advanced Configuration - Multiple Tomcat Instances</strong></span>' in the <a class="link" href="https://tomcat.apache.org/tomcat-9.0-doc/RUNNING.txt">Running The Apache Tomcat 9.0 Servlet/JSP Container</a> document found on the Apache Tomcat Website.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The default location for <span class="emphasis"><em>CATALINA_BASE</em></span> is <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/</code> also known as <span class="emphasis"><em>CATALINA_HOME</em></span>.
					</p></div><p>
					For more information on setting <span class="emphasis"><em>CATALINA_BASE</em></span>, see:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="https://tomcat.apache.org/tomcat-9.0-doc/introduction.html#Directories_and_Files">Apache Tomcat 9: Introduction - Directories and Files</a>
						</li><li class="listitem">
							<a class="link" href="https://tomcat.apache.org/tomcat-9.0-doc/RUNNING.txt">Running The Apache Tomcat 9.0 Servlet/JSP Container: Advanced Configuration - Multiple Tomcat Instances</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="initializing_the_password_vault"/>Initializing the Password Vault</h2></div></div></div><p>
					The vault must be initialized before it can be used to store sensitive strings. This is done using the <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/bin/tomcat-vault.sh</code> vault script. For Microsoft Windows, the script is <code class="literal">tomcat-vault.bat</code>.
				</p><p>
					The script can be run interactively or non-interactively. Below is an example of an interactive execution of the script to initialize a password vault, with the values shown below using the example keystore from the previous step.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="initializing_the_vault_for_apache_tomcat_interactively"/>Initializing the Vault for Apache Tomcat interactively</h3></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							The values below are examples only. Replace them with values appropriate for your environment.
						</p></div><pre class="screen"># <span class="strong"><strong><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/bin/tomcat-vault.sh</strong></span>

WARNING JBOSS_HOME may be pointing to a different installation - unpredictable results may occur.

=========================================================================

  JBoss Vault

  JBOSS_HOME: JWS_HOME/tomcat

  JAVA: java

=========================================================================

**********************************
****  JBoss Vault  ***************
**********************************
Please enter a Digit::
0: Start Interactive Session
1: Remove Interactive Session
2: Exit

<span class="strong"><strong>0</strong></span>

Starting an interactive session
Enter directory to store encrypted files: <span class="strong"><strong><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/</strong></span>
Enter Keystore URL: <span class="strong"><strong><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/vault.keystore</strong></span>
Enter Keystore password: <span class="strong"><strong><span class="emphasis"><em>&lt;vault_password&gt;</em></span></strong></span>
Enter Keystore password again: <span class="strong"><strong><span class="emphasis"><em>&lt;vault_password&gt;</em></span></strong></span>
Values match
Enter 8 character salt: <span class="strong"><strong>1234abcd</strong></span>
Enter iteration count as a number (Eg: 44): <span class="strong"><strong>120</strong></span>
Enter Keystore Alias: <span class="strong"><strong>my_vault</strong></span>
Initializing Vault
Jun 16, 2018 10:24:27 AM org.apache.tomcat.vault.security.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in tomcat properties file:
********************************************
...
KEYSTORE_URL=JWS_HOME/tomcat/vault.keystore
KEYSTORE_PASSWORD=MASK-3CuP21KMHn7G6iH/A3YpM/
KEYSTORE_ALIAS=my_vault
SALT=1234abcd
ITERATION_COUNT=120
ENC_FILE_DIR=JWS_HOME/tomcat/
...
********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::
0: Store a secured attribute
1: Check whether a secured attribute exists
2: Exit

<span class="strong"><strong>2</strong></span></pre><p>
						Note the output for the Tomcat properties file, as you will need this to configure Tomcat to use the vault.
					</p><h5><a id="configuring_tomcat_to_use_the_password_vault"/>Configuring Tomcat to Use the Password Vault</h5><p>
						In <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/conf/</code>, create a file named <code class="literal">vault.properties</code> containing the vault configuration produced when initializing the vault. The values provided below use the example vault initialized in the previous steps.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							For <code class="literal">KEYSTORE_PASSWORD</code>, you must use the masked value that was generated when initializing the vault.
						</p></div><pre class="screen">KEYSTORE_URL=<span class="emphasis"><em>JWS_HOME</em></span>/tomcat/vault.keystore
KEYSTORE_PASSWORD=MASK-3CuP21KMHn7G6iH/A3YpM/
KEYSTORE_ALIAS=my_vault
SALT=1234abcd
ITERATION_COUNT=120
ENC_FILE_DIR=<span class="emphasis"><em>JWS_HOME</em></span>/tomcat/</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="initializing_the_vault_for_apache_tomcat_non_interactively_silent_setup"/>Initializing the Vault for Apache Tomcat non-interactively (silent setup)</h3></div></div></div><p>
						The Vault for Apache Tomcat can be created non-interactively by providing the required input as arguments to the <code class="literal">tomcat-vault.sh</code> script. The <code class="literal">vault.properties</code> file is also created as output of the <code class="literal">tomcat-vault.sh</code> script when the <code class="literal">-g, --generate-config</code> option is used.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							The values below are examples only. Replace them with values appropriate for your environment.
						</p></div><pre class="screen">$ <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/bin/tomcat-vault.sh \
 --keystore <span class="strong"><strong><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/vault.keystore</strong></span> \
 --keystore-password <span class="strong"><strong><span class="emphasis"><em>&lt;vault_password&gt;</em></span></strong></span> \
 --alias <span class="strong"><strong>my_vault</strong></span> \
 --enc-dir <span class="strong"><strong><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/</strong></span> \
 --iteration <span class="strong"><strong>120</strong></span> \
 --salt <span class="strong"><strong>1234abcd</strong></span> \
 --generate-config <span class="strong"><strong><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/conf/vault.properties</strong></span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="storing_a_sensitive_string_in_the_password_vault"/>Storing a Sensitive String in the Password Vault</h2></div></div></div><p>
					The vault script used in the previous steps is also used to store sensitive strings in the password vault. The script can be run interactively or non-interactively.
				</p><p>
					When adding a string to a password vault, the sensitive string needs a name that it will be referred by. For a password vault, this name is called an <code class="literal">attribute name</code>, and the password itself is called a <code class="literal">secured attribute</code>.
				</p><p>
					The example below demonstrates using the vault script non-interactively to store a password. It uses the vault that was initialized in the previous steps, and stores the sensitive string <code class="literal">P@SSW0#D</code> with the attribute name <code class="literal">manager_password</code>.
				</p><pre class="screen">$ <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/bin/tomcat-vault.sh --keystore <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/vault.keystore --keystore-password <span class="emphasis"><em>&lt;vault_password&gt;</em></span> --alias my_vault --enc-dir <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/ --iteration 120 --salt 1234abcd --vault-block my_block --attribute manager_password --sec-attr P@SSW0#D</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						You can optionally specify a vault block to store the password in. If you don’t specify a block, one will be automatically created for you. In the above example, my_block is used.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_a_stored_sensitive_string_in_your_tomcat_configuration"/>Using a Stored Sensitive String in Your Tomcat Configuration</h2></div></div></div><p>
					After storing a sensitive string in the password vault, you can refer to it in your configuration files by entering the stored string’s attribute as <code class="literal">${VAULT::block_name::attribute_name::}</code>.
				</p><p>
					For example, to use the password stored in the previous steps, replace:
				</p><pre class="programlisting">&lt;user username="manager" password="P@SSW0#D" roles="manager-gui"/&gt;</pre><p>
					with:
				</p><pre class="programlisting">&lt;user username="manager" password="${VAULT::my_block::manager_password::}" roles="manager-gui"/&gt;</pre><p>
					As a result, only a reference to the password is visible in the Tomcat configuration file, and the actual password is only stored in the password vault.
				</p></div></div></div></body></html>