<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 7. Enabling HTTP/2 for the Red Hat JBoss Web Server</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="enabling_http2_for_JBoss_Web_Server_jboss_web_server_installation_guide"/>Chapter 7. Enabling HTTP/2 for the Red Hat JBoss Web Server</h1></div></div></div><p>
			The Hypertext Transfer Protocols are standard methods of transmitting data between applications (such as servers and browsers) over the internet. HTTP/2 improves on HTTP/1.1 by providing enhancements such as:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					header compression - reducing the size of the header transmitted by omitting implied information, and
				</li><li class="listitem">
					multiple requests and responses over a single connection - using binary framing to break down response messages, as opposed to textual framing.
				</li></ul></div><p>
			Using HTTP/2 with the Red Hat JBoss Web Server:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					<span class="strong"><strong>is supported</strong></span> for encrypted connections over TLS (<code class="literal">h2</code>).
				</li><li class="listitem">
					<span class="strong"><strong>is not supported</strong></span> for unencrypted connections over TCP (<code class="literal">h2c</code>).
				</li></ul></div><h2><a id="prerequisites_5"/>Prerequisites</h2><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					Root user access (Red Hat Enterprise Linux and Solaris systems), or
				</li><li class="listitem">
					Administrative access (Windows Server).
				</li><li class="listitem">
					Red Hat JBoss Web Server 5.0 or higher
				</li><li class="listitem"><p class="simpara">
					The following operating system native libraries (provided by <code class="literal">jws-application-server-5.0.0-<span class="emphasis"><em>&lt;platform&gt;</em></span>-<span class="emphasis"><em>&lt;architecture&gt;</em></span>.zip</code> where available).
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Tomcat Native, for example:
						</p><pre class="screen">jws-5.0/tomcat/lib/libtcnative-1.so</pre></li><li class="listitem"><p class="simpara">
							Apache Portable Runtime (APR):
						</p><pre class="screen">jws-5.0/tomcat/lib/libapr-1.so.0.6.3</pre><p class="simpara">
							Where the APR libraries are provided by <code class="literal">jws-application-server-5.0.0-<span class="emphasis"><em>&lt;platform&gt;</em></span>-<span class="emphasis"><em>&lt;architecture&gt;</em></span>.zip</code> for Red Hat Enterprise Linux, the libraries will be a symbolic link to:
						</p><pre class="screen">jws-5.0/jbcs-apr-1.6.3/lib64/libapr-1.so.0.6.3</pre></li><li class="listitem"><p class="simpara">
							OpenSSL, for example:
						</p><pre class="screen">jws-5.0/tomcat/lib/libcrypto.so.1.0.2n
jws-5.0/tomcat/lib/libssl.so.1.0.2n</pre><p class="simpara">
							Where the OpenSSL libraries are provided by <code class="literal">jws-application-server-5.0.0-<span class="emphasis"><em>&lt;platform&gt;</em></span>-<span class="emphasis"><em>&lt;architecture&gt;</em></span>.zip</code> for Red Hat Enterprise Linux, the libraries will be symbolic links to:
						</p><pre class="screen">jws-5.0/jbcs-openssl-1.0.2n/openssl/lib64/libcrypto.so.1.0.2n
jws-5.0/jbcs-openssl-1.0.2n/openssl/lib64/libssl.so.1.0.2n</pre></li></ul></div></li><li class="listitem"><p class="simpara">
					A connector that supports the HTTP/2 protocol with SSL enabled. For JBoss Web Server 5.0, the connectors with HTTP/2 protocol support are:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The APR Native connector (APR)
						</li><li class="listitem">
							The NIO connector with JSSE + OpenSSL (JSSE)
						</li><li class="listitem">
							The NIO2 connector with JSSE + OpenSSL (JSSE)
						</li></ul></div></li></ul></div><h2><a id="procedure_3"/>Procedure</h2><p>
			Enable HTTP/2 for a connector:
		</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
					Add the HTTP/2 upgrade protocol (<code class="literal">&lt;UpgradeProtocol className="org.apache.coyote.http2.Http2Protocol" /&gt;</code>) to the connector in the server configuration <code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/conf/server.xml</code>.
				</p><p class="simpara">
					For example:
				</p><pre class="programlisting">&lt;Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"
           maxThreads="150" SSLEnabled="true"&gt;
    &lt;UpgradeProtocol className="org.apache.coyote.http2.Http2Protocol" /&gt;
    &lt;SSLHostConfig&gt;
        &lt;Certificate certificateKeystoreFile="/KeyStore.jks"
                     certificateKeystorePassword="changeit"
                     type="RSA" /&gt;
    &lt;/SSLHostConfig&gt;
&lt;/Connector&gt;</pre><p class="simpara">
					<code class="literal">server.xml</code> contains an example connector definition for the APR protocol with the upgrade protocol to HTTP/2:
				</p><pre class="programlisting">&lt;Connector port="8443"
           protocol="org.apache.coyote.http11.Http11AprProtocol"
           maxThreads="150" SSLEnabled="true" &gt;
    &lt;UpgradeProtocol className="org.apache.coyote.http2.Http2Protocol" /&gt;
    &lt;SSLHostConfig&gt;
        &lt;Certificate certificateKeyFile="conf/localhost-rsa-key.pem"
                     certificateFile="conf/localhost-rsa-cert.pem"
                     certificateChainFile="conf/localhost-rsa-chain.pem"
                     type="RSA" /&gt;
    &lt;/SSLHostConfig&gt;
&lt;/Connector&gt;</pre></li><li class="listitem"><p class="simpara">
					Restart the Red Hat JBoss Web Server as the root user, to apply the changed configuration.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							For SysV (Red Hat Enterprise Linux 6) users:
						</p><pre class="screen"># service jws5-tomcat restart</pre></li><li class="listitem"><p class="simpara">
							For systemd (Red Hat Enterprise Linux 7) users:
						</p><pre class="screen"># systemctl restart jws5-tomcat.service</pre></li><li class="listitem"><p class="simpara">
							For Red Hat Enterprise Linux users running Red Hat JBoss Web Server using <code class="literal">startup.sh</code>:
						</p><pre class="screen"># <span class="emphasis"><em>JWS_HOME</em></span>/sbin/shudown.sh
# <span class="emphasis"><em>JWS_HOME</em></span>/sbin/startup.sh</pre></li><li class="listitem"><p class="simpara">
							For Solaris users:
						</p><pre class="screen"># sh <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/bin/daemon.sh stop
# sh <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/bin/daemon.sh start</pre></li><li class="listitem"><p class="simpara">
							For Windows Server users:
						</p><pre class="screen"># net restart tomcat9</pre></li></ol></div></li></ol></div><h2><a id="next_steps_3"/>Next Steps</h2><p>
			Verify that HTTP/2 is enabled by reviewing the Red Hat JBoss Web Server logs or by using the <code class="literal">curl</code> command:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
					Check the console output log (<code class="literal"><span class="emphasis"><em>JWS_HOME</em></span>/tomcat/logs/catalina.out</code>) to verify that the "connector has been configured to support negotiation to [h2]":
				</p><pre class="screen">$ <span class="strong"><strong>cat <span class="emphasis"><em>JWS_HOME</em></span>/tomcat/logs/catalina.out | grep 'h2'</strong></span>

06-Apr-2018 04:49:26.201 INFO [main] <span class="strong"><strong>org.apache.coyote.http11.AbstractHttp11Protocol.configureUpgradeProtocol</strong></span> The ["https-openssl-apr-8443"] connector has been configured to support negotiation to <span class="strong"><strong>[h2]</strong></span> via ALPN</pre></li><li class="listitem"><p class="simpara">
					Or verify using <code class="literal">curl</code> (for versions of <code class="literal">curl</code> that support <code class="literal">HTTP2</code>):
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						To check <code class="literal">curl</code> for HTTP/2 support:
					</p><pre class="screen">$ <span class="strong"><strong>curl -V</strong></span>

curl 7.55.1 (x86_64-redhat-linux-gnu) ...
Release-Date: 2017-08-14
Protocols: dict file ftp ftps gopher http https ...
Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz TLS-SRP <span class="strong"><strong><span class="emphasis"><em>HTTP2</em></span></strong></span> UnixSockets HTTPS-proxy Metalink PSL</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							For example, when the HTTP/2 protocol is inactive:
						</p><pre class="screen">$ <span class="strong"><strong>curl -I http://<span class="emphasis"><em>&lt;JBoss_Web_Server&gt;</em></span>:8080/</strong></span>

HTTP/1.1 200
...</pre></li><li class="listitem"><p class="simpara">
							But if the HTTP/2 protocol is active, <code class="literal">curl</code> returns:
						</p><pre class="screen">$ <span class="strong"><strong>curl -I https://<span class="emphasis"><em>&lt;JBoss_Web_Server&gt;</em></span>:8443/</strong></span>

HTTP/2 200
...</pre><p class="simpara">
							Where <span class="strong"><strong><span class="emphasis"><em>&lt;JBoss_Web_Server&gt;</em></span></strong></span> is the URI of the modified connector (such as <code class="literal">example.com</code>), and the port number is dependent on your configuration.
						</p></li></ul></div></li></ul></div><h2><a id="additional_resources_4"/>Additional Resources</h2><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					For additional information on using HTTP/2, see: <a class="link" href="https://tomcat.apache.org/tomcat-9.0-doc/config/http.html#HTTP/2_Support">Apache Tomcat 9 Configuration Reference: The HTTP Connector - HTTP/2 Support</a>.
				</li><li class="listitem">
					For information on the HTTP/2 Upgrade Protocol and the supported attributes, see: <a class="link" href="https://tomcat.apache.org/tomcat-9.0-doc/config/http2.html">Apache Tomcat 9 Configuration Reference: The HTTP2 Upgrade Protocol</a>.
				</li><li class="listitem">
					The proposed internet standard for HTTP/2: <a class="link" href="https://www.rfc-editor.org/info/rfc7540">IETF: RFC 7540 - Hypertext Transfer Protocol Version 2 (HTTP/2)</a>
				</li></ul></div></div></body></html>