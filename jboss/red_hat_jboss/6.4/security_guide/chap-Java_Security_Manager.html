<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 2. Java Security Manager</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Java_Security_Manager">
      ⁠</a>Chapter 2. Java Security Manager</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_the_Java_Security_Manager">
      ⁠</a>2.1. About the Java Security Manager</h1></div></div></div><div class="para">
		The Java Security Manager is a class that manages the external boundary of the Java Virtual Machine (JVM) sandbox, controlling how code executing within the JVM can interact with resources outside the JVM. When the Java Security Manager is activated, the Java API checks with the security manager for approval before executing a wide range of potentially unsafe operations. The Java Security Manager uses a security policy to determine whether a given action will be allowed or denied.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4778-714990+%5BLatest%5D&amp;comment=Title%3A+About+the+Java+Security+Manager%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4778-714990+03+Oct+2014+00%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Java_Security_Manager_Policies">
      ⁠</a>2.2. About Java Security Policies</h1></div></div></div><div class="para">
		A Java Security policy is a set of defined permissions for different classes of code. The Java Security Manager compares actions requested by applications against the security policy. If an action is allowed by the policy, the Security Manager will permit that action to take place. If the action is not allowed by the policy, the Security Manager will deny that action. The security policy can define permissions based on the location of code, on the code's signature, or based on the subject's principals.
	</div><div class="para">
		You can create a security policy using the <code class="command">policytool</code> application, which is included with the Java Development Kit (JDK). A security policy entry consists of the following configuration elements, which are configurable using <code class="command">policytool</code>:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">CodeBase</span></dt><dd><div class="para">
					The URL location (excluding the host and domain information) where the code originates from. This parameter is optional.
				</div></dd><dt><span class="term">SignedBy</span></dt><dd><div class="para">
					The alias used in the keystore to reference the signer whose private key was used to sign the code. This can be a single value or a comma-separated list of values. This parameter is optional. If omitted, presence or lack of a signature has no impact on the Java Security Manager.
				</div></dd><dt><span class="term">Principals</span></dt><dd><div class="para">
					A list of <em class="parameter"><code>principal_type</code></em>/<em class="parameter"><code>principal_name</code></em> pairs, which must be present within the executing thread's principal set. The Principals entry is optional. If it is omitted, it signifies that the principals of the executing thread will have no impact on the Java Security Manager.
				</div></dd><dt><span class="term">Permissions</span></dt><dd><div class="para">
					A permission is the access which is granted to the code. Many permissions are provided as part of the Java Enterprise Edition 6 (Java EE 6) specification. 
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4781-748001+%5BLatest%5D&amp;comment=Title%3A+About+Java+Security+Policies%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4781-748001+20+Mar+2015+00%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Write_a_Java_Security_Manager_Policy1">
      ⁠</a>2.3. Write a Java Security Policy</h1></div></div></div><div class="para">
		An application called <code class="command">policytool</code> is included with most JDK and JRE distributions, for the purpose of creating and editing Java security policies. Detailed information about <code class="command">policytool</code> is linked from <a href="http://docs.oracle.com/javase/6/docs/technotes/tools/">http://docs.oracle.com/javase/6/docs/technotes/tools/</a>. Alternatively, you can also write a security policy using a text editor.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772535390672">
      ⁠</a><p class="title"><strong>Procedure 2.1. Setup a new Java Security Manager Policy</strong></p><ol class="1"><li class="step"><p class="title"><strong>Start <code class="command">policytool</code>.</strong></p><div class="para">
				Start the <code class="command">policytool</code> tool in one of the following ways.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Red Hat Enterprise Linux</strong></p><div class="para">
						From your GUI or a command prompt, run <code class="command">/usr/bin/policytool</code>.
					</div></li>
				 <li class="step"><p class="title"><strong>Microsoft Windows Server</strong></p><div class="para">
						Run <code class="command">policytool.exe</code> from your Start menu or from the <code class="filename">bin\</code> of your Java installation. The location can vary.
					</div></li>

			</ul></li><li class="step"><p class="title"><strong>Create a policy.</strong></p><div class="para">
				To create a policy, select <span class="guibutton"><strong>Add Policy Entry</strong></span>. Add the parameters you need, then click <span class="guibutton"><strong>Done</strong></span>.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Use VFS to specify paths for applications deployed on JBoss EAP. On Linux the path is: <code class="filename">vfs:/content/<em class="replaceable">application.war</em></code>. On Microsoft Windows it is: <code class="filename">vfs:/${user.dir}/content/<em class="replaceable">application.war</em></code> <code class="filename"/>.
				</div><div class="para">
					For example:
				</div><pre class="screen">grant codeBase "vfs:/content/application.war/-" {
permission java.util.PropertyPermission "*", "read";
};
</pre></div></div></li><li class="step"><p class="title"><strong>Edit an existing policy</strong></p><div class="para">
				Select the policy from the list of existing policies, and select the <span class="guibutton"><strong>Edit Policy Entry</strong></span> button. Edit the parameters as needed.
			</div></li><li class="step"><p class="title"><strong>Delete an existing policy.</strong></p><div class="para">
				Select the policy from the list of existing policies, and select the <span class="guibutton"><strong>Remove Policy Entry</strong></span> button.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4782-748002+%5BLatest%5D&amp;comment=Title%3A+Write+a+Java+Security+Policy%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4782-748002+20+Mar+2015+00%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Run_JBoss_Enterprise_Application_Platform_Within_the_Java_Security_Manager">
      ⁠</a>2.4. Run JBoss EAP 6 Within the Java Security Manager</h1></div></div></div><div class="para">
		From JBoss EAP 6.4 and onwards, running JBoss EAP 6 within the Java Security Manager (JSM) is done using the <code class="code">secmgr</code> option.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Direct usage of the <code class="code">-Djava.security.manager</code> Java system property is no longer possible. This previous method used in older versions of JBoss EAP 6 to enable the Java Security Manager is now only supported as a fallback mechanism in the JBoss EAP startup scripts.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			From JBoss EAP 6.4 and onwards, custom security managers cannot be used.
		</div></div></div><div class="para">
		The following procedure guides you through the steps of configuring your JBoss EAP 6 instance to run within the Java Security Manager using a specified security policy.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Before you follow this procedure, you need to write a security policy using the <code class="command">policytool</code> application which is included in the Java Development Kit (JDK). Alternatively, you can write a security policy using a text editor.
			</div><div class="para">
				Security policies will be needed for any user deployments that require permissions. This procedure assumes that your policy is located at <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/server.policy</code>.
			</div></li><li class="listitem"><div class="para">
				The domain or standalone server must be completely stopped before you edit any configuration files.
			</div></li></ul></div><div class="para">
		If you are using JBoss EAP 6 in a Managed Domain, you must perform the following procedure on each physical host or instance in your domain.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772526371216">
      ⁠</a><p class="title"><strong>Procedure 2.2. Configure the Java Security Manager for JBoss EAP 6</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the Configuration File</strong></p><div class="para">
				Open the configuration file for editing. The configuration file you need to edit depends on whether you use a Managed Domain or standalone server, as well as your operating system.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Managed Domain</strong></p><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								For Linux: <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/domain.conf</code>
							</div></li><li class="listitem"><div class="para">
								For Windows: <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\domain.conf.bat</code>
							</div></li></ul></div></li>
				 <li class="step"><p class="title"><strong>Standalone Server</strong></p><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								For Linux: <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/standalone.conf</code>
							</div></li><li class="listitem"><div class="para">
								For Windows: <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\standalone.conf.bat</code>
							</div></li></ul></div></li>

			</ul></li><li class="step"><p class="title"><strong>Enable the Java Security Manager</strong></p><div class="para">
				Use one of the methods below to enable the Java Security Manager:
			</div><ul class="stepalternatives">
				<li class="step"><div class="para">
						Use the <code class="code">-secmgr</code> option with your JBoss EAP 6 server startup script.
					</div></li>
				 <li class="step"><div class="para">
						Uncomment the <code class="literal">SECMGR="true"</code> line in the configuration file:
					</div><ul class="stepalternatives">
						<li class="step"><p class="title"><strong>On Linux:</strong></p><pre class="programlisting"># Uncomment this to run with a security manager enabled
SECMGR="true"</pre></li>
						 <li class="step"><p class="title"><strong>On Windows:</strong></p><pre class="programlisting">rem # Uncomment this to run with a security manager enabled
set "SECMGR=true"</pre></li>

					</ul></li>

			</ul></li><li class="step"><p class="title"><strong>Specify the Java Security Policy</strong></p><div class="para">
				You can use <code class="literal">-Djava.security.policy</code> to specify the exact location of your security policy. It should go onto one line only, with no line break. Using <code class="code">==</code> when setting <code class="literal">-Djava.security.policy</code> specifies that the security manager will use <span class="emphasis"><em>only</em></span> the specified policy file. Using <code class="code">=</code> specifies that the security manager will use the specified policy <span class="emphasis"><em>combined with</em></span> the policy set in the <code class="literal">policy.url</code> section of <code class="filename"><em class="replaceable">JAVA_HOME</em>/lib/security/java.security</code>.
			</div><div class="para">
				In your relevant JBoss EAP 6 configuration file, add your security policy Java options. If you are using a Managed Domain, ensure that this is inserted before where <code class="code">PROCESS_CONTROLLER_JAVA_OPTS</code> and <code class="code">HOST_CONTROLLER_JAVA_OPTS</code> are set.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>On Linux:</strong></p><pre class="programlisting">JAVA_OPTS="$JAVA_OPTS -Djava.security.policy==$JBOSS_HOME/bin/server.policy -Djboss.home.dir=$JBOSS_HOME"</pre></li>
				 <li class="step"><p class="title"><strong>On Windows:</strong></p><pre class="programlisting">set "JAVA_OPTS=%JAVA_OPTS% -Djava.security.policy==%JBOSS_HOME%\bin\server.policy -Djboss.home.dir=%JBOSS_HOME%"</pre></li>

			</ul></li><li class="step"><p class="title"><strong>Start the Domain or Server</strong></p><div class="para">
				Start the domain or server as normal.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4779-741909+%5BLatest%5D&amp;comment=Title%3A+Run+JBoss+EAP+6+Within+the+Java+Security+Manager%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4779-741909+07+Feb+2015+13%3A07+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="IBM_JRE_and_the_Java_Security_Manager">
      ⁠</a>2.5. IBM JDK and the Java Security Manager</h1></div></div></div><div class="para">
		Some versions of the IBM JDK use a default policy provider which does not work correctly with a JBoss EAP security policy. If you are having problems using an IBM JDK to host JBoss EAP with the Java Security Manager enabled, you must change the JRE configuration to use the standard policy provider.
	</div><div class="para">
		To modify the JRE configuration for the IBM JDK, edit the <code class="filename">JAVA_HOME/jre/lib/security/java.security</code> file, and set the <code class="code">policy.provider</code> value to <code class="code">sun.security.provider.PolicyFile</code>.
	</div><pre class="screen">policy.provider=sun.security.provider.PolicyFile</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+30502-732585+%5BLatest%5D&amp;comment=Title%3A+IBM+JDK+and+the+Java+Security+Manager%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30502-732585+14+Dec+2014+20%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Debug_Security_Manager_Policies">
      ⁠</a>2.6. Debug Security Manager Policies</h1></div></div></div><div class="para">
		You can enable debugging information to help you troubleshoot security policy-related issues. The <code class="command">java.security.debug</code> option configures the level of security-related information reported. The command <code class="command">java -Djava.security.debug=help</code> will produce help output with the full range of debugging options. Setting the debug level to <code class="command">all</code> is useful when troubleshooting a security-related failure whose cause is completely unknown, but for general use it will produce too much information. A sensible general default is <code class="command">access:failure</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772543992448">
      ⁠</a><p class="title"><strong>Procedure 2.3. Enable general debugging</strong></p><ul><li class="step"><p class="title"><strong>This procedure will enable a sensible general level of security-related debug information.</strong></p><div class="para">
				Add the following line to the server configuration file. 
				<div class="itemizedlist"><ul><li class="listitem"><div class="para">
							If the JBoss EAP 6 instance is running in a managed domain, the line is added to the <code class="filename">bin/domain.conf</code> file for Linux or the <code class="filename">bin\domain.conf.bat</code> file for Windows.
						</div></li><li class="listitem"><div class="para">
							If the JBoss EAP 6 instance is running as a standalone server, the line is added to the <code class="filename">bin/standalone.conf</code> file for Linux, or the <code class="filename">bin\standalone.conf.bat</code> file for Windows.
						</div></li></ul></div>

			</div></li></ul></div><div class="para">
		<code class="command">Linux</code>
	</div><div class="para">
		
<pre class="programlisting">JAVA_OPTS="$JAVA_OPTS -Djava.security.debug=access:failure"</pre>

	</div><div class="para">
		<code class="command">Windows</code>
	</div><div class="para">
		
<pre class="programlisting">set "JAVA_OPTS=%JAVA_OPTS% -Djava.security.debug=access:failure"</pre>

	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			A general level of security-related debug information has been enabled.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4780-591672+%5BLatest%5D&amp;comment=Title%3A+Debug+Security+Manager+Policies%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4780-591672+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></body></html>