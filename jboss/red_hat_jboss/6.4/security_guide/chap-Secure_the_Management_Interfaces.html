<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 5. Secure the Management Interfaces</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Secure_the_Management_Interfaces">
      ⁠</a>Chapter 5. Secure the Management Interfaces</h1></div></div></div><div class="para">
		A common development scenario is to run JBoss EAP 6 with no security on the management interfaces to allow rapid configuration changes.
	</div><div class="para">
		In production deployment, secure the management interfaces by at least the following methods:
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Encrypt_Network_Traffic.html#Specify_Which_Network_Interface_the_Enterprise_Application_Platform_Uses">Section 4.1, “Specify Which Network Interface JBoss EAP 6 Uses”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Encrypt_Network_Traffic.html#Configure_Network_Firewalls_to_Work_with_JBoss_Enterprise_Application_Platform_6">Section 4.2, “Configure Network Firewalls to Work with JBoss EAP 6”</a>
				</div></li></ul></div>

	</div><div class="para">
		Additionally, the default silent local authentication mode allows local clients (on the server machine) to connect to the Management CLI without requiring a username or password. This is a convenience for local users and Management CLI scripts. To disable this, refer to <a class="xref" href="chap-Secure_the_Management_Interfaces.html#Remove_Silent_Authentication_from_the_Default_Security_Realm">Section 5.4, “Remove Silent Authentication from the Default Security Realm”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+IDs%3A%0A4703-686257+%5BLatest%5D&amp;comment=Title%3A+Secure+the+Management+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Default_User_Security_Configuration">
      ⁠</a>5.1. Default User Security Configuration</h1></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			All management interfaces in JBoss EAP 6 are secured by default. This security takes two different forms:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Local interfaces are secured by a SASL contract between local clients and the server they connect to. This security mechanism is based on the client's ability to access the local filesystem. This is because access to the local filesystem would allow the client to add a user or otherwise change the configuration to thwart other security mechanisms. This adheres to the principle that if physical access to the filesystem is achieved, other security mechanisms are superfluous. The mechanism happens in four steps:
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					HTTP access is considered to be remote, even if you connect to the localhost using HTTP.
				</div></div></div><div class="orderedlist"><ol><li class="listitem"><div class="para">
						The client sends a message to the server which includes a request to authenticate with the local SASL mechanism.
					</div></li><li class="listitem"><div class="para">
						The server generates a one-time token, writes it to a unique file, and sends a message to the client with the full path of the file.
					</div></li><li class="listitem"><div class="para">
						The client reads the token from the file and sends it to the server, verifying that it has local access to the filesystem.
					</div></li><li class="listitem"><div class="para">
						The server verifies the token and then deletes the file.
					</div></li></ol></div></li><li class="listitem"><div class="para">
				Remote clients, including local HTTP clients, use realm-based security. The default realm with the permissions to configure the JBoss EAP 6 instance remotely using the management interfaces is <code class="literal">ManagementRealm</code>. A script is provided which allows you to add users to this realm (or realms you create). For more information on adding users, see the <em class="citetitle">User Management</em> chapter of the <em class="citetitle">JBoss EAP 6 Administration and Configuration Guide</em>. For each user, the username and a hashed password are stored in a file.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Managed domain</span></dt><dd><div class="para">
							<code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/mgmt-users.properties</code>
						</div></dd><dt><span class="term">Standalone server</span></dt><dd><div class="para">
							<code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/mgmt-users.properties</code>
						</div></dd></dl></div><div class="para">
				Even though the contents of the <code class="filename">mgmt-users.properties</code> are masked, the file must still be treated as a sensitive file. It is recommended that it be set to the file mode of <code class="literal">600</code>, which gives no access other than read and write access by the file owner.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+5751-729848+%5BLatest%5D&amp;comment=Title%3A+Default+User+Security+Configuration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5751-729848+30+Nov+2014+18%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Overview_of_Advanced_Management_Interface_Configuration1">
      ⁠</a>5.2. Overview of Advanced Management Interface Configuration</h1></div></div></div><div class="para">
		The Management interface configuration in the <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/host.xml</code> or <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/standalone.xml</code> controls which network interfaces the host controller process binds to, which types of management interfaces are available at all, and which type of authentication system is used to authenticate users on each interface. This topic discusses how to configure the Management Interfaces to suit your environment.
	</div><div class="para">
		The Management subsystem consists of a <code class="sgmltag-element">&lt;management&gt;</code> element that includes the following four configurable child elements. The security realms and outbound connections are each first defined, and then applied to the management interfaces as attributes.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				&lt;security-realms&gt;
			</div></li><li class="listitem"><div class="para">
				&lt;outbound-connections&gt;
			</div></li><li class="listitem"><div class="para">
				&lt;management-interfaces&gt;
			</div></li><li class="listitem"><div class="para">
				&lt;audit-log&gt;
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Refer to the <em class="citetitle">Management Interface Audit Logging</em> section of the <em class="citetitle">Administration and Configuration Guide</em> for more information on audit logging.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Security Realms</div>
			The security realm is responsible for the authentication and authorization of users allowed to administer JBoss EAP 6 via the Management API, Management CLI, or web-based Management Console.
		</div><div class="para">
		Two different file-based security realms are included in a default installation: <code class="literal">ManagementRealm</code> and <code class="literal">ApplicationRealm</code>. Each of these security realms uses a <code class="filename">-users.properties</code> file to store users and hashed passwords, and a <code class="filename">-roles.properties</code> to store mappings between users and roles. Support is also included for an LDAP-enabled security realm.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Security realms can also be used for your own applications. The security realms discussed here are specific to the management interfaces.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Outbound Connections</div>
			Some security realms connect to external interfaces, such as an LDAP server. An outbound connection defines how to make this connection. A pre-defined connection type, <code class="literal">ldap-connection</code>, sets all of the required and optional attributes to connect to the LDAP server and verify the credential.
		</div><div class="para">
		For more information on how to configure LDAP authentication see <a class="xref" href="chap-Secure_the_Management_Interfaces.html#Use_LDAP_to_Authenticate_to_the_Management_Interfaces1">Section 5.11.2, “Use LDAP to Authenticate to the Management Interfaces”</a>.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Management Interfaces</div>
			A management interface includes properties about how connect to and configure JBoss EAP. Such information includes the named network interface, port, security realm, and other configurable information about the interface. Two interfaces are included in a default installation:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">http-interface</code> is the configuration for the web-based Management Console.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">native-interface</code> is the configuration for the command-line Management CLI and the REST-like Management API.
			</div></li></ul></div><div class="para">
		Each of the main configurable elements of the host management subsystem are interrelated. A security realm refers to an outbound connection, and a management interface refers to a security realm.
	</div><div class="para">
		Associated information can be found in <a class="xref" href="chap-Secure_the_Management_Interfaces.html">Chapter 5, <em>Secure the Management Interfaces</em></a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+8428-685975+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Advanced+Management+Interface+Configuration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8428-685975+18+Jul+2014+05%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Disable_the_HTTP_Management_Interface">
      ⁠</a>5.3. Disable the HTTP Management Interface</h1></div></div></div><div class="para">
		In a managed domain, you only need access to the HTTP interface on the domain controller, rather than on domain member servers. In addition, on a production server, you may decide to disable the web-based Management Console altogether.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Other clients, such as JBoss Operations Network, also operate using the HTTP interface. If you want to use these services, and simply disable the Management Console itself, you can set the <code class="code">console-enabled</code> attribute of the HTTP interface to <code class="literal">false</code>, instead of disabling the interface completely.
		</div><pre class="screen">/host=master/core-service=management/management-interface=http-interface/:write-attribute(name=console-enabled,value=false)</pre></div></div><div class="para">
		To disable access to the HTTP interface, which also disables access to the web-based Management Console, you can delete the HTTP interface altogether.
	</div><div class="para">
		The following JBoss CLI command allows you to read the current contents of your HTTP interface, in case you decide to add it again.
	</div><div class="example"><a id="idm139772560079392">
      ⁠</a><p class="title"><strong>Example 5.1. Read the Configuration of the HTTP Interface</strong></p><div class="example-contents"><pre class="screen">
<code class="command">/host=master/core-service=management/management-interface=http-interface/:read-resource(recursive=true,proxies=false,include-runtime=false,include-defaults=true)</code>
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "console-enabled" =&gt; true,
        "interface" =&gt; "management",
        "port" =&gt; expression "${jboss.management.http.port:9990}",
        "secure-port" =&gt; undefined,
        "security-realm" =&gt; "ManagementRealm"
    }
}
</pre></div></div><div class="para">
		To remove the HTTP interface, issue the following command:
	</div><div class="example"><a id="idm139772531527024">
      ⁠</a><p class="title"><strong>Example 5.2. Remove the HTTP Interface</strong></p><div class="example-contents"><pre class="screen">
/host=master/core-service=management/management-interface=http-interface/:remove
</pre></div></div><div class="para">
		To re-enable access, issue the following commands to re-create the HTTP Interface with the default values.
	</div><div class="example"><a id="idm139772533727520">
      ⁠</a><p class="title"><strong>Example 5.3. Re-Create the HTTP Interface</strong></p><div class="example-contents"><pre class="screen">/host=master/core-service=management/management-interface=http-interface:add(console-enabled=true,interface=management,port="${jboss.management.http.port:9990}",security-realm=ManagementRealm)</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+8430-591838+%5BLatest%5D&amp;comment=Title%3A+Disable+the+HTTP+Management+Interface%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8430-591838+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Remove_Silent_Authentication_from_the_Default_Security_Realm">
      ⁠</a>5.4. Remove Silent Authentication from the Default Security Realm</h1></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			The default installation of JBoss EAP 6 contains a method of silent authentication for a local Management CLI user. This allows the local user the ability to access the Management CLI without username or password authentication. This functionality is enabled as a convenience, and to assist local users running Management CLI scripts without requiring authentication. It is considered a useful feature given that access to the local configuration typically also gives the user the ability to add their own user details or otherwise disable security checks.
		</div><div class="para">
		The convenience of silent authentication for local users can be disabled where greater security control is required. This can be achieved by removing the <code class="literal">local</code> element within the <code class="literal">security-realm</code> section of the configuration file. This applies to both the <code class="filename">standalone.xml</code> for a Standalone Server instance, or <code class="filename">host.xml</code> for a Managed Domain. You should only consider the removal of the <code class="literal">local</code> element if you understand the impact that it might have on your particular server configuration.
	</div><div class="para">
		The preferred method of removing silent authentication is by use of the Management CLI, which directly removes the <code class="literal">local</code> element visible in the following example.
	</div><div class="example"><a id="idm139772531673296">
      ⁠</a><p class="title"><strong>Example 5.4. Example of the <code class="literal">local</code> element in the <code class="literal">security-realm</code></strong></p><div class="example-contents"><pre class="programlisting">
&lt;security-realms&gt;
    &lt;security-realm name="ManagementRealm"&gt;
        &lt;authentication&gt;
            &lt;local default-user="$local"/&gt;
            &lt;properties path="mgmt-users.properties" relative-to="jboss.server.config.dir"/&gt;
        &lt;/authentication&gt;
    &lt;/security-realm&gt;
    &lt;security-realm name="ApplicationRealm"&gt;
        &lt;authentication&gt;
            &lt;local default-user="$local" allowed-users="*"/&gt;
            &lt;properties path="application-users.properties" relative-to="jboss.server.config.dir"/&gt;
        &lt;/authentication&gt;
        &lt;authorization&gt;
            &lt;properties path="application-roles.properties" relative-to="jboss.server.config.dir"/&gt;
        &lt;/authorization&gt;
    &lt;/security-realm&gt;
&lt;/security-realms&gt;

</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Start the JBoss EAP 6 instance.
			</div></li><li class="listitem"><div class="para">
				Launch the Management CLI.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772539167360">
      ⁠</a><p class="title"><strong>Procedure 5.1. Remove Silent Authentication from the Default Security Realm</strong></p><ul><li class="step"><p class="title"><strong>Remove silent authentication with the Management CLI</strong></p><div class="para">
				Remove the <code class="literal">local</code> element from the Management Realm and Application Realm as required.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Remove the <code class="literal">local</code> element from the Management Realm.
					</div><ul class="stepalternatives">
						<li class="step"><p class="title"><strong>For Standalone Servers</strong></p><pre class="screen">/core-service=management/security-realm=ManagementRealm/authentication=local:remove</pre></li>
						 <li class="step"><p class="title"><strong>For Managed Domains</strong></p><pre class="screen">/host=<em class="replaceable">HOST_NAME</em>/core-service=management/security-realm=ManagementRealm/authentication=local:remove</pre></li>

					</ul></li><li class="step"><div class="para">
						Remove the <code class="literal">local</code> element from the Application Realm.
					</div><ul class="stepalternatives">
						<li class="step"><p class="title"><strong>For Standalone Servers</strong></p><pre class="screen">/core-service=management/security-realm=ApplicationRealm/authentication=local:remove</pre></li>
						 <li class="step"><p class="title"><strong>For Managed Domains</strong></p><pre class="screen">/host=<em class="replaceable">HOST_NAME</em>/core-service=management/security-realm=ApplicationRealm/authentication=local:remove</pre></li>

					</ul></li></ol></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The silent authentication mode is removed from the <code class="literal">ManagementRealm</code> and the <code class="literal">ApplicationRealm</code>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+9053-591862+%5BLatest%5D&amp;comment=Title%3A+Remove+Silent+Authentication+from+the+Default+Security+Realm%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9053-591862+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Disable_Remote_Access_to_the_JMX_Subsystem1">
      ⁠</a>5.5. Disable Remote Access to the JMX Subsystem</h1></div></div></div><div class="para">
		Remote access to the JMX subsystem allows you to trigger JDK and application management operations remotely. In order to secure an installation, disable this function either by removing the remoting connector or removing the JMX subsystem. The example Management CLI commands are suitable for a managed domain. For a standalone server, remove the <code class="literal">/profile=default</code> prefix from the commands.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			In a managed domain the remoting connector is removed from the JMX subsystem by default. This command is provided for your information, in case you add it during development.
		</div></div></div><div class="example"><a id="idm139772497989632">
      ⁠</a><p class="title"><strong>Example 5.5. Remove the Remoting Connector from the JMX Subsystem</strong></p><div class="example-contents"><pre class="screen">/profile=<em class="replaceable">default</em>/subsystem=jmx/remoting-connector=jmx/:remove</pre></div></div><div class="example"><a id="idm139772538249264">
      ⁠</a><p class="title"><strong>Example 5.6. Remove the JMX Subsystem</strong></p><div class="example-contents"><div class="para">
			For a managed domain, run this command for each profile.
		</div><pre class="screen">/profile=<em class="replaceable">default</em>/subsystem=jmx/:remove</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+8432-714908+%5BLatest%5D&amp;comment=Title%3A+Disable+Remote+Access+to+the+JMX+Subsystem%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8432-714908+02+Oct+2014+19%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Security_Realms_for_the_Management_Interfaces">
      ⁠</a>5.6. Configure Security Realms for the Management Interfaces</h1></div></div></div><div class="para">
		The management interfaces use security realms to control authentication and access to the configuration mechanisms of JBoss EAP 6. A Security Realm is similar to a Unix group. It is effectively a database of usernames and passwords that can be use to authenticate users.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Default Management Realm</div>
			The management interfaces are configured to use the <code class="literal">ManagementRealm</code> security realm by default. The ManagementRealm stores its user password combinations in the file <code class="filename">mgmt-users.properties</code>.
		</div><div class="example"><a id="idm139772550892944">
      ⁠</a><p class="title"><strong>Example 5.7. Default ManagementRealm</strong></p><div class="example-contents"><pre class="screen"><code class="command">/host=master/core-service=management/security-realm=ManagementRealm/:read-resource(recursive=true,proxies=false,include-runtime=false,include-defaults=true)</code>
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "map-groups-to-roles" =&gt; false,
        "authentication" =&gt; {
            "local" =&gt; {
                "allowed-users" =&gt; undefined,
                "default-user" =&gt; "$local"
            },
            "properties" =&gt; {
                "path" =&gt; "mgmt-users.properties",
                "plain-text" =&gt; false,
                "relative-to" =&gt; "jboss.domain.config.dir"
            }
        },
        "authorization" =&gt; {"properties" =&gt; {
            "path" =&gt; "mgmt-groups.properties",
            "relative-to" =&gt; "jboss.domain.config.dir"
        }},
        "plug-in" =&gt; undefined,
        "server-identity" =&gt; undefined
    }
}</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Create a new Security Realm</div>
			The following commands create a new security realm called <code class="literal">TestRealm</code> and set the directory for the relevant properties file.
		</div><div class="example"><a id="idm139772549725712">
      ⁠</a><p class="title"><strong>Example 5.8. Create a new Security Realm</strong></p><div class="example-contents"><pre class="screen"><code class="prompt">/host=master/core-service=management/security-realm=TestRealm/:add</code>
<code class="prompt">/host=master/core-service=management/security-realm=TestRealm/authentication=properties/:add(path=TestUsers.properties, relative-to=jboss.domain.config.dir)</code></pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure Security Realm authentication through an existing Security Domain</div>
			To use Security Domain to authenticate to the Management interfaces:
		</div><div class="para">
		First, create a Security Realm. Then, set specify it as the value for the <code class="literal">security-realm</code> attribute of the management interface:
	</div><div class="example"><a id="idm139772559673472">
      ⁠</a><p class="title"><strong>Example 5.9. Specify a Security Realm to use for the HTTP Management Interface</strong></p><div class="example-contents"><pre class="screen"><code class="command">/host=master/core-service=management/management-interface=http-interface/:write-attribute(name=security-realm,value=<em class="replaceable">TestRealm</em>)</code></pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+8433-741741+%5BLatest%5D&amp;comment=Title%3A+Configure+Security+Realms+for+the+Management+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8433-741741+05+Feb+2015+23%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_the_Management_Console_for_HTTPS_in_Standalone_mode">
      ⁠</a>5.7. Configure the Management Console for HTTPS</h1></div></div></div><div class="para">
		Configuring the JBoss EAP management console for communication <span class="bold bold"><strong> only</strong></span> via HTTPS provides increased security. All network traffic between the client (web browser) and management console is encrypted, which reduces the risk of security attacks such as a man-in-the-middle attack. Anyone administering a JBoss EAP instance has greater permissions on that instance than non-privileged users, and using HTTPS helps protect the integrity and availability of that instance.
	</div><div class="para">
		In this procedure unencrypted communications with the JBoss EAP standalone instance or domain is disabled. Passwords used in these communications are stored encrypted using the JBoss EAP <span class="bold bold"><strong>vault</strong></span> feature, and passwords used in configuration files are masked.
	</div><div class="para">
		This procedure applies to both <code class="literal">standalone</code> and <code class="literal">domain</code> mode configurations. For <code class="literal">domain</code> mode, prefix the management CLI commands with the name of the host, for example: <code class="command">/host=master</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772542210352">
      ⁠</a><p class="title"><strong>Procedure 5.2. </strong></p><ol class="1"><li class="step"><p class="title"><strong>Create a keystore to secure the management console.</strong></p><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					This keystore must be in JKS format as the management console is not compatible with keystores in JCEKS format.
				</div></div></div><div class="para">
				In a terminal emulator, enter the following command. For the parameters <em class="parameter"><code>alias</code></em>, <em class="parameter"><code>keypass</code></em>, <em class="parameter"><code>keystore</code></em>, <em class="parameter"><code>storepass</code></em> and <em class="parameter"><code>dname</code></em>, replace the example values with values of your choice.
			</div><div class="para">
				The parameter <em class="parameter"><code>validity</code></em> specifies for how many days the key is valid. A value of 730 equals two years.
			</div><div class="para">
				
<pre class="programlisting">keytool -genkeypair -alias <em class="replaceable">appserver</em> -storetype jks -keyalg RSA -keysize 2048 -keypass <em class="replaceable">password1</em> -keystore <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/identity.jks</code> -storepass <em class="replaceable">password1</em> -dname <em class="replaceable">"CN=appserver,OU=Sales,O=Systems Inc,L=Raleigh,ST=NC,C=US"</em> -validity 730 -v</pre>

			</div></li><li class="step"><p class="title"><strong>Ensure the Management Console Binds to HTTPS</strong></p><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Standalone Mode</strong></p><div class="para">
						Ensure the management console binds to <code class="literal">HTTPS</code> for its interface by adding the <code class="literal">management-https</code> configuration and removing the <code class="literal">management-http</code> configuration.
					</div><div class="para">
						Ensure the JBoss EAP instance is running, then enter the following management CLI commands:
					</div><pre class="programlisting"><code class="command">/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</code></pre><pre class="programlisting"><code class="command">/core-service=management/management-interface=http-interface:undefine-attribute(name=socket-binding)</code></pre><div class="para">
						The expected output from these commands is:
					</div><pre class="screen">
{"outcome" =&gt; "success"}
</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							At this point the JBoss EAP log may display the following error message. This is to be expected because the SSL configuration is not yet completed.
						</div><pre class="screen">
JBAS015103: A secure port has been specified for the HTTP interface but no SSL configuration in the realm.
</pre></div></div></li>
				 <li class="step"><p class="title"><strong>Domain Mode</strong></p><div class="para">
						Change the socket element within the management-interface section by adding secure-port and removing port configuration.
					</div><div class="para">
						Ensure the JBoss EAP instance is running, then enter the following management CLI commands:
					</div><pre class="programlisting"><code class="command">/host=master/core-service=management/management-interface=http-interface:write-attribute(name=secure-port,value=9443)</code>
<code class="command">/host=master/core-service=management/management-interface=http-interface:undefine-attribute(name=port)</code></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							At this point the JBoss EAP log may display the following error message. This is to be expected because the SSL configuration is not yet completed.
						</div><pre class="screen">
JBAS015103: A secure port has been specified for the HTTP interface but no SSL configuration in the realm.
</pre></div></div></li>

			</ul></li><li class="step"><p class="title"><strong>Optional: Custom socket-binding group</strong></p><div class="para">
				If you are using a custom <em class="parameter"><code>socket-binding</code></em> group, ensure the <em class="parameter"><code>management-https</code></em> binding is defined (it is present by default, bound to port <code class="literal">9443</code>). Edit the master configuration file - for example <code class="filename">standalone.xml</code> - to match the following.
			</div><pre class="programlisting"> &lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;
        &lt;socket-binding name="management-native" interface="management" port="${jboss.management.native.port:9999}"/&gt;
        &lt;socket-binding name="management-http" interface="management" port="${jboss.management.http.port:9990}"/&gt;
        &lt;socket-binding name="management-https" interface="management" port="${jboss.management.https.port:9443}"/&gt;

</pre></li><li class="step"><p class="title"><strong>Create a new Security Realm</strong></p><div class="para">
				Enter the following commands to create a new security realm named <code class="literal">ManagementRealmHTTPS</code>:
			</div><pre class="screen">/host=master/core-service=management/security-realm=ManagementRealmHTTPS/:add
/host=master/core-service=management/security-realm=ManagementRealmHTTPS/authentication=properties/:add(path=ManagementUsers.properties, relative-to=jboss.domain.config.dir)</pre></li><li class="step"><p class="title"><strong>Configure Management Interface to use the new security realm</strong></p><div class="para">
				Enter the following commands:
			</div><pre class="screen">/host=master/core-service=management/management-interface=http-interface/:write-attribute(name=security-realm,value=ManagementRealmHTTPS)</pre></li><li class="step"><p class="title"><strong>Configure the management console to use the keystore.</strong></p><div class="para">
				Enter the following management CLI command. For the parameters <em class="parameter"><code>file</code></em>, <em class="parameter"><code>password</code></em> and <em class="parameter"><code>alias</code></em> their values must be copied from the step <em class="citetitle">Create a keystore to secure the management console</em>.
			</div><pre class="programlisting">/core-service=management/security-realm=ManagementRealmHTTPS/server-identity=ssl:add(keystore-path=<code class="filename"><em class="replaceable">identity.jks</em></code>,keystore-relative-to=jboss.server.config.dir, keystore-password=<em class="replaceable">password1</em>, alias=<em class="replaceable">appserver</em>)</pre><div class="para">
				The expected output from this command is:
			</div><pre class="screen">{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}</pre></li><li class="step"><p class="title"><strong> Restart the JBoss EAP server. </strong></p><div class="para">
				On restarting the server the log should contain the following, just before the text which states the number of services that are started. The management console is now listening on port 9443, which confirms that the procedure was successful.
			</div><pre class="screen">
14:53:14,720 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015962: Http management interface listening on https://<em class="replaceable">127.0.0.1</em>:9443/management
14:53:14,721 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015952: Admin console listening on https://<em class="replaceable">127.0.0.1</em>:9443
</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For security reasons it is recommended that you mask the keystore password. For details on how to do this see <a class="xref" href="chap-Secure_Passwords_and_Other_Sensitive_Strings_with_Password_Vault.html#About_Securing_Sensitive_Strings_in_Clear-Text_Files1">Section 7.1, “Password Vault System”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+22638-686024+%5BLatest%5D&amp;comment=Title%3A+Configure+the+Management+Console+for+HTTPS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=22638-686024+18+Jul+2014+10%3A39+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Secure_Interface_Attribute">
      ⁠</a>5.8. Use Distinct Interfaces for HTTP and HTTPS connections to the Management Interface</h1></div></div></div><div class="para">
		The Management Interface can listen on distinct interfaces for HTTP and HTTPS connections. One scenario for this is to listen for encrypted traffic on an external network, and use unencrypted traffic on an internal network.
	</div><div class="para">
		The <code class="literal">secure-interface</code> attribute specifies the network interface on which the host's socket for HTTPS management communication should be opened, if a different interface should be used from that specified by the <code class="literal">interface</code> attribute. If it is not specified then the interface specified by the <code class="literal">interface</code> attribute is used.
	</div><div class="para">
		The <code class="literal">secure-interface</code> attribute has no effect if the <code class="literal">secure-port</code> attribute is not set.
	</div><div class="para">
		Note that when the server listens for HTTP and HTTPS traffic on the <span class="emphasis"><em>same</em></span> interface, HTTPS requests received by the HTTP listener are automatically redirected to the HTTPS port. When <span class="emphasis"><em>distinct</em></span> interfaces are used for HTTP and HTTPS traffic, no redirection is performed when an HTTPS request is received by the HTTP listener.
	</div><div class="para">
		Here is an example <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/host.xml</code> configuration that sets the <code class="literal">secure-interface</code> attribute to listen for HTTPS traffic on a distinct interface from HTTP traffic:
	</div><pre class="screen">&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;host name="master" xmlns="urn:jboss:domain:3.0"&gt;

    &lt;management&gt;
        &lt;security-realms&gt;
            &lt;security-realm name="ManagementRealm"&gt;
                &lt;authentication&gt;
                    &lt;local default-user="$local" /&gt;
                    &lt;properties path="mgmt-users.properties" relative-to="jboss.domain.config.dir"/&gt;
                &lt;/authentication&gt;
            &lt;/security-realm&gt;
        &lt;/security-realms&gt;
        &lt;management-interfaces&gt;
            &lt;native-interface security-realm="ManagementRealm"&gt;
                &lt;socket interface="management" port="${jboss.management.native.port:9999}"/&gt;
            &lt;/native-interface&gt;
            &lt;http-interface security-realm="ManagementRealm"&gt;
                &lt;socket interface="management" port="${jboss.management.http.port:9990}" secure-port="${jboss.management.https.port:9943}" secure-interface="secure-management"/&gt;
            &lt;/http-interface&gt;
        &lt;/management-interfaces&gt;
    &lt;/management&gt;

    &lt;domain-controller&gt;
        &lt;local/&gt;
        &lt;!-- Alternative remote domain controller configuration with a host and port --&gt;
        &lt;!-- &lt;remote host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}" security-realm="ManagementRealm"/&gt; --&gt;
    &lt;/domain-controller&gt;

    &lt;interfaces&gt;
        &lt;interface name="management"&gt;
            &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
        &lt;/interface&gt;
        &lt;interface name="secure-management"&gt;
            &lt;inet-address value="${jboss.bind.address:10.10.64.1}"/&gt;
        &lt;/interface&gt;
    &lt;/interfaces&gt;
&lt;/host&gt;
</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+30877-686462+%5BLatest%5D&amp;comment=Title%3A+Use+Distinct+Interfaces+for+HTTP+and+HTTPS+connections+to+the+Management+Interface%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30877-686462+21+Jul+2014+21%3A22+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Using_2-way_SSL_for_the_Management_interface_and_the_CLI">
      ⁠</a>5.9. Using 2-way SSL for the Management interface and the CLI</h1></div></div></div><div class="para">
		2-way SSL authentication, also known as <em class="firstterm">client authentication</em>, authenticates both the client and the server using SSL certificates. This provides assurance that not only is the server who it says it is, but the client is also who it says it is.
	</div><div class="para">
		In this topic the following conventions are used:
	</div><div class="variablelist"><p class="title"><strong/></p><dl class="variablelist"><dt><span class="term"><em class="replaceable">HOST1</em></span></dt><dd><div class="para">
					The JBoss server hostname. For example; <code class="literal">jboss.redhat.com</code>
				</div></dd><dt><span class="term"><em class="replaceable">HOST2</em></span></dt><dd><div class="para">
					A suitable name for the client. For example: <code class="literal">myclient</code>. Note this is not necessarily an actual hostname.
				</div></dd><dt><span class="term"><em class="replaceable">CA_HOST1</em></span></dt><dd><div class="para">
					The DN (distinguished name) to use for the <em class="replaceable">HOST1</em> certificate. For example <code class="literal">cn=jboss,dc=redhat,dc=com</code>.
				</div></dd><dt><span class="term"><em class="replaceable">CA_HOST2</em></span></dt><dd><div class="para">
					The DN (distinguished name) to use for the <em class="replaceable">HOST2</em> certificate. For example <code class="literal">cn=myclient,dc=redhat,dc=com</code>.
				</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				If you are going to use a password vault to store the keystore and truststore passwords (recommended), the password vault should already be created. Refer to <a class="xref" href="chap-Secure_Passwords_and_Other_Sensitive_Strings_with_Password_Vault.html#About_Securing_Sensitive_Strings_in_Clear-Text_Files1">Section 7.1, “Password Vault System”</a>.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772539751840">
      ⁠</a><p class="title"><strong>Procedure 5.3. </strong></p><ol class="1"><li class="step"><div class="para">
				Generate the stores:
			</div><pre class="programlisting">keytool -genkeypair -alias <em class="replaceable">HOST1_alias</em> -keyalg RSA -keysize 1024 -validity 365 -keystore host1.keystore.jks -dname "<em class="replaceable">CA_HOST1</em>" -keypass secret -storepass <em class="replaceable">secret</em></pre><pre class="programlisting">keytool -genkeypair -alias <em class="replaceable">HOST2_alias</em> -keyalg RSA -keysize 1024 -validity 365 -keystore host2.keystore.jks -dname "<em class="replaceable">CA_HOST2</em>" -keypass secret -storepass <em class="replaceable">secret</em></pre></li><li class="step"><div class="para">
				Export the certificates:
			</div><pre class="programlisting">keytool -exportcert  -keystore <em class="replaceable">HOST1</em>.keystore.jks -alias <em class="replaceable">HOST1_alias</em> -keypass <em class="replaceable">secret</em> -storepass <em class="replaceable">secret</em> -file <em class="replaceable">HOST1</em>.cer
</pre><pre class="programlisting">keytool -exportcert  -keystore <em class="replaceable">HOST2</em>.keystore.jks -alias <em class="replaceable">HOST2_alias</em> -keypass <em class="replaceable">secret</em> -storepass <em class="replaceable">secret</em> -file <em class="replaceable">HOST2</em>.cer
</pre></li><li class="step"><div class="para">
				Import the certificates into the opposing trust stores:
			</div><pre class="programlisting">keytool -importcert -keystore <em class="replaceable">HOST1</em>.truststore.jks -storepass <em class="replaceable">secret</em> -alias <em class="replaceable">HOST2_alias</em> -trustcacerts -file <em class="replaceable">HOST2</em>.cer
</pre><pre class="programlisting">keytool -importcert -keystore <em class="replaceable">HOST2</em>.truststore.jks -storepass <em class="replaceable">secret</em> -alias <em class="replaceable">HOST1_alias</em> -trustcacerts -file <em class="replaceable">HOST1</em>.cer
</pre></li><li class="step"><div class="para">
				Define a CertificateRealm in the configuration for your installation (<code class="filename">host.xml</code> or <code class="filename">standalone.xml</code>) and point the interface to it:
			</div><div class="para">
				This can be done by manually editing the configuration file (not recommended) or by using the following commands:
			</div><pre class="programlisting"><code class="command">/core-service=management/security-realm=CertificateRealm:add()</code></pre><pre class="programlisting"><code class="command">/core-service=management/security-realm=CertificateRealm/server-identity=ssl:add(keystore-path=/path/to/HOST1.keystore.jks,keystore-password=secret, alias=HOST1_alias)</code></pre><pre class="programlisting"><code class="command">/core-service=management/security-realm=CertificateRealm/authentication=truststore:add(keystore-path=/path/to/HOST1.truststore.jks,keystore-password=secret)</code></pre><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					The provided commands apply to standalone mode only. For domain mode, add <code class="command">/host=master</code> before each command.
				</div></div></div></li><li class="step"><div class="para">
				Change the <em class="parameter"><code>security-realm</code></em> of the native-interface to the new Certificate Realm.
			</div><pre class="programlisting"><code class="command">/host=master/core-service=management/management-interface=native-interface:write-attribute(name=security-realm,value=CertificateRealm)</code></pre></li><li class="step"><div class="para">
				Add the SSL configuration for the CLI, which uses <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.xml</code> as a settings file. Either use a password vault to store the keystore and truststore passwords (recommended), or store them in plain text:
			</div><ul class="stepalternatives">
				<li class="step"><div class="para">
						To store the keystore and truststore passwords in a password vault:
					</div><div class="para">
						Edit <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.xml</code> and add the SSL configuration (using the appropriate values for the variables). Also add the vault configuration, replacing each value with those of your vault.
					</div><pre class="programlisting">&lt;ssl&gt;
  &lt;vault&gt;
    &lt;vault-option name="KEYSTORE_URL" value="path-to/vault/vault.keystore"/&gt;
    &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5WNXs8oEbrs"/&gt;
    &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
    &lt;vault-option name="SALT" value="12345678"/&gt;
    &lt;vault-option name="ITERATION_COUNT" value="50"/&gt;
    &lt;vault-option name="ENC_FILE_DIR" value="path-to/jboss-eap/vault/"/&gt;
  &lt;/vault&gt;
  &lt;alias&gt;$HOST2alias&lt;/alias&gt;
  &lt;key-store&gt;/path/to/HOST2.keystore.jks&lt;/key-store&gt;
  &lt;key-store-password&gt;VAULT::VB::cli_pass::1&lt;/key-store-password&gt;
  &lt;key-password&gt;VAULT::VB::cli_pass::1&lt;/key-password&gt;  
  &lt;trust-store&gt;/path/to/HOST2.truststore.jks&lt;/trust-store&gt;
  &lt;trust-store-password&gt;VAULT::VB::cli_pass::1&lt;/trust-store-password&gt;
  &lt;modify-trust-store&gt;true&lt;/modify-trust-store&gt;
&lt;/ssl&gt;
</pre></li>
				 <li class="step"><div class="para">
						To store the keystore and truststore passwords in plain text:
					</div><div class="para">
						Edit <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.xml</code> and add the SSL configuration (using the appropriate values for the variables):
					</div><pre class="programlisting">&lt;ssl&gt;
  &lt;alias&gt;$HOST2alias&lt;/alias&gt;
  &lt;key-store&gt;/path/to/HOST2.keystore.jks&lt;/key-store&gt;
  &lt;key-store-password&gt;secret&lt;/key-store-password&gt;
  &lt;trust-store&gt;/path/to/HOST2.truststore.jks&lt;/trust-store&gt;
  &lt;trust-store-password&gt;secret&lt;/trust-store-password&gt;
  &lt;modify-trust-store&gt;true&lt;/modify-trust-store&gt;
&lt;/ssl&gt;
</pre></li>

			</ul></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+22641-686543+%5BLatest%5D&amp;comment=Title%3A+Using+2-way+SSL+for+the+Management+interface+and+the+CLI%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=22641-686543+21+Jul+2014+22%3A11+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Secure_the_Management_Interfaces_via_JAAS">
      ⁠</a>5.10. Secure the Management Interfaces via JAAS</h1></div></div></div><div class="para">
		To use JAAS to authenticate to the Management interfaces:
	</div><div class="para">
		First, create a security domain with the UsersRoles login module:
	</div><pre class="screen">/subsystem=security/security-domain=UsersLMDomain:add(cache-type=default)
/subsystem=security/security-domain=UsersLMDomain/authentication=classic:add
/subsystem=security/security-domain=UsersLMDomain/authentication=classic/login-module=UsersRoles:add()</pre><div class="para">
		Then, create a security realm with JAAS Authentication:
	</div><pre class="screen">/core-service=management/security-realm=SecurityDomainAuthnRealm:add
/core-service=management/security-realm=SecurityDomainAuthnRealm/authentication=jaas:add(name=UsersLMDomain)</pre><div class="para">
		The attribute <code class="literal">assign-groups</code> determines whether loaded user membership information from the Security Domain is used for group assignment in the Security Realm. When set to <code class="literal">true</code> this group assignment is used for Role-Based Access Control (RBAC).
	</div><div class="para">
		The <code class="literal">assign-groups</code> attribute can be set to true by this CLI command:
	</div><pre class="screen">/core-service=management/security-realm=ManagementRealm/authentication=jaas:write-attribute(name=assign-groups,value=true)</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+41107-742327+%5BLatest%5D&amp;comment=Title%3A+Secure+the+Management+Interfaces+via+JAAS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41107-742327+09+Feb+2015+22%3A50+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-LDAP">
      ⁠</a>5.11. LDAP</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_LDAP1">
      ⁠</a>5.11.1. About LDAP</h2></div></div></div><div class="para">
		Lightweight Directory Access Protocol (LDAP) is a protocol for storing and distributing directory information across a network. This directory information includes information about users, hardware devices, access roles and restrictions, and other information.
	</div><div class="para">
		Some common implementations of LDAP include OpenLDAP, Microsoft Active Directory, IBM Tivoli Directory Server, Oracle Internet Directory, and others.
	</div><div class="para">
		JBoss EAP 6 includes several authentication and authorization modules which allow you to use a LDAP server as the authentication and authorization authority for your Web and EJB applications.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+7819-591808+%5BLatest%5D&amp;comment=Title%3A+About+LDAP%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7819-591808+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_LDAP_to_Authenticate_to_the_Management_Interfaces1">
      ⁠</a>5.11.2. Use LDAP to Authenticate to the Management Interfaces</h2></div></div></div><div class="para">
		To use an LDAP directory server as the authentication source for the Management Console, Management CLI, or Management API, you need to perform the following procedures:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
				Create an outbound connection to the LDAP server.
			</div></li><li class="listitem"><div class="para">
				Create an LDAP-enabled security realm.
			</div></li><li class="listitem"><div class="para">
				Reference the new security domain in the Management Interface.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Create an Outbound Connection to an LDAP Server</div>
			The LDAP outbound connection allows the following attributes:
		</div><div class="table"><a id="idm139772497023520">
      ⁠</a><p class="title"><strong>Table 5.1. Attributes of an LDAP Outbound Connection</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Attributes of an LDAP Outbound Connection"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Required </th><th> Description </th></tr></thead><tbody><tr><td> <code class="literal">url</code> </td><td> yes </td><td> <div class="para">
						The URL address of the directory server.
					</div>
					 </td></tr><tr><td> <code class="literal">search-dn</code> </td><td> no </td><td> <div class="para">
						The fully distinguished name (DN) of the user authorized to perform searches.
					</div>
					 </td></tr><tr><td> <code class="literal">search-credentials</code> </td><td> no </td><td> <div class="para">
						The password of the user authorized to perform searches.
					</div>
					 </td></tr><tr><td> <code class="literal">initial-context-factory</code> </td><td> no </td><td> <div class="para">
						The initial context factory to use when establishing the connection. Defaults to <code class="code">com.sun.jndi.ldap.LdapCtxFactory</code>.
					</div>
					 </td></tr><tr><td> <code class="literal">security-realm</code> </td><td> no </td><td> <div class="para">
						The security realm to reference to obtain a configured <code class="code">SSLContext</code> to use when establishing the connection.
					</div>
					 </td></tr></tbody></table></div></div><div class="example"><a id="idm139772494175296">
      ⁠</a><p class="title"><strong>Example 5.10. Add an LDAP Outbound Connection</strong></p><div class="example-contents"><div class="para">
			This example adds an outbound connection with the following properties set:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Search DN: <code class="literal">cn=search,dc=acme,dc=com</code>
				</div></li><li class="listitem"><div class="para">
					Search Credential: <code class="literal">myPass</code>
				</div></li><li class="listitem"><div class="para">
					URL: <code class="literal">ldap://127.0.0.1:389</code>
				</div></li></ul></div><div class="para">
			The first command adds the security realm.
		</div><pre class="screen">/host=master/core-service=management/security-realm=ldap_security_realm:add</pre><div class="para">
			The second command adds the LDAP connection.
		</div><pre class="screen">/host=master/core-service=management/ldap-connection=ldap_connection/:add(search-credential=myPass,url=ldap://127.0.0.1:389,search-dn="cn=search,dc=acme,dc=com")</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Create an LDAP-Enabled Security Realm</div>
			The Management Interfaces can authenticate against LDAP server instead of the property-file based security realms configured by default. The LDAP authenticator operates by first establishing a connection to the remote directory server. It then performs a search using the username which the user passed to the authentication system, to find the fully-qualified distinguished name (DN) of the LDAP record. A new connection is established, using the DN of the user as the credential, and password supplied by the user. If this authentication to the LDAP server is successful, the DN is verified to be valid.
		</div><div class="para">
		The LDAP security realm uses the following configuration attributes:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">connection</span></dt><dd><div class="para">
					The name of the connection defined in <em class="parameter"><code>outbound-connections</code></em> to use to connect to the LDAP directory.
				</div></dd><dt><span class="term">advanced-filter</span></dt><dd><div class="para">
					The fully defined filter used to search for a user based on the supplied user ID. The filter must contain a variable in the following format: <code class="literal">{0}</code>. This is later replaced with the user name supplied by the user.
				</div></dd><dt><span class="term">base-dn</span></dt><dd><div class="para">
					The distinguished name of the context to begin searching for the user.
				</div></dd><dt><span class="term">recursive</span></dt><dd><div class="para">
					Whether the search should be recursive throughout the LDAP directory tree, or only search the specified context. Defaults to <code class="literal">false</code>.
				</div></dd><dt><span class="term">user-dn</span></dt><dd><div class="para">
					The attribute of the user that holds the distinguished name. This is subsequently used to test authentication as the user can complete. Defaults to <code class="literal">dn</code>.
				</div></dd><dt><span class="term">username-attribute</span></dt><dd><div class="para">
					The name of the attribute to search for the user. This filter performs a simple search where the user name entered by the user matches the specified attribute.
				</div></dd><dt><span class="term">allow-empty-passwords</span></dt><dd><div class="para">
					This attribute determines whether an empty password is accepted. The default value for this attribute is <code class="literal">false</code>.
				</div></dd><dt><span class="term">Either <code class="literal">username-filter</code> or <code class="literal">advanced-filter</code> must be specified</span></dt><dd><div class="para">
					The <em class="parameter"><code>advanced-filter</code></em> attribute contains a filter query in the standard LDAP syntax, for example:
				</div><pre class="programlisting">(&amp;(sAMAccountName={0})(memberOf=cn=admin,cn=users,dc=acme,dc=com))
</pre></dd></dl></div><div class="example"><a id="idm139772546814368">
      ⁠</a><p class="title"><strong>Example 5.11. XML Representing an LDAP-enabled Security Realm</strong></p><div class="example-contents"><div class="para">
			This example uses the following parameters:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					connection - <code class="literal">ldap_connection</code>
				</div></li><li class="listitem"><div class="para">
					base-dn - <code class="literal">cn=users,dc=acme,dc=com</code>.
				</div></li><li class="listitem"><div class="para">
					username-filter - <code class="literal">attribute="sambaAccountName"</code>
				</div></li></ul></div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-realm</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ldap_security_realm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;ldap</span><span xmlns="" class="perl_Others"> connection=</span><span xmlns="" class="perl_String">"ldap_connection"</span><span xmlns="" class="perl_Others"> base-dn=</span><span xmlns="" class="perl_String">"cn=users,dc=acme,dc=com"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;username-filter</span><span xmlns="" class="perl_Others"> attribute=</span><span xmlns="" class="perl_String">"sambaAccountName"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/ldap&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-realm&gt;</span>
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			It is important to ensure that you do not allow empty LDAP passwords; unless you specifically desire this in your environment, it is a serious security concern.
		</div><div class="para">
			EAP 6.1 includes a patch for CVE-2012-5629, which sets the allowEmptyPasswords option for the LDAP login modules to false if the option is not already configured. For older versions, this option should be configured manually
		</div></div></div><div class="example"><a id="idm139772559960096">
      ⁠</a><p class="title"><strong>Example 5.12. Add an LDAP Security Realm</strong></p><div class="example-contents"><div class="para">
			The command below adds an LDAP authentication to a security realm and sets its attributes for a host named master in the domain. 
		</div><pre class="screen">/host=master/core-service=management/security-realm=ldap_security_realm/authentication=ldap:add(base-dn="<em class="replaceable">DC=mycompany</em>,<em class="replaceable">DC=org</em>", recursive=true, username-attribute="<em class="replaceable">MyAccountName</em>", connection="ldap_connection")</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Apply the New Security Realm to the Management Interface</div>
			After you create a security realm, you need to reference it in the configuration of your management interface. The management interface will use the security realm for HTTP digest authentication.
		</div><div class="example"><a id="idm139772563373680">
      ⁠</a><p class="title"><strong>Example 5.13. Apply the Security Realm to the HTTP Interface</strong></p><div class="example-contents"><div class="para">
			After this configuration is in place, and you restart the host controller, the web-based Management Console will use LDAP to authenticate its users.
		</div><pre class="screen">/host=master/core-service=management/management-interface=http-interface/:write-attribute(name=security-realm,value=ldap_security_realm)</pre></div></div><div class="example"><a id="idm139772538778640">
      ⁠</a><p class="title"><strong>Example 5.14. Apply the Security Realm to the Native Interface</strong></p><div class="example-contents"><div class="para">
			Use the following command to apply the same settings to the native interface:
		</div><pre class="screen">/host=master/core-service=management/management-interface=native-interface/:write-attribute(name=security-realm,value=ldap_security_realm)</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+8429-623240+%5BLatest%5D&amp;comment=Title%3A+Use+LDAP+to+Authenticate+to+the+Management+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8429-623240+21+Mar+2014+06%3A48+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_Outbound_LDAP_with_2-way_SSL_in_the_Management_Interface_and_CLI">
      ⁠</a>5.11.3. Using Outbound LDAP with 2-way SSL in the Management Interface and CLI</h2></div></div></div><div class="para">
		JBoss EAP 6 can be configured to use an outbound connection to a LDAP server using 2-way SSL for authentication in the Management Interface and CLI.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						An LDAP-enabled security realm must be created. See <a class="xref" href="chap-Secure_the_Management_Interfaces.html#Use_LDAP_to_Authenticate_to_the_Management_Interfaces1">Section 5.11.2, “Use LDAP to Authenticate to the Management Interfaces”</a> for details on creating the security realm.
					</div></li></ul></div>

		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772530975184">
      ⁠</a><p class="title"><strong>Procedure 5.4. Configure Outbound LDAP with 2-way SSL</strong></p><ol class="1"><li class="step"><div class="para">
				Configure the security realm keystore and truststore. The security realm must contain a keystore configured with the key that the JBoss EAP 6 server will use to authenticate against the LDAP server. The security realm must also contain a truststore configured with the LDAP server's certificates. See <a class="xref" href="chap-Secure_the_Management_Interfaces.html#Using_2-way_SSL_for_the_Management_interface_and_the_CLI">Section 5.9, “Using 2-way SSL for the Management interface and the CLI”</a> for instructions on configuring keystores and truststores.
			</div></li><li class="step"><div class="para">
				Add the outbound connection to the LDAP server, specifying the configured security realm:
			</div><pre class="screen">/core-service=management/ldap-connection=LocalLdap:add(url="ldaps://<em class="replaceable">LDAP_HOST</em>:<em class="replaceable">LDAP_PORT</em>")

/core-service=management/ldap-connection=LocalLdap:write-attribute(name=security-realm,value="<em class="replaceable">LdapSSLRealm</em>")
</pre></li><li class="step"><div class="para">
				Configure LDAP authentication within the security realm and the management interfaces as shown in <a class="xref" href="chap-Secure_the_Management_Interfaces.html#Use_LDAP_to_Authenticate_to_the_Management_Interfaces1">Section 5.11.2, “Use LDAP to Authenticate to the Management Interfaces”</a>.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+34221-686364+%5BLatest%5D&amp;comment=Title%3A+Using+Outbound+LDAP+with+2-way+SSL+in+the+Management+Interface+and+CLI%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34221-686364+21+Jul+2014+02%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>