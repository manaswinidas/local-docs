<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 11. Authentication and Authorization</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Authentication_and_Authorization">
      ⁠</a>Chapter 11. Authentication and Authorization</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Kerberos_and_SPNEGO_Integration">
      ⁠</a>11.1. Kerberos and SPNEGO Integration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Kerberos_Integration">
      ⁠</a>11.1.1. About Kerberos and SPNEGO Integration</h2></div></div></div><div class="para">
		Kerberos is an authentication method that is designed for open network computing environments. It works on the basis of a ticket and authenticator to establish the identity of both the user and the server. It helps the two nodes communicating over a non secure environment to establish their identity to each other in a secured manner.
	</div><div class="para">
		SPNEGO is an authentication method used by a client application to authenticate itself to the server. This technology is used when the client application and the server trying to communicate with each other are not sure of the authentication protocol the other supports. SPNEGO determines the common GSSAPI mechanisms between the client application and the server and then dispatches all further security operations to it.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Kerberos and SPNEGO Integration</div>
			In a typical setup, the user logs into a desktop which is governed by the Active Directory domain. The user then uses the web browser, either Firebox or Internet Explorer, to access a web application that uses JBoss Negotiation hosted on the JBoss EAP. The web browser transfers the desktop sign on information to the web application. JBoss EAP uses background GSS messages with the Active Directory or any Kerberos Server to validate the user. This enables the user to achieve a seamless SSO into the web application.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24109-592544+%5BLatest%5D&amp;comment=Title%3A+About+Kerberos+and+SPNEGO+Integration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24109-592544+23+Feb+2014+16%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Desktop_SSO_using_SPNego">
      ⁠</a>11.1.2. Desktop SSO using SPNEGO</h2></div></div></div><div class="para">
		To configure the desktop SSO using SPNEGO configure the following:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Security Domain
			</div></li><li class="listitem"><div class="para">
				System Properties
			</div></li><li class="listitem"><div class="para">
				Web Application
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure pdf-break"><a id="idm139772534922960">
      ⁠</a><p class="title"><strong>Procedure 11.1. Configure Desktop SSO using SPNEGO</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure Security Domain</strong></p><div class="para">
				Configure the security domains to represent the identity of the server and to secure the web application.
			</div><div class="example"><a id="idm139772484291920">
      ⁠</a><p class="title"><strong>Example 11.1. Security Domain Configuration</strong></p><div class="example-contents"><pre class="programlisting">&lt;security-domains&gt;

    &lt;security-domain name="host" cache-type="default"&gt;

      &lt;authentication&gt;

        &lt;login-module code="Kerberos" flag="required"&gt;

          &lt;module-option name="storeKey" value="true"/&gt;

          &lt;module-option name="useKeyTab" value="true"/&gt;

          &lt;module-option name="principal" value="host/testserver@MY_REALM"/&gt;

          &lt;module-option name="keyTab" value="/home/username/service.keytab"/&gt;

          &lt;module-option name="doNotPrompt" value="true"/&gt;

          &lt;module-option name="debug" value="false"/&gt;

        &lt;/login-module&gt;

       &lt;/authentication&gt;

     &lt;/security-domain&gt;

   

     &lt;security-domain name="SPNEGO" cache-type="default"&gt;

       &lt;authentication&gt;

         &lt;login-module code="SPNEGO"  flag="requisite"&gt;

           &lt;module-option name="password-stacking" value="useFirstPass"/&gt;

           &lt;module-option name="serverSecurityDomain" value="host"/&gt;

         &lt;/login-module&gt;


         &lt;!-- Login Module For Roles Search --&gt;

       &lt;/security-domain&gt;

</pre></div></div></li><li class="step"><p class="title"><strong>Setup the System Properties</strong></p><div class="para">
				If required, the system properties can be set in the domain model.
			</div><div class="example"><a id="idm139772540509568">
      ⁠</a><p class="title"><strong>Example 11.2. Configure System Properties</strong></p><div class="example-contents"><pre class="programlisting">&lt;system-properties&gt;

      &lt;property name="java.security.krb5.kdc" value="mykdc.mydomain"/&gt;

      &lt;property name="java.security.krb5.realm" value="MY_REALM"/&gt;

    &lt;/system-properties&gt;

</pre></div></div></li><li class="step"><p class="title"><strong>Configure Web Application</strong></p><div class="para">
				It is not possible to override the authenticators, but it is possible to add the <code class="filename">NegotiationAuthenticator</code> as a valve to your jboss-web.xml descriptor to configure the web application.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The valve requires the <code class="code">security-constraint</code> and <code class="code">login-config</code> to be defined in the web.xml file as this is used to decide which resources are secured. However, the chosen <code class="code">auth-method</code> is overridden by this authenticator.
				</div></div></div><div class="example"><a id="idm139772568731584">
      ⁠</a><p class="title"><strong>Example 11.3. Configure Web Application</strong></p><div class="example-contents"><pre class="programlisting"> &lt;!DOCTYPE jboss-web PUBLIC
  "-//JBoss//DTD Web Application 2.4//EN"
  "http://www.jboss.org/j2ee/dtd/jboss-web_4_0.dtd"&gt;

  &lt;jboss-web&gt;

    &lt;security-domain&gt;SPNEGO&lt;/security-domain&gt;

    &lt;valve&gt;

      &lt;class-name&gt;org.jboss.security.negotiation.NegotiationAuthenticator&lt;/class-name&gt;

    &lt;/valve&gt;

  &lt;/jboss-web&gt;

</pre></div></div><div class="para">
				The web application also requires a dependency defining in <code class="filename">META-INF/MANIFEST.MF</code> so that the JBoss Negotiation classes can be located.
			</div><div class="example"><a id="idm139772545717408">
      ⁠</a><p class="title"><strong>Example 11.4. Define Dependency in <code class="filename">META-INF/MANIFEST.MF</code></strong></p><div class="example-contents"><pre class="programlisting">    Manifest-Version: 1.0

    Build-Jdk: 1.6.0_24

    Dependencies: org.jboss.security.negotiation

</pre></div></div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24110-688467+%5BLatest%5D&amp;comment=Title%3A+Desktop+SSO+using+SPNEGO%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24110-688467+28+Jul+2014+00%3A07+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_JBoss_Negotiation_for_Microsoft_Windows_Domain">
      ⁠</a>11.1.3. Configure JBoss Negotiation for Microsoft Windows Domain</h2></div></div></div><div class="para">
		This section describes how to configure the accounts required for JBoss Negotiation to be used when JBoss EAP is running on a Microsoft Windows server, which is a part of the Active Directory domain.
	</div><div class="para">
		In this section, the hostname that is used to access the server as is referred to as <code class="code">{hostname}</code>, realm is referred to as <code class="code">{realm}</code>, domain is referred to as <code class="code">{domain}</code>, and the server hosting the JBoss EAP instance is referred to as <code class="code">{machine_name}</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772486051504">
      ⁠</a><p class="title"><strong>Procedure 11.2. Configure JBoss Negotiation for Microsoft Windows Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Clear Existing Service Principal Mappings</strong></p><div class="para">
				On a Microsoft Windows network some mappings are created automatically. Delete the automatically created mappings to map the identity of the server to the service principal for negotiation to take place correctly. The mapping enables the web browser on the client computer to trust the server and attempt SPNEGO. The client computer verifies with the domain controller for a mapping in the form of <code class="code">HTTP{hostname}</code>.
			</div><div class="para">
				The following are the steps to delete the existing mappings:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						List the mapping registered with the domain for the computer using the command, <code class="code">setspn -L {machine_name}</code>.
					</div></li><li class="listitem"><div class="para">
						Delete the existing mappings using the commands, <code class="code">setspn -D HTTP/{hostname} {machine_name}</code> and <code class="code">setspn -D host/{hostname} {machine_name}</code>.
					</div></li></ul></div></li><li class="step"><div class="para">
				Create a host user account.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Ensure the host user name is different from the <code class="code">{machine_name}</code>.
				</div></div></div><div class="para">
				In the rest of the section the host user name is referred to as <code class="code">{user_name}</code>.
			</div></li><li class="step"><p class="title"><strong>Define the mapping between the <code class="code">{user_name}</code> and <code class="code">{hostname}</code>.</strong></p><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Run the following command to configure the Service Principal Mapping, <code class="code">ktpass -princ HTTP/{hostname}@{realm} -pass * -mapuser {domain}\{user_name}</code>.
					</div></li><li class="listitem"><div class="para">
						Enter the password for the user name when prompted. 
						<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
								Reset the password for the user name as it is a prerequisite for exporting the keytab.
							</div></div></div>

					</div></li><li class="listitem"><div class="para">
						Verify the mapping by running the following command, <code class="code">setspn -L {user_name}</code>
					</div></li></ul></div></li><li class="step"><p class="title"><strong>Export the keytab of the user to the server on which EAP JBoss is installed.</strong></p><div class="para">
				Run the following command to export the keytab, <code class="code">ktab -k service.keytab -a HTTP/{hostname}@{realm}</code>.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					This command exports the ticket for the HTTP/{hostname} principal to the keytab <code class="code">service.keytab</code>, which is used to configure the host security domain on JBoss.
				</div></div></div></li><li class="step"><div class="para">
				Define the principal within the security domain as follows:
			</div><div class="para">
				
<pre class="programlisting">&lt;module-option name="principal"&gt;HTTP/{hostname}@{realm}&lt;/module-option&gt;

</pre>

			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24328-592556+%5BLatest%5D&amp;comment=Title%3A+Configure+JBoss+Negotiation+for+Microsoft+Windows+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24328-592556+23+Feb+2014+16%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Kerberos_Authentication_for_PicketLink_IDP">
      ⁠</a>11.1.4. Kerberos Authentication for PicketLink IDP</h2></div></div></div><div class="para">
		The following sections explain how to set up Kerberos authentication for PicketLink IDP.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772557806256">
      ⁠</a><p class="title"><strong>Procedure 11.3. Install JBoss EAP 6 and setup Kerberos</strong></p><ol class="1"><li class="step"><div class="para">
				Download and install JBoss EAP 6. Refer to installation instructions in the <a href="https://access.redhat.com/site/documentation/en-US/JBoss_Enterprise_Application_Platform/6.2/html-single/Installation_Guide/index.html#proc-Zip_Installation">Installation Guide</a>.
			</div></li><li class="step"><div class="para">
				Whether you are using Oracle Java or IBM Java, you must use unlimited JCE. Without unlimited JCE, the JBoss server cannot negotiate on the proper SPNEGO mechanism type (using 1.3.6.1.5.2.5, which is <code class="filename">GSS_IAKERB_MECHANISM</code>).
			</div></li><li class="step"><div class="para">
				Use the example below to configure JBoss to use your desired Java version.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>export JAVA_HOME=JDK/JRE_directory</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772546505152">
      ⁠</a><p class="title"><strong>Procedure 11.4. Test your Kerberos setup using JBoss Negotiation Toolkit</strong></p><ol class="1"><li class="step"><div class="para">
				Use the JBoss Negotiation Toolkit available at <a href="https://github.com/wildfly-security/jboss-negotiation">Github</a>
			</div></li><li class="step"><div class="para">
				Modify the configuration files and use the <code class="command">mvn clean install</code> command to build the project.
			</div></li><li class="step"><div class="para">
				Copy the file <code class="filename">jboss-negotiation-toolkit/target/jboss-negotiation-toolkit.war</code> to <code class="filename">$JBOSS_HOME/standalone/deployments/</code>.
			</div></li><li class="step"><div class="para">
				Verify that all the three sections pass through the JBoss Negotiation Toolkit.
			</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772549142608">
      ⁠</a><p class="title"><strong>Procedure 11.5. Set up PicketLink IDP</strong></p><div class="para"><div class="title">Changes to <code class="filename">idp.war</code></div>
				The example provided uses the <code class="filename">idp.war</code> and <code class="filename">employee.war</code> archives, which can be located in the PicketLink Quickstarts repository. Modify the files in <code class="filename">idp.war</code> as described below.
			</div><ol class="1"><li class="step"><div class="para">
				Add <code class="filename">org.jboss.security.negotiation</code> module to <code class="filename">$JBOSS_HOME/standalone/deployments/idp.war/META-INF/jboss-deployment-structure.xml</code> because IDP is using the JBoss Negotiation module. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;jboss-deployment-structure&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;deployment&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Add picketlink module dependency --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.picketlink"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.security.negotiation"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;/jboss-deployment-structure&gt;</span>
</pre>

			</div></li><li class="step"><div class="para">
				Add an additional valve <code class="literal">org.jboss.security.negotiation.NegotiationAuthenticator</code> for SPNEGO to <code class="filename">$JBOSS_HOME/standalone/deployments/idp.war/WEB-INF/jboss-web.xml</code>.
			</div></li><li class="step"><div class="para">
				Change <code class="filename">security-domain</code> from <code class="literal">idp</code> to <code class="literal">SPNEGO</code> in <code class="filename">$JBOSS_HOME/standalone/deployments/idp.war/WEB-INF/jboss-web.xml</code> as follows: 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>SPNEGO<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;context-root&gt;</span>idp<span xmlns="" class="perl_Keyword">&lt;/context-root&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.picketlink.identity.federation.bindings.tomcat.idp.IDPWebBrowserSSOValve<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>passUserPrincipalToAttributeManager<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.security.negotiation.NegotiationAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre>

			</div></li><li class="step"><div class="para">
				Add or change the security-role added to your principal by Kerberos server setup to <code class="filename">$JBOSS_HOME/standalone/deployments/idp.war/WEB-INF/web.xml</code>.
			</div></li><li class="step"><div class="para">
				Modify the file <code class="filename">$JBOSS_HOME/standalone/deployments/idp.war/WEB-INF/picketlink.xml</code> as follows: 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;PicketLink</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:picketlink:identity-federation:config:2.1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;PicketLinkIDP</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:picketlink:identity-federation:config:2.1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;IdentityURL&gt;</span>${idp.url::http://localhost:8080/idp/}<span xmlns="" class="perl_Keyword">&lt;/IdentityURL&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;Trust&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;Domains&gt;</span>redhat.com,localhost,amazonaws.com<span xmlns="" class="perl_Keyword">&lt;/Domains&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/Trust&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/PicketLinkIDP&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;Handlers</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:picketlink:identity-federation:handler:config:2.1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;Handler</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.web.handlers.saml2.SAML2IssuerTrustHandler"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;Handler</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.web.handlers.saml2.SAML2LogOutHandler"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;Handler</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.web.handlers.saml2.SAML2AuthenticationHandler"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;Handler</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.web.handlers.saml2.RolesGenerationHandler"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/Handlers&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The configuration bellow defines a token timeout and a clock skew. Both 	configurations will be used during the SAML Assertion creation. This configuration is optional. It is defined only to show you how to set the token timeout and clock skew configuration.	--&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;PicketLinkSTS</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:picketlink:identity-federation:config:1.0"</span><span xmlns="" class="perl_Others"> TokenTimeout=</span><span xmlns="" class="perl_String">"5000"</span><span xmlns="" class="perl_Others"> ClockSkew=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;TokenProviders&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;TokenProvider</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       ProviderClass=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.core.saml.v1.providers.SAML11AssertionTokenProvider"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       TokenType=</span><span xmlns="" class="perl_String">"urn:oasis:names:tc:SAML:1.0:assertion"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       TokenElement=</span><span xmlns="" class="perl_String">"Assertion"</span><span xmlns="" class="perl_Others"> TokenElementNS=</span><span xmlns="" class="perl_String">"urn:oasis:names:tc:SAML:1.0:assertion"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;TokenProvider</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       ProviderClass=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.core.saml.v2.providers.SAML20AssertionTokenProvider"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       TokenType=</span><span xmlns="" class="perl_String">"urn:oasis:names:tc:SAML:2.0:assertion"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       TokenElement=</span><span xmlns="" class="perl_String">"Assertion"</span><span xmlns="" class="perl_Others"> TokenElementNS=</span><span xmlns="" class="perl_String">"urn:oasis:names:tc:SAML:2.0:assertion"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/TokenProviders&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/PicketLinkSTS&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/PicketLink&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

			</div></li><li class="step"><div class="para">
				Change <code class="literal">IdentityURL</code> to match the host name of server you are running IDP on.
			</div></li><li class="step"><div class="para">
				Change <code class="literal">Trust</code> to contain the domain names trusted by the Identity Provider.
			</div></li><li class="step"><div class="para">
				Modify the <code class="filename">employee.war</code>. Add or change security-roles added to your principal by Kerberos server setup to <code class="filename">$JBOSS_HOME/standalone/deployments/employee.war/WEB-INF/web.xml</code>.
			</div></li><li class="step"><div class="para">
				Modify the <code class="literal">security domain</code> configuration in the file <code class="filename">$JBOSS_HOME/standalone/configuration/standalone.xml</code>. Role mapping configuration is the same as that in normal security domain configurations.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Kerberos"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"principal"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"HTTP/something.com@yourdomain.COM"</span><span xmlns="" class="perl_Keyword">/&gt;</span>       <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"storeKey"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useKeyTab"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"doNotPrompt"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"keyTab"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/root/keytab"</span><span xmlns="" class="perl_Keyword">/&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SPNEGO"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>  
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>  
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"SPNEGO"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>  
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serverSecurityDomain"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Keyword">/&gt;</span>  
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>  
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"sp"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>  
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>  
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;login-module</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    	code=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.bindings.jboss.auth.SAML2LoginModule"</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      flag=</span><span xmlns="" class="perl_String">"required"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>  
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>
</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			In case of using IBM JDK, options for Kerberos module are different. You must set the system property <code class="literal">jboss.security.disable.secdomain.option</code> to <code class="literal">true</code>. Refer to <a class="xref" href="chap-Authentication_and_Authorization.html#Configure_Authentication_in_a_Security_Domain">Section 11.2.2, “Configure Authentication in a Security Domain”</a> for details. Update the login module to the following: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Kerberos"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"principal"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"HTTP/something.com@yourdomain.COM"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"credsType"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"acceptor"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useKeytab"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"file:///root/keytab"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772549910368">
      ⁠</a><p class="title"><strong>Procedure 11.6. Verify Kerberos authentication setup for PicketLink IDP</strong></p><ol class="1"><li class="step"><div class="para">
				Start JBoss EAP server using <code class="command">$JBOSS_HOME/bin/standalone.sh</code>.
			</div></li><li class="step"><div class="para">
				Setup your Kerberos system. There are a number of ways to do so. For example, using one of the following options: 
				<div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<a href="http://www.freeipa.org/">FreeIPA</a>: there are multiple configuration options. You must choose the one that is suitable to your setup.
						</div></li><li class="listitem"><div class="para">
							<a href="http://directory.apache.org/apacheds/kerberos-user-guide.html">ApacheDS </a>
						</div></li></ul></div>

			</div></li><li class="step"><div class="para">
				Setup your browser, for example Firefox, to use Kerberos. Follow the instructions provided here: <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/sso-config-firefox.html">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/sso-config-firefox.html</a>
			</div></li><li class="step"><div class="para">
				Verify that you are able to access the <code class="literal">http://YOUR_DOMAIN:8080/employee</code> from Firefox configured as mentioned above.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+30880-687801+%5BLatest%5D&amp;comment=Title%3A+Kerberos+Authentication+for+PicketLink+IDP%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30880-687801+24+Jul+2014+04%3A34+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Login_with_Certificate_with_PicketLink_IDP">
      ⁠</a>11.1.5. Login with Certificate with PicketLink IDP</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure IDP to Support SSL</div>
					You can configure the PicketLink IDP to support SSL. The following procedure is an example demonstrating how to configure a web application as an IDP supporting SSL client authentication. There are two ways to configure the IDP to authenticate users:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						If SSL is being used, the server will ask the client for a certificate and use this certificate to authenticate the user.
					</div></li><li class="listitem"><div class="para">
						If no certificate is provided by the client, a form-based authentication is performed.
					</div></li></ul></div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+IDs%3A%0A30876-639217+%5BLatest%5D&amp;comment=Title%3A+Login+with+Certificate+with+PicketLink+IDP%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="JBoss_EAP_6.3_SSL_Configuration">
      ⁠</a>11.1.5.1. JBoss EAP 6 SSL Configuration</h3></div></div></div><div class="para">
		The first thing you must do is create the certificates - the keystore and truststore that will be used during the entire configuration procedure.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772549293344">
      ⁠</a><p class="title"><strong>Procedure 11.7. Create the certificate, keystore, and truststore for your server</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create a Certificate for Your Server</strong></p><div class="para">
				Use the following command to create a certificate for your server: 
<pre class="programlisting">keytool -genkey -alias server -keyalg RSA -keystore server.keystore -storepass change_it -validity 365
</pre>
				 The system prompts you for additional information. You must provide the values as required. The CN name of the certificate must be the same as your DNS server name. For example, in case of localhost you could use the following command: 
<pre class="programlisting">keytool -genkey -alias server -keystore server.keystore -storepass change_it -keypass password -dname
"CN=localhost,OU=QE,O=example.com,L=Brno,C=CZ"
</pre>

			</div></li><li class="step"><p class="title"><strong>Create the Client Certificate</strong></p><div class="para">
				You will use this client certificate to authenticate against the server when accessing a resource through SSL. 
<pre class="programlisting">keytool -genkey -alias client -keystore client.keystore -storepass change_it -validity 365 -keyalg RSA -keysize 2048 -storetype pkcs12
</pre>

			</div></li><li class="step"><p class="title"><strong>Create the Truststore</strong></p><div class="para">
				Export the client's certificate and create a truststore by importing this certificate: 
<pre class="programlisting">keytool -exportcert -keystore client.keystore -storetype pkcs12 -storepass change_it -alias client -keypass change_it -file client.keystore
keytool -import -file client.keystore -alias client -keystore client.truststore
</pre>

			</div></li><li class="step"><p class="title"><strong>Change the JBoss EAP 6 Server Installation to Enable SSL</strong></p><div class="para">
				Add the following connector to the web subsystem to enable SSL: 
<pre class="programlisting">&lt;connector name="https" protocol="HTTP/1.1" scheme="https" socket-binding="https" enable-lookups="false" secure="true"&gt;
   &lt;ssl name="localhost-ssl" key-alias="server" password="change_it"
   certificate-key-file="${jboss.server.config.dir}/server.keystore"
   protocol="TLSv1"
   verify-client="want"
   ca-certificate-file="${jboss.server.config.dir}/client.truststore"/&gt;
&lt;/connector&gt;
</pre>

			</div></li><li class="step"><p class="title"><strong>Restart the Server</strong></p><div class="para">
				Restart the server and verify that it is responding on: <a href="https://localhost:8443">https://localhost:8443</a>
			</div></li><li class="step"><p class="title"><strong>Trust the Certificate</strong></p><div class="para">
				You will be prompted to trust the server certificate.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure the Client Certificate in your Browser</div>
			Before accessing the application, you must import the <code class="literal">client.keystore</code> to your browser. This file holds the client certificate. When you access the application, the browser prompts you to select the certificate you need to use to authenticate with the server. Select the desired certificate.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Security Domain Configuration</div>
			Add the following security domain to your server installation. If you're in standalone mode, you must add it to the <code class="code">JBOSS_HOME/standalone/configuration/standalone.xml</code>: 
<pre class="programlisting"> &lt;security-domain name="idp" cache-type="default"&gt;
   &lt;authentication&gt;
   &lt;login-module code="CertificateRoles" flag="optional"&gt;
   &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
   &lt;module-option name="securityDomain" value="idp"/&gt;
   &lt;module-option name="verifier" value="org.jboss.security.auth.certs.AnyCertVerifier"/&gt;
   &lt;/login-module&gt;
   
   &lt;login-module code="org.picketlink.identity.federation.bindings.jboss.auth.RegExUserNameLoginModule" flag="optional"&gt;
   &lt;module-option name="regex" value="CN=(.*?),"/&gt;
   &lt;/login-module&gt;
   
   &lt;login-module code="UsersRoles" flag="required"&gt;
   &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
   &lt;module-option name="usersProperties" value="users.properties"/&gt;
   &lt;module-option name="rolesProperties" value="roles.properties"/&gt;
   &lt;/login-module&gt;
   &lt;/authentication&gt;

   &lt;jsse keystore-password="change_it" keystore-url="${jboss.server.config.dir}" truststore-password="change_it" truststore-url="${jboss.server.config.dir}" client-auth="true"/&gt;
&lt;/security-domain&gt;

</pre>
			 The configuration example above validates any provided certificate. If no certificate is provided or if the authentication fails, the procedure falls back to a user/password based authentication.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Regular Expression User Name Login Module</div>
			The Regular Expression User Name Login module can be used after Certificate Login Modules to extract a username, UID or other field from the principal name so that roles can be obtained from LDAP. The module has an option named <code class="code">regex</code> which specifies the regular expression to be applied to the principal name, the result of which is passed on to the subsequent login module.
		</div><div class="para">
		In this example, an input principal name of <code class="code">UID=007, EMAILADDRESS=something@something, CN=James Bond, O=SpyAgency</code> would result in the output <code class="code">UID=007</code>.
	</div><div class="example"><a id="idm139772549134688">
      ⁠</a><p class="title"><strong>Example 11.5. Example of Regular Expression User Name Login Module</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.picketlink.identity.federation.bindings.jboss.auth.RegExUserNameLoginModule"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"regex"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"UID=(.*?),"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para">
		For further details about regular expressions, see <code class="code">java.util.regex.Pattern</code> class documentation at <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+30878-736848+%5BLatest%5D&amp;comment=Title%3A+JBoss+EAP+6+SSL+Configuration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30878-736848+19+Jan+2015+04%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Authentication">
      ⁠</a>11.2. Authentication</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Authentication1">
      ⁠</a>11.2.1. About Authentication</h2></div></div></div><div class="para">
		Authentication refers to identifying a subject and verifying the authenticity of the identification. The most common authentication mechanism is a username and password combination. Other common authentication mechanisms use shared keys, smart cards, or fingerprints. The outcome of a successful authentication is referred to as a principal, in terms of Java Enterprise Edition declarative security.
	</div><div class="para">
		JBoss EAP 6 uses a pluggable system of authentication modules to provide flexibility and integration with the authentication systems you already use in your organization. Each security domain may contain one or more configured authentication modules. Each module includes additional configuration parameters to customize its behavior. The easiest way to configure the authentication subsystem is within the web-based management console.
	</div><div class="para">
		Authentication is not the same as authorization, although they are often linked. Many of the included authentication modules can also handle authorization.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4723-742133+%5BLatest%5D&amp;comment=Title%3A+About+Authentication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4723-742133+09+Feb+2015+02%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Authentication_in_a_Security_Domain">
      ⁠</a>11.2.2. Configure Authentication in a Security Domain</h2></div></div></div><div class="para">
		To configure authentication settings for a security domain, log into the management console and follow this procedure.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772556042496">
      ⁠</a><p class="title"><strong>Procedure 11.8. Setup Authentication Settings for a Security Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the security domain's detailed view.</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Click the <span class="guilabel"><strong>Configuration</strong></span> label at the top of the management console.
					</div></li><li class="step"><div class="para">
						Select the profile to modify from the <span class="guilabel"><strong>Profile</strong></span> selection box at the top left of the Profile view.
					</div></li><li class="step"><div class="para">
						Expand the <span class="guilabel"><strong>Security</strong></span> menu, and select <span class="guilabel"><strong>Security Domains</strong></span>.
					</div></li><li class="step"><div class="para">
						Click the <span class="guilabel"><strong>View</strong></span> link for the security domain you want to edit.
					</div></li></ol></li><li class="step"><p class="title"><strong>Navigate to the Authentication subsystem configuration.</strong></p><div class="para">
				Select the <span class="guilabel"><strong>Authentication</strong></span> label at the top of the view if it is not already selected.
			</div><div class="para">
				The configuration area is divided into two areas: <span class="guilabel"><strong>Login Modules</strong></span> and <span class="guilabel"><strong>Details</strong></span>. The login module is the basic unit of configuration. A security domain can include several login modules, each of which can include several attributes and options.
			</div></li><li class="step"><p class="title"><strong>Add an authentication module.</strong></p><div class="para">
				Click <span class="guilabel"><strong>Add</strong></span> to add a JAAS authentication module. Fill in the details for your module.
			</div><div class="para">
				The <span class="guilabel"><strong>Code</strong></span> is the class name of the module. The <span class="guilabel"><strong>Flag</strong></span> setting controls how the module relates to other authentication modules within the same security domain.
			</div><div class="para"><div class="title">Explanation of the Flags</div>
					The Java Enterprise Edition 6 specification provides the following explanation of the flags for security modules. The following list is taken from <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html#AppendixA">http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html#AppendixA</a>. Refer to that document for more detailed information.
				</div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col/><col/></colgroup><thead><tr><th> Flag </th><th> Details </th></tr></thead><tbody><tr><td> required </td><td> <div class="para">
								The LoginModule is required to succeed. If it succeeds or fails, authentication still continues to proceed down the LoginModule list.
							</div>
							 </td></tr><tr><td> requisite </td><td> <div class="para">
								LoginModule is required to succeed. If it succeeds, authentication continues down the LoginModule list. If it fails, control immediately returns to the application (authentication does not proceed down the LoginModule list).
							</div>
							 </td></tr><tr><td> sufficient </td><td> <div class="para">
								The LoginModule is not required to succeed. If it does succeed, control immediately returns to the application (authentication does not proceed down the LoginModule list). If it fails, authentication continues down the LoginModule list.
							</div>
							 </td></tr><tr><td> optional </td><td> <div class="para">
								The LoginModule is not required to succeed. If it succeeds or fails, authentication still continues to proceed down the LoginModule list.
							</div>
							 </td></tr></tbody></table></div></li><li class="step"><p class="title"><strong>Edit authentication settings</strong></p><div class="para">
				After you have added your module, you can modify its <span class="guilabel"><strong>Code</strong></span> or <span class="guilabel"><strong>Flags</strong></span> by clicking <span class="guibutton"><strong>Edit</strong></span> in the <span class="guilabel"><strong>Details</strong></span> section of the screen. Be sure the <span class="guilabel"><strong>Attributes</strong></span> tab is selected.
			</div></li><li class="step"><p class="title"><strong>Optional: Add or remove module options.</strong></p><div class="para">
				If you need to add options to your module, click its entry in the <span class="guilabel"><strong>Login Modules</strong></span> list, and select the <span class="guilabel"><strong>Module Options</strong></span> tab in the <span class="guilabel"><strong>Details</strong></span> section of the page. Click the <span class="guibutton"><strong>Add</strong></span> button, and provide the key and value for the option. Use the <span class="guibutton"><strong>Remove</strong></span> button to remove an option.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your authentication module is added to the security domain, and is immediately available to applications which use the security domain.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">The <code class="code">jboss.security.security_domain</code> Module Option</div>
			By default, each login module defined in a security domain has the <code class="code">jboss.security.security_domain</code> module option added to it automatically. This option causes problems with login modules which check to make sure that only known options are defined. The IBM Kerberos login module, <code class="code">com.ibm.security.auth.module.Krb5LoginModule</code> is one of these.
		</div><div class="para">
		You can disable the behavior of adding this module option by setting the system property to <code class="code">true</code> when starting JBoss EAP 6. Add the following to your start-up parameters.
	</div><pre class="screen">-Djboss.security.disable.secdomain.option=true</pre><div class="para">
		You can also set this property using the web-based Management Console. In a standalone server, you can set system properties in the <span class="guilabel"><strong>Profile</strong></span> section of the configuration. In a managed domain, you can set system properties for each server group.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4724-632151+%5BLatest%5D&amp;comment=Title%3A+Configure+Authentication+in+a+Security+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4724-632151+16+Apr+2014+21%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JAAS_-_Java_Authentication_and_Authorization_Service">
      ⁠</a>11.3. JAAS - Java Authentication and Authorization Service</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_JAAS">
      ⁠</a>11.3.1. About JAAS</h2></div></div></div><div class="para">
		JAAS is the Java Authentication and Authorization Service. It is part of the Java EE Spec, and allows for pluggable authentication and authorization to abstract applications from security providers.
	</div><div class="para">
		The JAAS 1.0 API consists of a set of Java packages designed for user authentication and authorization. The API implements a Java version of the standard Pluggable Authentication Modules (PAM) framework and extends the Java 2 Platform access control architecture to support user-based authorization.
	</div><div class="para">
		JAAS authentication is performed in a pluggable fashion. This permits Java applications to remain independent from underlying authentication technologies, and allows the security manager to work in different security infrastructures. Integration with a security infrastructure is achievable without changing the security manager implementation. You need only change the configuration of the authentication stack JAAS uses.
	</div><div class="para">
		Refer to the <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html">Java EE JAAS Documentation</a> for further information on JAAS.
	</div><div class="para">
		The JBoss Enterprise Application Platform 6 security subsystem is based on the JAAS API.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24380-686357+%5BLatest%5D&amp;comment=Title%3A+About+JAAS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24380-686357+21+Jul+2014+02%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="JAAS_Core_Classes">
      ⁠</a>11.3.2. JAAS Core Classes</h2></div></div></div><div class="para">
		The JAAS core classes can be broken down into three categories: common, authentication, and authorization. The following list presents only the common and authentication classes because these are the specific classes used to implement the functionality of the EAP security subsystem covered in this chapter.
	</div><div class="para">
		These are the common classes:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">Subject</code> (<code class="classname">javax.security.auth.Subject</code>)
			</div></li></ul></div><div class="para">
		These are the authentication classes:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">Configuration</code> (<code class="classname">javax.security.auth.login.Configuration</code>)
			</div></li><li class="listitem"><div class="para">
				<code class="literal">LoginContext</code> (<code class="classname">javax.security.auth.login.LoginContext</code>)
			</div></li></ul></div><div class="para">
		These are the associated interfaces:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">Principal</code> (<code class="classname">java.security.Principal</code>)
			</div></li><li class="listitem"><div class="para">
				<code class="literal">Callback</code> (<code class="classname">javax.security.auth.callback.Callback</code>)
			</div></li><li class="listitem"><div class="para">
				<code class="literal">CallbackHandler</code> (<code class="classname">javax.security.auth.callback.CallbackHandler</code>)
			</div></li><li class="listitem"><div class="para">
				<code class="literal">LoginModule</code> (<code class="classname">javax.security.auth.spi.LoginModule</code>)
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24101-686358+%5BLatest%5D&amp;comment=Title%3A+JAAS+Core+Classes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24101-686358+21+Jul+2014+02%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Subject_and_Principal_classes">
      ⁠</a>11.3.3. Subject and Principal classes</h2></div></div></div><div class="para">
		To authorize access to resources, applications must first authenticate the request's source. The JAAS framework defines the term subject to represent a request's source. The <code class="classname">Subject</code> class is the central class in JAAS. A <code class="classname">Subject</code> represents information for a single entity, such as a person or service. It encompasses the entity's principals, public credentials, and private credentials. The JAAS API uses the existing Java 2 <code class="classname">java.security.Principal</code> interface to represent a principal, which is essentially a typed name.
	</div><div class="para">
		During the authentication process, a subject is populated with associated identities, or principals. A subject may have many principals. For example, a person may have a name principal (John Doe), a social security number principal (123-45-6789), and a user name principal (johnd), all of which help distinguish the subject from other subjects. To retrieve the principals associated with a subject, two methods are available:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getPrincipals</span>() {...}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getPrincipals</span>(<span xmlns="" class="perl_Keyword">Class</span> c) {...}
</pre><div class="para">
		<code class="methodname">getPrincipals()</code> returns all principals contained in the subject. <code class="methodname">getPrincipals(Class c)</code> returns only those principals that are instances of class <code class="literal">c</code> or one of its subclasses. An empty set is returned if the subject has no matching principals.
	</div><div class="para">
		Note that the <code class="classname">java.security.acl.Group</code> interface is a sub-interface of <code class="classname">java.security.Principal</code>, so an instance in the principals set may represent a logical grouping of other principals or groups of principals.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24102-685967+%5BLatest%5D&amp;comment=Title%3A+Subject+and+Principal+classes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24102-685967+18+Jul+2014+05%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Subject_Authentication">
      ⁠</a>11.3.4. Subject Authentication</h2></div></div></div><div class="para">
		Subject Authentication requires a JAAS login. For a description of the JAAS Login Configuration file, refer to <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jgss/tutorials/LoginConfigFile.html">JAAS Login Configuration File</a> in the Java documentation.
	</div><div class="para">
		The login process consists of the following points:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
				An application instantiates a <code class="literal">LoginContext</code> and passes in the name of the login configuration and a <code class="literal">CallbackHandler</code> to populate the <code class="literal">Callback</code> objects, as required by the configuration <code class="literal">LoginModule</code>s.
			</div></li><li class="listitem"><div class="para">
				The <code class="literal">LoginContext</code> consults a <code class="literal">Configuration</code> to load all the <code class="literal">LoginModules</code> included in the named login configuration. If no such named configuration exists the <code class="literal">other</code> configuration is used as a default.
			</div></li><li class="listitem"><div class="para">
				The application invokes the <code class="methodname">LoginContext.login</code> method.
			</div></li><li class="listitem"><div class="para">
				The login method invokes each loaded <code class="literal">LoginModule</code>. As each <code class="literal">LoginModule</code> attempts to authenticate the subject, it invokes the handle method on the associated <code class="literal">CallbackHandler</code> to obtain the information required for the authentication process. The required information is passed to the handle method in the form of an array of <code class="literal">Callback</code> objects. Upon success, the <code class="literal">LoginModule</code>s associate relevant principals and credentials with the subject.
			</div></li><li class="listitem"><div class="para">
				The <code class="literal">LoginContext</code> returns the authentication status to the application. Success is represented by a return from the login method. Failure is represented through a LoginException being thrown by the login method.
			</div></li><li class="listitem"><div class="para">
				If authentication succeeds, the application retrieves the authenticated subject using the <code class="methodname">LoginContext.getSubject</code> method.
			</div></li><li class="listitem"><div class="para">
				After the scope of the subject authentication is complete, all principals and related information associated with the subject by the <code class="literal">login</code> method can be removed by invoking the <code class="methodname">LoginContext.logout</code> method.
			</div></li></ol></div><div class="para">
		The <code class="classname">LoginContext</code> class provides the basic methods for authenticating subjects and offers a way to develop an application that is independent of the underlying authentication technology. The <code class="classname">LoginContext</code> consults a <code class="literal">Configuration</code> to determine the authentication services configured for a particular application. <code class="classname">LoginModule</code> classes represent the authentication services. Therefore, you can plug different login modules into an application without changing the application itself. The following code shows the steps required by an application to authenticate a subject.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>CallbackHandler handler = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">MyHandler</span>();
<span xmlns="" class="line">​</span>LoginContext lc = <span xmlns="" class="perl_Keyword">new</span> LoginContext(<span xmlns="" class="perl_String">"some-config"</span>, handler);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    lc.<span xmlns="" class="perl_Function">login</span>();
<span xmlns="" class="line">​</span>    Subject subject = lc.<span xmlns="" class="perl_Function">getSubject</span>();
<span xmlns="" class="line">​</span>} <span xmlns="" class="perl_Keyword">catch</span>(LoginException e) {
<span xmlns="" class="line">​</span>    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"authentication failed"</span>);
<span xmlns="" class="line">​</span>    e.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>                        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Perform work as authenticated Subject</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Scope of work complete, logout to remove authentication info</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    lc.<span xmlns="" class="perl_Function">logout</span>();
<span xmlns="" class="line">​</span>} <span xmlns="" class="perl_Keyword">catch</span>(LoginException e) {
<span xmlns="" class="line">​</span>    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"logout failed"</span>);
<span xmlns="" class="line">​</span>    e.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>                        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// A sample MyHandler class</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">class</span> MyHandler 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">implements</span> CallbackHandler
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handle</span>(Callback[] callbacks) <span xmlns="" class="perl_Keyword">throws</span>
<span xmlns="" class="line">​</span>        IOException, UnsupportedCallbackException
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> i = <span xmlns="" class="perl_Float">0</span>; i &lt; callbacks.<span xmlns="" class="perl_Function">length</span>; i++) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (callbacks[i] <span xmlns="" class="perl_Keyword">instanceof</span> NameCallback) {
<span xmlns="" class="line">​</span>                NameCallback nc = (NameCallback)callbacks[i];
<span xmlns="" class="line">​</span>                nc.<span xmlns="" class="perl_Function">setName</span>(username);
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span> (callbacks[i] <span xmlns="" class="perl_Keyword">instanceof</span> PasswordCallback) {
<span xmlns="" class="line">​</span>                PasswordCallback pc = (PasswordCallback)callbacks[i];
<span xmlns="" class="line">​</span>                pc.<span xmlns="" class="perl_Function">setPassword</span>(password);
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> UnsupportedCallbackException(callbacks[i],
<span xmlns="" class="line">​</span>                                                       <span xmlns="" class="perl_String">"Unrecognized Callback"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
		Developers integrate with an authentication technology by creating an implementation of the <code class="literal">LoginModule</code> interface. This allows an administrator to plug different authentication technologies into an application. You can chain together multiple <code class="literal">LoginModule</code>s to allow for more than one authentication technology to participate in the authentication process. For example, one <code class="literal">LoginModule</code> may perform user name/password-based authentication, while another may interface to hardware devices such as smart card readers or biometric authenticators.
	</div><div class="para">
		The life cycle of a <code class="literal">LoginModule</code> is driven by the <code class="literal">LoginContext</code> object against which the client creates and issues the login method. The process consists of two phases. The steps of the process are as follows:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				The <code class="literal">LoginContext</code> creates each configured <code class="literal">LoginModule</code> using its public no-arg constructor.
			</div></li><li class="listitem"><div class="para">
				Each <code class="literal">LoginModule</code> is initialized with a call to its initialize method. The <code class="literal">Subject</code> argument is guaranteed to be non-null. The signature of the initialize method is: <code class="methodname">public void initialize(Subject subject, CallbackHandler callbackHandler, Map sharedState, Map options)</code>
			</div></li><li class="listitem"><div class="para">
				The <code class="methodname">login</code> method is called to start the authentication process. For example, a method implementation might prompt the user for a user name and password and then verify the information against data stored in a naming service such as NIS or LDAP. Alternative implementations might interface to smart cards and biometric devices, or simply extract user information from the underlying operating system. The validation of user identity by each <code class="literal">LoginModule</code> is considered phase 1 of JAAS authentication. The signature of the <code class="methodname">login</code> method is <code class="methodname">boolean login() throws LoginException</code> . A <code class="literal">LoginException</code> indicates failure. A return value of true indicates that the method succeeded, whereas a return value of false indicates that the login module should be ignored.
			</div></li><li class="listitem"><div class="para">
				If the <code class="literal">LoginContext</code>'s overall authentication succeeds, <code class="literal">commit</code> is invoked on each <code class="literal">LoginModule</code>. If phase 1 succeeds for a <code class="literal">LoginModule</code>, then the commit method continues with phase 2 and associates the relevant principals, public credentials, and/or private credentials with the subject. If phase 1 fails for a <code class="literal">LoginModule</code>, then <code class="literal">commit</code> removes any previously stored authentication state, such as user names or passwords. The signature of the <code class="methodname">commit</code> method is: <code class="methodname">boolean commit() throws LoginException</code> . Failure to complete the commit phase is indicated by throwing a <code class="literal">LoginException</code>. A return of true indicates that the method succeeded, whereas a return of false indicates that the login module should be ignored.
			</div></li><li class="listitem"><div class="para">
				If the <code class="literal">LoginContext</code>'s overall authentication fails, then the <code class="methodname">abort</code> method is invoked on each <code class="literal">LoginModule</code>. The <code class="literal">abort</code> method removes or destroys any authentication state created by the login or initialize methods. The signature of the <code class="literal">abort</code> method is <code class="methodname">boolean abort() throws LoginException</code> . Failure to complete the <code class="literal">abort</code> phase is indicated by throwing a <code class="literal">LoginException</code>. A return of true indicates that the method succeeded, whereas a return of false indicates that the login module should be ignored.
			</div></li><li class="listitem"><div class="para">
				To remove the authentication state after a successful login, the application invokes <code class="literal">logout</code> on the <code class="literal">LoginContext</code>. This in turn results in a <code class="methodname">logout</code> method invocation on each <code class="literal">LoginModule</code>. The <code class="methodname">logout</code> method removes the principals and credentials originally associated with the subject during the <code class="literal">commit</code> operation. Credentials should be destroyed upon removal. The signature of the <code class="methodname">logout</code> method is: <code class="methodname">boolean logout() throws LoginException</code> . Failure to complete the logout process is indicated by throwing a <code class="literal">LoginException</code>. A return of true indicates that the method succeeded, whereas a return of false indicates that the login module should be ignored.
			</div></li></ul></div><div class="para">
		When a <code class="literal">LoginModule</code> must communicate with the user to obtain authentication information, it uses a <code class="literal">CallbackHandler</code> object. Applications implement the <span class="interface"> CallbackHandler </span> interface and pass it to the <code class="literal">LoginContext</code>, which send the authentication information directly to the underlying login modules.
	</div><div class="para">
		Login modules use the <code class="literal">CallbackHandler</code> both to gather input from users, such as a password or smart card PIN, and to supply information to users, such as status information. By allowing the application to specify the <code class="literal">CallbackHandler</code>, underlying <code class="literal">LoginModule</code>s remain independent from the different ways applications interact with users. For example, a <code class="literal">CallbackHandler</code>'s implementation for a GUI application might display a window to solicit user input. On the other hand, a <code class="literal">CallbackHandler</code> implementation for a non-GUI environment, such as an application server, might simply obtain credential information by using an application server API. The <span class="interface"> CallbackHandler </span> interface has one method to implement:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handle</span>(Callback[] callbacks)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> java.<span xmlns="" class="perl_Function">io</span>.<span xmlns="" class="perl_Function">IOException</span>, 
<span xmlns="" class="line">​</span>           UnsupportedCallbackException;
</pre><div class="para">
		The <code class="literal">Callback</code> interface is the last authentication class we will look at. This is a tagging interface for which several default implementations are provided, including the <code class="literal">NameCallback</code> and <code class="literal">PasswordCallback</code> used in an earlier example. A <code class="literal">LoginModule</code> uses a <code class="literal">Callback</code> to request information required by the authentication mechanism. <code class="literal">LoginModule</code>s pass an array of <code class="literal">Callback</code>s directly to the <code class="methodname">CallbackHandler.handle</code> method during the authentication's login phase. If a <code class="literal">callbackhandler</code> does not understand how to use a <code class="literal">Callback</code> object passed into the handle method, it throws an <code class="literal">UnsupportedCallbackException</code> to abort the login call.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24103-686005+%5BLatest%5D&amp;comment=Title%3A+Subject+Authentication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24103-686005+18+Jul+2014+08%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Java_Authentication_SPI_for_Containers_JASPI">
      ⁠</a>11.4. Java Authentication SPI for Containers (JASPI)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Authentication_SPI_for_Containers_JASPI_Security1">
      ⁠</a>11.4.1. About Java Authentication SPI for Containers (JASPI) Security</h2></div></div></div><div class="para">
		Java Authentication SPI for Containers (JASPI or JASPIC) is a pluggable interface for Java applications. It is defined in JSR-196 of the Java Community Process. Refer to <a href="http://www.jcp.org/en/jsr/detail?id=196">http://www.jcp.org/en/jsr/detail?id=196</a> for details about the specification.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+7199-687581+%5BLatest%5D&amp;comment=Title%3A+About+Java+Authentication+SPI+for+Containers+%28JASPI%29+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7199-687581+23+Jul+2014+08%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Java_Authentication_SPI_for_Containers_JASPI_Security1">
      ⁠</a>11.4.2. Configure Java Authentication SPI for Containers (JASPI) Security</h2></div></div></div><div class="para">
		To authenticate against a JASPI provider, add a <code class="sgmltag-element">&lt;authentication-jaspi&gt;</code> element to your security domain. The configuration is similar to a standard authentication module, but login module elements are enclosed in a <code class="sgmltag-element">&lt;login-module-stack&gt;</code> element. The structure of the configuration is:
	</div><div class="example"><a id="idm139772524641680">
      ⁠</a><p class="title"><strong>Example 11.6. Structure of the <code class="literal">authentication-jaspi</code> element</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;authentication-jaspi&gt;
<span xmlns="" class="line">​</span>	&lt;login-module-stack name=<span xmlns="" class="perl_String">"..."</span>&gt;
<span xmlns="" class="line">​</span>	  &lt;login-module code=<span xmlns="" class="perl_String">"..."</span> flag=<span xmlns="" class="perl_String">"..."</span>&gt;
<span xmlns="" class="line">​</span>	    &lt;module-option name=<span xmlns="" class="perl_String">"..."</span> value=<span xmlns="" class="perl_String">"..."</span>/&gt;
<span xmlns="" class="line">​</span>	  &lt;/login-module&gt;
<span xmlns="" class="line">​</span>	&lt;/login-module-stack&gt;
<span xmlns="" class="line">​</span>	&lt;auth-module code=<span xmlns="" class="perl_String">"..."</span> login-module-stack-ref=<span xmlns="" class="perl_String">"..."</span>&gt;
<span xmlns="" class="line">​</span>	  &lt;module-option name=<span xmlns="" class="perl_String">"..."</span> value=<span xmlns="" class="perl_String">"..."</span>/&gt;
<span xmlns="" class="line">​</span>	&lt;/auth-module&gt;
<span xmlns="" class="line">​</span>&lt;/authentication-jaspi&gt;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para">
		The login module itself is configured in exactly the same way as a standard authentication module.
	</div><div class="para">
		Because the web-based management console does not expose the configuration of JASPI authentication modules, you need to stop JBoss EAP 6 completely before adding the configuration directly to <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/domain.xml</code> or <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/standalone.xml</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4934-591678+%5BLatest%5D&amp;comment=Title%3A+Configure+Java+Authentication+SPI+for+Containers+%28JASPI%29+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4934-591678+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Authorization">
      ⁠</a>11.5. Authorization</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Authorization1">
      ⁠</a>11.5.1. About Authorization</h2></div></div></div><div class="para">
		Authorization is a mechanism for granting or denying access to a resource based on identity. It is implemented as a set of declarative security roles which can be added to principals.
	</div><div class="para">
		JBoss EAP 6 uses a modular system to configure authorization. Each security domain may contain one or more authorization policies. Each policy has a basic module which defines its behavior. It is configured through specific flags and attributes. The easiest way to configure the authorization subsystem is by using the web-based management console.
	</div><div class="para">
		Authorization is different from authentication, and usually happens after authentication. Many of the authentication modules also handle authorization.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4725-744990+%5BLatest%5D&amp;comment=Title%3A+About+Authorization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4725-744990+26+Feb+2015+05%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Authorization_in_a_Security_Domain1">
      ⁠</a>11.5.2. Configure Authorization in a Security Domain</h2></div></div></div><div class="para">
		To configure authorization settings for a security domain, log into the management console and follow this procedure.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772546253536">
      ⁠</a><p class="title"><strong>Procedure 11.9. Setup Authorization in a Security Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the security domain's detailed view.</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Click the <span class="guilabel"><strong>Configuration</strong></span> label at the top of the management console.
					</div></li><li class="step"><div class="para">
						In a managed domain, select the profile to modify from the <span class="guilabel"><strong>Profile</strong></span> drop down box at the top left.
					</div></li><li class="step"><div class="para">
						Expand the <span class="guilabel"><strong>Security</strong></span> menu item, and select <span class="guilabel"><strong>Security Domains</strong></span>.
					</div></li><li class="step"><div class="para">
						Click the <span class="guilabel"><strong>View</strong></span> link for the security domain you want to edit.
					</div></li></ol></li><li class="step"><p class="title"><strong>Navigate to the Authorization subsystem configuration.</strong></p><div class="para">
				Select the <span class="guilabel"><strong>Authorization</strong></span> label at the top of the screen.
			</div><div class="para">
				The configuration area is divided into two areas: <span class="guilabel"><strong>Policies</strong></span> and <span class="guilabel"><strong>Details</strong></span>. The login module is the basic unit of configuration. A security domain can include several authorization policies, each of which can include several attributes and options.
			</div></li><li class="step"><p class="title"><strong>Add a policy.</strong></p><div class="para">
				Click <span class="guilabel"><strong>Add</strong></span> to add a JAAS authorization policy module. Fill in the details for your module.
			</div><div class="para">
				The <span class="guilabel"><strong>Code</strong></span> is the class name of the module. The <span class="guilabel"><strong>Flag</strong></span> controls how the module relates to other authorization policy modules within the same security domain.
			</div><div class="para"><div class="title">Explanation of the Flags</div>
					The Java Enterprise Edition 6 specification provides the following explanation of the flags for security modules. The following list is taken from <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html#AppendixA">http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html#AppendixA</a>. Refer to that document for more detailed information.
				</div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col/><col/></colgroup><thead><tr><th> Flag </th><th> Details </th></tr></thead><tbody><tr><td> required </td><td> <div class="para">
								The LoginModule is required to succeed. If it succeeds or fails, authorization still continues to proceed down the LoginModule list.
							</div>
							 </td></tr><tr><td> requisite </td><td> <div class="para">
								LoginModule is required to succeed. If it succeeds, authorization continues down the LoginModule list. If it fails, control immediately returns to the application (authorization does not proceed down the LoginModule list).
							</div>
							 </td></tr><tr><td> sufficient </td><td> <div class="para">
								The LoginModule is not required to succeed. If it does succeed, control immediately returns to the application (authorization does not proceed down the LoginModule list). If it fails, authorization continues down the LoginModule list.
							</div>
							 </td></tr><tr><td> optional </td><td> <div class="para">
								The LoginModule is not required to succeed. If it succeeds or fails, authorization still continues to proceed down the LoginModule list.
							</div>
							 </td></tr></tbody></table></div></li><li class="step"><p class="title"><strong>Edit authorization settings</strong></p><div class="para">
				After you have added your module, you can modify its <span class="guilabel"><strong>Code</strong></span> or <span class="guilabel"><strong>Flags</strong></span> by clicking <span class="guibutton"><strong>Edit</strong></span> in the <span class="guilabel"><strong>Details</strong></span> section of the screen. Be sure the <span class="guilabel"><strong>Attributes</strong></span> tab is selected.
			</div></li><li class="step"><p class="title"><strong>Optional: Add or remove module options.</strong></p><div class="para">
				If you need to add options to your module, click its entry in the <span class="guilabel"><strong>Policies</strong></span> list, and select the <span class="guilabel"><strong>Module Options</strong></span> tab in the <span class="guilabel"><strong>Details</strong></span> section of the page. Click <span class="guibutton"><strong>Add</strong></span> and provide the key and value for the option. Use the <span class="guibutton"><strong>Remove</strong></span> button to remove an option.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your authorization policy module is added to the security domain, and is immediately available to applications which use the security domain.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4726-675486+%5BLatest%5D&amp;comment=Title%3A+Configure+Authorization+in+a+Security+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4726-675486+23+Jun+2014+13%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Java_Authorization_Contract_for_Containers_JACC">
      ⁠</a>11.6. Java Authorization Contract for Containers (JACC)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Authorization_Contract_for_Containers_JACC">
      ⁠</a>11.6.1. About Java Authorization Contract for Containers (JACC)</h2></div></div></div><div class="para">
		Java Authorization Contract for Containers (JACC) is a standard which defines a contract between containers and authorization service providers, which results in the implementation of providers for use by containers. It was defined in JSR-115, which can be found on the Java Community Process website at <a href="http://jcp.org/en/jsr/detail?id=115">http://jcp.org/en/jsr/detail?id=115</a>. It has been part of the core Java Enterprise Edition (Java EE) specification since Java EE version 1.3.
	</div><div class="para">
		JBoss EAP 6 implements support for JACC within the security functionality of the security subsystem.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+7687-591801+%5BLatest%5D&amp;comment=Title%3A+About+Java+Authorization+Contract+for+Containers+%28JACC%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7687-591801+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Java_Authorization_Contract_for_Containers_JACC_Security">
      ⁠</a>11.6.2. Configure Java Authorization Contract for Containers (JACC) Security</h2></div></div></div><div class="para">
		To configure Java Authorization Contract for Containers (JACC), you need to configure your security domain with the correct module, and then modify your <code class="filename">jboss-web.xml</code> to include the correct parameters.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Add JACC Support to the Security Domain</div>
			To add JACC support to the security domain, add the <code class="literal">JACC</code> authorization policy to the authorization stack of the security domain, with the <code class="literal">required</code> flag set. The following is an example of a security domain with JACC support. However, the security domain is configured in the Management Console or Management CLI, rather than directly in the XML.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jacc"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"UsersRoles"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;authorization&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;policy-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"JACC"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/authorization&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure a Web Application to Use JACC</div>
			The <code class="filename">jboss-web.xml</code> is located in the <code class="filename">WEB-INF/</code> directory of your deployment, and contains overrides and additional JBoss-specific configuration for the web container. To use your JACC-enabled security domain, you need to include the <code class="sgmltag-element">&lt;security-domain&gt;</code> element, and also set the <code class="sgmltag-element">&lt;use-jboss-authorization&gt;</code> element to <code class="literal">true</code>. The following application is properly configured to use the JACC security domain above.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>jacc<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;use-jboss-authorization&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/use-jboss-authorization&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure an EJB Application to Use JACC</div>
			Configuring EJBs to use a security domain and to use JACC differs from Web Applications. For an EJB, you can declare <em class="firstterm">method permissions</em> on a method or group of methods, in the <code class="filename">ejb-jar.xml</code> descriptor. Within the <code class="sgmltag-element">&lt;ejb-jar&gt;</code> element, any child <code class="sgmltag-element">&lt;method-permission&gt;</code> elements contain information about JACC roles. Refer to the example configuration for more details. The <code class="code">EJBMethodPermission</code> class is part of the Java Enterprise Edition 6 API, and is documented at <a href="http://docs.oracle.com/javaee/6/api/javax/security/jacc/EJBMethodPermission.html">http://docs.oracle.com/javaee/6/api/javax/security/jacc/EJBMethodPermission.html</a>.
		</div><div class="example"><a id="idm139772538694816">
      ⁠</a><p class="title"><strong>Example 11.7. Example JACC Method Permissions in an EJB</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The employee and temp-employee roles may access any method of the EmployeeService bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>temp-employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeService<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para">
		You can also constrain the authentication and authorization mechanisms for an EJB by using a security domain, just as you can do for a web application. Security domains are declared in the <code class="filename">jboss-ejb3.xml</code> descriptor, in the <code class="sgmltag-element">&lt;security&gt;</code> child element. In addition to the security domain, you can also specify the <code class="sgmltag-element">&lt;run-as-principal&gt;</code>, which changes the principal the EJB runs as.
	</div><div class="example"><a id="idm139772534367392">
      ⁠</a><p class="title"><strong>Example 11.8. Example Security Domain Declaration in an EJB</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span> 
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;security&gt;</span>
<span xmlns="" class="line">​</span>  		<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>  		<span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>myDomain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>  		<span xmlns="" class="perl_Keyword">&lt;run-as-principal&gt;</span>myPrincipal<span xmlns="" class="perl_Keyword">&lt;/run-as-principal&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;/security&gt;</span>
<span xmlns="" class="line">​</span> 	<span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4933-744942+%5BLatest%5D&amp;comment=Title%3A+Configure+Java+Authorization+Contract+for+Containers+%28JACC%29+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4933-744942+25+Feb+2015+14%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Fine_Grained_Authorization_Using_XACML">
      ⁠</a>11.6.3. Fine Grained Authorization Using XACML</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Grained_Authorization">
      ⁠</a>11.6.3.1. About Fine Grained Authorization and XACML</h3></div></div></div><div class="para">
		Fine Grained Authorization caters to the changing requirements and multiple variables involved in the decision making process, which becomes the basis of providing authorization for accessing a module. Hence, the process of Fine Grained Authorization is complex in itself.
	</div><div class="para">
		JBoss uses XACML as a medium to achieve Fine Grained Authorization. XACML provides standards based solution to the complex nature of achieving Fine Grained Authorization. XACML defines a policy language and an architecture for decision making. The XACML architecture includes a Policy Enforcement Point (PEP), which intercepts any requests in a normal program flow, then asks a Policy Decision Point (PDP) to make an access decision based on the policies associated with the PDP. The PDP evaluates the XACML request created by the PEP and runs through the policies to make one of the following access decisions: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					PERMIT - The access is approved.
				</div></li><li class="listitem"><div class="para">
					DENY - The access is denied.
				</div></li><li class="listitem"><div class="para">
					INDETERMINATE - There is an error at the PDP.
				</div></li><li class="listitem"><div class="para">
					NOTAPPLICABLE - There is some attribute missing in the request or there is no policy match.
				</div></li></ul></div>

	</div><div class="para">
		The following are the features of the XACML:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Oasis XACML v2.0 library
			</div></li><li class="listitem"><div class="para">
				JAXB v2.0 based object model
			</div></li><li class="listitem"><div class="para">
				ExistDB Integration for storing/retrieving XACML Policies and Attributes
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24111-592544+%5BLatest%5D&amp;comment=Title%3A+About+Fine+Grained+Authorization+and+XACML%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24111-592544+23+Feb+2014+16%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_XACML_for_Fine_Grained_Authorization">
      ⁠</a>11.6.3.2. Configure XACML for Fine Grained Authorization</h3></div></div></div><div class="para">
		The following is the procedure to configure XACML.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772567618816">
      ⁠</a><p class="title"><strong>Procedure 11.10. Configure XACML</strong></p><ol class="1"><li class="step"><div class="para">
				Download the library which is a single jar file. 

			</div></li><li class="step"><p class="title"><strong>Create one or more policy files for XACML</strong></p><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Under the <code class="filename">WEB-INF/classes</code>, create a <code class="filename">policies</code> directory to save all your policies.
					</div></li><li class="listitem"><div class="para">
						Create a <code class="filename">policyConfig.xml</code> under <code class="filename">WEB-INF/classes</code> directory.
					</div><div class="para">
						The following are the two types of policy sets can be defined:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								Role Permission Policy Sets (RPS)
							</div></li><li class="listitem"><div class="para">
								Permission Policy Sets (PPS)
							</div></li></ul></div></li></ul></div><div class="example"><a id="idm139772526261456">
      ⁠</a><p class="title"><strong>Example 11.9. Role Permission Policy Sets (RPS)</strong></p><div class="example-contents"><div class="para"><div class="title">Employee</div>
						
<pre class="programlisting">    &lt;PolicySet xmlns="urn:oasis:names:tc:xacml:2.0:policy:schema:os"  
    PolicySetId="RPS:employee:role"  
    PolicyCombiningAlgId="urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:permit-overrides"&gt;  
    &lt;Target&gt;  
    &lt;Subjects&gt;  
    &lt;Subject&gt;  
    &lt;SubjectMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:anyURI-equal"&gt;  
    &lt;AttributeValue  
    DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;employee&lt;/AttributeValue&gt;  
    &lt;SubjectAttributeDesignator  
    AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role"  
    DataType="http://www.w3.org/2001/XMLSchema#anyURI"/&gt;  
    &lt;/SubjectMatch&gt;  
    &lt;/Subject&gt;  
    &lt;/Subjects&gt;  
    &lt;/Target&gt;  
    &lt;!-- Use permissions associated with the employee role --&gt;  
    &lt;PolicySetIdReference&gt;PPS:employee:role&lt;/PolicySetIdReference&gt;  
    &lt;/PolicySet&gt;

</pre>

					</div><div class="para"><div class="title">Manager</div>
						
<pre class="programlisting">&lt;PolicySet xmlns="urn:oasis:names:tc:xacml:2.0:policy:schema:os"  
PolicySetId="RPS:manager:role"  
PolicyCombiningAlgId="urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:permit-overrides"&gt;  
&lt;Target&gt;  
&lt;Subjects&gt;  
&lt;Subject&gt;  
&lt;SubjectMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:anyURI-equal"&gt;  
&lt;AttributeValue  
DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;manager&lt;/AttributeValue&gt;  
&lt;SubjectAttributeDesignator  
AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role"  
DataType="http://www.w3.org/2001/XMLSchema#anyURI"/&gt;  
&lt;/SubjectMatch&gt;  
&lt;/Subject&gt;  
&lt;/Subjects&gt;  
&lt;/Target&gt;  
&lt;!-- Use permissions associated with the manager role --&gt;  
&lt;PolicySetIdReference&gt;PPS:manager:role&lt;/PolicySetIdReference&gt;  
&lt;/PolicySet&gt;

</pre>

					</div></div></div><div class="example"><a id="idm139772495547024">
      ⁠</a><p class="title"><strong>Example 11.10. Permission Policy Sets (PPS)</strong></p><div class="example-contents"><div class="para"><div class="title">Employee</div>
						
<pre class="programlisting">    &lt;PolicySet xmlns="urn:oasis:names:tc:xacml:2.0:policy:schema:os"  
        PolicySetId="PPS:employee:role"  
        PolicyCombiningAlgId="urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:permit-overrides"&gt;  
        &lt;Target /&gt;  
        &lt;!-- Permissions specifically for the employee role --&gt;  
        &lt;Policy PolicyId="Permissions:specifically:for:the:employee:role"  
            RuleCombiningAlgId="urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides"&gt;  
            &lt;Target /&gt;  
            &lt;!-- Permission to create a purchase order --&gt;  
            &lt;Rule RuleId="Permission:to:create:a:purchase:order" Effect="Permit"&gt;  
                &lt;Target&gt;  
                    &lt;Resources&gt;  
                        &lt;Resource&gt;  
                            &lt;ResourceMatch  
                                MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal"&gt;  
                                &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string"&gt;purchase order  
                                &lt;/AttributeValue&gt;  
                                &lt;ResourceAttributeDesignator  
                                    AttributeId="urn:oasis:names:tc:xacml:1.0:resource:resource-id" DataType="http://www.w3.org/2001/XMLSchema#string" /&gt;  
                            &lt;/ResourceMatch&gt;  
                        &lt;/Resource&gt;  
                    &lt;/Resources&gt;  
                    &lt;Actions&gt;  
                        &lt;Action&gt;  
                            &lt;ActionMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal"&gt;  
                                &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string"&gt;create&lt;/AttributeValue&gt;  
                                &lt;ActionAttributeDesignator AttributeId="urn:action-id"  
                                    DataType="http://www.w3.org/2001/XMLSchema#string" /&gt;  
                            &lt;/ActionMatch&gt;  
                        &lt;/Action&gt;  
                    &lt;/Actions&gt;  
                &lt;/Target&gt;  
            &lt;/Rule&gt;  
        &lt;/Policy&gt;  
        &lt;!-- HasPrivilegesOfRole Policy for employee role --&gt;  
    &lt;Policy PolicyId="Permission:to:have:employee:role:permissions"  
        RuleCombiningAlgId="urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides"&gt;  
        &lt;Target /&gt;  
        &lt;!-- Permission to have employee role permissions --&gt;  
        &lt;Rule RuleId="Permission:to:have:employee:permissions" Effect="Permit"&gt;  
            &lt;Condition&gt;  
                &lt;Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:and"&gt;  
                    &lt;Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:anyURI-is-in"&gt;  
                        &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;employee&lt;/AttributeValue&gt;  
                        &lt;ResourceAttributeDesignator  
                            AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role" DataType="http://www.w3.org/2001/XMLSchema#anyURI" /&gt;  
                    &lt;/Apply&gt;  
                    &lt;Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:anyURI-is-in"&gt;  
                        &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;urn:oasis:names:tc:xacml:2.0:actions:hasPrivilegesOfRole  
                        &lt;/AttributeValue&gt;  
                        &lt;ActionAttributeDesignator AttributeId="urn:oasis:names:tc:xacml:1.0:action:action-id"  
                            DataType="http://www.w3.org/2001/XMLSchema#anyURI" /&gt;  
                    &lt;/Apply&gt;  
                &lt;/Apply&gt;  
            &lt;/Condition&gt;  
        &lt;/Rule&gt;  
    &lt;/Policy&gt;  
    &lt;/PolicySet&gt;

</pre>

					</div><div class="para"><div class="title">Manager</div>
						
<pre class="programlisting">&lt;PolicySet xmlns="urn:oasis:names:tc:xacml:2.0:policy:schema:os"  
        PolicySetId="PPS:manager:role"  
        PolicyCombiningAlgId="urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:permit-overrides"&gt;  
        &lt;Target /&gt;  
        &lt;!-- Permissions specifically for the manager role --&gt;  
        &lt;Policy PolicyId="Permissions:specifically:for:the:manager:role"  
            RuleCombiningAlgId="urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides"&gt;  
            &lt;Target /&gt;  
            &lt;!-- Permission to sign a purchase order --&gt;  
            &lt;Rule RuleId="Permission:to:sign:a:purchase:order" Effect="Permit"&gt;  
                &lt;Target&gt;  
                    &lt;Resources&gt;  
                        &lt;Resource&gt;  
                            &lt;ResourceMatch  
                                MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal"&gt;  
                                &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string"&gt;purchase order  
                                &lt;/AttributeValue&gt;  
                                &lt;ResourceAttributeDesignator  
                                    AttributeId="urn:oasis:names:tc:xacml:1.0:resource:resource-id" DataType="http://www.w3.org/2001/XMLSchema#string" /&gt;  
                            &lt;/ResourceMatch&gt;  
                        &lt;/Resource&gt;  
                    &lt;/Resources&gt;  
                    &lt;Actions&gt;  
                        &lt;Action&gt;  
                            &lt;ActionMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal"&gt;  
                                &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string"&gt;sign&lt;/AttributeValue&gt;  
                                &lt;ActionAttributeDesignator AttributeId="urn:action-id"  
                                    DataType="http://www.w3.org/2001/XMLSchema#string" /&gt;  
                            &lt;/ActionMatch&gt;  
                        &lt;/Action&gt;  
                    &lt;/Actions&gt;  
                &lt;/Target&gt;  
            &lt;/Rule&gt;  
        &lt;/Policy&gt;  
        &lt;!-- HasPrivilegesOfRole Policy for manager role --&gt;  
    &lt;Policy PolicyId="Permission:to:have:manager:role:permissions"  
        RuleCombiningAlgId="urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides"&gt;  
        &lt;Target /&gt;  
        &lt;!-- Permission to have manager role permissions --&gt;  
        &lt;Rule RuleId="Permission:to:have:manager:permissions" Effect="Permit"&gt;  
            &lt;Condition&gt;  
                &lt;Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:and"&gt;  
                    &lt;Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:anyURI-is-in"&gt;  
                        &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;manager&lt;/AttributeValue&gt;  
                        &lt;ResourceAttributeDesignator  
                            AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role" DataType="http://www.w3.org/2001/XMLSchema#anyURI" /&gt;  
                    &lt;/Apply&gt;  
                    &lt;Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:anyURI-is-in"&gt;  
                        &lt;AttributeValue DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;urn:oasis:names:tc:xacml:2.0:actions:hasPrivilegesOfRole  
                        &lt;/AttributeValue&gt;  
                        &lt;ActionAttributeDesignator AttributeId="urn:oasis:names:tc:xacml:1.0:action:action-id"  
                            DataType="http://www.w3.org/2001/XMLSchema#anyURI" /&gt;  
                    &lt;/Apply&gt;  
                &lt;/Apply&gt;  
            &lt;/Condition&gt;  
        &lt;/Rule&gt;  
    &lt;/Policy&gt;  
        &lt;!-- Include permissions associated with employee role --&gt;  
        &lt;PolicySetIdReference&gt;PPS:employee:role&lt;/PolicySetIdReference&gt;  
    &lt;/PolicySet&gt;

</pre>

					</div></div></div></li><li class="step"><p class="title"><strong>Create a configuration file for the XACML engine.</strong></p><div class="para">
				A configuration file is created to configure the locators and mention the directories where the policies are saved.
			</div><div class="example"><a id="idm139772531773392">
      ⁠</a><p class="title"><strong>Example 11.11. Configuration File</strong></p><div class="example-contents"><div class="para"><div class="title">Configuration File Only Indicating The Directory Of The Policy Files.</div>
						
<pre class="programlisting">    &lt;ns:jbosspdp xmlns:ns="urn:jboss:xacml:2.0"&gt;  
      &lt;ns:Policies&gt;   
       &lt;ns:PolicySet&gt;  
          &lt;ns:Location&gt;test/policies/rbac/&lt;/ns:Location&gt;   
        &lt;/ns:PolicySet&gt;  
      &lt;/ns:Policies&gt;  
      &lt;ns:Locators&gt;  
        &lt;ns:Locator Name="org.jboss.security.xacml.locators.JBossRBACPolicySetLocator"/&gt;  
      &lt;/ns:Locators&gt;  
    &lt;/ns:jbosspdp&gt;

</pre>

					</div><div class="para"><div class="title">Configuration File Defining the Policy Set</div>
						
<pre class="programlisting">&lt;ns:jbosspdp xmlns:ns="urn:jboss:xacml:2.0"&gt;  
  &lt;ns:Policies&gt;    
    &lt;ns:PolicySet&gt;  
      &lt;ns:Location&gt;test/policies/rbac/employee-PPS-policyset.xml&lt;/ns:Location&gt;   
    &lt;/ns:PolicySet&gt;  
    &lt;ns:PolicySet&gt;  
      &lt;ns:Location&gt;test/policies/rbac/manager-PPS-policyset.xml&lt;/ns:Location&gt;   
    &lt;/ns:PolicySet&gt;  
    &lt;ns:PolicySet&gt;  
      &lt;ns:Location&gt;test/policies/rbac/employee-RPS-policyset.xml&lt;/ns:Location&gt;   
    &lt;/ns:PolicySet&gt;  
    &lt;ns:PolicySet&gt;  
      &lt;ns:Location&gt;test/policies/rbac/manager-RPS-policyset.xml&lt;/ns:Location&gt;   
    &lt;/ns:PolicySet&gt;  
  &lt;/ns:Policies&gt;  
  &lt;ns:Locators&gt;  
    &lt;ns:Locator Name="org.jboss.security.xacml.locators.JBossRBACPolicySetLocator"/&gt;  
  &lt;/ns:Locators&gt;  
&lt;/ns:jbosspdp&gt;

</pre>

					</div></div></div></li><li class="step"><div class="para">
				Create a Policy Decision Point (PDP) and pass it in the Configuration File.
			</div></li><li class="step"><div class="para">
				In the Policy Enforcement Point (PEP), create an XACML request based on the context. Pass the XACML request to the PDP to get one of the following access decisions: 
				<div class="itemizedlist"><ul><li class="listitem"><div class="para">
							Permit
						</div></li><li class="listitem"><div class="para">
							Deny
						</div></li><li class="listitem"><div class="para">
							Indeterminate
						</div></li><li class="listitem"><div class="para">
							Not Applicable
						</div></li></ul></div>

			</div><div class="example"><a id="idm139772546396976">
      ⁠</a><p class="title"><strong>Example 11.12. Access Decisions</strong></p><div class="example-contents"><div class="para"><div class="title">Permit condition</div>
						
<pre class="programlisting">    &lt;Request   
          xmlns="urn:oasis:names:tc:xacml:2.0:context:schema:os"  
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
          xsi:schemaLocation="urn:oasis:names:tc:xacml:2.0:context:schema:os  
             access_control-xacml-2.0-context-schema-os.xsd"&gt;  
    &lt;Subject&gt;  
    &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id"  
     DataType="http://www.w3.org/2001/XMLSchema#string"&gt;  
    &lt;AttributeValue&gt;Anne&lt;/AttributeValue&gt;  
    &lt;/Attribute&gt;  
      
    &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role"  
     DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;  
    &lt;AttributeValue&gt;manager&lt;/AttributeValue&gt;  
    &lt;/Attribute&gt;  
    &lt;/Subject&gt;   
      
    &lt;Resource&gt;  
    &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role"  
    DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;  
    &lt;AttributeValue&gt;manager&lt;/AttributeValue&gt;  
    &lt;/Attribute&gt;  
    &lt;/Resource&gt;  
      
    &lt;Action&gt;  
    &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:1.0:action:action-id"  
     DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;  
     &lt;AttributeValue&gt;urn:oasis:names:tc:xacml:2.0:actions:hasPrivilegesOfRole&lt;/AttributeValue&gt;  
    &lt;/Attribute&gt;  
    &lt;/Action&gt;  
    &lt;/Request&gt;

</pre>

					</div><div class="para"><div class="title">Deny Permission</div>
						
<pre class="programlisting">    &lt;Request xmlns="urn:oasis:names:tc:xacml:2.0:context:schema:os"  
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
        xsi:schemaLocation="urn:oasis:names:tc:xacml:2.0:context:schema:os  
             access_control-xacml-2.0-context-schema-os.xsd"&gt;  
        &lt;Subject&gt;  
            &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id"  
                DataType="http://www.w3.org/2001/XMLSchema#string"&gt;  
                &lt;AttributeValue&gt;Anne&lt;/AttributeValue&gt;  
            &lt;/Attribute&gt;  
      
            &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role"  
                DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;  
                &lt;AttributeValue&gt;manager&lt;/AttributeValue&gt;  
            &lt;/Attribute&gt;  
        &lt;/Subject&gt;  
      
        &lt;Resource&gt;  
            &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role"  
                DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;  
                &lt;AttributeValue&gt;manager&lt;/AttributeValue&gt;  
            &lt;/Attribute&gt;  
        &lt;/Resource&gt;  
      
        &lt;Action&gt;  
            &lt;Attribute AttributeId="urn:oasis:names:tc:xacml:1.0:action:action-id"  
                DataType="http://www.w3.org/2001/XMLSchema#anyURI"&gt;  
                &lt;AttributeValue&gt;urn:nobody&lt;/AttributeValue&gt;  
            &lt;/Attribute&gt;  
        &lt;/Action&gt;  
    &lt;/Request&gt;

</pre>

					</div></div></div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+24310-592556+%5BLatest%5D&amp;comment=Title%3A+Configure+XACML+for+Fine+Grained+Authorization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24310-592556+23+Feb+2014+16%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Security_Auditing">
      ⁠</a>11.7. Security Auditing</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Security_Auditing1">
      ⁠</a>11.7.1. About Security Auditing</h2></div></div></div><div class="para">
		Security auditing refers to triggering events, such as writing to a log, in response to an event that happens within the security subsystem. Auditing mechanisms are configured as part of a security domain, along with authentication, authorization, and security mapping details.
	</div><div class="para">
		Auditing uses <em class="firstterm">provider modules</em>. You can use one of the included ones, or implement your own.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4727-591674+%5BLatest%5D&amp;comment=Title%3A+About+Security+Auditing%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4727-591674+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Security_Auditing1">
      ⁠</a>11.7.2. Configure Security Auditing</h2></div></div></div><div class="para">
		To configure security auditing settings for a security domain, log into the management console and follow this procedure.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772561554224">
      ⁠</a><p class="title"><strong>Procedure 11.11. Setup Security Auditing for a Security Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the security domain's detailed view.</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Click <span class="guilabel"><strong>Configuration</strong></span> at the top of the screen.
					</div></li><li class="step"><div class="para">
						In a managed domain, select a profile to modify from the <span class="guilabel"><strong>Profile</strong></span> selection box at the top left.
					</div></li><li class="step"><div class="para">
						Expand the <span class="guilabel"><strong>Security</strong></span> menu and select <span class="guilabel"><strong>Security Domains</strong></span>.
					</div></li><li class="step"><div class="para">
						Click <span class="guilabel"><strong>View</strong></span> for the security domain you want to edit.
					</div></li></ol></li><li class="step"><p class="title"><strong>Navigate to the Auditing subsystem configuration.</strong></p><div class="para">
				Select the <span class="guilabel"><strong>Audit</strong></span> tab at the top of the screen.
			</div><div class="para">
				The configuration area is divided into two areas: <span class="guilabel"><strong>Provider Modules</strong></span> and <span class="guilabel"><strong>Details</strong></span>. The provider module is the basic unit of configuration. A security domain can include several provider modules each of which can include attributes and options.
			</div></li><li class="step"><p class="title"><strong>Add a provider module.</strong></p><div class="para">
				Click <span class="guilabel"><strong>Add</strong></span>. Fill in the <span class="guilabel"><strong>Code</strong></span> section with the classname of the provider module.
			</div></li><li class="step"><p class="title"><strong>Verify if your module is working</strong></p><div class="para">
				The goal of an audit module is to provide a way to monitor the events in the security subsystem. This monitoring can be done by means of writing to a log file, email notifications or any other measurable auditing mechanism.
			</div><div class="para">
				For example, JBoss EAP 6 includes the <code class="filename">LogAuditProvider</code> module by default. If enabled following the steps above, this audit module writes security notifications to a <code class="filename">audit.log</code> file in the <code class="filename">log</code> subfolder within the <code class="filename"><em class="replaceable">EAP_HOME</em></code> directory.
			</div><div class="para">
				To verify if the steps above have worked in the context of the <code class="filename">LogAuditProvider</code>, perform an action that is likely to trigger a notification and then check the audit log file.
			</div><div class="para">
				For a full list of included security auditing provider modules, see here: <a class="xref" href="appe-Reference.html#Included_Security_Auditing_Provider_Modules">Section A.4, “Included Security Auditing Provider Modules”</a>
			</div></li><li class="step"><p class="title"><strong>Optional: Add, edit, or remove module options.</strong></p><div class="para">
				To add options to your module, click its entry in the <span class="guilabel"><strong>Modules</strong></span> list, and select the <span class="guilabel"><strong>Module Options</strong></span> tab in the <span class="guilabel"><strong>Details</strong></span> section of the page. Click <span class="guibutton"><strong>Add</strong></span>, and provide the key and value for the option.
			</div><div class="para">
				To edit an option that already exists, click <span class="guibutton"><strong>Remove</strong></span> to remove it, and click <span class="guibutton"><strong>Add</strong></span> to add it again with the correct options.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your security auditing module is added to the security domain, and is immediately available to applications which use the security domain.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4728-632203+%5BLatest%5D&amp;comment=Title%3A+Configure+Security+Auditing%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4728-632203+16+Apr+2014+22%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="New_Security_Properties">
      ⁠</a>11.7.3. New Security Properties</h2></div></div></div><div class="para">
		New system properties have been added to the security audit functionality for JBoss EAP versions 6.2.2 and later. These new properties mitigate security concerns surrounding plain text logging of web request components, particularly in scenarios involving BASIC or FORM based authentication.
	</div><div class="para">
		The new properties allow greater control over which components of a web request are captured in audit logs (parameters, cookies, headers or attributes). These components can also be masked using the new properties.
	</div><div class="para">
		The new properties are:
	</div><div class="table"><a id="idm139772528125024">
      ⁠</a><p class="title"><strong>Table 11.1. New Security Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols lt-7-rows" summary="New Security Properties"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th> Name </th><th> Description </th><th> Possible values </th><th> Behavior </th><th> Default </th></tr></thead><tbody><tr><td> <code class="literal">org.jboss.security.web.audit</code> </td><td> This property controls the granularity of the security auditing of web requests. </td><td> <code class="literal">off</code>, <code class="literal">headers</code>, <code class="literal">cookies</code>, <code class="literal">parameters</code>, <code class="literal">attributes</code> </td><td> Any component (or comma-separated group of components) specified will be audited out of web requests. </td><td> <code class="literal">headers,parameters</code> </td></tr><tr><td> <code class="literal">org.jboss.security.web.audit.mask</code> </td><td> This property can be used to specify a list of strings to be matched against headers, parameters, cookies, and attributes of web requests. Any element matching the specified masks will be excluded from security audit logging. </td><td> Any comma separated string indicating keys of headers, parameters, cookies, and attributes. </td><td> Currently, the matching of the masks is fuzzy rather than strict. For example, a mask of <code class="literal">authorization</code> will mask both the header called <span class="emphasis"><em>authorization</em></span> and the parameter called <span class="emphasis"><em>custom_authorization</em></span>. A future release may introduce strict masks. </td><td> j_password,authorization </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+29465-608813+%5BLatest%5D&amp;comment=Title%3A+New+Security+Properties%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=29465-608813+04+Mar+2014+20%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Security_Mapping">
      ⁠</a>11.8. Security Mapping</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Security_Mapping1">
      ⁠</a>11.8.1. About Security Mapping</h2></div></div></div><div class="para">
		Security mapping allows you to combine authentication and authorization information after the authentication or authorization happens, but before the information is passed to your application.
	</div><div class="para">
		You can map principals (authentication), roles (authorization), or credentials (attributes which are not principals or roles).
	</div><div class="para">
		Role Mapping is used to add, replace, or remove roles to the subject after authentication.
	</div><div class="para">
		Principal mapping is used to modify a principal after authentication.
	</div><div class="para">
		Attribute mapping is used to convert attributes from an external system to be used by your application, and vice versa.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4729-686016+%5BLatest%5D&amp;comment=Title%3A+About+Security+Mapping%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4729-686016+18+Jul+2014+08%3A39+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Security_Mapping_in_a_Security_Domain">
      ⁠</a>11.8.2. Configure Security Mapping in a Security Domain</h2></div></div></div><div class="para">
		To configure security mapping settings for a security domain, log into the management console and follow this procedure.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772531771584">
      ⁠</a><p class="title"><strong>Procedure 11.12. Setup Security Mapping Settings in a Security Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the security domain's detailed view.</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Click the <span class="guilabel"><strong>Configuration</strong></span> label at the top of the management console.
					</div></li><li class="step"><div class="para">
						In a managed domain, select a profile from the <span class="guilabel"><strong>Profile</strong></span> selection box at the top left.
					</div></li><li class="step"><div class="para">
						Expand the <span class="guilabel"><strong>Security</strong></span> menu, and select <span class="guilabel"><strong>Security Domains</strong></span>.
					</div></li><li class="step"><div class="para">
						Click <span class="guilabel"><strong>View</strong></span> for the security domain you want to edit.
					</div></li></ol></li><li class="step"><p class="title"><strong>Navigate to the Mapping subsystem configuration.</strong></p><div class="para">
				Select the <span class="guilabel"><strong>Mapping</strong></span> label at the top of the screen.
			</div><div class="para">
				The configuration area is divided into two areas: <span class="guilabel"><strong>Modules</strong></span> and <span class="guilabel"><strong>Details</strong></span>. The mapping module is the basic unit of configuration. A security domain can include several mapping modules, each of which can include several attributes and options.
			</div></li><li class="step"><p class="title"><strong>Add a security mapping module.</strong></p><div class="para">
				Click <span class="guilabel"><strong>Add</strong></span>.
			</div><div class="para">
				Fill in the details for your module. The <span class="guilabel"><strong>Code</strong></span> is the class name of the module. The <span class="guilabel"><strong>Type</strong></span> field refers to the type of mapping this module performs. Allowed values are principal, role, attribute or credential.
			</div></li><li class="step"><p class="title"><strong>Edit a security mapping module</strong></p><div class="para">
				After you have added your module, you can modify its <span class="guilabel"><strong>Code</strong></span> or <span class="guilabel"><strong>Type</strong></span>.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Select the <span class="guilabel"><strong>Attributes</strong></span> tab.
					</div></li><li class="step"><div class="para">
						Click <span class="guibutton"><strong>Edit</strong></span> in the <span class="guilabel"><strong>Details</strong></span> section of the screen.
					</div></li></ol></li><li class="step"><p class="title"><strong>Optional: Add, edit, or remove module options.</strong></p><div class="para">
				To add options to your module, click its entry in the <span class="guilabel"><strong>Modules</strong></span> list, and select the <span class="guilabel"><strong>Module Options</strong></span> tab in the <span class="guilabel"><strong>Details</strong></span> section of the page. Click <span class="guibutton"><strong>Add</strong></span>, and provide the key and value for the option.
			</div><div class="para">
				To edit an option that already exists, click <span class="guilabel"><strong>Remove</strong></span> to remove it, and add it again with the new value.
			</div><div class="para">
				Use the <span class="guibutton"><strong>Remove</strong></span> button to remove an option.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your security mapping module is added to the security domain, and is immediately available to applications which use the security domain.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4730-632207+%5BLatest%5D&amp;comment=Title%3A+Configure+Security+Mapping+in+a+Security+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4730-632207+16+Apr+2014+22%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Use_a_Security_Domain_in_Your_Application">
      ⁠</a>11.9. Use a Security Domain in Your Application</h1></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			To use a security domain in your application, first you need to define the security domain in the server's configuration and then enable it for an application in the application's deployment descriptor. Then you must add the required annotations to the EJB that uses it. This topic covers the steps required to use a security domain in your application.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			If an application is part of a security domain that uses an authentication cache, user authentications for that application will also be available to other applications in that security domain.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772564824304">
      ⁠</a><p class="title"><strong>Procedure 11.13. Configure Your Application to Use a Security Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Define the Security Domain</strong></p><div class="para">
				You need to define the security domain in the server's configuration file, and then enable it for an application in the application's descriptor file.
			</div><ol class="substeps a"><li class="step"><p class="title"><strong>Configure the security domain in the server's configuration file</strong></p><div class="para">
						The security domain is configured in the <code class="literal">security</code> subsystem of the server's configuration file. If the JBoss EAP 6 instance is running in a managed domain, this is the <code class="filename">domain/configuration/domain.xml</code> file. If the JBoss EAP 6 instance is running as a standalone server, this is the <code class="filename">standalone/configuration/standalone.xml</code> file.
					</div><div class="para">
						The <code class="literal">other</code>, <code class="literal">jboss-web-policy</code>, and <code class="literal">jboss-ejb-policy</code> security domains are provided by default in JBoss EAP 6. The following XML example was copied from the <code class="literal">security</code> subsystem in the server's configuration file.
					</div><div class="para">
						The <code class="code">cache-type</code> attribute of a security domain specifies a cache for faster authentication checks. Allowed values are <code class="literal">default</code> to use a simple map as the cache, or <code class="literal">infinispan</code> to use an Infinispan cache. 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:security:1.2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domains&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"other"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Remoting"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"optional"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"RealmDirect"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss-web-policy"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;authorization&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;policy-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Delegating"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/authorization&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss-ejb-policy"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;authorization&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;policy-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Delegating"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/authorization&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-domains&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>
</pre>

					</div><div class="para">
						You can configure additional security domains as needed using the Management Console or CLI.
					</div></li><li class="step"><p class="title"><strong>Enable the security domain in the application's descriptor file</strong></p><div class="para">
						The security domain is specified in the <code class="sgmltag-element">&lt;security-domain&gt;</code> child element of the <code class="sgmltag-element">&lt;jboss-web&gt;</code> element in the application's <code class="filename">WEB-INF/jboss-web.xml</code> file. The following example configures a security domain named <code class="literal">my-domain</code>. 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>my-domain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre>

					</div><div class="para">
						This is only one of many settings which you can specify in the <code class="filename">WEB-INF/jboss-web.xml</code> descriptor.
					</div></li></ol></li><li class="step"><p class="title"><strong>Add the Required Annotation to the EJB</strong></p><div class="para">
				You configure security in the EJB using the <code class="literal">@SecurityDomain</code> and <code class="literal">@RolesAllowed</code> annotations. The following EJB code example limits access to the <code class="literal">other</code> security domain by users in the <code class="literal">guest</code> role.
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>package example.<span xmlns="" class="perl_Function">ejb3</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.security.Principal;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.annotation.Resource;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.annotation.security.RolesAllowed;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.ejb.SessionContext;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.ejb.Stateless;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb3.annotation.SecurityDomain;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Simple secured EJB using EJB security annotations</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Allow access to "other" security domain by users in a "guest" role.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>({ <span xmlns="" class="perl_String">"guest"</span> })
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SecurityDomain</span>(<span xmlns="" class="perl_String">"other"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> SecuredEJB {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">// Inject the Session Context</span>
<span xmlns="" class="line">​</span>   @Resource
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> SessionContext ctx;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    * Secured EJB method using security annotations</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    */</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSecurityInfo</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// Session context injected using the resource annotation</span>
<span xmlns="" class="line">​</span>      Principal principal = ctx.<span xmlns="" class="perl_Function">getCallerPrincipal</span>();
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> principal.<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre><div class="para">
				For more code examples, see the <code class="literal">ejb-security</code> quickstart in the JBoss EAP 6 Quickstarts bundle, which is available from the Red Hat Customer Portal.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4765-715581+%5BLatest%5D&amp;comment=Title%3A+Use+a+Security+Domain+in+Your+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4765-715581+08+Oct+2014+13%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></body></html>