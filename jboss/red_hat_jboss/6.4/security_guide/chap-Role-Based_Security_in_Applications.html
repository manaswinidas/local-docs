<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 15. Role-Based Security in Applications</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Role-Based_Security_in_Applications">
      ⁠</a>Chapter 15. Role-Based Security in Applications</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Java_Authentication_and_Authorization_Service_JAAS">
      ⁠</a>15.1. Java Authentication and Authorization Service (JAAS)</h1></div></div></div><div class="para">
		<em class="firstterm">Java Authentication and Authorization Service (JAAS)</em> is a security API which consists of a set of Java packages designed for user authentication and authorization. The API is a Java implementation of the standard Pluggable Authentication Modules (PAM) framework. It extends the Java Enterprise Edition access control architecture to support user-based authorization.
	</div><div class="para">
		In JBoss EAP 6, JAAS only provides declarative role-based security. For more information about declarative security, refer to <a class="xref" href="chap-Security_Overview.html#sect-Declarative_Security">Section 8.2, “Declarative Security”</a>.
	</div><div class="para">
		JAAS is independent of any underlying authentication technologies, such as Kerberos or LDAP. You can change your underlying security structure without changing your application. You only need to change the JAAS configuration.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4769-591672+%5BLatest%5D&amp;comment=Title%3A+Java+Authentication+and+Authorization+Service+%28JAAS%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4769-591672+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Java_Authentication_and_Authorization_Service_JAAS">
      ⁠</a>15.2. About Java Authentication and Authorization Service (JAAS)</h1></div></div></div><div class="para">
		The security architecture of JBoss EAP 6 is comprised of the security configuration subsystem, and application-specific security configurations which are included in several configuration files within the application.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Domain, Server Group, and Server Specific Configuration</div>
			Server groups (in a managed domain) and servers (in a standalone server) include the configuration for security domains. A security domain includes information about a combination of authentication, authorization, mapping, and auditing modules, with configuration details. An application specifies which security domain it requires, by name, in its <code class="filename">jboss-web.xml</code>.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Application-specific Configuration</div>
			Application-specific configuration takes place in one or more of the following four files.
		</div><div class="table"><a id="idm139772489964528">
      ⁠</a><p class="title"><strong>Table 15.1. Application-Specific Configuration Files</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Application-Specific Configuration Files"><colgroup><col/><col/></colgroup><thead><tr><th> File </th><th> Description </th></tr></thead><tbody><tr><td> ejb-jar.xml </td><td> <div class="para">
						The deployment descriptor for an Enterprise JavaBean (EJB) application, located in the <code class="filename">META-INF</code> directory of the archive. Use the <code class="filename">ejb-jar.xml</code> to specify roles and map them to principals, at the application level. You can also limit specific methods and classes to certain roles. It is also used for other EJB-specific configuration not related to security.
					</div>
					 </td></tr><tr><td> web.xml </td><td> <div class="para">
						The deployment descriptor for a Java Enterprise Edition (EE) web application. Use the <code class="filename">web.xml</code> to declare the resource and transport constraints for the application, such as limiting the type of HTTP requests that are allowed. You can also configure simple web-based authentication in this file. It is also used for other application-specific configuration not related to security. The security domain the application uses for authentication and authorization is defined in <code class="filename">jboss-web.xml</code>.
					</div>
					 </td></tr><tr><td> jboss-ejb3.xml </td><td> <div class="para">
						Contains JBoss-specific extensions to the <code class="filename">ejb-jar.xml</code> descriptor.
					</div>
					 </td></tr><tr><td> jboss-web.xml </td><td> <div class="para">
						Contains JBoss-specific extensions to the <code class="filename">web.xml</code> descriptor.
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The <code class="filename">ejb-jar.xml</code> and <code class="filename">web.xml</code> are defined in the Java Enterprise Edition (Java EE) specification. The <code class="filename">jboss-ejb3.xml</code> provides JBoss-specific extensions for the <code class="filename">ejb-jar.xml</code>, and the <code class="filename">jboss-web.xml</code> provides JBoss-specific extensions for the <code class="filename">web.xml</code>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4797-685271+%5BLatest%5D&amp;comment=Title%3A+About+Java+Authentication+and+Authorization+Service+%28JAAS%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4797-685271+15+Jul+2014+02%3A00+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Use_Role-Based_Security_In_Servlets">
      ⁠</a>15.3. Use Role-Based Security In Servlets</h1></div></div></div><div class="para">
		To add security to a servlet, you map each servlet to a URL pattern, and create security constraints on the URL patterns which need to be secured. The security constraints limit access to the URLs to roles. The authentication and authorization are handled by the security domain specified in the WAR's <code class="filename">jboss-web.xml</code>.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			Before you use role-based security in a servlet, the security domain used to authenticate and authorize access needs to be configured in the JBoss EAP 6 container.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139772562999216">
      ⁠</a><p class="title"><strong>Procedure 15.1. Add Role-Based Security to Servlets</strong></p><ol class="1"><li class="step"><p class="title"><strong>Add mappings between servlets and URL patterns.</strong></p><div class="para">
				Use <code class="sgmltag-element">&lt;servlet-mapping&gt;</code> elements in the <code class="filename">web.xml</code> to map individual servlets to URL patterns. The following example maps the servlet called <code class="literal">DisplayOpResult</code> to the URL pattern <code class="literal">/DisplayOpResult</code>.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>		
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>
</pre></li><li class="step"><p class="title"><strong>Add security constraints to the URL patterns.</strong></p><div class="para">
				To map the URL pattern to a security constraint, use a <code class="sgmltag-element">&lt;security-constraint&gt;</code>. The following example constrains access from the URL pattern <code class="literal">/DisplayOpResult</code> to be accessed by principals with the role <code class="literal">eap_admin</code>. The role needs to be present in the security domain.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>	
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>	
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-role&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-role&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>BASIC<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span>
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>
</pre><div class="para">
				You need to specify the authentication method, which can be any of the following: <code class="literal">BASIC, FORM, DIGEST, CLIENT-CERT, SPNEGO.</code> This example uses <code class="literal">BASIC</code> authentication.
			</div></li><li class="step"><p class="title"><strong>Specify the security domain in the WAR's <code class="filename">jboss-web.xml</code></strong></p><div class="para">
				Add the security domain to the WAR's <code class="filename">jboss-web.xml</code> in order to connect the servlets to the configured security domain, which knows how to authenticate and authorize principals against the security constraints. The following example uses the security domain called <code class="literal">acme_domain</code>.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>acme_domain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>
</pre></li></ol></div><div class="example"><a id="idm139772488113728">
      ⁠</a><p class="title"><strong>Example 15.1. Example <code class="filename">web.xml</code> with Role-Based Security Configured</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web-app</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         version=</span><span xmlns="" class="perl_String">"3.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Use Role-Based Security In Servlets<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;welcome-file-list&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;welcome-file&gt;</span>/index.jsp<span xmlns="" class="perl_Keyword">&lt;/welcome-file&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/welcome-file-list&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-role&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-role&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>BASIC<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/web-app&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+4927-591678+%5BLatest%5D&amp;comment=Title%3A+Use+Role-Based+Security+In+Servlets%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4927-591678+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Use_A_Third-Party_Authentication_System_In_Your_Application">
      ⁠</a>15.4. Use A Third-Party Authentication System In Your Application</h1></div></div></div><div class="para">
		You can integrate third-party security systems with JBoss EAP 6. These types of systems are usually token-based. The external system performs the authentication and passes a token back to the Web application through the request headers. This is often referred to as <em class="firstterm">perimeter authentication</em>. To configure perimeter authentication in your application, add a custom authentication valve. If you have a valve from a third-party provider, be sure it is in your classpath and follow the examples below, along with the documentation for your third-party authentication module.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The location for configuring valves has changed in JBoss EAP 6. There is no longer a <code class="filename">context.xml</code> deployment descriptor. Valves are configured directly in the <code class="filename">jboss-web.xml</code> descriptor instead. The <code class="filename">context.xml</code> is now ignored.
		</div></div></div><div class="example"><a id="idm139772535700864">
      ⁠</a><p class="title"><strong>Example 15.2. Basic Authentication Valve</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.security.negotiation.NegotiationAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
			This valve is used for Kerberos-based SSO. It also shows the most simple pattern for specifying a third-party authenticator for your Web application.
		</div></div></div><div class="example"><a id="idm139772543221056">
      ⁠</a><p class="title"><strong>Example 15.3. Custom Valve With Header Attributes Set</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.web.tomcat.security.GenericHeaderAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>httpHeaderForSSOAuth<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>sm_ssoid,ct-remote-user,HTTP_OBLIX_UID<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>sessionCookieForSSOAuth<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>SMSESSION,CTSESSION,ObSSOCookie<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
			This example shows how to set custom attributes on your valve. The authenticator checks for the presence of the header ID and the session key, and passes them into the JAAS framework which drives the security layer, as the username and password value. You need a custom JAAS login module which can process the username and password and populate the subject with the correct roles. If no header values match the configured values, regular form-based authentication semantics apply.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Writing a Custom Authenticator</div>
			Writing your own authenticator is out of scope of this document. However, the following Java code is provided as an example.
		</div><div class="example"><a id="idm139772530089600">
      ⁠</a><p class="title"><strong>Example 15.4. GenericHeaderAuthenticator.java</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/*</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * JBoss, Home of Professional Open Source.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Copyright 2006, Red Hat Middleware LLC, and individual contributors</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * as indicated by the @author tags. See the copyright.txt file in the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * distribution for a full listing of individual contributors.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * This is free software; you can redistribute it and/or modify it</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * under the terms of the GNU Lesser General Public License as</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * published by the Free Software Foundation; either version 2.1 of</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * the License, or (at your option) any later version.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * This software is distributed in the hope that it will be useful,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Lesser General Public License for more details.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * You should have received a copy of the GNU Lesser General Public</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * License along with this software; if not, write to the Free</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * 02110-1301 USA, or see the FSF site: http://www.fsf.org.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">web</span>.<span xmlns="" class="perl_Function">tomcat</span>.<span xmlns="" class="perl_Function">security</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.io.IOException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.security.Principal;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.StringTokenizer;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.JMException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.ObjectName;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.http.Cookie;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.http.HttpServletRequest;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.http.HttpServletResponse;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.Realm;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.Session;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.authenticator.Constants;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Request;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Response;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.deploy.LoginConfig;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.logging.Logger;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.as.web.security.ExtendedFormAuthenticator;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * JBAS-2283: Provide custom header based authentication support</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Header Authenticator that deals with userid from the request header Requires</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * two attributes configured on the Tomcat Service - one for the http header</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * denoting the authenticated identity and the other is the SESSION cookie</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author &lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"mailto:Anil.Saldhana@jboss.org"</span><span xmlns="" class="perl_Keyword">&gt;</span><span xmlns="" class="perl_Comment">Anil Saldhana</span><span xmlns="" class="perl_Keyword">&lt;/a&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author &lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"mailto:sguilhen@redhat.com"</span><span xmlns="" class="perl_Keyword">&gt;</span><span xmlns="" class="perl_Comment">Stefan Guilhen</span><span xmlns="" class="perl_Keyword">&lt;/a&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@version </span><span xmlns="" class="perl_Comment">$Revision$</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@since </span><span xmlns="" class="perl_Comment">Sep 11, 2006</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> GenericHeaderAuthenticator <span xmlns="" class="perl_Keyword">extends</span> ExtendedFormAuthenticator {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">static</span> Logger log = Logger
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">getLogger</span>(GenericHeaderAuthenticator.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">boolean</span> trace = log.<span xmlns="" class="perl_Function">isTraceEnabled</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// JBAS-4804: GenericHeaderAuthenticator injection of ssoid and</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// sessioncookie name.</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String httpHeaderForSSOAuth = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String sessionCookieForSSOAuth = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Obtain the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * attribute is used to indicate the request header ids that have to be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * checked in order to retrieve the SSO identity set by a third party</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * security system.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the value of the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *         </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getHttpHeaderForSSOAuth</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> httpHeaderForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Set the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * attribute is used to indicate the request header ids that have to be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * checked in order to retrieve the SSO identity set by a third party</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * security system.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param httpHeaderForSSOAuth</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the value of the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setHttpHeaderForSSOAuth</span>(String httpHeaderForSSOAuth) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">httpHeaderForSSOAuth</span> = httpHeaderForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Obtain the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">sessionCookieForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * This attribute is used to indicate the names of the SSO cookies that may</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * be present in the request object.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the names (separated by a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *         </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">','</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment">) of the SSO cookies that may have been set by a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *         third party security system in the request.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSessionCookieForSSOAuth</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> sessionCookieForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Set the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">sessionCookieForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * attribute is used to indicate the names of the SSO cookies that may be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * present in the request object.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param sessionCookieForSSOAuth</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the names (separated by a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">','</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment">) of the SSO cookies that may have been set by</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            a third party security system in the request.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setSessionCookieForSSOAuth</span>(String sessionCookieForSSOAuth) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sessionCookieForSSOAuth</span> = sessionCookieForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Creates an instance of </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">GenericHeaderAuthenticator</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment">.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">GenericHeaderAuthenticator</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">super</span>();
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">authenticate</span>(Request request, HttpServletResponse response,
<span xmlns="" class="line">​</span>      LoginConfig config) <span xmlns="" class="perl_Keyword">throws</span> IOException {
<span xmlns="" class="line">​</span>    log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Authenticating user"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    Principal principal = request.<span xmlns="" class="perl_Function">getUserPrincipal</span>();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (principal != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Already authenticated '"</span> + principal.<span xmlns="" class="perl_Function">getName</span>() + <span xmlns="" class="perl_String">"'"</span>);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    Realm realm = context.<span xmlns="" class="perl_Function">getRealm</span>();
<span xmlns="" class="line">​</span>    Session session = request.<span xmlns="" class="perl_Function">getSessionInternal</span>(<span xmlns="" class="perl_Keyword">true</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    String username = <span xmlns="" class="perl_Function">getUserId</span>(request);
<span xmlns="" class="line">​</span>    String password = <span xmlns="" class="perl_Function">getSessionCookie</span>(request);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Check if there is sso id as well as sessionkey</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (username == <span xmlns="" class="perl_Keyword">null</span> || password == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Username is null or password(sessionkey) is null:fallback to form auth"</span>);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">authenticate</span>(request, response, config);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    principal = realm.<span xmlns="" class="perl_Function">authenticate</span>(username, password);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (principal == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Function">forwardToErrorPage</span>(request, response, config);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    session.<span xmlns="" class="perl_Function">setNote</span>(Constants.<span xmlns="" class="perl_Function">SESS_USERNAME_NOTE</span>, username);
<span xmlns="" class="line">​</span>    session.<span xmlns="" class="perl_Function">setNote</span>(Constants.<span xmlns="" class="perl_Function">SESS_PASSWORD_NOTE</span>, password);
<span xmlns="" class="line">​</span>    request.<span xmlns="" class="perl_Function">setUserPrincipal</span>(principal);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">register</span>(request, response, principal, HttpServletRequest.<span xmlns="" class="perl_Function">FORM_AUTH</span>,
<span xmlns="" class="line">​</span>        username, password);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the username from the request header</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param request</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getUserId</span>(Request request) {
<span xmlns="" class="line">​</span>    String ssoid = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// We can have a comma-separated ids</span>
<span xmlns="" class="line">​</span>    String ids = <span xmlns="" class="perl_String">""</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      ids = <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getIdentityHeaderId</span>();
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (JMException e) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"getUserId exception"</span>, e);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (ids == <span xmlns="" class="perl_Keyword">null</span> || ids.<span xmlns="" class="perl_Function">length</span>() == <span xmlns="" class="perl_Float">0</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalStateException(
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_String">"Http headers configuration in tomcat service missing"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    StringTokenizer st = <span xmlns="" class="perl_Keyword">new</span> StringTokenizer(ids, <span xmlns="" class="perl_String">","</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">while</span> (st.<span xmlns="" class="perl_Function">hasMoreTokens</span>()) {
<span xmlns="" class="line">​</span>      ssoid = request.<span xmlns="" class="perl_Function">getHeader</span>(st.<span xmlns="" class="perl_Function">nextToken</span>());
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (ssoid != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">break</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"SSOID-"</span> + ssoid);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> ssoid;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Obtain the session cookie from the request</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param request</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getSessionCookie</span>(Request request) {
<span xmlns="" class="line">​</span>    Cookie[] cookies = request.<span xmlns="" class="perl_Function">getCookies</span>();
<span xmlns="" class="line">​</span>    log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Cookies:"</span> + cookies);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">int</span> numCookies = cookies != <span xmlns="" class="perl_Keyword">null</span> ? cookies.<span xmlns="" class="perl_Function">length</span> : <span xmlns="" class="perl_Float">0</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// We can have comma-separated ids</span>
<span xmlns="" class="line">​</span>    String ids = <span xmlns="" class="perl_String">""</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      ids = <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getSessionCookieId</span>();
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Session Cookie Ids="</span> + ids);
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (JMException e) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"checkSessionCookie exception"</span>, e);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (ids == <span xmlns="" class="perl_Keyword">null</span> || ids.<span xmlns="" class="perl_Function">length</span>() == <span xmlns="" class="perl_Float">0</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalStateException(
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_String">"Session cookies configuration in tomcat service missing"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    StringTokenizer st = <span xmlns="" class="perl_Keyword">new</span> StringTokenizer(ids, <span xmlns="" class="perl_String">","</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">while</span> (st.<span xmlns="" class="perl_Function">hasMoreTokens</span>()) {
<span xmlns="" class="line">​</span>      String cookieToken = st.<span xmlns="" class="perl_Function">nextToken</span>();
<span xmlns="" class="line">​</span>      String val = <span xmlns="" class="perl_Function">getCookieValue</span>(cookies, numCookies, cookieToken);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (val != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> val;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Session Cookie not found"</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the configured header identity id in the tomcat service</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@throws JMException</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getIdentityHeaderId</span>() <span xmlns="" class="perl_Keyword">throws</span> JMException {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">httpHeaderForSSOAuth</span> != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">httpHeaderForSSOAuth</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> (String) mserver.<span xmlns="" class="perl_Function">getAttribute</span>(<span xmlns="" class="perl_Keyword">new</span> ObjectName(
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_String">"jboss.web:service=WebServer"</span>), <span xmlns="" class="perl_String">"HttpHeaderForSSOAuth"</span>);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the configured session cookie id in the tomcat service</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@throws JMException</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getSessionCookieId</span>() <span xmlns="" class="perl_Keyword">throws</span> JMException {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sessionCookieForSSOAuth</span> != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sessionCookieForSSOAuth</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> (String) mserver.<span xmlns="" class="perl_Function">getAttribute</span>(<span xmlns="" class="perl_Keyword">new</span> ObjectName(
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_String">"jboss.web:service=WebServer"</span>), <span xmlns="" class="perl_String">"SessionCookieForSSOAuth"</span>);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the value of a cookie if the name matches the token</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param cookies</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            array of cookies</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param numCookies</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            number of cookies in the array</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param </span><span xmlns="" class="perl_Comment">t</span><span xmlns="" class="perl_Keyword">oken</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            Key</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">value of cookie</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getCookieValue</span>(Cookie[] cookies, <span xmlns="" class="perl_DataType">int</span> numCookies,
<span xmlns="" class="line">​</span>      String token) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> i = <span xmlns="" class="perl_Float">0</span>; i &lt; numCookies; i++) {
<span xmlns="" class="line">​</span>      Cookie cookie = cookies[i];
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Matching cookieToken:"</span> + token + <span xmlns="" class="perl_String">" with cookie name="</span>
<span xmlns="" class="line">​</span>          + cookie.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (token.<span xmlns="" class="perl_Function">equals</span>(cookie.<span xmlns="" class="perl_Function">getName</span>())) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>          log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Cookie-"</span> + token + <span xmlns="" class="perl_String">" value="</span> + cookie.<span xmlns="" class="perl_Function">getValue</span>());
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> cookie.<span xmlns="" class="perl_Function">getValue</span>();
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+22930%2C+Security+Guide-6.4-1%0ABuild+Date%3A+15-04-2015+13%3A57%3A35%0ATopic+ID%3A+7825-591808+%5BLatest%5D&amp;comment=Title%3A+Use+A+Third-Party+Authentication+System+In+Your+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7825-591808+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></body></html>