<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 8. Enterprise JavaBeans</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Enterprise_JavaBeans">
      ⁠</a>Chapter 8. Enterprise JavaBeans</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Introduction">
      ⁠</a>8.1. Introduction</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Overview_of_Enterprise_JavaBeans">
      ⁠</a>8.1.1. Overview of Enterprise JavaBeans</h2></div></div></div><div class="para">
		Enterprise JavaBeans (EJB) 3.1 is an API for developing distributed, transactional, secure and portable Java EE applications through the use of server-side components called Enterprise Beans. Enterprise Beans implement the business logic of an application in a decoupled manner that encourages reuse. Enterprise JavaBeans 3.1 is documented as the Java EE specification JSR-318.
	</div><div class="para">
		JBoss EAP 6 has full support for applications built using the Enterprise JavaBeans 3.1 specification.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4525-591667+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Enterprise+JavaBeans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4525-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="EJB_31_Feature_Set">
      ⁠</a>8.1.2. EJB 3.1 Feature Set</h2></div></div></div><div class="para">
		The following features are supported in EJB 3.1
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Session Beans
			</div></li><li class="listitem"><div class="para">
				Message Driven Beans
			</div></li><li class="listitem"><div class="para">
				No-interface views
			</div></li><li class="listitem"><div class="para">
				local interfaces
			</div></li><li class="listitem"><div class="para">
				remote interfaces
			</div></li><li class="listitem"><div class="para">
				JAX-WS web services
			</div></li><li class="listitem"><div class="para">
				JAX-RS web services
			</div></li><li class="listitem"><div class="para">
				Timer Service
			</div></li><li class="listitem"><div class="para">
				Asynchronous Calls
			</div></li><li class="listitem"><div class="para">
				Interceptors
			</div></li><li class="listitem"><div class="para">
				RMI/IIOP interoperability
			</div></li><li class="listitem"><div class="para">
				Transaction support
			</div></li><li class="listitem"><div class="para">
				Security
			</div></li><li class="listitem"><div class="para">
				Embeddable API
			</div></li></ul></div><div class="para">
		The following features are supported in EJB 3.1 but are proposed for "pruning". This means that these features may become optional in Java EE 7.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Entity Beans (container and bean-managed persistence)
			</div></li><li class="listitem"><div class="para">
				EJB 2.1 Entity Bean client views
			</div></li><li class="listitem"><div class="para">
				EJB Query Language (EJB QL)
			</div></li><li class="listitem"><div class="para">
				JAX-RPC based Web Services (endpoints and client views)
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4533-591667+%5BLatest%5D&amp;comment=Title%3A+EJB+3.1+Feature+Set%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4533-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="EJB_31_Lite">
      ⁠</a>8.1.3. EJB 3.1 Lite</h2></div></div></div><div class="para">
		EJB Lite is a sub-set of the EJB 3.1 specification. It provides a simpler version of the full EJB 3.1 specification as part of the Java EE 6 web profile.
	</div><div class="para">
		EJB Lite simplifies the implementation of business logic in web applications with enterprise beans by:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
				Only supporting the features that make sense for web-applications, and
			</div></li><li class="listitem"><div class="para">
				allowing EJBs to be deployed in the same WAR file as a web-application.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4529-591667+%5BLatest%5D&amp;comment=Title%3A+EJB+3.1+Lite%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4529-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="EJB_31_Lite_Features">
      ⁠</a>8.1.4. EJB 3.1 Lite Features</h2></div></div></div><div class="para">
		EJB Lite includes the following features:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Stateless, stateful, and singleton session beans
			</div></li><li class="listitem"><div class="para">
				Local business interfaces and "no interface" beans
			</div></li><li class="listitem"><div class="para">
				Interceptors
			</div></li><li class="listitem"><div class="para">
				Container-managed and bean-managed transactions
			</div></li><li class="listitem"><div class="para">
				Declarative and programmatic security
			</div></li><li class="listitem"><div class="para">
				Embeddable API
			</div></li></ul></div><div class="para">
		The following features of EJB 3.1 are specifically not included:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Remote interfaces
			</div></li><li class="listitem"><div class="para">
				RMI-IIOP Interoperability
			</div></li><li class="listitem"><div class="para">
				JAX-WS Web Service Endpoints
			</div></li><li class="listitem"><div class="para">
				EJB Timer Service
			</div></li><li class="listitem"><div class="para">
				Asynchronous session bean invocations
			</div></li><li class="listitem"><div class="para">
				Message-driven beans
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4531-591667+%5BLatest%5D&amp;comment=Title%3A+EJB+3.1+Lite+Features%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4531-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enterprise_Beans">
      ⁠</a>8.1.5. Enterprise Beans</h2></div></div></div><div class="para">
		Enterprise beans are server-side application components as defined in the Enterprise JavaBeans (EJB) 3.1 specification, JSR-318. Enterprise beans are designed for the implementation of application business logic in a decoupled manner to encourage reuse.
	</div><div class="para">
		Enterprise beans are written as Java classes and annotated with the appropriate EJB annotations. They can be deployed to the application server in their own archive (a JAR file) or be deployed as part of a Java EE application. The application server manages the lifecycle of each enterprise bean and provides services to them such as security, transactions, and concurrency management.
	</div><div class="para">
		An enterprise bean can also define any number of business interfaces. Business interfaces provide greater control over which of the bean's methods are available to clients and can also allow access to clients running in remote JVMs.
	</div><div class="para">
		There are three types of Enterprise Bean: Session beans, Message-driven beans and Entity beans.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Entity beans are now deprecated in EJB 3.1 and Red Hat recommends the use of JPA entities instead. Red Hat only recommends the use of Entity beans for backwards compatibility with legacy systems.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5089-591681+%5BLatest%5D&amp;comment=Title%3A+Enterprise+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5089-591681+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Overview_of_Writing_Enterprise_Beans">
      ⁠</a>8.1.6. Overview of Writing Enterprise Beans</h2></div></div></div><div class="para">
		Enterprise beans are server-side components designed to encapsulate business logic in a manner decoupled from any one specific application client. By implementing your business logic within enterprise beans you will be able to reuse those beans in multiple applications.
	</div><div class="para">
		Enterprise beans are written as annotated Java classes and do not have to implement any specific EJB interfaces or be sub-classed from any EJB super classes to be considered an enterprise bean.
	</div><div class="para">
		EJB 3.1 enterprise beans are packaged and deployed in Java archive (JAR) files. An enterprise bean JAR file can be deployed to your application server, or included in an enterprise archive (EAR) file and deployed with that application. It is also possible to deploy enterprise beans in a WAR file along side a web application.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5090-626311+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Writing+Enterprise+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5090-626311+31+Mar+2014+01%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Session_Bean_Business_Interfaces">
      ⁠</a>8.1.7. Session Bean Business Interfaces</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Enterprise_Bean_Business_Interfaces">
      ⁠</a>8.1.7.1. Enterprise Bean Business Interfaces</h3></div></div></div><div class="para">
		An EJB business interface is a Java interface written by the bean developer which provides declarations of the public methods of a session bean that are available for clients. Session beans can implement any number of interfaces including none (a "no-interface" bean).
	</div><div class="para">
		Business interfaces can be declared as local or remote interfaces but not both.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5096-591681+%5BLatest%5D&amp;comment=Title%3A+Enterprise+Bean+Business+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5096-591681+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="EJB_Local_Business_Interfaces">
      ⁠</a>8.1.7.2. EJB Local Business Interfaces</h3></div></div></div><div class="para">
		An EJB local business interface declares the methods which are available when the bean and the client are in the same JVM. When a session bean implements a local business interface only the methods declared in that interface will be available to clients.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5354-591693+%5BLatest%5D&amp;comment=Title%3A+EJB+Local+Business+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5354-591693+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="EJB_Remote_Business_Interfaces">
      ⁠</a>8.1.7.3. EJB Remote Business Interfaces</h3></div></div></div><div class="para">
		An EJB remote business interface declares the methods which are available to remote clients. Remote access to a session bean that implements a remote interface is automatically provided by the EJB container.
	</div><div class="para">
		A remote client is any client running in a different JVM and can include desktop applications as well as web applications, services and enterprise beans deployed to a different application server.
	</div><div class="para">
		Local clients can access the methods exposed by a remote business interface. 
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5355-741424+%5BLatest%5D&amp;comment=Title%3A+EJB+Remote+Business+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5355-741424+05+Feb+2015+01%3A01+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="EJB_No-interface_Beans">
      ⁠</a>8.1.7.4. EJB No-interface Beans</h3></div></div></div><div class="para">
		A session bean that does not implement any business interfaces is called a no-interface bean. All of the public methods of no-interface beans are accessible to local clients.
	</div><div class="para">
		A session bean that implements a business interface can also be written to expose a "no-interface" view.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5356-591693+%5BLatest%5D&amp;comment=Title%3A+EJB+No-interface+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5356-591693+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Creating_Enterprise_Bean_Projects">
      ⁠</a>8.2. Creating Enterprise Bean Projects</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_an_EJB_Archive_Project_Using_JBoss_Developer_Studio">
      ⁠</a>8.2.1. Create an EJB Archive Project Using Red Hat JBoss Developer Studio</h2></div></div></div><div class="para">
		This task describes how to create an Enterprise JavaBeans (EJB) project in Red Hat JBoss Developer Studio.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A server and server runtime for JBoss EAP 6 has been set up. See <a class="xref" href="chap-Get_Started_Developing_Applications.html#Add_the_JBoss_EAP_Server_Using_Define_New_Server">Section 1.3.1.5, “Add the JBoss EAP Server Using Define New Server”</a> .
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550723366720">
      ⁠</a><p class="title"><strong>Procedure 8.1. Create an EJB Project in Red Hat JBoss Developer Studio</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create new project</strong></p><div class="para">
				To open the New EJB Project wizard, navigate to the <span class="guimenu"><strong>File</strong></span> menu, select <span class="guisubmenu"><strong> New</strong></span>, and then <span class="guimenuitem"><strong>EJB Project</strong></span>.
			</div><div class="figure"><a id="idm140550798212816">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/6585.png" alt="New EJB Project wizard"/></div></div><p class="title"><strong>Figure 8.1. New EJB Project wizard</strong></p></div></li><li class="step"><p class="title"><strong>Specify Details</strong></p><div class="para">
				Supply the following details:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Project name.
					</div><div class="para">
						As well as the being the name of the project that appears in Red Hat JBoss Developer Studio this is also the default filename for the deployed JAR file.
					</div></li><li class="listitem"><div class="para">
						Project location.
					</div><div class="para">
						The directory where the project's files will be saved. The default is a directory in the current workspace.
					</div></li><li class="listitem"><div class="para">
						Target Runtime.
					</div><div class="para">
						This is the server runtime used for the project. This will need to be set to the same JBoss EAP 6 runtime used by the server that you will be deploying to.
					</div></li><li class="listitem"><div class="para">
						EJB module version. This is the version of the EJB specification that your enterprise beans will comply with. Red Hat recommends using <code class="literal">3.1</code>.
					</div></li><li class="listitem"><div class="para">
						Configuration. This allows you to adjust the supported features in your project. Use the default configuration for your selected runtime.
					</div></li></ul></div><div class="para">
				Click <span class="guibutton"><strong>Next</strong></span> to continue.
			</div></li><li class="step"><p class="title"><strong>Java Build Configuration</strong></p><div class="para">
				This screen allows you to customize the directories will contain Java source files and the directory where the built output is placed.
			</div><div class="para">
				Leave this configuration unchanged and click <span class="guibutton"><strong>Next</strong></span>.
			</div></li><li class="step"><p class="title"><strong>EJB Module settings</strong></p><div class="para">
				Check the <span class="guilabel"><strong>Generate ejb-jar.xml deployment descriptor</strong></span> checkbox if a deployment descriptor is required. The deployment descriptor is optional in EJB 3.1 and can be added later if required.
			</div><div class="para">
				Click <span class="guibutton"><strong>Finish</strong></span> and the project is created and will be displayed in the Project Explorer.
			</div><div class="figure"><a id="idm140550723459200">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/47.png" alt="Newly created EJB Project in the Project Explorer"/></div></div><p class="title"><strong>Figure 8.2. Newly created EJB Project in the Project Explorer</strong></p></div></li><li class="step"><p class="title"><strong>Add Build Artifact to Server for Deployment</strong></p><div class="para">
				Open the <span class="guilabel"><strong>Add and Remove</strong></span> dialog by right-clicking on the server you want to deploy the built artifact to in the server tab, and select "Add and Remove".
			</div><div class="para">
				Select the resource to deploy from the <span class="guilabel"><strong>Available</strong></span> column and click the <span class="guibutton"><strong>Add</strong></span> button. The resource will be moved to the <span class="guilabel"><strong>Configured</strong></span> column. Click <span class="guibutton"><strong>Finish</strong></span> to close the dialog.
			</div><div class="figure"><a id="idm140550784759216">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/48.png" alt="Add and Remove dialog"/></div></div><p class="title"><strong>Figure 8.3. Add and Remove dialog</strong></p></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			You now have an EJB Project in Red Hat JBoss Developer Studio that can build and deploy to the specified server.
		</div><div class="para">
		If no enterprise beans are added to the project then Red Hat JBoss Developer Studio will display the warning "An EJB module must contain one or more enterprise beans." This warning will disappear once one or more enterprise beans have been added to the project.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5385-744622+%5BLatest%5D&amp;comment=Title%3A+Create+an+EJB+Archive+Project+Using+Red+Hat+JBoss+Developer+Studio%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5385-744622+24+Feb+2015+14%3A21+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_an_EJB_Archive_Project_in_Maven">
      ⁠</a>8.2.2. Create an EJB Archive Project in Maven</h2></div></div></div><div class="para">
		This task demonstrates how to create a project using Maven that contains one or more enterprise beans packaged in a JAR file.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites:</strong></p><ul><li class="listitem"><div class="para">
				Maven is already installed.
			</div></li><li class="listitem"><div class="para">
				You understand the basic usage of Maven.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550721308704">
      ⁠</a><p class="title"><strong>Procedure 8.2. Create an EJB Archive project in Maven</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create the Maven project</strong></p><div class="para">
				An EJB project can be created using Maven's archetype system and the <code class="code">ejb-javaee6</code> archetype. To do this run the <code class="command">mvn</code> command with parameters as shown:
			</div><pre class="synopsis"> mvn archetype:generate -DarchetypeGroupId=org.codehaus.mojo.archetypes -DarchetypeArtifactId=ejb-javaee6 </pre><div class="para">
				Maven will prompt you for the <code class="code">groupId</code>, <code class="code">artifactId</code>, <code class="code">version</code> and <code class="code">package</code> for your project.
			</div><pre class="screen">[localhost]$ mvn archetype:generate -DarchetypeGroupId=org.codehaus.mojo.archetypes -DarchetypeArtifactId=ejb-javaee6
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] &gt;&gt;&gt; maven-archetype-plugin:2.0:generate (default-cli) @ standalone-pom &gt;&gt;&gt;
[INFO] 
[INFO] &lt;&lt;&lt; maven-archetype-plugin:2.0:generate (default-cli) @ standalone-pom &lt;&lt;&lt;
[INFO] 
[INFO] --- maven-archetype-plugin:2.0:generate (default-cli) @ standalone-pom ---
[INFO] Generating project in Interactive mode
[INFO] Archetype [org.codehaus.mojo.archetypes:ejb-javaee6:1.5] found in catalog remote
Define value for property 'groupId': : com.shinysparkly
Define value for property 'artifactId': : payment-arrangments
Define value for property 'version':  1.0-SNAPSHOT: : 
Define value for property 'package':  com.shinysparkly: : 
Confirm properties configuration:
groupId: com.company
artifactId: payment-arrangments
version: 1.0-SNAPSHOT
package: com.company.collections
Y: : 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 32.440s
[INFO] Finished at: Mon Oct 31 10:11:12 EST 2011
[INFO] Final Memory: 7M/81M
[INFO] ------------------------------------------------------------------------
[localhost]$</pre></li><li class="step"><p class="title"><strong>Add your enterprise beans</strong></p><div class="para">
				Write your enterprise beans and add them to the project under the <code class="filename">src/main/java</code> directory in the appropriate sub-directory for the bean's package.
			</div></li><li class="step"><p class="title"><strong>Build the project</strong></p><div class="para">
				To build the project, run the <code class="command">mvn package</code> command in the same directory as the <code class="filename">pom.xml</code> file. This will compile the Java classes and package the JAR file. The built JAR file is named <code class="filename"><em class="replaceable">artifactId</em>-<em class="replaceable">version</em>.jar</code> and is placed in the <code class="filename">target/</code> directory.
			</div></li></ol></div><div class="para">
		RESULT: You now have a Maven project that builds and packages a JAR file. This project can contain enterprise beans and the JAR file can be deployed to an application server.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5099-591683+%5BLatest%5D&amp;comment=Title%3A+Create+an+EJB+Archive+Project+in+Maven%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5099-591683+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_an_EAR_Project_containing_an_EJB_Project">
      ⁠</a>8.2.3. Create an EAR Project containing an EJB Project</h2></div></div></div><div class="para">
		This task describes how to create a new Enterprise Archive (EAR) project in Red Hat JBoss Developer Studio that contains an EJB Project.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A server and server runtime for JBoss EAP 6 has been set up. See <a class="xref" href="chap-Get_Started_Developing_Applications.html#Add_the_JBoss_EAP_Server_Using_Define_New_Server">Section 1.3.1.5, “Add the JBoss EAP Server Using Define New Server”</a>. 
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550786023152">
      ⁠</a><p class="title"><strong>Procedure 8.3. Create an EAR Project containing an EJB Project</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the New EAR Application Project Wizard</strong></p><div class="para">
				Navigate to the <span class="guimenu"><strong>File</strong></span> menu, select <span class="guisubmenu"><strong> New</strong></span>, then <span class="guimenuitem"><strong>Project</strong></span> and the <span class="guilabel"><strong>New Project</strong></span> wizard appears. Select <span class="guimenuitem"><strong>Java EE/Enterprise Application Project</strong></span> and click <span class="guibutton"><strong>Next</strong></span>.
			</div><div class="figure"><a id="idm140550797732864">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/6584.png" alt="New EAR Application Project Wizard"/></div></div><p class="title"><strong>Figure 8.4. New EAR Application Project Wizard</strong></p></div></li><li class="step"><p class="title"><strong>Supply details</strong></p><div class="para">
				Supply the following details:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Project name.
					</div><div class="para">
						As well as the being the name of the project that appears in Red Hat JBoss Developer Studio this is also the default filename for the deployed EAR file.
					</div></li><li class="listitem"><div class="para">
						Project location.
					</div><div class="para">
						The directory where the project's files will be saved. The default is a directory in the current workspace.
					</div></li><li class="listitem"><div class="para">
						Target Runtime.
					</div><div class="para">
						This is the server runtime used for the project. This will need to be set to the same JBoss EAP 6 runtime used by the server that you will be deploying to.
					</div></li><li class="listitem"><div class="para">
						EAR version.
					</div><div class="para">
						This is the version of the Java Enterprise Edition specification that your project will comply with. Red Hat recommends using <code class="literal">6</code>.
					</div></li><li class="listitem"><div class="para">
						Configuration. This allows you to adjust the supported features in your project. Use the default configuration for your selected runtime.
					</div></li></ul></div><div class="para">
				Click <span class="guibutton"><strong>Next</strong></span> to continue.
			</div></li><li class="step"><p class="title"><strong>Add a new EJB Module</strong></p><div class="para">
				New Modules can be added from the <span class="guilabel"><strong>Enterprise Application</strong></span> page of the wizard. To add a new EJB Project as a module follow the steps below:
			</div><ol class="substeps a"><li class="step"><p class="title"><strong>Add new EJB Module</strong></p><div class="para">
						Click <span class="guibutton"><strong>New Module</strong></span>, uncheck <span class="guilabel"><strong>Create Default Modules</strong></span> checkbox, select the <span class="guilabel"><strong>Enterprise Java Bean</strong></span> and click <span class="guibutton"><strong>Next</strong></span>. The <span class="guilabel"><strong>New EJB Project</strong></span> wizard appears.
					</div></li><li class="step"><p class="title"><strong>Create EJB Project</strong></p><div class="para">
						<span class="guilabel"><strong>New EJB Project</strong></span> wizard is the same as the wizard used to create new standalone EJB Projects and is described in <a class="xref" href="chap-Enterprise_JavaBeans.html#Create_an_EJB_Archive_Project_Using_JBoss_Developer_Studio">Section 8.2.1, “Create an EJB Archive Project Using Red Hat JBoss Developer Studio”</a>.
					</div><div class="para">
						The minimal details required to create the project are:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								Project name
							</div></li><li class="listitem"><div class="para">
								Target Runtime
							</div></li><li class="listitem"><div class="para">
								EJB Module version
							</div></li><li class="listitem"><div class="para">
								Configuration
							</div></li></ul></div><div class="para">
						All the other steps of the wizard are optional. Click <span class="guibutton"><strong>Finish</strong></span> to complete creating the EJB Project.
					</div></li></ol><div class="para">
				The newly created EJB project is listed in the Java EE module dependencies and the checkbox is checked.
			</div></li><li class="step"><p class="title"><strong>Optional: add an application.xml deployment descriptor</strong></p><div class="para">
				Check the <span class="guilabel"><strong>Generate application.xml deployment descriptor</strong></span> checkbox if one is required.
			</div></li><li class="step"><p class="title"><strong>Click Finish</strong></p><div class="para">
				Two new project will appear, the EJB project and the EAR project
			</div></li><li class="step"><p class="title"><strong>Add Build Artifact to Server for Deployment</strong></p><div class="para">
				Open the <span class="guilabel"><strong>Add and Remove</strong></span> dialog by right-clicking in the <span class="guilabel"><strong>Servers</strong></span> tab on the server you want to deploy the built artifact to in the server tab, and select <span class="guimenuitem"><strong>Add and Remove</strong></span>.
			</div><div class="para">
				Select the EAR resource to deploy from the <span class="guilabel"><strong>Available</strong></span> column and click the <span class="guibutton"><strong>Add</strong></span> button. The resource will be moved to the <span class="guilabel"><strong>Configured</strong></span> column. Click <span class="guibutton"><strong>Finish</strong></span> to close the dialog.
			</div><div class="figure"><a id="idm140550812646768">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/51.png" alt="Add and Remove dialog"/></div></div><p class="title"><strong>Figure 8.5. Add and Remove dialog</strong></p></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			You now have an Enterprise Application Project with a member EJB Project. This will build and deploy to the specified server as a single EAR deployment containing an EJB subdeployment.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5098-744621+%5BLatest%5D&amp;comment=Title%3A+Create+an+EAR+Project+containing+an+EJB+Project%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5098-744621+24+Feb+2015+14%3A20+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Add_a_Deployment_Descriptor_to_an_EJB_Project">
      ⁠</a>8.2.4. Add a Deployment Descriptor to an EJB Project</h2></div></div></div><div class="para">
		An EJB deployment descriptor can be added to an EJB project that was created without one. To do this, follow the procedure below.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Perquisites:</strong></p><ul><li class="listitem"><div class="para">
				You have a EJB Project in Red Hat JBoss Developer Studio to which you want to add an EJB deployment descriptor.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550792253200">
      ⁠</a><p class="title"><strong>Procedure 8.4. Add an Deployment Descriptor to an EJB Project</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the Project</strong></p><div class="para">
				Open the project in Red Hat JBoss Developer Studio.
			</div></li><li class="step"><p class="title"><strong>Add Deployment Descriptor</strong></p><div class="para">
				Right-click on the Deployment Descriptor folder in the project view and select <span class="guimenuitem"><strong>Generate Deployment Descriptor Stub</strong></span>.
			</div><div class="figure"><a id="idm140550717949680">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/49.png" alt="Adding a Deployment Descriptor"/></div></div><p class="title"><strong>Figure 8.6. Adding a Deployment Descriptor</strong></p></div></li></ol></div><div class="para">
		The new file, <code class="filename">ejb-jar.xml</code>, is created in <code class="filename">ejbModule/META-INF/</code>. Double-clicking on the Deployment Descriptor folder in the project view will also open this file.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5386-681237+%5BLatest%5D&amp;comment=Title%3A+Add+a+Deployment+Descriptor+to+an+EJB+Project%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5386-681237+03+Jul+2014+10%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Session_Beans">
      ⁠</a>8.3. Session Beans</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Session_Beans">
      ⁠</a>8.3.1. Session Beans</h2></div></div></div><div class="para">
		Session Beans are Enterprise Beans that encapsulate a set of related business processes or tasks and are injected into the classes that request them. There are three types of session bean: stateless, stateful, and singleton.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4527-591667+%5BLatest%5D&amp;comment=Title%3A+Session+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4527-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Stateless_Session_Beans">
      ⁠</a>8.3.2. Stateless Session Beans</h2></div></div></div><div class="para">
		Stateless session beans are the simplest yet most widely used type of session bean. They provide business methods to client applications but do not maintain any state between method calls. Each method is a complete task that does not rely on any shared state within that session bean. Because there is no state, the application server is not required to ensure that each method call is performed on the same instance. This makes stateless session beans very efficient and scalable.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5236-591689+%5BLatest%5D&amp;comment=Title%3A+Stateless+Session+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5236-591689+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Stateful_Session_Beans">
      ⁠</a>8.3.3. Stateful Session Beans</h2></div></div></div><div class="para">
		Stateful session beans are Enterprise Beans that provide business methods to client applications and maintain conversational state with the client. They should be used for tasks that must be done in several steps (method calls), each of which relies on the state of the previous step being maintained. The application server ensures that each client receives the same instance of a stateful session bean for each method call.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5237-759201+%5BLatest%5D&amp;comment=Title%3A+Stateful+Session+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5237-759201+24+May+2015+19%3A48+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Singleton_Session_Beans">
      ⁠</a>8.3.4. Singleton Session Beans</h2></div></div></div><div class="para">
		Singleton session beans are session beans that are instantiated once per application and every client request for a singleton bean goes to the same instance. Singleton beans are an implementation of the Singleton Design Pattern as described in the book <em class="citetitle"> Design Patterns: Elements of Reusable Object-Oriented Software</em> by Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides; published by Addison-Wesley in 1994.
	</div><div class="para">
		Singleton beans provide the smallest memory footprint of all the session bean types but must be designed as thread-safe. EJB 3.1 provides container-managed concurrency (CMC) to allow developers to implement thread safe singleton beans easily. However singleton beans can also be written using traditional multi-threaded code (bean-managed concurrency or BMC) if CMC does not provide enough flexibility.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5238-591689+%5BLatest%5D&amp;comment=Title%3A+Singleton+Session+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5238-591689+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Add_Session_Beans_to_a_Project_in_JBoss_Developer_Studio">
      ⁠</a>8.3.5. Add Session Beans to a Project in Red Hat JBoss Developer Studio</h2></div></div></div><div class="para">
		Red Hat JBoss Developer Studio has several wizards that can be used to quickly create enterprise bean classes. The following procedure shows how to use the Red Hat JBoss Developer Studio wizards to add a session bean to a project.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites:</strong></p><ul><li class="listitem"><div class="para">
				You have a EJB or Dynamic Web Project in Red Hat JBoss Developer Studio to which you want to add one or more session beans.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550804137904">
      ⁠</a><p class="title"><strong>Procedure 8.5. Add Session Beans to a Project in Red Hat JBoss Developer Studio</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the Project</strong></p><div class="para">
				Open the project in Red Hat JBoss Developer Studio.
			</div></li><li class="step"><p class="title"><strong>Open the "Create EJB 3.x Session Bean" wizard</strong></p><div class="para">
				To open the <span class="guilabel"><strong>Create EJB 3.x Session Bean</strong></span> wizard, navigate to the <span class="guimenu"><strong>File</strong></span> menu, select <span class="guisubmenu"><strong> New</strong></span>, and then <span class="guimenuitem"><strong>Session Bean (EJB 3.x)</strong></span>.
			</div><div class="figure"><a id="idm140550726188976">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/44.png" alt="Create EJB 3.x Session Bean wizard"/></div></div><p class="title"><strong>Figure 8.7. Create EJB 3.x Session Bean wizard</strong></p></div></li><li class="step"><p class="title"><strong>Specify class information</strong></p><div class="para">
				Supply the following details:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Project
					</div><div class="para">
						Verify the correct project is selected.
					</div></li><li class="listitem"><div class="para">
						Source folder
					</div><div class="para">
						This is the folder that the Java source files will be created in. This should not usually need to be changed.
					</div></li><li class="listitem"><div class="para">
						Package
					</div><div class="para">
						Specify the package that the class belongs to.
					</div></li><li class="listitem"><div class="para">
						Class name
					</div><div class="para">
						Specify the name of the class that will be the session bean.
					</div></li><li class="listitem"><div class="para">
						Superclass
					</div><div class="para">
						The session bean class can inherit from a super class. Specify that here if your session has a super class.
					</div></li><li class="listitem"><div class="para">
						State type
					</div><div class="para">
						Specify the state type of the session bean: stateless, stateful, or singleton.
					</div></li><li class="listitem"><div class="para">
						Business Interfaces
					</div><div class="para">
						By default the No-interface box is checked so no interfaces will be created. Check the boxes for the interfaces you wish to define and adjust the names if necessary.
					</div><div class="para">
						Remember that enterprise beans in a web archive (WAR) only support EJB 3.1 Lite and this does not include remote business interfaces.
					</div></li></ul></div><div class="para">
				Click <span class="guibutton"><strong>Next</strong></span>.
			</div></li><li class="step"><p class="title"><strong>Session Bean Specific Information</strong></p><div class="para">
				You can enter in additional information here to further customize the session bean. It is not required to change any of the information here.
			</div><div class="para">
				Items that you can change are:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Bean name.
					</div></li><li class="listitem"><div class="para">
						Mapped name.
					</div></li><li class="listitem"><div class="para">
						Transaction type (Container managed or Bean managed).
					</div></li><li class="listitem"><div class="para">
						Additional interfaces can be supplied that the bean must implement.
					</div></li><li class="listitem"><div class="para">
						You can also specify EJB 2.x Home and Component interfaces if required.
					</div></li></ul></div></li><li class="step"><p class="title"><strong>Finish</strong></p><div class="para">
				Click <span class="guibutton"><strong>Finish</strong></span> and the new session bean will be created and added to the project. The files for any new business interfaces will also be created if they were specified.
			</div></li></ol></div><div class="figure"><a id="idm140550728309568">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/45.png" alt="New Session Bean in Red Hat JBoss Developer Studio"/></div></div><p class="title"><strong>Figure 8.8. New Session Bean in Red Hat JBoss Developer Studio</strong></p></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5440-759202+%5BLatest%5D&amp;comment=Title%3A+Add+Session+Beans+to+a+Project+in+Red+Hat+JBoss+Developer+Studio%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5440-759202+24+May+2015+19%3A51+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Message-Driven_Beans">
      ⁠</a>8.4. Message-Driven Beans</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Message-Driven_Beans1">
      ⁠</a>8.4.1. Message-Driven Beans</h2></div></div></div><div class="para">
		Message-driven Beans (MDBs) provide an event driven model for application development. The methods of MDBs are not injected into or invoked from client code but are triggered by the receipt of messages from a messaging service such as a Java Messaging Service (JMS) server. The Java EE 6 specification requires that JMS is supported but other messaging systems can be supported as well.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4528-591667+%5BLatest%5D&amp;comment=Title%3A+Message-Driven+Beans%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4528-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Resource_Adapters">
      ⁠</a>8.4.2. Resource Adapters</h2></div></div></div><div class="para">
		A resource adapter is a deployable Java EE component that provides communication between a Java EE application and an Enterprise Information System (EIS) using the Java Connector Architecture (JCA) specification. A resource adapter is often provided by EIS vendors to allow easy integration of their products with Java EE applications.
	</div><div class="para">
		An Enterprise Information System can be any other software system within an organization. Examples include Enterprise Resource Planning (ERP) systems, database systems, e-mail servers and proprietary messaging systems.
	</div><div class="para">
		A resource adapter is packaged in a Resource Adapter Archive (RAR) file which can be deployed to JBoss EAP 6. A RAR file may also be included in an Enterprise Archive (EAR) deployment.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4516-591663+%5BLatest%5D&amp;comment=Title%3A+Resource+Adapters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4516-591663+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_a_JMS-based_Message-Driven_Bean_in_JBoss_Developer_Studio">
      ⁠</a>8.4.3. Create a JMS-based Message-Driven Bean in Red Hat JBoss Developer Studio</h2></div></div></div><div class="para">
		This procedure shows how to add a JMS-based Message-Driven Bean to a project in Red Hat JBoss Developer Studio. This procedure creates an EJB 3.x Message-Driven Bean that uses annotations.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Prerequisites:</strong></p><ol><li class="listitem"><div class="para">
				You must have an existing project open in Red Hat JBoss Developer Studio.
			</div></li><li class="listitem"><div class="para">
				You must know the name and type of the JMS destination that the bean will be listening to.
			</div></li><li class="listitem"><div class="para">
				Support for Java Messaging Service (JMS) must be enabled in the JBoss EAP 6 configuration to which this bean will be deployed.
			</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550804960048">
      ⁠</a><p class="title"><strong>Procedure 8.6. Add a JMS-based Message-Driven Bean in Red Hat JBoss Developer Studio</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the <span class="guilabel"><strong>Create EJB 3.x Message-Driven Bean</strong></span> Wizard</strong></p><div class="para">
				Go to <span class="guimenu"><strong>File</strong></span> → <span class="guisubmenu"><strong>New</strong></span> → <span class="guimenuitem"><strong>Other</strong></span>. Select <span class="guilabel"><strong>EJB/Message-Driven Bean (EJB 3.x)</strong></span> and click the <span class="guibutton"><strong>Next</strong></span> button.
			</div><div class="figure"><a id="idm140550741225968">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/111.png" alt="Create EJB 3.x Message-Driven Bean Wizard"/></div></div><p class="title"><strong>Figure 8.9. Create EJB 3.x Message-Driven Bean Wizard</strong></p></div></li><li class="step"><p class="title"><strong>Specify class file destination details</strong></p><div class="para">
				There are three sets of details to specify for the bean class here: Project, Java class, and message destination.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Project</span></dt><dd><div class="itemizedlist"><ul><li class="listitem"><div class="para">
									If multiple projects exist in the <span class="guilabel"><strong>Workspace</strong></span>, ensure that the correct one is selected in the <span class="guimenu"><strong>Project</strong></span> menu.
								</div></li><li class="listitem"><div class="para">
									The folder where the source file for the new bean will be created is <code class="filename">ejbModule</code> under the selected project's directory. Only change this if you have a specific requirement.
								</div></li></ul></div></dd><dt><span class="term">Java class</span></dt><dd><div class="itemizedlist"><ul><li class="listitem"><div class="para">
									The required fields are: <span class="guilabel"><strong>Java package</strong></span> and <span class="guilabel"><strong>class name</strong></span>.
								</div></li><li class="listitem"><div class="para">
									It is not necessary to supply a <span class="guilabel"><strong>Superclass</strong></span> unless the business logic of your application requires it.
								</div></li></ul></div></dd><dt><span class="term">Message Destination</span></dt><dd><div class="para">
							These are the details you must supply for a JMS-based Message-Driven Bean:
						</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
									<span class="guilabel"><strong>Destination name</strong></span>. This is the queue or topic name that contains the messages that the bean will respond to.
								</div></li><li class="listitem"><div class="para">
									By default the <span class="guilabel"><strong>JMS</strong></span> checkbox is selected. Do not change this.
								</div></li><li class="listitem"><div class="para">
									Set <span class="guilabel"><strong>Destination type</strong></span> to <span class="guilabel"><strong>Queue</strong></span> or <span class="guilabel"><strong>Topic</strong></span> as required.
								</div></li></ul></div></dd></dl></div><div class="para">
				Click the <span class="guibutton"><strong>Next</strong></span> button.
			</div></li><li class="step"><p class="title"><strong>Enter Message-Driven Bean specific information</strong></p><div class="para">
				The default values here are suitable for a JMS-based Message-Driven bean using Container-managed transactions.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Change the Transaction type to Bean if the Bean will use Bean-managed transactions.
					</div></li><li class="listitem"><div class="para">
						Change the Bean name if a different bean name than the class name is required.
					</div></li><li class="listitem"><div class="para">
						The JMS Message Listener interface will already be listed. You do not need to add or remove any interfaces unless they are specific to your applications business logic.
					</div></li><li class="listitem"><div class="para">
						Leave the checkboxes for creating method stubs selected.
					</div></li></ul></div><div class="para">
				Click the <span class="guibutton"><strong>Finish</strong></span> button.
			</div></li></ol></div><div class="para">
		Result: The Message-Driven Bean is created with stub methods for the default constructor and the <code class="code">onMessage()</code> method. A Red Hat JBoss Developer Studio editor window opened with the corresponding file.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5094-681244+%5BLatest%5D&amp;comment=Title%3A+Create+a+JMS-based+Message-Driven+Bean+in+Red+Hat+JBoss+Developer+Studio%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5094-681244+03+Jul+2014+11%3A02+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Specifying_a_Resource_Adapter_in_jboss-ejb3.xml_for_an_MDB">
      ⁠</a>8.4.4. Specifying a Resource Adapter in <code class="filename">jboss-ejb3.xml</code> for an MDB</h2></div></div></div><div class="para">
		In the <code class="filename">jboss-ejb3.xml</code> deployment descriptor you can specify a resource adapter for an MDB to use. Alternatively, to configure a JBoss EAP 6 server-wide default resource adapter for MDBs, see <em class="citetitle">Configuring Message-Driven Beans</em> in the <em class="citetitle">Administration and Configuration Guide</em>.
	</div><div class="para">
		To specify a resource adapter in <code class="filename">jboss-ejb3.xml</code> for an MDB, use the following example.
	</div><div class="example"><a id="idm140550773300672">
      ⁠</a><p class="title"><strong>Example 8.1. <code class="filename">jboss-ejb3.xml</code> Configuration for an MDB Resource Adapter</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://www.jboss.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:jee=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:mdb=</span><span xmlns="" class="perl_String">"urn:resource-adapter-binding"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jee:assembly-descriptor&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;mdb:resource-adapter-binding&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;jee:ejb-name&gt;</span>MyMDB<span xmlns="" class="perl_Keyword">&lt;/jee:ejb-name&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;mdb:resource-adapter-name&gt;</span>MyResourceAdapter.rar<span xmlns="" class="perl_Keyword">&lt;/mdb:resource-adapter-name&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/mdb:resource-adapter-binding&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/jee:assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss&gt;</span></pre></div></div><div class="para">
		For a resource adapter located in an EAR, you must use the following syntax for <code class="code">&lt;mdb:resource-adapter-name&gt;</code>:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				For a resource adapter that is in another EAR:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mdb:resource-adapter-name&gt;</span>OtherDeployment.ear#MyResourceAdapter.rar<span xmlns="" class="perl_Keyword">&lt;/mdb:resource-adapter-name&gt;</span></pre></li><li class="listitem"><div class="para">
				For a resource adapter that is in the same EAR as the MDB, you can omit the EAR name:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mdb:resource-adapter-name&gt;</span>#MyResourceAdapter.rar<span xmlns="" class="perl_Keyword">&lt;/mdb:resource-adapter-name&gt;</span></pre></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+42008-759203+%5BLatest%5D&amp;comment=Title%3A+Specifying+a+Resource+Adapter+in+%3Cfilename%3Ejboss-ejb3.xml%3C%2Ffilename%3E+for+an+MDB%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42008-759203+24+May+2015+19%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enable_EJB_and_MDB_Property_Substitution_in_an_Application">
      ⁠</a>8.4.5. Enable EJB and MDB Property Substitution in an Application</h2></div></div></div><div class="para">
		A new feature in Red Hat JBoss Enterprise Application Platform allows you to enable property substitution in EJBs and MDBs using the <code class="code">@ActivationConfigProperty</code> and <code class="code">@Resource</code> annotations. Property substitution requires the following configuration and code changes. 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					You must enable property substitution in the JBoss EAP server configuration file.
				</div></li><li class="listitem"><div class="para">
					You must define the system properties in the server configuration file or pass them as arguments when you start the JBoss EAP server.
				</div></li><li class="listitem"><div class="para">
					You must modify the code to use the substitution variables.
				</div></li></ul></div>

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550786257504">
      ⁠</a><p class="title"><strong>Procedure 8.7. Implement Property Substitution in an MDB Application</strong></p><div class="para">
			The following code examples are based on the <code class="literal">helloworld-mdb</code> quickstart that ships with JBoss EAP 6.3 or later. This topic shows you how to modify that quickstart to enable property substitution.
		</div><ol class="1"><li class="step"><p class="title"><strong>Configure the JBoss EAP server to enable property substitution.</strong></p><div class="para">
				The JBoss EAP server must be configured to enable property substitution. To do this, set the <code class="code">&lt;annotation-property-replacement&gt;</code> attribute in the <code class="literal">ee</code> subsystem of the server configuration file to <code class="literal">true</code>.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Back up the server configuration file. The <code class="literal">helloworld-mdb</code> quickstart example requires the full profile for a standalone server, so this is the <code class="filename">standalone/configuration/standalone-full.xml</code> file. If you are running your server in a managed domain, this is the <code class="filename">domain/configuration/domain.xml</code> file.
					</div></li><li class="step"><div class="para">
						Start the JBoss EAP server with the full profile.
					</div><div class="para">
						For Linux: 
<pre class="screen"><code class="command"><em class="replaceable">EAP_HOME</em>/bin/standalone.sh -c standalone-full.xml</code></pre>
						 For Windows: 
<pre class="screen"><code class="command"><em class="replaceable">EAP_HOME</em>bin\standalone.bat -c standalone-full.xml</code></pre>

					</div></li><li class="step"><div class="para">
						Launch the Management CLI using the command for your operating system.
					</div><div class="para">
						For Linux: 
<pre class="screen"><code class="command"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.sh --connect</code></pre>
						 For Windows: 
<pre class="screen"><code class="command"><em class="replaceable">EAP_HOME</em>\bin\jboss-cli.bat --connect</code></pre>

					</div></li><li class="step"><div class="para">
						Type the following command to enable annotation property substitution. 
<pre class="screen"><code class="command">/subsystem=ee:write-attribute(name=annotation-property-replacement,value=true) </code></pre>

					</div></li><li class="step"><div class="para">
						You should see the following result: 
<pre class="screen">{"outcome" =&gt; "success"}</pre>

					</div></li><li class="step"><div class="para">
						Review the changes to the JBoss EAP server configuration file. The <code class="literal">ee</code> subsystem should now contain the following XML. 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:ee:1.2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;spec-descriptor-property-replacement&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/spec-descriptor-property-replacement&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jboss-descriptor-property-replacement&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/jboss-descriptor-property-replacement&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;annotation-property-replacement&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/annotation-property-replacement&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span></pre>

					</div></li></ol></li><li class="step"><p class="title"><strong>Define the system properties.</strong></p><div class="para">
				You can specify the system properties in the server configuration file or you can pass them as command line arguments when you start the JBoss EAP server. System properties defined in the server configuration file take precedence over those passed on the command line when you start the server.
			</div><ul class="stepalternatives">
				<li class="step"><div class="para">
						Define the system properties in the server configuration file.
					</div><ol class="substeps a"><li class="step"><div class="para">
								Start the JBoss EAP server and Management API as described in the previous step.
							</div></li><li class="step"><div class="para">
								Use the following command syntax to configure a system property in the JBoss EAP server: 
<pre class="screen"><code class="command">/system-property=<em class="replaceable">PROPERTY_NAME</em>:add(value=<em class="replaceable">PROPERTY_VALUE</em>) </code></pre>

							</div><div class="para">
								For the <code class="literal">helloworld-mdb</code> quickstart, we configure the following system properties: 
<pre class="screen"><code class="command">/system-property=property.helloworldmdb.queue:add(value=java:/queue/HELLOWORLDMDBPropQueue)</code>
<code class="command">/system-property=property.helloworldmdb.topic:add(value=java:/topic/HELLOWORLDMDBPropTopic)</code>
<code class="command">/system-property=property.connection.factory:add(value=java:/ConnectionFactory)</code></pre>

							</div></li><li class="step"><div class="para">
								Review the changes to the JBoss EAP server configuration file. The following system properties should now appear in the after the <code class="code">&lt;extensions&gt;</code>. 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;system-properties&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"property.helloworldmdb.queue"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"java:/queue/HELLOWORLDMDBPropQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"property.helloworldmdb.topic"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"java:/topic/HELLOWORLDMDBPropTopic"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"property.connection.factory"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"java:/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/system-properties&gt;</span></pre>

							</div></li></ol></li>
				 <li class="step"><div class="para">
						Pass the system properties as arguments on the command line when you start the JBoss EAP server in the form of <code class="command">-D<em class="replaceable">PROPERTY_NAME</em>=<em class="replaceable">PROPERTY_VALUE</em></code>. The following is an example of how to pass the arguments for the system properties defined in the previous step. 
<pre class="screen"><code class="command"><em class="replaceable">EAP_HOME</em>/bin/standalone.sh -c standalone-full.xml -Dproperty.helloworldmdb.queue=java:/queue/HELLOWORLDMDBPropQueue -Dproperty.helloworldmdb.topic=java:/topic/HELLOWORLDMDBPropTopic -Dproperty.connection.factory=java:/ConnectionFactory</code></pre>

					</div></li>

			</ul></li><li class="step"><p class="title"><strong>Modify the code to use the system property substitutions.</strong></p><div class="para">
				Replace hard-coded <code class="code">@ActivationConfigProperty</code> and <code class="code">@Resource</code> annotation values with substitutions for the newly defined system properties. The following are examples of how to change the <code class="literal">helloworld-mdb</code> quickstart to use the newly defined system property substitutions within the annotations in the source code.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Change the <code class="code">@ActivationConfigProperty</code> <code class="literal">destination</code> property value in the <code class="classname">HelloWorldQueueMDB</code> class to use the substitution for the system property. The <code class="code">@MessageDriven</code> annotation should now look like this: 
<pre class="programlisting"><span xmlns="" class="line">​</span>@MessageDriven(name = "HelloWorldQueueMDB", activationConfig = {
<span xmlns="" class="line">​</span>    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
<span xmlns="" class="line">​</span>    @ActivationConfigProperty(propertyName = "destination", propertyValue = "${property.helloworldmdb.queue}"),   
<span xmlns="" class="line">​</span>    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })
</pre>

					</div></li><li class="step"><div class="para">
						Change the <code class="code">@ActivationConfigProperty</code> <code class="literal">destination</code> property value in the <code class="classname">HelloWorldTopicMDB</code> class to use the substitution for the system property. The <code class="code">@MessageDriven</code> annotation should now look like this: 
<pre class="programlisting"><span xmlns="" class="line">​</span>@MessageDriven(name = "HelloWorldQTopicMDB", activationConfig = {
<span xmlns="" class="line">​</span>    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Topic"),
<span xmlns="" class="line">​</span>    @ActivationConfigProperty(propertyName = "destination", propertyValue = "${property.helloworldmdb.topic}"),   
<span xmlns="" class="line">​</span>    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })</pre>

					</div></li><li class="step"><div class="para">
						Change the <code class="code">@Resource</code> annotations in the <code class="classname">HelloWorldMDBServletClient</code> class to use the system property substitutions. The code should now look like this: 
<pre class="programlisting"><span xmlns="" class="line">​</span>@Resource(mappedName = "${property.connection.factory}")
<span xmlns="" class="line">​</span>private ConnectionFactory connectionFactory;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Resource(mappedName = "${property.helloworldmdb.queue}")   
<span xmlns="" class="line">​</span>private Queue queue;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Resource(mappedName = "${property.helloworldmdb.topic}")
<span xmlns="" class="line">​</span>private Topic topic;
</pre>

					</div></li><li class="step"><div class="para">
						Modify the <code class="filename">hornetq-jms.xml</code> file to use the system property substitution values. 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;messaging-deployment</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:messaging-deployment:1.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;hornetq-server&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;jms-destinations&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jms-queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"HELLOWORLDMDBQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"${property.helloworldmdb.queue}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jms-queue&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jms-topic</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"HELLOWORLDMDBTopic"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"${property.helloworldmdb.topic}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jms-topic&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/jms-destinations&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/hornetq-server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/messaging-deployment&gt;</span></pre>

					</div></li></ol></li><li class="step"><div class="para">
				Deploy the application. The application will now use the values specified by the system properties for the <code class="code">@Resource</code> and <code class="code">@ActivationConfigProperty</code> property values.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+30840-744610+%5BLatest%5D&amp;comment=Title%3A+Enable+EJB+and+MDB+Property+Substitution+in+an+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30840-744610+24+Feb+2015+11%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Invoking_Session_Beans">
      ⁠</a>8.5. Invoking Session Beans</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Invoke_a_Session_Bean_Remotely_using_JNDI1">
      ⁠</a>8.5.1. Invoke a Session Bean Remotely using JNDI</h2></div></div></div><div class="para">
		This task describes how to add support to a remote client for the invocation of session beans using JNDI. The task assumes that the project is being built using Maven.
	</div><div class="para">
		The <code class="filename">ejb-remote</code> quickstart contains working Maven projects that demonstrate this functionality. The quickstart contains projects for both the session beans to deploy and the remote client. The code samples below are taken from the remote client project.
	</div><div class="para">
		This task assumes that the session beans do not require authentication.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><div class="para">
			The following prerequisites must be satisfied before beginning:
		</div><ul><li class="listitem"><div class="para">
				You must already have a Maven project created ready to use.
			</div></li><li class="listitem"><div class="para">
				Configuration for the JBoss EAP 6 Maven repository has already been added.
			</div></li><li class="listitem"><div class="para">
				The session beans that you want to invoke are already deployed.
			</div></li><li class="listitem"><div class="para">
				The deployed session beans implement remote business interfaces.
			</div></li><li class="listitem"><div class="para">
				The remote business interfaces of the session beans are available as a Maven dependency. If the remote business interfaces are only available as a JAR file then it is recommended to add the JAR to your Maven repository as an artifact. Refer to the Maven documentation for the <code class="command">install:install-file</code> goal for directions, <a href="http://maven.apache.org/plugins/maven-install-plugin/usage.html">http://maven.apache.org/plugins/maven-install-plugin/usage.html</a>
			</div></li><li class="listitem"><div class="para">
				You need to know the hostname and JNDI port of the server hosting the session beans.
			</div></li></ul></div><div class="para">
		To invoke a session bean from a remote client you must first configure the project correctly.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550788794672">
      ⁠</a><p class="title"><strong>Procedure 8.8. Add Maven Project Configuration for Remote Invocation of Session Beans</strong></p><ol class="1"><li class="step"><div class="para">
				Add the required project dependencies
			</div><div class="para">
				The <code class="filename">pom.xml</code> for the project must be updated to include the necessary dependencies.
			</div></li><li class="step"><div class="para">
				Add the <code class="filename">jboss-ejb-client.properties</code> file
			</div><div class="para">
				The JBoss EJB client API expects to find a file in the root of the project named <code class="filename">jboss-ejb-client.properties</code> that contains the connection information for the JNDI service. Add this file to the <code class="filename">src/main/resources/</code> directory of your project with the following content.
			</div><pre class="programlisting">
# In the following line, set SSL_ENABLED to true for SSL
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default
# Uncomment the following line to set SSL_STARTTLS to true for SSL
# remote.connection.default.connect.options.org.xnio.Options.SSL_STARTTLS=true
remote.connection.default.host=localhost
remote.connection.default.port = 4447
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
# Add any of the following SASL options if required
# remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
# remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOPLAINTEXT=false
# remote.connection.default.connect.options.org.xnio.Options.SASL_DISALLOWED_MECHANISMS=JBOSS-LOCAL-USER
</pre><div class="para">
				Change the host name and port to match your server. <code class="literal">4447</code> is the default port number. For a secure connection, set the <code class="literal">SSL_ENABLED</code> line to <code class="literal">true</code> and uncomment the <code class="literal">SSL_STARTTLS</code> line. The Remoting interface in the container supports secured and unsecured connections using the same port.
			</div></li><li class="step"><div class="para">
				Add dependencies for the remote business interfaces
			</div><div class="para">
				Add the Maven dependencies to the <code class="filename">pom.xml</code> for the remote business interfaces of the session beans.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>&lt;dependency&gt;
<span xmlns="" class="line">​</span>   &lt;groupId&gt;org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">as</span>.<span xmlns="" class="perl_Function">quickstarts</span>&lt;/groupId&gt;
<span xmlns="" class="line">​</span>   &lt;artifactId&gt;jboss-ejb-remote-server-side&lt;/artifactId&gt;
<span xmlns="" class="line">​</span>   &lt;type&gt;ejb-client&lt;/type&gt;
<span xmlns="" class="line">​</span>   &lt;version&gt;${project.<span xmlns="" class="perl_Function">version</span>}&lt;/version&gt;
<span xmlns="" class="line">​</span>&lt;/dependency&gt;</pre></li></ol></div><div class="para">
		Now that the project has been configured correctly, you can add the code to access and invoke the session beans.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550730524688">
      ⁠</a><p class="title"><strong>Procedure 8.9. Obtain a Bean Proxy using JNDI and Invoke Methods of the Bean</strong></p><ol class="1"><li class="step"><div class="para">
				Handle checked exceptions
			</div><div class="para">
				Two of the methods used in the following code (<code class="code">InitialContext()</code> and <code class="code">lookup()</code>) have a checked exception of type <code class="code">javax.naming.NamingException</code>. These method calls must either be enclosed in a try/catch block that catches <code class="code">NamingException</code> or in a method that is declared to throw <code class="code">NamingException</code>. The <code class="filename">ejb-remote</code> quickstart uses the second technique.
			</div></li><li class="step"><div class="para">
				Create a JNDI Context
			</div><div class="para">
				A JNDI Context object provides the mechanism for requesting resources from the server. Create a JNDI context using the following code:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">final</span> Hashtable jndiProperties = <span xmlns="" class="perl_Keyword">new</span> Hashtable();
<span xmlns="" class="line">​</span>jndiProperties.<span xmlns="" class="perl_Function">put</span>(Context.<span xmlns="" class="perl_Function">URL_PKG_PREFIXES</span>, <span xmlns="" class="perl_String">"org.jboss.ejb.client.naming"</span>);
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">final</span> Context context = <span xmlns="" class="perl_Keyword">new</span> InitialContext(jndiProperties);</pre><div class="para">
				The connection properties for the JNDI service are read from the <code class="filename">jboss-ejb-client.properties</code> file.
			</div></li><li class="step"><div class="para">
				Use the JNDI Context's lookup() method to obtain a bean proxy
			</div><div class="para">
				Invoke the <code class="code">lookup()</code> method of the bean proxy and pass it the JNDI name of the session bean you require. This will return an object that must be cast to the type of the remote business interface that contains the methods you want to invoke.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">final</span> RemoteCalculator statelessRemoteCalculator = (RemoteCalculator) context.<span xmlns="" class="perl_Function">lookup</span>(
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_String">"ejb:/jboss-ejb-remote-server-side//CalculatorBean!"</span> + 
<span xmlns="" class="line">​</span>    RemoteCalculator.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>());
</pre><div class="para">
				Session bean JNDI names are defined using a special syntax. For more information, see <a class="xref" href="chap-Enterprise_JavaBeans.html#EJB_JNDI_Naming_Reference">Section 8.8.1, “EJB JNDI Naming Reference”</a> .
			</div></li><li class="step"><div class="para">
				Invoke methods
			</div><div class="para">
				Now that you have a proxy bean object you can invoke any of the methods contained in the remote business interface.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">int</span> a = <span xmlns="" class="perl_Float">204</span>;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">int</span> b = <span xmlns="" class="perl_Float">340</span>;
<span xmlns="" class="line">​</span>System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Adding "</span> + a + <span xmlns="" class="perl_String">" and "</span> + b + <span xmlns="" class="perl_String">" via the remote stateless calculator deployed on the server"</span>);
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">int</span> sum = statelessRemoteCalculator.<span xmlns="" class="perl_Function">add</span>(a, b);
<span xmlns="" class="line">​</span>System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Remote calculator returned sum = "</span> + sum);</pre><div class="para">
				The proxy bean passes the method invocation request to the session bean on the server, where it is executed. The result is returned to the proxy bean which then returns it to the caller. The communication between the proxy bean and the remote session bean is transparent to the caller.
			</div></li></ol></div><div class="para">
		You should now be able to configure a Maven project to support invoking session beans on a remote server and write the code invoke the session beans methods using a proxy bean retrieved from the server using JNDI.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5719-766863+%5BLatest%5D&amp;comment=Title%3A+Invoke+a+Session+Bean+Remotely+using+JNDI%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5719-766863+05+Aug+2015+11%3A28+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_EJB_Client_Contexts">
      ⁠</a>8.5.2. About EJB Client Contexts</h2></div></div></div><div class="para">
		JBoss EAP 6 introduced the EJB client API for managing remote EJB invocations. The JBoss EJB client API uses the EJBClientContext, which may be associated with and be used by one or more threads concurrently. The means an EJBClientContext can potentially contain any number of EJB receivers. An EJB receiver is a component that knows how to communicate with a server that is capable of handling the EJB invocation. Typically, EJB remote applications can be classified into the following: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					A remote client, which runs as a standalone Java application.
				</div></li><li class="listitem"><div class="para">
					A remote client, which runs within another JBoss EAP 6 instance.
				</div></li></ul></div>

	</div><div class="para">
		Depending on the type of remote client, from an EJB client API point of view, there can potentially be more than one EJBClientContext within a JVM.
	</div><div class="para">
		While standalone applications typically have a single EJBClientContext that may be backed by any number of EJB receivers, this isn't mandatory. If a standalone application has more than one EJBClientContext, an EJB client context selector is responsible for returning the appropriate context.
	</div><div class="para">
		In case of remote clients that run within another JBoss EAP 6 instance, each deployed application will have a corresponding EJB client context. Whenever that application invokes another EJB, the corresponding EJB client context is used to find the correct EJB receiver, which then handles the invocation.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14184-592104+%5BLatest%5D&amp;comment=Title%3A+About+EJB+Client+Contexts%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14184-592104+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Limitations_of_Single_EJB_Client_Context">
      ⁠</a>8.5.3. Considerations When Using a Single EJB Context</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			You must consider your application requirements when using a single EJB client context with standalone remote clients. For more information about the different types of remote clients, refer to: <a class="xref" href="chap-Enterprise_JavaBeans.html#About_EJB_Client_Contexts">Section 8.5.2, “About EJB Client Contexts”</a> .
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Typical Process for a Remote Standalone Client with a Single EJB Client Context</div>
			A remote standalone client typically has just one EJB client context backed by any number of EJB receivers. The following is an example of a standalone remote client application: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyApplication {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span>(String args[]) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">Context</span> ctxOne = <span xmlns="" class="perl_Keyword">new</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">InitialContext</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> MyBeanInterface beanOne = ctxOne.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"ejb:app/module/distinct/bean!interface"</span>);
<span xmlns="" class="line">​</span>        beanOne.<span xmlns="" class="perl_Function">doSomething</span>();
<span xmlns="" class="line">​</span>        ...
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre>

		</div><div class="para">
		Remote client JNDI lookups are usually backed by a <code class="filename">jboss-ejb-client.properties</code> file, which is used to set up the EJB client context and the EJB receivers. This configuration also includes the security credentials, which are then used to create the EJB receiver that connects to the JBoss EAP 6 server. When the above code is invoked, the EJB client API looks for the EJB client context, which is then used to select the EJB receiver that will receive and process the EJB invocation request. In this case, there is just the single EJB client context, so that context is used by the above code to invoke the bean. The procedure to invoke a session bean remotely using JNDI is described in greater detail here: <a class="xref" href="chap-Enterprise_JavaBeans.html#Invoke_a_Session_Bean_Remotely_using_JNDI1">Section 8.5.1, “Invoke a Session Bean Remotely using JNDI”</a> .
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Remote Standalone Client Requiring Different Credentials</div>
			A user application may want to invoke a bean more than once, but connect to the JBoss EAP 6 server using different security credentials. The following is an example of a standalone remote client application that invokes the same bean twice: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyApplication {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span>(String args[]) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Use the "foo" security credential connect to the server and invoke this bean instance</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">Context</span> ctxOne = <span xmlns="" class="perl_Keyword">new</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">InitialContext</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> MyBeanInterface beanOne = ctxOne.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"ejb:app/module/distinct/bean!interface"</span>);
<span xmlns="" class="line">​</span>        beanOne.<span xmlns="" class="perl_Function">doSomething</span>();
<span xmlns="" class="line">​</span>        ...
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Use the "bar" security credential to connect to the server and invoke this bean instance</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">Context</span> ctxTwo = <span xmlns="" class="perl_Keyword">new</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">InitialContext</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> MyBeanInterface beanTwo = ctxTwo.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"ejb:app/module/distinct/bean!interface"</span>);
<span xmlns="" class="line">​</span>        beanTwo.<span xmlns="" class="perl_Function">doSomething</span>();
<span xmlns="" class="line">​</span>        ...
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre>

		</div><div class="para">
		In this case, the application wants to connect to the same server instance to invoke the EJB hosted on that server, but wants to use two different credentials while connecting to the server. Because the client application has a single EJB client context, which can have only one EJB receiver for each server instance, this means the above code uses just one credential to connect to the server and the code does not execute as the application expects it to.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Solution</div>
			Scoped EJB client contexts offer a solution to this issue. They provide a way to have more control over the EJB client contexts and their associated JNDI contexts, which are typically used for EJB invocations. For more information about scoped EJB client contexts, refer to <a class="xref" href="chap-Enterprise_JavaBeans.html#Using_Scoped_EJB_Client_Contexts">Section 8.5.4, “Using Scoped EJB Client Contexts”</a>  and <a class="xref" href="chap-Enterprise_JavaBeans.html#Configure_EJBs_Using_a_Map-Based_or_Scoped_Context">Section 8.5.5, “Configure EJBs Using a Scoped EJB Client Context”</a> .
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14185-592104+%5BLatest%5D&amp;comment=Title%3A+Considerations+When+Using+a+Single+EJB+Context%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14185-592104+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_Scoped_EJB_Client_Contexts">
      ⁠</a>8.5.4. Using Scoped EJB Client Contexts</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			To invoke an EJB In earlier versions of JBoss EAP 6, you would typically create a JNDI context and pass it the PROVIDER_URL, which would point to the target server. Any invocations done on EJB proxies that were looked up using that JNDI context, would end up on that server. With scoped EJB client contexts, user applications have control over which EJB receiver is used for a specific invocation.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Use Scoped EJB Client Context in a Remote Standalone Client</div>
			Prior to the introduction of scoped EJB client contexts, the context was typically scoped to the client application. Scoped client contexts now allow the EJB client contexts to be scoped with the JNDI contexts. The following is an example of a standalone remote client application that invokes the same bean twice using a scoped EJB client context: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyApplication { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span>(String args[]) {
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Use the "foo" security credential connect to the server and invoke this bean instance</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> Properties ejbClientContextPropsOne = <span xmlns="" class="perl_Function">getPropsForEJBClientContextOne</span>():
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">Context</span> ctxOne = <span xmlns="" class="perl_Keyword">new</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">InitialContext</span>(ejbClientContextPropsOne);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> MyBeanInterface beanOne = ctxOne.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"ejb:app/module/distinct/bean!interface"</span>);
<span xmlns="" class="line">​</span>        beanOne.<span xmlns="" class="perl_Function">doSomething</span>();
<span xmlns="" class="line">​</span>        ...
<span xmlns="" class="line">​</span>        ctxOne.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Use the "bar" security credential to connect to the server and invoke this bean instance</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> Properties ejbClientContextPropsTwo = <span xmlns="" class="perl_Function">getPropsForEJBClientContextTwo</span>():
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">Context</span> ctxTwo = <span xmlns="" class="perl_Keyword">new</span> javax.<span xmlns="" class="perl_Function">naming</span>.<span xmlns="" class="perl_Function">InitialContext</span>(ejbClientContextPropsTwo);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> MyBeanInterface beanTwo = ctxTwo.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"ejb:app/module/distinct/bean!interface"</span>);
<span xmlns="" class="line">​</span>        beanTwo.<span xmlns="" class="perl_Function">doSomething</span>();
<span xmlns="" class="line">​</span>        ...
<span xmlns="" class="line">​</span>        ctxTwo.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre>

		</div><div class="para">
		To use the scoped EJB client context, you configure EJB client properties programmatically and pass the properties on context creation. The properties are the same set of properties that are used in the standard <code class="filename">jboss-ejb-client.properties</code> file. To scope the EJB client context to the JNDI context, you must also specify the <code class="literal">org.jboss.ejb.client.scoped.context</code> property and set its value to <code class="literal">true</code>. This property notifies the EJB client API that it must create an EJB client context, which is backed by EJB receivers, and that the created context is then scoped or visible only to the JNDI context that created it. Any EJB proxies looked up or invoked using this JNDI context will only know of the EJB client context associated with this JNDI context. Other JNDI contexts used by the application to lookup and invoke EJBs will not know about the other scoped EJB client contexts.
	</div><div class="para">
		JNDI contexts that do not pass the <code class="literal">org.jboss.ejb.client.scoped.context</code> property and aren't scoped to an EJB client context will use the default behavior, which is to use the existing EJB client context that is typically tied to the entire application.
	</div><div class="para">
		Scoped EJB client contexts provide user applications with the flexibility that was associated with the JNP based JNDI invocations in previous versions of JBoss EAP. It provides user applications with more control over which JNDI context communicates to which server and how it connects to that server.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			With the scoped context, the underlying resources are no longer handled by the container or the API, so you must close the <code class="code">InitialContext</code> when it is no longer needed. When the <code class="code">InitialContext</code> is closed, the resources are released immediately. The proxies that are bound to it are no longer valid and any invocation will throw an Exception. Failure to close the <code class="code">InitialContext</code> may result in resource and performance issues.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14186-592104+%5BLatest%5D&amp;comment=Title%3A+Using+Scoped+EJB+Client+Contexts%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14186-592104+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_EJBs_Using_a_Map-Based_or_Scoped_Context">
      ⁠</a>8.5.5. Configure EJBs Using a Scoped EJB Client Context</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			EJBs can be configured using a map-based scoped context. This is achieved by programmatically populating a <code class="classname">Properties</code> map using the standard properties found in the <code class="filename">jboss-ejb-client.properties</code>, specifying <code class="literal">true</code> for the <code class="literal">org.jboss.ejb.client.scoped.context</code> property, and passing the properties on the <code class="classname">InitialContext</code> creation.
		</div><div class="para">
		The benefit of using a scoped context is that it allows you to configure access without directly referencing the EJB or importing JBoss classes. It also provides a way to configure and load balance a host at runtime in a multithreaded environment.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550717931952">
      ⁠</a><p class="title"><strong>Procedure 8.10. Configure an EJB Using a Map-Based Scoped Context</strong></p><ol class="1"><li class="step"><p class="title"><strong>Set the Properties</strong></p><div class="para">
				Configure the EJB client properties programmatically, specifying the same set of properties that are used in the standard <code class="filename">jboss-ejb-client.properties</code> file. To enable the scoped context, you must specify the <code class="literal">org.jboss.ejb.client.scoped.context</code> property and set its value to <code class="literal">true</code>. The following is an example that configures the properties programmatically. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Configure  EJB Client properties for the InitialContext</span>
<span xmlns="" class="line">​</span>Properties ejbClientContextProps = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>ejbClientContextProps.<span xmlns="" class="perl_Function">put</span>(“remote.<span xmlns="" class="perl_Function">connections</span>”,”name1”);
<span xmlns="" class="line">​</span>ejbClientContextProps.<span xmlns="" class="perl_Function">put</span>(“remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">name1</span>.<span xmlns="" class="perl_Function">host</span>”,”localhost”);
<span xmlns="" class="line">​</span>ejbClientContextProps.<span xmlns="" class="perl_Function">put</span>(“remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">name1</span>.<span xmlns="" class="perl_Function">port</span>”,”4447”);
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Property to enable scoped EJB client context which will be tied to the JNDI context</span>
<span xmlns="" class="line">​</span>ejbClientContextProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"org.jboss.ejb.client.scoped.context"</span>, “true”);
</pre>

			</div></li><li class="step"><p class="title"><strong>Pass the Properties on the Context Creation</strong></p><div class="para">
				
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Create the context using the configured properties</span>
<span xmlns="" class="line">​</span>InitialContext ic = <span xmlns="" class="perl_Keyword">new</span> InitialContext(ejbClientContextProps);
<span xmlns="" class="line">​</span>MySLSB bean = ic.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"ejb:myapp/ejb//MySLSBBean!"</span> + MySLSB.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>());
</pre>

			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Additional Information</div>
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Contexts generated by lookup EJB proxies are bound by this scoped context and use only the relevant connection parameters. This makes it possible to create different contexts to access data within a client application or to independently access servers using different logins.
					</div></li><li class="listitem"><div class="para">
						In the client, both the scoped <code class="classname">InitialContext</code> and the scoped proxy are passed to threads, allowing each thread to work with the given context. It is also possible to pass the proxy to multiple threads that can use it concurrently.
					</div></li><li class="listitem"><div class="para">
						The scoped context EJB proxy is serialized on the remote call and then deserialized on the server. When it is deserialized, the scoped context information is removed and it returns to its default state. If the deserialized proxy is used on the remote server, because it no longer has the scoped context that was used when it was created, this can result in an <code class="literal">EJBCLIENT000025</code> error or possibly call an unwanted target by using the EJB name.
					</div></li></ul></div>

		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14110-592100+%5BLatest%5D&amp;comment=Title%3A+Configure+EJBs+Using+a+Scoped+EJB+Client+Context%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14110-592100+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="EJB_Client_Properties">
      ⁠</a>8.5.6. EJB Client Properties</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			The following tables list properties that can be configured programmatically or in the <code class="filename">jboss-ejb-client.properties</code> file.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">EJB Client Global Properties</div>
			The following table lists properties that are valid for the whole library within the same scope.
		</div><div class="table"><a id="table-global-ejb-client-properties">
      ⁠</a><p class="title"><strong>Table 8.1. Global Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Global Properties"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property Name </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> <code class="code">endpoint.name</code> </td><td style="text-align: left"> <div class="para">
						Name of the client endpoint. If not set, the default value is <code class="literal">client-endpoint</code>
					</div>
					 <div class="para">
						This can be helpful to distinguish different endpoint settings because the thread name contains this property.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED</code> </td><td style="text-align: left"> <div class="para">
						Boolean value that specifies whether the SSL protocol is enabled for all connections.
					</div>
					 <div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
							Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
						</div></div></div>
					 </td></tr><tr><td style="text-align: left"> <code class="code">deployment.node.selector</code> </td><td style="text-align: left"> <div class="para">
						The fully qualified name of the implementation of <code class="classname">org.jboss.ejb.client.DeploymentNodeSelector</code>.
					</div>
					 <div class="para">
						This is used to load balance the invocation for the EJBs.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code">invocation.timeout</code> </td><td style="text-align: left"> <div class="para">
						The timeout for the EJB handshake or method invocation request/response cycle. The value is in milliseconds.
					</div>
					 <div class="para">
						The invocation of any method throws a <code class="classname">java.util.concurrent.TimeoutException</code> if the execution takes longer than the timeout period. The execution completes and the server is not interrupted.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code">reconnect.tasks.timeout</code> </td><td style="text-align: left"> <div class="para">
						The timeout for the background reconnect tasks. The value is in milliseconds.
					</div>
					 <div class="para">
						If a number of connections are down, the next client EJB invocation will use an algorithm to decide if a reconnect is necessary to find the right node.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code">org.jboss.ejb.client.scoped.context</code> </td><td style="text-align: left"> <div class="para">
						Boolean value that specifies whether to enable the scoped EJB client context. The default value is <code class="literal">false</code>.
					</div>
					 <div class="para">
						If set to <code class="literal">true</code>, the EJB Client will use the scoped context that is tied to the JNDI context. Otherwise the EJB client context will use the global selector in the JVM to determine the properties used to call the remote EJB and host.
					</div>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">EJB Client Connection Properties</div>
			The connection properties start with the prefix <code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code> where the <em class="replaceable">CONNECTION_NAME</em> is a local identifier only used to uniquely identify the connection.
		</div><div class="table"><a id="table-ejb-client-connection-properties">
      ⁠</a><p class="title"><strong>Table 8.2. Connection Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Connection Properties"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property Name </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> <code class="code">remote.connections</code> </td><td style="text-align: left"> <div class="para">
						A comma-separated list of active <code class="literal">connection-names</code>. Each connection is configured by using this name.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.host</code> </td><td style="text-align: left"> <div class="para">
						The host name or IP for the connection.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.port</code> </td><td style="text-align: left"> <div class="para">
						The port for the connection. The default value is 4447.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.username</code> </td><td style="text-align: left"> <div class="para">
						The user name used to authenticate connection security.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.password</code> </td><td style="text-align: left"> <div class="para">
						The password used to authenticate the user.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.connect.timeout</code> </td><td style="text-align: left"> <div class="para">
						The timeout period for the initial connection. After that, the reconnect task will periodically check whether the connection can be established. The value is in milliseconds.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.callback.handler.class</code> </td><td style="text-align: left"> <div class="para">
						Fully qualified name of the <code class="classname">CallbackHandler</code> class. It will be used to establish the connection and can not be changed as long as the connection is open.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.channel.options.org.jboss.remoting3.RemotingOptions.MAX_OUTBOUND_MESSAGES</code> </td><td style="text-align: left"> <div class="para">
						Integer value specifying the maximum number of outbound requests. The default is 80.
					</div>
					 <div class="para">
						There is only one connection from the client (JVM) to the server to handle all invocations.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS</code> </td><td style="text-align: left"> <div class="para">
						Boolean value that determines whether credentials must be provided by the client to connect successfully. The default value is <code class="literal">true</code>.
					</div>
					 <div class="para">
						If set to <code class="literal">true</code>, the client must provide credentials. If set to <code class="literal">false</code>, invocation is allowed as long as the remoting connector does not request a security realm.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.connect.options.org.xnio.Options.SASL_DISALLOWED_MECHANISMS</code> </td><td style="text-align: left"> <div class="para">
						Disables certain SASL mechanisms used for authenticating during connection creation.
					</div>
					 <div class="para">
						<code class="literal">JBOSS-LOCAL-USER</code> means the silent authentication mechanism, used when the client and server are on the same machine, is disabled.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.connect.options.org.xnio.Options.SASL_POLICY_NOPLAINTEXT</code> </td><td style="text-align: left"> <div class="para">
						Boolean value that enables or disables the use of plain text messages during the authentication. If using JAAS, it must be set to false to allow a plain text password.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.connect.options.org.xnio.Options.SSL_ENABLED</code> </td><td style="text-align: left"> <div class="para">
						Boolean value that specifies whether the SSL protocol is enabled for this connection.
					</div>
					 <div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
							Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
						</div></div></div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.connection.<em class="replaceable">CONNECTION_NAME</em></code>.connect.options.org.jboss.remoting3.RemotingOptions.HEARTBEAT_INTERVAL</code> </td><td style="text-align: left"> <div class="para">
						Interval to send a heartbeat between client and server to prevent automatic close, for example, in the case of a firewall. The value is in milliseconds.
					</div>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">EJB Client Cluster Properties</div>
			If the initial connection connects to a clustered environment, the topology of the cluster is received automatically and asynchronously. These properties are used to connect to each received member. Each property starts with the prefix <code class="literal">remote.cluster.<em class="replaceable">CLUSTER_NAME</em></code> where the <em class="replaceable">CLUSTER_NAME</em> refers to the related to the servers Infinispan subsystem configuration.
		</div><div class="table"><a id="table-ejb-client-cluster-properties">
      ⁠</a><p class="title"><strong>Table 8.3. Cluster Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Cluster Properties"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property Name </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.cluster.<em class="replaceable">CLUSTER_NAME</em></code>.clusternode.selector</code> </td><td style="text-align: left"> <div class="para">
						The fully qualified name of the implementation of <code class="classname">org.jboss.ejb.client.ClusterNodeSelector</code>.
					</div>
					 <div class="para">
						This class, rather than <code class="classname">org.jboss.ejb.client.DeploymentNodeSelector</code>, is used to load balance EJB invocations in a clustered environment. If the cluster is completely down, the invocation will fail with <code class="literal">No ejb receiver available</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.cluster.<em class="replaceable">CLUSTER_NAME</em></code>.channel.options.org.jboss.remoting3.RemotingOptions.MAX_OUTBOUND_MESSAGES</code> </td><td style="text-align: left"> <div class="para">
						Integer value specifying the maximum number of outbound requests that can be made to the entire cluster.
					</div>
					 </td></tr><tr><td style="text-align: left"> <code class="code"><code class="literal">remote.cluster.<em class="replaceable">CLUSTER_NAME</em></code>.node.<em class="replaceable">NODE_NAME</em>. channel.options.org.jboss.remoting3.RemotingOptions.MAX_OUTBOUND_MESSAGES</code> </td><td style="text-align: left"> <div class="para">
						Integer value specifying the maximum number of outbound requests that can be made to this specific cluster-node.
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14113-744801+%5BLatest%5D&amp;comment=Title%3A+EJB+Client+Properties%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14113-744801+25+Feb+2015+07%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Remote_EJB_Data_Compression">
      ⁠</a>8.5.7. Remote EJB Data Compression</h2></div></div></div><div class="para">
		Previous versions of JBoss EAP included a feature where the message stream that contained the EJB protocol message could be compressed. This feature has been included in JBoss EAP 6.3 and later.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong/></p></div><div class="admonition"><div class="para">
			Compression currently can only be specified by annotations on the EJB interface which should be on the client and server side. There is not currently an XML equivalent to specify compression hints.
		</div></div></div><div class="para">
		Data compression hints can be specified via the JBoss annotation <code class="methodname">org.jboss.ejb.client.annotation.CompressionHint</code>. The hint values specify whether to compress the request, response or request and response. Adding <code class="literal">@CompressionHint</code> defaults to <code class="literal">compressResponse=true</code> and <code class="literal">compressRequest=true</code>.
	</div><div class="para">
		The annotation can be specified at the interface level to apply to all methods in the EJB's interface such as:
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.annotation.CompressionHint;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">CompressionHint</span>(compressResponse = <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> ClassLevelRequestCompressionRemoteView {
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echo</span>(String msg);
<span xmlns="" class="line">​</span>}</pre><div class="para">
		Or the annotation can be applied to specific methods in the EJB's interface such as:
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.annotation.CompressionHint;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> CompressableDataRemoteView {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">CompressionHint</span>(compressResponse = <span xmlns="" class="perl_Keyword">false</span>, compressionLevel = Deflater.<span xmlns="" class="perl_Function">BEST_COMPRESSION</span>)
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithRequestCompress</span>(String msg);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">CompressionHint</span>(compressRequest = <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithResponseCompress</span>(String msg);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @CompressionHint
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithRequestAndResponseCompress</span>(String msg);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithNoCompress</span>(String msg);
<span xmlns="" class="line">​</span>}</pre><div class="para">
		The <code class="literal">compressionLevel</code> setting shown above can have the following values:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				BEST_COMPRESSION
			</div></li><li class="listitem"><div class="para">
				BEST_SPEED
			</div></li><li class="listitem"><div class="para">
				DEFAULT_COMPRESSION
			</div></li><li class="listitem"><div class="para">
				NO_COMPRESSION
			</div></li></ul></div><div class="para">
		The <code class="literal">compressionLevel</code> setting defaults to <code class="literal">Deflater.DEFAULT_COMPRESSION</code>.
	</div><div class="para">
		Class level annotation with method level overrides:
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>@CompressionHint
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> MethodOverrideDataCompressionRemoteView {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">CompressionHint</span>(compressRequest = <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithResponseCompress</span>(<span xmlns="" class="perl_DataType">final</span> String msg);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">CompressionHint</span>(compressResponse = <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithRequestCompress</span>(<span xmlns="" class="perl_DataType">final</span> String msg);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    String <span xmlns="" class="perl_Function">echoWithNoExplicitDataCompressionHintOnMethod</span>(String msg);
<span xmlns="" class="line">​</span>}</pre><div class="para">
		On the client side ensure the <em class="parameter"><code>org.jboss.ejb.client.view.annotation.scan.enabled</code></em> system property is set to <code class="literal">true</code>. This property tells JBoss EJB Client to scan for annotations.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+44808-768517+%5BLatest%5D&amp;comment=Title%3A+Remote+EJB+Data+Compression%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44808-768517+25+Aug+2015+23%3A49+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Container_Interceptors">
      ⁠</a>8.6. Container Interceptors</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Container_Interceptors">
      ⁠</a>8.6.1. About Container Interceptors</h2></div></div></div><div class="para">
		Standard Java EE interceptors, as defined by the <a href="http://jcp.org/en/jsr/detail?id=318">JSR 318, Enterprise JavaBeans 3.1</a> specification, are expected to run after the container has completed security context propagation, transaction management, and other container provided invocation processing. This is a problem if the application must intercept a call before a specific container interceptor is run.
	</div><div class="para">
		Releases prior to JBoss EAP 6.0 provided a way to plug server side interceptors into the invocation flow so you could run specific application logic before the container completed the invocation processing. This feature was implemented in JBoss EAP 6.1. This implementation allows standard Java EE interceptors to be used as container interceptors, meaning they use the same XSD elements that are allowed in <code class="filename">ejb-jar.xml</code> file for the 3.1 version of the ejb-jar deployment descriptor.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Positioning of the Container Interceptor in the Interceptor Chain</div>
			The container interceptors configured for an EJB are guaranteed to be run before the JBoss EAP provided security interceptors, transaction management interceptors, and other server provided interceptors. This allows specific application container interceptors to process or configure relevant context data before the invocation proceeds.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Differences Between the Container Interceptor and the Java EE Interceptor API</div>
			Although container interceptors are modeled to be similar to Java EE interceptors, there are some differences in the semantics of the API. For example, it is illegal for container interceptors to invoke the <code class="code">javax.interceptor.InvocationContext.getTarget()</code> method because these interceptors are invoked long before the EJB components are setup or instantiated.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+13885-676196+%5BLatest%5D&amp;comment=Title%3A+About+Container+Interceptors%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13885-676196+24+Jun+2014+09%3A21+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_a_Container_Interceptor_Class">
      ⁠</a>8.6.2. Create a Container Interceptor Class</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			Container interceptor classes are simple Plain Old Java Objects (POJOs). They use the <code class="code">@javax.annotation.AroundInvoke</code> to mark the method that is invoked during the invocation on the bean.
		</div><div class="para">
		The following is an example of a container interceptor class that marks the <code class="code">iAmAround</code> method for invocation:
	</div><div class="example"><a id="idm140550812325648">
      ⁠</a><p class="title"><strong>Example 8.2. Container Interceptor Class Example</strong></p><div class="example-contents"><div class="para">
			
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> ClassLevelContainerInterceptor {
<span xmlns="" class="line">​</span>    @AroundInvoke
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Object <span xmlns="" class="perl_Function">iAmAround</span>(<span xmlns="" class="perl_DataType">final</span> InvocationContext invocationContext) <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getClass</span>().<span xmlns="" class="perl_Function">getName</span>() + <span xmlns="" class="perl_String">" "</span> + invocationContext.<span xmlns="" class="perl_Function">proceed</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre>

		</div></div></div><div class="para">
		For an example of a container interceptor descriptor file configured to use this class, see the <code class="filename">jboss-ejb3.xml</code> file described here:  <a class="xref" href="chap-Enterprise_JavaBeans.html#Configure_a_Container_Interceptor">Section 8.6.3, “Configure a Container Interceptor”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+13887-621655+%5BLatest%5D&amp;comment=Title%3A+Create+a+Container+Interceptor+Class%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13887-621655+14+Mar+2014+16%3A34+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_a_Container_Interceptor">
      ⁠</a>8.6.3. Configure a Container Interceptor</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			Container interceptors use the standard Java EE interceptor libraries, meaning they use the same XSD elements that are allowed in <code class="filename">ejb-jar.xml</code> file for the 3.1 version of the ejb-jar deployment descriptor. Because they are based on the standard Jave EE interceptor libraries, container interceptors may only be configured using deployment descriptors. This was done by design so applications would not require any JBoss specific annotation or other library dependencies. For more information about container interceptors, refer to:  <a class="xref" href="chap-Enterprise_JavaBeans.html#About_Container_Interceptors">Section 8.6.1, “About Container Interceptors”</a>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550787767760">
      ⁠</a><p class="title"><strong>Procedure 8.11. Create the Descriptor File to Configure the Container Interceptor</strong></p><ol class="1"><li class="step"><div class="para">
				Create a <code class="filename">jboss-ejb3.xml</code> file in the <code class="filename">META-INF</code> directory of the EJB deployment.
			</div></li><li class="step"><div class="para">
				Configure the container interceptor elements in the descriptor file.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Use the <code class="literal">urn:container-interceptors:1.0</code> namespace to specify configuration of container interceptor elements.
					</div></li><li class="step"><div class="para">
						Use the <code class="literal">&lt;container-interceptors&gt;</code> element to specify the container interceptors.
					</div></li><li class="step"><div class="para">
						Use the <code class="literal">&lt;interceptor-binding&gt;</code> elements to bind the container interceptor to the EJBs. The interceptors can be bound in either of the following ways:
					</div><ul class="stepalternatives">
						<li class="step"><div class="para">
								Bind the interceptor to all the EJBs in the deployment using the <code class="literal">*</code> wildcard.
							</div></li>
						 <li class="step"><div class="para">
								Bind the interceptor at the individual bean level using the specific EJB name.
							</div></li>
						 <li class="step"><div class="para">
								Bind the interceptor at the specific method level for the EJBs.
							</div></li>

					</ul><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							These elements are configured using the EJB 3.1 XSD in the same way it is done for Java EE interceptors.
						</div></div></div></li></ol></li><li class="step"><div class="para">
				Review the following descriptor file for examples of the above elements.
			</div><div class="example"><a id="idm140550724471904">
      ⁠</a><p class="title"><strong>Example 8.3. jboss-ejb3.xml</strong></p><div class="example-contents"><div class="para">
					
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://www.jboss.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xmlns:jee=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xmlns:ci</span> <span xmlns="" class="perl_Others">=</span><span xmlns="" class="perl_String">"urn:container-interceptors:1.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jee:assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ci:container-interceptors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- Default interceptor --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ContainerInterceptorOne<span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- Class level container-interceptor --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AnotherFlowTrackingBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ClassLevelContainerInterceptor<span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- Method specific container-interceptor --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AnotherFlowTrackingBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.MethodSpecificContainerInterceptor<span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>echoWithMethodSpecificContainerInterceptor<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- container interceptors in a specific order --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AnotherFlowTrackingBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;interceptor-order&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ClassLevelContainerInterceptor<span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.MethodSpecificContainerInterceptor<span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>org.jboss.as.test.integration.ejb.container.interceptor.ContainerInterceptorOne<span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/interceptor-order&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>echoInSpecificOrderOfContainerInterceptors<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jee:interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/ci:container-interceptors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/jee:assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

				</div></div></div><div class="para">
				The XSD for the <code class="literal">urn:container-interceptors:1.0</code> namespace is available at <code class="filename"><em class="replaceable">EAP_HOME</em>/docs/schema/jboss-ejb-container-interceptors_1_0.xsd</code>.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+13886-606491+%5BLatest%5D&amp;comment=Title%3A+Configure+a+Container+Interceptor%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13886-606491+26+Feb+2014+15%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Change_the_Security_Context_Identity">
      ⁠</a>8.6.4. Change the Security Context Identity</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			By default, when you make a remote call to an EJB deployed to the application server, the connection to the server is authenticated and any request received over this connection is executed as the identity that authenticated the connection. This is true for both client-to-server and server-to-server calls. If you need to use different identities from the same client, you normally need to open multiple connections to the server so that each one is authenticated as a different identity. Rather than open multiple client connections, you can give permission to the authenticated user to execute a request as a different user.
		</div><div class="para">
		This topic describes how to switch identities on the existing client connection. The code examples are abridged versions of the code in the quickstart. Refer to the <code class="filename">ejb-security-interceptors</code> quickstart for a complete working example.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550812836864">
      ⁠</a><p class="title"><strong>Procedure 8.12. Change the Identity of the Security Context</strong></p><div class="para">
			To change the identity of a secured connection, you must create the following 3 components.
		</div><ol class="1"><li class="step"><p class="title"><strong>Create the client side interceptor</strong></p><div class="para">
				The client side interceptor must implement the <code class="classname">org.jboss.ejb.client.EJBClientInterceptor</code> interface. The interceptor must pass the requested identity through the context data map, which can be obtained via a call to <code class="code">EJBClientInvocationContext.getContextData()</code>. The following is an example of client side interceptor code: 
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> ClientSecurityInterceptor <span xmlns="" class="perl_Keyword">implements</span> EJBClientInterceptor {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handleInvocation</span>(EJBClientInvocationContext context) <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>        Principal currentPrincipal = SecurityActions.<span xmlns="" class="perl_Function">securityContextGetPrincipal</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (currentPrincipal != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>            Map&lt;String, Object&gt; contextData = context.<span xmlns="" class="perl_Function">getContextData</span>();
<span xmlns="" class="line">​</span>            contextData.<span xmlns="" class="perl_Function">put</span>(ServerSecurityInterceptor.<span xmlns="" class="perl_Function">DELEGATED_USER_KEY</span>, currentPrincipal.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        context.<span xmlns="" class="perl_Function">sendRequest</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Object <span xmlns="" class="perl_Function">handleInvocationResult</span>(EJBClientInvocationContext context) <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> context.<span xmlns="" class="perl_Function">getResult</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre>

			</div><div class="para">
				User applications can insert the interceptor into the interceptor chain in the <code class="classname">EJBClientContext</code> in one of the following ways:
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Programmatically</strong></p><div class="para">
						With this approach, you call the <code class="code">org.jboss.ejb.client.EJBClientContext.registerInterceptor(int order, EJBClientInterceptor interceptor)</code> method and pass the <code class="code">order</code> and the <code class="code">interceptor</code> instance. The <code class="code">order</code> determines where this client interceptor is placed in the interceptor chain.
					</div></li>
				 <li class="step"><p class="title"><strong>ServiceLoader Mechanism</strong></p><div class="para">
						With this approach, you create a <code class="filename">META-INF/services/org.jboss.ejb.client.EJBClientInterceptor</code> file and place or package it in the classpath of the client application. The rules for the file are dictated by the <a href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">Java ServiceLoader Mechanism</a>. This file is expected to contain a separate line for each fully qualified class name of the EJB client interceptor implementation. The EJB client interceptor classes must be available in the classpath. EJB client interceptors added using the <code class="classname">ServiceLoader</code> mechanism are added to the end of the client interceptor chain, in the order they are found in the classpath. The <code class="filename">ejb-security-interceptors</code> quickstart uses this approach.
					</div></li>

			</ul></li><li class="step"><p class="title"><strong>Create and configure the server side container interceptor</strong></p><div class="para">
				Container interceptor classes are simple Plain Old Java Objects (POJOs). They use the <code class="code">@javax.annotation.AroundInvoke</code> to mark the method that will be invoked during the invocation on the bean. For more information about container interceptors, refer to:  <a class="xref" href="chap-Enterprise_JavaBeans.html#About_Container_Interceptors">Section 8.6.1, “About Container Interceptors”</a>.
			</div><ol class="substeps a"><li class="step"><p class="title"><strong>Create the container interceptor</strong></p><div class="para">
						This interceptor receives the <code class="classname">InvocationContext</code> with the identity and requests the switch to that new identity. The following is an abridged version of the actual code example: 
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> ServerSecurityInterceptor {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> Logger logger = Logger.<span xmlns="" class="perl_Function">getLogger</span>(ServerSecurityInterceptor.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> String DELEGATED_USER_KEY = ServerSecurityInterceptor.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>() + <span xmlns="" class="perl_String">".DelegationUser"</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @AroundInvoke
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Object <span xmlns="" class="perl_Function">aroundInvoke</span>(<span xmlns="" class="perl_DataType">final</span> InvocationContext invocationContext) <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>        Principal desiredUser = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>        UserPrincipal connectionUser = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Map&lt;String, Object&gt; contextData = invocationContext.<span xmlns="" class="perl_Function">getContextData</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (contextData.<span xmlns="" class="perl_Function">containsKey</span>(DELEGATED_USER_KEY)) {
<span xmlns="" class="line">​</span>            desiredUser = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SimplePrincipal</span>((String) contextData.<span xmlns="" class="perl_Function">get</span>(DELEGATED_USER_KEY));
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            Collection&lt;Principal&gt; connectionPrincipals = SecurityActions.<span xmlns="" class="perl_Function">getConnectionPrincipals</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (connectionPrincipals != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">for</span> (Principal current : connectionPrincipals) {
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">if</span> (current <span xmlns="" class="perl_Keyword">instanceof</span> UserPrincipal) {
<span xmlns="" class="line">​</span>                        connectionUser = (UserPrincipal) current;
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">break</span>;
<span xmlns="" class="line">​</span>                    }
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalStateException(<span xmlns="" class="perl_String">"Delegation user requested but no user on connection found."</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        ContextStateCache stateCache = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (desiredUser != <span xmlns="" class="perl_Keyword">null</span> &amp;&amp; connectionUser != <span xmlns="" class="perl_Keyword">null</span>
<span xmlns="" class="line">​</span>                &amp;&amp; (desiredUser.<span xmlns="" class="perl_Function">getName</span>().<span xmlns="" class="perl_Function">equals</span>(connectionUser.<span xmlns="" class="perl_Function">getName</span>()) == <span xmlns="" class="perl_Keyword">false</span>)) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Comment">// The final part of this check is to verify that the change does actually indicate a change in user.</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Comment">// We have been requested to use an authentication token</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Comment">// so now we attempt the switch.</span>
<span xmlns="" class="line">​</span>                    stateCache = SecurityActions.<span xmlns="" class="perl_Function">pushIdentity</span>(desiredUser, <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">OuterUserCredential</span>(connectionUser));
<span xmlns="" class="line">​</span>                } <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>                    logger.<span xmlns="" class="perl_Function">error</span>(<span xmlns="" class="perl_String">"Failed to switch security context for user"</span>, e);
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Comment">// Don't propagate the exception stacktrace back to the client for security reasons</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">EJBAccessException</span>(<span xmlns="" class="perl_String">"Unable to attempt switching of user."</span>);
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> invocationContext.<span xmlns="" class="perl_Function">proceed</span>();
<span xmlns="" class="line">​</span>        } <span xmlns="" class="perl_Keyword">finally</span> {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// switch back to original context</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (stateCache != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>                SecurityActions.<span xmlns="" class="perl_Function">popIdentity</span>(stateCache);;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
</pre>

					</div></li><li class="step"><p class="title"><strong>Configure the container interceptor</strong></p><div class="para">
						For information on how to configure server side container interceptors, refer to:  <a class="xref" href="chap-Enterprise_JavaBeans.html#Configure_a_Container_Interceptor">Section 8.6.3, “Configure a Container Interceptor”</a>.
					</div></li></ol></li><li class="step"><p class="title"><strong>Create the JAAS LoginModule</strong></p><div class="para">
				This component is responsible for verifying that user is allowed to execute requests as the requested identity. The following abridged code examples show the methods that peform the login and validation: 
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">SuppressWarnings</span>(<span xmlns="" class="perl_String">"unchecked"</span>)
<span xmlns="" class="line">​</span>    @Override
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">login</span>() <span xmlns="" class="perl_Keyword">throws</span> LoginException {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">login</span>() == <span xmlns="" class="perl_Keyword">true</span>) {
<span xmlns="" class="line">​</span>            log.<span xmlns="" class="perl_Function">debug</span>(<span xmlns="" class="perl_String">"super.login()==true"</span>);
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Time to see if this is a delegation request.</span>
<span xmlns="" class="line">​</span>        NameCallback ncb = <span xmlns="" class="perl_Keyword">new</span> NameCallback(<span xmlns="" class="perl_String">"Username:"</span>);
<span xmlns="" class="line">​</span>        ObjectCallback ocb = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ObjectCallback</span>(<span xmlns="" class="perl_String">"Password:"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            callbackHandler.<span xmlns="" class="perl_Function">handle</span>(<span xmlns="" class="perl_Keyword">new</span> Callback[] { ncb, ocb });
<span xmlns="" class="line">​</span>        } <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (e <span xmlns="" class="perl_Keyword">instanceof</span> RuntimeException) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> (RuntimeException) e;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>; <span xmlns="" class="perl_Comment">// If the CallbackHandler can not handle the required callbacks then no chance.</span>
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        String name = ncb.<span xmlns="" class="perl_Function">getName</span>();
<span xmlns="" class="line">​</span>        Object credential = ocb.<span xmlns="" class="perl_Function">getCredential</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (credential <span xmlns="" class="perl_Keyword">instanceof</span> OuterUserCredential) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// This credential type will only be seen for a delegation request, if not seen then the request is not for us.</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Function">delegationAcceptable</span>(name, (OuterUserCredential) credential)) {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                identity = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SimplePrincipal</span>(name);
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Function">getUseFirstPass</span>()) {
<span xmlns="" class="line">​</span>                    String userName = identity.<span xmlns="" class="perl_Function">getName</span>();
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">if</span> (log.<span xmlns="" class="perl_Function">isDebugEnabled</span>())
<span xmlns="" class="line">​</span>                        log.<span xmlns="" class="perl_Function">debug</span>(<span xmlns="" class="perl_String">"Storing username '"</span> + userName + <span xmlns="" class="perl_String">"' and empty password"</span>);
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Comment">// Add the username and an empty password to the shared state map</span>
<span xmlns="" class="line">​</span>                    sharedState.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"javax.security.auth.login.name"</span>, identity);
<span xmlns="" class="line">​</span>                    sharedState.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"javax.security.auth.login.password"</span>, <span xmlns="" class="perl_String">""</span>);
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>                loginOk = <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>; <span xmlns="" class="perl_Comment">// Attempted login but not successful.</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">delegationAcceptable</span>(String requestedUser, OuterUserCredential connectionUser) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (delegationMappings == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    String[] allowedMappings = <span xmlns="" class="perl_Function">loadPropertyValue</span>(connectionUser.<span xmlns="" class="perl_Function">getName</span>(), connectionUser.<span xmlns="" class="perl_Function">getRealm</span>());
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (allowedMappings.<span xmlns="" class="perl_Function">length</span> == <span xmlns="" class="perl_Float">1</span> &amp;&amp; <span xmlns="" class="perl_String">"*"</span>.<span xmlns="" class="perl_Function">equals</span>(allowedMappings[<span xmlns="" class="perl_Float">1</span>])) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// A wild card mapping was found.</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">for</span> (String current : allowedMappings) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (requestedUser.<span xmlns="" class="perl_Function">equals</span>(current)) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>}
</pre>

			</div></li></ol></div><div class="para">
		See the <code class="literal">ejb-security-interceptors</code> quickstart <code class="filename">README.html</code> file for complete instructions and more detailed information about the code.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+13166-665343+%5BLatest%5D&amp;comment=Title%3A+Change+the+Security+Context+Identity%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13166-665343+06+Jun+2014+15%3A38+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_a_Client_Side_Interceptor_in_an_Application">
      ⁠</a>8.6.5. Use a Client Side Interceptor in an Application</h2></div></div></div><div class="para">
		You can plug a client-side interceptor into an application programmatically or using a ServiceLoader mechanism. The following procedure describes the two methods.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Plug the Interceptor into an Application Programmatically </div>
			With this approach, you call the <code class="code">org.jboss.ejb.client.EJBClientContext.registerInterceptor(int order, EJBClientInterceptor interceptor)</code> API and pass the <code class="code">order</code> and the <code class="code">interceptor</code> instance. The <code class="code">order</code> is used to determine where exactly in the client interceptor chain this <code class="code">interceptor</code> is placed.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Plug the Interceptor into an Application via the ServiceLoader Mechanism </div>
			With this approach, you create a <code class="filename">META-INF/services/org.jboss.ejb.client.EJBClientInterceptor</code> file and place or package it in the classpath of the client application. The rules for the file are dictated by the <a href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">Java ServiceLoader Mechanism</a>. This file is expected to contain a separate line for each fully qualified class name of the EJB client interceptor implementation. The EJB client interceptor classes must be available in the classpath. EJB client interceptors added using the <code class="classname">ServiceLoader</code> mechanism are added to the end of the client interceptor chain, in the order they are found in the classpath. The <code class="filename">ejb-security-interceptors</code> quickstart uses this approach.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14138-759204+%5BLatest%5D&amp;comment=Title%3A+Use+a+Client+Side+Interceptor+in+an+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14138-759204+24+May+2015+20%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Clustered_Enterprise_JavaBeans">
      ⁠</a>8.7. Clustered Enterprise JavaBeans</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Clustered_Enterprise_JavaBeans_EJBs">
      ⁠</a>8.7.1. About Clustered Enterprise JavaBeans (EJBs)</h2></div></div></div><div class="para">
		EJB components can be clustered for high-availability scenarios. They use different protocols than HTTP components, so they are clustered in different ways. EJB 2 and 3 stateful and stateless beans can be clustered.
	</div><div class="para">
		For information on singletons, refer here: <a class="xref" href="chap-Clustering_in_Web_Applications.html#Implement_an_HA_Singleton">Section 10.3, “Implement an HA Singleton”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			EJB 2 entity beans cannot be clustered in EAP 6 and henceforth. This is a migration issue.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4663-680486+%5BLatest%5D&amp;comment=Title%3A+About+Clustered+Enterprise+JavaBeans+%28EJBs%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4663-680486+01+Jul+2014+01%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Standalone_Client_Configuration">
      ⁠</a>8.7.2. Standalone and In-server Client Configuration</h2></div></div></div><div class="para">
		To connect an EJB client to a clustered EJB application, you need to expand the existing configuration in standalone EJB client or in-server EJB client to include cluster connection configuration. The <code class="filename">jboss-ejb-client.properties</code> for standalone EJB client, or even <code class="filename">jboss-ejb-client.xml</code> file for a server-side application must be expanded to include a cluster configuration.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			An EJB client is any program that uses an EJB on a remote server. A client is <code class="literal">in-server</code> when the JVM doing the calling to the remote server is itself running inside of a server. In other words, an EAP instance calling out to another EAP instance would be considered an in-server client.
		</div></div></div><div class="para">
		<div class="example"><a id="idm140550774440000">
      ⁠</a><p class="title"><strong>Example 8.4. Standalone client with <code class="literal">jboss-ejb-client.properties</code> configuration</strong></p><div class="example-contents"><div class="para">
				This example shows the additional cluster configuration required for a standalone EJB client.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>remote.clusters=ejb
<span xmlns="" class="line">​</span>remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
<span xmlns="" class="line">​</span>remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED=false
<span xmlns="" class="line">​</span>remote.cluster.ejb.username=test
<span xmlns="" class="line">​</span>remote.cluster.ejb.password=password
</pre></div></div>
		 If an application uses the remote-outbound-connection, you need to configure <code class="filename">jboss-ejb-client.xml</code> file and add cluster configuration as shown in the following example: 
		<div class="example"><a id="idm140550778509168">
      ⁠</a><p class="title"><strong>Example 8.5. Client application which is deployed in another EAP 6 instance (Configuring jboss-ejb-client.xml file)</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-ejb-client</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"urn:jboss:ejb-client:1.2"</span><span xmlns="" class="perl_Others"> xsi:noNamespaceSchemaLocation=</span><span xmlns="" class="perl_String">"jboss-ejb-client_1_2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;client-context&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;ejb-receivers&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- this is the connection to access the app-one --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;remoting-ejb-receiver</span><span xmlns="" class="perl_Others"> outbound-connection-ref=</span><span xmlns="" class="perl_String">"remote-ejb-connection-1"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- this is the connection to access the app-two --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;remoting-ejb-receiver</span><span xmlns="" class="perl_Others"> outbound-connection-ref=</span><span xmlns="" class="perl_String">"remote-ejb-connection-2"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/ejb-receivers&gt;</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- if an outbound connection connects to a cluster; a list of members is provided after successful connection.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">To connect to this node this cluster element must be defined. --&gt;</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;clusters&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">&lt;!-- cluster of remote-ejb-connection-1 --&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;cluster</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ejb"</span><span xmlns="" class="perl_Others"> security-realm=</span><span xmlns="" class="perl_String">"ejb-security-realm-1"</span><span xmlns="" class="perl_Others"> username=</span><span xmlns="" class="perl_String">"quickuser1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;connection-creation-options&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.xnio.Options.SSL_ENABLED"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.xnio.Options.SASL_POLICY_NOANONYMOUS"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/connection-creation-options&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/cluster&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/clusters&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/client-context&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-ejb-client&gt;</span>
</pre></div></div>

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For a secure connection you need to add the credentials to cluster configuration in order to avoid an authentication exception.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+40832-769949+%5BLatest%5D&amp;comment=Title%3A+Standalone+and+In-server+Client+Configuration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=40832-769949+07+Sep+2015+03%3A04+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Implementing_a_Custom_Load_Balancing_Policy_for_EJB_Calls">
      ⁠</a>8.7.3. Implementing a Custom Load Balancing Policy for EJB Calls</h2></div></div></div><div class="para">
		It is possible to implement a custom/alternate load balancing policy so that servers for the application do not handle the same amount of EJB calls in general or for a specific time period.
	</div><div class="para">
		You can implement <code class="literal">AllClusterNodeSelector</code> for EJB calls. The node selection behavior of <code class="literal">AllClusterNodeSelector</code> is similar to default selector except that <code class="literal">AllClusterNodeSelector</code> uses all available cluster nodes even in case of a large cluster (number of nodes&gt;20). If an unconnected cluster node is returned it is opened automatically. The following example shows <code class="literal">AllClusterNodeSelector</code> implementation: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">as</span>.<span xmlns="" class="perl_Function">quickstarts</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">clients</span>.<span xmlns="" class="perl_Function">selector</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Arrays;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Random;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.logging.Level;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.logging.Logger;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.ClusterNodeSelector;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AllClusterNodeSelector <span xmlns="" class="perl_Keyword">implements</span> ClusterNodeSelector {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> Logger LOGGER = Logger.<span xmlns="" class="perl_Function">getLogger</span>(AllClusterNodeSelector.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">selectNode</span>(<span xmlns="" class="perl_DataType">final</span> String clusterName, <span xmlns="" class="perl_DataType">final</span> String[] connectedNodes, <span xmlns="" class="perl_DataType">final</span> String[] availableNodes) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span>(LOGGER.<span xmlns="" class="perl_Function">isLoggable</span>(Level.<span xmlns="" class="perl_Function">FINER</span>)) {
<span xmlns="" class="line">​</span>      LOGGER.<span xmlns="" class="perl_Function">finer</span>(<span xmlns="" class="perl_String">"INSTANCE "</span>+<span xmlns="" class="perl_Keyword">this</span>+ <span xmlns="" class="perl_String">" : cluster:"</span>+clusterName+<span xmlns="" class="perl_String">" connected:"</span>+Arrays.<span xmlns="" class="perl_Function">deepToString</span>(connectedNodes)+<span xmlns="" class="perl_String">" available:"</span>+Arrays.<span xmlns="" class="perl_Function">deepToString</span>(availableNodes));
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (availableNodes.<span xmlns="" class="perl_Function">length</span> == <span xmlns="" class="perl_Float">1</span>) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> availableNodes[<span xmlns="" class="perl_Float">0</span>];
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">final</span> Random random = <span xmlns="" class="perl_Keyword">new</span> Random();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">final</span> <span xmlns="" class="perl_DataType">int</span> randomSelection = random.<span xmlns="" class="perl_Function">nextInt</span>(availableNodes.<span xmlns="" class="perl_Function">length</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> availableNodes[randomSelection];
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}
</pre>
		 You can also implement the <code class="literal">SimpleLoadFactorNodeSelector</code> for EJB calls. Load balancing in <code class="literal">SimpleLoadFactorNodeSelector</code> happens based on a load factor. The load factor (2/3/4) is calculated based on the names of nodes (A/B/C) irrespective of the load on each node. The following example shows <code class="literal">SimpleLoadFactorNodeSelector</code> implementation: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">as</span>.<span xmlns="" class="perl_Function">quickstarts</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">clients</span>.<span xmlns="" class="perl_Function">selector</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.ArrayList;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Arrays;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Collection;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.HashMap;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.List;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Map;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.logging.Level;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.logging.Logger;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.DeploymentNodeSelector;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> SimpleLoadFactorNodeSelector <span xmlns="" class="perl_Keyword">implements</span> DeploymentNodeSelector {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> Logger LOGGER = Logger.<span xmlns="" class="perl_Function">getLogger</span>(SimpleLoadFactorNodeSelector.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">final</span> Map&lt;String, List&lt;String&gt;[]&gt; nodes = <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String, List&lt;String&gt;[]&gt;();
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">final</span> Map&lt;String, Integer&gt; cursor = <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String, Integer&gt;();
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> ArrayList&lt;String&gt; <span xmlns="" class="perl_Function">calculateNodes</span>(Collection&lt;String&gt; eligibleNodes) {
<span xmlns="" class="line">​</span>    ArrayList&lt;String&gt; nodeList = <span xmlns="" class="perl_Keyword">new</span> ArrayList&lt;String&gt;();
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">for</span> (String string : eligibleNodes) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span>(string.<span xmlns="" class="perl_Function">contains</span>(<span xmlns="" class="perl_String">"A"</span>) || string.<span xmlns="" class="perl_Function">contains</span>(<span xmlns="" class="perl_String">"2"</span>)) {
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>      } <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span>(string.<span xmlns="" class="perl_Function">contains</span>(<span xmlns="" class="perl_String">"B"</span>) || string.<span xmlns="" class="perl_Function">contains</span>(<span xmlns="" class="perl_String">"3"</span>)) {
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>      } <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span>(string.<span xmlns="" class="perl_Function">contains</span>(<span xmlns="" class="perl_String">"C"</span>) || string.<span xmlns="" class="perl_Function">contains</span>(<span xmlns="" class="perl_String">"4"</span>)) {
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>        nodeList.<span xmlns="" class="perl_Function">add</span>(string);
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> nodeList;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">SuppressWarnings</span>(<span xmlns="" class="perl_String">"unchecked"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">checkNodeNames</span>(String[] eligibleNodes, String key) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span>(!nodes.<span xmlns="" class="perl_Function">containsKey</span>(key) || nodes.<span xmlns="" class="perl_Function">get</span>(key)[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">size</span>() != eligibleNodes.<span xmlns="" class="perl_Function">length</span> || !nodes.<span xmlns="" class="perl_Function">get</span>(key)[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">containsAll</span>(Arrays.<span xmlns="" class="perl_Function">asList</span>(eligibleNodes))) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// must be synchronized as the client might call it concurrent</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">synchronized</span> (nodes) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span>(!nodes.<span xmlns="" class="perl_Function">containsKey</span>(key) || nodes.<span xmlns="" class="perl_Function">get</span>(key)[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">size</span>() != eligibleNodes.<span xmlns="" class="perl_Function">length</span> || !nodes.<span xmlns="" class="perl_Function">get</span>(key)[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">containsAll</span>(Arrays.<span xmlns="" class="perl_Function">asList</span>(eligibleNodes))) {
<span xmlns="" class="line">​</span>          ArrayList&lt;String&gt; nodeList = <span xmlns="" class="perl_Keyword">new</span> ArrayList&lt;String&gt;();
<span xmlns="" class="line">​</span>          nodeList.<span xmlns="" class="perl_Function">addAll</span>(Arrays.<span xmlns="" class="perl_Function">asList</span>(eligibleNodes));
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          nodes.<span xmlns="" class="perl_Function">put</span>(key, <span xmlns="" class="perl_Keyword">new</span> List[] { nodeList, <span xmlns="" class="perl_Function">calculateNodes</span>(nodeList) });
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_Keyword">synchronized</span> String <span xmlns="" class="perl_Function">nextNode</span>(String key) {
<span xmlns="" class="line">​</span>    Integer c = cursor.<span xmlns="" class="perl_Function">get</span>(key);
<span xmlns="" class="line">​</span>    List&lt;String&gt; nodeList = nodes.<span xmlns="" class="perl_Function">get</span>(key)[<span xmlns="" class="perl_Float">1</span>];
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span>(c == <span xmlns="" class="perl_Keyword">null</span> || c &gt;= nodeList.<span xmlns="" class="perl_Function">size</span>()) {
<span xmlns="" class="line">​</span>      c = Integer.<span xmlns="" class="perl_Function">valueOf</span>(<span xmlns="" class="perl_Float">0</span>);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    String node = nodeList.<span xmlns="" class="perl_Function">get</span>(c);
<span xmlns="" class="line">​</span>    cursor.<span xmlns="" class="perl_Function">put</span>(key, Integer.<span xmlns="" class="perl_Function">valueOf</span>(c + <span xmlns="" class="perl_Float">1</span>));
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> node;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">selectNode</span>(String[] eligibleNodes, String appName, String moduleName, String distinctName) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (LOGGER.<span xmlns="" class="perl_Function">isLoggable</span>(Level.<span xmlns="" class="perl_Function">FINER</span>)) {
<span xmlns="" class="line">​</span>      LOGGER.<span xmlns="" class="perl_Function">finer</span>(<span xmlns="" class="perl_String">"INSTANCE "</span> + <span xmlns="" class="perl_Keyword">this</span> + <span xmlns="" class="perl_String">" : nodes:"</span> + Arrays.<span xmlns="" class="perl_Function">deepToString</span>(eligibleNodes) + <span xmlns="" class="perl_String">" appName:"</span> + appName + <span xmlns="" class="perl_String">" moduleName:"</span> + moduleName
<span xmlns="" class="line">​</span>          + <span xmlns="" class="perl_String">" distinctName:"</span> + distinctName);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// if there is only one there is no sense to choice</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (eligibleNodes.<span xmlns="" class="perl_Function">length</span> == <span xmlns="" class="perl_Float">1</span>) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> eligibleNodes[<span xmlns="" class="perl_Float">0</span>];
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">final</span> String key = appName + <span xmlns="" class="perl_String">"|"</span> + moduleName + <span xmlns="" class="perl_String">"|"</span> + distinctName;
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">checkNodeNames</span>(eligibleNodes, key);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">nextNode</span>(key);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre>

	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuration with <code class="literal">jboss-ejb-client.properties</code></div>
			You need to add the property <code class="literal">remote.cluster.ejb.clusternode.selector</code> with the name of your implementation class (<code class="literal">AllClusterNodeSelector</code> or <code class="literal">SimpleLoadFactorNodeSelector</code>). The selector will see all configured servers which are available at the invocation time. The following example uses <code class="literal">AllClusterNodeSelector</code> as the deployment node selector: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">clusters</span>=ejb
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">cluster</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">clusternode</span>.<span xmlns="" class="perl_Function">selector</span>=org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">as</span>.<span xmlns="" class="perl_Function">quickstarts</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">clients</span>.<span xmlns="" class="perl_Function">selector</span>.<span xmlns="" class="perl_Function">AllClusterNodeSelector</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">cluster</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">connect</span>.<span xmlns="" class="perl_Function">options</span>.<span xmlns="" class="perl_Function">org</span>.<span xmlns="" class="perl_Function">xnio</span>.<span xmlns="" class="perl_Function">Options</span>.<span xmlns="" class="perl_Function">SASL_POLICY_NOANONYMOUS</span>=<span xmlns="" class="perl_Keyword">false</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">cluster</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">connect</span>.<span xmlns="" class="perl_Function">options</span>.<span xmlns="" class="perl_Function">org</span>.<span xmlns="" class="perl_Function">xnio</span>.<span xmlns="" class="perl_Function">Options</span>.<span xmlns="" class="perl_Function">SSL_ENABLED</span>=<span xmlns="" class="perl_Keyword">false</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">cluster</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">username</span>=test
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">cluster</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">password</span>=password
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connectionprovider</span>.<span xmlns="" class="perl_Function">create</span>.<span xmlns="" class="perl_Function">options</span>.<span xmlns="" class="perl_Function">org</span>.<span xmlns="" class="perl_Function">xnio</span>.<span xmlns="" class="perl_Function">Options</span>.<span xmlns="" class="perl_Function">SSL_ENABLED</span>=<span xmlns="" class="perl_Keyword">false</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connections</span>=one,two
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">one</span>.<span xmlns="" class="perl_Function">host</span>=localhost
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">one</span>.<span xmlns="" class="perl_Function">port</span> = <span xmlns="" class="perl_Float">4447</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">one</span>.<span xmlns="" class="perl_Function">connect</span>.<span xmlns="" class="perl_Function">options</span>.<span xmlns="" class="perl_Function">org</span>.<span xmlns="" class="perl_Function">xnio</span>.<span xmlns="" class="perl_Function">Options</span>.<span xmlns="" class="perl_Function">SASL_POLICY_NOANONYMOUS</span>=<span xmlns="" class="perl_Keyword">false</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">one</span>.<span xmlns="" class="perl_Function">username</span>=user
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">one</span>.<span xmlns="" class="perl_Function">password</span>=user123
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">two</span>.<span xmlns="" class="perl_Function">host</span>=localhost
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">two</span>.<span xmlns="" class="perl_Function">port</span> = <span xmlns="" class="perl_Float">4547</span>
<span xmlns="" class="line">​</span>remote.<span xmlns="" class="perl_Function">connection</span>.<span xmlns="" class="perl_Function">two</span>.<span xmlns="" class="perl_Function">connect</span>.<span xmlns="" class="perl_Function">options</span>.<span xmlns="" class="perl_Function">org</span>.<span xmlns="" class="perl_Function">xnio</span>.<span xmlns="" class="perl_Function">Options</span>.<span xmlns="" class="perl_Function">SASL_POLICY_NOANONYMOUS</span>=<span xmlns="" class="perl_Keyword">false</span>
</pre>

		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Using JBoss ejb-client API</div>
			You need to add the property <code class="literal">remote.cluster.ejb.clusternode.selector</code> to the list for the <code class="literal">PropertiesBasedEJBClientConfiguration</code> constructor. The following example uses <code class="literal">AllClusterNodeSelector</code> as the deployment node selector: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Properties p = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.clusters"</span>, <span xmlns="" class="perl_String">"ejb"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.cluster.ejb.clusternode.selector"</span>, <span xmlns="" class="perl_String">"org.jboss.as.quickstarts.ejb.clients.selector.AllClusterNodeSelector"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS"</span>, <span xmlns="" class="perl_String">"false"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED"</span>, <span xmlns="" class="perl_String">"false"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.cluster.ejb.username"</span>, <span xmlns="" class="perl_String">"test"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.cluster.ejb.password"</span>, <span xmlns="" class="perl_String">"password"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED"</span>, <span xmlns="" class="perl_String">"false"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connections"</span>, <span xmlns="" class="perl_String">"one,two"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.one.port"</span>, <span xmlns="" class="perl_String">"4447"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.one.host"</span>, <span xmlns="" class="perl_String">"localhost"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.two.port"</span>, <span xmlns="" class="perl_String">"4547"</span>);
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.two.host"</span>, <span xmlns="" class="perl_String">"localhost"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>EJBClientConfiguration cc = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">PropertiesBasedEJBClientConfiguration</span>(p);
<span xmlns="" class="line">​</span>ContextSelector&lt;EJBClientContext&gt; selector = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ConfigBasedEJBClientContextSelector</span>(cc);
<span xmlns="" class="line">​</span>EJBClientContext.<span xmlns="" class="perl_Function">setSelector</span>(selector);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>p = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>p.<span xmlns="" class="perl_Function">put</span>(Context.<span xmlns="" class="perl_Function">URL_PKG_PREFIXES</span>, <span xmlns="" class="perl_String">"org.jboss.ejb.client.naming"</span>);
<span xmlns="" class="line">​</span>InitialContext context = <span xmlns="" class="perl_Keyword">new</span> InitialContext(p);
</pre>

		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Server application side configuration with <code class="filename">jboss-ejb-client.xml</code></div>
			To use the load balancing policy for server to server communication; package the class together with the application and configure it within the <code class="filename">jboss-ejb-client.xml</code> settings (located in <code class="literal">META-INF</code> folder). The following example uses <code class="literal">AllClusterNodeSelector</code> as the deployment node selector: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-ejb-client</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"urn:jboss:ejb-client:1.2"</span><span xmlns="" class="perl_Others"> xsi:noNamespaceSchemaLocation=</span><span xmlns="" class="perl_String">"jboss-ejb-client_1_2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;client-context</span><span xmlns="" class="perl_Others"> deployment-node-selector=</span><span xmlns="" class="perl_String">"org.jboss.ejb.client.DeploymentNodeSelector"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;ejb-receivers&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- this is the connection to access the app --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;remoting-ejb-receiver</span><span xmlns="" class="perl_Others"> outbound-connection-ref=</span><span xmlns="" class="perl_String">"remote-ejb-connection-1"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/ejb-receivers&gt;</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- if an outbound connection connect to a cluster a list of members is provided after successful connection.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">To connect to this node this cluster element must be defined.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">--&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;clusters&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- cluster of remote-ejb-connection-1 --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;cluster</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ejb"</span><span xmlns="" class="perl_Others"> security-realm=</span><span xmlns="" class="perl_String">"ejb-security-realm-1"</span><span xmlns="" class="perl_Others"> username=</span><span xmlns="" class="perl_String">"test"</span><span xmlns="" class="perl_Others"> cluster-node-selector=</span><span xmlns="" class="perl_String">"org.jboss.as.quickstarts.ejb.clients.selector.AllClusterNodeSelector"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connection-creation-options&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.xnio.Options.SSL_ENABLED"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.xnio.Options.SASL_POLICY_NOANONYMOUS"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/connection-creation-options&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/cluster&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/clusters&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/client-context&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-ejb-client&gt;</span>
</pre>
			 To use the above configuration with security, you will need to add <code class="literal">ejb-security-realm-1</code> to client-server configuration. The following example shows the CLI commands for adding security realm (<code class="literal">ejb-security-realm-1</code>) the value is the base64 encoded password for the user "test": 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>core-service=management/security-realm=ejb-security-realm-1:add()
<span xmlns="" class="line">​</span>core-service=management/security-realm=ejb-security-realm-1/server-identity=secret:add(value=cXVpY2sxMjMr)
</pre>
			 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					If you are using standalone mode use the start option <code class="command">-Djboss.node.name= </code> or the server configuration file <code class="filename">standalone.xml</code> to configure the server name (server name=""). Ensure that the server name is unique. In domain mode, the controller automatically validates that the names are unique.
				</div></div></div>

		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+40838-781122+%5BLatest%5D&amp;comment=Title%3A+Implementing+a+Custom+Load+Balancing+Policy+for+EJB+Calls%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=40838-781122+27+Jan+2017+08%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Transaction_Behavior_of_EJB_Invocations">
      ⁠</a>8.7.4. Transaction Behavior of EJB Invocations</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Server to Server Invocations</div>
			Transaction attributes for distributed JBoss EAP applications need to be handled in a way as if the application is called on the same server. To discontinue a transaction, the destination method must be marked <code class="literal">REQUIRES_NEW</code> using different interfaces.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			JBoss EAP 6 does not require Java Transaction Services (JTS) for transaction propagation on server-to-server EJB invocations if both servers are JBoss EAP 6. JBoss EJB client API library handles it itself.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Client Side Invocations</div>
			To invoke EJB session beans with a JBoss EAP 6 standalone client, the client must have a reference to the <code class="literal">InitialContext</code> object while the EJB proxies or <code class="literal">UserTransaction</code> are used. It is also important to keep the <code class="literal">InitialContext</code> object open while EJB proxies or <code class="literal">UserTransaction</code> are being used. Control of the connections will be inside the classes created by the <code class="literal">InitialContext</code> with the properties.
		</div><div class="para">
		The following example shows EJB client API which holds a reference to the <code class="literal">InitialContext</code> object. 
		<div class="example"><a id="idm140550812948272">
      ⁠</a><p class="title"><strong>Example 8.6. EJB client API referencing <code class="literal">InitialContext</code> object</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">as</span>.<span xmlns="" class="perl_Function">quickstarts</span>.<span xmlns="" class="perl_Function">ejb</span>.<span xmlns="" class="perl_Function">multi</span>.<span xmlns="" class="perl_Function">server</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Date;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Properties;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.logging.Level;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.logging.Logger;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.naming.Context;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.naming.InitialContext;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.as.quickstarts.ejb.multi.server.app.MainApp;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.ContextSelector;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.EJBClientConfiguration;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.EJBClientContext;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.PropertiesBasedEJBClientConfiguration;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.remoting.ConfigBasedEJBClientContextSelector;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Client {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">* </span><span xmlns="" class="perl_Keyword">@param args </span><span xmlns="" class="perl_Comment">no args needed</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">* </span><span xmlns="" class="perl_Keyword">@throws Exception</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">*/</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span>(String[] args) <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// suppress output of client messages</span>
<span xmlns="" class="line">​</span>        Logger.<span xmlns="" class="perl_Function">getLogger</span>(<span xmlns="" class="perl_String">"org.jboss"</span>).<span xmlns="" class="perl_Function">setLevel</span>(Level.<span xmlns="" class="perl_Function">OFF</span>);
<span xmlns="" class="line">​</span>        Logger.<span xmlns="" class="perl_Function">getLogger</span>(<span xmlns="" class="perl_String">"org.xnio"</span>).<span xmlns="" class="perl_Function">setLevel</span>(Level.<span xmlns="" class="perl_Function">OFF</span>);
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>        Properties p = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>        p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED"</span>, <span xmlns="" class="perl_String">"false"</span>);
<span xmlns="" class="line">​</span>        p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connections"</span>, <span xmlns="" class="perl_String">"one"</span>);
<span xmlns="" class="line">​</span>        p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.one.port"</span>, <span xmlns="" class="perl_String">"4447"</span>);
<span xmlns="" class="line">​</span>        p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.one.host"</span>, <span xmlns="" class="perl_String">"localhost"</span>);
<span xmlns="" class="line">​</span>        p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.one.username"</span>, <span xmlns="" class="perl_String">"quickuser"</span>);
<span xmlns="" class="line">​</span>        p.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"remote.connection.one.password"</span>, <span xmlns="" class="perl_String">"quick-123"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        EJBClientConfiguration cc = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">PropertiesBasedEJBClientConfiguration</span>(p);
<span xmlns="" class="line">​</span>        ContextSelector&lt;EJBClientContext&gt; selector = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ConfigBasedEJBClientContextSelector</span>(cc);
<span xmlns="" class="line">​</span>        EJBClientContext.<span xmlns="" class="perl_Function">setSelector</span>(selector);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Properties props = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>        props.<span xmlns="" class="perl_Function">put</span>(Context.<span xmlns="" class="perl_Function">URL_PKG_PREFIXES</span>, <span xmlns="" class="perl_String">"org.jboss.ejb.client.naming"</span>);
<span xmlns="" class="line">​</span>        InitialContext context = <span xmlns="" class="perl_Keyword">new</span> InitialContext(props);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> String rcal = <span xmlns="" class="perl_String">"ejb:jboss-ejb-multi-server-app-main/ejb//"</span> + (<span xmlns="" class="perl_String">"MainAppBean"</span>) + <span xmlns="" class="perl_String">"!"</span> + MainApp.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> MainApp remote = (MainApp) context.<span xmlns="" class="perl_Function">lookup</span>(rcal);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">final</span> String result = remote.<span xmlns="" class="perl_Function">invokeAll</span>(<span xmlns="" class="perl_String">"Client call at "</span>+<span xmlns="" class="perl_Keyword">new</span> Date());
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"InvokeAll succeed: "</span>+result);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}
</pre></div></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Obtaining a <code class="literal">UserTransaction</code> reference on the client is unsupported for scenarios with a scoped EJB client context and for invocations which use the <code class="literal">remote-naming</code> protocol. This is because in these scenarios, <code class="literal">InitialContext</code> encapsulates its own EJB client context instance; which cannot be accessed using the static methods of the <code class="classname">EJBClient</code> class. When <code class="methodname">EJBClient.getUserTransaction()</code> is called, it returns a transaction from default (global) EJB client context (which might not be initialized) and not from the desired one.
			</div></div></div>

	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> UserTransaction reference on the Client Side</div>
			The following example shows how to get <code class="literal">UserTransaction</code> reference on a standalone client. 
			<div class="example"><a id="idm140550810303296">
      ⁠</a><p class="title"><strong>Example 8.7. Standalone client referencing <code class="literal">UserTransaction</code> object</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb.client.EJBClient;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.transaction.UserTransaction;</span>
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span>    Context context=<span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    UserTransaction tx=<span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      Properties props = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// REMEMBER: there must be a jboss-ejb-client.properties with the connection parameter</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">//           in the clients classpath</span>
<span xmlns="" class="line">​</span>      props.<span xmlns="" class="perl_Function">put</span>(Context.<span xmlns="" class="perl_Function">URL_PKG_PREFIXES</span>, <span xmlns="" class="perl_String">"org.jboss.ejb.client.naming"</span>);
<span xmlns="" class="line">​</span>      context = <span xmlns="" class="perl_Keyword">new</span> InitialContext(props);  
<span xmlns="" class="line">​</span>      System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n\t</span><span xmlns="" class="perl_String">Got initial Context: "</span>+context);
<span xmlns="" class="line">​</span>      tx=EJBClient.<span xmlns="" class="perl_Function">getUserTransaction</span>(<span xmlns="" class="perl_String">"yourServerName"</span>);
<span xmlns="" class="line">​</span>      System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"UserTransaction = "</span>+tx.<span xmlns="" class="perl_Function">getStatus</span>());
<span xmlns="" class="line">​</span>      tx.<span xmlns="" class="perl_Function">begin</span>();
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// do some work</span>
<span xmlns="" class="line">​</span>      ...
<span xmlns="" class="line">​</span>    }<span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>      e.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>      tx.<span xmlns="" class="perl_Function">rollback</span>();
<span xmlns="" class="line">​</span>    }<span xmlns="" class="perl_Keyword">finally</span>{
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span>(context != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>        context.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>    }
</pre></div></div>

		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			To get <code class="literal">UserTransaction</code> reference on the client side; start your server with the following system property <code class="literal">-Djboss.node.name=yourServerName</code> and then use it on client side as following: 
<pre class="programlisting">tx=EJBClient.getUserTransaction("yourServerName");</pre>
			 Replace "yourServerName" with the name of your server. If a user transaction is started on a node all invocations are sticky on the node and the node must have all the needed EJBs. It is not possible to use <code class="literal">UserTransaction</code> with remote-naming protocol and scoped-context.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+40839-759592+%5BLatest%5D&amp;comment=Title%3A+Transaction+Behavior+of+EJB+Invocations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=40839-759592+28+May+2015+02%3A38+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Reference1">
      ⁠</a>8.8. Reference</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="EJB_JNDI_Naming_Reference">
      ⁠</a>8.8.1. EJB JNDI Naming Reference</h2></div></div></div><div class="para">
		The JNDI lookup name for a session bean has the syntax of:
	</div><pre class="synopsis"> ejb:<em class="replaceable">&lt;appName&gt;</em>/<em class="replaceable">&lt;moduleName&gt;</em>/<em class="replaceable">&lt;distinctName&gt;</em>/<em class="replaceable">&lt;beanName&gt;</em>!<em class="replaceable">&lt;viewClassName&gt;</em><em class="replaceable">?stateful</em> </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="code">&lt;appName&gt;</code></span></dt><dd><div class="para">
					If the session bean's JAR file has been deployed within an enterprise archive (EAR) then this is the name of that EAR. By default, the name of an EAR is its filename without the <code class="filename">.ear</code> suffix. The application name can also be overridden in its <code class="filename">application.xml</code> file. If the session bean is not deployed in an EAR then leave this blank.
				</div></dd><dt><span class="term"><code class="code">&lt;moduleName&gt;</code></span></dt><dd><div class="para">
					The module name is the name of the JAR file that the session bean is deployed in. By the default, the name of the JAR file is its filename without the <code class="filename">.jar</code> suffix. The module name can also be overridden in the JAR's <code class="filename">ejb-jar.xml</code> file.
				</div></dd><dt><span class="term"><code class="code">&lt;distinctName&gt;</code></span></dt><dd><div class="para">
					JBoss EAP 6 allows each deployment to specify an optional distinct name. If the deployment does not have a distinct name then leave this blank.
				</div></dd><dt><span class="term"><code class="code">&lt;beanName&gt;</code></span></dt><dd><div class="para">
					The bean name is the classname of the session bean to be invoked.
				</div></dd><dt><span class="term"><code class="code">&lt;viewClassName&gt;</code></span></dt><dd><div class="para">
					The view class name is the fully qualified classname of the remote interface. This includes the package name of the interface.
				</div></dd><dt><span class="term"><code class="code">?stateful</code></span></dt><dd><div class="para">
					The <code class="code">?stateful</code> suffix is required when the JNDI name refers to a stateful session bean. It is not included for other bean types.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5119-591683+%5BLatest%5D&amp;comment=Title%3A+EJB+JNDI+Naming+Reference%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5119-591683+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="EJB_Reference_Resolution">
      ⁠</a>8.8.2. EJB Reference Resolution</h2></div></div></div><div class="para">
		This section covers how JBoss implements <code class="code">@EJB</code> and <code class="code">@Resource</code>. Please note that XML always overrides annotations but the same rules apply.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Rules for the @EJB annotation</strong></p><ul><li class="listitem"><div class="para">
				The <code class="code">@EJB</code> annotation also has a <code class="code">mappedName()</code> attribute. The specification leaves this as vendor specific metadata, but JBoss recognizes <code class="code">mappedName()</code> as the global JNDI name of the EJB you are referencing. If you have specified a <code class="code">mappedName()</code>, then all other attributes are ignored and this global JNDI name is used for binding.
			</div></li><li class="listitem"><div class="para">
				If you specify <code class="code">@EJB</code> with no attributes defined:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>@EJB 
<span xmlns="" class="line">​</span>ProcessPayment myEjbref;</pre><div class="para">
				Then the following rules apply:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						The EJB jar of the referencing bean is searched for an EJB with the interface used in the <code class="code">@EJB</code> injection. If there are more than one EJB that publishes same business interface, then an exception is thrown. If there is only one bean with that interface then that one is used.
					</div></li><li class="listitem"><div class="para">
						Search the EAR for EJBs that publish that interface. If there are duplicates, then an exception is thrown. Otherwise the matching bean is returned.
					</div></li><li class="listitem"><div class="para">
						Search globally in JBoss runtime for an EJB of that interface. Again, if duplicates are found, an exception is thrown.
					</div></li></ul></div></li><li class="listitem"><div class="para">
				<code class="code">@EJB.beanName()</code> corresponds to <code class="code">&lt;ejb-link&gt;</code>. If the <code class="code">beanName()</code> is defined, then use the same algorithm as <code class="code">@EJB</code> with no attributes defined except use the <code class="code">beanName()</code> as a key in the search. An exception to this rule is if you use the ejb-link '#' syntax. The '#' syntax allows you to put a relative path to a jar in the EAR where the EJB you are referencing is located. Refer to the EJB 3.1 specification for more details.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4543-591667+%5BLatest%5D&amp;comment=Title%3A+EJB+Reference+Resolution%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4543-591667+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Project_dependencies_for_Remote_EJB_Clients">
      ⁠</a>8.8.3. Project dependencies for Remote EJB Clients</h2></div></div></div><div class="para">
		Maven projects that include the invocation of session beans from remote clients require the following dependencies from the JBoss EAP 6 Maven repository.
	</div><div class="table"><a id="idm140550721641824">
      ⁠</a><p class="title"><strong>Table 8.4. Maven dependencies for Remote EJB Clients</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Maven dependencies for Remote EJB Clients"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> GroupID </th><th style="text-align: left"> ArtifactID </th></tr></thead><tbody><tr><td style="text-align: left"> org.jboss.spec </td><td style="text-align: left"> jboss-javaee-6.0 </td></tr><tr><td style="text-align: left"> org.jboss.as </td><td style="text-align: left"> jboss-as-ejb-client-bom </td></tr><tr><td style="text-align: left"> org.jboss.spec.javax.transaction </td><td style="text-align: left"> jboss-transaction-api_1.1_spec </td></tr><tr><td style="text-align: left"> org.jboss.spec.javax.ejb </td><td style="text-align: left"> jboss-ejb-api_3.1_spec </td></tr><tr><td style="text-align: left"> org.jboss </td><td style="text-align: left"> jboss-ejb-client </td></tr><tr><td style="text-align: left"> org.jboss.xnio </td><td style="text-align: left"> xnio-api </td></tr><tr><td style="text-align: left"> org.jboss.xnio </td><td style="text-align: left"> xnio-nio </td></tr><tr><td style="text-align: left"> org.jboss.remoting3 </td><td style="text-align: left"> jboss-remoting </td></tr><tr><td style="text-align: left"> org.jboss.sasl </td><td style="text-align: left"> jboss-sasl </td></tr><tr><td style="text-align: left"> org.jboss.marshalling </td><td style="text-align: left"> jboss-marshalling-river </td></tr></tbody></table></div></div><div class="para">
		With the exception of <code class="code">jboss-javaee-6.0</code> and <code class="code">jboss-as-ejb-client-bom</code>, these dependencies must be added to the <code class="code">&lt;dependencies&gt;</code> section of the <code class="filename">pom.xml</code> file.
	</div><div class="para">
		The <code class="code">jboss-javaee-6.0</code> and <code class="code">jboss-as-ejb-client-bom</code> dependencies should be added to the <code class="code">&lt;dependencyManagement&gt;</code> section of your <code class="filename">pom.xml</code> with the scope of <code class="code">import</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The <code class="code">artifactID</code>'s versions are subject to change. Refer to the Maven repository for the relevant version.
		</div></div></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;dependencyManagement&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.jboss.spec<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>jboss-javaee-6.0<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>3.0.0.Final-redhat-1<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;type&gt;</span>pom<span xmlns="" class="perl_Keyword">&lt;/type&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;scope&gt;</span>import<span xmlns="" class="perl_Keyword">&lt;/scope&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.jboss.as<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>jboss-as-ejb-client-bom<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>7.1.1.Final-redhat-1<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;type&gt;</span>pom<span xmlns="" class="perl_Keyword">&lt;/type&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;scope&gt;</span>import<span xmlns="" class="perl_Keyword">&lt;/scope&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/dependencyManagement&gt;</span></pre><div class="para">
		Refer to <code class="filename">ejb-remote/client/pom.xml</code> in the quickstart files for a complete example of dependency configuration for remote session bean invocation.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5726-606308+%5BLatest%5D&amp;comment=Title%3A+Project+dependencies+for+Remote+EJB+Clients%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5726-606308+25+Feb+2014+22%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jboss-ejb3xml_Deployment_Descriptor_Reference">
      ⁠</a>8.8.4. jboss-ejb3.xml Deployment Descriptor Reference</h2></div></div></div><div class="para">
		<code class="filename">jboss-ejb3.xml</code> is a custom deployment descriptor that can be used in either EJB JAR or WAR archives. In an EJB JAR archive it must be located in the <code class="filename">META-INF/</code> directory. In a WAR archive it must be located in the <code class="filename">WEB-INF/</code> directory.
	</div><div class="para">
		The format is similar to <code class="filename">ejb-jar.xml</code>, using some of the same namespaces and providing some other additional namespaces. The contents of <code class="filename">jboss-ejb3.xml</code> are merged with the contents of <code class="filename">ejb-jar.xml</code>, with the <code class="filename">jboss-ejb3.xml</code> items taking precedence.
	</div><div class="para">
		This document only covers the additional non-standard namespaces used by <code class="filename">jboss-ejb3.xml</code>. Refer to <a href="http://java.sun.com/xml/ns/javaee/">http://java.sun.com/xml/ns/javaee/</a> for documentation on the standard namespaces.
	</div><div class="para">
		The root namespace is <code class="systemitem">http://www.jboss.com/xml/ns/javaee</code>.
	</div><div class="variablelist"><p class="title"><strong>Assembly descriptor namespaces</strong></p><div class="para">
			The following namespaces can all be used in the <code class="code">&lt;assembly-descriptor&gt;</code> element. They can be used to apply their configuration to a single bean, or to all beans in the deployment by using <code class="code">*</code> as the <code class="code">ejb-name</code>.
		</div><dl class="variablelist"><dt><span class="term">The clustering namespace: <code class="code">urn:clustering:1.0</code></span></dt><dd><pre class="programlisting"><span xmlns="" class="line">​</span>xmlns:c="urn:clustering:1.0"</pre><div class="para">
					This allows you to mark EJB's as clustered. It is the deployment descriptor equivalent to <code class="code">@org.jboss.ejb3.annotation.Clustered</code>.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;c:clustering&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>DDBasedClusteredSFSB<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;c:clustered&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/c:clustered&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/c:clustering&gt;</span></pre></dd><dt><span class="term">The security namespace (<code class="code">urn:security</code>)</span></dt><dd><pre class="programlisting"><span xmlns="" class="line">​</span>xmlns:s="urn:security"</pre><div class="para">
					This allows you to set the <code class="code">security-domain</code> and the <code class="code">run-as-principal</code> for an EJB.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:security&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:security-domain&gt;</span>myDomain<span xmlns="" class="perl_Keyword">&lt;/s:security-domain&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:run-as-principal&gt;</span>myPrincipal<span xmlns="" class="perl_Keyword">&lt;/s:run-as-principal&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/s:security&gt;</span></pre></dd><dt><span class="term">The resource adapter namespace: <code class="code">urn:resource-adapter-binding</code></span></dt><dd><pre class="programlisting"><span xmlns="" class="line">​</span>xmlns:r="urn:resource-adapter-binding"</pre><div class="para">
					This allows you to set the resource adapter for a Message-Driven Bean.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;r:resource-adapter-binding&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;r:resource-adapter-name&gt;</span>myResourceAdapter<span xmlns="" class="perl_Keyword">&lt;/r:resource-adapter-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/r:resource-adapter-binding&gt;</span></pre></dd><dt><span class="term">The IIOP namespace: <code class="code">urn:iiop</code></span></dt><dd><pre class="programlisting"><span xmlns="" class="line">​</span>xmlns:u="urn:iiop"</pre><div class="para">
					The IIOP namespace is where IIOP settings are configured.
				</div></dd><dt><span class="term">The pool namespace: <code class="code">urn:ejb-pool:1.0</code></span></dt><dd><pre class="programlisting"><span xmlns="" class="line">​</span>xmlns:p="urn:ejb-pool:1.0"</pre><div class="para">
					This allows you to select the pool that is used by the included stateless session beans or Message-Driven Beans. Pools are defined in the server configuration.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;p:pool&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;p:bean-instance-pool-ref&gt;</span>my-pool<span xmlns="" class="perl_Keyword">&lt;/p:bean-instance-pool-ref&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/p:pool&gt;</span></pre></dd><dt><span class="term">The cache namespace: <code class="code">urn:ejb-cache:1.0</code></span></dt><dd><pre class="programlisting"><span xmlns="" class="line">​</span>xmlns:c="urn:ejb-cache:1.0"</pre><div class="para">
					This allows you to select the cache that is used by the included stateful session beans. Caches are defined in the server configuration.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;c:cache&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;c:cache-ref&gt;</span>my-cache<span xmlns="" class="perl_Keyword">&lt;/c:cache-ref&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/c:cache&gt;</span></pre></dd></dl></div><div class="example"><a id="idm140550797188240">
      ⁠</a><p class="title"><strong>Example 8.8. jboss-ejb3.xml file</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.1" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss:ejb-jar</span><span xmlns="" class="perl_Others"> xmlns:jboss=</span><span xmlns="" class="perl_String">"http://www.jboss.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns:c=</span><span xmlns="" class="perl_String">"urn:clustering:1.0"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    version=</span><span xmlns="" class="perl_String">"3.1"</span><span xmlns="" class="perl_Others"> impl-version=</span><span xmlns="" class="perl_String">"2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;message-driven&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>ReplyingMDB<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ejb-class&gt;</span>org.jboss.as.test.integration.ejb.mdb.messagedestination.ReplyingMDB<span xmlns="" class="perl_Keyword">&lt;/ejb-class&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;activation-config&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;activation-config-property&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;activation-config-property-name&gt;</span>destination<span xmlns="" class="perl_Keyword">&lt;/activation-config-property-name&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;activation-config-property-value&gt;</span>java:jboss/mdbtest/messageDestinationQueue
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/activation-config-property-value&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;/activation-config-property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/activation-config&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/message-driven&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;c:clustering&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>DDBasedClusteredSFSB<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;c:clustered&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/c:clustered&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/c:clustering&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss:ejb-jar&gt;</span></pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			There are known issues with the <code class="filename">jboss-ejb3-spec-2_0.xsd</code> that may result in schema validation errors. You can ignore these errors. For more information, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1192591">https://bugzilla.redhat.com/show_bug.cgi?id=1192591</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+9019-781126+%5BLatest%5D&amp;comment=Title%3A+jboss-ejb3.xml+Deployment+Descriptor+Reference%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9019-781126+27+Jan+2017+11%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>