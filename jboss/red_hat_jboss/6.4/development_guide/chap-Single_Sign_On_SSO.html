<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 19. Single Sign On (SSO)</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Single_Sign_On_SSO">
      ⁠</a>Chapter 19. Single Sign On (SSO)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Single_Sign_On_SSO_for_Web_Applications">
      ⁠</a>19.1. About Single Sign On (SSO) for Web Applications</h1></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			<em class="firstterm">Single Sign On (SSO)</em> allows authentication to one resource to implicitly allow access to other resources.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Clustered and Non-Clustered SSO</div>
			Non-clustered SSO limits the sharing of access information to applications on the same virtual host. In addition, there is no resiliency in the event of a host failure. Clustered SSO data can be shared between applications in multiple hosts, and is resilient to failover. In addition, clustered SSO is able to receive requests from a load balancer.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">How SSO Works</div>
			If a resource is unprotected, a user is not challenged to authenticate at all. If a user accesses a protected resource, the user is required to authenticate.
		</div><div class="para">
		Upon successful authentication, the roles associated with the user are stored and used for authentication of all other associated resources.
	</div><div class="para">
		If the user logs out of an application, or an application invalidates the session programmatically, all persisted authentication data is removed, and the process starts over.
	</div><div class="para">
		A session timeout does not invalidate the SSO session if other sessions are still valid.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4694-741431+%5BLatest%5D&amp;comment=Title%3A+About+Single+Sign+On+%28SSO%29+for+Web+Applications%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4694-741431+05+Feb+2015+01%3A50+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Clustered_Single_Sign_On_SSO_for_Web_Applications">
      ⁠</a>19.2. About Clustered Single Sign On (SSO) for Web Applications</h1></div></div></div><div class="para">
		Single Sign On (SSO) is the ability for users to authenticate to a single web application, and by means of a successful authentication, will successfully authenticate to multiple other applications without needing to be prompted at each one. Clustered SSO stores the authentication information in a clustered cache. This allows for applications on multiple different servers to share the information, and also makes the information resilient to a failure of one of the hosts.
	</div><div class="para">
		Some of the supported SSO mechanisms (for example, Kerberos, PicketLink SAML) need valves to work correctly. Valves have a similar function as the servlet filters, but they are processed before the container managed authentication. Valves for web applications can be defined in the <code class="filename">jboss-web.xml</code> deployment descriptor.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4696-741834+%5BLatest%5D&amp;comment=Title%3A+About+Clustered+Single+Sign+On+%28SSO%29+for+Web+Applications%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4696-741834+06+Feb+2015+02%3A05+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Choose_the_Right_SSO_Implementation">
      ⁠</a>19.3. Choose the Right SSO Implementation</h1></div></div></div><div class="para">
		JBoss EAP 6 runs Java Enterprise Edition (EE) applications, which may be web applications, EJB applications, web services, or other types. Single Sign On (SSO) allows you to propagate security context and identity information between these applications. Several SSO solutions are available but choosing the right solution depends on your requirements.
	</div><div class="para">
		Note that there is a distinct difference between a clustered web application and clustered SSO. A clustered web application is one which is distributed across the nodes of a cluster to spread the load of hosting that application. If marked as distributable, all new sessions, and changes to existing sessions are replicated to other members of the cluster. An application is marked as able to be distributed across cluster nodes with the &lt;distributable/&gt; tag in the <code class="filename">web.xml</code> deployment descriptor. Clustered SSO allows for replication of security context and identity information, regardless of whether or not the applications are themselves clustered. Although these technologies may be used together they are separate concepts.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Kerberos-Based Desktop SSO</div>
			If your organization already uses a Kerberos-based authentication and authorization system, such as Microsoft Active Directory, you can use the same systems to transparently authenticate to your enterprise applications running on JBoss EAP 6.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Non-Clustered Web Application SSO</div>
			If you are running multiple applications on a single instance and need to enable SSO session replication for those applications, non-clustered SSO will meet your requirements.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Clustered Web Application SSO</div>
			If you are running either a single application, or multiple applications, across a cluster and need to enable SSO session replication for those applications, clustered SSO will meet your requirements.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7502-679639+%5BLatest%5D&amp;comment=Title%3A+Choose+the+Right+SSO+Implementation%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7502-679639+26+Jun+2014+20%3A00+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Use_Single_Sign_On_SSO_In_A_Web_Application">
      ⁠</a>19.4. Use Single Sign On (SSO) In A Web Application</h1></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			Single Sign On (SSO) capabilities are provided by the web and Infinispan subsystems. Use this procedure to configure SSO in web applications.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A configured security domain which handles authentication and access.
			</div></li><li class="listitem"><div class="para">
				The <code class="code">infinispan</code> subsystem. By default, it is present in all the profiles for managed domain and standalone server.
			</div></li><li class="listitem"><div class="para">
				The <code class="code">web</code> <code class="code">cache-container</code> and SSO replicated-cache. The initial configuration files already contain the <code class="code">web</code> cache-container, and some of the configurations already contain the SSO replicated-cache as well. Use the following commands to check for and enable the SSO replicated-cache. Note that these commands modify the <code class="code">ha</code> profile of a managed domain. You can change the commands to use a different profile, or remove the <code class="literal">/profile=ha</code> portion of the command, for a standalone server.
			</div><div class="example"><a id="idm140550791354336">
      ⁠</a><p class="title"><strong>Example 19.1. Check for the <code class="code">web</code> cache-container</strong></p><div class="example-contents"><div class="para">
					The profiles and configurations mentioned above include the <code class="code">web</code> cache-container by default. Use the following command to verify its presence. If you use a different profile, substitute its name instead of <code class="literal">ha</code>.
				</div><pre class="screen">/profile=ha/subsystem=infinispan/cache-container=web/:read-resource(recursive=false,proxies=false,include-runtime=false,include-defaults=true)</pre><div class="para">
					If the result is <code class="literal">success</code> the subsystem is present. Otherwise, you need to add it.
				</div></div></div><div class="example"><a id="idm140550813159104">
      ⁠</a><p class="title"><strong>Example 19.2. Add the <code class="code">web</code> cache-container</strong></p><div class="example-contents"><div class="para">
					Use the following three commands to enable the <code class="code">web</code> cache-container to your configuration. Modify the name of the profile as appropriate, as well as the other parameters. The parameters here are the ones used in a default configuration.
				</div><pre class="screen">/profile=ha/subsystem=infinispan/cache-container=web:add(aliases=["standard-session-cache"],default-cache="repl",module="org.jboss.as.clustering.web.infinispan")</pre><pre class="screen">/profile=ha/subsystem=infinispan/cache-container=web/transport=TRANSPORT:add(lock-timeout=60000)</pre><pre class="screen">/profile=ha/subsystem=infinispan/cache-container=web/replicated-cache=repl:add(mode="ASYNC",batching=true)</pre></div></div><div class="example"><a id="idm140550799920544">
      ⁠</a><p class="title"><strong>Example 19.3. Check for the <code class="code">SSO</code> replicated-cache</strong></p><div class="example-contents"><div class="para">
					Run the following Management CLI command:
				</div><pre class="screen">/profile=ha/subsystem=infinispan/cache-container=web/:read-resource(recursive=true,proxies=false,include-runtime=false,include-defaults=true)</pre><div class="para">
					Look for output like the following: <code class="code">"sso" =&gt; {</code>
				</div><div class="para">
					If you do not find it, the SSO replicated-cache is not present in your configuration.
				</div></div></div><div class="example"><a id="idm140550728672640">
      ⁠</a><p class="title"><strong>Example 19.4. Add the <code class="code">SSO</code> replicated-cache</strong></p><div class="example-contents"><pre class="screen">/profile=ha/subsystem=infinispan/cache-container=web/replicated-cache=sso:add(mode="SYNC", batching=true)</pre></div></div></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure Clustered SSO for a Managed Domain</div>

		</div><div class="para">
		The <code class="code">web</code> subsystem needs to be configured to use SSO. The following command enables SSO on the virtual server called <code class="literal">default-host</code>, and the cookie domain <code class="literal">domain.com</code>. The cache name is <code class="literal">sso</code>, and reauthentication is disabled.
	</div><pre class="screen">/profile=ha/subsystem=web/virtual-server=<em class="replaceable">default-host</em>/sso=configuration:add(cache-container="web",cache-name=<em class="replaceable">"sso"</em>,reauthenticate=<em class="replaceable">"false"</em>,domain=<em class="replaceable">"domain.com"</em>)</pre><div class="para">
		Each application which will share the SSO information must be configured to use the same &lt;security-domain&gt; in its <code class="filename">jboss-web.xml</code> deployment descriptor and the same Realm in its <code class="filename">web.xml</code> configuration file.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure Clustered or Non-Clustered SSO for a Standalone Server</div>
			Configure <code class="code">sso</code> under the web subsystem in the server profile. The <code class="code">ClusteredSingleSignOn</code> version is used when attribute <code class="code">cache-container</code> is present, otherwise standard <code class="code">SingleSignOn</code> class is used.
		</div><div class="example"><a id="idm140550783493616">
      ⁠</a><p class="title"><strong>Example 19.5. Example Non-Clustered SSO Configuration</strong></p><div class="example-contents"><pre class="screen">/subsystem=web/virtual-server=<em class="replaceable">default-host</em>/sso=configuration:add(reauthenticate="<em class="replaceable">false</em>")</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Invalidate a Session</div>
			An application can programmatically invalidate a session by invoking method <code class="code">javax.servlet.http.HttpSession.invalidate()</code>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4695-745001+%5BLatest%5D&amp;comment=Title%3A+Use+Single+Sign+On+%28SSO%29+In+A+Web+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4695-745001+26+Feb+2015+06%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Kerberos">
      ⁠</a>19.5. About Kerberos</h1></div></div></div><div class="para">
		Kerberos is a network authentication protocol for client/server applications. It allows authentication across a non-secure network in a secure way, using secret-key symmetric cryptography.
	</div><div class="para">
		Kerberos uses security tokens called tickets. To use a secured service, you need to obtain a ticket from the Ticket Granting Service (TGS), which is a service running on a server on the network. After obtaining the ticket, you request a Service Ticket (ST) from an Authentication Service (AS), which is another service running on the network. You then use the ST to authenticate to the service you want to use. The TGS and the AS both run inside an enclosing service called the Key Distribution Center (KDC).
	</div><div class="para">
		Kerberos is designed to be used in a client-server environment, and is rarely used in Web applications or thin client environments. However, many organizations already use a Kerberos system for desktop authentication, and prefer to reuse their existing system rather than create a second one for their Web Applications. Kerberos is an integral part of Microsoft Active Directory, and is also used in many Red Hat Enterprise Linux environments.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7816-732409+%5BLatest%5D&amp;comment=Title%3A+About+Kerberos%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7816-732409+11+Dec+2014+23%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_SPNEGO">
      ⁠</a>19.6. About SPNEGO</h1></div></div></div><div class="para">
		Simple and Protected GSS_API Negotiation Mechanism (SPNEGO) provides a mechanism for extending a Kerberos-based Single Sign On (SSO) environment for use in Web applications.
	</div><div class="para">
		When an application on a client computer, such as a web browser, attempts to access a protect page on the web server, the server responds that authorization is required. The application then requests a service ticket from the Kerberos Key Distribution Center (KDC). After the ticket is obtained, the application wraps it in a request formatted for SPNEGO, and sends it back to the Web application, via the browser. The web container running the deployed Web application unpacks the request and authenticates the ticket. Upon successful authentication, access is granted.
	</div><div class="para">
		SPNEGO works with all types of Kerberos providers, including the Kerberos service included in Red Hat Enterprise Linux and the Kerberos server which is an integral part of Microsoft Active Directory.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7817-591807+%5BLatest%5D&amp;comment=Title%3A+About+SPNEGO%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7817-591807+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Microsoft_Active_Directory">
      ⁠</a>19.7. About Microsoft Active Directory</h1></div></div></div><div class="para">
		Microsoft Active Directory is a directory service developed by Microsoft to authenticate users and computers in a Microsoft Windows domain. It is included as part of Microsoft Windows Server. The computer in the Microsoft Windows Server is referred to as the domain controller. Red Hat Enterprise Linux servers running the Samba service can also act as the domain controller in this type of network.
	</div><div class="para">
		Active Directory relies on three core technologies which work together:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Lightweight Directory Access Protocol (LDAP), for storing information about users, computers, passwords, and other resources.
			</div></li><li class="listitem"><div class="para">
				Kerberos, for providing secure authentication over the network.
			</div></li><li class="listitem"><div class="para">
				Domain Name Service (DNS) for providing mappings between IP addresses and host names of computers and other devices on the network.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7818-591807+%5BLatest%5D&amp;comment=Title%3A+About+Microsoft+Active+Directory%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7818-591807+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Kerberos_or_Microsoft_Active_Directory_Desktop_SSO_for_Web_Applications">
      ⁠</a>19.8. Configure Kerberos or Microsoft Active Directory Desktop SSO for Web Applications</h1></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			To authenticate your web or EJB applications using your organization's existing Kerberos-based authentication and authorization infrastructure, such as Microsoft Active Directory, you can use the JBoss Negotiation capabilities built into JBoss EAP 6. If you configure your web application properly, a successful desktop or network login is sufficient to transparently authenticate against your web application, so no additional login prompt is required.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Difference from Previous Versions of the Platform</div>
			There are a few noticeable differences between JBoss EAP 6 and earlier versions:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Security domains are configured for each profile of a managed domain, or for each standalone server. They are not part of the deployment itself. The security domain a deployment should use is named in the deployment's <code class="filename">jboss-web.xml</code> or <code class="filename">jboss-ejb3.xml</code> file.
			</div></li><li class="listitem"><div class="para">
				Security properties are configured as part of a security domain. They are not part of the deployment.
			</div></li><li class="listitem"><div class="para">
				You can no longer override the authenticators as part of your deployment. However, you can add a NegotiationAuthenticator valve to your <code class="filename">jboss-web.xml</code> descriptor to achieve the same effect. The valve still requires the <code class="sgmltag-element">&lt;security-constraint&gt;</code> and <code class="sgmltag-element">&lt;login-config&gt;</code> elements to be defined in the <code class="filename">web.xml</code>. These are used to decide which resources are secured. However, the chosen auth-method will be overridden by the NegotiationAuthenticator valve in the <code class="filename">jboss-web.xml</code>.
			</div></li><li class="listitem"><div class="para">
				The <code class="literal">CODE</code> attributes in security domains now use a simple name instead of a fully-qualified class name. The following table shows the mappings between the classes used for JBoss Negotiation, and their classes.
			</div></li></ul></div><div class="table"><a id="idm140550742016016">
      ⁠</a><p class="title"><strong>Table 19.1. Login Module Codes and Class Names</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Login Module Codes and Class Names"><colgroup><col width="20%" style="text-align: left" class="c1"/><col width="40%" style="text-align: left" class="c2"/><col width="40%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Simple Name </th><th style="text-align: left"> Class Name </th><th style="text-align: left"> Purpose </th></tr></thead><tbody><tr><td style="text-align: left"> Kerberos </td><td style="text-align: left"> <div class="para">
						com.sun.security.auth.module.Krb5LoginModule
					</div>
					 <div class="para">

					</div>
					 <div class="para">
						com.ibm.security.auth.module.Krb5LoginModule
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Kerberos login module when using the Oracle JDK
					</div>
					 <div class="para">

					</div>
					 <div class="para">
						Kerberos login module when using the IBM Java development kit
					</div>
					 </td></tr><tr><td style="text-align: left"> SPNEGO </td><td style="text-align: left"> org.jboss.security.negotiation.spnego.SPNEGOLoginModule </td><td style="text-align: left"> The mechanism which enables your Web applications to authenticate to your Kerberos authentication server. </td></tr><tr><td style="text-align: left"> AdvancedLdap </td><td style="text-align: left"> org.jboss.security.negotiation.AdvancedLdapLoginModule </td><td style="text-align: left"> Used with LDAP servers other than Microsoft Active Directory. </td></tr><tr><td style="text-align: left"> AdvancedAdLdap </td><td style="text-align: left"> org.jboss.security.negotiation.AdvancedADLoginModule </td><td style="text-align: left"> Used with Microsoft Active Directory LDAP servers. </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">JBoss Negotiation Toolkit</div>
			The <code class="filename">JBoss Negotiation Toolkit</code> is a debugging tool which is available for download from <a href="https://community.jboss.org/servlet/JiveServlet/download/16876-2-34629/jboss-negotiation-toolkit.war">https://community.jboss.org/servlet/JiveServlet/download/16876-2-34629/jboss-negotiation-toolkit.war</a>. It is provided as an extra tool to help you to debug and test the authentication mechanisms before introducing your application into production. It is an unsupported tool, but is considered to be very helpful, as SPNEGO can be difficult to configure for web applications.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550770343600">
      ⁠</a><p class="title"><strong>Procedure 19.1. Setup SSO Authentication for your Web or EJB Applications</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure one security domain to represent the identity of the server. Set system properties if necessary.</strong></p><div class="para">
				The first security domain authenticates the container itself to the directory service. It needs to use a login module which accepts some type of static login mechanism, because a real user is not involved. This example uses a static principal and references a keytab file which contains the credential.
			</div><div class="para">
				The XML code is given here for clarity, but you should use the Management Console or Management CLI to configure your security domains.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Kerberos"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"storeKey"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useKeyTab"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"principal"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"host/testserver@MY_REALM"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"keyTab"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/home/username/service.keytab"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"doNotPrompt"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"debug"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span></pre></li><li class="step"><p class="title"><strong>Configure a second security domain to secure the web application or applications. Set system properties if necessary.</strong></p><div class="para">
				The second security domain is used to authenticate the individual user to the Kerberos or SPNEGO authentication server. You need at least one login module to authenticate the user, and another to search for the roles to apply to the user. The following XML code shows an example SPNEGO security domain. It includes an authorization module to map roles to individual users. You can also use a module which searches for the roles on the authentication server itself.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SPNEGO"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Check the username and password --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"SPNEGO"</span><span xmlns="" class="perl_Others">  flag=</span><span xmlns="" class="perl_String">"requisite"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serverSecurityDomain"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Search for roles --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"UsersRoles"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"usersProperties"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"spnego-users.properties"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"rolesProperties"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"spnego-roles.properties"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span></pre></li><li class="step"><p class="title"><strong>Specify the security-constraint and login-config in the <code class="filename">web.xml</code></strong></p><div class="para">
				The <code class="filename">web.xml</code> descriptor contain information about security constraints and login configuration. The following are example values for each.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Security Constraint on Conversation<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>examplesWebApp<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>RequiredRole<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>SPNEGO<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;realm-name&gt;</span>SPNEGO<span xmlns="" class="perl_Keyword">&lt;/realm-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-role&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;description&gt;</span> role required to log in to the Application<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>RequiredRole<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-role&gt;</span></pre></li><li class="step"><p class="title"><strong>Specify the security domain and other settings in the <code class="filename">jboss-web.xml</code> descriptor.</strong></p><div class="para">
				Specify the name of the client-side security domain (the second one in this example) in the <code class="filename">jboss-web.xml</code> descriptor of your deployment, to direct your application to use this security domain.
			</div><div class="para">
				You can no longer override authenticators directly. Instead, you can add the NegotiationAuthenticator as a valve to your <code class="filename">jboss-web.xml</code> descriptor, if you need to. The <code class="sgmltag-element">&lt;jacc-star-role-allow&gt;</code> allows you to use the asterisk (*) character to match multiple role names, and is optional.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>SPNEGO<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.security.negotiation.NegotiationAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;jacc-star-role-allow&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/jacc-star-role-allow&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span></pre></li><li class="step"><p class="title"><strong>Add a dependency to your application's <code class="filename">MANIFEST.MF</code>, to locate the Negotiation classes.</strong></p><div class="para">
				The web application needs a dependency on class <code class="code">org.jboss.security.negotiation</code> to be added to the deployment's <code class="filename">META-INF/MANIFEST.MF</code> manifest, in order to locate the JBoss Negotiation classes. The following shows a properly-formatted entry.
			</div><pre class="programlisting">Manifest-Version: 1.0
Build-Jdk: 1.6.0_24
Dependencies: org.jboss.security.negotiation</pre><ul class="stepalternatives">
				<li class="step"><div class="para">
						As an alternative, add a dependency to your application by editing the <code class="filename">META-INF/jboss-deployment-structure.xml</code> file:
					</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-deployment-structure&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;deployment&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">'org.jboss.security.negotiation'</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-deployment-structure&gt;</span></pre></li>

			</ul></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			You can use only one Kerberos login module in a security domain.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your web application accepts and authenticates credentials against your Kerberos, Microsoft Active Directory, or other SPNEGO-compatible directory service. If the user runs the application from a system which is already logged into the directory service, and where the required roles are already applied to the user, the web application does not prompt for authentication, and SSO capabilities are achieved.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4937-767986+%5BLatest%5D&amp;comment=Title%3A+Configure+Kerberos+or+Microsoft+Active+Directory+Desktop+SSO+for+Web+Applications%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4937-767986+21+Aug+2015+03%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_SPNEGO_Fall_Back_to_Form_Authentication">
      ⁠</a>19.9. Configure SPNEGO Fall Back to Form Authentication</h1></div></div></div><div class="para">
		Follow the procedure below to setup a SPNEGO fall back to form authentication. ⁠
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550741842384">
      ⁠</a><p class="title"><strong>Procedure 19.2. SPNEGO security with fall back to form authentication</strong></p><ol class="1"><li class="step"><p class="title"><strong>Set up SPNEGO</strong></p><div class="para">
				Refer the procedure described in <a class="xref" href="chap-Single_Sign_On_SSO.html#Configure_Kerberos_or_Microsoft_Active_Directory_Desktop_SSO_for_Web_Applications">Section 19.8, “Configure Kerberos or Microsoft Active Directory Desktop SSO for Web Applications”</a>
			</div></li><li class="step"><p class="title"><strong>Modify <code class="filename">web.xml</code></strong></p><div class="para">
				Add a <code class="literal">login-config</code> element to your application and setup the login and error pages in web.xml: 
<pre class="programlisting">&lt;login-config&gt;
    &lt;auth-method&gt;SPNEGO&lt;/auth-method&gt;
    &lt;realm-name&gt;SPNEGO&lt;/realm-name&gt;
        &lt;form-login-config&gt;
            &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
            &lt;form-error-page&gt;/error.jsp&lt;/form-error-page&gt;
        &lt;/form-login-config&gt;
   &lt;/login-config&gt;
</pre>

			</div></li><li class="step"><p class="title"><strong>Add web content</strong></p><div class="para">
				Add references of <code class="filename">login.html</code> and <code class="filename">error.html</code> to <code class="filename">web.xml</code>. These files are added to web application archive to the place specified in <code class="filename">form-login-config</code> configuration. For more information refer <em class="citetitle">Enable Form-based Authentication</em> section in the <em class="citetitle">Security Guide</em> for JBoss EAP 6. A typical <code class="filename">login.html</code> looks like this: 
<pre class="programlisting">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Vault Form Authentication&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Vault Login Page&lt;/h1&gt;
        &lt;p&gt;   
        &lt;form method="post" action="j_security_check"&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;Username&lt;/td&gt;&lt;td&gt;-&lt;/td&gt;
                &lt;td&gt;&lt;input type="text" name="j_username"&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;Password&lt;/td&gt;&lt;td&gt;-&lt;/td&gt;
                &lt;td&gt;&lt;input type="password" name="j_password"&gt;&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td colspan="2"&gt;&lt;input type="submit"&gt;&lt;/td&gt;
            &lt;/tr&gt;              
        &lt;/table&gt;
        &lt;/form&gt;
        &lt;/p&gt; 
        &lt;hr&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

			</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The fallback to FORM logic is only available in the case when no SPNEGO (or NTLM) tokens are present. As a result, a login form is not presented to the browser if the browser sends an NTLM token.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+35796-681166+%5BLatest%5D&amp;comment=Title%3A+Configure+SPNEGO+Fall+Back+to+Form+Authentication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=35796-681166+03+Jul+2014+05%3A39+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_SAML_Web_Browser_Based_SSO">
      ⁠</a>19.10. About SAML Web Browser Based SSO</h1></div></div></div><div class="para">
		PicketLink in JBoss EAP provides a platform to implement federated identity based services. This includes centralized identity services and Single Sign-On (SSO) for applications.
	</div><div class="para">
		The SAML profile has support for both the HTTP/POST and the HTTP/Redirect bindings with centralized identity services to enable web SSO for your applications. The architecture for the SAML v2 based Web SSO follows the hub and spoke architecture of identity management. In this architecture an identity provider (IDP) acts as the central source (hub) for identity and role information to all the applications (Service Providers). The spokes are the service providers (SP).
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			If one HTTP client (web browser) connects to more SPs pointing to the same IDP, the IDP does not distinguish between the different SPs. If more requests from one client come simultaneously, the IDP handles the most recent request from an SP and sends back SAML assertion about the authenticated user. It means the SAML response from the IDP can be in such case forwarded to incorrect SP. To get back to the older SP, you will need to reenter the SP URL in the browser.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For more information, refer <em class="citetitle">Red Hat JBoss Enterprise Application Platform 6.4 How to Setup SSO with SAML V2</em> document and <em class="citetitle">Browser-based SSO Using SAML</em> section in the <em class="citetitle">Red Hat JBoss Enterprise Application Platform 6.4 Security Architecture</em> document.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+44827-771085+%5BLatest%5D&amp;comment=Title%3A+About+SAML+Web+Browser+Based+SSO%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44827-771085+29+Sep+2015+07%3A28+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Cookie_Domain">
      ⁠</a>19.11. Cookie Domain</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Cookie_Domain">
      ⁠</a>19.11.1. About the Cookie Domain</h2></div></div></div><div class="para">
		The <em class="firstterm">cookie domain</em> refers to the set of hosts able to read a cookie from the client browser which is accessing your application. It is a configuration mechanism to minimize the risk of third parties accessing information your application stores in browser cookies.
	</div><div class="para">
		The default value for the cookie domain is <code class="literal">/</code>. This means that only the issuing host can read the contents of a cookie. Setting a specific cookie domain makes the contents of the cookie available to a wider range of hosts. To set the cookie domain, refer to <a class="xref" href="chap-Single_Sign_On_SSO.html#Configure_the_Cookie_Domain">Section 19.11.2, “Configure the Cookie Domain for Single Sign On”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4697-591671+%5BLatest%5D&amp;comment=Title%3A+About+the+Cookie+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4697-591671+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_Cookie_Domain">
      ⁠</a>19.11.2. Configure the Cookie Domain for Single Sign On</h2></div></div></div><div class="para">
		To enable your SSO valve to share a SSO context, configure the cookie domain in the valve configuration. The following configuration would allow applications on <code class="literal">http://app1.xyz.com</code> and <code class="literal">http://app2.xyz.com</code> to share an SSO context, even if these applications run on different servers in a cluster or the virtual host with which they are associated has multiple aliases.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Clustered SSO (shared against clustered JBoss EAP instances)</div>
			Using the CLI (in Standalone mode):
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>/subsystem=web/virtual-server=default-host/sso=configuration:add(cache-container="web",cache-name="sso")</pre><div class="para">
		Editing <code class="filename">standlone.xml</code> or <code class="filename">domain.xml</code> and append the below to the relevant web subsystem:
	</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:web:1.1"</span><span xmlns="" class="perl_Others"> default-virtual-server=</span><span xmlns="" class="perl_String">"default-host"</span><span xmlns="" class="perl_Others"> native=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Others"> protocol=</span><span xmlns="" class="perl_String">"HTTP/1.1"</span><span xmlns="" class="perl_Others"> scheme=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;virtual-server</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"default-host"</span><span xmlns="" class="perl_Others"> enable-welcome-root=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;alias</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;alias</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"example.com"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;sso</span><span xmlns="" class="perl_Others"> cache-container=</span><span xmlns="" class="perl_String">"web"</span><span xmlns="" class="perl_Others"> cache-name=</span><span xmlns="" class="perl_String">"sso"</span><span xmlns="" class="perl_Keyword">/&gt;</span> <span xmlns="" class="perl_Comment">&lt;!--</span><span xmlns="" class="perl_Alert">FIXME</span><span xmlns="" class="perl_Comment">: ADD this Line--&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/virtual-server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>
</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Non-Clustered SSO (SSO only shared against instances within the Jboss EAP instances)</div>
			Using the CLI (in Standalone mode):
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    /subsystem=web/virtual-server=default-host/sso=configuration:add()
</pre><div class="para">
		Editing <code class="filename">standlone.xml</code> or <code class="filename">domain.xml</code> and append the below to the relevant web subsystem:
	</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:web:1.1"</span><span xmlns="" class="perl_Others"> default-virtual-server=</span><span xmlns="" class="perl_String">"default-host"</span><span xmlns="" class="perl_Others"> native=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Others"> protocol=</span><span xmlns="" class="perl_String">"HTTP/1.1"</span><span xmlns="" class="perl_Others"> scheme=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;virtual-server</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"default-host"</span><span xmlns="" class="perl_Others"> enable-welcome-root=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;alias</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;alias</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"example.com"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;sso/&gt;</span> <span xmlns="" class="perl_Comment">&lt;!--</span><span xmlns="" class="perl_Alert">FIXME</span><span xmlns="" class="perl_Comment">: ADD this Line--&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/virtual-server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>
</pre><div class="para">
		The Single Sign On (SSO) configuration in JBoss EAP 6 includes a domain attribute that can be specified. For example:
	</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>/subsystem=web/virtual-server=default-host/sso=configuration:add(domain="example.com",...)</pre><div class="para">
		Which adds the following SSO configuration:
	</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;sso</span><span xmlns="" class="perl_Others"> domain=</span><span xmlns="" class="perl_String">"example.com"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4698-770218+%5BLatest%5D&amp;comment=Title%3A+Configure+the+Cookie+Domain+for+Single+Sign+On%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4698-770218+14+Sep+2015+03%3A04+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>