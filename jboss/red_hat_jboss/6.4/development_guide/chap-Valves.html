<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 4. Valves</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Valves">
      ⁠</a>Chapter 4. Valves</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Valves">
      ⁠</a>4.1. About Valves</h1></div></div></div><div class="para">
		A Valve is a Java class that gets inserted into the request processing pipeline for an application. It is inserted in the pipeline before servlet filters. Valves can make changes to the request before passing it on or perform other processing such as authentication or even canceling the request.
	</div><div class="para">
		Valves can be configured at the server level or at the application level. The only difference is in how they are configured and packaged. 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Global Valves are configured at the server level and apply to all applications deployed to the server. Instructions to configure Global Valves are located in the <em class="citetitle">Administration and Configuration Guide</em> for JBoss EAP.
				</div></li><li class="listitem"><div class="para">
					Valves configured at the application level are packaged with the application deployment and only affect the specific application. Instructions to configure Valves at the application level are located in the <em class="citetitle">Development Guide</em> for JBoss EAP.
				</div></li></ul></div>

	</div><div class="para">
		Version 6.1.0 and later supports global valves.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14168-672932+%5BLatest%5D&amp;comment=Title%3A+About+Valves%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14168-672932+12+Jun+2014+12%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Global_Valves">
      ⁠</a>4.2. About Global Valves</h1></div></div></div><div class="para">
		A Global Valve is a valve that is inserted into the request processing pipeline of all deployed applications. A valve is made global by being packaged and installed as a static module in JBoss EAP 6. Global valves are configured in the web subsystem.
	</div><div class="para">
		Only version 6.1.0 and later supports global valves.
	</div><div class="para">
		For instructions on how to configure Global Valves, see the chapter entitled <em class="citetitle">Global Valves</em> in the <em class="citetitle">Administration and Configuration Guide for JBoss EAP</em>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14169-717305+%5BLatest%5D&amp;comment=Title%3A+About+Global+Valves%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14169-717305+17+Oct+2014+12%3A13+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Authenticator_Valves">
      ⁠</a>4.3. About Authenticator Valves</h1></div></div></div><div class="para">
		An authenticator valve is a valve that authenticates the credentials of a request. Such valve is a sub-class of <code class="code">org.apache.catalina.authenticator.AuthenticatorBase</code> and overrides the <code class="code">authenticate(Request request, Response response, LoginConfig config)</code> method.
	</div><div class="para">
		This can be used to implement additional authentication schemes.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14172-592104+%5BLatest%5D&amp;comment=Title%3A+About+Authenticator+Valves%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14172-592104+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_a_Web_Application_to_use_a_Valve">
      ⁠</a>4.4. Configure a Web Application to use a Valve</h1></div></div></div><div class="para">
		Valves that are not installed as global valves must be included with your application and configured in the <code class="filename">jboss-web.xml</code> deployment descriptor.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Valves that are installed as global valves are automatically applied to all deployed applications. For instructions on how to configure Global Valves, see <em class="citetitle">Global Valves</em> in the JBoss EAP <em class="citetitle">Administration and Configuration Guide</em>.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				The valve must be created and included in your application's classpath. This can be done by either including it in the application's WAR file or any module that is added as a dependency. Examples of such modules include a static module installed on the server or a JAR file in the <code class="filename">lib/</code> directory of an EAR archive if the WAR is deployed in an EAR.
			</div></li><li class="listitem"><div class="para">
				The application must include a <code class="filename">jboss-web.xml</code> deployment descriptor.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550732250096">
      ⁠</a><p class="title"><strong>Procedure 4.1. Configure an application for a local valve</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure a Valve</strong></p><div class="para">
				Create a <code class="code">valve</code> element containing the <code class="code">class-name</code> child element in the application's <code class="filename">jboss-web.xml</code> file. The <code class="code">class-name</code> is the name of the valve class. 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>VALVE_CLASS_NAME<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span></pre>
				 <div class="example"><a id="idm140550799043888">
      ⁠</a><p class="title"><strong>Example 4.1. Valve element configured in the jboss-web.xml file</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.security.negotiation.NegotiationAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span></pre></div></div>

			</div></li><li class="step"><p class="title"><strong>Configure a Custom Valve</strong></p><div class="para">
				If the valve has configurable parameters, add a <code class="code">param</code> child element to the <code class="code">valve</code> element for each parameter, specifying the <code class="code">param-name</code> and <code class="code">param-value</code> for each.
			</div><div class="example"><a id="idm140550772610800">
      ⁠</a><p class="title"><strong>Example 4.2. Custom valve element configured in the jboss-web.xml file</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.web.tomcat.security.GenericHeaderAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>httpHeaderForSSOAuth<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>sm_ssoid,ct-remote-user,HTTP_OBLIX_UID<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>sessionCookieForSSOAuth<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>SMSESSION,CTSESSION,ObSSOCookie<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span></pre></div></div></li></ol></div><div class="para">
		When the application is deployed, the valve will be enabled for the application with the specified configuration.
	</div><div class="example"><a id="idm140550813258800">
      ⁠</a><p class="title"><strong>Example 4.3. jboss-web.xml valve configuration</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.samplevalves.RestrictedUserAgentsValve<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>restrictedUserAgents<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>^.*MS Web Services Client Protocol.*$<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span></pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14173-759135+%5BLatest%5D&amp;comment=Title%3A+Configure+a+Web+Application+to+use+a+Valve%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14173-759135+22+May+2015+00%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_a_Web_Application_to_use_an_Authenticator_Valve">
      ⁠</a>4.5. Configure a Web Application to use an Authenticator Valve</h1></div></div></div><div class="para">
		Configuring an application to use an authenticator valve requires the valve to be installed and configured (either local to the application or as a global valve) and the <code class="filename">web.xml</code> deployment descriptor of the application to be configured. In the simplest case, the <code class="filename">web.xml</code> configuration is the same as using <code class="systemitem">BASIC</code> authentication except the <code class="code">auth-method</code> child element of <code class="code">login-config</code> is set to the name of the valve performing the configuration.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Authentication valve must already be created.
			</div></li><li class="listitem"><div class="para">
				If the authentication valve is a global valve then it must already be installed and configured, and you must know the name that it was configured as.
			</div></li><li class="listitem"><div class="para">
				You need to know the realm name of the security realm that the application will use.
			</div></li></ul></div><div class="para">
		If you do not know the valve or security realm name to use, ask your server administrator for this information.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550741718464">
      ⁠</a><p class="title"><strong>Procedure 4.2. Configure an Application to use an Authenticator Valve</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure the valve</strong></p><div class="para">
				When using a local valve, it must be configured in the application's <code class="filename">jboss-web.xml</code> deployment descriptor. See <a class="xref" href="chap-Valves.html#Configure_a_Web_Application_to_use_a_Valve">Section 4.4, “Configure a Web Application to use a Valve”</a>.
			</div><div class="para">
				When using a global valve, this is not necessary.
			</div></li><li class="step"><p class="title"><strong>Add security configuration to web.xml</strong></p><div class="para">
				Add the security configuration to the <code class="filename">web.xml</code> file for your application, using the standard elements such as <code class="systemitem">security-constraint</code>, <code class="systemitem">login-config</code>, and <code class="systemitem">security-role</code>. In the <code class="systemitem">login-config</code> element, set the value of <code class="systemitem">auth-method</code> to the name of the authenticator valve. The realm-name element must also be set to the name of the JBoss security realm being used by the application.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>VALVE_NAME<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;realm-name&gt;</span>REALM_NAME<span xmlns="" class="perl_Keyword">&lt;/realm-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span></pre></li></ol></div><div class="para">
		When the application is deployed, the authentication of requests is handled by the configured authentication valve. 
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14174-759154+%5BLatest%5D&amp;comment=Title%3A+Configure+a+Web+Application+to+use+an+Authenticator+Valve%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14174-759154+22+May+2015+02%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Create_a_Custom_Valve">
      ⁠</a>4.6. Create a Custom Valve</h1></div></div></div><div class="para">
		A Valve is a Java class that gets inserted into the request processing pipeline for an application before the application's servlet filters. This can be used to modify the request or perform any other behavior. This task demonstrates the basic steps required for implementing a valve.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550814575248">
      ⁠</a><p class="title"><strong>Procedure 4.3. Create a Custom Valve</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure the Maven dependencies.</strong></p><div class="para">
				Add the following dependency configuration to the project <code class="filename">pom.xml</code> file. 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.jboss.web<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>jbossweb<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>7.5.7.Final-redhat-1<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;scope&gt;</span>provided<span xmlns="" class="perl_Keyword">&lt;/scope&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span></pre>

			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The <code class="filename">jbossweb-<em class="replaceable">VERSION</em>.jar</code> file should not be included in the application. It is available to the JBoss EAP server runtime classpath as a JBoss module at this location: <code class="filename"><em class="replaceable">EAP_HOME</em>/modules/system/layers/base/org/jboss/as/web/main/jbossweb-7.5.7.Final-redhat-1.jar</code>.
				</div></div></div></li><li class="step"><p class="title"><strong>Create the Valve class</strong></p><div class="para">
				Create a subclass of <code class="code">org.apache.catalina.valves.ValveBase</code>.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">samplevalves</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.valves.ValveBase;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Request;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Response;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> RestrictedUserAgentsValve <span xmlns="" class="perl_Keyword">extends</span> ValveBase {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre></li><li class="step"><p class="title"><strong>Implement the invoke method.</strong></p><div class="para">
				The <code class="code">invoke()</code> method is called when this valve is executed in the pipeline. The request and response objects are passed as parameters. Perform any processing and modification of the request and response here.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">invoke</span>(Request request, Response response)
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre></li><li class="step"><p class="title"><strong>Invoke the next pipeline step.</strong></p><div class="para">
				The last thing the invoke method must do is invoke the next step of the pipeline and pass the modified request and response objects along. This is done using the <code class="code">getNext().invoke()</code> method
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Function">getNext</span>().<span xmlns="" class="perl_Function">invoke</span>(request, response);</pre></li><li class="step"><p class="title"><strong>Optional: Specify parameters.</strong></p><div class="para">
				If the valve must be configurable, enable this by adding a parameter. Do this by adding an instance variable and a setter method for each parameter.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> String restrictedUserAgents = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRestricteduserAgents</span>(String mystring) 
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">restrictedUserAgents</span> = mystring;
<span xmlns="" class="line">​</span>}</pre></li><li class="step"><p class="title"><strong>Review the completed code example.</strong></p><div class="para">
				The class should now look like the following example.
			</div><div class="para">
				<div class="example"><a id="idm140550789504768">
      ⁠</a><p class="title"><strong>Example 4.4. Sample Custom Valve</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">samplevalves</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.io.IOException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.regex.Pattern;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.ServletException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.valves.ValveBase;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Request;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Response;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> RestrictedUserAgentsValve <span xmlns="" class="perl_Keyword">extends</span> ValveBase 
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String restrictedUserAgents = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRestrictedUserAgents</span>(String mystring) 
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">restrictedUserAgents</span> = mystring;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">invoke</span>(Request request, Response response) <span xmlns="" class="perl_Keyword">throws</span> IOException, ServletException 
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>      String agent = request.<span xmlns="" class="perl_Function">getHeader</span>(<span xmlns="" class="perl_String">"User-Agent"</span>);
<span xmlns="" class="line">​</span>      System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"user-agent: "</span> + agent + <span xmlns="" class="perl_String">" : "</span> + restrictedUserAgents);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (Pattern.<span xmlns="" class="perl_Function">matches</span>(restrictedUserAgents, agent)) 
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"user-agent: "</span> + agent + <span xmlns="" class="perl_String">" matches: "</span> + restrictedUserAgents);
<span xmlns="" class="line">​</span>         response.<span xmlns="" class="perl_Function">addHeader</span>(<span xmlns="" class="perl_String">"Connection"</span>, <span xmlns="" class="perl_String">"close"</span>);
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Function">getNext</span>().<span xmlns="" class="perl_Function">invoke</span>(request, response);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div>

			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14175-771123+%5BLatest%5D&amp;comment=Title%3A+Create+a+Custom+Valve%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14175-771123+29+Sep+2015+13%3A47+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></body></html>