<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 14. Hibernate Search</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Hibernate_Search">
      ⁠</a>Chapter 14. Hibernate Search</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Getting_Started_with_Hibernate_Search">
      ⁠</a>14.1. Getting Started with Hibernate Search</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Hibernate_Search">
      ⁠</a>14.1.1. About Hibernate Search</h2></div></div></div><div class="para">
		Hibernate Search provides full-text search capability to Hibernate applications. It is especially suited to search applications for which SQL-based solutions are not suited, including: full-text, fuzzy and geolocation searches. Hibernate Search uses Apache Lucene as its full-text search engine, but is designed to minimize the maintenance overhead. Once it is configured, indexing, clustering and data synchronization is maintained transparently, allowing you to focus on meeting your business requirements.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+42279-743936+%5BLatest%5D&amp;comment=Title%3A+About+Hibernate+Search%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42279-743936+18+Feb+2015+23%3A18+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="First_Steps_with_Hibernate_Search">
      ⁠</a>14.1.2. First Steps with Hibernate Search</h2></div></div></div><div class="para">
		To get started with Hibernate Search for your application, follow these topics.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				See <em class="citetitle">Configuration</em> in the JBoss EAP <em class="citetitle">Administration and Configuration Guide</em> to configure Hibernate Search.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Hibernate_Search.html#Enable_Hibernate_Search_using_Maven">Section 14.1.3, “Enable Hibernate Search using Maven”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Hibernate_Search.html#Indexing">Section 14.1.5, “Indexing”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Hibernate_Search.html#Searching">Section 14.1.6, “Searching”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Hibernate_Search.html#Analyzer">Section 14.1.7, “Analyzer”</a>
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+43176-749462+%5BLatest%5D&amp;comment=Title%3A+First+Steps+with+Hibernate+Search%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=43176-749462+31+Mar+2015+22%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enable_Hibernate_Search_using_Maven">
      ⁠</a>14.1.3. Enable Hibernate Search using Maven</h2></div></div></div><div class="para">
		Use the following configuration in your Maven project to add <code class="literal">hibernate-search-orm</code> dependencies:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;dependencyManagement&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.hibernate<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>hibernate-search-orm<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>4.6.0.Final-redhat-2<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/dependencyManagement&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.hibernate<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>hibernate-search-orm<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;scope&gt;</span>provided<span xmlns="" class="perl_Keyword">&lt;/scope&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span></pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+43166-750091+%5BLatest%5D&amp;comment=Title%3A+Enable+Hibernate+Search+using+Maven%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=43166-750091+08+Apr+2015+06%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuration9">
      ⁠</a>14.1.4. Add Annotations</h2></div></div></div><div class="para">
		For this section, consider the example in which you have a database containing details of books. Your application contains the Hibernate managed classes <code class="classname">example.Book</code> and <code class="classname">example.Author</code> and you want to add free text search capabilities to your application to enable searching for books.
	</div><div class="example"><a id="idm140550744394192">
      ⁠</a><p class="title"><strong>Example 14.1. Entities Book and Author Before Adding Hibernate Search Specific Annotations</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package example;
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Book {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Id
<span xmlns="" class="line">​</span>  @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer id; 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String title;  
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String subtitle; 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @ManyToMany 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Set&lt;Author&gt; authors = <span xmlns="" class="perl_Keyword">new</span> HashSet&lt;Author&gt;();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Date publicationDate;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Book() {} 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// standard getters/setters follow here</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre><pre class="programlisting"><span xmlns="" class="line">​</span>package example;
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Author {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Id
<span xmlns="" class="line">​</span>  @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">Author</span>() {} 
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// standard getters/setters follow here</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		To achieve this you have to add a few annotations to the <code class="classname">Book</code> and <code class="classname">Author</code> class. The first annotation <code class="literal">@Indexed</code> marks <code class="classname">Book</code> as indexable. By design Hibernate Search stores an untokenized ID in the index to ensure index unicity for a given entity. <code class="literal">@DocumentId</code> marks the property to use for this purpose and is in most cases the same as the database primary key. The <code class="literal">@DocumentId</code> annotation is optional in the case where an <code class="classname">@Id</code> annotation exists.
	</div><div class="para">
		Next the fields you want to make searchable must be marked as such. In this example, start with <code class="literal">title</code> and <code class="literal">subtitle</code> and annotate both with <code class="literal">@Field</code>. The parameter <code class="literal">index=Index.YES</code> will ensure that the text will be indexed, while <code class="literal">analyze=Analyze.YES</code> ensures that the text will be analyzed using the default Lucene analyzer. Usually, analyzing means chunking a sentence into individual words and potentially excluding common words like <code class="literal">'a'</code> or '<code class="literal">the</code>'. We will talk more about analyzers a little later on. The third parameter we specify within <code class="literal">@Field</code>,<code class="literal"> store=Store.NO</code>, ensures that the actual data will not be stored in the index. Whether this data is stored in the index or not has nothing to do with the ability to search for it. From Lucene's perspective it is not necessary to keep the data once the index is created. The benefit of storing it is the ability to retrieve it via projections ( see <a class="xref" href="chap-Hibernate_Search.html#Projection">Section 14.3.1.10.5, “Projection”</a>).
	</div><div class="para">
		Without projections, Hibernate Search will per default execute a Lucene query in order to find the database identifiers of the entities matching the query criteria and use these identifiers to retrieve managed objects from the database. The decision for or against projection has to be made on a case to case basis. The default behavior is recommended since it returns managed objects whereas projections only return object arrays.
	</div><div class="para">
		Note that <code class="literal">index=Index.YES</code>, <code class="literal">analyze=Analyze.YES</code> and <code class="literal">store=Store.NO</code> are the default values for these parameters and could be omitted.
	</div><div class="para">
		Another annotation not yet discussed is <code class="literal">@DateBridge</code>. This annotation is one of the built-in field bridges in Hibernate Search. The Lucene index is purely string based. For this reason Hibernate Search must convert the data types of the indexed fields to strings and vice-versa. A range of predefined bridges are provided, including the <code class="classname">DateBridge</code> which will convert a <code class="classname">java.util.Date</code> into a <code class="classname">String</code> with the specified resolution. For more details see <a class="xref" href="chap-Hibernate_Search.html#sect-Bridges">Section 14.2.4, “Bridges”</a>.
	</div><div class="para">
		This leaves us with <code class="literal">@IndexedEmbedded.</code>This annotation is used to index associated entities (<code class="literal">@ManyToMany</code>, <code class="literal">@*ToOne</code>, <code class="literal">@Embedded</code> and <code class="literal">@ElementCollection</code>) as part of the owning entity. This is needed since a Lucene index document is a flat data structure which does not know anything about object relations. To ensure that the authors' name will be searchable you have to ensure that the names are indexed as part of the book itself. On top of <code class="literal">@IndexedEmbedded</code> you will also have to mark all fields of the associated entity you want to have included in the index with <code class="literal">@Indexed</code>. For more details see <a class="xref" href="chap-Hibernate_Search.html#Embedded_and_Associated_Objects">Section 14.2.1.3, “Embedded and Associated Objects”</a>
	</div><div class="para">
		These settings should be sufficient for now. For more details on entity mapping see <a class="xref" href="chap-Hibernate_Search.html#sect-Mapping_an_Entity">Section 14.2.1, “Mapping an Entity”</a>.
	</div><div class="example"><a id="idm140550807218672">
      ⁠</a><p class="title"><strong>Example 14.2. Entities After Adding Hibernate Search Annotations</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>package example;
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Book {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Id
<span xmlns="" class="line">​</span>  @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Field</span>(index=Index.<span xmlns="" class="perl_Function">YES</span>, analyze=Analyze.<span xmlns="" class="perl_Function">YES</span>, store=Store.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String title;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Field</span>(index=Index.<span xmlns="" class="perl_Function">YES</span>, analyze=Analyze.<span xmlns="" class="perl_Function">YES</span>, store=Store.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String subtitle; 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span> @<span xmlns="" class="perl_Function">Field</span>(index = Index.<span xmlns="" class="perl_Function">YES</span>, analyze=Analyze.<span xmlns="" class="perl_Function">NO</span>, store = Store.<span xmlns="" class="perl_Function">YES</span>)
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">DateBridge</span>(resolution = Resolution.<span xmlns="" class="perl_Function">DAY</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Date publicationDate;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @IndexedEmbedded
<span xmlns="" class="line">​</span>  @ManyToMany 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Set&lt;Author&gt; authors = <span xmlns="" class="perl_Keyword">new</span> HashSet&lt;Author&gt;();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Book() {
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// standard getters/setters follow here</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">... </span>
<span xmlns="" class="line">​</span>}</pre><pre class="programlisting Java"><span xmlns="" class="line">​</span>package example;
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Author {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Id
<span xmlns="" class="line">​</span>  @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Field
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">Author</span>() {
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// standard getters/setters follow here</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14257-749464+%5BLatest%5D&amp;comment=Title%3A+Add+Annotations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14257-749464+31+Mar+2015+23%3A17+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Indexing">
      ⁠</a>14.1.5. Indexing</h2></div></div></div><div class="para">
		Hibernate Search will transparently index every entity persisted, updated or removed through Hibernate Core. However, you have to create an initial Lucene index for the data already present in your database. Once you have added the above properties and annotations it is time to trigger an initial batch index of your books. You can achieve this by using one of the following code snippets (see also <a class="xref" href="chap-Hibernate_Search.html#sect-Rebuilding_the_Index">Section 14.4.3, “Rebuilding the Index”</a>):
	</div><div class="example"><a id="idm140550797851536">
      ⁠</a><p class="title"><strong>Example 14.3. Using the Hibernate Session to Index Data</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Search</span>.<span xmlns="" class="perl_Function">getFullTextSession</span>(session);
<span xmlns="" class="line">​</span>fullTextSession.<span xmlns="" class="perl_Function">createIndexer</span>().<span xmlns="" class="perl_Function">startAndWait</span>();</pre></div></div><div class="example"><a id="idm140550786835824">
      ⁠</a><p class="title"><strong>Example 14.4. Using JPA to Index Data</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>EntityManager em = entityManagerFactory.<span xmlns="" class="perl_Function">createEntityManager</span>();
<span xmlns="" class="line">​</span>FullTextEntityManager fullTextEntityManager = org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">jpa</span>.<span xmlns="" class="perl_Function">Search</span>.<span xmlns="" class="perl_Function">getFullTextEntityManager</span>(em);
<span xmlns="" class="line">​</span>fullTextEntityManager.<span xmlns="" class="perl_Function">createIndexer</span>().<span xmlns="" class="perl_Function">startAndWait</span>();</pre></div></div><div class="para">
		After executing the above code, you should be able to see a Lucene index under <code class="literal">/var/lucene/indexes/example.Book</code>. Go ahead an inspect this index with <a href="http://code.google.com/p/luke/">Luke</a>. It will help you to understand how Hibernate Search works.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14225-746032+%5BLatest%5D&amp;comment=Title%3A+Indexing%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14225-746032+05+Mar+2015+20%3A03+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Searching">
      ⁠</a>14.1.6. Searching</h2></div></div></div><div class="para">
		To execute a search, create a Lucene query using either the Lucene API (<a class="xref" href="chap-Hibernate_Search.html#Building_a_Lucene_Query_Using_the_Lucene_API">Section 14.3.1.1, “Building a Lucene Query Using the Lucene API”</a>) or the Hibernate Search query DSL (<a class="xref" href="chap-Hibernate_Search.html#Building_a_Lucene_Query_with_the_Hibernate_Search_Query_DSL">Section 14.3.1.2, “Building a Lucene Query”</a>). Wrap the query in a <code class="classname">org.hibernate.Query</code> to get the required functionality from the Hibernate API. The following code prepares a query against the indexed fields. Executing the code returns a list of <code class="classname">Book</code>s.
	</div><div class="example"><a id="idm140550729279024">
      ⁠</a><p class="title"><strong>Example 14.5. Using a Hibernate Search Session to Create and Execute a Search</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(session);
<span xmlns="" class="line">​</span>Transaction tx = fullTextSession.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// create native Lucene query using the query DSL</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// alternatively you can write the Lucene query using the Lucene query parser</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// or the Lucene programmatic API. The Hibernate Search DSL is recommended though</span>
<span xmlns="" class="line">​</span>QueryBuilder qb = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">buildQueryBuilder</span>().<span xmlns="" class="perl_Function">forEntity</span>( Book.<span xmlns="" class="perl_Function">class</span> ).<span xmlns="" class="perl_Function">get</span>();
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> query = qb
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">onFields</span>(<span xmlns="" class="perl_String">"title"</span>, <span xmlns="" class="perl_String">"subtitle"</span>, <span xmlns="" class="perl_String">"authors.name"</span>, <span xmlns="" class="perl_String">"publicationDate"</span>)
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"Java rocks!"</span>)
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">createQuery</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// wrap Lucene query in a org.hibernate.Query</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">Query</span> hibQuery = 
<span xmlns="" class="line">​</span>    fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>(query, Book.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// execute search</span>
<span xmlns="" class="line">​</span>List result = hibQuery.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>tx.<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>session.<span xmlns="" class="perl_Function">close</span>();</pre></div></div><div class="example"><a id="idm140550777786368">
      ⁠</a><p class="title"><strong>Example 14.6. Using JPA to Create and Execute a Search</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>EntityManager em = entityManagerFactory.<span xmlns="" class="perl_Function">createEntityManager</span>();
<span xmlns="" class="line">​</span>FullTextEntityManager fullTextEntityManager = 
<span xmlns="" class="line">​</span>    org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">jpa</span>.<span xmlns="" class="perl_Function">Search</span>.<span xmlns="" class="perl_Function">getFullTextEntityManager</span>(em);
<span xmlns="" class="line">​</span>em.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">begin</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// create native Lucene query using the query DSL</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// alternatively you can write the Lucene query using the Lucene query parser</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// or the Lucene programmatic API. The Hibernate Search DSL is recommended though</span>
<span xmlns="" class="line">​</span>QueryBuilder qb = fullTextEntityManager.<span xmlns="" class="perl_Function">getSearchFactory</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">buildQueryBuilder</span>().<span xmlns="" class="perl_Function">forEntity</span>( Book.<span xmlns="" class="perl_Function">class</span> ).<span xmlns="" class="perl_Function">get</span>();
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> query = qb
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">onFields</span>(<span xmlns="" class="perl_String">"title"</span>, <span xmlns="" class="perl_String">"subtitle"</span>, <span xmlns="" class="perl_String">"authors.name"</span>, <span xmlns="" class="perl_String">"publicationDate"</span>)
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"Java rocks!"</span>)
<span xmlns="" class="line">​</span>  .<span xmlns="" class="perl_Function">createQuery</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// wrap Lucene query in a javax.persistence.Query</span>
<span xmlns="" class="line">​</span>javax.<span xmlns="" class="perl_Function">persistence</span>.<span xmlns="" class="perl_Function">Query</span> persistenceQuery = 
<span xmlns="" class="line">​</span>    fullTextEntityManager.<span xmlns="" class="perl_Function">createFullTextQuery</span>(query, Book.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// execute search</span>
<span xmlns="" class="line">​</span>List result = persistenceQuery.<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>em.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>em.<span xmlns="" class="perl_Function">close</span>();</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14248-750185+%5BLatest%5D&amp;comment=Title%3A+Searching%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14248-750185+09+Apr+2015+00%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Analyzer">
      ⁠</a>14.1.7. Analyzer</h2></div></div></div><div class="para">
		Assuming that the title of an indexed book entity is <code class="literal">Refactoring: Improving the Design of Existing Code</code> and that hits are required for the following queries: <code class="literal">refactor</code>, <code class="literal">refactors</code>, <code class="literal">refactored</code>, and <code class="literal">refactoring</code>. Select an analyzer class in Lucene that applies word stemming when indexing and searching. <span class="phrase">Hibernate Search</span> offers several ways to configure the analyzer (see <a class="xref" href="chap-Hibernate_Search.html#Default_Analyzer_and_Analyzer_by_Class">Section 14.2.3.1, “Default Analyzer and Analyzer by Class”</a> for more information):
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Set the <code class="literal">analyzer</code> property in the configuration file. The specified class becomes the default analyzer.
			</div></li><li class="listitem"><div class="para">
				Set the <code class="literal"><code class="literal">@Analyzer</code></code> annotation at the entity level.
			</div></li><li class="listitem"><div class="para">
				Set the <code class="literal">@<code class="literal">Analyzer</code></code> annotation at the field level.
			</div></li></ul></div><div class="para">
		Specify the fully qualified classname or the analyzer to use, or see an analyzer defined by the <code class="literal">@AnalyzerDef</code> annotation with the <code class="literal">@Analyzer</code> annotation. The Solr analyzer framework with its factories are utilized for the latter option. For more information about factory classes, see the Solr JavaDoc or read the corresponding section on the Solr Wiki (<a href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters</a>)
	</div><div class="para">
		In the example, a <code class="classname">StandardTokenizerFactory</code> is used by two filter factories: <code class="classname">LowerCaseFilterFactory</code> and <code class="classname">SnowballPorterFilterFactory</code>. The tokenizer splits words at punctuation characters and hyphens but keeping email addresses and internet hostnames intact. The standard tokenizer is ideal for this and other general operations. The lowercase filter converts all letters in the token into lowercase and the snowball filter applies language specific stemming.
	</div><div class="para">
		If using the Solr framework, use the tokenizer with an arbitrary number of filters.
	</div><div class="example"><a id="idm140550787577312">
      ⁠</a><p class="title"><strong>Example 14.7. Using @AnalyzerDef and the Solr Framework to Define and Use an Analyzer</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">AnalyzerDef</span>(
<span xmlns="" class="line">​</span>   name = <span xmlns="" class="perl_String">"customanalyzer"</span>,
<span xmlns="" class="line">​</span>   tokenizer = @<span xmlns="" class="perl_Function">TokenizerDef</span>(factory = StandardTokenizerFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>   filters = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = LowerCaseFilterFactory.<span xmlns="" class="perl_Function">class</span>), 
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = SnowballPorterFilterFactory.<span xmlns="" class="perl_Function">class</span>,
<span xmlns="" class="line">​</span>         params = { @<span xmlns="" class="perl_Function">Parameter</span>(name = <span xmlns="" class="perl_String">"language"</span>, value = <span xmlns="" class="perl_String">"English"</span>) })
<span xmlns="" class="line">​</span> })
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Book <span xmlns="" class="perl_Keyword">implements</span> Serializable {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Field
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Analyzer</span>(definition = <span xmlns="" class="perl_String">"customanalyzer"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String title;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Field
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Analyzer</span>(definition = <span xmlns="" class="perl_String">"customanalyzer"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String subtitle; 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @IndexedEmbedded
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Set authors = <span xmlns="" class="perl_Keyword">new</span> HashSet();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Field</span>(index = Index.<span xmlns="" class="perl_Function">YES</span>, analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>, store = Store.<span xmlns="" class="perl_Function">YES</span>)
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">DateBridge</span>(resolution = Resolution.<span xmlns="" class="perl_Function">DAY</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Date publicationDate;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Book() {
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// standard getters/setters follow here</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">... </span>
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Use <code class="classname">@AnalyzerDef</code> to define an analyzer, then apply it to entities and properties using <code class="classname">@Analyzer</code>. In the example, the <code class="literal">customanalyzer</code> is defined but not applied on the entity. The analyzer is only applied to the <code class="literal">title</code> and <code class="literal">subtitle</code> properties. An analyzer definition is global. Define the analyzer for an entity and reuse the definition for other entities as required.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14251-592108+%5BLatest%5D&amp;comment=Title%3A+Analyzer%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14251-592108+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Mapping_Entities_to_the_Index_Structure">
      ⁠</a>14.2. Mapping Entities to the Index Structure</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Mapping_an_Entity">
      ⁠</a>14.2.1. Mapping an Entity</h2></div></div></div><div class="para">
				All the metadata information required to index entities is described through annotations, so there is no need for XML mapping files. You can still use Hibernate mapping files for the basic Hibernate configuration, but the Hibernate Search specific configuration has to be expressed via annotations.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14214-747229+%5BLatest%5D&amp;comment=Title%3A+Mapping+an+Entity%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-Basic_Mapping">
      ⁠</a>14.2.1.1. Basic Mapping</h3></div></div></div><div class="para">
					Lets start with the most commonly used annotations for mapping an entity.
				</div><div class="para">
					The Lucene-based Query API uses the following common annotations to map entities: 
					<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								@Indexed
							</div></li><li class="listitem"><div class="para">
								@Field
							</div></li><li class="listitem"><div class="para">
								@NumericField
							</div></li><li class="listitem"><div class="para">
								@Id
							</div></li></ul></div>

				</div><div class="para RoleCreateBugPara">
					<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14272-592110+%5BLatest%5D&amp;comment=Title%3A+Basic+Mapping%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
				</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Indexed">
      ⁠</a>14.2.1.1.1. @Indexed</h4></div></div></div><div class="para">
		Foremost we must declare a persistent class as indexable. This is done by annotating the class with <code class="literal">@Indexed</code> (all entities not annotated with <code class="literal">@Indexed</code> will be ignored by the indexing process):
	</div><div class="example"><a id="idm140550792721520">
      ⁠</a><p class="title"><strong>Example 14.8. Making a class indexable with <code class="classname">@Indexed</code></strong></p><div class="example-contents"><pre class="programlisting">@Entity
<span class="bold bold"><strong>@Indexed</strong></span>
public class Essay {
    ...
}</pre></div></div><div class="para">
		You can optionally specify the <code class="literal">index</code> attribute of the @Indexed annotation to change the default name of the index.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14287-747234+%5BLatest%5D&amp;comment=Title%3A+%40Indexed%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14287-747234+16+Mar+2015+00%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Field">
      ⁠</a>14.2.1.1.2. @Field</h4></div></div></div><div class="para">
		For each property (or attribute) of your entity, you have the ability to describe how it will be indexed. The default (no annotation present) means that the property is ignored by the indexing process. <code class="literal">@Field</code> does declare a property as indexed and allows to configure several aspects of the indexing process by setting one or more of the following attributes:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">name</code> : describe under which name, the property should be stored in the Lucene Document. The default value is the property name (following the JavaBeans convention)
			</div></li><li class="listitem"><div class="para">
				<code class="literal">store</code> : describe whether or not the property is stored in the Lucene index. You can store the value <code class="literal">Store.YES</code> (consuming more space in the index but allowing projection, see <a class="xref" href="chap-Hibernate_Search.html#Projection">Section 14.3.1.10.5, “Projection”</a>), store it in a compressed way <code class="literal">Store.COMPRESS</code> (this does consume more CPU), or avoid any storage <code class="literal">Store.NO</code> (this is the default value). When a property is stored, you can retrieve its original value from the Lucene Document. This is not related to whether the element is indexed or not.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">index</code>: describe whether the property is indexed or not. The different values are <code class="literal">Index.NO</code> (no indexing, ie cannot be found by a query), <code class="literal">Index.YES</code> (the element gets indexed and is searchable). The default value is <code class="literal">Index.YES</code>. <code class="literal">Index.NO</code> can be useful for cases where a property is not required to be searchable, but should be available for projection.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="literal">Index.NO</code> in combination with <code class="literal">Analyze.YES</code> or <code class="literal">Norms.YES</code> is not useful, since <code class="literal">analyze</code> and <code class="literal">norms</code> require the property to be indexed
				</div></div></div></li><li class="listitem"><div class="para">
				<code class="literal">analyze</code>: determines whether the property is analyzed (<code class="literal">Analyze.YES</code>) or not (<code class="literal">Analyze.NO</code>). The default value is <code class="literal">Analyze.YES</code>. 
				<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						Whether or not you want to analyze a property depends on whether you wish to search the element as is, or by the words it contains. It make sense to analyze a text field, but probably not a date field.
					</div></div></div>
				 <div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						Fields used for sorting <span class="emphasis"><em>must not</em></span> be analyzed.
					</div></div></div>

			</div></li><li class="listitem"><div class="para">
				<code class="literal">norms</code>: describes whether index time boosting information should be stored (<code class="literal">Norms.YES</code>) or not (<code class="literal">Norms.NO</code>). Not storing it can save a considerable amount of memory, but there won't be any index time boosting information available. The default value is <code class="literal">Norms.YES</code>.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">termVector</code>: describes collections of term-frequency pairs. This attribute enables the storing of the term vectors within the documents during indexing. The default value is <code class="literal">TermVector.NO</code>.
			</div><div class="para">
				The different values of this attribute are:
			</div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: center"> Value </th><th style="text-align: center"> Definition </th></tr></thead><tbody><tr><td style="text-align: left"> TermVector.YES </td><td style="text-align: left"> Store the term vectors of each document. This produces two synchronized arrays, one contains document terms and the other contains the term's frequency. </td></tr><tr><td style="text-align: left"> TermVector.NO </td><td style="text-align: left"> Do not store term vectors. </td></tr><tr><td style="text-align: left"> TermVector.WITH_OFFSETS </td><td style="text-align: left"> Store the term vector and token offset information. This is the same as TermVector.YES plus it contains the starting and ending offset position information for the terms. </td></tr><tr><td style="text-align: left"> TermVector.WITH_POSITIONS </td><td style="text-align: left"> Store the term vector and token position information. This is the same as TermVector.YES plus it contains the ordinal positions of each occurrence of a term in a document. </td></tr><tr><td style="text-align: left"> TermVector.WITH_POSITION_OFFSETS </td><td style="text-align: left"> Store the term vector, token position and offset information. This is a combination of the YES, WITH_OFFSETS and WITH_POSITIONS. </td></tr></tbody></table></div></li><li class="listitem"><div class="para">
				<code class="literal">indexNullAs</code> : Per default null values are ignored and not indexed. However, using <em class="parameter"><code>indexNullAs</code></em> you can specify a string which will be inserted as token for the <code class="constant">null</code> value. Per default this value is set to <code class="constant">Field.DO_NOT_INDEX_NULL</code> indicating that <code class="constant">null</code> values should not be indexed. You can set this value to <code class="constant">Field.DEFAULT_NULL_TOKEN</code> to indicate that a default <code class="constant">null</code> token should be used. This default <code class="constant">null</code> token can be specified in the configuration using <code class="literal">hibernate.search.default_null_token</code>. If this property is not set and you specify <code class="constant">Field.DEFAULT_NULL_TOKEN</code> the string "_null_" will be used as default.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					When the <em class="parameter"><code>indexNullAs</code></em> parameter is used it is important to use the same token in the search query to search for <code class="constant">null</code> values. It is also advisable to use this feature only with un-analyzed fields (<code class="literal"><code class="literal">analyze=</code>Analyze.NO</code>).
				</div></div></div><div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					When implementing a custom <code class="classname">FieldBridge</code> or <code class="classname">TwoWayFieldBridge</code> it is up to the developer to handle the indexing of null values (see JavaDocs of <code class="methodname">LuceneOptions.indexNullAs()</code>).
				</div></div></div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14285-750175+%5BLatest%5D&amp;comment=Title%3A+%40Field%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14285-750175+08+Apr+2015+23%3A40+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="NumericField">
      ⁠</a>14.2.1.1.3. @NumericField</h4></div></div></div><div class="para">
		There is a companion annotation to <code class="classname">@Field</code> called <code class="classname">@NumericField</code> that can be specified in the same scope as <code class="classname">@Field</code> or <code class="classname">@DocumentId</code>. It can be specified for Integer, Long, Float, and Double properties. At index time the value will be indexed using a Trie structure. When a property is indexed as numeric field, it enables efficient range query and sorting, orders of magnitude faster than doing the same query on standard <code class="classname">@Field</code> properties. The <code class="classname">@NumericField</code> annotation accept the following parameters: 
		<div class="informaltable"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: center"> Value </th><th style="text-align: center"> Definition </th></tr></thead><tbody><tr><td style="text-align: left"> forField </td><td style="text-align: left"> (Optional) Specify the name of the related @Field that will be indexed as numeric. It's only mandatory when the property contains more than a @Field declaration </td></tr><tr><td style="text-align: left"> precisionStep </td><td style="text-align: left"> (Optional) Change the way that the Trie structure is stored in the index. Smaller precisionSteps lead to more disk space usage and faster range and sort queries. Larger values lead to less space used and range query performance more close to the range query in normal @Fields. Default value is 4. </td></tr></tbody></table></div>
		 <code class="classname">@NumericField</code> supports only <code class="classname">Double</code>, <code class="classname">Long</code>, <code class="classname">Integer</code> and <code class="classname">Float</code>. It is not possible to take any advantage from similar functionality in Lucene for the other numeric types, so remaining types should use the string encoding via the default or custom <code class="classname">TwoWayFieldBridge</code>.
	</div><div class="para">
		It is possible to use a custom <code class="classname">NumericFieldBridge</code> assuming you can deal with the approximation during type transformation:
	</div><div class="example"><a id="example-custom-numericfieldbridge">
      ⁠</a><p class="title"><strong>Example 14.9. Defining a custom <code class="classname">NumericFieldBridge</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> BigDecimalNumericFieldBridge <span xmlns="" class="perl_Keyword">extends</span> NumericFieldBridge {
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> BigDecimal storeFactor = BigDecimal.<span xmlns="" class="perl_Function">valueOf</span>(<span xmlns="" class="perl_Float">100</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Override
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> set(String name, Object value, Document document, LuceneOptions luceneOptions) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> ( value != <span xmlns="" class="perl_Keyword">null</span> ) {
<span xmlns="" class="line">​</span>         BigDecimal decimalValue = (BigDecimal) value;
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_DataType">Long</span> indexedValue = <span xmlns="" class="perl_DataType">Long</span>.<span xmlns="" class="perl_Function">valueOf</span>( decimalValue.<span xmlns="" class="perl_Function">multiply</span>( storeFactor ).<span xmlns="" class="perl_Function">longValue</span>() );
<span xmlns="" class="line">​</span>         luceneOptions.<span xmlns="" class="perl_Function">addNumericFieldToDocument</span>( name, indexedValue, document );
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Override
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Object <span xmlns="" class="perl_Function">get</span>(String name, Document document) {
<span xmlns="" class="line">​</span>        String fromLucene = document.<span xmlns="" class="perl_Function">get</span>( name );
<span xmlns="" class="line">​</span>        BigDecimal storedBigDecimal = <span xmlns="" class="perl_Keyword">new</span> BigDecimal( fromLucene );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> storedBigDecimal.<span xmlns="" class="perl_Function">divide</span>( storeFactor );
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14284-748751+%5BLatest%5D&amp;comment=Title%3A+%40NumericField%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14284-748751+26+Mar+2015+00%3A28+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Id">
      ⁠</a>14.2.1.1.4. @Id</h4></div></div></div><div class="para">
		Finally, the <code class="literal">id</code> (identifier) property of an entity is a special property used by Hibernate Search to ensure index uniqueness of a given entity. By design, an <code class="literal">id</code> must be stored and must not be tokenized. To mark a property as an index identifier, use the <code class="literal">@DocumentId</code> annotation. If you are using JPA and you have specified <code class="classname">@Id</code> you can omit <code class="classname">@DocumentId</code>. The chosen entity identifier will also be used as the document identifier.
	</div><div class="example"><a id="example-annotated-entity">
      ⁠</a><p class="title"><strong>Example 14.10. Specifying indexed properties</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Essay {
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">Long</span> <span xmlns="" class="perl_Function">getId</span>() { <span xmlns="" class="perl_Keyword">return</span> id; }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Field</span>(name=<span xmlns="" class="perl_String">"Abstract"</span>, store=Store.<span xmlns="" class="perl_Function">YES</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSummary</span>() { <span xmlns="" class="perl_Keyword">return</span> summary; }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Lob
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getText</span>() { <span xmlns="" class="perl_Keyword">return</span> text; }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field @<span xmlns="" class="perl_Function">NumericField</span>( precisionStep = <span xmlns="" class="perl_Float">6</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">float</span> <span xmlns="" class="perl_Function">getGrade</span>() { <span xmlns="" class="perl_Keyword">return</span> grade; }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		<a class="xref" href="chap-Hibernate_Search.html#example-annotated-entity">Example 14.10, “Specifying indexed properties”</a> defines an index with four fields: <code class="literal">id</code> , <code class="literal">Abstract</code>, <code class="literal">text</code> and <code class="literal">grade</code> . Note that by default the field name is not capitalized, following the JavaBean specification. The <code class="literal">grade</code> field is annotated as numeric with a slightly larger precision step than the default.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14286-747435+%5BLatest%5D&amp;comment=Title%3A+%40Id%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14286-747435+16+Mar+2015+21%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Mapping_Properties_Multiple_Times">
      ⁠</a>14.2.1.2. Mapping Properties Multiple Times</h3></div></div></div><div class="para">
		Sometimes you need to map a property multiple times per index, with slightly different indexing strategies. For example, sorting a query by field requires the field to be un-analyzed. To search by words on this property and still sort it, it needs to be indexed - once analyzed and once un-analyzed. @Fields allows you to achieve this goal.
	</div><div class="example"><a id="example-fields-annotation">
      ⁠</a><p class="title"><strong>Example 14.11. Using @Fields to map a property multiple times</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Indexed</span>(index = <span xmlns="" class="perl_String">"Book"</span> )
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Book {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Fields</span>( {
<span xmlns="" class="line">​</span>            @Field,
<span xmlns="" class="line">​</span>            @<span xmlns="" class="perl_Function">Field</span>(name = <span xmlns="" class="perl_String">"summary_forSort"</span>, analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>, store = Store.<span xmlns="" class="perl_Function">YES</span>)
<span xmlns="" class="line">​</span>            } )
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSummary</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> summary;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		In this example the field <code class="literal">summary</code> is indexed twice, once as <code class="literal">summary</code> in a tokenized way, and once as <code class="literal">summary_forSort</code> in an untokenized way.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14278-748752+%5BLatest%5D&amp;comment=Title%3A+Mapping+Properties+Multiple+Times%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14278-748752+26+Mar+2015+00%3A33+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Embedded_and_Associated_Objects">
      ⁠</a>14.2.1.3. Embedded and Associated Objects</h3></div></div></div><div class="para">
		Associated objects as well as embedded objects can be indexed as part of the root entity index. This is useful if you expect to search a given entity based on properties of associated objects. In <a class="xref" href="chap-Hibernate_Search.html#example-indexing-associations">Example 14.12, “Indexing associations”</a> the aim is to return places where the associated city is Atlanta (In the Lucene query parser language, it would translate into <code class="code">address.city:Atlanta</code>). The place fields will be indexed in the <code class="literal">Place</code> index. The <code class="literal">Place</code> index documents will also contain the fields <code class="literal">address.id</code>, <code class="literal">address.street</code>, and <code class="literal">address.city</code> which you will be able to query.
	</div><div class="example"><a id="example-indexing-associations">
      ⁠</a><p class="title"><strong>Example 14.12. Indexing associations</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Place {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">OneToOne</span>( cascade = { CascadeType.<span xmlns="" class="perl_Function">PERSIST</span>, CascadeType.<span xmlns="" class="perl_Function">REMOVE</span> } )
<span xmlns="" class="line">​</span>    @IndexedEmbedded
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Address address;
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Address {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String street;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String city;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @ContainedIn
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">OneToMany</span>(mappedBy=<span xmlns="" class="perl_String">"address"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set&lt;Place&gt; places;
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Because the data is denormalized in the Lucene index when using the <code class="classname">@IndexedEmbedded</code> technique, Hibernate Search must be aware of any change in the <code class="classname">Place</code> object and any change in the <code class="classname">Address</code> object to keep the index up to date. To ensure the <code class="literal"><code class="classname">Place</code></code> Lucene document is updated when it's <code class="classname">Address</code> changes, mark the other side of the bidirectional relationship with <code class="classname">@ContainedIn</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			<code class="literal">@ContainedIn</code> is useful on both associations pointing to entities and on embedded (collection of) objects.
		</div></div></div><div class="para">
		To expand upon this, the following example demonstrates nesting @IndexedEmbedded.
	</div><div class="example"><a id="example-nested-index-embedded">
      ⁠</a><p class="title"><strong>Example 14.13. Nested usage of <code class="classname">@IndexedEmbedded</code> and <code class="classname">@ContainedIn</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Place {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">OneToOne</span>( cascade = { CascadeType.<span xmlns="" class="perl_Function">PERSIST</span>, CascadeType.<span xmlns="" class="perl_Function">REMOVE</span> } )
<span xmlns="" class="line">​</span>    @IndexedEmbedded
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Address address;
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Address {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String street;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String city;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">IndexedEmbedded</span>(depth = <span xmlns="" class="perl_Float">1</span>, prefix = <span xmlns="" class="perl_String">"ownedBy_"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Owner ownedBy;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @ContainedIn
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">OneToMany</span>(mappedBy=<span xmlns="" class="perl_String">"address"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set&lt;Place&gt; places;
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Embeddable
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Owner {
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Any <code class="literal">@*ToMany, @*ToOne</code> and <code class="literal">@Embedded</code> attribute can be annotated with <code class="literal">@IndexedEmbedded</code>. The attributes of the associated class will then be added to the main entity index. In <a class="xref" href="chap-Hibernate_Search.html#example-nested-index-embedded">Example 14.13, “Nested usage of <code class="classname">@IndexedEmbedded</code> and <code class="classname">@ContainedIn</code>”</a> the index will contain the following fields:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				id
			</div></li><li class="listitem"><div class="para">
				name
			</div></li><li class="listitem"><div class="para">
				address.street
			</div></li><li class="listitem"><div class="para">
				address.city
			</div></li><li class="listitem"><div class="para">
				address.ownedBy_name
			</div></li></ul></div><div class="para">
		The default prefix is <code class="literal">propertyName.</code>, following the traditional object navigation convention. You can override it using the <code class="literal">prefix</code> attribute as it is shown on the <code class="literal">ownedBy</code> property.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The prefix cannot be set to the empty string.
		</div></div></div><div class="para">
		The <code class="literal"> depth</code> property is necessary when the object graph contains a cyclic dependency of classes (not instances). For example, if <code class="classname">Owner</code> points to <code class="classname">Place</code>. Hibernate Search will stop including Indexed embedded attributes after reaching the expected depth (or the object graph boundaries are reached). A class having a self reference is an example of cyclic dependency. In our example, because <code class="literal">depth</code> is set to 1, any <code class="literal">@IndexedEmbedded</code> attribute in Owner (if any) will be ignored.
	</div><div class="para">
		Using <code class="literal">@IndexedEmbedded</code> for object associations allows you to express queries (using Lucene's query syntax) such as:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Return places where name contains JBoss and where address city is Atlanta. In Lucene query this would be
			</div><pre class="programlisting">+name:jboss +address.city:atlanta</pre></li><li class="listitem"><div class="para">
				Return places where name contains JBoss and where owner's name contain Joe. In Lucene query this would be
			</div><pre class="programlisting">+name:jboss +address.ownedBy_name:joe</pre></li></ul></div><div class="para">
		This behavior mimics the relational join operation in a more efficient way (at the cost of data duplication). Remember that, out of the box, Lucene indexes have no notion of association, the join operation does not exist. It might help to keep the relational model normalized while benefiting from the full text index speed and feature richness.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				An associated object can itself (but does not have to) be <code class="literal">@Indexed</code>
			</div></div></div>

	</div><div class="para">
		When @IndexedEmbedded points to an entity, the association has to be directional and the other side has to be annotated <code class="literal">@ContainedIn</code> (as seen in the previous example). If not, Hibernate Search has no way to update the root index when the associated entity is updated (in our example, a <code class="literal">Place</code> index document has to be updated when the associated <code class="classname">Address</code> instance is updated).
	</div><div class="para">
		Sometimes, the object type annotated by <code class="classname">@IndexedEmbedded</code> is not the object type targeted by Hibernate and Hibernate Search. This is especially the case when interfaces are used in lieu of their implementation. For this reason you can override the object type targeted by Hibernate Search using the <code class="methodname">targetElement</code> parameter.
	</div><div class="example"><a id="idm140550787733904">
      ⁠</a><p class="title"><strong>Example 14.14. Using the <code class="literal">targetElement</code> property of <code class="classname">@IndexedEmbedded</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Address {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String street;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">IndexedEmbedded</span>(depth = <span xmlns="" class="perl_Float">1</span>, prefix = <span xmlns="" class="perl_String">"ownedBy_"</span>, targetElement = Owner.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Target</span>(Owner.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Person ownedBy;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Embeddable
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Owner <span xmlns="" class="perl_Keyword">implements</span> Person { <span xmlns="" class="perl_Keyword">... </span>}</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14202-750418+%5BLatest%5D&amp;comment=Title%3A+Embedded+and+Associated+Objects%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14202-750418+10+Apr+2015+05%3A35+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Limiting_Object_Embedding_to_Specific_Paths">
      ⁠</a>14.2.1.4. Limiting Object Embedding to Specific Paths</h3></div></div></div><div class="para">
		The <code class="classname">@IndexedEmbedded</code> annotation provides also an attribute <code class="methodname">includePaths</code> which can be used as an alternative to <code class="methodname">depth</code>, or be combined with it.
	</div><div class="para">
		When using only <code class="methodname">depth</code> all indexed fields of the embedded type will be added recursively at the same depth. This makes it harder to select only a specific path without adding all other fields as well, which might not be needed.
	</div><div class="para">
		To avoid unnecessarily loading and indexing entities you can specify exactly which paths are needed. A typical application might need different depths for different paths, or in other words it might need to specify paths explicitly, as shown in <a class="xref" href="chap-Hibernate_Search.html#indexedembedded-includePath">Example 14.15, “Using the <code class="literal">includePaths</code> property of <code class="classname">@IndexedEmbedded</code>”</a>
	</div><div class="example"><a id="indexedembedded-includePath">
      ⁠</a><p class="title"><strong>Example 14.15. Using the <code class="literal">includePaths</code> property of <code class="classname">@IndexedEmbedded</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Person {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Id
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getId</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> id;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Field
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getName</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> name;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Field
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSurname</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> surname;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @OneToMany
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">IndexedEmbedded</span>(includePaths = { <span xmlns="" class="perl_String">"name"</span> })
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> Set&lt;Person&gt; <span xmlns="" class="perl_Function">getParents</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> parents;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @ContainedIn
<span xmlns="" class="line">​</span>   @ManyToOne
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> Human <span xmlns="" class="perl_Function">getChild</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> child;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ...<span xmlns="" class="perl_Comment">//other fields omitted</span></pre></div></div><div class="para">
		Using a mapping as in <a class="xref" href="chap-Hibernate_Search.html#indexedembedded-includePath">Example 14.15, “Using the <code class="literal">includePaths</code> property of <code class="classname">@IndexedEmbedded</code>”</a>, you would be able to search on a <code class="classname">Person</code> by <code class="literal">name</code> and/or <code class="literal">surname</code>, and/or the <code class="literal">name</code> of the parent. It will not index the <code class="literal">surname</code> of the parent, so searching on parent's surnames will not be possible but speeds up indexing, saves space and improve overall performance.
	</div><div class="para">
		The <code class="classname">@IndexedEmbedded</code><code class="methodname">includePaths</code> will include the specified paths <span class="emphasis"><em>in addition to</em></span> what you would index normally specifying a limited value for <code class="methodname">depth</code>. When using <code class="methodname">includePaths</code>, and leaving <code class="methodname">depth</code> undefined, behavior is equivalent to setting <code class="methodname">depth</code><code class="literal">=0</code>: only the included paths are indexed.
	</div><div class="example"><a id="indexedembedded-includePathsAndDepth">
      ⁠</a><p class="title"><strong>Example 14.16. Using the <code class="literal">includePaths</code> property of <code class="classname">@IndexedEmbedded</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Human {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Id
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getId</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> id;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Field
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getName</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> name;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Field
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSurname</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> surname;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @OneToMany
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">IndexedEmbedded</span>(depth = <span xmlns="" class="perl_Float">2</span>, includePaths = { <span xmlns="" class="perl_String">"parents.parents.name"</span> })
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> Set&lt;Human&gt; <span xmlns="" class="perl_Function">getParents</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> parents;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @ContainedIn
<span xmlns="" class="line">​</span>   @ManyToOne
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> Human <span xmlns="" class="perl_Function">getChild</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> child;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ...<span xmlns="" class="perl_Comment">//other fields omitted</span></pre></div></div><div class="para">
		In <a class="xref" href="chap-Hibernate_Search.html#indexedembedded-includePathsAndDepth">Example 14.16, “Using the <code class="literal">includePaths</code> property of <code class="classname">@IndexedEmbedded</code>”</a>, every human will have its name and surname attributes indexed. The name and surname of parents will also be indexed, recursively up to second line because of the <code class="methodname">depth</code> attribute. It will be possible to search by name or surname, of the person directly, his parents or of his grand parents. Beyond the second level, we will in addition index one more level but only the name, not the surname.
	</div><div class="para">
		This results in the following fields in the index:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">id</code> - as primary key
			</div></li><li class="listitem"><div class="para">
				<code class="literal">_hibernate_class</code> - stores entity type
			</div></li><li class="listitem"><div class="para">
				<code class="literal">name</code> - as direct field
			</div></li><li class="listitem"><div class="para">
				<code class="literal">surname</code> - as direct field
			</div></li><li class="listitem"><div class="para">
				<code class="literal">parents.name</code> - as embedded field at depth 1
			</div></li><li class="listitem"><div class="para">
				<code class="literal">parents.surname</code> - as embedded field at depth 1
			</div></li><li class="listitem"><div class="para">
				<code class="literal">parents.parents.name</code> - as embedded field at depth 2
			</div></li><li class="listitem"><div class="para">
				<code class="literal">parents.parents.surname</code> - as embedded field at depth 2
			</div></li><li class="listitem"><div class="para">
				<code class="literal">parents.parents.parents.name</code> - as additional path as specified by <code class="methodname">includePaths</code>. The first <code class="literal">parents.</code> is inferred from the field name, the remaining path is the attribute of <code class="methodname">includePaths</code>
			</div></li></ul></div><div class="para">
		Having explicit control of the indexed paths might be easier if you are designing your application by defining the needed queries first, as at that point you might know exactly which fields you need, and which other fields are unnecessary to implement your use case.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14290-748758+%5BLatest%5D&amp;comment=Title%3A+Limiting+Object+Embedding+to+Specific+Paths%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14290-748758+26+Mar+2015+00%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Boosting">
      ⁠</a>14.2.2. Boosting</h2></div></div></div><div class="para">
				Lucene has the notion of <span class="emphasis"><em>boosting</em></span> which allows you to give certain documents or fields more or less importance than others. Lucene differentiates between index and search time boosting. The following sections show you how you can achieve index time boosting using Hibernate Search.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14275-592110+%5BLatest%5D&amp;comment=Title%3A+Boosting%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Static_Index_Time_Boosting">
      ⁠</a>14.2.2.1. Static Index Time Boosting</h3></div></div></div><div class="para">
		To define a static boost value for an indexed class or property you can use the <code class="classname">@Boost</code> annotation. You can use this annotation within @Field or specify it directly on method or class level.
	</div><div class="example"><a id="example-boost">
      ⁠</a><p class="title"><strong>Example 14.17. Different ways of using @Boost</strong></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
<span class="bold bold"><strong>@Boost(1.7f)</strong></span>
public class Essay {
    ...

    @Id
    @DocumentId
    public Long getId() { return id; }

    @Field(name="Abstract", store=Store.YES, boost=<span class="bold bold"><strong>@Boost(2f)</strong></span>)
    <span class="bold bold"><strong>@Boost(1.5f)</strong></span>
    public String getSummary() { return summary; }

    @Lob
    @Field(boost=<span class="bold bold"><strong>@Boost(1.2f)</strong></span>)
    public String getText() { return text; }

    @Field
    public String getISBN() { return isbn; }

}</pre></div></div><div class="para">
		In <a class="xref" href="chap-Hibernate_Search.html#example-boost">Example 14.17, “Different ways of using @Boost”</a>, <code class="classname">Essay</code>'s probability to reach the top of the search list will be multiplied by 1.7. The <code class="methodname">summary</code> field will be 3.0 (2 * 1.5, because <code class="methodname">@Field.boost</code> and <code class="classname">@Boost</code> on a property are cumulative) more important than the <code class="methodname">isbn</code> field. The <code class="methodname">text</code> field will be 1.2 times more important than the <code class="methodname">isbn</code> field. Note that this explanation is wrong in strictest terms, but it is simple and close enough to reality for all practical purposes. 
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14203-592106+%5BLatest%5D&amp;comment=Title%3A+Static+Index+Time+Boosting%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14203-592106+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Dynamic_Index_Time_Boosting">
      ⁠</a>14.2.2.2. Dynamic Index Time Boosting</h3></div></div></div><div class="para">
		The <code class="literal">@Boost</code> annotation used in <a class="xref" href="chap-Hibernate_Search.html#Static_Index_Time_Boosting">Section 14.2.2.1, “Static Index Time Boosting”</a> defines a static boost factor which is independent of the state of the indexed entity at runtime. However, there are usecases in which the boost factor may depend on the actual state of the entity. In this case you can use the <code class="literal">@DynamicBoost</code> annotation together with an accompanying custom <code class="classname">BoostStrategy</code>.
	</div><div class="example"><a id="example-dynamic-boosting">
      ⁠</a><p class="title"><strong>Example 14.18. Dynamic boost example</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">enum</span> PersonType {
<span xmlns="" class="line">​</span>    NORMAL,
<span xmlns="" class="line">​</span>    VIP
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">DynamicBoost</span>(impl = VIPBoostStrategy.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Person {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> PersonType type;   
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// ....</span>
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> VIPBoostStrategy <span xmlns="" class="perl_Keyword">implements</span> BoostStrategy {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">float</span> <span xmlns="" class="perl_Function">defineBoost</span>(Object value) {
<span xmlns="" class="line">​</span>        Person person = ( Person ) value;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> ( person.<span xmlns="" class="perl_Function">getType</span>().<span xmlns="" class="perl_Function">equals</span>( PersonType.<span xmlns="" class="perl_Function">VIP</span> ) ) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Float">2.0f</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Float">1.0f</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		In <a class="xref" href="chap-Hibernate_Search.html#example-dynamic-boosting">Example 14.18, “Dynamic boost example”</a> a dynamic boost is defined on class level specifying <code class="classname">VIPBoostStrategy</code> as implementation of the <code class="classname">BoostStrategy</code> interface to be used at indexing time. You can place the <code class="literal">@DynamicBoost</code> either at class or field level. Depending on the placement of the annotation either the whole entity is passed to the <code class="methodname">defineBoost</code> method or just the annotated field/property value. It's up to you to cast the passed object to the correct type. In the example all indexed values of a VIP person would be double as important as the values of a normal person. 
		<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The specified <code class="classname">BoostStrategy</code> implementation must define a public no-arg constructor.
			</div></div></div>
		 Of course you can mix and match <code class="literal">@Boost</code> and <code class="literal">@DynamicBoost</code> annotations in your entity. All defined boost factors are cumulative.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14196-761327+%5BLatest%5D&amp;comment=Title%3A+Dynamic+Index+Time+Boosting%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14196-761327+11+Jun+2015+05%3A53+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Analysis">
      ⁠</a>14.2.3. Analysis</h2></div></div></div><div class="para">
				<code class="literal">Analysis</code> is the process of converting text into single terms (words) and can be considered as one of the key features of a full-text search engine. Lucene uses the concept of <code class="classname">Analyzer</code>s to control this process. In the following section we cover the multiple ways Hibernate Search offers to configure the analyzers.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14243-592107+%5BLatest%5D&amp;comment=Title%3A+Analysis%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Default_Analyzer_and_Analyzer_by_Class">
      ⁠</a>14.2.3.1. Default Analyzer and Analyzer by Class</h3></div></div></div><div class="para">
		The default analyzer class used to index tokenized fields is configurable through the <code class="literal">hibernate.search.analyzer</code> property. The default value for this property is <code class="classname">org.apache.lucene.analysis.standard.StandardAnalyzer</code>.
	</div><div class="para">
		You can also define the analyzer class per entity, property and even per @Field (useful when multiple fields are indexed from a single property).
	</div><div class="example"><a id="idm140550742111488">
      ⁠</a><p class="title"><strong>Example 14.19. Different ways of using @Analyzer</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Analyzer</span>(impl = EntityAnalyzer.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyEntity {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Analyzer</span>(impl = PropertyAnalyzer.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String summary;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Field</span>( analyzer = @<span xmlns="" class="perl_Function">Analyzer</span>(impl = FieldAnalyzer.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String body;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		In this example, <code class="classname">EntityAnalyzer</code> is used to index tokenized property (<code class="literal">name</code>), except <code class="literal">summary</code> and <code class="literal">body</code> which are indexed with <code class="classname">PropertyAnalyzer</code> and <code class="classname">FieldAnalyzer</code> respectively.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Mixing different analyzers in the same entity is most of the time a bad practice. It makes query building more complex and results less predictable (for the novice), especially if you are using a QueryParser (which uses the same analyzer for the whole query). As a rule of thumb, for any given field the same analyzer should be used for indexing and querying.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14259-750729+%5BLatest%5D&amp;comment=Title%3A+Default+Analyzer+and+Analyzer+by+Class%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14259-750729+14+Apr+2015+07%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Named_analyzers">
      ⁠</a>14.2.3.2. Named Analyzers</h3></div></div></div><div class="para">
		Analyzers can become quite complex to deal with. For this reason introduces Hibernate Search the notion of analyzer definitions. An analyzer definition can be reused by many <code class="classname">@Analyzer</code> declarations and is composed of:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				a name: the unique string used to refer to the definition
			</div></li><li class="listitem"><div class="para">
				a list of char filters: each char filter is responsible to pre-process input characters before the tokenization. Char filters can add, change, or remove characters; one common usage is for characters normalization
			</div></li><li class="listitem"><div class="para">
				a tokenizer: responsible for tokenizing the input stream into individual words
			</div></li><li class="listitem"><div class="para">
				a list of filters: each filter is responsible to remove, modify, or sometimes even add words into the stream provided by the tokenizer
			</div></li></ul></div><div class="para">
		This separation of tasks - a list of char filters, and a tokenizer followed by a list of filters - allows for easy reuse of each individual component and let you build your customized analyzer in a very flexible way (like Lego). Generally speaking the char filters do some pre-processing in the character input, then the <code class="classname">Tokenizer</code> starts the tokenizing process by turning the character input into tokens which are then further processed by the <code class="classname">TokenFilter</code>s. Hibernate Search supports this infrastructure by utilizing the Solr analyzer framework.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Some of the analyzers and filters will require additional dependencies. For example to use the snowball stemmer you have to also include the <code class="literal">lucene-snowball</code> jar and for the <code class="classname">PhoneticFilterFactory</code> you need the <a href="http://commons.apache.org/codec">commons-codec</a> jar. Your distribution of Hibernate Search provides these dependencies in its <code class="filename">lib/optional</code> directory. 
		</div><div class="para">
			When using Maven all required Solr dependencies are now defined as dependencies of the artifact <span class="emphasis"><em>org.hibernate:hibernate-search-analyzers</em></span>; add the following dependency : 
<pre class="programlisting">&lt;dependency&gt;
   &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
   &lt;artifactId&gt;hibernate-search-analyzers&lt;/artifactId&gt;
   &lt;version&gt;4.6.0.Final-redhat-2&lt;/version&gt;
   &lt;scope&gt;provided&lt;/scope&gt;
&lt;dependency&gt;</pre>

		</div></div></div><div class="para">
		Let's review a concrete example now - <a class="xref" href="chap-Hibernate_Search.html#example-analyzer-def">Example 14.20, “<code class="classname">@AnalyzerDef</code> and the Solr framework”</a>. First a char filter is defined by its factory. In our example, a mapping char filter is used, and will replace characters in the input based on the rules specified in the mapping file. Next a tokenizer is defined. This example uses the standard tokenizer. Last but not least, a list of filters is defined by their factories. In our example, the <code class="classname">StopFilter</code> filter is built reading the dedicated words property file. The filter is also expected to ignore case.
	</div><div class="example"><a id="example-analyzer-def">
      ⁠</a><p class="title"><strong>Example 14.20. <code class="classname">@AnalyzerDef</code> and the Solr framework</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">AnalyzerDef</span>(name=<span xmlns="" class="perl_String">"customanalyzer"</span>,
<span xmlns="" class="line">​</span>  charFilters = {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">CharFilterDef</span>(factory = MappingCharFilterFactory.<span xmlns="" class="perl_Function">class</span>, params = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name = <span xmlns="" class="perl_String">"mapping"</span>,
<span xmlns="" class="line">​</span>        value = <span xmlns="" class="perl_String">"org/hibernate/search/test/analyzer/solr/mapping-chars.properties"</span>)
<span xmlns="" class="line">​</span>    })
<span xmlns="" class="line">​</span>  },
<span xmlns="" class="line">​</span>  tokenizer = @<span xmlns="" class="perl_Function">TokenizerDef</span>(factory = StandardTokenizerFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>  filters = {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = ISOLatin1AccentFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = LowerCaseFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = StopFilterFactory.<span xmlns="" class="perl_Function">class</span>, params = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"words"</span>,
<span xmlns="" class="line">​</span>        value= <span xmlns="" class="perl_String">"org/hibernate/search/test/analyzer/solr/stoplist.properties"</span> ),
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"ignoreCase"</span>, value=<span xmlns="" class="perl_String">"true"</span>)
<span xmlns="" class="line">​</span>    })
<span xmlns="" class="line">​</span>})
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Team {
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Filters and char filters are applied in the order they are defined in the <code class="classname">@AnalyzerDef</code> annotation. Order matters!
		</div></div></div><div class="para">
		Some tokenizers, token filters or char filters load resources like a configuration or metadata file. This is the case for the stop filter and the synonym filter. If the resource charset is not using the VM default, you can explicitly specify it by adding a <code class="literal">resource_charset</code> parameter.
	</div><div class="example"><a id="example-analyzer-def-charset">
      ⁠</a><p class="title"><strong>Example 14.21. Use a specific charset to load the property file</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">AnalyzerDef</span>(name=<span xmlns="" class="perl_String">"customanalyzer"</span>,
<span xmlns="" class="line">​</span>  charFilters = {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">CharFilterDef</span>(factory = MappingCharFilterFactory.<span xmlns="" class="perl_Function">class</span>, params = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name = <span xmlns="" class="perl_String">"mapping"</span>,
<span xmlns="" class="line">​</span>        value = <span xmlns="" class="perl_String">"org/hibernate/search/test/analyzer/solr/mapping-chars.properties"</span>)
<span xmlns="" class="line">​</span>    })
<span xmlns="" class="line">​</span>  },
<span xmlns="" class="line">​</span>  tokenizer = @<span xmlns="" class="perl_Function">TokenizerDef</span>(factory = StandardTokenizerFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>  filters = {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = ISOLatin1AccentFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = LowerCaseFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = StopFilterFactory.<span xmlns="" class="perl_Function">class</span>, params = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"words"</span>,
<span xmlns="" class="line">​</span>        value= <span xmlns="" class="perl_String">"org/hibernate/search/test/analyzer/solr/stoplist.properties"</span> ),
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"resource_charset"</span>, value = <span xmlns="" class="perl_String">"UTF-16BE"</span>),
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"ignoreCase"</span>, value=<span xmlns="" class="perl_String">"true"</span>)
<span xmlns="" class="line">​</span>  })
<span xmlns="" class="line">​</span>})
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Team {
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Once defined, an analyzer definition can be reused by an <code class="classname">@Analyzer</code> declaration as seen in <a class="xref" href="chap-Hibernate_Search.html#example-referencing-analyzer-def">Example 14.22, “Referencing an analyzer by name”</a>.
	</div><div class="example"><a id="idm140550725547024">
      ⁠</a><p class="title"><strong>Example 14.22. Referencing an analyzer by name</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">AnalyzerDef</span>(name=<span xmlns="" class="perl_String">"customanalyzer"</span>, <span xmlns="" class="perl_Keyword">... </span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Team {
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String location;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field 
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Analyzer</span>(definition = <span xmlns="" class="perl_String">"customanalyzer"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String description;
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Analyzer instances declared by <code class="classname">@AnalyzerDef</code> are also available by their name in the <code class="classname">SearchFactory</code> which is quite useful when building queries.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Analyzer analyzer = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>().<span xmlns="" class="perl_Function">getAnalyzer</span>(<span xmlns="" class="perl_String">"customanalyzer"</span>);</pre><div class="para">
		Fields in queries must be analyzed with the same analyzer used to index the field so that they speak a common "language": the same tokens are reused between the query and the indexing process. This rule has some exceptions but is true most of the time. Respect it unless you know what you are doing.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14252-750252+%5BLatest%5D&amp;comment=Title%3A+Named+Analyzers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14252-750252+09+Apr+2015+03%3A47+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Available_Analyzers">
      ⁠</a>14.2.3.3. Available Analyzers</h3></div></div></div><div class="para">
		Solr and Lucene come with a lot of useful default char filters, tokenizers, and filters. You can find a complete list of char filter factories, tokenizer factories and filter factories at <a href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters</a>. Let's check a few of them.
	</div><div class="table"><a id="table-available-char-filters">
      ⁠</a><p class="title"><strong>Table 14.1. Example of available char filters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols lt-7-rows" summary="Example of available char filters"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="text-align: center"> Factory </th><th style="text-align: center"> Description </th><th style="text-align: center"> Parameters </th><th style="text-align: center"> Additional dependencies </th></tr></thead><tbody><tr><td> <code class="classname">MappingCharFilterFactory</code> </td><td> Replaces one or more characters with one or more characters, based on mappings specified in the resource file </td><td> <div class="para">
						<code class="literal">mapping</code>: points to a resource file containing the mappings using the format: 
<div class="literallayout"><p><br/>
                    "á" =&gt; "a"<br/>
                    "ñ" =&gt; "n"<br/>
                    "ø" =&gt; "o"<br/>
</p></div>

					</div>
					 </td><td> none </td></tr><tr><td> <code class="classname">HTMLStripCharFilterFactory</code> </td><td> Remove HTML standard tags, keeping the text </td><td> none </td><td> none </td></tr></tbody></table></div></div><div class="table"><a id="table-available-tokenizers">
      ⁠</a><p class="title"><strong>Table 14.2. Example of available tokenizers</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols lt-7-rows" summary="Example of available tokenizers"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="text-align: center"> Factory </th><th style="text-align: center"> Description </th><th style="text-align: center"> Parameters </th><th style="text-align: center"> Additional dependencies </th></tr></thead><tbody><tr><td> <code class="classname">StandardTokenizerFactory</code> </td><td> Use the Lucene StandardTokenizer </td><td> none </td><td> none </td></tr><tr><td> <code class="classname">HTMLStripCharFilterFactory</code> </td><td> Remove HTML tags, keep the text and pass it to a StandardTokenizer. </td><td> none </td><td> <code class="literal">solr-core</code> </td></tr><tr><td> <code class="classname">PatternTokenizerFactory</code> </td><td> Breaks text at the specified regular expression pattern. </td><td> <div class="para">
						<code class="literal">pattern</code>: the regular expression to use for tokenizing
					</div>
					 <div class="para">
						group: says which pattern group to extract into tokens
					</div>
					 </td><td> <code class="literal">solr-core</code> </td></tr></tbody></table></div></div><div class="table"><a id="table-available-filters">
      ⁠</a><p class="title"><strong>Table 14.3. Examples of available filters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols gt-7-rows" summary="Examples of available filters"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="text-align: center"> Factory </th><th style="text-align: center"> Description </th><th style="text-align: center"> Parameters </th><th style="text-align: center"> Additional dependencies </th></tr></thead><tbody><tr><td> <code class="classname">StandardFilterFactory</code> </td><td> Remove dots from acronyms and 's from words </td><td> none </td><td> <code class="literal">solr-core</code> </td></tr><tr><td> <code class="classname">LowerCaseFilterFactory</code> </td><td> Lowercases all words </td><td> none </td><td> <code class="literal">solr-core</code> </td></tr><tr><td> <code class="classname">StopFilterFactory</code> </td><td> Remove words (tokens) matching a list of stop words </td><td> <div class="para">
						<code class="literal">words</code>: points to a resource file containing the stop words
					</div>
					 <div class="para">
						ignoreCase: true if <code class="literal">case</code> should be ignored when comparing stop words, <code class="literal">false</code> otherwise
					</div>
					 </td><td> <code class="literal">solr-core</code> </td></tr><tr><td> <code class="classname">SnowballPorterFilterFactory</code> </td><td> Reduces a word to it's root in a given language. (example: protect, protects, protection share the same root). Using such a filter allows searches matching related words. </td><td> <code class="literal">language</code>: Danish, Dutch, English, Finnish, French, German, Italian, Norwegian, Portuguese, Russian, Spanish, Swedish and a few more </td><td> <code class="literal">solr-core</code> </td></tr><tr><td> <code class="classname">ISOLatin1AccentFilterFactory</code> </td><td> Remove accents for languages like French </td><td> none </td><td> <code class="literal">solr-core</code> </td></tr><tr><td> <code class="classname">PhoneticFilterFactory</code> </td><td> Inserts phonetically similar tokens into the token stream </td><td> <div class="para">
						<code class="literal">encoder</code>: One of DoubleMetaphone, Metaphone, Soundex or RefinedSoundex
					</div>
					 <div class="para">
						inject: <code class="constant">true</code> will add tokens to the stream, <code class="constant">false</code> will replace the existing token
					</div>
					 <div class="para">
						<code class="literal">maxCodeLength</code>: sets the maximum length of the code to be generated. Supported only for Metaphone and DoubleMetaphone encodings
					</div>
					 </td><td> <code class="literal">solr-core</code> and <code class="literal">commons-codec</code> </td></tr><tr><td> <code class="classname">CollationKeyFilterFactory</code> </td><td> Converts each token into its <code class="classname">java.text.CollationKey</code>, and then encodes the <code class="classname">CollationKey</code> with <code class="classname">IndexableBinaryStringTools</code>, to allow it to be stored as an index term. </td><td> <code class="literal">custom</code>, <code class="literal">language</code>, <code class="literal">country</code>, <code class="literal">variant</code>, <code class="literal">strength</code>, <code class="literal">decomposition</code> <div class="para">
						For more information, see Lucene's <code class="classname">CollationKeyFilter</code> javadocs
					</div>
					 </td><td> <code class="literal">solr-core</code> and <code class="literal">commons-io</code> </td></tr></tbody></table></div></div><div class="para">
		We recommend to check all the implementations of <code class="classname">org.apache.solr.analysis.TokenizerFactory</code> and <code class="classname">org.apache.solr.analysis.TokenFilterFactory</code> in your IDE to see the implementations available.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14291-759344+%5BLatest%5D&amp;comment=Title%3A+Available+Analyzers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14291-759344+26+May+2015+06%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Dynamic_analyzer_selection">
      ⁠</a>14.2.3.4. Dynamic Analyzer Selection</h3></div></div></div><div class="para">
		So far all the introduced ways to specify an analyzer were static. However, there are use cases where it is useful to select an analyzer depending on the current state of the entity to be indexed, for example in a multilingual applications. For an <code class="classname">BlogEntry</code> class for example the analyzer could depend on the language property of the entry. Depending on this property the correct language specific stemmer should be chosen to index the actual text.
	</div><div class="para">
		To enable this dynamic analyzer selection Hibernate Search introduces the <code class="classname">AnalyzerDiscriminator</code> annotation. <a class="xref" href="chap-Hibernate_Search.html#example-analyzer-discriminator">Example 14.23, “Usage of @AnalyzerDiscriminator”</a> demonstrates the usage of this annotation.
	</div><div class="example"><a id="example-analyzer-discriminator">
      ⁠</a><p class="title"><strong>Example 14.23. Usage of @AnalyzerDiscriminator</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">AnalyzerDefs</span>({
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">AnalyzerDef</span>(name = <span xmlns="" class="perl_String">"en"</span>,
<span xmlns="" class="line">​</span>    tokenizer = @<span xmlns="" class="perl_Function">TokenizerDef</span>(factory = StandardTokenizerFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    filters = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = LowerCaseFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = EnglishPorterFilterFactory.<span xmlns="" class="perl_Function">class</span>
<span xmlns="" class="line">​</span>      )
<span xmlns="" class="line">​</span>    }),
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">AnalyzerDef</span>(name = <span xmlns="" class="perl_String">"de"</span>,
<span xmlns="" class="line">​</span>    tokenizer = @<span xmlns="" class="perl_Function">TokenizerDef</span>(factory = StandardTokenizerFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    filters = {
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = LowerCaseFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>      @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = GermanStemFilterFactory.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>    })
<span xmlns="" class="line">​</span>})
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> BlogEntry {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Id
<span xmlns="" class="line">​</span>    @GeneratedValue
<span xmlns="" class="line">​</span>    @DocumentId
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">AnalyzerDiscriminator</span>(impl = LanguageDiscriminator.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String language;
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    @Field
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String text;
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set&lt;BlogEntry&gt; references;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// standard getter/setter</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}</pre><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> LanguageDiscriminator <span xmlns="" class="perl_Keyword">implements</span> Discriminator {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getAnalyzerDefinitionName</span>(Object value, Object entity, String field) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> ( value == <span xmlns="" class="perl_Keyword">null</span> || !( entity <span xmlns="" class="perl_Keyword">instanceof</span> BlogEntry ) ) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> (String) value;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		The prerequisite for using <code class="classname">@AnalyzerDiscriminator</code> is that all analyzers which are going to be used dynamically are predefined via <code class="classname">@AnalyzerDef</code> definitions. If this is the case, one can place the <code class="classname">@AnalyzerDiscriminator</code> annotation either on the class or on a specific property of the entity for which to dynamically select an analyzer. Via the <code class="literal">impl</code> parameter of the <code class="classname">AnalyzerDiscriminator</code> you specify a concrete implementation of the <code class="classname">Discriminator</code> interface. It is up to you to provide an implementation for this interface. The only method you have to implement is <code class="classname">getAnalyzerDefinitionName()</code> which gets called for each field added to the Lucene document. The entity which is getting indexed is also passed to the interface method. The <code class="literal">value</code> parameter is only set if the <code class="classname">AnalyzerDiscriminator</code> is placed on property level instead of class level. In this case the value represents the current value of this property.
	</div><div class="para">
		An implementation of the <code class="classname">Discriminator</code> interface has to return the name of an existing analyzer definition or <code class="classname">null</code> if the default analyzer should not be overridden. <a class="xref" href="chap-Hibernate_Search.html#example-analyzer-discriminator">Example 14.23, “Usage of @AnalyzerDiscriminator”</a> assumes that the language parameter is either 'de' or 'en' which matches the specified names in the <code class="classname">@AnalyzerDef</code>s.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14244-759341+%5BLatest%5D&amp;comment=Title%3A+Dynamic+Analyzer+Selection%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14244-759341+26+May+2015+03%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Retrieving_an_analyzer">
      ⁠</a>14.2.3.5. Retrieving an Analyzer</h3></div></div></div><div class="para">
		Retrieving an analyzer can be used when multiple analyzers have been used in a domain model, in order to benefit from stemming or phonetic approximation, etc. In this case, use the same analyzers to building a query. Alternatively, use the Hibernate Search query DSL, which selects the correct analyzer automatically. See <a class="xref" href="chap-Hibernate_Search.html#Building_a_Lucene_Query_with_the_Hibernate_Search_Query_DSL">Section 14.3.1.2, “Building a Lucene Query”</a>
	</div><div class="para">
		Whether you are using the Lucene programmatic API or the Lucene query parser, you can retrieve the scoped analyzer for a given entity. A scoped analyzer is an analyzer which applies the right analyzers depending on the field indexed. Remember, multiple analyzers can be defined on a given entity each one working on an individual field. A scoped analyzer unifies all these analyzers into a context-aware analyzer. While the theory seems a bit complex, using the right analyzer in a query is very easy.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			When you use programmatic mapping for a child entity, you can only see the fields defined by the child entity. Fields or methods inherited from a parent entity (annotated with @MappedSuperclass) are not configurable. To configure properties inherited from a parent entity, either override the property in the child entity or create a programmatic mapping for the parent entity. This mimics the usage of annotations where you cannot annotate a field or method of a parent entity unless it is redefined in the child entity.
		</div></div></div><div class="example"><a id="idm140550787241040">
      ⁠</a><p class="title"><strong>Example 14.24. Using the scoped analyzer when building a full-text query</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">queryParser</span>.<span xmlns="" class="perl_Function">QueryParser</span> parser = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">QueryParser</span>(
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_String">"title"</span>, 
<span xmlns="" class="line">​</span>    fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>().<span xmlns="" class="perl_Function">getAnalyzer</span>( Song.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> luceneQuery = 
<span xmlns="" class="line">​</span>    parser.<span xmlns="" class="perl_Function">parse</span>( <span xmlns="" class="perl_String">"title:sky Or title_stemmed:diamond"</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">Query</span> fullTextQuery = 
<span xmlns="" class="line">​</span>    fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Song.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>List result = fullTextQuery.<span xmlns="" class="perl_Function">list</span>(); <span xmlns="" class="perl_Comment">//return a list of managed objects</span></pre></div></div><div class="para">
		In the example above, the song title is indexed in two fields: the standard analyzer is used in the field <code class="literal">title</code> and a stemming analyzer is used in the field <code class="literal">title_stemmed</code>. By using the analyzer provided by the search factory, the query uses the appropriate analyzer depending on the field targeted.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			You can also retrieve analyzers defined via <code class="classname">@AnalyzerDef</code> by their definition name using <code class="code">searchFactory.getAnalyzer(String)</code>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14240-592107+%5BLatest%5D&amp;comment=Title%3A+Retrieving+an+Analyzer%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14240-592107+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Bridges">
      ⁠</a>14.2.4. Bridges</h2></div></div></div><div class="para">
				When discussing the basic mapping for an entity one important fact was so far disregarded. In Lucene all index fields have to be represented as strings. All entity properties annotated with <code class="literal">@Field</code> have to be converted to strings to be indexed. The reason we have not mentioned it so far is, that for most of your properties Hibernate Search does the translation job for you thanks to set of built-in bridges. However, in some cases you need a more fine grained control over the translation process.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14260-592108+%5BLatest%5D&amp;comment=Title%3A+Bridges%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Built-in_Bridges">
      ⁠</a>14.2.4.1. Built-in Bridges</h3></div></div></div><div class="para">
		Hibernate Search comes bundled with a set of built-in bridges between a Java property type and its full text representation.
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">null</span></dt><dd><div class="para">
					Per default <code class="constant">null</code> elements are not indexed. Lucene does not support null elements. However, in some situation it can be useful to insert a custom token representing the <code class="constant">null</code> value. See <a class="xref" href="chap-Hibernate_Search.html#Field">Section 14.2.1.1.2, “@Field”</a> for more information.
				</div></dd><dt><span class="term">java.lang.String</span></dt><dd><div class="para">
					Strings are indexed as are
				</div></dd><dt><span class="term">short, Short, integer, Integer, long, Long, float, Float, double, Double, BigInteger, BigDecimal</span></dt><dd><div class="para">
					Numbers are converted into their string representation. Note that numbers cannot be compared by Lucene (that is, used in ranged queries) out of the box: they have to be padded. 
					<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Using a Range query has drawbacks, an alternative approach is to use a Filter query which will filter the result query to the appropriate range.
						</div><div class="para">
							Hibernate Search also supports the use of a custom StringBridge as described in <a class="xref" href="chap-Hibernate_Search.html#sect-Custom_Bridges">Section 14.2.4.2, “Custom Bridges”</a>.
						</div></div></div>

				</div></dd><dt><span class="term">java.util.Date</span></dt><dd><div class="para">
					Dates are stored as yyyyMMddHHmmssSSS in GMT time (200611072203012 for Nov 7th of 2006 4:03PM and 12ms EST). You shouldn't really bother with the internal format. What is important is that when using a TermRangeQuery, you should know that the dates have to be expressed in GMT time.
				</div><div class="para">
					Usually, storing the date up to the millisecond is not necessary. <code class="literal">@DateBridge</code> defines the appropriate resolution you are willing to store in the index (<code class="literal">@DateBridge(resolution=Resolution.DAY)</code>). The date pattern will then be truncated accordingly.
				</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity 
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Meeting {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Field</span>(analyze=Analyze.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">DateBridge</span>(resolution=Resolution.<span xmlns="" class="perl_Function">MINUTE</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Date date;
<span xmlns="" class="line">​</span>    ...</pre><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
						A Date whose resolution is lower than <code class="literal">MILLISECOND</code> cannot be a <code class="literal">@DocumentId</code>.
					</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						The default <code class="classname">Date</code> bridge uses Lucene's <code class="classname">DateTools</code> to convert from and to <code class="classname">String</code>. This means that all dates are expressed in GMT time. If your requirements are to store dates in a fixed time zone you have to implement a custom date bridge. Make sure you understand the requirements of your applications regarding to date indexing and searching.
					</div></div></div></dd><dt><span class="term">java.net.URI, java.net.URL</span></dt><dd><div class="para">
					URI and URL are converted to their string representation.
				</div></dd><dt><span class="term">java.lang.Class</span></dt><dd><div class="para">
					Class are converted to their fully qualified class name. The thread context class loader is used when the class is rehydrated.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14232-764999+%5BLatest%5D&amp;comment=Title%3A+Built-in+Bridges%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14232-764999+14+Jul+2015+11%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-Custom_Bridges">
      ⁠</a>14.2.4.2. Custom Bridges</h3></div></div></div><div class="para">
					Sometimes, the built-in bridges of Hibernate Search do not cover some of your property types, or the String representation used by the bridge does not meet your requirements. The following paragraphs describe several solutions to this problem.
				</div><div class="para RoleCreateBugPara">
					<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14191-592106+%5BLatest%5D&amp;comment=Title%3A+Custom+Bridges%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
				</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="StringBridge">
      ⁠</a>14.2.4.2.1. StringBridge</h4></div></div></div><div class="para">
		The simplest custom solution is to give Hibernate Search an implementation of your expected <code class="classname">Object</code> to <code class="classname">String</code> bridge. To do so you need to implement the <code class="literal">org.hibernate.search.bridge.StringBridge</code> interface. All implementations have to be thread-safe as they are used concurrently.
	</div><div class="example"><a id="example-custom-string-bridge">
      ⁠</a><p class="title"><strong>Example 14.25. Custom <code class="classname">StringBridge</code> implementation</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Padding Integer bridge.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * All numbers will be padded with 0 to match 5 digits</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author </span><span xmlns="" class="perl_Comment">Emmanuel Bernard</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PaddedIntegerBridge <span xmlns="" class="perl_Keyword">implements</span> StringBridge {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> PADDING = <span xmlns="" class="perl_Float">5</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">objectToString</span>(Object object) {
<span xmlns="" class="line">​</span>        String rawInteger = ( (Integer) object ).<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (rawInteger.<span xmlns="" class="perl_Function">length</span>() &gt; PADDING) 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalArgumentException( <span xmlns="" class="perl_String">"Try to pad on a number too big"</span> );
<span xmlns="" class="line">​</span>        StringBuilder paddedInteger = <span xmlns="" class="perl_Keyword">new</span> StringBuilder( );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">for</span> ( <span xmlns="" class="perl_DataType">int</span> padIndex = rawInteger.<span xmlns="" class="perl_Function">length</span>() ; padIndex &lt; PADDING ; padIndex++ ) {
<span xmlns="" class="line">​</span>            paddedInteger.<span xmlns="" class="perl_Function">append</span>(<span xmlns="" class="perl_Char">'0'</span>);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> paddedInteger.<span xmlns="" class="perl_Function">append</span>( rawInteger ).<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Given the string bridge defined in <a class="xref" href="chap-Hibernate_Search.html#example-custom-string-bridge">Example 14.25, “Custom <code class="classname">StringBridge</code> implementation”</a>, any property or field can use this bridge thanks to the <code class="literal">@FieldBridge</code> annotation:
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">FieldBridge</span>(impl = PaddedIntegerBridge.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Integer length;</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14297-592111+%5BLatest%5D&amp;comment=Title%3A+StringBridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14297-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Parameterized_Bridge">
      ⁠</a>14.2.4.2.2. Parameterized Bridge</h4></div></div></div><div class="para">
		Parameters can also be passed to the bridge implementation making it more flexible. <a class="xref" href="chap-Hibernate_Search.html#example-passing-bridge-paremters">Example 14.26, “Passing parameters to your bridge implementation”</a> implements a <code class="classname">ParameterizedBridge</code> interface and parameters are passed through the <code class="literal">@FieldBridge</code> annotation.
	</div><div class="example"><a id="example-passing-bridge-paremters">
      ⁠</a><p class="title"><strong>Example 14.26. Passing parameters to your bridge implementation</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PaddedIntegerBridge <span xmlns="" class="perl_Keyword">implements</span> StringBridge, ParameterizedBridge {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> String PADDING_PROPERTY = <span xmlns="" class="perl_String">"padding"</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> padding = <span xmlns="" class="perl_Float">5</span>; <span xmlns="" class="perl_Comment">//default</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setParameterValues</span>(Map&lt;String,String&gt; parameters) {
<span xmlns="" class="line">​</span>        String padding = parameters.<span xmlns="" class="perl_Function">get</span>( PADDING_PROPERTY );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (padding != <span xmlns="" class="perl_Keyword">null</span>) <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">padding</span> = Integer.<span xmlns="" class="perl_Function">parseInt</span>( padding );
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">objectToString</span>(Object object) {
<span xmlns="" class="line">​</span>        String rawInteger = ( (Integer) object ).<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (rawInteger.<span xmlns="" class="perl_Function">length</span>() &gt; padding) 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalArgumentException( <span xmlns="" class="perl_String">"Try to pad on a number too big"</span> );
<span xmlns="" class="line">​</span>        StringBuilder paddedInteger = <span xmlns="" class="perl_Keyword">new</span> StringBuilder( );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">for</span> ( <span xmlns="" class="perl_DataType">int</span> padIndex = rawInteger.<span xmlns="" class="perl_Function">length</span>() ; padIndex &lt; padding ; padIndex++ ) {
<span xmlns="" class="line">​</span>            paddedInteger.<span xmlns="" class="perl_Function">append</span>(<span xmlns="" class="perl_Char">'0'</span>);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> paddedInteger.<span xmlns="" class="perl_Function">append</span>( rawInteger ).<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//property</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">FieldBridge</span>(impl = PaddedIntegerBridge.<span xmlns="" class="perl_Function">class</span>,
<span xmlns="" class="line">​</span>             params = @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"padding"</span>, value=<span xmlns="" class="perl_String">"10"</span>)
<span xmlns="" class="line">​</span>            )
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Integer length;</pre></div></div><div class="para">
		The <code class="classname">ParameterizedBridge</code> interface can be implemented by <code class="classname">StringBridge</code>, <code class="classname">TwoWayStringBridge</code>, <code class="classname">FieldBridge</code> implementations.
	</div><div class="para">
		All implementations have to be thread-safe, but the parameters are set during initialization and no special care is required at this stage.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14294-592111+%5BLatest%5D&amp;comment=Title%3A+Parameterized+Bridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14294-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Type_Aware_Bridge">
      ⁠</a>14.2.4.2.3. Type Aware Bridge</h4></div></div></div><div class="para">
		It is sometimes useful to get the type the bridge is applied on:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				the return type of the property for field/getter-level bridges.
			</div></li><li class="listitem"><div class="para">
				the class type for class-level bridges.
			</div></li></ul></div><div class="para">
		An example is a bridge that deals with enums in a custom fashion but needs to access the actual enum type. Any bridge implementing <code class="classname">AppliedOnTypeAwareBridge</code> will get the type the bridge is applied on injected. Like parameters, the type injected needs no particular care with regard to thread-safety.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14296-592111+%5BLatest%5D&amp;comment=Title%3A+Type+Aware+Bridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14296-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Two-Way_Bridge">
      ⁠</a>14.2.4.2.4. Two-Way Bridge</h4></div></div></div><div class="para">
		If you expect to use your bridge implementation on an id property (that is, annotated with <code class="literal">@DocumentId</code> ), you need to use a slightly extended version of <code class="literal">StringBridge</code> named <code class="classname">TwoWayStringBridge</code>. Hibernate Search needs to read the string representation of the identifier and generate the object out of it. There is no difference in the way the <code class="literal">@FieldBridge</code> annotation is used.
	</div><div class="example"><a id="idm140550798073504">
      ⁠</a><p class="title"><strong>Example 14.27. Implementing a TwoWayStringBridge usable for id properties</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PaddedIntegerBridge <span xmlns="" class="perl_Keyword">implements</span> TwoWayStringBridge, ParameterizedBridge {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> String PADDING_PROPERTY = <span xmlns="" class="perl_String">"padding"</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> padding = <span xmlns="" class="perl_Float">5</span>; <span xmlns="" class="perl_Comment">//default</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setParameterValues</span>(Map parameters) {
<span xmlns="" class="line">​</span>        Object padding = parameters.<span xmlns="" class="perl_Function">get</span>( PADDING_PROPERTY );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (padding != <span xmlns="" class="perl_Keyword">null</span>) <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">padding</span> = (Integer) padding;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">objectToString</span>(Object object) {
<span xmlns="" class="line">​</span>        String rawInteger = ( (Integer) object ).<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (rawInteger.<span xmlns="" class="perl_Function">length</span>() &gt; padding) 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalArgumentException( <span xmlns="" class="perl_String">"Try to pad on a number too big"</span> );
<span xmlns="" class="line">​</span>        StringBuilder paddedInteger = <span xmlns="" class="perl_Keyword">new</span> StringBuilder( );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">for</span> ( <span xmlns="" class="perl_DataType">int</span> padIndex = rawInteger.<span xmlns="" class="perl_Function">length</span>() ; padIndex &lt; padding ; padIndex++ ) {
<span xmlns="" class="line">​</span>            paddedInteger.<span xmlns="" class="perl_Function">append</span>(<span xmlns="" class="perl_Char">'0'</span>);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> paddedInteger.<span xmlns="" class="perl_Function">append</span>( rawInteger ).<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Object <span xmlns="" class="perl_Function">stringToObject</span>(String stringValue) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> Integer(stringValue);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//id property</span>
<span xmlns="" class="line">​</span>@DocumentId
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">FieldBridge</span>(impl = PaddedIntegerBridge.<span xmlns="" class="perl_Function">class</span>,
<span xmlns="" class="line">​</span>             params = @<span xmlns="" class="perl_Function">Parameter</span>(name=<span xmlns="" class="perl_String">"padding"</span>, value=<span xmlns="" class="perl_String">"10"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Integer id;
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			It is important for the two-way process to be idempotent (ie object = stringToObject( objectToString( object ) ) ).
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14293-592111+%5BLatest%5D&amp;comment=Title%3A+Two-Way+Bridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14293-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="FieldBridge">
      ⁠</a>14.2.4.2.5. FieldBridge</h4></div></div></div><div class="para">
		Some use cases require more than a simple object to string translation when mapping a property to a Lucene index. To give you the greatest possible flexibility you can also implement a bridge as a <code class="classname">FieldBridge</code>. This interface gives you a property value and let you map it the way you want in your Lucene <code class="classname">Document</code>. You can for example store a property in two different document fields. The interface is very similar in its concept to the Hibernate <code class="classname">UserType</code>s.
	</div><div class="example"><a id="example-field-bridge">
      ⁠</a><p class="title"><strong>Example 14.28. Implementing the FieldBridge Interface</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Store the date in 3 different fields - year, month, day - to ease Range Query per</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * year, month or day (eg get all the elements of December for the last 5 years).</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author </span><span xmlns="" class="perl_Comment">Emmanuel Bernard</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> DateSplitBridge <span xmlns="" class="perl_Keyword">implements</span> FieldBridge {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">final</span> <span xmlns="" class="perl_DataType">static</span> TimeZone GMT = TimeZone.<span xmlns="" class="perl_Function">getTimeZone</span>(<span xmlns="" class="perl_String">"GMT"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> set(String name, Object value, Document document, LuceneOptions luceneOptions) {
<span xmlns="" class="line">​</span>        Date date = (Date) value;
<span xmlns="" class="line">​</span>        Calendar cal = GregorianCalendar.<span xmlns="" class="perl_Function">getInstance</span>(GMT);
<span xmlns="" class="line">​</span>        cal.<span xmlns="" class="perl_Function">setTime</span>(date);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">int</span> year = cal.<span xmlns="" class="perl_Function">get</span>(Calendar.<span xmlns="" class="perl_Function">YEAR</span>);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">int</span> month = cal.<span xmlns="" class="perl_Function">get</span>(Calendar.<span xmlns="" class="perl_Function">MONTH</span>) + <span xmlns="" class="perl_Float">1</span>;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">int</span> day = cal.<span xmlns="" class="perl_Function">get</span>(Calendar.<span xmlns="" class="perl_Function">DAY_OF_MONTH</span>);
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// set year</span>
<span xmlns="" class="line">​</span>        luceneOptions.<span xmlns="" class="perl_Function">addFieldToDocument</span>(
<span xmlns="" class="line">​</span>            name + <span xmlns="" class="perl_String">".year"</span>,
<span xmlns="" class="line">​</span>            String.<span xmlns="" class="perl_Function">valueOf</span>( year ),
<span xmlns="" class="line">​</span>            document );
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// set month and pad it if needed</span>
<span xmlns="" class="line">​</span>        luceneOptions.<span xmlns="" class="perl_Function">addFieldToDocument</span>(
<span xmlns="" class="line">​</span>            name + <span xmlns="" class="perl_String">".month"</span>,
<span xmlns="" class="line">​</span>            month &lt; <span xmlns="" class="perl_Float">10</span> ? <span xmlns="" class="perl_String">"0"</span> : <span xmlns="" class="perl_String">""</span> + String.<span xmlns="" class="perl_Function">valueOf</span>( month ),
<span xmlns="" class="line">​</span>            document );
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// set day and pad it if needed</span>
<span xmlns="" class="line">​</span>        luceneOptions.<span xmlns="" class="perl_Function">addFieldToDocument</span>(
<span xmlns="" class="line">​</span>            name + <span xmlns="" class="perl_String">".day"</span>,
<span xmlns="" class="line">​</span>            day &lt; <span xmlns="" class="perl_Float">10</span> ? <span xmlns="" class="perl_String">"0"</span> : <span xmlns="" class="perl_String">""</span> + String.<span xmlns="" class="perl_Function">valueOf</span>( day ),
<span xmlns="" class="line">​</span>            document );
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//property</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">FieldBridge</span>(impl = DateSplitBridge.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Date date;</pre></div></div><div class="para">
		In <a class="xref" href="chap-Hibernate_Search.html#example-field-bridge">Example 14.28, “Implementing the FieldBridge Interface”</a> the fields are not added directly to Document. Instead the addition is delegated to the <code class="classname">LuceneOptions</code> helper; this helper will apply the options you have selected on <code class="literal">@Field</code>, like <code class="literal">Store</code> or <code class="literal">TermVector</code>, or apply the choosen <code class="classname">@Boost</code> value. It is especially useful to encapsulate the complexity of <code class="literal">COMPRESS</code> implementations. Even though it is recommended to delegate to <code class="classname">LuceneOptions</code> to add fields to the <code class="classname">Document</code>, nothing stops you from editing the <code class="classname">Document</code> directly and ignore the <code class="classname">LuceneOptions</code> in case you need to.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Classes like <code class="classname">LuceneOptions</code> are created to shield your application from changes in Lucene API and simplify your code. Use them if you can, but if you need more flexibility you're not required to.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14292-592111+%5BLatest%5D&amp;comment=Title%3A+FieldBridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14292-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ClassBridge">
      ⁠</a>14.2.4.2.6. ClassBridge</h4></div></div></div><div class="para">
		It is sometimes useful to combine more than one property of a given entity and index this combination in a specific way into the Lucene index. The <code class="classname">@ClassBridge</code> and <code class="classname">@ClassBridges</code> annotations can be defined at the class level, as opposed to the property level. In this case the custom field bridge implementation receives the entity instance as the value parameter instead of a particular property. Though not shown in <a class="xref" href="chap-Hibernate_Search.html#example-class-bridge">Example 14.29, “Implementing a class bridge”</a>, <code class="classname">@ClassBridge</code> supports the <code class="methodname">termVector</code> attribute discussed in section <a class="xref" href="chap-Hibernate_Search.html#sect-Basic_Mapping">Section 14.2.1.1, “Basic Mapping”</a>.
	</div><div class="example"><a id="example-class-bridge">
      ⁠</a><p class="title"><strong>Example 14.29. Implementing a class bridge</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ClassBridge</span>(name=<span xmlns="" class="perl_String">"branchnetwork"</span>,
<span xmlns="" class="line">​</span>             store=Store.<span xmlns="" class="perl_Function">YES</span>,
<span xmlns="" class="line">​</span>             impl = CatFieldsClassBridge.<span xmlns="" class="perl_Function">class</span>,
<span xmlns="" class="line">​</span>             params = @<span xmlns="" class="perl_Function">Parameter</span>( name=<span xmlns="" class="perl_String">"sepChar"</span>, value=<span xmlns="" class="perl_String">" "</span> ) )
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Department {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> id;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String network;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String branchHead;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String branch;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Integer maxEmployees
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> CatFieldsClassBridge <span xmlns="" class="perl_Keyword">implements</span> FieldBridge, ParameterizedBridge {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String sepChar;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setParameterValues</span>(Map parameters) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sepChar</span> = (String) parameters.<span xmlns="" class="perl_Function">get</span>( <span xmlns="" class="perl_String">"sepChar"</span> );
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> set( String name, Object value, Document document, LuceneOptions luceneOptions) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// In this particular class the name of the new field was passed</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// from the name field of the ClassBridge Annotation. This is not</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// a requirement. It just works that way in this instance. The</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// actual name could be supplied by hard coding it below.</span>
<span xmlns="" class="line">​</span>        Department dep = (Department) value;
<span xmlns="" class="line">​</span>        String fieldValue1 = dep.<span xmlns="" class="perl_Function">getBranch</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> ( fieldValue1 == <span xmlns="" class="perl_Keyword">null</span> ) {
<span xmlns="" class="line">​</span>            fieldValue1 = <span xmlns="" class="perl_String">""</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        String fieldValue2 = dep.<span xmlns="" class="perl_Function">getNetwork</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> ( fieldValue2 == <span xmlns="" class="perl_Keyword">null</span> ) {
<span xmlns="" class="line">​</span>            fieldValue2 = <span xmlns="" class="perl_String">""</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        String fieldValue = fieldValue1 + sepChar + fieldValue2;
<span xmlns="" class="line">​</span>        Field field = <span xmlns="" class="perl_Keyword">new</span> Field( name, fieldValue, luceneOptions.<span xmlns="" class="perl_Function">getStore</span>(),
<span xmlns="" class="line">​</span>            luceneOptions.<span xmlns="" class="perl_Function">getIndex</span>(), luceneOptions.<span xmlns="" class="perl_Function">getTermVector</span>() );
<span xmlns="" class="line">​</span>        field.<span xmlns="" class="perl_Function">setBoost</span>( luceneOptions.<span xmlns="" class="perl_Function">getBoost</span>() );
<span xmlns="" class="line">​</span>        document.<span xmlns="" class="perl_Function">add</span>( field );
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		In this example, the particular <code class="classname">CatFieldsClassBridge</code> is applied to the <code class="literal">department</code> instance, the field bridge then concatenate both branch and network and index the concatenation.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14295-781575+%5BLatest%5D&amp;comment=Title%3A+ClassBridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14295-781575+15+Nov+2017+14%3A44+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Querying">
      ⁠</a>14.3. Querying</h1></div></div></div><div class="para">
			<span class="phrase">Hibernate Search</span> can execute Lucene queries and retrieve domain objects managed by an <span class="phrase">Hibernate</span> session. The search provides the power of Lucene without leaving the Hibernate paradigm, giving another dimension to the Hibernate classic search mechanisms (HQL, Criteria query, native SQL query).
		</div><div class="para">
			Preparing and executing a query consists of following four steps:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Creating a <code class="classname">FullTextSession</code>
				</div></li><li class="listitem"><div class="para">
					Creating a Lucene query using either <span class="phrase">Hibernate Search</span> query DSL (recommended) or using the Lucene Query API
				</div></li><li class="listitem"><div class="para">
					Wrapping the Lucene query using an <code class="classname">org.hibernate.Query</code>
				</div></li><li class="listitem"><div class="para">
					Executing the search by calling for example <code class="methodname">list()</code> or <code class="methodname">scroll()</code>
				</div></li></ul></div><div class="para">
			To access the querying facilities, use a <code class="classname">FullTextSession</code>. This Search specific session wraps a regular <code class="classname">org.hibernate.Session</code> in order to provide query and indexing capabilities.
		</div><div class="example"><a id="idm140550744068496">
      ⁠</a><p class="title"><strong>Example 14.30. Creating a FullTextSession</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>Session session = sessionFactory.<span xmlns="" class="perl_Function">openSession</span>();
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(session);</pre></div></div><div class="para">
			Use the <code class="classname">FullTextSession</code> to build a full-text query using either the <span class="phrase">Hibernate Search</span> query DSL or the native Lucene query.
		</div><div class="para">
			Use the following code when using the <span class="phrase">Hibernate Search</span> query DSL:
		</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">final</span> QueryBuilder b = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>().<span xmlns="" class="perl_Function">buildQueryBuilder</span>().<span xmlns="" class="perl_Function">forEntity</span>( Myth.<span xmlns="" class="perl_Function">class</span> ).<span xmlns="" class="perl_Function">get</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> luceneQuery =
<span xmlns="" class="line">​</span>    b.<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>).<span xmlns="" class="perl_Function">boostedTo</span>(<span xmlns="" class="perl_Float">3</span>)
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"storm"</span>)
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">createQuery</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">Query</span> fullTextQuery = fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery );
<span xmlns="" class="line">​</span>List result = fullTextQuery.<span xmlns="" class="perl_Function">list</span>(); <span xmlns="" class="perl_Comment">//return a list of managed objects</span>
</pre><div class="para">
			As an alternative, write the Lucene query using either the Lucene query parser or the Lucene programmatic API.
		</div><div class="example"><a id="idm140550794040976">
      ⁠</a><p class="title"><strong>Example 14.31. Creating a Lucene query via the <code class="classname">QueryParser</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>SearchFactory searchFactory = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>();
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">queryParser</span>.<span xmlns="" class="perl_Function">QueryParser</span> parser = 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">QueryParser</span>(<span xmlns="" class="perl_String">"title"</span>, searchFactory.<span xmlns="" class="perl_Function">getAnalyzer</span>(Myth.<span xmlns="" class="perl_Function">class</span>) );
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> luceneQuery = parser.<span xmlns="" class="perl_Function">parse</span>( <span xmlns="" class="perl_String">"history:storm^3"</span> );
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">catch</span> (ParseException e) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">//handle parsing failure</span>
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">Query</span> fullTextQuery = fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>(luceneQuery);
<span xmlns="" class="line">​</span>List result = fullTextQuery.<span xmlns="" class="perl_Function">list</span>(); <span xmlns="" class="perl_Comment">//return a list of managed objects</span>
</pre></div></div><div class="para">
			A Hibernate query built on the Lucene query is a <code class="classname">org.hibernate.Query</code>. This query remains in the same paradigm as other Hibernate query facilities, such as HQL (Hibernate Query Language), Native, and Criteria. Use methods such as <code class="classname">list()</code>, <code class="classname">uniqueResult()</code>, <code class="classname">iterate()</code> and <code class="classname">scroll()</code> with the query.
		</div><div class="para">
			The same extensions are available with the Hibernate Java Persistence APIs:
		</div><div class="example"><a id="idm140550769683296">
      ⁠</a><p class="title"><strong>Example 14.32. Creating a Search query using the JPA API</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>EntityManager em = entityManagerFactory.<span xmlns="" class="perl_Function">createEntityManager</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>FullTextEntityManager fullTextEntityManager = 
<span xmlns="" class="line">​</span>    org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">jpa</span>.<span xmlns="" class="perl_Function">Search</span>.<span xmlns="" class="perl_Function">getFullTextEntityManager</span>(em);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">final</span> QueryBuilder b = fullTextEntityManager.<span xmlns="" class="perl_Function">getSearchFactory</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">buildQueryBuilder</span>().<span xmlns="" class="perl_Function">forEntity</span>( Myth.<span xmlns="" class="perl_Function">class</span> ).<span xmlns="" class="perl_Function">get</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> luceneQuery =
<span xmlns="" class="line">​</span>    b.<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>).<span xmlns="" class="perl_Function">boostedTo</span>(<span xmlns="" class="perl_Float">3</span>)
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"storm"</span>)
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">createQuery</span>();
<span xmlns="" class="line">​</span>javax.<span xmlns="" class="perl_Function">persistence</span>.<span xmlns="" class="perl_Function">Query</span> fullTextQuery = fullTextEntityManager.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>List result = fullTextQuery.<span xmlns="" class="perl_Function">getResultList</span>(); <span xmlns="" class="perl_Comment">//return a list of managed objects</span></pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				In these examples, the Hibernate API has been used. The same examples can also be written with the Java Persistence API by adjusting the way the <code class="classname">FullTextQuery</code> is retrieved.
			</div></div></div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14227-781573+%5BLatest%5D&amp;comment=Title%3A+Querying%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Building_Queries">
      ⁠</a>14.3.1. Building Queries</h2></div></div></div><div class="para">
				Hibernate Search queries are built on Lucene queries, allowing users to use any Lucene query type. When the query is built, Hibernate Search uses org.hibernate.Query as the query manipulation API for further query processing.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14256-592108+%5BLatest%5D&amp;comment=Title%3A+Building+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Building_a_Lucene_Query_Using_the_Lucene_API">
      ⁠</a>14.3.1.1. Building a Lucene Query Using the Lucene API</h3></div></div></div><div class="para">
		With the Lucene API, use either the query parser (simple queries) or the Lucene programmatic API (complex queries). <span class="phrase">Building a Lucene query is out of scope for the Hibernate Search documentation.</span> For details, see the online Lucene documentation or a copy of <em class="citetitle">Lucene in Action</em> or <em class="citetitle">Hibernate Search in Action</em>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14236-592107+%5BLatest%5D&amp;comment=Title%3A+Building+a+Lucene+Query+Using+the+Lucene+API%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14236-592107+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Building_a_Lucene_Query_with_the_Hibernate_Search_Query_DSL">
      ⁠</a>14.3.1.2. Building a Lucene Query</h3></div></div></div><div class="para">
		The Lucene programmatic API enables full-text queries. However, when using the Lucene programmatic API, the parameters must be converted to their string equivalent and must also apply the correct analyzer to the right field. A ngram analyzer for example uses several ngrams as the tokens for a given word and should be searched as such. It is recommended to use the <code class="classname">QueryBuilder</code> for this task.
	</div><div class="para">
		The Hibernate Search query API is fluent, with the following key characteristics:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Method names are in English. As a result, API operations can be read and understood as a series of English phrases and instructions.
			</div></li><li class="listitem"><div class="para">
				It uses IDE autocompletion which helps possible completions for the current input prefix and allows the user to choose the right option.
			</div></li><li class="listitem"><div class="para">
				It often uses the chaining method pattern.
			</div></li><li class="listitem"><div class="para">
				It is easy to use and read the API operations.
			</div></li></ul></div><div class="para">
		To use the API, first create a query builder that is attached to a given <code class="literal">indexedentitytype</code>. This <code class="classname">QueryBuilder</code> knows what analyzer to use and what field bridge to apply. Several <code class="classname">QueryBuilder</code>s (one for each entity type involved in the root of your query) can be created. The <code class="classname">QueryBuilder</code> is derived from the <code class="classname">SearchFactory</code>.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>QueryBuilder mythQB = searchFactory.<span xmlns="" class="perl_Function">buildQueryBuilder</span>().<span xmlns="" class="perl_Function">forEntity</span>( Myth.<span xmlns="" class="perl_Function">class</span> ).<span xmlns="" class="perl_Function">get</span>();</pre><div class="para">
		The analyzer used for a given field or fields can also be overridden.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>QueryBuilder mythQB = searchFactory.<span xmlns="" class="perl_Function">buildQueryBuilder</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">forEntity</span>( Myth.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">overridesForField</span>(<span xmlns="" class="perl_String">"history"</span>,<span xmlns="" class="perl_String">"stem_analyzer_definition"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">get</span>();</pre><div class="para">
		The query builder is now used to build Lucene queries. Customized queries generated using Lucene's query parser or <code class="classname">Query</code> objects assembled using the Lucene programmatic API are used with the Hibernate Search DSL.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14228-748329+%5BLatest%5D&amp;comment=Title%3A+Building+a+Lucene+Query%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14228-748329+23+Mar+2015+22%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Keyword_Queries">
      ⁠</a>14.3.1.3. Keyword Queries</h3></div></div></div><div class="para">
		The following example shows how to search for a specific word:
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>).<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"storm"</span>).<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="table"><a id="idm140550777797040">
      ⁠</a><p class="title"><strong>Table 14.4. Keyword query parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Keyword query parameters"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> keyword() </td><td style="text-align: left"> Use this parameter to find a specific word </td></tr><tr><td style="text-align: left"> onField() </td><td style="text-align: left"> Use this parameter to specify in which lucene field to search the word </td></tr><tr><td style="text-align: left"> matching() </td><td style="text-align: left"> use this parameter to specify the match for search string </td></tr><tr><td style="text-align: left"> createQuery() </td><td style="text-align: left"> creates the Lucene query object </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				The value "storm" is passed through the <code class="literal">history</code> <code class="classname">FieldBridge</code>. This is useful when numbers or dates are involved.
			</div></li><li class="listitem"><div class="para">
				The field bridge value is then passed to the analyzer used to index the field <code class="literal">history</code>. This ensures that the query uses the same term transformation than the indexing (lower case, ngram, stemming and so on). If the analyzing process generates several terms for a given word, a boolean query is used with the <code class="literal">SHOULD</code> logic (roughly an <code class="literal">OR</code> logic).
			</div></li></ul></div><div class="para">
		To search a property that is not of type string.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Indexed 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Myth {
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Field</span>(analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>) 
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">DateBridge</span>(resolution = Resolution.<span xmlns="" class="perl_Function">YEAR</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Date <span xmlns="" class="perl_Function">getCreationDate</span>() { <span xmlns="" class="perl_Keyword">return</span> creationDate; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Date <span xmlns="" class="perl_Function">setCreationDate</span>(Date creationDate) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">creationDate</span> = creationDate; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Date creationDate;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Date birthdate = ...;
<span xmlns="" class="line">​</span>Query luceneQuery = mythQb.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"creationDate"</span>).<span xmlns="" class="perl_Function">matching</span>(birthdate).<span xmlns="" class="perl_Function">createQuery</span>();
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			In plain Lucene, the <code class="classname">Date</code> object had to be converted to its string representation (in this case the year)
		</div></div></div><div class="para">
		This conversion works for any object, provided that the <code class="classname">FieldBridge</code> has an <code class="methodname">objectToString</code> method (and all built-in <code class="classname">FieldBridge</code> implementations do).
	</div><div class="para">
		The next example searches a field that uses ngram analyzers. The ngram analyzers index succession of ngrams of words, which helps to avoid user typos. For example, the 3-grams of the word hibernate are hib, ibe, ber, ern, rna, nat, ate.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">AnalyzerDef</span>(name = <span xmlns="" class="perl_String">"ngram"</span>,
<span xmlns="" class="line">​</span>  tokenizer = @<span xmlns="" class="perl_Function">TokenizerDef</span>(factory = StandardTokenizerFactory.<span xmlns="" class="perl_Function">class</span> ),
<span xmlns="" class="line">​</span>  filters = {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = StandardFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = LowerCaseFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = StopFilterFactory.<span xmlns="" class="perl_Function">class</span>),
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">TokenFilterDef</span>(factory = NGramFilterFactory.<span xmlns="" class="perl_Function">class</span>,
<span xmlns="" class="line">​</span>      params = { 
<span xmlns="" class="line">​</span>        @<span xmlns="" class="perl_Function">Parameter</span>(name = <span xmlns="" class="perl_String">"minGramSize"</span>, value = <span xmlns="" class="perl_String">"3"</span>),
<span xmlns="" class="line">​</span>        @<span xmlns="" class="perl_Function">Parameter</span>(name = <span xmlns="" class="perl_String">"maxGramSize"</span>, value = <span xmlns="" class="perl_String">"3"</span>) } )
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>)
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Myth {
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Field</span>(analyzer=@<span xmlns="" class="perl_Function">Analyzer</span>(definition=<span xmlns="" class="perl_String">"ngram"</span>) 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getName</span>() { <span xmlns="" class="perl_Keyword">return</span> name; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">setName</span>(String name) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">name</span> = name; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Date birthdate = ...;
<span xmlns="" class="line">​</span>Query luceneQuery = mythQb.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"name"</span>).<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"Sisiphus"</span>)
<span xmlns="" class="line">​</span>   .<span xmlns="" class="perl_Function">createQuery</span>();
</pre><div class="para">
		The matching word "Sisiphus" will be lower-cased and then split into 3-grams: sis, isi, sip, iph, phu, hus. Each of these ngram will be part of the query. The user is then able to find the Sysiphus myth (with a <code class="literal">y</code>). All that is transparently done for the user.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			If the user does not want a specific field to use the field bridge or the analyzer then the <code class="methodname">ignoreAnalyzer()</code> or <code class="methodname">ignoreFieldBridge()</code> functions can be called.
		</div></div></div><div class="para">
		To search for multiple possible words in the same field, add them all in the matching clause.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//search document with storm or lightning in their history</span>
<span xmlns="" class="line">​</span>Query luceneQuery = 
<span xmlns="" class="line">​</span>    mythQB.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>).<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"storm lightning"</span>).<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para">
		To search the same word on multiple fields, use the <code class="methodname">onFields</code> method.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onFields</span>(<span xmlns="" class="perl_String">"history"</span>,<span xmlns="" class="perl_String">"description"</span>,<span xmlns="" class="perl_String">"name"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"storm"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para">
		Sometimes, one field should be treated differently from another field even if searching the same term, use the <code class="methodname">andField()</code> method for that.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB.<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">andField</span>(<span xmlns="" class="perl_String">"name"</span>)
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">boostedTo</span>(<span xmlns="" class="perl_Float">5</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">andField</span>(<span xmlns="" class="perl_String">"description"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"storm"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para">
		In the previous example, only field name is boosted to 5.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14301-750422+%5BLatest%5D&amp;comment=Title%3A+Keyword+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14301-750422+10+Apr+2015+05%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Fuzzy_Queries">
      ⁠</a>14.3.1.4. Fuzzy Queries</h3></div></div></div><div class="para">
		To execute a fuzzy query (based on the Levenshtein distance algorithm), start with a <code class="literal">keyword</code> query and add the <code class="literal">fuzzy</code> flag.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">fuzzy</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">withThreshold</span>( <span xmlns="" class="perl_Float">.8f</span> )
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">withPrefixLength</span>( <span xmlns="" class="perl_Float">1</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"starm"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para">
		The <code class="literal">threshold</code> is the limit above which two terms are considering matching. It is a decimal between 0 and 1 and the default value is 0.5. The <code class="literal">prefixLength</code> is the length of the prefix ignored by the "fuzzyness". While the default value is 0, a nonzero value is recommended for indexes containing a huge number of distinct terms.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14303-748331+%5BLatest%5D&amp;comment=Title%3A+Fuzzy+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14303-748331+23+Mar+2015+23%3A04+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Wildcard_Queries">
      ⁠</a>14.3.1.5. Wildcard Queries</h3></div></div></div><div class="para">
		Wildcard queries are useful in circumstances where only part of the word is known. The <code class="literal">?</code> represents a single character and <code class="literal">*</code> represents multiple characters. Note that for performance purposes, it is recommended that the query does not start with either <code class="literal">?</code> or <code class="literal">*</code>.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">wildcard</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"sto*"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Wildcard queries do not apply the analyzer on the matching terms. The risk of <code class="literal">*</code> or <code class="literal">?</code> being mangled is too high.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14304-748332+%5BLatest%5D&amp;comment=Title%3A+Wildcard+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14304-748332+23+Mar+2015+23%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Phrase_Queries">
      ⁠</a>14.3.1.6. Phrase Queries</h3></div></div></div><div class="para">
		So far we have been looking for words or sets of words, the user can also search exact or approximate sentences. Use <code class="methodname">phrase()</code> to do so.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">phrase</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">sentence</span>(<span xmlns="" class="perl_String">"Thou shalt not kill"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para">
		Approximate sentences can be searched by adding a slop factor. The slop factor represents the number of other words permitted in the sentence: this works like a within or near operator.
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">phrase</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">withSlop</span>(<span xmlns="" class="perl_Float">3</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"history"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">sentence</span>(<span xmlns="" class="perl_String">"Thou kill"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14300-592111+%5BLatest%5D&amp;comment=Title%3A+Phrase+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14300-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Range_Queries">
      ⁠</a>14.3.1.7. Range Queries</h3></div></div></div><div class="para">
		A range query searches for a value in between given boundaries (included or not) or for a value below or above a given boundary (included or not).
	</div><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//look for 0 &lt;= starred &lt; 3</span>
<span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">range</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"starred"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">from</span>(<span xmlns="" class="perl_Float">0</span>).<span xmlns="" class="perl_Function">to</span>(<span xmlns="" class="perl_Float">3</span>).<span xmlns="" class="perl_Function">excludeLimit</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//look for myths strictly BC</span>
<span xmlns="" class="line">​</span>Date beforeChrist = ...;
<span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">range</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"creationDate"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">below</span>(beforeChrist).<span xmlns="" class="perl_Function">excludeLimit</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14299-592111+%5BLatest%5D&amp;comment=Title%3A+Range+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14299-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Combining_Queries">
      ⁠</a>14.3.1.8. Combining Queries</h3></div></div></div><div class="para">
		Queries can be aggregated (combined) to create more complex queries. The following aggregation operators are available:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">SHOULD</code>: the query should contain the matching elements of the subquery.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">MUST</code>: the query must contain the matching elements of the subquery.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">MUST NOT</code>: the query must not contain the matching elements of the subquery.
			</div></li></ul></div><div class="para">
		The subqueries can be any Lucene query including a boolean query itself.
	</div><div class="example"><a id="idm140550772965200">
      ⁠</a><p class="title"><strong>Example 14.33.  <code class="literal">MUST NOT</code> Query </strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//look for popular modern myths that are not urban</span>
<span xmlns="" class="line">​</span>Date twentiethCentury = ...;
<span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">bool</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">must</span>( mythQB.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"description"</span>).<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"urban"</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">not</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">must</span>( mythQB.<span xmlns="" class="perl_Function">range</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"starred"</span>).<span xmlns="" class="perl_Function">above</span>(<span xmlns="" class="perl_Float">4</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">must</span>( mythQB
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">range</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"creationDate"</span>)
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">above</span>(twentiethCentury)
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre></div></div><div class="example"><a id="idm140550793447952">
      ⁠</a><p class="title"><strong>Example 14.34.  <code class="literal">SHOULD</code> Query </strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//look for popular myths that are preferably urban</span>
<span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">bool</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">should</span>( mythQB.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"description"</span>).<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"urban"</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">must</span>( mythQB.<span xmlns="" class="perl_Function">range</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"starred"</span>).<span xmlns="" class="perl_Function">above</span>(<span xmlns="" class="perl_Float">4</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre></div></div><div class="example"><a id="idm140550790713584">
      ⁠</a><p class="title"><strong>Example 14.35.  <code class="literal">NOT</code> Query </strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//look for all myths except religious ones</span>
<span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">all</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">except</span>( monthQb
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">onField</span>( <span xmlns="" class="perl_String">"description_stem"</span> )
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">matching</span>( <span xmlns="" class="perl_String">"religion"</span> )
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">createQuery</span>() 
<span xmlns="" class="line">​</span>      )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14302-748333+%5BLatest%5D&amp;comment=Title%3A+Combining+Queries%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14302-748333+23+Mar+2015+23%3A17+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Query_Options">
      ⁠</a>14.3.1.9. Query Options</h3></div></div></div><div class="para">
		The Hibernate Search query DSL is an easy to use and easy to read query API. In accepting and producing Lucene queries, you can incorporate query types not yet supported by the DSL.
	</div><div class="para">
		The following is a summary of query options for query types and fields:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="methodname">boostedTo</code> (on query type and on field) boosts the whole query or the specific field to a given factor.
			</div></li><li class="listitem"><div class="para">
				<code class="methodname">withConstantScore</code> (on query) returns all results that match the query have a constant score equals to the boost.
			</div></li><li class="listitem"><div class="para">
				<code class="methodname">filteredBy(Filter)</code>(on query) filters query results using the <code class="classname">Filter</code> instance.
			</div></li><li class="listitem"><div class="para">
				<code class="methodname">ignoreAnalyzer</code> (on field) ignores the analyzer when processing this field.
			</div></li><li class="listitem"><div class="para">
				<code class="methodname">ignoreFieldBridge</code> (on field) ignores field bridge when processing this field.
			</div></li></ul></div><div class="example"><a id="idm140550773108624">
      ⁠</a><p class="title"><strong>Example 14.36. Combination of Query Options</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>Query luceneQuery = mythQB
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">bool</span>()
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">should</span>( mythQB.<span xmlns="" class="perl_Function">keyword</span>().<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"description"</span>).<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"urban"</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">should</span>( mythQB
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">keyword</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"name"</span>)
<span xmlns="" class="line">​</span>          .<span xmlns="" class="perl_Function">boostedTo</span>(<span xmlns="" class="perl_Float">3</span>)
<span xmlns="" class="line">​</span>          .<span xmlns="" class="perl_Function">ignoreAnalyzer</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">matching</span>(<span xmlns="" class="perl_String">"urban"</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">must</span>( mythQB
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">range</span>()
<span xmlns="" class="line">​</span>          .<span xmlns="" class="perl_Function">boostedTo</span>(<span xmlns="" class="perl_Float">5</span>).<span xmlns="" class="perl_Function">withConstantScore</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">onField</span>(<span xmlns="" class="perl_String">"starred"</span>).<span xmlns="" class="perl_Function">above</span>(<span xmlns="" class="perl_Float">4</span>).<span xmlns="" class="perl_Function">createQuery</span>() )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createQuery</span>();</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14298-748334+%5BLatest%5D&amp;comment=Title%3A+Query+Options%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14298-748334+23+Mar+2015+23%3A27+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-Build_a_Hibernate_Search_Query">
      ⁠</a>14.3.1.10. Build a Hibernate Search Query</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Generality">
      ⁠</a>14.3.1.10.1. Generality</h4></div></div></div><div class="para">
		After building the Lucene query, wrap it within a Hibernate query. The query searches all indexed entities and returns all types of indexed classes unless explicitly configured not to do so.
	</div><div class="example"><a id="idm140550730715904">
      ⁠</a><p class="title"><strong>Example 14.37. Wrapping a Lucene Query in a Hibernate Query</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>( session );
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">Query</span> fullTextQuery = fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery );</pre></div></div><div class="para">
		For improved performance, restrict the returned types as follows:
	</div><div class="example"><a id="example-filtering-by-entity-type">
      ⁠</a><p class="title"><strong>Example 14.38. Filtering the Search Result by Entity Type</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>fullTextQuery = fullTextSession
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Customer.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// or</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>fullTextQuery = fullTextSession
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Item.<span xmlns="" class="perl_Function">class</span>, Actor.<span xmlns="" class="perl_Function">class</span> );</pre></div></div><div class="para">
		The first part of the second example only returns the matching <code class="classname">Customer</code>s. The second part of the same example returns matching <code class="classname">Actor</code>s and <code class="classname">Item</code>s. The type restriction is polymorphic. As a result, if the two subclasses <code class="classname">Salesman</code> and <code class="classname">Customer</code> of the base class <code class="classname">Person</code> return, specify <code class="classname">Person.class</code> to filter based on result types.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14309-592109+%5BLatest%5D&amp;comment=Title%3A+Generality%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14309-592109+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Pagination3">
      ⁠</a>14.3.1.10.2. Pagination</h4></div></div></div><div class="para">
		To avoid performance degradation, it is recommended to restrict the number of returned objects per query. A user navigating from one page to another page is a very common use case. The way to define pagination is similar to defining pagination in a plain HQL or Criteria query.
	</div><div class="example"><a id="idm140550729969248">
      ⁠</a><p class="title"><strong>Example 14.39. Defining pagination for a search query</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">Query</span> fullTextQuery = 
<span xmlns="" class="line">​</span>    fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Customer.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>fullTextQuery.<span xmlns="" class="perl_Function">setFirstResult</span>(<span xmlns="" class="perl_Float">15</span>); <span xmlns="" class="perl_Comment">//start from the 15th element</span>
<span xmlns="" class="line">​</span>fullTextQuery.<span xmlns="" class="perl_Function">setMaxResults</span>(<span xmlns="" class="perl_Float">10</span>); <span xmlns="" class="perl_Comment">//return 10 elements</span></pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			It is still possible to get the total number of matching elements regardless of the pagination via <code class="methodname">fulltextQuery.</code><code class="methodname">getResultSize()</code>
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14305-592111+%5BLatest%5D&amp;comment=Title%3A+Pagination%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14305-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Sorting">
      ⁠</a>14.3.1.10.3. Sorting</h4></div></div></div><div class="para">
		Apache Lucene contains a flexible and powerful result sorting mechanism. The default sorting is by relevance and is appropriate for a large variety of use cases. The sorting mechanism can be changed to sort by other properties using the Lucene Sort object to apply a Lucene sorting strategy.
	</div><div class="example"><a id="idm140550784004848">
      ⁠</a><p class="title"><strong>Example 14.40. Specifying a Lucene <code class="classname">Sort</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">FullTextQuery</span> query = s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( query, Book.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Sort</span> sort = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Sort</span>(
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SortField</span>(<span xmlns="" class="perl_String">"title"</span>, SortField.<span xmlns="" class="perl_Function">STRING</span>));
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setSort</span>(sort);
<span xmlns="" class="line">​</span>List results = query.<span xmlns="" class="perl_Function">list</span>();
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Fields used for sorting must not be tokenized. For more information about tokenizing, see <a class="xref" href="chap-Hibernate_Search.html#Field">Section 14.2.1.1.2, “@Field”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14312-592109+%5BLatest%5D&amp;comment=Title%3A+Sorting%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14312-592109+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Fetching_Strategy">
      ⁠</a>14.3.1.10.4. Fetching Strategy</h4></div></div></div><div class="para">
		<span class="phrase">Hibernate Search</span> loads objects using a single query if the return types are restricted to one class. <span class="phrase">Hibernate Search</span> is restricted by the static fetching strategy defined in the domain model. It is useful to refine the fetching strategy for a specific use case as follows:
	</div><div class="example"><a id="idm140550797497968">
      ⁠</a><p class="title"><strong>Example 14.41. Specifying <code class="classname">FetchMode</code> on a query</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>Criteria criteria = 
<span xmlns="" class="line">​</span>    s.<span xmlns="" class="perl_Function">createCriteria</span>( Book.<span xmlns="" class="perl_Function">class</span> ).<span xmlns="" class="perl_Function">setFetchMode</span>( <span xmlns="" class="perl_String">"authors"</span>, FetchMode.<span xmlns="" class="perl_Function">JOIN</span> );
<span xmlns="" class="line">​</span>s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery ).<span xmlns="" class="perl_Function">setCriteriaQuery</span>( criteria );</pre></div></div><div class="para">
		In this example, the query will return all Books matching the LuceneQuery. The authors collection will be loaded from the same query using an SQL outer join.
	</div><div class="para">
		In a criteria query definition, the type is guessed based on the provided criteria query. As a result, it is not necessary to restrict the return entity types.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			The fetch mode is the only adjustable property. Do not use a restriction (a where clause) on the <code class="classname">Criteria</code> query because the <code class="methodname">getResultSize()</code> throws a <code class="classname">SearchException</code> if used in conjunction with a <code class="classname">Criteria</code> with restriction.
		</div></div></div><div class="para">
		If more than one entity is expected, do not use <code class="methodname">setCriteriaQuery</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14310-592109+%5BLatest%5D&amp;comment=Title%3A+Fetching+Strategy%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14310-592109+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Projection">
      ⁠</a>14.3.1.10.5. Projection</h4></div></div></div><div class="para">
		In some cases, only a small subset of the properties is required. Use Hibernate Search to return a subset of properties as follows:
	</div><div class="para">
		Hibernate Search extracts properties from the Lucene index and converts them to their object representation and returns a list of <code class="classname">Object[]</code>. Projections prevent a time consuming database round-trip. However, they have following constraints:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				The properties projected must be stored in the index (<code class="literal">@Field(store=Store.YES)</code>), which increases the index size.
			</div></li><li class="listitem"><div class="para">
				The properties projected must use a <code class="literal">FieldBridge</code> implementing <code class="classname">org.hibernate.search.bridge.TwoWayFieldBridge</code> or <code class="literal">org.hibernate.search.bridge.TwoWayStringBridge</code>, the latter being the simpler version.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					All Hibernate Search built-in types are two-way.
				</div></div></div></li><li class="listitem"><div class="para">
				Only the simple properties of the indexed entity or its embedded associations can be projected. Therefore a whole embedded entity cannot be projected.
			</div></li><li class="listitem"><div class="para">
				Projection does not work on collections or maps which are indexed via <code class="classname">@IndexedEmbedded</code>
			</div></li></ul></div><div class="para">
		Lucene provides metadata information about query results. Use projection constants to retrieve the metadata.
	</div><div class="example"><a id="idm140550736337376">
      ⁠</a><p class="title"><strong>Example 14.42. Using Projection to Retrieve Metadata</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">FullTextQuery</span> query = 
<span xmlns="" class="line">​</span>    s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Book.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setProjection</span>( FullTextQuery.<span xmlns="" class="perl_Function">SCORE</span>, FullTextQuery.<span xmlns="" class="perl_Function">THIS</span>, <span xmlns="" class="perl_String">"mainAuthor.name"</span> );
<span xmlns="" class="line">​</span>List results = query.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span>Object[] firstResult = (Object[]) results.<span xmlns="" class="perl_Function">get</span>(<span xmlns="" class="perl_Float">0</span>);
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">float</span> score = firstResult[<span xmlns="" class="perl_Float">0</span>];
<span xmlns="" class="line">​</span>Book book = firstResult[<span xmlns="" class="perl_Float">1</span>];
<span xmlns="" class="line">​</span>String authorName = firstResult[<span xmlns="" class="perl_Float">2</span>];</pre></div></div><div class="para">
		Fields can be mixed with the following projection constants:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.THIS</code>: returns the initialized and managed entity (as a non projected query would have done).
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.DOCUMENT</code>: returns the Lucene Document related to the object projected.
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.OBJECT_CLASS</code>: returns the class of the indexed entity.
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.SCORE</code>: returns the document score in the query. Scores are handy to compare one result against an other for a given query but are useless when comparing the result of different queries.
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.ID</code>: the ID property value of the projected object.
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.DOCUMENT_ID</code>: the Lucene document ID. Be careful in using this value as a Lucene document ID can change over time between two different IndexReader opening.
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FullTextQuery.EXPLANATION</code>: returns the Lucene Explanation object for the matching object/document in the given query. This is not suitable for retrieving large amounts of data. Running explanation typically is as costly as running the whole Lucene query per matching element. As a result, projection is recommended.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14307-748344+%5BLatest%5D&amp;comment=Title%3A+Projection%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14307-748344+24+Mar+2015+01%3A33+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Customizing_Object_Initialization_Strategies">
      ⁠</a>14.3.1.10.6. Customizing Object Initialization Strategies</h4></div></div></div><div class="para">
		By default, <span class="phrase">Hibernate Search</span> uses the most appropriate strategy to initialize entities matching the full text query. It executes one (or several) queries to retrieve the required entities. This approach minimizes database trips where few of the retrieved entities are present in the persistence context (the session) or the second level cache.
	</div><div class="para">
		If entities are present in the second level cache, force <span class="phrase">Hibernate Search</span> to look into the cache before retrieving a database object.
	</div><div class="example"><a id="idm140550807917072">
      ⁠</a><p class="title"><strong>Example 14.43. Check the second-level cache before using a query</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextQuery query = session.<span xmlns="" class="perl_Function">createFullTextQuery</span>(luceneQuery, User.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">initializeObjectWith</span>(
<span xmlns="" class="line">​</span>    ObjectLookupMethod.<span xmlns="" class="perl_Function">SECOND_LEVEL_CACHE</span>,
<span xmlns="" class="line">​</span>    DatabaseRetrievalMethod.<span xmlns="" class="perl_Function">QUERY</span>
<span xmlns="" class="line">​</span>);</pre></div></div><div class="para">
		<code class="classname">ObjectLookupMethod</code> defines the strategy to check if an object is easily accessible (without fetching it from the database). Other options are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<em class="parameter"><code>ObjectLookupMethod.PERSISTENCE_CONTEXT</code></em> is used if many matching entities are already loaded into the persistence context (loaded in the <code class="classname">Session</code> or <code class="classname">EntityManager</code>).
			</div></li><li class="listitem"><div class="para">
				<code class="literal">ObjectLookupMethod.SECOND_LEVEL_CACHE</code> checks the persistence context and then the second-level cache.
			</div></li></ul></div><div class="para">
		Set the following to search in the second-level cache:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Correctly configure and activate the second-level cache.
			</div></li><li class="listitem"><div class="para">
				Enable the second-level cache for the relevant entity. This is done using annotations such as <code class="classname">@Cacheable</code>.
			</div></li><li class="listitem"><div class="para">
				Enable second-level cache read access for either <code class="classname">Session</code>, <code class="classname">EntityManager</code> or <code class="classname">Query</code>. Use <em class="parameter"><code>CacheMode.NORMAL</code></em> in Hibernate native APIs or <em class="parameter"><code>CacheRetrieveMode.USE</code></em> in Java Persistence APIs.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Unless the second-level cache implementation is EHCache or Infinispan, do not use <code class="classname">ObjectLookupMethod.SECOND_LEVEL_CACHE</code>. Other second-level cache providers do not implement this operation efficiently.
		</div></div></div><div class="para">
		Customize how objects are loaded from the database using <code class="classname">DatabaseRetrievalMethod</code> as follows:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="classname">QUERY</code> (default) uses a set of queries to load several objects in each batch. This approach is recommended.
			</div></li><li class="listitem"><div class="para">
				<code class="classname">FIND_BY_ID</code> loads one object at a time using the <code class="classname">Session</code>.<code class="methodname">get</code> or <code class="classname">EntityManager</code>.<code class="methodname">find</code> semantic. This is recommended if the batch size is set for the entity, which allows Hibernate Core to load entities in batches.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14311-748488+%5BLatest%5D&amp;comment=Title%3A+Customizing+Object+Initialization+Strategies%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14311-748488+24+Mar+2015+20%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Limiting_the_Time_of_a_Query">
      ⁠</a>14.3.1.10.7. Limiting the Time of a Query</h4></div></div></div><div class="para">
		Limit the time a query takes in Hibernate Guide as follows:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Raise an exception when arriving at the limit.
			</div></li><li class="listitem"><div class="para">
				Limit to the number of results retrieved when the time limit is raised.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14308-592109+%5BLatest%5D&amp;comment=Title%3A+Limiting+the+Time+of+a+Query%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14308-592109+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Raise_an_Exception_on_Time_Limit">
      ⁠</a>14.3.1.10.8. Raise an Exception on Time Limit</h4></div></div></div><div class="para">
		If a query uses more than the defined amount of time, a <code class="classname">QueryTimeoutException</code> is raised (<code class="classname">org.hibernate.QueryTimeoutException</code> or <code class="classname">javax.persistence.QueryTimeoutException</code> depending on the programmatic API).
	</div><div class="para">
		To define the limit when using the native Hibernate APIs, use one of the following approaches:
	</div><div class="example"><a id="idm140550720006880">
      ⁠</a><p class="title"><strong>Example 14.44. Defining a Timeout in Query Execution</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = ...;
<span xmlns="" class="line">​</span>FullTextQuery query = fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>(luceneQuery, User.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//define the timeout in seconds</span>
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setTimeout</span>(<span xmlns="" class="perl_Float">5</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//alternatively, define the timeout in any given time unit</span>
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setTimeout</span>(<span xmlns="" class="perl_Float">450</span>, TimeUnit.<span xmlns="" class="perl_Function">MILLISECONDS</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    query.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">catch</span> (org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">QueryTimeoutException</span> e) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">//do something, too slow</span>
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		The <code class="methodname">getResultSize()</code>, <code class="methodname">iterate()</code> and <code class="methodname">scroll()</code> honor the timeout until the end of the method call. As a result, <code class="classname">Iterable</code> or the <code class="classname">ScrollableResults</code> ignore the timeout. Additionally, <code class="methodname">explain()</code> does not honor this timeout period. This method is used for debugging and to check the reasons for slow performance of a query.
	</div><div class="para">
		The following is the standard way to limit execution time using the Java Persistence API (JPA):
	</div><div class="example"><a id="idm140550802480816">
      ⁠</a><p class="title"><strong>Example 14.45. Defining a Timeout in Query Execution</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>Query luceneQuery = ...;
<span xmlns="" class="line">​</span>FullTextQuery query = fullTextEM.<span xmlns="" class="perl_Function">createFullTextQuery</span>(luceneQuery, User.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//define the timeout in milliseconds</span>
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setHint</span>( <span xmlns="" class="perl_String">"javax.persistence.query.timeout"</span>, <span xmlns="" class="perl_Float">450</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    query.<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">catch</span> (javax.<span xmlns="" class="perl_Function">persistence</span>.<span xmlns="" class="perl_Function">QueryTimeoutException</span> e) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">//do something, too slow</span>
<span xmlns="" class="line">​</span>}</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			The example code does not guarantee that the query stops at the specified results amount.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14306-592111+%5BLatest%5D&amp;comment=Title%3A+Raise+an+Exception+on+Time+Limit%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14306-592111+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Retrieving_the_Results">
      ⁠</a>14.3.2. Retrieving the Results</h2></div></div></div><div class="para">
				After building the Hibernate query, it is executed the same way as a HQL or Criteria query. The same paradigm and object semantic apply to a Lucene Query query and the common operations like: <code class="methodname">list()</code>, <code class="methodname">uniqueResult()</code>, <code class="methodname">iterate()</code>, <code class="methodname">scroll()</code> are available.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14245-748489+%5BLatest%5D&amp;comment=Title%3A+Retrieving+the+Results%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Performance_Considerations">
      ⁠</a>14.3.2.1. Performance Considerations</h3></div></div></div><div class="para">
		If you expect a reasonable number of results (for example using pagination) and expect to work on all of them, <code class="methodname">list()</code> or <code class="methodname">uniqueResult()</code> are recommended. <code class="methodname">list()</code> work best if the entity <code class="literal">batch-size</code> is set up properly. Note that Hibernate Search has to process all Lucene Hits elements (within the pagination) when using <code class="methodname">list()</code> , <code class="methodname">uniqueResult()</code> and <code class="methodname">iterate()</code>.
	</div><div class="para">
		If you wish to minimize Lucene document loading, <code class="methodname">scroll()</code> is more appropriate. Don't forget to close the <code class="classname">ScrollableResults</code> object when you're done, since it keeps Lucene resources. If you expect to use <code class="methodname">scroll,</code> but wish to load objects in batch, you can use <code class="methodname">query.setFetchSize()</code>. When an object is accessed, and if not already loaded, Hibernate Search will load the next <code class="literal">fetchSize</code> objects in one pass.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Pagination is preferred over scrolling.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14253-592108+%5BLatest%5D&amp;comment=Title%3A+Performance+Considerations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14253-592108+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Result_Size">
      ⁠</a>14.3.2.2. Result Size</h3></div></div></div><div class="para">
		It is sometimes useful to know the total number of matching documents:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				to provide a total search results feature, as provided by Google searches. For example, "1-10 of about 888,000,000 results"
			</div></li><li class="listitem"><div class="para">
				to implement a fast pagination navigation
			</div></li><li class="listitem"><div class="para">
				to implement a multi-step search engine that adds approximation if the restricted query returns zero or not enough results
			</div></li></ul></div><div class="para">
		Of course it would be too costly to retrieve all the matching documents. Hibernate Search allows you to retrieve the total number of matching documents regardless of the pagination parameters. Even more interesting, you can retrieve the number of matching elements without triggering a single object load.
	</div><div class="example"><a id="idm140550730964400">
      ⁠</a><p class="title"><strong>Example 14.46. Determining the Result Size of a Query</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">FullTextQuery</span> query = 
<span xmlns="" class="line">​</span>    s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Book.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//return the number of matching books without loading a single one</span>
<span xmlns="" class="line">​</span>assert <span xmlns="" class="perl_Float">3245</span> == query.<span xmlns="" class="perl_Function">getResultSize</span>(); 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">FullTextQuery</span> query = 
<span xmlns="" class="line">​</span>    s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Book.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setMaxResult</span>(<span xmlns="" class="perl_Float">10</span>);
<span xmlns="" class="line">​</span>List results = query.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//return the total number of matching books regardless of pagination</span>
<span xmlns="" class="line">​</span>assert <span xmlns="" class="perl_Float">3245</span> == query.<span xmlns="" class="perl_Function">getResultSize</span>();</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Like Google, the number of results is approximation if the index is not fully up-to-date with the database (asynchronous cluster for example).
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14247-765405+%5BLatest%5D&amp;comment=Title%3A+Result+Size%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14247-765405+20+Jul+2015+07%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ResultTransformer">
      ⁠</a>14.3.2.3. ResultTransformer</h3></div></div></div><div class="para">
		Projection results are returned as <code class="classname">Object</code> arrays. If the data structure used for the object does not match the requirements of the application, apply a <code class="classname">ResultTransformer</code>. The <code class="classname">ResultTransformer</code> builds the required data structure after the query execution.
	</div><div class="example"><a id="idm140550801599728">
      ⁠</a><p class="title"><strong>Example 14.47. Using ResultTransformer with Projections</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">FullTextQuery</span> query = 
<span xmlns="" class="line">​</span>    s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Book.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setProjection</span>( <span xmlns="" class="perl_String">"title"</span>, <span xmlns="" class="perl_String">"mainAuthor.name"</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">setResultTransformer</span>( <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">StaticAliasToBeanResultTransformer</span>( BookView.<span xmlns="" class="perl_Function">class</span>, <span xmlns="" class="perl_String">"title"</span>, <span xmlns="" class="perl_String">"author"</span> ) );
<span xmlns="" class="line">​</span>List&lt;BookView&gt; results = (List&lt;BookView&gt;) query.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">for</span>(BookView view : results) {
<span xmlns="" class="line">​</span>    log.<span xmlns="" class="perl_Function">info</span>( <span xmlns="" class="perl_String">"Book: "</span> + view.<span xmlns="" class="perl_Function">getTitle</span>() + <span xmlns="" class="perl_String">", "</span> + view.<span xmlns="" class="perl_Function">getAuthor</span>() );
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Examples of <code class="classname">ResultTransformer</code> implementations can be found in the Hibernate Core codebase.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14266-748490+%5BLatest%5D&amp;comment=Title%3A+ResultTransformer%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14266-748490+24+Mar+2015+20%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_Results">
      ⁠</a>14.3.2.4. Understanding Results</h3></div></div></div><div class="para">
		If the results of a query are not what you expected, the <code class="literal">Luke</code> tool is useful in understanding the outcome. However, Hibernate Search also gives you access to the Lucene <code class="classname">Explanation</code> object for a given result (in a given query). This class is considered fairly advanced to Lucene users but can provide a good understanding of the scoring of an object. You have two ways to access the Explanation object for a given result:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Use the <code class="methodname">fullTextQuery.explain(int)</code> method
			</div></li><li class="listitem"><div class="para">
				Use projection
			</div></li></ul></div><div class="para">
		The first approach takes a document ID as a parameter and return the Explanation object. The document ID can be retrieved using projection and the <code class="literal">FullTextQuery.DOCUMENT_ID</code> constant.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			The Document ID is unrelated to the entity ID. Be careful not to confuse these concepts.
		</div></div></div><div class="para">
		In the second approach you project the <code class="classname">Explanation</code> object using the <code class="literal">FullTextQuery.EXPLANATION</code> constant.
	</div><div class="example"><a id="idm140550742709024">
      ⁠</a><p class="title"><strong>Example 14.48. Retrieving the Lucene Explanation Object Using Projection</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextQuery ftQuery = s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Dvd.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">setProjection</span>( 
<span xmlns="" class="line">​</span>             FullTextQuery.<span xmlns="" class="perl_Function">DOCUMENT_ID</span>, 
<span xmlns="" class="line">​</span>             FullTextQuery.<span xmlns="" class="perl_Function">EXPLANATION</span>, 
<span xmlns="" class="line">​</span>             FullTextQuery.<span xmlns="" class="perl_Function">THIS</span> );
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SuppressWarnings</span>(<span xmlns="" class="perl_String">"unchecked"</span>) List&lt;Object[]&gt; results = ftQuery.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">for</span> (Object[] result : results) {
<span xmlns="" class="line">​</span>    Explanation e = (Explanation) result[<span xmlns="" class="perl_Float">1</span>];
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">display</span>( e.<span xmlns="" class="perl_Function">toString</span>() );
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		Use the Explanation object only when required as it is roughly as expensive as running the Lucene query again.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14255-748491+%5BLatest%5D&amp;comment=Title%3A+Understanding+Results%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14255-748491+24+Mar+2015+20%3A41+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Filters">
      ⁠</a>14.3.3. Filters</h2></div></div></div><div class="para">
				Apache Lucene has a powerful feature that allows you to filter query results according to a custom filtering process. This is a very powerful way to apply additional data restrictions, especially since filters can be cached and reused. Use cases include:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						security
					</div></li><li class="listitem"><div class="para">
						temporal data (example, view only last month's data)
					</div></li><li class="listitem"><div class="para">
						population filter (example, search limited to a given category)
					</div></li></ul></div><div class="para">
				Hibernate Search pushes the concept further by introducing the notion of parameterizable named filters which are transparently cached. For people familiar with the notion of Hibernate Core filters, the API is very similar:
			</div><div class="example"><a id="idm140550793692576">
      ⁠</a><p class="title"><strong>Example 14.49. Enabling Fulltext Filters for a Query</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>fullTextQuery = s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( query, Driver.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>fullTextQuery.<span xmlns="" class="perl_Function">enableFullTextFilter</span>(<span xmlns="" class="perl_String">"bestDriver"</span>);
<span xmlns="" class="line">​</span>fullTextQuery.<span xmlns="" class="perl_Function">enableFullTextFilter</span>(<span xmlns="" class="perl_String">"security"</span>).<span xmlns="" class="perl_Function">setParameter</span>( <span xmlns="" class="perl_String">"login"</span>, <span xmlns="" class="perl_String">"andre"</span> );
<span xmlns="" class="line">​</span>fullTextQuery.<span xmlns="" class="perl_Function">list</span>(); <span xmlns="" class="perl_Comment">//returns only best drivers where andre has credentials</span></pre></div></div><div class="para">
				In this example we enabled two filters on top of the query. You can enable (or disable) as many filters as you like.
			</div><div class="para">
				Declaring filters is done through the <code class="classname">@FullTextFilterDef</code> annotation. This annotation can be on any <code class="literal">@Indexed</code> entity regardless of the query the filter is later applied to. This implies that filter definitions are global and their names must be unique. A <code class="classname">SearchException</code> is thrown in case two different <code class="classname">@FullTextFilterDef</code> annotations with the same name are defined. Each named filter has to specify its actual filter implementation.
			</div><div class="example"><a id="idm140550772069152">
      ⁠</a><p class="title"><strong>Example 14.50. Defining and Implementing a Filter</strong></p><div class="example-contents"><pre class="programlisting">

@FullTextFilterDefs( {
    <span class="bold bold"><strong>@FullTextFilterDef(name = "bestDriver", impl = BestDriversFilter.class)</strong></span>, 
    <span class="bold bold"><strong>@FullTextFilterDef(name = "security", impl = SecurityFilterFactory.class)</strong></span> 
})
public class Driver { ... }</pre><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> BestDriversFilter <span xmlns="" class="perl_Keyword">extends</span> org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Filter</span> {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> DocIdSet <span xmlns="" class="perl_Function">getDocIdSet</span>(IndexReader reader) <span xmlns="" class="perl_Keyword">throws</span> IOException {
<span xmlns="" class="line">​</span>        OpenBitSet bitSet = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">OpenBitSet</span>( reader.<span xmlns="" class="perl_Function">maxDoc</span>() );
<span xmlns="" class="line">​</span>        TermDocs termDocs = reader.<span xmlns="" class="perl_Function">termDocs</span>( <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Term</span>( <span xmlns="" class="perl_String">"score"</span>, <span xmlns="" class="perl_String">"5"</span> ) );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">while</span> ( termDocs.<span xmlns="" class="perl_Function">next</span>() ) {
<span xmlns="" class="line">​</span>            bitSet.<span xmlns="" class="perl_Function">set</span>( termDocs.<span xmlns="" class="perl_Function">doc</span>() );
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> bitSet;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
				<code class="classname">BestDriversFilter</code> is an example of a simple Lucene filter which reduces the result set to drivers whose score is 5. In this example the specified filter implements the <code class="literal">org.apache.lucene.search.Filter</code> directly and contains a no-arg constructor.
			</div><div class="para">
				If your Filter creation requires additional steps or if the filter you want to use does not have a no-arg constructor, you can use the factory pattern:
			</div><div class="example"><a id="idm140550727288528">
      ⁠</a><p class="title"><strong>Example 14.51. Creating a filter using the factory pattern</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">FullTextFilterDef</span>(name = <span xmlns="" class="perl_String">"bestDriver"</span>, impl = BestDriversFilterFactory.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Driver { <span xmlns="" class="perl_Keyword">... </span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> BestDriversFilterFactory {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Factory
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Filter <span xmlns="" class="perl_Function">getFilter</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">//some additional steps to cache the filter results per IndexReader</span>
<span xmlns="" class="line">​</span>        Filter bestDriversFilter = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">BestDriversFilter</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">CachingWrapperFilter</span>(bestDriversFilter);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
				Hibernate Search will look for a <code class="literal">@Factory</code> annotated method and use it to build the filter instance. The factory must have a no-arg constructor.
			</div><div class="para">
				Named filters come in handy where parameters have to be passed to the filter. For example a security filter might want to know which security level you want to apply:
			</div><div class="example"><a id="idm140550738836256">
      ⁠</a><p class="title"><strong>Example 14.52. Passing parameters to a defined filter</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>fullTextQuery = s.<span xmlns="" class="perl_Function">createFullTextQuery</span>( query, Driver.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>fullTextQuery.<span xmlns="" class="perl_Function">enableFullTextFilter</span>(<span xmlns="" class="perl_String">"security"</span>).<span xmlns="" class="perl_Function">setParameter</span>( <span xmlns="" class="perl_String">"level"</span>, <span xmlns="" class="perl_Float">5</span> );</pre></div></div><div class="para">
				Each parameter name should have an associated setter on either the filter or filter factory of the targeted named filter definition.
			</div><div class="example"><a id="idm140550813217248">
      ⁠</a><p class="title"><strong>Example 14.53. Using parameters in the actual filter implementation</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> SecurityFilterFactory {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Integer level;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * injected parameter</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setLevel</span>(Integer level) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">level</span> = level;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Key <span xmlns="" class="perl_Keyword">public</span> FilterKey <span xmlns="" class="perl_Function">getKey</span>() {
<span xmlns="" class="line">​</span>        StandardFilterKey key = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">StandardFilterKey</span>();
<span xmlns="" class="line">​</span>        key.<span xmlns="" class="perl_Function">addParameter</span>( level );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> key;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Factory
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Filter <span xmlns="" class="perl_Function">getFilter</span>() {
<span xmlns="" class="line">​</span>        Query query = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">TermQuery</span>( <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Term</span>(<span xmlns="" class="perl_String">"level"</span>, level.<span xmlns="" class="perl_Function">toString</span>() ) );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">CachingWrapperFilter</span>( <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">QueryWrapperFilter</span>(query) );
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
				Note the method annotated <code class="classname">@Key</code> returns a <code class="classname">FilterKey</code> object. The returned object has a special contract: the key object must implement <code class="methodname">equals()</code> / <code class="methodname">hashCode()</code> so that two keys are equal if and only if the given <code class="classname">Filter</code> types are the same and the set of parameters are the same. In other words, two filter keys are equal if and only if the filters from which the keys are generated can be interchanged. The key object is used as a key in the cache mechanism.
			</div><div class="para">
				<code class="classname">@Key</code> methods are needed only if:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						the filter caching system is enabled (enabled by default)
					</div></li><li class="listitem"><div class="para">
						the filter has parameters
					</div></li></ul></div><div class="para">
				In most cases, using the <code class="literal">StandardFilterKey</code> implementation will be good enough. It delegates the <code class="methodname">equals()</code> / <code class="methodname">hashCode()</code> implementation to each of the parameters equals and hashcode methods.
			</div><div class="para">
				As mentioned before the defined filters are per default cached and the cache uses a combination of hard and soft references to allow disposal of memory when needed. The hard reference cache keeps track of the most recently used filters and transforms the ones least used to <code class="classname">SoftReferences</code> when needed. Once the limit of the hard reference cache is reached additional filters are cached as <code class="classname">SoftReferences</code>. To adjust the size of the hard reference cache, use <code class="literal">hibernate.search.filter.cache_strategy.size</code> (defaults to 128). For advanced use of filter caching, implement your own <code class="classname">FilterCachingStrategy</code>. The classname is defined by <code class="literal">hibernate.search.filter.cache_strategy</code>.
			</div><div class="para">
				This filter caching mechanism should not be confused with caching the actual filter results. In Lucene it is common practice to wrap filters using the <code class="classname">IndexReader</code> around a <code class="classname">CachingWrapperFilter.</code> The wrapper will cache the <code class="classname">DocIdSet</code> returned from the <code class="methodname">getDocIdSet(IndexReader reader)</code> method to avoid expensive recomputation. It is important to mention that the computed <code class="classname">DocIdSet</code> is only cachable for the same <code class="classname">IndexReader</code> instance, because the reader effectively represents the state of the index at the moment it was opened. The document list cannot change within an opened <code class="classname">IndexReader</code>. A different/new <code class="classname">IndexReader</code> instance, however, works potentially on a different set of <code class="classname">Document</code>s (either from a different index or simply because the index has changed), hence the cached <code class="classname">DocIdSet</code> has to be recomputed.
			</div><div class="para">
				Hibernate Search also helps with this aspect of caching. Per default the <code class="literal">cache</code> flag of <code class="classname">@FullTextFilterDef</code> is set to <code class="literal">FilterCacheModeType.INSTANCE_AND_DOCIDSETRESULTS</code> which will automatically cache the filter instance as well as wrap the specified filter around a Hibernate specific implementation of <code class="classname">CachingWrapperFilter</code>. In contrast to Lucene's version of this class <code class="classname">SoftReference</code>s are used together with a hard reference count (see discussion about filter cache). The hard reference count can be adjusted using <code class="literal">hibernate.search.filter.cache_docidresults.size</code> (defaults to 5). The wrapping behaviour can be controlled using the <code class="literal">@FullTextFilterDef.cache</code> parameter. There are three different values for this parameter:
			</div><div class="informaltable"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: center"> Value </th><th style="text-align: center"> Definition </th></tr></thead><tbody><tr><td style="text-align: left"> FilterCacheModeType.NONE </td><td style="text-align: left"> No filter instance and no result is cached by Hibernate Search. For every filter call, a new filter instance is created. This setting might be useful for rapidly changing data sets or heavily memory constrained environments. </td></tr><tr><td style="text-align: left"> FilterCacheModeType.INSTANCE_ONLY </td><td style="text-align: left"> The filter instance is cached and reused across concurrent <code class="methodname">Filter.getDocIdSet()</code> calls. <code class="classname">DocIdSet</code> results are not cached. This setting is useful when a filter uses its own specific caching mechanism or the filter results change dynamically due to application specific events making <code class="classname">DocIdSet</code> caching in both cases unnecessary. </td></tr><tr><td style="text-align: left"> FilterCacheModeType.INSTANCE_AND_DOCIDSETRESULTS </td><td style="text-align: left"> Both the filter instance and the <code class="classname">DocIdSet</code> results are cached. This is the default value. </td></tr></tbody></table></div><div class="para">
				Last but not least - why should filters be cached? There are two areas where filter caching shines:
			</div><div class="para">
				Filters should be cached in the following situations:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						the system does not update the targeted entity index often (in other words, the IndexReader is reused a lot)
					</div></li><li class="listitem"><div class="para">
						the Filter's DocIdSet is expensive to compute (compared to the time spent to execute the query)
					</div></li></ul></div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14239-768544+%5BLatest%5D&amp;comment=Title%3A+Filters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Using_Filters_in_a_Sharded_Environment">
      ⁠</a>14.3.3.1. Using Filters in a Sharded Environment</h3></div></div></div><div class="para">
		In a sharded environment it is possible to execute queries on a subset of the available shards. This can be done in two steps:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550811248368">
      ⁠</a><p class="title"><strong>Procedure 14.1.  Query a Subset of Index Shards </strong></p><ol class="1"><li class="step"><div class="para">
				Create a sharding strategy that does select a subset of <code class="classname">IndexManager</code>s depending on a filter configuration.
			</div></li><li class="step"><div class="para">
				Activate the filter at query time.
			</div></li></ol></div><div class="example"><a id="idm140550741822320">
      ⁠</a><p class="title"><strong>Example 14.54.  Query a Subset of Index Shards </strong></p><div class="example-contents"><div class="para">
			In this example the query is run against a specific customer shard if the <code class="literal">customer</code> filter is activated.
		</div><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> CustomerShardingStrategy <span xmlns="" class="perl_Keyword">implements</span> IndexShardingStrategy {
<span xmlns="" class="line">​</span>	
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Comment">// stored IndexManagers in a array indexed by customerID</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">private</span> IndexManager[] indexManagers;
<span xmlns="" class="line">​</span>	 
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> initialize(Properties properties, IndexManager[] indexManagers) {
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">indexManagers</span> = indexManagers;
<span xmlns="" class="line">​</span>	 }
<span xmlns="" class="line">​</span>	
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">public</span> IndexManager[] <span xmlns="" class="perl_Function">getIndexManagersForAllShards</span>() {
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">return</span> indexManagers;
<span xmlns="" class="line">​</span>	 }
<span xmlns="" class="line">​</span>	
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">public</span> IndexManager <span xmlns="" class="perl_Function">getIndexManagerForAddition</span>(
<span xmlns="" class="line">​</span>	     <span xmlns="" class="perl_Keyword">Class</span>&lt;?&gt; entity, Serializable id, String idInString, Document document) {
<span xmlns="" class="line">​</span>	   Integer customerID = Integer.<span xmlns="" class="perl_Function">parseInt</span>(document.<span xmlns="" class="perl_Function">getFieldable</span>(<span xmlns="" class="perl_String">"customerID"</span>).<span xmlns="" class="perl_Function">stringValue</span>());
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">return</span> indexManagers[customerID];
<span xmlns="" class="line">​</span>	 }
<span xmlns="" class="line">​</span>	
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">public</span> IndexManager[] <span xmlns="" class="perl_Function">getIndexManagersForDeletion</span>(
<span xmlns="" class="line">​</span>	     <span xmlns="" class="perl_Keyword">Class</span>&lt;?&gt; entity, Serializable id, String idInString) {
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">getIndexManagersForAllShards</span>();
<span xmlns="" class="line">​</span>	 }
<span xmlns="" class="line">​</span>	
<span xmlns="" class="line">​</span>	  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	  * Optimization; don't search ALL shards and union the results; in this case, we </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	  * can be certain that all the data for a particular customer Filter is in a single</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	  * shard; simply return that shard by customerID.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	  */</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">public</span> IndexManager[] <span xmlns="" class="perl_Function">getIndexManagersForQuery</span>(
<span xmlns="" class="line">​</span>	     FullTextFilterImplementor[] filters) {
<span xmlns="" class="line">​</span>	   FullTextFilter filter = <span xmlns="" class="perl_Function">getCustomerFilter</span>(filters, <span xmlns="" class="perl_String">"customer"</span>);
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">if</span> (filter == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>	     <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">getIndexManagersForAllShards</span>();
<span xmlns="" class="line">​</span>	   }
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>	     <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> IndexManager[] { indexManagers[Integer.<span xmlns="" class="perl_Function">parseInt</span>(
<span xmlns="" class="line">​</span>	       filter.<span xmlns="" class="perl_Function">getParameter</span>(<span xmlns="" class="perl_String">"customerID"</span>).<span xmlns="" class="perl_Function">toString</span>())] };
<span xmlns="" class="line">​</span>	   }
<span xmlns="" class="line">​</span>	 }
<span xmlns="" class="line">​</span>	
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">private</span> FullTextFilter <span xmlns="" class="perl_Function">getCustomerFilter</span>(FullTextFilterImplementor[] filters, String name) {
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">for</span> (FullTextFilterImplementor filter: filters) {
<span xmlns="" class="line">​</span>	     <span xmlns="" class="perl_Keyword">if</span> (filter.<span xmlns="" class="perl_Function">getName</span>().<span xmlns="" class="perl_Function">equals</span>(name)) <span xmlns="" class="perl_Keyword">return</span> filter;
<span xmlns="" class="line">​</span>	   }
<span xmlns="" class="line">​</span>	   <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>	 }
<span xmlns="" class="line">​</span>	}</pre></div></div><div class="para">
		In this example, if the filter named <code class="literal">customer</code> is present, only the shard dedicated to this customer is queried, otherwise, all shards are returned. A given Sharding strategy can react to one or more filters and depends on their parameters.
	</div><div class="para">
		The second step is to activate the filter at query time. While the filter can be a regular filter (as defined in <a class="xref" href="chap-Hibernate_Search.html#sect-Filters">Section 14.3.3, “Filters”</a>) which also filters Lucene results after the query, you can make use of a special filter that will only be passed to the sharding strategy (and is otherwise ignored).
	</div><div class="para">
		To use this feature, specify the <code class="classname">ShardSensitiveOnlyFilter</code> class when declaring your filter.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">FullTextFilterDef</span>(name=<span xmlns="" class="perl_String">"customer"</span>, impl=ShardSensitiveOnlyFilter.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>FullTextQuery query = ftEm.<span xmlns="" class="perl_Function">createFullTextQuery</span>(luceneQuery, Customer.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>query.<span xmlns="" class="perl_Function">enableFulltextFilter</span>(<span xmlns="" class="perl_String">"customer"</span>).<span xmlns="" class="perl_Function">setParameter</span>(<span xmlns="" class="perl_String">"CustomerID"</span>, <span xmlns="" class="perl_Float">5</span>);
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SuppressWarnings</span>(<span xmlns="" class="perl_String">"unchecked"</span>)
<span xmlns="" class="line">​</span>List&lt;Customer&gt; results = query.<span xmlns="" class="perl_Function">getResultList</span>();</pre><div class="para">
		Note that by using the <code class="classname">ShardSensitiveOnlyFilter</code>, you do not have to implement any Lucene filter. Using filters and sharding strategy reacting to these filters is recommended to speed up queries in a sharded environment.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14193-765525+%5BLatest%5D&amp;comment=Title%3A+Using+Filters+in+a+Sharded+Environment%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14193-765525+21+Jul+2015+01%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Faceting">
      ⁠</a>14.3.4. Faceting</h2></div></div></div><div class="para">
				Faceted search is a technique which allows the results of a query to be divided into multiple categories. This categorization includes the calculation of hit counts for each category and the ability to further restrict search results based on these facets (categories). <a class="xref" href="chap-Hibernate_Search.html#example-amazon-facets">Example 14.55, “Search for Hibernate Search on Amazon”</a> shows a faceting example. The search results in fifteen hits which are displayed on the main part of the page. The navigation bar on the left, however, shows the category<span class="emphasis"><em> Computers &amp; Internet</em></span> with its subcategories <span class="emphasis"><em>Programming</em></span>, <span class="emphasis"><em>Computer Science</em></span>, <span class="emphasis"><em>Databases</em></span>, <span class="emphasis"><em>Software</em></span>, <span class="emphasis"><em>Web Development,</em></span> <span class="emphasis"><em>Networking</em></span> and <span class="emphasis"><em>Home Computing</em></span>. For each of these subcategories the number of books is shown matching the main search criteria and belonging to the respective subcategory. This division of the category <span class="emphasis"><em>Computers &amp; Internet</em></span> is one concrete search facet. Another one is for example the average customer review.
			</div><div class="example"><a id="example-amazon-facets">
      ⁠</a><p class="title"><strong>Example 14.55. Search for Hibernate Search on Amazon</strong></p><div class="example-contents"><div class="para">
					In Hibernate Search, the classes <code class="classname">QueryBuilder</code> and <code class="classname">FullTextQuery</code> are the entry point into the faceting API. The former creates faceting requests and the latter accesses the <code class="classname">FacetManager</code>. The <code class="classname">FacetManager</code> applies faceting requests on a query and selects facets that are added to an existing query to refine search results. The examples use the entity <code class="classname">Cd</code> as shown in <a class="xref" href="chap-Hibernate_Search.html#example-faceting-entity">Example 14.56, “Entity Cd”</a>:
				</div></div></div><div class="figure"><a id="idm140550784187280">
      ⁠</a><div class="figure-contents"><div class="mediaobject" style="text-align: center"><img src="images/1605.png" align="middle" alt="Search for Hibernate Search on Amazon" style="text-align: middle"/></div></div><p class="title"><strong>Figure 14.1. Search for Hibernate Search on Amazon</strong></p></div><div class="example"><a id="example-faceting-entity">
      ⁠</a><p class="title"><strong>Example 14.56. Entity Cd</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Cd {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Fields</span>( {
<span xmlns="" class="line">​</span>        @Field,
<span xmlns="" class="line">​</span>        @<span xmlns="" class="perl_Function">Field</span>(name = <span xmlns="" class="perl_String">"name_un_analyzed"</span>, analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>    })
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Field</span>(analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>    @NumericField
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> price;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    Field(analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">DateBridge</span>(resolution = Resolution.<span xmlns="" class="perl_Function">YEAR</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Date releaseYear;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Field</span>(analyze = Analyze.<span xmlns="" class="perl_Function">NO</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String label;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// setter/getter</span>
<span xmlns="" class="line">​</span>...</pre></div></div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14277-748497+%5BLatest%5D&amp;comment=Title%3A+Faceting%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Creating_a_Faceting_Request">
      ⁠</a>14.3.4.1. Creating a Faceting Request</h3></div></div></div><div class="para">
		The first step towards a faceted search is to create the <code class="classname">FacetingRequest</code>. Currently two types of faceting requests are supported. The first type is called <span class="emphasis"><em>discrete faceting</em></span> and the second type <span class="emphasis"><em>range faceting</em></span> request. In the case of a discrete faceting request you specify on which index field you want to facet (categorize) and which faceting options to apply. An example for a discrete faceting request can be seen in <a class="xref" href="chap-Hibernate_Search.html#example-discrete-faceting">Example 14.57, “Creating a discrete faceting request”</a>:
	</div><div class="example"><a id="example-discrete-faceting">
      ⁠</a><p class="title"><strong>Example 14.57. Creating a discrete faceting request</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>QueryBuilder builder = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">buildQueryBuilder</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">forEntity</span>( Cd.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>            .<span xmlns="" class="perl_Function">get</span>();
<span xmlns="" class="line">​</span>FacetingRequest labelFacetingRequest = builder.<span xmlns="" class="perl_Function">facet</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">name</span>( <span xmlns="" class="perl_String">"labelFaceting"</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>( <span xmlns="" class="perl_String">"label"</span>)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">discrete</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">orderedBy</span>( FacetSortOrder.<span xmlns="" class="perl_Function">COUNT_DESC</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">includeZeroCounts</span>( <span xmlns="" class="perl_Keyword">false</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">maxFacetCount</span>( <span xmlns="" class="perl_Float">1</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createFacetingRequest</span>();</pre></div></div><div class="para">
		When executing this faceting request a <code class="classname">Facet</code> instance will be created for each discrete value for the indexed field <code class="constant">label</code>. The <code class="classname">Facet</code> instance will record the actual field value including how often this particular field value occurs within the original query results. <code class="methodname">orderedBy</code>, <code class="methodname">includeZeroCounts</code> and <code class="methodname">maxFacetCount</code> are optional parameters which can be applied on any faceting request. <code class="methodname">orderedBy</code> allows to specify in which order the created facets will be returned. The default is <code class="constant">FacetSortOrder.COUNT_DESC</code>, but you can also sort on the field value or the order in which ranges were specified. <code class="methodname">includeZeroCount</code> determines whether facets with a count of 0 will be included in the result (per default they are) and <code class="methodname">maxFacetCount</code> allows to limit the maximum amount of facets returned.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			At the moment there are several preconditions an indexed field has to meet in order to apply faceting on it. The indexed property must be of type <code class="classname">String</code>, <code class="classname">Date</code> or a subtype of <code class="classname">Number</code> and <code class="constant">null</code> values should be avoided. Furthermore the property has to be indexed with <code class="constant">Analyze.NO</code> and in case of a numeric property <code class="classname">@NumericField</code> needs to be specified.
		</div></div></div><div class="para">
		The creation of a range faceting request is quite similar except that we have to specify ranges for the field values we are faceting on. A range faceting request can be seen in <a class="xref" href="chap-Hibernate_Search.html#example-range-faceting">Example 14.58, “Creating a range faceting request”</a> where three different price ranges are specified. <code class="methodname">below</code> and <code class="methodname">above</code> can only be specified once, but you can specify as many <code class="methodname">from</code> - <code class="methodname">to</code> ranges as you want. For each range boundary you can also specify via <code class="methodname">excludeLimit</code> whether it is included into the range or not.
	</div><div class="example"><a id="example-range-faceting">
      ⁠</a><p class="title"><strong>Example 14.58. Creating a range faceting request</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>QueryBuilder builder = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">buildQueryBuilder</span>()
<span xmlns="" class="line">​</span>        .<span xmlns="" class="perl_Function">forEntity</span>( Cd.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>            .<span xmlns="" class="perl_Function">get</span>();
<span xmlns="" class="line">​</span>FacetingRequest priceFacetingRequest = builder.<span xmlns="" class="perl_Function">facet</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">name</span>( <span xmlns="" class="perl_String">"priceFaceting"</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">onField</span>( <span xmlns="" class="perl_String">"price"</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">range</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">below</span>( <span xmlns="" class="perl_Float">1000</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">from</span>( <span xmlns="" class="perl_Float">1001</span> ).<span xmlns="" class="perl_Function">to</span>( <span xmlns="" class="perl_Float">1500</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">above</span>( <span xmlns="" class="perl_Float">1500</span> ).<span xmlns="" class="perl_Function">excludeLimit</span>()
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">createFacetingRequest</span>();</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14271-592110+%5BLatest%5D&amp;comment=Title%3A+Creating+a+Faceting+Request%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14271-592110+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Applying_a_Faceting_Request">
      ⁠</a>14.3.4.2. Applying a Faceting Request</h3></div></div></div><div class="para">
		A faceting request is applied to a query via the <code class="classname">FacetManager</code> class which can be retrieved via the <code class="classname">FullTextQuery</code> class.
	</div><div class="para">
		You can enable as many faceting requests as you like and retrieve them afterwards via <code class="methodname">getFacets()</code> specifying the faceting request name. There is also a <code class="methodname">disableFaceting()</code> method which allows you to disable a faceting request by specifying its name.
	</div><div class="example"><a id="example-applying-faceting">
      ⁠</a><p class="title"><strong>Example 14.59. Applying a faceting request</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// create a fulltext query</span>
<span xmlns="" class="line">​</span>Query luceneQuery = builder.<span xmlns="" class="perl_Function">all</span>().<span xmlns="" class="perl_Function">createQuery</span>(); <span xmlns="" class="perl_Comment">// match all query</span>
<span xmlns="" class="line">​</span>FullTextQuery fullTextQuery = fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, Cd.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// retrieve facet manager and apply faceting request</span>
<span xmlns="" class="line">​</span>FacetManager facetManager = fullTextQuery.<span xmlns="" class="perl_Function">getFacetManager</span>();
<span xmlns="" class="line">​</span>facetManager.<span xmlns="" class="perl_Function">enableFaceting</span>( priceFacetingRequest );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// get the list of Cds </span>
<span xmlns="" class="line">​</span>List&lt;Cd&gt; cds = fullTextQuery.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// retrieve the faceting results</span>
<span xmlns="" class="line">​</span>List&lt;Facet&gt; facets = facetManager.<span xmlns="" class="perl_Function">getFacets</span>( <span xmlns="" class="perl_String">"priceFaceting"</span> );
<span xmlns="" class="line">​</span>...</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14249-748527+%5BLatest%5D&amp;comment=Title%3A+Applying+a+Faceting+Request%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14249-748527+24+Mar+2015+23%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Restricting_Query_Results">
      ⁠</a>14.3.4.3. Restricting Query Results</h3></div></div></div><div class="para">
		Last but not least, you can apply any of the returned <code class="classname">Facet</code>s as additional criteria on your original query in order to implement a "drill-down" functionality. For this purpose <code class="classname">FacetSelection</code> can be utilized. <code class="classname">FacetSelection</code>s are available via the <code class="classname">FacetManager</code> and allow you to select a facet as query criteria (<code class="methodname">selectFacets</code>), remove a facet restriction (<code class="methodname">deselectFacets</code>), remove all facet restrictions (<code class="methodname">clearSelectedFacets</code>) and retrieve all currently selected facets (<code class="methodname">getSelectedFacets</code>). <a class="xref" href="chap-Hibernate_Search.html#example-restricting-query-results">Example 14.60, “Restricting query results via the application of a <code class="classname">FacetSelection</code>”</a> shows an example.
	</div><div class="example"><a id="example-restricting-query-results">
      ⁠</a><p class="title"><strong>Example 14.60. Restricting query results via the application of a <code class="classname">FacetSelection</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// create a fulltext query</span>
<span xmlns="" class="line">​</span>Query luceneQuery = builder.<span xmlns="" class="perl_Function">all</span>().<span xmlns="" class="perl_Function">createQuery</span>(); <span xmlns="" class="perl_Comment">// match all query</span>
<span xmlns="" class="line">​</span>FullTextQuery fullTextQuery = fullTextSession.<span xmlns="" class="perl_Function">createFullTextQuery</span>( luceneQuery, clazz );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// retrieve facet manager and apply faceting request</span>
<span xmlns="" class="line">​</span>FacetManager facetManager = fullTextQuery.<span xmlns="" class="perl_Function">getFacetManager</span>();
<span xmlns="" class="line">​</span>facetManager.<span xmlns="" class="perl_Function">enableFaceting</span>( priceFacetingRequest );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// get the list of Cd </span>
<span xmlns="" class="line">​</span>List&lt;Cd&gt; cds = fullTextQuery.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Function">assertTrue</span>(cds.<span xmlns="" class="perl_Function">size</span>() == <span xmlns="" class="perl_Float">10</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// retrieve the faceting results</span>
<span xmlns="" class="line">​</span>List&lt;Facet&gt; facets = facetManager.<span xmlns="" class="perl_Function">getFacets</span>( <span xmlns="" class="perl_String">"priceFaceting"</span> );
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Function">assertTrue</span>(facets.<span xmlns="" class="perl_Function">get</span>(<span xmlns="" class="perl_Float">0</span>).<span xmlns="" class="perl_Function">getCount</span>() == <span xmlns="" class="perl_Float">2</span>)
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// apply first facet as additional search criteria</span>
<span xmlns="" class="line">​</span>facetManager.<span xmlns="" class="perl_Function">getFacetGroup</span>( <span xmlns="" class="perl_String">"priceFaceting"</span> ).<span xmlns="" class="perl_Function">selectFacets</span>( facets.<span xmlns="" class="perl_Function">get</span>( <span xmlns="" class="perl_Float">0</span> ) );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// re-execute the query</span>
<span xmlns="" class="line">​</span>cds = fullTextQuery.<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Function">assertTrue</span>(cds.<span xmlns="" class="perl_Function">size</span>() == <span xmlns="" class="perl_Float">2</span>);</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14258-592108+%5BLatest%5D&amp;comment=Title%3A+Restricting+Query+Results%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14258-592108+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Optimizing_the_Query_Process">
      ⁠</a>14.3.5. Optimizing the Query Process</h2></div></div></div><div class="para">
				Query performance depends on several criteria:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						The Lucene query.
					</div></li><li class="listitem"><div class="para">
						The number of objects loaded: use pagination (always) or index projection (if needed).
					</div></li><li class="listitem"><div class="para">
						The way Hibernate Search interacts with the Lucene readers: defines the appropriate reader strategy.
					</div></li><li class="listitem"><div class="para">
						Caching frequently extracted values from the index: see <a class="xref" href="chap-Hibernate_Search.html#Caching_Index_Values_FieldCache">Section 14.3.5.1, “Caching Index Values: FieldCache”</a>
					</div></li></ul></div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14242-748532+%5BLatest%5D&amp;comment=Title%3A+Optimizing+the+Query+Process%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Caching_Index_Values_FieldCache">
      ⁠</a>14.3.5.1. Caching Index Values: FieldCache</h3></div></div></div><div class="para">
		The primary function of a Lucene index is to identify matches to your queries. After the query is performed the results must be analyzed to extract useful information. Hibernate Search would typically need to extract the Class type and the primary key.
	</div><div class="para">
		Extracting the needed values from the index has a performance cost, which in some cases might be very low and not noticeable, but in some other cases might be a good candidate for caching.
	</div><div class="para">
		The requirements depend on the kind of Projections being used (see <a class="xref" href="chap-Hibernate_Search.html#Projection">Section 14.3.1.10.5, “Projection”</a>), as in some cases the Class type is not needed as it can be inferred from the query context or other means.
	</div><div class="para">
		Using the @<code class="classname">CacheFromIndex</code> annotation you can experiment with different kinds of caching of the main metadata fields required by Hibernate Search:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import static org.hibernate.search.annotations.FieldCacheType.CLASS;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import static org.hibernate.search.annotations.FieldCacheType.ID;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Indexed
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">CacheFromIndex</span>( { <span xmlns="" class="perl_Keyword">CLASS</span>, ID } )
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Essay {
<span xmlns="" class="line">​</span>    ...</pre><div class="para">
		It is possible to cache Class types and IDs using this annotation:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="constant">CLASS</code>: Hibernate Search will use a Lucene FieldCache to improve peformance of the Class type extraction from the index.
			</div><div class="para">
				This value is enabled by default, and is what Hibernate Search will apply if you don't specify the @<code class="classname">CacheFromIndex</code> annotation.
			</div></li><li class="listitem"><div class="para">
				<code class="constant">ID</code>: Extracting the primary identifier will use a cache. This is likely providing the best performing queries, but will consume much more memory which in turn might reduce performance.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Measure the performance and memory consumption impact after warmup (executing some queries). Performance may improve by enabling Field Caches but this is not always the case.
		</div></div></div><div class="para">
		Using a FieldCache has two downsides to consider:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Memory usage: these caches can be quite memory hungry. Typically the CLASS cache has lower requirements than the ID cache.
			</div></li><li class="listitem"><div class="para">
				Index warmup: when using field caches, the first query on a new index or segment will be slower than when you don't have caching enabled.
			</div></li></ul></div><div class="para">
		With some queries the classtype won't be needed at all, in that case even if you enabled the <code class="constant">CLASS</code> field cache, this might not be used; for example if you are targeting a single class, obviously all returned values will be of that type (this is evaluated at each Query execution).
	</div><div class="para">
		For the ID FieldCache to be used, the ids of targeted entities must be using a <code class="classname">TwoWayFieldBridge</code> (as all builting bridges), and all types being loaded in a specific query must use the fieldname for the id, and have ids of the same type (this is evaluated at each Query execution).
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14198-748547+%5BLatest%5D&amp;comment=Title%3A+Caching+Index+Values%3A+FieldCache%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14198-748547+24+Mar+2015+23%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Manual_Index_Changes">
      ⁠</a>14.4. Manual Index Changes</h1></div></div></div><div class="para">
			As Hibernate Core applies changes to the database, Hibernate Search detects these changes and will update the index automatically (unless the EventListeners are disabled). Sometimes changes are made to the database without using Hibernate, as when backup is restored or your data is otherwise affected. In these cases Hibernate Search exposes the Manual Index APIs to explicitly update or remove a single entity from the index, rebuild the index for the whole database, or remove all references to a specific type.
		</div><div class="para">
			All these methods affect the Lucene Index only, no changes are applied to the database.
		</div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14218-748554+%5BLatest%5D&amp;comment=Title%3A+Manual+Index+Changes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Adding_Instances_to_the_Index">
      ⁠</a>14.4.1. Adding Instances to the Index</h2></div></div></div><div class="para">
		Using <code class="classname">FullTextSession</code>.<code class="methodname">index(T entity)</code> you can directly add or update a specific object instance to the index. If this entity was already indexed, then the index will be updated. Changes to the index are only applied at transaction commit.
	</div><div class="example"><a id="idm140550813163840">
      ⁠</a><p class="title"><strong>Example 14.61. Indexing an entity via FullTextSession.index(T entity)</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(session);
<span xmlns="" class="line">​</span>Transaction tx = fullTextSession.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>Object customer = fullTextSession.<span xmlns="" class="perl_Function">load</span>( Customer.<span xmlns="" class="perl_Function">class</span>, <span xmlns="" class="perl_Float">8</span> );
<span xmlns="" class="line">​</span>fullTextSession.<span xmlns="" class="perl_Function">index</span>(customer);
<span xmlns="" class="line">​</span>tx.<span xmlns="" class="perl_Function">commit</span>(); <span xmlns="" class="perl_Comment">//index only updated at commit time</span></pre></div></div><div class="para">
		In case you want to add all instances for a type, or for all indexed types, the recommended approach is to use a <code class="classname">MassIndexer</code>: see <a class="xref" href="chap-Hibernate_Search.html#Using_a_MassIndexer">Section 14.4.3.2, “Using a MassIndexer”</a> for more details.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14274-592110+%5BLatest%5D&amp;comment=Title%3A+Adding+Instances+to+the+Index%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14274-592110+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Deleting_Instances_from_the_Index">
      ⁠</a>14.4.2. Deleting Instances from the Index</h2></div></div></div><div class="para">
		It is equally possible to remove an entity or all entities of a given type from a Lucene index without the need to physically remove them from the database. This operation is named purging and is also done through the <code class="classname">FullTextSession</code>.
	</div><div class="example"><a id="idm140550787911776">
      ⁠</a><p class="title"><strong>Example 14.62. Purging a specific instance of an entity from the index</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(session);
<span xmlns="" class="line">​</span>Transaction tx = fullTextSession.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">for</span> (Customer customer : customers) {
<span xmlns="" class="line">​</span>    fullTextSession.<span xmlns="" class="perl_Function">purge</span>( Customer.<span xmlns="" class="perl_Function">class</span>, customer.<span xmlns="" class="perl_Function">getId</span>() );
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>tx.<span xmlns="" class="perl_Function">commit</span>(); <span xmlns="" class="perl_Comment">//index is updated at commit time</span></pre></div></div><div class="para">
		Purging will remove the entity with the given id from the Lucene index but will not touch the database.
	</div><div class="para">
		If you need to remove all entities of a given type, you can use the <code class="methodname">purgeAll</code> method. This operation removes all entities of the type passed as a parameter as well as all its subtypes.
	</div><div class="example"><a id="idm140550797226608">
      ⁠</a><p class="title"><strong>Example 14.63. Purging all instances of an entity from the index</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(session);
<span xmlns="" class="line">​</span>Transaction tx = fullTextSession.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>fullTextSession.<span xmlns="" class="perl_Function">purgeAll</span>( Customer.<span xmlns="" class="perl_Function">class</span> );
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//optionally optimize the index</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//fullTextSession.getSearchFactory().optimize( Customer.class );</span>
<span xmlns="" class="line">​</span>tx.<span xmlns="" class="perl_Function">commit</span>(); <span xmlns="" class="perl_Comment">//index changes are applied at commit time</span></pre></div></div><div class="para">
		It is recommended to optimize the index after such an operation.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Methods <code class="methodname">index</code>, <code class="methodname">purge</code>, and <code class="methodname">purgeAll</code> are available on <code class="classname">FullTextEntityManager</code> as well.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			All manual indexing methods (<code class="methodname">index</code>, <code class="methodname">purge</code>, and <code class="methodname">purgeAll</code>) only affect the index, not the database, nevertheless they are transactional and as such they won't be applied until the transaction is successfully committed, or you make use of <code class="methodname">flushToIndexes</code>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14200-592106+%5BLatest%5D&amp;comment=Title%3A+Deleting+Instances+from+the+Index%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14200-592106+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Rebuilding_the_Index">
      ⁠</a>14.4.3. Rebuilding the Index</h2></div></div></div><div class="para">
				If you change the entity mapping to the index, chances are that the whole Index needs to be updated; For example if you decide to index a an existing field using a different analyzer you'll need to rebuild the index for affected types. Also if the Database is replaced (like restored from a backup, imported from a legacy system) you'll want to be able to rebuild the index from existing data. Hibernate Search provides two main strategies to choose from:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Using <code class="classname">FullTextSession</code>.<code class="methodname">flushToIndexes()</code> periodically, while using <code class="classname">FullTextSession</code>.<code class="methodname">index()</code> on all entities.
					</div></li><li class="listitem"><div class="para">
						Use a <code class="classname">MassIndexer</code>.
					</div></li></ul></div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14210-592105+%5BLatest%5D&amp;comment=Title%3A+Rebuilding+the+Index%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Using_flushToIndexes">
      ⁠</a>14.4.3.1. Using flushToIndexes()</h3></div></div></div><div class="para">
		This strategy consists of removing the existing index and then adding all entities back to the index using <code class="classname">FullTextSession</code>.<code class="methodname">purgeAll()</code> and <code class="classname">FullTextSession</code>.<code class="methodname">index()</code>, however there are some memory and efficiency constraints. For maximum efficiency Hibernate Search batches index operations and executes them at commit time. If you expect to index a lot of data you need to be careful about memory consumption since all documents are kept in a queue until the transaction commit. You can potentially face an <code class="classname">OutOfMemoryException</code> if you don't empty the queue periodically; to do this use <code class="methodname">fullTextSession.flushToIndexes()</code>. Every time <code class="methodname">fullTextSession.flushToIndexes()</code> is called (or if the transaction is committed), the batch queue is processed, applying all index changes. Be aware that, once flushed, the changes cannot be rolled back.
	</div><div class="example"><a id="idm140550768552928">
      ⁠</a><p class="title"><strong>Example 14.64. Index rebuilding using index() and flushToIndexes()</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>fullTextSession.<span xmlns="" class="perl_Function">setFlushMode</span>(FlushMode.<span xmlns="" class="perl_Function">MANUAL</span>);
<span xmlns="" class="line">​</span>fullTextSession.<span xmlns="" class="perl_Function">setCacheMode</span>(CacheMode.<span xmlns="" class="perl_Function">IGNORE</span>);
<span xmlns="" class="line">​</span>transaction = fullTextSession.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">//Scrollable results will avoid loading too many objects in memory</span>
<span xmlns="" class="line">​</span>ScrollableResults results = fullTextSession.<span xmlns="" class="perl_Function">createCriteria</span>( Email.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">setFetchSize</span>(BATCH_SIZE)
<span xmlns="" class="line">​</span>    .<span xmlns="" class="perl_Function">scroll</span>( ScrollMode.<span xmlns="" class="perl_Function">FORWARD_ONLY</span> );
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">int</span> index = <span xmlns="" class="perl_Float">0</span>;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">while</span>( results.<span xmlns="" class="perl_Function">next</span>() ) {
<span xmlns="" class="line">​</span>    index++;
<span xmlns="" class="line">​</span>    fullTextSession.<span xmlns="" class="perl_Function">index</span>( results.<span xmlns="" class="perl_Function">get</span>(<span xmlns="" class="perl_Float">0</span>) ); <span xmlns="" class="perl_Comment">//index each element</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (index % BATCH_SIZE == <span xmlns="" class="perl_Float">0</span>) {
<span xmlns="" class="line">​</span>        fullTextSession.<span xmlns="" class="perl_Function">flushToIndexes</span>(); <span xmlns="" class="perl_Comment">//apply changes to indexes</span>
<span xmlns="" class="line">​</span>        fullTextSession.<span xmlns="" class="perl_Function">clear</span>(); <span xmlns="" class="perl_Comment">//free memory since the queue is processed</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>transaction.<span xmlns="" class="perl_Function">commit</span>();</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			<code class="literal">hibernate.search.default.worker.batch_size</code> has been deprecated in favor of this explicit API which provides better control
		</div></div></div><div class="para">
		Try to use a batch size that guarantees that your application will not be out of memory: with a bigger batch size objects are fetched faster from database but more memory is needed.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14192-748558+%5BLatest%5D&amp;comment=Title%3A+Using+flushToIndexes%28%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14192-748558+25+Mar+2015+00%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Using_a_MassIndexer">
      ⁠</a>14.4.3.2. Using a MassIndexer</h3></div></div></div><div class="para">
		Hibernate Search's <code class="classname">MassIndexer</code> uses several parallel threads to rebuild the index. You can optionally select which entities need to be reloaded or have it reindex all entities. This approach is optimized for best performance but requires to set the application in maintenance mode. Querying the index is not recommended when a MassIndexer is busy.
	</div><div class="example"><a id="idm140550731882496">
      ⁠</a><p class="title"><strong>Example 14.65. Rebuild the Index Using a MassIndexer</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>fullTextSession.<span xmlns="" class="perl_Function">createIndexer</span>().<span xmlns="" class="perl_Function">startAndWait</span>();</pre></div></div><div class="para">
		This will rebuild the index, deleting it and then reloading all entities from the database. Although it is simple to use, some tweaking is recommended to speed up the process.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			During the progress of a MassIndexer the content of the index is undefined! If a query is performed while the MassIndexer is working most likely some results will be missing.
		</div></div></div><div class="example"><a id="idm140550798329616">
      ⁠</a><p class="title"><strong>Example 14.66. Using a Tuned MassIndexer</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>fullTextSession
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">createIndexer</span>( User.<span xmlns="" class="perl_Function">class</span> )
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">batchSizeToLoadObjects</span>( <span xmlns="" class="perl_Float">25</span> )
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">cacheMode</span>( CacheMode.<span xmlns="" class="perl_Function">NORMAL</span> )
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">threadsToLoadObjects</span>( <span xmlns="" class="perl_Float">12</span> )
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">idFetchSize</span>( <span xmlns="" class="perl_Float">150</span> )
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">progressMonitor</span>( monitor ) <span xmlns="" class="perl_Comment">//a MassIndexerProgressMonitor implementation</span>
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">startAndWait</span>();</pre></div></div><div class="para">
		This will rebuild the index of all User instances (and subtypes), and will create 12 parallel threads to load the User instances using batches of 25 objects per query. These same 12 threads will also need to process indexed embedded relations and custom <code class="classname">FieldBridge</code>s or <code class="classname">ClassBridge</code>s to output a Lucene document. The threads trigger lazyloading of additional attributes during the conversion process. Because of this, a high number of threads working in parallel is required. The number of threads working on actual index writing is defined by the backend configuration of each index. 
	</div><div class="para">
		It is recommended to leave cacheMode to <code class="literal">CacheMode.IGNORE</code> (the default), as in most reindexing situations the cache will be a useless additional overhead. It might be useful to enable some other <code class="literal">CacheMode</code> depending on your data as it could increase performance if the main entity is relating to enum-like data included in the index.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The ideal of number of threads to achieve best performance is highly dependent on your overall architecture, database design and data values. All internal thread groups have meaningful names so they should be easily identified with most diagnostic tools, including threaddumps.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The MassIndexer is unaware of transactions, therefore there is no need to begin one or commit afterward. Because it is not transactional it is not recommended to let users use the system during its processing, as it is unlikely people will be able to find results and the system load might be too high anyway.
		</div></div></div><div class="para">
		Other parameters which affect indexing time and memory consumption are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].exclusive_index_use</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_buffered_docs</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_merge_docs</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_factor</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_min_size</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_max_size</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_max_optimize_size</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_calibrate_by_deletes</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.ram_buffer_size</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.term_index_interval</code>
			</div></li></ul></div><div class="para">
		Previous versions also had a <code class="literal">max_field_length</code> but this was removed from Lucene, it's possible to obtain a similar effect by using a <code class="classname">LimitTokenCountAnalyzer</code>.
	</div><div class="para">
		All <code class="literal">.indexwriter</code> parameters are Lucene specific and Hibernate Search passes these parameters through.
	</div><div class="para">
		The <code class="classname">MassIndexer</code> uses a forward only scrollable result to iterate on the primary keys to be loaded, but MySQL's JDBC driver will load all values in memory. To avoid this "optimization" set <code class="literal">idFetchSize</code> to <code class="literal">Integer.MIN_VALUE</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14235-750257+%5BLatest%5D&amp;comment=Title%3A+Using+a+MassIndexer%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14235-750257+09+Apr+2015+07%3A02+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Index_Optimization">
      ⁠</a>14.5. Index Optimization</h1></div></div></div><div class="para">
			From time to time, the Lucene index needs to be optimized. The process is essentially a defragmentation. Until an optimization is triggered Lucene only marks deleted documents as such, no physical are applied. During the optimization process the deletions will be applied which also affects the number of files in the Lucene Directory.
		</div><div class="para">
			Optimizing the Lucene index speeds up searches but has no effect on the indexation (update) performance. During an optimization, searches can be performed, but will most likely be slowed down. All index updates will be stopped. It is recommended to schedule optimization:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					On an idle system or when searches are least frequent.
				</div></li><li class="listitem"><div class="para">
					After a large number of index modifications are applied.
				</div></li></ul></div><div class="para">
			<code class="classname">MassIndexer</code> (see <a class="xref" href="chap-Hibernate_Search.html#Using_a_MassIndexer">Section 14.4.3.2, “Using a MassIndexer”</a>) optimizes indexes by default at the start and at the end of processing. Use <code class="classname">MassIndexer</code>.<code class="methodname">optimizeAfterPurge</code> and <code class="classname">MassIndexer</code>.<code class="methodname">optimizeOnFinish</code> to change this default behavior.
		</div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A14215-765622+%5BLatest%5D&amp;comment=Title%3A+Index+Optimization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Automatic_Optimization">
      ⁠</a>14.5.1. Automatic Optimization</h2></div></div></div><div class="para">
		Hibernate Search can automatically optimize an index after either:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				a certain amount of operations (insertion or deletion).
			</div></li><li class="listitem"><div class="para">
				a certain amount of transactions.
			</div></li></ul></div><div class="para">
		The configuration for automatic index optimization can be defined either globally or per index:
	</div><div class="example"><a id="idm140550777904000">
      ⁠</a><p class="title"><strong>Example 14.67. Defining automatic optimization parameters</strong></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.operation_limit.max = 1000
hibernate.search.default.optimizer.transaction_limit.max = 100
hibernate.search.Animal.optimizer.transaction_limit.max = 50</pre></div></div><div class="para">
		An optimization will be triggered to the <code class="literal">Animal</code> index as soon as either:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				the number of additions and deletions reaches <code class="literal">1000</code>.
			</div></li><li class="listitem"><div class="para">
				the number of transactions reaches <code class="literal">50</code> (<code class="constant">hibernate.search.Animal.optimizer.transaction_limit.max</code> has priority over <code class="constant">hibernate.search.default.optimizer.transaction_limit.max</code>)
			</div></li></ul></div><div class="para">
		If none of these parameters are defined, no optimization is processed automatically.
	</div><div class="para">
		The default implementation of OptimizerStrategy can be overridden by implementing <code class="literal">org.hibernate.search.store.optimization.OptimizerStrategy</code> and setting the <code class="literal">optimizer.implementation</code> property to the fully qualified name of your implementation. This implementation must implement the interface, be a public class and have a public constructor taking no arguments.
	</div><div class="example"><a id="idm140550786025360">
      ⁠</a><p class="title"><strong>Example 14.68. Loading a custom OptimizerStrategy</strong></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.implementation = com.acme.worlddomination.SmartOptimizer
hibernate.search.default.optimizer.SomeOption = CustomConfigurationValue
hibernate.search.humans.optimizer.implementation = default</pre></div></div><div class="para">
		The keyword <code class="literal">default</code> can be used to select the Hibernate Search default implementation; all properties after the <code class="literal">.optimizer</code> key separator will be passed to the implementation's <code class="methodname">initialize</code> method at start.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14262-748574+%5BLatest%5D&amp;comment=Title%3A+Automatic+Optimization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14262-748574+25+Mar+2015+00%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Manual_Optimization">
      ⁠</a>14.5.2. Manual Optimization</h2></div></div></div><div class="para">
		You can programmatically optimize (defragment) a Lucene index from Hibernate Search through the <code class="classname">SearchFactory</code>:
	</div><div class="example"><a id="idm140550720453952">
      ⁠</a><p class="title"><strong>Example 14.69. Programmatic Index Optimization</strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(regularSession);
<span xmlns="" class="line">​</span>SearchFactory searchFactory = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>searchFactory.<span xmlns="" class="perl_Function">optimize</span>(Order.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// or</span>
<span xmlns="" class="line">​</span>searchFactory.<span xmlns="" class="perl_Function">optimize</span>();</pre></div></div><div class="para">
		The first example optimizes the Lucene index holding <code class="classname">Order</code>s and the second optimizes all indexes.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			<code class="literal">searchFactory.optimize()</code> has no effect on a JMS backend. You must apply the optimize operation on the Master node.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14233-592107+%5BLatest%5D&amp;comment=Title%3A+Manual+Optimization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14233-592107+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Adjusting_Optimization">
      ⁠</a>14.5.3. Adjusting Optimization</h2></div></div></div><div class="para">
		Apache Lucene has a few parameters to influence how optimization is performed. Hibernate Search exposes those parameters.
	</div><div class="para">
		Further index optimization parameters include:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_buffered_docs</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_merge_docs</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_factor</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.ram_buffer_size</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.term_index_interval</code>
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14237-747226+%5BLatest%5D&amp;comment=Title%3A+Adjusting+Optimization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14237-747226+16+Mar+2015+00%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Advanced_Features">
      ⁠</a>14.6. Advanced Features</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Accessing_the_SearchFactory">
      ⁠</a>14.6.1. Accessing the SearchFactory</h2></div></div></div><div class="para">
		The <code class="classname">SearchFactory</code> object keeps track of the underlying Lucene resources for Hibernate Search. It is a convenient way to access Lucene natively. The <code class="literal">SearchFactory</code> can be accessed from a <code class="classname">FullTextSession</code>:
	</div><div class="example"><a id="idm140550789372192">
      ⁠</a><p class="title"><strong>Example 14.70. Accessing the <code class="classname">SearchFactory</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>FullTextSession fullTextSession = Search.<span xmlns="" class="perl_Function">getFullTextSession</span>(regularSession);
<span xmlns="" class="line">​</span>SearchFactory searchFactory = fullTextSession.<span xmlns="" class="perl_Function">getSearchFactory</span>();</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14208-592105+%5BLatest%5D&amp;comment=Title%3A+Accessing+the+SearchFactory%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14208-592105+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_an_IndexReader">
      ⁠</a>14.6.2. Using an IndexReader</h2></div></div></div><div class="para">
		Queries in Lucene are executed on an <code class="classname">IndexReader</code>. Hibernate Search might cache index readers to maximize performance, or provide other efficient strategies to retrieve an updated <code class="classname">IndexReader</code> minimizing I/O operations. Your code can access these cached resources, but there are several requirements.
	</div><div class="example"><a id="idm140550799085792">
      ⁠</a><p class="title"><strong>Example 14.71. Accessing an <code class="classname">IndexReader</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>IndexReader reader = searchFactory.<span xmlns="" class="perl_Function">getIndexReaderAccessor</span>().<span xmlns="" class="perl_Function">open</span>(Order.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">//perform read-only operations on the reader</span>
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">finally</span> {
<span xmlns="" class="line">​</span>   searchFactory.<span xmlns="" class="perl_Function">getIndexReaderAccessor</span>().<span xmlns="" class="perl_Function">close</span>(reader);
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
		In this example the <code class="classname">SearchFactory</code> determines which indexes are needed to query this entity (considering a Sharding strategy). Using the configured <code class="classname">ReaderProvider</code> on each index, it returns a compound <code class="literal">IndexReader</code> on top of all involved indexes. Because this <code class="classname">IndexReader</code> is shared amongst several clients, you must adhere to the following rules:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Never call indexReader.close(), instead use readerProvider.closeReader(reader) when necessary, preferably in a finally block.
			</div></li><li class="listitem"><div class="para">
				Don not use this <code class="classname">IndexReader</code> for modification operations (it is a readonly <code class="classname">IndexReader</code>, and any such attempt will result in an exception).
			</div></li></ul></div><div class="para">
		Aside from those rules, you can use the <code class="classname">IndexReader</code> freely, especially to do native Lucene queries. Using the shared <code class="classname">IndexReader</code>s will make most queries more efficient than by opening one directly from, for example, the filesystem.
	</div><div class="para">
		As an alternative to the method <code class="methodname">open(Class... types)</code> you can use <code class="methodname">open(String... indexNames)</code>, allowing you to pass in one or more index names. Using this strategy you can also select a subset of the indexes for any indexed type if sharding is used.
	</div><div class="example"><a id="idm140550720120816">
      ⁠</a><p class="title"><strong>Example 14.72. Accessing an <code class="classname">IndexReader by index names</code></strong></p><div class="example-contents"><pre class="programlisting Java"><span xmlns="" class="line">​</span>IndexReader reader = searchFactory.<span xmlns="" class="perl_Function">getIndexReaderAccessor</span>().<span xmlns="" class="perl_Function">open</span>(<span xmlns="" class="perl_String">"Products.1"</span>, <span xmlns="" class="perl_String">"Products.3"</span>);</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14220-748732+%5BLatest%5D&amp;comment=Title%3A+Using+an+IndexReader%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14220-748732+25+Mar+2015+22%3A39+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Accessing_a_Lucene_Directory">
      ⁠</a>14.6.3. Accessing a Lucene Directory</h2></div></div></div><div class="para">
		A <code class="classname">Directory</code> is the most common abstraction used by Lucene to represent the index storage; Hibernate Search doesn't interact directly with a Lucene <code class="classname">Directory</code> but abstracts these interactions via an <code class="classname">IndexManager</code>: an index does not necessarily need to be implemented by a <code class="classname">Directory</code>.
	</div><div class="para">
		If you know your index is represented as a <code class="classname">Directory</code> and need to access it, you can get a reference to the <code class="classname">Directory</code> via the <code class="classname">IndexManager</code>. Cast the <code class="classname">IndexManager</code> to a <code class="classname">DirectoryBasedIndexManager</code> and then use <code class="literal">getDirectoryProvider().getDirectory()</code> to get a reference to the underlying <code class="classname">Directory</code>. This is not recommended, we would encourage to use the <code class="classname">IndexReader</code> instead.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14204-592106+%5BLatest%5D&amp;comment=Title%3A+Accessing+a+Lucene+Directory%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14204-592106+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Sharding_Indexes">
      ⁠</a>14.6.4. Sharding Indexes</h2></div></div></div><div class="para">
		In some cases it can be useful to split (shard) the indexed data of a given entity into several Lucene indexes.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Sharding should only be implemented if the advantages outweigh the disadvantages. Searching sharded indexes will typically be slower as all shards have to be opened for a single search.
		</div></div></div><div class="para">
		Possible use cases for sharding are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				A single index is so large that index update times are slowing the application down.
			</div></li><li class="listitem"><div class="para">
				A typical search will only hit a subset of the index, such as when data is naturally segmented by customer, region or application.
			</div></li></ul></div><div class="para">
		By default sharding is not enabled unless the number of shards is configured. To do this use the <code class="literal">hibernate.search.&lt;indexName&gt;.sharding_strategy.nbr_of_shards</code> property.
	</div><div class="example"><a id="example-index-sharding">
      ⁠</a><p class="title"><strong>Example 14.73. Enabling Index Sharding</strong></p><div class="example-contents"><div class="para">
			In this example 5 shards are enabled.
		</div><pre class="programlisting">hibernate.search.&lt;indexName&gt;.sharding_strategy.nbr_of_shards = 5</pre></div></div><div class="para">
		Responsible for splitting the data into sub-indexes is the <code class="classname">IndexShardingStrategy</code>. The default sharding strategy splits the data according to the hash value of the ID string representation (generated by the <code class="classname">FieldBridge</code>). This ensures a fairly balanced sharding. You can replace the default strategy by implementing a custom <code class="classname">IndexShardingStrategy</code>. To use your custom strategy you have to set the <code class="literal">hibernate.search.&lt;indexName&gt;.sharding_strategy</code> property.
	</div><div class="example"><a id="idm140550813061872">
      ⁠</a><p class="title"><strong>Example 14.74. Specifying a Custom Sharding Strategy</strong></p><div class="example-contents"><pre class="programlisting">hibernate.search.&lt;indexName&gt;.sharding_strategy = my.shardingstrategy.Implementation</pre></div></div><div class="para">
		The <code class="classname">IndexShardingStrategy</code> property also allows for optimizing searches by selecting which shard to run the query against. By activating a filter a sharding strategy can select a subset of the shards used to answer a query (<code class="classname">IndexShardingStrategy.getIndexManagersForQuery</code>) and thus speed up the query execution.
	</div><div class="para">
		Each shard has an independent <code class="classname">IndexManager</code> and so can be configured to use a different directory provider and back end configuration. The <code class="classname">IndexManager</code> index names for the Animal entity in <a class="xref" href="chap-Hibernate_Search.html#example-sharding-configuration">Example 14.75, “Sharding Configuration for Entity Animal”</a> are <code class="literal">Animal.0</code> to <code class="literal">Animal.4</code>. In other words, each shard has the name of its owning index followed by <code class="constant">.</code> (dot) and its index number.
	</div><div class="example"><a id="example-sharding-configuration">
      ⁠</a><p class="title"><strong>Example 14.75. Sharding Configuration for Entity Animal</strong></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.indexBase = /usr/lucene/indexes
hibernate.search.Animal.sharding_strategy.nbr_of_shards = 5
hibernate.search.Animal.directory_provider = filesystem
hibernate.search.Animal.0.indexName = Animal00 
hibernate.search.Animal.3.indexBase = /usr/lucene/sharded
hibernate.search.Animal.3.indexName = Animal03</pre></div></div><div class="para">
		In <a class="xref" href="chap-Hibernate_Search.html#example-sharding-configuration">Example 14.75, “Sharding Configuration for Entity Animal”</a>, the configuration uses the default id string hashing strategy and shards the <code class="classname">Animal</code> index into 5 sub-indexes. All sub-indexes are filesystem instances and the directory where each sub-index is stored is as followed:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				for sub-index 0: <code class="filename">/usr/lucene/indexes/Animal00</code> (shared indexBase but overridden indexName)
			</div></li><li class="listitem"><div class="para">
				for sub-index 1: <code class="filename">/usr/lucene/indexes/Animal.1</code> (shared indexBase, default indexName)
			</div></li><li class="listitem"><div class="para">
				for sub-index 2: <code class="filename">/usr/lucene/indexes/Animal.2</code> (shared indexBase, default indexName)
			</div></li><li class="listitem"><div class="para">
				for sub-index 3: <code class="filename">/usr/lucene/shared/Animal03</code> (overridden indexBase, overridden indexName)
			</div></li><li class="listitem"><div class="para">
				for sub-index 4: <code class="filename">/usr/lucene/indexes/Animal.4</code> (shared indexBase, default indexName)
			</div></li></ul></div><div class="para">
		When implementing a <code class="classname">IndexShardingStrategy</code> any field can be used to determine the sharding selection. Consider that to handle deletions, <code class="literal">purge</code> and <code class="literal">purgeAll</code> operations, the implementation might need to return one or more indexes without being able to read all the field values or the primary identifier. In that case the information is not enough to pick a single index, all indexes should be returned, so that the delete operation will be propagated to all indexes potentially containing the documents to be deleted.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14190-748889+%5BLatest%5D&amp;comment=Title%3A+Sharding+Indexes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14190-748889+26+Mar+2015+18%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Customizing_Lucenes_Scoring_Formula">
      ⁠</a>14.6.5. Customizing Lucene's Scoring Formula</h2></div></div></div><div class="para">
		Lucene allows the user to customize its scoring formula by extending <code class="classname">org.apache.lucene.search.Similarity</code>. The abstract methods defined in this class match the factors of the following formula calculating the score of query q for document d:
	</div><div class="para">
		<span class="bold bold"><strong>score(q,d) = coord(q,d) · queryNorm(q) · ∑ <sub>t in q</sub> ( tf(t in d) · idf(t) <sup>2</sup> · t.getBoost() · norm(t,d) )</strong></span>
	</div><div class="informaltable"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: center"> Factor </th><th style="text-align: center"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> tf(t ind) </td><td style="text-align: left"> Term frequency factor for the term (t) in the document (d). </td></tr><tr><td style="text-align: left"> idf(t) </td><td style="text-align: left"> Inverse document frequency of the term. </td></tr><tr><td style="text-align: left"> coord(q,d) </td><td style="text-align: left"> Score factor based on how many of the query terms are found in the specified document. </td></tr><tr><td style="text-align: left"> queryNorm(q) </td><td style="text-align: left"> Normalizing factor used to make scores between queries comparable. </td></tr><tr><td style="text-align: left"> t.getBoost() </td><td style="text-align: left"> Field boost. </td></tr><tr><td style="text-align: left"> norm(t,d) </td><td style="text-align: left"> Encapsulates a few (indexing time) boost and length factors. </td></tr></tbody></table></div><div class="para">
		It is beyond the scope of this manual to explain this formula in more detail. Please refer to <code class="classname">Similarity</code>'s Javadocs for more information.
	</div><div class="para">
		Hibernate Search provides three ways to modify Lucene's similarity calculation.
	</div><div class="para">
		First you can set the default similarity by specifying the fully specified classname of your <code class="classname">Similarity</code> implementation using the property <code class="constant">hibernate.search.similarity</code>. The default value is <code class="classname">org.apache.lucene.search.DefaultSimilarity</code>.
	</div><div class="para">
		You can also override the similarity used for a specific index by setting the <code class="literal">similarity</code> property 
<pre class="programlisting">hibernate.search.default.similarity = my.custom.Similarity</pre>

	</div><div class="para">
		Finally you can override the default similarity on class level using the <code class="literal">@Similarity</code> annotation.
	</div><pre class="programlisting">@Entity
@Indexed
<span class="bold bold"><strong>@Similarity(impl = DummySimilarity.class)</strong></span>
public class Book {
...
}</pre><div class="para">
		As an example, let's assume it is not important how often a term appears in a document. Documents with a single occurrence of the term should be scored the same as documents with multiple occurrences. In this case your custom implementation of the method <code class="methodname">tf(float freq)</code> should return 1.0.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			When two entities share the same index they must declare the same <code class="classname">Similarity</code> implementation. Classes in the same class hierarchy always share the index, so it's not allowed to override the <code class="classname">Similarity</code> implementation in a subtype.
		</div><div class="para">
			Likewise, it does not make sense to define the similarity via the index setting and the class-level setting as they would conflict. Such a configuration will be rejected.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14268-765747+%5BLatest%5D&amp;comment=Title%3A+Customizing+Lucene%27s+Scoring+Formula%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14268-765747+22+Jul+2015+19%3A20+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Exception_Handling_Configuration1">
      ⁠</a>14.6.6. Exception Handling Configuration</h2></div></div></div><div class="para">
		<span class="phrase">Hibernate Search</span> allows you to configure how exceptions are handled during the indexing process. If no configuration is provided then exceptions are logged to the log output by default. It is possible to explicitly declare the exception logging mechanism as follows:
	</div><pre class="programlisting">hibernate.search.error_handler = log</pre><div class="para">
		The default exception handling occurs for both synchronous and asynchronous indexing. <span class="phrase">Hibernate Search</span> provides an easy mechanism to override the default error handling implementation.
	</div><div class="para">
		In order to provide your own implementation you must implement the <code class="classname">ErrorHandler</code> interface, which provides the <code class="code">handle(ErrorContext context)</code> method. <code class="code">ErrorContext</code> provides a reference to the primary <code class="code">LuceneWork</code> instance, the underlying exception and any subsequent <code class="code">LuceneWork</code> instances that could not be processed due to the primary exception.
	</div><div class="para">
		
<pre class="programlisting">public interface ErrorContext  {
   List&lt;LuceneWork&gt; getFailingOperations();
   LuceneWork getOperationAtFault();
   Throwable getThrowable();
   boolean hasErrors();
}</pre>

	</div><div class="para">
		To register this error handler with <span class="phrase">Hibernate Search</span> you must declare the fully qualified classname of your <code class="classname">ErrorHandler</code> implementation in the configuration properties:
	</div><div class="para">
		
<pre class="programlisting">hibernate.search.error_handler = CustomerErrorHandler</pre>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+14222-592105+%5BLatest%5D&amp;comment=Title%3A+Exception+Handling+Configuration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14222-592105+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Disable_Hibernate_Search">
      ⁠</a>14.6.7. Disable Hibernate Search</h2></div></div></div><div class="para">
		Hibernate Search can be partially or completely disabled as required. Hibernate Search's indexing can be disabled, for example, if the index is read-only, or you prefer to perform indexing manually, rather than automatically. It is also possible to completely disable Hibernate Search, preventing indexing and searching.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Disable Indexing </div>
			To disable Hibernate Search indexing, change the <code class="literal">indexing_strategy</code> configuration option to <code class="literal">manual</code>, then restart JBoss EAP. 
<pre class="screen">hibernate.search.indexing_strategy = manual</pre>

		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Disable Hibernate Search Completely </div>
			To disable Hibernate Search completely, disable all listeners by changing the <code class="literal">autoregister_listeners</code> configuration option to <code class="literal">false</code>, then restart JBoss EAP. 
<pre class="screen">hibernate.search.autoregister_listeners = false</pre>

		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+43111-747741+%5BLatest%5D&amp;comment=Title%3A+Disable+Hibernate+Search%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=43111-747741+18+Mar+2015+21%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>