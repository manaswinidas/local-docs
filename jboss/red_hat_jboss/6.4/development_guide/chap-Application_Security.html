<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 18. Application Security</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Application_Security">
      ⁠</a>Chapter 18. Application Security</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Foundational_Concepts">
      ⁠</a>18.1. Foundational Concepts</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Encryption">
      ⁠</a>18.1.1. About Encryption</h2></div></div></div><div class="para">
		<em class="firstterm">Encryption</em> refers to obfuscating sensitive information by applying mathematical algorithms to it. Encryption is one of the foundations of securing your infrastructure from data breaches, system outages, and other risks.
	</div><div class="para">
		Encryption can be applied to simple string data, such as passwords. It can also be applied to data communication streams. The HTTPS protocol, for instance, encrypts all data before transferring it from one party to another. If you connect from one server to another using the Secure Shell (SSH) protocol, all of your communication is sent in an encrypted <em class="wordasword"> tunnel </em>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4774-591672+%5BLatest%5D&amp;comment=Title%3A+About+Encryption%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4774-591672+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Security_Domains">
      ⁠</a>18.1.2. About Security Domains</h2></div></div></div><div class="para">
		Security domains are part of the JBoss EAP 6 security subsystem. All security configuration is now managed centrally, by the domain controller of a managed domain, or by the standalone server.
	</div><div class="para">
		A security domain consists of configurations for authentication, authorization, security mapping, and auditing. It implements <em class="firstterm">Java Authentication and Authorization Service (JAAS)</em> declarative security.
	</div><div class="para">
		Authentication refers to verifying the identity of a user. In security terminology, this user is referred to as a <em class="firstterm">principal</em>. Although authentication and authorization are different, many of the included authentication modules also handle authorization.
	</div><div class="para">
		<em class="firstterm">Authorization</em> is a process by which the server determines if an authenticated user has permission or privileges to access specific resources in the system or operation.
	</div><div class="para">
		<em class="firstterm">Security mapping</em> refers to the ability to add, modify, or delete information from a principal, role, or attribute before passing the information to your application.
	</div><div class="para">
		The auditing manager allows you to configure <em class="firstterm">provider modules</em> to control the way that security events are reported.
	</div><div class="para">
		If you use security domains, you can remove all specific security configuration from your application itself. This allows you to change security parameters centrally. One common scenario that benefits from this type of configuration structure is the process of moving applications between testing and production environments.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4721-687641+%5BLatest%5D&amp;comment=Title%3A+About+Security+Domains%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4721-687641+23+Jul+2014+20%3A17+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_SSL_Encryption">
      ⁠</a>18.1.3. About SSL Encryption</h2></div></div></div><div class="para">
		Secure Sockets Layer (SSL) encrypts network traffic between two systems. Traffic between the two systems is encrypted using a two-way key, generated during the <em class="glossterm"> handshake</em>
		 phase of the connection and known only by those two systems.
	</div><div class="para">
		For secure exchange of the two-way encryption key, SSL makes use of Public Key Infrastructure (PKI), a method of encryption that utilizes a <em class="firstterm">key pair</em>. A <em class="firstterm">key pair</em> consists of two separate but matching cryptographic keys - a public key and a private key. The public key is shared with others and is used to encrypt data, and the private key is kept secret and is used to decrypt data that has been encrypted using the public key.
	</div><div class="para">
		When a client requests a secure connection, a handshake phase takes place before secure communication can begin. During the SSL handshake the server passes its public key to the client in the form of a certificate. The certificate contains the identity of the server (its URL), the public key of the server, and a digital signature that validates the certificate. The client then validates the certificate and makes a decision about whether the certificate is trusted or not. If the certificate is trusted, the client generates the two-way encryption key for the SSL connection, encrypts it using the public key of the server, and sends it back to the server. The server decrypts the two-way encryption key, using its private key, and further communication between the two machines over this connection is encrypted using the two-way encryption key.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4775-724692+%5BLatest%5D&amp;comment=Title%3A+About+SSL+Encryption%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4775-724692+09+Nov+2014+23%3A42+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Declarative_Security">
      ⁠</a>18.1.4. About Declarative Security</h2></div></div></div><div class="para">
		<em class="firstterm">Declarative security</em> is a method to separate security concerns from your application code by using the container to manage security. The container provides an authorization system based on either file permissions or users, groups, and roles. This approach is usually superior to <em class="firstterm">programmatic</em> security, which gives the application itself all of the responsibility for security.
	</div><div class="para">
		JBoss EAP 6 provides declarative security via security domains.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4766-591673+%5BLatest%5D&amp;comment=Title%3A+About+Declarative+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4766-591673+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Role-Based_Security_in_Applications">
      ⁠</a>18.2. Role-Based Security in Applications</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Application_Security">
      ⁠</a>18.2.1. About Application Security</h2></div></div></div><div class="para">
		Securing your applications is a multi-faceted and important concern for every application developer. JBoss EAP 6 provides all the tools you need to write secure applications, including the following abilities:
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_Authentication1">Section 18.2.2, “About Authentication”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_Authorization1">Section 18.2.3, “About Authorization”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_Security_Auditing1">Section 18.2.4, “About Security Auditing”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_Security_Mapping1">Section 18.2.5, “About Security Mapping”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_Declarative_Security">Section 18.1.4, “About Declarative Security”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_EJB_Method_Permissions">Section 18.4.2.1, “About EJB Method Permissions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Application_Security.html#About_EJB_Security_Annotations">Section 18.4.3.1, “About EJB Security Annotations”</a>
				</div></li></ul></div>

	</div><div class="para">
		See also <a class="xref" href="chap-Application_Security.html#Use_a_Security_Domain_in_Your_Application">Section 18.2.8, “Use a Security Domain in Your Application”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4771-591672+%5BLatest%5D&amp;comment=Title%3A+About+Application+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4771-591672+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Authentication1">
      ⁠</a>18.2.2. About Authentication</h2></div></div></div><div class="para">
		Authentication refers to identifying a subject and verifying the authenticity of the identification. The most common authentication mechanism is a username and password combination. Other common authentication mechanisms use shared keys, smart cards, or fingerprints. The outcome of a successful authentication is referred to as a principal, in terms of Java Enterprise Edition declarative security.
	</div><div class="para">
		JBoss EAP 6 uses a pluggable system of authentication modules to provide flexibility and integration with the authentication systems you already use in your organization. Each security domain may contain one or more configured authentication modules. Each module includes additional configuration parameters to customize its behavior. The easiest way to configure the authentication subsystem is within the web-based management console.
	</div><div class="para">
		Authentication is not the same as authorization, although they are often linked. Many of the included authentication modules can also handle authorization.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4723-742133+%5BLatest%5D&amp;comment=Title%3A+About+Authentication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4723-742133+09+Feb+2015+02%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Authorization1">
      ⁠</a>18.2.3. About Authorization</h2></div></div></div><div class="para">
		Authorization is a mechanism for granting or denying access to a resource based on identity. It is implemented as a set of declarative security roles which can be added to principals.
	</div><div class="para">
		JBoss EAP 6 uses a modular system to configure authorization. Each security domain may contain one or more authorization policies. Each policy has a basic module which defines its behavior. It is configured through specific flags and attributes. The easiest way to configure the authorization subsystem is by using the web-based management console.
	</div><div class="para">
		Authorization is different from authentication, and usually happens after authentication. Many of the authentication modules also handle authorization.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4725-744990+%5BLatest%5D&amp;comment=Title%3A+About+Authorization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4725-744990+26+Feb+2015+05%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Security_Auditing1">
      ⁠</a>18.2.4. About Security Auditing</h2></div></div></div><div class="para">
		Security auditing refers to triggering events, such as writing to a log, in response to an event that happens within the security subsystem. Auditing mechanisms are configured as part of a security domain, along with authentication, authorization, and security mapping details.
	</div><div class="para">
		Auditing uses <em class="firstterm">provider modules</em>. You can use one of the included ones, or implement your own.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4727-591674+%5BLatest%5D&amp;comment=Title%3A+About+Security+Auditing%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4727-591674+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Security_Mapping1">
      ⁠</a>18.2.5. About Security Mapping</h2></div></div></div><div class="para">
		Security mapping allows you to combine authentication and authorization information after the authentication or authorization happens, but before the information is passed to your application.
	</div><div class="para">
		You can map principals (authentication), roles (authorization), or credentials (attributes which are not principals or roles).
	</div><div class="para">
		Role Mapping is used to add, replace, or remove roles to the subject after authentication.
	</div><div class="para">
		Principal mapping is used to modify a principal after authentication.
	</div><div class="para">
		Attribute mapping is used to convert attributes from an external system to be used by your application, and vice versa.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4729-686016+%5BLatest%5D&amp;comment=Title%3A+About+Security+Mapping%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4729-686016+18+Jul+2014+08%3A39+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Java_Authentication_and_Authorization_Service_JAAS">
      ⁠</a>18.2.6. Java Authentication and Authorization Service (JAAS)</h2></div></div></div><div class="para">
		<em class="firstterm">Java Authentication and Authorization Service (JAAS)</em> is a security API which consists of a set of Java packages designed for user authentication and authorization. The API is a Java implementation of the standard Pluggable Authentication Modules (PAM) framework. It extends the Java Enterprise Edition access control architecture to support user-based authorization.
	</div><div class="para">
		In JBoss EAP 6, JAAS only provides declarative role-based security. For more information about declarative security, refer to <a class="xref" href="chap-Application_Security.html#About_Declarative_Security">Section 18.1.4, “About Declarative Security”</a>.
	</div><div class="para">
		JAAS is independent of any underlying authentication technologies, such as Kerberos or LDAP. You can change your underlying security structure without changing your application. You only need to change the JAAS configuration.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4769-591672+%5BLatest%5D&amp;comment=Title%3A+Java+Authentication+and+Authorization+Service+%28JAAS%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4769-591672+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Authentication_and_Authorization_Service_JAAS">
      ⁠</a>18.2.7. About Java Authentication and Authorization Service (JAAS)</h2></div></div></div><div class="para">
		The security architecture of JBoss EAP 6 is comprised of the security configuration subsystem, and application-specific security configurations which are included in several configuration files within the application.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Domain, Server Group, and Server Specific Configuration</div>
			Server groups (in a managed domain) and servers (in a standalone server) include the configuration for security domains. A security domain includes information about a combination of authentication, authorization, mapping, and auditing modules, with configuration details. An application specifies which security domain it requires, by name, in its <code class="filename">jboss-web.xml</code>.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Application-specific Configuration</div>
			Application-specific configuration takes place in one or more of the following four files.
		</div><div class="table"><a id="idm140550742244048">
      ⁠</a><p class="title"><strong>Table 18.1. Application-Specific Configuration Files</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Application-Specific Configuration Files"><colgroup><col/><col/></colgroup><thead><tr><th> File </th><th> Description </th></tr></thead><tbody><tr><td> ejb-jar.xml </td><td> <div class="para">
						The deployment descriptor for an Enterprise JavaBean (EJB) application, located in the <code class="filename">META-INF</code> directory of the archive. Use the <code class="filename">ejb-jar.xml</code> to specify roles and map them to principals, at the application level. You can also limit specific methods and classes to certain roles. It is also used for other EJB-specific configuration not related to security.
					</div>
					 </td></tr><tr><td> web.xml </td><td> <div class="para">
						The deployment descriptor for a Java Enterprise Edition (EE) web application. Use the <code class="filename">web.xml</code> to declare the resource and transport constraints for the application, such as limiting the type of HTTP requests that are allowed. You can also configure simple web-based authentication in this file. It is also used for other application-specific configuration not related to security. The security domain the application uses for authentication and authorization is defined in <code class="filename">jboss-web.xml</code>.
					</div>
					 </td></tr><tr><td> jboss-ejb3.xml </td><td> <div class="para">
						Contains JBoss-specific extensions to the <code class="filename">ejb-jar.xml</code> descriptor.
					</div>
					 </td></tr><tr><td> jboss-web.xml </td><td> <div class="para">
						Contains JBoss-specific extensions to the <code class="filename">web.xml</code> descriptor.
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The <code class="filename">ejb-jar.xml</code> and <code class="filename">web.xml</code> are defined in the Java Enterprise Edition (Java EE) specification. The <code class="filename">jboss-ejb3.xml</code> provides JBoss-specific extensions for the <code class="filename">ejb-jar.xml</code>, and the <code class="filename">jboss-web.xml</code> provides JBoss-specific extensions for the <code class="filename">web.xml</code>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4797-685271+%5BLatest%5D&amp;comment=Title%3A+About+Java+Authentication+and+Authorization+Service+%28JAAS%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4797-685271+15+Jul+2014+02%3A00+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_a_Security_Domain_in_Your_Application">
      ⁠</a>18.2.8. Use a Security Domain in Your Application</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			To use a security domain in your application, first you need to define the security domain in the server's configuration and then enable it for an application in the application's deployment descriptor. Then you must add the required annotations to the EJB that uses it. This topic covers the steps required to use a security domain in your application.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			If an application is part of a security domain that uses an authentication cache, user authentications for that application will also be available to other applications in that security domain.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550719517920">
      ⁠</a><p class="title"><strong>Procedure 18.1. Configure Your Application to Use a Security Domain</strong></p><ol class="1"><li class="step"><p class="title"><strong>Define the Security Domain</strong></p><div class="para">
				You need to define the security domain in the server's configuration file, and then enable it for an application in the application's descriptor file.
			</div><ol class="substeps a"><li class="step"><p class="title"><strong>Configure the security domain in the server's configuration file</strong></p><div class="para">
						The security domain is configured in the <code class="literal">security</code> subsystem of the server's configuration file. If the JBoss EAP 6 instance is running in a managed domain, this is the <code class="filename">domain/configuration/domain.xml</code> file. If the JBoss EAP 6 instance is running as a standalone server, this is the <code class="filename">standalone/configuration/standalone.xml</code> file.
					</div><div class="para">
						The <code class="literal">other</code>, <code class="literal">jboss-web-policy</code>, and <code class="literal">jboss-ejb-policy</code> security domains are provided by default in JBoss EAP 6. The following XML example was copied from the <code class="literal">security</code> subsystem in the server's configuration file.
					</div><div class="para">
						The <code class="code">cache-type</code> attribute of a security domain specifies a cache for faster authentication checks. Allowed values are <code class="literal">default</code> to use a simple map as the cache, or <code class="literal">infinispan</code> to use an Infinispan cache. 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:security:1.2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domains&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"other"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Remoting"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"optional"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"RealmDirect"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password-stacking"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"useFirstPass"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss-web-policy"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;authorization&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;policy-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Delegating"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/authorization&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss-ejb-policy"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;authorization&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;policy-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"Delegating"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/authorization&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-domains&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span></pre>

					</div><div class="para">
						You can configure additional security domains as needed using the Management Console or CLI.
					</div></li><li class="step"><p class="title"><strong>Enable the security domain in the application's descriptor file</strong></p><div class="para">
						The security domain is specified in the <code class="sgmltag-element">&lt;security-domain&gt;</code> child element of the <code class="sgmltag-element">&lt;jboss-web&gt;</code> element in the application's <code class="filename">WEB-INF/jboss-web.xml</code> file. The following example configures a security domain named <code class="literal">my-domain</code>. 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>my-domain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span></pre>

					</div><div class="para">
						This is only one of many settings which you can specify in the <code class="filename">WEB-INF/jboss-web.xml</code> descriptor.
					</div></li></ol></li><li class="step"><p class="title"><strong>Add the Required Annotation to the EJB</strong></p><div class="para">
				You configure security in the EJB using the <code class="literal">@SecurityDomain</code> and <code class="literal">@RolesAllowed</code> annotations. The following EJB code example limits access to the <code class="literal">other</code> security domain by users in the <code class="literal">guest</code> role.
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>package example.<span xmlns="" class="perl_Function">ejb3</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.security.Principal;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.annotation.Resource;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.annotation.security.RolesAllowed;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.ejb.SessionContext;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.ejb.Stateless;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ejb3.annotation.SecurityDomain;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Simple secured EJB using EJB security annotations</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Allow access to "other" security domain by users in a "guest" role.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>({ <span xmlns="" class="perl_String">"guest"</span> })
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SecurityDomain</span>(<span xmlns="" class="perl_String">"other"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> SecuredEJB {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">// Inject the Session Context</span>
<span xmlns="" class="line">​</span>   @Resource
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> SessionContext ctx;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    * Secured EJB method using security annotations</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    */</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSecurityInfo</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// Session context injected using the resource annotation</span>
<span xmlns="" class="line">​</span>      Principal principal = ctx.<span xmlns="" class="perl_Function">getCallerPrincipal</span>();
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> principal.<span xmlns="" class="perl_Function">toString</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre><div class="para">
				For more code examples, see the <code class="literal">ejb-security</code> quickstart in the JBoss EAP 6 Quickstarts bundle, which is available from the Red Hat Customer Portal.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The security domain for an EJB can also be set using the <code class="literal">jboss-ejb3.xml</code> deployment descriptor. See <a class="xref" href="chap-Enterprise_JavaBeans.html#jboss-ejb3xml_Deployment_Descriptor_Reference">Section 8.8.4, “jboss-ejb3.xml Deployment Descriptor Reference”</a> for details.
				</div></div></div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550813357008">
      ⁠</a><p class="title"><strong>Procedure 18.2. Configure JBoss EAP 6 to access custom principal in EJB 3 bean</strong></p><ol class="1"><li class="step"><div class="para">
				Configure the ApplicationRealm to defer to JAAS:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-realm</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MyDomainRealm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;jaas</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-security-domain"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-realm&gt;</span></pre></li><li class="step"><div class="para">
				Configure the JAAS security-domain to use the custom principal:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-security-domain"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"UsersRoles"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"usersProperties"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"file:///${jboss.server.config.dir}/users.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"rolesProperties"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"file:///${jboss.server.config.dir}/roles.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"principalClass"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.example.CustomPrincipalImpl"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span></pre></li><li class="step"><div class="para">
				Deploy the custom principal as a JBoss module.
			</div></li><li class="step"><div class="para">
				Configure the <code class="methodname">org.jboss.as.remoting</code> module (<code class="filename">modules/org/jboss/as/remoting/main/module.xml</code>) to depend on the module that contains the custom principal:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;resources&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;resource-root</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"jboss-as-remoting-7.1.2.Final-redhat-1.jar"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Insert resources here --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/resources&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.staxmapper"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.controller"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.domain-management"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.network"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.protocol"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.server"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.security"</span><span xmlns="" class="perl_Others"> optional=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.as.threads"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.logging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.modules"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.msc"</span><span xmlns="" class="perl_Keyword">/&gt;</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.remoting3"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.sasl"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.threads"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.picketbox"</span><span xmlns="" class="perl_Others"> optional=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"javax.api"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.example"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>  <span xmlns="" class="perl_Comment">&lt;!--</span><span xmlns="" class="perl_Alert">FIXME</span><span xmlns="" class="perl_Comment">:  dependency on custom principal added here --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span></pre></li><li class="step"><div class="para">
				Configure the client to use <code class="methodname">org.jboss.ejb.client.naming</code>, the <code class="filename">jboss-ejb-client.properties</code> file should look like the following:
			</div><pre class="programlisting ">remote.connections=default
endpoint.name=client-endpoint
remote.connection.default.port=4447
remote.connection.default.host=localhost
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
# The following setting is required when deferring to JAAS
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOPLAINTEXT=false

remote.connection.default.username=admin
remote.connection.default.password=testing</pre></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4765-771120+%5BLatest%5D&amp;comment=Title%3A+Use+a+Security+Domain+in+Your+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4765-771120+29+Sep+2015+11%3A36+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_Role-Based_Security_In_Servlets">
      ⁠</a>18.2.9. Use Role-Based Security In Servlets</h2></div></div></div><div class="para">
		To add security to a servlet, you map each servlet to a URL pattern, and create security constraints on the URL patterns which need to be secured. The security constraints limit access to the URLs to roles. The authentication and authorization are handled by the security domain specified in the WAR's <code class="filename">jboss-web.xml</code>.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			Before you use role-based security in a servlet, the security domain used to authenticate and authorize access needs to be configured in the JBoss EAP 6 container.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550722537568">
      ⁠</a><p class="title"><strong>Procedure 18.3. Add Role-Based Security to Servlets</strong></p><ol class="1"><li class="step"><p class="title"><strong>Add mappings between servlets and URL patterns.</strong></p><div class="para">
				Use <code class="sgmltag-element">&lt;servlet-mapping&gt;</code> elements in the <code class="filename">web.xml</code> to map individual servlets to URL patterns. The following example maps the servlet called <code class="literal">DisplayOpResult</code> to the URL pattern <code class="literal">/DisplayOpResult</code>.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>		
<span xmlns="" class="line">​</span>
</pre></li><li class="step"><p class="title"><strong>Add security constraints to the URL patterns.</strong></p><div class="para">
				To map the URL pattern to a security constraint, use a <code class="sgmltag-element">&lt;security-constraint&gt;</code>. The following example constrains access from the URL pattern <code class="literal">/DisplayOpResult</code> to be accessed by principals with the role <code class="literal">eap_admin</code>. The role needs to be present in the security domain.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>	
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>	
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-role&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-role&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>BASIC<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
				You need to specify the authentication method, which can be any of the following: <code class="literal">BASIC, FORM, DIGEST, CLIENT-CERT, SPNEGO.</code> This example uses <code class="literal">BASIC</code> authentication.
			</div></li><li class="step"><p class="title"><strong>Specify the security domain in the WAR's <code class="filename">jboss-web.xml</code></strong></p><div class="para">
				Add the security domain to the WAR's <code class="filename">jboss-web.xml</code> in order to connect the servlets to the configured security domain, which knows how to authenticate and authorize principals against the security constraints. The following example uses the security domain called <code class="literal">acme_domain</code>.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>acme_domain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
<span xmlns="" class="line">​</span>
</pre></li></ol></div><div class="example"><a id="idm140550794622912">
      ⁠</a><p class="title"><strong>Example 18.1. Example <code class="filename">web.xml</code> with Role-Based Security Configured</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web-app</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         version=</span><span xmlns="" class="perl_String">"3.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Use Role-Based Security In Servlets<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;welcome-file-list&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;welcome-file&gt;</span>/index.jsp<span xmlns="" class="perl_Keyword">&lt;/welcome-file&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/welcome-file-list&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>Restrict access to role eap_admin<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/DisplayOpResult/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-role&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>eap_admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-role&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>BASIC<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/web-app&gt;</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4927-591678+%5BLatest%5D&amp;comment=Title%3A+Use+Role-Based+Security+In+Servlets%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4927-591678+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_A_Third-Party_Authentication_System_In_Your_Application">
      ⁠</a>18.2.10. Use A Third-Party Authentication System In Your Application</h2></div></div></div><div class="para">
		You can integrate third-party security systems with JBoss EAP 6. These types of systems are usually token-based. The external system performs the authentication and passes a token back to the Web application through the request headers. This is often referred to as <em class="firstterm">perimeter authentication</em>. To configure perimeter authentication in your application, add a custom authentication valve. If you have a valve from a third-party provider, be sure it is in your classpath and follow the examples below, along with the documentation for your third-party authentication module.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The location for configuring valves has changed in JBoss EAP 6. There is no longer a <code class="filename">context.xml</code> deployment descriptor. Valves are configured directly in the <code class="filename">jboss-web.xml</code> descriptor instead. The <code class="filename">context.xml</code> is now ignored.
		</div></div></div><div class="example"><a id="idm140550717981136">
      ⁠</a><p class="title"><strong>Example 18.2. Basic Authentication Valve</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.security.negotiation.NegotiationAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre><div class="para">
			This valve is used for Kerberos-based SSO. It also shows the most simple pattern for specifying a third-party authenticator for your Web application.
		</div></div></div><div class="example"><a id="idm140550810802736">
      ⁠</a><p class="title"><strong>Example 18.3. Custom Valve With Header Attributes Set</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;valve&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class-name&gt;</span>org.jboss.web.tomcat.security.GenericHeaderAuthenticator<span xmlns="" class="perl_Keyword">&lt;/class-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>httpHeaderForSSOAuth<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>sm_ssoid,ct-remote-user,HTTP_OBLIX_UID<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>sessionCookieForSSOAuth<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>SMSESSION,CTSESSION,ObSSOCookie<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/param&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/valve&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre><div class="para">
			This example shows how to set custom attributes on your valve. The authenticator checks for the presence of the header ID and the session key, and passes them into the JAAS framework which drives the security layer, as the username and password value. You need a custom JAAS login module which can process the username and password and populate the subject with the correct roles. If no header values match the configured values, regular form-based authentication semantics apply.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Writing a Custom Authenticator</div>
			Writing your own authenticator is out of scope of this document. However, the following Java code is provided as an example.
		</div><div class="example"><a id="idm140550788383888">
      ⁠</a><p class="title"><strong>Example 18.4. GenericHeaderAuthenticator.java</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/*</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * JBoss, Home of Professional Open Source.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Copyright 2006, Red Hat Middleware LLC, and individual contributors</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * as indicated by the @author tags. See the copyright.txt file in the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * distribution for a full listing of individual contributors.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * This is free software; you can redistribute it and/or modify it</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * under the terms of the GNU Lesser General Public License as</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * published by the Free Software Foundation; either version 2.1 of</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * the License, or (at your option) any later version.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * This software is distributed in the hope that it will be useful,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Lesser General Public License for more details.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * You should have received a copy of the GNU Lesser General Public</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * License along with this software; if not, write to the Free</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * 02110-1301 USA, or see the FSF site: http://www.fsf.org.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">web</span>.<span xmlns="" class="perl_Function">tomcat</span>.<span xmlns="" class="perl_Function">security</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.io.IOException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.security.Principal;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.StringTokenizer;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.JMException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.ObjectName;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.http.Cookie;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.http.HttpServletRequest;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.servlet.http.HttpServletResponse;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.Realm;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.Session;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.authenticator.Constants;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Request;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.connector.Response;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.catalina.deploy.LoginConfig;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.logging.Logger;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.as.web.security.ExtendedFormAuthenticator;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * JBAS-2283: Provide custom header based authentication support</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * Header Authenticator that deals with userid from the request header Requires</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * two attributes configured on the Tomcat Service - one for the http header</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * denoting the authenticated identity and the other is the SESSION cookie</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author &lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"mailto:Anil.Saldhana@jboss.org"</span><span xmlns="" class="perl_Keyword">&gt;</span><span xmlns="" class="perl_Comment">Anil Saldhana</span><span xmlns="" class="perl_Keyword">&lt;/a&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author &lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"mailto:sguilhen@redhat.com"</span><span xmlns="" class="perl_Keyword">&gt;</span><span xmlns="" class="perl_Comment">Stefan Guilhen</span><span xmlns="" class="perl_Keyword">&lt;/a&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@version </span><span xmlns="" class="perl_Comment">$Revision$</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@since </span><span xmlns="" class="perl_Comment">Sep 11, 2006</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> GenericHeaderAuthenticator <span xmlns="" class="perl_Keyword">extends</span> ExtendedFormAuthenticator {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">static</span> Logger log = Logger
<span xmlns="" class="line">​</span>      .<span xmlns="" class="perl_Function">getLogger</span>(GenericHeaderAuthenticator.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">boolean</span> trace = log.<span xmlns="" class="perl_Function">isTraceEnabled</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// JBAS-4804: GenericHeaderAuthenticator injection of ssoid and</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">// sessioncookie name.</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String httpHeaderForSSOAuth = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String sessionCookieForSSOAuth = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Obtain the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * attribute is used to indicate the request header ids that have to be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * checked in order to retrieve the SSO identity set by a third party</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * security system.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the value of the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *         </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getHttpHeaderForSSOAuth</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> httpHeaderForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Set the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * attribute is used to indicate the request header ids that have to be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * checked in order to retrieve the SSO identity set by a third party</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * security system.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param httpHeaderForSSOAuth</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the value of the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">httpHeaderForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setHttpHeaderForSSOAuth</span>(String httpHeaderForSSOAuth) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">httpHeaderForSSOAuth</span> = httpHeaderForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Obtain the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">sessionCookieForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * This attribute is used to indicate the names of the SSO cookies that may</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * be present in the request object.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the names (separated by a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *         </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">','</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment">) of the SSO cookies that may have been set by a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *         third party security system in the request.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSessionCookieForSSOAuth</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> sessionCookieForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Set the value of the </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">sessionCookieForSSOAuth</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> attribute. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * attribute is used to indicate the names of the SSO cookies that may be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * present in the request object.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param sessionCookieForSSOAuth</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            a </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">String</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> containing the names (separated by a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">','</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment">) of the SSO cookies that may have been set by</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            a third party security system in the request.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setSessionCookieForSSOAuth</span>(String sessionCookieForSSOAuth) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sessionCookieForSSOAuth</span> = sessionCookieForSSOAuth;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Creates an instance of </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">GenericHeaderAuthenticator</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment">.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">GenericHeaderAuthenticator</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">super</span>();
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">authenticate</span>(Request request, HttpServletResponse response,
<span xmlns="" class="line">​</span>      LoginConfig config) <span xmlns="" class="perl_Keyword">throws</span> IOException {
<span xmlns="" class="line">​</span>    log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Authenticating user"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    Principal principal = request.<span xmlns="" class="perl_Function">getUserPrincipal</span>();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (principal != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Already authenticated '"</span> + principal.<span xmlns="" class="perl_Function">getName</span>() + <span xmlns="" class="perl_String">"'"</span>);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    Realm realm = context.<span xmlns="" class="perl_Function">getRealm</span>();
<span xmlns="" class="line">​</span>    Session session = request.<span xmlns="" class="perl_Function">getSessionInternal</span>(<span xmlns="" class="perl_Keyword">true</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    String username = <span xmlns="" class="perl_Function">getUserId</span>(request);
<span xmlns="" class="line">​</span>    String password = <span xmlns="" class="perl_Function">getSessionCookie</span>(request);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Check if there is sso id as well as sessionkey</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (username == <span xmlns="" class="perl_Keyword">null</span> || password == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Username is null or password(sessionkey) is null:fallback to form auth"</span>);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">authenticate</span>(request, response, config);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    principal = realm.<span xmlns="" class="perl_Function">authenticate</span>(username, password);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (principal == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Function">forwardToErrorPage</span>(request, response, config);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    session.<span xmlns="" class="perl_Function">setNote</span>(Constants.<span xmlns="" class="perl_Function">SESS_USERNAME_NOTE</span>, username);
<span xmlns="" class="line">​</span>    session.<span xmlns="" class="perl_Function">setNote</span>(Constants.<span xmlns="" class="perl_Function">SESS_PASSWORD_NOTE</span>, password);
<span xmlns="" class="line">​</span>    request.<span xmlns="" class="perl_Function">setUserPrincipal</span>(principal);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">register</span>(request, response, principal, HttpServletRequest.<span xmlns="" class="perl_Function">FORM_AUTH</span>,
<span xmlns="" class="line">​</span>        username, password);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the username from the request header</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param request</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getUserId</span>(Request request) {
<span xmlns="" class="line">​</span>    String ssoid = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// We can have a comma-separated ids</span>
<span xmlns="" class="line">​</span>    String ids = <span xmlns="" class="perl_String">""</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      ids = <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getIdentityHeaderId</span>();
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (JMException e) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"getUserId exception"</span>, e);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (ids == <span xmlns="" class="perl_Keyword">null</span> || ids.<span xmlns="" class="perl_Function">length</span>() == <span xmlns="" class="perl_Float">0</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalStateException(
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_String">"Http headers configuration in tomcat service missing"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    StringTokenizer st = <span xmlns="" class="perl_Keyword">new</span> StringTokenizer(ids, <span xmlns="" class="perl_String">","</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">while</span> (st.<span xmlns="" class="perl_Function">hasMoreTokens</span>()) {
<span xmlns="" class="line">​</span>      ssoid = request.<span xmlns="" class="perl_Function">getHeader</span>(st.<span xmlns="" class="perl_Function">nextToken</span>());
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (ssoid != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">break</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"SSOID-"</span> + ssoid);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> ssoid;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Obtain the session cookie from the request</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param request</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getSessionCookie</span>(Request request) {
<span xmlns="" class="line">​</span>    Cookie[] cookies = request.<span xmlns="" class="perl_Function">getCookies</span>();
<span xmlns="" class="line">​</span>    log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Cookies:"</span> + cookies);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">int</span> numCookies = cookies != <span xmlns="" class="perl_Keyword">null</span> ? cookies.<span xmlns="" class="perl_Function">length</span> : <span xmlns="" class="perl_Float">0</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// We can have comma-separated ids</span>
<span xmlns="" class="line">​</span>    String ids = <span xmlns="" class="perl_String">""</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      ids = <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getSessionCookieId</span>();
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Session Cookie Ids="</span> + ids);
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (JMException e) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"checkSessionCookie exception"</span>, e);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (ids == <span xmlns="" class="perl_Keyword">null</span> || ids.<span xmlns="" class="perl_Function">length</span>() == <span xmlns="" class="perl_Float">0</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalStateException(
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_String">"Session cookies configuration in tomcat service missing"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    StringTokenizer st = <span xmlns="" class="perl_Keyword">new</span> StringTokenizer(ids, <span xmlns="" class="perl_String">","</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">while</span> (st.<span xmlns="" class="perl_Function">hasMoreTokens</span>()) {
<span xmlns="" class="line">​</span>      String cookieToken = st.<span xmlns="" class="perl_Function">nextToken</span>();
<span xmlns="" class="line">​</span>      String val = <span xmlns="" class="perl_Function">getCookieValue</span>(cookies, numCookies, cookieToken);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (val != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> val;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Session Cookie not found"</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the configured header identity id in the tomcat service</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@throws JMException</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getIdentityHeaderId</span>() <span xmlns="" class="perl_Keyword">throws</span> JMException {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">httpHeaderForSSOAuth</span> != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">httpHeaderForSSOAuth</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> (String) mserver.<span xmlns="" class="perl_Function">getAttribute</span>(<span xmlns="" class="perl_Keyword">new</span> ObjectName(
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_String">"jboss.web:service=WebServer"</span>), <span xmlns="" class="perl_String">"HttpHeaderForSSOAuth"</span>);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the configured session cookie id in the tomcat service</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * @return</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@throws JMException</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getSessionCookieId</span>() <span xmlns="" class="perl_Keyword">throws</span> JMException {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sessionCookieForSSOAuth</span> != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">sessionCookieForSSOAuth</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> (String) mserver.<span xmlns="" class="perl_Function">getAttribute</span>(<span xmlns="" class="perl_Keyword">new</span> ObjectName(
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_String">"jboss.web:service=WebServer"</span>), <span xmlns="" class="perl_String">"SessionCookieForSSOAuth"</span>);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the value of a cookie if the name matches the token</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param cookies</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            array of cookies</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param numCookies</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            number of cookies in the array</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@param </span><span xmlns="" class="perl_Comment">t</span><span xmlns="" class="perl_Keyword">oken</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   *            Key</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">value of cookie</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getCookieValue</span>(Cookie[] cookies, <span xmlns="" class="perl_DataType">int</span> numCookies,
<span xmlns="" class="line">​</span>      String token) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> i = <span xmlns="" class="perl_Float">0</span>; i &lt; numCookies; i++) {
<span xmlns="" class="line">​</span>      Cookie cookie = cookies[i];
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Matching cookieToken:"</span> + token + <span xmlns="" class="perl_String">" with cookie name="</span>
<span xmlns="" class="line">​</span>          + cookie.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (token.<span xmlns="" class="perl_Function">equals</span>(cookie.<span xmlns="" class="perl_Function">getName</span>())) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (trace)
<span xmlns="" class="line">​</span>          log.<span xmlns="" class="perl_Function">trace</span>(<span xmlns="" class="perl_String">"Cookie-"</span> + token + <span xmlns="" class="perl_String">" value="</span> + cookie.<span xmlns="" class="perl_Function">getValue</span>());
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> cookie.<span xmlns="" class="perl_Function">getValue</span>();
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7825-591808+%5BLatest%5D&amp;comment=Title%3A+Use+A+Third-Party+Authentication+System+In+Your+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7825-591808+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Login_Modules">
      ⁠</a>18.3. Login Modules</h1></div></div></div><div class="para">

		</div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A28308-608934+%5BLatest%5D&amp;comment=Title%3A+Login+Modules%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Using_Modules">
      ⁠</a>18.3.1. Using Modules</h2></div></div></div><div class="para">
				JBoss EAP 6 includes several bundled login modules suitable for most user management needs. JBoss EAP 6 can read user information from a relational database, an LDAP server, or flat files. In addition to these core login modules, JBoss EAP 6 provides other login modules that provide user information for very customized needs.
			</div><div class="para">
				More login modules and their options can be found in Appendix A.1.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A28309-638876+%5BLatest%5D&amp;comment=Title%3A+Using+Modules%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Password_Stacking">
      ⁠</a>18.3.1.1. Password Stacking</h3></div></div></div><div class="para">
		Multiple login modules can be chained together in a stack, with each login module providing both the credentials verification and role assignment during authentication. This works for many use cases, but sometimes credentials verification and role assignment are split across multiple user management stores.
	</div><div class="para">
		<a class="xref" href="chap-Application_Security.html#LdapLoginModule1">Section 18.3.1.4, “Ldap Login Module”</a> describes how to combine LDAP and a relational database, allowing a user to be authenticated by either system. Consider the case where users are managed in a central LDAP server but application-specific roles are stored in the application's relational database. The password-stacking module option captures this relationship.
	</div><div class="para">
		To use password stacking, each login module should set the <span class="markup">&lt;module-option&gt;</span> <code class="literal">password-stacking</code> attribute to <code class="literal">useFirstPass</code>. If a previous module configured for password stacking has authenticated the user, all the other stacking modules will consider the user authenticated and only attempt to provide a set of roles for the authorization step.
	</div><div class="para">
		When <code class="literal">password-stacking</code> option is set to <code class="literal">useFirstPass</code>, this module first looks for a shared user name and password under the property names <span class="property">javax.security.auth.login.name</span> and <span class="property">javax.security.auth.login.password</span> respectively in the login module shared state map.
	</div><div class="para">
		If found, these properties are used as the principal name and password. If not found, the principal name and password are set by this login module and stored under the property names <span class="property">javax.security.auth.login.name</span> and <span class="property">javax.security.auth.login.password</span> respectively.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			When using password stacking, set all modules to be required. This ensures that all modules are considered, and have the chance to contribute roles to the authorization process.
		</div></div></div><div class="example"><a id="exam-Password_Stacking_Example">
      ⁠</a><p class="title"><strong>Example 18.5. Password Stacking Sample</strong></p><div class="example-contents"><div class="para">
			This management CLI example shows how password stacking could be used.
		</div><pre class="programlisting">/subsystem=security/security-domain=pwdStack/authentication=classic/login-module=Ldap:add( \
  code=Ldap, \
  flag=required, \
  module-options=[ \
    ("password-stacking"=&gt;"useFirstPass"), \
    ... Ldap login module configuration
  ])
/subsystem=security/security-domain=pwdStack/authentication=classic/login-module=Database:add( \
  code=Database, \
  flag=required, \
  module-options=[ \
    ("password-stacking"=&gt;"useFirstPass"), \
    ... Database login module configuration
  ])</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28312-638661+%5BLatest%5D&amp;comment=Title%3A+Password+Stacking%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28312-638661+06+May+2014+20%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Password_Hashing">
      ⁠</a>18.3.1.2. Password Hashing</h3></div></div></div><div class="para">
		Most login modules must compare a client-supplied password to a password stored in a user management system. These modules generally work with plain text passwords, but can be configured to support hashed passwords to prevent plain text passwords from being stored on the server side.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Red Hat JBoss Enterprise Application Platform Common Criteria certified release only supports SHA-256 for password hashing.
		</div></div></div><div class="example"><a id="idm140550777139904">
      ⁠</a><p class="title"><strong>Example 18.6. Password Hashing</strong></p><div class="example-contents"><div class="para">
			The following is a login module configuration that assigns unauthenticated users the principal name <code class="literal">nobody</code> and contains based64-encoded, SHA-256 hashes of the passwords in a <code class="filename">usersb64.properties</code> file. The <code class="filename">usersb64.properties</code> file is part of the deployment classpath.
		</div><pre class="programlisting">
/subsystem=security/security-domain=testUsersRoles:add
/subsystem=security/security-domain=testUsersRoles/authentication=classic:add
/subsystem=security/security-domain=testUsersRoles/authentication=classic/login-module=UsersRoles:add( \
  code=UsersRoles, \
  flag=required, \
  module-options=[ \
    ("usersProperties"=&gt;"usersb64.properties"), \
    ("rolesProperties"=&gt;"test-users-roles.properties"), \
    ("unauthenticatedIdentity"=&gt;"nobody"), \
    ("hashAlgorithm"=&gt;"SHA-256"), \
    ("hashEncoding"=&gt;"base64") \
  ])
</pre></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">hashAlgorithm</span></dt><dd><div class="para">
					Name of the <code class="literal">java.security.MessageDigest</code> algorithm to use to hash the password. There is no default so this option must be specified to enable hashing. Typical values are <code class="literal">SHA-256</code>, <code class="literal">SHA-1</code> and <code class="literal">MD5</code>.
				</div></dd><dt><span class="term">hashEncoding</span></dt><dd><div class="para">
					String that specifies one of three encoding types: <code class="literal">base64</code>, <code class="literal">hex</code> or <code class="literal">rfc2617</code>. The default is <code class="literal">base64</code>.
				</div></dd><dt><span class="term">hashCharset</span></dt><dd><div class="para">
					Encoding character set used to convert the clear text password to a byte array. The platform default encoding is the default.
				</div></dd><dt><span class="term">hashUserPassword</span></dt><dd><div class="para">
					Specifies the hashing algorithm must be applied to the password the user submits. The hashed user password is compared against the value in the login module, which is expected to be a hash of the password. The default is <code class="literal">true</code>.
				</div></dd><dt><span class="term">hashStorePassword</span></dt><dd><div class="para">
					Specifies the hashing algorithm must be applied to the password stored on the server side. This is used for digest authentication, where the user submits a hash of the user password along with a request-specific tokens from the server to be compare. The hash algorithm (for digest, this would be <code class="literal">rfc2617</code>) is utilized to compute a server-side hash, which should match the hashed value sent from the client.
				</div></dd></dl></div><div class="para">
		If you must generate passwords in code, the <code class="classname">org.jboss.security.auth.spi.Util</code> class provides a static helper method that will hash a password using the specified encoding. The following example produces a base64-encoded, MD5 hashed password.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>String hashedPassword = Util.<span xmlns="" class="perl_Function">createPasswordHash</span>(<span xmlns="" class="perl_String">"SHA-256"</span>,
<span xmlns="" class="line">​</span> Util.<span xmlns="" class="perl_Function">BASE64_ENCODING</span>, <span xmlns="" class="perl_Keyword">null</span>, <span xmlns="" class="perl_Keyword">null</span>, <span xmlns="" class="perl_String">"password"</span>);
</pre><div class="para">
		OpenSSL provides an alternative way to quickly generate hashed passwords at the command-line. The following example also produces a base64-encoded, SHA-256 hashed password. Here the password in plain text - <code class="literal">password</code> - is piped into the OpenSSL digest function then piped into another OpenSSL function to convert into base64-encoded format.
	</div><pre class="programlisting">echo -n password | openssl dgst -sha256 -binary | openssl base64</pre><div class="para">
		In both cases, the hashed version of the password is the same: <code class="literal"> XohImNooBHFR0OVvjcYpJ3NgPQ1qq73WKhHvch0VQtg=</code>. This value must be stored in the users' properties file specified in the security domain - <code class="filename">usersb64.properties</code> - in the example above.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28313-638664+%5BLatest%5D&amp;comment=Title%3A+Password+Hashing%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28313-638664+06+May+2014+20%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Unauthenticated_Identity">
      ⁠</a>18.3.1.3. Unauthenticated Identity</h3></div></div></div><div class="para">
		Not all requests are received in an authenticated format. <code class="literal">unauthenticatedIdentity</code> is a login module configuration option that assigns a specific identity (guest, for example) to requests that are made with no associated authentication information. This can be used to allow unprotected servlets to invoke methods on EJBs that do not require a specific role. Such a principal has no associated roles and so can only access either unsecured EJBs or EJB methods that are associated with the unchecked permission constraint.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="bold bold"><strong>unauthenticatedIdentity</strong></span>: This defines the principal name that should be assigned to requests that contain no authentication information.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28314-592747+%5BLatest%5D&amp;comment=Title%3A+Unauthenticated+Identity%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28314-592747+23+Feb+2014+17%3A00+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="LdapLoginModule1">
      ⁠</a>18.3.1.4. Ldap Login Module</h3></div></div></div><div class="para">
		<code class="literal">Ldap</code> login module is a <code class="literal">LoginModule</code> implementation that authenticates against a Lightweight Directory Access Protocol (LDAP) server. Use the <code class="literal">Ldap</code> login module if your user name and credentials are stored in an LDAP server that is accessible using a Java Naming and Directory Interface (JNDI) LDAP provider.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>AdvancedLDAP Login Module</strong></p></div><div class="admonition"><div class="para">
			If you wish to use LDAP with the SPNEGO authentication or skip some of the authentication phases while using an LDAP server, consider using the <code class="literal">AdvancedLdap</code> login module chained with the SPNEGO login module or only the <code class="literal">AdvancedLdap</code> login module.
		</div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Distinguished Name (DN)</span></dt><dd><div class="para">
					In Lightweight Directory Access Protocol (LDAP), the distinguished name uniquely identifies an object in a directory. Each distinguished name must have a unique name and location from all other objects, which is achieved using a number of attribute-value pairs (AVPs). The AVPs define information such as common names, organization unit, among others. The combination of these values results in a unique string required by the LDAP.
				</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			This login module also supports unauthenticated identity and password stacking.
		</div></div></div><div class="para">
		The LDAP connectivity information is provided as configuration options that are passed through to the environment object used to create JNDI initial context. The standard LDAP JNDI properties used include the following:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="property">java.naming.factory.initial</span></span></dt><dd><div class="para">
					<code class="classname">InitialContextFactory</code> implementation class name. This defaults to the Sun LDAP provider implementation <code class="literal">com.sun.jndi.ldap.LdapCtxFactory</code>.
				</div></dd><dt><span class="term"><span class="property">java.naming.provider.url</span></span></dt><dd><div class="para">
					LDAP URL for the LDAP server.
				</div></dd><dt><span class="term"><span class="property">java.naming.security.authentication</span></span></dt><dd><div class="para">
					Security protocol level to use. The available values include <code class="literal">none</code>, <code class="literal">simple</code>, and <code class="literal">strong</code>. If the property is undefined, the behavior is determined by the service provider.
				</div></dd><dt><span class="term"><span class="property">java.naming.security.protocol</span></span></dt><dd><div class="para">
					Transport protocol to use for secure access. Set this configuration option to the type of service provider (for example, SSL). If the property is undefined, the behavior is determined by the service provider.
				</div></dd><dt><span class="term"><span class="property">java.naming.security.principal</span></span></dt><dd><div class="para">
					Specifies the identity of the Principal for authenticating the caller to the service. This is built from other properties as described below.
				</div></dd><dt><span class="term"><span class="property">java.naming.security.credentials</span></span></dt><dd><div class="para">
					Specifies the credentials of the Principal for authenticating the caller to the service. Credentials can take the form of a hashed password, a clear-text password, a key, or a certificate. If the property is undefined, the behavior is determined by the service provider.
				</div></dd></dl></div><div class="para">
		For details of Ldap login module configuration options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			In certain directory schemas (e.g., Microsoft Active Directory), role attributes in the user object are stored as DNs to role objects instead of simple names. For implementations that use this schema type, <span class="property">roleAttributeIsDN</span> must be set to <code class="literal">true</code>.
		</div></div></div><div class="para">
		User authentication is performed by connecting to the LDAP server, based on the login module configuration options. Connecting to the LDAP server is done by creating an <code class="literal">InitialLdapContext</code> with an environment composed of the LDAP JNDI properties described previously in this section.
	</div><div class="para">
		The <span class="property">Context.SECURITY_PRINCIPAL</span> is set to the distinguished name of the user obtained by the callback handler in combination with the <span class="property">principalDNPrefix</span> and <span class="property">principalDNSuffix</span> option values, and the <span class="property">Context.SECURITY_CREDENTIALS</span> property is set to the respective <span class="property">String</span> password.
	</div><div class="para">
		Once authentication has succeeded (<code class="literal">InitialLdapContext</code> instance is created), the user's roles are queried by performing a search on the <code class="literal">rolesCtxDN</code> location with search attributes set to the <span class="property">roleAttributeName</span> and <span class="property">uidAttributeName</span> option values. The roles names are obtaining by invoking the <code class="methodname"> toString </code> method on the role attributes in the search result set.
	</div><div class="example"><a id="idm140550725383168">
      ⁠</a><p class="title"><strong>Example 18.7. LDAP Login Module Security Domain</strong></p><div class="example-contents"><div class="para">
			This management CLI example shows how to use the parameters in a security domain authentication configuration.
		</div><pre class="programlisting">
/subsystem=security/security-domain=testLDAP:add(cache-type=default)
/subsystem=security/security-domain=testLDAP/authentication=classic:add
/subsystem=security/security-domain=testLDAP/authentication=classic/login-module=Ldap:add( \
  code=Ldap, \
  flag=required, \
  module-options=[ \
    ("java.naming.factory.initial"=&gt;"com.sun.jndi.ldap.LdapCtxFactory"), \
    ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org:1389/"), \
    ("java.naming.security.authentication"=&gt;"simple"), \
    ("principalDNPrefix"=&gt;"uid="), \
    ("principalDNSuffix"=&gt;",ou=People,dc=jboss,dc=org"), \
    ("rolesCtxDN"=&gt;"ou=Roles,dc=jboss,dc=org"), \
    ("uidAttributeID"=&gt;"member"), \
    ("matchOnUserDN"=&gt;true), \
    ("roleAttributeID"=&gt;"cn"), \
    ("roleAttributeIsDN"=&gt;false) \
  ])
</pre></div></div><div class="para">
		The <em class="parameter"><code>java.naming.factory.initial</code></em>, <em class="parameter"><code>java.naming.factory.url</code></em> and <em class="parameter"><code>java.naming.security</code></em> options in the <span class="property">testLDAP</span> security domain configuration indicate the following conditions:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				The Sun LDAP JNDI provider implementation will be used
			</div></li><li class="listitem"><div class="para">
				The LDAP server is located on host <code class="literal">ldaphost.jboss.org</code> on port 1389
			</div></li><li class="listitem"><div class="para">
				The LDAP simple authentication method will be use to connect to the LDAP server.
			</div></li></ul></div><div class="para">
		The login module attempts to connect to the LDAP server using a Distinguished Name (DN) representing the user it is trying to authenticate. This DN is constructed from the passed <span class="property">principalDNPrefix</span>, the user name of the user and the <span class="property">principalDNSuffix</span> as described above. In <a class="xref" href="chap-Application_Security.html#exam-LDIF_File_Example">Example 18.8, “LDIF File Example”</a>, the user name <code class="literal">jsmith</code> would map to <code class="literal">uid=jsmith,ou=People,dc=jboss,dc=org</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The example assumes the LDAP server authenticates users using the <code class="literal">userPassword</code> attribute of the user's entry (<code class="literal">theduke</code> in this example). Most LDAP servers operate in this manner, however if your LDAP server handles authentication differently you must ensure LDAP is configured according to your production environment requirements.
		</div></div></div><div class="para">
		Once authentication succeeds, the roles on which authorization will be based are retrieved by performing a subtree search of the <code class="literal">rolesCtxDN</code> for entries whose <span class="property">uidAttributeID</span> match the user. If <span class="property">matchOnUserDN</span> is true, the search will be based on the full DN of the user. Otherwise the search will be based on the actual user name entered. In this example, the search is under <code class="literal">ou=Roles,dc=jboss,dc=org</code> for any entries that have a <code class="literal">member</code> attribute equal to <code class="literal">uid=jsmith,ou=People,dc=jboss,dc=org</code>. The search would locate <code class="literal">cn=JBossAdmin</code> under the roles entry.
	</div><div class="para">
		The search returns the attribute specified in the <span class="property">roleAttributeID</span> option. In this example, the attribute is <code class="literal">cn</code>. The value returned would be <code class="literal">JBossAdmin</code>, so the <code class="literal">jsmith</code> user is assigned to the <code class="literal">JBossAdmin</code> role.
	</div><div class="para">
		A local LDAP server often provides identity and authentication services, but is unable to use authorization services. This is because application roles do not always map well onto LDAP groups, and LDAP administrators are often hesitant to allow external application-specific data in central LDAP servers. The LDAP authentication module is often paired with another login module, such as the database login module, that can provide roles more suitable to the application being developed.
	</div><div class="para">
		An LDAP Data Interchange Format (LDIF) file representing the structure of the directory this data operates against is shown in <a class="xref" href="chap-Application_Security.html#exam-LDIF_File_Example">Example 18.8, “LDIF File Example”</a>.
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">LDAP Data Interchange Format (LDIF)</span></dt><dd><div class="para">
					Plain text data interchange format used to represent LDAP directory content and update requests. Directory content is represented as one record for each object or update request. Content consists of add, modify, delete, and rename requests.
				</div></dd></dl></div><div class="example"><a id="exam-LDIF_File_Example">
      ⁠</a><p class="title"><strong>Example 18.8. LDIF File Example</strong></p><div class="example-contents"><pre class="programlisting">dn: dc=jboss,dc=org
objectclass: top
objectclass: dcObject
objectclass: organization
dc: jboss
o: JBoss

dn: ou=People,dc=jboss,dc=org
objectclass: top
objectclass: organizationalUnit
ou: People

dn: uid=jsmith,ou=People,dc=jboss,dc=org
objectclass: top
objectclass: uidObject
objectclass: person
uid: jsmith
cn: John
sn: Smith
userPassword: theduke

dn: ou=Roles,dc=jboss,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Roles

dn: cn=JBossAdmin,ou=Roles,dc=jboss,dc=org
objectclass: top
objectclass: groupOfNames
cn: JBossAdmin
member: uid=jsmith,ou=People,dc=jboss,dc=org
description: the JBossAdmin group
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28310-771113+%5BLatest%5D&amp;comment=Title%3A+Ldap+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28310-771113+29+Sep+2015+11%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="LdapExtLoginModule">
      ⁠</a>18.3.1.5. LdapExtended Login Module</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Distinguished Name (DN)</span></dt><dd><div class="para">
					In Lightweight Directory Access Protocol (LDAP), the distinguished name uniquely identifies an object in a directory. Each distinguished name must have a unique name and location from all other objects, which is achieved using a number of attribute-value pairs (AVPs). The AVPs define information such as common names, organization unit, among others. The combination of these values results in a unique string required by the LDAP.
				</div></dd></dl></div><div class="para">
		The LdapExtended (<code class="classname">org.jboss.security.auth.spi.LdapExtLoginModule)</code> searches for the user to bind, as well as the associated roles, for authentication. The roles query recursively follows DNs to navigate a hierarchical role structure.
	</div><div class="para">
		The LoginModule options include whatever options are supported by the chosen LDAP JNDI provider supports. Examples of standard property names are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="property">Context.INITIAL_CONTEXT_FACTORY</span> = "java.naming.factory.initial"
			</div></li><li class="listitem"><div class="para">
				<span class="property">Context.SECURITY_PROTOCOL</span> = "java.naming.security.protocol"
			</div></li><li class="listitem"><div class="para">
				<span class="property">Context.PROVIDER_URL</span> = "java.naming.provider.url"
			</div></li><li class="listitem"><div class="para">
				<span class="property">Context.SECURITY_AUTHENTICATION</span> = "java.naming.security.authentication"
			</div></li><li class="listitem"><div class="para">
				<span class="property">Context.REFERRAL</span> = "java.naming.referral"
			</div></li></ul></div><div class="para">
		Login module implementation logic follows the order below:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
				The initial LDAP server bind is authenticated using the <span class="property">bindDN</span> and <span class="property">bindCredential</span> properties. The <span class="property">bindDN</span> is a user with permissions to search both the <span class="property">baseCtxDN</span> and <span class="property">rolesCtxDN</span> trees for the user and roles. The <span class="property">user DN</span> to authenticate against is queried using the filter specified by the <span class="property">baseFilter</span> property.
			</div></li><li class="listitem"><div class="para">
				The resulting <span class="property">userDN</span> is authenticated by binding to the LDAP server using the <span class="property">userDN</span> as the InitialLdapContext environment <span class="property">Context.SECURITY_PRINCIPAL</span>. The <span class="property">Context.SECURITY_CREDENTIALS</span> property is either set to the String password obtained by the callback handler.
			</div></li><li class="listitem"><div class="para">
				If this is successful, the associated user roles are queried using the rolesCtxDN, roleAttributeID, roleAttributeIsDN, roleNameAttributeID, and roleFilter options.
			</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			AdvancedLdap Login Module differs from LdapExtended Login Module in the following ways: 
			<div class="itemizedlist"><ul><li class="listitem"><div class="para">
						The top level role is queried only for roleAttributeID and not for roleNameAttributeID.
					</div></li><li class="listitem"><div class="para">
						When the roleAttributeIsDN module property is set to false, the recursive role search is disabled even if the recurseRoles module option is set to true.
					</div></li></ul></div>

		</div></div></div><div class="para">
		For details of LdapExtended login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="figure"><a id="idm140550718140528">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/4764.png" alt="LDAP Structure Example"/></div></div><p class="title"><strong>Figure 18.1. LDAP Structure Example</strong></p></div><div class="example"><a id="idm140550745208000">
      ⁠</a><p class="title"><strong>Example 18.9. Example 2 LDAP Configuration</strong></p><div class="example-contents"><pre class="programlisting">
version: 1
dn: o=example2,dc=jboss,dc=org
objectClass: top
objectClass: organization
o: example2

dn: ou=People,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: organizationalUnit
ou: People

dn: uid=jduke,ou=People,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: uidObject
objectClass: person
objectClass: inetOrgPerson
cn: Java Duke
employeeNumber: judke-123
sn: Duke
uid: jduke
userPassword:: dGhlZHVrZQ==

dn: uid=jduke2,ou=People,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: uidObject
objectClass: person
objectClass: inetOrgPerson
cn: Java Duke2
employeeNumber: judke2-123
sn: Duke2
uid: jduke2
userPassword:: dGhlZHVrZTI=

dn: ou=Roles,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Roles

dn: uid=jduke,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: groupUserEx
memberOf: cn=Echo,ou=Roles,o=example2,dc=jboss,dc=org
memberOf: cn=TheDuke,ou=Roles,o=example2,dc=jboss,dc=org
uid: jduke

dn: uid=jduke2,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: groupUserEx
memberOf: cn=Echo2,ou=Roles,o=example2,dc=jboss,dc=org
memberOf: cn=TheDuke2,ou=Roles,o=example2,dc=jboss,dc=org
uid: jduke2

dn: cn=Echo,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: groupOfNames
cn: Echo
description: the echo role
member: uid=jduke,ou=People,dc=jboss,dc=org

dn: cn=TheDuke,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: TheDuke
description: the duke role
member: uid=jduke,ou=People,o=example2,dc=jboss,dc=org

dn: cn=Echo2,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: groupOfNames
cn: Echo2
description: the Echo2 role
member: uid=jduke2,ou=People,dc=jboss,dc=org

dn: cn=TheDuke2,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: TheDuke2
description: the duke2 role
member: uid=jduke2,ou=People,o=example2,dc=jboss,dc=org

dn: cn=JBossAdmin,ou=Roles,o=example2,dc=jboss,dc=org
objectClass: top
objectClass: groupOfNames
cn: JBossAdmin
description: the JBossAdmin group
member: uid=jduke,ou=People,dc=jboss,dc=org</pre><div class="para">
			The module configuration for this LDAP structure example is outlined in the following management CLI command.
		</div><pre class="programlisting">

/subsystem=security/security-domain=testLdapExample2/authentication=classic/login-module=LdapExtended:add( \
  code=LdapExtended, \
  flag=required, \
  module-options=[ \
    ("java.naming.factory.initial"=&gt;"com.sun.jndi.ldap.LdapCtxFactory"), \
    ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"), \
    ("java.naming.security.authentication"=&gt;"simple"), \
    ("bindDN"=&gt;"cn=Root,dc=jboss,dc=org"), \
    ("bindCredential"=&gt;"secret1"), \
    ("baseCtxDN"=&gt;"ou=People,o=example2,dc=jboss,dc=org"), \
    ("baseFilter"=&gt;"(uid={0})"), \
    ("rolesCtxDN"=&gt;"ou=Roles,o=example2,dc=jboss,dc=org"), \
    ("roleFilter"=&gt;"(uid={0})"), \
    ("roleAttributeIsDN"=&gt;"true"), \
    ("roleAttributeID"=&gt;"memberOf"), \
    ("roleNameAttributeID"=&gt;"cn") \
  ])
</pre></div></div><div class="example"><a id="idm140550808234368">
      ⁠</a><p class="title"><strong>Example 18.10. Example 3 LDAP Configuration</strong></p><div class="example-contents"><pre class="programlisting">

dn: o=example3,dc=jboss,dc=org
objectclass: top
objectclass: organization
o: example3

dn: ou=People,o=example3,dc=jboss,dc=org
objectclass: top
objectclass: organizationalUnit
ou: People

dn: uid=jduke,ou=People,o=example3,dc=jboss,dc=org
objectclass: top
objectclass: uidObject
objectclass: person
objectClass: inetOrgPerson
uid: jduke
employeeNumber: judke-123
cn: Java Duke
sn: Duke
userPassword: theduke

dn: ou=Roles,o=example3,dc=jboss,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Roles

dn: uid=jduke,ou=Roles,o=example3,dc=jboss,dc=org
objectClass: top
objectClass: groupUserEx
memberOf: cn=Echo,ou=Roles,o=example3,dc=jboss,dc=org
memberOf: cn=TheDuke,ou=Roles,o=example3,dc=jboss,dc=org
uid: jduke

dn: cn=Echo,ou=Roles,o=example3,dc=jboss,dc=org
objectClass: top
objectClass: groupOfNames
cn: Echo
description: the JBossAdmin group
member: uid=jduke,ou=People,o=example3,dc=jboss,dc=org

dn: cn=TheDuke,ou=Roles,o=example3,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: TheDuke
member: uid=jduke,ou=People,o=example3,dc=jboss,dc=org

</pre></div></div><div class="para">
		The module configuration for this LDAP structure example is outlined in the following management CLI command.
	</div><pre class="programlisting">

/subsystem=security/security-domain=testLdapExample3/authentication=classic/login-module=LdapExtended:add( \
  code=LdapExtended, \
  flag=required, \
  module-options=[ \
    ("java.naming.factory.initial"=&gt;"com.sun.jndi.ldap.LdapCtxFactory"), \
    ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"), \
    ("java.naming.security.authentication"=&gt;"simple"), \
    ("bindDN"=&gt;"cn=Root,dc=jboss,dc=org"), \
    ("bindCredential"=&gt;"secret1"), \
    ("baseCtxDN"=&gt;"ou=People,o=example3,dc=jboss,dc=org"), \
    ("baseFilter"=&gt;"(cn={0})"), \
    ("rolesCtxDN"=&gt;"ou=Roles,o=example3,dc=jboss,dc=org"), \
    ("roleFilter"=&gt;"(member={1})"), \
    ("roleAttributeID"=&gt;"cn") \
  ])

</pre><div class="example"><a id="idm140550788017088">
      ⁠</a><p class="title"><strong>Example 18.11. Example 4 LDAP Configuration</strong></p><div class="example-contents"><pre class="programlisting">

dn: o=example4,dc=jboss,dc=org
objectclass: top
objectclass: organization
o: example4

dn: ou=People,o=example4,dc=jboss,dc=org
objectclass: top
objectclass: organizationalUnit
ou: People

dn: uid=jduke,ou=People,o=example4,dc=jboss,dc=org
objectClass: top
objectClass: uidObject
objectClass: person
objectClass: inetOrgPerson
cn: Java Duke
employeeNumber: jduke-123
sn: Duke
uid: jduke
userPassword:: dGhlZHVrZQ==

dn: ou=Roles,o=example4,dc=jboss,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Roles

dn: cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: RG1
member: cn=empty

dn: cn=RG2,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: RG2
member: cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org
member: uid=jduke,ou=People,o=example4,dc=jboss,dc=org

dn: cn=RG3,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: RG3
member: cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org

dn: cn=R1,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: R1
member: cn=RG2,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org

dn: cn=R2,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: R2
member: cn=RG2,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org

dn: cn=R3,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: R3
member: cn=RG2,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org
member: cn=RG3,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org

dn: cn=R4,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: R4
member: cn=RG3,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org

dn: cn=R5,ou=Roles,o=example4,dc=jboss,dc=org
objectClass: groupOfNames
objectClass: top
cn: R5
member: cn=RG3,cn=RG1,ou=Roles,o=example4,dc=jboss,dc=org
member: uid=jduke,ou=People,o=example4,dc=jboss,dc=org
</pre><div class="para">
			The module configuration for this LDAP structure example is outlined in the code sample.
		</div><pre class="programlisting">

/subsystem=security/security-domain=testLdapExample4/authentication=classic/login-module=LdapExtended:add( \
  code=LdapExtended, \
  flag=required, \
  module-options=[ \
    ("java.naming.factory.initial"=&gt;"com.sun.jndi.ldap.LdapCtxFactory"), \
    ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"), \
    ("java.naming.security.authentication"=&gt;"simple"), \
    ("bindDN"=&gt;"cn=Root,dc=jboss,dc=org"), \
    ("bindCredential"=&gt;"secret1"), \
    ("baseCtxDN"=&gt;"ou=People,o=example4,dc=jboss,dc=org"), \
    ("baseFilter"=&gt;"(cn={0})"), \
    ("rolesCtxDN"=&gt;"ou=Roles,o=example4,dc=jboss,dc=org"), \
    ("roleFilter"=&gt;"(member={1})"), \
    ("roleRecursion"=&gt;"1"), \
    ("roleAttributeID"=&gt;"memberOf") \
  ])

</pre></div></div><div class="example"><a id="exam-Default_ActiveDirectory_Configuration">
      ⁠</a><p class="title"><strong>Example 18.12. Default Active Directory Configuration</strong></p><div class="example-contents"><div class="para">
			The example below represents the configuration for a default Active Directory configuration.
		</div><div class="para">
			Some Active Directory configurations may require searching against the Global Catalog on port 3268 instead of the usual port 389. This is most likely when the Active Directory forest includes multiple domains.
		</div><pre class="programlisting">

/subsystem=security/security-domain=AD_Default/authentication=classic/login-module=LdapExtended:add( \
  code=LdapExtended, \
  flag=required, \
  module-options=[ \
    ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"), \
    ("bindDN"=&gt;"JBOSS\searchuser"), \
    ("bindCredential"=&gt;"password"), \
    ("baseCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), \
    ("baseFilter"=&gt;"(sAMAccountName={0})"), \
    ("rolesCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), \
    ("roleFilter"=&gt;"(sAMAccountName={0})"), \
    ("roleAttributeID"=&gt;"memberOf"), \
    ("roleAttributeIsDN"=&gt;"true"), \
    ("roleNameAttributeID"=&gt;"cn"), \
    ("searchScope"=&gt;"ONELEVEL_SCOPE"), \
    ("allowEmptyPasswords"=&gt;"false") \
  ])

</pre></div></div><div class="example"><a id="idm140550802809104">
      ⁠</a><p class="title"><strong>Example 18.13. Recursive Roles Active Directory Configuration</strong></p><div class="example-contents"><div class="para">
			The example below implements a recursive role search within Active Directory. The key difference between this example and the default Active Directory example is that the role search has been replaced to search the member attribute using the DN of the user. The login module then uses the DN of the role to find groups of which the group is a member.
		</div><pre class="programlisting">

/subsystem=security/security-domain=AD_Recursive/authentication=classic/login-module=LdapExtended:add( \
  code=LdapExtended, \
  flag=required, \
  module-options=[ \
    ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"), \
    ("java.naming.referral"=&gt;"follow"), \
    ("bindDN"=&gt;"JBOSS\searchuser"), \
    ("bindCredential"=&gt;"password"), \
    ("baseCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), \
    ("baseFilter"=&gt;"(sAMAccountName={0})"), \
    ("rolesCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), \
    ("roleFilter"=&gt;"(member={1})"), \
    ("roleAttributeID"=&gt;"cn"), \
    ("roleAttributeIsDN"=&gt;"false"), \
    ("roleRecursion"=&gt;"2"), \
    ("searchScope"=&gt;"ONELEVEL_SCOPE"), \
    ("allowEmptyPasswords"=&gt;"false") \
  ])

</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28311-771114+%5BLatest%5D&amp;comment=Title%3A+LdapExtended+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28311-771114+29+Sep+2015+11%3A18+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="UsersRolesLoginModule">
      ⁠</a>18.3.1.6. UsersRoles Login Module</h3></div></div></div><div class="para">
		<code class="literal">UsersRoles</code> login module is a simple login module that supports multiple users and user roles loaded from Java properties files. The default username-to-password mapping filename is <code class="filename">users.properties</code> and the default username-to-roles mapping filename is <code class="filename">roles.properties</code>.
	</div><div class="para">
		For details of UsersRoles login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para">
		This login module supports password stacking, password hashing, and unauthenticated identity.
	</div><div class="para">
		The properties files are loaded during initialization using the initialize method thread context class loader. This means that these files can be placed on the classpath of the Java EE deployment (for example, into the <code class="filename">WEB-INF/classes</code> folder in the <code class="literal">WAR</code> archive), or into any directory on the server classpath. The primary purpose of this login module is to easily test the security settings of multiple users and roles using properties files deployed with the application.
	</div><div class="example"><a id="exam-UsersRoleLoginModule">
      ⁠</a><p class="title"><strong>Example 18.14. UsersRoles Login Module</strong></p><div class="example-contents"><pre class="programlisting">
/subsystem=security/security-domain=ejb3-sampleapp/authentication=classic/login-module=UsersRoles:add( \
  code=UsersRoles, \
  flag=required, \
  module-options=[ \
    ("usersProperties"=&gt;"ejb3-sampleapp-users.properties"), \
    ("rolesProperties"=&gt;"ejb3-sampleapp-roles.properties") \
  ])
</pre></div></div><div class="para">
		In <a class="xref" href="chap-Application_Security.html#exam-UsersRoleLoginModule">Example 18.14, “UsersRoles Login Module”</a>, the <code class="filename">ejb3-sampleapp-users.properties</code> file uses a <code class="filename">username=password</code> format with each user entry on a separate line:
	</div><pre class="programlisting">
username1=password1
username2=password2
...
</pre><div class="para">
		The <code class="filename">ejb3-sampleapp-roles.properties</code> file referenced in <a class="xref" href="chap-Application_Security.html#exam-UsersRoleLoginModule">Example 18.14, “UsersRoles Login Module”</a> uses the pattern <code class="literal">username=role1,role2,</code> with an optional group name value. For example:
	</div><pre class="programlisting">
username1=role1,role2,...
username1.RoleGroup1=role3,role4,...
username2=role1,role3,...
</pre><div class="para">
		The <span class="property">user name.XXX</span> property name pattern present in <code class="filename">ejb3-sampleapp-roles.properties</code> is used to assign the user name roles to a particular named group of roles where the <code class="literal">XXX</code> portion of the property name is the group name. The <span class="property">user name=...</span> form is an abbreviation for <span class="property">user name.Roles=...</span>, where the <code class="literal">Roles</code> group name is the standard name the <code class="literal">JBossAuthorizationManager</code> expects to contain the roles which define the permissions of users.
	</div><div class="para">
		The following would be equivalent definitions for the <code class="literal">jduke</code> user name:
	</div><pre class="programlisting">
jduke=TheDuke,AnimatedCharacter
jduke.Roles=TheDuke,AnimatedCharacter
</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28315-771115+%5BLatest%5D&amp;comment=Title%3A+UsersRoles+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28315-771115+29+Sep+2015+11%3A21+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="DatabaseServerLoginModule">
      ⁠</a>18.3.1.7. Database Login Module</h3></div></div></div><div class="para">
		The <code class="literal">Database</code> login module is a Java Database Connectivity-based (JDBC) login module that supports authentication and role mapping. Use this login module if you have your user name, password and role information stored in a relational database.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			This module supports password stacking, password hashing and unauthenticated identity.
		</div></div></div><div class="para">
		The <code class="literal">Database</code> login module is based on two logical tables:
	</div><pre class="programlisting">
Table Principals(PrincipalID text, Password text)
Table Roles(PrincipalID text, Role text, RoleGroup text)
</pre><div class="para">
		The <code class="literal">Principals</code> table associates the user <code class="literal">PrincipalID</code> with the valid password and the <code class="literal">Roles</code> table associates the user <code class="literal">PrincipalID</code> with its role sets. The roles used for user permissions must be contained in rows with a <code class="literal">RoleGroup</code> column value of <code class="literal">Roles</code>.
	</div><div class="para">
		The tables are logical in that you can specify the SQL query that the login module uses. The only requirement is that the <code class="literal">java.sql.ResultSet</code> has the same logical structure as the <code class="literal">Principals</code> and <code class="literal">Roles</code> tables described previously. The actual names of the tables and columns are not relevant as the results are accessed based on the column index.
	</div><div class="para">
		To clarify this notion, consider a database with two tables, <code class="literal">Principals</code> and <code class="literal">Roles</code>, as already declared. The following statements populate the tables with the following data:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">PrincipalID</code> <code class="literal">java</code> with a <code class="literal">Password</code> of <code class="literal">echoman</code> in the <code class="literal">Principals</code> table
			</div></li><li class="listitem"><div class="para">
				<code class="literal">PrincipalID</code> <code class="literal">java</code> with a role named <code class="literal">Echo</code> in the <code class="literal">Roles</code><code class="literal">RoleGroup</code> in the <code class="literal">Roles</code> table
			</div></li><li class="listitem"><div class="para">
				<code class="literal">PrincipalID</code> <code class="literal">java</code> with a role named <code class="literal">caller_java</code> in the <code class="literal">CallerPrincipal</code><code class="literal">RoleGroup</code> in the <code class="literal">Roles</code> table
			</div></li></ul></div><pre class="programlisting">INSERT INTO Principals VALUES('java', 'echoman')
INSERT INTO Roles VALUES('java', 'Echo', 'Roles')
INSERT INTO Roles VALUES('java', 'caller_java', 'CallerPrincipal')
</pre><div class="para">
		For details of Database login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para">
		An example <code class="literal">Database login module</code> configuration could be constructed as follows:
	</div><pre class="programlisting">
CREATE TABLE Users(username VARCHAR(64) PRIMARY KEY, passwd VARCHAR(64))
CREATE TABLE UserRoles(username VARCHAR(64), role VARCHAR(32))
</pre><div class="para">
		A corresponding login module configuration in a security domain:
	</div><pre class="programlisting">
/subsystem=security/security-domain=testDB/authentication=classic/login-module=Database:add( \
  code=Database, \
  flag=required, \
  module-options=[ \
    ("dsJndiName"=&gt;"java:/MyDatabaseDS"), \
    ("principalsQuery"=&gt;"select passwd from Users where username=?"), \
    ("rolesQuery"=&gt;"select role, 'Roles' from UserRoles where username=?") \
  ])
</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28316-771118+%5BLatest%5D&amp;comment=Title%3A+Database+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28316-771118+29+Sep+2015+11%3A27+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="BaseCertLoginModule">
      ⁠</a>18.3.1.8. Certificate Login Module</h3></div></div></div><div class="para">
		<code class="literal">Certificate</code> login module authenticates users based on X509 certificates. A typical use case for this login module is <code class="literal">CLIENT-CERT</code> authentication in the web tier.
	</div><div class="para">
		This login module only performs authentication: you must combine it with another login module capable of acquiring authorization roles to completely define access to a secured web or EJB component. Two subclasses of this login module, <code class="literal">CertRolesLoginModule</code> and <code class="literal">DatabaseCertLoginModule</code> extend the behavior to obtain the authorization roles from either a properties file or database.
	</div><div class="para">
		For details of <code class="literal">Certificate</code> login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para">
		The <code class="literal">Certificate</code> login module needs a <code class="literal">KeyStore</code> to perform user validation. This is obtained from a JSSE configuration of linked security domain as shown in the following configuration fragment:
	</div><pre class="programlisting">
/subsystem=security/security-domain=trust-domain:add
/subsystem=security/security-domain=trust-domain/jsse=classic:add( \
  truststore={ \
    password=&gt;pass1234, \
    url=&gt;/home/jbosseap/trusted-clients.jks \
  })

/subsystem=security/security-domain=testCert:add
/subsystem=security/security-domain=testCert/authentication=classic:add
/subsystem=security/security-domain=testCert/authentication=classic/login-module=Certificate:add( \
  code=Certificate, \
  flag=required, \
  module-options=[ \
    ("securityDomain"=&gt;"trust-domain"), \
  ])
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Secure_Web_Applications_With_Certs_Role_Based_Authorization">
      ⁠</a><p class="title"><strong>Procedure 18.4. Secure Web Applications with Certificates and Role-based Authorization</strong></p><div class="para">
			This procedure describes how to secure a web application, such as the <code class="filename">user-app.war</code>, using client certificates and role-based authorization. In this example the <code class="literal">CertificateRoles</code> login module is used for authentication and authorization. Both the <code class="literal">trusted-clients.keystore</code> and the <code class="literal">app-roles.properties</code> require an entry that maps to the principal associated with the client certificate.
		</div><div class="para">
			By default, the principal is created using the client certificate distinguished name, such as the DN specified in <a class="xref" href="chap-Application_Security.html#exam-Certificate_Example">Example 18.15, “Certificate Example”</a>.
		</div><ol class="1"><li class="step"><p class="title"><strong>Declare Resources and Roles</strong></p><div class="para">
				Modify <code class="filename">web.xml</code> to declare the resources to be secured along with the allowed roles and security domain to be used for authentication and authorization.
			</div><pre class="programlisting">

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
        version="3.0"&gt;

        &lt;security-constraint&gt;
                &lt;web-resource-collection&gt;
                        &lt;web-resource-name&gt;Protect App&lt;/web-resource-name&gt;
                        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/web-resource-collection&gt;
                &lt;auth-constraint&gt;
                        &lt;role-name&gt;Admin&lt;/role-name&gt;
                &lt;/auth-constraint&gt;
        &lt;/security-constraint&gt;

        &lt;login-config&gt;
                &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
                &lt;realm-name&gt;Secured area&lt;/realm-name&gt;
        &lt;/login-config&gt;

        &lt;security-role&gt;
                &lt;role-name&gt;Admin&lt;/role-name&gt;
        &lt;/security-role&gt;
&lt;/web-app&gt;

</pre></li><li class="step"><p class="title"><strong>Specify the Security Domain</strong></p><div class="para">
				In the <code class="literal">jboss-web.xml</code> file, specify the required security domain.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>app-sec-domain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
<span xmlns="" class="line">​</span>
</pre></li><li class="step"><p class="title"><strong>Configure Login Module</strong></p><div class="para">
				Define the login module configuration for the <code class="literal">app-sec-domain</code> domain you just specified using the management CLI.
			</div><pre class="programlisting">[
/subsystem=security/security-domain=trust-domain:add
/subsystem=security/security-domain=trust-domain/jsse=classic:add( \
  truststore={ \
    password=&gt;pass1234, \
    url=&gt;/home/jbosseap/trusted-clients.jks \
  })

/subsystem=security/security-domain=app-sec-domain:add
/subsystem=security/security-domain=app-sec-domain/authentication=classic:add
/subsystem=security/security-domain=app-sec-domain/authentication=classic/login-module=CertificateRoles:add( \
  code=CertificateRoles, \
  flag=required, \
  module-options=[ \
    ("securityDomain"=&gt;"trust-domain"), \
    ("rolesProperties"=&gt;"app-roles.properties") \
  ])
</pre></li></ol></div><div class="example"><a id="exam-Certificate_Example">
      ⁠</a><p class="title"><strong>Example 18.15. Certificate Example</strong></p><div class="example-contents"><pre class="screen">
[conf]$ keytool -printcert -file valid-client-cert.crt
Owner: CN=valid-client, OU=Security QE, OU=JBoss, O=Red Hat, C=CZ
Issuer: CN=EAP Certification Authority, OU=Security QE, OU=JBoss, O=Red Hat, C=CZ
Serial number: 2
Valid from: Mon Mar 24 18:21:55 CET 2014 until: Tue Mar 24 18:21:55 CET 2015
Certificate fingerprints:
         MD5:  0C:54:AE:6E:29:ED:E4:EF:46:B5:14:30:F2:E0:2A:CB
         SHA1: D6:FB:19:E7:11:28:6C:DE:01:F2:92:2F:22:EF:BB:5D:BF:73:25:3D
         SHA256: CD:B7:B1:72:A3:02:42:55:A3:1C:30:E1:A6:F0:20:B0:2C:0F:23:4F:7A:8E:2F:2D:FA:AF:55:3E:A7:9B:2B:F4
         Signature algorithm name: SHA1withRSA
         Version: 3
</pre></div></div><div class="para">
		The <code class="literal">trusted-clients.keystore</code> would need the certificate in <a class="xref" href="chap-Application_Security.html#exam-Certificate_Example">Example 18.15, “Certificate Example”</a> stored with an alias of <code class="literal">CN=valid-client, OU=Security QE, OU=JBoss, O=Red Hat, C=CZ</code>. The <code class="literal">app-roles.properties</code> must have the same entry. Since the DN contains characters that are normally treated as delimiters, you must escape the problem characters using a backslash ('<code class="literal">\</code>') as illustrated below.
	</div><pre class="screen">
# A sample app-roles.properties file
CN\=valid-client,\ OU\=Security\ QE,\ OU\=JBoss,\ O\=Red\ Hat,\ C\=CZ
</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28317-771119+%5BLatest%5D&amp;comment=Title%3A+Certificate+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28317-771119+29+Sep+2015+11%3A28+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="IdentityLoginModule">
      ⁠</a>18.3.1.9. Identity Login Module</h3></div></div></div><div class="para">
		<code class="literal">Identity</code> login module is a simple login module that associates a hard-coded user name to any subject authenticated against the module. It creates a <code class="literal">SimplePrincipal</code> instance using the name specified by the <code class="literal">principal</code> option.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			This module supports password stacking.
		</div></div></div><div class="para">
		This login module is useful when you need to provide a fixed identity to a service, and in development environments when you want to test the security associated with a given principal and associated roles.
	</div><div class="para">
		For details of Identity login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para">
		A sample security domain configuration is described below. It authenticates all users as the principal named <code class="literal">jduke</code> and assigns role names of <code class="literal">TheDuke</code>, and <code class="literal">AnimatedCharacter</code>:.
	</div><pre class="programlisting">
/subsystem=security/security-domain=testIdentity:add
/subsystem=security/security-domain=testIdentity/authentication=classic:add
/subsystem=security/security-domain=testIdentity/authentication=classic/login-module=Identity:add( \
  code=Identity, \
  flag=required, \
  module-options=[ \
    ("principal"=&gt;"jduke"), \
    ("roles"=&gt;"TheDuke,AnimatedCharacter") \
  ])

</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28318-771116+%5BLatest%5D&amp;comment=Title%3A+Identity+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28318-771116+29+Sep+2015+11%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-RunAs_Login_Module">
      ⁠</a>18.3.1.10. RunAs Login Module</h3></div></div></div><div class="para">
					<code class="literal">RunAs</code> login module is a helper module that pushes a <code class="literal">run as</code> role onto the stack for the duration of the login phase of authentication, then pops the <code class="literal">run as</code> role from the stack in either the commit or abort phase.
				</div><div class="para">
					The purpose of this login module is to provide a role for other login modules that must access secured resources in order to perform their authentication (for example, a login module that accesses a secured EJB). <code class="literal">RunAs</code> login module must be configured ahead of the login modules that require a <code class="literal">run as</code> role established.
				</div><div class="para">
					For details of RunAs login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
				</div><div class="para RoleCreateBugPara">
					<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A28319-771117+%5BLatest%5D&amp;comment=Title%3A+RunAs+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
				</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="RunAsIdentity_Creation">
      ⁠</a>18.3.1.10.1. RunAsIdentity Creation</h4></div></div></div><div class="para">
		In order for JBoss EAP 6 to secure access to EJB methods, the identity of the user must be known at the time the method call is made.
	</div><div class="para">
		A user's identity in the server is represented either by a <code class="classname">javax.security.auth.Subject</code> instance or an <code class="classname">org.jboss.security.RunAsIdentity</code> instance. Both these classes store one or more principals that represent the identity and a list of roles that the identity possesses. In the case of the <code class="classname">javax.security.auth.Subject</code> a list of credentials is also stored.
	</div><div class="para">
		In the <span class="markup">&lt;assembly-descriptor&gt;</span> section of the <code class="filename">ejb-jar.xml</code> deployment descriptor, you specify one or more roles that a user must have to access the various EJB methods. A comparison of these lists reveals whether the user has one of the roles necessary to access the EJB method.
	</div><div class="example"><a id="exam-RunAsIdentity_Creation">
      ⁠</a><p class="title"><strong>Example 18.16. org.jboss.security.RunAsIdentity Creation</strong></p><div class="example-contents"><div class="para">
			In the <code class="filename">ejb-jar.xml</code> file, you specify a <span class="markup">&lt;security-identity&gt;</span> element with a <span class="markup">&lt;run-as&gt;</span> role defined as a child of the &lt;session&gt; element.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;session&gt;</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;security-identity&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;run-as&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>Admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/run-as&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/security-identity&gt;</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/session&gt;</span></pre><div class="para">
			This declaration signifies that an <code class="literal">Admin</code> RunAsIdentity role must be created.
		</div><div class="para">
			To name a principal for the <code class="literal">Admin</code> role, you define a <code class="sgmltag-element">&lt;run-as-principal&gt;</code> element in the <code class="filename">jboss-ejb3.xml</code> file.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss:ejb-jar</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        xmlns:jboss=</span><span xmlns="" class="perl_String">"http://www.jboss.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        xmlns:s=</span><span xmlns="" class="perl_String">"urn:security:1.1"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        version=</span><span xmlns="" class="perl_String">"3.1"</span><span xmlns="" class="perl_Others"> impl-version=</span><span xmlns="" class="perl_String">"2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;s:security&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>WhoAmIBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;s:run-as-principal&gt;</span>John<span xmlns="" class="perl_Keyword">&lt;/s:run-as-principal&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/s:security&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss:ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
			The <code class="sgmltag-element">&lt;security-identity&gt;</code> element in both the <code class="filename">ejb-jar.xml</code> and <code class="sgmltag-element">&lt;security&gt;</code> element in the <code class="filename">jboss-ejb3.xml</code> files are parsed at deployment time. The <code class="sgmltag-element">&lt;run-as&gt;</code> role name and the <code class="sgmltag-element">&lt;run-as-principal&gt;</code> name are then stored in the <code class="classname">org.jboss.metadata.ejb.spec.SecurityIdentityMetaData</code> class.
		</div></div></div><div class="example"><a id="idm140550722870048">
      ⁠</a><p class="title"><strong>Example 18.17. Assigning multiple roles to a RunAsIdentity</strong></p><div class="example-contents"><div class="para">
			You can assign more roles to RunAsIdentity by mapping roles to principals in the <code class="filename">jboss-ejb3.xml</code> deployment descriptor <code class="sgmltag-element">&lt;assembly-descriptor&gt;</code> element group.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss:ejb-jar</span><span xmlns="" class="perl_Others"> xmlns:sr=</span><span xmlns="" class="perl_String">"urn:security-role"</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Error">...</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>            ...
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;sr:security-role&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;sr:role-name&gt;</span>Support<span xmlns="" class="perl_Keyword">&lt;/sr:role-name&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;sr:principal-name&gt;</span>John<span xmlns="" class="perl_Keyword">&lt;/sr:principal-name&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;sr:principal-name&gt;</span>Jill<span xmlns="" class="perl_Keyword">&lt;/sr:principal-name&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;sr:principal-name&gt;</span>Tony<span xmlns="" class="perl_Keyword">&lt;/sr:principal-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/sr:security-role&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss:ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
			In <a class="xref" href="chap-Application_Security.html#exam-RunAsIdentity_Creation">Example 18.16, “org.jboss.security.RunAsIdentity Creation”</a>, the <code class="sgmltag-element">&lt;run-as-principal&gt;</code> of <code class="literal">John</code> was created. The configuration in this example extends the <code class="literal">Admin</code> role, by adding the <code class="literal">Support</code> role. The new role contains extra principals, including the originally defined principal <code class="literal">John</code>.
		</div><div class="para">
			The <code class="sgmltag-element">&lt;security-role&gt;</code> element in both the <code class="filename">ejb-jar.xml</code> and <code class="filename">jboss-ejb3.xml</code> files are parsed at deployment time. The <code class="sgmltag-element">&lt;role-name&gt;</code> and the <code class="sgmltag-element">&lt;principal-name&gt;</code> data is stored in the <code class="classname">org.jboss.metadata.ejb.spec.SecurityIdentityMetaData</code> class.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28320-640429+%5BLatest%5D&amp;comment=Title%3A+RunAsIdentity+Creation%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28320-640429+12+May+2014+18%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ClientLoginModule">
      ⁠</a>18.3.1.11. Client Login Module</h3></div></div></div><div class="para">
		<code class="literal">Client</code> login module (<code class="classname">org.jboss.security.ClientLoginModule</code>) is an implementation of <code class="literal">LoginModule</code> for use by JBoss clients when establishing caller identity and credentials. This creates a new <code class="literal">SecurityContext</code> assigns it a principal and a credential and sets the <code class="literal">SecurityContext</code> to the <code class="literal">ThreadLocal</code> security context.
	</div><div class="para">
		<code class="literal">Client</code> login module is the only supported mechanism for a client to establish the current thread's caller. Both stand-alone client applications, and server environments (acting as JBoss EJB clients where the security environment has not been configured to use the EAP security subsystem transparently) must use <code class="literal">Client</code> login module.
	</div><div class="para">
		Note that this login module does not perform any authentication. It merely copies the login information provided to it into the server EJB invocation layer for subsequent authentication on the server. If you need to perform client-side authentication of users you would need to configure another login module in addition to the <code class="literal">Client</code> login module.
	</div><div class="para">
		For details of Client login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28321-771110+%5BLatest%5D&amp;comment=Title%3A+Client+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28321-771110+29+Sep+2015+11%3A11+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="SPNEGOLoginModule">
      ⁠</a>18.3.1.12. SPNEGO Login Module</h3></div></div></div><div class="para">
		<code class="literal">SPNEGO</code> login module (<code class="classname">org.jboss.security.negotiation.spnego.SPNEGOLoginModule</code>) is an implementation of <code class="literal">LoginModule</code> that establishes caller identity and credentials with a KDC. The module implements SPNEGO (Simple and Protected GSSAPI Negotiation mechanism) and is a part of the JBoss Negotiation project. This authentication can be used in the chained configuration with the <code class="code">AdvancedLdap</code> login module to allow cooperation with an LDAP server.
	</div><div class="para">
		For details of SPNEGO login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para">
		The JBoss Negotiation module is not included as a standard dependency for deployed applications. To use the <code class="code">SPNEGO</code> or <code class="code">AdvancedLdap</code> login modules in your project, you must add the dependency manually by editing the <code class="filename">META-INF/jboss-deployment-structure.xml</code> deployment descriptor file.
	</div><div class="example"><a id="idm140550782365744">
      ⁠</a><p class="title"><strong>Example 18.18. Add JBoss Negotiation Module as a Dependency</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-deployment-structure&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;deployment&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.jboss.security.negotiation"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-deployment-structure&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28322-771112+%5BLatest%5D&amp;comment=Title%3A+SPNEGO+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28322-771112+29+Sep+2015+11%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="RoleMappingLoginModule">
      ⁠</a>18.3.1.13. RoleMapping Login Module</h3></div></div></div><div class="para">
		<code class="literal">RoleMapping</code> login module supports mapping roles, that are the end result of the authentication process, to one or more declarative roles. For example, if the authentication process has determined that the user "A" has the roles "ldapAdmin" and "testAdmin", and the declarative role defined in the <code class="filename">web.xml</code> or <code class="filename">ejb-jar.xml</code> file for access is <code class="literal">admin</code>, then this login module maps the <code class="literal">admin</code> roles to the user <code class="literal">A</code>.
	</div><div class="para">
		For details of <code class="literal">RoleMapping</code> login module options, see the <em class="citetitle">Included Authentication Modules</em> reference in the <em class="citetitle">Security Guide</em> for JBoss EAP.
	</div><div class="para">
		The <code class="literal">RoleMapping</code> login module must be defined as an optional module to a login module configuration as it alters mapping of the previously mapped roles.
	</div><div class="example"><a id="idm140550796280032">
      ⁠</a><p class="title"><strong>Example 18.19. Defining mapped roles</strong></p><div class="example-contents"><pre class="programlisting">
/subsystem=security/security-domain=test-domain-2/:add
/subsystem=security/security-domain=test-domain-2/authentication=classic:add
/subsystem=security/security-domain=test-domain-2/authentication=classic/login-module=test-2-lm/:add(\
flag=required,\
code=UsersRoles,\
module-options=[("usersProperties"=&gt;"users.properties"),("rolesProperties"=&gt;"roles.properties")]\
)
/subsystem=security/security-domain=test-domain-2/authentication=classic/login-module=test2-map/:add(\
flag=optional,\
code=RoleMapping,\
module-options=[("rolesProperties"=&gt;"rolesMapping-roles.properties")]\
)
</pre></div></div><div class="para">
		Another example achieving the same result, but using the mapping module. This is the preferred method of role mapping:
	</div><div class="example"><a id="idm140550721259536">
      ⁠</a><p class="title"><strong>Example 18.20. Preferred method of defining mapped roles</strong></p><div class="example-contents"><pre class="programlisting">
/subsystem=security/security-domain=test-domain-2/:add
/subsystem=security/security-domain=test-domain-2/authentication=classic:add
/subsystem=security/security-domain=test-domain-2/authentication=classic/login-module=test-2-lm/:add(\
flag=required,\
code=UsersRoles,\
module-options=[("usersProperties"=&gt;"users.properties"),("rolesProperties"=&gt;"roles.properties")]\
)
/subsystem=security/security-domain=test-domain-2/mapping=classic/mapping-module=test2-map/:add(\
code=PropertiesRoles,type=role,\
module-options=[("rolesProperties"=&gt;"rolesMapping-roles.properties")]\
)
</pre></div></div><div class="example"><a id="exam-PropertiesFile_RoleMappingLoginModule">
      ⁠</a><p class="title"><strong>Example 18.21. Properties File used by a RoleMappingLoginModule</strong></p><div class="example-contents"><pre class="programlisting">
ldapAdmin=admin, testAdmin
</pre><div class="para">
			If the authenticated subject contains role <code class="literal">ldapAdmin</code>, then the roles <code class="literal">admin</code> and <code class="literal">testAdmin</code> are added to or substitute the authenticated subject depending on the <span class="property">replaceRole</span> property value.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28323-771111+%5BLatest%5D&amp;comment=Title%3A+RoleMapping+Login+Module%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28323-771111+29+Sep+2015+11%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Mechanism_to_Cache_Passwords_from_External_Source">
      ⁠</a>18.3.1.14. bindCredential Module Option</h3></div></div></div><div class="para">
		The <code class="literal">bindCredential</code> module option is used to store the credentials for the DN and can be used by several login and mapping modules. There are several methods for obtaining the password.
	</div><div class="variablelist"><p class="title"><strong/></p><dl class="variablelist"><dt><span class="term"> Plaintext in a management CLI command. </span></dt><dd><div class="para">
					The password for the <code class="code">bindCredential</code> module may be provided in plaintext, in a management CLI command. For example: <code class="code">("bindCredential"=&gt;"secret1")</code>. For security reasons, the password should be encrypted using the JBoss EAP vault mechanism.
				</div></dd><dt><span class="term"> Use an external command. </span></dt><dd><div class="para">
					To obtain the password from the output of an external command, use the format <code class="code">{EXT}...</code> where the <code class="code">...</code> is the external command. The first line of the command output is used as the password.
				</div><div class="para">
					To improve performance, the <code class="code">{EXTC[:expiration_in_millis]}</code> variant caches the password for a specified number of milliseconds. By default the cached password does not expire. If the value <code class="literal">0</code> (zero) is specified, the cached credentials do not expire.
				</div><div class="para">
					The <code class="code">EXTC</code> variant is only supported by the <code class="code">LdapExtended</code> login module.
				</div></dd></dl></div><div class="example"><a id="idm140550770289328">
      ⁠</a><p class="title"><strong>Example 18.22. Obtain a password from an external command</strong></p><div class="example-contents"><div class="para">
			
<pre class="screen">
{EXT}cat /mysecretpasswordfile
</pre>

		</div></div></div><div class="example"><a id="idm140550810465696">
      ⁠</a><p class="title"><strong>Example 18.23. Obtain a password from an external file and cache it for 500 milliseconds</strong></p><div class="example-contents"><div class="para">
			
<pre class="screen">
{EXTC:500}cat /mysecretpasswordfile
</pre>

		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+38715-681306+%5BLatest%5D&amp;comment=Title%3A+bindCredential+Module+Option%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=38715-681306+03+Jul+2014+20%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Custom_Modules">
      ⁠</a>18.3.2. Custom Modules</h2></div></div></div><div class="para">
				If the login modules bundled with the EAP security framework do not work with your security environment, you can write your own custom login module implementation. The <code class="literal">AuthenticationManager</code> requires a particular usage pattern of the <code class="literal">Subject</code> principals set. You must understand the JAAS Subject class's information storage features and the expected usage of these features to write a login module that works with the <code class="literal">AuthenticationManager</code>.
			</div><div class="para">
				This section examines this requirement and introduces two abstract base <code class="literal">LoginModule</code> implementations that can help you implement custom login modules.
			</div><div class="para">
				You can obtain security information associated with a <code class="literal">Subject</code> by using the following methods:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Set</span> <span xmlns="" class="perl_Function">getPrincipals</span>()
<span xmlns="" class="line">​</span>java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Set</span> <span xmlns="" class="perl_Function">getPrincipals</span>(java.<span xmlns="" class="perl_Function">lang</span>.<span xmlns="" class="perl_Function">Class</span> c)
<span xmlns="" class="line">​</span>java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Set</span> <span xmlns="" class="perl_Function">getPrivateCredentials</span>()
<span xmlns="" class="line">​</span>java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Set</span> <span xmlns="" class="perl_Function">getPrivateCredentials</span>(java.<span xmlns="" class="perl_Function">lang</span>.<span xmlns="" class="perl_Function">Class</span> c)
<span xmlns="" class="line">​</span>java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Set</span> <span xmlns="" class="perl_Function">getPublicCredentials</span>()
<span xmlns="" class="line">​</span>java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Set</span> <span xmlns="" class="perl_Function">getPublicCredentials</span>(java.<span xmlns="" class="perl_Function">lang</span>.<span xmlns="" class="perl_Function">Class</span> c)</pre><div class="para">
				For <code class="literal">Subject</code> identities and roles, EAP has selected the most logical choice: the principals sets obtained via <code class="literal">getPrincipals()</code> and <code class="literal">getPrincipals(java.lang.Class)</code>. The usage pattern is as follows:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						User identities (for example; user name, social security number, employee ID) are stored as <code class="literal">java.security.Principal</code> objects in the <code class="literal">Subject</code><code class="literal">Principals</code> set. The <code class="literal">Principal</code> implementation that represents the user identity must base comparisons and equality on the name of the principal. A suitable implementation is available as the <code class="literal">org.jboss.security.SimplePrincipal</code> class. Other <code class="literal">Principal</code> instances may be added to the <code class="literal">Subject</code><code class="literal">Principals</code> set as needed.
					</div></li><li class="listitem"><div class="para">
						Assigned user roles are also stored in the <code class="literal">Principals</code> set, and are grouped in named role sets using <code class="literal">java.security.acl.Group</code> instances. The <code class="literal">Group</code> interface defines a collection of <code class="literal">Principal</code>s and/or <code class="literal">Group</code>s, and is a subinterface of <code class="literal">java.security.Principal</code>.
					</div></li><li class="listitem"><div class="para">
						Any number of role sets can be assigned to a <code class="literal">Subject</code>.
					</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						The EAP security framework uses two well-known role sets with the names <code class="literal">Roles</code> and <code class="literal">CallerPrincipal</code>.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								The <code class="literal">Roles</code> group is the collection of <code class="literal">Principal</code>s for the named roles as known in the application domain under which the <code class="literal">Subject</code> has been authenticated. This role set is used by methods like the <code class="literal">EJBContext.isCallerInRole(String)</code>, which EJBs can use to see if the current caller belongs to the named application domain role. The security interceptor logic that performs method permission checks also uses this role set.
							</div></li><li class="listitem"><div class="para">
								The <code class="literal">CallerPrincipal</code> <code class="literal">Group</code> consists of the single <code class="literal">Principal</code> identity assigned to the user in the application domain. The <code class="literal">EJBContext.getCallerPrincipal() </code>method uses the <code class="literal">CallerPrincipal</code> to allow the application domain to map from the operation environment identity to a user identity suitable for the application. If a <code class="literal">Subject</code> does not have a <code class="literal">CallerPrincipal</code> <code class="literal">Group</code>, the application identity is the same as operational environment identity.
							</div></li></ul></div></li></ul></div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A28324-686361+%5BLatest%5D&amp;comment=Title%3A+Custom+Modules%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Subject_Usage_Pattern_Support">
      ⁠</a>18.3.2.1. Subject Usage Pattern Support</h3></div></div></div><div class="para">
		To simplify correct implementation of the <code class="literal">Subject</code> usage patterns described in <a class="xref" href="chap-Application_Security.html#sect-Custom_Modules">Section 18.3.2, “Custom Modules”</a>, EAP includes login modules that populate the authenticated <code class="literal">Subject</code> with a template pattern that enforces correct <code class="literal">Subject</code> usage.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">AbstractServerLoginModule</div>
			The most generic of the two is the <code class="literal">org.jboss.security.auth.spi.AbstractServerLoginModule</code> class.
		</div><div class="para">
		It provides an implementation of the <code class="literal">javax.security.auth.spi.LoginModule</code> interface and offers abstract methods for the key tasks specific to an operation environment security infrastructure. The key details of the class are highlighted in <a class="xref" href="chap-Application_Security.html#exam-AbstractServerLoginModule_Class_Fragment">Example 18.24, “AbstractServerLoginModule Class Fragment”</a>. The JavaDoc comments detail the responsibilities of subclasses.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			The <code class="literal">loginOk</code> instance variable is pivotal. This must be set to <code class="literal">true</code> if the log in succeeds, or <code class="literal">false</code> by any subclasses that override the log in method. If this variable is incorrectly set, the commit method will not correctly update the subject.
		</div></div></div><div class="para">
		Tracking the log in phase outcomes allows login modules to be chained together with control flags. These control flags do not require the login modules to succeed as part of the authentication process.
	</div><div class="example"><a id="exam-AbstractServerLoginModule_Class_Fragment">
      ⁠</a><p class="title"><strong>Example 18.24. AbstractServerLoginModule Class Fragment</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">security</span>.<span xmlns="" class="perl_Function">auth</span>.<span xmlns="" class="perl_Function">spi</span>;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  This class implements the common functionality required for a JAAS</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  server-side LoginModule and implements the PicketBox standard</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  Subject usage pattern of storing identities and roles. Subclass</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  this module to create your own custom LoginModule and override the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  login(), getRoleSets(), and getIdentity() methods.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">abstract</span> <span xmlns="" class="perl_Keyword">class</span> AbstractServerLoginModule
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">implements</span> javax.<span xmlns="" class="perl_Function">security</span>.<span xmlns="" class="perl_Function">auth</span>.<span xmlns="" class="perl_Function">spi</span>.<span xmlns="" class="perl_Function">LoginModule</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> Subject subject;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> CallbackHandler callbackHandler;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> Map sharedState;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> Map options;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> Logger log;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** Flag indicating if the shared credential should be used */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">boolean</span> useFirstPass;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * Flag indicating if the login phase succeeded. Subclasses that</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * override the login method must set this to true on successful</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * completion of login</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">boolean</span> loginOk;
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * Initialize the login module. This stores the subject,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * callbackHandler and sharedState and options for the login</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * session. Subclasses should override if they need to process</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * their own options. A call to super.initialize(...)  must be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * made in the case of an override.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * The options are checked for the  </span><span xmlns="" class="perl_Keyword">&lt;em&gt;</span><span xmlns="" class="perl_Comment">password-stacking</span><span xmlns="" class="perl_Keyword">&lt;/em&gt;</span><span xmlns="" class="perl_Comment"> parameter.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * If this is set to "useFirstPass", the login identity will be taken from the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">javax.security.auth.login.name</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> value of the sharedState map,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * and the proof of identity from the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">&lt;code&gt;</span><span xmlns="" class="perl_Comment">javax.security.auth.login.password</span><span xmlns="" class="perl_Keyword">&lt;/code&gt;</span><span xmlns="" class="perl_Comment"> value of the sharedState map.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">@param subject </span><span xmlns="" class="perl_Comment">the Subject to update after a successful login.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">@param callbackHandler </span><span xmlns="" class="perl_Comment">the CallbackHandler that will be used to obtain the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * the user identity and credentials.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">@param sharedState </span><span xmlns="" class="perl_Comment">a Map shared between all configured login module instances</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">@param options </span><span xmlns="" class="perl_Comment">the parameters passed to the login module.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> initialize(Subject subject,
<span xmlns="" class="line">​</span>                           CallbackHandler callbackHandler,
<span xmlns="" class="line">​</span>                           Map sharedState,
<span xmlns="" class="line">​</span>                           Map options)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  Looks for javax.security.auth.login.name and</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  javax.security.auth.login.password values in the sharedState</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  map if the useFirstPass option was true and returns true if</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  they exist. If they do not or are null this method returns</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  false.  </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  Note that subclasses that override the login method</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  must set the loginOk var to true if the login succeeds in</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  order for the commit phase to populate the Subject. This</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  implementation sets loginOk to true if the login() method</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  returns true, otherwise, it sets loginOk to false.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">login</span>() 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throws</span> LoginException
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  Overridden by subclasses to return the Principal that</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  corresponds to the user primary identity.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">abstract</span> <span xmlns="" class="perl_Keyword">protected</span> Principal <span xmlns="" class="perl_Function">getIdentity</span>();
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  Overridden by subclasses to return the Groups that correspond</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  to the role sets assigned to the user. Subclasses should</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  create at least a Group named "Roles" that contains the roles</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  assigned to the user.  A second common group is</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  "CallerPrincipal," which provides the application identity of</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  the user rather than the security domain identity.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">Group[] containing the sets of roles</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">abstract</span> <span xmlns="" class="perl_Keyword">protected</span> Group[] <span xmlns="" class="perl_Function">getRoleSets</span>() <span xmlns="" class="perl_Keyword">throws</span> LoginException;
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">UsernamePasswordLoginModule</div>
			The second abstract base login module suitable for custom login modules is the <code class="literal">org.jboss.security.auth.spi.UsernamePasswordLoginModule</code>.
		</div><div class="para">
		This login module further simplifies custom login module implementation by enforcing a string-based user name as the user identity and a <code class="literal">char[]</code> password as the authentication credentials. It also supports the mapping of anonymous users (indicated by a null user name and password) to a principal with no roles. The key details of the class are highlighted in the following class fragment. The JavaDoc comments detail the responsibilities of subclasses.
	</div><div class="example"><a id="exam-UsernamePasswordLoginModule_Class_Fragment">
      ⁠</a><p class="title"><strong>Example 18.25. UsernamePasswordLoginModule Class Fragment</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">security</span>.<span xmlns="" class="perl_Function">auth</span>.<span xmlns="" class="perl_Function">spi</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  An abstract subclass of AbstractServerLoginModule that imposes a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  an identity == String username, credentials == String password</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  view on the login process. Subclasses override the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  getUsersPassword() and getUsersRoles() methods to return the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  expected password and roles for the user.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">abstract</span> <span xmlns="" class="perl_Keyword">class</span> UsernamePasswordLoginModule
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">extends</span> AbstractServerLoginModule
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** The login identity */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Principal identity;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** The proof of login identity */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">char</span>[] credential;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** The principal to use when a null username and password are seen */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Principal unauthenticatedIdentity;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * The message digest algorithm used to hash passwords. If null then</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * plain passwords will be used. */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String hashAlgorithm = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  The name of the charset/encoding to use when converting the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * password String to a byte array. Default is the platform's</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * default encoding.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">private</span> String hashCharset = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** The string encoding format to use. Defaults to base64. */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String hashEncoding = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/** </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  Override the superclass method to look for an</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  unauthenticatedIdentity property. This method first invokes</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  the super version.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  </span><span xmlns="" class="perl_Keyword">@param options,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  @option unauthenticatedIdentity: the name of the principal to</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  assign and authenticate when a null username and password are</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  seen.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> initialize(Subject subject,
<span xmlns="" class="line">​</span>                           CallbackHandler callbackHandler,
<span xmlns="" class="line">​</span>                           Map sharedState,
<span xmlns="" class="line">​</span>                           Map options)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">initialize</span>(subject, callbackHandler, sharedState,
<span xmlns="" class="line">​</span>                         options);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Check for unauthenticatedIdentity option.</span>
<span xmlns="" class="line">​</span>        Object option = options.<span xmlns="" class="perl_Function">get</span>(<span xmlns="" class="perl_String">"unauthenticatedIdentity"</span>);
<span xmlns="" class="line">​</span>        String name = (String) option;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (name != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>            unauthenticatedIdentity = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SimplePrincipal</span>(name);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  A hook that allows subclasses to change the validation of the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  input password against the expected password. This version</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  checks that neither inputPassword or expectedPassword are null</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  and that inputPassword.equals(expectedPassword) is true;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">true if the inputPassword is valid, false otherwise.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">validatePassword</span>(String inputPassword,
<span xmlns="" class="line">​</span>                                       String expectedPassword)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (inputPassword == <span xmlns="" class="perl_Keyword">null</span> || expectedPassword == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> inputPassword.<span xmlns="" class="perl_Function">equals</span>(expectedPassword);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *  Get the expected password for the current username available</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * via the getUsername() method. This is called from within the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * login() method after the CallbackHandler has returned the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * username and candidate password.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     *</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     * </span><span xmlns="" class="perl_Keyword">@return </span><span xmlns="" class="perl_Comment">the valid password String</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     */</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">abstract</span> <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getUsersPassword</span>()
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throws</span> LoginException;
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Subclassing Login Modules</div>
			The choice of sub-classing the <code class="literal">AbstractServerLoginModule</code> versus <code class="literal">UsernamePasswordLoginModule</code> is based on whether a string-based user name and credentials are usable for the authentication technology you are writing the login module for. If the string-based semantic is valid, then subclass <code class="literal">UsernamePasswordLoginModule</code>, otherwise subclass <code class="literal">AbstractServerLoginModule</code>.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Subclassing Steps</div>
			The steps your custom login module must execute depend on which base login module class you choose. When writing a custom login module that integrates with your security infrastructure, you should start by sub-classing <code class="literal">AbstractServerLoginModule</code> or <code class="literal">UsernamePasswordLoginModule</code> to ensure that your login module provides the authenticated <code class="literal">Principal</code> information in the form expected by the EAP security manager.
		</div><div class="para">
		When sub-classing the <code class="literal">AbstractServerLoginModule</code>, you must override the following:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">void initialize(Subject, CallbackHandler, Map, Map)</code>: if you have custom options to parse.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">boolean login()</code>: to perform the authentication activity. Be sure to set the <code class="literal">loginOk</code> instance variable to true if log in succeeds, false if it fails.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">Principal getIdentity()</code>: to return the <code class="literal">Principal</code> object for the user authenticated by the <code class="literal">log()</code> step.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">Group[] getRoleSets()</code>: to return at least one <code class="literal">Group</code> named <code class="literal">Roles</code> that contains the roles assigned to the <code class="literal">Principal</code> authenticated during <code class="literal">login()</code>. A second common <code class="literal">Group</code> is named <code class="literal">CallerPrincipal</code> and provides the user's application identity rather than the security domain identity.
			</div></li></ul></div><div class="para">
		When sub-classing the <code class="literal">UsernamePasswordLoginModule</code>, you must override the following:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">void initialize(Subject, CallbackHandler, Map, Map)</code>: if you have custom options to parse.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">Group[] getRoleSets()</code>: to return at least one <code class="literal">Group</code> named <code class="literal">Roles</code> that contains the roles assigned to the <code class="literal">Principal</code> authenticated during <code class="literal">login()</code>. A second common <code class="literal">Group</code> is named <code class="literal">CallerPrincipal</code> and provides the user's application identity rather than the security domain identity.
			</div></li><li class="listitem"><div class="para">
				<code class="literal">String getUsersPassword()</code>: to return the expected password for the current user name available via the <code class="literal">getUsername()</code> method. The <code class="literal">getUsersPassword()</code> method is called from within <code class="literal">login()</code> after the <code class="literal">callbackhandler</code> returns the user name and candidate password.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28325-686362+%5BLatest%5D&amp;comment=Title%3A+Subject+Usage+Pattern+Support%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28325-686362+21+Jul+2014+02%3A38+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Custom_LoginModule_Example">
      ⁠</a>18.3.2.2. Custom LoginModule Example</h3></div></div></div><div class="para">
		The following information will help you to create a custom Login Module example that extends the <code class="literal">UsernamePasswordLoginModule</code> and obtains a user's password and role names from a JNDI lookup.
	</div><div class="para">
		At the end of this section you will have created a custom JNDI context login module that will return a user's password if you perform a lookup on the context using a name of the form <code class="literal">password/&lt;username&gt;</code> (where <code class="literal">&lt;username&gt;</code> is the current user being authenticated). Similarly, a lookup of the form <code class="literal">roles/&lt;username&gt;</code> returns the requested user's roles. In <a class="xref" href="chap-Application_Security.html#A_Custom_LoginModule_Example-_A_JndiUserAndPass_custom_login_module">Example 18.26, “JndiUserAndPassLoginModule Custom Login Module”</a> is the source code for the <code class="literal">JndiUserAndPassLoginModule</code> custom login module.
	</div><div class="para">
		Note that because this extends the JBoss <code class="literal">UsernamePasswordLoginModule</code>, the <code class="literal">JndiUserAndPassLoginModule</code> obtains the user's password and roles from the JNDI store. The <code class="literal">JndiUserAndPassLoginModule</code> does not interact with the JAAS LoginModule operations.
	</div><div class="example"><a id="A_Custom_LoginModule_Example-_A_JndiUserAndPass_custom_login_module">
      ⁠</a><p class="title"><strong>Example 18.26. JndiUserAndPassLoginModule Custom Login Module</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">book</span>.<span xmlns="" class="perl_Function">security</span>.<span xmlns="" class="perl_Function">ex2</span>;
<span xmlns="" class="line">​</span>                    
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.security.acl.Group;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Map;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.naming.InitialContext;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.naming.NamingException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.Subject;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.callback.CallbackHandler;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.login.LoginException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.logging.Logger;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.security.SimpleGroup;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.security.SimplePrincipal;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.security.auth.spi.UsernamePasswordLoginModule;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * An example custom login module that obtains passwords and roles for a user from a JNDI lookup.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author </span><span xmlns="" class="perl_Comment">Scott.Stark@jboss.org</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> JndiUserAndPassLoginModule <span xmlns="" class="perl_Keyword">extends</span> UsernamePasswordLoginModule {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/** The JNDI name to the context that handles the password/username lookup */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String userPathPrefix;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/** The JNDI name to the context that handles the roles/username lookup */</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String rolesPathPrefix;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> Logger log = Logger.<span xmlns="" class="perl_Function">getLogger</span>(JndiUserAndPassLoginModule.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Override to obtain the userPathPrefix and rolesPathPrefix options.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> initialize(Subject subject, CallbackHandler callbackHandler, Map sharedState, Map options) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">initialize</span>(subject, callbackHandler, sharedState, options);
<span xmlns="" class="line">​</span>    userPathPrefix = (String) options.<span xmlns="" class="perl_Function">get</span>(<span xmlns="" class="perl_String">"userPathPrefix"</span>);
<span xmlns="" class="line">​</span>    rolesPathPrefix = (String) options.<span xmlns="" class="perl_Function">get</span>(<span xmlns="" class="perl_String">"rolesPathPrefix"</span>);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the roles the current user belongs to by querying the rolesPathPrefix + '/' + super.getUsername() JNDI location.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> Group[] <span xmlns="" class="perl_Function">getRoleSets</span>() <span xmlns="" class="perl_Keyword">throws</span> LoginException {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      InitialContext ctx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>      String rolesPath = rolesPathPrefix + <span xmlns="" class="perl_Char">'/'</span> + <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">getUsername</span>();
<span xmlns="" class="line">​</span>      String[] roles = (String[]) ctx.<span xmlns="" class="perl_Function">lookup</span>(rolesPath);
<span xmlns="" class="line">​</span>      Group[] groups = { <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SimpleGroup</span>(<span xmlns="" class="perl_String">"Roles"</span>) };
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Getting roles for user="</span> + <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">getUsername</span>());
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> r = <span xmlns="" class="perl_Float">0</span>; r &lt; roles.<span xmlns="" class="perl_Function">length</span>; r++) {
<span xmlns="" class="line">​</span>        SimplePrincipal role = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SimplePrincipal</span>(roles[r]);
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Found role="</span> + roles[r]);
<span xmlns="" class="line">​</span>        groups[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">addMember</span>(role);
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> groups;
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (NamingException e) {
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">error</span>(<span xmlns="" class="perl_String">"Failed to obtain groups for user="</span> + <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">getUsername</span>(), e);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> LoginException(e.<span xmlns="" class="perl_Function">toString</span>(<span xmlns="" class="perl_Keyword">true</span>));
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">/**</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   * Get the password of the current user by querying the userPathPrefix + '/' + super.getUsername() JNDI location.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   */</span>
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getUsersPassword</span>() <span xmlns="" class="perl_Keyword">throws</span> LoginException {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      InitialContext ctx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>      String userPath = userPathPrefix + <span xmlns="" class="perl_Char">'/'</span> + <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">getUsername</span>();
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Getting password for user="</span> + <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">getUsername</span>());
<span xmlns="" class="line">​</span>      String passwd = (String) ctx.<span xmlns="" class="perl_Function">lookup</span>(userPath);
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Found password="</span> + passwd);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> passwd;
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (NamingException e) {
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">error</span>(<span xmlns="" class="perl_String">"Failed to obtain password for user="</span> + <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">getUsername</span>(), e);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> LoginException(e.<span xmlns="" class="perl_Function">toString</span>(<span xmlns="" class="perl_Keyword">true</span>));
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="example"><a id="idm140550721430400">
      ⁠</a><p class="title"><strong>Example 18.27. Definition of security-ex2 security domain with the newly-created custom login module</strong></p><div class="example-contents"><pre class="programlisting">
/subsystem=security/security-domain=security-ex2/:add
/subsystem=security/security-domain=security-ex2/authentication=classic:add
/subsystem=security/security-domain=security-ex2/authentication=classic/login-module=ex2/:add(\
flag=required,\
code=org.jboss.book.security.ex2.JndiUserAndPassLoginModule,\
module-options=[("userPathPrefix"=&gt;"/security/store/password"),\
("rolesPathPrefix"=&gt;"/security/store/roles")]\
)

</pre></div></div><div class="para">
		The choice of using the <code class="literal">JndiUserAndPassLoginModule</code> custom login module for the server side authentication of the user is determined by the login configuration for the example security domain. The EJB JAR <code class="filename">META-INF/jboss-ejb3.xml</code> descriptor sets the security domain. For a web application it is part of the <code class="filename">WEB-INF/jboss-web.xml</code> file.
	</div><div class="example"><a id="idm140550812835424">
      ⁠</a><p class="title"><strong>Example 18.28. <code class="filename">jboss-ejb3.xml</code> Example</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss:ejb-jar</span><span xmlns="" class="perl_Others"> xmlns:jboss=</span><span xmlns="" class="perl_String">"http://www.jboss.com/xml/ns/javaee"</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span><span xmlns="" class="perl_Others"> xmlns:s=</span><span xmlns="" class="perl_String">"urn:security"</span><span xmlns="" class="perl_Others"> version=</span><span xmlns="" class="perl_String">"3.1"</span><span xmlns="" class="perl_Others"> impl-version=</span><span xmlns="" class="perl_String">"2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:security&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;s:security-domain&gt;</span>security-ex2<span xmlns="" class="perl_Keyword">&lt;/s:security-domain&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/s:security&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss:ejb-jar&gt;</span>
</pre></div></div><div class="example"><a id="idm140550794789424">
      ⁠</a><p class="title"><strong>Example 18.29. <code class="filename">jboss-web.xml example</code></strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>security-ex2<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+28326-638684+%5BLatest%5D&amp;comment=Title%3A+Custom+LoginModule+Example%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28326-638684+06+May+2014+22%3A50+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-EJB_Application_Security">
      ⁠</a>18.4. EJB Application Security</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Security_Identity">
      ⁠</a>18.4.1. Security Identity</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_EJB_Security_Identity">
      ⁠</a>18.4.1.1. About EJB Security Identity</h3></div></div></div><div class="para">
		An EJB can specify an identity to use when invoking methods on other components. This is the EJB's <em class="firstterm">security identity</em> (also known as <em class="firstterm">invocation identity</em>).
	</div><div class="para">
		By default, the EJB uses its own caller identity. The identity can alternatively be set to a specific security role. Using specific security roles is useful when you want to construct a segmented security model - for example, restricting access to a set of components to internal EJBs only.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4713-685873+%5BLatest%5D&amp;comment=Title%3A+About+EJB+Security+Identity%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4713-685873+17+Jul+2014+20%3A05+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Set_the_Security_Identity_of_an_EJB">
      ⁠</a>18.4.1.2. Set the Security Identity of an EJB</h3></div></div></div><div class="para">
		The security identity of the EJB is specified through the <code class="sgmltag-element">&lt;security-identity&gt;</code> tag in the security configuration.
	</div><div class="para">
		By default - if no <code class="sgmltag-element">&lt;security-identity&gt;</code> tag is present - the EJB's own caller identity is used.
	</div><div class="example"><a id="idm140550791305744">
      ⁠</a><p class="title"><strong>Example 18.30. Set the security identity of an EJB to be the same as its caller</strong></p><div class="example-contents"><div class="para">
			This example sets the security identity for method invocations made by an EJB to be the same as the current caller's identity. This behavior is the default if you do not specify a <code class="sgmltag-element">&lt;security-identity&gt;</code> element declaration.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">&lt;session&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>ASessionBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Comment">&lt;!-- ... --&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;security-identity&gt;</span>
<span xmlns="" class="line">​</span>		  <span xmlns="" class="perl_Keyword">&lt;use-caller-identity/&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;/security-identity&gt;</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">&lt;/session&gt;</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Comment">&lt;!-- ... --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
</pre></div></div><div class="example"><a id="idm140550719619120">
      ⁠</a><p class="title"><strong>Example 18.31. Set the security identity of an EJB to a specific role</strong></p><div class="example-contents"><div class="para">
			To set the security identity to a specific role, use the <code class="sgmltag-element">&lt;run-as&gt;</code> and <code class="sgmltag-element">&lt;role-name&gt;</code> tags inside the <code class="sgmltag-element">&lt;security-identity&gt;</code> tag.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">&lt;session&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>RunAsBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Comment">&lt;!-- ... --&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;security-identity&gt;</span>
<span xmlns="" class="line">​</span>		  <span xmlns="" class="perl_Keyword">&lt;run-as&gt;</span>
<span xmlns="" class="line">​</span>			 <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>A private internal role<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>			 <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>InternalRole<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>		  <span xmlns="" class="perl_Keyword">&lt;/run-as&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;/security-identity&gt;</span>
<span xmlns="" class="line">​</span>	 <span xmlns="" class="perl_Keyword">&lt;/session&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- ... --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
</pre><div class="para">
			By default, when you use <code class="sgmltag-element">&lt;run-as&gt;</code>, a principal named <code class="literal">anonymous</code> is assigned to outgoing calls. To assign a different principal, uses the <code class="sgmltag-element">&lt;run-as-principal&gt;</code>.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;session&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>RunAsBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-identity&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;run-as-principal&gt;</span>internal<span xmlns="" class="perl_Keyword">&lt;/run-as-principal&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/security-identity&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/session&gt;</span>
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Specifying security identity in servlets</strong></p></div><div class="admonition"><div class="para">
			You can also use the <code class="sgmltag-element">&lt;run-as&gt;</code> and <code class="sgmltag-element">&lt;run-as-principal&gt;</code> elements inside a servlet element.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>See also:</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#About_EJB_Security_Identity">Section 18.4.1.1, “About EJB Security Identity”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Development_Security_References.html#EJB_Security_Parameter_Reference">Section 20.1, “EJB Security Parameter Reference”</a>
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5052-685874+%5BLatest%5D&amp;comment=Title%3A+Set+the+Security+Identity+of+an+EJB%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5052-685874+17+Jul+2014+20%3A05+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-EJB_Method_Permissions">
      ⁠</a>18.4.2. EJB Method Permissions</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_EJB_Method_Permissions">
      ⁠</a>18.4.2.1. About EJB Method Permissions</h3></div></div></div><div class="para">
		EJBs can restrict access to their methods to specific security roles.
	</div><div class="para">
		The EJB <code class="sgmltag-element">&lt;method-permission&gt;</code> element declaration specifies the roles that can invoke the EJB's interface methods. You can specify permissions for the following combinations:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				All home and component interface methods of the named EJB
			</div></li><li class="listitem"><div class="para">
				A specified method of the home or component interface of the named EJB
			</div></li><li class="listitem"><div class="para">
				A specified method within a set of methods with an overloaded name
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4767-685876+%5BLatest%5D&amp;comment=Title%3A+About+EJB+Method+Permissions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4767-685876+17+Jul+2014+20%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Use_EJB_Method_Permissions">
      ⁠</a>18.4.2.2. Use EJB Method Permissions</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			The <code class="sgmltag-element">&lt;method-permission&gt;</code> element defines the logical roles that are allowed to access the EJB methods defined by <code class="sgmltag-element">&lt;method&gt;</code> elements. Several examples demonstrate the syntax of the XML. Multiple method permission statements may be present, and they have a cumulative effect. The <code class="sgmltag-element">&lt;method-permission&gt;</code> element is a child of the <code class="sgmltag-element">&lt;assembly-descriptor&gt;</code> element of the <code class="sgmltag-element">&lt;ejb-jar&gt;</code> descriptor.
		</div><div class="para">
		The XML syntax is an alternative to using annotations for EJB method permissions.
	</div><div class="example"><a id="idm140550739382800">
      ⁠</a><p class="title"><strong>Example 18.32. Allow roles to access all methods of an EJB</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The employee and temp-employee roles may access any method
<span xmlns="" class="line">​</span>  of the EmployeeService bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>temp-employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeService<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="example"><a id="idm140550770323296">
      ⁠</a><p class="title"><strong>Example 18.33. Allow roles to access only specific methods of an EJB, and limiting which method parameters can be passed.</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The employee role may access the findByPrimaryKey,
<span xmlns="" class="line">​</span>  getEmployeeInfo, and the updateEmployeeInfo(String) method of
<span xmlns="" class="line">​</span>  the AcmePayroll bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AcmePayroll<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>findByPrimaryKey<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AcmePayroll<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>getEmployeeInfo<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AcmePayroll<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>updateEmployeeInfo<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;method-params&gt;</span>
<span xmlns="" class="line">​</span>	  <span xmlns="" class="perl_Keyword">&lt;method-param&gt;</span>java.lang.String<span xmlns="" class="perl_Keyword">&lt;/method-param&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/method-params&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
</pre></div></div><div class="example"><a id="idm140550730580144">
      ⁠</a><p class="title"><strong>Example 18.34. Allow any authenticated user to access methods of EJBs</strong></p><div class="example-contents"><div class="para">
			Using the <code class="sgmltag-element">&lt;unchecked/&gt;</code> element allows any authenticated user to use the specified methods.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Any authenticated user may access any method of the
<span xmlns="" class="line">​</span>  EmployeeServiceHelp bean<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;unchecked/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeServiceHelp<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
</pre></div></div><div class="example"><a id="idm140550778786432">
      ⁠</a><p class="title"><strong>Example 18.35. Completely exclude specific EJB methods from being used</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;exclude-list&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>No fireTheCTO methods of the EmployeeFiring bean may be
<span xmlns="" class="line">​</span>  used in this deployment<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeFiring<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>fireTheCTO<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/exclude-list&gt;</span>
</pre></div></div><div class="example"><a id="idm140550782008064">
      ⁠</a><p class="title"><strong>Example 18.36. A complete <code class="sgmltag-element">&lt;assembly-descriptor&gt;</code> containing several <code class="sgmltag-element">&lt;method-permission&gt;</code> blocks</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The employee and temp-employee roles may access any
<span xmlns="" class="line">​</span>                method of the EmployeeService bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>temp-employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeService<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The employee role may access the findByPrimaryKey,
<span xmlns="" class="line">​</span>                getEmployeeInfo, and the updateEmployeeInfo(String) method of
<span xmlns="" class="line">​</span>                the AcmePayroll bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AcmePayroll<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>findByPrimaryKey<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AcmePayroll<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>getEmployeeInfo<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>AcmePayroll<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>updateEmployeeInfo<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-params&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;method-param&gt;</span>java.lang.String<span xmlns="" class="perl_Keyword">&lt;/method-param&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/method-params&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The admin role may access any method of the
<span xmlns="" class="line">​</span>                EmployeeServiceAdmin bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>admin<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeServiceAdmin<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Any authenticated user may access any method of the
<span xmlns="" class="line">​</span>                EmployeeServiceHelp bean<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;unchecked/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeServiceHelp<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;exclude-list&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>No fireTheCTO methods of the EmployeeFiring bean may be
<span xmlns="" class="line">​</span>                used in this deployment<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeFiring<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>fireTheCTO<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/exclude-list&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4794-591676+%5BLatest%5D&amp;comment=Title%3A+Use+EJB+Method+Permissions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4794-591676+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-EJB_Security_Annotations">
      ⁠</a>18.4.3. EJB Security Annotations</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_EJB_Security_Annotations">
      ⁠</a>18.4.3.1. About EJB Security Annotations</h3></div></div></div><div class="para">
		EJB <code class="literal">javax.annotation.security</code> annotations are defined in JSR250.
	</div><div class="para">
		EJBs use security annotations to pass information about security to the deployer. These include:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">@DeclareRoles</span></dt><dd><div class="para">
					Declares which roles are available.
				</div></dd><dt><span class="term">@RunAs</span></dt><dd><div class="para">
					Configures the propagated security identity of a component.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4768-685879+%5BLatest%5D&amp;comment=Title%3A+About+EJB+Security+Annotations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4768-685879+17+Jul+2014+20%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Use_EJB_Security_Annotations">
      ⁠</a>18.4.3.2. Use EJB Security Annotations</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			You can use either XML descriptors or annotations to control which security roles are able to call methods in your Enterprise JavaBeans (EJBs). For information on using XML descriptors, refer to <a class="xref" href="chap-Application_Security.html#Use_EJB_Method_Permissions">Section 18.4.2.2, “Use EJB Method Permissions”</a>.
		</div><div class="para">
		Any method values explicitly specified in the deployment descriptor override annotation values. If a method value is not specified in the deployment descriptor, those values set using annotations are used. The overriding granularity is on a per-method basis.
	</div><div class="variablelist"><p class="title"><strong>Annotations for Controlling Security Permissions of EJBs</strong></p><dl class="variablelist"><dt><span class="term">@DeclareRoles</span></dt><dd><div class="para">
					Use @DeclareRoles to define which security roles to check permissions against. If no @DeclareRoles is present, the list is built automatically from the @RolesAllowed annotation. For information about configuring roles, refer to the <em class="citetitle">Java EE 6 Tutorial</em> <a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbyl.html#gjgcq">Specifying Authorized Users by Declaring Security Roles</a>.
				</div></dd><dt><span class="term">@RolesAllowed, @PermitAll, @DenyAll</span></dt><dd><div class="para">
					Use <code class="code">@RolesAllowed</code> to list which roles are allowed to access a method or methods. Use <code class="code">@PermitAll</code> or <code class="code">@DenyAll</code> to either permit or deny all roles from using a method or methods. For information about configuring annotation method permissions, refer to the <em class="citetitle">Java EE 6 Tutorial</em> <a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbyl.html#gjgcq">Specifying Authorized Users by Declaring Security Roles</a>.
				</div></dd><dt><span class="term">@RunAs</span></dt><dd><div class="para">
					Use <code class="code">@RunAs</code> to specify a role a method uses when making calls from the annotated method. For information about configuring propagated security identities using annotations, refer to the <em class="citetitle">Java EE 6 Tutorial</em> <a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbyl.html#bnbyr">Propagating a Security Identity (Run-As)</a>.
				</div></dd></dl></div><div class="example"><a id="idm140550742688592">
      ⁠</a><p class="title"><strong>Example 18.37. Security Annotations Example</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>({<span xmlns="" class="perl_String">"admin"</span>})
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SecurityDomain</span>(<span xmlns="" class="perl_String">"other"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> WelcomeEJB <span xmlns="" class="perl_Keyword">implements</span> Welcome {
<span xmlns="" class="line">​</span>	@PermitAll
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">WelcomeEveryone</span>(String msg) {
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"Welcome to "</span> + msg;
<span xmlns="" class="line">​</span>	}
<span xmlns="" class="line">​</span>	@<span xmlns="" class="perl_Function">RunAs</span>(<span xmlns="" class="perl_String">"tempemployee"</span>)
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">GoodBye</span>(String msg) {
<span xmlns="" class="line">​</span>	    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"Goodbye, "</span> + msg;
<span xmlns="" class="line">​</span>	}
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">GoodbyeAdmin</span>(String msg) {
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"See you later, "</span> + msg;
<span xmlns="" class="line">​</span>	}
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			In this code, all roles can access method <code class="code">WelcomeEveryone</code>. The <code class="code">GoodBye</code> method uses the <code class="code">tempemployee</code> role when making calls. Only the <code class="code">admin</code> role can access method <code class="code">GoodbyeAdmin</code>, and any other methods with no security annotation.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4795-687321+%5BLatest%5D&amp;comment=Title%3A+Use+EJB+Security+Annotations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4795-687321+22+Jul+2014+18%3A35+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Remote_Access_to_EJBs">
      ⁠</a>18.4.4. Remote Access to EJBs</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Remoting">
      ⁠</a>18.4.4.1. About Remote Method Access</h3></div></div></div><div class="para">
		JBoss Remoting is the framework which provides remote access to EJBs, JMX MBeans, and other similar services. It works within the following transport types, with or without SSL:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Supported Transport Types</strong></p><ul><li class="listitem"><div class="para">
				Socket / Secure Socket
			</div></li><li class="listitem"><div class="para">
				RMI / RMI over SSL
			</div></li><li class="listitem"><div class="para">
				HTTP / HTTPS
			</div></li><li class="listitem"><div class="para">
				Servlet / Secure Servlet
			</div></li><li class="listitem"><div class="para">
				Bisocket / Secure Bisocket
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
		</div></div></div><div class="para">
		JBoss Remoting also provides automatic discovery via Multicast or JNDI.
	</div><div class="para">
		It is used by many of the subsystems within JBoss EAP 6, and also enables you to design, implement, and deploy services that can be remotely invoked by clients over several different transport mechanisms. It also allows you to access existing services in JBoss EAP 6.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Data Marshalling</div>
			The Remoting system also provides data marshalling and unmarshalling services. Data marshalling refers to the ability to safely move data across network and platform boundaries, so that a separate system can perform work on it. The work is then sent back to the original system and behaves as though it were handled locally.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Architecture Overview</div>
			When you design a client application which uses Remoting, you direct your application to communicate with the server by configuring it to use a special type of resource locator called an <code class="literal">InvokerLocator</code>, which is a simple String with a URL-type format. The server listens for requests for remote resources on a <code class="literal">connector</code>, which is configured as part of the <code class="literal">remoting</code> subsystem. The <code class="literal">connector</code> hands the request off to a configured <code class="literal">ServerInvocationHandler</code>. Each <code class="literal">ServerInvocationHandler</code> implements a method <code class="code">invoke(InvocationRequest)</code>, which knows how to handle the request.
		</div><div class="para">
		The JBoss Remoting framework contains three layers that mirror each other on the client and server side.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>JBoss Remoting Framework Layers</strong></p><ul><li class="listitem"><div class="para">
				The user interacts with the outer layer. On the client side, the outer layer is the <code class="code">Client</code> class, which sends invocation requests. On the server side, it is the InvocationHandler, which is implemented by the user and receives invocation requests.
			</div></li><li class="listitem"><div class="para">
				The transport is controlled by the invoker layer.
			</div></li><li class="listitem"><div class="para">
				The lowest layer contains the marshaller and unmarshaller, which convert data formats to wire formats.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7882-724703+%5BLatest%5D&amp;comment=Title%3A+About+Remote+Method+Access%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7882-724703+09+Nov+2014+23%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Remoting_Callbacks">
      ⁠</a>18.4.4.2. About Remoting Callbacks</h3></div></div></div><div class="para">
		When a Remoting client requests information from the server, it can block and wait for the server to reply, but this is often not the ideal behavior. To allow the client to listen for asynchronous events on the server, and continue doing other work while waiting for the server to finish the request, your application can ask the server to send a notification when it has finished. This is referred to as a callback. One client can add itself as a listener for asynchronous events generated on behalf of another client, as well. There are two different choices for how to receive callbacks: pull callbacks or push callbacks. Clients check for pull callbacks synchronously, but passively listen for push callbacks.
	</div><div class="para">
		In essence, a callback works by the server sending an <code class="code">InvocationRequest</code> to the client. Your server-side code works the same regardless of whether the callback is synchronous or asynchronous. Only the client needs to know the difference. The server's InvocationRequest sends a <code class="code">responseObject</code> to the client. This is the payload that the client has requested. This may be a direct response to a request or an event notification.
	</div><div class="para">
		Your server also tracks listeners using an <code class="code">m_listeners</code> object. It contains a list of all listeners that have been added to your server handler. The <code class="code">ServerInvocationHandler</code> interface includes methods that allow you to manage this list.
	</div><div class="para">
		The client handles pull and push callback in different ways. In either case, it must implement a callback handler. A callback handler is an implementation of interface <code class="code">org.jboss.remoting.InvokerCallbackHandler</code>, which processes the callback data. After implementing the callback handler, you either add yourself as a listener for a pull callback, or implement a callback server for a push callback.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Pull Callbacks</div>
			For a pull callback, your client adds itself to the server's list of listeners using the <code class="code">Client.addListener()</code> method. It then polls the server periodically for synchronous delivery of callback data. This poll is performed using the <code class="code">Client.getCallbacks()</code>.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Push Callback</div>
			A push callback requires your client application to run its own InvocationHandler. To do this, you need to run a Remoting service on the client itself. This is referred to as a <em class="firstterm">callback server</em>. The callback server accepts incoming requests asynchronously and processes them for the requester (in this case, the server). To register your client's callback server with the main server, pass the callback server's <code class="code">InvokerLocator</code> as the second argument to the <code class="code">addListener</code> method.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7883-591811+%5BLatest%5D&amp;comment=Title%3A+About+Remoting+Callbacks%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7883-591811+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Remoting_Server_Detection">
      ⁠</a>18.4.4.3. About Remoting Server Detection</h3></div></div></div><div class="para">
		Remoting servers and clients can automatically detect each other using JNDI or Multicast. A Remoting Detector is added to both the client and server, and a NetworkRegistry is added to the client.
	</div><div class="para">
		The Detector on the server side periodically scans the InvokerRegistry and pulls all server invokers it has created. It uses this information to publish a detection message which contains the locator and subsystems supported by each server invoker. It publishes this message via a multicast broadcast or a binding into a JNDI server.
	</div><div class="para">
		On the client side, the Detector receives the multicast message or periodically polls the JNDI server to retrieve detection messages. If the Detector notices that a detection message is for a newly-detected remoting server, it registers it into the NetworkRegistry. The Detector also updates the NetworkRegistry if it detects that a server is no longer available.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7890-591811+%5BLatest%5D&amp;comment=Title%3A+About+Remoting+Server+Detection%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7890-591811+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_the_Remoting_Subsystem">
      ⁠</a>18.4.4.4. Configure the Remoting Subsystem</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			JBoss Remoting has three top-level configurable elements: the worker thread pool, one or more connectors, and a series of local and remote connection URIs. This topic presents an explanation of each configurable item, example CLI commands for how to configure each item, and an XML example of a fully-configured subsystem. This configuration only applies to the server. Most people will not need to configure the Remoting subsystem at all, unless they use custom connectors for their own applications. Applications which act as Remoting clients, such as EJBs, need separate configuration to connect to a specific connector.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The Remoting subsystem configuration is not exposed to the web-based Management Console, but it is fully configurable from the command-line based Management CLI. Editing the XML by hand is not recommended.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Adapting the CLI Commands</div>
			The CLI commands are formulated for a managed domain, when configuring the <code class="literal">default</code> profile. To configure a different profile, substitute its name. For a standalone server, omit the <code class="literal">/profile=default</code> part of the command.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuration Outside the Remoting Subsystem</div>
			There are a few configuration aspects which are outside of the <code class="literal">remoting</code> subsystem:
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Network Interface</span></dt><dd><div class="para">
					The network interface used by the <code class="literal">remoting</code> subsystem is the <code class="literal">public</code> interface defined in the <code class="filename">domain/configuration/domain.xml</code> or <code class="filename">standalone/configuration/standalone.xml</code>.
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;interfaces&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;interface</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"management"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;interface</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"public"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;interface</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"unsecure"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/interfaces&gt;</span>        
<span xmlns="" class="line">​</span>
</pre><div class="para">
					The per-host definition of the <code class="literal">public</code> interface is defined in the <code class="filename">host.xml</code> in the same directory as the <code class="filename">domain.xml</code> or <code class="filename">standalone.xml</code>. This interface is also used by several other subsystems. Exercise caution when modifying it.
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;interfaces&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;interface</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"management"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;inet-address</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.bind.address.management:127.0.0.1}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/interface&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;interface</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"public"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;inet-address</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.bind.address:127.0.0.1}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/interface&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;interface</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"unsecure"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Used for IIOP sockets in the standard configuration.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">         To secure JacORB you need to setup SSL --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;inet-address</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.bind.address.unsecure:127.0.0.1}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/interface&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/interfaces&gt;</span>             
<span xmlns="" class="line">​</span>
</pre></dd><dt><span class="term">socket-binding</span></dt><dd><div class="para">
					The default socket-binding used by the <code class="literal">remoting</code> subsystem binds to TCP port 4447. Refer to the documentation about socket bindings and socket binding groups for more information if you need to change this.
				</div><div class="para">
					Information about socket binding and socket binding groups can be found in the <em class="citetitle">Socket Binding Groups</em> chapter of JBoss EAP's <em class="citetitle">Administration and Configuration Guide</em> available at <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/?version=6.4">https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/?version=6.4</a>
				</div></dd><dt><span class="term">Remoting Connector Reference for EJB</span></dt><dd><div class="para">
					The EJB subsystem contains a reference to the remoting connector for remote method invocations. The following is the default configuration:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;remote</span><span xmlns="" class="perl_Others"> connector-ref=</span><span xmlns="" class="perl_String">"remoting-connector"</span><span xmlns="" class="perl_Others"> thread-pool-name=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">/&gt;</span>            
<span xmlns="" class="line">​</span>
</pre></dd><dt><span class="term">Secure Transport Configuration</span></dt><dd><div class="para">
					Remoting transports use StartTLS to use a secure (HTTPS, Secure Servlet, etc) connection if the client requests it. The same socket binding (network port) is used for secured and unsecured connections, so no additional server-side configuration is necessary. The client requests the secure or unsecured transport, as its needs dictate. JBoss EAP 6 components which use Remoting, such as EJBs, the ORB, and the JMS provider, request secured interfaces by default.
				</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning: StartTLS Security Considerations</strong></p></div><div class="admonition"><div class="para">
			StartTLS works by activating a secure connection if the client requests it, and otherwise defaulting to an unsecured connection. It is inherently susceptible to a <em class="firstterm">Man in the Middle</em> style exploit, wherein an attacker intercepts the client's request and modifies it to request an unsecured connection. Clients must be written to fail appropriately if they do not receive a secure connection, unless an unsecured connection actually is an appropriate fall-back.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Worker Thread Pool</div>
			The worker thread pool is the group of threads which are available to process work which comes in through the Remoting connectors. It is a single element <code class="sgmltag-element">&lt;worker-thread-pool&gt;</code>, and takes several attributes. Tune these attributes if you get network timeouts, run out of threads, or need to limit memory usage. Specific recommendations depend on your specific situation. Contact Red Hat Global Support Services for more information.
		</div><div class="table"><a id="idm140550799939712">
      ⁠</a><p class="title"><strong>Table 18.2. Worker Thread Pool Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Worker Thread Pool Attributes"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> read-threads </td><td> <div class="para">
						The number of read threads to create for the remoting worker. Defaults to <code class="literal">1</code>.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/:write-attribute(name=worker-read-threads,value=1)</code>
					</div>
					 </td></tr><tr><td> write-threads </td><td> <div class="para">
						The number of write threads to create for the remoting worker. Defaults to <code class="literal">1</code>.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/:write-attribute(name=worker-write-threads,value=1)</code>
					</div>
					 </td></tr><tr><td> task-keepalive </td><td> <div class="para">
						The number of milliseconds to keep non-core remoting worker task threads alive. Defaults to <code class="literal">60</code>.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/:write-attribute(name=worker-task-keepalive,value=60)</code>
					</div>
					 </td></tr><tr><td> task-max-threads </td><td> <div class="para">
						The maximum number of threads for the remoting worker task thread pool. Defaults to <code class="literal">16</code>.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/:write-attribute(name=worker-task-max-threads,value=16)</code>
					</div>
					 </td></tr><tr><td> task-core-threads </td><td> <div class="para">
						The number of core threads for the remoting worker task thread pool. Defaults to <code class="literal">4</code>.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/:write-attribute(name=worker-task-core-threads,value=4)</code>
					</div>
					 </td></tr><tr><td> task-limit </td><td> <div class="para">
						The maximum number of remoting worker tasks to allow before rejecting. Defaults to <code class="literal">16384</code>.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/:write-attribute(name=worker-task-limit,value=16384)</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Connector</div>
			The connector is the main Remoting configuration element. Multiple connectors are allowed. Each consists of a element <code class="sgmltag-element">&lt;connector&gt;</code> element with several sub-elements, as well as a few possible attributes. The default connector is used by several subsystems of JBoss EAP 6. Specific settings for the elements and attributes of your custom connectors depend on your applications, so contact Red Hat Global Support Services for more information.
		</div><div class="table"><a id="idm140550768909024">
      ⁠</a><p class="title"><strong>Table 18.3. Connector Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Connector Attributes"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> socket-binding </td><td> The name of the socket binding to use for this connector. </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/connector=remoting-connector/:write-attribute(name=socket-binding,value=remoting)</code>
					</div>
					 </td></tr><tr><td> authentication-provider </td><td> <div class="para">
						The Java Authentication Service Provider Interface for Containers (JASPIC) module to use with this connector. The module must be in the classpath.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/connector=remoting-connector/:write-attribute(name=authentication-provider,value=myProvider)</code>
					</div>
					 </td></tr><tr><td> security-realm </td><td> <div class="para">
						Optional. The security realm which contains your application's users, passwords, and roles. An EJB or Web Application can authenticate against a security realm. <code class="literal">ApplicationRealm</code> is available in a default JBoss EAP 6 installation.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/connector=remoting-connector/:write-attribute(name=security-realm,value=ApplicationRealm)</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm140550814753072">
      ⁠</a><p class="title"><strong>Table 18.4. Connector Elements</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Connector Elements"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> sasl </td><td> <div class="para">
						Enclosing element for Simple Authentication and Security Layer (SASL) authentication mechanisms
					</div>
					 </td><td> <div class="para">
						<code class="literal">N/A</code>
					</div>
					 </td></tr><tr><td> properties </td><td> <div class="para">
						Contains one or more <code class="sgmltag-element">&lt;property&gt;</code> elements, each with a <code class="literal">name</code> attribute and an optional <code class="literal">value</code> attribute.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/connector=remoting-connector/property=myProp/:add(value=myPropValue)</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Outbound Connections</div>
			You can specify three different types of outbound connection:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Outbound connection to a URI.
			</div></li><li class="listitem"><div class="para">
				Local outbound connection – connects to a local resource such as a socket.
			</div></li><li class="listitem"><div class="para">
				Remote outbound connection – connects to a remote resource and authenticates using a security realm.
			</div></li></ul></div><div class="para">
		All of the outbound connections are enclosed in an <code class="sgmltag-element">&lt;outbound-connections&gt;</code> element. Each of these connection types takes an <code class="literal">outbound-socket-binding-ref</code> attribute. The outbound-connection takes a <code class="literal">uri</code> attribute. The remote outbound connection takes optional <code class="literal">username</code> and <code class="literal">security-realm</code> attributes to use for authorization.
	</div><div class="table"><a id="idm140550738608928">
      ⁠</a><p class="title"><strong>Table 18.5. Outbound Connection Elements</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Outbound Connection Elements"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> outbound-connection </td><td> Generic outbound connection. </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/outbound-connection=my-connection/:add(uri=http://my-connection)</code>
					</div>
					 </td></tr><tr><td> local-outbound-connection </td><td> Outbound connection with a implicit local:// URI scheme. </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/local-outbound-connection=my-connection/:add(outbound-socket-binding-ref=remoting2)</code>
					</div>
					 </td></tr><tr><td> remote-outbound-connection </td><td> <div class="para">
						Outbound connections for remote:// URI scheme, using basic/digest authentication with a security realm.
					</div>
					 </td><td> <div class="para">
						<code class="literal">/profile=default/subsystem=remoting/remote-outbound-connection=my-connection/:add(outbound-socket-binding-ref=remoting,username=myUser,security-realm=ApplicationRealm)</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">SASL Elements</div>
			Before defining the SASL child elements, you need to create the initial SASL element. Use the following command:
		</div><pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl:add</pre><div class="para">
		The child elements of the SASL element are described in the table below.
	</div><div class="table"><a id="idm140550803327520">
      ⁠</a><p class="title"><strong>Table 18.6. SASL child elements</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="SASL child elements"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> include-mechanisms </td><td> <div class="para">
						Contains a <code class="literal">value</code> attribute, which is a list of SASL mechanisms.
					</div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl:write-attribute(name=include-mechanisms,value=["DIGEST","PLAIN","GSSAPI"])</pre>
					 </td></tr><tr><td> qop </td><td> <div class="para">
						Contains a <code class="literal">value</code> attribute, which is a list of SASL Quality of protection values, in decreasing order of preference.
					</div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl:write-attribute(name=qop,value=["auth"])</pre>
					 </td></tr><tr><td> strength </td><td> <div class="para">
						Contains a <code class="literal">value</code> attribute, which is a list of SASL cipher strength values, in decreasing order of preference.
					</div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl:write-attribute(name=strength,value=["medium"])</pre>
					 </td></tr><tr><td> reuse-session </td><td> <div class="para">
						Contains a <code class="literal">value</code> attribute which is a boolean value. If true, attempt to reuse sessions.
					</div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl:write-attribute(name=reuse-session,value=false)</pre>
					 </td></tr><tr><td> server-auth </td><td> <div class="para">
						Contains a <code class="literal">value</code> attribute which is a boolean value. If true, the server authenticates to the client.
					</div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl:write-attribute(name=server-auth,value=false)</pre>
					 </td></tr><tr><td> policy </td><td> <div class="para">
						An enclosing element which contains zero or more of the following elements, which each take a single <code class="literal">value</code>.
					</div>
					 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
								forward-secrecy – whether mechanisms are required to implement forward secrecy (breaking into one session will not automatically provide information for breaking into future sessions)
							</div></li><li class="listitem"><div class="para">
								no-active – whether mechanisms susceptible to non-dictionary attacks are permitted. A value of <code class="literal">false</code> permits, and <code class="literal">true</code> denies.
							</div></li><li class="listitem"><div class="para">
								no-anonymous – whether mechanisms that accept anonymous login are permitted. A value of <code class="literal">false</code> permits, and <code class="literal">true</code> denies.
							</div></li><li class="listitem"><div class="para">
								no-dictionary – whether mechanisms susceptible to passive dictionary attacks are allowed. A value of <code class="literal">false</code> permits, and <code class="literal">true</code> denies.
							</div></li><li class="listitem"><div class="para">
								no-plain-text – whether mechanisms which are susceptible to simple plain passive attacks are allowed. A value of <code class="literal">false</code> permits, and <code class="literal">true</code> denies.
							</div></li><li class="listitem"><div class="para">
								pass-credentials – whether mechanisms which pass client credentials are allowed.
							</div></li></ul></div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:add</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:write-attribute(name=forward-secrecy,value=true)</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:write-attribute(name=no-active,value=false)</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:write-attribute(name=no-anonymous,value=false)</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:write-attribute(name=no-dictionary,value=true)</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:write-attribute(name=no-plain-text,value=false)</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/sasl-policy=policy:write-attribute(name=pass-credentials,value=true)</pre>
					 </td></tr><tr><td> properties </td><td> <div class="para">
						Contains one or more <code class="sgmltag-element">&lt;property&gt;</code> elements, each with a <code class="literal">name</code> attribute and an optional <code class="literal">value</code> attribute.
					</div>
					 </td><td>
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/property=myprop:add(value=1)</pre>
					 
<pre class="screen">/profile=default/subsystem=remoting/connector=remoting-connector/security=sasl/property=myprop2:add(value=2)</pre>
					 </td></tr></tbody></table></div></div><div class="example"><a id="idm140550782931584">
      ⁠</a><p class="title"><strong>Example 18.38. Example Configurations</strong></p><div class="example-contents"><div class="para">
			This example shows the default remoting subsystem that ships with JBoss EAP 6.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:remoting:1.1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"remoting-connector"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"remoting"</span><span xmlns="" class="perl_Others"> security-realm=</span><span xmlns="" class="perl_String">"ApplicationRealm"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>    
<span xmlns="" class="line">​</span>
</pre><div class="para">
			This example contains many hypothetical values, and is presented to put the elements and attributes discussed previously into context.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:remoting:1.1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;worker-thread-pool</span><span xmlns="" class="perl_Others"> read-threads=</span><span xmlns="" class="perl_String">"1"</span><span xmlns="" class="perl_Others"> task-keepalive=</span><span xmlns="" class="perl_String">"60"</span><span xmlns="" class="perl_Others"> task-max-threads=</span><span xmlns="" class="perl_String">"16"</span><span xmlns="" class="perl_Others"> task-core-thread=</span><span xmlns="" class="perl_String">"4"</span><span xmlns="" class="perl_Others"> task-limit=</span><span xmlns="" class="perl_String">"16384"</span><span xmlns="" class="perl_Others"> write-threads=</span><span xmlns="" class="perl_String">"1"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"remoting-connector"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"remoting"</span><span xmlns="" class="perl_Others"> security-realm=</span><span xmlns="" class="perl_String">"ApplicationRealm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;sasl&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;include-mechanisms</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"GSSAPI PLAIN DIGEST-MD5"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;qop</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"auth"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;strength</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"medium"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;reuse-session</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;server-auth</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;policy&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;forward-secrecy</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;no-active</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;no-anonymous</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;no-dictionary</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;no-plain-text</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;pass-credentials</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/policy&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;properties&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myprop1"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"1"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myprop2"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"2"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/properties&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/sasl&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;authentication-provider</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myprovider"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;properties&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myprop3"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"propValue"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/properties&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/connector&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;outbound-connections&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;outbound-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-outbound-connection"</span><span xmlns="" class="perl_Others"> uri=</span><span xmlns="" class="perl_String">"http://myhost:7777/"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;remote-outbound-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-remote-connection"</span><span xmlns="" class="perl_Others"> outbound-socket-binding-ref=</span><span xmlns="" class="perl_String">"my-remote-socket"</span><span xmlns="" class="perl_Others"> username=</span><span xmlns="" class="perl_String">"myUser"</span><span xmlns="" class="perl_Others"> security-realm=</span><span xmlns="" class="perl_String">"ApplicationRealm"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;local-outbound-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myLocalConnection"</span><span xmlns="" class="perl_Others"> outbound-socket-binding-ref=</span><span xmlns="" class="perl_String">"my-outbound-socket"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/outbound-connections&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>    
<span xmlns="" class="line">​</span>
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Configuration Aspects Not Yet Documented</strong></p><ul><li class="listitem"><div class="para">
				JNDI and Multicast Automatic Detection
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7884-781534+%5BLatest%5D&amp;comment=Title%3A+Configure+the+Remoting+Subsystem%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7884-781534+13+Nov+2017+12%3A18+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Use_Security_Realms_with_Remote_EJB_Clients">
      ⁠</a>18.4.4.5. Use Security Realms with Remote EJB Clients</h3></div></div></div><div class="para">
		One way to add security to clients which invoke EJBs remotely is to use security realms. A security realm is a simple database of username/password pairs and username/role pairs. The terminology is also used in the context of web containers, with a slightly different meaning.
	</div><div class="para">
		To authenticate a specific username/password pair that exists in a security realm against an EJB, follow these steps:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Add a new security realm to the domain controller or standalone server.
			</div></li><li class="listitem"><div class="para">
				Add the following parameters to the <code class="filename">jboss-ejb-client.properties</code> file, which is in the classpath of the application. This example assumes the connection is referred to as <code class="literal">default</code> by the other parameters in the file.
			</div><pre class="programlisting">
remote.connection.default.username=appuser
remote.connection.default.password=apppassword
</pre></li><li class="listitem"><div class="para">
				Create a custom Remoting connector on the domain or standalone server, which uses your new security realm.
			</div></li><li class="listitem"><div class="para">
				Deploy your EJB to the server group which is configured to use the profile with the custom Remoting connector, or to your standalone server if you are not using a managed domain.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+8270-680304+%5BLatest%5D&amp;comment=Title%3A+Use+Security+Realms+with+Remote+EJB+Clients%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8270-680304+30+Jun+2014+08%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Add_a_New_Security_Realm">
      ⁠</a>18.4.4.6. Add a New Security Realm</h3></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Run the Management CLI.</strong></p><div class="para">
				Start the <code class="filename">jboss-cli.sh</code> or <code class="filename">jboss-cli.bat</code> command and connect to the server.
			</div></li><li class="step"><p class="title"><strong>Create the new security realm itself.</strong></p><div class="para">
				Run the following command to create a new security realm named <code class="literal">MyDomainRealm</code> on a domain controller or a standalone server.
			</div><div class="para">
				For a domain instance, use this command:
			</div><pre class="screen">/host=master/core-service=management/security-realm=MyDomainRealm:add()</pre><div class="para">
				For a standalone instance, use this command:
			</div><pre class="screen">/core-service=management/security-realm=MyDomainRealm:add()</pre></li><li class="step"><p class="title"><strong>Create the references to the properties file which will store information about the new role.</strong></p><div class="para">
				Run the following command to create a pointer a file named <code class="filename">myfile.properties</code>, which will contain the properties pertaining to the new role.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The newly created properties file is not managed by the included <code class="filename">add-user.sh</code> and <code class="filename">add-user.bat</code> scripts. It must be managed externally.
				</div></div></div><div class="para">
				For a domain instance, use this command:
			</div><pre class="screen">/host=master/core-service=management/security-realm=MyDomainRealm/authentication=properties:add(path=myfile.properties)</pre><div class="para">
				For a standalone instance, use this command:
			</div><pre class="screen">/core-service=management/security-realm=MyDomainRealm/authentication=properties:add(path=myfile.properties)</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your new security realm is created. When you add users and roles to this new realm, the information will be stored in a separate file from the default security realms. You can manage this new file using your own applications or procedures.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+8272-719583+%5BLatest%5D&amp;comment=Title%3A+Add+a+New+Security+Realm%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8272-719583+27+Oct+2014+21%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Add_a_User_to_a_Security_Realm">
      ⁠</a>18.4.4.7. Add a User to a Security Realm</h3></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Run the <code class="filename">add-user.sh</code> or <code class="filename">add-user.bat</code> command.</strong></p><div class="para">
				Open a terminal and change directories to the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/</code> directory. If you run Red Hat Enterprise Linux or another UNIX-like operating system, run <code class="filename">add-user.sh</code>. If you run Microsoft Windows Server, run <code class="filename">add-user.bat</code>.
			</div></li><li class="step"><p class="title"><strong>Choose whether to add a Management User or Application User.</strong></p><div class="para">
				For this procedure, type <code class="literal">b</code> to add an Application User.
			</div></li><li class="step"><p class="title"><strong>Choose the realm the user will be added to.</strong></p><div class="para">
				By default, the only available realm is <code class="literal">ApplicationRealm</code>. If you have added a custom realm, you can type its name instead.
			</div></li><li class="step"><p class="title"><strong>Type the username, password, and roles, when prompted.</strong></p><div class="para">
				Type the desired username, password, and optional roles when prompted. Verify your choice by typing <code class="literal">yes</code>, or type <code class="literal">no</code> to cancel the changes. The changes are written to each of the properties files for the security realm.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+8271-591829+%5BLatest%5D&amp;comment=Title%3A+Add+a+User+to+a+Security+Realm%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8271-591829+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Remote_EJB_Access_Using_SSL_Encryption">
      ⁠</a>18.4.4.8. About Remote EJB Access Using SSL Encryption</h3></div></div></div><div class="para">
		By default, the network traffic for Remote Method Invocation (RMI) of EJB2 and EJB3 Beans is not encrypted. In instances where encryption is required, Secure Sockets Layer (SSL) can be utilized so that the connection between the client and server is encrypted. Using SSL also has the added benefit of allowing the network traffic to traverse some firewalls, depending on the firewall configuration.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4786-724704+%5BLatest%5D&amp;comment=Title%3A+About+Remote+EJB+Access+Using+SSL+Encryption%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4786-724704+09+Nov+2014+23%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JAX-RS_Application_Security">
      ⁠</a>18.5. JAX-RS Application Security</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enable_Role-Based_Security_for_a_RESTEasy_JAX-RS_Web_Service1">
      ⁠</a>18.5.1. Enable Role-Based Security for a RESTEasy JAX-RS Web Service</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			RESTEasy supports the @RolesAllowed, @PermitAll, and @DenyAll annotations on JAX-RS methods. However, it does not recognize these annotations by default. Follow these steps to configure the <code class="filename">web.xml</code> file and enable role-based security.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Changing the default values of the following RESTEasy parameters may cause RESTEasy applications to be potentially vulnerable against XXE attacks.
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					resteasy.document.expand.entity.references
				</div></li><li class="listitem"><div class="para">
					resteasy.document.secure.processing.feature
				</div></li><li class="listitem"><div class="para">
					resteasy.document.secure.disableDTDs
				</div></li></ul></div><div class="para">
			For more information about these parameters, see <a class="xref" href="chap-JAX-RS_Web_Services.html#RESTEasy_Configuration_Parameters">Section 15.5.1, “RESTEasy Configuration Parameters”</a>.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Do not activate role-based security if the application uses EJBs. The EJB container will provide the functionality, instead of RESTEasy.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550811896752">
      ⁠</a><p class="title"><strong>Procedure 18.5. Enable Role-Based Security for a RESTEasy JAX-RS Web Service</strong></p><ol class="1"><li class="step"><div class="para">
				Open the <code class="filename">web.xml</code> file for the application in a text editor.
			</div></li><li class="step"><div class="para">
				Add the following &lt;context-param&gt; to the file, within the <code class="code">web-app</code> tags:
			</div><pre class="screen">
&lt;context-param&gt;
    &lt;param-name&gt;resteasy.role.based.security&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;
</pre></li><li class="step"><div class="para">
				Declare all roles used within the RESTEasy JAX-RS WAR file, using the &lt;security-role&gt; tags:
			</div><pre class="screen">&lt;security-role&gt;
    &lt;role-name&gt;<em class="replaceable">ROLE_NAME</em>&lt;/role-name&gt;
&lt;/security-role&gt;
&lt;security-role&gt;
    &lt;role-name&gt;<em class="replaceable">ROLE_NAME</em>&lt;/role-name&gt;
&lt;/security-role&gt;</pre></li><li class="step"><div class="para">
				Authorize access to all URLs handled by the JAX-RS runtime for all roles:
			</div><pre class="screen">&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
	&lt;web-resource-name&gt;Resteasy&lt;/web-resource-name&gt;
	&lt;url-pattern&gt;/<em class="replaceable">PATH</em>&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
	&lt;role-name&gt;<em class="replaceable">ROLE_NAME</em>&lt;/role-name&gt;
	&lt;role-name&gt;<em class="replaceable">ROLE_NAME</em>&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Role-based security has been enabled within the application, with a set of defined roles.
		</div><div class="example"><a id="idm140550773570448">
      ⁠</a><p class="title"><strong>Example 18.39. Example Role-Based Security Configuration</strong></p><div class="example-contents"><pre class="programlisting">
&lt;web-app&gt;

    &lt;context-param&gt;
	&lt;param-name&gt;resteasy.role.based.security&lt;/param-name&gt;
	&lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;servlet-mapping&gt;
	&lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;security-constraint&gt;
	&lt;web-resource-collection&gt;
	    &lt;web-resource-name&gt;Resteasy&lt;/web-resource-name&gt;
	    &lt;url-pattern&gt;/security&lt;/url-pattern&gt;
	&lt;/web-resource-collection&gt;
	&lt;auth-constraint&gt;
	    &lt;role-name&gt;admin&lt;/role-name&gt;
	    &lt;role-name&gt;user&lt;/role-name&gt;
	&lt;/auth-constraint&gt;
    &lt;/security-constraint&gt;

    &lt;security-role&gt;
	&lt;role-name&gt;admin&lt;/role-name&gt;
    &lt;/security-role&gt;
    &lt;security-role&gt;
	&lt;role-name&gt;user&lt;/role-name&gt;
    &lt;/security-role&gt;
    
&lt;/web-app&gt;
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5945-781125+%5BLatest%5D&amp;comment=Title%3A+Enable+Role-Based+Security+for+a+RESTEasy+JAX-RS+Web+Service%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5945-781125+27+Jan+2017+11%3A51+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Secure_a_JAX-RS_Web_Service_using_Annotations1">
      ⁠</a>18.5.2. Secure a JAX-RS Web Service using Annotations</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps to secure a JAX-RS web service using the supported security annotations
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550781222304">
      ⁠</a><p class="title"><strong>Procedure 18.6. Secure a JAX-RS Web Service using Supported Security Annotations</strong></p><ol class="1"><li class="step"><div class="para">
				Enable role-based security. For more information, refer to: <a class="xref" href="chap-Application_Security.html#Enable_Role-Based_Security_for_a_RESTEasy_JAX-RS_Web_Service1">Section 18.5.1, “Enable Role-Based Security for a RESTEasy JAX-RS Web Service”</a>
			</div></li><li class="step"><div class="para">
				Add security annotations to the JAX-RS web service. RESTEasy supports the following annotations:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">@RolesAllowed</span></dt><dd><div class="para">
							Defines which roles can access the method. All roles should be defined in the <code class="filename">web.xml</code> file.
						</div></dd><dt><span class="term">@PermitAll</span></dt><dd><div class="para">
							Allows all roles defined in the <code class="filename">web.xml</code> file to access the method.
						</div></dd><dt><span class="term">@DenyAll</span></dt><dd><div class="para">
							Denies all access to the method.
						</div></dd></dl></div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+6095-591722+%5BLatest%5D&amp;comment=Title%3A+Secure+a+JAX-RS+Web+Service+using+Annotations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=6095-591722+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Password_Vaults_for_Sensitive_Strings">
      ⁠</a>18.6. Password Vaults for Sensitive Strings</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Securing_Sensitive_Strings_in_Clear-Text_Files1">
      ⁠</a>18.6.1. Password Vault System</h2></div></div></div><div class="para">
		Configuration of JBoss EAP and associated applications requires potentially sensitive information, such as usernames and passwords.
	</div><div class="para">
		The Password Vault provides a feature to mask the password information and store it in an encrypted keystore. You can include references of the encrypted keystore in Management CLI commands or applications. The Password Vault uses the Java Keystore as its storage mechanism. The Password Vault consists of two parts: storage and key storage. Java Keystore is used to store the key, which is used to encrypt or decrypt sensitive strings in Vault storage.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+9001-768433+%5BLatest%5D&amp;comment=Title%3A+Password+Vault+System%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9001-768433+25+Aug+2015+04%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_and_Use_Password_Vault">
      ⁠</a>18.6.2. Configure and Use Password Vault</h2></div></div></div><div class="para">
		The masked keystore password feature provided in Password Vault provides the option to obtain the masked keystore password from Password Vault, which is stored on the JBoss EAP server. The Password Vault uses the Java Keystore as its storage mechanism.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550768539376">
      ⁠</a><p class="title"><strong>Procedure 18.7. Basic steps to configure and use Password Vault</strong></p><ol class="1"><li class="step"><div class="para">
				Setup a Java Keystore to store key for password encryption.
			</div><div class="para">
				For information on creating a keystore, refer <a class="xref" href="chap-Application_Security.html#Create_a_Java_Keystore_to_Store_Sensitive_Strings">Section 18.6.4, “Create a Java Keystore to Store Sensitive Strings”</a>.
			</div></li><li class="step"><div class="para">
				Initialize the Password Vault.
			</div><div class="para">
				For information on masking the password and initialize the password vault, refer <a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>.
			</div></li><li class="step"><div class="para">
				Store a Sensitive String in the Password Vault.
			</div><div class="para">
				For information on storing sensitive string in Password Vault, refer <a class="xref" href="chap-Application_Security.html#Store_and_Retrieve_Encrypted_Sensitive_Strings_in_the_Java_Keystore">Section 18.6.8, “Store a Sensitive String in the Password Vault”</a>.
			</div></li><li class="step"><div class="para">
				Configure JBoss EAP 6 to use the Password Vault.
			</div><div class="para">
				For information on configuring JBoss EAP 6 to use the Password Vault, refer <a class="xref" href="chap-Application_Security.html#Configure_the_Enterprise_Application_Platform_to_Use_the_Password_Vault1">Section 18.6.6, “Configure JBoss EAP 6 to Use the Password Vault”</a>. For custom implementation, refer <a class="xref" href="chap-Application_Security.html#Configure_JBoss_EAP_6_to_Use_a_Custom_Implementation_of_the_Password_Vault">Section 18.6.7, “Configure JBoss EAP 6 to Use a Custom Implementation of the Password Vault”</a>.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					To use an encrypted sensitive string in configuration, refer <a class="xref" href="chap-Application_Security.html#Use_an_Encrypted_Sensitive_String_in_Configuration">Section 18.6.9, “Use an Encrypted Sensitive String in Configuration”</a>.
				</div><div class="para">
					To use an encrypted sensitive string in an application, refer <a class="xref" href="chap-Application_Security.html#Store_and_Resolve_Sensitive_Strings_In_Your_Applications1">Section 18.6.10, “Use an Encrypted Sensitive String in an Application”</a>.
				</div><div class="para">
					To verify a sensitive string in Password Vault, refer <a class="xref" href="chap-Application_Security.html#Check_if_a_Sensitive_String_is_in_the_Password_Vault">Section 18.6.11, “Check if a Sensitive String is in the Password Vault”</a>.
				</div><div class="para">
					To remove a sensitive string from Password Vault, refer <a class="xref" href="chap-Application_Security.html#Remove_a_Sensitive_String_from_the_Password_Vault">Section 18.6.12, “Remove a Sensitive String from the Password Vault”</a>.
				</div></div></div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+42241-766000+%5BLatest%5D&amp;comment=Title%3A+Configure+and+Use+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42241-766000+26+Jul+2015+23%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Obtain_Keystore_Password_From_External_Source">
      ⁠</a>18.6.3. Obtain Keystore Password From External Source</h2></div></div></div><div class="para">
		You can also the use the EXT, EXTC, CMD, CMDC or CLASS methods in Vault configuration for obtaining the Java keystore password. 
<pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;vault-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"KEYSTORE_PASSWORD"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"[here]"</span></pre>

	</div><div class="para">
		The description for the methods are listed as:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="code">{EXT}...</code>: Refers to the exact command, where ‘…’ is the exact command. For example: <code class="code">{EXT}/usr/bin/getmypassword --section 1 --query company</code>, run the <code class="code">/usr/bin/getmypassword</code> command, which displays the password on standard output and use it as password for Security Vault's keystore. In this example, the command is using two options: --section 1 and --query company.
			</div></li><li class="listitem"><div class="para">
				<code class="code">{EXTC[:expiration_in_millis]}...</code>: Refers to the exact command, where the '...' is the exact command line that is passed to the Runtime.exec(String) method to execute a platform command. The first line of the command output is used as the password. EXTC variant caches the passwords for expiration_in_millis milliseconds. Default cache expiration is 0 (zero), meaning items in the cache never expire. For example: <code class="code">{EXTC:120000}/usr/bin/getmypassword --section 1 --query company</code> Verify if cache contains <code class="code">/usr/bin/getmypassword</code> output, if it contains the output then use it. If it does not contain the output, run the command to output it to cache and use it. In this example, the cache expires in 2 minute (120000 milliseconds).
			</div></li><li class="listitem"><div class="para">
				<code class="code">{CMD}...</code> or <code class="code">{CMDC[:expiration_in_millis]}...</code>: The general command is a string delimited by ',' where the first part is the actual command and further parts represents the parameters. The comma can be backslashed to keep it as a part of the parameter. For example, <code class="code">{CMD}/usr/bin/getmypassword,--section,1,--query,company</code>
			</div></li><li class="listitem"><div class="para">
				<code class="code">{CLASS[@jboss_module_spec]}classname[:ctorargs]</code>: Where the '[:ctorargs]' is an optional string delimited by the ':' from the classname is passed to the classname ctor. The ctorargs is a comma delimited list of strings. For example, <code class="code">{CLASS@org.test.passwd}org.test.passwd.ExternamPassworProvider</code>. In this example, we load <code class="code">org.test.passwd.ExternamPassworProvider</code> class from <code class="code">org.test.passwd</code> module and use the <code class="code"> toCharArray()</code> method to get the password. If <code class="code">toCharArray()</code> is not available use <code class="code">toString()</code> method. The <code class="code">org.test.passwd.ExternamPassworProvider</code> class must have the default constructor.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+42239-738014+%5BLatest%5D&amp;comment=Title%3A+Obtain+Keystore+Password+From+External+Source%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42239-738014+23+Jan+2015+00%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_a_Java_Keystore_to_Store_Sensitive_Strings">
      ⁠</a>18.6.4. Create a Java Keystore to Store Sensitive Strings</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				The <code class="command">keytool</code> utility, provided by the Java Runtime Environment (JRE). Locate the path for the file, which on Red Hat Enterprise Linux is <code class="filename">/usr/bin/keytool</code>.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			JCEKS keystore implementations differ between Java vendors so you must generate the keystore using the <code class="command">keytool</code> utility from the same vendor as the Java development kit you use.
		</div><div class="para">
			Using a keystore generated by the <code class="command">keytool</code> from one vendor's Java development kit in a JBoss EAP instance running on a Java development kit from a different vendor results in the following exception:
		</div><pre class="screen">java.io.IOException: com.sun.crypto.provider.SealedObjectForKeyProtector</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550812723584">
      ⁠</a><p class="title"><strong>Procedure 18.8. Set up a Java Keystore</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create a directory to store your keystore and other encrypted information.</strong></p><div class="para">
				Create a directory to store your keystore and other important information. The rest of this procedure assumes that the directory is <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/</code>. Since this directory will contain sensitive information it should be accessible to only limited users. At a minimum the user account under which JBoss EAP is running requires read-write access.
			</div></li><li class="step"><p class="title"><strong>Determine the parameters to use with <code class="command">keytool</code> utility.</strong></p><div class="para">
				Decide on values for the following parameters:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">alias</span></dt><dd><div class="para">
							The alias is a unique identifier for the vault or other data stored in the keystore. Aliases are case-insensitive.
						</div></dd><dt><span class="term"> storetype </span></dt><dd><div class="para">
							The storetype specifies the keystore type. The value <code class="literal">jceks</code> is recommended.
						</div></dd><dt><span class="term">keyalg</span></dt><dd><div class="para">
							The algorithm to use for encryption. Use the documentation for your JRE and operating system to see which other choices may be available to you.
						</div></dd><dt><span class="term">keysize</span></dt><dd><div class="para">
							The size of an encryption key impacts how difficult it is to decrypt through brute force. For information on appropriate values, see the documentation distributed with the <code class="command">keytool</code> utility.
						</div></dd><dt><span class="term"> storepass </span></dt><dd><div class="para">
							The value of <code class="literal">storepass</code> is the password is used to authenticate to the keystore so that the key can be read. The password must be at least 6 characters long and must be provided when the keystore is accessed. If you omit this parameter, you will be prompted to enter it when you execute the command.
						</div></dd><dt><span class="term"> keypass </span></dt><dd><div class="para">
							The value of <code class="literal">keypass</code> is the password used to access the specific key and must match the value of the <code class="literal">storepass</code> parameter.
						</div></dd><dt><span class="term"> validity </span></dt><dd><div class="para">
							The value of <code class="literal">validity</code> is the period (in days) for which the key will be valid.
						</div></dd><dt><span class="term">keystore</span></dt><dd><div class="para">
							The value of <code class="literal">keystore</code> is the filepath and filename in which the keystore's values are to be stored. The keystore file is created when data is first added to it.
						</div><div class="para">
							Ensure you use the correct file path separator: <code class="literal">/</code> (forward slash) for Red Hat Enterprise Linux and similar operating systems, <code class="literal">\</code> (backslash) for Microsoft Windows Server.
						</div></dd></dl></div><div class="para">
				The <code class="command">keytool</code> utility has many other options. See the documentation for your JRE or your operating system for more details.
			</div></li><li class="step"><p class="title"><strong>Run the <code class="command">keytool</code> command</strong></p><div class="para">
				Launch your operating system's command line interface and run the <code class="command">keytool</code> utility, supplying the information that you gathered.
			</div></li></ol></div><div class="example"><a id="idm140550804363808">
      ⁠</a><p class="title"><strong>Example 18.40. Create a Java Keystore</strong></p><div class="example-contents"><pre class="screen">$ keytool -genseckey -alias <em class="replaceable">vault</em> -storetype jceks -keyalg AES -keysize 128 -storepass <em class="replaceable">vault22</em> -keypass <em class="replaceable">vault22</em> -validity 730 -keystore <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/vault.keystore</code></pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			In this a keystore has been created in the file <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/vault.keystore</code>. It stores a single key, with the alias <code class="literal">vault</code>, which will be used to store encrypted strings, such as passwords, for JBoss EAP.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5353-764601+%5BLatest%5D&amp;comment=Title%3A+Create+a+Java+Keystore+to+Store+Sensitive+Strings%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5353-764601+12+Jul+2015+20%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">
      ⁠</a>18.6.5. Initialize the Password Vault</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#Create_a_Java_Keystore_to_Store_Sensitive_Strings">Section 18.6.4, “Create a Java Keystore to Store Sensitive Strings”</a>
			</div></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			The Password Vault can be initialized either interactively, where you are prompted for each parameter's value, or non-interactively, where you provide all parameters' values on the commmand line. Each method gives the same result, so choose whichever method you prefer.
		</div><div class="para">
		Refer to the following list when using either method.
	</div><div class="variablelist"><a id="password_vault_parameter_values">
      ⁠</a><p class="title"><strong>Parameter Values</strong></p><dl class="variablelist"><dt><span class="term">Keystore URL (KEYSTORE_URL) </span></dt><dd><div class="para">
					The file system path or URI of the keystore file. The examples use <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/<code class="literal">vault.keystore</code></code>.
				</div></dd><dt><span class="term"> Keystore password (KEYSTORE_PASSWORD) </span></dt><dd><div class="para">
					The password used to access the keystore.
				</div></dd><dt><span class="term"> Salt (SALT) </span></dt><dd><div class="para">
					The <code class="literal">salt</code> value is a random string of eight characters used, together with the iteration count, to encrypt the content of the keystore.
				</div></dd><dt><span class="term"> Keystore Alias (KEYSTORE_ALIAS) </span></dt><dd><div class="para">
					The alias by which the keystore is known.
				</div></dd><dt><span class="term"> Iteration Count (ITERATION_COUNT) </span></dt><dd><div class="para">
					The number of times the encryption algorithm is run.
				</div></dd><dt><span class="term"> Directory to store encrypted files (ENC_FILE_DIR) </span></dt><dd><div class="para">
					The path in which the encrypted files are to be stored. This is typically the directory containing the password vault.
				</div><div class="para">
					It is convenient but not mandatory to store all of your encrypted information in the same place as the key store. This directory should be only accessible to limited users. At a minimum the user account under which JBoss EAP is running requires read-write access. If you followed <a class="xref" href="chap-Application_Security.html#Create_a_Java_Keystore_to_Store_Sensitive_Strings">Section 18.6.4, “Create a Java Keystore to Store Sensitive Strings”</a>, your keystore is in a directory called <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/</code>.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The trailing backslash or forward slash on the directory name is required. Ensure you use the correct file path separator: / (forward slash) for Red Hat Enterprise Linux and similar operating systems, \ (backslash) for Microsoft Windows Server.
					</div></div></div></dd><dt><span class="term"> Vault Block (VAULT_BLOCK) </span></dt><dd><div class="para">
					The name to be given to this block in the password vault. Choose a value which is significant to you.
				</div></dd><dt><span class="term"> Attribute (ATTRIBUTE) </span></dt><dd><div class="para">
					The name to be given to the attribute being stored. Choose a value which is significant to you. For example, you could choose a name which you associate with a datasource.
				</div></dd><dt><span class="term"> Security Attribute (SEC-ATTR) </span></dt><dd><div class="para">
					The password which is being stored in the password vault.
				</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550809552576">
      ⁠</a><p class="title"><strong>Procedure 18.9. Run the Password Vault Command Interactively</strong></p><div class="para">
			Use this method if you would prefer to be prompted for the value of each parameter.
		</div><ol class="1"><li class="step"><p class="title"><strong> Launch the Password Vault command interactively. </strong></p><div class="para">
				Launch your operating system's command line interface and run <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server). Start a new interactive session by typing <code class="literal">0</code> (zero).
			</div></li><li class="step"><p class="title"><strong>Complete the prompted parameters.</strong></p><div class="para">
				Follow the prompts to input the required parameters.
			</div></li><li class="step"><p class="title"><strong>Make a note of the masked password information.</strong></p><div class="para">
				The masked password, salt, and iteration count are printed to standard output. Make a note of them in a secure location. They are required to add entries to the Password Vault. Access to the keystore file and these values could allow an attacker access to obtain access to sensitive information in the Password Vault.
			</div></li><li class="step"><p class="title"><strong>Exit the interactive console.</strong></p><div class="para">
				Type <code class="literal">3</code> (three) to exit the interactive console.
			</div></li></ol></div><div class="example"><a id="idm140550794564288">
      ⁠</a><p class="title"><strong>Example 18.41.  Run the Password Vault command interactively </strong></p><div class="example-contents"><pre class="screen">Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault/                        
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password: vault22
Enter Keystore password again: vault22
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Oct 17, 2014 12:58:11 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in AS7 config file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************
Vault is initialized and ready for use
Handshake with Vault complete</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550789153504">
      ⁠</a><p class="title"><strong>Procedure 18.10. Run the Password Vault Command Non-interactively</strong></p><div class="para">
			Use this method if you would prefer to provide all parameters' values at once.
		</div><ul><li class="step"><div class="para">
				Launch your operating system's command line interface and run the Password Vault command. Refer to the <a class="xref" href="chap-Application_Security.html#password_vault_parameter_values">Parameter Values</a> list, substituting the placeholder values with your preferred values.
			</div><div class="para">
				Use <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server).
			</div><pre class="screen">
vault.sh --keystore <em class="replaceable">KEYSTORE_URL</em> --keystore-password <em class="replaceable">KEYSTORE_PASSWORD</em> --alias <em class="replaceable">KEYSTORE_ALIAS</em> --vault-block <em class="replaceable">VAULT_BLOCK</em> --attribute <em class="replaceable">ATTRIBUTE</em> --sec-attr <em class="replaceable">SEC-ATTR</em> --enc-dir <em class="replaceable">ENC_FILE_DIR</em> --iteration <em class="replaceable">ITERATION_COUNT</em> --salt <em class="replaceable">SALT</em></pre><div class="example"><a id="idm140550798052976">
      ⁠</a><p class="title"><strong>Example 18.42. Run the Password Vault command non-interactively</strong></p><div class="example-contents"><pre class="screen">vault.sh --keystore <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/vault.keystore</code> --keystore-password <em class="parameter"><code>vault22</code></em> --alias <em class="parameter"><code>vault</code></em> --vault-block <em class="parameter"><code>vb</code></em> --attribute <em class="parameter"><code>password</code></em> --sec-attr <em class="parameter"><code>0penS3sam3</code></em> --enc-dir <em class="parameter"><code><em class="replaceable">EAP_HOME</em>/vault/</code></em> --iteration <em class="parameter"><code>120</code></em> --salt <em class="parameter"><code>1234abcd</code></em></pre><div class="para">
					Command output
				</div><pre class="screen">=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME

  JAVA: java

=========================================================================

Oct 17, 2014 2:23:43 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Secured attribute value has been stored in vault. 
Please make note of the following:
********************************************
Vault Block:vb
Attribute Name:password
Configuration should be done as follows:
VAULT::vb::password::1
********************************************
Vault Configuration in AS7 config file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************
</pre></div></div></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your keystore password has been masked for use in configuration files and deployments. In addition, your vault is initialized and ready to use.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5357-763590+%5BLatest%5D&amp;comment=Title%3A+Initialize+the+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5357-763590+02+Jul+2015+00%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_Enterprise_Application_Platform_to_Use_the_Password_Vault1">
      ⁠</a>18.6.6. Configure JBoss EAP 6 to Use the Password Vault</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			Before you can mask passwords and other sensitive attributes in configuration files, you need to make JBoss EAP 6 aware of the password vault which stores and decrypts them.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550810848160">
      ⁠</a><p class="title"><strong>Procedure 18.11. Enable the Password Vault</strong></p><ul><li class="step"><p class="title"><strong/></p><div class="para">
				Run the following Management CLI command, substituting the placeholder values with those from the output of the Password Vault command in <a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					If you use Microsoft Windows Server, use two backslashes (<code class="literal">\\</code>) in the file path where you would normally use one. For example, <code class="literal">C:\\data\\vault\\vault.keystore</code>. This is because a single backslash character (<code class="literal">\</code>) is used for character escaping.
				</div></div></div><pre class="screen">/core-service=vault:add(vault-options=[("KEYSTORE_URL" =&gt; "<em class="replaceable">PATH_TO_KEYSTORE</em>"), ("KEYSTORE_PASSWORD" =&gt; "<em class="replaceable">MASKED_PASSWORD</em>"), ("KEYSTORE_ALIAS" =&gt; "<em class="replaceable">ALIAS</em>"), ("SALT" =&gt; "<em class="replaceable">SALT</em>"),("ITERATION_COUNT" =&gt; "<em class="replaceable">ITERATION_COUNT</em>"), ("ENC_FILE_DIR" =&gt; "<em class="replaceable">ENC_FILE_DIR</em>")])</pre></li></ul></div><div class="example"><a id="idm140550786518384">
      ⁠</a><p class="title"><strong>Example 18.43. Enable the Password Vault</strong></p><div class="example-contents"><div class="para">
			
<pre class="screen">/core-service=vault:add(vault-options=[("KEYSTORE_URL" =&gt; "<em class="replaceable">EAP_HOME</em>/vault/vault.keystore"), ("KEYSTORE_PASSWORD" =&gt; "MASK-5dOaAVafCSd"), ("KEYSTORE_ALIAS" =&gt; "vault"), ("SALT" =&gt; "1234abcd"),("ITERATION_COUNT" =&gt; "120"), ("ENC_FILE_DIR" =&gt; "<em class="replaceable">EAP_HOME</em>/vault/")])</pre>

		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			JBoss EAP 6 is configured to decrypt masked strings stored in the Password Vault. To add strings to the Password Vault and use them in your configuration, see <a class="xref" href="chap-Application_Security.html#Store_and_Retrieve_Encrypted_Sensitive_Strings_in_the_Java_Keystore">Section 18.6.8, “Store a Sensitive String in the Password Vault”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5358-717634+%5BLatest%5D&amp;comment=Title%3A+Configure+JBoss+EAP+6+to+Use+the+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5358-717634+20+Oct+2014+20%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_JBoss_EAP_6_to_Use_a_Custom_Implementation_of_the_Password_Vault">
      ⁠</a>18.6.7. Configure JBoss EAP 6 to Use a Custom Implementation of the Password Vault</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			You can use your own implementation of <code class="code">SecurityVault</code> to mask passwords and other sensitive attributes in configuration files.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550722799008">
      ⁠</a><p class="title"><strong>Procedure 18.12. Use a Custom Implementation of the Password Vault</strong></p><ol class="1"><li class="step"><div class="para">
				Create a class that implements the interface <code class="code">SecurityVault</code>.
			</div></li><li class="step"><div class="para">
				Create a module containing the class from the previous step, and specify a dependency on <code class="code">org.picketbox</code> where the interface is <code class="code">SecurityVault</code>.
			</div></li><li class="step"><div class="para">
				Enable the custom Password Vault in the JBoss EAP server configuration by adding the vault element with the following attributes:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> code </span></dt><dd><div class="para">
							The fully qualified name of class that implements <code class="code">SecurityVault</code>.
						</div></dd><dt><span class="term"> module </span></dt><dd><div class="para">
							The name of the module that contains the custom class.
						</div></dd></dl></div><div class="para">
				Optionally, you can use <code class="code">vault-options</code> parameters to initialize the custom class for a Password Vault.
			</div><div class="example"><a id="idm140550812178736">
      ⁠</a><p class="title"><strong>Example 18.44.  Use <code class="code">vault-options</code> Parameters to Initialize the Custom Class </strong></p><div class="example-contents"><pre class="screen">/core-service=vault:add(code="<em class="replaceable">custom.vault.implementation.CustomSecurityVault</em>", module="<em class="replaceable">custom.vault.module</em>", vault-options=[("KEYSTORE_URL" =&gt; "<em class="replaceable">PATH_TO_KEYSTORE</em>"), ("KEYSTORE_PASSWORD" =&gt; "<em class="replaceable">MASKED_PASSWORD</em>"), ("KEYSTORE_ALIAS" =&gt; "<em class="replaceable">ALIAS</em>"), ("SALT" =&gt; "<em class="replaceable">SALT</em>"),("ITERATION_COUNT" =&gt; "<em class="replaceable">ITERATION_COUNT</em>"), ("ENC_FILE_DIR" =&gt; "<em class="replaceable">ENC_FILE_DIR</em>")])</pre></div></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			JBoss EAP 6 is configured to decrypt masked strings using a custom implementation of the password vault.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+30621-716527+%5BLatest%5D&amp;comment=Title%3A+Configure+JBoss+EAP+6+to+Use+a+Custom+Implementation+of+the+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30621-716527+14+Oct+2014+23%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Store_and_Retrieve_Encrypted_Sensitive_Strings_in_the_Java_Keystore">
      ⁠</a>18.6.8. Store a Sensitive String in the Password Vault</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			Including passwords and other sensitive strings in plaintext configuration files is a security risk. Store these strings instead in the Password Vault for improved security, where they can then be referenced in configuration files, Management CLI commands and applications in their masked form.
		</div><div class="para">
		Sensitive strings can be store in the Password Vault either interactively, where you are prompted for each parameter's value, or non-interactively, where you provide all parameters' values on the commmand line. Each method gives the same result, so choose whichever method you prefer. For a description of all parameters, see <a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#Configure_the_Enterprise_Application_Platform_to_Use_the_Password_Vault1">Section 18.6.6, “Configure JBoss EAP 6 to Use the Password Vault”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550791879152">
      ⁠</a><p class="title"><strong>Procedure 18.13. Store a Sensitive String Interactively</strong></p><div class="para">
			Use this method if you would prefer to be prompted for the value of each parameter.
		</div><ol class="1"><li class="step"><p class="title"><strong>Run the Password Vault command</strong></p><div class="para">
				Launch your operating system's command line interface and run the Password Vault command. Use <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server). Start a new interactive session by typing <code class="literal">0</code> (zero).
			</div></li><li class="step"><p class="title"><strong>Complete the prompted parameters about the Password Vault</strong></p><div class="para">
				Follow the prompts to input the required authentication parameters. These values must match those provided when the Password Vault was created.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The keystore password must be given in plaintext form, not masked form.
				</div></div></div></li><li class="step"><p class="title"><strong>Complete the prompted parameters about the sensitive string</strong></p><div class="para">
				Enter <code class="literal">0</code> (zero) to start storing the sensitive string. Follow the prompts to input the required parameters.
			</div></li><li class="step"><p class="title"><strong>Make note of the information about the masked string</strong></p><div class="para">
				A message prints to standard output, showing the vault block, attribute name, masked string, and advice about using the string in your configuration. Make note of this information in a secure location. An extract of sample output is as follows:
			</div><pre class="screen">Vault Block:ds_Example1
Attribute Name:password
Configuration should be done as follows:
VAULT::ds_Example1::password::1
</pre></li><li class="step"><p class="title"><strong>Exit the interactive console</strong></p><div class="para">
				Enter <code class="literal">3</code> (three) to exit the interactive console.
			</div></li></ol></div><div class="example"><a id="idm140550784098976">
      ⁠</a><p class="title"><strong>Example 18.45.  Store a Sensitive String Interactively </strong></p><div class="example-contents"><pre class="screen">=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME/jboss-eap-6.4

  JAVA: java

=========================================================================

**********************************
****  JBoss Vault  ***************
**********************************
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:11:18:46,086 INFO  [org.jboss.security] (management-handler-thread - 4) PBOX0                                                                  
Enter directory to store encrypted files:EAP_HOME/vault/ 
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password: 
Enter Keystore password again: 
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Oct 21, 2014 11:20:49 AM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in AS7 config file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::   0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
0
Task: Store a secured attribute
Please enter secured attribute value (such as password):
Please enter secured attribute value (such as password) again: 
Values match
Enter Vault Block:ds_Example1
Enter Attribute Name:password
Secured attribute value has been stored in vault. 
Please make note of the following:
********************************************
Vault Block:ds_Example1
Attribute Name:password
Configuration should be done as follows:
VAULT::ds_Example1::password::1
********************************************
Please enter a Digit::   0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550739216176">
      ⁠</a><p class="title"><strong>Procedure 18.14. Store a Sensitive String Non-interactively</strong></p><div class="para">
			Use this method if you would prefer to provide all parameters' values at once.
		</div><ol class="1"><li class="step"><div class="para">
				Launch your operating system's command line interface and run the Password Vault command. Use <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server).
			</div><div class="para">
				Substitute the placeholder values with your own values. The values for parameters <em class="parameter"><code>KEYSTORE_URL</code></em>, <em class="parameter"><code>KEYSTORE_PASSWORD</code></em> and <em class="parameter"><code>KEYSTORE_ALIAS</code></em> must match those provided when the Password Vault was created.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The keystore password must be given in plaintext form, not masked form.
				</div></div></div><pre class="screen"><code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> --keystore <em class="replaceable">KEYSTORE_URL</em> --keystore-password <em class="replaceable">KEYSTORE_PASSWORD</em> --alias <em class="replaceable">KEYSTORE_ALIAS</em> --vault-block <em class="replaceable">VAULT_BLOCK</em> --attribute <em class="replaceable">ATTRIBUTE</em> --sec-attr <em class="replaceable">SEC-ATTR</em> --enc-dir <em class="replaceable">ENC_FILE_DIR</em> --iteration <em class="replaceable">ITERATION_COUNT</em> --salt <em class="replaceable">SALT</em></pre></li><li class="step"><p class="title"><strong>Make note of the information about the masked string</strong></p><div class="para">
				A message prints to standard output, showing the vault block, attribute name, masked string, and advice about using the string in your configuration. Make note of this information in a secure location. An extract of sample output is as follows:
			</div><pre class="screen">Vault Block:vb
Attribute Name:password
Configuration should be done as follows:
VAULT::vb::password::1
</pre></li></ol></div><div class="example"><a id="idm140550778788544">
      ⁠</a><p class="title"><strong>Example 18.46. Run the Password Vault command non-interactively</strong></p><div class="example-contents"><pre class="screen"><code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> --keystore <code class="filename"><em class="replaceable">EAP_HOME</em>/vault/vault.keystore</code> --keystore-password <em class="parameter"><code>vault22</code></em> --alias <em class="parameter"><code>vault</code></em> --vault-block <em class="parameter"><code>vb</code></em> --attribute <em class="parameter"><code>password</code></em> --sec-attr <em class="parameter"><code>0penS3sam3</code></em> --enc-dir <em class="parameter"><code><em class="replaceable">EAP_HOME</em>/vault/</code></em> --iteration <em class="parameter"><code>120</code></em> --salt <em class="parameter"><code>1234abcd</code></em></pre><div class="para">
			Command output
		</div><pre class="screen">=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME

  JAVA: java

=========================================================================

Oct 22, 2014 9:24:43 AM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Secured attribute value has been stored in vault. 
Please make note of the following:
********************************************
Vault Block:vb
Attribute Name:password
Configuration should be done as follows:
VAULT::vb::password::1
********************************************
Vault Configuration in AS7 config file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="vault22"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************</pre></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The sensitive string has now been stored in the Password Vault and can be used in configuration files, Management CLI commands and applications in its masked form.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+5359-748093+%5BLatest%5D&amp;comment=Title%3A+Store+a+Sensitive+String+in+the+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5359-748093+20+Mar+2015+12%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_an_Encrypted_Sensitive_String_in_Configuration">
      ⁠</a>18.6.9. Use an Encrypted Sensitive String in Configuration</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#Store_and_Retrieve_Encrypted_Sensitive_Strings_in_the_Java_Keystore">Section 18.6.8, “Store a Sensitive String in the Password Vault”</a>
			</div></li></ul></div><div class="para">
		Any sensitive string which has been encrypted can be used in a configuration file or Management CLI command in its masked form, providing expressions are allowed.
	</div><div class="para">
		To confirm if expressions are allowed within a particular subsystem, run the following Management CLI command against that subsystem.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Add the prefix <code class="literal">/host=<em class="replaceable">HOST_NAME</em></code> to the command for a managed domain.
		</div></div></div><pre class="programlisting">/core-service=<em class="replaceable">SUBSYSTEM</em>:read-resource-description(recursive=true)</pre><div class="example"><a id="idm140550724069296">
      ⁠</a><p class="title"><strong>Example 18.47.  List the Description of all Resources in the Management Subsystem </strong></p><div class="example-contents"><div class="para">
			
<pre class="screen">/core-service=management:read-resource-description(recursive=true)</pre>

		</div></div></div><div class="para">
		From the output of running this command, look for the value of the <code class="literal">expressions-allowed</code> parameter. If this is <code class="literal">true</code>, then you can use expressions within the configuration of this subsystem.
	</div><div class="para">
		Use the following syntax to replace any plaintext string with the masked form.
	</div><pre class="screen">${VAULT::<em class="replaceable">VAULT_BLOCK</em>::<em class="replaceable">ATTRIBUTE_NAME</em>::<em class="replaceable">MASKED_STRING</em>}</pre><div class="example"><a id="idm140550803328512">
      ⁠</a><p class="title"><strong>Example 18.48.  Datasource Definition Using a Password in Masked Form </strong></p><div class="example-contents"><div class="para">
			In this example the vault block is <code class="literal">ds_ExampleDS</code> and the attribute is <code class="literal">password</code>.
		</div><div class="para">
			
<pre class="screen">
...
  &lt;subsystem xmlns="urn:jboss:domain:datasources:1.0"&gt;
    &lt;datasources&gt;
      &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" enabled="true" use-java-context="true" pool-name="H2DS"&gt;
        &lt;connection-url&gt;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&lt;/connection-url&gt;
        &lt;driver&gt;h2&lt;/driver&gt;
        &lt;pool&gt;&lt;/pool&gt;
        &lt;security&gt;
          &lt;user-name&gt;sa&lt;/user-name&gt;
          &lt;password&gt;${VAULT::ds_ExampleDS::password::1}&lt;/password&gt;
        &lt;/security&gt;
      &lt;/datasource&gt;
      &lt;drivers&gt;
         &lt;driver name="h2" module="com.h2database.h2"&gt;
            &lt;xa-datasource-class&gt;org.h2.jdbcx.JdbcDataSource&lt;/xa-datasource-class&gt;
         &lt;/driver&gt;
      &lt;/drivers&gt;
    &lt;/datasources&gt;
  &lt;/subsystem&gt;
...
</pre>

		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+41946-718312+%5BLatest%5D&amp;comment=Title%3A+Use+an+Encrypted+Sensitive+String+in+Configuration%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41946-718312+22+Oct+2014+19%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Store_and_Resolve_Sensitive_Strings_In_Your_Applications1">
      ⁠</a>18.6.10. Use an Encrypted Sensitive String in an Application</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Application_Security.html#Store_and_Retrieve_Encrypted_Sensitive_Strings_in_the_Java_Keystore">Section 18.6.8, “Store a Sensitive String in the Password Vault”</a>
			</div></li></ul></div><div class="para">
		Encrypted strings stored in the Password Vault can be used in your application's source code.
	</div><div class="example"><a id="idm140550777836640">
      ⁠</a><p class="title"><strong>Example 18.49. Servlet Using a Vaulted Password</strong></p><div class="example-contents"><div class="para">
			This example is an extract of a servlet's source code, illustrating the use of a masked password in a datasource definition, instead of the plaintext password. The plaintext version is commented out so that you can see the difference.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/*@DataSourceDefinition(</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        name = "java:jboss/datasources/LoginDS",</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        user = "sa",</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        password = "sa",</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        className = "org.h2.jdbcx.JdbcDataSource",</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        url = "jdbc:h2:tcp://localhost/mem:test"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">)*/</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">DataSourceDefinition</span>(
<span xmlns="" class="line">​</span>        name = <span xmlns="" class="perl_String">"java:jboss/datasources/LoginDS"</span>,
<span xmlns="" class="line">​</span>        user = <span xmlns="" class="perl_String">"sa"</span>,
<span xmlns="" class="line">​</span>        password = <span xmlns="" class="perl_String">"VAULT::DS::thePass::1"</span>,
<span xmlns="" class="line">​</span>        className = <span xmlns="" class="perl_String">"org.h2.jdbcx.JdbcDataSource"</span>,
<span xmlns="" class="line">​</span>        url = <span xmlns="" class="perl_String">"jdbc:h2:tcp://localhost/mem:test"</span>
<span xmlns="" class="line">​</span>)
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4930-716839+%5BLatest%5D&amp;comment=Title%3A+Use+an+Encrypted+Sensitive+String+in+an+Application%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4930-716839+15+Oct+2014+22%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Check_if_a_Sensitive_String_is_in_the_Password_Vault">
      ⁠</a>18.6.11. Check if a Sensitive String is in the Password Vault</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Overview </div>
			Before attempting to store or use a sensitive string in the Password Vault it can be useful to first confirm if it is already stored.
		</div><div class="para">
		This check can be done either interactively, where you are prompted for each parameter's value, or non-interactively, where you provide all parameters' values on the commmand line. Each method gives the same result, so choose whichever method you prefer.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550775515552">
      ⁠</a><p class="title"><strong>Procedure 18.15.  Check For a Sensitive String Interactively </strong></p><div class="para">
			Use this method if you would prefer to be prompted for the value of each parameter.
		</div><ol class="1"><li class="step"><p class="title"><strong>Run the Password Vault command</strong></p><div class="para">
				Launch your operating system's command line interface and run the Password Vault command. Use <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server). Start a new interactive session by typing <code class="literal">0</code> (zero).
			</div></li><li class="step"><p class="title"><strong>Complete the prompted parameters about the Password Vault</strong></p><div class="para">
				Follow the prompts to input the required authentication parameters. These values must match those provided when the Password Vault was created.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The keystore password must be given in plaintext form, not masked form.
				</div></div></div></li><li class="step"><div class="para">
				Enter <strong class="userinput"><code>1</code></strong> (one) to select “Check whether a secured attribute exists”.
			</div></li><li class="step"><div class="para">
				Enter the name of the vault block in which the sensitive string is stored.
			</div></li><li class="step"><div class="para">
				Enter the name of the sensitive string to be checked.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Result </div>
			If the sensitive string is stored in the vault block specified, a confirmation message like the following will be output.
		</div><pre class="screen">A value exists for (VAULT_BLOCK, ATTRIBUTE)</pre><div class="para">
		If the sensitive string is <span class="emphasis"><em>not</em></span> stored in the specified block, a message like the following will be output.
	</div><pre class="screen">No value has been store for (VAULT_BLOCK, ATTRIBUTE)</pre><div class="example"><a id="idm140550807699424">
      ⁠</a><p class="title"><strong>Example 18.50. Check For a Sensitive String Interactively</strong></p><div class="example-contents"><pre class="screen">=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME

  JAVA: java

=========================================================================

**********************************
****  JBoss Vault  ***************
**********************************
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password:
Enter Keystore password again:
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Oct 22, 2014 12:53:56 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in AS7 config file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::   0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
1
Task: Verify whether a secured attribute exists
Enter Vault Block:vb
Enter Attribute Name:password
A value exists for (vb, password)
Please enter a Digit::   0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550739024096">
      ⁠</a><p class="title"><strong>Procedure 18.16.  Check For a Sensitive String Non-Interactively </strong></p><div class="para">
			Use this method if you would prefer to provide all parameters' values at once. For a description of all parameters, see <a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>.
		</div><ul><li class="step"><div class="para">
				Launch your operating system's command line interface and run the Password Vault command. Use <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server).
			</div><div class="para">
				Substitute the placeholder values with your own values. The values for parameters <em class="parameter"><code>KEYSTORE_URL</code></em>, <em class="parameter"><code>KEYSTORE_PASSWORD-password</code></em> and <em class="parameter"><code>KEYSTORE_ALIAS</code></em> must match those provided when the Password Vault was created.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The keystore password must be given in plaintext form, not masked form.
				</div></div></div><pre class="screen"><code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> --keystore <em class="replaceable">KEYSTORE_URL</em> --keystore-password <em class="replaceable">KEYSTORE_PASSWORD</em> --alias <em class="replaceable">KEYSTORE_ALIAS</em> --check-sec-attr --vault-block <em class="replaceable">VAULT_BLOCK</em> --attribute <em class="replaceable">ATTRIBUTE</em> --enc-dir <em class="replaceable">ENC_FILE_DIR</em> --iteration <em class="replaceable">ITERATION_COUNT</em> --salt <em class="replaceable">SALT</em></pre></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Result </div>
			If the sensitive string is stored in the vault block specified, the following message will be output.
		</div><pre class="screen">Password already exists.</pre><div class="para">
		If the value is <span class="emphasis"><em>not</em></span> stored in the specified block, the following message will be output.
	</div><pre class="screen">Password doesn't exist.</pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+42030-748092+%5BLatest%5D&amp;comment=Title%3A+Check+if+a+Sensitive+String+is+in+the+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42030-748092+20+Mar+2015+12%3A28+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Remove_a_Sensitive_String_from_the_Password_Vault">
      ⁠</a>18.6.12. Remove a Sensitive String from the Password Vault</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			For security reasons it is best to remove sensitive strings from the Password Vault when they are no longer required. For example, if you are decommissioning an application, any sensitive strings used in datasource definitions should be removed at the same time.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Prerequisite </div>
			Before removing a sensitive string from the Password Vault, confirm if it is used in the configuration of JBoss EAP. One method of doing this is to use the ‘grep’ utility to search configuration files for instances of the masked string. On Red Hat Enterprise Linux (and similar operating systems), <code class="command">grep</code> is installed by default but for Microsoft Windows Server it must be installed manually.
		</div><div class="para">
		The Password Vault utility provides two modes: interactive and non-interactive. Interactive mode prompts you for each parameter’s value, where non-interactive mode requires you to provide all parameters’ values in a single command.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550744334304">
      ⁠</a><p class="title"><strong>Procedure 18.17. Remove a Sensitive String Interactively</strong></p><div class="para">
			Use this method if you would prefer to be prompted for the value of each parameter.
		</div><ol class="1"><li class="step"><p class="title"><strong>Run the Password Vault command</strong></p><div class="para">
				Launch your operating system's command line interface and run <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server). Start a new interactive session by typing <strong class="userinput"><code>0</code></strong> (zero).
			</div></li><li class="step"><p class="title"><strong> Provide Authentication Details </strong></p><div class="para">
				Follow the prompts to input the required authentication parameters. These values must match those provided when the Password Vault was created.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The keystore password must be given in plaintext form, not masked form.
				</div></div></div></li><li class="step"><div class="para">
				Enter <strong class="userinput"><code>2</code></strong> (two) to choose option <code class="literal">Remove secured attribute</code>.
			</div></li><li class="step"><div class="para">
				Enter the name of the vault block in which the sensitive string is stored.
			</div></li><li class="step"><div class="para">
				Enter the name of the sensitive string to be removed.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			If the sensitive string is successfully removed, a confirmation message like the following will be output.
		</div><pre class="screen">Secured attribute [VAULT_BLOCK::ATTRIBUTE] has been successfully removed from vault</pre><div class="para">
		If the sensitive string is <span class="emphasis"><em>not removed, a message like the following will be output.</em></span>
	</div><pre class="screen">Secured attribute [VAULT_BLOCK::ATTRIBUTE] was not removed from vault, check whether it exist</pre><div class="example"><a id="idm140550718695072">
      ⁠</a><p class="title"><strong>Example 18.51.  Remove a Sensitive String Interactively </strong></p><div class="example-contents"><div class="para">
			
<pre class="screen">**********************************
****  JBoss Vault  ***************
**********************************
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault/
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password: 
Enter Keystore password again: 
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Dec 23, 2014 1:40:56 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in configuration file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::  0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
2
Task: Remove secured attribute
Enter Vault Block:craft
Enter Attribute Name:password
Secured attribute [craft::password] has been successfully removed from vault</pre>

		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550774535584">
      ⁠</a><p class="title"><strong>Procedure 18.18.  Remove a Sensitive String Non-interactively </strong></p><div class="para">
			Use this method if you would prefer to provide all parameters' values at once. For a description of all parameters, see <a class="xref" href="chap-Application_Security.html#Mask_the_Keystore_Password_and_Initialize_the_Password_Vault.">Section 18.6.5, “Initialize the Password Vault”</a>.
		</div><ul><li class="step"><div class="para">
				Launch your operating system's command line interface and run the Password Vault command. Use <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\vault.bat</code> (on Microsoft Windows Server).
			</div><div class="para">
				Substitute the placeholder values with your own values. The values for parameters <em class="parameter"><code>KEYSTORE_URL</code></em>, <em class="parameter"><code>KEYSTORE_PASSWORD</code></em> and <em class="parameter"><code>KEYSTORE_ALIAS</code></em> must match those provided when the Password Vault was created.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The keystore password must be given in plaintext form, not masked form.
				</div></div></div><pre class="screen"><code class="filename"><em class="replaceable">EAP_HOME</em>/bin/vault.sh</code> --keystore <em class="replaceable">KEYSTORE_URL</em> --keystore-password <em class="replaceable">KEYSTORE_PASSWORD</em> --alias <em class="replaceable">KEYSTORE_ALIAS</em> --remove-sec-attr --vault-block <em class="replaceable">VAULT_BLOCK</em> --attribute <em class="replaceable">ATTRIBUTE</em> --enc-dir <em class="replaceable">ENC_FILE_DIR</em> --iteration <em class="replaceable">ITERATION_COUNT</em> --salt <em class="replaceable">SALT</em></pre></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			If the sensitive string is successfully removed, a confirmation message like the following will be output.
		</div><pre class="screen">Secured attribute [VAULT_BLOCK::ATTRIBUTE] has been successfully removed from vault</pre><div class="para">
		If the sensitive string is <span class="emphasis"><em>not removed, a message like the following will be output.</em></span>
	</div><pre class="screen">Secured attribute [VAULT_BLOCK::ATTRIBUTE] was not removed from vault, check whether it exist</pre><div class="example"><a id="idm140550777838160">
      ⁠</a><p class="title"><strong>Example 18.52.  Remove a Sensitive String Non-interactively </strong></p><div class="example-contents"><div class="para">
			
<pre class="screen">./vault.sh --keystore EAP_HOME/vault/vault.keystore --keystore-password vault22 --alias vault --remove-sec-attr --vault-block craft --attribute password --enc-dir ../vault/ --iteration 120 --salt 1234abcd
=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME

  JAVA: java

=========================================================================

Dec 23, 2014 1:54:24 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Secured attribute [craft::password] has been successfully removed from vault</pre>

		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+42029-734038+%5BLatest%5D&amp;comment=Title%3A+Remove+a+Sensitive+String+from+the+Password+Vault%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42029-734038+22+Dec+2014+23%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Java_Authorization_Contract_for_Containers_JACC">
      ⁠</a>18.7. Java Authorization Contract for Containers (JACC)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Authorization_Contract_for_Containers_JACC">
      ⁠</a>18.7.1. About Java Authorization Contract for Containers (JACC)</h2></div></div></div><div class="para">
		Java Authorization Contract for Containers (JACC) is a standard which defines a contract between containers and authorization service providers, which results in the implementation of providers for use by containers. It was defined in JSR-115, which can be found on the Java Community Process website at <a href="http://jcp.org/en/jsr/detail?id=115">http://jcp.org/en/jsr/detail?id=115</a>. It has been part of the core Java Enterprise Edition (Java EE) specification since Java EE version 1.3.
	</div><div class="para">
		JBoss EAP 6 implements support for JACC within the security functionality of the security subsystem.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7687-591801+%5BLatest%5D&amp;comment=Title%3A+About+Java+Authorization+Contract+for+Containers+%28JACC%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7687-591801+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Java_Authorization_Contract_for_Containers_JACC_Security">
      ⁠</a>18.7.2. Configure Java Authorization Contract for Containers (JACC) Security</h2></div></div></div><div class="para">
		To configure Java Authorization Contract for Containers (JACC), you need to configure your security domain with the correct module, and then modify your <code class="filename">jboss-web.xml</code> to include the correct parameters.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Add JACC Support to the Security Domain</div>
			To add JACC support to the security domain, add the <code class="literal">JACC</code> authorization policy to the authorization stack of the security domain, with the <code class="literal">required</code> flag set. The following is an example of a security domain with JACC support. However, the security domain is configured in the Management Console or Management CLI, rather than directly in the XML.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jacc"</span><span xmlns="" class="perl_Others"> cache-type=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"UsersRoles"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;authorization&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;policy-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"JACC"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/authorization&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure a Web Application to Use JACC</div>
			The <code class="filename">jboss-web.xml</code> is located in the <code class="filename">WEB-INF/</code> directory of your deployment, and contains overrides and additional JBoss-specific configuration for the web container. To use your JACC-enabled security domain, you need to include the <code class="sgmltag-element">&lt;security-domain&gt;</code> element, and also set the <code class="sgmltag-element">&lt;use-jboss-authorization&gt;</code> element to <code class="literal">true</code>. The following application is properly configured to use the JACC security domain above.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>jacc<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;use-jboss-authorization&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/use-jboss-authorization&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure an EJB Application to Use JACC</div>
			Configuring EJBs to use a security domain and to use JACC differs from Web Applications. For an EJB, you can declare <em class="firstterm">method permissions</em> on a method or group of methods, in the <code class="filename">ejb-jar.xml</code> descriptor. Within the <code class="sgmltag-element">&lt;ejb-jar&gt;</code> element, any child <code class="sgmltag-element">&lt;method-permission&gt;</code> elements contain information about JACC roles. Refer to the example configuration for more details. The <code class="code">EJBMethodPermission</code> class is part of the Java Enterprise Edition 6 API, and is documented at <a href="http://docs.oracle.com/javaee/6/api/javax/security/jacc/EJBMethodPermission.html">http://docs.oracle.com/javaee/6/api/javax/security/jacc/EJBMethodPermission.html</a>.
		</div><div class="example"><a id="idm140550813644928">
      ⁠</a><p class="title"><strong>Example 18.53. Example JACC Method Permissions in an EJB</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;method-permission&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The employee and temp-employee roles may access any method of the EmployeeService bean <span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>temp-employee<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;method&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EmployeeService<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;method-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/method-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/method&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/method-permission&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
</pre></div></div><div class="para">
		You can also constrain the authentication and authorization mechanisms for an EJB by using a security domain, just as you can do for a web application. Security domains are declared in the <code class="filename">jboss-ejb3.xml</code> descriptor, in the <code class="sgmltag-element">&lt;security&gt;</code> child element. In addition to the security domain, you can also specify the <code class="sgmltag-element">&lt;run-as-principal&gt;</code>, which changes the principal the EJB runs as.
	</div><div class="example"><a id="idm140550807972528">
      ⁠</a><p class="title"><strong>Example 18.54. Example Security Domain Declaration in an EJB</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar&gt;</span> 
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;security&gt;</span>
<span xmlns="" class="line">​</span>  		<span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>  		<span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>myDomain<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>  		<span xmlns="" class="perl_Keyword">&lt;run-as-principal&gt;</span>myPrincipal<span xmlns="" class="perl_Keyword">&lt;/run-as-principal&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;/security&gt;</span>
<span xmlns="" class="line">​</span> 	<span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4933-744942+%5BLatest%5D&amp;comment=Title%3A+Configure+Java+Authorization+Contract+for+Containers+%28JACC%29+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4933-744942+25+Feb+2015+14%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Java_Authentication_SPI_for_Containers_JASPI">
      ⁠</a>18.8. Java Authentication SPI for Containers (JASPI)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Authentication_SPI_for_Containers_JASPI_Security1">
      ⁠</a>18.8.1. About Java Authentication SPI for Containers (JASPI) Security</h2></div></div></div><div class="para">
		Java Authentication SPI for Containers (JASPI or JASPIC) is a pluggable interface for Java applications. It is defined in JSR-196 of the Java Community Process. Refer to <a href="http://www.jcp.org/en/jsr/detail?id=196">http://www.jcp.org/en/jsr/detail?id=196</a> for details about the specification.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+7199-687581+%5BLatest%5D&amp;comment=Title%3A+About+Java+Authentication+SPI+for+Containers+%28JASPI%29+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=7199-687581+23+Jul+2014+08%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Java_Authentication_SPI_for_Containers_JASPI_Security1">
      ⁠</a>18.8.2. Configure Java Authentication SPI for Containers (JASPI) Security</h2></div></div></div><div class="para">
		To authenticate against a JASPI provider, add a <code class="sgmltag-element">&lt;authentication-jaspi&gt;</code> element to your security domain. The configuration is similar to a standard authentication module, but login module elements are enclosed in a <code class="sgmltag-element">&lt;login-module-stack&gt;</code> element. The structure of the configuration is:
	</div><div class="example"><a id="idm140550800271920">
      ⁠</a><p class="title"><strong>Example 18.55. Structure of the <code class="literal">authentication-jaspi</code> element</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;authentication-jaspi&gt;
<span xmlns="" class="line">​</span>	&lt;login-module-stack name=<span xmlns="" class="perl_String">"..."</span>&gt;
<span xmlns="" class="line">​</span>	  &lt;login-module code=<span xmlns="" class="perl_String">"..."</span> flag=<span xmlns="" class="perl_String">"..."</span>&gt;
<span xmlns="" class="line">​</span>	    &lt;module-option name=<span xmlns="" class="perl_String">"..."</span> value=<span xmlns="" class="perl_String">"..."</span>/&gt;
<span xmlns="" class="line">​</span>	  &lt;/login-module&gt;
<span xmlns="" class="line">​</span>	&lt;/login-module-stack&gt;
<span xmlns="" class="line">​</span>	&lt;auth-module code=<span xmlns="" class="perl_String">"..."</span> login-module-stack-ref=<span xmlns="" class="perl_String">"..."</span>&gt;
<span xmlns="" class="line">​</span>	  &lt;module-option name=<span xmlns="" class="perl_String">"..."</span> value=<span xmlns="" class="perl_String">"..."</span>/&gt;
<span xmlns="" class="line">​</span>	&lt;/auth-module&gt;
<span xmlns="" class="line">​</span>&lt;/authentication-jaspi&gt;
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para">
		The login module itself is configured in exactly the same way as a standard authentication module.
	</div><div class="para">
		Because the web-based management console does not expose the configuration of JASPI authentication modules, you need to stop JBoss EAP 6 completely before adding the configuration directly to <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/domain.xml</code> or <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/standalone.xml</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4934-591678+%5BLatest%5D&amp;comment=Title%3A+Configure+Java+Authentication+SPI+for+Containers+%28JASPI%29+Security%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4934-591678+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>