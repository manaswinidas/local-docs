<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 12. Java Transaction API (JTA)</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Java_Transaction_API_JTA">
      ⁠</a>Chapter 12. Java Transaction API (JTA)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Overview">
      ⁠</a>12.1. Overview</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Overview_of_Java_Transactions_API_JTA">
      ⁠</a>12.1.1. Overview of Java Transactions API (JTA)</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			These topics provide a foundational understanding of the Java Transactions API (JTA).
		</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Java_Transactions_API_JTA">Section 12.2.5, “About Java Transactions API (JTA)”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Lifecycle_of_a_JTA_Transaction">Section 12.5.2, “Lifecycle of a JTA Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#JTA_Transaction_Example">Section 12.9.2, “JTA Transaction Example”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4377-591665+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Java+Transactions+API+%28JTA%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4377-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Transaction_Concepts">
      ⁠</a>12.2. Transaction Concepts</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Transactions">
      ⁠</a>12.2.1. About Transactions</h2></div></div></div><div class="para">
		A transaction consists of two or more actions which must either all succeed or all fail. A successful outcome is a commit, and a failed outcome is a roll-back. In a roll-back, each member's state is reverted to its state before the transaction attempted to commit.
	</div><div class="para">
		The typical standard for a well-designed transaction is that it is <em class="firstterm">Atomic, Consistent, Isolated, and Durable (ACID)</em>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4268-591658+%5BLatest%5D&amp;comment=Title%3A+About+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4268-591658+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_ACID_Properties_for_Transactions">
      ⁠</a>12.2.2. About ACID Properties for Transactions</h2></div></div></div><div class="para">
		ACID is an acronym which stands for <code class="literal">Atomicity</code>, <code class="literal">Consistency</code>, <code class="literal">Isolation</code>, and <code class="literal">Durability</code>. This terminology is usually used in the context of databases or transactional operations.
	</div><div class="variablelist"><p class="title"><strong>ACID Definitions</strong></p><dl class="variablelist"><dt><span class="term">Atomicity</span></dt><dd><div class="para">
					For a transaction to be atomic, all transaction members must make the same decision. Either they all commit, or they all roll back. If atomicity is broken, what results is termed a <em class="firstterm">heuristic outcome.</em>
				</div></dd><dt><span class="term">Consistency</span></dt><dd><div class="para">
					Consistency means that data written to the database is guaranteed to be valid data, in terms of the database schema. The database or other data source must always be in a consistent state. One example of an inconsistent state would be a field in which half of the data is written before an operation aborts. A consistent state would be if all the data were written, or the write were rolled back when it could not be completed.
				</div></dd><dt><span class="term">Isolation</span></dt><dd><div class="para">
					Isolation means that data being operated on by a transaction must be locked before modification, to prevent processes outside the scope of the transaction from modifying the data.
				</div></dd><dt><span class="term">Durability</span></dt><dd><div class="para">
					Durability means that in the event of an external failure after transaction members have been instructed to commit, all members will be able to continue committing the transaction when the failure is resolved. This failure may be related to hardware, software, network, or any other involved system.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4271-591658+%5BLatest%5D&amp;comment=Title%3A+About+ACID+Properties+for+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4271-591658+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Transaction_Coordinator_or_Transaction_Manager">
      ⁠</a>12.2.3. About the Transaction Coordinator or Transaction Manager</h2></div></div></div><div class="para">
		The terms <em class="firstterm">Transaction Coordinator</em> and <em class="firstterm">Transaction Manager</em> are mostly interchangeable in terms of transactions with JBoss EAP 6. The term Transaction Coordinator is usually used in the context of distributed transactions.
	</div><div class="para">
		In JTA transactions, The <em class="firstterm">Transaction Manager</em> runs within JBoss EAP 6 and communicates with transaction participants during the <em class="firstterm">two-phase commit</em> protocol.
	</div><div class="para">
		The Transaction Manager tells transaction participants whether to commit or roll back their data, depending on the outcome of other transaction participants. In this way, it ensures that transactions adhere to the ACID standard.
	</div><div class="para">
		In JTS transactions, the Transaction Coordinator manages interactions between transaction managers on different servers.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Transaction_Participants">Section 12.2.4, “About Transaction Participants”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_ACID_Properties_for_Transactions">Section 12.2.2, “About ACID Properties for Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_2-Phase_Commit_Protocol">Section 12.2.9, “About the 2-Phase Commit Protocol”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4269-591658+%5BLatest%5D&amp;comment=Title%3A+About+the+Transaction+Coordinator+or+Transaction+Manager%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4269-591658+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Transaction_Participants">
      ⁠</a>12.2.4. About Transaction Participants</h2></div></div></div><div class="para">
		A transaction participant is any process within a transaction, which has the ability to commit or roll back state. This may be a database or other application. Each participant of a transaction independently decides whether it is able to commit or roll back its state, and only if all participants can commit, does the transaction as a whole succeed. Otherwise, each participant rolls back its state, and the transaction as a whole fails. The Transaction Manager coordinates the commit or rollback operations and determines the outcome of the transaction.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Transactions">Section 12.2.1, “About Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_Transaction_Coordinator_or_Transaction_Manager">Section 12.2.3, “About the Transaction Coordinator or Transaction Manager”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4270-591658+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Participants%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4270-591658+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Transactions_API_JTA">
      ⁠</a>12.2.5. About Java Transactions API (JTA)</h2></div></div></div><div class="para">
		Java Transactions API (JTA) is part of Java Enterprise Edition specification. It is defined in JSR-907.
	</div><div class="para">
		Implementation of JTA is done using Transaction manager, which is covered by project Narayana for JBoss EAP application server. Transaction manager allows application to assign various resources, for example, database or JMS brokers, through a single global transaction. The global transaction is referred as XA transaction. Only resources with XA capabilities can be included in a transaction.
	</div><div class="para">
		In this document, JTA refers to Java Transaction API, this term is used to indicate how the transaction manager processes the transactions. Transaction manager works in JTA transactions mode, the data is shared via memory and transaction context is transferred by remote EJB calls. In JTS mode, the data is shared by sending Common Object Request Broker Architecture (CORBA)messages and transaction context is transferred by IIOP calls. Both modes support distribution of transaction over multiple EAP servers.
	</div><div class="para">
		Annotations is a method for creating and controlling transactions within your code.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_XA_Datasources_and_XA_Transactions">Section 12.2.7, “About XA Datasources and XA Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Distributed_Transactions">Section 12.2.11, “About Distributed Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_the_ORB_for_JTS_Transactions">Section 12.8.2, “Configure the ORB for JTS Transactions”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4300-697973+%5BLatest%5D&amp;comment=Title%3A+About+Java+Transactions+API+%28JTA%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4300-697973+13+Aug+2014+02%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Transaction_Service_JTS">
      ⁠</a>12.2.6. About Java Transaction Service (JTS)</h2></div></div></div><div class="para">
		<em class="firstterm">Java Transaction Service (JTS)</em> is a mapping of the Object Transaction Service (OTS) to Java. Java applications use the JTA API to manage transactions. JTA then interacts with a JTS transaction implementation when the transaction manager is switched to JTS mode. To use special JTS capabilities, for example, nested transactions, you need to manually use the JTS API.
	</div><div class="para">
		JTS works over the IIOP protocol. Transaction managers that use JTS, communicate with each other using a process called an <em class="firstterm">Object Request Broker</em> (ORB), using a communication standard called <em class="firstterm">Common Object Request Broker Architecture</em> (CORBA).
	</div><div class="para">
		Using JTA API from an application standpoint, a JTS transaction behaves in the same way as a JTA transaction.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The implementation of JTS included in JBoss EAP 6 supports distributed transactions. The difference from fully-compliant JTS transactions is interoperability with external third-party ORBs. This feature is unsupported with JBoss EAP 6. Supported configurations distribute transactions across multiple JBoss EAP 6 containers only.
		</div></div></div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_Transaction_Coordinator_or_Transaction_Manager">Section 12.2.3, “About the Transaction Coordinator or Transaction Manager”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4318-759598+%5BLatest%5D&amp;comment=Title%3A+About+Java+Transaction+Service+%28JTS%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4318-759598+28+May+2015+05%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_XA_Datasources_and_XA_Transactions">
      ⁠</a>12.2.7. About XA Datasources and XA Transactions</h2></div></div></div><div class="para">
		An XA datasource is a datasource which can participate in an XA global transaction.
	</div><div class="para">
		An XA transaction is a transaction which can span multiple resources. It involves a coordinating transaction manager, with one or more databases or other transactional resources, all involved in a single global transaction.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4286-591656+%5BLatest%5D&amp;comment=Title%3A+About+XA+Datasources+and+XA+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4286-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_XA_Recovery">
      ⁠</a>12.2.8. About XA Recovery</h2></div></div></div><div class="para">
		The Java Transaction API (JTA) allows distributed transactions across multiple <em class="firstterm">X/Open XA resources</em>. XA stands for <em class="firstterm">Extended Architecture</em> which was developed by the X/Open Group to define a transaction which uses more than one back-end data store. The XA standard describes the interface between a global <em class="firstterm">Transaction Manager (TM)</em> and a local resource manager. XA allows multiple resources, such as application servers, databases, caches, and message queues, to participate in the same transaction, while preserving atomicity of the transaction. Atomicity means that if one of the participants fails to commit its changes, the other participants abort the transaction, and restore their state to the same status as before the transaction occurred.
	</div><div class="para">
		<em class="firstterm">XA Recovery</em> is the process of ensuring that all resources affected by a transaction are updated or rolled back, even if any of the resources are transaction participants crash or become unavailable. Within the scope of JBoss EAP 6, the Transaction subsystem provides the mechanisms for XA Recovery to any XA resources or subsystems which use them, such as XA datasources, JMS message queues, and JCA resource adapters.
	</div><div class="para">
		XA Recovery happens without user intervention. In the event of an XA Recovery failure, errors are recorded in the log output. Contact Red Hat Global Support Services if you need assistance.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4821-591676+%5BLatest%5D&amp;comment=Title%3A+About+XA+Recovery%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4821-591676+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_2-Phase_Commit_Protocol">
      ⁠</a>12.2.9. About the 2-Phase Commit Protocol</h2></div></div></div><div class="para">
		The Two-phase commit protocol (2PC) refers to an algorithm to determine the outcome of a transaction.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Phase 1</div>
			In the first phase, the transaction participants notify the transaction coordinator whether they are able to commit the transaction or must roll back.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Phase 2</div>
			In the second phase, the transaction coordinator makes the decision about whether the overall transaction should commit or roll back. If any one of the participants cannot commit, the transaction must roll back. Otherwise, the transaction can commit. The coordinator directs the transactions about what to do, and they notify the coordinator when they have done it. At that point, the transaction is finished.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4272-591658+%5BLatest%5D&amp;comment=Title%3A+About+the+2-Phase+Commit+Protocol%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4272-591658+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Transaction_Timeouts">
      ⁠</a>12.2.10. About Transaction Timeouts</h2></div></div></div><div class="para">
		In order to preserve atomicity and adhere to the ACID standard for transactions, some parts of a transaction can be long-running. Transaction participants need to lock parts of datasources when they commit, and the transaction manager needs to wait to hear back from each transaction participant before it can direct them all whether to commit or roll back. Hardware or network failures can cause resources to be locked indefinitely.
	</div><div class="para">
		Transaction timeouts can be associated with transactions in order to control their lifecycle. If a timeout threshold passes before the transaction commits or rolls back, the timeout causes the transaction to be rolled back automatically.
	</div><div class="para">
		You can configure default timeout values for the entire transaction subsystem, or you disable default timeout values, and specify timeouts on a per-transaction basis.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4378-591665+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Timeouts%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4378-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Distributed_Transactions">
      ⁠</a>12.2.11. About Distributed Transactions</h2></div></div></div><div class="para">
		A <em class="firstterm">distributed transaction</em>,  is a transaction with participants on multiple JBoss EAP 6 servers. <em class="firstterm">Java Transaction Service (JTS)</em> specification mandates that JTS transactions be able to be distributed across application servers from different vendors (transaction distribution among servers from different vendors is not a supported feature). Java Transaction API (JTA) does not define that but JBoss EAP 6 supports distributed JTA transactions among JBoss EAP6 servers.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			In other app server vendor documentation, you can find that term distributed transaction means XA transaction. In context of JBoss EAP 6 documentation, the distributed transaction refers transactions distributed among several application servers. Transaction which consists from different resources (for example, database resource and jms resource) are referred as XA transactions in this document. For more information, refer <a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Java_Transaction_Service_JTS">Section 12.2.6, “About Java Transaction Service (JTS)”</a> and <a class="xref" href="chap-Java_Transaction_API_JTA.html#About_XA_Datasources_and_XA_Transactions">Section 12.2.7, “About XA Datasources and XA Transactions”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4279-687031+%5BLatest%5D&amp;comment=Title%3A+About+Distributed+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4279-687031+22+Jul+2014+05%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_ORB_Portability_API">
      ⁠</a>12.2.12. About the ORB Portability API</h2></div></div></div><div class="para">
		The Object Request Broker (ORB) is a process which sends and receives messages to transaction participants, coordinators, resources, and other services distributed across multiple application servers. An ORB uses a standardized Interface Description Language (IDL) to communicate and interpret messages. <em class="firstterm">Common Object Request Broker Architecture (CORBA)</em> is the IDL used by the ORB in JBoss EAP 6.
	</div><div class="para">
		The main type of service which uses an ORB is a system of distributed Java Transactions, using the Java Transaction Service (JTS) protocol. Other systems, especially legacy systems, may choose to use an ORB for communication, rather than other mechanisms such as remote Enterprise JavaBeans or JAX-WS or JAX-RS Web Services.
	</div><div class="para">
		The ORB Portability API provides mechanisms to interact with an ORB. This API provides methods for obtaining a reference to the ORB, as well as placing an application into a mode where it listens for incoming connections from an ORB. Some of the methods in the API are not supported by all ORBs. In those cases, an exception is thrown.
	</div><div class="para">
		The API consists of two different classes:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>ORB Portability API Classes</strong></p><ul><li class="listitem"><div class="para">
				<code class="code">com.arjuna.orbportability.orb</code>
			</div></li><li class="listitem"><div class="para">
				<code class="code">com.arjuna.orbportability.oa</code>
			</div></li></ul></div><div class="para">
		Refer to the JBoss EAP 6 Javadocs bundle from the <a href="https://access.redhat.com/jbossnetwork/restricted/listSoftware.html">Red Hat Customer Portal</a> for specific details about the methods and properties included in the ORB Portability API.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4320-763588+%5BLatest%5D&amp;comment=Title%3A+About+the+ORB+Portability+API%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4320-763588+02+Jul+2015+00%3A02+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Nested_Transactions">
      ⁠</a>12.2.13. About Nested Transactions</h2></div></div></div><div class="para">
		Nested transactions are transactions where some participants are also transactions.
	</div><div class="variablelist"><p class="title"><strong>Benefits of Nested Transactions</strong></p><dl class="variablelist"><dt><span class="term">Fault Isolation</span></dt><dd><div class="para">
					If a subtransaction rolls back, perhaps because an object it is using fails, the enclosing transaction does not need to roll back.
				</div></dd><dt><span class="term">Modularity</span></dt><dd><div class="para">
					If a transaction is already associated with a call when a new transaction begins, the new transaction is nested within it. Therefore, if you know that an object requires transactions, you can create them within the object. If the object's methods are invoked without a client transaction, then the object's transactions are top-level. Otherwise, they are nested within the scope of the client's transactions. Likewise, a client does not need to know whether an object is transactional. It can begin its own transaction.
				</div></dd></dl></div><div class="para">
		Nested Transactions are only supported as part of the Java Transaction Service (JTS) API, and not part of the Java Transaction API (JTA). Attempting to nest (non-distributed) JTA transactions results in an exception.
	</div><div class="para">
		Modifying JBoss EAP 6 configuration of transaction subsystem to use JTS does not indicate that nested transaction will be used or activated. If you need to use them, you have to directly use ORB API as JTA API does not provide any method to start the nested transaction.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4287-687477+%5BLatest%5D&amp;comment=Title%3A+About+Nested+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4287-687477+23+Jul+2014+02%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-About_XML_Transaction_Service">
      ⁠</a>12.2.14. About XML Transaction Service</h2></div></div></div><div class="para">
				The XML Transaction Service (XTS) component supports the coordination of private and public Web Services in a business transaction. Using XTS, you can coordinate complex business transactions in a controlled and reliable manner. The XTS API supports a transactional coordination model based on the WS-Coordination, WS-Atomic Transaction, and WS-Business Activity protocols.
			</div><div class="para">
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<a class="xref" href="chap-Java_Transaction_API_JTA.html#Overview_of_Protocols_Used_by_XTS">Section 12.2.14.1, “Overview of Protocols Used by XTS”</a>
						</div></li><li class="listitem"><div class="para">
							<a class="xref" href="chap-Java_Transaction_API_JTA.html#Web_Services-Atomic_Transaction_Process">Section 12.2.14.2, “Web Services-Atomic Transaction Process”</a>
						</div></li><li class="listitem"><div class="para">
							<a class="xref" href="chap-Java_Transaction_API_JTA.html#Web_Services-Business_Activity_Process">Section 12.2.14.3, “Web Services-Business Activity Process”</a>
						</div></li><li class="listitem"><div class="para">
							<a class="xref" href="chap-Java_Transaction_API_JTA.html#Transaction_Bridging_Overview">Section 12.2.14.4, “Transaction Bridging Overview”</a>
						</div></li></ul></div>

			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A45519-781197+%5BLatest%5D&amp;comment=Title%3A+About+XML+Transaction+Service%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Overview_of_Protocols_Used_by_XTS">
      ⁠</a>12.2.14.1. Overview of Protocols Used by XTS</h3></div></div></div><div class="para">
		This topic describes the fundamental concepts associated with the WS-Coordination (WS-C), WS-Atomic Transaction (WS-AT) and WS-Business Activity (WS-BA) protocols, as defined in the specifications of each protocol.
	</div><div class="para">
		The WS-C specification defines a framework that allows different coordination protocols to be plugged in to coordinate work between clients, services, and participants.
	</div><div class="para">
		WS-T protocol comprises the pair of transaction coordination protocols, WS-Atomic Transaction (WS-AT) and WS-Business Activity (WS-BA) , which utilize the coordination framework provided by WS-C. WS-T is developed to unify existing traditional transaction processing systems, allowing them to communicate reliably with one another.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Web_Services-Atomic_Transaction_Process">Section 12.2.14.2, “Web Services-Atomic Transaction Process”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Web_Services-Business_Activity_Process">Section 12.2.14.3, “Web Services-Business Activity Process”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+45515-781200+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Protocols+Used+by+XTS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=45515-781200+09+Feb+2017+06%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Web_Services-Atomic_Transaction_Process">
      ⁠</a>12.2.14.2. Web Services-Atomic Transaction Process</h3></div></div></div><div class="para">
		An atomic transaction (AT) is designed to support short duration interactions where ACID semantics are appropriate. Within the scope of an AT, Web Services typically employ bridging to access XA resources, such as databases and message queues, under the control of the WS-T. When the transaction terminates, the participant propagates the outcome decision of the AT to the XA resources, and the appropriate commit or rollback actions are taken by each participant.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Atomic Transaction Process</div>
			<div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
						To initiate an AT, the client application first locates a WS-C Activation Coordinator Web Service that supports WS-T.
					</div></li><li class="listitem"><div class="para">
						The client sends a WS-C <code class="varname">CreateCoordinationContext</code> message to the service, specifying <a href="http://schemas.xmlsoap.org/ws/2004/10/wsat">http://schemas.xmlsoap.org/ws/2004/10/wsat</a> as its coordination type.
					</div></li><li class="listitem"><div class="para">
						The client receives an appropriate WS-T context from the activation service.
					</div></li><li class="listitem"><div class="para">
						The response to the <code class="varname">CreateCoordinationContext</code> message, the transaction context, has its <code class="varname">CoordinationType</code> element set to the WS-AT namespace, <a href="http://schemas.xmlsoap.org/ws/2004/10/wsat">http://schemas.xmlsoap.org/ws/2004/10/wsat</a>. It also contains a reference to the atomic transaction coordinator endpoint, the WS-C Registration Service, where participants can be enlisted.
					</div></li><li class="listitem"><div class="para">
						The client normally proceeds to invoke Web Services and complete the transaction, either committing all the changes made by the Web Services, or rolling them back. In order to be able to drive this completion, the client must register itself as a participant for the Completion protocol, by sending a register message to the Registration Service whose endpoint was returned in the Coordination Context.
					</div></li><li class="listitem"><div class="para">
						Once registered for completion, the client application then interacts with Web Services to accomplish its business-level work. With each invocation of a business Web Service, the client inserts the transaction context into a SOAP header block, such that each invocation is implicitly scoped by the transaction. The toolkits that support WS-AT aware Web Services provide facilities to correlate contexts found in SOAP header blocks with back-end operations. This ensures that modifications made by the Web Service are done within the scope of the same transaction as the client and subject to commit or rollback by the Transaction Coordinator.
					</div></li><li class="listitem"><div class="para">
						Once all the necessary application work is complete, the client can terminate the transaction, with the intent of making any changes to the service state permanent. The completion participant instructs the coordinator to try to commit or roll back the transaction. When the commit or rollback operation completes, a status is returned to the participant to indicate the outcome of the transaction.
					</div></li></ol></div>

		</div><div class="para">
		For more details, see <a href="http://narayana.io//docs/project/index.html#d0e14935">Web Services-Transaction Documentation</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+45516-781199+%5BLatest%5D&amp;comment=Title%3A+Web+Services-Atomic+Transaction+Process%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=45516-781199+09+Feb+2017+05%3A35+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Web_Services-Business_Activity_Process">
      ⁠</a>12.2.14.3. Web Services-Business Activity Process</h3></div></div></div><div class="para">
		Web Services-Business Activity (WS-BA) defines a protocol for Web Services based applications to enable existing business processing and workflow systems to wrap their proprietary mechanisms and interoperate across implementations and business boundaries.
	</div><div class="para">
		Unlike the WS-AT protocol model, where participants inform the transaction coordinator of their state only when asked, a child activity within a BA can specify its outcome to the coordinator directly, without waiting for a request. A participant may choose to exit the activity or notify the coordinator of a failure at any point. This feature is useful when tasks fail because the notification can be used to modify the goals and drive processing forward, without waiting until the end of the transaction to identify failures.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">WS-BA Process</div>
			<div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
						Services are requested to do work.
					</div></li><li class="listitem"><div class="para">
						Wherever these services have the ability to undo any work, they inform the BA, in case the BA later decides the cancel the work. If the BA suffers a failure. it can instruct the service to execute its undo behavior.
					</div></li></ol></div>

		</div><div class="para">
		The BA protocols employ a compensation-based transaction model. When a participant in a business activity completes its work, it may choose to exit the activity. This choice does not allow any subsequent rollback. Alternatively, the participant can complete its activity, signaling to the coordinator that the work it has done can be compensated if, at some later point, another participant notifies a failure to the coordinator. In this latter case, the coordinator asks each non-exited participant to compensate for the failure, giving them the opportunity to execute whatever compensating action they consider appropriate. If all participants exit or complete without failure, the coordinator notifies each completed participant that the activity has been closed.
	</div><div class="para">
		For more details, see <a href="http://narayana.io//docs/project/index.html#d0e14935">Web Services-Transaction Documentation</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+45517-781201+%5BLatest%5D&amp;comment=Title%3A+Web+Services-Business+Activity+Process%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=45517-781201+09+Feb+2017+06%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Transaction_Bridging_Overview">
      ⁠</a>12.2.14.4. Transaction Bridging Overview</h3></div></div></div><div class="para">
		Transaction Bridging describes the process of linking the Java EE and WS-T domains. The transaction bridge component <code class="varname">txbridge</code> provides bi-directional linkage, such that either type of transaction may encompass business logic designed for use with the other type. The technique used by the bridge is a combination of interposition and protocol mapping.
	</div><div class="para">
		In the transaction bridge, an interposed coordinator is registered into the existing transaction and performs the additional task of protocol mapping; that is, it appears to its parent coordinator to be a resource of its native transaction type, whilst appearing to its children to be a coordinator of their native transaction type, even though these transaction types differ.
	</div><div class="para">
		The transaction bridge resides in the package <code class="varname">org.jboss.jbossts.txbridge</code> and its sub-packages. It consists of two distinct sets of classes, one for bridging in each direction.
	</div><div class="para">
		For more details, see <a href="http://narayana.io//docs/product/index.html#txbridge">Transaction Bridge Documentation</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+45518-781202+%5BLatest%5D&amp;comment=Title%3A+Transaction+Bridging+Overview%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=45518-781202+09+Feb+2017+06%3A22+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Transaction_Optimizations">
      ⁠</a>12.3. Transaction Optimizations</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Overview_of_Transaction_Optimizations">
      ⁠</a>12.3.1. Overview of Transaction Optimizations</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			The Transactions subsystem of JBoss EAP 6 includes several optimizations which you can take advantage of in your applications.
		</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#sect-About_the_LRCO_Optimization_for_Single-phase_Commit_1PC">Section 12.3.2, “About the LRCO Optimization for Single-phase Commit (1PC)”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_Presumed-Abort_Optimization">Section 12.3.3, “About the Presumed-Abort Optimization”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_Read-Only_Optimization">Section 12.3.4, “About the Read-Only Optimization”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4274-591656+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Transaction+Optimizations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4274-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-About_the_LRCO_Optimization_for_Single-phase_Commit_1PC">
      ⁠</a>12.3.2. About the LRCO Optimization for Single-phase Commit (1PC)</h2></div></div></div><div class="para">
				Although the 2-phase commit protocol (2PC) is more commonly encountered with transactions, some situations do not require, or cannot accommodate, both phases. In these cases, you can use the <em class="firstterm">single phase commit (1PC)</em> protocol. One situation where this might happen is when a non-XA-aware datasource needs to participate in the transaction.
			</div><div class="para">
				In these situations, an optimization known as the <em class="firstterm">Last Resource Commit Optimization (LRCO)</em> is employed. The single-phase resource is processed last in the prepare phase of the transaction, and an attempt is made to commit it. If the commit succeeds, the transaction log is written and the remaining resources go through the 2PC. If the last resource fails to commit, the transaction is rolled back.
			</div><div class="para">
				While this protocol allows for most transactions to complete normally, certain types of error can cause an inconsistent transaction outcome. Therefore, use this approach only as a last resort.
			</div><div class="para">
				Where a single local TX datasource is used in a transaction, the LRCO is automatically applied to it.
			</div><div class="para">
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_2-Phase_Commit_Protocol">Section 12.2.9, “About the 2-Phase Commit Protocol”</a>
						</div></li></ul></div>

			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+IDs%3A%0A4273-591656+%5BLatest%5D&amp;comment=Title%3A+About+the+LRCO+Optimization+for+Single-phase+Commit+%281PC%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Commit_Markable_Resource">
      ⁠</a>12.3.2.1. Commit Markable Resource</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			Configuring access to a resource manager via the Commit Markable Resource (CMR) interface ensures that a 1PC resource manager can be reliably enlisted in a 2PC transaction. It is an implementation of the LRCO algorithm, which makes non-XA resource fully recoverable.
		</div><div class="para">
		Previously, adding 1PC resources to a 2PC transaction was achieved via the LRCO method, however there is a window of failure in LRCO. Following the procedure below for adding 1PC resources to a 2PC transaction via the LRCO method:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
				Prepare 2PC
			</div></li><li class="listitem"><div class="para">
				Commit LRCO
			</div></li><li class="listitem"><div class="para">
				Write tx log
			</div></li><li class="listitem"><div class="para">
				Commit 2PC
			</div></li></ol></div><div class="para">
		If the procedure crashes between steps 2 and step 3, you cannot commit the 2PC. CMR eliminates this restriction and allows 1PC to be reliably enlisted in a 2PC transaction.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Use the <code class="literal">exception-sorter</code> parameter in the datasource configuration. You can follow the datasource configuration examples mentioned in the JBoss EAP <em class="citetitle">Administration and Configuration Guide</em>.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Restrictions</div>
			A transaction may contain only one CMR resource.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			You must have a table created for which the following SQL would work: 
<pre class="screen">SELECT xid,actionuid FROM _tableName_ WHERE transactionManagerID IN (String[])
DELETE FROM _tableName_ WHERE xid IN (byte[[]])
INSERT INTO _tableName_ (xid, transactionManagerID, actionuid) VALUES (byte[],String,byte[])</pre>

		</div><div class="example"><a id="idm140550810608128">
      ⁠</a><p class="title"><strong>Example 12.1. Some examples of the SQL query</strong></p><div class="example-contents"><div class="para">
			Sybase: 
<pre class="screen">CREATE TABLE xids (xid varbinary(144), transactionManagerID varchar(64), actionuid varbinary(28))</pre>

		</div><div class="para">
			Oracle: 
<pre class="screen">CREATE TABLE xids (xid RAW(144), transactionManagerID varchar(64), actionuid RAW(28))
CREATE UNIQUE INDEX index_xid ON xids (xid)</pre>

		</div><div class="para">
			IBM: 
<pre class="screen">CREATE TABLE xids (xid VARCHAR(255) for bit data not null, transactionManagerID
varchar(64), actionuid VARCHAR(255) for bit data not null)
CREATE UNIQUE INDEX index_xid ON xids (xid)</pre>

		</div><div class="para">
			SQL Server: 
<pre class="screen">CREATE TABLE xids (xid varbinary(144), transactionManagerID varchar(64), actionuid varbinary(28))
CREATE UNIQUE INDEX index_xid ON xids (xid)</pre>

		</div><div class="para">
			Postgres: 
<pre class="screen">CREATE TABLE xids (xid bytea, transactionManagerID varchar(64), actionuid bytea)
CREATE UNIQUE INDEX index_xid ON xids (xid)</pre>

		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Enabling a resource manager as CMR</div>
			By default, the CMR feature is disabled for datasources. To enable it, you must create or modify the datasource configuration and ensure that the connectible attribute is set to true. An example configuration entry in the datasources section of a server xml configuration file could be as follows:
		</div><div class="para">
		
<pre class="screen">&lt;datasource enabled="true" jndi-name="java:jboss/datasources/ConnectableDS" pool-name="ConnectableDS" jta="true" use-java-context="true" spy="false" use-ccm="true" connectable="true"/&gt;</pre>

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			This feature is not applicable to XA datasources.
		</div></div></div><div class="para">
		You can also enable a resource manager as CMR using CLI as follows: 
<pre class="screen">/subsystem=datasources/data-source=ConnectableDS:add(enabled="true", jndi-name="java:jboss/datasources/ConnectableDS", jta="true", use-java-context="true", spy="false", use-ccm="true", connectable="true", connection-url="validConnectionURL", exception-sorter="org.jboss.jca.adapters.jdbc.extensions.mssql.MSSQLExceptionSorter", driver-name="h2")</pre>

	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Updating an existing resource to use the new CMR feature</div>
			If you only need to update an existing resource to use the new CMR feature, then simply modifiy the connectable attribute: 
<pre class="screen">/subsystem=datasources/data-source=ConnectableDS:write-attribute(name=connectable,value=true)</pre>

		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Identifying CMR capable datasources</div>
			The transaction subsystem identifies the datasources that are CMR capable through an entry to the transaction subsystem config section as shown below:
		</div><pre class="screen">&lt;subsystem xmlns="urn:jboss:domain:transactions:3.0"&gt;
    ...
    &lt;commit-markable-resources&gt;
        &lt;commit-markable-resource jndi-name="java:jboss/datasources/ConnectableDS"&gt;
            &lt;xid-location name="xids" batch-size="100" immediate-cleanup="false"/&gt;
        &lt;/commit-markable-resource&gt;
        ...
    &lt;/commit-markable-resources&gt;
&lt;/subsystem&gt;</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			You must restart the server after adding the CMR.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+30533-769448+%5BLatest%5D&amp;comment=Title%3A+Commit+Markable+Resource%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30533-769448+01+Sep+2015+06%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Presumed-Abort_Optimization">
      ⁠</a>12.3.3. About the Presumed-Abort Optimization</h2></div></div></div><div class="para">
		If a transaction is going to roll back, it can record this information locally and notify all enlisted participants. This notification is only a courtesy, and has no effect on the transaction outcome. After all participants have been contacted, the information about the transaction can be removed.
	</div><div class="para">
		If a subsequent request for the status of the transaction occurs there will be no information available. In this case, the requester assumes that the transaction has aborted and rolled back. This <em class="firstterm">presumed-abort</em> optimization means that no information about participants needs to be made persistent until the transaction has decided to commit, since any failure prior to this point will be assumed to be an abort of the transaction.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4275-591656+%5BLatest%5D&amp;comment=Title%3A+About+the+Presumed-Abort+Optimization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4275-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Read-Only_Optimization">
      ⁠</a>12.3.4. About the Read-Only Optimization</h2></div></div></div><div class="para">
		When a participant is asked to prepare, it can indicate to the coordinator that it has not modified any data during the transaction. Such a participant does not need to be informed about the outcome of the transaction, since the fate of the participant has no affect on the transaction. This <em class="firstterm">read-only</em> participant can be omitted from the second phase of the commit protocol.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4277-591656+%5BLatest%5D&amp;comment=Title%3A+About+the+Read-Only+Optimization%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4277-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Transaction_Outcomes">
      ⁠</a>12.4. Transaction Outcomes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Transaction_Outcomes">
      ⁠</a>12.4.1. About Transaction Outcomes</h2></div></div></div><div class="para">
		There are three possible outcomes for a transaction.
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Roll-back</span></dt><dd><div class="para">
					If any transaction participant cannot commit, or the transaction coordinator cannot direct participants to commit, the transaction is rolled back. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Transaction_Roll-Back">Section 12.4.3, “About Transaction Roll-Back”</a> for more information.
				</div></dd><dt><span class="term">Commit</span></dt><dd><div class="para">
					If every transaction participant can commit, the transaction coordinator directs them to do so. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Transaction_Commit">Section 12.4.2, “About Transaction Commit”</a> for more information.
				</div></dd><dt><span class="term">Heuristic outcome</span></dt><dd><div class="para">
					If some transaction participants commit and others roll back. it is termed a heuristic outcome. Heuristic outcomes require human intervention. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Heuristic_Outcomes">Section 12.4.4, “About Heuristic Outcomes”</a> for more information.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4283-591656+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Outcomes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4283-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Transaction_Commit">
      ⁠</a>12.4.2. About Transaction Commit</h2></div></div></div><div class="para">
		When a transaction participant commits, it makes its new state durable. The new state is created by the participant doing the work involved in the transaction. The most common example is when a transaction member writes records to a database.
	</div><div class="para">
		After commit, information about the transaction is removed from the transaction coordinator, and the newly-written state is now the durable state.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4282-591656+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Commit%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4282-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Transaction_Roll-Back">
      ⁠</a>12.4.3. About Transaction Roll-Back</h2></div></div></div><div class="para">
		A transaction participant rolls back by restoring its state to reflect the state before the transaction began. After a roll-back, the state is the same as if the transaction had never been started.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4281-591656+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Roll-Back%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4281-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Heuristic_Outcomes">
      ⁠</a>12.4.4. About Heuristic Outcomes</h2></div></div></div><div class="para">
		A heuristic outcome, or non-atomic outcome, is a transaction anomaly. It refers to a situation where some transaction participants committed their state, and others rolled back. A heuristic outcome causes state to be inconsistent.
	</div><div class="para">
		Heuristic outcomes typically happen during the second phase of the 2-phase commit (2PC) protocol. They are often caused by failures to the underlying hardware or communications subsystems of the underlying servers.
	</div><div class="para">
		There are four different types of heuristic outcome.
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Heuristic rollback</span></dt><dd><div class="para">
					The commit operation failed because some or all of the participants unilaterally rolled back the transaction.
				</div></dd><dt><span class="term">Heuristic commit</span></dt><dd><div class="para">
					An attempted rollback operation failed because all of the participants unilaterally committed. This may happen if, for example, the coordinator is able to successfully prepare the transaction but then decides to roll it back because of a failure on its side, such as a failure to update its log. In the interim, the participants may decide to commit.
				</div></dd><dt><span class="term">Heuristic mixed</span></dt><dd><div class="para">
					Some participants committed and others rolled back.
				</div></dd><dt><span class="term">Heuristic hazard</span></dt><dd><div class="para">
					The outcome of some of the updates is unknown. For the ones that are known, they have either all committed or all rolled back.
				</div></dd></dl></div><div class="para">
		Heuristic outcomes can cause loss of integrity to the system, and usually require human intervention to resolve. Do not write code which relies on them.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_2-Phase_Commit_Protocol">Section 12.2.9, “About the 2-Phase Commit Protocol”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4285-591656+%5BLatest%5D&amp;comment=Title%3A+About+Heuristic+Outcomes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4285-591656+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="JBoss_Transactions_Errors_and_Exceptions1">
      ⁠</a>12.4.5. JBoss Transactions Errors and Exceptions</h2></div></div></div><div class="para">
		For details about exceptions thrown by methods of the <code class="classname">UserTransaction</code> class, see the <em class="citetitle">UserTransaction API</em> specification at <a href="http://docs.oracle.com/javaee/6/api/javax/transaction/UserTransaction.html">http://docs.oracle.com/javaee/6/api/javax/transaction/UserTransaction.html</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4299-689191+%5BLatest%5D&amp;comment=Title%3A+JBoss+Transactions+Errors+and+Exceptions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4299-689191+30+Jul+2014+02%3A47+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Overview_of_JTA_Transactions">
      ⁠</a>12.5. Overview of JTA Transactions</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Transactions_API_JTA1">
      ⁠</a>12.5.1. About Java Transactions API (JTA)</h2></div></div></div><div class="para">
		Java Transactions API (JTA) is part of Java Enterprise Edition specification. It is defined in JSR-907.
	</div><div class="para">
		Implementation of JTA is done using Transaction manager, which is covered by project Narayana for JBoss EAP application server. Transaction manager allows application to assign various resources, for example, database or JMS brokers, through a single global transaction. The global transaction is referred as XA transaction. Only resources with XA capabilities can be included in a transaction.
	</div><div class="para">
		In this document, JTA refers to Java Transaction API, this term is used to indicate how the transaction manager processes the transactions. Transaction manager works in JTA transactions mode, the data is shared via memory and transaction context is transferred by remote EJB calls. In JTS mode, the data is shared by sending Common Object Request Broker Architecture (CORBA)messages and transaction context is transferred by IIOP calls. Both modes support distribution of transaction over multiple EAP servers.
	</div><div class="para">
		Annotations is a method for creating and controlling transactions within your code.
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_XA_Datasources_and_XA_Transactions">Section 12.2.7, “About XA Datasources and XA Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Distributed_Transactions">Section 12.2.11, “About Distributed Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_the_ORB_for_JTS_Transactions">Section 12.8.2, “Configure the ORB for JTS Transactions”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4300-697973+%5BLatest%5D&amp;comment=Title%3A+About+Java+Transactions+API+%28JTA%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4300-697973+13+Aug+2014+02%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Lifecycle_of_a_JTA_Transaction">
      ⁠</a>12.5.2. Lifecycle of a JTA Transaction</h2></div></div></div><div class="para">
		When a resource asks to participate in a transaction, a chain of events is set in motion. The <em class="firstterm">Transaction Manager</em> is a process that lives within the application server and manages transactions. <em class="firstterm">Transaction participants</em> are objects which participate in a transaction. <em class="firstterm">Resources</em> are datasources, JMS connection factories, or other JCA connections.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Your application starts a new transaction</strong></p><div class="para">
				To begin a transaction, your application obtains an instance of class <code class="classname">UserTransaction</code> from JNDI or, if it is an EJB, from an annotation. The <code class="classname">UserTransaction</code> interface includes methods for beginning, committing, and rolling back top-level transactions. Newly-created transactions are automatically associated with their invoking thread. Nested transactions are not supported in JTA, so all transactions are top-level transactions.
			</div><div class="para">
				Calling <code class="classname">UserTransaction</code>.<code class="methodname">begin()</code> using annotations starts a transaction when an EJB method is called (driven by TransactionAttribute rules). Any resource that is used after that point is associated with the transaction. If more than one resource is enlisted, your transaction becomes an XA transaction, and participates in the two-phase commit protocol at commit time.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The <code class="classname">UserTransaction</code> object is used only for BMT transactions. In CMT, the UserTransaction object is not permitted.
				</div></div></div></li><li class="step"><p class="title"><strong>Your application modifies its state.</strong></p><div class="para">
				In the next step, your application performs its work and makes changes to its state.
			</div></li><li class="step"><p class="title"><strong>Your application decides to commit or roll back</strong></p><div class="para">
				When your application has finished changing its state, it decides whether to commit or roll back. It calls the appropriate method, either <code class="classname">UserTransaction</code>.<code class="methodname">commit()</code> or <code class="classname">UserTransaction</code>.<code class="methodname">rollback()</code>. 
			</div></li><li class="step"><p class="title"><strong>The transaction manager removes the transaction from its records.</strong></p><div class="para">
				After the commit or rollback completes, the transaction manager cleans up its records and removes information about your transaction from the transaction log.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Failure recovery</div>
			Failure recovery happens automatically. If a resource, transaction participant, or the application server become unavailable, the Transaction Manager handles recovery when the underlying failure is resolved and the resource is available again.
		</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Transactions">Section 12.2.1, “About Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_Transaction_Coordinator_or_Transaction_Manager">Section 12.2.3, “About the Transaction Coordinator or Transaction Manager”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Transaction_Participants">Section 12.2.4, “About Transaction Participants”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_the_2-Phase_Commit_Protocol">Section 12.2.9, “About the 2-Phase Commit Protocol”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#About_XA_Datasources_and_XA_Transactions">Section 12.2.7, “About XA Datasources and XA Transactions”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4301-759692+%5BLatest%5D&amp;comment=Title%3A+Lifecycle+of+a+JTA+Transaction%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4301-759692+29+May+2015+01%3A09+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Transaction_Subsystem_Configuration">
      ⁠</a>12.6. Transaction Subsystem Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Transactions_Configuration_Overview1">
      ⁠</a>12.6.1. Transactions Configuration Overview</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			The following procedures show you how to configure the transactions subsystem of JBoss EAP 6.
		</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_Your_Datasource_to_Use_JTA_Transactions1">Section 12.6.2.3, “Configure Your Datasource to Use JTA Transaction API”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_an_XA_Datasource">Section 12.6.2.1, “Configure an XA Datasource”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_the_Transaction_Manager1">Section 12.7.8.2, “Configure the Transaction Manager”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_Logging_for_the_Transaction_Subsystem1">Section 12.6.3.2, “Configure Logging for the Transaction Subsystem”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4374-591665+%5BLatest%5D&amp;comment=Title%3A+Transactions+Configuration+Overview%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4374-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Transactional_Datasource_Configuration">
      ⁠</a>12.6.2. Transactional Datasource Configuration</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_an_XA_Datasource">
      ⁠</a>12.6.2.1. Configure an XA Datasource</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			Log into the Management Console.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Add a new datasource.</strong></p><div class="para">
				Add a new datasource to JBoss EAP 6. Click the <span class="guilabel"><strong>XA Datasource</strong></span> tab at the top.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Refer to <em class="citetitle">Create an XA Datasource with the Management Interfaces</em> section of the <em class="citetitle">Administration and Configuration Guide</em> on the Red Hat Customer Portal for information on how to add a new datasource to JBoss EAP 6.
				</div></div></div></li><li class="step"><p class="title"><strong>Configure additional properties as appropriate.</strong></p><div class="para">
				All datasource parameters are listed in <a class="xref" href="chap-Java_Transaction_API_JTA.html#Datasource_Parameters1">Section 12.6.2.5, “Datasource Parameters”</a>.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your XA Datasource is configured and ready to use.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4303-765631+%5BLatest%5D&amp;comment=Title%3A+Configure+an+XA+Datasource%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4303-765631+22+Jul+2015+01%3A18+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Create_a_Non-XA_Datasource_with_the_Management_Interfaces">
      ⁠</a>12.6.2.2. Create a Non-XA Datasource with the Management Interfaces</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to create a non-XA datasource, using either the Management Console or the Management CLI.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				The JBoss EAP 6 server must be running.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Oracle Datasources</strong></p></div><div class="admonition"><div class="para">
			Prior to version 10.2 of the Oracle datasource, the &lt;no-tx-separate-pools/&gt; parameter was required, as mixing non-transactional and transactional connections would result in an error. This parameter may no longer be required for certain applications.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Domain Mode</strong></p></div><div class="admonition"><div class="para">
			To prevent issues such as duplication of driver listing, selected driver not available in a profile, or driver not displayed if a server for the profile is not running, in JBoss EAP 6.4 onwards, only JDBC drivers that are installed as modules and correctly referenced from profiles are detectable while creating a datasource using the Management Console in domain mode.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550809872960">
      ⁠</a><p class="title"><strong>Procedure 12.1. Create a Datasource using either the Management CLI or the Management Console</strong></p><ul><li class="step"><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Management CLI</strong></p><ol class="substeps a"><li class="step"><div class="para">
								Launch the CLI tool and connect to your server.
							</div></li><li class="step"><div class="para">
								Run the following Management CLI command to create a non-XA datasource, configuring the variables as appropriate:
							</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									The value for <em class="replaceable">DRIVER_NAME</em> depends on the number of classes listed in the <code class="filename">/META-INF/services/java.sql.Driver</code> file located in the JDBC driver JAR. If there is only one class, the value is the name of the JAR. If there are multiple classes, the value is the name of the JAR + driverClassName + "_" + majorVersion +"_" + minorVersion. Failure to do so will result in the following error being logged:
								</div><pre class="screen">JBAS014775:    New missing/unsatisfied dependencies</pre><div class="para">
									For example, the <em class="replaceable">DRIVER_NAME</em> value required for the MySQL 5.1.31 driver, is <code class="literal">mysql-connector-java-5.1.31-bin.jarcom.mysql.jdbc.Driver_5_1</code>.
								</div></div></div><pre class="screen">data-source add --name=<em class="replaceable">DATASOURCE_NAME</em> --jndi-name=<em class="replaceable">JNDI_NAME</em> --driver-name=<em class="replaceable">DRIVER_NAME</em>  --connection-url=<em class="replaceable">CONNECTION_URL</em></pre></li><li class="step"><div class="para">
								Enable the datasource:
							</div><pre class="screen">data-source enable --name=<em class="replaceable">DATASOURCE_NAME</em></pre></li></ol></li>
				 <li class="step"><p class="title"><strong>Management Console</strong></p><ol class="substeps a"><li class="step"><div class="para">
								Login to the Management Console.
							</div></li><li class="step"><p class="title"><strong>Navigate to the <span class="guilabel"><strong>Datasources</strong></span> panel in the Management Console</strong></p><ol class="substeps i"><li class="step"><div class="para">
										Select the <span class="guilabel"><strong>Configuration</strong></span> tab from the top of the console.
									</div></li><li class="step"><div class="para">
										For Domain mode only, select a profile from the drop-down box in the top left.
									</div></li><li class="step"><div class="para">
										Expand the <span class="guimenu"><strong>Subsystems</strong></span> menu on the left of the console, then expand the <span class="guimenu"><strong>Connector</strong></span> menu.
									</div></li><li class="step"><div class="para">
										Select <span class="guimenuitem"><strong>Datasources</strong></span> from the menu on the left of the console.
									</div></li></ol></li><li class="step"><p class="title"><strong>Create a new datasource</strong></p><ol class="substeps i"><li class="step"><div class="para">
										Click <span class="guibutton"><strong>Add</strong></span> at the top of the <span class="guilabel"><strong>Datasources</strong></span> panel.
									</div></li><li class="step"><div class="para">
										Enter the new datasource attributes in the <span class="guilabel"><strong>Create Datasource</strong></span> wizard and proceed with the <span class="guibutton"><strong>Next</strong></span> button.
									</div></li><li class="step"><div class="para">
										Enter the JDBC driver details in the <span class="guilabel"><strong>Create Datasource</strong></span> wizard and click <span class="guibutton"><strong>Next</strong></span> to continue.
									</div></li><li class="step"><div class="para">
										Enter the connection settings in the <span class="guilabel"><strong>Create Datasource</strong></span> wizard.
									</div></li><li class="step"><div class="para">
										Click the <span class="guibutton"><strong>Test Connection</strong></span> button to test the connection to the datasource and verify the settings are correct.
									</div></li><li class="step"><div class="para">
										Click <span class="guibutton"><strong>Done</strong></span> to finish
									</div></li></ol></li></ol></li>

			</ul></li></ul></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The non-XA datasource has been added to the server. It is now visible in either the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> file, as well as the management interfaces.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4805-762760+%5BLatest%5D&amp;comment=Title%3A+Create+a+Non-XA+Datasource+with+the+Management+Interfaces%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4805-762760+24+Jun+2015+00%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_Your_Datasource_to_Use_JTA_Transactions1">
      ⁠</a>12.6.2.3. Configure Your Datasource to Use JTA Transaction API</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This task shows you how to enable Java Transaction API (JTA) on your datasource.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			You must meet the following conditions before continuing with this task:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Your database or other resource must support Java Transaction API. If in doubt, consult the documentation for your database or other resource.
			</div></li><li class="listitem"><div class="para">
				Create a datasource. Refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#Create_a_Non-XA_Datasource_with_the_Management_Interfaces">Section 12.6.2.2, “Create a Non-XA Datasource with the Management Interfaces”</a>.
			</div></li><li class="listitem"><div class="para">
				Stop JBoss EAP 6.
			</div></li><li class="listitem"><div class="para">
				Have access to edit the configuration files directly, in a text editor.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550807851312">
      ⁠</a><p class="title"><strong>Procedure 12.2. Configure the Datasource to use Java Transaction API</strong></p><ol class="1"><li class="step"><p class="title"><strong>Open the configuration file in a text editor.</strong></p><div class="para">
				Depending on whether you run JBoss EAP 6 in a managed domain or standalone server, your configuration file will be in a different location.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Managed domain</strong></p><div class="para">
						The default configuration file for a managed domain is in <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/domain.xml</code> for Red Hat Enterprise Linux, and <code class="filename"><em class="replaceable">EAP_HOME\domain\configuration\domain.xml</em></code> for Microsoft Windows Server.
					</div></li>
				 <li class="step"><p class="title"><strong>Standalone server</strong></p><div class="para">
						The default configuration file for a standalone server is in <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/standalone.xml</code> for Red Hat Enterprise Linux, and <code class="filename"><em class="replaceable">EAP_HOME\standalone\configuration\standalone.xml</em></code> for Microsoft Windows Server.
					</div></li>

			</ul></li><li class="step"><p class="title"><strong>Locate the <code class="literal">&lt;datasource&gt;</code> tag that corresponds to your datasource.</strong></p><div class="para">
				The datasource will have the <code class="literal">jndi-name</code> attribute set to the one you specified when you created it. For example, the ExampleDS datasource looks like this:
			</div><pre class="screen">&lt;datasource jndi-name="java:jboss/datasources/ExampleDS" pool-name="H2DS" enabled="true" jta="true" use-java-context="true" use-ccm="true"&gt;</pre></li><li class="step"><p class="title"><strong>Set the <code class="literal">jta</code> attribute to <code class="literal">true</code>.</strong></p><div class="para">
				Add the following to the contents of your <code class="literal">&lt;datasource&gt;</code> tag, as they appear in the previous step: <code class="literal">jta="true"</code>
			</div><div class="para">
				Unless you have a specific use case (such as defining a read only datasource) Red Hat discourages overriding the default value of <code class="literal">jta=true</code>. This setting indicates that the datasource will honor the Java Transaction API and allows better tracking of connections by the JCA implementation.
			</div></li><li class="step"><p class="title"><strong>Save the configuration file.</strong></p><div class="para">
				Save the configuration file and exit the text editor.
			</div></li><li class="step"><p class="title"><strong>Start JBoss EAP 6.</strong></p><div class="para">
				Relaunch the JBoss EAP 6 server.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result:</div>
			JBoss EAP 6 starts, and your datasource is configured to use Java Transaction API.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4295-741398+%5BLatest%5D&amp;comment=Title%3A+Configure+Your+Datasource+to+Use+JTA+Transaction+API%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4295-741398+04+Feb+2015+22%3A40+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_Database_Connection_Validation_Settings">
      ⁠</a>12.6.2.4. Configure Database Connection Validation Settings</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			Database maintenance, network problems, or other outage events may cause JBoss EAP 6 to lose the connection to the database. You enable database connection validation using the <code class="literal">&lt;validation&gt;</code> element within the <code class="literal">&lt;datasource&gt;</code> section of the server configuration file. Follow the steps below to configure the datasource settings to enable database connection validation in JBoss EAP 6.
		</div><div class="para">

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550816380784">
      ⁠</a><p class="title"><strong>Procedure 12.3. Configure Database Connection Validation Settings</strong></p><ol class="1"><li class="step"><p class="title"><strong>Choose a Validation Method</strong></p><div class="para">
				Select one of the following validation methods.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>&lt;validate-on-match&gt;true&lt;/validate-on-match&gt;</strong></p><div class="para">
						When the <code class="literal">&lt;validate-on-match&gt;</code> option is set to <code class="literal">true</code>, the database connection is validated every time it is checked out from the connection pool using the validation mechanism specified in the next step.
					</div><div class="para">
						If a connection is not valid, a warning is written to the log and it retrieves the next connection in the pool. This process continues until a valid connection is found. If you prefer not to cycle through every connection in the pool, you can use the <code class="literal">&lt;use-fast-fail&gt;</code> option. If a valid connection is not found in the pool, a new connection is created. If the connection creation fails, an exception is returned to the requesting application.
					</div><div class="para">
						This setting results in the quickest recovery but creates the highest load on the database. However, this is the safest selection if the minimal performance hit is not a concern.
					</div></li>
				 <li class="step"><p class="title"><strong>&lt;background-validation&gt;true&lt;/background-validation&gt;</strong></p><div class="para">
						When the <code class="literal">&lt;background-validation&gt;</code> option is set to <code class="literal">true</code>, it is used in combination with the <code class="literal">&lt;background-validation-millis&gt;</code> value to determine how often background validation runs. The default value for the <code class="literal">&lt;background-validation-millis&gt;</code> parameter is 0 milliseconds, meaning it is disabled by default. This value should not be set to the same value as your <code class="literal">&lt;idle-timeout-minutes&gt;</code> setting.
					</div><div class="para">
						It is a balancing act to determine the optimum <code class="literal">&lt;background-validation-millis&gt;</code> value for a particular system. The lower the value, the more frequently the pool is validated and the sooner invalid connections are removed from the pool. However, lower values take more database resources. Higher values result in less frequent connection validation checks and use less database resources, but dead connections are undetected for longer periods of time.
					</div></li>

			</ul><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					If the <code class="literal">&lt;validate-on-match&gt;</code> option is set to <code class="literal">true</code>, the <code class="literal">&lt;background-validation&gt;</code> option should be set to <code class="literal">false</code>. The reverse is also true. If the <code class="literal">&lt;background-validation&gt;</code> option is set to <code class="literal">true</code>, the <code class="literal">&lt;validate-on-match&gt;</code> option should be set to <code class="literal">false</code>.
				</div></div></div></li><li class="step"><p class="title"><strong>Choose a Validation Mechanism</strong></p><div class="para">
				Select one of the following validation mechanisms.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Specify a &lt;valid-connection-checker&gt; Class Name</strong></p><div class="para">
						This is the preferred mechanism as it optimized for the particular RDBMS in use. JBoss EAP 6 provides the following connection checkers: 
						<div class="itemizedlist"><ul><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.db2.DB2ValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.mssql.MSSQLValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLReplicationValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.novendor.JDBC4ValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.novendor.NullValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.oracle.OracleValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.postgres.PostgreSQLValidConnectionChecker
								</div></li><li class="listitem"><div class="para">
									org.jboss.jca.adapters.jdbc.extensions.sybase.SybaseValidConnectionChecker
								</div></li></ul></div>

					</div></li>
				 <li class="step"><p class="title"><strong>Specify SQL for &lt;check-valid-connection-sql&gt;</strong></p><div class="para">
						You provide the SQL statement used to validate the connection.
					</div><div class="para">
						The following is an example of how you might specify a SQL statement to validate a connection for Oracle: 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;check-valid-connection-sql&gt;</span>select 1 from dual<span xmlns="" class="perl_Keyword">&lt;/check-valid-connection-sql&gt;</span></pre>
						 For MySQL or PostgreSQL, you might specify the following SQL statement: 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;check-valid-connection-sql&gt;</span>select 1<span xmlns="" class="perl_Keyword">&lt;/check-valid-connection-sql&gt;</span></pre>

					</div></li>

			</ul></li><li class="step"><p class="title"><strong>Set the &lt;exception-sorter&gt; Class Name</strong></p><div class="para">
				When an exception is marked as fatal, the connection is closed immediately, even if the connection is participating in a transaction. Use the exception sorter class option to properly detect and clean up after fatal connection exceptions. JBoss EAP 6 provides the following exception sorters: 
				<div class="itemizedlist"><ul><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.db2.DB2ExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.informix.InformixExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.novendor.NullExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.oracle.OracleExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.postgres.PostgreSQLExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.sybase.SybaseExceptionSorter
						</div></li><li class="listitem"><div class="para">
							org.jboss.jca.adapters.jdbc.extensions.mssql.MSSQLExceptionSorter
						</div></li></ul></div>

			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+41672-769442+%5BLatest%5D&amp;comment=Title%3A+Configure+Database+Connection+Validation+Settings%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41672-769442+01+Sep+2015+05%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Datasource_Parameters1">
      ⁠</a>12.6.2.5. Datasource Parameters</h3></div></div></div><div class="table"><a id="idm140550719940112">
      ⁠</a><p class="title"><strong>Table 12.1. Datasource parameters common to non-XA and XA datasources</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Datasource parameters common to non-XA and XA datasources"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> jndi-name </td><td style="text-align: left"> The unique JNDI name for the datasource. </td></tr><tr><td style="text-align: left"> pool-name </td><td style="text-align: left"> The name of the management pool for the datasource. </td></tr><tr><td style="text-align: left"> enabled </td><td style="text-align: left"> Whether or not the datasource is enabled. </td></tr><tr><td style="text-align: left"> use-java-context </td><td style="text-align: left"> <div class="para">
						Whether to bind the datasource to global JNDI.
					</div>
					 </td></tr><tr><td style="text-align: left"> spy </td><td style="text-align: left"> <div class="para">
						Enable <code class="literal">spy</code> functionality on the JDBC layer. This logs all JDBC traffic to the datasource. Note that the logging category <code class="literal">jboss.jdbc.spy</code> must also be set to the log level <code class="literal">DEBUG</code> in the logging subsystem.
					</div>
					 </td></tr><tr><td style="text-align: left"> use-ccm </td><td style="text-align: left"> Enable the cached connection manager. </td></tr><tr><td style="text-align: left"> new-connection-sql </td><td style="text-align: left"> A SQL statement which executes when the connection is added to the connection pool. </td></tr><tr><td style="text-align: left"> transaction-isolation </td><td style="text-align: left"> <div class="para">
						One of the following:
					</div>
					 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
								TRANSACTION_READ_UNCOMMITTED
							</div></li><li class="listitem"><div class="para">
								TRANSACTION_READ_COMMITTED
							</div></li><li class="listitem"><div class="para">
								TRANSACTION_REPEATABLE_READ
							</div></li><li class="listitem"><div class="para">
								TRANSACTION_SERIALIZABLE
							</div></li><li class="listitem"><div class="para">
								TRANSACTION_NONE
							</div></li></ul></div>
					 </td></tr><tr><td style="text-align: left"> url-selector-strategy-class-name </td><td style="text-align: left"> A class that implements interface <code class="code">org.jboss.jca.adapters.jdbc.URLSelectorStrategy</code>. </td></tr><tr><td style="text-align: left"> security </td><td style="text-align: left"> <div class="para">
						Contains child elements which are security settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-security">Table 12.6, “Security parameters”</a>.
					</div>
					 </td></tr><tr><td style="text-align: left"> validation </td><td style="text-align: left"> <div class="para">
						Contains child elements which are validation settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-validation">Table 12.7, “Validation parameters”</a>.
					</div>
					 </td></tr><tr><td style="text-align: left"> timeout </td><td style="text-align: left"> <div class="para">
						Contains child elements which are timeout settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-timeout">Table 12.8, “Timeout parameters”</a>.
					</div>
					 </td></tr><tr><td style="text-align: left"> statement </td><td style="text-align: left"> <div class="para">
						Contains child elements which are statement settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-statement">Table 12.9, “Statement parameters”</a>.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm140550796878400">
      ⁠</a><p class="title"><strong>Table 12.2. Non-XA datasource parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Non-XA datasource parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> jta </td><td style="text-align: left"> Enable JTA integration for non-XA datasources. Does not apply to XA datasources. </td></tr><tr><td style="text-align: left"> connection-url </td><td style="text-align: left"> The JDBC driver connection URL. </td></tr><tr><td style="text-align: left"> driver-class </td><td style="text-align: left"> The fully-qualified name of the JDBC driver class. </td></tr><tr><td style="text-align: left"> connection-property </td><td style="text-align: left"> <div class="para">
						Arbitrary connection properties passed to the method <code class="code">Driver.connect(url,props)</code>. Each connection-property specifies a string name/value pair. The property name comes from the name, and the value comes from the element content.
					</div>
					 </td></tr><tr><td style="text-align: left"> pool </td><td style="text-align: left"> <div class="para">
						Contains child elements which are pooling settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-pooling">Table 12.4, “Pool parameters common to non-XA and XA datasources”</a>.
					</div>
					 </td></tr><tr><td style="text-align: left"> url-delimiter </td><td style="text-align: left"> <div class="para">
						The delimiter for URLs in a connection-url for High Availability (HA) clustered databases.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm140550798629584">
      ⁠</a><p class="title"><strong>Table 12.3. XA datasource parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="XA datasource parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> xa-datasource-property </td><td style="text-align: left"> <div class="para">
						A property to assign to implementation class <code class="classname">XADataSource</code>. Specified by <em class="replaceable">name</em>=<em class="replaceable">value</em>. If a setter method exists, in the format <code class="code">set<em class="replaceable">Name</em></code>, the property is set by calling a setter method in the format of <code class="code">set<em class="replaceable">Name</em>(<em class="replaceable">value</em>)</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> xa-datasource-class </td><td style="text-align: left"> <div class="para">
						The fully-qualified name of the implementation class <code class="code">javax.sql.XADataSource</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> driver </td><td style="text-align: left"> <div class="para">
						A unique reference to the class loader module which contains the JDBC driver. The accepted format is <em class="replaceable">driverName</em>#<em class="replaceable">majorVersion</em>.<em class="replaceable">minorVersion</em>.
					</div>
					 </td></tr><tr><td style="text-align: left"> xa-pool </td><td style="text-align: left"> <div class="para">
						Contains child elements which are pooling settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-pooling">Table 12.4, “Pool parameters common to non-XA and XA datasources”</a> and <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-xa-pooling">Table 12.5, “XA pool parameters”</a>.
					</div>
					 </td></tr><tr><td style="text-align: left"> recovery </td><td style="text-align: left"> <div class="para">
						Contains child elements which are recovery settings. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Topic2772-recovery">Table 12.10, “Recovery parameters”</a>.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-pooling">
      ⁠</a><p class="title"><strong>Table 12.4. Pool parameters common to non-XA and XA datasources</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Pool parameters common to non-XA and XA datasources"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> min-pool-size </td><td style="text-align: left"> The minimum number of connections a pool holds. </td></tr><tr><td style="text-align: left"> max-pool-size </td><td style="text-align: left"> The maximum number of connections a pool can hold. </td></tr><tr><td style="text-align: left"> prefill </td><td style="text-align: left"> Whether to try to prefill the connection pool. The default is <code class="literal">false</code>. </td></tr><tr><td style="text-align: left"> use-strict-min </td><td style="text-align: left"> Whether the idle connection scan should strictly stop marking for closure of any further connections, once the <code class="literal">min-pool-size</code> has been reached. The default value is <code class="literal">false</code>. </td></tr><tr><td style="text-align: left"> flush-strategy </td><td style="text-align: left"> <div class="para">
						Whether the pool is flushed in the case of an error. Valid values are:
					</div>
					 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
								FailingConnectionOnly
							</div></li><li class="listitem"><div class="para">
								IdleConnections
							</div></li><li class="listitem"><div class="para">
								EntirePool
							</div></li></ul></div>
					 <div class="para">
						The default is <code class="literal">FailingConnectionOnly</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> allow-multiple-users </td><td style="text-align: left"> Specifies if multiple users will access the datasource through the getConnection(user, password) method, and whether the internal pool type accounts for this behavior. </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-xa-pooling">
      ⁠</a><p class="title"><strong>Table 12.5. XA pool parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="XA pool parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> is-same-rm-override </td><td style="text-align: left"> Whether the <code class="classname">javax.transaction.xa.XAResource.isSameRM(XAResource)</code> class returns <code class="literal">true</code> or <code class="literal">false</code>. </td></tr><tr><td style="text-align: left"> interleaving </td><td style="text-align: left"> Whether to enable interleaving for XA connection factories. </td></tr><tr><td style="text-align: left"> no-tx-separate-pools </td><td style="text-align: left"> <div class="para">
						Whether to create separate sub-pools for each context. This is required for Oracle datasources, which do not allow XA connections to be used both inside and outside of a JTA transaction.
					</div>
					 <div class="para">
						Using this option will cause your total pool size to be twice <code class="literal">max-pool-size</code>, because two actual pools will be created.
					</div>
					 </td></tr><tr><td style="text-align: left"> pad-xid </td><td style="text-align: left"> Whether to pad the Xid. </td></tr><tr><td style="text-align: left"> wrap-xa-resource </td><td style="text-align: left"> <div class="para">
						Whether to wrap the XAResource in an <code class="code">org.jboss.tm.XAResourceWrapper</code> instance.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-security">
      ⁠</a><p class="title"><strong>Table 12.6. Security parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Security parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> user-name </td><td style="text-align: left"> The username to use to create a new connection. </td></tr><tr><td style="text-align: left"> password </td><td style="text-align: left"> The password to use to create a new connection. </td></tr><tr><td style="text-align: left"> security-domain </td><td style="text-align: left"> Contains the name of a JAAS security-manager which handles authentication. This name correlates to the application-policy/name attribute of the JAAS login configuration. </td></tr><tr><td style="text-align: left"> reauth-plugin </td><td style="text-align: left"> Defines a reauthentication plug-in to use to reauthenticate physical connections. </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-validation">
      ⁠</a><p class="title"><strong>Table 12.7. Validation parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Validation parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> valid-connection-checker </td><td style="text-align: left"> <div class="para">
						An implementation of interface <code class="code">org.jboss.jca.adaptors.jdbc.ValidConnectionChecker</code> which provides a <code class="code">SQLException.isValidConnection(Connection e)</code> method to validate a connection. An exception means the connection is destroyed. This overrides the parameter <code class="literal">check-valid-connection-sql</code> if it is present.
					</div>
					 </td></tr><tr><td style="text-align: left"> check-valid-connection-sql </td><td style="text-align: left"> An SQL statement to check validity of a pool connection. This may be called when a managed connection is taken from a pool for use. </td></tr><tr><td style="text-align: left"> validate-on-match </td><td style="text-align: left"> <div class="para">
						Indicates whether connection level validation is performed when a connection factory attempts to match a managed connection for a given set.
					</div>
					 <div class="para">
						Specifying "true" for <code class="literal">validate-on-match</code> is typically not done in conjunction with specifying "true" for <code class="literal">background-validation</code>. <code class="literal">Validate-on-match</code> is needed when a client must have a connection validated prior to use. This parameter is false by default.
					</div>
					 </td></tr><tr><td style="text-align: left"> background-validation </td><td style="text-align: left"> <div class="para">
						Specifies that connections are validated on a background thread. Background validation is a performance optimization when not used with <code class="literal">validate-on-match</code>. If <code class="literal">validate-on-match</code> is true, using <code class="literal">background-validation</code> could result in redundant checks. Background validation does leave open the opportunity for a bad connection to be given to the client for use (a connection goes bad between the time of the validation scan and prior to being handed to the client), so the client application must account for this possibility.
					</div>
					 </td></tr><tr><td style="text-align: left"> background-validation-millis </td><td style="text-align: left"> The amount of time, in milliseconds, that background validation runs. </td></tr><tr><td style="text-align: left"> use-fast-fail </td><td style="text-align: left"> <div class="para">
						If true, fail a connection allocation on the first attempt, if the connection is invalid. Defaults to <code class="literal">false</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> stale-connection-checker </td><td style="text-align: left"> <div class="para">
						An instance of <code class="code">org.jboss.jca.adapters.jdbc.StaleConnectionChecker</code> which provides a Boolean <code class="code">isStaleConnection(SQLException e)</code> method. If this method returns <code class="literal">true</code>, the exception is wrapped in an <code class="code">org.jboss.jca.adapters.jdbc.StaleConnectionException</code>, which is a subclass of <code class="code">SQLException</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> exception-sorter </td><td style="text-align: left"> <div class="para">
						An instance of <code class="code">org.jboss.jca.adapters.jdbc.ExceptionSorter</code> which provides a Boolean <code class="code">isExceptionFatal(SQLException e)</code> method. This method validates whether an exception is broadcast to all instances of <code class="code">javax.resource.spi.ConnectionEventListener</code> as a <code class="literal">connectionErrorOccurred</code> message.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-timeout">
      ⁠</a><p class="title"><strong>Table 12.8. Timeout parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Timeout parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> use-try-lock </td><td style="text-align: left"> Uses <code class="code">tryLock()</code> instead of <code class="code">lock()</code>. This attempts to obtain the lock for the configured number of seconds, before timing out, rather than failing immediately if the lock is unavailable. Defaults to <code class="literal">60</code> seconds. As an example, to set a timeout of 5 minutes, set <code class="code">&lt;use-try-lock&gt;</code>300<code class="code">&lt;/use-try-lock&gt;</code>. </td></tr><tr><td style="text-align: left"> blocking-timeout-millis </td><td style="text-align: left"> The maximum time, in milliseconds, to block while waiting for a connection. After this time is exceeded, an exception is thrown. This blocks only while waiting for a permit for a connection, and does not throw an exception if creating a new connection takes a long time. Defaults to 30000, which is 30 seconds. </td></tr><tr><td style="text-align: left"> idle-timeout-minutes </td><td style="text-align: left"> <div class="para">
						The maximum time, in minutes, before an idle connection is closed. If not specified, the default is <code class="literal">30</code> minutes. The actual maximum time depends upon the idleRemover scan time, which is half of the smallest <code class="literal">idle-timeout-minutes</code> of any pool.
					</div>
					 </td></tr><tr><td style="text-align: left"> set-tx-query-timeout </td><td style="text-align: left"> <div class="para">
						Whether to set the query timeout based on the time remaining until transaction timeout. Any configured query timeout is used if no transaction exists. Defaults to <code class="literal">false</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> query-timeout </td><td style="text-align: left"> Timeout for queries, in seconds. The default is no timeout. </td></tr><tr><td style="text-align: left"> allocation-retry </td><td style="text-align: left"> The number of times to retry allocating a connection before throwing an exception. The default is <code class="literal">0</code>, so an exception is thrown upon the first failure. </td></tr><tr><td style="text-align: left"> allocation-retry-wait-millis </td><td style="text-align: left"> <div class="para">
						How long, in milliseconds, to wait before retrying to allocate a connection. The default is 5000, which is 5 seconds.
					</div>
					 </td></tr><tr><td style="text-align: left"> xa-resource-timeout </td><td style="text-align: left"> <div class="para">
						If non-zero, this value is passed to method <code class="code">XAResource.setTransactionTimeout</code>.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-statement">
      ⁠</a><p class="title"><strong>Table 12.9. Statement parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Statement parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> track-statements </td><td style="text-align: left"> <div class="para">
						Whether to check for unclosed statements when a connection is returned to a pool and a statement is returned to the prepared statement cache. If false, statements are not tracked.
					</div>
					 <div class="itemizedlist"><p class="title"><strong>Valid values</strong></p><ul><li class="listitem"><div class="para">
								<code class="literal">true</code>: statements and result sets are tracked, and a warning is issued if they are not closed.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">false</code>: neither statements or result sets are tracked.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">nowarn</code>: statements are tracked but no warning is issued. This is the default.
							</div></li></ul></div>
					 </td></tr><tr><td style="text-align: left"> prepared-statement-cache-size </td><td style="text-align: left"> The number of prepared statements per connection, in a Least Recently Used (LRU) cache. </td></tr><tr><td style="text-align: left"> share-prepared-statements </td><td style="text-align: left"> <div class="para">
						Whether JBoss EAP should cache, instead of close or terminate, the underlying physical statement when the wrapper supplied to the application is closed by application code. The default is <code class="literal">false</code>.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="Topic2772-recovery">
      ⁠</a><p class="title"><strong>Table 12.10. Recovery parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Recovery parameters"><colgroup><col width="50%" style="text-align: left" class="c1"/><col width="50%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Parameter </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> recover-credential </td><td style="text-align: left"> A username/password pair or security domain to use for recovery. </td></tr><tr><td style="text-align: left"> recover-plugin </td><td style="text-align: left"> <div class="para">
						An implementation of the <code class="code">org.jboss.jca.core.spi.recoveryRecoveryPlugin</code> class, to be used for recovery.
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+2772-781124+%5BLatest%5D&amp;comment=Title%3A+Datasource+Parameters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=2772-781124+27+Jan+2017+11%3A35+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Transaction_Logging">
      ⁠</a>12.6.3. Transaction Logging</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Transaction_Log_Messages">
      ⁠</a>12.6.3.1. About Transaction Log Messages</h3></div></div></div><div class="para">
		To track transaction status while keeping the log files readable, use the <code class="code">DEBUG</code> log level for the transaction logger. For detailed debugging, use the <code class="code">TRACE</code> log level. Refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_Logging_for_the_Transaction_Subsystem1">Section 12.6.3.2, “Configure Logging for the Transaction Subsystem”</a> for information on configuring the transaction logger.
	</div><div class="para">
		The transaction manager can generate a lot of logging information when configured to log in the <code class="code">TRACE</code> log level. Following are some of the most commonly-seen messages. This list is not comprehensive, so you may see other messages than these.
	</div><div class="table"><a id="idm140550802741280">
      ⁠</a><p class="title"><strong>Table 12.11. Transaction State Change</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Transaction State Change"><colgroup><col/><col/></colgroup><tbody><tr><td> Transaction Begin </td><td> <div class="para">
						When a transaction begins, the following code is executed:
					</div>
					 
<pre class="screen">com.arjuna.ats.arjuna.coordinator.BasicAction::Begin:1342</pre>
					 
<pre class="screen">tsLogger.logger.trace("BasicAction::Begin() for action-id "+ get_uid());</pre>
					 </td></tr><tr><td> Transaction Commit </td><td> <div class="para">
						When a transaction commits, the following code is executed:
					</div>
					 
<pre class="screen">com.arjuna.ats.arjuna.coordinator.BasicAction::End:1342</pre>
					 
<pre class="screen">tsLogger.logger.trace("BasicAction::End() for action-id "+ get_uid());</pre>
					 </td></tr><tr><td> Transaction Rollback </td><td> <div class="para">
						When a transaction rolls back, the following code is executed:
					</div>
					 
<pre class="screen">com.arjuna.ats.arjuna.coordinator.BasicAction::Abort:1575</pre>
					 
<pre class="screen">tsLogger.logger.trace("BasicAction::Abort() for action-id "+ get_uid());</pre>
					 </td></tr><tr><td> Transaction Timeout </td><td> <div class="para">
						When a transaction times out, the following code is executed:
					</div>
					 
<pre class="screen">com.arjuna.ats.arjuna.coordinator.TransactionReaper::doCancellations:349</pre>
					 
<pre class="screen">tsLogger.logger.trace("Reaper Worker " + Thread.currentThread() + " attempting to cancel " + e._control.get_uid());</pre>
					 <div class="para">
						You will then see the same thread rolling back the transaction as shown above.
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+9018-591860+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Log+Messages%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9018-591860+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_Logging_for_the_Transaction_Subsystem1">
      ⁠</a>12.6.3.2. Configure Logging for the Transaction Subsystem</h3></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			Use this procedure to control the amount of information logged about transactions, independent of other logging settings in JBoss EAP 6. The main procedure shows how to do this in the web-based Management Console. The Management CLI command is given afterward.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550799360048">
      ⁠</a><p class="title"><strong>Procedure 12.4. Configure the Transaction Logger Using the Management Console</strong></p><ol class="1"><li class="step"><p class="title"><strong>Navigate to the Logging configuration area.</strong></p><div class="para">
				In the Management Console, click the <span class="guilabel"><strong>Configuration</strong></span> tab. If you use a managed domain, choose the server profile you wish to configure, from the <span class="guilabel"><strong>Profile</strong></span> selection box at the top left.
			</div><div class="para">
				Expand the <span class="guilabel"><strong>Core</strong></span> menu, and select <span class="guilabel"><strong>Logging</strong></span>.
			</div></li><li class="step"><p class="title"><strong>Edit the <code class="code">com.arjuna</code> attributes.</strong></p><div class="para">
				Select the <span class="guilabel"><strong>Log Categories</strong></span> tab. Select <code class="code">com.arjuna</code> and lick <span class="guilabel"><strong>Edit</strong></span> in the <span class="guilabel"><strong>Details</strong></span> section. This is where you can add class-specific logging information. The <code class="code">com.arjuna</code> class is already present. You can change the log level and whether to use parent handlers.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Log Level</span></dt><dd><div class="para">
							The log level is <code class="literal">WARN</code> by default. Because transactions can produce a large quantity of logging output, the meaning of the standard logging levels is slightly different for the transaction logger. In general, messages tagged with levels at a lower severity than the chosen level are discarded.
						</div><div class="itemizedlist"><p class="title"><strong>Transaction Logging Levels, from Most to Least Verbose</strong></p><ul><li class="listitem"><div class="para">
									TRACE
								</div></li><li class="listitem"><div class="para">
									DEBUG
								</div></li><li class="listitem"><div class="para">
									INFO
								</div></li><li class="listitem"><div class="para">
									WARN
								</div></li><li class="listitem"><div class="para">
									ERROR
								</div></li><li class="listitem"><div class="para">
									FAILURE
								</div></li></ul></div></dd><dt><span class="term">Use Parent Handlers</span></dt><dd><div class="para">
							Whether the logger should send its output to its parent logger. The default behavior is <code class="literal">true</code>.
						</div></dd></dl></div></li><li class="step"><div class="para">
				Changes take effect immediately.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4311-632600+%5BLatest%5D&amp;comment=Title%3A+Configure+Logging+for+the+Transaction+Subsystem%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4311-632600+21+Apr+2014+21%3A48+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Browse_and_Manage_Transactions">
      ⁠</a>12.6.3.3. Browse and Manage Transactions</h3></div></div></div><div class="para">
		The Management CLI supports the ability to browse and manipulate transaction records. This functionality is provided by the interaction between the Transaction Manager and the management API of JBoss EAP 6.
	</div><div class="para">
		The Transaction Manager stores information about each pending transaction and the participants involved the transaction, in a persistent storage called the <em class="firstterm">object store</em>. The management API exposes the object store as a resource called the <code class="code">log-store</code>. An API operation called <code class="code">probe</code> reads the transaction logs and creates a node for each log. You can call the <code class="code">probe</code> command manually, whenever you need to refresh the <code class="code">log-store</code>. It is normal for transaction logs to appear and disappear quickly.
	</div><div class="example"><a id="refresh_log_store">
      ⁠</a><p class="title"><strong>Example 12.2. Refresh the Log Store</strong></p><div class="example-contents"><div class="para">
			This command refreshes the log store for server groups which use the profile <code class="literal">default</code> in a managed domain. For a standalone server, remove the <code class="literal">profile=default</code> from the command.
		</div><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/:probe</pre></div></div><div class="example"><a id="idm140550790125536">
      ⁠</a><p class="title"><strong>Example 12.3. View All Prepared Transactions</strong></p><div class="example-contents"><div class="para">
			To view all prepared transactions, first refresh the log store (see <a class="xref" href="chap-Java_Transaction_API_JTA.html#refresh_log_store">Example 12.2, “Refresh the Log Store”</a>), then run the following command, which functions similarly to a filesystem <code class="command">ls</code> command.
		</div><pre class="screen">ls /profile=default/subsystem=transactions/log-store=log-store/transactions</pre><div class="para">
			Each transaction is shown, along with its unique identifier. Individual operations can be run against an individual transaction (see <a class="xref" href="chap-Java_Transaction_API_JTA.html#manage_transaction">Manage a Transaction</a>).
		</div></div></div><div class="variablelist"><a id="manage_transaction">
      ⁠</a><p class="title"><strong>Manage a Transaction</strong></p><dl class="variablelist"><dt><span class="term">View a transaction's attributes.</span></dt><dd><div class="para">
					To view information about a transaction, such as its JNDI name, EIS product name and version, or its status, use the <code class="code">:read-resource</code> CLI command.
				</div><div class="informalexample"><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=<em class="replaceable">0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9</em>:read-resource</pre></div></dd><dt><span class="term">View the participants of a transaction.</span></dt><dd><div class="para">
					Each transaction log contains a child element called <code class="code">participants</code>. Use the <code class="code">read-resource</code> CLI command on this element to see the participants of the transaction. Participants are identified by their JNDI names.
				</div><div class="informalexample"><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=<em class="replaceable">0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9</em>/participants=<em class="replaceable">java\:\/JmsXA</em>:read-resource</pre></div><div class="para">
					The result may look similar to this:
				</div><div class="informalexample"><pre class="screen">
{
   "outcome" =&gt; "success",
   "result" =&gt; {
       "eis-product-name" =&gt; "HornetQ",
       "eis-product-version" =&gt; "2.0",
       "jndi-name" =&gt; "java:/JmsXA",
       "status" =&gt; "HEURISTIC",
       "type" =&gt; "/StateManager/AbstractRecord/XAResourceRecord"
   }
}
</pre></div><div class="para">
					The outcome status shown here is in a <code class="code">HEURISTIC</code> state and is eligible for recovery. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#recover_transaction">Recover a transaction.</a> for more details.
				</div><div class="para">
					In special cases it is possible to create orphan records in the object store, that is XAResourceRecords, which do not have any corresponding transaction record in the log. For example, XA resource prepared but crashed before the TM recorded and is inaccessible for the domain management API. To access such records you need to set management option <code class="literal">expose-all-logs</code> to <code class="literal">true</code>. This option is not saved in management model and is restored to <code class="literal">false</code> when the server is restarted. 
<pre class="screen">/profile=default/subsystem=transactions/log-store=log-store:write-attribute(name=expose-all-logs, value=true)</pre>

				</div></dd><dt><span class="term">Delete a transaction.</span></dt><dd><div class="para">
					Each transaction log supports a <code class="code">:delete</code> operation, to delete the transaction log representing the transaction.
				</div><div class="informalexample"><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=<em class="replaceable">0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9</em>:delete</pre></div></dd><dt><a id="recover_transaction">
      ⁠</a><span class="term">Recover a transaction.</span></dt><dd><div class="para">
					Each transaction participant supports recovery via the <code class="code">:recover</code> CLI command.
				</div><div class="informalexample"><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=<em class="replaceable">0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=2</em>:recover</pre></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Recovery of heuristic transactions and participants</strong></p><ul><li class="listitem"><div class="para">
							If the transaction's status is <code class="literal">HEURISTIC</code>, the recovery operation changes the state to <code class="literal">PREPARE</code> and triggers a recovery.
						</div></li><li class="listitem"><div class="para">
							If one of the transaction's participants is heuristic, the recovery operation tries to replay the <code class="code">commit</code> operation. If successful, the participant is removed from the transaction log. You can verify this by re-running the <code class="code">:probe</code> operation on the <code class="code">log-store</code> and checking that the participant is no longer listed. If this is the last participant, the transaction is also deleted.
						</div></li></ul></div></dd><dt><span class="term">Refresh the status of a transaction which needs recovery.</span></dt><dd><div class="para">
					If a transaction needs recovery, you can use the <code class="code">:refresh</code> CLI command to be sure it still requires recovery, before attempting the recovery.
				</div><div class="informalexample"><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=<em class="replaceable">0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=2</em>:refresh</pre></div></dd></dl></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">View Transaction Statistics</div>
			If Transaction Manager statistics are enabled, you can view statistics about the Transaction Manager and transaction subsystem. See <a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_the_Transaction_Manager1">Section 12.7.8.2, “Configure the Transaction Manager”</a>  for information about how to enable Transaction Manager statistics.
		</div><div class="para">
		You can view statistics either via the management console or the Management CLI. In the management console, transaction statistics are available via <span class="guimenu"><strong>Runtime</strong></span> → <span class="guimenuitem"><strong>Status</strong></span> → <span class="guimenuitem"><strong>Subsystems</strong></span> → <span class="guimenuitem"><strong>Transactions</strong></span>. Transaction statistics are available for each server in a managed domain. To view the status of a different server, select <span class="guilabel"><strong>Change Server</strong></span> in the left-hand menu and select the server from the list.
	</div><div class="para">
		The following table shows each available statistic, its description, and the Management CLI command to view the statistic.
	</div><div class="table"><a id="idm140550811104384">
      ⁠</a><p class="title"><strong>Table 12.12. Transaction Subsystem Statistics</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Transaction Subsystem Statistics"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Statistic </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Total </td><td> <div class="para">
						The total number of transactions processed by the Transaction Manager on this server.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-transactions,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Committed </td><td> <div class="para">
						The number of committed transactions processed by the Transaction Manager on this server.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-committed-transactions,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Aborted </td><td> <div class="para">
						The number of aborted transactions processed by the Transaction Manager on this server.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-aborted-transactions,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Timed Out </td><td> <div class="para">
						The number of timed out transactions processed by the Transaction Manager on this server.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-timed-out-transactions,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Heuristics </td><td> <div class="para">
						Not available in the Management Console. Number of transactions in a heuristic state.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-heuristics,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> In-Flight Transactions </td><td> <div class="para">
						Not available in the Management Console. Number of transactions which have begun but not yet terminated.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-inflight-transactions,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Failure Origin - Applications </td><td> <div class="para">
						The number of failed transactions whose failure origin was an application.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-application-rollbacks,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Failure Origin - Resources </td><td> <div class="para">
						The number of failed transactions whose failure origin was a resource.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/:read-attribute(name=number-of-resource-rollbacks,include-defaults=true)</pre></div>
					</div>
					 </td></tr><tr><td> Participant ID </td><td> <div class="para">
						The ID of the participant.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9:read-children-names(child-type=participants)</pre></div>
					</div>
					 </td></tr><tr><td> List of all transactions </td><td> <div class="para">
						The complete list of transactions.
					</div>
					 </td><td> <div class="para">
						<div class="informalexample"><pre class="screen">/host=<em class="replaceable">master</em>/server=<em class="replaceable">server-one</em>/subsystem=transactions/log-store=log-store:read-children-names(child-type=transactions)</pre></div>
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4312-760806+%5BLatest%5D&amp;comment=Title%3A+Browse+and+Manage+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4312-760806+09+Jun+2015+04%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Use_JTA_Transactions">
      ⁠</a>12.7. Use JTA Transactions</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Transactions_JTA_Task_Overview">
      ⁠</a>12.7.1. Transactions JTA Task Overview</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			The following procedures are useful when you need to use transactions in your application.
		</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Control_JTA_Transactions">Section 12.7.2, “Control Transactions”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Begin_a_JTA_Transaction">Section 12.7.3, “Begin a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Commit_a_JTA_Transaction">Section 12.7.5, “Commit a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Roll_Back_a_JTA_Transaction">Section 12.7.6, “Roll Back a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Handle_a_Heuristic_Outcome_in_a_JTA_Transaction">Section 12.7.7, “Handle a Heuristic Outcome in a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_the_Transaction_Manager1">Section 12.7.8.2, “Configure the Transaction Manager”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Handle_Transaction_Errors">Section 12.7.9.1, “Handle Transaction Errors”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4375-591665+%5BLatest%5D&amp;comment=Title%3A+Transactions+JTA+Task+Overview%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4375-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Control_JTA_Transactions">
      ⁠</a>12.7.2. Control Transactions</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			This list of procedures outlines the different ways to control transactions in your applications which use JTA or JTS APIs.
		</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Begin_a_JTA_Transaction">Section 12.7.3, “Begin a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Commit_a_JTA_Transaction">Section 12.7.5, “Commit a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Roll_Back_a_JTA_Transaction">Section 12.7.6, “Roll Back a Transaction”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-Java_Transaction_API_JTA.html#Handle_a_Heuristic_Outcome_in_a_JTA_Transaction">Section 12.7.7, “Handle a Heuristic Outcome in a Transaction”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4313-591659+%5BLatest%5D&amp;comment=Title%3A+Control+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4313-591659+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Begin_a_JTA_Transaction">
      ⁠</a>12.7.3. Begin a Transaction</h2></div></div></div><div class="para">
		This procedure shows how to begin a new transaction. The API is the same either you run Transaction Manager configured with JTA or JTS.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Get an instance of <code class="classname">UserTransaction</code>.</strong></p><div class="para">
				You can get the instance using JNDI, injection, or an EJB's context, if the EJB uses bean-managed transactions, by means of a <code class="literal">@TransactionManagement(TransactionManagementType.BEAN)</code> annotation.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>JNDI</strong></p><pre class="programlisting">new InitialContext().lookup("java:comp/UserTransaction")</pre></li>
				 <li class="step"><p class="title"><strong>Injection</strong></p><pre class="programlisting">@Resource UserTransaction userTransaction;</pre></li>
				 <li class="step"><p class="title"><strong>Context</strong></p><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								In a stateless/stateful bean: 
<pre class="programlisting">@Resource SessionContext ctx;
ctx.getUserTransaction();</pre>

							</div></li><li class="listitem"><div class="para">
								In a message-driven bean: 
<pre class="programlisting">@Resource MessageDrivenContext ctx;
ctx.getUserTransaction()</pre>

							</div></li></ul></div></li>

			</ul></li><li class="step"><p class="title"><strong>Call <code class="classname">UserTransaction</code>.<code class="methodname">begin()</code> after you connect to your datasource.</strong></p><pre class="programlisting">
...
try {
    System.out.println("\nCreating connection to database: "+url);
    stmt = conn.createStatement();  // non-tx statement
    try {
        System.out.println("Starting top-level transaction.");
        userTransaction.begin();
        stmtx = conn.createStatement(); // will be a tx-statement
        ...
    }
}
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Participate in an existing transaction using the JTS API.</div>
			One of the benefits of EJBs (either used with CMT or BMT) is that the container manages all the internals of the transactional processing, that is, you are free from taking care of transaction being part of XA transaction or transaction distribution amongst EAP containers.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result:</div>
			The transaction begins. All uses of your datasource until you commit or roll back the transaction are transactional.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For a full example, see <a class="xref" href="chap-Java_Transaction_API_JTA.html#JTA_Transaction_Example">Section 12.9.2, “JTA Transaction Example”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4304-744140+%5BLatest%5D&amp;comment=Title%3A+Begin+a+Transaction%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4304-744140+20+Feb+2015+02%3A00+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Nest_Transactions">
      ⁠</a>12.7.4. Nested Transactions</h2></div></div></div><div class="para">
		Nested transactions allow an application to create a transaction that is embedded in an existing transaction. In this model, multiple subtransactions can be embedded recursively in a transaction. Subtransactions can be committed or rolled back without committing or rolling back the parent transaction. However, the results of a commit operation are contingent upon the commitment of all the transaction's ancestors.
	</div><div class="para">
		For implementation specific information, refer JBossTS JTS Development guide at <a href="https://docs.jboss.org/jbosstm/latest/guides/narayana-jts-development_guide">https://docs.jboss.org/jbosstm/latest/guides/narayana-jts-development_guide</a>.
	</div><div class="para">
		Nested transactions are available only when used with the JTS API. Nested transaction are not a supported feature of EAP application server. In addition, many database vendors do not support nested transactions, so consult your database vendor before you add nested transactions to your application.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4308-742124+%5BLatest%5D&amp;comment=Title%3A+Nested+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4308-742124+09+Feb+2015+01%3A36+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Commit_a_JTA_Transaction">
      ⁠</a>12.7.5. Commit a Transaction</h2></div></div></div><div class="para">
		This procedure shows how to commit a transaction using the Java Transaction API (JTA).
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			You must begin a transaction before you can commit it. For information on how to begin a transaction, refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#Begin_a_JTA_Transaction">Section 12.7.3, “Begin a Transaction”</a>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Call the <code class="methodname">commit()</code> method on the <code class="classname">UserTransaction</code>.</strong></p><div class="para">
				When you call the <code class="methodname">commit()</code> method on the <code class="classname">UserTransaction</code>, the Transaction Manager attempts to commit the transaction.
			</div><pre class="programlisting">
@Inject
private UserTransaction userTransaction;

public void updateTable(String key, String value)
    EntityManager entityManager = entityManagerFactory.createEntityManager();
    try {
        userTransaction.begin():
        &lt;!-- Perform some data manipulation using entityManager --&gt;
        ...
        // Commit the transaction
        userTransaction.commit();
    } catch (Exception ex) {
        &lt;!-- Log message or notify Web page --&gt;
        ...
        try {
            userTransaction.rollback();
        } catch (SystemException se) {
            throw new RuntimeException(se);
        }
        throw new RuntimeException(e);
    } finally {
        entityManager.close();
    }
}
</pre></li><li class="step"><p class="title"><strong>If you use Container Managed Transactions (CMT), you do not need to manually commit.</strong></p><div class="para">
				If you configure your bean to use Container Managed Transactions, the container will manage the transaction lifecycle for you based on annotations you configure in the code.
			</div><pre class="programlisting">
@PersistenceContext
private EntityManager em;

@TransactionAttribute(TransactionAttributeType.REQUIRED)
public void updateTable(String key, String value)
  &lt;!-- Perform some data manipulation using entityManager --&gt;
  ...
}
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your datasource commits and your transaction ends, or an exception is thrown.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For a full example, see <a class="xref" href="chap-Java_Transaction_API_JTA.html#JTA_Transaction_Example">Section 12.9.2, “JTA Transaction Example”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4305-741706+%5BLatest%5D&amp;comment=Title%3A+Commit+a+Transaction%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4305-741706+05+Feb+2015+22%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Roll_Back_a_JTA_Transaction">
      ⁠</a>12.7.6. Roll Back a Transaction</h2></div></div></div><div class="para">
		This procedure shows how to roll back a transaction using the Java Transaction API (JTA).
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
			You must begin a transaction before you can roll it back. For information on how to begin a transaction, refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#Begin_a_JTA_Transaction">Section 12.7.3, “Begin a Transaction”</a>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Call the <code class="methodname">rollback()</code> method on the <code class="classname">UserTransaction</code>.</strong></p><div class="para">
				When you call the <code class="methodname">rollback()</code> method on the <code class="classname">UserTransaction</code>, the Transaction Manager attempts to roll back the transaction and return the data to its previous state.
			</div><pre class="programlisting"> 
@Inject
private UserTransaction userTransaction;

public void updateTable(String key, String value)
    EntityManager entityManager = entityManagerFactory.createEntityManager();
    try {
        userTransaction.begin():
        &lt;!-- Perform some data manipulation using entityManager --&gt;
          ...
          // Commit the transaction
        userTransaction.commit();
    } catch (Exception ex) {
        &lt;!-- Log message or notify Web page --&gt;
        ...
        try {
            userTransaction.rollback();
        } catch (SystemException se) {
            throw new RuntimeException(se);
        }
        throw new RuntimeException(e);
    } finally {
        entityManager.close();
    }
}
</pre></li><li class="step"><p class="title"><strong>If you use Container Managed Transactions (CMT), you do not need to manually roll back the transaction.</strong></p><div class="para">
				If you configure your bean to use Container Managed Transactions, the container will manage the transaction lifecycle for you based on annotations you configure in the code.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Rollback for CMT occurs if RuntimeException is thrown. You can also explicitly call the <code class="classname">setRollbackOnly</code> method to gain the rollback. Or, use the <code class="classname">@ApplicationException(rollback=true</code>) for application exception to rollback.
				</div></div></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your transaction is rolled back by the Transaction Manager.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For a full example, see <a class="xref" href="chap-Java_Transaction_API_JTA.html#JTA_Transaction_Example">Section 12.9.2, “JTA Transaction Example”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4306-741705+%5BLatest%5D&amp;comment=Title%3A+Roll+Back+a+Transaction%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4306-741705+05+Feb+2015+22%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Handle_a_Heuristic_Outcome_in_a_JTA_Transaction">
      ⁠</a>12.7.7. Handle a Heuristic Outcome in a Transaction</h2></div></div></div><div class="para">
		This procedure shows how to handle a heuristic outcome of a transaction using the Java Transaction API (JTA).
	</div><div class="para">
		Heuristic transaction outcomes are uncommon and usually have exceptional causes. The word <em class="firstterm">heuristic</em> means "by hand", and that is the way that these outcomes usually have to be handled. Refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#About_Heuristic_Outcomes">Section 12.4.4, “About Heuristic Outcomes”</a> for more information about heuristic transaction outcomes.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550724433984">
      ⁠</a><p class="title"><strong>Procedure 12.5. Handle a heuristic outcome in a transaction</strong></p><ol class="1"><li class="step"><p class="title"><strong>Determine the cause</strong></p><div class="para">
				The over-arching cause of a heuristic outcome in a transaction is that a resource manager promised it could commit or roll-back, and then failed to fulfill the promise. This could be due to a problem with a third-party component, the integration layer between the third-party component and JBoss EAP 6, or JBoss EAP 6 itself.
			</div><div class="para">
				By far, the most common two causes of heuristic errors are transient failures in the environment and coding errors in the code dealing with resource managers.
			</div></li><li class="step"><p class="title"><strong>Fix transient failures in the environment</strong></p><div class="para">
				Typically, if there is a transient failure in your environment, you will know about it before you find out about the heuristic error. This could be a network outage, hardware failure, database failure, power outage, or a host of other things.
			</div><div class="para">
				If you experienced the heuristic outcome in a test environment, during stress testing, it provides information about weaknesses in your environment.
			</div><div class="warning"><div class="admonition_header"><p><strong>Heuristic transactions are not recovered</strong></p></div><div class="admonition"><div class="para">
					JBoss EAP 6 will automatically recover transactions that were in a non-heuristic state at the time of the failure, but it does not attempt to recover heuristic transactions.
				</div></div></div></li><li class="step"><p class="title"><strong>Contact resource manager vendors</strong></p><div class="para">
				If you have no obvious failure in your environment, or the heuristic outcome is easily reproducible, it is probably a coding error. Contact third-party vendors to find out if a solution is available. If you suspect the problem is in the transaction manager of JBoss EAP 6 itself, contact Red Hat Global Support Services.
			</div></li><li class="step"><p class="title"><strong>In a test environment, delete the logs and restart JBoss EAP 6.</strong></p><div class="para">
				In a test environment, or if you do not care about the integrity of the data, deleting the transaction logs and restarting JBoss EAP 6 gets rid of the heuristic outcome. The transaction logs are located in <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/data/tx-object-store/</code> for a standalone server, or <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/servers/<em class="replaceable">SERVER_NAME</em>/data/tx-object-store</code> in a managed domain, by default. In the case of a managed domain, <em class="replaceable">SERVER_NAME</em> refers to the name of the individual server participating in a server group.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The location of the transaction log also depends on the object store in use and the values set for the <em class="parameter"><code>oject-store-relative-to</code></em> and <em class="parameter"><code>object-store-path</code></em> parameters. For file system logs (such as a standard shadow and HornetQ logs) the default direction location is used, but when using a JDBC object store, the transaction logs are stored in a database.
				</div></div></div></li><li class="step"><p class="title"><strong>Resolve the outcome by hand</strong></p><div class="para">
				The process of resolving the transaction outcome by hand is very dependent on the exact circumstance of the failure. Typically, you need to take the following steps, applying them to your situation:
			</div><ol class="substeps a"><li class="step"><div class="para">
						Identify which resource managers were involved.
					</div></li><li class="step"><div class="para">
						Examine the state in the transaction manager and the resource managers.
					</div></li><li class="step"><div class="para">
						Manually force log cleanup and data reconciliation in one or more of the involved components.
					</div></li></ol><div class="para">
				The details of how to perform these steps are out of the scope of this documentation.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4307-744629+%5BLatest%5D&amp;comment=Title%3A+Handle+a+Heuristic+Outcome+in+a+Transaction%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4307-744629+24+Feb+2015+19%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Transaction_Timeouts">
      ⁠</a>12.7.8. Transaction Timeouts</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="About_Transaction_Timeouts1">
      ⁠</a>12.7.8.1. About Transaction Timeouts</h3></div></div></div><div class="para">
		In order to preserve atomicity and adhere to the ACID standard for transactions, some parts of a transaction can be long-running. Transaction participants need to lock parts of datasources when they commit, and the transaction manager needs to wait to hear back from each transaction participant before it can direct them all whether to commit or roll back. Hardware or network failures can cause resources to be locked indefinitely.
	</div><div class="para">
		Transaction timeouts can be associated with transactions in order to control their lifecycle. If a timeout threshold passes before the transaction commits or rolls back, the timeout causes the transaction to be rolled back automatically.
	</div><div class="para">
		You can configure default timeout values for the entire transaction subsystem, or you disable default timeout values, and specify timeouts on a per-transaction basis.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4378-591665+%5BLatest%5D&amp;comment=Title%3A+About+Transaction+Timeouts%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4378-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configure_the_Transaction_Manager1">
      ⁠</a>12.7.8.2. Configure the Transaction Manager</h3></div></div></div><div class="para">
		You can configure the Transaction Manager (TM) using the web-based Management Console or the command-line Management CLI. For each command or option given, the assumption is made that you are running JBoss EAP 6 as a Managed Domain. If you use a Standalone Server or you want to modify a different profile than <code class="code">default</code>, you may need to modify the steps and commands in the following ways.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Notes about the Example Commands</strong></p><ul><li class="listitem"><div class="para">
				For the Management Console, the <code class="code">default</code> profile is the one which is selected when you first log into the console. If you need to modify the Transaction Manager's configuration in a different profile, select your profile instead of <code class="code">default</code>, in each instruction.
			</div><div class="para">
				Similarly, substitute your profile for the <code class="code">default</code> profile in the example CLI commands.
			</div></li><li class="listitem"><div class="para">
				If you use a Standalone Server, only one profile exists. Ignore any instructions to choose a specific profile. In CLI commands, remove the <code class="code">/profile=default</code> portion of the sample commands.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			In order for the TM options to be visible in the Management Console or Management CLI, the <code class="code">transactions</code> subsystem must be enabled. It is enabled by default, and required for many other subsystems to function properly, so it is very unlikely that it would be disabled.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure the TM Using the Management Console</div>
			To configure the TM using the web-based Management Console, select the <span class="guilabel"><strong>Configuration</strong></span> tab from the top of the screen. If you use a managed domain, choose the correct profile from the <span class="guilabel"><strong>Profile</strong></span> selection box at the top left. Expand the <span class="guilabel"><strong>Container</strong></span> menu and select <span class="guilabel"><strong>Transactions</strong></span>.
		</div><div class="para">
		Most options are shown in the Transaction Manager configuration page. The <span class="guilabel"><strong>Recovery</strong></span> options are hidden by default. Click the <span class="guilabel"><strong>Recovery</strong></span> tab to see the recovery options. Click <span class="guilabel"><strong>Edit</strong></span> to edit any of the options. Changes take effect immediately.
	</div><div class="para">
		Click the <span class="guilabel"><strong>Need Help?</strong></span> label to display in-line help text.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure the TM using the Management CLI</div>
			In the Management CLI, you can configure the TM using a series of commands. The commands all begin with <code class="code">/profile=default/subsystem=transactions/</code> for a managed domain with profile <code class="code">default</code>, or <code class="code">/subsystem=transactions</code> for a Standalone Server.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			If transaction subsystem is configured to use hornetq journal as storage type for transaction logs, then two instances of JBoss EAP is not permitted to use the same directory for storing the journal. Application server instances can't share the same location and each has to configure unique location for it.
		</div></div></div><div class="table"><a id="idm140550744594000">
      ⁠</a><p class="title"><strong>Table 12.13. TM Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="TM Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> <div class="para">
						Enable Statistics
					</div>
					 </td><td> <div class="para">
						Whether to enable transaction statistics. These statistics can be viewed in the Management Console in the <span class="guilabel"><strong>Subsystem Metrics</strong></span> section of the <span class="guilabel"><strong>Runtime</strong></span> tab.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=enable-statistics,value=true)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						Enable TSM Status
					</div>
					 </td><td> <div class="para">
						Whether to enable the transaction status manager (TSM) service, which is used for out-of-process recovery. Running an out of process recovery manager to contact the ActionStatusService from different process is not supported (it is normally contacted in memory).
					</div>
					 </td><td> <div class="para">
						This configuration option is unsupported.
					</div>
					 </td></tr><tr><td> <div class="para">
						Default Timeout
					</div>
					 </td><td> <div class="para">
						The default transaction timeout. This defaults to <code class="literal">300</code> seconds. You can override this programmatically, on a per-transaction basis.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=default-timeout,value=300)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						Object Store Path
					</div>
					 </td><td> <div class="para">
						A relative or absolute filesystem path where the TM object store stores data. By default relative to the <code class="code">object-store-relative-to</code> parameter's value.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=object-store-path,value=tx-object-store)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						Object Store Path Relative To
					</div>
					 </td><td> <div class="para">
						References a global path configuration in the domain model. The default value is the data directory for JBoss EAP 6, which is the value of the property <code class="code">jboss.server.data.dir</code>, and defaults to <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/data/</code> for a Managed Domain, or <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/data/</code> for a Standalone Server instance. The value of the object store <code class="code">object-store-path</code> TM attribute is relative to this path.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=object-store-relative-to,value=jboss.server.data.dir)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						Socket Binding
					</div>
					 </td><td> <div class="para">
						Specifies the name of the socket binding used by the Transaction Manager for recovery and generating transaction identifiers, when the socket-based mechanism is used. Refer to <code class="code">process-id-socket-max-ports</code> for more information on unique identifier generation. Socket bindings are specified per server group in the <span class="guilabel"><strong>Server</strong></span> tab of the Management Console.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=socket-binding,value=txn-recovery-environment)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						Status Socket Binding
					</div>
					 </td><td> <div class="para">
						Specifies the socket binding to use for the Transaction Status manager.
					</div>
					 </td><td> <div class="para">
						This configuration option is unsupported.
					</div>
					 </td></tr><tr><td> <div class="para">
						Recovery Listener
					</div>
					 </td><td> <div class="para">
						Whether or not the Transaction Recovery process should listen on a network socket. Defaults to <code class="literal">false</code>.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=recovery-listener,value=false)</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="para">
		The following options are for advanced use and can only be modified using the Management CLI. Be cautious when changing them from the default configuration. Contact <a href="https://access.redhat.com/support/contact/technicalSupport/">Red Hat Global Support Services</a> for more information.
	</div><div class="table"><a id="idm140550799511664">
      ⁠</a><p class="title"><strong>Table 12.14. Advanced TM Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Advanced TM Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> <div class="para">
						jts
					</div>
					 </td><td> <div class="para">
						Whether to use Java Transaction Service (JTS) transactions. Defaults to <code class="literal">false</code>, which uses JTA transactions only.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=jts,value=false)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						node-identifier
					</div>
					 </td><td> <div class="para">
						The node identifier for the Transaction Manager. This option is required in the following situations: 
						<div class="itemizedlist"><ul><li class="listitem"><div class="para">
									For JTS to JTS communications
								</div></li><li class="listitem"><div class="para">
									When two Transaction Managers access shared resource managers
								</div></li><li class="listitem"><div class="para">
									When two Transaction Managers access shared object stores
								</div></li></ul></div>
						 The <code class="literal">node-identifier</code> must be unique for each Transaction Manager as it is required to enforce data integrity during recovery. The <code class="literal">node-identifier</code> must also be unique for JTA because multiple nodes may interact with the same resource manager or share a transaction object store.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=node-identifier,value=1)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						process-id-socket-max-ports
					</div>
					 </td><td> <div class="para">
						The Transaction Manager creates a unique identifier for each transaction log. Two different mechanisms are provided for generating unique identifiers: a socket-based mechanism and a mechanism based on the process identifier of the process.
					</div>
					 <div class="para">
						In the case of the socket-based identifier, a socket is opened and its port number is used for the identifier. If the port is already in use, the next port is probed, until a free one is found. The <code class="code">process-id-socket-max-ports</code> represents the maximum number of sockets the TM will try before failing. The default value is <code class="literal">10</code>.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=process-id-socket-max-ports,value=10)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						process-id-uuid
					</div>
					 </td><td> <div class="para">
						Set to <code class="code">true</code> to use the process identifier to create a unique identifier for each transaction. Otherwise, the socket-based mechanism is used. Defaults to <code class="code">true</code>. Refer to <code class="code">process-id-socket-max-ports</code> for more information. To enable <code class="code">process-id-socket-binding</code>, set <code class="code">process-id-uuid</code> to <code class="code">false</code>.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=process-id-uuid,value=true)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						process-id-socket-binding
					</div>
					 </td><td> <div class="para">
						The name of the socket binding configuration to use if the transaction manager should use a socket-based process id. Will be <code class="code">undefined</code> if <code class="code">process-id-uuid</code> is <code class="code">true</code>; otherwise must be set.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=process-id-socket-binding,value=true)</code>
					</div>
					 </td></tr><tr><td> <div class="para">
						use-hornetq-store
					</div>
					 </td><td> <div class="para">
						Use HornetQ's journaled storage mechanisms instead of file-based storage, for the transaction logs. This is disabled by default, but can improve I/O performance. It is not recommended for JTS transactions on separate Transaction Managers. When changing this option, the server has to be restarted using the <code class="command">shutdown</code> command for the change to take effect.
					</div>
					 </td><td> <div class="para">
						<code class="code">/profile=default/subsystem=transactions/:write-attribute(name=use-hornetq-store,value=false)</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4310-770221+%5BLatest%5D&amp;comment=Title%3A+Configure+the+Transaction+Manager%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4310-770221+14+Sep+2015+07%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-JTA_Transaction_Error_Handling">
      ⁠</a>12.7.9. JTA Transaction Error Handling</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Handle_Transaction_Errors">
      ⁠</a>12.7.9.1. Handle Transaction Errors</h3></div></div></div><div class="para">
		Transaction errors are challenging to solve because they are often dependent on timing. Here are some common errors and ideas for troubleshooting them.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Handle transaction errors</strong></p></div><div class="admonition"><div class="para">
			These guidelines do not apply to heuristic errors. If you experience heuristic errors, refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#Handle_a_Heuristic_Outcome_in_a_JTA_Transaction">Section 12.7.7, “Handle a Heuristic Outcome in a Transaction”</a> and contact Red Hat Global Support Services for assistance.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">The transaction timed out but the business logic thread did not notice</div>
			This type of error often manifests itself when Hibernate is unable to obtain a database connection for lazy loading. If it happens frequently, you can lengthen the timeout value. Refer to <a class="xref" href="chap-Java_Transaction_API_JTA.html#Configure_the_Transaction_Manager1">Section 12.7.8.2, “Configure the Transaction Manager”</a>.
		</div><div class="para">
		If that is not feasible, you may be able to tune your external environment to perform more quickly, or restructure your code to be more efficient. Contact Red Hat Global Support Services if you still have trouble with timeouts.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">The transaction is already running on a thread, or you receive a <code class="code">NotSupportedException</code> exception</div>
			The <code class="code"> NotSupportedException</code> exception usually indicates that you attempted to nest a JTA transaction, and this is not supported. If you were not attempting to nest a transaction, it is likely that another transaction was started in a thread pool task, but finished the task without suspending or ending the transaction.
		</div><div class="para">
		Applications typically use <code class="code"> UserTransaction</code>, which handles this automatically. If so, there may be a problem with a framework.
	</div><div class="para">
		If your code does use <code class="code"> TransactionManager</code> or <code class="code"> Transaction</code> methods directly, be aware of the following behavior when committing or rolling back a transaction. If your code uses <code class="code"> TransactionManager</code> methods to control your transactions, committing or rolling back a transaction disassociates the transaction from the current thread. However, if your code uses <code class="code"> Transaction</code> methods, the transaction may not be associated with the running thread, and you need to disassociate it from its threads manually, before returning it to the thread pool.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">You are unable to enlist a second local resource</div>
			This error happens if you try to enlist a second non-XA resource into a transaction. If you need multiple resources in a transaction, they must be XA.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4376-591665+%5BLatest%5D&amp;comment=Title%3A+Handle+Transaction+Errors%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4376-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-ORB_Configuration">
      ⁠</a>12.8. ORB Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="CORBA">
      ⁠</a>12.8.1. About Common Object Request Broker Architecture (CORBA)</h2></div></div></div><div class="para">
		<em class="firstterm">Common Object Request Broker Architecture (CORBA)</em> is a standard that enables applications and services to work together even when they are written in multiple, otherwise-incompatible, languages or hosted on separate platforms. CORBA requests are brokered by a server-side component called an <em class="firstterm">Object Request Broker (ORB)</em>. JBoss EAP 6 provides an ORB instance, by means of the JacORB component.
	</div><div class="para">
		The ORB is used internally for <em class="firstterm">Java Transaction Service (JTS)</em> transactions, and is also available for use by your own applications.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4979-591675+%5BLatest%5D&amp;comment=Title%3A+About+Common+Object+Request+Broker+Architecture+%28CORBA%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4979-591675+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_ORB_for_JTS_Transactions">
      ⁠</a>12.8.2. Configure the ORB for JTS Transactions</h2></div></div></div><div class="para">
		In a default installation of JBoss EAP 6, the ORB is disabled. You can enable the ORB using the command-line Management CLI.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140550794442240">
      ⁠</a><p class="title"><strong>Procedure 12.6. Configure the ORB using the Management Console</strong></p><ol class="1"><li class="step"><p class="title"><strong>View the profile settings.</strong></p><div class="para">
				Select <span class="guilabel"><strong>Configuration</strong></span> from the top of the management console. If you use a managed domain, select either the <span class="guilabel"><strong>full</strong></span> or <span class="guilabel"><strong>full-ha</strong></span> profile from the selection box at the top left.
			</div></li><li class="step"><p class="title"><strong>Modify the <span class="guilabel"><strong>Initializers</strong></span> Settings</strong></p><div class="para">
				Expand the <span class="guilabel"><strong>Subsystems</strong></span> menu. Expand the <span class="guilabel"><strong>Container</strong></span> menu and select <span class="guilabel"><strong>JacORB</strong></span>.
			</div><div class="para">
				In the form that appears in the main screen, select the <span class="guilabel"><strong>Initializers</strong></span> tab and click the <span class="guilabel"><strong>Edit</strong></span> button.
			</div><div class="para">
				Enable the security interceptors by setting the value of <span class="guilabel"><strong>Security</strong></span> to <code class="literal">on</code>.
			</div><div class="para">
				To enable the ORB for JTS, set the <span class="guilabel"><strong>Transaction Interceptors</strong></span> value to <code class="literal">on</code>, rather than the default <code class="literal">spec</code>.
			</div><div class="para">
				Refer to the <span class="guilabel"><strong>Need Help?</strong></span> link in the form for detailed explanations about these values. Click <span class="guilabel"><strong>Save</strong></span> when you have finished editing the values.
			</div></li><li class="step"><p class="title"><strong>Advanced ORB Configuration</strong></p><div class="para">
				Refer to the other sections of the form for advanced configuration options. Each section includes a <span class="guilabel"><strong>Need Help?</strong></span> link with detailed information about the parameters.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure the ORB using the Management CLI</div>
			You can configure each aspect of the ORB using the Management CLI. The following commands configure the initializers to the same values as the procedure above, for the Management Console. This is the minimum configuration for the ORB to be used with JTS.
		</div><div class="para">
		These commands are configured for a managed domain using the <span class="guilabel"><strong>full</strong></span> profile. If necessary, change the profile to suit the one you need to configure. If you use a standalone server, omit the <code class="literal">/profile=full</code> portion of the commands.
	</div><div class="example"><a id="idm140550724526096">
      ⁠</a><p class="title"><strong>Example 12.4. Enable the Security Interceptors</strong></p><div class="example-contents"><pre class="screen">/profile=<em class="replaceable">full</em>/subsystem=jacorb/:write-attribute(name=security,value=on)</pre></div></div><div class="example"><a id="idm140550783043968">
      ⁠</a><p class="title"><strong>Example 12.5. Enable Transactions in the JacORB Subsystem</strong></p><div class="example-contents"><pre class="screen">/profile=<em class="replaceable">full</em>/subsystem=jacorb/:write-attribute(name=transactions,value=on)</pre></div></div><div class="example"><a id="idm140550771762384">
      ⁠</a><p class="title"><strong>Example 12.6. Enable JTS in the Transaction Subsystem</strong></p><div class="example-contents"><pre class="screen">/profile=<em class="replaceable">full</em>/subsystem=transactions:write-attribute(name=jts,value=true)</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			For JTS activation, the server must be restarted as reload is not enough.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4981-766792+%5BLatest%5D&amp;comment=Title%3A+Configure+the+ORB+for+JTS+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4981-766792+05+Aug+2015+07%3A33+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Transaction_References">
      ⁠</a>12.9. Transaction References</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="JBoss_Transactions_Errors_and_Exceptions">
      ⁠</a>12.9.1. JBoss Transactions Errors and Exceptions</h2></div></div></div><div class="para">
		For details about exceptions thrown by methods of the <code class="classname">UserTransaction</code> class, see the <em class="citetitle">UserTransaction API</em> specification at <a href="http://docs.oracle.com/javaee/6/api/javax/transaction/UserTransaction.html">http://docs.oracle.com/javaee/6/api/javax/transaction/UserTransaction.html</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4299-689191+%5BLatest%5D&amp;comment=Title%3A+JBoss+Transactions+Errors+and+Exceptions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4299-689191+30+Jul+2014+02%3A47+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="JTA_Transaction_Example">
      ⁠</a>12.9.2. JTA Transaction Example</h2></div></div></div><div class="para">
		This example illustrates how to begin, commit, and roll back a JTA transaction. You need to adjust the connection and datasource parameters to suit your environment, and set up two test tables in your database.
	</div><div class="example"><a id="idm140550739048016">
      ⁠</a><p class="title"><strong>Example 12.7. JTA Transaction example</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> JDBCExample {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span> (String[] args) {
<span xmlns="" class="line">​</span>        Context ctx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Change these two lines to suit your environment.</span>
<span xmlns="" class="line">​</span>        DataSource ds = (DataSource)ctx.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"jdbc/ExampleDS"</span>);
<span xmlns="" class="line">​</span>        Connection conn = ds.<span xmlns="" class="perl_Function">getConnection</span>(<span xmlns="" class="perl_String">"testuser"</span>, <span xmlns="" class="perl_String">"testpwd"</span>);
<span xmlns="" class="line">​</span>        Statement stmt = <span xmlns="" class="perl_Keyword">null</span>; <span xmlns="" class="perl_Comment">// Non-transactional statement</span>
<span xmlns="" class="line">​</span>        Statement stmtx = <span xmlns="" class="perl_Keyword">null</span>; <span xmlns="" class="perl_Comment">// Transactional statement</span>
<span xmlns="" class="line">​</span>        Properties dbProperties = <span xmlns="" class="perl_Keyword">new</span> Properties();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Get a UserTransaction</span>
<span xmlns="" class="line">​</span>        UserTransaction txn = <span xmlns="" class="perl_Keyword">new</span> InitialContext().<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"java:comp/UserTransaction"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            stmt = conn.<span xmlns="" class="perl_Function">createStatement</span>();  <span xmlns="" class="perl_Comment">// non-tx statement</span>
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// Check the database connection.</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>                stmt.<span xmlns="" class="perl_Function">executeUpdate</span>(<span xmlns="" class="perl_String">"DROP TABLE test_table"</span>);
<span xmlns="" class="line">​</span>                stmt.<span xmlns="" class="perl_Function">executeUpdate</span>(<span xmlns="" class="perl_String">"DROP TABLE test_table2"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Comment">// assume not in database.</span>
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>                stmt.<span xmlns="" class="perl_Function">executeUpdate</span>(<span xmlns="" class="perl_String">"CREATE TABLE test_table (a INTEGER,b INTEGER)"</span>);
<span xmlns="" class="line">​</span>                stmt.<span xmlns="" class="perl_Function">executeUpdate</span>(<span xmlns="" class="perl_String">"CREATE TABLE test_table2 (a INTEGER,b INTEGER)"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Starting top-level transaction."</span>);
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                txn.<span xmlns="" class="perl_Function">begin</span>();
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                stmtx = conn.<span xmlns="" class="perl_Function">createStatement</span>(); <span xmlns="" class="perl_Comment">// will be a tx-statement</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Comment">// First, we try to roll back changes</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Adding entries to table 1."</span>);
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                stmtx.<span xmlns="" class="perl_Function">executeUpdate</span>(<span xmlns="" class="perl_String">"INSERT INTO test_table (a, b) VALUES (1,2)"</span>);
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                ResultSet res1 = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Inspecting table 1."</span>);
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                res1 = stmtx.<span xmlns="" class="perl_Function">executeQuery</span>(<span xmlns="" class="perl_String">"SELECT * FROM test_table"</span>);
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">while</span> (res1.<span xmlns="" class="perl_Function">next</span>()) {
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 1: "</span>+res1.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">1</span>));
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 2: "</span>+res1.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">2</span>));
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Adding entries to table 2."</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                stmtx.<span xmlns="" class="perl_Function">executeUpdate</span>(<span xmlns="" class="perl_String">"INSERT INTO test_table2 (a, b) VALUES (3,4)"</span>);
<span xmlns="" class="line">​</span>                res1 = stmtx.<span xmlns="" class="perl_Function">executeQuery</span>(<span xmlns="" class="perl_String">"SELECT * FROM test_table2"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Inspecting table 2."</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">while</span> (res1.<span xmlns="" class="perl_Function">next</span>()) {
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 1: "</span>+res1.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">1</span>));
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 2: "</span>+res1.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">2</span>));
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">print</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Now attempting to rollback changes."</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                txn.<span xmlns="" class="perl_Function">rollback</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Comment">// Next, we try to commit changes</span>
<span xmlns="" class="line">​</span>                txn.<span xmlns="" class="perl_Function">begin</span>();
<span xmlns="" class="line">​</span>                stmtx = conn.<span xmlns="" class="perl_Function">createStatement</span>();
<span xmlns="" class="line">​</span>                ResultSet res2 = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Now checking state of table 1."</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                res2 = stmtx.<span xmlns="" class="perl_Function">executeQuery</span>(<span xmlns="" class="perl_String">"SELECT * FROM test_table"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">while</span> (res2.<span xmlns="" class="perl_Function">next</span>()) {
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 1: "</span>+res2.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">1</span>));
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 2: "</span>+res2.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">2</span>));
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"</span><span xmlns="" class="perl_Char">\n</span><span xmlns="" class="perl_String">Now checking state of table 2."</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                stmtx = conn.<span xmlns="" class="perl_Function">createStatement</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                res2 = stmtx.<span xmlns="" class="perl_Function">executeQuery</span>(<span xmlns="" class="perl_String">"SELECT * FROM test_table2"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">while</span> (res2.<span xmlns="" class="perl_Function">next</span>()) {
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 1: "</span>+res2.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">1</span>));
<span xmlns="" class="line">​</span>                    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Column 2: "</span>+res2.<span xmlns="" class="perl_Function">getInt</span>(<span xmlns="" class="perl_Float">2</span>));
<span xmlns="" class="line">​</span>                }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>                txn.<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">catch</span> (Exception ex) {
<span xmlns="" class="line">​</span>                ex.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">exit</span>(<span xmlns="" class="perl_Float">0</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">catch</span> (Exception sysEx) {
<span xmlns="" class="line">​</span>            sysEx.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>            System.<span xmlns="" class="perl_Function">exit</span>(<span xmlns="" class="perl_Float">0</span>);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }      
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4314-591659+%5BLatest%5D&amp;comment=Title%3A+JTA+Transaction+Example%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4314-591659+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="API_Documentation_for_JBoss_Transactions_JTA">
      ⁠</a>12.9.3. API Documentation for JBoss Transactions JTA</h2></div></div></div><div class="para">
		The API documentation for the Transaction subsystem of JBoss EAP 6 is available at the following location:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				UserTransaction - <a href="http://docs.oracle.com/javaee/6/api/javax/transaction/UserTransaction.html">http://docs.oracle.com/javaee/6/api/javax/transaction/UserTransaction.html</a>
			</div></li></ul></div><div class="para">
		If you use Red Hat JBoss Developer Studio to develop your applications, the API documentation is included in the <span class="guilabel"><strong>Help</strong></span> menu.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+4315-689193+%5BLatest%5D&amp;comment=Title%3A+API+Documentation+for+JBoss+Transactions+JTA%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4315-689193+30+Jul+2014+02%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Limitations_of_the_XA_Recovery_Process">
      ⁠</a>12.9.4. Limitations of the XA Recovery Process</h2></div></div></div><div class="para">
		XA recovery has the following limitations.
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">The transaction log may not be cleared from a successfully committed transaction.</span></dt><dd><div class="para">
					If the JBoss EAP server crashes after an <code class="classname">XAResource</code> commit method successfully completes and commits the transaction, but before the coordinator can update the log, you may see the following warning message in the log when you restart the server: 
<pre class="screen">ARJUNA016037: Could not find new XAResource to use for recovering non-serializable XAResource XAResourceRecord</pre>
					 This is because upon recovery, the JBoss Transaction Manager sees the transaction participants in the log and attempts to retry the commit. Eventually the JBoss Transaction Manager assumes the resources are committed and no longer retries the commit. In this situation, can safely ignore this warning as the transaction is committed and there is no loss of data.
				</div><div class="para">
					To prevent the warning, set the <span class="property">com.arjuna.ats.jta.xaAssumeRecoveryComplete</span> property value to <code class="literal">true</code> . This property is checked whenever a new <code class="classname">XAResource</code> instance cannot be located from any registered <code class="classname">XAResourceRecovery</code> instance. When set to <code class="literal">true</code>, the recovery assumes that a previous commit attempt succeeded and the instance can be removed from the log with no further recovery attempts. This property must be used with care because it is global and when used incorrectly could result in <code class="classname">XAResource</code> instances remaining in an uncommitted state.
				</div></dd><dt><span class="term">Rollback is not called for JTS transaction when a server crashes at the end of XAResource.prepare().</span></dt><dd><div class="para">
					If the JBoss EAP server crashes after the completion of an <code class="classname">XAResource</code> <code class="code">prepare()</code> method call, all of the participating XAResources are locked in the prepared state and remain that way upon server restart, The transaction is not rolled back and the resources remain locked until the transaction times out or a DBA manually rolls back the resources and clears the transaction log.
				</div></dd><dt><span class="term">Periodic recovery can occur on committed transactions.</span></dt><dd><div class="para">
					When the server is under excessive load, the server log may contain the following warning message, followed by a stacktrace: 
<pre class="screen">ARJUNA016027: Local XARecoveryModule.xaRecovery got XA exception XAException.XAER_NOTA: javax.transaction.xa.XAException</pre>

				</div><div class="para">
					Under heavy load, the processing time taken by a transaction can overlap with the timing of the periodic recovery process’s activity. The periodic recovery process detects the transaction still in progress and attempts to initiate a rollback but in fact the transaction continues to completion. At the time the periodic recovery attempts but fails the rollback, it records the rollback failure in the server log. The underlying cause of this issue will be addressed in a future release, but in the meantime a workaround is available.
				</div><div class="para">
					Increase the interval between the two phases of the recovery process by setting the <span class="property">com.arjuna.ats.jta.orphanSafetyInterval</span> property to a value higher than the default value of 10000 milliseconds. A value of 40000 milliseconds is recommended. Please note that this does not solve the issue, instead it decreases the probability that it will occur and that the warning message will be shown in the log.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23088%2C+Red+Hat+Development+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A13%3A01%0ATopic+ID%3A+30617-634590+%5BLatest%5D&amp;comment=Title%3A+Limitations+of+the+XA+Recovery+Process%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30617-634590+29+Apr+2014+20%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>