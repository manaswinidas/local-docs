<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 9. Global Valves</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Global_Valves">
      ⁠</a>Chapter 9. Global Valves</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Valves">
      ⁠</a>9.1. About Valves</h1></div></div></div><div class="para">
		A Valve is a Java class that gets inserted into the request processing pipeline for an application. It is inserted in the pipeline before servlet filters. Valves can make changes to the request before passing it on or perform other processing such as authentication or even canceling the request.
	</div><div class="para">
		Valves can be configured at the server level or at the application level. The only difference is in how they are configured and packaged. 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Global Valves are configured at the server level and apply to all applications deployed to the server. Instructions to configure Global Valves are located in the <em class="citetitle">Administration and Configuration Guide</em> for JBoss EAP.
				</div></li><li class="listitem"><div class="para">
					Valves configured at the application level are packaged with the application deployment and only affect the specific application. Instructions to configure Valves at the application level are located in the <em class="citetitle">Development Guide</em> for JBoss EAP.
				</div></li></ul></div>

	</div><div class="para">
		Version 6.1.0 and later supports global valves.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14168-672932+%5BLatest%5D&amp;comment=Title%3A+About+Valves%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14168-672932+12+Jun+2014+12%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Global_Valves">
      ⁠</a>9.2. About Global Valves</h1></div></div></div><div class="para">
		A Global Valve is a valve that is inserted into the request processing pipeline of all deployed applications. A valve is made global by being packaged and installed as a static module in JBoss EAP 6. Global valves are configured in the web subsystem.
	</div><div class="para">
		Only version 6.1.0 and later supports global valves.
	</div><div class="para">
		For instructions on how to configure Global Valves, see  <a class="xref" href="chap-Global_Valves.html#Configure_a_Global_Valve">Section 9.5, “Configure a Global Valve”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14169-717305+%5BLatest%5D&amp;comment=Title%3A+About+Global+Valves%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14169-717305+17+Oct+2014+12%3A13+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Authenticator_Valves">
      ⁠</a>9.3. About Authenticator Valves</h1></div></div></div><div class="para">
		An authenticator valve is a valve that authenticates the credentials of a request. Such valve is a sub-class of <code class="code">org.apache.catalina.authenticator.AuthenticatorBase</code> and overrides the <code class="code">authenticate(Request request, Response response, LoginConfig config)</code> method.
	</div><div class="para">
		This can be used to implement additional authentication schemes.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14172-592104+%5BLatest%5D&amp;comment=Title%3A+About+Authenticator+Valves%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14172-592104+23+Feb+2014+16%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Install_a_Global_Valve">
      ⁠</a>9.4. Install a Global Valve</h1></div></div></div><div class="para">
		Global valves must be packaged and installed as static modules in JBoss EAP 6. This task shows how to install the module.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Pre-requisities:</strong></p><ul><li class="listitem"><div class="para">
				The valve must already be created and packaged in a JAR file.
			</div></li><li class="listitem"><div class="para">
				A <code class="filename">module.xml</code> file must already be created for the module.
			</div><div class="para">
				Refer to <a class="xref" href="chap-Configuring_Modules.html#Modules">Section 7.1.1, “Modules”</a> for an example of <code class="filename">module.xml</code> file.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978540323696">
      ⁠</a><p class="title"><strong>Procedure 9.1. Install a Global Module</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create module installation directory</strong></p><div class="para">
				A directory for the module to be installed in must be created in the modules directory of the application server.
			</div><pre class="synopsis"><em class="replaceable">EAP_HOME</em>/modules/system/layers/base/<em class="replaceable">MODULENAME</em>/main</pre><pre class="screen">$ mkdir -P <em class="replaceable">EAP_HOME</em>/modules/system/layers/base/<em class="replaceable">MODULENAME</em>/main</pre></li><li class="step"><p class="title"><strong>Copy files</strong></p><div class="para">
				Copy the JAR and <code class="filename">module.xml</code> files to the directory created in step 1.
			</div><pre class="screen">$ cp MyValves.jar module.xml <em class="replaceable">EAP_HOME</em>/modules/system/layers/base/<em class="replaceable">MODULENAME</em>/main</pre></li></ol></div><div class="para">
		The valve classes declared in the module are now available to be configured in the web subsystem.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14170-633500+%5BLatest%5D&amp;comment=Title%3A+Install+a+Global+Valve%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14170-633500+24+Apr+2014+01%3A49+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_a_Global_Valve">
      ⁠</a>9.5. Configure a Global Valve</h1></div></div></div><div class="para">
		Global valves are enabled and configured in the web subsystem. This is done using the JBoss CLI tool.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978442714240">
      ⁠</a><p class="title"><strong>Procedure 9.2. Configure a Global Valve</strong></p><ol class="1"><li class="step"><p class="title"><strong>Enable the Valve</strong></p><div class="para">
				Use the <code class="code">add</code> operation to add a new valve entry.
			</div><pre class="synopsis">/subsystem=web/valve=<em class="replaceable">VALVENAME</em>:add(module="<em class="replaceable">MODULENAME</em>",class-name="<em class="replaceable">CLASSNAME</em>")</pre><div class="para">
				You need to specify the following values:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="code">VALVENAME</code>, the name that is used to refer to this valve in application configuration.
					</div></li><li class="listitem"><div class="para">
						<code class="code">MODULENAME</code>, the module that contains the value being configured.
					</div></li><li class="listitem"><div class="para">
						<code class="code">CLASSNAME</code>, the classname of the specific valve in the module.
					</div></li></ul></div><div class="para">
				For example:
			</div><pre class="screen">/subsystem=web/valve=clientlimiter:add(module="clientlimitermodule",class-name="org.jboss.samplevalves.RestrictedUserAgentsValve")</pre></li><li class="step"><p class="title"><strong>Optionally: Specify Parameters</strong></p><div class="para">
				If the valve has configuration parameters, specify these with the <code class="code">add-param</code> operation.
			</div><pre class="synopsis">/subsystem=web/valve=<em class="replaceable">VALVENAME</em>:add-param(param-name="PARAMNAME", param-value="PARAMVALUE")</pre><div class="para">
				You need to specify the following values:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="code">VALVENAME</code>, the name that is used to refer to this valve in application configuration.
					</div></li><li class="listitem"><div class="para">
						<code class="code">PARAMNAME</code>, the name of the parameter that is being configured for specific valve.
					</div></li><li class="listitem"><div class="para">
						<code class="code">PARAMVALUE</code>, the value of the specified parameter.
					</div></li></ul></div><div class="para">
				For example:
			</div><div class="example"><a id="idm139978545135616">
      ⁠</a><p class="title"><strong>Example 9.1. Valve configuration</strong></p><div class="example-contents"><pre class="screen">/subsystem=web/valve=clientlimiter:add-param(
   param-name="restrictedUserAgents", 
   param-value="^.*MS Web Services Client Protocol.*$"
)</pre></div></div></li></ol></div><div class="para">
		The valve is now enabled and configured for all deployed applications.
	</div><div class="para">
		Refer to <em class="citetitle">Create a Custom Valve</em> section of the <em class="citetitle">Developement Guide</em> for more information on how to create a custom valve.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14171-744768+%5BLatest%5D&amp;comment=Title%3A+Configure+a+Global+Valve%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14171-744768+25+Feb+2015+01%3A21+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></body></html>