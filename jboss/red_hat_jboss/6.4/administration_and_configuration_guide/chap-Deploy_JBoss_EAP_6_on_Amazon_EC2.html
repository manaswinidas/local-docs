<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 24. Deploy JBoss EAP 6 on Amazon EC2</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2">
      ⁠</a>Chapter 24. Deploy JBoss EAP 6 on Amazon EC2</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Introduction2">
      ⁠</a>24.1. Introduction</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Amazon_EC2">
      ⁠</a>24.1.1. About Amazon EC2</h2></div></div></div><div class="para">
		Amazon Elastic Compute Cloud (Amazon EC2) is a service operated by amazon.com that provides customers with a customizable virtual computing environment. An Amazon Machine Image (AMI) can be booted using the service to create a virtual machine or instance. Users can install whatever software they require on an instance and are charged according to the capacity used. Amazon EC2 is designed to be flexible and allow users to quickly scale their deployed applications.
	</div><div class="para">
		You can read more about it at the Amazon EC2 website, <a href="http://aws.amazon.com/ec2/">http://aws.amazon.com/ec2/</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9364-591876+%5BLatest%5D&amp;comment=Title%3A+About+Amazon+EC2%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9364-591876+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Amazon_Machine_Instances_AMIs1">
      ⁠</a>24.1.2. About Amazon Machine Instances (AMIs)</h2></div></div></div><div class="para">
		An Amazon Machine Image (AMI) is a template for a EC2 virtual machine instance. Users create EC2 instances by selecting an appropriate AMI to create the instance from. The primary component of an AMI is a read-only filesystem that contains an installed operating system as well as other software. Each AMI has different software installed for different use cases. Amazon EC2 includes many AMIs to choose from provided by both amazon.com and third parties. Users can also create their own custom AMIs.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9365-591876+%5BLatest%5D&amp;comment=Title%3A+About+Amazon+Machine+Instances+%28AMIs%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9365-591876+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_JBoss_Cloud_Access1">
      ⁠</a>24.1.3. About JBoss Cloud Access</h2></div></div></div><div class="para">
		JBoss Cloud Access is a Red Hat subscription feature that provides support for JBoss EAP 6 on Red Hat certified cloud infrastructure providers such as Amazon EC2. JBoss Cloud Access allows you to move your subscriptions between traditional servers and public cloud-based resources in a simple and cost-effective manner.
	</div><div class="para">
		You can find out more details about it at <a href="http://www.redhat.com/en/technologies/cloud-computing/cloud-access">http://www.redhat.com/en/technologies/cloud-computing/cloud-access</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9366-764122+%5BLatest%5D&amp;comment=Title%3A+About+JBoss+Cloud+Access%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9366-764122+07+Jul+2015+08%3A53+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="JBoss_Cloud_Access_Features1">
      ⁠</a>24.1.4. JBoss Cloud Access Features</h2></div></div></div><div class="para">
		Membership in the JBoss Cloud Access program provides access to supported private Amazon Machine Images (AMIs) created by Red Hat.
	</div><div class="para">
		The Red Hat AMIs have the following software pre-installed and fully supported by Red hat:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Red Hat Enterprise Linux 6
			</div></li><li class="listitem"><div class="para">
				JBoss EAP 6
			</div></li><li class="listitem"><div class="para">
				The JBoss Operations Network (JON) 3 agent
			</div></li><li class="listitem"><div class="para">
				Product updates with RPMs using Red Hat Update Infrastructure.
			</div></li></ul></div><div class="para">
		Each of the Red Hat AMIs are only a starting point, requiring further configuration to the requirements of your application.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			JBoss Cloud Access does not currently provide support for the full-ha profile, in either standalone instances or a managed domain.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9367-623236+%5BLatest%5D&amp;comment=Title%3A+JBoss+Cloud+Access+Features%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9367-623236+21+Mar+2014+06%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Supported_Amazon_EC2_Instance_Types">
      ⁠</a>24.1.5. Supported Amazon EC2 Instance Types</h2></div></div></div><div class="para">
		JBoss Cloud Access supports the following Amazon EC2 instance types. Refer to the <em class="citetitle">Amazon EC2 User Guide</em> for more details about each instance type, <a href="http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/instance-types.html">http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/instance-types.html</a>.
	</div><div class="table"><a id="table-Supported_Amazon_EC2_Instance_Types">
      ⁠</a><p class="title"><strong>Table 24.1. Supported Amazon EC2 Instance Types</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Supported Amazon EC2 Instance Types"><colgroup><col width="25%" style="text-align: left" class="c1"/><col width="75%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Instance Type </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> Standard Instance </td><td style="text-align: left"> <div class="para">
						Standard Instances are general purpose environments with a balanced memory-to-CPU ratio.
					</div>
					 </td></tr><tr><td style="text-align: left"> High Memory Instance </td><td style="text-align: left"> <div class="para">
						High Memory Instances have more memory allocated to them than Standard Instances. High Memory Instances are suited for high throughput applications such as databases or memory caching applications.
					</div>
					 </td></tr><tr><td style="text-align: left"> High CPU Instance </td><td style="text-align: left"> <div class="para">
						High CPU Instances have more CPU resources allocated than memory and are suited for relatively low throughput but CPU intensive applications.
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			The instance type <code class="systemitem">Micro (t1.micro)</code> is not suitable for deployment of JBoss EAP 6.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9368-591876+%5BLatest%5D&amp;comment=Title%3A+Supported+Amazon+EC2+Instance+Types%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9368-591876+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Supported_Red_Hat_AMIs1">
      ⁠</a>24.1.6. Supported Red Hat AMIs</h2></div></div></div><div class="para">
		The supported Red Hat AMIs can be identified by their AMI Name.
	</div><div class="para">
		The JBoss EAP 6 AMIs are named using the following syntax:
	</div><pre class="synopsis"> RHEL-<em class="replaceable">osversion</em>-JBEAP-<em class="replaceable">version</em>-<em class="replaceable">arch</em>-<em class="replaceable">creationdate</em> </pre><div class="para">
		<em class="replaceable">version</em> is the version number of JBoss EAP installed in the AMI. Example <code class="literal">6.3</code>.
	</div><div class="para">
		<em class="replaceable">osversion</em> is the version number of Red Hat Enterprise Linux installed in the AMI. Example <code class="literal">6.2</code>.
	</div><div class="para">
		<em class="replaceable">arch</em> is the architecture of the AMI. This will be <code class="literal">x86_64</code> or <code class="literal">i386</code>.
	</div><div class="para">
		<em class="replaceable">creationdate</em> is the date that the AMI was created in the format of <em class="replaceable">YYYYMMDD</em>. Example <code class="literal">20120501</code>.
	</div><div class="para">
		Example AMI name: <code class="literal">RHEL-6.2-JBEAP-6.0.0-x86_64-20120501</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9369-697699+%5BLatest%5D&amp;comment=Title%3A+Supported+Red+Hat+AMIs%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9369-697699+11+Aug+2014+20%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Deploying_JBoss_EAP_6_on_Amazon_EC2">
      ⁠</a>24.2. Deploying JBoss EAP 6 on Amazon EC2</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Overview_of_Deploying_JBoss_Enterprise_Application_Platform_6_on_Amazon_EC2">
      ⁠</a>24.2.1. Overview of Deploying JBoss EAP 6 on Amazon EC2</h2></div></div></div><div class="para">
		JBoss EAP 6 can be deployed using the Amazon EC2 AMI. The AMI contains everything that is required for deployment of clustered and non-clustered instances.
	</div><div class="para">
		Deploying a non-clustered instance is the easiest scenario. It requires only that you make a few configuration changes to specify your application deployment when creating the instance.
	</div><div class="para">
		Deploying clustered instances requires more configuration. It is recommended you create a Virtual Private Cloud to contain your cluster. Use of a JBoss EAP instance to act as a mod_cluster proxy is optional but if you take this option, an S3 bucket for the S3_PING JGroups discovery protocol is also required.
	</div><div class="para">
		Each of these steps is detailed below but it is assumed that you have some experience with JBoss EAP 6, Red Hat Enterprise Linux 6 and Amazon EC2.
	</div><div class="para">
		The following documentation is recommended additional reference:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				JBoss EAP 6
			</div><div class="para">
				<a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/?version=6.4">https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/?version=6.4</a>
			</div></li><li class="listitem"><div class="para">
				Red Hat Enterprise Linux 6
			</div><div class="para">
				<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/</a>
			</div></li><li class="listitem"><div class="para">
				Amazon Web Services
			</div><div class="para">
				<a href="http://aws.amazon.com/documentation/">http://aws.amazon.com/documentation/</a>
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9370-781529+%5BLatest%5D&amp;comment=Title%3A+Overview+of+Deploying+JBoss+EAP+6+on+Amazon+EC2%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9370-781529+08+Nov+2017+13%3A36+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Non-clustered_JBoss_EAP_6">
      ⁠</a>24.3. Non-clustered JBoss EAP 6</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Non-clustered_Instances1">
      ⁠</a>24.3.1. About Non-clustered Instances</h2></div></div></div><div class="para">
		A non-clustered instance is a single Amazon EC2 instance running JBoss EAP 6. It is not part of a cluster.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9371-591876+%5BLatest%5D&amp;comment=Title%3A+About+Non-clustered+Instances%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9371-591876+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Non-clustered_Instances">
      ⁠</a>24.4. Non-clustered Instances</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_a_Non-clustered_JBoss_Enterprise_Application_Platform_6_Instance">
      ⁠</a>24.4.1. Launch a Non-clustered JBoss EAP 6 Instance</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch a non-clustered instance of JBoss EAP 6 on a Red Hat AMI (Amazon Machine Image).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A suitable Red Hat AMI. Refer to <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Supported_Red_Hat_AMIs1">Section 24.1.6, “Supported Red Hat AMIs”</a>.
			</div></li><li class="listitem"><div class="para">
				A pre-configured Security Group which allows incoming requests on at least ports 22, 8080, and 9990.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978445486528">
      ⁠</a><p class="title"><strong>Procedure 24.1. Launch a Non-clustered Instance of JBoss EAP 6 on a Red Hat AMI (Amazon Machine Image)</strong></p><ol class="1"><li class="step"><div class="para">
				Configure the <code class="code">User Data</code> field. The configurable parameters are available here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Permanent_Script_Parameters">Section 24.10.1, “Permanent Configuration Parameters”</a>, <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Custom_Script_Parameters1">Section 24.10.2, “Custom Script Parameters”</a>.
			</div><div class="example"><a id="idm139978514191648">
      ⁠</a><p class="title"><strong>Example 24.1. Example User Data Field</strong></p><div class="example-contents"><div class="para">
					The example shows the User Data field for a non-clustered JBoss EAP 6 instance. The password for the user <code class="code">admin</code> has been set to <code class="code">adminpwd</code>.
				</div><pre class="programlisting">
JBOSSAS_ADMIN_PASSWORD=adminpwd
JBOSS_IP=0.0.0.0 #listen on all IPs and interfaces

# In production, access to these ports needs to be restricted for security reasons
PORTS_ALLOWED="9990 9443"

cat&gt; $USER_SCRIPT &lt;&lt; "EOF"

# Get the application to be deployed from an Internet URL
# mkdir -p /usr/share/java/jboss-ec2-eap-applications
# wget https://&lt;your secure storage hostname&gt;/&lt;path&gt;/&lt;app name&gt;.war -O /usr/share/java/jboss-ec2-eap-applications/&lt;app name&gt;.war 

# Create a file of CLI commands to be executed after starting the server
cat&gt; $USER_CLI_COMMANDS &lt;&lt; "EOC" 
# deploy /usr/share/java/jboss-ec2-eap-applications/&lt;app name&gt;.war
EOC

EOF
</pre></div></div></li><li class="step optional"><p class="title"><strong>For Production Instances</strong></p><div class="para">
				For a production instance, add the following line beneath the <code class="code">USER_SCRIPT</code> line of the <code class="code">User Data</code> field, to ensure security updates are applied on boot.
			</div><pre class="screen">yum -y update</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="command">yum -y update</code> should be run regularly, to apply security fixes and enhancements.
				</div></div></div></li><li class="step"><div class="para">
				Launch the Red Hat AMI instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			A non-clustered instance of JBoss EAP 6 has been configured, and launched on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9372-715942+%5BLatest%5D&amp;comment=Title%3A+Launch+a+Non-clustered+JBoss+EAP+6+Instance%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9372-715942+09+Oct+2014+23%3A49+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Deploy_an_Application_on_a_non-clustered_JBoss_Enterprise_Application_Platform_Instance">
      ⁠</a>24.4.2. Deploy an Application on a non-clustered JBoss EAP 6 Instance</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers deploying an application to a non-clustered JBoss EAP 6 instance on a Red Hat AMI.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Deploy the Sample Application</strong></p><div class="para">
						Add the following lines to the <code class="code">User Data</code> field:
					</div><pre class="screen">
# Deploy the sample application from the local filesystem
deploy --force /usr/share/java/jboss-ec2-eap-samples/hello.war
</pre><div class="example"><a id="idm139978440453760">
      ⁠</a><p class="title"><strong>Example 24.2. Example User Data Field with Sample Application</strong></p><div class="example-contents"><div class="para">
							This example uses the sample application provided on the Red Hat AMI. It also includes basic configuration for a non-clustered JBoss EAP 6 instance. The password for the user <code class="code">admin</code> has been set to <code class="code">adminpwd</code>.
						</div><pre class="programlisting">
JBOSSAS_ADMIN_PASSWORD=adminpwd
JBOSS_IP=0.0.0.0 #listen on all IPs and interfaces

# In production, access to these ports needs to be restricted for security reasons
PORTS_ALLOWED="9990 9443"

cat&gt; $USER_SCRIPT &lt;&lt; "EOF"

# Create a file of CLI commands to be executed after starting the server
cat&gt; $USER_CLI_COMMANDS &lt;&lt; "EOC" 

# Deploy the sample application from the local filesystem
deploy --force /usr/share/java/jboss-ec2-eap-samples/hello.war
EOC

EOF
</pre></div></div></li>
				 <li class="step"><p class="title"><strong>Deploy a Custom Application</strong></p><div class="para">
						Add the following lines to the <code class="code">User Data</code> field, configuring the application name and the URL:
					</div><pre class="screen">
# Get the application to be deployed from an Internet URL
mkdir -p /usr/share/java/jboss-ec2-eap-applications
wget https://&lt;your secure storage hostname&gt;/&lt;path&gt;/&lt;app name&gt;.war -O /usr/share/java/jboss-ec2-eap-applications/&lt;app name&gt;.war
</pre><div class="example"><a id="idm139978468856736">
      ⁠</a><p class="title"><strong>Example 24.3. Example User Data Field with Custom Application</strong></p><div class="example-contents"><div class="para">
							This example uses an application called <code class="code">MyApp</code>, and includes basic configuration for a non-clustered JBoss EAP 6 instance. The password for the user <code class="code">admin</code> has been set to <code class="code">adminpwd</code>.
						</div><pre class="programlisting">
JBOSSAS_ADMIN_PASSWORD=adminpwd
JBOSS_IP=0.0.0.0 #listen on all IPs and interfaces

# In production, access to these ports needs to be restricted for security reasons
PORTS_ALLOWED="9990 9443"

cat&gt; $USER_SCRIPT &lt;&lt; "EOF"

# Get the application to be deployed from an Internet URL
mkdir -p /usr/share/java/jboss-ec2-eap-applications
wget https://PATH_TO_MYAPP/MyApp.war -O /usr/share/java/jboss-ec2-eap-applications/MyApp.war 

# Create a file of CLI commands to be executed after starting the server
cat&gt; $USER_CLI_COMMANDS &lt;&lt; "EOC" 
deploy /usr/share/java/jboss-ec2-eap-applications/MyApp.war
EOC

EOF
</pre></div></div></li>

			</ul></li><li class="step"><div class="para">
				Launch the Red Hat AMI instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The application has been successfully deployed to JBoss EAP 6.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9401-591878+%5BLatest%5D&amp;comment=Title%3A+Deploy+an+Application+on+a+non-clustered+JBoss+EAP+6+Instance%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9401-591878+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Test_the_Non-clustered_JBoss_Enterprise_Application_Platform_6_Instance1">
      ⁠</a>24.4.3. Test the Non-clustered JBoss EAP 6 Instance</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to test that the non-clustered JBoss EAP 6 is running correctly.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978447093376">
      ⁠</a><p class="title"><strong>Procedure 24.2. Test the Non-clustered JBoss EAP 6 Instance is Running Correctly</strong></p><ol class="1"><li class="step"><div class="para">
				Determine the instance's <code class="literal">Public DNS</code>, located in the instance's details pane.
			</div></li><li class="step"><div class="para">
				Navigate to <code class="code">http://&lt;<em class="replaceable">public-DNS</em>&gt;:8080</code>.
			</div></li><li class="step"><div class="para">
				Confirm that the JBoss EAP home page appears, including a link to the Admin console. If the home page is not available, refer here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#About_Troubleshooting_Amazon_EC2">Section 24.11.1, “About Troubleshooting Amazon EC2”</a>.
			</div></li><li class="step"><div class="para">
				Click on the <span class="guilabel"><strong>Admin Console</strong></span> hyperlink.
			</div></li><li class="step"><div class="para">
				Log in:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Username: <code class="literal">admin</code>
					</div></li><li class="listitem"><div class="para">
						Password: Specified in the <code class="code">User Data</code> field here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_a_Non-clustered_JBoss_Enterprise_Application_Platform_6_Instance">Section 24.4.1, “Launch a Non-clustered JBoss EAP 6 Instance”</a>.
					</div></li></ul></div></li><li class="step optional"><p class="title"><strong>Test the Sample Application</strong></p><div class="para">
				Navigate to <code class="code">http://&lt;<em class="replaceable">public-DNS</em>&gt;:8080/hello</code> to test that the sample application is running successfully. The text <code class="literal">Hello World!</code> should appear in the browser. If the text is not visible, refer here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#About_Troubleshooting_Amazon_EC2">Section 24.11.1, “About Troubleshooting Amazon EC2”</a>.
			</div></li><li class="step"><div class="para">
				Log out of the JBoss EAP 6 Admin Console.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The JBoss EAP 6 instance is running correctly.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9373-715943+%5BLatest%5D&amp;comment=Title%3A+Test+the+Non-clustered+JBoss+EAP+6+Instance%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9373-715943+09+Oct+2014+23%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Non-clustered_Managed_Domains">
      ⁠</a>24.5. Non-clustered Managed Domains</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_an_Instance_to_Serve_as_a_Domain_Controller">
      ⁠</a>24.5.1. Launch an Instance to Serve as a Domain Controller</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch a non-clustered JBoss EAP 6 managed domain on a Red Hat AMI (Amazon Machine Image).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A suitable Red Hat AMI. Refer to <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Supported_Red_Hat_AMIs1">Section 24.1.6, “Supported Red Hat AMIs”</a>.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Create_a_Virtual_Private_Cloud_VPC">Section 24.6.3, “Create a Virtual Private Cloud (VPC)”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Apache_HTTPD_instance_to_serve_as_a_mod_cluster_proxy_and_a_NAT_instance_for_the_VPC">Section 24.6.4, “Launch an Apache HTTP Server Instance to Serve as a mod_cluster Proxy and a NAT Instance for the VPC”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_the_VPC_Private_Subnet_Default_Route">Section 24.6.5, “Configure the VPC Private Subnet Default Route”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_S3_Bucket_Setup1">Section 24.6.9, “Configure S3 Bucket Setup”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978500193440">
      ⁠</a><p class="title"><strong>Procedure 24.3. Launch a non-clustered JBoss EAP 6 managed domain on a Red Hat AMI</strong></p><ol class="1"><li class="step"><div class="para">
				In the Security Group tab, ensure all traffic is allowed. Red Hat Enterprise Linux's built-in firewall capabilities can be used to restrict access if desired.
			</div></li><li class="step"><div class="para">
				Set the public subnet of the VPC to <span class="emphasis"><em>running</em></span>.
			</div></li><li class="step"><div class="para">
				Select a static IP.
			</div></li><li class="step"><div class="para">
				Configure the <code class="code">User Data</code> field. The configurable parameters are available here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Permanent_Script_Parameters">Section 24.10.1, “Permanent Configuration Parameters”</a>, <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Custom_Script_Parameters1">Section 24.10.2, “Custom Script Parameters”</a>. For further information on domain controller discovery on Amazon EC2, see <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configuring_Domain_Controller_Discovery_and_Failover_on_Amazon_EC2">Section 24.5.4, “Configuring Domain Controller Discovery and Failover on Amazon EC2”</a>.
			</div><div class="example"><a id="idm139978472322320">
      ⁠</a><p class="title"><strong>Example 24.4. Example User Data Field</strong></p><div class="example-contents"><div class="para">
					The example shows the User Data field for a non-clustered JBoss EAP 6 managed domain. The password for the user <code class="code">admin</code> has been set to <code class="code">admin</code>.
				</div><pre class="programlisting">
## password that will be used by slave host controllers to connect to the domain controller
JBOSSAS_ADMIN_PASSWORD=admin

## subnet prefix this machine is connected to
SUBNET=10.0.0.

## S3 domain controller discovery setup
# JBOSS_DOMAIN_S3_SECRET_ACCESS_KEY=&lt;your secret key&gt;
# JBOSS_DOMAIN_S3_ACCESS_KEY=&lt;your access key&gt;
# JBOSS_DOMAIN_S3_BUCKET=&lt;your bucket name&gt;

#### to run the example no modifications below should be needed ####
JBOSS_DOMAIN_CONTROLLER=true
PORTS_ALLOWED="9999 9990 9443"
JBOSS_IP=`hostname | sed -e 's/ip-//' -e 'y/-/./'` #listen on public/private EC2 IP address

cat &gt; $USER_SCRIPT &lt;&lt; "EOF"
## Get the application to be deployed from an Internet URL
# mkdir -p /usr/share/java/jboss-ec2-eap-applications
# wget https://&lt;your secure storage hostname&gt;/&lt;path&gt;/&lt;app name&gt;.war -O /usr/share/java/jboss-ec2-eap-applications/&lt;app name&gt;.war

## Create a file of CLI commands to be executed after starting the server
cat&gt; $USER_CLI_COMMANDS &lt;&lt; "EOC" 

# Add the modcluster subsystem to the default profile to set up a proxy
/profile=default/subsystem=web/connector=ajp:add(name=ajp,protocol=AJP/1.3,scheme=http,socket-binding=ajp)
/:composite(steps=[ {"operation" =&gt; "add", "address" =&gt; [ ("profile" =&gt; "default"), ("subsystem" =&gt; "modcluster") ] },{ "operation" =&gt; "add", "address" =&gt; [ ("profile" =&gt; "default"), ("subsystem" =&gt; "modcluster"), ("mod-cluster-config" =&gt; "configuration") ], "advertise" =&gt; "false", "proxy-list" =&gt; "${jboss.modcluster.proxyList}", "connector" =&gt; "ajp"}, { "operation" =&gt; "add", "address" =&gt; [ ("profile" =&gt; "default"), ("subsystem" =&gt; "modcluster"), ("mod-cluster-config" =&gt; "configuration"), ("dynamic-load-provider" =&gt; "configuration") ]}, { "operation" =&gt; "add", "address" =&gt; [ ("profile" =&gt; "default"), ("subsystem" =&gt; "modcluster"), ("mod-cluster-config" =&gt; "configuration"), ("dynamic-load-provider" =&gt; "configuration"), ("load-metric" =&gt; "busyness")], "type" =&gt; "busyness"} ])

# Deploy the sample application from the local filesystem
deploy /usr/share/java/jboss-ec2-eap-samples/hello.war --server-groups=main-server-group
EOC

## this will workaround the problem that in a VPC, instance hostnames are not resolvable
echo -e "127.0.0.1\tlocalhost.localdomain localhost" &gt; /etc/hosts
echo -e "::1\tlocalhost6.localdomain6 localhost6" &gt;&gt; /etc/hosts
for (( i=1 ; i&lt;255 ; i++ )); do
   echo -e "$SUBNET$i\tip-${SUBNET//./-}$i" ;
done &gt;&gt; /etc/hosts

EOF
</pre></div></div></li><li class="step optional"><p class="title"><strong>For Production Instances</strong></p><div class="para">
				For a production instance, add the following line beneath the <code class="code">USER_SCRIPT</code> line of the <code class="code">User Data</code> field, to ensure security updates are applied on boot.
			</div><pre class="screen">yum -y update</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="command">yum -y update</code> should be run regularly, to apply security fixes and enhancements.
				</div></div></div></li><li class="step"><div class="para">
				Launch the Red Hat AMI instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			A non-clustered JBoss EAP 6 managed domain has been configured, and launched on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+12696-682293+%5BLatest%5D&amp;comment=Title%3A+Launch+an+Instance+to+Serve+as+a+Domain+Controller%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=12696-682293+07+Jul+2014+23%3A51+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_One_or_More_Instances_to_Serve_as_Host_Controllers">
      ⁠</a>24.5.2. Launch One or More Instances to Serve as Host Controllers</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch one or more instances of JBoss EAP 6 to serve as non-clustered host controllers on a Red Hat AMI (Amazon Machine Image).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Configure and launch the non-clustered domain controller. Refer to <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Instance_to_Serve_as_a_Domain_Controller">Section 24.5.1, “Launch an Instance to Serve as a Domain Controller”</a> .
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_S3_Bucket_Setup1">Section 24.6.9, “Configure S3 Bucket Setup”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978473368720">
      ⁠</a><p class="title"><strong>Procedure 24.4. Launch Host Controllers</strong></p><div class="para">
			For each instance you would like to create, repeat the following steps:
		</div><ol class="1"><li class="step"><div class="para">
				Select an AMI.
			</div></li><li class="step"><div class="para">
				Define the desired number of instances (the number of slave host controllers).
			</div></li><li class="step"><div class="para">
				Select the VPC and instance type.
			</div></li><li class="step"><div class="para">
				Click on Security Group.
			</div></li><li class="step"><div class="para">
				Ensure that all traffic from the JBoss EAP 6 subnet is allowed.
			</div></li><li class="step"><div class="para">
				Define other restrictions as desired.
			</div></li><li class="step"><div class="para">
				Add the following into the User Data field:
			</div><pre class="programlisting">## mod cluster proxy addresses
MOD_CLUSTER_PROXY_LIST=10.0.0.4:7654

## host controller setup
### static domain controller discovery setup
JBOSS_DOMAIN_MASTER_ADDRESS=10.0.0.5
### S3 domain controller discovery setup
# JBOSS_DOMAIN_S3_SECRET_ACCESS_KEY=&lt;your secret key&gt;
# JBOSS_DOMAIN_S3_ACCESS_KEY=&lt;your access key&gt;
# JBOSS_DOMAIN_S3_BUCKET=&lt;your bucket name&gt;

JBOSS_HOST_PASSWORD=&lt;password for slave host controllers&gt;

## subnet prefix this machine is connected to
SUBNET=10.0.1.

#### to run the example no modifications below should be needed ####
JBOSS_HOST_USERNAME=admin
PORTS_ALLOWED="1024:65535"
JBOSS_IP=`hostname | sed -e 's/ip-//' -e 'y/-/./'` #listen on public/private EC2 IP address

cat &gt; $USER_SCRIPT &lt;&lt; "EOF"
## Server instance configuration
sed -i "s/other-server-group/main-server-group/" $JBOSS_CONFIG_DIR/$JBOSS_HOST_CONFIG

## this will workaround the problem that in a VPC, instance hostnames are not resolvable
echo -e "127.0.0.1\tlocalhost.localdomain localhost" &gt; /etc/hosts
echo -e "::1\tlocalhost6.localdomain6 localhost6" &gt;&gt; /etc/hosts
for (( i=1 ; i&lt;255 ; i++ )); do
    echo -e "$SUBNET$i\tip-${SUBNET//./-}$i" ;
done &gt;&gt; /etc/hosts

EOF</pre><div class="para">
				For further information on domain controller discovery on Amazon EC2, see <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configuring_Domain_Controller_Discovery_and_Failover_on_Amazon_EC2">Section 24.5.4, “Configuring Domain Controller Discovery and Failover on Amazon EC2”</a>.
			</div></li><li class="step optional"><p class="title"><strong>For Production Instances</strong></p><div class="para">
				For a production instance, add the following line beneath the <code class="code">USER_SCRIPT</code> line of the <code class="code">User Data</code> field, to ensure security updates are applied on boot.
			</div><pre class="screen">yum -y update</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="command">yum -y update</code> should be run regularly, to apply security fixes and enhancements.
				</div></div></div></li><li class="step"><div class="para">
				Launch the Red Hat AMI instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The JBoss EAP 6 non-clustered host controllers are configured and launched on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+12720-682294+%5BLatest%5D&amp;comment=Title%3A+Launch+One+or+More+Instances+to+Serve+as+Host+Controllers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=12720-682294+07+Jul+2014+23%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Test_the_Non-Clustered_JBoss_Enterprise_Application_Platform_6_Managed_Domain">
      ⁠</a>24.5.3. Test the Non-Clustered JBoss EAP 6 Managed Domain</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to test the non-clustered JBoss EAP 6 managed domain on a Red Hat AMI (Amazon Machine Image).
		</div><div class="para">
		To test the managed domain you must know the elastic IP addresses of both the Apache HTTP server and JBoss EAP 6 domain controller.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Configure and launch the domain controller. See <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Instance_to_Serve_as_a_Domain_Controller">Section 24.5.1, “Launch an Instance to Serve as a Domain Controller”</a> .
			</div></li><li class="listitem"><div class="para">
				Configure and launch the host controllers. See <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_One_or_More_Instances_to_Serve_as_Host_Controllers">Section 24.5.2, “Launch One or More Instances to Serve as Host Controllers”</a> .
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978500898368">
      ⁠</a><p class="title"><strong>Procedure 24.5. Test the Web Server</strong></p><ul><li class="step"><div class="para">
				Navigate to <code class="code">http://ELASTIC_IP_OF_APACHE_HTTPD</code> in a browser to confirm the web server is running successfully.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978451567280">
      ⁠</a><p class="title"><strong>Procedure 24.6. Test the Domain Controller</strong></p><ol class="1"><li class="step"><div class="para">
				Navigate to <code class="code">http://ELASTIC_IP_OF_DOMAIN_CONTROLLER:9990/console</code>
			</div></li><li class="step"><div class="para">
				Log in using the username of <code class="literal">admin</code> and the password specified in the User Data field for the domain controller and the admin console landing page for a managed domain should appear (<code class="code">http://ELASTIC_IP_OF_DOMAIN_CONTROLLER:9990/console/App.html#server-instances</code>).
			</div></li><li class="step"><div class="para">
				Click the <span class="guilabel"><strong>Server</strong></span> label at the top right side of the screen, and select any of the host controllers in the <span class="guilabel"><strong>Host</strong></span> dropdown menu at the top left side of the screen.
			</div></li><li class="step"><div class="para">
				Verify that each host controller has two server configurations called <code class="literal">server-one</code> and <code class="literal">server-two</code> and that they both belong to the <code class="literal">main-server-group</code>.
			</div></li><li class="step"><div class="para">
				Log out of the JBoss EAP 6 Admin Console.
			</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978495361584">
      ⁠</a><p class="title"><strong>Procedure 24.7. Test the Host Controllers</strong></p><ol class="1"><li class="step"><div class="para">
				Navigate to <code class="code">http://<em class="replaceable">ELASTIC_IP_OF_APACHE_HTTPD</em>/hello</code> to test that the sample application is running successfully. The text <code class="literal">Hello World!</code> should appear in the browser.
			</div><div class="para">
				If the text is not visible, refer here: Section 18.5.1, "About Troubleshooting Amazon EC2".
			</div></li><li class="step"><div class="para">
				Connect to the Apache HTTP server instance:
			</div><pre class="screen">$ ssh -L7654:localhost:7654 <em class="replaceable">ELASTIC_IP_OF_APACHE_HTTPD</em></pre></li><li class="step"><div class="para">
				Navigate to <code class="code">http://localhost:7654/mod_cluster-manager</code> to confirm all instances are running correctly.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The JBoss EAP 6 web server, domain controller, and host controllers are running correctly on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+12721-681092+%5BLatest%5D&amp;comment=Title%3A+Test+the+Non-Clustered+JBoss+EAP+6+Managed+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=12721-681092+03+Jul+2014+00%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Domain_Controller_Discovery_and_Failover_on_Amazon_EC2">
      ⁠</a>24.5.4. Configuring Domain Controller Discovery and Failover on Amazon EC2</h2></div></div></div><div class="para">
		For a managed domain running on Amazon EC2, in addition to static domain controller discovery, host controllers can dynamically discover a domain controller using the Amazon S3 storage system. In particular, host controllers and the domain controller can be configured with information needed to access an Amazon S3 bucket.
	</div><div class="para">
		Using this configuration, when a domain controller is started, it writes its contact information to an S3 file in the bucket. Whenever a host controller attempts to contact the domain controller, it gets the domain controller's contact information from the S3 file.
	</div><div class="para">
		This means that if the domain controller's contact information changes (for example, it is common for an EC2 instance's IP address to change when it is stopped and started), the host controllers do not need to be reconfigured. The host controllers are able to get the domain controller's new contact information from the S3 file.
	</div><div class="para">
		You can automatically enable domain controller discovery by passing the <em class="parameter"><code>JBOSS_DOMAIN_S3_ACCESS_KEY</code></em>, <em class="parameter"><code>JBOSS_DOMAIN_S3_SECRET_ACCESS_KEY</code></em>, and <em class="parameter"><code>JBOSS_DOMAIN_S3_BUCKET</code></em> parameters to the JBoss EAP 6 instance when launching it. See <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Permanent_Script_Parameters">Section 24.10.1, “Permanent Configuration Parameters”</a> for configurable parameters. Alternatively, you can manually configure domain discovery using the following configuration.
	</div><div class="para">
		The manual domain controller discovery configuration is specified using the following properties:
	</div><div class="variablelist"><p class="title"><strong/></p><dl class="variablelist"><dt><span class="term"> access-key </span></dt><dd><div class="para">
					The Amazon AWS user account access key.
				</div></dd><dt><span class="term"> secret-access-key </span></dt><dd><div class="para">
					The Amazon AWS user account secret access key.
				</div></dd><dt><span class="term"> location </span></dt><dd><div class="para">
					The Amazon S3 bucket to be used.
				</div></dd></dl></div><div class="para">
		The following are example host controller and domain controller configurations. Although one discovery option is shown in the examples below, it is possible to configure any number of static discovery or S3 discovery options. For details on the domain discovery and failover process, see <a class="xref" href="chap-Introduction.html#About_Domain_Controller_Failover">Section 1.7, “About Domain Controller Discovery and Failover”</a>.
	</div><div class="example"><a id="idm139978465052912">
      ⁠</a><p class="title"><strong>Example 24.5. Host Controller Configuration</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;domain-controller&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;remote</span><span xmlns="" class="perl_Others"> security-realm=</span><span xmlns="" class="perl_String">"ManagementRealm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;discovery-options&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;discovery-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"s3-discovery"</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.as.host.controller.discovery.S3Discovery"</span><span xmlns="" class="perl_Others"> module=</span><span xmlns="" class="perl_String">"org.jboss.as.host-controller"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"access-key"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"S3_ACCESS_KEY"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"secret-access-key"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"S3_SECRET_ACCESS_KEY"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"location"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"S3_BUCKET_NAME"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/discovery-option&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/discovery-options&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/remote&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/domain-controller&gt;</span></pre></div></div><div class="example"><a id="idm139978457691632">
      ⁠</a><p class="title"><strong>Example 24.6. Domain Controller Configuration</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;domain-controller&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;local&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;discovery-options&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;discovery-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"s3-discovery"</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.as.host.controller.discovery.S3Discovery"</span><span xmlns="" class="perl_Others"> module=</span><span xmlns="" class="perl_String">"org.jboss.as.host-controller"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"access-key"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"S3_ACCESS_KEY"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"secret-access-key"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"S3_SECRET_ACCESS_KEY"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"location"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"S3_BUCKET_NAME"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/discovery-option&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/discovery-options&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/local&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/domain-controller&gt;</span></pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+40904-682291+%5BLatest%5D&amp;comment=Title%3A+Configuring+Domain+Controller+Discovery+and+Failover+on+Amazon+EC2%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=40904-682291+07+Jul+2014+23%3A44+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Clustered_JBoss_EAP_6">
      ⁠</a>24.6. Clustered JBoss EAP 6</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Clustered_Instances1">
      ⁠</a>24.6.1. About Clustered Instances</h2></div></div></div><div class="para">
		A clustered instance is an Amazon EC2 instance running JBoss EAP 6 with clustering enabled. Another instance running the Apache HTTP server will be acting as the proxy for the instances in the cluster.
	</div><div class="para">
		The JBoss EAP 6 AMIs include two configuration files for use in clustered instances, <code class="filename">standalone-ec2-ha.xml</code> and <code class="filename">standalone-mod_cluster-ec2-ha.xml</code>. Each of these configuration files provides clustering without the use of multicast because Amazon EC2 does not support multicast. This is done by using TCP unicast for cluster communications and S3_PING as the discovery protocol. The <code class="filename">standalone-mod_cluster-ec2-ha.xml</code> configuration also provides easy registration with mod_cluster proxies.
	</div><div class="para">
		Similarly, the <code class="filename">domain-ec2.xml</code> configuration file provides two profiles for use in clustered managed domains: ec2-ha, and mod_cluster-ec2-ha.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9427-681100+%5BLatest%5D&amp;comment=Title%3A+About+Clustered+Instances%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9427-681100+03+Jul+2014+00%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Virtual_Private_Clouds1">
      ⁠</a>24.6.2. About Virtual Private Clouds</h2></div></div></div><div class="para">
		An Amazon Virtual Private Cloud (Amazon VPC) is a feature of Amazon Web Services (AWS) that allows you to isolate a set of AWS resources in a private network. The topology and configuration of this private network can be customized to your needs.
	</div><div class="para">
		Refer to the Amazon Virtual Private Cloud website for more information <a href="http://aws.amazon.com/vpc/">http://aws.amazon.com/vpc/</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9431-591880+%5BLatest%5D&amp;comment=Title%3A+About+Virtual+Private+Clouds%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9431-591880+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_a_Virtual_Private_Cloud_VPC">
      ⁠</a>24.6.3. Create a Virtual Private Cloud (VPC)</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to create a Virtual Private Cloud, using a database external to the VPC as an example. Your security policies may require connection to the database to be encrypted. Please refer to Amazon's <em class="citetitle">RDS FAQ</em> for details about encrypting the database connections.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			VPC is recommended for a JBoss EAP 6 cluster setup as it greatly simplifies secure communication between cluster nodes, a JON Server and the mod_cluster proxy. Without a VPC, these communication channels need to be encrypted and authenticated.
		</div><div class="para">
			For detailed instructions on configuring SSL, refer to the <em class="citetitle"> Core Management Security Guide </em>.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
				Go to the VPC tab in the AWS console.
			</div></li><li class="step"><div class="para">
				Subscribe to the service if needed.
			</div></li><li class="step"><div class="para">
				Click on "<span class="guilabel"><strong>Create new VPC</strong></span>".
			</div></li><li class="step"><div class="para">
				Choose a VPC with one public and one private subnet.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Set the public subnet to be <code class="literal">10.0.0.0/24</code>.
					</div></li><li class="step"><div class="para">
						Set the private subnet to be <code class="literal">10.0.1.0/24</code>.
					</div></li></ol></li><li class="step"><div class="para">
				Go to <span class="guilabel"><strong>Elastic IPs</strong></span>.
			</div></li><li class="step"><div class="para">
				Create an elastic IP for use by the mod_cluster proxy/NAT instance.
			</div></li><li class="step"><div class="para">
				Go to <span class="guilabel"><strong>Security groups</strong></span> and create a security group to allow all traffic in and out.
			</div></li><li class="step"><div class="para">
				Go to Network ACLs
			</div><ol class="substeps a"><li class="step"><div class="para">
						Create an ACL to allow all traffic in and out.
					</div></li><li class="step"><div class="para">
						Create an ACL to allow all traffic out and traffic in on only TCP ports <code class="literal">22</code>, <code class="literal">8009</code>, <code class="literal">8080</code>, <code class="literal">8443</code>, <code class="literal">9443</code>, <code class="literal">9990</code> and <code class="literal">16163</code>.
					</div></li></ol></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The Virtual Private Cloud has been successfully created.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9432-749444+%5BLatest%5D&amp;comment=Title%3A+Create+a+Virtual+Private+Cloud+%28VPC%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9432-749444+31+Mar+2015+18%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_an_Apache_HTTPD_instance_to_serve_as_a_mod_cluster_proxy_and_a_NAT_instance_for_the_VPC">
      ⁠</a>24.6.4. Launch an Apache HTTP Server Instance to Serve as a mod_cluster Proxy and a NAT Instance for the VPC</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch an Apache HTTP server instance to serve as a mod_cluster proxy and a NAT instance for the Virtual Private Cloud.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Create_a_Virtual_Private_Cloud_VPC">Section 24.6.3, “Create a Virtual Private Cloud (VPC)”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978539810496">
      ⁠</a><p class="title"><strong>Procedure 24.8. Launch an Apache HTTP server Instance to Serve as a mod_cluster proxy and a NAT Instance for the VPC</strong></p><ol class="1"><li class="step"><div class="para">
				Create an elastic IP for this instance.
			</div></li><li class="step"><div class="para">
				Select an AMI.
			</div></li><li class="step"><div class="para">
				Go to <span class="guilabel"><strong>Security Group</strong></span> and allow all traffic (use Red Hat Enterprise Linux's built-in firewall capabilities to restrict access if desired).
			</div></li><li class="step"><div class="para">
				Select "<code class="literal">running</code>" in the public subnet of the VPC.
			</div></li><li class="step"><div class="para">
				Select a static IP (e.g. <code class="literal">10.0.0.4</code>).
			</div></li><li class="step"><div class="para">
				Put the following in the <span class="guilabel"><strong>User Data:</strong></span> field:
			</div><pre class="programlisting">
JBOSSCONF=disabled

cat &gt; $USER_SCRIPT &lt;&lt; "EOS"

echo 1 &gt; /proc/sys/net/ipv4/ip_forward
echo 0 &gt; /proc/sys/net/ipv4/conf/all/rp_filter
echo 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter

iptables -I INPUT 4 -s 10.0.1.0/24 -p tcp --dport 7654 -j ACCEPT
iptables -I INPUT 4 -p tcp --dport 80 -j ACCEPT

iptables -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -I FORWARD -s 10.0.1.0/24 -j ACCEPT
iptables -t nat -A POSTROUTING -o eth0 ! -s 10.0.0.4 -j MASQUERADE

# balancer module incompatible with mod_cluster
sed -i -e 's/LoadModule proxy_balancer_module/#\0/' /etc/httpd/conf/httpd.conf

cat &gt; /etc/httpd/conf.d/mod_cluster.conf &lt;&lt; "EOF"
#LoadModule proxy_module modules/mod_proxy.so
#LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so

Listen 7654

# workaround JBPAPP-4557
MemManagerFile /var/cache/mod_proxy/manager

&lt;VirtualHost *:7654&gt;
   &lt;Location /mod_cluster-manager&gt;
      SetHandler mod_cluster-manager
      Order deny,allow
      Deny from all
      Allow from 127.0.0.1
   &lt;/Location&gt;

   &lt;Location /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.
      Allow from 127.0.0.1
   &lt;/Location&gt;

   KeepAliveTimeout 60
   MaxKeepAliveRequests 0
   ManagerBalancerName mycluster
   ServerAdvertise Off
   EnableMCPMReceive
&lt;/VirtualHost&gt;
EOF

echo "`hostname | sed -e 's/ip-//' -e 'y/-/./'`        `hostname`" &gt;&gt; /etc/hosts

semanage port -a -t http_port_t -p tcp 7654 #add port in the apache port list for the below to work
setsebool -P httpd_can_network_relay 1 #for mod_proxy_cluster to work
chcon -t httpd_config_t -u system_u /etc/httpd/conf.d/mod_cluster.conf

#### Uncomment the following line when launching a managed domain ####
# setsebool -P httpd_can_network_connect 1

service httpd start

EOS
</pre></li><li class="step"><div class="para">
				Disable the Amazon EC2 cloud source/destination checking for this instance so it can act as a router.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Right-click on the running Apache HTTP server instance and choose "<span class="guilabel"><strong>Change Source/Dest check</strong></span>".
					</div></li><li class="step"><div class="para">
						Click on <span class="guilabel"><strong>Yes, Disable</strong></span>.
					</div></li></ol></li><li class="step"><div class="para">
				Assign the elastic IP to this instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The Apache HTTP server instance has been launched successfully.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9433-741846+%5BLatest%5D&amp;comment=Title%3A+Launch+an+Apache+HTTP+Server+Instance+to+Serve+as+a+mod_cluster+Proxy+and+a+NAT+Instance+for+the+VPC%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9433-741846+06+Feb+2015+05%3A09+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_VPC_Private_Subnet_Default_Route">
      ⁠</a>24.6.5. Configure the VPC Private Subnet Default Route</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to configure the VPC private subnet default route. JBoss EAP 6 cluster nodes will run in the private subnet of the VPC, but cluster nodes require Internet access for S3 connectivity. A default route needs to be set to go through the NAT instance.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978539996816">
      ⁠</a><p class="title"><strong>Procedure 24.9. Configure the VPC Private Subnet Default Route</strong></p><ol class="1"><li class="step"><div class="para">
				Navigate to the Apache HTTP server instance in the Amazon AWS console.
			</div></li><li class="step"><div class="para">
				Navigate to the <span class="guimenu"><strong>VPC</strong></span> → <span class="guimenuitem"><strong> route tables</strong></span>.
			</div></li><li class="step"><div class="para">
				Click on the routing table used by the private subnet.
			</div></li><li class="step"><div class="para">
				In the field for a new route enter <code class="literal">0.0.0.0/0</code>.
			</div></li><li class="step"><div class="para">
				Click on "<span class="guilabel"><strong>Select a target</strong></span>".
			</div></li><li class="step"><div class="para">
				Select "<code class="literal">Enter Instance ID</code>".
			</div></li><li class="step"><div class="para">
				Choose the ID of the running Apache HTTP server instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The default route has been successfully configured for the VPC subnet.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9434-681108+%5BLatest%5D&amp;comment=Title%3A+Configure+the+VPC+Private+Subnet+Default+Route%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9434-681108+03+Jul+2014+01%3A17+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Identity_and_Access_Management_IAM">
      ⁠</a>24.6.6. About Identity and Access Management (IAM)</h2></div></div></div><div class="para">
		Identity and Access Management (IAM) provides configurable security for your AWS resources. IAM can be configured to use accounts created in IAM or to provide identity federation between IAM and your own identity services.
	</div><div class="para">
		Refer to the AWS Identity and Access Management website for more information <a href="http://aws.amazon.com/iam/">http://aws.amazon.com/iam/</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9435-591880+%5BLatest%5D&amp;comment=Title%3A+About+Identity+and+Access+Management+%28IAM%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9435-591880+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_IAM_Setup1">
      ⁠</a>24.6.7. Configure IAM Setup</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the configuration steps required for setting up IAM for clustered JBoss EAP 6 instances. The <em class="parameter"><code>S3_PING</code></em> protocol uses an S3 bucket to discover other cluster members. <span class="application"><strong>JGroups</strong></span> version 3.0.x requires Amazon AWS account access and secret keys to authenticate against the S3 service.
		</div><div class="para">
		Because S3 domain controller discovery makes use of an S3 bucket, it requires Amazon AWS account access and secret keys to authenticate against the S3 service (similar to the <em class="parameter"><code>S3_PING</code></em> protocol used by JGroups). The IAM user and S3 bucket used for S3 discovery must be different from the IAM user and S3 bucket used for clustering.
	</div><div class="para">
		It is a security risk to enter your main account credentials in the user-data field, store them online or in an AMI. To circumvent this, a separate account can be created using the Amazon IAM feature which would be only granted access to a single S3 bucket.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978545820864">
      ⁠</a><p class="title"><strong>Procedure 24.10. Configure IAM Setup</strong></p><ol class="1"><li class="step"><div class="para">
				Go to the IAM tab in the AWS console.
			</div></li><li class="step"><div class="para">
				Click on <span class="guilabel"><strong>users</strong></span>.
			</div></li><li class="step"><div class="para">
				Select <span class="guilabel"><strong>Create New Users</strong></span>.
			</div></li><li class="step"><div class="para">
				Choose a name, and ensure the <span class="guilabel"><strong>Generate an access key for each User</strong></span> option is checked.
			</div></li><li class="step"><div class="para">
				Select <span class="guilabel"><strong>Download credentials</strong></span>, and save them in a secure location.
			</div></li><li class="step"><div class="para">
				Close the window.
			</div></li><li class="step"><div class="para">
				Click on the newly created user.
			</div></li><li class="step"><div class="para">
				Make note of the <code class="literal">User ARM</code> value. This value is required to set up the S3 bucket, documented here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_S3_Bucket_Setup1">Section 24.6.9, “Configure S3 Bucket Setup”</a>.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The IAM user account has been successfully created.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9436-629272+%5BLatest%5D&amp;comment=Title%3A+Configure+IAM+Setup%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9436-629272+11+Apr+2014+00%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_S3_Bucket1">
      ⁠</a>24.6.8. About the S3 Bucket</h2></div></div></div><div class="para">
		S3 Buckets are the basic organization store unit in the Amazon Simple Storage System (Amazon S3). A bucket can store any number of arbitrary objects and must have a unique name to identify it with Amazon S3..
	</div><div class="para">
		Refer to the Amazon S3 website for more information, <a href="http://aws.amazon.com/s3/">http://aws.amazon.com/s3/</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9437-591880+%5BLatest%5D&amp;comment=Title%3A+About+the+S3+Bucket%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9437-591880+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_S3_Bucket_Setup1">
      ⁠</a>24.6.9. Configure S3 Bucket Setup</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to configure a new S3 bucket.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978495349600">
      ⁠</a><p class="title"><strong>Procedure 24.11. Configure S3 Bucket Setup</strong></p><ol class="1"><li class="step"><div class="para">
				Open the <span class="guilabel"><strong>S3</strong></span> tab in the AWS console.
			</div></li><li class="step"><div class="para">
				Click on <span class="guilabel"><strong>Create Bucket</strong></span>.
			</div></li><li class="step"><div class="para">
				Choose a name for the bucket and click <span class="guibutton"><strong>Create</strong></span>.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Bucket names are unique across the entire S3. Names cannot be reused.
				</div></div></div></li><li class="step"><div class="para">
				Right click on the new bucket and select <span class="guilabel"><strong>Properties</strong></span>.
			</div></li><li class="step"><div class="para">
				Click <span class="guilabel"><strong>Add bucket policy</strong></span> in the permissions tab.
			</div></li><li class="step optional"><div class="para">
				Click <span class="guilabel"><strong>New policy</strong></span> to open the policy creation wizard.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Copy the following content into the new policy, replacing <code class="literal">arn:aws:iam::05555555555:user/jbosscluster*</code> with the value defined here: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>. Change both instances of <code class="code">clusterbucket123</code> to the name of the bucket defined in step 3 of this procedure.
					</div><pre class="programlisting">
{
    "Version": "2008-10-17",
    "Id": "Policy1312228794320",
    "Statement": [
        {
            "Sid": "Stmt1312228781799",
            "Effect": "Allow",
            "Principal": {
                "AWS": [
                    "arn:aws:iam::055555555555:user/jbosscluster"
                ]
            },
            "Action": [
                "s3:ListBucketVersions",
                "s3:GetObjectVersion",
                "s3:ListBucket",
                "s3:PutBucketVersioning",
                "s3:DeleteObject",
                "s3:DeleteObjectVersion",
                "s3:GetObject",
                "s3:ListBucketMultipartUploads",
                "s3:ListMultipartUploadParts",
                "s3:PutObject",
                "s3:GetBucketVersioning"
            ],
            "Resource": [
                "arn:aws:s3:::clusterbucket123/*",
                "arn:aws:s3:::clusterbucket123"
            ]
        }
    ]
}
</pre></li></ol></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			A new S3 bucket has been created, and configured successfully.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9438-591880+%5BLatest%5D&amp;comment=Title%3A+Configure+S3+Bucket+Setup%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9438-591880+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Clustered_Instances">
      ⁠</a>24.7. Clustered Instances</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_Clustered_JBoss_Enterprise_Application_Platform_6_AMIs">
      ⁠</a>24.7.1. Launch Clustered JBoss EAP 6 AMIs</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch clustered JBoss EAP 6 AMIs.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Create_a_Virtual_Private_Cloud_VPC">Section 24.6.3, “Create a Virtual Private Cloud (VPC)”</a>.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Apache_HTTPD_instance_to_serve_as_a_mod_cluster_proxy_and_a_NAT_instance_for_the_VPC">Section 24.6.4, “Launch an Apache HTTP Server Instance to Serve as a mod_cluster Proxy and a NAT Instance for the VPC”</a>.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_the_VPC_Private_Subnet_Default_Route">Section 24.6.5, “Configure the VPC Private Subnet Default Route”</a>.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_S3_Bucket_Setup1">Section 24.6.9, “Configure S3 Bucket Setup”</a>.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Running a JBoss EAP 6 cluster in a subnet with network mask smaller than 24 bits or spanning multiple subnets complicates acquiring a unique server peer ID for each cluster member.
		</div><div class="para">
			Refer to the <em class="parameter"><code>JBOSS_CLUSTER_ID</code></em> variable for information on how to make such a configuration work reliably: <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Permanent_Script_Parameters">Section 24.10.1, “Permanent Configuration Parameters”</a>.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			The auto-scaling Amazon EC2 feature can be used with JBoss EAP 6 cluster nodes. However, ensure it is tested <span class="strong strong"><strong>before</strong></span> deployment. You should ensure that your particular workloads scale to the desired number of nodes, and that the performance meets your needs for the instance type you are planning to use (different instance types receive a different share of the EC2 cloud resources).
		</div><div class="para">
			Furthermore, instance locality and current network/storage/host machine/RDS utilization can affect performance of a cluster. Test with your expected real-life loads and try to account for unexpected conditions.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Down-scaling a cluster</strong></p></div><div class="admonition"><div class="para">
			The Amazon EC2 <span class="emphasis"><em>scale-down</em></span> action terminates the nodes without any chance to gracefully shut down, and, as some transactions might be interrupted, other cluster nodes (and load balancers) will need time to fail over. This is likely to impact your application users' experience.
		</div><div class="para">
			It is recommended that you either scale down the application cluster manually by disabling the server from the mod_cluster management interface until processed sessions are completed, or shut down the JBoss EAP 6 instance gracefully (SSH access to the instance or JON can be used).
		</div><div class="para">
			Test that your chosen procedure for scaling-down does not lead to adverse effects on your users' experience. Additional measures might be required for particular workloads, load balancers and setups.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978543950304">
      ⁠</a><p class="title"><strong>Procedure 24.12. Launch Clustered JBoss EAP 6 AMIs</strong></p><ol class="1"><li class="step"><div class="para">
				Select an AMI.
			</div></li><li class="step"><div class="para">
				Define the desired number of instances (the cluster size).
			</div></li><li class="step"><div class="para">
				Select the VPC and instance type.
			</div></li><li class="step"><div class="para">
				Click on <span class="guilabel"><strong>Security Group</strong></span>.
			</div></li><li class="step"><div class="para">
				Ensure that all traffic from the JBoss EAP 6 cluster subnet is allowed.
			</div></li><li class="step"><div class="para">
				Define other restrictions as desired.
			</div></li><li class="step"><div class="para">
				Add the following into the <span class="guilabel"><strong>User Data</strong></span> field:
			</div><div class="example"><a id="idm139978443907280">
      ⁠</a><p class="title"><strong>Example 24.7. Example User Data Field</strong></p><div class="example-contents"><pre class="programlisting">## mod cluster proxy addresses
MOD_CLUSTER_PROXY_LIST=10.0.0.4:7654

## clustering setup
JBOSS_JGROUPS_S3_PING_SECRET_ACCESS_KEY=&lt;your secret key&gt;
JBOSS_JGROUPS_S3_PING_ACCESS_KEY=&lt;your access key&gt;
JBOSS_JGROUPS_S3_PING_BUCKET=&lt;your bucket name&gt;

## password to access admin console
JBOSSAS_ADMIN_PASSWORD=&lt;your password for opening admin console&gt;

## database credentials configuration
JAVA_OPTS="$JAVA_OPTS -Ddb.host=instancename.something.rds.amazonaws.com -Ddb.database=mydatabase -Ddb.user=&lt;user&gt; -Ddb.passwd=&lt;pass&gt;"

## subnet prefix this machine is connected to
SUBNET=10.0.1.

#### to run the example no modifications below should be needed ####
PORTS_ALLOWED="1024:65535"
JBOSS_IP=`hostname | sed -e 's/ip-//' -e 'y/-/./'` #listen on public/private EC2 IP address

cat &gt; $USER_SCRIPT &lt;&lt; "EOF"
## Get the application to be deployed from an Internet URL
# mkdir -p /usr/share/java/jboss-ec2-eap-applications
# wget https://&lt;your secure storage hostname&gt;/&lt;path&gt;/&lt;app name&gt;.war -O /usr/share/java/jboss-ec2-eap-applications/&lt;app name&gt;.war

## install the JDBC driver as a core module
yum -y install mysql-connector-java
mkdir -p /usr/share/jbossas/modules/com/mysql/main
cp -v /usr/share/java/mysql-connector-java-*.jar /usr/share/jbossas/modules/com/mysql/main/mysql-connector-java.jar

cat &gt; /usr/share/jbossas/modules/com/mysql/main/module.xml &lt;&lt;"EOM"
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="com.mysql"&gt;
   &lt;resources&gt;
      &lt;resource-root path="mysql-connector-java.jar"/&gt;
   &lt;/resources&gt;
   &lt;dependencies&gt;
      &lt;module name="javax.api"/&gt;
   &lt;/dependencies&gt;
&lt;/module&gt;
EOM

cat &gt; $USER_CLI_COMMANDS &lt;&lt; "EOC" 
## Deploy sample application from local filesystem
deploy --force /usr/share/java/jboss-ec2-eap-samples/cluster-demo.war

## ExampleDS configuration for MySQL database
data-source remove --name=ExampleDS
/subsystem=datasources/jdbc-driver=mysql:add(driver-name="mysql",driver-module-name="com.mysql")
data-source add --name=ExampleDS --connection-url="jdbc:mysql://${db.host}:3306/${db.database}" --jndi-name=java:jboss/datasources/ExampleDS --driver-name=mysql --user-name="${db.user}" --password="${db.passwd}"
/subsystem=datasources/data-source=ExampleDS:enable
/subsystem=datasources/data-source=ExampleDS:test-connection-in-pool
EOC

## this will workaround the problem that in a VPC, instance hostnames are not resolvable
echo -e "127.0.0.1\tlocalhost.localdomain localhost" &gt; /etc/hosts
echo -e "::1\tlocalhost6.localdomain6 localhost6" &gt;&gt; /etc/hosts
for (( i=1 ; i&lt;255 ; i++ )); do
   echo -e "$SUBNET$i\tip-${SUBNET//./-}$i" ;
done &gt;&gt; /etc/hosts

EOF</pre></div></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The clustered JBoss EAP 6 AMIs have been configured and launched successfully.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9439-741761+%5BLatest%5D&amp;comment=Title%3A+Launch+Clustered+JBoss+EAP+6+AMIs%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9439-741761+05+Feb+2015+23%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Test_the_Clustered_JBoss_Enterprise_Application_Platform_6_Instance">
      ⁠</a>24.7.2. Test the Clustered JBoss EAP 6 Instance</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps to confirm that the clustered JBoss EAP 6 instances are running correctly.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978442335552">
      ⁠</a><p class="title"><strong>Procedure 24.13. Testing the Clustered Instance</strong></p><ol class="1"><li class="step"><div class="para">
				Navigate to <a href="http://ELASTIC_IP_OF_APACHE_HTTPD">http://ELASTIC_IP_OF_APACHE_HTTPD</a> in a browser to confirm the web server is running successfully.
			</div></li><li class="step"><p class="title"><strong>Test the Clustered Nodes</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Navigate to <a href="http://ELASTIC_IP_OF_APACHE_HTTPD/cluster-demo/put.jsp">http://ELASTIC_IP_OF_APACHE_HTTPD/cluster-demo/put.jsp</a> in a browser.
					</div></li><li class="step"><div class="para">
						Verify that one of the cluster nodes logs the following message:
					</div><pre class="screen">Putting date now</pre></li><li class="step"><div class="para">
						Stop the cluster node that logged the message in the previous step.
					</div></li><li class="step"><div class="para">
						Navigate to <a href="http://ELASTIC_IP_OF_APACHE_HTTPD/cluster-demo/get.jsp">http://ELASTIC_IP_OF_APACHE_HTTPD/cluster-demo/get.jsp</a> in a browser.
					</div></li><li class="step"><div class="para">
						Verify that the time shown is the same as the time that was PUT using <code class="filename">put.jsp</code> in Step 2-a.
					</div></li><li class="step"><div class="para">
						Verify that one of the running cluster nodes logs the following message:
					</div><pre class="screen">Getting date now</pre></li><li class="step"><div class="para">
						Restart the stopped clustered node.
					</div></li><li class="step"><div class="para">
						Connect to the Apache HTTP server instance:
					</div><pre class="screen">ssh -L7654:localhost:7654 &lt;<em class="replaceable">ELASTIC_IP_OF_APACHE_HTTPD</em>&gt;</pre></li><li class="step"><div class="para">
						Navigate to <a href="http://localhost:7654/mod_cluster-manager">http://localhost:7654/mod_cluster-manager</a> to confirm all instances are running correctly.
					</div></li></ol></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The clustered JBoss EAP 6 instances have been tested, and confirmed to be working correctly.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9440-681110+%5BLatest%5D&amp;comment=Title%3A+Test+the+Clustered+JBoss+EAP+6+Instance%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9440-681110+03+Jul+2014+01%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Clustered_Managed_Domains">
      ⁠</a>24.8. Clustered Managed Domains</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_an_Instance_to_Serve_as_a_Cluster_Domain_Controller">
      ⁠</a>24.8.1. Launch an Instance to Serve as a Cluster Domain Controller</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch a clustered JBoss EAP 6 managed domain on a Red Hat AMI (Amazon Machine Image).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A suitable Red Hat AMI. Refer to <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Supported_Red_Hat_AMIs1">Section 24.1.6, “Supported Red Hat AMIs”</a> .
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Create_a_Virtual_Private_Cloud_VPC">Section 24.6.3, “Create a Virtual Private Cloud (VPC)”</a> 
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Apache_HTTPD_instance_to_serve_as_a_mod_cluster_proxy_and_a_NAT_instance_for_the_VPC">Section 24.6.4, “Launch an Apache HTTP Server Instance to Serve as a mod_cluster Proxy and a NAT Instance for the VPC”</a> 
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_the_VPC_Private_Subnet_Default_Route">Section 24.6.5, “Configure the VPC Private Subnet Default Route”</a> 
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_S3_Bucket_Setup1">Section 24.6.9, “Configure S3 Bucket Setup”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978514705408">
      ⁠</a><p class="title"><strong>Procedure 24.14. Launch a Cluster Domain Contoller</strong></p><ol class="1"><li class="step"><div class="para">
				Create an elastic IP for this instance.
			</div></li><li class="step"><div class="para">
				Select an AMI.
			</div></li><li class="step"><div class="para">
				Go to Security Group and allow all traffic (use Red Hat Enterprise Linux's built-in firewall capabilities to restrict access if desired).
			</div></li><li class="step"><div class="para">
				Choose "running" in the public subnet of the VPC.
			</div></li><li class="step"><div class="para">
				Choose a static IP (e.g. <code class="literal">10.0.0.5</code>).
			</div></li><li class="step"><div class="para">
				Put the following in the User Data: field:
			</div><pre class="programlisting">## mod cluster proxy addresses
MOD_CLUSTER_PROXY_LIST=10.0.0.4:7654
 
## password that will be used by slave host controllers to connect to the domain controller
JBOSSAS_ADMIN_PASSWORD=&lt;password for slave host controllers&gt;
 
## subnet prefix this machine is connected to
SUBNET=10.0.0.

## S3 domain controller discovery setup
# JBOSS_DOMAIN_S3_SECRET_ACCESS_KEY=&lt;your secret key&gt;
# JBOSS_DOMAIN_S3_ACCESS_KEY=&lt;your access key&gt;
# JBOSS_DOMAIN_S3_BUCKET=&lt;your bucket name&gt;
 
#### to run the example no modifications below should be needed ####
JBOSS_DOMAIN_CONTROLLER=true
PORTS_ALLOWED="9999 9990 9443"
JBOSS_IP=`hostname | sed -e 's/ip-//' -e 'y/-/./'` #listen on public/private EC2 IP address
 
cat &gt; $USER_SCRIPT &lt;&lt; "EOF"
## Get the application to be deployed from an Internet URL
# mkdir -p /usr/share/java/jboss-ec2-eap-applications
# wget https://&lt;your secure storage hostname&gt;/&lt;path&gt;/&lt;app name&gt;.war -O /usr/share/java/jboss-ec2-eap-applications/&lt;app name&gt;.war
 
## Install the JDBC driver as a core module
yum -y install mysql-connector-java
mkdir -p /usr/share/jbossas/modules/com/mysql/main
cp -v /usr/share/java/mysql-connector-java-*.jar /usr/share/jbossas/modules/com/mysql/main/mysql-connector-java.jar
 
cat &gt; /usr/share/jbossas/modules/com/mysql/main/module.xml &lt;&lt;"EOM"
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="com.mysql"&gt;
   &lt;resources&gt;
      &lt;resource-root path="mysql-connector-java.jar"/&gt;
   &lt;/resources&gt;
   &lt;dependencies&gt;
      &lt;module name="javax.api"/&gt;
   &lt;/dependencies&gt;
&lt;/module&gt;
EOM
 
cat &gt; $USER_CLI_COMMANDS &lt;&lt; "EOC" 
## Deploy the sample application from the local filesystem
deploy /usr/share/java/jboss-ec2-eap-samples/cluster-demo.war --server-groups=other-server-group
 
## ExampleDS configuration for MySQL database
data-source --profile=mod_cluster-ec2-ha remove --name=ExampleDS
/profile=mod_cluster-ec2-ha/subsystem=datasources/jdbc-driver=mysql:add(driver-name="mysql",driver-module-name="com.mysql")
data-source --profile=mod_cluster-ec2-ha add --name=ExampleDS --connection-url="jdbc:mysql://${db.host}:3306/${db.database}" --jndi-name=java:jboss/datasources/ExampleDS --driver-name=mysql --user-name="${db.user}" --password="${db.passwd}"
/profile=mod_cluster-ec2-ha/subsystem=datasources/data-source=ExampleDS:enable
EOC
 
## this will workaround the problem that in a VPC, instance hostnames are not resolvable
echo -e "127.0.0.1\tlocalhost.localdomain localhost" &gt; /etc/hosts
echo -e "::1\tlocalhost6.localdomain6 localhost6" &gt;&gt; /etc/hosts
for (( i=1 ; i&lt;255 ; i++ )); do
   echo -e "$SUBNET$i\tip-${SUBNET//./-}$i" ;
done &gt;&gt; /etc/hosts
 
EOF</pre></li><li class="step optional"><p class="title"><strong>For Production Instances</strong></p><div class="para">
				For a production instance, add the following line beneath the <code class="code">USER_SCRIPT</code> line of the <code class="code">User Data</code> field, to ensure security updates are applied on boot.
			</div><pre class="screen">yum -y update</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="command">yum -y update</code> should be run regularly, to apply security fixes and enhancements.
				</div></div></div></li><li class="step"><div class="para">
				Launch the Red Hat AMI instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			A clustered JBoss EAP 6 managed domain is configured and launched on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+12719-629276+%5BLatest%5D&amp;comment=Title%3A+Launch+an+Instance+to+Serve+as+a+Cluster+Domain+Controller%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=12719-629276+11+Apr+2014+00%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Launch_One_or_More_Instances_to_Serve_as_Cluster_Host_Controllers">
      ⁠</a>24.8.2. Launch One or More Instances to Serve as Cluster Host Controllers</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to launch one or more instances of JBoss EAP 6 to serve as cluster host controllers on a Red Hat AMI (Amazon Machine Image).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Configure and launch the cluster domain controller. Refer to <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Instance_to_Serve_as_a_Cluster_Domain_Controller">Section 24.8.1, “Launch an Instance to Serve as a Cluster Domain Controller”</a> .
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_IAM_Setup1">Section 24.6.7, “Configure IAM Setup”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Configure_S3_Bucket_Setup1">Section 24.6.9, “Configure S3 Bucket Setup”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978472393792">
      ⁠</a><p class="title"><strong>Procedure 24.15. Launch Host Controllers</strong></p><div class="para">
			For each instance you would like to create, repeat the following steps:
		</div><ol class="1"><li class="step"><div class="para">
				Select an AMI.
			</div></li><li class="step"><div class="para">
				Define the desired number of instances (the number of slave host controllers).
			</div></li><li class="step"><div class="para">
				Select the VPC and instance type.
			</div></li><li class="step"><div class="para">
				Click on Security Group.
			</div></li><li class="step"><div class="para">
				Ensure that all traffic from the JBoss EAP 6 cluster subnet is allowed.
			</div></li><li class="step"><div class="para">
				Define other restrictions as desired.
			</div></li><li class="step"><div class="para">
				Add the following into the User Data field:
			</div><pre class="programlisting">## mod cluster proxy addresses
MOD_CLUSTER_PROXY_LIST=10.0.0.4:7654
 
## clustering setup
JBOSS_JGROUPS_S3_PING_SECRET_ACCESS_KEY=&lt;your secret key&gt;
JBOSS_JGROUPS_S3_PING_ACCESS_KEY=&lt;your access key&gt;
JBOSS_JGROUPS_S3_PING_BUCKET=&lt;your bucket name&gt;
 
## host controller setup
### static domain controller discovery setup
JBOSS_DOMAIN_MASTER_ADDRESS=10.0.0.5
### S3 domain controller discovery setup
# JBOSS_DOMAIN_S3_SECRET_ACCESS_KEY=&lt;your secret key&gt;
# JBOSS_DOMAIN_S3_ACCESS_KEY=&lt;your access key&gt;
# JBOSS_DOMAIN_S3_BUCKET=&lt;your bucket name&gt;

JBOSS_HOST_PASSWORD=&lt;password for slave host controllers&gt;
 
## database credentials configuration
JAVA_OPTS="$JAVA_OPTS -Ddb.host=instancename.something.rds.amazonaws.com -Ddb.database=mydatabase -Ddb.user=&lt;user&gt; -Ddb.passwd=&lt;pass&gt;"
 
## subnet prefix this machine is connected to
SUBNET=10.0.1.
 
#### to run the example no modifications below should be needed ####
JBOSS_HOST_USERNAME=admin
PORTS_ALLOWED="1024:65535"
JBOSS_IP=`hostname | sed -e 's/ip-//' -e 'y/-/./'` #listen on public/private EC2 IP address
 
cat &gt; $USER_SCRIPT &lt;&lt; "EOF"
## Server instance configuration
sed -i "s/main-server-group/other-server-group/" $JBOSS_CONFIG_DIR/$JBOSS_HOST_CONFIG
 
## install the JDBC driver as a core module
yum -y install mysql-connector-java
mkdir -p /usr/share/jbossas/modules/com/mysql/main
cp -v /usr/share/java/mysql-connector-java-*.jar /usr/share/jbossas/modules/com/mysql/main/mysql-connector-java.jar
 
cat &gt; /usr/share/jbossas/modules/com/mysql/main/module.xml &lt;&lt;"EOM"
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="com.mysql"&gt;
   &lt;resources&gt;
      &lt;resource-root path="mysql-connector-java.jar"/&gt;
   &lt;/resources&gt;
   &lt;dependencies&gt;
      &lt;module name="javax.api"/&gt;
   &lt;/dependencies&gt;
&lt;/module&gt;
EOM
 
## this will workaround the problem that in a VPC, instance hostnames are not resolvable
echo -e "127.0.0.1\tlocalhost.localdomain localhost" &gt; /etc/hosts
echo -e "::1\tlocalhost6.localdomain6 localhost6" &gt;&gt; /etc/hosts
for (( i=1 ; i&lt;255 ; i++ )); do
   echo -e "$SUBNET$i\tip-${SUBNET//./-}$i" ;
done &gt;&gt; /etc/hosts
 
EOF</pre></li><li class="step optional"><p class="title"><strong>For Production Instances</strong></p><div class="para">
				For a production instance, add the following line beneath the <code class="code">USER_SCRIPT</code> line of the <code class="code">User Data</code> field, to ensure security updates are applied on boot.
			</div><pre class="screen">yum -y update</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="command">yum -y update</code> should be run regularly, to apply security fixes and enhancements.
				</div></div></div></li><li class="step"><div class="para">
				Launch the Red Hat AMI instance.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The JBoss EAP 6 cluster host controllers are configured and launched on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+12722-629279+%5BLatest%5D&amp;comment=Title%3A+Launch+One+or+More+Instances+to+Serve+as+Cluster+Host+Controllers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=12722-629279+11+Apr+2014+00%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Test_the_Clustered_JBoss_Enterprise_Application_Platform_6_Managed_Domain">
      ⁠</a>24.8.3. Test the Clustered JBoss EAP 6 Managed Domain</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			This topic covers the steps required to test the clustered JBoss EAP 6 managed domain on a Red Hat AMI (Amazon Machine Image).
		</div><div class="para">
		To test the Managed Domain you must know the elastic IP addresses of both the Apache HTTP server and JBoss EAP 6 Domain Controller.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Configure and launch the cluster domain controller. See <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_an_Instance_to_Serve_as_a_Cluster_Domain_Controller">Section 24.8.1, “Launch an Instance to Serve as a Cluster Domain Controller”</a> .
			</div></li><li class="listitem"><div class="para">
				Configure and launch the cluster host controllers. See <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Launch_One_or_More_Instances_to_Serve_as_Cluster_Host_Controllers">Section 24.8.2, “Launch One or More Instances to Serve as Cluster Host Controllers”</a> .
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978523523520">
      ⁠</a><p class="title"><strong>Procedure 24.16. Test the Apache HTTP server instance</strong></p><ul><li class="step"><div class="para">
				Navigate to <code class="code">http://<em class="replaceable">ELASTIC_IP_OF_APACHE_HTTP_SERVER</em></code> in a browser to confirm the web server is running successfully.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978457184656">
      ⁠</a><p class="title"><strong>Procedure 24.17. Test the Domain Controller</strong></p><ol class="1"><li class="step"><div class="para">
				Navigate to <code class="code">http://<em class="replaceable">ELASTIC_IP_OF_DOMAIN_CONTROLLER</em>:9990/console</code>
			</div></li><li class="step"><div class="para">
				Log in using the username <code class="literal">admin</code> and the password specified in the User Data field for the domain controller. Once logged in, the administration console landing page for a managed domain should appear (<code class="code">http://<em class="replaceable">ELASTIC_IP_OF_DOMAIN_CONTROLLER</em>:9990/console/App.html#server-instances</code>).
			</div></li><li class="step"><div class="para">
				Click the <span class="guilabel"><strong>Server</strong></span> label at the top right side of the screen. Select any of the host controllers in the <span class="guilabel"><strong>Host</strong></span> dropdown menu at the top left side of the screen.
			</div></li><li class="step"><div class="para">
				Verify that this host controller has two server configurations called <code class="literal">server-one</code> and <code class="literal">server-two</code> and verify that they both belong to the <code class="literal">other-server-group</code>.
			</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978502440528">
      ⁠</a><p class="title"><strong>Procedure 24.18. Test the Host Controllers</strong></p><ol class="1"><li class="step"><div class="para">
				Navigate to <code class="code">http://<em class="replaceable">ELASTIC_IP_OF_APACHE_HTTP_SERVER</em>/cluster-demo/put.jsp</code> in a browser.
			</div></li><li class="step"><div class="para">
				Verify that one of the host controllers logs the following message: <code class="literal">Putting date now.</code>
			</div></li><li class="step"><div class="para">
				Stop the server instance that logged the message in the previous step (see <em class="citetitle">Stop a Server Using the Management Console</em>).
			</div></li><li class="step"><div class="para">
				Navigate to <code class="code">http://<em class="replaceable">ELASTIC_IP_OF_APACHE_HTTP_SERVER</em>/cluster-demo/get.jsp</code> in a browser.
			</div></li><li class="step"><div class="para">
				Verify that the time shown is the same as the time that was <code class="code">PUT</code> using <code class="filename">put.jsp</code> in Step 2.
			</div></li><li class="step"><div class="para">
				Verify that one of the running server instances logs the following message: <code class="literal">Getting date now.</code>
			</div></li><li class="step"><div class="para">
				Restart the stopped server instance (see <a class="xref" href="chap-Application_Server_Management.html#Start_a_Server_Using_the_Management_Console">Section 2.3.2, “Start a Server Using the Management Console”</a>)
			</div></li><li class="step"><div class="para">
				Connect to the Apache HTTP server instance.
			</div><pre class="screen">$ ssh -L7654:localhost:7654 <em class="replaceable">ELASTIC_IP_OF_APACHE_HTTP_SERVER</em></pre></li><li class="step"><div class="para">
				Navigate to <code class="code">http://localhost:7654/mod_cluster-manager</code> to confirm all instances are running correctly.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The JBoss EAP 6 web server, domain controller, and host controllers are running correctly on a Red Hat AMI.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+12723-747847+%5BLatest%5D&amp;comment=Title%3A+Test+the+Clustered+JBoss+EAP+6+Managed+Domain%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=12723-747847+19+Mar+2015+05%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Establishing_Monitoring_with_JBoss_Operations_Network_JON">
      ⁠</a>24.9. Establishing Monitoring with JBoss Operations Network (JON)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_AMI_Monitoring">
      ⁠</a>24.9.1. About AMI Monitoring</h2></div></div></div><div class="para">
		With your business application deployed to a correctly-configured AMI instance, the next step is to establish monitoring of the platform with JBoss Operations Network (JON).
	</div><div class="para">
		The <acronym class="acronym">JON</acronym> server is commonly located inside a corporate network, so it's necessary to establish a secure connection between the server and each of its agents. Establishing a VPN between the two points is the most common solution but this complicates the required networking configuration. This chapter provides network configuration guidelines for enabling communication between the <acronym class="acronym">JON</acronym> agent and <acronym class="acronym">JON</acronym> server. For more extensive information on configuration, management, and usage please refer to the official Red Hat documentation for JBoss Operations Network (JON).
	</div><div class="figure"><a id="idm139978442900336">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/1477.png" alt="JON Server connectivity"/></div></div><p class="title"><strong>Figure 24.1. JON Server connectivity</strong></p></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9478-591881+%5BLatest%5D&amp;comment=Title%3A+About+AMI+Monitoring%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9478-591881+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Connectivity_Requirements1">
      ⁠</a>24.9.2. About Connectivity Requirements</h2></div></div></div><div class="para">
		Registering a JON agent with its servers requires two-way communication between agent and servers. The JON Agent needs access to port <code class="literal">7080</code> on all JON servers, except in the case of SSL where port <code class="literal">7443</code> is used. Each JON server must be able to access each of the connected agents on a unique host and port pairing. The agent port is usually <code class="literal">16163</code>.
	</div><div class="para">
		If there are multiple clustered JON servers, make sure each agent can communicate with all servers in the JON cluster via the IP and hostname pairs as configured through the JON server administration console. The JON server used by the agent to register may not be the server it tries to use after initialization.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9507-591883+%5BLatest%5D&amp;comment=Title%3A+About+Connectivity+Requirements%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9507-591883+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Network_Address_Translation_NAT1">
      ⁠</a>24.9.3. About Network Address Translation (NAT)</h2></div></div></div><div class="para">
		A corporate VPN gateway acting in routed mode greatly simplifies network configuration. If your corporate VPN gateway is acting in NAT mode however, the <acronym class="acronym">JON</acronym> server does not have direct visibility of agents. In this case, port forwarding needs to be configured for each agent.
	</div><div class="para">
		NAT VPN configurations require a port on the gateway to be forwarded to the <acronym class="acronym">JON</acronym> agent's address of port on the managed machine. The <acronym class="acronym">JON</acronym> agent also needs to be configured to tell the server the forwarded port number and IP address. You can find further information in the <code class="literal">rhq.communications.connector.*</code> description for the <code class="literal">agent-configuration.xml</code> configuration file.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9479-591881+%5BLatest%5D&amp;comment=Title%3A+About+Network+Address+Translation+%28NAT%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9479-591881+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Amazon_EC2_and_DNS">
      ⁠</a>24.9.4. About Amazon EC2 and DNS</h2></div></div></div><div class="para">
		<acronym class="acronym">JON</acronym> servers and <acronym class="acronym">JON</acronym> agents need to be able to resolve each others' hostnames. The DNS resolution is more complicated in the case of a VPN configuration. Connected servers have multiple possible options. One option is to use either the Amazon EC2 or the corporate network's DNS servers. Another option is to use a split DNS configuration where the corporate DNS servers are used for resolving names in particular domains, and the Amazon EC2 DNS servers are used for resolving all other names.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9480-591881+%5BLatest%5D&amp;comment=Title%3A+About+Amazon+EC2+and+DNS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9480-591881+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Routing_in_EC2">
      ⁠</a>24.9.5. About Routing in EC2</h2></div></div></div><div class="para">
		All Amazon EC2 servers have a <code class="literal">source/destination checking</code> routing feature activated by default. This feature drops any packets being sent to the server which have a destination different from the machine's IP address. If the VPN solution selected for connecting agents to the <acronym class="acronym">JON</acronym> server includes a router, this feature needs to be turned off for the server or servers acting as routers or VPN gateways. This configuration setting can be accessed via the Amazon AWS console. Disabled <code class="literal">source/destination checking</code> is also required in a Virtual Private Cloud (VPC).
	</div><div class="para">
		Some VPN configurations route general Internet traffic through the corporate VPN by default. It is recommended that you avoid this as it may be a slower and less efficient configuration for your particular needs.
	</div><div class="para">
		While the use of a proper addressing schema is not a concern specific to JON, poor schemas can affect it. Amazon EC2 assigns IP addresses from the <code class="literal">10.0.0.0/8</code> network. Instances usually have a public IP address also, but only network traffic on the internal IP address within the same availability zone is free. To avoid using the <code class="literal">10.0.0.0/8</code> network in private addressing, there are a few things to consider.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				When creating a <acronym class="acronym">VPC</acronym>, avoid allocating addresses already in use in the private network to avoid connectivity problems.
			</div></li><li class="listitem"><div class="para">
				If an instance needs access to availability zone local resources, make sure Amazon EC2 private addresses are used and traffic is not routed through the VPN.
			</div></li><li class="listitem"><div class="para">
				If an Amazon EC2 instance will access a small subset of corporate private network addresses (for example only <acronym class="acronym">JON</acronym> servers), only these addresses should be routed through the VPN. This increases security and lowers the chance of Amazon EC2 or private network address space collisions.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9481-591881+%5BLatest%5D&amp;comment=Title%3A+About+Routing+in+EC2%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9481-591881+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Terminating_and_Restarting_with_JON">
      ⁠</a>24.9.6. About Terminating and Restarting with JON</h2></div></div></div><div class="para">
		One of the benefits of a cloud environment is the ease by which you can terminate and launch a machine instance. You can also launch an instance identical to the initial one. This may cause issues if the new instance tries to register with <acronym class="acronym">JON</acronym> servers using the same agent name as the previously running agent. If this happens the JON server will not allow an agent to reconnect with a missing or non-matching identification token.
	</div><div class="para">
		To avoid this, ensure that terminated agents are removed from the <acronym class="acronym">JON</acronym> inventory before trying to connect an agent with the same name or specify the correct identification token when starting new agent.
	</div><div class="para">
		Another issue that you might encounter is when an agent machine is assigned a new VPN IP address that no longer matches the address recorded in the <acronym class="acronym">JON</acronym> configuration. An example might include a machine that is restarted or where a VPN connection is terminated. In this case, it is recommended that you bind the <acronym class="acronym">JON</acronym> agent's life cycle to the VPN connection's life cycle. If the connection drops, you can stop the agent. When the connection is restored again, update <code class="literal">JON_AGENT_ADDR</code> in <code class="literal">/etc/sysconfig/jon-agent-ec2</code> to reflect the new IP address and restart the agent.
	</div><div class="para">
		Information on how to change the agent's IP address can be found in the Configuring <acronym class="acronym">JON</acronym> Servers and Agents Guide available at <a href="https://access.redhat.com/documentation/en-US/JBoss_Operations_Network">https://access.redhat.com/documentation/en-US/JBoss_Operations_Network</a>.
	</div><div class="para">
		If there are a high number of instances launched and/or terminated it can become impractical to add and remove them manually from the <acronym class="acronym">JON</acronym> inventory. <acronym class="acronym">JON</acronym>'s scripting capabilities can be used for automate these steps. Refer to the <acronym class="acronym">JON</acronym> documentation for further information.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9482-767774+%5BLatest%5D&amp;comment=Title%3A+About+Terminating+and+Restarting+with+JON%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9482-767774+19+Aug+2015+08%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_an_EAP_Instance_to_Register_with_JON">
      ⁠</a>24.9.7. Configure an Instance to Register with JBoss Operations Network</h2></div></div></div><div class="para">
		Use the following procedure to register a JBoss EAP 6 instance with JBoss Operations Network.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ul><li class="step"><div class="para">
				For JBoss EAP 6, add this to the User Data field.
			</div><pre class="programlisting">JON_SERVER_ADDR=jon2.it.example.com
## if instance not already configured to resolve its hostname
JON_AGENT_ADDR=`ip addr show dev eth0 primary to 0/0 | sed -n 's#.*inet \([0-9.]\+\)/.*#\1#p'` 
PORTS_ALLOWED=16163
# insert other JON options when necessary.</pre><div class="para">
				See <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#Permanent_Script_Parameters">Section 24.10.1, “Permanent Configuration Parameters”</a>, parameters starting with <em class="parameter"><code>JON_</code></em> for the format of JON options.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9483-631856+%5BLatest%5D&amp;comment=Title%3A+Configure+an+Instance+to+Register+with+JBoss+Operations+Network%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9483-631856+15+Apr+2014+21%3A41+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-User_Script_Configuration">
      ⁠</a>24.10. User Script Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Permanent_Script_Parameters">
      ⁠</a>24.10.1. Permanent Configuration Parameters</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			The following parameters can be used to influence the configuration and operation of JBoss EAP 6. Their contents are written to <code class="filename">/etc/sysconfig/jbossas</code> and <code class="filename">/etc/sysconfig/jon-agent-ec2</code>.
		</div><div class="table"><a id="idm139978526141280">
      ⁠</a><p class="title"><strong>Table 24.2. Configurable Parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-14-rows" summary="Configurable Parameters"><colgroup><col width="33%" style="text-align: left" class="c1"/><col width="33%" style="text-align: left" class="c2"/><col width="33%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Name </th><th style="text-align: left"> Description </th><th style="text-align: left"> Default </th></tr></thead><tbody><tr><td style="text-align: left"> JBOSS_JGROUPS_S3_PING_ACCESS_KEY </td><td style="text-align: left"> Amazon AWS user account access key for S3_PING discovery if clustering is used. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSS_JGROUPS_S3_PING_SECRET_ACCESS_KEY </td><td style="text-align: left"> Amazon AWS user account secret access key. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSS_JGROUPS_S3_PING_BUCKET </td><td style="text-align: left"> Amazon S3 bucket to be used for S3_PING discovery. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSS_CLUSTER_ID </td><td style="text-align: left"> <div class="para">
						ID of cluster member nodes. Only used for clustering. Accepted values are (in order):
					</div>
					 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
								A valid cluster ID number in the range <code class="literal">0</code> - <code class="literal">1023</code>.
							</div></li><li class="listitem"><div class="para">
								A network interface name, where the last octet of the IP is used as the value.
							</div></li><li class="listitem"><div class="para">
								"S3" as a value would coordinate ID usage through the S3 bucket used by jgroups' S3_PING.
							</div><div class="para">
								It is recommended to use the last octet of the IP (the default) when all cluster nodes are located in the same 24 or more bit subnet (for example, in a VPC subnet).
							</div></li></ul></div>
					 </td><td style="text-align: left"> Last octet of eth0's IP address </td></tr><tr><td style="text-align: left"> MOD_CLUSTER_PROXY_LIST </td><td style="text-align: left"> Comma-delimited list of IPs/hostnames of mod_cluster proxies if mod_cluster is to be used. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> PORTS_ALLOWED </td><td style="text-align: left"> List of incoming ports to be allowed by firewall in addition to the default ones. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSSAS_ADMIN_PASSWORD </td><td style="text-align: left"> Password for the <code class="literal">admin</code> user. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JON_SERVER_ADDR </td><td style="text-align: left"> JON server hostname or IP with which to register. This is only used for registration, after that the agent may communicate with other servers in the JON cluster. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JON_SERVER_PORT </td><td style="text-align: left"> Port used by the agent to communicate with the server. </td><td style="text-align: left"> 7080 </td></tr><tr><td style="text-align: left"> JON_AGENT_NAME </td><td style="text-align: left"> Name of JON agent, must be unique. </td><td style="text-align: left"> Instance's ID </td></tr><tr><td style="text-align: left"> JON_AGENT_PORT </td><td style="text-align: left"> Port that the agent listens on. </td><td style="text-align: left"> 16163 </td></tr><tr><td style="text-align: left"> JON_AGENT_ADDR </td><td style="text-align: left"> IP address that the JON agent is to be bound to. This is used when the server has more than one public address, (e.g. VPN). </td><td style="text-align: left"> JON agent chooses the IP of local hostname by default. </td></tr><tr><td style="text-align: left"> JON_AGENT_OPTS </td><td style="text-align: left"> Additional JON agent system properties which can be used for configuring SSL, NAT and other advanced settings. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSS_SERVER_CONFIG </td><td style="text-align: left"> <div class="para">
						Name of JBoss EAP 6 server configuration file to use. If JBOSS_DOMAIN_CONTROLLER=true, then <code class="filename">domain-ec2.xml</code> is used. Otherwise:
					</div>
					 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
								If S3 config is present, then <code class="filename">standalone-ec2-ha.xml</code> is used.
							</div></li><li class="listitem"><div class="para">
								If MOD_CLUSTER_PROXY_LIST is specified, then <code class="filename">standalone-mod_cluster-ec2-ha.xml</code> is selected.
							</div></li><li class="listitem"><div class="para">
								If neither of the first two options are used, then the <code class="filename">standalone.xml</code> file is used.
							</div></li><li class="listitem"><div class="para">
								Can also be set to <code class="filename">standalone-full.xml</code>.
							</div></li></ul></div>
					 </td><td style="text-align: left"> <code class="filename">standalone.xml</code>, <code class="filename">standalone-full.xml</code>, <code class="filename">standalone-ec2-ha.xml</code>, <code class="filename">standalone-mod_cluser-ec2-ha.xml</code>, <code class="filename">domain-ec2.xml</code> depending on the other parameters. </td></tr><tr><td style="text-align: left"> JAVA_OPTS </td><td style="text-align: left"> Custom values to be added to the variable before JBoss EAP 6 starts. </td><td style="text-align: left"> JAVA_OPTS is built from the values of other parameters. </td></tr><tr><td style="text-align: left"> JBOSS_IP </td><td style="text-align: left"> IP address that the server is to be bound to. </td><td style="text-align: left"> 127.0.0.1 </td></tr><tr><td style="text-align: left"> JBOSSCONF </td><td style="text-align: left"> The name of the JBoss EAP 6 profile to start. To prevent JBoss EAP 6 from starting, JBOSSCONF can be set to <code class="literal">disabled</code> </td><td style="text-align: left"> <code class="code">standalone</code> </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_DOMAIN_CONTROLLER
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Sets whether or not this instance will run as a domain controller.
					</div>
					 </td><td style="text-align: left"> <div class="para">
						<code class="literal">false</code>
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_DOMAIN_MASTER_ADDRESS
					</div>
					 </td><td style="text-align: left"> <div class="para">
						IP address of remote domain controller.
					</div>
					 </td><td style="text-align: left"> <div class="para">
						N/A
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_HOST_NAME
					</div>
					 </td><td style="text-align: left"> <div class="para">
						The logical host name (within the domain). This needs to be distinct.
					</div>
					 </td><td style="text-align: left"> <div class="para">
						The value of the HOSTNAME environment variable.
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_HOST_USERNAME
					</div>
					 </td><td style="text-align: left"> <div class="para">
						The username the host controller should use when registering with the domain controller. If not provided, the JBOSS_HOST_NAME is used instead.
					</div>
					 </td><td style="text-align: left"> <div class="para">
						JBOSS_HOST_NAME
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_HOST_PASSWORD
					</div>
					 </td><td style="text-align: left"> <div class="para">
						The password the host controller should use when registering with the domain controller.
					</div>
					 </td><td style="text-align: left"> <div class="para">
						N/A
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_HOST_CONFIG
					</div>
					 </td><td style="text-align: left"> <div class="para">
						If JBOSS_DOMAIN_CONTROLLER=true, then <code class="filename">host-master.xml</code> is used. If JBOSS_DOMAIN_MASTER_ADDRESS is present, then <code class="filename">host-slave.xml</code> is used.
					</div>
					 </td><td style="text-align: left"> <div class="para">
						<code class="filename">host-master.xml</code> or <code class="filename">host-slave.xml</code>, depending on the other parameters.
					</div>
					 </td></tr><tr><td style="text-align: left"> JBOSS_DOMAIN_S3_ACCESS_KEY </td><td style="text-align: left"> Amazon AWS user account access key for S3 domain controller discovery. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSS_DOMAIN_S3_SECRET_ACCESS_KEY </td><td style="text-align: left"> Amazon AWS user account secret access key for S3 domain controller discovery. </td><td style="text-align: left"> N/A </td></tr><tr><td style="text-align: left"> JBOSS_DOMAIN_S3_BUCKET </td><td style="text-align: left"> Amazon S3 bucket to be used for S3 domain controller discovery. </td><td style="text-align: left"> N/A </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9347-631772+%5BLatest%5D&amp;comment=Title%3A+Permanent+Configuration+Parameters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9347-631772+15+Apr+2014+19%3A27+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Custom_Script_Parameters1">
      ⁠</a>24.10.2. Custom Script Parameters</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			The following parameters can be used in the user customization section of the <span class="guilabel"><strong>User Data:</strong></span> field.
		</div><div class="table"><a id="idm139978518523904">
      ⁠</a><p class="title"><strong>Table 24.3. Configurable Parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Configurable Parameters"><colgroup><col width="33%" style="text-align: left" class="c1"/><col width="67%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Name </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> <div class="para">
						JBOSS_DEPLOY_DIR
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Deploy directory of the active profile (for example, <code class="filename">/var/lib/jbossas/standalone/deployments/</code>). Deployable archives placed in this directory will be deployed. Red Hat recommends using the Management Console or CLI tool to manage deployments instead of using the deploy directory.
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_CONFIG_DIR
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Config directory of the active profile (for example, <code class="filename">/var/lib/jbossas/standalone/configuration</code>).
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_HOST_CONFIG
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Name of the active host configuration file (for example, <code class="filename">host-master.xml</code>). Red Hat recommends using the Management Console or CLI tools to configure the server instead of editing the configuration file.
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						JBOSS_SERVER_CONFIG
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Name of the active server configuration file (for example, <code class="filename">standalone-ec2-ha.xml</code>). Red Hat recommends using the Management Console or CLI tools to configure the server instead of editing the configuration file.
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						USER_SCRIPT
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Path to the custom configuration script, which is available prior to sourcing user-data configuration.
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						USER_CLI_COMMANDS
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Path to a custom file of CLI commands, which is available prior to sourcing user-data configuration.
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9348-591875+%5BLatest%5D&amp;comment=Title%3A+Custom+Script+Parameters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9348-591875+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Troubleshooting">
      ⁠</a>24.11. Troubleshooting</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Troubleshooting_Amazon_EC2">
      ⁠</a>24.11.1. About Troubleshooting Amazon EC2</h2></div></div></div><div class="para">
		EC2 provides an Alarm Status for each instance, indicating severe instance malfunction but the absence of such an alarm is no guarantee that the instance has started correctly and services are running properly. It is possible to use Amazon CloudWatch with its custom metric functionality to monitor instance services' health but use of an enterprise management solution is recommended.
	</div><div class="para">
		To simplify troubleshooting, Red Hat recommends managing the EC2 instance using JBoss Operations Network (JON) which can automatically discover, monitor and manage many services on an EC2 instance with the JON agent installed, including: JBoss EAP 6, Tomcat, Apache HTTP Server, and PostgreSQL. For details of monitoring JBoss EAP with JON, see <a class="xref" href="chap-Deploy_JBoss_EAP_6_on_Amazon_EC2.html#About_AMI_Monitoring">Section 24.9.1, “About AMI Monitoring”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9375-684498+%5BLatest%5D&amp;comment=Title%3A+About+Troubleshooting+Amazon+EC2%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9375-684498+14+Jul+2014+02%3A42+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Diagnostic_Information1">
      ⁠</a>24.11.2. Diagnostic Information</h2></div></div></div><div class="para">
		In case of a problem being detected by the JBoss Operations Network, Amazon CloudWatch or manual inspection, common sources of diagnostic information are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="filename">/var/log/jboss_user-data.out</code> is the output of the jboss-ec2-eap init script and user custom configuration script.
			</div></li><li class="listitem"><div class="para">
				<code class="filename">/var/cache/jboss-ec2-eap/</code> contains the actual user data, custom script, and custom CLI commands used at instance start-up.
			</div></li><li class="listitem"><div class="para">
				<code class="filename">/var/log</code> also contains all the logs collected from machine start up, JBoss EAP 6, httpd and most other services.
			</div></li></ul></div><div class="para">
		Access to these files is only available via an SSH session. Refer to the Amazon EC Getting Started Guide for details on how to configure and establish an SSH session with an Amazon EC2 instance.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9349-591875+%5BLatest%5D&amp;comment=Title%3A+Diagnostic+Information%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9349-591875+23+Feb+2014+16%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>