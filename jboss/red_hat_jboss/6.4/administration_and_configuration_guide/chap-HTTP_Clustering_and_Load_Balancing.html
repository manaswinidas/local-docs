<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 17. HTTP Clustering and Load Balancing</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-HTTP_Clustering_and_Load_Balancing">
      ⁠</a>Chapter 17. HTTP Clustering and Load Balancing</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="HTTP_Server_name_conventions">
      ⁠</a>17.1. HTTP Server name conventions</h1></div></div></div><div class="para">
		The following tables outline the naming and location conventions used when discussing HTTPD-related topics.
	</div><div class="table"><a id="idm139978504375728">
      ⁠</a><p class="title"><strong>Table 17.1. Apache HTTP Server provided by operating system</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols lt-7-rows" summary="Apache HTTP Server provided by operating system"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th> Operating System </th><th> <em class="replaceable">HTTPD_CONF.D</em> </th><th> <em class="replaceable">HTTPD_CONF</em> </th><th> <em class="replaceable">HTTPD_MODULES</em> </th></tr></thead><tbody><tr><td> Red Hat Enterprise Linux (httpd) </td><td> <code class="filename">/etc/httpd/conf.d</code> </td><td> <code class="filename">/etc/httpd/conf</code> </td><td> <code class="filename">/etc/httpd/modules</code> </td></tr><tr><td> HPUX (Web Server Suite) </td><td> See note below. </td><td> <code class="filename">/opt/hpws/apache/conf</code> </td><td> <code class="filename">/opt/hpws/apache/modules</code> </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			There is no <code class="filename">conf.d</code> in HP-UX's Web server Suite for Apache HTTP Server. You can create one, however:
		</div><div class="procedure"><a id="idm139978500980480">
      ⁠</a><p class="title"><strong>Procedure 17.1. title</strong></p><ol class="1"><li class="step"><div class="para">
					Create <code class="filename">/opt/hpws/apache/conf.d</code>.
				</div></li><li class="step"><div class="para">
					Add <code class="literal">Include conf.d/*.conf</code> into the <code class="filename">httpd.conf</code> file.
				</div></li></ol></div></div></div><div class="table"><a id="idm139978451829056">
      ⁠</a><p class="title"><strong>Table 17.2. JBoss Enterprise Web Server</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols lt-7-rows" summary="JBoss Enterprise Web Server"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th style="text-align: left"> Operating System </th><th style="text-align: left"> <em class="replaceable">HTTPD_CONF.D</em> </th><th style="text-align: left"> <em class="replaceable">HTTPD_CONF</em> </th><th style="text-align: left"> <em class="replaceable">HTTPD_MODULES</em> </th><th style="text-align: left"> <div class="para">
						Distribution
					</div>
					 </th></tr></thead><tbody><tr><td style="text-align: left"> Red Hat Enterprise Linux </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/httpd/conf.d</code> </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/httpd/conf</code> </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/httpd/modules</code> </td><td style="text-align: left"> <div class="para">
						zip
					</div>
					 </td></tr><tr><td style="text-align: left"> <div class="para">
						Red Hat Enterprise Linux
					</div>
					 </td><td style="text-align: left"> <div class="para">
						<code class="filename">/etc/httpd/conf.d</code>
					</div>
					 </td><td style="text-align: left"> <div class="para">
						<code class="filename">/etc/httpd/conf</code>
					</div>
					 </td><td style="text-align: left"> <div class="para">
						<code class="filename">/usr/lib/httpd/modules</code>
					</div>
					 </td><td style="text-align: left"> <div class="para">
						rpm
					</div>
					 </td></tr><tr><td style="text-align: left"> Solaris </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/etc/httpd/conf.d</code> </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/etc/httpd/conf</code> </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/lib/httpd/modules</code> </td><td style="text-align: left"> <div class="para">
						zip
					</div>
					 </td></tr><tr><td style="text-align: left"> Windows </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/etc/httpd/conf.d</code> </td><td style="text-align: left"> <code class="filename">/<em class="replaceable">EWS_HOME</em>/etc/httpd/conf</code> </td><td style="text-align: left"> <div class="para">
						<code class="filename">/<em class="replaceable">EWS_HOME</em>/lib/httpd/modules</code>
					</div>
					 </td><td style="text-align: left"> <div class="para">
						zip
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="itemizedlist"><p class="title"><strong>Path variances:</strong></p><ul><li class="listitem"><div class="para">
					If you are using a 64-bit architecture, amend the filepaths from the table above to use the <code class="filename">lib64/</code> directory.
				</div></li><li class="listitem"><div class="para">
					If you are using a Red Hat Enterprise Linux 7 installation, the <code class="filename">httpd</code> directory is named <code class="filename">httpd22</code>.
				</div></li></ul></div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42292-750679+%5BLatest%5D&amp;comment=Title%3A+HTTP+Server+name+conventions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42292-750679+13+Apr+2015+22%3A02+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Introduction">
      ⁠</a>17.2. Introduction</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_High-Availability_and_Load_Balancing_Clusters">
      ⁠</a>17.2.1. About High-Availability and Load Balancing Clusters</h2></div></div></div><div class="para">
		<em class="firstterm">Clustering</em> refers to using multiple resources, such as servers, as though they were a single entity. The two main types of clustering are <em class="firstterm">Load balancing (LB)</em> and <em class="firstterm">High-availability (HA)</em>. In a LB cluster, all resources run at the same time, and a management layer spreads the work load across them.
	</div><div class="para">
		In HA clustering, one resource runs, and another is available to step in if the first one becomes unavailable. The purpose of HA clustering is to reduce the consequences of hardware, software, or network outages.
	</div><div class="para">
		JBoss EAP 6 supports clustering at several different levels. Some of the components of the runtime and your applications that can be made highly available are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Instances of the Application Server
			</div></li><li class="listitem"><div class="para">
				Web applications, when used in conjunction with the internal JBoss Web Server, Apache HTTP Server, Microsoft IIS, or Oracle iPlanet Web Server.
			</div></li><li class="listitem"><div class="para">
				Stateful, stateless, and entity Enterprise JavaBeans (EJBs)
			</div></li><li class="listitem"><div class="para">
				Single Sign On (SSO) Mechanisms
			</div></li><li class="listitem"><div class="para">
				Distributed cache
			</div></li><li class="listitem"><div class="para">
				HTTP sessions
			</div></li><li class="listitem"><div class="para">
				JMS services and Message-driven beans (MDBs)
			</div></li></ul></div><div class="para">
		Clustering is made available to JBoss EAP 6 by two subsystems: <code class="literal">jgroups</code> and <code class="literal">modcluster</code>. The <code class="literal">ha</code> and <code class="literal">full-ha</code> profiles have these systems enabled. In JBoss EAP 6 these services start up and shut down on demand, but they will only start up if an application configured as <code class="literal">distributable</code> is deployed on the servers.
	</div><div class="para">
		Infinispan is provided as the cache provider in JBoss EAP 6. Infinispan manages clustering and replication caches for JBoss EAP 6.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4647-723811+%5BLatest%5D&amp;comment=Title%3A+About+High-Availability+and+Load+Balancing+Clusters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4647-723811+04+Nov+2014+19%3A23+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Components_Which_Can_Benefit_from_High_Availability1">
      ⁠</a>17.2.2. Components Which Can Benefit from High Availability</h2></div></div></div><div class="para">
		High Availability (HA) falls into a few broad categories in JBoss EAP 6.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">The Container</div>
			Several instances of JBoss EAP 6 (running as a standalone server) or a server group's members (running as part of a managed domain) can be configured to be highly available. This means that if one instance or member is stopped or disappears from the cluster, its work load is moved to a peer. The work load can be managed in such a way to provide load-balancing functionality as well, so that servers or server groups with more or better resources can take on a larger portion of the work load, or additional capacity can be added during times of high load.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">The Web Server</div>
			The web server itself can be clustered for HA, using one of several compatible load balancing mechanisms. The most flexible is <code class="code">mod_cluster</code> connector, which is tightly integrated with the JBoss EAP 6 container. Other choices include Apache <code class="code">mod_jk</code> or <code class="code">mod_proxy</code> connectors, or the ISAPI connector and NSAPI connector.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">The Application</div>
			Deployed applications can be made highly-available because of the Java Enterprise Edition 6 (Java EE 6) specification. Stateless or stateful session EJBs can be clustered so that if the node which is involved in the work disappears, another node can take over, and in the case of stateful session beans, preserve the state.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4648-759233+%5BLatest%5D&amp;comment=Title%3A+Components+Which+Can+Benefit+from+High+Availability%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4648-759233+25+May+2015+07%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Overview_of_HTTP_Connectors">
      ⁠</a>17.2.3. Overview of HTTP Connectors</h2></div></div></div><div class="para">
		JBoss EAP 6 has the ability to use load-balancing and high-availability mechanisms built into external web servers, such as Apache Web Server, Microsoft IIS, and Oracle iPlanet. JBoss EAP 6 communicates with the external web server using a connector. These connectors are configured within the web subsystem of JBoss EAP 6.
	</div><div class="para">
		The web servers include software modules which control the way that HTTP requests are routed to JBoss EAP 6 nodes. Each of these modules varies in how it works and how it is configured. The modules are configured to balance work loads across multiple JBoss EAP 6 nodes, to move work loads to alternate servers in case of a failure event, or both. These abilities are called <em class="firstterm">Load Balancing</em> and <em class="firstterm">High Availability (HA)</em>.
	</div><div class="para">
		JBoss EAP 6 supports several different connectors. The one you choose depends on the web server in use and the functionality you need.
	</div><div class="para">
		The table below lists the differences between the different HTTP connectors which are compatible with JBoss EAP 6. For the most current information about supported configurations for HTTP connectors, see <a href="https://access.redhat.com/articles/111663">https://access.redhat.com/articles/111663</a>.
	</div><div class="table"><a id="idm139978445564784">
      ⁠</a><p class="title"><strong>Table 17.3. HTTP connector features and constraints</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols lt-7-rows" summary="HTTP connector features and constraints"><colgroup><col width="8%"/><col width="15%"/><col width="23%"/><col width="15%"/><col width="31%"/><col width="8%"/></colgroup><thead><tr><th> Connector </th><th> Web server </th><th> Supported operating systems </th><th> Supported protocols </th><th> Adapts to deployment status </th><th> Supports sticky session </th></tr></thead><tbody><tr><td> mod_cluster </td><td> httpd in JBoss Enterprise Web Server, httpd provided by operating system (Red Hat Enterprise Linux, Hewlett-Packard HP-UX) </td><td> Red Hat Enterprise Linux, Microsoft Windows Server, Oracle Solaris, Hewlett-Packard HP-UX </td><td> HTTP, HTTPS, AJP </td><td> Yes. Detects deployment and undeployment of applications and dynamically decides whether to direct client requests to a server based on whether the application is deployed on that server. </td><td> Yes </td></tr><tr><td> mod_jk </td><td> httpd in JBoss Enterprise Web Server, httpd provided by operating system (Red Hat Enterprise Linux, Hewlett-Packard HP-UX) </td><td> Red Hat Enterprise Linux, Microsoft Windows Server, Oracle Solaris, Hewlett-Packard HP-UX </td><td> AJP </td><td> No. Directs client requests to the container as long as the container is available, regardless of application status. </td><td> Yes </td></tr><tr><td> mod_proxy </td><td> httpd in JBoss Enterprise Web Server </td><td> Red Hat Enterprise Linux, Microsoft Windows Server, Oracle Solaris </td><td> HTTP, HTTPS, AJP </td><td> No. Directs client requests to the container as long as the container is available, regardless of application status. </td><td> Yes </td></tr><tr><td> ISAPI connector </td><td> Microsoft IIS </td><td> Microsoft Windows Server </td><td> AJP </td><td> No. Directs client requests to the container as long as the container is available, regardless of application status. </td><td> Yes </td></tr><tr><td> NSAPI connector </td><td> Oracle iPlanet Web Server </td><td> Oracle Solaris </td><td> AJP </td><td> No. Directs client requests to the container as long as the container is available, regardless of application status. </td><td> Yes </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Learn more about each HTTP Connector</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Modcluster_HTTP_Connector">Section 17.6.1, “About the <code class="code">mod_cluster</code> HTTP Connector”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Apache_mod_jk_HTTP_Connector">Section 17.7.1, “About the Apache mod_jk HTTP Connector”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Apache_mod_proxy_HTTP_Connector1">Section 17.8.1, “About the Apache mod_proxy HTTP Connector”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Internet_Server_API_ISAPI_HTTP_Connector">Section 17.9.1, “About the Internet Server API (ISAPI)”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Netscape_Server_API_NSAPI_HTTP_Connector1">Section 17.10.1, “About the Netscape Server API (NSAPI)”</a>
			</div></li></ul></div><div class="para">
		JBoss EAP 6 supported configurations are available here: <a href="https://access.redhat.com/articles/111663">https://access.redhat.com/articles/111663</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5213-767770+%5BLatest%5D&amp;comment=Title%3A+Overview+of+HTTP+Connectors%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5213-767770+19+Aug+2015+08%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Worker_Node">
      ⁠</a>17.2.4. Node types</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">HTTP connector node</div>
			A <em class="firstterm">worker node</em>, sometimes referred to as a node, is a JBoss EAP 6 server instance which accepts requests from one or more client-facing HTTP servers that act as a proxy. JBoss EAP 6 can accept HTTP, HTTPS and AJP requests from Apache HTTP Server, Microsoft IIS or Oracle iPlanet Web Server (formerly Netscape Web Server).
		</div><div class="para">
		For an overview of HTTP connectors supported by JBoss EAP 6 and how to configure them, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Overview_of_HTTP_Connectors">Section 17.2.3, “Overview of HTTP Connectors”</a>.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Cluster node</div>
			<em class="firstterm">Cluster node</em> is a specialization of the worker node. Such a cluster may be load-balancing, high-availability or both. In a load-balancing cluster, a central manager distributes work loads amongst its nodes equally, by some situation-specific measurement of equality. In a high-availability cluster, some nodes are actively doing work, and others are waiting to step in if one of the active nodes leaves the cluster.
		</div><div class="example"><a id="idm139978541292768">
      ⁠</a><p class="title"><strong>Example 17.1. Apache HTTP Server with mod_cluster configured</strong></p><div class="example-contents"><div class="para">
			For instance, you might have a setup where Apache HTTP Server with mod_cluster configured acts as a load-balancing proxy to client's requests. These requests are forwarded to particular cluster nodes according to their current load. In case the sticky sessions are disabled, all incoming requests are distributed according to the current load. In case sticky sessions are enabled (default), subsequent requests within an already created session are routed to the worker node with which the session was created. If one of these cluster nodes dies or becomes overloaded, Apache HTTP Server with mod_cluster acting as a load-balancing proxy will forward client's request to another cluster node. Due to the session replication within the cluster, client's data will not be lost.
		</div><div class="para">
			Similarly, you might have a simpler setup with worker nodes that are not clustered. If a worker node dies, its neighbor does not have the former session data, yet client will not get any non-HTTP 200 error code.
		</div><div class="para">
			In the case of sticky session configuration, it does not matter to the load-balancing proxy whether or not its worker nodes are clustered.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4651-765848+%5BLatest%5D&amp;comment=Title%3A+Node+types%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4651-765848+23+Jul+2015+13%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Connector_Configuration">
      ⁠</a>17.3. Connector Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Define_Thread_Pools_for_HTTP_Connector_in_JBoss_Enterprise_Application_Platform">
      ⁠</a>17.3.1. Define Thread Pools for HTTP Connector in JBoss EAP 6</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			Thread Pools in JBoss EAP 6 can be shared between different components using the Executor model. These pools can be shared not only by different (HTTP) connectors, but also by other components within JBoss EAP 6 that support the Executor model. Getting the HTTP connector thread pool to match your current web performance requirements is tricky and requires close monitoring of the current thread pool and the current and anticipated web load demands. In this task, you will learn how to set the a thread pool for an HTTP Connector using the Executor model. You will learn how to set this using both the Management CLI and by modifying the XML configuration file.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			If you are running JBoss EAP in domain mode, add the prefix <code class="command">/profile=<em class="parameter"><code>PROFILE_NAME</code></em></code> to all Management CLI commands in this procedure.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978540934944">
      ⁠</a><p class="title"><strong>Procedure 17.2. Setup a thread pool for an HTTP Connector</strong></p><ol class="1"><li class="step"><p class="title"><strong>Define a thread factory</strong></p><div class="para">
				Open up your configuration file (<code class="filename">standalone.xml</code> if modifying for a standalone server or <code class="filename">domain.xml</code> if modifying for a domain based configuration. This file will be in the <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration</code> or the <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration</code> folder).
			</div><div class="para">
				Add the following subsystem entry, changing the values to suit your server requirements.
			</div><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:threads:1.1"&gt;
    &lt;thread-factory name="http-connector-factory" thread-name-pattern="HTTP-%t" priority="9" group-name="uq-thread-pool"/&gt;
&lt;/subsystem&gt;
</pre><div class="para">
				If you prefer to use the Management CLI to do this task, then execute the following command in a CLI command prompt:
			</div><pre class="programlisting">[standalone@localhost:9999 /] ./subsystem=threads/thread-factory=http-connector-factory:add(thread-name-pattern="HTTP-%t", priority="9", group-name="uq-thread-pool")</pre></li><li class="step"><p class="title"><strong>Create an executor</strong></p><div class="para">
				You can use one of six in-built executor classes to act as the executor for this factory. The six executors are: 
				<div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="filename">unbounded-queue-thread-pool</code>: This type of thread pool always accepts tasks. If fewer than the maximum number of threads are running, a new thread is started up to run the submitted task; otherwise, the task is placed into an unbounded FIFO queue to be executed when a thread is available. 
							<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									The single-thread executor type provided by <code class="code">Executors.singleThreadExecutor()</code> is essentially an unbounded-queue executor with a thread limit of one. This type of executor is deployed using the <code class="code">unbounded-queue-thread-pool-executor</code> element.
								</div></div></div>

						</div></li><li class="listitem"><div class="para">
							<code class="filename">bounded-queue-thread-pool</code>: This type of executor maintains a fixed-length queue and two pool sizes: a <code class="code">core</code> size and a <code class="code">maximum</code> size. When a task is accepted, if the number of running pool threads is less than the <code class="code">core</code> size, a new thread is started to execute the task. If space remains in the queue, the task is placed in the queue. If the number of running pool threads is less than the <code class="code">maximum</code> size, a new thread is started to execute the task. If blocking is enabled on the executor, the calling thread will block until space becomes available in the queue. The task is delegated to the handoff executor, if a handoff executor is configured. Otherwise, the task is rejected.
						</div></li><li class="listitem"><div class="para">
							<code class="filename">blocking-bounded-queue-thread-pool</code>: A thread pool executor with a bounded queue where threads submittings tasks may block. Such a thread pool has a core and maximum size and a specified queue length. When a task is submitted, if the number of running threads is less than the core size, a new thread is created. Otherwise, if there is room in the queue, the task is enqueued. Otherwise, if the number of running threads is less than the maximum size, a new thread is created. Otherwise, the caller blocks until room becomes available in the queue.
						</div></li><li class="listitem"><div class="para">
							<code class="filename">queueless-thread-pool</code>: Sometimes, a simple thread pool is required to run tasks in separate threads, reusing threads as they complete their tasks with no intervening queue. This type of pool is ideal for handling tasks which are long-running, perhaps utilizing blocking I/O, since tasks are always started immediately upon acceptance rather than accepting a task and then delaying its execution until other running tasks have completed. This type of executor is declared using the <code class="code">queueless-thread-pool-executor</code> element.
						</div></li><li class="listitem"><div class="para">
							<code class="filename">blocking-queueless-thread-pool</code>: A thread pool executor with no queue where threads submittings tasks may block. When a task is submitted, if the number of running threads is less than the maximum size, a new thread is created. Otherwise, the caller blocks until another thread completes its task and accepts the new one.
						</div></li><li class="listitem"><div class="para">
							<code class="filename">scheduled-thread-pool</code>:This is a special type of executor whose purpose is to execute tasks at specific times and time intervals, based on the <code class="code">java.util.concurrent.ScheduledThreadPoolExecutor</code> class. This type of executor is configured with the <code class="code">scheduled-thread-pool-executor</code> element:
						</div></li></ul></div>

			</div><div class="para">
				In this example, we will use the <code class="filename">unbounded-queue-thread-pool</code> to act as the executor. Modify the values of <em class="parameter"><code>max-threads</code></em> and <em class="parameter"><code>keepalive-time</code></em> parameters to suit your server needs.
			</div><pre class="programlisting">&lt;unbounded-queue-thread-pool name="uq-thread-pool"&gt;
  &lt;thread-factory name="http-connector-factory" /&gt;
  &lt;max-threads count="10" /&gt;
  &lt;keepalive-time time="30" unit="seconds" /&gt;
&lt;/unbounded-queue-thread-pool&gt;</pre><div class="para">
				Or if you prefer to use the Management CLI:
			</div><pre class="programlisting">[standalone@localhost:9999 /] ./subsystem=threads/unbounded-queue-thread-pool=uq-thread-pool:add(thread-factory="http-connector-factory", keepalive-time={time=30, unit="seconds"}, max-threads=30)</pre></li><li class="step"><p class="title"><strong>Make the HTTP web connector use this thread pool</strong></p><div class="para">
				In the same configuration file, locate the HTTP connector element under the web subsystem and modify it to use the thread pool defined in the previous steps.
			</div><pre class="programlisting">&lt;connector name="http" protocol="HTTP/1.1" scheme="http" socket-binding="http" executor="uq-thread-pool" /&gt;</pre><div class="para">
				Again, if you prefer to use the Management CLI:
			</div><pre class="programlisting">[standalone@localhost:9999 /] ./subsystem=web/connector=http:write-attribute(name=executor, value="uq-thread-pool")</pre></li><li class="step"><p class="title"><strong>Restart the server</strong></p><div class="para">
				Restart the server (standalone or domain) so that the changes can take effect. Use the following Management CLI commands to confirm if the changes from the steps above have taken place:
			</div><pre class="programlisting">[standalone@localhost:9999 /] ./subsystem=threads:read-resource(recursive=true)
{                  
    "outcome" =&gt; "success",
    "result" =&gt; {
        "blocking-bounded-queue-thread-pool" =&gt; undefined,
        "blocking-queueless-thread-pool" =&gt; undefined,
        "bounded-queue-thread-pool" =&gt; undefined,
        "queueless-thread-pool" =&gt; undefined,
        "scheduled-thread-pool" =&gt; undefined,
        "thread-factory" =&gt; {"http-connector-factory" =&gt; {
            "group-name" =&gt; "uq-thread-pool",
            "name" =&gt; "http-connector-factory",
            "priority" =&gt; 9,
            "thread-name-pattern" =&gt; "HTTP-%t"
        }},
        "unbounded-queue-thread-pool" =&gt; {"uq-thread-pool" =&gt; {
            "keepalive-time" =&gt; {
                "time" =&gt; 30L,
                "unit" =&gt; "SECONDS"
            },
            "max-threads" =&gt; 30,
            "name" =&gt; "uq-thread-pool",
            "thread-factory" =&gt; "http-connector-factory"
        }}
    }
}
[standalone@localhost:9999 /] ./subsystem=web/connector=http:read-resource(recursive=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "configuration" =&gt; undefined,
        "enable-lookups" =&gt; false,
        "enabled" =&gt; true,
        "executor" =&gt; "uq-thread-pool",
        "max-connections" =&gt; undefined,
        "max-post-size" =&gt; 2097152,
        "max-save-post-size" =&gt; 4096,
        "name" =&gt; "http",
        "protocol" =&gt; "HTTP/1.1",
        "proxy-name" =&gt; undefined,
        "proxy-port" =&gt; undefined,
        "redirect-port" =&gt; 443,
        "scheme" =&gt; "http",
        "secure" =&gt; false,
        "socket-binding" =&gt; "http",
        "ssl" =&gt; undefined,
        "virtual-server" =&gt; undefined
    }
}
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			You have successfully created a thread factory and an executor and modified your HTTP Connector to use this thread pool.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14050-742578+%5BLatest%5D&amp;comment=Title%3A+Define+Thread+Pools+for+HTTP+Connector+in+JBoss+EAP+6%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14050-742578+11+Feb+2015+05%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Web_Server_Configuration">
      ⁠</a>17.4. Web Server Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Stand-Alone_HTTPD1">
      ⁠</a>17.4.1. About the Standalone Apache HTTP Server</h2></div></div></div><div class="para">
		JBoss EAP 6 is tested and supported with the Apache HTTP server which is included with certified versions of Red Hat Enterprise Linux 6. Apache HTTP server is also available for other operating systems, such as Microsoft Windows Server. However, since Apache HTTP server is a separate product produced by the Apache Foundation, it was previously difficult to be sure that the version of Apache HTTP server a customer used was compatible with JBoss EAP.
	</div><div class="para">
		A standalone Apache HTTP server bundle is now available as a separate download with JBoss EAP 6. This simplifies installation and configuration in environments other than Red Hat Enterprise Linux, or on systems which already have a configured Apache HTTP server and want to use a separate instance for web applications. You can download this Apache HTTP server as a separate download in the Customer Service Portal, listed under the available JBoss EAP 6 downloads for your installation platform.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5727-719829+%5BLatest%5D&amp;comment=Title%3A+About+the+Standalone+Apache+HTTP+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5727-719829+29+Oct+2014+00%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="HTTPD_Variable_Conventions">
      ⁠</a>17.4.2. HTTPD Variable Conventions</h2></div></div></div><div class="table"><a id="idm139978507360272">
      ⁠</a><p class="title"><strong>Table 17.4. Native </strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Native "><colgroup><col width="33%" style="text-align: left" class="c1"/><col width="33%" style="text-align: left" class="c2"/><col width="33%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Product </th><th style="text-align: left"> HTTPD_CONF </th><th style="text-align: left"> HTTPD_MODULES </th></tr></thead><tbody><tr><td style="text-align: left"> Red Hat Enterprise Linux </td><td style="text-align: left"> /etc/httpd/conf </td><td style="text-align: left"> /etc/httpd/modules </td></tr><tr><td style="text-align: left"> HPUX </td><td style="text-align: left"> /opt/hpws/apache/conf </td><td style="text-align: left"> /opt/hpws/apache/modules </td></tr></tbody></table></div></div><div class="table"><a id="idm139978502592304">
      ⁠</a><p class="title"><strong>Table 17.5. EWS</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="EWS"><colgroup><col width="33%" style="text-align: left" class="c1"/><col width="33%" style="text-align: left" class="c2"/><col width="33%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Product </th><th style="text-align: left"> HTTPD_CONF </th><th style="text-align: left"> HTTPD_MODULES </th></tr></thead><tbody><tr><td style="text-align: left"> Red Hat Enterprise Linux </td><td style="text-align: left"> /HTTPD_HOME/EWS-ROOT/httpd/conf </td><td style="text-align: left"> /HTTPD_HOME/EWS-ROOT/httpd/modules </td></tr><tr><td style="text-align: left"> Solaris </td><td style="text-align: left"> /HTTPD_HOME/EWS-ROOT/etc/httpd/conf </td><td style="text-align: left"> <div class="para">
						/HTTPD_HOME/EWS-ROOT/lib/httpd/modules
					</div>
					 <div class="para">
						or
					</div>
					 <div class="para">
						/HTTPD_HOME/EWS-ROOT/lib64/httpd/modules
					</div>
					 </td></tr><tr><td style="text-align: left"> Windows </td><td style="text-align: left"> /HTTPD_HOME/EWS-ROOT/etc/httpd/conf </td><td style="text-align: left"> <div class="para">
						/HTTPD_HOME/EWS-ROOT/lib/httpd/modules
					</div>
					 <div class="para">
						or
					</div>
					 <div class="para">
						/HTTPD_HOME/EWS-ROOT/lib64/httpd/modules
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44576-764159+%5BLatest%5D&amp;comment=Title%3A+HTTPD+Variable+Conventions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44576-764159+07+Jul+2015+12%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_Apache_HTTPD_included_with_JBoss_Enterprise_Application_Platform_61">
      ⁠</a>17.4.3. Install Apache HTTP Server in Red Hat Enterprise Linux 5, 6, and 7 (Zip)</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Root-level or administrator access.
			</div></li><li class="listitem"><div class="para">
				A supported version of Java installed.
			</div></li><li class="listitem"><div class="para">
				The following packages installed:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="code">krb5-workstation</code>
					</div></li><li class="listitem"><div class="para">
						<code class="code">mod_auth_kerb</code> (required for Kerberos functionality)
					</div></li><li class="listitem"><div class="para">
						<code class="code">elinks</code> (required for the <code class="literal">apachectl</code> functionality)
					</div></li><li class="listitem"><div class="para">
						<code class="code">apr-util-devel</code> (Apache Portability Runtime (APR))
					</div></li><li class="listitem"><div class="para">
						<code class="code">apr-util-ldap</code> (Red Hat Enterprise Linux 7 <span class="emphasis"><em>only</em></span>, required for LDAP authentication functionality)
					</div></li></ul></div></li></ul></div><div class="para">
		The <code class="literal">Apache HTTP Server</code> Zip archive contains symbolic links to several Kerberos modules, which is why the <code class="code">mod_auth_kerb</code> package is a prerequisite. If Kerberos functionality is not required, there is no need to install the <code class="code">mod_auth_kerb</code> package and the associated symbolic link can be deleted: <code class="filename"><em class="replaceable">EAP_HOME</em>/httpd/modules/mod_auth_kerb.so</code>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978544330928">
      ⁠</a><p class="title"><strong>Procedure 17.3. Install the Apache HTTP Server</strong></p><ol class="1"><li class="step"><p class="title"><strong>Navigate to the JBoss EAP downloads list for your platform, on the Red Hat Customer Portal.</strong></p><div class="para">
				Log in to the Customer Portal and navigate to the <span class="guilabel"><strong>Software Downloads</strong></span> page. Select the appropriate <span class="guimenuitem"><strong>Product</strong></span> and <span class="guimenuitem"><strong>Version</strong></span>.
			</div></li><li class="step"><p class="title"><strong>Choose the Apache HTTP Server binary from the list.</strong></p><div class="para">
				Find the <span class="guilabel"><strong>Apache HTTP Server</strong></span> option for your operating system and architecture. Click the <span class="guilabel"><strong>Download</strong></span> link. A Zip file containing the Apache HTTP Server distribution downloads to your computer.
			</div></li><li class="step"><p class="title"><strong>Extract the Zip to the system where the Apache HTTP Server binary will run.</strong></p><div class="para">
				Extract the Zip file on your preferred server, to a temporary location. The Zip file will contain the <code class="filename">httpd</code> directory under a <em class="replaceable">jboss-ews-version-number</em> folder. Copy the <code class="filename">httpd</code> folder and place it inside the <em class="replaceable">EAP_HOME</em> directory.
			</div><div class="para">
				Your Apache HTTP Server is now located in the <code class="filename"><em class="replaceable">EAP_HOME</em>/httpd/</code> directory. This directory is referred to as <em class="replaceable">HTTPD_HOME</em>.
			</div></li><li class="step"><p class="title"><strong>Run the Post-installation script and create the <code class="literal">apache</code> user and group accounts</strong></p><div class="para">
				In a terminal emulator, navigate to the <code class="literal">EAP_HOME/httpd</code> directory and execute the following command with <code class="literal">root</code> user privileges.
			</div><pre class="screen">./.postinstall</pre><div class="para">
				Next, verify that the <code class="literal">apache</code> user exists on the system by running the following command:
			</div><pre class="screen">id apache</pre><div class="para">
				If the user does not exist then it will need to be added, along with the appropriate usergroup. In order to achieve this, execute the following with <code class="literal">root</code> user privileges:
			</div><pre class="screen">getent group apache &gt;/dev/null || groupadd -g 48 -r apache
getent passwd apache &gt;/dev/null || useradd -r -u 48 \
-g apache -s /sbin/nologin  -d HTTPD_HOME/httpd/www -c "Apache" apache
</pre><div class="para">
				Once this is completed, if the <code class="literal">apache</code> user will be running the Apache HTTP Server service, then the ownership of the HTTP directories will need to be changed to reflect this:
			</div><pre class="screen">chown -R apache:apache httpd</pre><div class="para">
				To test that the above commands have been successful, check that the <code class="literal">apache</code> user has execution permission to the Apache HTTP Server install path.
			</div><pre class="screen">ls -l</pre><div class="para">
				The output should be similar to:
			</div><pre class="screen">drwxrwxr-- 11 apache apache 4096 Feb 14 06:52 httpd</pre></li><li class="step"><p class="title"><strong>Configure the Apache HTTP Server.</strong></p><div class="para">
				Prior to starting the Apache HTTP Server, configure it to meet the needs of your organization. You can use the documentation available from the Apache Foundation at <a href="http://httpd.apache.org/">http://httpd.apache.org/</a> for general guidance.
			</div></li><li class="step"><p class="title"><strong>Start the Apache HTTP Server.</strong></p><div class="para">
				Start the Apache HTTP Server using the following command:
			</div><pre class="screen"><em class="replaceable">HTTPD_HOME</em>/httpd/sbin/apachectl start</pre></li><li class="step"><p class="title"><strong>Stop the Apache HTTP Server.</strong></p><div class="para">
				To stop the Apache HTTP Server, issue the following command:
			</div><pre class="screen"><em class="replaceable">HTTPD_HOME</em>/httpd/sbin/apachectl stop</pre></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5728-766431+%5BLatest%5D&amp;comment=Title%3A+Install+Apache+HTTP+Server+in+Red%26nbsp%3BHat+Enterprise+Linux+5%2C+6%2C+and+7+%28Zip%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5728-766431+30+Jul+2015+20%3A02+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_Apache_HTTPD_in_Red_Hat_Enterprise_Linux_with_JBoss_EAP_6_RPM">
      ⁠</a>17.4.4. Install Apache HTTP Server in Red Hat Enterprise Linux (RHEL) 5, 6, and 7 (RPM)</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Root-level access.
			</div></li><li class="listitem"><div class="para">
				The latest version of <span class="package">elinks</span> package installed (required for the apachectl functionality).
			</div></li><li class="listitem"><div class="para">
				Subscribe to Red Hat Enterprise Linux (RHEL) channels (to install Apache HTTP Server from RHEL channels).
			</div></li><li class="listitem"><div class="para">
				Subscribe to <code class="literal">jbappplatform-6-ARCH-server-VERS-rpm</code> Red Hat Network (RHN) channel (to install EAP specific distribution of Apache HTTP Server).
			</div></li></ul></div><div class="para">
		You can install Apache HTTP Server using either of the following methods: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					From Red Hat Enterprise Linux (RHEL) channels: An active subscription to Red Hat Enterprise Linux (RHEL) channels is necessary to install Apache HTTP server.
				</div></li><li class="listitem"><div class="para">
					From <code class="literal">jbappplatform-6-ARCH-server-VERS-rpm</code> channel (JBoss EAP specific distribution): JBoss EAP distributes its own version of the Apache HTTP Server. An active subscription to <code class="literal">jbappplatform-6-ARCH-server-VERS-rpm</code> channel is necessary to install the JBoss EAP specific distribution of Apache HTTP Server.
				</div></li></ul></div>

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978439856000">
      ⁠</a><p class="title"><strong>Procedure 17.4. Install and Configure Apache HTTP Server in Red Hat Enterprise Linux 5 and 6 (RPM)</strong></p><ol class="1"><li class="step"><p class="title"><strong>Install <code class="literal">httpd</code></strong></p><div class="para">
				To install the JBoss EAP specific version of <code class="literal">httpd</code> package run the following command: 
<pre class="programlisting">yum install httpd</pre>
				 To install <code class="literal">httpd</code> explicitly from Red Hat Enterprise Linux (RHEL) channels run the following command: 
<pre class="programlisting"> yum install httpd --disablerepo=jbappplatform-6-*</pre>
				 <div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						You must run only one of the above commands to install the <code class="literal">httpd</code> package on your system.
					</div></div></div>

			</div></li><li class="step"><p class="title"><strong>Set the Service Boot Behavior</strong></p><div class="para">
				You can define the service behavior for the <code class="literal">httpd</code> service at boot from the command line or with the service configuration graphical tool. Run the following command to define the behavior: 
<pre class="programlisting"> chkconfig httpd on</pre>
				 To use the service configuration tool run the following command and change the service setting in the displayed window: 
<pre class="programlisting"> system-config-services</pre>

			</div></li><li class="step"><p class="title"><strong>Start <code class="literal">httpd</code></strong></p><div class="para">
				Start <code class="literal">httpd</code> using the following command: 
<pre class="programlisting">service httpd start</pre>

			</div></li><li class="step"><p class="title"><strong>Stop <code class="literal">httpd</code></strong></p><div class="para">
				Stop <code class="literal">httpd</code> using the following command:
			</div><pre class="programlisting">service httpd stop</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978544766800">
      ⁠</a><p class="title"><strong>Procedure 17.5. Install and Configure Apache HTTP Server in Red Hat Enterprise Linux 7 (RPM)</strong></p><ol class="1"><li class="step"><p class="title"><strong>Install <code class="literal">httpd22</code></strong></p><div class="para">
				To install the JBoss EAP specific version of <code class="literal">httpd22</code> package run the following command: 
<pre class="programlisting">yum install httpd22</pre>

			</div></li><li class="step"><p class="title"><strong>Set the Service Boot Behavior</strong></p><div class="para">
				Run the following command to start the <code class="literal">httpd22</code> service at boot:
			</div><pre class="programlisting">systemctl enable httpd22.service</pre></li><li class="step"><p class="title"><strong>Start <code class="literal">httpd22</code></strong></p><div class="para">
				Start <code class="literal">httpd22</code> using the following command: 
<pre class="programlisting">systemctl start httpd22.service</pre>

			</div></li><li class="step"><p class="title"><strong>Stop <code class="literal">httpd22</code></strong></p><div class="para">
				Stop <code class="literal">httpd22</code> using the following command:
			</div><pre class="programlisting">systemctl stop httpd22.service</pre></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+24405-707053+%5BLatest%5D&amp;comment=Title%3A+Install+Apache+HTTP+Server+in+Red+Hat+Enterprise+Linux+%28RHEL%29+5%2C+6%2C+and+7+%28RPM%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24405-707053+07+Sep+2014+21%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Manage_Apache_HTTP_Server_Service_for_Microsoft_Windows_Server_Environment">
      ⁠</a>17.4.5. Manage Apache HTTP Server Service for Microsoft Windows Server Environment</h2></div></div></div><div class="para">

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978443002992">
      ⁠</a><p class="title"><strong>Procedure 17.6. Install the Apache HTTP Server service for Microsoft Windows Server environment</strong></p><ul><li class="step"><p class="title"><strong>Install the Apache HTTP Server service using this command.</strong></p><div class="para">
				
<pre class="screen">cd /D "%EWS_HOME%\bin"
httpd -k install</pre>

			</div><div class="para">
				This command installs an Apache HTTP Server service named Apache2.2.
			</div><div class="para">
				To specify a different name for the service, for example, ApacheBalancer, use the following command. 
<pre class="screen">cd /D "%EWS_HOME%\bin"
httpd -k install -n ApacheBalancer</pre>

			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978507196848">
      ⁠</a><p class="title"><strong>Procedure 17.7. Start the Apache HTTP Server service for Microsoft Windows Server environment</strong></p><ul><li class="step"><p class="title"><strong>To start a service, you can either use httpd.exe or service manager.</strong></p><div class="para">
				Using httpd.exe:
			</div><pre class="screen">cd /D "%EWS_HOME%\bin"
httpd -k start -n Apache2.2</pre><div class="para">
				Using service manager:
			</div><pre class="screen">net start Apache2.2</pre></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978448944304">
      ⁠</a><p class="title"><strong>Procedure 17.8. Stop the Apache HTTP Server service for Microsoft Windows Server environment</strong></p><ul><li class="step"><p class="title"><strong>To stop a service, you can either use httpd.exe or service manager.</strong></p><div class="para">
				Using httpd.exe:
			</div><pre class="screen">cd /D "%EWS_HOME%\bin"
httpd -k stop -n Apache2.2</pre><div class="para">
				Using service manager:
			</div><pre class="screen">net stop Apache2.2</pre></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978542901392">
      ⁠</a><p class="title"><strong>Procedure 17.9. Uninstall the Apache HTTP Server service for Microsoft Windows Server environment</strong></p><ul><li class="step"><p class="title"><strong>To uninstall a service, it must be referenced by name. For example, to uninstall the service names ApacheBalancer, use the following command.</strong></p><pre class="screen">cd /D "%EWS_HOME%\bin"
httpd -k uninstall -n ApacheBalancer</pre></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44383-762679+%5BLatest%5D&amp;comment=Title%3A+Manage+Apache+HTTP+Server+Service+for+Microsoft+Windows+Server+Environment%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44383-762679+23+Jun+2015+01%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mod_cluster_Configuration_on_httpd">
      ⁠</a>17.4.6. mod_cluster Configuration on Apache HTTP Server</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			The mod_cluster connector is an Apache HTTP Server-based load balancer. It uses a communication channel to forward requests from the Apache HTTP Server to one of a set of application server nodes. The following derivatives can be set to configure mod_cluster.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			There is no need to use ProxyPass directives because mod_cluster automatically configures the URLs that must be forwarded to Apache HTTP Server.
		</div></div></div><div class="table"><a id="idm139978465143648">
      ⁠</a><p class="title"><strong>Table 17.6. mod_cluster Derivatives</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="mod_cluster Derivatives"><colgroup><col width="33%" style="text-align: left" class="c1"/><col width="33%" style="text-align: left" class="c2"/><col width="33%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Derivative </th><th style="text-align: left"> Description </th><th style="text-align: left"> Values </th></tr></thead><tbody><tr><td style="text-align: left"> CreateBalancers </td><td style="text-align: left"> Defines how the balancers are created in the Apache HTTP Server VirtualHosts. This allows directives like: <code class="filename"> ProxyPass /balancer://mycluster1/</code>. </td><td style="text-align: left"> <div class="para">
						0: Create all VirtualHosts defined in Apache HTTP Server
					</div>
					 <div class="para">
						1: Do not create balancers (at least one ProxyPass or ProxyMatch is required to define the balancer names)
					</div>
					 <div class="para">
						2: Create only the main server
					</div>
					 <div class="para">
						Default: 2
					</div>
					 <div class="para">
						<span class="bold bold"><strong>While using the value 1, do not forget to configure the balancer in the ProxyPass directive, because the default is an empty stickysession and <code class="filename">nofailover=Off</code> and the values received via the MCMP CONFIG message are ignored.</strong></span>
					</div>
					 </td></tr><tr><td style="text-align: left"> UseAlias </td><td style="text-align: left"> Check that the alias corresponds to the server name. </td><td style="text-align: left"> <div class="para">
						0: Ignore aliases
					</div>
					 <div class="para">
						1: Check aliases
					</div>
					 <div class="para">
						Default: 0
					</div>
					 </td></tr><tr><td style="text-align: left"> LBstatusRecalTime </td><td style="text-align: left"> Time interval in seconds for loadbalancing logic to recalculate the status of a node. </td><td style="text-align: left"> <div class="para">
						Default: 5 seconds
					</div>
					 </td></tr><tr><td style="text-align: left"> WaitBeforeRemove </td><td style="text-align: left"> Time in seconds before a removed node is forgotten by httpd. </td><td style="text-align: left"> <div class="para">
						Default: 10 seconds
					</div>
					 </td></tr><tr><td style="text-align: left"> ProxyPassMatch/ProxyPass </td><td style="text-align: left"> <div class="para">
						ProxyPassMatch and ProxyPass are mod_proxy directives which, when using <code class="filename">!</code> (instead of the back-end URL), prevent reverse-proxy in the path. This is used to allow Apache HTTP Server to serve static content. For example,
					</div>
					 <div class="para">
						<code class="filename">ProxyPassMatch ^(/.*\.gif)$ !</code>
					</div>
					 <div class="para">
						The above example allows the Apache HTTP Server to serve the <code class="filename">.gif</code> files directly.
					</div>
					 </td><td style="text-align: left"> </td></tr></tbody></table></div></div><div class="para">
		A hot-standby node in the mod_cluster logic is the last resort node to which all requests are routed if all other nodes are down. This is similar to the hot-standby logic in mod_proxy.
	</div><div class="para">
		To configure a hot-standby node, replace the dynamic-load-provider in mod_cluster subsystem with a simple-load-provider with factor set to 0, for example:
	</div><pre class="programlisting">
&lt;subsystem xmlns="urn:jboss:domain:modcluster:1.2"&gt;
    &lt;mod-cluster-config advertise-socket="modcluster" connector="ajp"&gt;
-        &lt;dynamic-load-provider&gt;
-            &lt;load-metric type="busyness"/&gt;
-        &lt;/dynamic-load-provider&gt;
+        &lt;simple-load-provider factor="0"/&gt;
    &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;

</pre><div class="para">
		In mod_cluster-manager console, the node is displayed with OK status and Load: 0. For more information, refer <em class="citetitle">Apache mod_cluster-manager Application</em> section in the <em class="citetitle">JBoss Enterprise Application Platform Development Guide</em>.
	</div><div class="para">
		For instance, if there are three nodes: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Node A, Load: 10
				</div></li><li class="listitem"><div class="para">
					Node B, Load: 10
				</div></li><li class="listitem"><div class="para">
					Node C, Load: 0
				</div></li></ul></div>

	</div><div class="para">
		The load will be balanced between nodes A and B. If both the nodes are unavailable, node C will take the load.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">mod_manager</div>
			The context of a mod_manager directive is VirtualHost in all cases, except when mentioned otherwise. <code class="filename">server config</code> context implies that the directive must be outside a VirtualHost configuration. If not, an error message is displayed and the Apache HTTP Server does not start.
		</div><div class="table"><a id="idm139978517449120">
      ⁠</a><p class="title"><strong>Table 17.7. mod_manager Derivatives</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="mod_manager Derivatives"><colgroup><col width="33%" style="text-align: left" class="c1"/><col width="33%" style="text-align: left" class="c2"/><col width="33%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Derivative </th><th style="text-align: left"> Description </th><th style="text-align: left"> Values </th></tr></thead><tbody><tr><td style="text-align: left"> EnableMCPMReceive </td><td style="text-align: left"> Allow the VirtualHost to receive the MCPM from the nodes. Include EnableMCPMReceive in the Apache HTTP Server configuration to allow mod_cluster to work. Save it in the VirtualHost where you configure advertising. </td><td style="text-align: left"> </td></tr><tr><td style="text-align: left"> MemManagerFile </td><td style="text-align: left"> <div class="para">
						The base name for the names that mod_manager uses to store configuration, generate keys for shared memory or locked files. This must be an absolute path name; the directories are created if needed. It is recommended that these files are placed on a local drive and not an NFS share.
					</div>
					 <div class="para">
						Context: server config
					</div>
					 </td><td style="text-align: left"> <div class="para">
						<code class="filename">$server_root/logs/</code>
					</div>
					 </td></tr><tr><td style="text-align: left"> Maxcontext </td><td style="text-align: left"> The maximum number of contexts supported by mod_cluster 
					<div class="para">
						Context: server config
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Default: 100
					</div>
					 </td></tr><tr><td style="text-align: left"> Maxnode </td><td style="text-align: left"> The maximum number of nodes supported by mod_cluster. 
					<div class="para">
						Context: server config
					</div>
					 </td><td style="text-align: left"> <div class="para">
						Default: 20
					</div>
					 </td></tr><tr><td style="text-align: left"> Maxhost </td><td style="text-align: left"> The maximum number of hosts (aliases) supported by mod_cluster. It also includes the maximum number of balancers. 
					<div class="para">
						Context: server config
					</div>
					 </td><td style="text-align: left"> Default: 20 </td></tr><tr><td style="text-align: left"> Maxsessionid </td><td style="text-align: left"> <div class="para">
						The number of active <code class="literal">sessionid</code> stored to provide the number of active sessions in the mod_cluster-manager handler. A session is inactive when mod_cluster does not receive any information from the session within 5 minutes.
					</div>
					 <div class="para">
						Context: server config
					</div>
					 <div class="para">
						This field is for demonstration and debugging purposes only.
					</div>
					 </td><td style="text-align: left"> 0: the logic is not activated. </td></tr><tr><td style="text-align: left"> MaxMCMPMaxMessSize </td><td style="text-align: left"> The maximum size of MCMP messages from other Max directives </td><td style="text-align: left"> Calculated from other Max directives. Min: 1024 </td></tr><tr><td style="text-align: left"> ManagerBalancerName </td><td style="text-align: left"> The name of balancer to use when the JBoss EAP instance does not provide a balancer name. </td><td style="text-align: left"> <div class="para">
						<code class="filename">mycluster</code>
					</div>
					 </td></tr><tr><td style="text-align: left"> PersistSlots </td><td style="text-align: left"> Tells mod_slotmem to persist nodes, aliases and contexts in files. 
					<div class="para">
						Context: server config
					</div>
					 </td><td style="text-align: left"> Off </td></tr><tr><td style="text-align: left"> CheckNonce </td><td style="text-align: left"> Switch check of <code class="literal">nonce</code> when using mod_cluster-manager handler. </td><td style="text-align: left"> <div class="para">
						on/off
					</div>
					 <div class="para">
						Default: on - <code class="literal">Nonce</code> checked
					</div>
					 </td></tr><tr><td style="text-align: left"> AllowDisplay </td><td style="text-align: left"> Switch additional display on mod_cluster-manager main page. </td><td style="text-align: left"> <div class="para">
						on/off
					</div>
					 <div class="para">
						Default: off - only version is displayed
					</div>
					 </td></tr><tr><td style="text-align: left"> AllowCmd </td><td style="text-align: left"> Allow commands using mod_cluster-manager URL. </td><td style="text-align: left"> <div class="para">
						on/off
					</div>
					 <div class="para">
						Default: on - Commands allowed
					</div>
					 </td></tr><tr><td style="text-align: left"> ReduceDisplay </td><td style="text-align: left"> Reduce the information displayed on the main mod_cluster-manager page, so that more nodes can be displayed on the page. </td><td style="text-align: left"> <div class="para">
						on/off
					</div>
					 <div class="para">
						Default: off - full information is displayed
					</div>
					 </td></tr><tr><td style="text-align: left"> SetHandler mod_cluster-manager </td><td style="text-align: left"> <div class="para">
						Displays information about the node that mod_cluster sees from the cluster. The information includes generic information and additionally counts the number of active sessions.
					</div>
					 
<pre class="programlisting">
						&lt;Location /mod_cluster-manager&gt;
							SetHandler mod_cluster-manager
							Order deny,allow
							Allow from 127.0.0.1
							&lt;/Location&gt;
</pre>
					 </td><td style="text-align: left"> <div class="para">
						on/off
					</div>
					 <div class="para">
						Default: off
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			When accessing the location defined in <code class="filename">httpd.conf</code>:
		</div><div class="para">
			Transferred: Corresponds to the POST data sent to the back-end server.
		</div><div class="para">
			Connected: Corresponds to the number of requests that have been processed when the mod_cluster status page was requested.
		</div><div class="para">
			Num_sessions: Corresponds to the number of sessions mod_cluster report as active (on which there was a request within the past 5 minutes). This field is not present when Maxsessionid is zero and is for demonstration and debugging purposes only.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14165-764926+%5BLatest%5D&amp;comment=Title%3A+mod_cluster+Configuration+on+Apache+HTTP+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14165-764926+14+Jul+2015+00%3A48+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_an_External_HTTPD_as_the_Web_Front-end_for_Enterprise_Application_Platform_Applications">
      ⁠</a>17.4.7. Use an External Web Server as the Web Front-end for JBoss EAP 6 Applications</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			For reasons to use an external web server as the web front-end, as well as advantages and disadvantages of the different HTTP connectors supported by JBoss EAP 6, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Overview_of_HTTP_Connectors">Section 17.2.3, “Overview of HTTP Connectors”</a>. In some situations, you can use the Apache HTTP Server that comes with your operating system. Otherwise, you can use the Apache HTTP Server that ships as part of JBoss Enterprise Web Server.
		</div><div class="para">
		After you have decided which web server and HTTP connector to use, refer to one of the following procedures:
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Apache_HTTPD_included_with_JBoss_Enterprise_Application_Platform_61">Section 17.4.3, “Install Apache HTTP Server in Red Hat Enterprise Linux 5, 6, and 7 (Zip)”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_mod_cluster_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.6.3, “Install the mod_cluster Module Into Apache HTTP Server or JBoss Enterprise Web Server (Zip)”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Mod_jk_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.7.3, “Install the mod_jk Module Into the Apache HTTP Server (ZIP)”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_Microsoft_IIS_to_Use_the_ISAPI_Redirector1">Section 17.9.3, “Configure Microsoft IIS to Use the ISAPI Connector”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_NSAPI_Connector_on_Oracle_Solaris1">Section 17.10.2, “Configure the NSAPI Connector on Oracle Solaris”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5242-684432+%5BLatest%5D&amp;comment=Title%3A+Use+an+External+Web+Server+as+the+Web+Front-end+for+JBoss+EAP+6+Applications%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5242-684432+14+Jul+2014+01%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">
      ⁠</a>17.4.8. Configure JBoss EAP 6 to Accept Requests From External Web Servers</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			JBoss EAP 6 does not need to know which proxy it is accepting requests from, only the port and protocol to look for. This is not true of <code class="systemitem">mod_cluster</code>, which is more tightly coupled to the configuration of JBoss EAP 6. But the following task works for <code class="systemitem">mod_jk</code>, <code class="systemitem">mod_proxy</code>, <code class="systemitem">ISAPI connector</code>, and <code class="systemitem">NSAPI connector</code>. Substitute the protocols and ports in the examples with the ones you need to configure.
		</div><div class="para">
		To configure JBoss EAP 6 for <code class="systemitem">mod_cluster</code>, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_a_mod_cluster_Worker_Node">Section 17.6.6, “Configure a mod_cluster Worker Node”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				You need to be logged into the Management CLI or Management Console to perform this task. The exact steps in the task use the Management CLI, but the same basic procedure is used in the Management Console.
			</div></li><li class="listitem"><div class="para">
				You need a list of which protocols you will be using, whether HTTP, HTTPS, or AJP.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978455413984">
      ⁠</a><p class="title"><strong>Procedure 17.10. Edit Configuration and add Socket Bindings</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure the <code class="code">jvmRoute</code> system property.</strong></p><div class="para">
				For a standalone mode instance, remove the prefix <code class="code">/host=<em class="replaceable">NODE_NAME</em></code>. Replace <code class="literal">NODE_NAME</code> with the name of the host.
			</div><pre class="screen"><code class="command">/host=<em class="replaceable">NODE_NAME</em>/system-property=jvmRoute/:add(value=<em class="replaceable">NODE_NAME</em>)</code></pre></li><li class="step"><p class="title"><strong>List the connectors available in the web subsystem.</strong></p><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					This step is only necessary if you are not using the <code class="code">ha</code> or <code class="code">full-ha</code> profiles for either a standalone server, or a server group in a Managed Domain. Those configurations already include all of the necessary connectors.
				</div></div></div><div class="para">
				In order for an external web server to be able to connect to JBoss EAP 6's web server, the web subsystem needs a connector. Each protocol needs its own connector, which is tied to a socket group.
			</div><div class="para">
				To list the connectors currently available, issue the following command:
			</div><pre class="screen"><code class="command">/subsystem=web:read-children-names(child-type=connector)</code></pre><div class="para">
				If there is no line indicating the connector your need (HTTP, HTTPS, AJP), you need to add the connector.
			</div></li><li class="step"><p class="title"><strong>Read the configuration of a connector.</strong></p><div class="para">
				To see the details of how a connector is configured, you can read its configuration. The following command reads the configuration of the AJP connector. The other connectors have similar configuration output.
			</div><pre class="screen"><code class="command">/subsystem=web/connector=ajp:read-resource(recursive=true)</code>
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "enable-lookups" =&gt; false,
        "enabled" =&gt; true,
        "max-post-size" =&gt; 2097152,
        "max-save-post-size" =&gt; 4096,
        "protocol" =&gt; "AJP/1.3",
        "redirect-port" =&gt; 8443,
        "scheme" =&gt; "http",
        "secure" =&gt; false,
        "socket-binding" =&gt; "ajp",
        "ssl" =&gt; undefined,
        "virtual-server" =&gt; undefined
    }
}
</pre></li><li class="step"><p class="title"><strong>Add the necessary connectors to the web subsystem.</strong></p><div class="para">
				To add a connector to the web subsystem, it must have a socket binding. The socket binding is added to the socket binding group used by your server or server group. The following steps assume that your server group is <code class="literal">server-group-one</code> and that your socket binding group is <code class="literal">standard-sockets</code>.
			</div><ol class="substeps a"><li class="step"><p class="title"><strong>Add a socket to the socket binding group.</strong></p><div class="para">
						To add a socket to the socket binding group, issue the following command, replacing the protocol and port with the ones you need.
					</div><pre class="screen"><code class="command">/socket-binding-group=standard-sockets/socket-binding=ajp:add(port=8009)</code></pre></li><li class="step"><p class="title"><strong>Add the socket binding to the web subsystem.</strong></p><div class="para">
						Issue the following command to add a connector to the web subsystem, substituting the socket binding name and protocol with the ones you need.
					</div><pre class="screen"><code class="command">/subsystem=web/connector=ajp:add(socket-binding=ajp, protocol="AJP/1.3", enabled=true, scheme="http")</code></pre></li></ol></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5245-764438+%5BLatest%5D&amp;comment=Title%3A+Configure+JBoss+EAP+6+to+Accept+Requests+From+External+Web+Servers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5245-764438+09+Jul+2015+19%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Clustering">
      ⁠</a>17.5. Clustering</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Use_TCP_Communication_for_the_Clustering_Subsystem1">
      ⁠</a>17.5.1. Use TCP Communication for the Clustering Subsystem</h2></div></div></div><div class="para">
		By default, cluster nodes monitor each other's status using the UDP protocol. Some networks only allow TCP to be used. In this situation, you can add the <code class="code">TCPPING</code> protocol stack to your configuration and use it as the default mechanism. These configuration options are available in the command-line based Management CLI.
	</div><div class="para">
		The <code class="code">mod_cluster</code> subsystem also uses UDP communication by default, and you can choose to use TCP here as well.
	</div><div class="para">
		Refer to the following two procedures to configure JGroups and mod_cluster subsystems to use TCP for network communication:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_JGroups_Subsystem_to_Use_TCP">Section 17.5.2, “Configure the JGroups Subsystem to Use TCP”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_mod_cluster_Subsystem_to_Use_TCP">Section 17.5.3, “Disable Advertising for the <code class="code">mod_cluster</code> Subsystem”</a>
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5759-591712+%5BLatest%5D&amp;comment=Title%3A+Use+TCP+Communication+for+the+Clustering+Subsystem%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5759-591712+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_JGroups_Subsystem_to_Use_TCP">
      ⁠</a>17.5.2. Configure the JGroups Subsystem to Use TCP</h2></div></div></div><div class="para">
		By default, the JGroups subsystem communicates using multicast UDP. Use the following procedure to configure the JGroups subsystem to use unicast TCP instead.
	</div><div class="para">
		To configure the <code class="code">mod_cluster</code> subsystem to use TCP as well, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_mod_cluster_Subsystem_to_Use_TCP">Section 17.5.3, “Disable Advertising for the <code class="code">mod_cluster</code> Subsystem”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Modify the following script to suit your environment.</strong></p><div class="para">
				Copy the following script into a text editor. If you use a different profile on a managed domain, change the profile name. If you use a standalone server, remove the <code class="literal">/profile=full-ha</code> portion of the commands. Modify the properties listed at the bottom of the command as follows. Each of these properties is optional.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">initial_hosts</span></dt><dd><div class="para">
							A comma-separated list of hosts, using the syntax <code class="literal"><em class="replaceable">HOST</em>[<em class="replaceable">PORT</em>]</code>, that are considered well-known and will be available to look up the initial membership.
						</div></dd><dt><span class="term">port_range</span></dt><dd><div class="para">
							If desired, you can assign a port range. If you assign a port range of 2, and the initial port for a host is 7600, then TCPPING will attempt to contact the host on ports 7600-7602. The port range applies to each address specified in <code class="literal">initial_hosts</code>. This property is optional.
						</div></dd><dt><span class="term">timeout</span></dt><dd><div class="para">
							An optional timeout value, in milliseconds, for cluster members.
						</div></dd><dt><span class="term">num_initial_members</span></dt><dd><div class="para">
							The number of nodes before the cluster is considered to be complete. This property is optional.
						</div></dd></dl></div><pre class="screen">
batch
##  If  tcp  is already added then you can remove it  ##
/profile=full-ha/subsystem=jgroups/stack=tcp:remove
/profile=full-ha/subsystem=jgroups/stack=tcp:add(transport={"type" =&gt;"TCP", "socket-binding" =&gt; "jgroups-tcp"})
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=TCPPING)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=MERGE2)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=FD_SOCK,socket-binding=jgroups-tcp-fd)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=FD)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=VERIFY_SUSPECT)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=BARRIER)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=pbcast.NAKACK)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=UNICAST2)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=pbcast.STABLE)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=pbcast.GMS)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=UFC)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=MFC)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=FRAG2)
/profile=full-ha/subsystem=jgroups/stack=tcp/:add-protocol(type=RSVP)
/profile=full-ha/subsystem=jgroups:write-attribute(name=default-stack,value=tcp)
run-batch
/profile=full-ha/subsystem=jgroups/stack=tcp/protocol=TCPPING/property=initial_hosts/:add(value="HostA[7600],HostB[7600]")
/profile=full-ha/subsystem=jgroups/stack=tcp/protocol=TCPPING/property=port_range/:add(value=0)
/profile=full-ha/subsystem=jgroups/stack=tcp/protocol=TCPPING/property=timeout/:add(value=3000)
/profile=full-ha/subsystem=jgroups/stack=tcp/protocol=TCPPING/property=num_initial_members/:add(value=3)</pre></li><li class="step"><p class="title"><strong>Run the script in batch mode.</strong></p><div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					The servers running the profile have to be shutdown before executing the batch file.
				</div></div></div><div class="para">
				In a terminal emulator, navigate to the directory containing the <code class="filename">jboss-cli.sh</code> script and enter the command 
<pre class="screen">./jboss-cli.sh -c --file=<code class="filename"><em class="replaceable">SCRIPT_NAME</em></code></pre>
				 where <em class="replaceable">SCRIPT_NAME</em> is the name and path containing the script.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The <code class="code">TCPPING</code> stack is now available to the JGroups subsystem. If it is used, the JGroups subsystem uses TCP for all network communication. To configure the <code class="code">mod_cluster</code> subsystem to use TCP as well, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_mod_cluster_Subsystem_to_Use_TCP">Section 17.5.3, “Disable Advertising for the <code class="code">mod_cluster</code> Subsystem”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+11843-781524+%5BLatest%5D&amp;comment=Title%3A+Configure+the+JGroups+Subsystem+to+Use+TCP%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=11843-781524+13+Oct+2017+15%3A20+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_mod_cluster_Subsystem_to_Use_TCP">
      ⁠</a>17.5.3. Disable Advertising for the <code class="code">mod_cluster</code> Subsystem</h2></div></div></div><div class="para">
		By default, the <code class="code">mod_cluster</code> subsystem's balancer uses multicast UDP to advertise its availability to the background workers. If you wish, you can disable advertisement. Use the following procedure to configure this behavior.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978449523472">
      ⁠</a><p class="title"><strong>Procedure 17.11. </strong></p><ol class="1"><li class="step"><p class="title"><strong>Modify the Apache HTTP Server configuration.</strong></p><div class="para">
				Modify the Apache HTTP Server configuration to disable server advertising and to use a proxy list instead. The proxy list is configured on the worker, and contains all of the <code class="code">mod_cluster</code>-enabled Web servers to which the worker can talk.
			</div><div class="para">
				The <code class="code">mod_cluster</code> configuration for the Web server is located in <em class="replaceable">HTTPD_HOME</em>. See <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_mod_cluster_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.6.3, “Install the mod_cluster Module Into Apache HTTP Server or JBoss Enterprise Web Server (Zip)”</a> and <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_Server_Advertisement_Properties_for_Your_mod_cluster-enabled_HTTPD1">Section 17.6.5, “Configure Server Advertisement Properties for Your mod_cluster-enabled Web Server”</a> for more information about the file itself. Open the file containing the virtual host which listens for MCPM requests (using the <code class="code">EnableMCPMReceive</code> directive), and disable server advertising by changing the <code class="code">ServerAdvertise</code> directive as follows.
			</div><pre class="screen">ServerAdvertise Off</pre></li><li class="step"><p class="title"><strong>Disable advertising within the <code class="code">mod_cluster</code> subsystem of JBoss EAP 6, and provide a list of proxies.</strong></p><div class="para">
				You can disable advertising for the <code class="code">mod_cluster</code> subsystem and provide a list of proxies, by using the web-based Management Console or the command-line Management CLI. The list of proxies is necessary because the <code class="code">mod_cluster</code> subsystem will not be able to automatically discover proxies if advertising is disabled.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Management Console</strong></p><div class="para">
						If you use a managed domain, you can only configure <code class="code">mod_cluster</code> in profiles where it is enabled, such as the <code class="code">ha</code> and <code class="code">full-ha</code> profiles.
					</div><div class="procedure"><ol class="1"><li class="step"><div class="para">
								Log in to the Management Console and select the <span class="guilabel"><strong>Configuration</strong></span> tab at the top of the screen. If you use a managed domain, select either the <code class="code">ha</code> or <code class="code">full-ha</code> profile from the <span class="guilabel"><strong>Profile</strong></span> drop-down menu at the top left.
							</div></li><li class="step"><div class="para">
								Expand the <span class="guilabel"><strong>Subsystems</strong></span> menu then expand the <span class="guilabel"><strong>Web</strong></span> menu and select <span class="guilabel"><strong>mod_cluster</strong></span>.
							</div></li><li class="step"><div class="para">
								Click <span class="guilabel"><strong>Edit</strong></span> under the <span class="guilabel"><strong>Advertising</strong></span> tab under <code class="code">mod_cluster</code>. To disable advertising, clear the check box next to <span class="guilabel"><strong>Advertise</strong></span>, and click <span class="guilabel"><strong>Save</strong></span>.
							</div><div class="figure"><a id="idm139978512601920">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/5243.png" alt="mod_cluster Advertising Configuration Screen"/></div></div><p class="title"><strong>Figure 17.1. <code class="code">mod_cluster</code> Advertising Configuration Screen</strong></p></div></li><li class="step"><div class="para">
								Click the <span class="guilabel"><strong>Proxies</strong></span> tab. Click <span class="guilabel"><strong>Edit</strong></span> and enter a list of proxy servers in the <span class="guilabel"><strong>Proxy List</strong></span> field. The correct syntax is a comma-separated list of <code class="code">HOSTNAME:PORT</code> strings, like the following:
							</div><pre class="screen">10.33.144.3:6666,10.33.144.1:6666</pre><div class="para">
								Click the <span class="guilabel"><strong>Save</strong></span> button to finish.
							</div></li></ol></div></li>
				 <li class="step"><p class="title"><strong>Management CLI</strong></p><div class="para">
						The following two Management CLI commands create the same configuration as the Management Console instructions above. They assume that you run a managed domain and that your server group uses the <code class="code">full-ha</code> profile. If you use a different profile, change its name in the commands. If you use a standalone server using the <code class="code">standalone-ha</code> profile, remove the <code class="code">/profile=full-ha</code> portion of the commands.
					</div><pre class="screen">/profile=full-ha/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=advertise,value=false)

/profile=full-ha/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=proxy-list,value="10.33.144.3:6666,10.33.144.1:6666")</pre></li>

			</ul></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The Apache HTTP Server balancer no longer advertises its presence to worker nodes and UDP multicast is no longer used. 
			<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					In order to set the attribute <code class="code">advertise="false"</code>, you must also set the attribute <code class="code">proxy-list="address:port"</code>. If the <code class="code">proxy-list</code> attribute is empty, the <code class="code">advertise="false"</code> attribute is ignored. To disable the mod_cluster subsystem altogether, you may remove it from the server configuration.
				</div></div></div>

		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+11844-764928+%5BLatest%5D&amp;comment=Title%3A+Disable+Advertising+for+the+%3Ccode%3Emod_cluster%3C%2Fcode%3E+Subsystem%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=11844-764928+14+Jul+2015+01%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Switch_UDP_to_TCP_for_HornetQ_Clustering">
      ⁠</a>17.5.4. Switch UDP to TCP for HornetQ Clustering</h2></div></div></div><div class="para">
		The following example uses the default standalone-full-ha.xml file shipped with EAP 6.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			If security is enabled, you must set the cluster-password attribute: 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-password&gt;</span>${jboss.messaging.cluster.password:ChangeMe&gt;}<span xmlns="" class="perl_Keyword">&lt;/cluster-password&gt;</span></pre>

		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Remove the broadcast-groups and discovery-groups:</strong></p><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;broadcast-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"bg-group1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;socket-binding&gt;</span>messaging-group<span xmlns="" class="perl_Keyword">&lt;/socket-binding&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;broadcast-period&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/broadcast-period&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/broadcast-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;discovery-groups&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;discovery-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dg-group1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;socket-binding&gt;</span>messaging-group<span xmlns="" class="perl_Keyword">&lt;/socket-binding&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;refresh-timeout&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/refresh-timeout&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/discovery-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/discovery-groups</span>
</pre></li><li class="step"><p class="title"><strong>Optionally, remove the "messaging-group" socket-binding:</strong></p><div class="para">
				
<pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;socket-binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"messaging-group"</span><span xmlns="" class="perl_Others"> port=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Others"> multicast-address=</span><span xmlns="" class="perl_String">"${jboss.messaging.group.address:231.7.7.7}"</span><span xmlns="" class="perl_Others"> multicast-port=</span><span xmlns="" class="perl_String">"${jboss.messaging.group.port:9876}"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre>

			</div></li><li class="step"><p class="title"><strong>Configure the appropriate Netty connector(s) - one for each of the other nodes in the cluster. </strong></p><div class="para">
				For example, if the cluster is 3 nodes then configure 2 Netty connectors, etc., if the cluster is 2 nodes then configure 1 Netty connector, etc. Here is a sample configuration for a 3-node cluster:
			</div><div class="para">
				
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"other-cluster-node1"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"other-cluster-node1"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"other-cluster-node2"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"other-cluster-node2"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre>

			</div></li><li class="step"><p class="title"><strong>Configure the related socket bindings.</strong></p><div class="para">
				<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The system property substitution can be used for either "host" or "port", if required.
					</div></div></div>
				 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;outbound-socket-binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"other-cluster-node1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;remote-destination</span><span xmlns="" class="perl_Others"> host=</span><span xmlns="" class="perl_String">"otherNodeHostName1"</span><span xmlns="" class="perl_Others"> port=</span><span xmlns="" class="perl_String">"5445"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/outbound-socket-binding&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;outbound-socket-binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"other-cluster-node2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;remote-destination</span><span xmlns="" class="perl_Others"> host=</span><span xmlns="" class="perl_String">"otherNodeHostName2"</span><span xmlns="" class="perl_Others"> port=</span><span xmlns="" class="perl_String">"5445"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/outbound-socket-binding&gt;</span></pre>

			</div></li><li class="step"><p class="title"><strong>Configure the cluster-connection to use these connectors instead of the discovery-group, which is used by default: </strong></p><div class="para">
				
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-cluster"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;static-connectors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>other-cluster-node1<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>other-cluster-node2<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/static-connectors&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/cluster-connection&gt;</span></pre>

			</div><div class="para">
				This process has to be repeated on each of the cluster nodes so that each node has connectors to every other node in the cluster. 
				<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						Do not configure a node with a connection to itself. This is considered as a misconfiguration.
					</div></div></div>

			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31955-646734+%5BLatest%5D&amp;comment=Title%3A+Switch+UDP+to+TCP+for+HornetQ+Clustering%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31955-646734+29+May+2014+05%3A41+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Web_HTTP_Connectors_and_HTTP_Clustering">
      ⁠</a>17.6. Web, HTTP Connectors, and HTTP Clustering</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Modcluster_HTTP_Connector">
      ⁠</a>17.6.1. About the <code class="code">mod_cluster</code> HTTP Connector</h2></div></div></div><div class="para">
		The <em class="firstterm">mod_cluster</em> module enables load balancing and is referred to as a <em class="firstterm">connector</em>. To learn about other connectors, see one of the following:
	</div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Apache_mod_jk_HTTP_Connector">Section 17.7.1, “About the Apache mod_jk HTTP Connector”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Internet_Server_API_ISAPI_HTTP_Connector">Section 17.9.1, “About the Internet Server API (ISAPI)”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Netscape_Server_API_NSAPI_HTTP_Connector1">Section 17.10.1, “About the Netscape Server API (NSAPI)”</a>
				</div></li></ul></div>

	</div><div class="para">
		The mod_cluster connector has several advantages over other connectors.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				The <em class="firstterm">mod_cluster Management Protocol</em> (MCMP) is an additional connection between the JBoss Enterprise Application Platform 6 servers and the Apache HTTP Server with the mod_cluster module enabled. It is used by the JBoss Enterprise Application Platform servers to transmit server-side load balance factors and lifecycle events back to the Apache HTTP Server via a custom set of HTTP methods.
			</div></li><li class="listitem"><div class="para">
				Dynamic configuration of Apache HTTP Server with mod_cluster allows JBoss EAP 6 servers to join the load balancing arrangement without manual configuration.
			</div></li><li class="listitem"><div class="para">
				JBoss EAP 6 performs the load-balancing factor calculations, rather than relying on the Apache HTTP Server with mod_cluster. This makes load balancing metrics more accurate than other connectors.
			</div></li><li class="listitem"><div class="para">
				The mod_cluster connector gives fine-grained application lifecycle control. Each JBoss EAP 6 server forwards web application context lifecycle events to the Apache HTTP Server, informing it to start or stop routing requests for a given context. This prevents end users from seeing HTTP errors due to unavailable resources.
			</div></li><li class="listitem"><div class="para">
				AJP, HTTP or HTTPS transports can be used.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4650-730317+%5BLatest%5D&amp;comment=Title%3A+About+the+%3Ccode%3Emod_cluster%3C%2Fcode%3E+HTTP+Connector%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4650-730317+02+Dec+2014+19%3A11+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_mod_cluster_Subsystem">
      ⁠</a>17.6.2. Configure the <code class="code">mod_cluster</code> Subsystem</h2></div></div></div><div class="para">
		The <code class="code">mod_cluster</code> subsystem can be configured via the Management Console and Management CLI. In this topic the various configuration options are described, grouped as they appear in the Management Console. Example Management CLI commands are provided for each option.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The <span class="guilabel"><strong>mod_cluster</strong></span> configuration page is only visible for <code class="literal">ha</code> and <code class="literal">full-ha</code> profiles. For a managed domain these profiles are <code class="literal">ha</code> and <code class="literal">full-ha</code>, and for a standalone server they are <code class="literal">standalone-ha</code> and <code class="literal">standalone-full-ha</code>.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"> Management Console </div>
			Click the <span class="guilabel"><strong>Configuration</strong></span> tab. If you are configuring a managed domain, select the correct profile from the <span class="guilabel"><strong>Profile</strong></span> drop-down list. Expand the <span class="guilabel"><strong>Subsystems</strong></span> menu, then expand the <span class="guilabel"><strong>Web</strong></span> menu and select <span class="guilabel"><strong>mod_cluster</strong></span>.
		</div><div class="table"><a id="idm139978524408032">
      ⁠</a><p class="title"><strong>Table 17.8. <code class="code">mod_cluster</code> Advertising Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="mod_cluster Advertising Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Load Balancing Group </td><td> <div class="para">
						If this is not null, requests are sent to a specific load balancing group on the load balancer. Leave this blank if you do not want to use load balancing groups. This is unset by default.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=load-balancing-group,value=myGroup)</pre>
					 </td></tr><tr><td> Balancer </td><td> <div class="para">
						This attribute specifies what mod_proxy balancer is to be automatically configured by mod_cluster on the Apache HTTP Server. The default is <code class="literal">none</code>, in which case the default of <code class="literal">mycluster</code> is used (<code class="literal">balancer://mycluster/</code> when expressed in mod_proxy terms). This default value is configured on the Apache HTTP Server side with the ManagerBalancerName directive.
					</div>
					 <div class="para">
						If you use two different <code class="literal">balancer</code> attribute values on the JBoss EAP 6 worker instances, there will be two different mod_proxy balancers created by mod_cluster automatically on the Apache HTTP Server.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=balancer,value=myBalancer)</pre>
					 </td></tr><tr><td> Advertise Socket </td><td> <div class="para">
						The name of the socket binding to use for cluster advertising.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=advertise-socket,value=modcluster)</pre>
					 </td></tr><tr><td> Advertise Security Key </td><td> <div class="para">
						A string containing the security key for advertising.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=advertise-security-key,value=myKey)</pre>
					 </td></tr><tr><td> Advertise </td><td> <div class="para">
						Whether or not advertising is enabled. Defaults to <code class="literal">true</code>.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=advertise,value=true)</pre>
					 </td></tr></tbody></table></div></div><div class="table"><a id="modcluster_connector_options_console">
      ⁠</a><p class="title"><strong>Table 17.9. <code class="code">mod_cluster</code> Session Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="mod_cluster Session Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Sticky Session </td><td> <div class="para">
						Whether to use sticky sessions for requests. This means that after the client makes a connection to a specific node, further communication is routed to that same node unless it becomes unavailable. This defaults to <code class="literal">true</code>, which is the recommended setting.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=sticky-session,value=true)</pre>
					 </td></tr><tr><td> Sticky Session Force </td><td> <div class="para">
						If <code class="literal">true</code>, a request is not redirected to a new node if its initial node becomes unavailable but instead it fails. This defaults to <code class="literal">false</code>.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=sticky-session-force,value=false)</pre>
					 </td></tr><tr><td> Sticky Session Remove </td><td> <div class="para">
						Remove session information on failover. This defaults to <code class="literal">false</code>.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=sticky-session-remove,value=false)</pre>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm139978446564752">
      ⁠</a><p class="title"><strong>Table 17.10. <code class="code">mod_cluster</code> Web Context Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="mod_cluster Web Context Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Auto Enable Contexts </td><td> <div class="para">
						Whether to add new contexts to <code class="code">mod_cluster</code> by default or not. This defaults to <code class="literal">true</code>. If you change the default and need to enable context manually, the Web Application can enable its context using the <code class="code">enable()</code> MBean method, or via the <code class="code">mod_cluster</code> manager, which is a web application which runs on the httpd proxy on a named virtual host or port which is specified in that httpd's configuration.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=auto-enable-contexts,value=true)</pre>
					 </td></tr><tr><td> Excluded Contexts </td><td> <div class="para">
						A comma-separated list of contexts that <code class="code">mod_cluster</code> should ignore. If no host is indicated, the host is assumed to be <code class="code">localhost</code>. <code class="code">ROOT</code> indicates the root context of the Web Application. The default value is <code class="literal">ROOT,invoker,jbossws,juddi,console</code>.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=excluded-contexts,value="ROOT,invoker,jbossws,juddi,console")</pre>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm139978444998032">
      ⁠</a><p class="title"><strong>Table 17.11. <code class="code">mod_cluster</code> Proxy Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="mod_cluster Proxy Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Proxy URL </td><td> <div class="para">
						If defined, this value will be prepended to the URL of MCMP commands.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=proxy-url,value=myhost)</pre>
					 </td></tr><tr><td> Proxy List </td><td> <div class="para">
						A comma-separated list of httpd proxy addresses, in the format <code class="literal">hostname:port</code>. This indicates the list of proxies that the <code class="code">mod_cluster</code> process will attempt to communicate with initially.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=proxy-list,value="127.0.0.1,127.0.0.2")</pre>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure SSL Communication for <code class="code">mod_cluster</code></div>
			By default, <code class="code">mod_cluster</code> communication happens over an unencrypted HTTP link. If you set the connector scheme to <code class="literal">HTTPS</code> (refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#modcluster_connector_options_console">Table 17.9, “<code class="code">mod_cluster</code> Session Configuration Options”</a>), the settings below tell <code class="code">mod_cluster</code> where to find the information to encrypt the connection.
		</div><div class="table"><a id="mod_cluster_SSL_configuration_options">
      ⁠</a><p class="title"><strong>Table 17.12. <code class="code">mod_cluster</code> SSL Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="mod_cluster SSL Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Key Alias </td><td> <div class="para">
						The key alias, which was chosen when the certificate was created.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=key-alias,value=jboss)</pre>
					 </td></tr><tr><td> Password </td><td> <div class="para">
						This password is the keystore password for both keystores: certificate-key-file (Key File) and ca-certificate-file (Cert File) and the key/certificate entry specified with Key Alias inside Cert File.
					</div>
					 <div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							@ca-certificate-password is the truststore password and value remains undefined if you have not specified it.
						</div></div></div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=password,value=changeit)</pre>
					 </td></tr><tr><td> CA Cert File/Trust Store </td><td> <div class="para">
						Trust store used to validate the web server certificate.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=ca-certificate-file,value=${user.home}/jboss.crt)</pre>
					 </td></tr><tr><td> Key Store </td><td> <div class="para">
						Key store that holds the certificate and private key that identifies this instance.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=certificate-key-file,value=${user.home}/.keystore)</pre>
					 </td></tr><tr><td> Cipher Suite </td><td> <div class="para">
						The allowed encryption cipher suite.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=cipher-suite,value=ALL)</pre>
					 </td></tr><tr><td> Revocation URL </td><td> <div class="para">
						The URL of the Certificate Authority revocation list.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=ca-revocation-url,value=jboss.crl)</pre>
					 </td></tr><tr><td> Protocol </td><td> <div class="para">
						The SSL protocols, which are enabled.
					</div>
					 <div class="para">
						You can also specify a combination of protocols, which is comma separated. For example, TLSv1, TLSv1.1,TLSv1.2.
					</div>
					 <div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
							Red Hat recommends that you explicitly disable SSL in favor of TLSv1.1 or TLSv1.2 in all affected packages.
						</div></div></div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/ssl=configuration/:write-attribute(name=protocol,value="TLSv1, TLSv1.1,TLSv1.2")</pre>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configure <code class="code">mod_cluster</code> Networking Options</div>
			The available <code class="code">mod_cluster</code> networking options control several different timeout behaviors for different types of services with which the <code class="code">mod_cluster</code> service communicates.
		</div><div class="table"><a id="idm139978446012320">
      ⁠</a><p class="title"><strong>Table 17.13. <code class="code">mod_cluster</code> Networking Configuration Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="mod_cluster Networking Configuration Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Node Timeout </td><td> <div class="para">
						Timeout, in seconds, for proxy connections to a worker. This is the time that mod_cluster will wait for the back-end response before returning an error. If the <code class="code">node-timeout</code> attribute is undefined, the httpd <code class="code">ProxyTimeout</code> directive is used. If <code class="code">ProxyTimeout</code> is undefined, the httpd <code class="code">Timeout</code> directive is used, which defaults to <code class="literal">300</code> seconds.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=node-timeout,value=-1)</pre>
					 </td></tr><tr><td> Socket Timeout </td><td> <div class="para">
						Number of seconds to wait for a response from an httpd proxy to MCMP commands before timing out, and flagging the proxy as in error.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=socket-timeout,value=20)</pre>
					 </td></tr><tr><td> Stop Context Timeout </td><td> <div class="para">
						The amount of time, measure in units specified by stopContextTimeoutUnit, for which to wait for clean shutdown of a context (completion of pending requests for a distributable context; or destruction/expiration of active sessions for a non-distributable context).
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=stop-context-timeout,value=10)</pre>
					 </td></tr><tr><td> Session Draining Strategy </td><td> <div class="para">
						Whether to drain sessions before undeploying a web application.
					</div>
					 <div class="variablelist"><dl class="variablelist"><dt><span class="term">DEFAULT</span></dt><dd><div class="para">
									Drain sessions before web application undeploy only if the web application is non-distributable.
								</div></dd><dt><span class="term">ALWAYS</span></dt><dd><div class="para">
									Always drain sessions before web application undeploy, even for distributable web applications.
								</div></dd><dt><span class="term">NEVER</span></dt><dd><div class="para">
									Do not drain sessions before web application undeploy, even for non-distributable web application.
								</div></dd></dl></div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=session-draining-strategy,value=DEFAULT)</pre>
					 </td></tr><tr><td> Max Attempts </td><td> <div class="para">
						Number of times an httpd proxy will attempt to send a given request to a node before giving up. The minimum value is <code class="literal">1</code>, meaning try only once. The <code class="code">mod_proxy</code> default is also <code class="literal">1</code>, which means that no retry occurs.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=max-attempts,value=1)</pre>
					 </td></tr><tr><td> Flush Packets </td><td> <div class="para">
						Whether or not to enable packet flushing to the Web server. Defaults to <code class="literal">false</code>.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=flush-packets,value=false)</pre>
					 </td></tr><tr><td> Flush Wait </td><td> <div class="para">
						How long, in seconds, to wait before flushing packets to the Web server. Defaults to <code class="literal">-1</code>. A value of <code class="literal">-1</code> means to wait forever before flushing packets.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=flush-wait,value=-1)</pre>
					 </td></tr><tr><td> Ping </td><td> <div class="para">
						How long, in seconds, to wait for a response to a ping from a worker. Defaults to <code class="literal">10</code> seconds.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=ping,value=10)</pre>
					 </td></tr><tr><td> SMAX </td><td> <div class="para">
						Soft maximum idle connection count (the same as <code class="code">smax</code> in mod_proxy documentation). The maximum value depends on the httpd thread configuration, and can be either <code class="literal">ThreadsPerChild</code> or <code class="literal">1</code>.
					</div>
					 </td><td>
<pre class="screen">profile=full-ha/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=smax,value=ThreadsPerChild)</pre>
					 </td></tr><tr><td> TTL </td><td> <div class="para">
						Time to live (in seconds) for idle connections above smax, default is 60
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=ttl,value=-1)</pre>
					 </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"><code class="code">mod_cluster</code> Load Provider Configuration Options</div>
			The following <code class="code">mod_cluster</code> configuration options are not available in the management console, but can only be set using the Management CLI.
		</div><div class="para">
		A simple load provider is used if no dynamic load provider is present. It assigns each cluster member a load factor of <code class="literal">1</code>, and distributes work evenly without applying a load balancing algorithm. To add it, use the following Management CLI command.
	</div><pre class="screen">[standalone@localhost:9990 /] /subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=simple-load-provider, value=1)</pre><div class="para">
		A dynamic load provider can be configured to use a variety of algorithms in combination, in order to determine which worker receives the next request. You can create a load provider and configure it to suit your environment, and you can have more than one load metric active simultaneously by adding them via the CLI. The default dynamic load provider uses <code class="literal">busyness</code> as the determining load metric. The dynamic load provider options and possible load metrics are shown below. 
	</div><div class="table"><a id="idm139978507829344">
      ⁠</a><p class="title"><strong>Table 17.14. <code class="code">mod_cluster</code> Dynamic Load Provider Options</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="mod_cluster Dynamic Load Provider Options"><colgroup><col/><col/><col/></colgroup><thead><tr><th> Option </th><th> Description </th><th> CLI Command </th></tr></thead><tbody><tr><td> Decay </td><td> <div class="para">
						The factor by which historical metrics should decay in significance.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/:write-attribute(name=decay,value=2)</pre>
					 </td></tr><tr><td> History </td><td> <div class="para">
						The number of historic load metric records to consider when determining the load.
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/:write-attribute(name=history,value=9)</pre>
					 </td></tr><tr><td> Load Metric </td><td> <div class="para">
						The default load metric included with the dynamic load provider in JBoss EAP 6 is <code class="literal">busyness</code>, which calculates the load of the worker from the amount of threads in the thread pool being busy serving requests. You can set the capacity of this metric by which the actual load is divided: calculated_load / capacity. You can set multiple load metrics within the dynamic load provider. 
					</div>
					 </td><td>
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=busyness/:write-attribute(name=capacity,value=1.0)</pre>
					 
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=busyness/:write-attribute(name=type,value=busyness)</pre>
					 
<pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=busyness/:write-attribute(name=weight,value=1)</pre>
					 </td></tr></tbody></table></div></div><div class="variablelist"><p class="title"><strong>Load Metric Algorithms</strong></p><dl class="variablelist"><dt><span class="term">cpu</span></dt><dd><div class="para">
					The <code class="literal">cpu</code> load metric uses average CPU load to determine which node receives the next work load.
				</div></dd><dt><span class="term">mem</span></dt><dd><div class="para">
					The <code class="literal">mem</code> load metric uses free native memory as a load metric. Usage of this metric is discouraged because it provides a value that includes buffers and cache, so it is always a very low figure on every decent system with good memory management.
				</div></dd><dt><span class="term">heap</span></dt><dd><div class="para">
					The <code class="literal">heap</code> load metric uses the heap usage to determine which worker receives the next work load.
				</div></dd><dt><span class="term">sessions</span></dt><dd><div class="para">
					The <code class="literal">session</code> load metric uses the number of active sessions as a metric.
				</div></dd><dt><span class="term">requests</span></dt><dd><div class="para">
					The <code class="literal">requests</code> load metric uses the number of client requests to determine which worker receives the next work load. For instance, capacity 1000 means that 1000 requests/sec is considered to be a full load.
				</div></dd><dt><span class="term">send-traffic</span></dt><dd><div class="para">
					The <code class="literal">send-traffic</code> load metric uses the amount of traffic sent from the worker to the clients. E.g. the default capacity of 512 indicates that the node should be considered under full load if the average outbound traffic is 512 KB/s or higher.
				</div></dd><dt><span class="term">receive-traffic</span></dt><dd><div class="para">
					The receive-traffic load metric uses the amount of traffic sent to the worker from the clients. E.g. the default capacity of 1024 indicates that the worker should be considered under full load if the average inbound traffic is 1024 KB/s or higher.
				</div></dd><dt><span class="term">busyness</span></dt><dd><div class="para">
					This metric represents the amount of threads from the thread pool being busy serving requests.
				</div></dd></dl></div><div class="example"><a id="idm139978464681360">
      ⁠</a><p class="title"><strong>Example 17.2. Add a Load Metric</strong></p><div class="example-contents"><div class="para">
			To add a load metric, use the <code class="command">add-metric</code> command.
		</div><pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:add-metric(type=sessions)</pre></div></div><div class="example"><a id="idm139978445587824">
      ⁠</a><p class="title"><strong>Example 17.3. Set a Value for an Existing Metric</strong></p><div class="example-contents"><div class="para">
			To set a value for an existing metric, use the <code class="command">write-attribute</code> command.
		</div><pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=cpu/:write-attribute(name="weight",value="3")</pre></div></div><div class="example"><a id="idm139978453543200">
      ⁠</a><p class="title"><strong>Example 17.4. Change the Value of an Existing Metric</strong></p><div class="example-contents"><div class="para">
			To change the value of an existing metric, use the <code class="command">write-attribute</code> command.
		</div><pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=cpu/:write-attribute(name="type",value="busyness")</pre></div></div><div class="example"><a id="idm139978451888384">
      ⁠</a><p class="title"><strong>Example 17.5. Remove an Existing Metric</strong></p><div class="example-contents"><div class="para">
			To remove an existing metric, use the <code class="command">remove-metric</code> command.
		</div><pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration/:remove-metric(type=sessions)</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+8982-781527+%5BLatest%5D&amp;comment=Title%3A+Configure+the+%3Ccode%3Emod_cluster%3C%2Fcode%3E+Subsystem%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8982-781527+30+Oct+2017+11%3A13+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_mod_cluster_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">
      ⁠</a>17.6.3. Install the mod_cluster Module Into Apache HTTP Server or JBoss Enterprise Web Server (Zip)</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				To perform this task, you must be using Apache HTTP Server installed in Red Hat Enterprise Linux 6, or JBoss Enterprise Web Server, or the standalone Apache HTTP Server included as a separate downloadable component of JBoss EAP 6.
			</div></li><li class="listitem"><div class="para">
				If you need to install Apache HTTP Server in Red Hat Enterprise Linux 6, use the instructions from the <em class="citetitle">Red Hat Enterprise Linux 6 Deployment Guide</em>.
			</div></li><li class="listitem"><div class="para">
				If you need to install the standalone Apache HTTP Server included as a separate downloadable component of JBoss EAP 6, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Apache_HTTPD_included_with_JBoss_Enterprise_Application_Platform_61">Section 17.4.3, “Install Apache HTTP Server in Red Hat Enterprise Linux 5, 6, and 7 (Zip)”</a>.
			</div></li><li class="listitem"><div class="para">
				If you need to install JBoss Enterprise Web Server, use the instructions from the <em class="citetitle">JBoss Enterprise Web Server Installation Guide</em>.
			</div></li><li class="listitem"><div class="para">
				Download the <span class="guilabel"><strong>Webserver Connecter Natives</strong></span> package for your operating system and architecture from the Red Hat Customer Portal at <a href="https://access.redhat.com">https://access.redhat.com</a>. This package contains the mod_cluster binary web server modules precompiled for your operating system. After you extract the archive, the modules are located in the <code class="filename">EAP_HOME/modules/system/layers/base/native/lib/httpd/modules</code> directory.
			</div><div class="para">
				The <code class="filename">etc/</code> directory contains some example configuration files, and the <code class="filename">share/</code> directory contains some supplemental documentation.
			</div></li><li class="listitem"><div class="para">
				You must be logged in with administrative (root) privileges.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			If you use a 64 bit system the mod_cluster binary web server modules will be located here: <code class="filename">EAP_HOME/modules/system/layers/base/native/lib64/httpd/modules</code>. You must use this path whenever you need access to the modules.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978464235632">
      ⁠</a><p class="title"><strong>Procedure 17.12. Install the mod_cluster Module</strong></p><ol class="1"><li class="step"><p class="title"><strong>Determine your Apache HTTP Server configuration location.</strong></p><div class="para">
				Your Apache HTTP Server configuration location will be different depending on whether you are using Red Hat Enterprise Linux's Apache HTTP Server, the standalone Apache HTTP Server included as a separate downloadable component with JBoss EAP 6, or the Apache HTTP Server available in JBoss Enterprise Web Server. It is one of the following three options, and is referred to in the rest of this task as <em class="replaceable">HTTPD_HOME</em>.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Apache HTTP Server - <code class="filename">/etc/httpd/</code>
					</div></li><li class="listitem"><div class="para">
						JBoss EAP 6 Apache HTTP Server - This location is chosen by you, based on the requirements of your infrastructure.
					</div></li><li class="listitem"><div class="para">
						JBoss Enterprise Web Server Apache HTTP Server - <code class="filename"><em class="replaceable">EWS_HOME</em>/httpd/</code>
					</div></li></ul></div></li><li class="step"><p class="title"><strong>Copy the modules to the Apache HTTP Server modules directory.</strong></p><div class="para">
				Copy the four modules (the files ending in <code class="literal">.so</code>) from the <code class="filename">EAP_HOME/modules/system/layers/base/native/lib/httpd/modules</code> directory of the extracted Webserver Natives archive to the <code class="filename"><em class="replaceable">HTTPD_MODULES/</em></code> directory.
			</div></li><li class="step"><p class="title"><strong>For JBoss Enterprise Web Server, disable the <code class="systemitem">mod_proxy_balancer</code> module.</strong></p><div class="para">
				If you use JBoss Enterprise Web Server, the <code class="systemitem">mod_proxy_balancer</code> module is enabled by default. It is incompatible with mod_cluster. To disable it, edit the <code class="filename"><em class="replaceable">HTTPD_CONF</em>/httpd.conf</code> and comment out the following line by placing a <code class="literal">#</code> (hash) symbol before the line which loads the module. The line is shown without the comment and then with it, below.
			</div><pre class="screen">LoadModule proxy_balancer_module modules/mod_proxy_balancer.so</pre><pre class="screen"># LoadModule proxy_balancer_module modules/mod_proxy_balancer.so</pre><div class="para">
				Save and close the file.
			</div></li><li class="step"><p class="title"><strong>Configure the mod_cluster module.</strong></p><div class="para">
				The Webserver Natives archive contains a sample <code class="filename">mod_cluster.conf</code> file (<code class="filename">EAP_HOME/modules/system/layers/base/native/etc/httpd/conf</code>). This file can be used as a guide or copied and edited to create a <code class="filename"><em class="replaceable">HTTPD_CONF.D</em>/<em class="replaceable">JBoss_HTTP</em>.conf</code> file.
			</div><div class="para">
				<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						Using the name <code class="filename"><em class="replaceable">JBoss_HTTP</em>.conf</code> is an arbitrary convention in this document. The configuration file will be loaded, regardless of its name, if it is saved in the <code class="filename">conf.d/</code> directory with the <code class="filename">.conf</code> extension.
					</div></div></div>

			</div><div class="para">
				Add the following to your configuration file:
			</div><pre class="programlisting">
LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so
</pre><div class="para">
				This causes Apache HTTP Server to automatically load the modules that <code class="code">mod_cluster</code> needs in order to function.
			</div></li><li class="step"><p class="title"><strong>Create a proxy server listener.</strong></p><div class="para">
				Continue editing <code class="filename"><em class="replaceable">HTTPD_CONF.D</em>/JBoss_HTTP.conf</code> and add the following minimal configuration, replacing the values in capital letters with suitable values for your environment.
			</div><pre class="screen">
Listen IP_ADDRESS:PORT
&lt;VirtualHost IP_ADDRESS:PORT&gt;  
	  &lt;Location /&gt;
          Order deny,allow
          Deny from all
          Allow from *.MYDOMAIN.COM
	  &lt;/Location&gt;
	  
	  KeepAliveTimeout 60
	  MaxKeepAliveRequests 0
	  EnableMCPMReceive
	  
	  ManagerBalancerName mycluster
	  ServerAdvertise On
	  
&lt;/VirtualHost&gt;</pre><div class="para">
				These directives create a new virtual server which listens on <code class="literal">IP_ADDRESS:PORT</code>, allows connections from <code class="literal">MYDOMAIN.COM</code>, and advertises itself as a balancer called <code class="literal">mycluster</code>. These directives are covered in detail in the documentation for Apache Web Server. To learn more about the <code class="code">ServerAdvertise</code> and <code class="code">EnableMCPMReceive</code> directives, and the implications of server advertisement, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_Server_Advertisement_Properties_for_Your_mod_cluster-enabled_HTTPD1">Section 17.6.5, “Configure Server Advertisement Properties for Your mod_cluster-enabled Web Server”</a>.
			</div><div class="para">
				Save the file and exit.
			</div></li><li class="step"><p class="title"><strong>Restart the Apache HTTP Server.</strong></p><div class="para">
				The way to restart the Apache HTTP Server depends on whether you are using Red Hat Enterprise Linux's Apache HTTP Server or the Apache HTTP Server included in JBoss Enterprise Web Server. Choose one of the two methods below.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Red Hat Enterprise Linux 6 Apache HTTP Server</strong></p><div class="para">
						Issue the following command:
					</div><pre class="screen">[root@host]# <code class="command">service httpd restart</code></pre></li>
				 <li class="step"><p class="title"><strong>JBoss Enterprise Web Server HTTP Server</strong></p><div class="para">
						JBoss Enterprise Web Server runs on both Red Hat Enterprise Linux and Microsoft Windows Server. The method for restarting the Apache HTTP Server is different for each.
					</div><ul class="stepalternatives">
						<li class="step"><p class="title"><strong>Red Hat Enterprise Linux</strong></p><div class="para">
								In Red Hat Enterprise Linux, JBoss Enterprise Web Server installs its Apache HTTP Server as a service. To restart the Apache HTTP Server, issue the following two commands:
							</div><pre class="screen">
<code class="command">[root@host ~]# service httpd stop</code>
<code class="command">[root@host ~]# service httpd start</code></pre></li>
						 <li class="step"><p class="title"><strong>Microsoft Windows Server</strong></p><div class="para">
								Issue the following commands in a command prompt with administrative privileges:
							</div><pre class="screen"><code class="command">C:\&gt; net stop httpd</code>
<code class="command">C:\&gt; net start httpd</code></pre></li>

					</ul></li>

			</ul></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The Apache HTTP Server is now configured as a load balancer, and can work with the <code class="code">mod_cluster</code> subsystem running JBoss EAP 6. To configure JBoss EAP 6 to be aware of mod_cluster, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_a_mod_cluster_Worker_Node">Section 17.6.6, “Configure a mod_cluster Worker Node”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5218-746672+%5BLatest%5D&amp;comment=Title%3A+Install+the+mod_cluster+Module+Into+Apache+HTTP+Server+or+JBoss+Enterprise+Web+Server+%28Zip%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5218-746672+10+Mar+2015+20%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_mod_cluster_Module_Into_Apache_HTTPD_or_JBoss_Enterprise_Web_Server_HTTPD_RPM">
      ⁠</a>17.6.4. Install the mod_cluster Module Into Apache HTTP Server or JBoss Enterprise Web Server (RPM)</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				To perform this task, you must be using the Apache HTTP Server installed in Red Hat Enterprise Linux 6, JBoss Enterprise Web Server, or the standalone Apache HTTP Server included as a separate downloadable component of JBoss EAP 6.
			</div></li><li class="listitem"><div class="para">
				If you need to install Apache HTTP Server in Red Hat Enterprise Linux 6, use the instructions from the <em class="citetitle">Red Hat Enterprise Linux 6 Deployment Guide</em>.
			</div></li><li class="listitem"><div class="para">
				If you need to install the standalone Apache HTTP Server included as a separate downloadable component of JBoss EAP 6, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Apache_HTTPD_included_with_JBoss_Enterprise_Application_Platform_61">Section 17.4.3, “Install Apache HTTP Server in Red Hat Enterprise Linux 5, 6, and 7 (Zip)”</a> .
			</div></li><li class="listitem"><div class="para">
				If you need to install JBoss Enterprise Web Server, use the instructions from the <em class="citetitle">JBoss Enterprise Web Server Installation Guide</em>.
			</div></li><li class="listitem"><div class="para">
				You must be logged in with administrative (root) privileges.
			</div></li><li class="listitem"><div class="para">
				You must have an active subscription to the <code class="literal">jbappplatform-6-<em class="replaceable">ARCH</em>-server-<em class="replaceable">VERS</em>-rpm</code> RHN channel.
			</div></li></ul></div><div class="para">
		The RPM installation method is similar between Red Hat Enterprise Linux 5 and 6, only requiring minor variations for Red Hat Enterprise Linux 6 users who have Apache HTTP Server 2.2.15 installed.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
				Install the <code class="literal">mod_cluster-native</code> package using YUM:
			</div><pre class="programlisting">yum install mod_cluster-native
</pre></li><li class="step"><div class="para">
				<span class="bold bold"><strong>Apache HTTP Server</strong></span>:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						If you choose to stay on Apache HTTP Server 2.2.15, you must disable the <code class="literal">mod_proxy_balancer</code> module loaded by default by commmenting the <code class="literal">LoadModule proxy_balancer_module</code> line in the httpd.conf file.
					</div><div class="para">
						Either edit the file manually or use the following command:
					</div><pre class="programlisting">sed -i 's/^LoadModule proxy_balancer_module/#LoadModule proxy_balancer_module/;s/$//' /etc/httpd/conf/httpd.conf
</pre></li><li class="listitem"><div class="para">
						If you choose to upgrade to Apache HTTP Server 2.2.26, install the latest version using the following command.
					</div><pre class="programlisting">yum install httpd</pre></li></ul></div></li><li class="step"><div class="para">
				To have the Apache HTTP Server service start at boot, enter the following command:
			</div><ul class="stepalternatives">
				<li class="step"><div class="para">
						For Red Hat Enterprise Linux 5 and 6:
					</div><pre class="programlisting">service httpd add</pre></li>
				 <li class="step"><div class="para">
						For Red Hat Enterprise Linux 7:
					</div><pre class="programlisting">systemctl enable httpd22.service</pre></li>

			</ul></li><li class="step"><div class="para">
				Start the mod_cluster balancer with the following command:
			</div><ul class="stepalternatives">
				<li class="step"><div class="para">
						For Red Hat Enterprise Linux 5 and 6:
					</div><pre class="programlisting">service httpd start</pre></li>
				 <li class="step"><div class="para">
						For Red Hat Enterprise Linux 7:
					</div><pre class="programlisting">systemctl start httpd22.service</pre></li>

			</ul></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+24378-748998+%5BLatest%5D&amp;comment=Title%3A+Install+the+mod_cluster+Module+Into+Apache+HTTP+Server+or+JBoss+Enterprise+Web+Server+%28RPM%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24378-748998+27+Mar+2015+08%3A24+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Server_Advertisement_Properties_for_Your_mod_cluster-enabled_HTTPD1">
      ⁠</a>17.6.5. Configure Server Advertisement Properties for Your mod_cluster-enabled Web Server</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			For instructions on configuring your web server to interact with the mod_cluster load balancer, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_mod_cluster_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.6.3, “Install the mod_cluster Module Into Apache HTTP Server or JBoss Enterprise Web Server (Zip)”</a>. One aspect of the configuration which needs more explanation is <em class="firstterm">server advertisement</em>.
		</div><div class="para">
		When server advertisement is active, the web server broadcasts messages containing the IP address and port number specified in the mod_cluster virtual host. To configure these values, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_mod_cluster_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.6.3, “Install the mod_cluster Module Into Apache HTTP Server or JBoss Enterprise Web Server (Zip)”</a>. If UDP multicast is not available on your network, or you prefer to configure workers with a static list of proxy servers, you can disable server advertisement and manually configure the worker nodes. See <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_a_mod_cluster_Worker_Node">Section 17.6.6, “Configure a mod_cluster Worker Node”</a> for information on configuring a worker.
	</div><div class="para">
		The changes in this procedure need to be made to the <code class="filename">httpd.conf</code> associated with your Apache HTTP Server instance. This is often <code class="filename">/etc/httpd/conf/httpd.conf</code> in Red Hat Enterprise Linux, or may be in the <code class="filename">etc/</code> directory of your standalone Apache HTTP Server instance.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978509434080">
      ⁠</a><p class="title"><strong>Procedure 17.13. Edit the httpd.conf file and implement the changes</strong></p><ol class="1"><li class="step"><p class="title"><strong>Disable the <code class="code">AdvertiseFrequency</code> parameter, if it exists.</strong></p><div class="para">
				If you have a line like the following in your <code class="sgmltag-element">&lt;VirtualHost&gt;</code> statement, comment it out by putting a <code class="literal">#</code> (hash) character before the first character. The value may be different from <code class="literal">5</code>.
			</div><pre class="screen">AdvertiseFrequency 5</pre></li><li class="step"><p class="title"><strong>Add the directive to disable server advertisement.</strong></p><div class="para">
				Add the following directive inside the <code class="sgmltag-element">&lt;VirtualHost&gt;</code> statement, to disable server advertisement.
			</div><pre class="screen">ServerAdvertise Off</pre></li><li class="step"><p class="title"><strong>Enable the ability to receive MCPM messages.</strong></p><div class="para">
				Add the following directive to allow the Web server to receive MCPM messages from the worker nodes.
			</div><pre class="screen">EnableMCPMReceive</pre></li><li class="step"><p class="title"><strong>Restart the Web server.</strong></p><div class="para">
				Restart the Web server by issuing one of the following, depending on whether you use Red Hat Enterprise Linux or Microsoft Windows Server.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Red Hat Enterprise Linux</strong></p><pre class="screen">[root@host ]# service httpd restart</pre></li>
				 <li class="step"><p class="title"><strong>Microsoft Windows Server</strong></p><pre class="screen">
net stop Apache2.2
net start Apache2.2
</pre></li>

			</ul></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The web server no longer advertises the IP address and port of your mod_cluster proxy. To reiterate, you need to configure your worker nodes to use a static address and port to communicate with the proxy. See <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_a_mod_cluster_Worker_Node">Section 17.6.6, “Configure a mod_cluster Worker Node”</a> for more details.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5222-757911+%5BLatest%5D&amp;comment=Title%3A+Configure+Server+Advertisement+Properties+for+Your+mod_cluster-enabled+Web+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5222-757911+14+May+2015+06%3A53+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_a_mod_cluster_Worker_Node">
      ⁠</a>17.6.6. Configure a mod_cluster Worker Node</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			A mod_cluster worker node consists of a JBoss EAP 6 server. This server can be part of a server group in a Managed Domain, or a standalone server. A separate process runs within JBoss EAP 6, which manages all of the worker nodes of the cluster. This is called the master. For more conceptual information about nodes, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Worker_Node">Section 17.2.4, “Node types”</a>. For an overview of web server load balancing, see to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Overview_of_HTTP_Connectors">Section 17.2.3, “Overview of HTTP Connectors”</a>.
		</div><div class="para">
		Worker nodes in a managed domain share an identical configuration across a server group. Worker nodes running as standalone servers are configured individually. The configuration steps are otherwise identical.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Worker Node Configuration</strong></p><ul><li class="listitem"><div class="para">
				A standalone server must be started with the <code class="code">standalone-ha</code> or <code class="literal">standalone-full-ha</code> profile.
			</div></li><li class="listitem"><div class="para">
				A server group in a managed domain must use the <code class="code">ha</code> or <code class="code">full-ha</code> profile, and the <code class="code">ha-sockets</code> or <code class="code">full-ha-sockets</code> socket binding group. JBoss EAP 6 ships with a cluster-enabled server group called <code class="code">other-server-group</code> which meets these requirements.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Where Management CLI commands are given, they assume you use a managed domain. If you use a standalone server, remove the <code class="code">/profile=full-ha</code> portion of the commands.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978477952128">
      ⁠</a><p class="title"><strong>Procedure 17.14. Configure a Worker Node</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure the network interfaces.</strong></p><div class="para">
				By default, the network interfaces all default to <code class="literal">127.0.0.1</code>. Every physical host that hosts either a standalone server or one or more servers in a server group needs its interfaces to be configured to use its public IP address, which the other servers can see.
			</div><div class="para">
				To change the IP address of a JBoss EAP 6 host, you need to shut it down and edit its configuration file directly. This is because the Management API which drives the Management Console and Management CLI relies on a stable management address.
			</div><div class="para">
				Follow these steps to change the IP address on each server in your cluster to the master's public IP address.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Start the JBoss EAP server using the profile described earlier in this topic.
					</div></li><li class="step"><div class="para">
						Launch the Management CLI, using the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.sh</code> command in Linux or the <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\jboss-cli.bat</code> command in Microsoft Windows Server. Type <code class="command">connect</code> to connect to the domain controller on the localhost, or <code class="command">connect <em class="replaceable">IP_ADDRESS</em></code> to connect to a domain controller on a remote server.
					</div></li><li class="step"><div class="para">
						Modify the external IP address for the <code class="literal">management</code>, <code class="literal">public</code> and <code class="literal">unsecure</code> interfaces by typing the following commands. Be sure to replace <code class="literal">EXTERNAL_IP_ADDRESS</code> in the command with the actual external IP address of the host. 
<pre class="screen"><code class="command">/interface=management:write-attribute(name=inet-address,value="${jboss.bind.address.management:<em class="replaceable">EXTERNAL_IP_ADDRESS</em>}"</code>
<code class="command">/interface=public:write-attribute(name=inet-address,value="${jboss.bind.address.public:<em class="replaceable">EXTERNAL_IP_ADDRESS</em>}"</code>
<code class="command">/interface=unsecure:write-attribute(name=inet-address,value="${jboss.bind.address.unsecure:<em class="replaceable">EXTERNAL_IP_ADDRESS</em>}"</code>
<code class="command">reload</code></pre>
						 You should see the following result for each command. 
<pre class="screen"> "outcome" =&gt; "success"</pre>

					</div></li><li class="step"><div class="para">
						For hosts that participate in a managed domain but are not the master, you must change the host name from <code class="literal">master</code> to a unique name. This name must be unique across slaves and will be used for the slave to identify to the cluster, so make a note of the name you use.
					</div><ol class="substeps i"><li class="step"><div class="para">
								Start the JBoss EAP slave host using the following syntax: 
<pre class="screen"><code class="command">bin/domain.sh --host-config=<em class="replaceable">HOST_SLAVE_XML_FILE_NAME</em></code></pre>
								 For example: 
<pre class="screen"><code class="command">bin/domain.sh --host-config=host-slave01.xml</code></pre>

							</div></li><li class="step"><div class="para">
								Launch the Management CLI.
							</div></li><li class="step"><div class="para">
								Use the following syntax to replace the host name: 
<pre class="screen"><code class="command">/host=master:write-attribute(name="name",value=<em class="replaceable">UNIQUE_HOST_SLAVE_NAME</em>)</code></pre>
								 For example: 
<pre class="screen"><code class="command">/host=master:write-attribute(name="name",value="host-slave01")</code></pre>
								 You should see the following result. 
<pre class="screen"> "outcome" =&gt; "success"</pre>

							</div><div class="para">
								This modifies the XML in the <code class="filename">host-slave01.xml</code> file as follows: 
<pre class="screen">&lt;host name="host-slave01" xmlns="urn:jboss:domain:1.6"&gt;</pre>

							</div></li></ol></li><li class="step"><div class="para">
						For newly configured hosts that need to join a managed domain, you must remove the <code class="code">local</code> element and add the <code class="code">remote</code> element <code class="code">host</code> attribute that points to the domain controller. This step does not apply for a standalone server.
					</div><ol class="substeps i"><li class="step"><div class="para">
								Start the JBoss EAP slave host using the following syntax: 
<pre class="screen"><code class="command">bin/domain.sh --host-config=<em class="replaceable">HOST_SLAVE_XML_FILE_NAME</em></code></pre>
								 For example: 
<pre class="screen"><code class="command">bin/domain.sh --host-config=host-slave01.xml</code></pre>

							</div></li><li class="step"><div class="para">
								Launch the Management CLI.
							</div></li><li class="step"><div class="para">
								Use the following syntax specify the domain controller: 
<pre class="screen"><code class="command">/host=UNIQUE_HOST_SLAVE_NAME/:write-remote-domain-controller(host=<em class="replaceable">DOMAIN_CONTROLLER_IP_ADDRESS</em>,port=${jboss.domain.master.port:9999},security-realm="ManagementRealm") </code></pre>
								 For example: 
<pre class="screen"><code class="command">/host=host-slave01/:write-remote-domain-controller(host="192.168.1.200",port=${jboss.domain.master.port:9999},security-realm="ManagementRealm") </code></pre>
								 You should see the following result. 
<pre class="screen"> "outcome" =&gt; "success"</pre>

							</div><div class="para">
								This modifies the XML in the <code class="filename">host-slave01.xml</code> file as follows: 
<pre class="screen">&lt;domain-controller&gt;
    &lt;remote host="192.168.1.200" port="${jboss.domain.master.port:9999}" security-realm="ManagementRealm"/&gt;
&lt;/domain-controller&gt;</pre>

							</div></li></ol></li></ol></li><li class="step"><p class="title"><strong>Configure authentication for each slave server.</strong></p><div class="para">
				Each slave server needs a username and password created in the domain controller's or standalone master's <code class="literal">ManagementRealm</code>. On the domain controller or standalone master, run the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/add-user.sh</code> command. Add a user with the same username as the slave, to the <code class="literal">ManagementRealm</code>. When asked if this user will need to authenticate to an external JBoss EAP 6 instance, answer <code class="literal">yes</code>. An example of the input and output of the command is below, for a slave called <code class="literal">slave1</code>, with password <code class="literal">changeme</code>.
			</div><pre class="screen">
user:bin user$ ./add-user.sh

What type of user do you wish to add? 
 a) Management User (mgmt-users.properties) 
 b) Application User (application-users.properties)
(a): <code class="prompt">a</code>

Enter the details of the new user to add.
Realm (ManagementRealm) : 
Username : <code class="prompt">slave1</code>
Password : <code class="prompt">changeme</code>
Re-enter Password : <code class="prompt">changeme</code>
About to add user 'slave1' for realm 'ManagementRealm'
Is this correct yes/no? <code class="prompt">yes</code>
Added user 'slave1' to file '/home/user/jboss-eap-6.0/standalone/configuration/mgmt-users.properties'
Added user 'slave1' to file '/home/user/jboss-eap-6.0/domain/configuration/mgmt-users.properties'
Is this new user going to be used for one AS process to connect to another AS process e.g. slave domain controller?
yes/no? yes
To represent the user add the following to the server-identities definition &lt;secret value="Y2hhbmdlbWU=" /&gt;
</pre></li><li class="step"><p class="title"><strong>Copy the Base64-encoded <code class="code">&lt;secret&gt;</code> element from the <code class="code">add-user.sh</code> output.</strong></p><div class="para">
				If you plan to specify the Base64-encoded password value for authentication, copy the <code class="code">&lt;secret&gt;</code> element value from the last line of the <code class="code">add-user.sh</code> output as you will need it in the step below.
			</div></li><li class="step"><p class="title"><strong>Modify the slave host's security realm to use the new authentication.</strong></p><div class="para">
				You can specify the secret value in one of the following ways:
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Specify the Base64-encoded password value in the server configuration file using the Management CLI.</strong></p><ol class="substeps a"><li class="step"><div class="para">
								Launch the Management CLI, using the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.sh</code> command in Linux or the <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\jboss-cli.bat</code> command in Microsoft Windows Server. Type <code class="command">connect</code> to connect to the domain controller on the localhost, or <code class="command">connect <em class="replaceable">IP_ADDRESS</em></code> to connect to a domain controller on a remote server.
							</div></li><li class="step"><div class="para">
								Specify the secret value by typing the following command. Be sure to replace the <code class="literal">SECRET_VALUE</code> with the secret value returned from the <code class="command">add-user</code> output from the previous step. 
<pre class="screen"><code class="command">/host=<em class="replaceable">master</em>/core-service=management/security-realm=ManagementRealm/server-identity=secret:add(value="<em class="replaceable">SECRET_VALUE</em>") </code>
<code class="command">reload --host=<em class="replaceable">master</em></code></pre>
								 You should see the following result for each command. 
<pre class="screen"> "outcome" =&gt; "success"</pre>

							</div></li></ol></li>
				 <li class="step"><p class="title"><strong>Configure the host to get the password from the vault.</strong></p><ol class="substeps a"><li class="step"><div class="para">
								Use the <code class="filename">vault.sh</code> script to generate a masked password. It will generate a string like the following: <code class="literal">VAULT::secret::password::ODVmYmJjNGMtZDU2ZC00YmNlLWE4ODMtZjQ1NWNmNDU4ZDc1TElORV9CUkVBS3ZhdWx0</code>.
							</div><div class="para">
								You can find more information on password vaults in the <em class="citetitle">Security Architecture</em> and other JBoss EAP security documentation.
							</div></li><li class="step"><div class="para">
								Launch the Management CLI, using the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.sh</code> command in Linux or the <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\jboss-cli.bat</code> command in Microsoft Windows Server. Type <code class="command">connect</code> to connect to the domain controller on the localhost, or <code class="command">connect <em class="replaceable">IP_ADDRESS</em></code> to connect to a domain controller on a remote server.
							</div></li><li class="step"><div class="para">
								Specify the secret value by typing the following command. Be sure to replace the <code class="literal">SECRET_VALUE</code> with the masked password generated in the previous step. 
<pre class="screen"><code class="command">/host=<em class="replaceable">master</em>/core-service=management/security-realm=ManagementRealm/server-identity=secret:add(value="${VAULT::secret::password::<em class="replaceable">SECRET_VALUE</em>}") </code>
<code class="command">reload --host=<em class="replaceable">master</em></code></pre>
								 You should see the following result for each command. 
<pre class="screen"> "outcome" =&gt; "success"</pre>

							</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									When creating a password in the vault, it must be specified in plain text, not Base64-encoded.
								</div></div></div></li></ol><div class="para">

					</div></li>
				 <li class="step"><p class="title"><strong>Specify the password as a system property.</strong></p><div class="para">
						The following examples use <code class="literal">server.identity.password</code> as the system property name for the password.
					</div><ol class="substeps a"><li class="step"><div class="para">
								Specify the system property for the password in the server configuration file using the Management CLI.
							</div><ol class="substeps i"><li class="step"><div class="para">
										Launch the Management CLI, using the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/jboss-cli.sh</code> command in Linux or the <code class="filename"><em class="replaceable">EAP_HOME</em>\bin\jboss-cli.bat</code> command in Microsoft Windows Server. Type <code class="command">connect</code> to connect to the domain controller on the localhost, or <code class="command">connect <em class="replaceable">IP_ADDRESS</em></code> to connect to a domain controller on a remote server.
									</div></li><li class="step"><div class="para">
										Type the following command to configure the secret identity to use the system property. 
<pre class="screen"><code class="command">/host=<em class="replaceable">master</em>/core-service=management/security-realm=ManagementRealm/server-identity=secret:add(value="${server.identity.password}") </code>
<code class="command">reload --host=<em class="replaceable">master</em></code></pre>
										 You will see the following result for each command. 
<pre class="screen"> "outcome" =&gt; "success"</pre>

									</div></li></ol></li><li class="step"><div class="para">
								When you specify the password as a system property, you can configure the host in either of the following ways:
							</div><ul class="stepalternatives">
								<li class="step"><div class="para">
										Start the server entering the password in plain text as a command line argument, for example: 
<pre class="screen">-Dserver.identity.password=changeme</pre>

									</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
											The password must be entered in plain text and will be visible to anyone who issues a <code class="command">ps -ef</code> command.
										</div></div></div></li>
								 <li class="step"><div class="para">
										Place the password in a properties file and pass the properties file URL as a command line argument.
									</div><ol class="substeps i"><li class="step"><div class="para">
												Add the key/value pair to a properties file. For example:
											</div><pre class="screen">server.identity.password=changeme</pre></li><li class="step"><div class="para">
												Start the server with the command line arguments 
<pre class="screen">--properties=<em class="replaceable">URL_TO_PROPERTIES_FILE</em></pre>
												 .
											</div></li></ol></li>

							</ul></li></ol><div class="para">

					</div></li>

			</ul></li><li class="step"><p class="title"><strong>Restart the server.</strong></p><div class="para">
				The slave will now authenticate to the master using its host name as the username and the encrypted string as its password.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your standalone server, or servers within a server group of a managed domain, are now configured as mod_cluster worker nodes. If you deploy a clustered application, its sessions are replicated to all cluster nodes for failover, and it can accept requests from an external Web server or load balancer. Each node of the cluster discovers the other nodes using automatic discovery, by default.To configure automatic discovery, and the other specific settings of the <code class="code">mod_cluster</code> subsystem, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_mod_cluster_Subsystem">Section 17.6.2, “Configure the <code class="code">mod_cluster</code> Subsystem”</a>. To configure the Apache HTTP Server,see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Use_an_External_HTTPD_as_the_Web_Front-end_for_Enterprise_Application_Platform_Applications">Section 17.4.7, “Use an External Web Server as the Web Front-end for JBoss EAP 6 Applications”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5223-764467+%5BLatest%5D&amp;comment=Title%3A+Configure+a+mod_cluster+Worker+Node%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5223-764467+10+Jul+2015+01%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Migrate_Traffic_between_Clusters">
      ⁠</a>17.6.7. Migrate Traffic between Clusters</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			After creating a new cluster using JBoss EAP 6, you can migrate traffic from the previous cluster to the new one as part of an upgrade process. In this task, you will see the strategy that can be used to migrate this traffic with minimal outage or downtime.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				A new cluster setup: <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_mod_cluster_Subsystem">Section 17.6.2, “Configure the <code class="code">mod_cluster</code> Subsystem”</a> (we will call this cluster: ClusterNEW).
			</div></li><li class="listitem"><div class="para">
				An old cluster setup that is being made redundant (we will call this cluster: ClusterOLD).
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978501121792">
      ⁠</a><p class="title"><strong>Procedure 17.15. Upgrade Process for Clusters - Load Balancing Groups</strong></p><ol class="1"><li class="step"><div class="para">
				Setup your new cluster using the steps described in the prerequisites.
			</div></li><li class="step"><div class="para">
				In both ClusterNEW and ClusterOLD, ensure that the configuration option <code class="literal">sticky-session</code> is set to <code class="literal">true</code> (this option is set to <code class="literal">true</code> by default). Enabling this option means that all new requests made to a cluster node in any of the clusters will continue to go to the respective cluster node.
			</div><div class="para">
				
<pre class="programlisting">/profile=full-ha/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=sticky-session,value=true)
</pre>

			</div></li><li class="step"><div class="para">
				Assuming that all the cluster nodes in ClusterOLD are members of ClusterOLD load balancing group. One can set this configuration either via CLI or with an xml configuration (either ha or full-ha profiles in domain mode and either standalone-ha or standalone-full-ha in standalone mode):
			</div><div class="para">
				
<pre class="programlisting">/profile=full-ha/subsystem=modcluster/mod-cluster-config=configuration/:write-attribute(name=load-balancing-group,value=ClusterOLD)</pre>
				 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>				
<span xmlns="" class="line">​</span>				&lt;subsystem xmlns=<span xmlns="" class="perl_String">"urn:jboss:domain:modcluster:1.2"</span>&gt;
<span xmlns="" class="line">​</span>					&lt;mod-cluster-config load-balancing-group=<span xmlns="" class="perl_String">"ClusterOLD"</span> advertise-socket=<span xmlns="" class="perl_String">"modcluster"</span> connector=<span xmlns="" class="perl_String">"ajp"</span>&gt;
<span xmlns="" class="line">​</span>						&lt;dynamic-load-provider&gt;
<span xmlns="" class="line">​</span>							&lt;load-metric type=<span xmlns="" class="perl_String">"busyness"</span>/&gt;
<span xmlns="" class="line">​</span>						&lt;/dynamic-load-provider&gt;
<span xmlns="" class="line">​</span>       		&lt;/mod-cluster-config&gt;
<span xmlns="" class="line">​</span>    		&lt;/subsystem&gt;
</pre>

			</div></li><li class="step"><div class="para">
				Add the nodes in ClusterNEW to the mod_cluster configuration individually using the process described here: <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_a_mod_cluster_Worker_Node">Section 17.6.6, “Configure a mod_cluster Worker Node”</a>. Additionally use the aforementioned procedure and set their load balancing group to ClusterNEW.
			</div><div class="para">
				At this point, one can see an output similar to the undermentioned shortened example on the mod_cluster-manager console: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>				
<span xmlns="" class="line">​</span>				mod_cluster/&lt;version&gt;
<span xmlns="" class="line">​</span>				
<span xmlns="" class="line">​</span>    LBGroup ClusterOLD: [Enable Nodes]   [Disable Nodes]   [Stop Nodes]
<span xmlns="" class="line">​</span>        Node node-<span xmlns="" class="perl_Float">1</span>-<span xmlns="" class="perl_Function">jvmroute</span> (ajp:<span xmlns="" class="perl_Comment">//node1.oldcluster.example:8009):</span>
<span xmlns="" class="line">​</span>            [Enable Contexts]   [Disable Contexts]   [Stop Contexts]
<span xmlns="" class="line">​</span>            Balancer: qacluster, LBGroup: ClusterOLD, Flushpackets: Off, ..., Load: <span xmlns="" class="perl_Float">100</span>
<span xmlns="" class="line">​</span>            Virtual Host <span xmlns="" class="perl_Float">1</span>:
<span xmlns="" class="line">​</span>                Contexts:
<span xmlns="" class="line">​</span>                    /my-deployed-application-context, Status: ENABLED Request: <span xmlns="" class="perl_Float">0</span> [Disable]   [Stop]
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>        Node node-<span xmlns="" class="perl_Float">2</span>-<span xmlns="" class="perl_Function">jvmroute</span> (ajp:<span xmlns="" class="perl_Comment">//node2.oldcluster.example:8009):</span>
<span xmlns="" class="line">​</span>            [Enable Contexts]   [Disable Contexts]   [Stop Contexts]
<span xmlns="" class="line">​</span>            Balancer: qacluster, LBGroup: ClusterOLD, Flushpackets: Off, ..., Load: <span xmlns="" class="perl_Float">100</span>
<span xmlns="" class="line">​</span>            Virtual Host <span xmlns="" class="perl_Float">1</span>:
<span xmlns="" class="line">​</span>                Contexts:
<span xmlns="" class="line">​</span>                    /my-deployed-application-context, Status: ENABLED Request: <span xmlns="" class="perl_Float">0</span> [Disable]   [Stop]
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    LBGroup ClusterNEW: [Enable Nodes]   [Disable Nodes]   [Stop Nodes]
<span xmlns="" class="line">​</span>        Node node-<span xmlns="" class="perl_Float">3</span>-<span xmlns="" class="perl_Function">jvmroute</span> (ajp:<span xmlns="" class="perl_Comment">//node3.newcluster.example:8009):</span>
<span xmlns="" class="line">​</span>            [Enable Contexts]   [Disable Contexts]   [Stop Contexts]
<span xmlns="" class="line">​</span>            Balancer: qacluster, LBGroup: ClusterNEW, Flushpackets: Off, ..., Load: <span xmlns="" class="perl_Float">100</span>
<span xmlns="" class="line">​</span>            Virtual Host <span xmlns="" class="perl_Float">1</span>:
<span xmlns="" class="line">​</span>                Contexts:
<span xmlns="" class="line">​</span>                    /my-deployed-application-context, Status: ENABLED Request: <span xmlns="" class="perl_Float">0</span> [Disable]   [Stop]
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>        Node node-<span xmlns="" class="perl_Float">4</span>-<span xmlns="" class="perl_Function">jvmroute</span> (ajp:<span xmlns="" class="perl_Comment">//node4.newcluster.example:8009):</span>
<span xmlns="" class="line">​</span>            [Enable Contexts]   [Disable Contexts]   [Stop Contexts]
<span xmlns="" class="line">​</span>            Balancer: qacluster, LBGroup: ClusterNEW, Flushpackets: Off, ..., Load: <span xmlns="" class="perl_Float">100</span>
<span xmlns="" class="line">​</span>            Virtual Host <span xmlns="" class="perl_Float">1</span>:
<span xmlns="" class="line">​</span>                Contexts:
<span xmlns="" class="line">​</span>                    /my-deployed-application-context, Status: ENABLED Request: <span xmlns="" class="perl_Float">0</span> [Disable]   [Stop]
</pre>

			</div></li><li class="step"><div class="para">
				There are old active sessions within the ClusterOLD group and any new sessions are created either within the ClusterOLD or CLusterNEW group. Next, we want to disable the whole ClusterOLD group, so as we can power down its cluster nodes without causing any error to currently active client's sessions.
			</div><div class="para">
				Click on the [Disable Nodes] link for LBGroup ClusterOLD on mod_cluster-manager web console.
			</div><div class="para">
				From this point on, only requests belonging to already established sessions will be routed to members of ClusterOLD load balancing group. Any new client's sessions will be created in the ClusterNEW group only. As soon as there are no active sessions within ClusterOLD group, we can safely remove its members.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Using [Stop Nodes] would command the load balancer to stop routing any requests to this domain immediately. This will force a failover to another load balancing group which will cause session data loss to clients, provided there is no session replication between ClusterNEW and ClusterOLD.
				</div></div></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Default Load Balancing Group</div>
			In case the current ClusterOLD setup does not contain any load balancing group settings (one can see LBGroup:, on mod_cluster-manager console), one can still take advantage of disabling the ClusterOLD nodes. In this case, click on [Disable Contexts] for each of the Cluster OLD nodes. Contexts of these nodes will be disabled and once there are no active sessions present, they will be ready for removal. New client's sessions will be created only on nodes with enabled contexts, presumably Cluster NEW members in this example.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Using JBoss EAP CLI</div>
			In addition to the possibility of using mod_cluster-manager web console, one can leverage CLI in order to disable a particular context. The undermentioned operation is called stop-context, but it makes the cluster node to send DISABLE-APP command to the load balancer, having exactly the same effect as clicking on [Disable] link next to a particular context on mod_cluster-manager console (note that virtual host aliases, e.g. default-host were removed from the aforementioned mod_cluster-manager console output example). 
<pre class="programlisting">/profile=full-ha/subsystem=modcluster/:stop-context(context=/my-deployed-application-context, virtualhost=default-host, waittime=50)</pre>

		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Conclusion</div>
			To stop a particular context, cluster node or a whole load balancing group means to force the balancer to stop routing any request to it immediately, thus forcing failover to another available context. To disable a particular context, cluster node or a whole load balancing group means to tell the balancer that no new sessions should be crated on this particular context/node/load balancing group.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			You have successfully upgraded a JBoss EAP 6 Cluster.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+14157-764042+%5BLatest%5D&amp;comment=Title%3A+Migrate+Traffic+between+Clusters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=14157-764042+07+Jul+2015+06%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_fail_on_status_Parameter_for_mod_cluster">
      ⁠</a>17.6.8. Configure <code class="code">fail_on_status</code> Parameter for mod_cluster</h2></div></div></div><div class="para">
		The <code class="code">fail_on_status</code> parameter lists those HTTP status codes which, when returned by a worker node in a cluster, will mark that node as having failed. The load balancer will then send future requests to another worker node in the cluster. The failed worker node will remain in a <code class="code">NOTOK</code> state until it sends the load balancer a <code class="code">STATUS</code> message.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The <code class="code">fail_on_status</code> parameter cannot be used with HP-UX v11.3 hpws httpd B.2.2.15.15 from Hewlett-Packard as it does not support the feature.
		</div></div></div><div class="para">
		The <code class="code">fail_on_status</code> parameter must be configured in the <code class="code">httpd</code> configuration file of your load balancer. Multiple HTTP status codes for <code class="code">fail_on_status</code> can be specified as a comma-separated list. The following example specifies the HTTP status codes <code class="code">203</code> and <code class="code">204</code> for <code class="code">fail_on_status</code>.
	</div><div class="example"><a id="idm139978448929456">
      ⁠</a><p class="title"><strong>Example 17.6. <code class="code">fail_on_status</code> Configuration</strong></p><div class="example-contents"><pre class="programlisting">ProxyPass / balancer://MyBalancer stickysession=JSESSIONID|jsessionid nofailover=on failonstatus=203,204
ProxyPassReverse / balancer://MyBalancer
ProxyPreserveHost on</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42255-763064+%5BLatest%5D&amp;comment=Title%3A+Configure+%3Ccode%3Efail_on_status%3C%2Fcode%3E+Parameter+for+mod_cluster%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42255-763064+25+Jun+2015+23%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Apache_mod_jk">
      ⁠</a>17.7. Apache mod_jk</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Apache_mod_jk_HTTP_Connector">
      ⁠</a>17.7.1. About the Apache mod_jk HTTP Connector</h2></div></div></div><div class="para">
		Apache <code class="code">mod_jk</code> is a HTTP connector which is provided for customers who need it for compatibility purposes. It provides load balancing, and is a part of the natives package, <span class="guilabel"><strong>Red Hat JBoss Enterprise Application Platform 6.<em class="replaceable">X</em>.0 Webserver Connector Natives</strong></span> (zip installation) which is available on the Red Hat Customer Portal at <a href="https://access.redhat.com">https://access.redhat.com</a>. <code class="code">mod_jk</code> can be installed from the RPMs. For details of installing from RPM, refer <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Mod_jk_Module_Into_the_Apache_HTTP_Server_RPM">Section 17.7.4, “Install the mod_jk Module Into the Apache HTTP Server (RPM)”</a>. For supported platforms, see <a href="https://access.redhat.com/articles/111663">https://access.redhat.com/articles/111663</a>. The <code class="code">mod_jk</code> connector is maintained by Apache, and its documentation is located at <a href="http://tomcat.apache.org/connectors-doc/">http://tomcat.apache.org/connectors-doc/</a>.
	</div><div class="para">
		JBoss EAP 6 can accept workloads from an Apache HTTP proxy server. The proxy server accepts client requests from the web front-end, and passes the work to participating JBoss EAP 6 servers. If sticky sessions are enabled, the same client request always goes to the same JBoss EAP 6 server, unless the server is unavailable.
	</div><div class="para">
		Unlike the JBoss <code class="code">mod_cluster</code> HTTP connector, an Apache <code class="code">mod_jk</code> HTTP connector does not know the status of deployments on servers or server groups, and cannot adapt where it sends its work accordingly.
	</div><div class="para">
		<code class="code">mod_jk</code> communicates over the AJP 1.3 protocol. <code class="code">mod_cluster</code> supports other protocols. For more information, refer Table HTTP connector features and constraints in <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Overview_of_HTTP_Connectors">Section 17.2.3, “Overview of HTTP Connectors”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			<code class="code">mod_cluster</code> is a more advanced load balancer than <code class="code">mod_jk</code>. <code class="code">mod_cluster</code> provides all of the functionality of <code class="code">mod_jk</code> and additional features. For more information about <code class="code">mod_cluster</code>, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Modcluster_HTTP_Connector">Section 17.6.1, “About the <code class="code">mod_cluster</code> HTTP Connector”</a>.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Next step: Configure a JBoss EAP 6 instance to participate in a mod_jk load balancing group</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Mod_jk_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.7.3, “Install the mod_jk Module Into the Apache HTTP Server (ZIP)”</a>
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4654-767771+%5BLatest%5D&amp;comment=Title%3A+About+the+Apache+mod_jk+HTTP+Connector%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4654-767771+19+Aug+2015+08%3A07+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_Enterprise_Application_Platform_to_Communicate_with_Apache_Mod_jk1">
      ⁠</a>17.7.2. Configure JBoss EAP 6 to Communicate with Apache mod_jk</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			The mod_jk HTTP connector has a single component, the <code class="filename">mod_jk.so</code> module loaded by the web server. This module receives client requests and forwards them to the container, in this case JBoss EAP 6. JBoss EAP 6 must also be configured to accept these requests and send replies back to the web server.
		</div><div class="para">
		Configuring the Apache HTTP Server is covered in <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Mod_jk_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">Section 17.7.3, “Install the mod_jk Module Into the Apache HTTP Server (ZIP)”</a>.
	</div><div class="para">
		In order for JBoss EAP 6 to be able to communicate with the Apache HTTP server, it must have the AJP/1.3 connector enabled. This connector is present by default in the following configurations:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				In a managed domain, in server groups using the <code class="code">ha</code> and <code class="code">full-ha</code> profiles, and the <code class="code">ha</code> or <code class="code">full-ha</code> socket binding group. The <code class="code">other-server-group</code> server group is configured correctly in a default installation.
			</div></li><li class="listitem"><div class="para">
				In a standalone server, the <code class="filename">standalone-ha</code> and <code class="filename">standalone-full-ha</code> profiles are configured for clustered configurations. To start the standalone server with one of these profiles, issue the following command, from the <code class="filename"><em class="replaceable">EAP_HOME</em>/</code> directory. Substitute the appropriate profile name.
			</div><pre class="screen"><code class="prompt"><em class="replaceable">EAP_HOME</em>/bin/standalone.sh --server-config=standalone-ha.xml</code></pre><div class="para">
				For Windows, enter the following command:
			</div><pre class="screen"><code class="prompt"><em class="replaceable">EAP_HOME</em>\bin\standalone.bat --server-config=standalone-ha.xml</code></pre></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5215-766640+%5BLatest%5D&amp;comment=Title%3A+Configure+JBoss+EAP+6+to+Communicate+with+Apache+mod_jk%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5215-766640+04+Aug+2015+07%3A33+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_Mod_jk_Module_Into_Apache_HTTPD_or_Enterprise_Web_Server_HTTPD1">
      ⁠</a>17.7.3. Install the mod_jk Module Into the Apache HTTP Server (ZIP)</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				To perform this task, you must be using Apache HTTP Server installed on a supported environment or the Apache HTTP Server installed from JBoss Enterprise Web Server. Note that the JBoss Enterprise Web Server is part of the JBoss EAP 6 distribution.
			</div></li><li class="listitem"><div class="para">
				If you need to install the Red Hat Enterprise Linux native Apache HTTP Server, use the instructions in the <em class="citetitle">Red Hat Enterprise Linux Deployment Guide</em>.
			</div></li><li class="listitem"><div class="para">
				If you need to install the HP-UX native Apache HTTP Server, use the instructions in the <em class="citetitle">HP-UX Web Server Suite Installation Guide</em>, available at <a href="https://h20392.www2.hp.com/portal/swdepot/displayInstallInfo.do?productNumber=HPUXWSATW232">https://h20392.www2.hp.com/portal/swdepot/displayInstallInfo.do?productNumber=HPUXWSATW232</a>.
			</div></li><li class="listitem"><div class="para">
				If you need to install JBoss Enterprise Web Server, use the instructions in the <em class="citetitle">JBoss Enterprise Web Server Installation Guide</em>.
			</div></li><li class="listitem"><div class="para">
				If you are using Apache HTTP Server, download the JBoss EAP 6 Native Components package for your platform from the Red Hat Customer Portal at <a href="https://access.redhat.com">https://access.redhat.com</a>. This package contains both the <code class="code">mod_jk </code>and <code class="code">mod_cluster</code> precompiled binaries. If you are using JBoss Enterprise Web Server, it already includes the binary for <code class="code">mod_jk</code>.
			</div></li><li class="listitem"><div class="para">
				If you are using Red Hat Enterprise Linux (RHEL) 5 and native Apache HTTP server (httpd 2.2.3), load the mod_perl module prior to loading mod_jk module.
			</div></li><li class="listitem"><div class="para">
				You must be logged in with administrative (root) privileges.
			</div></li><li class="listitem"><div class="para">
				To view the HTTPD variable conventions, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#HTTPD_Variable_Conventions">Section 17.4.2, “HTTPD Variable Conventions”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978535809504">
      ⁠</a><p class="title"><strong>Procedure 17.16. Install the mod_jk Module</strong></p><ol class="1"><li class="step"><p class="title"><strong>Configure the mod_jk module.</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Create a new file called <code class="filename"><em class="replaceable">HTTPD_HOME</em>/conf.d/mod-jk.conf</code> and add the following to it:
					</div><div class="note"><div class="admonition_header"><p><strong>The JkMount directive</strong></p></div><div class="admonition"><div class="para">
							The <code class="literal">JkMount</code> directive specifies which URLs Apache HTTP Server must forward to the mod_jk module. Based on the directive's configuration, mod_jk sends the received URL to the correct workers.
						</div><div class="para">
							To serve static content directly, and only use the load balancer for Java applications, the URL path must be <code class="literal">/application/*</code>. To use mod_jk as a load balancer, use the value <code class="literal">/*</code>, to forward all URLs to mod_jk.
						</div></div></div><pre class="programlisting">
# Load mod_jk module
# Specify the filename of the mod_jk lib
LoadModule jk_module modules/mod_jk.so

# Where to find workers.properties
JkWorkersFile conf/workers.properties

# Where to put jk logs
JkLogFile logs/mod_jk.log

# Set the jk log level [debug/error/info]
JkLogLevel info 

# Select the log format
JkLogStampFormat  "[%a %b %d %H:%M:%S %Y]"

# JkOptions indicates to send SSK KEY SIZE
JkOptions +ForwardKeySize -ForwardDirectories

# JkRequestLogFormat
JkRequestLogFormat "%w %V %T"

# Mount your applications
# The default setting only sends Java application data to mod_jk.
# Use the commented-out line to send all URLs through mod_jk.
# JkMount /* loadbalancer
JkMount /application/* loadbalancer

# Add shared memory.
# This directive is present with 1.2.10 and
# later versions of mod_jk, and is needed for
# for load balancing to work properly
JkShmFile logs/jk.shm 

# Add jkstatus for managing runtime data
&lt;Location /jkstatus/&gt;
JkMount status
Order deny,allow
Deny from all
Allow from 127.0.0.1
&lt;/Location&gt;
</pre><div class="para">
						Look over the values and ensure they are reasonable for your setup. When you are satisfied, save the file.
					</div></li><li class="step"><p class="title"><strong>Specify a JKMountFile directive</strong></p><div class="para">
						In addition to the JKMount directive in the <code class="filename">mod-jk.conf</code>, you can specify a file which contains multiple URL patterns to be forwarded to mod_jk.
					</div><ol class="substeps i"><li class="step"><div class="para">
								Add the following to the <code class="filename"><em class="replaceable">HTTPD_HOME</em>/conf/mod-jk.conf</code> file:
							</div><pre class="programlisting">
# You can use external file for mount points.
# It will be checked for updates each 60 seconds.
# The format of the file is: /url=worker
# /examples/*=loadbalancer
JkMountFile conf/uriworkermap.properties
</pre></li><li class="step"><div class="para">
								Create a new file called <code class="filename"><em class="replaceable">HTTPD_CONF</em>/uriworkermap.properties</code>, with a line for each URL pattern to be matched. The following example shows examples of the syntax of the file.
							</div><pre class="programlisting">
# Simple worker configuration file
/*=loadbalancer
</pre></li></ol></li><li class="step"><p class="title"><strong>Copy the mod_jk.so file to the httpd's modules directory</strong></p><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							This is only necessary if the Apache HTTP server does not have <code class="filename">mod_jk.so</code> in its <code class="filename">modules/</code> directory. You can skip this step if you are using the Apache HTTP server included as a download as part of JBoss EAP 6.
						</div></div></div><div class="para">
						Extract the Native Web Server Connectors Zip package. Locate the <code class="filename">mod_jk.so</code> file in either the <code class="filename"><em class="replaceable">EAP_HOME</em>/modules/system/layers/base/native/lib/httpd/modules/</code> or the <code class="filename"><em class="replaceable">EAP_HOME</em>/modules/system/layers/base/native/lib64/httpd/modules/</code> directories, depending on whether your operating system is 32-bit or 64-bit.
					</div><div class="para">
						Copy the file to the <code class="filename"><em class="replaceable">HTTPD_MODULES</em>/</code> directory.
					</div></li></ol></li><li class="step"><p class="title"><strong>Configure the mod_jk worker nodes.</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Create a new file called <code class="filename"><em class="replaceable">HTTPD_CONF</em>/workers.properties</code>. Use the following example as your starting point, and modify the file to suit your needs.
					</div><pre class="programlisting">
# Define list of workers that will be used
# for mapping requests
worker.list=loadbalancer,status

# Define Node1
# modify the host as your host IP or DNS name.
worker.node1.port=8009
worker.node1.host=node1.mydomain.com
worker.node1.type=ajp13
worker.node1.ping_mode=A
worker.node1.lbfactor=1 

# Define Node2
# modify the host as your host IP or DNS name.
worker.node2.port=8009
worker.node2.host=node2.mydomain.com
worker.node2.type=ajp13
worker.node2.ping_mode=A
worker.node2.lbfactor=1

# Load-balancing behavior
worker.loadbalancer.type=lb
worker.loadbalancer.balance_workers=node1,node2
worker.loadbalancer.sticky_session=1

# Status worker for managing load balancer
worker.status.type=status
</pre><div class="para">
						For a detailed description of the syntax of the <code class="filename">workers.properties</code> file, and advanced configuration options, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configuration_Reference_for_Apache_Mod_jk_Workers">Section 17.7.5, “Configuration Reference for Apache mod_jk Workers”</a>.
					</div></li></ol></li><li class="step"><p class="title"><strong>Restart the Web Server.</strong></p><div class="para">
				The way to restart the web server depends on whether you are using Red Hat Enterprise Linux's Apache HTTP server or the Apache HTTP server included in JBoss Enterprise Web Server. Choose one of the following methods.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Red Hat Enterprise Linux's Apache HTTP Server</strong></p><div class="para">
						Issue the following command:
					</div><pre class="screen">[root@host]# <code class="command">service httpd restart</code></pre></li>
				 <li class="step"><p class="title"><strong>JBoss Enterprise Web Server Apache HTTP Server</strong></p><div class="para">
						JBoss Enterprise Web Server runs on both Red Hat Enterprise Linux and Microsoft Windows Server. The method for restarting the web server is different for each.
					</div><ul class="stepalternatives">
						<li class="step"><p class="title"><strong>Red Hat Enterprise Linux, installed from RPM</strong></p><div class="para">
								In Red Hat Enterprise Linux, JBoss Enterprise Web Server installs its web server as a service. To restart the web server, issue the following two commands:
							</div><pre class="screen">
[root@host ~]# service httpd stop
[root@host ~]# service httpd start
</pre></li>
						 <li class="step"><p class="title"><strong>Red Hat Enterprise Linux, installed from Zip</strong></p><div class="para">
								If you have installed the JBoss Enterprise Web Server Apache HTTP server from a Zip archive, use the <code class="command">apachectl</code> command to restart the web server. Replace <em class="replaceable">EWS_HOME</em> with the directory where you unzipped JBoss Enterprise Web Server Apache HTTP server.
							</div><pre class="screen">
[root@host ~]# <em class="replaceable">EWS_HOME</em>/httpd/sbin/apachectl restart
</pre></li>
						 <li class="step"><p class="title"><strong>Microsoft Windows Server</strong></p><div class="para">
								Issue the following commands in a command prompt with administrative privileges:
							</div><pre class="screen">
net stop Apache2.2
net start Apache2.2
</pre></li>
						 <li class="step"><p class="title"><strong>Solaris</strong></p><div class="para">
								Issue the following commands in a command prompt with administrative privileges. Replace <em class="replaceable">EWS_HOME</em> with the directory where you unzipped JBoss Enterprise Web Server Apache HTTP server.
							</div><pre class="screen">
[root@host ~] <em class="replaceable">EWS_HOME</em>/httpd/sbin/apachectl restart
</pre></li>

					</ul></li>

			</ul></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The Apache HTTP server is now configured to use the mod_jk load balancer. To configure JBoss EAP 6 to be aware of mod_jk, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5217-767501+%5BLatest%5D&amp;comment=Title%3A+Install+the+mod_jk+Module+Into+the+Apache+HTTP+Server+%28ZIP%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5217-767501+17+Aug+2015+04%3A34+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_Mod_jk_Module_Into_the_Apache_HTTP_Server_RPM">
      ⁠</a>17.7.4. Install the mod_jk Module Into the Apache HTTP Server (RPM)</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				To perform this task, you must be using the Apache HTTP Server installed in Red Hat Enterprise Linux 6, JBoss Enterprise Web Server, or the standalone Apache HTTP Server included as a separate downloadable component of JBoss EAP 6.
			</div></li><li class="listitem"><div class="para">
				You must have an active subscription to the <code class="literal">jbappplatform-6-ARCHITECTURE-server-RHEL_VERSION-rpm</code> channel.
			</div></li><li class="listitem"><div class="para">
				If you need to install Apache HTTP Server in Red Hat Enterprise Linux 6, use the instructions from the <em class="citetitle">Red Hat Enterprise Linux 6 Deployment Guide</em>.
			</div></li><li class="listitem"><div class="para">
				If you need to install the standalone Apache HTTP Server included as a separate downloadable component of JBoss EAP 6, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Apache_HTTPD_included_with_JBoss_Enterprise_Application_Platform_61">Section 17.4.3, “Install Apache HTTP Server in Red Hat Enterprise Linux 5, 6, and 7 (Zip)”</a> .
			</div></li><li class="listitem"><div class="para">
				If you need to install JBoss Enterprise Web Server, use the instructions from the <em class="citetitle">JBoss Enterprise Web Server Installation Guide</em>.
			</div></li><li class="listitem"><div class="para">
				You must be logged in with administrative (root) privileges.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978528342928">
      ⁠</a><p class="title"><strong>Procedure 17.17. Red Hat Enterprise Linux 5: mod_jk with Apache HTTP Server 2.2.3</strong></p><ol class="1"><li class="step"><div class="para">
				Install mod_jk-ap22 1.2.37 and its dependency mod_perl from the <code class="literal">jbappplatform-6-ARCHITECTURE-server-5-rpm</code> channel:
			</div><pre class="programlisting">yum install mod_jk
</pre></li><li class="step"><div class="para">
				<span class="bold bold"><strong>Optional:</strong></span> Copy the sample configuration files for use:
			</div><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/mod_jk.conf.sample /etc/httpd/conf.d/mod_jk.conf
</pre><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/workers.properties.sample /etc/httpd/conf/workers.properties
</pre><div class="para">
				These files should be edited to suit your needs.
			</div></li><li class="step"><div class="para">
				Start the server:
			</div><pre class="programlisting">service httpd start
</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The following error message indicates that your mod_jk module had been loaded before mod_perl was present:
		</div><pre class="programlisting">Cannot load /etc/httpd/modules/mod_jk.so into server: /etc/httpd/modules/mod_jk.so: undefined symbol: ap_get_server_description
</pre><div class="para">
			To ensure mod_perl module is loaded before mod_jk module add the following to the <code class="filename">/etc/httpd/conf.d/mod_jk.conf</code>:
		</div><pre class="programlisting"> &lt;IfModule !perl_module&gt;
        LoadModule perl_module modules/mod_perl.so
&lt;/IfModule&gt;
LoadModule jk_module modules/mod_jk.so</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978502450000">
      ⁠</a><p class="title"><strong>Procedure 17.18. Red Hat Enterprise Linux 5: mod_jk with JBoss EAP Apache HTTP Server 2.2.26</strong></p><ol class="1"><li class="step"><div class="para">
				Install both mod_jk and the latest Apache HTTP Server 2.2.26 provided by the <code class="literal">jbappplatform-6-ARCHITECTURE-server-5-rpm</code> channel with this command:
			</div><pre class="programlisting">yum install mod_jk httpd
</pre></li><li class="step"><div class="para">
				<span class="bold bold"><strong>Optional:</strong></span> Copy the sample configuration files for use:
			</div><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/mod_jk.conf.sample /etc/httpd/conf.d/mod_jk.conf
</pre><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/workers.properties.sample /etc/httpd/conf/workers.properties
</pre><div class="para">
				These files should be edited to suit your needs.
			</div></li><li class="step"><div class="para">
				Start the server:
			</div><pre class="programlisting">service httpd start
</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978495397680">
      ⁠</a><p class="title"><strong>Procedure 17.19. Red Hat Enterprise Linux 6: mod_jk with JBoss EAP Apache HTTP Server 2.2.26</strong></p><ol class="1"><li class="step"><div class="para">
				Install mod_jk-ap22 1.2.37 and Apache HTTP Server 2.2.26 httpd package from the <code class="literal">jbappplatform-6-ARCHITECTURE-server-6-rpm</code> channel (any existing versions will be updated):
			</div><pre class="programlisting">yum install mod_jk httpd
</pre></li><li class="step"><div class="para">
				<span class="bold bold"><strong>Optional:</strong></span> Copy the sample configuration files for use:
			</div><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/mod_jk.conf.sample /etc/httpd/conf.d/mod_jk.conf
</pre><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/workers.properties.sample /etc/httpd/conf/workers.properties
</pre><div class="para">
				These files should be edited to suit your needs.
			</div></li><li class="step"><div class="para">
				Start the server:
			</div><pre class="programlisting">service httpd start
</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978515684368">
      ⁠</a><p class="title"><strong>Procedure 17.20. Red Hat Enterprise Linux 6: mod_jk with Apache HTTP Server 2.2.15</strong></p><ol class="1"><li class="step"><div class="para">
				Install mod_jk with Apache HTTP Server 2.2.15 with the following command:
			</div><pre class="programlisting">yum install mod_jk
</pre></li><li class="step"><div class="para">
				<span class="bold bold"><strong>Optional:</strong></span> Copy the sample configuration files for use:
			</div><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/mod_jk.conf.sample /etc/httpd/conf.d/mod_jk.conf
</pre><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/workers.properties.sample /etc/httpd/conf/workers.properties
</pre><div class="para">
				These files should be edited to suit your needs.
			</div></li><li class="step"><div class="para">
				Start the server:
			</div><pre class="programlisting">service httpd start
</pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978547813904">
      ⁠</a><p class="title"><strong>Procedure 17.21. Red Hat Enterprise Linux 7: mod_jk with JBoss EAP Apache HTTP Server 2.2.26</strong></p><ol class="1"><li class="step"><div class="para">
				Install mod_jk-ap22 1.2.37 and Apache HTTP Server 2.2.26 httpd22 package from the <code class="literal">jbappplatform-6-ARCHITECTURE-server-6-rpm</code> channel (any existing versions will be updated):
			</div><pre class="programlisting">yum install mod_jk
</pre></li><li class="step"><div class="para">
				<span class="bold bold"><strong>Optional:</strong></span> Copy the sample configuration files for use:
			</div><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/mod_jk.conf.sample /etc/httpd22/conf.d/mod_jk.conf
</pre><pre class="programlisting">cp /usr/share/doc/mod_jk-ap22-1.2.37/workers.properties.sample /etc/httpd22/conf/workers.properties
</pre><div class="para">
				These files should be edited to suit your needs.
			</div></li><li class="step"><div class="para">
				Start the server:
			</div><pre class="programlisting">systemctl start httpd22.service
</pre></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+24379-767305+%5BLatest%5D&amp;comment=Title%3A+Install+the+mod_jk+Module+Into+the+Apache+HTTP+Server+%28RPM%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=24379-767305+12+Aug+2015+18%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuration_Reference_for_Apache_Mod_jk_Workers">
      ⁠</a>17.7.5. Configuration Reference for Apache mod_jk Workers</h2></div></div></div><div class="para">
		The <code class="filename">workers.properties</code> file defines the behavior of the workers which mod_jk passes client requests to. In Red Hat Enterprise Linux, the file resides in <code class="filename">/etc/httpd/conf/workers.properties</code>. The <code class="filename">workers.properties</code> file defines where the different application servers are located, and the way the work load should be balanced across them.
	</div><div class="para">
		The configuration is divided into three sections. The first section deals with global properties, which apply to all workers. The second section contains settings which apply to a specific Load Balancer. The third section contains settings which apply to a specific worker node balanced by the Load Balancer.
	</div><div class="para">
		The general structure of a property is <code class="literal">worker.<em class="replaceable">WORKER_NAME</em>.<em class="replaceable">DIRECTIVE</em></code>, where <em class="replaceable">WORKER_NAME</em> is a unique name for the worker, and <em class="replaceable">DIRECTIVE</em> is the setting to be applied to the worker.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuration reference for Apache mod_jk Load Balancers</div>
			Templates specify default per-Load Balancer settings. You can override the template within the Load Balancer settings itself. You can see an example of Load Balancer templates in <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#example_workers.properties">Example 17.7, “Example <code class="filename">workers.properties</code> file”</a>.
		</div><div class="table"><a id="idm139978510970976">
      ⁠</a><p class="title"><strong>Table 17.15. Global properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Global properties"><colgroup><col width="25%" style="text-align: left" class="c1"/><col width="75%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> worker.list </td><td style="text-align: left"> The list of Load Balancers names used by mod_jk. These Load Balancers are available to receive requests. </td></tr></tbody></table></div></div><div class="table"><a id="idm139978450940480">
      ⁠</a><p class="title"><strong>Table 17.16. Mandatory Directives</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Mandatory Directives"><colgroup><col width="25%" style="text-align: left" class="c1"/><col width="75%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> type </td><td style="text-align: left"> <div class="para">
						The type of the Load Balancer. The default type is <code class="literal">ajp13</code>. Other possible values are <code class="literal">ajp14</code>, <code class="literal">lb</code>, <code class="literal">status</code>.
					</div>
					 <div class="para">
						For more information on these directives, refer to the Apache Tomcat Connector AJP Protocol Reference at <a href="http://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html">http://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html</a>.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm139978529870848">
      ⁠</a><p class="title"><strong>Table 17.17. Load Balancing Directives</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Load Balancing Directives"><colgroup><col width="25%" style="text-align: left" class="c1"/><col width="75%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> balance_workers </td><td style="text-align: left"> <div class="para">
						Specifies the worker nodes that the load balancer must manage. You can use the directive multiple times for the same load balancer. It consists of a comma-separated list of worker node names. This is set per Load Balancer, not per worker node.
					</div>
					 </td></tr><tr><td style="text-align: left"> sticky_session </td><td style="text-align: left"> <div class="para">
						Specifies whether requests from the same session are always routed to the same worker. The default is <code class="literal">1</code>, meaning that sticky sessions are enabled. To disable sticky sessions, set it to <code class="literal">0</code>. Sticky sessions should usually be enabled, unless all of your requests are truly stateless. This is set per Load Balancer, not per worker node.
					</div>
					 </td></tr></tbody></table></div></div><div class="table"><a id="idm139978456604688">
      ⁠</a><p class="title"><strong>Table 17.18. Connection Directives</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Connection Directives"><colgroup><col width="25%" style="text-align: left" class="c1"/><col width="75%" style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left"> Property </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> host </td><td style="text-align: left"> <div class="para">
						The hostname or IP address of the Load Balancer. The Load Balancer must support the <code class="literal">ajp</code> protocol stack. The default value is <code class="literal">localhost</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> port </td><td style="text-align: left"> <div class="para">
						The port number of the remote server instance listening for defined protocol requests. The default value is <code class="literal">8009</code>, which is the default listening port for AJP13 Load Balancers. The default value for AJP14 Load Balancers is <code class="literal">8011</code>.
					</div>
					 </td></tr><tr><td style="text-align: left"> ping_mode </td><td style="text-align: left"> <div class="para">
						The conditions under which connections are probed for network status. The probe uses an empty AJP13 packet for CPing, and expects a CPong in response. Specify the conditions by using a combination of directive flags. The flags are not separated by a comma or any white-space. The ping_mode can be any combination of <code class="literal">C</code>, <code class="literal">P</code>, <code class="literal">I</code>, and <code class="literal">A</code>.
					</div>
					 <div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">C</code> - Connect. Probe the connection one time after connecting to the server. Specify the timeout using the value of <code class="code">connect_timeout</code>. Otherwise, the value of <code class="code">ping_timeout</code> is used.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">P</code> - Prepost. Probe the connection before sending each request to the server. Specify the timeout using the <code class="code">prepost_timeout</code> directive. Otherwise, the value of <code class="code">ping_timeout</code> is used.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">I</code> - Interval. Probe the connection at an interval specified by <code class="code">connection_ping_interval</code>, if present. Otherwise, the value of <code class="code">ping_timeout</code> is used.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">A</code> - All. A shortcut for <code class="literal">CPI</code>, which specifies that all connection probes are used.
							</div></li></ul></div>
					 </td></tr><tr><td style="text-align: left"> ping_timeout, connect_timeout, prepost_timeout, connection_ping_interval </td><td style="text-align: left"> <div class="para">
						The timeout values for the connection probe settings above. The value is specified in milliseconds, and the default value for <code class="code">ping_timeout</code> is 10000.
					</div>
					 </td></tr><tr><td style="text-align: left"> lbfactor </td><td style="text-align: left"> <div class="para">
						Specifies the load-balancing factor for an individual Load Balancer, and only applies to a member worker node of a load balancer. This is useful to give a more powerful server more of the work load. To give a worker 3 times the default load, set this to <code class="literal">3</code>: <code class="literal">worker.my_worker.lbfactor=3</code>
					</div>
					 </td></tr></tbody></table></div></div><div class="example"><a id="example_workers.properties">
      ⁠</a><p class="title"><strong>Example 17.7. Example <code class="filename">workers.properties</code> file</strong></p><div class="example-contents"><pre class="programlisting">
worker.balancer1.type=lb
worker.balancer2.type=lb

worker.balancer1.sticky_sessions=1
worker.balancer1.balance_workers=node1
worker.balancer2.sticky_session=1
worker.balancer2.balance_workers=node2,node3

worker.nodetemplate.type=ajp13
worker.nodetemplate.port=8009

worker.node1.template=nodetemplate
worker.node1.host=localhost
worker.node1.ping_mode=CI
worker.node1.connection_ping_interval=9000
worker.node1.lbfactor=1

worker.node2.template=nodetemplate
worker.node2.host=192.168.1.1
worker.node2.ping_mode=A

worker.node3.template=nodetemplate
worker.node3.host=192.168.1.2
</pre></div></div><div class="para">
		The example above demonstrates the use of multiple Load Balancers to serve the content on behalf of a web server. The reasons for such configuration can be: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					To have different contexts to be served by different Load Balancers, providing a development environment in which all the developers share the same web server but own a Load Balancer of their own.
				</div></li><li class="listitem"><div class="para">
					To have different virtual hosts served by different processes, providing a clear separation between sites belonging to different companies.
				</div></li><li class="listitem"><div class="para">
					To provide load balancing, that is, run multiple Load Balancers each on its own machine and divide the requests between them.
				</div></li></ul></div>
		 Further configuration details for Apache mod_jk are out of the scope of this document. Refer to the Apache documentation at <a href="http://tomcat.apache.org/connectors-doc/">http://tomcat.apache.org/connectors-doc/</a> for further instructions.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4699-766644+%5BLatest%5D&amp;comment=Title%3A+Configuration+Reference+for+Apache+mod_jk+Workers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4699-766644+04+Aug+2015+07%3A44+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Apache_mod_proxy">
      ⁠</a>17.8. Apache mod_proxy</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Apache_mod_proxy_HTTP_Connector1">
      ⁠</a>17.8.1. About the Apache mod_proxy HTTP Connector</h2></div></div></div><div class="para">
		Apache provides two different proxying and load balancing modules for its httpd: <code class="systemitem">mod_proxy</code> and <code class="systemitem">mod_jk</code>. To learn more about <code class="systemitem">mod_jk</code>, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Apache_mod_jk_HTTP_Connector">Section 17.7.1, “About the Apache mod_jk HTTP Connector”</a>. JBoss EAP 6 supports use of either of these, although <code class="systemitem">mod_cluster</code>, the JBoss HTTP connector, more closely couples JBoss EAP 6 and the external httpd, and is the recommended HTTP connector. Refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Overview_of_HTTP_Connectors">Section 17.2.3, “Overview of HTTP Connectors”</a> for an overview of all supported HTTP connectors, including advantages and disadvantages.
	</div><div class="para">
		Unlike <code class="systemitem">mod_jk</code>, <code class="systemitem">mod_proxy</code> supports connections over HTTP and HTTPS protocols. Each of them also support the AJP protocol.
	</div><div class="para">
		<code class="systemitem">mod_proxy</code> can be configured in standalone or load-balanced configurations, and it supports the notion of sticky sessions.
	</div><div class="para">
		The <code class="systemitem">mod_proxy</code> module requires JBoss EAP 6 to have the HTTP, HTTPS or AJP web connector configured. This is part of the Web subsystem. Refer to <a class="xref" href="chap-Web_Subsystem.html#Configure_the_Web_Subsystem1">Section 15.1, “Configure the Web Subsystem”</a> for information on configuring the Web subsystem.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			<code class="code">mod_cluster</code> is a more advanced load balancer than <code class="code">mod_proxy</code>. <code class="code">mod_cluster</code> provides all of the functionality of <code class="code">mod_proxy</code> and additional features. For more information about <code class="code">mod_cluster</code>, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Modcluster_HTTP_Connector">Section 17.6.1, “About the <code class="code">mod_cluster</code> HTTP Connector”</a>.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5244-747801+%5BLatest%5D&amp;comment=Title%3A+About+the+Apache+mod_proxy+HTTP+Connector%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5244-747801+19+Mar+2015+01%3A02+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Install_the_Mod_proxy_HTTP_Connector_Into_Apache_HTTPD">
      ⁠</a>17.8.2. Install the mod_proxy HTTP Connector into Apache HTTP Server</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			<code class="systemitem">mod_proxy</code> is a load-balancing module provided by Apache. This task presents a basic configuration. For more advanced configuration, or additional details, see Apache's <code class="systemitem">mod_proxy</code> documentation at <a href="https://httpd.apache.org/docs/2.2/mod/mod_proxy.html">https://httpd.apache.org/docs/2.2/mod/mod_proxy.html</a>. For more details about <code class="systemitem">mod_proxy</code> from the perspective of JBoss EAP 6, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#About_the_Apache_mod_proxy_HTTP_Connector1">Section 17.8.1, “About the Apache mod_proxy HTTP Connector”</a> and <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Overview_of_HTTP_Connectors">Section 17.2.3, “Overview of HTTP Connectors”</a>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Apache HTTP server either from JBoss Enterprise Web Server or provided by operating system needs to be installed. A standalone Apache HTTP server is provided as a separate download in the Red Hat Customer Portal, in the JBoss EAP 6 download area. See <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Install_the_Apache_HTTPD_included_with_JBoss_Enterprise_Application_Platform_61">Section 17.4.3, “Install Apache HTTP Server in Red Hat Enterprise Linux 5, 6, and 7 (Zip)”</a> for information about this Apache HTTP server if you wish to use it.
			</div></li><li class="listitem"><div class="para">
				The <code class="systemitem">mod_proxy</code> modules need to be installed. Apache HTTP server typically comes with the <code class="systemitem">mod_proxy</code> modules already included. This is the case on Red Hat Enterprise Linux and the Apache HTTP Server that comes with the JBoss Enterprise Web Server.
			</div></li><li class="listitem"><div class="para">
				You need <code class="systemitem">root</code> or administrator privileges to modify the Apache HTTP Server configuration.
			</div></li><li class="listitem"><div class="para">
				In our example we assume that JBoss EAP 6 is configured with the HTTP or HTTPS web connector. This is part of the Web subsystem configuration. Refer to <a class="xref" href="chap-Web_Subsystem.html#Configure_the_Web_Subsystem1">Section 15.1, “Configure the Web Subsystem”</a> for information about configuring the Web subsystem.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Enable the <code class="systemitem">mod_proxy</code> modules in the httpd</strong></p><div class="para">
				Look for the following lines in your <code class="filename"><em class="replaceable">HTTPD_CONF</em>/httpd.conf</code> file. If they are not present, add them to the bottom. If they are present but the lines begin with a comment (#) character, remove the character. Save the file afterward. Usually, the modules are already present and enabled.
			</div><pre class="screen">
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_http_module modules/mod_proxy_http.so
# Uncomment these to proxy FTP or HTTPS
#LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
#LoadModule proxy_connect_module modules/mod_proxy_connect.so
</pre></li><li class="step"><p class="title"><strong>Add a non-load-balancing proxy.</strong></p><div class="para">
				Add the following configuration to your <code class="filename"><em class="replaceable">HTTPD_CONF</em>/httpd.conf</code> file, directly beneath any other <code class="sgmltag-element">&lt;VirtualHost&gt;</code> directives you may have. Replace the values with ones appropriate to your setup.
			</div><div class="para">
				This example uses a virtual host. See the next step to use the default httpd configuration.
			</div><pre class="screen">
&lt;VirtualHost *:80&gt;
# Your domain name
ServerName Domain_NAME_HERE

ProxyPreserveHost On

# The IP and port of JBoss EAP 6
# These represent the default values, if your httpd is on the same host
# as your JBoss EAP 6 managed domain or server

ProxyPass / http://localhost:8080/
ProxyPassReverse / http://localhost:8080/

# The location of the HTML files, and access control information
DocumentRoot /var/www
&lt;Directory /var/www&gt;
Options -Indexes
Order allow,deny
Allow from all
&lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre><div class="para">
				After making your changes, save the file.
			</div></li><li class="step"><p class="title"><strong>Add a load-balancing proxy.</strong></p><div class="para">
				To use <code class="systemitem">mod_proxy</code> as a load balancer, and send work to multiple JBoss EAP 6 instances, add the following configuration to your <code class="filename"><em class="replaceable">HTTPD_CONF</em>/httpd.conf</code> file. The example IP addresses are fictional. Replace them with the appropriate values for your environment.
			</div><pre class="screen">
&lt;Proxy balancer://mycluster&gt;

Order deny,allow
Allow from all

# Add each JBoss Enterprise Application Server by IP address and port.
# If the route values are unique like this, one node will not fail over to the other.
BalancerMember http://192.168.1.1:8080 route=node1
BalancerMember http://192.168.1.2:8180 route=node2
&lt;/Proxy&gt;

&lt;VirtualHost *:80&gt;
 # Your domain name
 ServerName YOUR_DOMAIN_NAME

 ProxyPreserveHost On
 ProxyPass / balancer://mycluster/

 # The location of the HTML files, and access control information DocumentRoot /var/www
 &lt;Directory /var/www&gt;
  Options -Indexes
  Order allow,deny
  Allow from all
 &lt;/Directory&gt;

&lt;/VirtualHost&gt;
</pre><div class="para">
				The examples above all communicate using the HTTP protocol. You can use AJP or HTTPS protocols instead, if you load the appropriate <code class="systemitem">mod_proxy</code> modules. Refer to Apache's <code class="systemitem">mod_proxy</code> documentation <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html">http://httpd.apache.org/docs/2.2/mod/mod_proxy.html</a> for more details.
			</div></li><li class="step"><p class="title"><strong>Enable sticky sessions.</strong></p><div class="para">
				<em class="firstterm">Sticky sessions</em> mean that if a client request originally goes to a specific JBoss EAP 6 worker, all future requests will be sent to the same worker, unless it becomes unavailable. This is almost always the correct behavior.
			</div><div class="para">
				To enable sticky sessions for <code class="systemitem">mod_proxy</code>, add the <code class="code">stickysession</code> parameter to the <code class="literal">ProxyPass</code> statement. This example also shows some other parameters which you can use. See Apache's <code class="systemitem">mod_proxy</code> documentation at <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html">http://httpd.apache.org/docs/2.2/mod/mod_proxy.html</a> for more information on them.
			</div><pre class="screen">ProxyPass /MyApp balancer://mycluster stickysession=JSESSIONID lbmethod=bytraffic nofailover=Off</pre></li><li class="step"><p class="title"><strong>Restart the Web Server.</strong></p><div class="para">
				Restart the web server for your changes to take effect.
			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Your Apache HTTP server is configured to use <code class="systemitem">mod_proxy</code> to send client requests to JBoss EAP 6 instances, either in a standard or load-balancing configuration. To configure JBoss EAP 6 to respond to these requests, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+5216-766646+%5BLatest%5D&amp;comment=Title%3A+Install+the+mod_proxy+HTTP+Connector+into+Apache+HTTP+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=5216-766646+04+Aug+2015+07%3A50+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Microsoft_ISAPI_Connector">
      ⁠</a>17.9. Microsoft ISAPI Connector</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Internet_Server_API_ISAPI_HTTP_Connector">
      ⁠</a>17.9.1. About the Internet Server API (ISAPI)</h2></div></div></div><div class="para">
		<em class="firstterm">Internet Server API (ISAPI)</em> is a set of APIs used to write OLE Server extensions and filters for Web servers such as Microsoft's Internet Information Services (IIS). <code class="filename">isapi_redirect.dll</code> is an extension of <code class="filename">mod_jk</code> adjusted to IIS. <code class="filename">isapi_redirect.dll</code> enables you to configure JBoss EAP 6 instances as a worker nodes with an IIS as load balancer. 
	</div><div class="para">

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4672-744998+%5BLatest%5D&amp;comment=Title%3A+About+the+Internet+Server+API+%28ISAPI%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4672-744998+26+Feb+2015+06%3A04+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Download_and_Extract_the_Webserver_Connector_Natives_for_Windows_Server">
      ⁠</a>17.9.2. Download and Extract Webserver Connector Natives for Microsoft IIS</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
				In a web browser, navigate to the Red Hat Customer Support portal at <a href="https://access.redhat.com">https://access.redhat.com</a>.
			</div></li><li class="step"><div class="para">
				Navigate to <span class="guilabel"><strong>Downloads</strong></span>, then <span class="guilabel"><strong>Red Hat JBoss Middleware Download Software</strong></span>, then select <span class="guilabel"><strong>Enterprise Application Platform</strong></span> from the <span class="guilabel"><strong>Product</strong></span> drop-down list.
			</div></li><li class="step"><div class="para">
				Select the appropriate version from the <span class="guilabel"><strong>Version</strong></span> drop-down list.
			</div></li><li class="step"><div class="para">
				Choose the <span class="guilabel"><strong>Download</strong></span> option of either <span class="guilabel"><strong>Red Hat JBoss Enterprise Application Platform <em class="replaceable">&lt;VERSION&gt;</em> Webserver Connector Natives for Windows Server 2008 x86_64</strong></span> or <span class="guilabel"><strong>Red Hat JBoss Enterprise Application Platform <em class="replaceable">&lt;VERSION&gt;</em> Webserver Connector Natives for Windows Server 2008 i686</strong></span> depending on the architecture of the server.
			</div></li><li class="step"><div class="para">
				Open the Zip file and copy the contents of the <code class="filename">jboss-eap-<em class="replaceable">&lt;VERSION&gt;</em>/modules/system/layers/base/native/sbin</code> directory to a location on your server. It is assumed the contents were copied to <code class="filename">C:\connectors\</code>.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31261-737048+%5BLatest%5D&amp;comment=Title%3A+Download+and+Extract+Webserver+Connector+Natives+for+Microsoft+IIS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31261-737048+19+Jan+2015+10%3A45+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Microsoft_IIS_to_Use_the_ISAPI_Redirector1">
      ⁠</a>17.9.3. Configure Microsoft IIS to Use the ISAPI Connector</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist prereqs-list"><p class="title"><strong>Prerequisites:</strong></p><ul class="prereqs-list prereqs-list"><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Download_and_Extract_the_Webserver_Connector_Natives_for_Windows_Server">Section 17.9.2, “Download and Extract Webserver Connector Natives for Microsoft IIS”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			See <a href="https://access.redhat.com/articles/111663">https://access.redhat.com/articles/111663</a> for a list of supported configurations of Microsoft Windows Server and IIS.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-4763_configure_iis7">
      ⁠</a><p class="title"><strong>Procedure 17.22. Configure the IIS Redirector Using the IIS Manager (IIS 7)</strong></p><ol class="1"><li class="step"><div class="para">
				Open the IIS manager by clicking <span class="guimenu"><strong>Start</strong></span> → <span class="guimenuitem"><strong>Run</strong></span>, and typing <code class="command">inetmgr</code>.
			</div></li><li class="step"><div class="para">
				In the tree view pane at the left, expand <span class="guilabel"><strong>IIS 7</strong></span>.
			</div></li><li class="step"><div class="para">
				Double-click <span class="guilabel"><strong>ISAPI and CGI Registrations</strong></span> to open it in a new window.
			</div></li><li class="step"><div class="para">
				In the <span class="guilabel"><strong>Actions</strong></span> pane, click <span class="guilabel"><strong>Add</strong></span>. The <span class="guilabel"><strong>Add ISAPI or CGI Restriction</strong></span> window opens.
			</div></li><li class="step"><div class="para">
				Specify the following values:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="guilabel"><strong>ISAPI or CGI Path</strong></span>: <code class="literal">c:\connectors\isapi_redirect.dll</code>
					</div></li><li class="listitem"><div class="para">
						<span class="guilabel"><strong>Description</strong></span>: <code class="literal">jboss</code>
					</div></li><li class="listitem"><div class="para">
						<span class="guilabel"><strong>Allow extension path to execute</strong></span>: select the check box.
					</div></li></ul></div></li><li class="step"><div class="para">
				Click <span class="guilabel"><strong>OK</strong></span> to close the <span class="guilabel"><strong>Add ISAPI or CGI Restriction</strong></span> window.
			</div></li><li class="step"><p class="title"><strong>Define a JBoss Native virtual directory</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Right-click <span class="guilabel"><strong>Default Web Site</strong></span>, and click <span class="guilabel"><strong>Add Virtual Directory</strong></span>. The <span class="guilabel"><strong>Add Virtual Directory</strong></span> window opens.
					</div></li><li class="step"><div class="para">
						Specify the following values to add a virtual directory:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="guilabel"><strong>Alias</strong></span>: <code class="literal">jboss</code>
							</div></li><li class="listitem"><div class="para">
								<span class="guilabel"><strong>Physical Path</strong></span>: <code class="literal">C:\connectors\</code>
							</div></li></ul></div></li><li class="step"><div class="para">
						Click <span class="guilabel"><strong>OK</strong></span> to save the values and close the <span class="guilabel"><strong>Add Virtual Directory</strong></span> window.
					</div></li></ol></li><li class="step"><p class="title"><strong>Define a JBoss Native ISAPI Redirect Filter</strong></p><ol class="substeps a"><li class="step"><div class="para">
						In the tree view pane, expand <span class="guimenu"><strong>Sites</strong></span> → <span class="guimenuitem"><strong>Default Web Site</strong></span>.
					</div></li><li class="step"><div class="para">
						Double-click <span class="guilabel"><strong>ISAPI Filters</strong></span>. The <span class="guilabel"><strong>ISAPI Filters Features</strong></span> view appears.
					</div></li><li class="step"><div class="para">
						In the <span class="guilabel"><strong>Actions</strong></span> pane, click <span class="guilabel"><strong>Add</strong></span>. The <span class="guilabel"><strong>Add ISAPI Filter</strong></span> window appears.
					</div></li><li class="step"><div class="para">
						Specify the following values in the <span class="guilabel"><strong>Add ISAPI Filter</strong></span> window:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="guilabel"><strong>Filter name</strong></span>: <code class="literal">jboss</code>
							</div></li><li class="listitem"><div class="para">
								<span class="guilabel"><strong>Executable</strong></span>: <code class="literal">C:\connectors\isapi_redirect.dll</code>
							</div></li></ul></div></li><li class="step"><div class="para">
						Click <span class="guilabel"><strong>OK</strong></span> to save the values and close the <span class="guilabel"><strong>Add ISAPI Filters</strong></span> window.
					</div></li></ol></li><li class="step"><p class="title"><strong>Enable the ISAPI-dll handler</strong></p><ol class="substeps a"><li class="step"><div class="para">
						Double-click the <span class="guilabel"><strong>IIS 7</strong></span> item in the tree view pane. The <span class="guilabel"><strong>IIS 7 Home Features View</strong></span> opens.
					</div></li><li class="step"><div class="para">
						Double-click <span class="guilabel"><strong>Handler Mappings</strong></span>. The <span class="guilabel"><strong>Handler Mappings Features View</strong></span> appears.
					</div></li><li class="step"><div class="para">
						In the <span class="guilabel"><strong>Group by</strong></span> combo box, select <span class="guilabel"><strong>State</strong></span>. The <span class="guilabel"><strong>Handler Mappings</strong></span> are displayed in <span class="guilabel"><strong>Enabled and Disabled Groups</strong></span>.
					</div></li><li class="step"><div class="para">
						Find <span class="guilabel"><strong>ISAPI-dll</strong></span>. If it is in the <span class="guilabel"><strong>Disabled</strong></span> group, right-click it and select <span class="guilabel"><strong>Edit Feature Permissions</strong></span>.
					</div></li><li class="step"><div class="para">
						Enable the following permissions:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								Read
							</div></li><li class="listitem"><div class="para">
								Script
							</div></li><li class="listitem"><div class="para">
								Execute
							</div></li></ul></div></li><li class="step"><div class="para">
						Click <span class="guilabel"><strong>OK</strong></span> to save the values, and close the <span class="guilabel"><strong>Edit Feature Permissions</strong></span> window.
					</div></li></ol></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			Microsoft IIS is now configured to use the ISAPI Connector. Next, <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>, then <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_ISAPI_Redirector_to_Send_Client_Requests_to_the_Enterprise_Application_Platform">Section 17.9.4, “Configure the ISAPI Connector to Send Client Requests to JBoss EAP 6”</a> or <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_ISAPI_to_Balance_Client_Requests_Across_Multiple_Enterprise_Application_Platform_Servers">Section 17.9.5, “Configure the ISAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers”</a>.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4673-767772+%5BLatest%5D&amp;comment=Title%3A+Configure+Microsoft+IIS+to+Use+the+ISAPI+Connector%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4673-767772+19+Aug+2015+08%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_ISAPI_Redirector_to_Send_Client_Requests_to_the_Enterprise_Application_Platform">
      ⁠</a>17.9.4. Configure the ISAPI Connector to Send Client Requests to JBoss EAP 6</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			This task configures a group of JBoss EAP 6 servers to accept requests from the ISAPI connector. It does not include configuration for load-balancing or high-availability failover. If you need these capabilities, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_ISAPI_to_Balance_Client_Requests_Across_Multiple_Enterprise_Application_Platform_Servers">Section 17.9.5, “Configure the ISAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers”</a>.
		</div><div class="para">
		This configuration is done on the IIS server, and assumes that JBoss EAP 6 is already configured as per <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				You need full administrator access to the IIS server
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_Microsoft_IIS_to_Use_the_ISAPI_Redirector1">Section 17.9.3, “Configure Microsoft IIS to Use the ISAPI Connector”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978504384896">
      ⁠</a><p class="title"><strong>Procedure 17.23. Edit Property Files and Setup Redirection</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create a directory to store logs, property files, and lock files.</strong></p><div class="para">
				The rest of this procedure assumes that you are using the directory <code class="filename">C:\connectors\</code> for this purpose. If you use a different directory, modify the instructions accordingly.
			</div></li><li class="step"><p class="title"><strong>Create the <code class="filename">isapi_redirect.properties</code> file.</strong></p><div class="para">
				Create a new file called <code class="filename">C:\connectors\isapi_redirect.properties</code>. Copy the following contents into the file.
			</div><pre class="screen">
# Configuration file for the ISAPI Connector
# Extension uri definition
extension_uri=/jboss/isapi_redirect.dll

# Full path to the log file for the ISAPI Connector
log_file=c:\connectors\isapi_redirect.log

# Log level (debug, info, warn, error or trace)
log_level=info

# Full path to the workers.properties file
worker_file=c:\connectors\workers.properties

# Full path to the uriworkermap.properties file
worker_mount_file=c:\connectors\uriworkermap.properties

#Full path to the rewrite.properties file 
rewrite_rule_file=c:\connectors\rewrite.properties
</pre><div class="para">
				If you do not want to use a <code class="filename">rewrite.properties</code> file, comment out the last line by placing a <code class="literal">#</code> character at the beginning of the line. See <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#step_isapi_rewrite.properties">Step 5</a> for more information.
			</div></li><li class="step"><p class="title"><strong>Create the <code class="filename">uriworkermap.properties</code> file</strong></p><div class="para">
				The <code class="filename">uriworkermap.properties</code> file contains mappings between deployed application URLs and which worker handles requests to them. The following example file shows the syntax of the file. Place your <code class="filename">uriworkermap.properties</code> file into <code class="filename">C:\connectors\</code>.
			</div><pre class="screen">
# images and css files for path /status are provided by worker01
/status=worker01
/images/*=worker01
/css/*=worker01

# Path /web-console is provided by worker02
# IIS (customized) error page is used for http errors with number greater or equal to 400
# css files are provided by worker01
/web-console/*=worker02;use_server_errors=400
/web-console/css/*=worker01

# Example of exclusion from mapping, logo.gif won't be displayed  
# /web-console/images/logo.gif=*

# Requests to /app-01 or /app-01/something will be routed to worker01
/app-01|/*=worker01

# Requests to /app-02 or /app-02/something will be routed to worker02
/app-02|/*=worker02
</pre></li><li class="step"><p class="title"><strong>Create the <code class="filename">workers.properties</code> file.</strong></p><div class="para">
				The <code class="filename">workers.properties</code> file contains mapping definitions between worker labels and server instances. The following example file shows the syntax of the file. Place this file into the <code class="filename">C:\connectors\</code> directory.
			</div><pre class="screen">
# An entry that lists all the workers defined
worker.list=worker01, worker02

# Entries that define the host and port associated with these workers

# First JBoss EAP 6 server definition, port 8009 is standard port for AJP in EAP 
worker.worker01.host=127.0.0.1
worker.worker01.port=8009
worker.worker01.type=ajp13

# Second JBoss EAP 6 server definition
worker.worker02.host=127.0.0.100
worker.worker02.port=8009
worker.worker02.type=ajp13
</pre></li><li class="step"><a id="step_isapi_rewrite.properties">
      ⁠</a><p class="title"><strong>Create the <code class="filename">rewrite.properties</code> file.</strong></p><div class="para">
				The <code class="filename">rewrite.properties</code> file contains simple URL rewriting rules for specific applications. The rewritten path is specified using name-value pairs, as shown in the example below. Place this file into the <code class="filename">C:\connectors\</code> directory.
			</div><pre class="screen">
#Simple example
# Images are accessible under abc path
/app-01/abc/=/app-01/images/
</pre></li><li class="step"><p class="title"><strong>Restart the IIS server.</strong></p><div class="para">
				Restart your IIS server by using the <code class="command">net stop</code> and <code class="command">net start</code> commands.
			</div><pre class="screen">
C:\&gt; net stop was /Y
C:\&gt; net start w3svc
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The IIS server is configured to send client requests to the specific JBoss EAP 6 servers you have configured, on an application-specific basis.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4676-762438+%5BLatest%5D&amp;comment=Title%3A+Configure+the+ISAPI+Connector+to+Send+Client+Requests+to+JBoss+EAP+6%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4676-762438+19+Jun+2015+02%3A25+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_ISAPI_to_Balance_Client_Requests_Across_Multiple_Enterprise_Application_Platform_Servers">
      ⁠</a>17.9.5. Configure the ISAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			This configuration balances client requests across the JBoss EAP 6 servers you specify. If you prefer to send client requests to specific JBoss EAP 6 servers on a per-deployment basis, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_ISAPI_Redirector_to_Send_Client_Requests_to_the_Enterprise_Application_Platform">Section 17.9.4, “Configure the ISAPI Connector to Send Client Requests to JBoss EAP 6”</a> instead.
		</div><div class="para">
		This configuration is done on the IIS server, and assumes that JBoss EAP 6 is already configured as per <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Full administrator access on the IIS server.
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>
			</div></li><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_Microsoft_IIS_to_Use_the_ISAPI_Redirector1">Section 17.9.3, “Configure Microsoft IIS to Use the ISAPI Connector”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978543743200">
      ⁠</a><p class="title"><strong>Procedure 17.24. Balance Client Requests Across Multiple Servers</strong></p><ol class="1"><li class="step"><p class="title"><strong>Create a directory to store logs, property files, and lock files.</strong></p><div class="para">
				The rest of this procedure assumes that you are using the directory <code class="filename">C:\connectors\</code> for this purpose. If you use a different directory, modify the instructions accordingly.
			</div></li><li class="step"><p class="title"><strong>Create the <code class="filename">isapi_redirect.properties</code> file.</strong></p><div class="para">
				Create a new file called <code class="filename">C:\connectors\isapi_redirect.properties</code>. Copy the following contents into the file.
			</div><pre class="screen">
# Configuration file for the ISAPI Connector
# Extension uri definition
extension_uri=/jboss/isapi_redirect.dll

# Full path to the log file for the ISAPI Connector
log_file=c:\connectors\isapi_redirect.log

# Log level (debug, info, warn, error or trace)
log_level=info

# Full path to the workers.properties file
worker_file=c:\connectors\workers.properties

# Full path to the uriworkermap.properties file
worker_mount_file=c:\connectors\uriworkermap.properties

#OPTIONAL: Full path to the rewrite.properties file 
rewrite_rule_file=c:\connectors\rewrite.properties
</pre><div class="para">
				If you do not want to use a <code class="filename">rewrite.properties</code> file, comment out the last line by placing a <code class="literal">#</code> character at the beginning of the line. See <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#step_isapi_load_balance_rewrite.properties">Step 5</a> for more information.
			</div></li><li class="step"><p class="title"><strong>Create the <code class="filename">uriworkermap.properties</code> file.</strong></p><div class="para">
				The <code class="filename">uriworkermap.properties</code> file contains mappings between deployed application URLs and which worker handles requests to them. The following example file shows the syntax of the file, with a load-balanced configuration. The wildcard (<code class="literal">*</code>) character sends all requests for various URL sub-directories to the load-balancer called <code class="literal">router</code>. The configuration of the load-balancer is covered in <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#isapi_load_balancer_config">Step 4</a>.
			</div><div class="para">
				Place your <code class="filename">uriworkermap.properties</code> file into <code class="filename">C:\connectors\</code>.
			</div><pre class="screen">
# images, css files, path /status and /web-console will be
# provided by nodes defined in the load-balancer called "router"
/css/*=router
/images/*=router
/status=router
/web-console|/*=router

# Example of exclusion from mapping, logo.gif won't be displayed  
# /web-console/images/logo.gif=*

# Requests to /app-01 and /app-02 will be routed to nodes defined
# in the load-balancer called "router"
/app-01|/*=router
/app-02|/*=router

# mapping for management console, nodes in cluster can be enabled or disabled here
/jkmanager|/*=status
</pre></li><li class="step"><a id="isapi_load_balancer_config">
      ⁠</a><p class="title"><strong>Create the <code class="filename">workers.properties</code> file.</strong></p><div class="para">
				The <code class="filename">workers.properties</code> file contains mapping definitions between worker labels and server instances. The following example file shows the syntax of the file. The load balancer is configured near the end of the file, to comprise workers <code class="literal">worker01</code> and <code class="literal">worker02</code>. The <code class="filename">workers.properties</code> file follows the syntax of the same file used for Apache mod_jk configuration. For more information about the syntax of the <code class="filename">workers.properties</code> file, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configuration_Reference_for_Apache_Mod_jk_Workers">Section 17.7.5, “Configuration Reference for Apache mod_jk Workers”</a>.
			</div><div class="para">
				Place this file into the <code class="filename">C:\connectors\</code> directory.
			</div><pre class="screen">
# The advanced router LB worker
worker.list=router,status

# First EAP server definition, port 8009 is standard port for AJP in EAP
#
# lbfactor defines how much the worker will be used. 
# The higher the number, the more requests are served
# lbfactor is useful when one machine is more powerful 
# ping_mode=A – all possible probes will be used to determine that
# connections are still working

worker.worker01.port=8009
worker.worker01.host=127.0.0.1
worker.worker01.type=ajp13
worker.worker01.ping_mode=A
worker.worker01.socket_timeout=10
worker.worker01.lbfactor=3

# Second EAP server definition
worker.worker02.port=8009
worker.worker02.host=127.0.0.100
worker.worker02.type=ajp13
worker.worker02.ping_mode=A
worker.worker02.socket_timeout=10
worker.worker02.lbfactor=1

# Define the LB worker
worker.router.type=lb
worker.router.balance_workers=worker01,worker02

# Define the status worker for jkmanager
worker.status.type=status
</pre></li><li class="step"><a id="step_isapi_load_balance_rewrite.properties">
      ⁠</a><p class="title"><strong>Create the <code class="filename">rewrite.properties</code> file.</strong></p><div class="para">
				The <code class="filename">rewrite.properties</code> file contains simple URL rewriting rules for specific applications. The rewritten path is specified using name-value pairs, as shown in the example below. Place this file into the <code class="filename">C:\connectors\</code> directory.
			</div><pre class="screen">
#Simple example
# Images are accessible under abc path
/app-01/abc/=/app-01/images/
</pre></li><li class="step"><p class="title"><strong>Restart the IIS server.</strong></p><div class="para">
				Restart your IIS server by using the <code class="command">net stop</code> and <code class="command">net start</code> commands.
			</div><pre class="screen">
C:\&gt; net stop was /Y
C:\&gt; net start w3svc
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The IIS server is configured to send client requests to the JBoss EAP 6 servers referenced in the <code class="filename">workers.properties</code> file, spreading the load across the servers in a 1:3 ratio. This ratio is derived from the load balancing factor (<code class="code">lbfactor</code>) assigned to each server.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4677-762443+%5BLatest%5D&amp;comment=Title%3A+Configure+the+ISAPI+Connector+to+Balance+Client+Requests+Across+Multiple+JBoss+EAP+6+Servers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4677-762443+19+Jun+2015+02%3A34+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Oracle_NSAPI_Connector">
      ⁠</a>17.10. Oracle NSAPI Connector</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_the_Netscape_Server_API_NSAPI_HTTP_Connector1">
      ⁠</a>17.10.1. About the Netscape Server API (NSAPI)</h2></div></div></div><div class="para">
		<em class="firstterm">Netscape Server API (NSAPI)</em> is an API provided by Oracle iPlanet Web Server (formerly Netscape Web Server) for implementing extensions to the server. These extensions are known as server plugins. This API is used in <code class="literal">nsapi_redirector.so</code> provided by JBoss EAP 6 in <code class="literal">Native utilities</code> packages. To configure this connector, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_NSAPI_as_a_Load-balancing_Cluster1">Section 17.10.4, “Configure the NSAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers”</a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4679-748777+%5BLatest%5D&amp;comment=Title%3A+About+the+Netscape+Server+API+%28NSAPI%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4679-748777+26+Mar+2015+05%3A03+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_NSAPI_Connector_on_Oracle_Solaris1">
      ⁠</a>17.10.2. Configure the NSAPI Connector on Oracle Solaris</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			The NSAPI connector is a module that runs within Oracle iPlanet Web Server.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				Your server is running Oracle Solaris 10 or greater, on either an Intel 32-bit, an Intel 64-bit, or a SPARC64 architecture.
			</div></li><li class="listitem"><div class="para">
				Oracle iPlanet Web Server 7.0.15 or later for Intel architectures, or 7.0.14 or later for SPARC architectures, is installed and configured, aside from the NSAPI connector.
			</div></li><li class="listitem"><div class="para">
				JBoss EAP 6 is installed and configured on each server which will serve as a worker. Refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_Enterprise_Application_Platform_to_Accept_Requests_From_an_External_HTTPD1">Section 17.4.8, “Configure JBoss EAP 6 to Accept Requests From External Web Servers”</a>.
			</div></li><li class="listitem"><div class="para">
				The JBoss Native Components ZIP package is downloaded from the Customer Service Portal at <a href="https://access.redhat.com">https://access.redhat.com</a>.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978513920176">
      ⁠</a><p class="title"><strong>Procedure 17.25. Extract and Setup the NSAPI Connector</strong></p><ol class="1"><li class="step"><p class="title"><strong>Extract the JBoss Native Components package.</strong></p><div class="para">
				The rest of this procedure assumes that the Native Components package is extracted to the <em class="replaceable">EAP_HOME</em> directory. For the rest of this procedure, the directory <code class="filename">/opt/oracle/webserver7/config/</code> is referred to as <em class="replaceable">IPLANET_CONFIG</em>. If your Oracle iPlanet configuration directory is different, modify the procedure accordingly.
			</div></li><li class="step"><p class="title"><strong>Disable servlet mappings.</strong></p><div class="para">
				Open the <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/default.web.xml</code> file and locate the section with the heading <code class="literal">Built In Server Mappings</code>. Disable the mappings to the following three servlets, by wrapping them in XML comment characters (<code class="literal">&lt;!--</code> and <code class="literal">--&gt;</code>).
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						default
					</div></li><li class="listitem"><div class="para">
						invoker
					</div></li><li class="listitem"><div class="para">
						jsp
					</div></li></ul></div><div class="para">
				The following example configuration shows the disabled mappings.
			</div><pre class="screen">&lt;!-- ============== Built In Servlet Mappings =============== --&gt;
&lt;!-- The servlet mappings for the built in servlets defined above. --&gt;
&lt;!-- The mapping for the default servlet --&gt;
&lt;!--servlet-mapping&gt;
 &lt;servlet-name&gt;default&lt;/servlet-name&gt;
 &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping--&gt;
&lt;!-- The mapping for the invoker servlet --&gt;
&lt;!--servlet-mapping&gt;
 &lt;servlet-name&gt;invoker&lt;/servlet-name&gt;
 &lt;url-pattern&gt;/servlet/*&lt;/url-pattern&gt;
&lt;/servlet-mapping--&gt;
&lt;!-- The mapping for the JSP servlet --&gt;
&lt;!--servlet-mapping&gt;
 &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
 &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
&lt;/servlet-mapping--&gt;</pre><div class="para">
				Save and exit the file.
			</div></li><li class="step"><p class="title"><strong>Configure the iPlanet Web Server to load the NSAPI connector module.</strong></p><div class="para">
				Add the following lines to the end of the <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/magnus.conf</code> file, modifying file paths to suit your configuration. These lines define the location of the <code class="filename">nsapi_redirector.so</code> module, as well as the <code class="filename">workers.properties</code> file, which lists the workers and their properties.
			</div><pre class="programlisting">Init fn="load-modules" funcs="jk_init,jk_service" shlib="<em class="replaceable">EAP_HOME</em>/modules/system/layers/base/native/lib/nsapi_redirector.so" shlib_flags="(global|now)"

Init fn="jk_init" worker_file="<em class="replaceable">IPLANET_CONFIG</em>/connectors/workers.properties" log_level="info" log_file="<em class="replaceable">IPLANET_CONFIG</em>/connectors/nsapi.log" shm_file="<em class="replaceable">IPLANET_CONFIG</em>/connectors/tmp/jk_shm"</pre><div class="para">
				The configuration above is for a 32-bit architecture. If you use 64-bit Solaris, change the string <code class="literal">lib/nsapi_redirector.so</code> to <code class="literal">lib64/nsapi_redirector.so</code>.
			</div><div class="para">
				Save and exit the file.
			</div></li><li class="step"><p class="title"><strong>Configure the NSAPI connector.</strong></p><div class="para">
				You can configure the NSAPI connector for a basic configuration, with no load balancing, or a load-balancing configuration. Choose one of the following options, after which your configuration will be complete.
			</div><div class="para">
				<div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_NSAPI_as_a_Basic_HTTP_Connector">Section 17.10.3, “Configure the NSAPI Connector to Send Client Requests to JBoss EAP 6”</a>
						</div></li><li class="listitem"><div class="para">
							<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_NSAPI_as_a_Load-balancing_Cluster1">Section 17.10.4, “Configure the NSAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers”</a>
						</div></li></ul></div>

			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4680-762463+%5BLatest%5D&amp;comment=Title%3A+Configure+the+NSAPI+Connector+on+Oracle+Solaris%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4680-762463+19+Jun+2015+03%3A06+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_NSAPI_as_a_Basic_HTTP_Connector">
      ⁠</a>17.10.3. Configure the NSAPI Connector to Send Client Requests to JBoss EAP 6</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			This task configures the NSAPI connector to redirect client requests to JBoss EAP 6 servers with no load-balancing or fail-over. The redirection is done on a per-deployment (and hence per-URL) basis. For a load-balancing configuration, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_NSAPI_as_a_Load-balancing_Cluster1">Section 17.10.4, “Configure the NSAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers”</a> instead.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				You must complete <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_NSAPI_Connector_on_Oracle_Solaris1">Section 17.10.2, “Configure the NSAPI Connector on Oracle Solaris”</a> before continuing with the current task.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978513140240">
      ⁠</a><p class="title"><strong>Procedure 17.26. Setup the Basic HTTP Connector</strong></p><ol class="1"><li class="step"><p class="title"><strong>Define the URL paths to redirect to the JBoss EAP 6 servers.</strong></p><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					In <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/obj.conf</code>, spaces are not allowed at the beginning of a line, except when the line is a continuation of the previous line.
				</div></div></div><div class="para">
				Edit the <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/obj.conf</code> file. Locate the section which starts with <code class="literal">&lt;Object name="default"&gt;</code>, and add each URL pattern to match, in the format shown by the example file below. The string <code class="literal">jknsapi</code> refers to the HTTP connector which will be defined in the next step. The example shows the use of wildcards for pattern matching.
			</div><pre class="screen">
&lt;Object name="default"&gt;
[...]
NameTrans fn="assign-name" from="/status" name="jknsapi"
NameTrans fn="assign-name" from="/images(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/css(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/nc(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/jmx-console(|/*)" name="jknsapi"
&lt;/Object&gt;
</pre></li><li class="step"><p class="title"><strong>Define the worker which serves each path.</strong></p><div class="para">
				Continue editing the <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/obj.conf</code> file. Add the following directly after the closing tag of the section you have just finished editing: <code class="literal">&lt;/Object&gt;</code>.
			</div><pre class="screen">
&lt;Object name="jknsapi"&gt;
ObjectType fn=force-type type=text/plain
Service fn="jk_service" worker="worker01" path="/status"
Service fn="jk_service" worker="worker02" path="/nc(/*)"
Service fn="jk_service" worker="worker01"
&lt;/Object&gt;
</pre><div class="para">
				The example above redirects requests to the URL path <code class="literal">/status</code> to the worker called <code class="literal">worker01</code>, and all URL paths beneath <code class="literal">/nc/</code> to the worker called <code class="literal">worker02</code>. The third line indicates that all URLs assigned to the <code class="literal">jknsapi</code> object which are not matched by the previous lines are served to <code class="literal">worker01</code>.
			</div><div class="para">
				Save and exit the file.
			</div></li><li class="step"><a id="nsapi_workers_properties_config">
      ⁠</a><p class="title"><strong>Define the workers and their attributes.</strong></p><div class="para">
				Create a file called <code class="literal">workers.properties</code> in the <code class="filename"><code class="literal">IPLANET_CONFIG</code>/connectors/</code> directory. Paste the following contents into the file, and modify them to suit your environment.
			</div><pre class="screen">
# An entry that lists all the workers defined
worker.list=worker01, worker02

# Entries that define the host and port associated with these workers
worker.worker01.host=127.0.0.1
worker.worker01.port=8009
worker.worker01.type=ajp13

worker.worker02.host=127.0.0.100
worker.worker02.port=8009
worker.worker02.type=ajp13
</pre><div class="para">
				The <code class="filename">workers.properties</code> file uses the same syntax as Apache mod_jk. For information about which options are available, refer to <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configuration_Reference_for_Apache_Mod_jk_Workers">Section 17.7.5, “Configuration Reference for Apache mod_jk Workers”</a>.
			</div><div class="para">
				Save and exit the file.
			</div></li><li class="step"><p class="title"><strong>Restart the iPlanet Web Server.</strong></p><div class="para">
				Issue the following command to restart the iPlanet Web Server.
			</div><pre class="screen">
IPLANET_CONFIG/../bin/stopserv
IPLANET_CONFIG/../bin/startserv
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			iPlanet Web Server now sends client requests to the URLs you have configured to deployments on JBoss EAP 6.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4683-762465+%5BLatest%5D&amp;comment=Title%3A+Configure+the+NSAPI+Connector+to+Send+Client+Requests+to+JBoss+EAP+6%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4683-762465+19+Jun+2015+04%3A25+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_NSAPI_as_a_Load-balancing_Cluster1">
      ⁠</a>17.10.4. Configure the NSAPI Connector to Balance Client Requests Across Multiple JBoss EAP 6 Servers</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Overview</div>
			This task configures the NSAPI connector to send client requests to JBoss EAP 6 servers in a load-balancing configuration. To use NSAPI connector as a simple HTTP connector with no load-balancing, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_NSAPI_as_a_Basic_HTTP_Connector">Section 17.10.3, “Configure the NSAPI Connector to Send Client Requests to JBoss EAP 6”</a>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
				<a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configure_the_NSAPI_Connector_on_Oracle_Solaris1">Section 17.10.2, “Configure the NSAPI Connector on Oracle Solaris”</a>
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978468940176">
      ⁠</a><p class="title"><strong>Procedure 17.27. Configure the Connector for Load-Balancing</strong></p><ol class="1"><li class="step"><p class="title"><strong>Define the URL paths to redirect to the JBoss EAP 6 servers.</strong></p><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					In <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/obj.conf</code>, spaces are not allowed at the beginning of a line, except when the line is a continuation of the previous line.
				</div></div></div><div class="para">
				Edit the <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/obj.conf</code> file. Locate the section which starts with <code class="literal">&lt;Object name="default"&gt;</code>, and add each URL pattern to match, in the format shown by the example file below. The string <code class="literal">jknsapi</code> refers to the HTTP connector which will be defined in the next step. The example shows the use of wildcards for pattern matching.
			</div><pre class="screen">
&lt;Object name="default"&gt;
[...]
NameTrans fn="assign-name" from="/status" name="jknsapi"
NameTrans fn="assign-name" from="/images(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/css(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/nc(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/jmx-console(|/*)" name="jknsapi"
NameTrans fn="assign-name" from="/jkmanager/*" name="jknsapi"   
&lt;/Object&gt;
</pre></li><li class="step"><p class="title"><strong>Define the worker that serves each path.</strong></p><div class="para">
				Continue editing the <code class="filename"><em class="replaceable">IPLANET_CONFIG</em>/obj.conf</code> file. Directly after the closing tag for the section you modified in the previous step (<code class="literal">&lt;/Object&gt;</code>), add the following new section and modify it to your needs:
			</div><pre class="screen">
&lt;Object name="jknsapi"&gt;
ObjectType fn=force-type type=text/plain
Service fn="jk_service" worker="status" path="/jkmanager(/*)"
Service fn="jk_service" worker="router"
&lt;/Object&gt;
</pre><div class="para">
				This <code class="literal">jksnapi</code> object defines the worker nodes used to serve each path that was mapped to the <code class="literal">name="jksnapi"</code> mapping in the <code class="literal">default</code> object. Everything except for URLs matching <code class="literal">/jkmanager/*</code> is redirected to the worker called <code class="literal">router</code>.
			</div></li><li class="step"><p class="title"><strong>Define the workers and their attributes.</strong></p><div class="para">
				Create a file called <code class="literal">workers.properties</code> in <code class="filename"><code class="literal">IPLANET_CONFIG</code>/connector/</code>. Paste the following contents into the file, and modify them to suit your environment.
			</div><pre class="screen">
# The advanced router LB worker
# A list of each worker
worker.list=router,status

# First JBoss EAP server
# (worker node) definition.
# Port 8009 is the standard port for AJP
#

worker.worker01.port=8009
worker.worker01.host=127.0.0.1
worker.worker01.type=ajp13
worker.worker01.ping_mode=A
worker.worker01.socket_timeout=10
worker.worker01.lbfactor=3

# Second JBoss EAP server
worker.worker02.port=8009
worker.worker02.host=127.0.0.100
worker.worker02.type=ajp13
worker.worker02.ping_mode=A
worker.worker02.socket_timeout=10
worker.worker02.lbfactor=1

# Define the load-balancer called "router"
worker.router.type=lb
worker.router.balance_workers=worker01,worker02

# Define the status worker
worker.status.type=status
</pre><div class="para">
				The <code class="filename">workers.properties</code> file uses the same syntax as Apache mod_jk. For information about which options are available, see <a class="xref" href="chap-HTTP_Clustering_and_Load_Balancing.html#Configuration_Reference_for_Apache_Mod_jk_Workers">Section 17.7.5, “Configuration Reference for Apache mod_jk Workers”</a>.
			</div><div class="para">
				Save and exit the file.
			</div></li><li class="step"><p class="title"><strong>Restart the iPlanet Web Server 7.0.</strong></p><pre class="screen">
IPLANET_CONFIG/../bin/stopserv
IPLANET_CONFIG/../bin/startserv
</pre></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			The iPlanet Web Server redirects the URL patterns you have configured to your JBoss EAP 6 servers in a load-balancing configuration.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4684-762466+%5BLatest%5D&amp;comment=Title%3A+Configure+the+NSAPI+Connector+to+Balance+Client+Requests+Across+Multiple+JBoss+EAP+6+Servers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4684-762466+19+Jun+2015+04%3A28+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>