<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 13. Infinispan</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Infinispan">
      ⁠</a>Chapter 13. Infinispan</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Infinispan1">
      ⁠</a>13.1. About Infinispan</h1></div></div></div><div class="para">
		Infinispan is a Java data grid platform. It provides a <a href="http://www.jcp.org/en/jsr/detail?id=107">JSR-107</a> compatible cache interface for managing cached data.
	</div><div class="para">
		The following Infinispan cache containers are used in JBoss Enterprise Application Platform 6:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">web</code> for Web Session Clustering
			</div></li><li class="listitem"><div class="para">
				<code class="literal">ejb</code> for Stateful Session Bean Clustering
			</div></li><li class="listitem"><div class="para">
				<code class="literal">hibernate</code> for entity caching
			</div></li><li class="listitem"><div class="para">
				<code class="literal">singleton</code> for singleton caching
			</div></li></ul></div><div class="para">
		Each cache container defines a "repl" and a "dist" cache. These caches should not be used directly by user applications.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Users can add more cache containers and caches, and reference them via JNDI. However, this is unsupported in JBoss Enterprise Application Platform 6.
		</div></div></div><div class="para">
		For more information about Infinispan functionality and configuration options see the <a href=" http://infinispan.org/docs/5.3.x/index.html"><em class="citetitle">Infinispan Documentation</em></a>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4104-675612+%5BLatest%5D&amp;comment=Title%3A+About+Infinispan%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4104-675612+23+Jun+2014+23%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Clustering_modes">
      ⁠</a>13.2. Clustering modes</h1></div></div></div><div class="para">
		Clustering can be configured in two different ways in JBoss EAP 6 using Infinispan. The correct method for your application will depend on your requirements. There is a trade off between availability, consistency, reliability and scalability with each mode. Before choosing a clustering mode, you must identify what are the most important features of your network for you, and balance those requirements.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Replicated Mode</div>
			Replicated Mode automatically detects and adds new instances on the cluster. Changes made to these instances will be replicated to all nodes on the cluster. Replicated mode typically works best in small clusters because of the amount of information that has to be replicated over the network. Infinispan can be configured to use UDP multicast, which alleviates network traffic congestion to a degree.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Distribution Mode</div>
			Distribution mode allows Infinispan to scale the cluster linearly. Distribution mode uses a consistent hash algorithm to determine where in a cluster a new node should be placed. The number of copies of information to be kept is configurable. There is a trade off between the number of copies kept, durability of the data and performance: the more copies that are kept, the more impact on performance, but the less likely you are to lose data in a server failure. The hash algorithm also works to reduce network traffic by locating entries without multicasting or storing metadata.
		</div><div class="para">
		One should consider using Distribution (dist) mode as a caching strategy when the cluster size exceeds 6-8 nodes. With Distribution mode, data is distributed to only a subset of nodes within the cluster, as opposed to all nodes (default Replicated mode).
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Synchronous and Asynchronous Replication</div>
			Replication can be performed either in synchronous or asynchronous mode, and the mode chosen depends on your requirements and your application. With synchronous replication, the thread that handles the user request is blocked until replication has been successful. Only when the replication is successful, a response is sent back to the client and the thread is released. Synchronous replication has an impact on network traffic because it requires a response from each node in the cluster. It has the advantage, however, of ensuring that all modifications have been made to all nodes in the cluster.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title"/>
			Asynchronous replication is carried out in the background. Infinispan implements a replication queue, which is used by a background thread to carry out replication. Replication is triggered either on a time basis, or on the queue size. A replication queue allows increased performance because there is no conversation being carried out between the cluster nodes. The trade off with asynchronous replication is that it is not quite so accurate. Failed replication attempts are written to a log, not notified in real time.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+37030-767071+%5BLatest%5D&amp;comment=Title%3A+Clustering+modes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=37030-767071+10+Aug+2015+04%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Cache_Containers_and_Cache_stores">
      ⁠</a>13.3. Cache Containers</h1></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Cache Containers</span></dt><dd><div class="para">
					A cache container is repository for the caches used by a subsystem. For Infinispan default cache containers are defined in the configuration xml files (standalone-ha.xml, standalone-full-ha.xml, domain.xml). One cache is defined as the default cache, which is the cache that will be used for clustering.
				</div><div class="example"><a id="idm139978452251296">
      ⁠</a><p class="title"><strong>Example 13.1. Cache container definitions from standalone-ha.xml configuration file</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:infinispan:1.5"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;cache-container</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"singleton"</span><span xmlns="" class="perl_Others"> aliases=</span><span xmlns="" class="perl_String">"cluster ha-partition"</span><span xmlns="" class="perl_Others"> default-cache=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;transport</span><span xmlns="" class="perl_Others"> lock-timeout=</span><span xmlns="" class="perl_String">"60000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;replicated-cache</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"SYNC"</span><span xmlns="" class="perl_Others"> batching=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;locking</span><span xmlns="" class="perl_Others"> isolation=</span><span xmlns="" class="perl_String">"REPEATABLE_READ"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/replicated-cache&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/cache-container&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;cache-container</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"web"</span><span xmlns="" class="perl_Others"> aliases=</span><span xmlns="" class="perl_String">"standard-session-cache"</span><span xmlns="" class="perl_Others"> default-cache=</span><span xmlns="" class="perl_String">"repl"</span><span xmlns="" class="perl_Others"> module=</span><span xmlns="" class="perl_String">"org.jboss.as.clustering.web.infinispan"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;transport</span><span xmlns="" class="perl_Others"> lock-timeout=</span><span xmlns="" class="perl_String">"60000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;replicated-cache</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"repl"</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"ASYNC"</span><span xmlns="" class="perl_Others"> batching=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;file-store/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/replicated-cache&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;replicated-cache</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"sso"</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"SYNC"</span><span xmlns="" class="perl_Others"> batching=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;distributed-cache</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dist"</span><span xmlns="" class="perl_Others"> l1-lifespan=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"ASYNC"</span><span xmlns="" class="perl_Others"> batching=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;file-store/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/distributed-cache&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/cache-container&gt;</span></pre></div></div><div class="para">
					Note the default cache defined in each cache container. In this example, in the <code class="literal">web</code> cache container, the <code class="literal">repl</code> cache is defined as the default. The <code class="literal">repl</code> cache will therefore be used when clustering web sessions.
				</div><div class="para">
					The cache containers and cache attributes can be configured using the Management Console or CLI commands, but it is not advisable to change the names of either cache containers or caches.
				</div></dd><dt><span class="term">Configure Cache Containers</span></dt><dd><div class="para">
					Cache containers for Infinispan can be configured using the CLI or the Management Console.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978458402768">
      ⁠</a><p class="title"><strong>Procedure 13.1. Configure the Infinispan Cache Containers in the Management Console</strong></p><ol class="1"><li class="step"><div class="para">
							Select the <span class="guimenuitem"><strong>Configuration</strong></span> tab from the top of the screen.
						</div></li><li class="step"><div class="para">
							For Domain mode only, select either <span class="guimenuitem"><strong>ha</strong></span> or <span class="guimenuitem"><strong>full-ha</strong></span> from the drop down menu at top left.
						</div></li><li class="step"><div class="para">
							Expand the <span class="guimenu"><strong>Subsystems</strong></span> menu, then expand the <span class="guimenu"><strong>Infinispan</strong></span> menu. Select <span class="guimenuitem"><strong>Cache Containers</strong></span>.
						</div></li><li class="step"><div class="para">
							Select a cache container from the <span class="guilabel"><strong>Cache Containers</strong></span> table.
						</div></li><li class="step"><p class="title"><strong>Add, Remove or Set Default Cache Container</strong></p><ol class="substeps a"><li class="step"><div class="para">
									To create a new cache container, click <span class="guibutton"><strong>Add</strong></span> from the <span class="guilabel"><strong>Cache Containers</strong></span> table.
								</div></li><li class="step"><div class="para">
									To remove a cache container, select the cache container in the <span class="guilabel"><strong>Cache Containers</strong></span> table. Click <span class="guibutton"><strong>Remove</strong></span> and click <span class="guibutton"><strong>OK</strong></span> to confirm.
								</div></li><li class="step"><div class="para">
									To set a cache container as default, click <span class="guibutton"><strong>Set Default</strong></span>, enter a cache container name from the drop down list, click <span class="guibutton"><strong>Save</strong></span> to confirm.
								</div></li></ol></li><li class="step"><div class="para">
							To add or update the attributes of a cache container, select the cache container in the <span class="guilabel"><strong>Cache Containers</strong></span> table. Select one from the <span class="guimenuitem"><strong>Attributes</strong></span>, <span class="guimenuitem"><strong>Transport</strong></span> and <span class="guimenuitem"><strong>Aliases</strong></span> tabs in the <span class="guilabel"><strong>Details</strong></span> area of the screen, and click <span class="guibutton"><strong>Edit</strong></span>. For help about the content of the <span class="guimenuitem"><strong>Attributes</strong></span>, <span class="guimenuitem"><strong>Transport</strong></span> and <span class="guimenuitem"><strong>Aliases</strong></span> tabs, click <span class="guilabel"><strong>Need Help?</strong></span>.
						</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978441609184">
      ⁠</a><p class="title"><strong>Procedure 13.2. Configure the Infinispan Cache Containers in the Management CLI</strong></p><ol class="1"><li class="step"><div class="para">
							To get a list of configurable attributes, enter the following CLI command: 
<pre class="screen">/profile=<em class="replaceable">profile name</em>/subsystem=infinispan/cache-container=<em class="replaceable">container name</em>:read-resource</pre>

						</div></li><li class="step"><div class="para">
							You can use the Management CLI to add, remove and update cache containers. Before issuing any commands to do with cache containers, ensure that you use the correct profile in the Management CLI command.
						</div><ol class="substeps a"><li class="step"><p class="title"><strong>Add a Cache Container</strong></p><div class="para">
									To add a cache container base your command on the following example: 
<pre class="screen">/profile=<em class="replaceable">profile-name</em>/subsystem=infinispan/cache-container="<em class="replaceable">cache container name</em>":add</pre>

								</div></li><li class="step"><p class="title"><strong>Remove a Cache Container</strong></p><div class="para">
									To remove a cache container base your command on the following example: 
<pre class="screen">/profile=<em class="replaceable">profile-name</em>/subsystem=infinispan/cache-container="<em class="replaceable">cache container name</em>":remove</pre>

								</div></li><li class="step"><p class="title"><strong>Update Cache Container attributes</strong></p><div class="para">
									Use the write-attribute operation to write a new value to an attribute. You can use tab completion to help complete the command string as you type, as well as to expose the available attributes. The following example updates statistics-enabled to true. 
<pre class="screen">/profile=<em class="replaceable">profile name</em>/subsystem=infinispan/cache-container=<em class="replaceable">cache container name</em>:write-attribute(name=statistics-enabled,value=true)</pre>

								</div></li></ol></li></ol></div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+40555-735882+%5BLatest%5D&amp;comment=Title%3A+Cache+Containers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=40555-735882+14+Jan+2015+04%3A25+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="About_Infinispan_Statistics">
      ⁠</a>13.4. About Infinispan Statistics</h1></div></div></div><div class="para">
		Runtime statistics about Infinispan cache and cache-container objects can be enabled for monitoring purposes. Statistics collection is not enabled by default for performance reasons.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Enabling Infinispan statistics can have a negative impact on the performance of the Infinispan subsystem. Statistics should be enabled only when required.
		</div></div></div><div class="para">
		Statistics collection can be enabled for each cache-container, cache or both. The statistics option for each cache overrides the option for the cache-container. Enabling or disabling statistics collection for a cache container will cause all caches in that container to inherit the setting, unless they explicitly specify their own. If only a cache-container is enabled for statistics, useful statistics are available.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+30886-668751+%5BLatest%5D&amp;comment=Title%3A+About+Infinispan+Statistics%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30886-668751+11+Jun+2014+15%3A58+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Enable_Infinispan_Statistics_Collection">
      ⁠</a>13.5. Enable Infinispan Statistics Collection</h1></div></div></div><div class="para">
			Statistics collection can be enabled from either the startup configuration file (for example <code class="filename">standalone.xml</code>, <code class="filename">standalone-ha.xml</code>, <code class="filename">domain.xml</code>) or the Management CLI.
		</div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A30890-760839+%5BLatest%5D&amp;comment=Title%3A+Enable+Infinispan+Statistics+Collection%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enable_Infinispan_Statistics_in_the_Startup_Configuration_File">
      ⁠</a>13.5.1. Enable Infinispan Statistics Collection in the Startup Configuration File</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978507776624">
      ⁠</a><p class="title"><strong>Procedure 13.3. Enable Infinispan Statistics in the Startup Configuration File</strong></p><ul><li class="step"><div class="para">
				Add the attribute <code class="code">statistics-enabled</code>=<em class="parameter"><code>VALUE</code></em> to the required <code class="literal">cache-container</code> or <code class="literal">cache</code> XML tag under the Infinispan subsystem.
			</div></li></ul></div><div class="example"><a id="idm139978544476000">
      ⁠</a><p class="title"><strong>Example 13.2. Enable Statistics Collection for a <code class="literal">cache</code></strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;replicated-cache</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"sso"</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"SYNC"</span><span xmlns="" class="perl_Others"> batching=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> statistics-enabled=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="example"><a id="idm139978439808832">
      ⁠</a><p class="title"><strong>Example 13.3. Enable Statistics Collection for a <code class="literal">cache-container</code></strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cache-container</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"singleton"</span><span xmlns="" class="perl_Others"> aliases=</span><span xmlns="" class="perl_String">"cluster ha-partition"</span><span xmlns="" class="perl_Others"> default-cache=</span><span xmlns="" class="perl_String">"default"</span><span xmlns="" class="perl_Others"> statistics-enabled=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+30891-639268+%5BLatest%5D&amp;comment=Title%3A+Enable+Infinispan+Statistics+Collection+in+the+Startup+Configuration+File%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30891-639268+08+May+2014+19%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enable_Infinispan_Statistics_from_the_Management_CLI">
      ⁠</a>13.5.2. Enable Infinispan Statistics Collection from the Management CLI</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978518662592">
      ⁠</a><p class="title"><strong>Procedure 13.4. Enable Infinispan Statistics Collection from the Management CLI</strong></p><div class="para">
			In this procedure: 
			<div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<em class="parameter"><code>CACHE_CONTAINER</code></em> is the preferred <code class="literal">cache-container</code> (for example, <code class="literal">web</code>)
					</div></li><li class="listitem"><div class="para">
						<em class="parameter"><code>CACHE_TYPE</code></em> is the preferred cache type (for example, <code class="literal">distributed-cache</code>)
					</div></li><li class="listitem"><div class="para">
						<em class="parameter"><code>CACHE</code></em> is the cache name (for example, <code class="literal">dist</code>)
					</div></li></ul></div>

		</div><ol class="1"><li class="step"><div class="para">
				Enter the following command: 
				<div class="example"><a id="idm139978456960272">
      ⁠</a><p class="title"><strong>Example 13.4. Enable Statistics Collection for a <code class="literal">cache</code></strong></p><div class="example-contents"><pre class="screen">/subsystem=infinispan/cache-container=<em class="replaceable">CACHE_CONTAINER</em>/<em class="replaceable">CACHE_TYPE</em>=<em class="replaceable">CACHE</em>:write-attribute(name=statistics-enabled,value=true)</pre></div></div>
				 <div class="example"><a id="idm139978448850224">
      ⁠</a><p class="title"><strong>Example 13.5. Enable Statistics Collection for a <code class="literal">cache-container</code></strong></p><div class="example-contents"><pre class="screen">/subsystem=infinispan/cache-container=<em class="replaceable">CACHE_CONTAINER</em>:write-attribute(name=statistics-enabled,value=true)</pre></div></div>

			</div></li><li class="step"><div class="para">
				Enter the following command to reload the server: 
<pre class="screen">reload</pre>

			</div></li></ol></div><div class="para">
		<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				To undefine an attribute, enter the following command: 
<pre class="screen">/subsystem=infinispan/cache-container=<em class="replaceable">CACHE_CONTAINER</em>/<em class="replaceable">CACHE_TYPE</em>=<em class="replaceable">CACHE</em>:undefine-attribute(name=statistics-enabled)</pre>
				 
<pre class="screen">/subsystem=infinispan/cache-container=<em class="replaceable">CACHE_CONTAINER</em>:undefine-attribute(name=statistics-enabled)</pre>

			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+30894-776159+%5BLatest%5D&amp;comment=Title%3A+Enable+Infinispan+Statistics+Collection+from+the+Management+CLI%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30894-776159+10+Feb+2016+01%3A40+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Verify_Infinispan_Statistics_Collection_is_Enabled">
      ⁠</a>13.5.3. Verify Infinispan Statistics Collection is Enabled</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978541824032">
      ⁠</a><p class="title"><strong>Procedure 13.5. Verify Infinispan Statistics Collection is Enabled</strong></p><div class="para">
			Depending on whether you are confirming that statistics collection is enabled on a <code class="literal">cache</code> or <code class="literal">cache-container</code>, use one of the following Management CLI commands.
		</div><ul><li class="step"><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>For a <code class="literal">cache</code></strong></p><div class="para">
						
<pre class="screen"><code class="command">/subsystem=infinispan/cache-container=<em class="parameter"><code>CACHE_CONTAINER</code></em>/<em class="parameter"><code>CACHE_TYPE</code></em>=<em class="parameter"><code>CACHE</code></em>:read-attribute(name=<code class="literal">statistics-enabled</code>)</code></pre>

					</div></li>
				 <li class="step"><p class="title"><strong>For a <code class="literal">cache-container</code></strong></p><div class="para">
						
<pre class="screen"><code class="command">/subsystem=infinispan/cache-container=<em class="parameter"><code>CACHE_CONTAINER</code></em>:read-attribute(name=<code class="literal">statistics-enabled</code>)</code></pre>

					</div></li>

			</ul></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+30899-760804+%5BLatest%5D&amp;comment=Title%3A+Verify+Infinispan+Statistics+Collection+is+Enabled%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30899-760804+09+Jun+2015+04%3A25+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Switching_to_Distributed_Cache_Mode_for_Web_Session_Replication">
      ⁠</a>13.6. Switching to Distributed Cache Mode for Web Session Replication</h1></div></div></div><div class="para">
		Change the web cache-container for Infinispan subsystem to <code class="code">dist</code> from <code class="code">repl</code>. The <code class="code">owners</code> attribute defines the number of cluster nodes that will hold the session data. One of them is called primary owner, and the others are backup owners.
	</div><div class="para">
		Following is the CLI command to update the cache mode to <code class="code">dist</code> with three owners assuming an <code class="code">ha</code> profile is being used: 
<pre class="programlisting"><span xmlns="" class="line">​</span>/subsystem=infinispan/cache-container=web/:write-attribute(name=default-cache,value=dist)
<span xmlns="" class="line">​</span>/subsystem=infinispan/cache-container=web/distributed-cache=dist/:write-attribute(name=owners,value=<span xmlns="" class="perl_Float">3</span>)</pre>

	</div><div class="para">
		Running the above CLI will yield the following output: 
<pre class="programlisting"><span xmlns="" class="line">​</span>&lt;cache-container name=<span xmlns="" class="perl_String">"web"</span> aliases=<span xmlns="" class="perl_String">"standard-session-cache"</span> default-cache=<span xmlns="" class="perl_String">"dist"</span> module=<span xmlns="" class="perl_String">"org.jboss.as.clustering.web.infinispan"</span>&gt;
<span xmlns="" class="line">​</span>  	&lt;transport lock-timeout=<span xmlns="" class="perl_String">"60000"</span>/&gt;
<span xmlns="" class="line">​</span>  	...
<span xmlns="" class="line">​</span>  	&lt;distributed-cache name=<span xmlns="" class="perl_String">"dist"</span> owners=<span xmlns="" class="perl_String">"3"</span> l1-lifespan=<span xmlns="" class="perl_String">"0"</span> mode=<span xmlns="" class="perl_String">"ASYNC"</span> batching=<span xmlns="" class="perl_String">"true"</span>&gt;
<span xmlns="" class="line">​</span>  		&lt;file-store/&gt;
<span xmlns="" class="line">​</span>  	&lt;/distributed-cache&gt;
<span xmlns="" class="line">​</span>&lt;/cache-container&gt;
</pre>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44685-770348+%5BLatest%5D&amp;comment=Title%3A+Switching+to+Distributed+Cache+Mode+for+Web+Session+Replication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44685-770348+15+Sep+2015+06%3A41+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JGroups">
      ⁠</a>13.7. JGroups</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_JGroups">
      ⁠</a>13.7.1. About JGroups</h2></div></div></div><div class="para">
		JGroups is a messaging toolkit which allows developers to create reliable messaging applications where system reliability is an issue. JGroups can be used to create clusters whose nodes can send messages to each other.
	</div><div class="para">
		The JGroups subsystem provides all the communication mechanisms for how the servers in a cluster talk to each other. EAP is preconfigured with two JGroups stacks.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				udp - the nodes in the cluster use UDP (User Datagram Protocol) multicasting to communicate with each other. UDP is generally faster but less reliable than TCP.
			</div></li><li class="listitem"><div class="para">
				tcp - the nodes in the cluster use TCP (Transmission Control Protocol) to communicate with each other. TCP tends to be slower than UDP, but will more reliably deliver data to its destination.
			</div></li></ul></div><div class="para">
		The preconfigured stacks can be used, or you can define your own to suit your system's specific requirements.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+38659-680110+%5BLatest%5D&amp;comment=Title%3A+About+JGroups%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=38659-680110+29+Jun+2014+21%3A53+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JGroups_Troubleshooting">
      ⁠</a>13.8. JGroups Troubleshooting</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Nodes_do_not_form_a_cluster">
      ⁠</a>13.8.1. Nodes do not form a cluster</h2></div></div></div><div class="para">
		Make sure your machine is set up correctly for IP multicast. There are 2 test programs that can be used to detect this: McastReceiverTest and McastSenderTest. For example:
	</div><pre class="screen">java -cp <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/client/jboss-client.jar org.jgroups.tests.McastReceiverTest -mcast_addr 230.11.11.11 -port 5555 -bind_addr <em class="replaceable">YOUR_BIND_ADDRESS</em></code></pre><div class="para">
		Then in another window start <code class="filename">McastSenderTest</code>:
	</div><pre class="screen">java -cp <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/client/jboss-client.jar org.jgroups.tests.McastSenderTest -mcast_addr 230.11.11.11 -port 5555 -bind_addr <em class="replaceable">YOUR_BIND_ADDRESS</em></code></pre><div class="para">
		If you want to bind to a specific network interface card (NIC), use <code class="filename">-bind_addr</code> <em class="replaceable">192.168.0.2</em>, where <em class="replaceable">192.168.0.2</em> is the IP address of the NIC to which you want to bind. Use this parameter in both the sender and the receiver.
	</div><div class="para">
		You should be able to type in the <code class="filename">McastSenderTest</code> window and see the output in the <code class="filename">McastReceiverTest</code> window. If not, try to use <code class="filename">-ttl 32</code> in the sender. If this still fails, consult a system administrator to help you setup IP multicast correctly, and ask the admin to make sure that multicast will work on the interface you have chosen or, if the machines have multiple interfaces, ask to be told the correct interface. Once you know multicast is working properly on each machine in your cluster, you can repeat the above test to test the network, putting the sender on one machine and the receiver on another.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42341-766900+%5BLatest%5D&amp;comment=Title%3A+Nodes+do+not+form+a+cluster%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42341-766900+05+Aug+2015+14%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Causes_of_missing_heartbeats_in_FD">
      ⁠</a>13.8.2. Causes of missing heartbeats in FD</h2></div></div></div><div class="para">
		Sometimes a member is suspected by FD because a heartbeat ack has not been received for some time T (defined by timeout and max_tries). This can have multiple reasons, e.g. in a cluster of A,B,C,D; C can be suspected if (note that A pings B, B pings C, C pings D and D pings A):
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				B or C are running at 100% CPU for more than T seconds. So even if C sends a heartbeat ack to B, B may not be able to process it because it is at 100%
			</div></li><li class="listitem"><div class="para">
				B or C are garbage collecting, same as above.
			</div></li><li class="listitem"><div class="para">
				A combination of the 2 cases above
			</div></li><li class="listitem"><div class="para">
				The network loses packets. This usually happens when there is a lot of traffic on the network, and the switch starts dropping packets (usually broadcasts first, then IP multicasts, TCP packets last).
			</div></li><li class="listitem"><div class="para">
				B or C are processing a callback. Let us say C received a remote method call over its channel and takes T+1 seconds to process it. During this time, C will not process any other messages, including heartbeats, and therefore B will not receive the heartbeat ack and will suspect C.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42342-732683+%5BLatest%5D&amp;comment=Title%3A+Causes+of+missing+heartbeats+in+FD%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42342-732683+15+Dec+2014+06%3A04+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>