<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 18. Messaging</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Messaging">
      ⁠</a>Chapter 18. Messaging</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Introduction4">
      ⁠</a>18.1. Introduction</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="HornetQ1">
      ⁠</a>18.1.1. HornetQ</h2></div></div></div><div class="para">
		HornetQ is a multi-protocol, asynchronous messaging system developed by Red Hat. HornetQ provides high availability (HA) with automatic client failover to guarantee message reliability in the event of a server failure. HornetQ also supports flexible clustering solutions with load-balanced messages.
	</div><div class="para">
		HornetQ is the Java Message Service (JMS) provider for JBoss EAP 6 and is configured as the <code class="literal">Messaging Subsystem</code>
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+48-675558+%5BLatest%5D&amp;comment=Title%3A+HornetQ%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=48-675558+23+Jun+2014+21%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Handling_Slow_HornetQ_Consumers">
      ⁠</a>18.1.2. Handling Slow HornetQ Consumers</h2></div></div></div><div class="para">
		A slow consumer with a server-side queue (e.g. JMS topic subscriber) can pose a significant problem for broker performance. If messages build up in the consumer's server-side queue then memory will begin filling up and the broker may enter paging mode which would impact performance negatively. However, criteria can be set so that consumers which don't acknowledge messages quickly enough can potentially be disconnected from the broker which in the case of a non-durable JMS subscriber would allow the broker to remove the subscription and all of its messages freeing up valuable server resources.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44725-767892+%5BLatest%5D&amp;comment=Title%3A+Handling+Slow+HornetQ+Consumers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44725-767892+20+Aug+2015+04%3A33+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Handling_Blocking_Calls_During_fail-over">
      ⁠</a>18.1.3. Handling Blocking Calls During fail-over</h2></div></div></div><div class="para">
		If the client code is in a blocking call to the server, waiting for a response to continue its execution, when fail-over occurs, the new session will not have any knowledge of the call that was in progress. This call might otherwise hang for ever, waiting for a response that will never come.
	</div><div class="para">
		To prevent this, HornetQ will unblock any blocking calls that were in progress at the time of fail-over by making them throw a <code class="literal">javax.jms.JMSException</code> (if using JMS), or a <code class="literal">HornetQException</code> with error code <code class="literal">HornetQException.UNBLOCKED</code>. It is up to the client code to catch this exception and retry any operations if desired.
	</div><div class="para">
		If the method being unblocked is a call to commit(), or prepare(), then the transaction will be automatically rolled back and HornetQ will throw a <code class="literal">javax.jms.TransactionRolledBackException</code> (if using JMS), or a <code class="literal">HornetQException</code> with error code <code class="literal">HornetQException.TRANSACTION_ROLLED_BACK</code> if using the core API.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44670-766779+%5BLatest%5D&amp;comment=Title%3A+Handling+Blocking+Calls+During+fail-over%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44670-766779+05+Aug+2015+04%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Handling_fail-over_With_Transactions">
      ⁠</a>18.1.4. Handling fail-over With Transactions</h2></div></div></div><div class="para">
		If the session is transactional and messages have already been sent or acknowledged in the current transaction, then the server cannot be sure that messages sent or acknowledgments have not been lost during the fail-over.
	</div><div class="para">
		Consequently the transaction will be marked as rollback-only, and any subsequent attempt to commit will throw a <code class="literal">javax.jms.TransactionRolledBackException</code> (if using JMS), or a <code class="literal">HornetQException</code> with error code <code class="literal">HornetQException.TRANSACTION_ROLLED_BACK</code> if using the core API.
	</div><div class="para">
		It is up to the user to catch the exception, and perform any client side local rollback code as necessary. There is no need to manually rollback the session - it is already rolled back. The user can then retry the transactional operations again on the same session.
	</div><div class="para">
		If fail-over occurs when a commit call is being executed, the server, as previously described, will unblock the call to prevent a hang, since no response will come back. In this case it is not easy for the client to determine whether the transaction commit was actually processed on the live server before failure occurred.
	</div><div class="para">
		To remedy this, the client can enable duplicate detection in the transaction, and retry the transaction operations again after the call is unblocked. If the transaction had indeed been committed on the live server successfully before fail-over, then when the transaction is retried, duplicate detection will ensure that any durable messages resent in the transaction will be ignored on the server to prevent them getting sent more than once.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			By catching the rollback exceptions and retrying, catching unblocked calls and enabling duplicate detection, once and only once delivery guarantees for messages can be provided in the case of failure, guaranteeing 100% no loss or duplication of messages.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44671-766780+%5BLatest%5D&amp;comment=Title%3A+Handling+fail-over+With+Transactions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44671-766780+05+Aug+2015+04%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Handling_fail-over_With_Non_Transactional_Sessions">
      ⁠</a>18.1.5. Handling fail-over With Non Transactional Sessions</h2></div></div></div><div class="para">
		If the session is non transactional, messages or acknowledgments can be lost in the event of fail-over.
	</div><div class="para">
		To provide once and only once delivery guarantees for non transacted sessions too, enabled duplicate detection, and catch unblock exceptions.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44672-766781+%5BLatest%5D&amp;comment=Title%3A+Handling+fail-over+With+Non+Transactional+Sessions%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44672-766781+05+Aug+2015+04%3A55+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Getting_Notified_of_Connection_Failure">
      ⁠</a>18.1.6. Getting Notified of Connection Failure</h2></div></div></div><div class="para">
		JMS provides a standard mechanism for getting notified asynchronously of connection failure: <code class="literal">java.jms.ExceptionListener</code>. For more information about ExceptionListener, refer <a href="http://docs.oracle.com/javaee/1.3/api/javax/jms/package-summary.html">Oracle javax.jms Javadoc</a>.
	</div><div class="para">
		The HornetQ core API also provides a similar feature in the form of the class <code class="literal">org.hornet.core.client.SessionFailureListener</code>.
	</div><div class="para">
		Any JMS <code class="literal">ExceptionListener</code> or Core <code class="literal">SessionFailureListener</code> instance will always be called by HornetQ in the event of connection failure, irrespective of whether the connection was successfully failed over, reconnected or reattached.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44673-766782+%5BLatest%5D&amp;comment=Title%3A+Getting+Notified+of+Connection+Failure%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44673-766782+05+Aug+2015+05%3A01+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Java_Messaging_Service_JMS">
      ⁠</a>18.1.7. About Java Messaging Service (JMS)</h2></div></div></div><div class="para">
		Messaging systems allow you to loosely couple heterogeneous systems together with added reliability. Java Messaging Service (JMS) providers use a system of transactions, to commit or roll back changes atomically. Unlike systems based on a Remote Procedure Call (RPC) pattern, messaging systems primarily use an asynchronous message passing pattern with no tight relationship between requests and responses. Most messaging systems also support a request-response mode but this is not a primary feature of messaging systems.
	</div><div class="para">
		Messaging systems decouple the senders of messages from the consumers of messages. The senders and consumers of messages are completely independent and know nothing of each other. This allows you to create flexible, loosely coupled systems. Often, large enterprises use a messaging system to implement a message bus which loosely couples heterogeneous systems together. Message buses often form the core of an Enterprise Service Bus (ESB). Using a message bus to decouple disparate systems can allow the system to grow and adapt more easily. It also allows more flexibility to add new systems or retire old ones since they don't have brittle dependencies on each other.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+76-591646+%5BLatest%5D&amp;comment=Title%3A+About+Java+Messaging+Service+%28JMS%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=76-591646+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Supported_Messaging_Styles">
      ⁠</a>18.1.8. Supported Messaging Styles</h2></div></div></div><div class="para">
		HornetQ supports the following messaging styles:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Message Queue pattern</span></dt><dd><div class="para">
					The Message Queue pattern involves sending a message to a queue. Once in the queue, the message is usually made persistent to guarantee delivery. Once the message has moved through the queue, the messaging system delivers it to a message consumer. The message consumer acknowledges the delivery of the message once it is processed.
				</div><div class="para">
					When used with point-to-point messaging, the Message Queue pattern allows multiple consumers for a queue, but each message can only be received by a single consumer.
				</div></dd><dt><span class="term">Publish-Subscribe pattern</span></dt><dd><div class="para">
					The Publish-Subscribe pattern allows multiple senders to send messages to a single entity on the server. This entity is often known as a "topic". Each topic can be attended by multiple consumers, known as "subscriptions".
				</div><div class="para">
					Each subscription receives a copy of every message sent to the topic. This differs from the Message Queue pattern, where each message is only consumed by a single consumer.
				</div><div class="para">
					Subscriptions that are durable retain copies of each message sent to the topic until the subscriber consumes them. These copies are retained even in the event of a server restart. Non-durable subscriptions last only as long as the connection that created them.
				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+77-591646+%5BLatest%5D&amp;comment=Title%3A+Supported+Messaging+Styles%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=77-591646+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Configuration_of_Transports">
      ⁠</a>18.2. Configuration of Transports</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Acceptors_and_Connectors">
      ⁠</a>18.2.1. About Acceptors and Connectors</h2></div></div></div><div class="para">
		HornetQ uses the concept of connectors and acceptors as a key part of the messaging system.
	</div><div class="variablelist"><p class="title"><strong>Acceptors and Connectors</strong></p><dl class="variablelist"><dt><span class="term"><code class="filename"> Acceptor</code></span></dt><dd><div class="para">
					An acceptor defines which types of connections are accepted by the HornetQ server.
				</div></dd><dt><span class="term"><code class="filename"> Connector</code></span></dt><dd><div class="para">
					A connector defines how to connect to a HornetQ server, and is used by the HornetQ client.
				</div></dd></dl></div><div class="para">
		There are two types of connectors and acceptors, relating to whether the matched connector and acceptor pair occur within same JVM or not.
	</div><div class="variablelist"><p class="title"><strong>Invm and Netty</strong></p><dl class="variablelist"><dt><span class="term"><code class="filename"> Invm</code></span></dt><dd><div class="para">
					Invm is short for Intra Virtual Machine. It can be used when both the client and the server are running in the same JVM.
				</div></dd><dt><span class="term"><code class="filename"> Netty</code></span></dt><dd><div class="para">
					The name of a JBoss project. It must be used when the client and server are running in different JVMs.
				</div></dd></dl></div><div class="para">
		A HornetQ client must use a connector that is compatible with one of the server's acceptors. Only an Invm connector can connect to an Invm acceptor, and only a netty connector can connect to a netty acceptor. The connectors and acceptors are both configured on the server in a <code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>. You can use either the Management Console or the Management CLI to define them.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4813-675734+%5BLatest%5D&amp;comment=Title%3A+About+Acceptors+and+Connectors%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4813-675734+24+Jun+2014+01%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Netty_TCP">
      ⁠</a>18.2.2. Configuring Netty TCP</h2></div></div></div><div class="para">
		Netty TCP is a simple unencrypted TCP sockets based transport. Netty TCP can be configured to use old blocking Java IO or non blocking Java NIO. Java NIO is recommended on the server side for better scalability with many concurrent connections. If the number of concurrent connections is less Java old IO can give better latency than NIO.
	</div><div class="para">
		Netty TCP is not recommended for running connections across an untrusted network as it is unencrypted. With the Netty TCP transport all connections are initiated from the client side. 
		<div class="example"><a id="idm139978495484048">
      ⁠</a><p class="title"><strong>Example 18.1. Example of Netty TCP Configuration from Default EAP Configuration</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-throughput"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"batch-delay"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"50"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/netty-connector&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;in-vm-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Others"> server-id=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-throughput"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"batch-delay"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"50"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"direct-deliver"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/netty-acceptor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;in-vm-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Others"> server-id=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span>
</pre></div></div>
		 The example configuration also shows how the JBoss EAP 6 implementation of HornetQ uses socket bindings in the acceptor and connector configuration. This differs from the standalone version of HornetQ, which requires you to declare the specific hosts and ports.
	</div><div class="para">
		The following table describes Netty TCP configuration properties: 
		<div class="table"><a id="idm139978524484096">
      ⁠</a><p class="title"><strong>Table 18.1. Netty TCP Configuration Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Netty TCP Configuration Properties"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/><col style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Property </th><th style="text-align: left"> Default </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> batch-delay </td><td style="text-align: left"> 0 milliseconds </td><td style="text-align: left"> Before writing packets to the transport, HornetQ can be configured to batch up writes for a maximum of batch-delay milliseconds. This increases the overall throughput for very small messages by increasing average latency for message transfer </td></tr><tr><td style="text-align: left"> direct-deliver </td><td style="text-align: left"> true </td><td style="text-align: left"> When a message arrives on the server and is delivered to waiting consumers, by default, the delivery is done on the same thread on which the message arrived. This gives good latency in environments with relatively small messages and a small number of consumers but reduces the throughput and latency. For highest throughput you can set this property as "false" </td></tr><tr><td style="text-align: left"> local-address </td><td style="text-align: left"> [local address available] </td><td style="text-align: left"> For a netty connector, this is used to specify the local address which the client will use when connecting to the remote address. If a local address is not specified then the connector will use any available local address </td></tr><tr><td style="text-align: left"> local-port </td><td style="text-align: left"> 0 </td><td style="text-align: left"> For a netty connector, this is used to specify which local port the client will use when connecting to the remote address. If the local-port default is used (0) then the connector will let the system pick up an ephemeral port. valid ports are 0 to 65535 </td></tr><tr><td style="text-align: left"> nio-remoting-threads </td><td style="text-align: left"> -1 </td><td style="text-align: left"> If configured to use NIO, HornetQ will, by default, use a number of threads equal to three times the number of cores (or hyper-threads) as reported by Runtime.getRuntime().availableProcessors() for processing incoming packets. To override this value, you can set a custom value for the number of threads </td></tr><tr><td style="text-align: left"> tcp-no-delay </td><td style="text-align: left"> true </td><td style="text-align: left"> If this is true then Nagle's algorithm will be enabled. This algorithm helps improve the efficiency of TCP/IP networks by reducing the number of packets sent over a network </td></tr><tr><td style="text-align: left"> tcp-send-buffer-size </td><td style="text-align: left"> 32768 bytes </td><td style="text-align: left"> This parameter determines the size of the TCP send buffer in bytes </td></tr><tr><td style="text-align: left"> tcp-receive-buffer-size </td><td style="text-align: left"> 32768 bytes </td><td style="text-align: left"> This parameter determines the size of the TCP receive buffer in bytes </td></tr><tr><td style="text-align: left"> use-nio </td><td style="text-align: left"> false </td><td style="text-align: left"> If this is true then Java non blocking NIO will be used. If set to false then old blocking Java IO will be used.If you need the server to handle many concurrent connections use non blocking Java NIO otherwise go for old (blocking) IO </td></tr><tr><td style="text-align: left"> use-nio-global-worker-pool </td><td style="text-align: left"> false </td><td style="text-align: left"> This parameter will ensure all JMS connections share a single pool of Java threads (rather than each connection having its own pool). This serves to avoid exhausting the maximum number of processes on the operating system. </td></tr></tbody></table></div></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				If you have <code class="literal">use-nio</code> set to true, use the <code class="literal">use-nio-global-worker-pool</code> parameter to minimize the risk that a machine may create a large number of connections, which could lead to an <code class="literal">OutOfMemory</code> error.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-nio"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-nio-global-worker-pool"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/netty-connector&gt;</span>
</pre></div></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Netty TCP properties are valid for all types of transport (Netty SSL, Netty HTTP and Netty Servlet).
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+39273-765363+%5BLatest%5D&amp;comment=Title%3A+Configuring+Netty+TCP%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=39273-765363+19+Jul+2015+22%3A48+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Netty_Secure_Sockets_Layer_SSL">
      ⁠</a>18.2.3. Configuring Netty Secure Sockets Layer (SSL)</h2></div></div></div><div class="para">
		Netty TCP is a simple unencrypted TCP sockets based transport. Netty SSL is similar to Netty TCP but it provides enhanced security by encrypting TCP connections using the Secure Sockets Layer (SSL).
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Use of SSLv3 protocol in SSL connectors/acceptors was disallowed because of "Poodle" vulnerability. JMS clients connecting by this protocol will be refused.
		</div></div></div><div class="para">
		The following example shows Netty configuration for one way SSL: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Most of the following parameters can be used with acceptors as well as connectors. However some parameters work only with acceptors. The parameter description explains the difference between using these parameters in connectors and acceptors.
			</div></div></div>
		 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"ssl-enabled"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"key-store-password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"[keystore password]"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"key-store-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"[path to keystore file]"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;/netty-acceptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>/acceptors&gt;
</pre>
		 <div class="table"><a id="idm139978455829632">
      ⁠</a><p class="title"><strong>Table 18.2. Netty SSL Configuration Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Netty SSL Configuration Properties"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/><col style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Property Name </th><th style="text-align: left"> Default </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> ssl-enabled </td><td style="text-align: left"> true </td><td style="text-align: left"> This enables SSL </td></tr><tr><td style="text-align: left"> key-store-password </td><td style="text-align: left"> [keystore password] </td><td style="text-align: left"> <div class="para">
							When used on an acceptor this is the password for the server side keystore.
						</div>
						 <div class="para">
							When used on a connector this is the password for the client-side keystore. This is only relevant for a connector if you are using two way SSL (mutual authentication). This value can be configured on the server, but it is downloaded and used by the client.
						</div>
						 </td></tr><tr><td style="text-align: left"> key-store-path </td><td style="text-align: left"> [path to keystore file] </td><td style="text-align: left"> <div class="para">
							When used on an acceptor this is the path to the SSL key store on the server which holds the server's certificates (whether self-signed or signed by an authority).
						</div>
						 <div class="para">
							When used on a connector this is the path to the client-side SSL key store which holds the client certificates. This is only relevant for a connector if you are using 2-way SSL (i.e. mutual authentication). Although this value is configured on the server, it is downloaded and used by the client.
						</div>
						 </td></tr></tbody></table></div></div>
		 If you are configuring Netty for two way SSL (mutual authentication between server and client), there are three additional parameters in addition to the ones described in the above example for one way SSL: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<em class="parameter"><code>need-client-auth</code></em>: This specifies the need for two way (mutual authentication) for client connections.
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>trust-store-password</code></em>: When used on an acceptor this is the password for the server side trust store. When used on a connector this is the password for the client side trust store. This is relevant for a connector for both one way and two way SSL. This value can be configured on the server, but it is downloaded and used by the client
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>trust-store-path</code></em>: When used on an acceptor this is the path to the server side SSL trust store that holds the keys of all the clients that the server trusts. When used on a connector this is the path to the client side SSL key store which holds the public keys of all the servers that the client trusts. This is relevant for a connector for both one way and two way SSL. This path can be configured on the server, but it is downloaded and used by the client.
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+38719-748762+%5BLatest%5D&amp;comment=Title%3A+Configuring+Netty+Secure+Sockets+Layer+%28SSL%29%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=38719-748762+26+Mar+2015+01%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Netty_HTTP">
      ⁠</a>18.2.4. Configuring Netty HTTP</h2></div></div></div><div class="para">
		Netty HTTP tunnels packets over the HTTP protocol. It can be useful in scenarios where firewalls allow only HTTP traffic to pass. Netty HTTP uses the same properties as Netty TCP along with some following additional properties: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The following parameters can be used with acceptors as well as connectors. Netty HTTP transport does not allow the reuse of standard HTTP port (8080 by default). The use of standard HTTP port results in an exception. You can use <a class="xref" href="chap-Messaging.html#Configuring_Netty_Servlet">Section 18.2.5, “Configuring Netty Servlet”</a> (Netty Servlet Transport) for tunneling HornetQ connections through standard HTTP port.
			</div></div></div>
		 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;socket-binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"messaging-http"</span><span xmlns="" class="perl_Others"> port=</span><span xmlns="" class="perl_String">"7080"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
</pre>
		 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-http"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"http-enabled"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"http-client-idle-time"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"500"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"http-client-idle-scan-period"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"500"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"http-response-time"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"10000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   	<span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"http-server-scan-period"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"5000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   	<span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"http-requires-session-id"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/netty-acceptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span>
</pre>
		 The following table describes the additional properties for configuring Netty HTTP: 
		<div class="table"><a id="idm139978526247040">
      ⁠</a><p class="title"><strong>Table 18.3. Netty HTTP Configuration Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Netty HTTP Configuration Properties"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/><col style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Property Name </th><th style="text-align: left"> Default </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> http-enabled </td><td style="text-align: left"> false </td><td style="text-align: left"> If this is true HTTP is enabled </td></tr><tr><td style="text-align: left"> http-client-idle-time </td><td style="text-align: left"> 500 milliseconds </td><td style="text-align: left"> How long a client can be idle before sending an empty HTTP request to keep the connection alive </td></tr><tr><td style="text-align: left"> http-client-idle-scan-period </td><td style="text-align: left"> 500 milliseconds </td><td style="text-align: left"> How often (milliseconds) to scan for idle clients </td></tr><tr><td style="text-align: left"> http-response-time </td><td style="text-align: left"> 10000 milliseconds </td><td style="text-align: left"> The time period for which the server can wait before sending an empty HTTP response to keep the connection alive </td></tr><tr><td style="text-align: left"> http-server-scan-period </td><td style="text-align: left"> 5000 milliseconds </td><td style="text-align: left"> How often, in milliseconds, to scan for clients needing responses </td></tr><tr><td style="text-align: left"> http-requires-session-id </td><td style="text-align: left"> false </td><td style="text-align: left"> If this is true then client will wait after the first call to receive a session ID </td></tr></tbody></table></div></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Automatic client failover is not supported for clients connecting through Netty HTTP transport.
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+38766-679352+%5BLatest%5D&amp;comment=Title%3A+Configuring+Netty+HTTP%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=38766-679352+26+Jun+2014+01%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Netty_Servlet">
      ⁠</a>18.2.5. Configuring Netty Servlet</h2></div></div></div><div class="para">
		The servlet transport allows HornetQ traffic to be tunneled over HTTP to a servlet running in a servlet engine which then redirects it to an in-VM HornetQ server. Netty HTTP transport acts as a web server listening for HTTP traffic on specific ports. With the servlet transport HornetQ traffic is proxied through a servlet engine which may already be serving web site or other applications.
	</div><div class="para">
		In order to configure a servlet engine to work the Netty Servlet transport you need to follow these steps: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Deploy the servlet: The following example describes a web application that uses the servlet: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web-app&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>HornetQServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-class&gt;</span>org.jboss.netty.channel.socket.http.HttpTunnelingServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;init-param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>endpoint<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>local:org.hornetq<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/init-param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;load-on-startup&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/load-on-startup&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/servlet&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>HornetQServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/HornetQServlet<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/web-app&gt;</span>
</pre>
					 The init parameter <em class="parameter"><code>endpoint</code></em> specifies the host attribute of the Netty acceptor that the servlet will forward its packets to
				</div></li><li class="listitem"><div class="para">
					Insert the Netty servlet acceptor on the server side configuration: The following example shows the definition of an acceptor in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>): 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-servlet"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>         org.hornetq.core.remoting.impl.netty.NettyAcceptorFactory
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-servlet"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.hornetq"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/acceptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span>
</pre>

				</div></li><li class="listitem"><div class="para">
					The last step is to define a connector for the client in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>): 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-servlet"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"http"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-servlet"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"servlet-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/messaging/HornetQServlet"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/netty-connector&gt;</span>
</pre>

				</div></li><li class="listitem"><div class="para">
					It is also possible to use the servlet transport over SSL by adding the following configuration to the connector: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-servlet"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"https"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-servlet"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"servlet-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/messaging/HornetQServlet"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"ssl-enabled"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"key-store-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"path to a key-store"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"key-store-password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"key-store password"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/netty-connector&gt;</span>
</pre>

				</div></li></ul></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Automatic client failover is not supported for clients connecting through HTTP tunneling servlet.
			</div></div></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Netty servlet cannot be used to configure EAP 6 servers in order to set up a HornetQ cluster.
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+38767-745579+%5BLatest%5D&amp;comment=Title%3A+Configuring+Netty+Servlet%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=38767-745579+03+Mar+2015+07%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Dead_Connection_Detection">
      ⁠</a>18.3. Dead Connection Detection</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Closing_Dead_Connection_Resources_on_the_Server">
      ⁠</a>18.3.1. Closing Dead Connection Resources on the Server</h2></div></div></div><div class="para">
		A HornetQ core or JMS client application must close its resources before it exits. You can configure your application to automatically close its resources by using the <code class="literal">finally</code> block in the application's code.
	</div><div class="para">
		The following example shows a core client application which closes its session and session factory in a <code class="literal">finally</code> block: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>ServerLocator locator = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>ClientSessionFactory sf = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>ClientSession session = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   locator = HornetQClient.<span xmlns="" class="perl_Function">createServerLocatorWithoutHA</span>(..);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   sf = locator.<span xmlns="" class="perl_Function">createClientSessionFactory</span>();;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   session = sf.<span xmlns="" class="perl_Function">createSession</span>(...);
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">... do</span> some operations with the session...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">finally</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">if</span> (session != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      session.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">if</span> (sf != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      sf.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">if</span>(locator != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      locator.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}
</pre>
		 The following example shows a JMS client application which closes its session and session factory in a <code class="literal">finally</code> block: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Connection jmsConnection = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   ConnectionFactory jmsConnectionFactory = HornetQJMSClient.<span xmlns="" class="perl_Function">createConnectionFactoryWithoutHA</span>(...);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   jmsConnection = jmsConnectionFactory.<span xmlns="" class="perl_Function">createConnection</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">... do</span> some operations with the connection...
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">finally</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">if</span> (connection != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      connection.<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}
</pre>

	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Using Connection Time to Live (TTL) Parameter </div>
			The <em class="parameter"><code>connection-ttl</code></em> parameter determines the time period for which the server keeps the connection alive when it does not receive data or ping packets from the client. This parameter ensures that dead server resources like old sessions are sustained longer thereby allowing clients to reconnect when a failed network connection recovers.
		</div><div class="para">
		You can define connection TTL for JMS clients by specifying <em class="parameter"><code>connection-ttl</code></em> parameter in <code class="literal">HornetQConnectionFactory</code> instance. If you are deploying JMS connection factory instances direct into JNDI; you can define <em class="parameter"><code>connection-ttl</code></em> parameter in <code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code> server configuration files.
	</div><div class="para">
		The default value of <em class="parameter"><code>connection-ttl</code></em> parameter is 60000 milliseconds. If you do not need clients to specify their own connection TTL; you can define the <em class="parameter"><code>connection-ttl-override</code></em> parameter in server configuration files to override all values. The <em class="parameter"><code>connection-ttl-override</code></em> parameter is disabled by default and has a value of -1.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Garbage Collection </div>
			HornetQ uses garbage collection to detect and close the sessions which are not explicitly closed in a <code class="literal">finally</code> block. HornetQ server logs a warning similar to the warning shown below before closing the sessions: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>[Finalizer] 20:14:43,244 WARNING [org.hornetq.core.client.impl.DelegatingSession]  I'm closing a ClientSession you left open. Please make sure you close all ClientSessions explicitly before let
<span xmlns="" class="line">​</span>ting them go out of scope!
<span xmlns="" class="line">​</span>[Finalizer] 20:14:43,244 WARNING [org.hornetq.core.client.impl.DelegatingSession]  The session you didn't close was created here:
<span xmlns="" class="line">​</span>java.lang.Exception
<span xmlns="" class="line">​</span>   at org.hornetq.core.client.impl.DelegatingSession.<span xmlns="" class="perl_Keyword">&lt;init&gt;</span>(DelegatingSession.java:83)
<span xmlns="" class="line">​</span>   at org.acme.yourproject.YourClass (YourClass.java:666)
</pre>
			 The log message contains information about the code part where a JMS connection or user session was created and not closed later.
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41481-700677+%5BLatest%5D&amp;comment=Title%3A+Closing+Dead+Connection+Resources+on+the+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41481-700677+20+Aug+2014+05%3A57+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Detecting_Client_Side_Failure">
      ⁠</a>18.3.2. Detecting Client Side Failure</h2></div></div></div><div class="para">
		The client application automatically sends ping packets to the server to prevent the client from shutting down. In a similar way, the client application considers the connection alive as long as it receives data from the server.
	</div><div class="para">
		If the client does not receive data packets from the server for a time period specified by <em class="parameter"><code>client-failure-check-period</code></em> parameter then the client considers that the connection has failed. The client then initiates a failover or calls <code class="literal">FailureListener</code> instances.
	</div><div class="para">
		For JMS clients, client failure check period is configured using <em class="parameter"><code>ClientFailureCheckPeriod</code></em> attribute on <code class="literal">HornetQConnectionFactory</code> instance. If you are deploying JMS connection factory instances directly into JNDI on the server side, you can specify <em class="parameter"><code>client-failure-check-period</code></em> parameter in <code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code> server configuration files.
	</div><div class="para">
		The default value for client failure check period is 30000 milliseconds. A value of -1 means that the client will never close the connection if no data is received from the server.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuring Asynchronous Connection Execution</div>
			By default, packets received on the server side are executed on the remoting thread. It is possible to free up the remoting thread by processing operations asynchronously on any thread from the thread pool. You can configure asynchronous connection execution using <em class="parameter"><code>async-connection-execution-enabled</code></em> parameter in <code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code> server configuration files. The default value of this parameter is "true".
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			If you process operations asynchronously on any thread from the thread pool, it adds a little latency. Short running operations are always handled on the remoting thread for performance reasons.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41485-781526+%5BLatest%5D&amp;comment=Title%3A+Detecting+Client+Side+Failure%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41485-781526+25+Oct+2017+08%3A35+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Work_with_Large_Messages">
      ⁠</a>18.4. Work with Large Messages</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Work_with_Large_Messages1">
      ⁠</a>18.4.1. Work with Large Messages</h2></div></div></div><div class="para">
		HornetQ supports the use of large messages even when either the client or server has limited amounts of memory. Large messages can be streamed as they are, or compressed further for more efficient transferral. A user can send a large message by setting an <code class="literal">InputStream</code> in the body of the message. When the message is sent HornetQ reads this <code class="literal">InputStream</code> and transmits data to the server in fragments.
	</div><div class="para">
		The client or the server never store the complete body of a large message in memory. The consumer initially receives a large message with an empty body and thereafter sets an <code class="literal">OutputStream</code> on the message to stream it in fragments to a disk file.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4814-633717+%5BLatest%5D&amp;comment=Title%3A+Work+with+Large+Messages%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4814-633717+25+Apr+2014+03%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_HornetQ_Large_Messages">
      ⁠</a>18.4.2. Configuring HornetQ Large Messages</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuring the Server</div>
			In Standalone mode large messages are stored in <code class="filename">EAP_HOME/standalone/data/largemessages</code> directory. In Domain mode large messages are stored in <code class="filename">EAP_HOME/domain/servers/SERVERNAME/data/largemessages</code> directory. The configuration property <code class="literal">large-messages-directory</code> indicates the location where large messages are stored. 
			<div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					To achieve best performance, we recommend storing the large messages directory on a different physical volume to the message journal or the paging directory
				</div></div></div>

		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+30614-635269+%5BLatest%5D&amp;comment=Title%3A+Configuring+HornetQ+Large+Messages%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30614-635269+30+Apr+2014+06%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Parameters">
      ⁠</a>18.4.3. Configuring Parameters</h2></div></div></div><div class="para">
		You can configure HornetQ large messages by setting various parameters:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Using HornetQ Core API on Client Side</span></dt><dd><div class="para">
					If you are using HornetQ Core API on client side you need to set <code class="literal">ServerLocator.setMinLargeMessageSize</code> parameter to specify minimum size of large messages. The minimum size of large messages(min-large-message-size) is set to 100KiB by default. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>ServerLocator locator = HornetQClient.createServerLocatorWithoutHA(new TransportConfiguration(NettyConnectorFactory.class.getName()))
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>locator.setMinLargeMessageSize(25 * 1024);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>ClientSessionFactory factory = HornetQClient.createClientSessionFactory();
<span xmlns="" class="line">​</span>
</pre>

				</div></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Configuring server for Java Messaging Service (JMS) clients</span></dt><dd><div class="para">
					If you using Java Messaging Service (JMS) you need to specify the minimum size of large messages in the attribute <code class="literal">min-large-message-size</code> of your server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>). The minimum size of large messages(min-large-message-size) is set to 100KiB by default. 
					<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							The value of the attribute <code class="literal">min-large-message-size</code> should be in bytes
						</div></div></div>

				</div><div class="para">
					You may choose to compress large messages for fast and efficient transfer. All compression/de-compression operations are handled on client side. If the compressed message is smaller than <code class="literal">min-large-message-size</code>,it is sent to the server as a regular message. Using Java Messaging Service (JMS) you can compress large messages by setting the boolean property <code class="literal">compress-large-messages</code> "true" on the server locator or ConnectionFactory. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;min-large-message-size&gt;</span>204800<span xmlns="" class="perl_Keyword">&lt;/min-large-message-size&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;compress-large-messages&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/compress-large-messages&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

				</div></dd></dl></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+30616-760657+%5BLatest%5D&amp;comment=Title%3A+Configuring+Parameters%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=30616-760657+05+Jun+2015+05%3A47+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Paging">
      ⁠</a>18.5. Paging</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Paging">
      ⁠</a>18.5.1. About Paging</h2></div></div></div><div class="para">
		HornetQ supports many message queues with each queue containing millions of messages. The HornetQ server runs with limited memory thereby making it difficult to store all message queues in memory at one time.
	</div><div class="para">
		Paging is a mechanism used by the HornetQ server to transparently page messages in and out of memory on need basis in order to accomodate large message queues in a limited memory.
	</div><div class="para">
		HornetQ starts paging messages to disk, when the size of messages in memory for a particular address exceeds the maximum configured message size.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			HornetQ paging is enabled by default.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+32284-647021+%5BLatest%5D&amp;comment=Title%3A+About+Paging%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=32284-647021+30+May+2014+00%3A24+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Page_Files">
      ⁠</a>18.5.2. Page Files</h2></div></div></div><div class="para">
		There is an individual folder for each address on the file system which stores messages in multiple files. These files which store the messages are called page files. Each file contains messages up to the maximum configured message size (<code class="literal">page-size-bytes</code>).
	</div><div class="para">
		The system navigates the page files as needed and removes the page files as soon as all messages in the page were received by client.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			If a consumer has a message selector to read messages from queue, only the messages in memory that match the selector are delivered to the consumer. When the consumer acknowledges delivery of these messages, new messages are depaged and loaded into memory. For performance reasons, HornetQ does not scan paged messages to verify if they match the consumer's message selector and there is no confirmation that new depaged messages match the consumer's message selector. There may be messages that match consumer's selector on disk in page files but HornetQ does not load them into memory until another consumer reads the messages in memory and provides free space. If the free space is not available, the consumer with selector may not receive any new messages.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+32285-762957+%5BLatest%5D&amp;comment=Title%3A+Page+Files%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=32285-762957+25+Jun+2015+05%3A35+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuration_of_Paging_Folder">
      ⁠</a>18.5.3. Configuration of Paging Folder</h2></div></div></div><div class="para">
		Global paging parameters are specified in server configuration files (standalone.xml and domain.xml). You can configure the location of the paging directory/folder by using the <em class="parameter"><code>paging-directory</code></em> parameter: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hornetq-server&gt;</span>
<span xmlns="" class="line">​</span> ...
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;paging-directory&gt;</span>/location/paging-directory<span xmlns="" class="perl_Keyword">&lt;/paging-directory&gt;</span>
<span xmlns="" class="line">​</span> ...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hornetq-server&gt;</span>
</pre>
		 The <em class="parameter"><code>paging-directory</code></em> parameter is used to specify a location/folder to store the page files. HornetQ creates one folder for each paging address in this paging directory. The page files are stored in these folders.
	</div><div class="para">
		The default paging directory is <code class="filename">EAP_HOME/standalone/data/messagingpaging</code> (standalone mode) and <code class="filename">EAP_HOME/domain/servers/SERVERNAME/data/messagingpaging</code> (domain mode).
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+32286-762005+%5BLatest%5D&amp;comment=Title%3A+Configuration+of+Paging+Folder%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=32286-762005+17+Jun+2015+07%3A21+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Paging_Mode">
      ⁠</a>18.5.4. Paging Mode</h2></div></div></div><div class="para">
		When messages delivered to an address exceed the configured size, that address goes into "page/paging mode".
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Paging is done individually per address. If you configure a <em class="parameter"><code>max-size-bytes</code></em> for an address, it means each matching address will have a maximum size that you specified. However it does not mean that the total overall size of all matching addresses is limited to <em class="parameter"><code>max-size-bytes</code></em>.
		</div><div class="para">
			Even with <em class="parameter"><code>page</code></em> mode, the server may crash due to an out-of-memory error. HornetQ keeps a reference to each page file on the disk. In a situation with millions of page files, HornetQ can face memory exhaustion. To minimize this risk, it is important to set the attribute <em class="parameter"><code>page-size-bytes</code></em> to a suitable value. You must configure the memory for your JBoss EAP 6 server higher than <em class="parameter"><code>(number of destinations)*(max-size-bytes)</code></em>, otherwise an out-of-memory error can occur.
		</div></div></div><div class="para">
		You can configure the maximum size in bytes (<em class="parameter"><code>max-size-bytes</code></em>) for an address in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>): 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-settings&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.someaddress"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;max-size-bytes&gt;</span>104857600<span xmlns="" class="perl_Keyword">&lt;/max-size-bytes&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;page-size-bytes&gt;</span>10485760<span xmlns="" class="perl_Keyword">&lt;/page-size-bytes&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;address-full-policy&gt;</span>PAGE<span xmlns="" class="perl_Keyword">&lt;/address-full-policy&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-settings&gt;</span>
</pre>
		 The following table describes the parameters on the address settings:
	</div><div class="table"><a id="idm139978518574880">
      ⁠</a><p class="title"><strong>Table 18.4. Paging Address Settings</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Paging Address Settings"><colgroup><col width="14%" style="text-align: left" class="c1"/><col width="14%" style="text-align: left" class="c2"/><col width="71%" style="text-align: left" class="c3"/></colgroup><thead><tr><th style="text-align: left"> Element </th><th style="text-align: left"> Default Value </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> max-size-bytes </td><td style="text-align: left"> 10485760 </td><td style="text-align: left"> <div class="para">
						This is used to specify the maximum memory size the address can have before entering nto paging mode
					</div>
					 </td></tr><tr><td style="text-align: left"> page-size-bytes </td><td style="text-align: left"> 2097152 </td><td style="text-align: left"> <div class="para">
						This is used to specify the size of each page file used on the paging system.
					</div>
					 </td></tr><tr><td style="text-align: left"> address-full-policy </td><td style="text-align: left"> PAGE </td><td style="text-align: left"> <div class="para">
						This value of this attribute is used for paging decisions. You can set either of these values for this attribute: <code class="literal">PAGE</code>: To enable paging and page messages beyond the set limit to disk, <code class="literal">DROP</code>: To silently drop messages which exceed the set limit, <code class="literal">FAIL</code>: To drop messages and send an exception to client message producers, <code class="literal">BLOCK</code>: To block client message producers when they send messages beyond the set limit
					</div>
					 </td></tr><tr><td style="text-align: left"> page-max-cache-size </td><td style="text-align: left"> 5 </td><td style="text-align: left"> <div class="para">
						The system will keep page files up to <em class="parameter"><code>page-max-cache-size</code></em> in memory to optimize Input/Output during paging navigation
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			If you don't want to page messages when the maximum size is reached, you may choose to configure an address in order to simply drop messages, drop messages with an exception on client side or block producers from sending further messages, by setting the <em class="parameter"><code>address-full-policy</code></em> to <code class="literal">DROP</code>, <code class="literal">FAIL</code> and <code class="literal">BLOCK</code> respectively. In the default configuration, all addresses are configured to page messages after an address reaches <em class="parameter"><code>max-size-bytes</code></em>.
		</div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Addresses with Multiple Queues</div>
			When a message is routed to an address that has multiplte queues bound to it, there is only a single copy of the message in memory. Each queue only handles a reference to this original copy of the message. Thus the memory is freed up only when all the queues referencing the original message, have delivered the message.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			A single lazy queue/subscription can reduce the Input/Output performance of the entire address as all the queues will have messages being sent through an extra storage on the paging system.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+32289-744460+%5BLatest%5D&amp;comment=Title%3A+Paging+Mode%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=32289-744460+23+Feb+2015+18%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Diverts">
      ⁠</a>18.6. Diverts</h1></div></div></div><div class="para">
			Diverts are objects configured in HornetQ; which help in diverting messages from one address (to which the message is routed) to some other address. Diverts can be configured in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>).
		</div><div class="para">
			Diverts can be classified into the following types: 
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Exclusive Divert: A message is only diverted to a new address and not sent to the old address at all
					</div></li><li class="listitem"><div class="para">
						Non-exclusive Divert: A message continues to go the old address, and a copy of it is also sent to the new address. Non-exclusive diverts can be used for splitting the flow of messages
					</div></li></ul></div>
			 Diverts can be configured to apply a <code class="literal">Transformer</code> and an optional message filter. An optional message filter helps only divert messages which match the specified filter. A transformer is used for transforming messages to another form. When a transformer is specified; all diverted messages are transformed by the <code class="literal">Transformer</code>.
		</div><div class="para">
			A divert only diverts a message to an address within the same server. If you need to divert a message to an address on a different server, you can follow the pattern described below: 
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Divert messages to a local store and forward queue. Setup a bridge which consumes from that queue and directs messages to an address on a different server
					</div></li></ul></div>
			 You can combine diverts with bridges to create various routings.
		</div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A41173-691439+%5BLatest%5D&amp;comment=Title%3A+Diverts%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Exclusive_Divert">
      ⁠</a>18.6.1. Exclusive Divert</h2></div></div></div><div class="para">
		An exclusive divert; diverts all messages from an old address to a new address. Matching messages are not routed to the old address at all. You can enable exclusive divert by setting <em class="parameter"><code>exclusive</code></em> attribute as <code class="literal">true</code> in <code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code> server configuration files.
	</div><div class="para">
		The following example shows an exclusive divert configured in server configuration file(s): 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;divert</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"prices-divert"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms.topic.priceUpdates<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;forwarding-address&gt;</span>jms.queue.priceForwarding<span xmlns="" class="perl_Keyword">&lt;/forwarding-address&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;filter</span><span xmlns="" class="perl_Others"> string=</span><span xmlns="" class="perl_String">"office='New York'"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;transformer-class-name&gt;</span>
<span xmlns="" class="line">​</span>      org.hornetq.jms.example.AddForwardingTimeTransformer
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/transformer-class-name&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;exclusive&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/exclusive&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/divert&gt;</span>
</pre>
		 The following list describes the attributes used in the above example: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<em class="parameter"><code>address</code></em>: Messages sent to this address are diverted to another address
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>forwarding-address</code></em>: Messages are diverted to this address from the old address
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>filter-string</code></em>: Messages which match the <em class="parameter"><code>filter-string</code></em> value are diverted. All other messages are routed to the normal address
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>transformer-class-name</code></em>: If you specify this parameter; it executes transformation for each matching message. This allows you to change a message's body or property before it is diverted
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>exclusive</code></em>: Used to enable or disable exclusive divert
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41250-691439+%5BLatest%5D&amp;comment=Title%3A+Exclusive+Divert%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41250-691439+08+Aug+2014+01%3A03+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Non-exclusive_Divert">
      ⁠</a>18.6.2. Non-exclusive Divert</h2></div></div></div><div class="para">
		Non-exclusive diverts forward a copy of the original message to the new address. The original message continues to arrive at the old address. You can configure non-exclusive diverts by setting <em class="parameter"><code>exclusive</code></em> property as false in <code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code> server configuration files.
	</div><div class="para">
		The following example shows a non-exclusive divert: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;divert</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"order-divert"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms.queue.orders<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;forwarding-address&gt;</span>jms.topic.spyTopic<span xmlns="" class="perl_Keyword">&lt;/forwarding-address&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;exclusive&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/exclusive&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/divert&gt;</span>
</pre>
		 The above example makes a copy of every message sent to <em class="parameter"><code>jms.queue.orders</code></em> address and sends it to <em class="parameter"><code>jms.topic.spyTopic</code></em> address.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41251-691439+%5BLatest%5D&amp;comment=Title%3A+Non-exclusive+Divert%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41251-691439+08+Aug+2014+01%3A03+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="The_Client_Classpath">
      ⁠</a>18.7. The Client Classpath</h1></div></div></div><div class="para">
		HornetQ requires several jars on the Client Classpath depending on whether the client uses HornetQ Core API, JMS, or JNDI.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			All the jars mentioned here can be found in the <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/client</code> directory of the HornetQ distribution. Be sure you only use the jars from the correct version of the release, you must not mix and match versions of jars from different HornetQ versions. Mixing and matching different jar versions may cause subtle errors and failures to occur.
		</div></div></div><div class="para">
		To set the client classpath, include <code class="filename"><em class="replaceable">EAP_HOME</em>/bin/client/jboss-client.jar</code>. You can also use Maven dependency settings as described in the <code class="filename">EAP_HOME/bin/client/README-EJB-JMS.txt</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44772-769068+%5BLatest%5D&amp;comment=Title%3A+The+Client+Classpath%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44772-769068+27+Aug+2015+06%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Configuration1">
      ⁠</a>18.8. Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_the_JMS_Server1">
      ⁠</a>18.8.1. Configure the JMS Server</h2></div></div></div><div class="para">
		To configure the JMS Server for HornetQ, edit the server configuration file. The server configuration is contained in the <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/domain.xml</code> file for domain servers, or in the <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/standalone-full.xml</code> file for standalone servers.
	</div><div class="para">
		The <code class="sgmltag-element">&lt;subsystem xmlns="urn:jboss:domain:messaging:1.4"&gt;</code> element in the server configuration file contains all JMS configuration. Add any JMS <code class="classname">ConnectionFactory</code>, <code class="classname">Queue</code>, or <code class="classname">Topic</code> instances required for the JNDI.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Enable the JMS subsystem in JBoss EAP 6.</strong></p><div class="para">
				Within the <code class="sgmltag-element">&lt;extensions&gt;</code> element, verify that the following line is present and is not commented out:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;extension</span><span xmlns="" class="perl_Others"> module=</span><span xmlns="" class="perl_String">"org.jboss.as.messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></li><li class="step"><p class="title"><strong>Add the basic JMS subsystem.</strong></p><div class="para">
				If the Messaging subsystem is not present in your configuration file, add it.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Look for the <code class="sgmltag-element">&lt;profile&gt;</code> which corresponds to the profile you use, and locate its <code class="sgmltag-element">&lt;subsystems&gt;</code> tag.
					</div></li><li class="step"><div class="para">
						Paste the following XML immediately following the <code class="sgmltag-element">&lt;profile&gt;</code> tag.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:messaging:1.4"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;hornetq-server&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- ALL XML CONFIGURATION IS ADDED HERE --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/hornetq-server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span></pre><div class="para">
						All further configuration will be added to the empty line above.
					</div></li></ol></li><li class="step"><p class="title"><strong>Add basic configuration for JMS.</strong></p><div class="para">
				Add the following XML in the blank line after the <code class="sgmltag-element">&lt;subsystem xmlns="urn:jboss:domain:messaging:1.4"&gt;</code><code class="sgmltag-element">&lt;hornetq-server&gt;</code> tag:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;journal-min-files&gt;</span>2<span xmlns="" class="perl_Keyword">&lt;/journal-min-files&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;journal-type&gt;</span>NIO<span xmlns="" class="perl_Keyword">&lt;/journal-type&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;persistence-enabled&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/persistence-enabled&gt;</span></pre><div class="para">
				Customize the values above to meet your needs.
			</div><div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					The value of <code class="code">journal-file-size</code> must be higher than or equal to <code class="code">min-large-message-size</code> (100KiB by default), or the server won't be able to store the message.
				</div></div></div></li><li class="step"><p class="title"><strong>Add connection factory instances to HornetQ</strong></p><div class="para">
				The client uses a JMS <code class="classname">ConnectionFactory</code> object to make connections to the server. To add a JMS connection factory object to HornetQ, include a single <code class="sgmltag-element">&lt;jms-connection-factories&gt;</code> tag and <code class="sgmltag-element">&lt;connection-factory&gt;</code> element for each connection factory as follows:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jms-connection-factories&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InVmConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"RemoteConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:jboss/exported/jms/RemoteConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;pooled-connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hornetq-ra"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;transaction</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"xa"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:/JmsXA"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/pooled-connection-factory&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jms-connection-factories&gt;</span>
</pre></li><li class="step"><p class="title"><strong>Configure the <code class="literal">netty</code> connectors and acceptors</strong></p><div class="para">
				This JMS connection factory uses <code class="literal">netty</code> acceptors and connectors. These are references to connector and acceptor objects deployed in the server configuration file. The connector object defines the transport and parameters used to connect to the HornetQ server. The acceptor object identifies the type of connections accepted by the HornetQ server.
			</div><div class="para">
				To configure the <code class="literal">netty</code> connectors, include the following settings:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-throughput"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"batch-delay"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"50"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/netty-connector&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;in-vm-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Others"> server-id=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
</pre><div class="para">
				To configure the <code class="literal">netty</code> acceptors, include the following settings:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-throughput"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"batch-delay"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"50"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"direct-deliver"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/netty-acceptor&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;in-vm-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Others"> server-id=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span>
</pre></li><li class="step"><p class="title"><strong>Review the configuration</strong></p><div class="para">
				If you have followed the previous steps, your messaging subsystem should look like the following: 
<pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:messaging:1.4"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;hornetq-server&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;journal-min-files&gt;</span>2<span xmlns="" class="perl_Keyword">&lt;/journal-min-files&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;journal-type&gt;</span>NIO<span xmlns="" class="perl_Keyword">&lt;/journal-type&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;persistence-enabled&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/persistence-enabled&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;jms-connection-factories&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InVmConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"RemoteConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:jboss/exported/jms/RemoteConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;pooled-connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hornetq-ra"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;transaction</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"xa"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:/JmsXA"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/pooled-connection-factory&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/jms-connection-factories&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;netty-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-throughput"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"batch-delay"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"50"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/netty-connector&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;in-vm-connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Others"> server-id=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>	
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;netty-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-throughput"</span><span xmlns="" class="perl_Others"> socket-binding=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"batch-delay"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"50"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"direct-deliver"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/netty-acceptor&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;in-vm-acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Others"> server-id=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/hornetq-server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>
</pre>

			</div></li><li class="step"><p class="title"><strong>Configure the socket binding groups</strong></p><div class="para">
				The netty connectors reference the <code class="literal">messaging</code> and <code class="literal">messaging-throughput</code> socket bindings. The <code class="literal">messaging</code> socket binding uses port 5445, and the <code class="literal">messaging-throughput</code> socket binding uses port 5455.  The <code class="sgmltag-element">&lt;socket-binding-group&gt;</code> tag is in a separate section of the server configuration file. Ensure the following socket bindings are present in the <code class="sgmltag-element">&lt;socket-binding-groups&gt;</code> element:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;socket-binding-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"standard-sockets"</span><span xmlns="" class="perl_Others"> default-interface=</span><span xmlns="" class="perl_String">"public"</span><span xmlns="" class="perl_Others"> port-offset=</span><span xmlns="" class="perl_String">"${jboss.socket.binding.port-offset:0}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;socket-binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"messaging"</span><span xmlns="" class="perl_Others"> port=</span><span xmlns="" class="perl_String">"5445"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;socket-binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"messaging-throughput"</span><span xmlns="" class="perl_Others"> port=</span><span xmlns="" class="perl_String">"5455"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/socket-binding-group&gt;</span>
</pre></li><li class="step"><p class="title"><strong>Add queue instances to HornetQ</strong></p><div class="para">
				There are 4 ways to setup the queue instances (or JMS destinations) for HornetQ.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Use the Management Console
					</div><div class="para">
						To use the Management Console, the server must have been started in the <code class="literal">Message-Enabled</code> mode. You can do this by using the <code class="literal">-c</code> option and forcing the use of the <code class="literal">standalone-full.xml</code> (for standalone servers) configuration file. For example, in the standalone mode, the following will start the server in a message enabled mode
					</div><pre class="programlisting">./standalone.sh -c standalone-full.xml</pre><div class="para">
						Once the server has started, logon to the Management Console and select the <span class="guimenuitem"><strong>Configuration</strong></span> tab. Expand the <span class="guimenu"><strong>Subsystems</strong></span> menu, then expand the <span class="guimenu"><strong>Messaging</strong></span> menu and click <span class="guimenuitem"><strong>Destinations</strong></span>. Next to <span class="guilabel"><strong>Default</strong></span> on the JMS Messaging Provider table, click <span class="guibutton"><strong>View</strong></span>, and then click <span class="guibutton"><strong>Add</strong></span> to enter details of the JMS destination.
					</div></li><li class="listitem"><div class="para">
						Use the Management CLI:
					</div><div class="para">
						First, connect to the Management CLI:
					</div><pre class="programlisting"> bin/jboss-cli.sh --connect</pre><div class="para">
						Next, change into the messaging subsystem:
					</div><pre class="programlisting">cd /subsystem=messaging/hornetq-server=default</pre><div class="para">
						Finally, execute an add operation, replacing the examples values given below with your own:
					</div><pre class="programlisting">./jms-queue=testQueue:add(durable=false,entries=["java:jboss/exported/jms/queue/test"])</pre></li><li class="listitem"><div class="para">
						Create a JMS configuration file and add it to the deployments folder
					</div><div class="para">
						Start by creating a JMS configuration file: <em class="replaceable">example-jms.xml</em>. Add the following entries to it, replacing the values with your own:
					</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>				  	  <span xmlns="" class="perl_Keyword">&lt;messaging-deployment</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:messaging-deployment:1.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;hornetq-server&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;jms-destinations&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jms-queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"testQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"queue/test"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:jboss/exported/jms/queue/test"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jms-queue&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;jms-topic</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"testTopic"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"topic/test"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:jboss/exported/jms/topic/test"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jms-topic&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/jms-destinations&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/hornetq-server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/messaging-deployment&gt;</span></pre><div class="para">
						Save this file in the deployments folder and do a deployment.
					</div></li><li class="listitem"><div class="para">
						Add entries in the JBoss EAP 6 configuration file.
					</div><div class="para">
						Queue attributes can be set in one of two ways.
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								Configuration at a JMS level
							</div><div class="para">
								The following shows a queue predefined in the <code class="literal">standalone.xml</code> or <code class="literal">domain.xml</code> configuration file.
							</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jms-queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"selectorQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/queue/selectorQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;selector</span><span xmlns="" class="perl_Others"> string=</span><span xmlns="" class="perl_String">"color='red'"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;durable&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/durable&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jms-queue&gt;</span></pre><div class="para">
								This name attribute of queue defines the name of the queue. When we do this at a jms level we follow a naming convention so the actual name of the core queue will be <code class="literal">jms.queue.selectorQueue</code>.
							</div><div class="para">
								The entry element configures the name that will be used to bind the queue to JNDI. This is a mandatory element and the queue can contain multiple of these to bind the same queue to different names.
							</div><div class="para">
								The selector element defines what JMS message selector the predefined queue will have. Only messages that match the selector will be added to the queue. This is an optional element with a default of null when omitted.
							</div><div class="para">
								The durable element specifies whether the queue will be persisted. This again is optional and defaults to true if omitted.
							</div></li><li class="listitem"><div class="para">
								Configuration at a core level
							</div><div class="para">
								A queue can be predefined at a core level in the <code class="literal">standalone.xml</code> or <code class="literal">domain.xml</code> file. For example:
							</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;core-queues&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jms.queue.selectorQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms.queue.selectorQueue<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;filter</span><span xmlns="" class="perl_Others"> string=</span><span xmlns="" class="perl_String">"color='red'"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;durable&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/durable&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/queue&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/core-queues&gt;</span></pre></li></ul></div></li></ul></div></li><li class="step"><p class="title"><strong>Perform additional configuration</strong></p><div class="para">
				If you need additional settings, review the DTD in <code class="filename"><em class="replaceable">EAP_HOME</em>/docs/schema/jboss-as-messaging_1_4.xsd</code>.
			</div></li></ol></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+111-769268+%5BLatest%5D&amp;comment=Title%3A+Configure+the+JMS+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=111-769268+31+Aug+2015+01%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_JMS_Address_Settings">
      ⁠</a>18.8.2. Configure JMS Address Settings</h2></div></div></div><div class="para">
		The JMS subsystem has several configurable options which control aspects of how and when a message is delivered, how many attempts should be made, and when the message expires. These configuration options all exist within the <code class="sgmltag-element">&lt;address-settings&gt;</code> configuration element.
	</div><div class="para">
		A common feature of address configurations is the syntax for matching multiple addresses, also known as wild cards.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Wildcard Syntax</div>
			Address wildcards can be used to match multiple similar addresses with a single statement, similar to how many systems use the asterisk ( <span class="keycap"><strong> *</strong></span>) character to match multiple files or strings with a single search. The following characters have special significance in a wildcard statement.
		</div><div class="table"><a id="idm139978526831984">
      ⁠</a><p class="title"><strong>Table 18.5. JMS Wildcard Syntax</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="JMS Wildcard Syntax"><colgroup><col/><col/></colgroup><thead><tr><th> Character </th><th> Description </th></tr></thead><tbody><tr><td> . (a single period) </td><td> Denotes the space between words in a wildcard expression. </td></tr><tr><td> # (a pound or hash symbol) </td><td> Matches any sequence of zero or more words. </td></tr><tr><td> * (an asterisk) </td><td> Matches a single word. </td></tr></tbody></table></div></div><div class="table"><a id="idm139978473260272">
      ⁠</a><p class="title"><strong>Table 18.6. JMS Wildcard Examples</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="JMS Wildcard Examples"><colgroup><col/><col/></colgroup><thead><tr><th> Example </th><th> Description </th></tr></thead><tbody><tr><td> news.europe.# </td><td> <div class="para">
						Matches <code class="literal">news.europe</code>, <code class="literal">news.europe.sport</code>, <code class="literal">news.europe.politic</code>, but not <code class="literal">news.usa</code> or <code class="literal">europe</code>.
					</div>
					 </td></tr><tr><td> news.* </td><td> <div class="para">
						Matches <code class="literal">news.europe</code> but not <code class="literal">news.europe.sport</code>.
					</div>
					 </td></tr><tr><td> news.*.sport </td><td> <div class="para">
						Matches <code class="literal">news.europe.sport</code> and <code class="literal">news.usa.sport</code>, but not <code class="literal">news.europe.politics</code>.
					</div>
					 </td></tr></tbody></table></div></div><div class="example"><a id="idm139978454104608">
      ⁠</a><p class="title"><strong>Example 18.2. Default Address Setting Configuration</strong></p><div class="example-contents"><div class="para">
			The values in this example are used to illustrate the rest of this topic.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-settings&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!--default for catch all--&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"#"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;dead-letter-address&gt;</span>jms.queue.DLQ<span xmlns="" class="perl_Keyword">&lt;/dead-letter-address&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;expiry-address&gt;</span>jms.queue.ExpiryQueue<span xmlns="" class="perl_Keyword">&lt;/expiry-address&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;redelivery-delay&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/redelivery-delay&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;max-size-bytes&gt;</span>10485760<span xmlns="" class="perl_Keyword">&lt;/max-size-bytes&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;address-full-policy&gt;</span>BLOCK<span xmlns="" class="perl_Keyword">&lt;/address-full-policy&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;message-counter-history-day-limit&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/message-counter-history-day-limit&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-settings&gt;</span>
</pre></div></div><div class="table"><a id="idm139978523970656">
      ⁠</a><p class="title"><strong>Table 18.7. Description of JMS Address Settings</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols gt-14-rows" summary="Description of JMS Address Settings"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th> Element </th><th> Description </th><th> Default Value </th><th> Type </th></tr></thead><tbody><tr><td> <div class="para">
						<code class="literal">address-full-policy</code>
					</div>
					 </td><td> <div class="para">
						Determines what happens when an address where max-size-bytes is specified becomes full.
					</div>
					 </td><td> <div class="para">
						PAGE
					</div>
					 </td><td> <div class="para">
						STRING
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">dead-letter-address</code>
					</div>
					 </td><td> <div class="para">
						If a dead letter address is specified, messages are moved to the dead letter address if <code class="literal">max-delivery-attempts</code> delivery attempts have failed. Otherwise, these undelivered messages are discarded. Wildcards are allowed.
					</div>
					 </td><td> <div class="para">
						jms.queue.DLQ
					</div>
					 </td><td> <div class="para">
						STRING
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">expiry-address</code>
					</div>
					 </td><td> <div class="para">
						If the expiry address is present, expired messages are sent to the address or addresses matched by it, instead of being discarded. Wildcards are allowed.
					</div>
					 </td><td> <div class="para">
						jms.queue.ExpiryQueue
					</div>
					 </td><td> <div class="para">
						STRING
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">last-value-queue</code>
					</div>
					 </td><td> <div class="para">
						Defines whether a queue only uses last values or not.
					</div>
					 </td><td> <div class="para">
						false
					</div>
					 </td><td> <div class="para">
						BOOLEAN
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">max-delivery-attempts</code>
					</div>
					 </td><td> <div class="para">
						The maximum number of times to attempt to re-deliver a message before it is sent to <code class="literal">dead-letter-address</code> or discarded.
					</div>
					 </td><td> <div class="para">
						10
					</div>
					 </td><td> <div class="para">
						INT
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">max-size-bytes</code>
					</div>
					 </td><td> <div class="para">
						The maximum bytes size.
					</div>
					 </td><td> <div class="para">
						10485760L
					</div>
					 </td><td> <div class="para">
						LONG
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">message-counter-history-day-limit</code>
					</div>
					 </td><td> <div class="para">
						Day limit for the message counter history.
					</div>
					 </td><td> <div class="para">
						10
					</div>
					 </td><td> <div class="para">
						INT
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">page-max-cache-size</code>
					</div>
					 </td><td> <div class="para">
						The number of page files to keep in memory to optimize IO during paging navigation.
					</div>
					 </td><td> <div class="para">
						5
					</div>
					 </td><td> <div class="para">
						INT
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">page-size-bytes</code>
					</div>
					 </td><td> <div class="para">
						The paging size.
					</div>
					 </td><td> <div class="para">
						5
					</div>
					 </td><td> <div class="para">
						INT
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">redelivery-delay</code>
					</div>
					 </td><td> <div class="para">
						Time to delay between re-delivery attempts of messages, expressed in milliseconds. If set to <code class="literal">0</code>, re-delivery attempts occur indefinitely.
					</div>
					 </td><td> <div class="para">
						0L
					</div>
					 </td><td> <div class="para">
						LONG
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">redistribution-delay</code>
					</div>
					 </td><td> <div class="para">
						Defines how long to wait when the last consumer is closed on a queue before redistributing any messages.
					</div>
					 </td><td> <div class="para">
						-1L
					</div>
					 </td><td> <div class="para">
						LONG
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">send-to-dla-on-no-route</code>
					</div>
					 </td><td> <div class="para">
						A parameter for an address that sets the condition of a message not routed to any queues to instead be sent the to the dead letter address (DLA) indicated for that address.
					</div>
					 </td><td> <div class="para">
						false
					</div>
					 </td><td> <div class="para">
						BOOLEAN
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">slow-consumer-threshold</code>
					</div>
					 </td><td> <div class="para">
						The minimum rate of message consumption allowed before a consumer is considered "slow." Measured in messages-per-second.
					</div>
					 </td><td> <div class="para">
						-1
					</div>
					 </td><td> <div class="para">
						INT
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">slow-consumer-policy</code>
					</div>
					 </td><td> <div class="para">
						What should happen when a slow consumer is detected. <code class="literal">KILL</code> will kill the consumer's connection (which will obviously impact any other client threads using that same connection). <code class="literal">NOTIFY</code> will send a CONSUMER_SLOW management notification which an application could receive and take action with.
					</div>
					 </td><td> <div class="para">

					</div>
					 </td><td> <div class="para">
						STRING
					</div>
					 </td></tr><tr><td> <div class="para">
						<code class="literal">slow-consumer-check-period</code>
					</div>
					 </td><td> <div class="para">
						How often to check for slow consumers on a particular queue. Measured in seconds.
					</div>
					 </td><td> <div class="para">
						5
					</div>
					 </td><td> <div class="para">
						INT
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ul><li class="step"><p class="title"><strong>Configure Address Setting and Pattern Attributes</strong></p><div class="para">
				Choose either the Management CLI or the Management Console to configure your pattern attributes as required.
			</div><ul class="stepalternatives">
				<li class="step"><p class="title"><strong>Configure the Address Settings Using the Management CLI</strong></p><div class="para">
						Use the Management CLI to configure address settings.
					</div><ol class="substeps a"><li class="step"><p class="title"><strong>Add a New Pattern</strong></p><div class="para">
								Use the <code class="command">add</code> operation to create a new address setting if required. You can run this command from the root of the Management CLI session, which in the following examples creates a new pattern titled <em class="replaceable">patternname</em>, with a <code class="literal">max-delivery-attempts</code> attribute declared as <em class="replaceable">5</em>. The examples for both Standalone Server and a Managed Domain editing on the <code class="literal">full</code> profile are shown.
							</div><pre class="programlisting">[standalone@localhost:9999 /] /subsystem=messaging/hornetq-server=default/address-setting=patternname/:add(max-delivery-attempts=5)</pre><pre class="programlisting">[domain@localhost:9999 /] /profile=full/subsystem=messaging/hornetq-server=default/address-setting=patternname/:add(max-delivery-attempts=5)</pre></li><li class="step"><p class="title"><strong>Edit Pattern Attributes</strong></p><div class="para">
								Use the <code class="command">write</code> operation to write a new value to an attribute. You can use tab completion to help complete the command string as you type, as well as to expose the available attributes. The following example updates the <code class="literal">max-delivery-attempts</code> value to <em class="replaceable">10</em>
							</div><pre class="programlisting">[standalone@localhost:9999 /] /subsystem=messaging/hornetq-server=default/address-setting=patternname/:write-attribute(name=max-delivery-attempts,value=10)</pre><pre class="programlisting">[domain@localhost:9999 /] /profile=full/subsystem=messaging/hornetq-server=default/address-setting=patternname/:write-attribute(name=max-delivery-attempts,value=10)</pre></li><li class="step"><p class="title"><strong>Confirm Pattern Attributes</strong></p><div class="para">
								Confirm the values are changed by running the <code class="command">read-resource</code> operation with the <code class="command">include-runtime=true</code> parameter to expose all current values active in the server model.
							</div><pre class="programlisting">[standalone@localhost:9999 /] /subsystem=messaging/hornetq-server=default/address-setting=patternname/:read-resource</pre><pre class="programlisting">[domain@localhost:9999 /] /profile=full/subsystem=messaging/hornetq-server=default/address-setting=patternname/:read-resource</pre></li></ol></li>
				 <li class="step"><p class="title"><strong>Configure the Address Settings Using the Management Console</strong></p><div class="para">
						Use the Management Console to configure address settings.
					</div><ol class="substeps a"><li class="step"><div class="para">
								Log into the Management Console of your Managed Domain or Standalone Server.
							</div></li><li class="step"><div class="para">
								Select the <span class="guilabel"><strong>Configuration</strong></span> tab at the top of the screen. For Domain mode, select a profile from the <span class="guilabel"><strong>Profile</strong></span> menu at the top left. Only the <code class="literal">full</code> and <code class="literal">full-ha</code> profiles have the <code class="literal">messaging</code> subsystem enabled.
							</div></li><li class="step"><div class="para">
								Expand the <span class="guilabel"><strong>Messaging</strong></span> menu, and select <span class="guilabel"><strong>Destinations</strong></span>.
							</div></li><li class="step"><div class="para">
								A list of JMS Providers is shown. In the default configuration, only one provider, called <code class="literal">default</code>, is shown. Click <span class="guilabel"><strong>View</strong></span> to view the detailed settings for this provider.
							</div></li><li class="step"><div class="para">
								Click the <span class="guilabel"><strong>Address Settings</strong></span> tab. Either add a new pattern by clicking <span class="guibutton"><strong>Add</strong></span>, or select an existing pattern and click<span class="guibutton"><strong>Edit</strong></span> to update the settings.
							</div></li><li class="step"><div class="para">
								If you are adding a new pattern, the <span class="guilabel"><strong>Pattern</strong></span> field refers to the <code class="literal">match</code> parameter of the <code class="literal">address-setting</code> element. You can also edit the <span class="guilabel"><strong>Dead Letter Address</strong></span>, <span class="guilabel"><strong>Expiry Address</strong></span>, <span class="guilabel"><strong>Redelivery Delay</strong></span>, and <span class="guilabel"><strong>Max Delivery Attempts</strong></span>. Other options need to be configured using the Management CLI.
							</div></li></ol></li>

			</ul></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+8537-767890+%5BLatest%5D&amp;comment=Title%3A+Configure+JMS+Address+Settings%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=8537-767890+20+Aug+2015+03%3A20+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Temporary_Queues_and_Runtime_Queues">
      ⁠</a>18.8.3. Temporary Queues and Runtime Queues</h2></div></div></div><div class="para">
		While designing request-reply scenarios that involve a client sending a request and waiting for a reply, an addressable issue is whether each runtime instance of the client has a dedicated queue for its replies or whether the runtime instances access a shared queue, selecting their specific reply message based on an appropriate attribute. If multiple queues are required, then we need the ability to create a queue dynamically for use by the client, and JMS provides this facility using the concept of temporary queues. The <code class="literal">TemporaryQueue</code> is created on request by the <code class="literal">QueueSession</code> and exists until it is deleted or for the life of the <code class="literal">QueueConnection</code> (i.e. until the <code class="literal">QueueConnection</code> is closed). This means that although the <code class="literal">TemporaryQueue</code> is created by a specific <code class="literal">QueueSession</code>, it can be reused by any other <code class="literal">QueueSessions</code> created from the same <code class="literal">QueueConnection</code> to create a <code class="literal">QueueReceiver</code>.
	</div><div class="para">
		The tradeoff between having a shared queue for replies or having individual temporary queues is influenced by the potential number of active client instances. With a shared-queue approach, at some provider-specific threshold, contention for access to the queue can become a concern. This has to be contrasted against the additional overhead associated with the provider creating queue storage at runtime and the impact on machine memory of having to host a potentially large number of temporary queues.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The creation of temporary queues is accomplished with the <code class="literal">createTemporaryQueue</code> method. Similarly, the creation of temporary topics is accomplished with the <code class="literal">createTemporaryTopic</code> method. Both of these methods are for creating the physical queue and physical topic.
		</div></div></div><div class="para">
		If there are messages that have been received but not acknowledged when a <code class="literal">QueueSession</code> terminates, these messages will be retained and redelivered when a consumer next accesses the queue. A <code class="literal">QueueSession</code> is used for creating Point-to-Point specific objects. In general, use the Session object. The <code class="literal">QueueSession</code> is used to support existing code. Using the Session object simplifies the programming model, and allows transactions to be used across the two messaging domains.
	</div><div class="para">
		A <code class="literal">TopicSession</code> is used for creating Pub/Sub specific objects. In general, use the Session object, and use <code class="literal">TopicSession</code> only to support existing code. Using the Session object simplifies the programming model, and allows transactions to be used across the two messaging domains.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44693-767220+%5BLatest%5D&amp;comment=Title%3A+Temporary+Queues+and+Runtime+Queues%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44693-767220+11+Aug+2015+07%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Last-Value_Queues">
      ⁠</a>18.8.4. Last-Value Queues</h2></div></div></div><div class="para">
		Last-Value queues are special queues which discard any messages when a newer message with the same value for a well-defined Last-Value property is put in the queue. In other words, a Last-Value queue only retains the last value. A typical example for Last-Value queue is for stock prices, where you are only interested by the latest value for a particular stock.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuring Last-Value Queues</div>
			Last-value queues are defined in the address-setting configuration: 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.lastValueQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;last-value-queue&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/last-value-queue&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre>

		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Using Last-Value Property</div>
			The property name used to identify the last value is <code class="literal">"_HQ_LVQ_NAME"</code> (or the constant <code class="literal">Message.HDR_LAST_VALUE_NAME</code> from the Core API). For example, if two messages with the same value for the Last-Value property are sent to a Last-Value queue, only the latest message will be kept in the queue:
		</div><div class="example"><a id="idm139978499029232">
      ⁠</a><p class="title"><strong>Example 18.3.  Send 1st message with Last-Value property set to <em class="replaceable">STOCK_NAME</em></strong></p><div class="example-contents"><pre class="programlisting">TextMessage message = session.createTextMessage("1st message with Last-Value property set");
message.setStringProperty("_HQ_LVQ_NAME", "STOCK_NAME");
producer.send(message);</pre></div></div><div class="example"><a id="idm139978499488048">
      ⁠</a><p class="title"><strong>Example 18.4.  Send 2nd message with Last-Value property set to <em class="replaceable">STOCK_NAME</em></strong></p><div class="example-contents"><pre class="programlisting">message = session.createTextMessage("2nd message with Last-Value property set");
message.setStringProperty("_HQ_LVQ_NAME", "STOCK_NAME");
producer.send(message);</pre></div></div><div class="example"><a id="idm139978503653376">
      ⁠</a><p class="title"><strong>Example 18.5.  Only the 2nd message will be received; it is the latest with the Last-Value property set: </strong></p><div class="example-contents"><pre class="programlisting">TextMessage messageReceived = (TextMessage)messageConsumer.receive(5000);
System.out.format("Received message: %s\n", messageReceived.getText());
</pre></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44694-769265+%5BLatest%5D&amp;comment=Title%3A+Last-Value+Queues%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44694-769265+31+Aug+2015+01%3A22+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Core_and_JMS_Destinations">
      ⁠</a>18.8.5. Core and JMS Destinations</h2></div></div></div><div class="para">
		HornetQ core does not have any concept of a JMS topic. A JMS topic is implemented in core as an address (the topic name) with zero or more queues bound to it. Each queue bound to that address represents a topic subscription. Likewise, a JMS queue is implemented as an address (the JMS queue name) but with one single queue bound to it which represents the JMS queue.
	</div><div class="para">
		A JMS topic is the channel through which users subscribe to receive specific messages from a producer in the publish-and-subscribe model of JMS messaging.
	</div><div class="para">
		A JMS queue is a channel through which users "pull" messages they want to receive using the Point-to-point (p2p) model, instead of automatically receiving messages on a particular topic. The producer submits messages to the queue, and recipients can browse the queue and decide which messages they wish to receive. In the p2p model, users can see the contents of the messages held in the queue before deciding whether or not to accept their delivery.
	</div><div class="para">

	</div><div class="para">
		If you want to configure settings for a JMS Queue with the name <em class="replaceable">orders.europe</em>, you need to configure the corresponding core queue <em class="replaceable">jms.queue.orders.europe</em>: 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- expired messages in JMS Queue "orders.europe" will be sent to the JMS Queue "expiry.europe" --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.orders.europe"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;expiry-address&gt;</span>jms.queue.expiry.europe<span xmlns="" class="perl_Keyword">&lt;/expiry-address&gt;</span>
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44695-769264+%5BLatest%5D&amp;comment=Title%3A+Core+and+JMS+Destinations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44695-769264+31+Aug+2015+01%3A21+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="JMS_Message_Selectors">
      ⁠</a>18.8.6. JMS Message Selectors</h2></div></div></div><div class="para">
		If your messaging application needs to filter the messages it receives, you can use a JMS API message selector, which allows a message consumer to specify the messages it is interested in. Message selectors assign the work of filtering messages to the JMS provider rather than to the application.
	</div><div class="para">
		You can define your message selector as follows: 
<pre class="screen">@MessageDriven(name = "MDBMessageSelectorExample", activationConfig =
{
   @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
   @ActivationConfigProperty(propertyName = "destination", propertyValue = "queue/testQueue"),
   @ActivationConfigProperty(propertyName = "messageSelector", propertyValue = "color = 'RED'")
})
@TransactionManagement(value= TransactionManagementType.CONTAINER)
@TransactionAttribute(value= TransactionAttributeType.REQUIRED)
public class MDBMessageSelectorExample implements MessageListener
{
   public void onMessage(Message message)....
}</pre>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44707-767285+%5BLatest%5D&amp;comment=Title%3A+JMS+Message+Selectors%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44707-767285+12+Aug+2015+01%3A12+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Messaging_with_HornetQ2">
      ⁠</a>18.8.7. Configure Messaging with HornetQ</h2></div></div></div><div class="para">
		The recommended method of configuring messaging in JBoss EAP 6 is in either the Management Console or Management CLI. You can make persistent changes with either of these management tools without needing to manually edit the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> configuration files. It is useful however to familiarize yourself with the messaging components of the default configuration files, where documentation examples using management tools give configuration file snippets for reference.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4371-591665+%5BLatest%5D&amp;comment=Title%3A+Configure+Messaging+with+HornetQ%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4371-591665+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Enable_Logging_for_HornetQ">
      ⁠</a>18.8.8. Enable Logging for HornetQ</h2></div></div></div><div class="para">
		You can enable logging for HornetQ in EAP 6.x using any of the following approaches:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Editing server configuration files (<code class="filename">standalone-full.xml</code> and <code class="filename">standalone-full-ha.xml</code>) manually
			</div></li><li class="listitem"><div class="para">
				Editing server configuration files using the CLI
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978524037952">
      ⁠</a><p class="title"><strong>Procedure 18.1. Set HornetQ logging by editing server configuration files manually</strong></p><ol class="1"><li class="step"><div class="para">
				Open the server configuration file(s) for editing. For example <code class="filename">standalone-full.xml</code> and <code class="filename">standalone-full-ha.xml</code>
			</div></li><li class="step"><div class="para">
				Navigate to logging subsystem configuration in the file(s). The default configuration looks like this: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;logger</span><span xmlns="" class="perl_Others"> category=</span><span xmlns="" class="perl_String">"com.arjuna"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;level</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TRACE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/logger&gt;</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;logger</span><span xmlns="" class="perl_Others"> category=</span><span xmlns="" class="perl_String">"org.apache.tomcat.util.modeler"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;level</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"WARN"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/logger&gt;</span>
<span xmlns="" class="line">​</span>....
</pre>

			</div></li><li class="step"><div class="para">
				Add the <code class="literal">org.hornetq</code> logger category along with the desired logging level as shown in the following example: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;logger</span><span xmlns="" class="perl_Others"> category=</span><span xmlns="" class="perl_String">"com.arjuna"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;level</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TRACE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/logger&gt;</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;logger</span><span xmlns="" class="perl_Others"> category=</span><span xmlns="" class="perl_String">"org.hornetq"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;level</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"INFO"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/logger&gt;</span>
<span xmlns="" class="line">​</span>....
</pre>

			</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
			HornetQ logging is enabled and log messages are processed based on the configured log level.
		</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Set HornetQ logging by editing server configuration files using the CLI</div>
			You can also use CLI to add the <code class="literal">org.hornetq</code> logger category along with the desired logging level to server configuration file(s). For more information see: <a class="xref" href="chap-The_Logging_Subsystem.html#Configure_a_Log_Category_in_the_CLI1">Section 12.3.2, “Configure a Log Category in the CLI”</a>
		</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41139-691450+%5BLatest%5D&amp;comment=Title%3A+Enable+Logging+for+HornetQ%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41139-691450+08+Aug+2014+01%3A20+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_HornetQ_Core_Bridge">
      ⁠</a>18.8.9. Configuring HornetQ Core Bridge</h2></div></div></div><div class="example"><a id="idm139978501231248">
      ⁠</a><p class="title"><strong>Example 18.6. Example configuration for HornetQ Core Bridge:</strong></p><div class="example-contents"><div class="para">
			The values in this example are used to illustrate the rest of this topic.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bridges&gt;</span>
<span xmlns="" class="line">​</span>  	<span xmlns="" class="perl_Keyword">&lt;bridge</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myBridge"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;queue-name&gt;</span>jms.queue.InQueue<span xmlns="" class="perl_Keyword">&lt;/queue-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;forwarding-address&gt;</span>jms.queue.OutQueue<span xmlns="" class="perl_Keyword">&lt;/forwarding-address&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;ha&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/ha&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;reconnect-attempts&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/reconnect-attempts&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;use-duplicate-detection&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/use-duplicate-detection&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;static-connectors&gt;</span>
<span xmlns="" class="line">​</span>        	<span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>
<span xmlns="" class="line">​</span>                bridge-connector
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/static-connectors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/bridge&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bridges&gt;</span>
</pre></div></div><div class="table"><a id="idm139978457230272">
      ⁠</a><p class="title"><strong>Table 18.8. HornetQ Core Bridge Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="HornetQ Core Bridge Attributes"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> name </td><td> <div class="para">
						All bridges must have a unique name on the server.
					</div>
					 </td></tr><tr><td> queue-name </td><td> <div class="para">
						This mandatory parameter is the unique name of the local queue that the bridge consumes from. The queue must already exist by the time the bridge is instantiated at start-up.
					</div>
					 </td></tr><tr><td> forwarding-address </td><td> <div class="para">
						This is the address on the target server that the message will be forwarded to. If a forwarding address is not specified, then the original address of the message will be retained.
					</div>
					 </td></tr><tr><td> ha </td><td> <div class="para">
						This optional parameter determines whether or not this bridge should support high availability. <code class="varname">true</code> means it will connect to any available server in a cluster and support failover. The default value is false.
					</div>
					 </td></tr><tr><td> reconnect-attempts </td><td> <div class="para">
						This optional parameter determines the total number of reconnect attempts the bridge should make before giving up and shutting down. A value of -1 signifies an unlimited number of attempts. The default value is -1.
					</div>
					 </td></tr><tr><td> use-duplicate-detection </td><td> <div class="para">
						This optional parameter determines whether the bridge will automatically insert a duplicate id property into each message that it forwards.
					</div>
					 </td></tr><tr><td> static-connectors </td><td> <div class="para">
						The static-connectors is a list of connector-ref elements pointing to connector elements defined elsewhere. A connector encapsulates knowledge of what transport to use (TCP, SSL, HTTP etc) as well as the server connection parameters (host, port etc).
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31325-654293+%5BLatest%5D&amp;comment=Title%3A+Configuring+HornetQ+Core+Bridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31325-654293+05+Jun+2014+10%3A38+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_HornetQ_JMS_Bridge">
      ⁠</a>18.8.10. Configuring JMS Bridge</h2></div></div></div><div class="para">
		HornetQ includes a fully functional JMS message bridge. The function of this bridge is to consume messages from a source queue or topic, and send them to a target queue or topic, typically on a different server.
	</div><div class="para">
		The source and target servers do not have to be in the same cluster, which makes bridging suitable for reliably sending messages from one cluster to another, for instance across a WAN, and where the connection is unreliable.
	</div><div class="para">
		A bridge can be deployed as a standalone application, with HornetQ standalone server or inside a JBoss AS instance. The source and the target can be located in the same virtual machine or another one.
	</div><div class="example"><a id="idm139978494963664">
      ⁠</a><p class="title"><strong>Example 18.7. Example configuration for JMS Bridge:</strong></p><div class="example-contents"><div class="para">
			The values in this example are used to illustrate the rest of this topic.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:messaging:1.3"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;hornetq-server&gt;</span>
<span xmlns="" class="line">​</span>             ...
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;/hornetq-server&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;jms-bridge</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myBridge"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;source&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;destination</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jms/queue/InQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/source&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;target&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jms/RemoteConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;destination</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jms/queue/OutQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;context&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"java.naming.factory.initial"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.naming.remote.client.InitialContextFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"java.naming.provider.url"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"remote://192.168.40.1:4447"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;/context&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/target&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;quality-of-service&gt;</span>AT_MOST_ONCE<span xmlns="" class="perl_Keyword">&lt;/quality-of-service&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;failure-retry-interval&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/failure-retry-interval&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;max-retries&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/max-retries&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;max-batch-size&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/max-batch-size&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;max-batch-time&gt;</span>100<span xmlns="" class="perl_Keyword">&lt;/max-batch-time&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;add-messageID-in-header&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/add-messageID-in-header&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/jms-bridge&gt;</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			It is recommended to use a connection factory that does not set the <code class="literal">reconnect-attempts</code> parameter (or sets it to <code class="literal">0</code>), as JMS Bridge has its own <code class="literal">max-retries</code> parameter to handle reconnection. This is to avoid a potential collision that may result in longer reconnection times.
		</div></div></div><div class="table"><a id="idm139978440797088">
      ⁠</a><p class="title"><strong>Table 18.9. HornetQ Core JMS Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="HornetQ Core JMS Attributes"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> name </td><td> <div class="para">
						All bridges must have a unique name on the server.
					</div>
					 </td></tr><tr><td> source connection-factory </td><td> <div class="para">
						This injects the SourceCFF bean (also defined in the beans file). This bean creates the source ConnectionFactory.
					</div>
					 </td></tr><tr><td> source destination name </td><td> <div class="para">
						This injects the SourceDestinationFactory bean (also defined in the beans file). This bean creates the source Destination.
					</div>
					 </td></tr><tr><td> target connection-factory </td><td> <div class="para">
						This injects the TargetCFF bean (also defined in the beans file). This bean creates the target ConnectionFactory.
					</div>
					 </td></tr><tr><td> target destination name </td><td> <div class="para">
						This injects the TargetDestinationFactory bean (also defined in the beans file). This bean creates the target Destination.
					</div>
					 </td></tr><tr><td> quality-of-service </td><td> <div class="para">
						This parameter represents the required quality of service mode. The possible values are: AT_MOST_ONCE, DUPLICATES_OK, ONCE_AND_ONLY_ONCE
					</div>
					 </td></tr><tr><td> failure-retry-interval </td><td> <div class="para">
						This represents the amount of time in milliseconds to wait between trying to recreate connections to the source or target servers when the bridge has detected they have failed.
					</div>
					 </td></tr><tr><td> max-retries </td><td> <div class="para">
						This represents the number of attempts to recreate connections to the source or target servers when the bridge has detected they have failed. The bridge will give up after trying this number of times. -1 represents 'try forever'.
					</div>
					 </td></tr><tr><td> max-batch-size </td><td> <div class="para">
						This represents the maximum number of messages to consume from the source destination before sending them in a batch to the target destination. Its value must &gt;= 1.
					</div>
					 </td></tr><tr><td> max-batch-time </td><td> <div class="para">
						This represents the maximum number of milliseconds to wait before sending a batch to target, even if the number of messages consumed has not reached MaxBatchSize. Its value must be -1 to represent 'wait forever', or &gt;= 1 to specify an actual time.
					</div>
					 </td></tr><tr><td> add-messageID-in-header </td><td> <div class="para">
						If true, then the original message's message id will be appended in the message sent to the destination in the header HORNETQ_BRIDGE_MSG_ID_LIST. If the message is bridged more than once, each message id will be appended. This enables a distributed request-response pattern to be used.
					</div>
					 <div class="para">
						When you receive the message you can send a response using the correlation id of the first message id, so when the original sender receives the message, it is easy to correlate.
					</div>
					 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			When shutting down a server that has a deployed JMS bridge with <em class="parameter"><code>quality-of-service</code></em> attribute set to <code class="literal">ONCE_AND_ONLY_ONCE</code>, shut the server down with the JMS bridge first to avoid unexpected exceptions.
		</div></div></div><div class="para">
		For more complete instructions, see <a class="xref" href="chap-Messaging.html#Create_a_JMS_Bridge">Section 18.13.2, “Create a JMS Bridge”</a> .
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31365-767927+%5BLatest%5D&amp;comment=Title%3A+Configuring+JMS+Bridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31365-767927+20+Aug+2015+10%3A13+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Delayed_Redelivery1">
      ⁠</a>18.8.11. Configure Delayed Redelivery</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			Delayed redelivery is defined in the <code class="sgmltag-element">&lt;redelivery-delay&gt;</code> element, which is a child element of the <code class="sgmltag-element">&lt;address-setting&gt;</code> configuration element in the Java Messaging Service (JMS) subsystem configuration.
		</div><div class="para">
		
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- delay redelivery of messages for 5s --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.exampleQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;redelivery-delay&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/redelivery-delay&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre>

	</div><div class="para">
		If a redelivery delay is specified, the JMS system waits for the duration of this delay before redelivering the messages. If <code class="sgmltag-element">&lt;redelivery-delay&gt;</code> is set to <code class="literal">0</code>, there is no redelivery delay. Address wildcards can be used on the <em class="parameter"><code>match</code></em> attribute of <code class="sgmltag-element">&lt;address-match&gt;</code> element to configure the redelivery delay for addresses that match the wildcard.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+640-591650+%5BLatest%5D&amp;comment=Title%3A+Configure+Delayed+Redelivery%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=640-591650+23+Feb+2014+16%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Dead_Letter_Addresses1">
      ⁠</a>18.8.12. Configure Dead Letter Addresses</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			A dead letter address is defined in the <code class="sgmltag-element">&lt;address-setting&gt;</code> element of the Java Messaging Service (JMS) subsystem configuration.
		</div><div class="para">
		
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- undelivered messages in exampleQueue will be sent to the dead letter address </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">deadLetterQueue after 3 unsuccessful delivery attempts</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">--&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.exampleQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;dead-letter-address&gt;</span>jms.queue.deadLetterQueue<span xmlns="" class="perl_Keyword">&lt;/dead-letter-address&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;max-delivery-attempts&gt;</span>3<span xmlns="" class="perl_Keyword">&lt;/max-delivery-attempts&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre>

	</div><div class="para">
		If a <code class="sgmltag-element">&lt;dead-letter-address&gt;</code> is not specified, messages are removed after trying to deliver <code class="sgmltag-element">&lt;max-delivery-attempts&gt;</code> times. By default, messages delivery is attempted 10 times. Setting <code class="sgmltag-element">&lt;max-delivery-attempts&gt;</code> to <code class="literal">-1</code> allows infinite redelivery attempts. For example, a dead letter can be set globally for a set of matching addresses and you can set <code class="sgmltag-element">&lt;max-delivery-attempts&gt;</code> to <code class="literal">-1</code> for a specific address setting to allow infinite redelivery attempts only for this address. Address wildcards can also be used to configure dead letter settings for a set of addresses.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+643-760659+%5BLatest%5D&amp;comment=Title%3A+Configure+Dead+Letter+Addresses%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=643-760659+05+Jun+2015+06%3A17+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configure_Message_Expiry_Addresses1">
      ⁠</a>18.8.13. Configure Message Expiry Addresses</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			Message expiry addresses are defined in the address-setting configuration of the Java Messaging Service (JMS). For example:
		</div><div class="para">
		
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- expired messages in exampleQueue will be sent to the expiry address expiryQueue --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.exampleQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;expiry-address&gt;</span>jms.queue.expiryQueue<span xmlns="" class="perl_Keyword">&lt;/expiry-address&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre>

	</div><div class="para">
		If messages are expired and no expiry address is specified, messages are simply removed from the queue and dropped. <em class="firstterm">Address wildcards</em> can also be used to configure specific ranges of an expiry address for a set of addresses. See <a class="xref" href="chap-Messaging.html#Configure_JMS_Address_Settings">Section 18.8.2, “Configure JMS Address Settings”</a> for the JMX wildcard syntax and examples.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+650-760660+%5BLatest%5D&amp;comment=Title%3A+Configure+Message+Expiry+Addresses%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=650-760660+05+Jun+2015+06%3A30+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Flow_Control">
      ⁠</a>18.8.14. Flow Control</h2></div></div></div><div class="para">
		Flow control is used to limit the flow of data between a client and server, or a server and another server, in order to prevent the client or the server being overloaded with data.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Consumer Flow Control - controls the flow of data between the server and the client as the client consumes messages. For performance reasons clients normally buffer messages before delivering to the consumer via the <code class="literal">receive()</code> method or asynchronously via a message listener.
			</div><div class="para">
				<span class="emphasis"><em>Rate-limited flow control</em></span>: It is possible to control the rate at which a consumer can consume messages. This is a form of throttling and can be used to ensure that a consumer never consumes messages at a rate faster than the rate specified. The rate must be a positive integer to enable this functionality and is the maximum desired message consumption rate specified in units of messages per second. Setting this to <code class="literal">-1</code> disables rate limited flow control. The default value is <code class="literal">-1</code>. 
				<div class="example"><a id="idm139978536498896">
      ⁠</a><p class="title"><strong>Example 18.8. Rate limited flow control using JMS</strong></p><div class="example-contents"><div class="para">
						If JNDI is used to look up the connection factory, the max rate can be configured in <code class="literal">standalone.xml</code> or <code class="literal">domain.xml</code>: 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>		<span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty-connector"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>  	<span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- We limit consumers created on this connection factory to consume messages at a maximum rate of 10 messages per sec --&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;consumer-max-rate&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/consumer-max-rate&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span></pre>

					</div></div></div>

			</div><div class="para">
				If the connection factory is directly instantiated, the max rate size can be set via the <code class="literal">HornetQConnectionFactory.setConsumerMaxRate(int consumerMaxRate)</code> method.
			</div></li><li class="listitem"><div class="para">
				Producer flow control - limits the amount of data sent from a client to a server to prevent the server being overwhelmed.
			</div><div class="para">
				<span class="emphasis"><em>Window based flow control</em></span>: HornetQ producers, by default, can only send messages to an address as long as they have sufficient credits to do so. The amount of credits required to send a message is given by the size of the message. As producers run low on credits they request more from the server, when the server sends them more credits they can send more messages. The amount of credits a producer requests in one go is known as the window size. 
				<div class="example"><a id="idm139978541509616">
      ⁠</a><p class="title"><strong>Example 18.9. Producer window size flow control using JMS</strong></p><div class="example-contents"><div class="para">
						If JNDI is used to look up the connection factory, the producer window size can be configured in <code class="literal">standalone.xml</code> or <code class="literal">domain.xml</code>: 
<pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty-connector"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;producer-window-size&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/producer-window-size&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span></pre>

					</div></div></div>

			</div><div class="para">
				If the connection factory is directly instantiated, the producer window size can be set via the <code class="literal">HornetQConnectionFactory.setProducerWindowSize(int producerWindowSize)</code> method.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44637-768527+%5BLatest%5D&amp;comment=Title%3A+Flow+Control%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44637-768527+26+Aug+2015+02%3A03+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Reference_for_HornetQ_Configuration_Attributes">
      ⁠</a>18.8.15. Reference for HornetQ Configuration Attributes</h2></div></div></div><div class="para">
		The JBoss EAP 6 implementation of HornetQ exposes the following attributes for configuration. You can use the Management CLI to show the configurable or viewable attributes with the <code class="literal">read-resource</code> operation.
	</div><div class="example"><a id="idm139978532469472">
      ⁠</a><p class="title"><strong>Example 18.10. Use read-resource to show attributes</strong></p><div class="example-contents"><pre class="programlisting">[standalone@localhost:9999 /] /subsystem=messaging/hornetq-server=default:read-resource</pre></div></div><div class="table"><a id="idm139978492518768">
      ⁠</a><p class="title"><strong>Table 18.10. HornetQ Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols gt-14-rows" summary="HornetQ Attributes"><colgroup><col width="43%" style="text-align: left" class="c1"/><col width="14%" style="text-align: left" class="c2"/><col width="14%" style="text-align: left" class="c3"/><col width="29%" style="text-align: left" class="c4"/></colgroup><thead><tr><th style="text-align: left"> Attribute </th><th style="text-align: left"> Default Value </th><th style="text-align: left"> Type </th><th style="text-align: left"> Description </th></tr></thead><tbody><tr><td style="text-align: left"> <code class="literal">allow-failback</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether this server will automatically shutdown if the original live server comes back up </td></tr><tr><td style="text-align: left"> <code class="literal">async-connection-execution-enabled</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether incoming packets on the server must be handed off to a thread from the thread pool for processing </td></tr><tr><td style="text-align: left"> <code class="literal">address-setting</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> An address setting defines some attributes that are defined against an address wildcard rather than a specific queue </td></tr><tr><td style="text-align: left"> <code class="literal">acceptor</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> An acceptor defines a way in which connections can be made to the HornetQ server </td></tr><tr><td style="text-align: left"> <code class="literal">backup-group-name</code> </td><td style="text-align: left"> </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The name of a set of live/backups that must replicate with each other </td></tr><tr><td style="text-align: left"> <code class="literal">backup</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether this server is a backup server </td></tr><tr><td style="text-align: left"> <code class="literal">check-for-live-server</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether a replicated live server must check the current cluster to see if there is already a live server with the same node ID </td></tr><tr><td style="text-align: left"> <code class="literal">clustered</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> [Deprecated] Whether the server is clustered </td></tr><tr><td style="text-align: left"> <code class="literal">cluster-password</code> </td><td style="text-align: left"> <code class="literal">CHANGE ME!!</code> </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The password used by cluster connections to communicate between the clustered nodes </td></tr><tr><td style="text-align: left"> <code class="literal">cluster-user</code> </td><td style="text-align: left"> HORNETQ.CLUSTER.ADMIN.USER </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The user used by cluster connections to communicate between the clustered nodes </td></tr><tr><td style="text-align: left"> <code class="literal">cluster-connection</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Cluster connections group servers into clusters so that messages can be load balanced between the nodes of the cluster </td></tr><tr><td style="text-align: left"> <code class="literal">create-bindings-dir</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether the server must create the bindings directory on start up </td></tr><tr><td style="text-align: left"> <code class="literal">create-journal-dir</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether the server must create the journal directory on start up </td></tr><tr><td style="text-align: left"> <code class="literal">connection-ttl-override</code> </td><td style="text-align: left"> -1L </td><td style="text-align: left"> LONG </td><td style="text-align: left"> If set, this will override how long (in ms) to keep a connection alive without receiving a ping </td></tr><tr><td style="text-align: left"> <code class="literal">connection-factory</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Defines a connection factory </td></tr><tr><td style="text-align: left"> <code class="literal">connector</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> A connector can be used by a client to define how it connects to a server </td></tr><tr><td style="text-align: left"> <code class="literal">connector-service</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> </td></tr><tr><td style="text-align: left"> <code class="literal">divert</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> A messaging resource that allows you to transparently divert messages routed to one address to some other address, without making any changes to any client application logic </td></tr><tr><td style="text-align: left"> <code class="literal">discovery-group</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Multicast group to listen to receive broadcast from other servers announcing their connectors </td></tr><tr><td style="text-align: left"> <code class="literal">failback-delay</code> </td><td style="text-align: left"> 5000 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> How long to wait before failback occurs on live server restart </td></tr><tr><td style="text-align: left"> <code class="literal">failover-on-shutdown</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether this backup server (if it is a backup server) must come live on a normal server shutdown </td></tr><tr><td style="text-align: left"> <code class="literal">grouping-handler</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Makes decisions about which node in a cluster must handle a message with a group id assigned </td></tr><tr><td style="text-align: left"> <code class="literal">id-cache-size</code> </td><td style="text-align: left"> 20000 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The size of the cache for pre-creating message IDs </td></tr><tr><td style="text-align: left"> <code class="literal">in-vm-acceptor</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Defines a way in which in-VM connections can be made to the HornetQ server </td></tr><tr><td style="text-align: left"> <code class="literal">in-vm-connector</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Used by an in-VM client to define how it connects to a server </td></tr><tr><td style="text-align: left"> <code class="literal">jmx-domain</code> </td><td style="text-align: left"> org.hornetq </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The JMX domain used to register internal HornetQ MBeans in the MBeanServer </td></tr><tr><td style="text-align: left"> <code class="literal">jmx-management-enabled</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether HornetQ must expose its internal management API via JMX. This is not recommended, as accessing these MBeans can lead to inconsistent configuration </td></tr><tr><td style="text-align: left"> <code class="literal">journal-buffer-size</code> </td><td style="text-align: left"> 501760 (490KiB) </td><td style="text-align: left"> LONG </td><td style="text-align: left"> The size of the internal buffer on the journal </td></tr><tr><td style="text-align: left"> <code class="literal">journal-buffer-timeout</code> </td><td style="text-align: left"> 500000 (0.5 milliseconds) for ASYNCIO journal and 3333333 (3.33 milliseconds) for NIO journal </td><td style="text-align: left"> LONG </td><td style="text-align: left"> The timeout (in nanoseconds) used to flush internal buffers on the journal </td></tr><tr><td style="text-align: left"> <code class="literal">journal-compact-min-files</code> </td><td style="text-align: left"> 10 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The minimal number of journal data files before we can start compacting </td></tr><tr><td style="text-align: left"> <code class="literal">journal-compact-percentage</code> </td><td style="text-align: left"> 30 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The percentage of live data on which we consider compacting the journal </td></tr><tr><td style="text-align: left"> <code class="literal">journal-file-size</code> </td><td style="text-align: left"> 10485760 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> The size (in bytes) of each journal file </td></tr><tr><td style="text-align: left"> <code class="literal">journal-max-io</code> </td><td style="text-align: left"> 1 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The maximum number of write requests that can be in the AIO queue at any one time. The default value changes to 500 when ASYNCIO journal is used </td></tr><tr><td style="text-align: left"> <code class="literal">journal-min-files</code> </td><td style="text-align: left"> 2 </td><td style="text-align: left"> INT </td><td style="text-align: left"> How many journal files to pre-create </td></tr><tr><td style="text-align: left"> <code class="literal">journal-sync-non-transactional</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether to wait for non transaction data to be synced to the journal before returning a response to the client </td></tr><tr><td style="text-align: left"> <code class="literal">journal-sync-transactional</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether to wait for transaction data to be synchronized to the journal before returning a response to the client </td></tr><tr><td style="text-align: left"> <code class="literal">journal-type</code> </td><td style="text-align: left"> ASYNCIO </td><td style="text-align: left"> String </td><td style="text-align: left"> The type of journal to use. This attribute can take the values "ASYNCIO" or "NIO" </td></tr><tr><td style="text-align: left"> <code class="literal">jms-topic</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Defines a JMS topic </td></tr><tr><td style="text-align: left"> <code class="literal">live-connector-ref</code> </td><td style="text-align: left"> reference </td><td style="text-align: left"> STRING </td><td style="text-align: left"> [Deprecated] The name of the connector used to connect to the live connector. If this server is not a backup that uses shared nothing HA, it's value is "undefined" </td></tr><tr><td style="text-align: left"> <code class="literal">log-journal-write-rate</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether to periodically log the journal's write rate and flush rate </td></tr><tr><td style="text-align: left"> <code class="literal">mask-password</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td class="auto-generated"> </td></tr><tr><td style="text-align: left"> <code class="literal">management-address</code> </td><td style="text-align: left"> jms.queue.hornetq.management </td><td style="text-align: left"> STRING </td><td style="text-align: left"> Address to send management messages to </td></tr><tr><td style="text-align: left"> <code class="literal">management-notification-address</code> </td><td style="text-align: left"> hornetq.notifications </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The name of the address that consumers bind to in order to receive management notifications </td></tr><tr><td style="text-align: left"> <code class="literal">max-saved-replicated-journal-size</code> </td><td style="text-align: left"> 2 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The maximum number of backup journals to keep after failback occurs </td></tr><tr><td style="text-align: left"> <code class="literal">memory-measure-interval</code> </td><td style="text-align: left"> -1 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> Frequency to sample JVM memory in ms (or -1 to disable memory sampling) </td></tr><tr><td style="text-align: left"> <code class="literal">memory-warning-threshold</code> </td><td style="text-align: left"> 25 </td><td style="text-align: left"> INT </td><td style="text-align: left"> Percentage of available memory which if exceeded results in a warning log </td></tr><tr><td style="text-align: left"> <code class="literal">message-counter-enabled</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether message counters are enabled </td></tr><tr><td style="text-align: left"> <code class="literal">message-counter-max-day-history</code> </td><td style="text-align: left"> 10 </td><td style="text-align: left"> INT </td><td style="text-align: left"> How many days to keep message counter history </td></tr><tr><td style="text-align: left"> <code class="literal">message-counter-sample-period</code> </td><td style="text-align: left"> 10000 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> The sample period (in ms) to use for message counters </td></tr><tr><td style="text-align: left"> <code class="literal">message-expiry-scan-period</code> </td><td style="text-align: left"> 30000 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> How often (in ms) to scan for expired messages </td></tr><tr><td style="text-align: left"> <code class="literal">message-expiry-thread-priority</code> </td><td style="text-align: left"> 3 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The priority of the thread expiring messages </td></tr><tr><td style="text-align: left"> <code class="literal">page-max-concurrent-io</code> </td><td style="text-align: left"> 5 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The maximum number of concurrent reads allowed on paging </td></tr><tr><td style="text-align: left"> <code class="literal">perf-blast-pages</code> </td><td style="text-align: left"> -1 </td><td style="text-align: left"> INT </td><td class="auto-generated"> </td></tr><tr><td style="text-align: left"> <code class="literal">persist-delivery-count-before-delivery</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether the delivery count is persisted before delivery. False means that this only happens after a message has been canceled </td></tr><tr><td style="text-align: left"> <code class="literal">persist-id-cache</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether IDs are persisted to the journal </td></tr><tr><td style="text-align: left"> <code class="literal">persistence-enabled</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether the server will use the file based journal for persistence </td></tr><tr><td style="text-align: left"> <code class="literal">pooled-connection-factory</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Defines a managed connection factory </td></tr><tr><td style="text-align: left"> <code class="literal">remoting-interceptors</code> </td><td style="text-align: left"> undefined </td><td style="text-align: left"> LIST </td><td style="text-align: left"> [Deprecated] The list of interceptor classes used by this server </td></tr><tr><td style="text-align: left"> <code class="literal">remoting-incoming-interceptors</code> </td><td style="text-align: left"> undefined </td><td style="text-align: left"> LIST </td><td style="text-align: left"> The list of incoming interceptor classes used by this server </td></tr><tr><td style="text-align: left"> <code class="literal">remoting-outgoing-interceptors</code> </td><td style="text-align: left"> undefined </td><td style="text-align: left"> LIST </td><td style="text-align: left"> The list of outgoing interceptor classes used by this server </td></tr><tr><td style="text-align: left"> <code class="literal">run-sync-speed-test</code> </td><td style="text-align: left"> false </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether to perform a diagnostic test on how fast your disk can sync on startup. Useful when determining performance issues </td></tr><tr><td style="text-align: left"> <code class="literal">replication-clustername</code> </td><td style="text-align: left"> </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The name of the cluster connection to replicate from if more than one cluster connection is configured </td></tr><tr><td style="text-align: left"> <code class="literal">runtime-queue</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> A runtime queue </td></tr><tr><td style="text-align: left"> <code class="literal">remote-connector</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Used by a remote client to define how it connects to a server </td></tr><tr><td style="text-align: left"> <code class="literal">remote-acceptor</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> Defines a way in which remote connections can be made to the HornetQ server </td></tr><tr><td style="text-align: left"> <code class="literal">scheduled-thread-pool-max-size</code> </td><td style="text-align: left"> 5 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The number of threads that the main scheduled thread pool has </td></tr><tr><td style="text-align: left"> <code class="literal">security-domain</code> </td><td style="text-align: left"> other </td><td style="text-align: left"> STRING </td><td style="text-align: left"> The security domain to use in order to verify user and role information </td></tr><tr><td style="text-align: left"> <code class="literal">security-enabled</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether security is enabled </td></tr><tr><td style="text-align: left"> <code class="literal">security-setting</code> </td><td style="text-align: left"> </td><td style="text-align: left"> </td><td style="text-align: left"> A security setting allows sets of permissions to be defined against queues based on their address </td></tr><tr><td style="text-align: left"> <code class="literal">security-invalidation-interval</code> </td><td style="text-align: left"> 10000 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> How long (in ms) to wait before invalidating the security cache </td></tr><tr><td style="text-align: left"> <code class="literal">server-dump-interval</code> </td><td style="text-align: left"> -1 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> How often to dump basic runtime information to the server log. A value less than 1 disables this feature </td></tr><tr><td style="text-align: left"> <code class="literal">shared store</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether this server is using a shared store for failover </td></tr><tr><td style="text-align: left"> <code class="literal">thread-pool-max-size</code> </td><td style="text-align: left"> 30 </td><td style="text-align: left"> INT </td><td style="text-align: left"> The number of threads that the main thread pool has. -1 means no limit </td></tr><tr><td style="text-align: left"> <code class="literal">transaction-timeout</code> </td><td style="text-align: left"> 300000 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> How long (in ms) before a transaction can be removed from the resource manager after create time </td></tr><tr><td style="text-align: left"> <code class="literal">transaction-timeout-scan-period</code> </td><td style="text-align: left"> 1000 </td><td style="text-align: left"> LONG </td><td style="text-align: left"> How often (in ms) to scan for timeout transactions </td></tr><tr><td style="text-align: left"> <code class="literal">wild-card-routing-enabled</code> </td><td style="text-align: left"> true </td><td style="text-align: left"> BOOLEAN </td><td style="text-align: left"> Whether the server supports wild card routing </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			The value of <code class="code">journal-file-size</code> must be higher than the size of message sent to server, or the server will not be able to store the message.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9087-763407+%5BLatest%5D&amp;comment=Title%3A+Reference+for+HornetQ+Configuration+Attributes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9087-763407+29+Jun+2015+23%3A42+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Set_Message_Expiry">
      ⁠</a>18.8.16. Set Message Expiry</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Introduction</div>
			Sent messages can be set to expire on server if they're not delivered to consumer after specified amount of time (milliseconds). Using Java Messaging Service (JMS) or HornetQ Core API, the expiration time can be set directly on the message. For example:
		</div><div class="para">
		
<pre class="programlisting">
// message will expire in 5000ms from now
message.setExpiration(System.currentTimeMillis() + 5000);
</pre>

	</div><div class="para">
		JMS <code class="code">MessageProducer</code> includes a <code class="code">TimeToLive</code> parameter which controls message expiry for the messages it sends:
	</div><div class="para">
		
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// messages sent by this producer will be retained for 5s (5000ms) before expiration           </span>
<span xmlns="" class="line">​</span>producer.<span xmlns="" class="perl_Function">setTimeToLive</span>(<span xmlns="" class="perl_Float">5000</span>);
</pre>

	</div><div class="para">

	</div><div class="para">
		Expired messages which are consumed from an expiry address have the following properties:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				_HQ_ORIG_ADDRESS
			</div></li></ul></div><div class="para">
		A string property containing the original address of the expired message.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				_HQ_ACTUAL_EXPIRY
			</div></li></ul></div><div class="para">
		A long property containing the actual expiration time of the expired message.
	</div><div class="para">
		Besides setting the time-to-live parameter on the JMS producer, you can also set it on a per-message basis. You can achieve this by adding TTL parameter to producer's send method when sending the message.
	</div><div class="para">
		
<pre class="programlisting">producer.send(message, DeliveryMode.PERSISTENT, 0, 5000)
</pre>

	</div><div class="para">
		Where, the last parameter is message specific TTL.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuring Expiry Addresses</div>
			Expiry address are defined in the address-setting configuration:
		</div><div class="para">
		
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- expired messages in exampleQueue will be sent to the expiry address expiryQueue --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.exampleQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;expiry-address&gt;</span>jms.queue.expiryQueue<span xmlns="" class="perl_Keyword">&lt;/expiry-address&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre>

	</div><div class="para">
		If the messages are expired and no expiry address is specified, the messages are removed from the queue and dropped.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuring Expiry Reaper Thread</div>
			A reaper thread periodically inspects the queues to validate if messages have expired.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				message-expiry-scan-period
			</div></li></ul></div><div class="para">
		How often the queues will be scanned to detect expired messages (in milliseconds, default is 30000ms, set to -1 to disable the reaper thread).
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				message-expiry-thread-priority
			</div></li></ul></div><div class="para">
		The reaper thread priority. It must be between 0 and 9, 9 being the highest priority, default is 3.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+649-712268+%5BLatest%5D&amp;comment=Title%3A+Set+Message+Expiry%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=649-712268+23+Sep+2014+02%3A04+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-PRE_ACKNOWLEDGE_mode">
      ⁠</a>18.9. PRE_ACKNOWLEDGE mode</h1></div></div></div><div class="para">
			JMS specifies three acknowledgement modes:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					AUTO_ACKNOWLEDGE
				</div></li><li class="listitem"><div class="para">
					CLIENT_ACKNOWLEDGE
				</div></li><li class="listitem"><div class="para">
					DUPS_OK_ACKNOWLEDGE
				</div></li></ul></div><div class="para">
			HornetQ supports two additional modes: PRE_ACKNOWLEDGE and INDIVIDUAL_ACKNOWLEDGE.
		</div><div class="para">
			In some scenarios you could afford to lose messages in event of failure, so it would help to acknowledge the message on the server before delivering it to the client.
		</div><div class="para">
			This extra mode is supported by HornetQ and is called as pre-acknowledge mode.
		</div><div class="para">
			The disadvantage of acknowledging the messages on the server before delivery is that the message is lost if the system crashes after acknowledging the message on the server but before it is delivered to the client. In that case, the message is lost and will not be recovered when the system restart.
		</div><div class="para">
			Depending on the messaging case, pre-acknowledgement mode can avoid extra network traffic and CPU at the cost of coping with message loss.
		</div><div class="para">
			An example use case for pre-acknowledgement is related to stock price update messages. With these messages it might be reasonable to lose a message in event of crash, since the next price update message will arrive soon, overriding the previous price.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				If you use pre-acknowledge mode, then you will lose transactional semantics for messages being consumed, since they are being acknowledged first on the server, not when you commit the transaction.
			</div></div></div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A44726-768095+%5BLatest%5D&amp;comment=Title%3A+PRE_ACKNOWLEDGE+mode%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_PRE_ACKNOWLEDGE">
      ⁠</a>18.9.1. Using PRE_ACKNOWLEDGE</h2></div></div></div><div class="para">
		The pre-acknowledgement mode can be configured in the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> file on the connection factory.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty-connector"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;pre-acknowledge&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/pre-acknowledge&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span></pre><div class="para">
		Alternatively, to use pre-acknowledgement mode using the JMS API, create a JMS Session with the <em class="parameter"><code>HornetQSession.PRE_ACKNOWLEDGE</code></em> constant.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>// messages will be acknowledge on the server *before* being delivered to the client
<span xmlns="" class="line">​</span>Session session = connection.createSession(false, HornetQJMSConstants.PRE_ACKNOWLEDGE);</pre><div class="para">
		Alternatively, you can set pre-acknowledge directly on the <code class="classname">HornetQConnectionFactory</code> instance using the setter method.
	</div><div class="para">
		To use pre-acknowledgement mode using the core API you can set it directly on the <code class="classname">ClientSessionFactory</code> instance by using the setter method.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44728-768026+%5BLatest%5D&amp;comment=Title%3A+Using+PRE_ACKNOWLEDGE%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44728-768026+21+Aug+2015+07%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Individual_Acknowledge">
      ⁠</a>18.9.2. Individual Acknowledge</h2></div></div></div><div class="para">
		A valid use-case for individual acknowledgement is when you need to have your own scheduling and you do not know when your message processing will be finished. You prefer having one consumer per thread worker but this is not possible in some circumstances depending on how complex is your processing. For that you can use the individual acknowledgement.
	</div><div class="para">
		You must setup <em class="parameter"><code>Individual Acknowledge</code></em> by creating a session with the acknowledge mode with <em class="parameter"><code>HornetQJMSConstants.INDIVIDUAL_ACKNOWLEDGE</code></em>. Individual Acknowledge inherits all the semantics from Client Acknowledge, with the exception the message is individually acknowledged.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			To avoid confusion on MDB processing, Individual ACKNOWLEDGE is not supported through MDBs (or the inbound resource adapter). This is because you have to finish the process of your message inside the MDB
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44729-767950+%5BLatest%5D&amp;comment=Title%3A+Individual+Acknowledge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44729-767950+20+Aug+2015+13%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Thread_Management">
      ⁠</a>18.10. Thread Management</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Server-Side_Thread_Management">
      ⁠</a>18.10.1. Server-Side Thread Management</h2></div></div></div><div class="para">
				Each HornetQ Server maintains a single thread pool for general use, and scheduled thread pool for scheduled use. A Java scheduled thread pool cannot be configured to use a standard thread pool, otherwise we could use a single thread pool for both scheduled and non scheduled activity.
			</div><div class="para">
				When using old (blocking) IO, a separate thread pool is used to service connections. Since old IO requires a thread per connection, it is not recommended to get the threads from the standard pool as the pool will get exhausted if too many connections are made. This results in the server hanging, since it has no remaining threads to do anything else. If you require the server to handle many concurrent connections you must use NIO, not old IO.
			</div><div class="para">
				When using new IO (NIO), by default, HornetQ uses a number of threads equal to three times the number of cores (or hyper-threads) as reported by <code class="function">.getRuntime().availableProcessors()</code>Runtime for processing incoming packets. To override this value, you can set the number of threads by specifying the <em class="parameter"><code>nio-remoting-threads</code></em> parameter in the transport configuration.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A44730-768092+%5BLatest%5D&amp;comment=Title%3A+Server-Side+Thread+Management%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Server_Scheduled_Thread_Pool">
      ⁠</a>18.10.1.1. Server Scheduled Thread Pool</h3></div></div></div><div class="para">
		The server scheduled thread pool is used for most activities on the server side that require running periodically or with delays. It maps internally to a <code class="classname">java.util.concurrent.ScheduledThreadPoolExecutor</code> instance.
	</div><div class="para">
		The maximum number of thread used by this pool is configured in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> using the <em class="parameter"><code>scheduled-thread-pool-max-size</code></em> parameter. The default value is 5 threads. A small number of threads is usually sufficient for this pool.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44731-768093+%5BLatest%5D&amp;comment=Title%3A+Server+Scheduled+Thread+Pool%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44731-768093+22+Aug+2015+14%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="General_Purpose_Server_Thread_Pool">
      ⁠</a>18.10.1.2. General Purpose Server Thread Pool</h3></div></div></div><div class="para">
		The general purpose thread pool is used for most asynchronous actions on the server side. It maps internally to a <code class="classname">java.util.concurrent.ThreadPoolExecutor</code> instance.
	</div><div class="para">
		The maximum number of thread used by this pool is configured in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> using the <em class="parameter"><code>thread-pool-max-size</code></em> parameter.
	</div><div class="para">
		If a value of -1 is used, the thread pool has no upper bound and new threads are created on demand if there are not enough threads available to fulfill a request. If activity later subsides then threads are timed-out and closed.
	</div><div class="para">
		If a value of n, where n is a positive integer greater than zero, is used then the thread pool is bounded. If more requests come in and there are no free threads are available in the pool and the pool is full then requests will block until a thread becomes available. It is recommended that a bounded thread pool is used with caution since it can lead to dead-lock situations if the upper bound is chosen to be too low.
	</div><div class="para">
		The default value for <em class="parameter"><code>thread-pool-max-size</code></em> is 30.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44732-768094+%5BLatest%5D&amp;comment=Title%3A+General+Purpose+Server+Thread+Pool%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44732-768094+22+Aug+2015+14%3A46+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Expiry_Reaper_Thread">
      ⁠</a>18.10.1.3. Expiry Reaper Thread</h3></div></div></div><div class="para">
		A single thread is also used on the server side to scan for expired messages in queues. We cannot use either of the thread pools for this since this thread needs to run at its own configurable priority.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44733-767686+%5BLatest%5D&amp;comment=Title%3A+Expiry+Reaper+Thread%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44733-767686+18+Aug+2015+08%3A43+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Asynchronous_IO">
      ⁠</a>18.10.1.4. Asynchronous IO</h3></div></div></div><div class="para">
		Asynchronous IO has a thread pool for receiving and dispatching events out of the native layer. It is on a thread dump with the prefix <code class="classname">HornetQ-AIO-poller-pool</code>. HornetQ uses one thread per opened file on the journal (there is usually one).
	</div><div class="para">
		There is also a single thread used to invoke writes on <code class="classname">libaio</code>. It is done to avoid context switching on <code class="classname">libaio</code> that would cause performance issues. This thread is found on a thread dump with the prefix <code class="classname">HornetQ-AIO-writer-pool</code>.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44734-767921+%5BLatest%5D&amp;comment=Title%3A+Asynchronous+IO%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44734-767921+20+Aug+2015+08%3A52+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Client-Side_Thread_Management">
      ⁠</a>18.10.2. Client-Side Thread Management</h2></div></div></div><div class="para">
		On the client side, HornetQ maintains a single static scheduled thread pool and a single static general thread pool for use by all clients using the same classloader in that JVM instance.
	</div><div class="para">
		The static scheduled thread pool has a maximum size of 5 threads, and the general purpose thread pool has an unbounded maximum size.
	</div><div class="para">
		If required HornetQ can also be configured so that each <code class="classname">ClientSessionFactory</code> instance does not use these static pools but instead maintains its own scheduled and general purpose pool. Any sessions created from that <code class="classname">ClientSessionFactory</code> will use those pools instead.
	</div><div class="para">
		To configure a <code class="classname">ClientSessionFactory</code> instance to use its own pools, use the appropriate setter methods immediately after creation. For example:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>ServerLocator locator = HornetQClient.createServerLocatorWithoutHA(...)
<span xmlns="" class="line">​</span>ClientSessionFactory myFactory = locator.createClientSessionFactory();
<span xmlns="" class="line">​</span>myFactory.setUseGlobalPools(false);
<span xmlns="" class="line">​</span>myFactory.setScheduledThreadPoolMaxSize(10);
<span xmlns="" class="line">​</span>myFactory.setThreadPoolMaxSize(-1);</pre><div class="para">
		If you are using the JMS API, you can set the same parameters on the <code class="classname">ClientSessionFactory</code> and use it to create the ConnectionFactory instance. For example:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span>ConnectionFactory myConnectionFactory = HornetQJMSClient.createConnectionFactory(myFactory);</pre><div class="para">
		If you are using JNDI to instantiate <code class="classname">HornetQConnectionFactory</code> instances, you can also set these parameters in the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> file where you describe your connection factory. For example:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"XAConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;use-global-pools&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/use-global-pools&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;scheduled-thread-pool-max-size&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/scheduled-thread-pool-max-size&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;thread-pool-max-size&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/thread-pool-max-size&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span></pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44735-768019+%5BLatest%5D&amp;comment=Title%3A+Client-Side+Thread+Management%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44735-768019+21+Aug+2015+07%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Message_Grouping">
      ⁠</a>18.11. Message Grouping</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Message_Grouping">
      ⁠</a>18.11.1. About Message Grouping</h2></div></div></div><div class="para">
		A message group is a set/group of messages which share certain characteristics: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					All messages in a message group are grouped under a common group id. This means that they can be identified with a common group property
				</div></li><li class="listitem"><div class="para">
					All messages in a message group are serially processed and consumed by the same consumer irrespective of the number of customers on the queue. This means that a specific message group with a unique group id is always processed by one consumer when the consumer opens it. If the consumer closes the message group the entire message group is directed to another consumer in the queue
				</div></li></ul></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				Message groups are especially useful when there is a need for messages with a certain value of the property (group id) to be processed serially by a single consumer.
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31273-642097+%5BLatest%5D&amp;comment=Title%3A+About+Message+Grouping%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31273-642097+21+May+2014+00%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_HornetQ_Core_API_on_Client_Side">
      ⁠</a>18.11.2. Using HornetQ Core API on Client Side</h2></div></div></div><div class="para">
		The property <code class="literal">_HQ_GROUP_ID</code> is used to identify a message group in HornetQ Core API on client side. To pick a random unique message group identifier you can also set the <code class="literal">auto-group</code> property as <code class="literal">true</code> on the SessionFactory.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31274-765748+%5BLatest%5D&amp;comment=Title%3A+Using+HornetQ+Core+API+on+Client+Side%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31274-765748+22+Jul+2015+20%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Server_for_Java_Messaging_Service_JMS_Clients">
      ⁠</a>18.11.3. Configuring Server for Java Messaging Service (JMS) Clients</h2></div></div></div><div class="para">
		The property <code class="literal">JMSXGroupID</code> is used to identify a message group for Java Messaging Service (JMS) clients. If you wish to send a message group with different messages to one consumer you can set the same <code class="literal">JMSXGroupID</code> for different messages: 
<pre class="programlisting">
 Message message = ...
 message.setStringProperty("JMSXGroupID", "Group-0");
 producer.send(message);

 message = ...
 message.setStringProperty("JMSXGroupID", "Group-0");
 producer.send(message);
</pre>
		 The second approach is to set the <code class="literal">auto-group</code> property to <code class="literal">true</code> on the <code class="methodname">HornetQConnectonFactory</code>. The <code class="methodname">HornetQConnectionFactory</code> will then pick up a random unique message group identifier. You can set the <code class="literal">auto-group</code> property in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>) as follows: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty-connector"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;auto-group&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/auto-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
</pre>
		 An alternative to the above methods is to set a specific message group identifier through the connection factory. This will in turn set the property <code class="literal">JMSXGroupID</code> to the specified value for all messages sent through this connection factory. To set a specific message group identifier on the connection factory, edit the <code class="literal">group-id</code> property in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>) as follows: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty-connector"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;group-id&gt;</span>Group-0<span xmlns="" class="perl_Keyword">&lt;/group-id&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
</pre>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31275-765029+%5BLatest%5D&amp;comment=Title%3A+Configuring+Server+for+Java+Messaging+Service+%28JMS%29+Clients%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31275-765029+15+Jul+2015+01%3A09+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Clustered_Grouping">
      ⁠</a>18.11.4. Clustered Grouping</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Clustered grouping is provided as <a href="https://access.redhat.com/support/offerings/techpreview">technology preview</a> only. It is not supported for use in a production environment and may be subject to significant future changes.
		</div></div></div><div class="para">
		Clustered grouping follows a different approach relative to normal message grouping. In a cluster, message groups with specific group ids can arrive on any of the nodes. It is important for a node to determine which group ids are bound to which consumer on which node. Each node is responsible for routing message groups correctly to the node which has the consumer processing those group ids irrespective of where the message groups arrive by default. Once messages with a given group id are sent to a specific consumer connected to the given node in the cluster, then those messages are never sent to another node even if the consumer is disconnected.
	</div><div class="para">
		This situation is addressed by a grouping handler. Each node has a grouping handler and this grouping handler (along with other handlers) is responsible for routing the message groups to the correct node. There are two types of grouping handlers namely <code class="literal">local</code> and <code class="literal">remote</code>.
	</div><div class="para">
		The local handler is responsible for deciding the route which a message group should take. The remote handlers communicate with the local handler and work accordingly. Each cluster should choose a specific node to have a local grouping handler and all the other nodes should have remote handlers.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			If message grouping is used in cluster, it breaks if the server with configured remote grouping handler fails. Setting up backup for remote grouping handler also does not have affect.
		</div></div></div><div class="para">
		You can configure "local" and "remote" grouping handlers in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>) as follows: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;grouping-handler</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-grouping-handler"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;type&gt;</span>LOCAL<span xmlns="" class="perl_Keyword">&lt;/type&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;timeout&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/timeout&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/grouping-handler&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;grouping-handler</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-grouping-handler"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;type&gt;</span>REMOTE<span xmlns="" class="perl_Keyword">&lt;/type&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;timeout&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/timeout&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/grouping-handler&gt;</span>
</pre>
		 The "timeout" attribute ensures that a routing decision is made quickly within the specified time. If a decision is not made within this time an exception is thrown.
	</div><div class="para">
		The node which initially receives a message group takes the routing decision based on regular cluster routing conditions (round-robin queue availability). The node proposes this decision to the respective grouping handler which then routes the messages to the proposed queue if it accepts the proposal.
	</div><div class="para">
		If the grouping handler rejects the proposal, it proposes some other route and the routing takes place accordingly. The other nodes follow suite and forward the message groups to the chosen queue. After a message arrives on a queue it is pinned to a customer on that queue.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31276-781523+%5BLatest%5D&amp;comment=Title%3A+Clustered+Grouping%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31276-781523+13+Oct+2017+14%3A27+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Best_Practices_for_Clustered_Grouping">
      ⁠</a>18.11.5. Best Practices for Clustered Grouping</h2></div></div></div><div class="para">
		Some best practices for clustered grouping are as follows: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					If you create and close consumers regularly make sure that your consumers are distributed evenly across the different nodes. Once a queue is pinned, messages are automatically transferred to that queue regardless of removing customers from it
				</div></li><li class="listitem"><div class="para">
					If you wish to remove a queue which has a message group bound to it, make sure the queue is deleted by the session that is sending the messages. Doing this will ensure that other nodes will not try to route messages to this queue after it is removed
				</div></li><li class="listitem"><div class="para">
					As a failover mechanism always replicate the node which has the local grouping handler
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+31277-642097+%5BLatest%5D&amp;comment=Title%3A+Best+Practices+for+Clustered+Grouping%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=31277-642097+21+May+2014+00%3A08+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Duplicate_Message_Detection">
      ⁠</a>18.12. Duplicate Message Detection</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Duplicate_Message_Detection">
      ⁠</a>18.12.1. About Duplicate Message Detection</h2></div></div></div><div class="para">
		Duplicate message detection allows filtering of duplicate messages without the need of coding the duplicate detection logic within the application. You can configure duplicate message detection in HornetQ.
	</div><div class="para">
		When a sender(client/server) sends a message to another server there can be a situation where the target server(receiver) or the connection fails after sending the message but before sending a response to the sender indicating that the process was successful. In such situations, it is very difficult for the sender(client) to determine if the message was sent successfully to the intended receiver.
	</div><div class="para">
		The message send may or may not be successful depending on when the target receiver or connection failed (before or after sending the message). If the sender (client/server) decides to resend the last message it can result in a duplicate message being sent to the address.
	</div><div class="para">
		HornetQ provides duplicate message detection for messages sent to addresses.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41001-686116+%5BLatest%5D&amp;comment=Title%3A+About+Duplicate+Message+Detection%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41001-686116+20+Jul+2014+18%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_Duplicate_Message_Detection_for_Sending_Messages">
      ⁠</a>18.12.2. Using Duplicate Message Detection for Sending Messages</h2></div></div></div><div class="para">
		To enable duplicate message detection for sent messages you need to set a special property on the message to a unique value. You can create this value the way you wish but this value must be unique.
	</div><div class="para">
		When the target server receives this message, it checks if the special property is set. If the property is set then the target server checks its memory cache for a received message with that value of the header. If the server finds any message with the same value of the header it ignores the message sent by a client.
	</div><div class="para">
		If you are sending messages in a transaction then you do not have to set the property for every message you send in that transaction; you only need to set it once in the transaction. If the server detects a duplicate message for any message in the transaction, then it will ignore the entire transaction.
	</div><div class="para">
		The name of the property that you set is given by the value of <em class="parameter"><code>org.hornetq.api.core.HDR_DUPLICATE_DETECTION_ID</code></em>, which is <em class="parameter"><code>_HQ_DUPL_ID</code></em>. The value of this property can be of type <code class="literal">byte[]</code> or <code class="literal">SimpleString</code> for core API. For Java Messaging Service (JMS) clients, it must be of the type <code class="literal">String</code> with a unique value. An easy way of generating a unique id is by generating a UUID.
	</div><div class="para">
		The following example shows how to set the property for core API: 
<pre class="programlisting">...     

ClientMessage message = session.createMessage(true);

SimpleString myUniqueID = "This is my unique id";   // Can use a UUID for this

message.setStringProperty(HDR_DUPLICATE_DETECTION_ID, myUniqueID);

...
</pre>
		 The following example shows how to set the property for JMS clients: 
<pre class="programlisting">...     

Message jmsMessage = session.createMessage();

String myUniqueID = "This is my unique id";   // Could use a UUID for this

message.setStringProperty(HDR_DUPLICATE_DETECTION_ID.toString(), myUniqueID);

...
</pre>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41002-686116+%5BLatest%5D&amp;comment=Title%3A+Using+Duplicate+Message+Detection+for+Sending+Messages%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41002-686116+20+Jul+2014+18%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Duplicate_ID_Cache">
      ⁠</a>18.12.3. Configuring Duplicate ID Cache</h2></div></div></div><div class="para">
		The server maintains caches of received values of the <em class="parameter"><code>org.hornetq.core.message.impl.HDR_DUPLICATE_DETECTION_ID</code></em> property sent to each address. Each address maintains its own address cache.
	</div><div class="para">
		The cache is fixed in terms of size. The maximum size of cache is configured using the parameter <em class="parameter"><code>id-cache-size</code></em> in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>). The default value of this parameter is 2000 elements. If the cache has a maximum size of n elements, then the (n + 1)th ID stored will overwrite the 0th element in the cache.
	</div><div class="para">
		The caches can also be configured to persist to disk or not. This can be configured using the parameter <em class="parameter"><code>persist-id-cache</code></em> in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>). If this value is set "true" then each ID will be persisted to permanent storage as they are received. The default value for this parameter is true. 
		<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Set the size of the duplicate ID cache to a large size in order to ensure that resending of messages does not overwrite the previously sent messages stored in the cache.
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41003-686116+%5BLatest%5D&amp;comment=Title%3A+Configuring+Duplicate+ID+Cache%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41003-686116+20+Jul+2014+18%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_Duplicate_Detection_with_Bridges_and_Cluster_Connections">
      ⁠</a>18.12.4. Using Duplicate Detection with Bridges and Cluster Connections</h2></div></div></div><div class="para">
		Core bridges can be configured to automatically add a unique duplicate ID value (if there isn't already one in the message) before forwarding the message to the target. To configure a core bridge for duplication message detection set the property <em class="parameter"><code>use-duplicate-detection</code></em> to "true" in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>). The default value of this parameter is "true".
	</div><div class="para">
		Cluster connections internally use core bridges to move messages between nodes of the cluster. To configure a cluster connection for duplicate message detection set the property <em class="parameter"><code>use-duplicate-detection</code></em> to "true" in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>). The default value of this parameter is "true".
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+41083-686116+%5BLatest%5D&amp;comment=Title%3A+Using+Duplicate+Detection+with+Bridges+and+Cluster+Connections%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=41083-686116+20+Jul+2014+18%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JMS_Bridges">
      ⁠</a>18.13. JMS Bridges</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Bridges1">
      ⁠</a>18.13.1. About Bridges</h2></div></div></div><div class="para">
		The function of a bridge is to consume messages from a source queue, and forward them to a target address, typically on a different HornetQ server. Bridges cope with unreliable connections, automatically reconnecting when the connections become available again. HornetQ bridges can be configured with filter expressions to only forward certain messages.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			JMS bridge cannot be deployed to EAP 6 server, which includes HornetQ configured as a dedicated backup. The reason is that Transaction Manager on a dedicated backup server is unable to recover transactions previously started on the HornetQ live server.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+9102-644024+%5BLatest%5D&amp;comment=Title%3A+About+Bridges%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=9102-644024+26+May+2014+05%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Create_a_JMS_Bridge">
      ⁠</a>18.13.2. Create a JMS Bridge</h2></div></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Summary</div>
			A JMS bridge consumes messages from a source JMS queue or topic and sends them to a target JMS queue or topic, which is typically on a different server. It can be used to bridge messages between any JMS servers, as long as they are JMS 1.1 compliant. The source and destination JMS resources are looked up using JNDI and the client classes for the JNDI lookup must be bundled in a module. The module name is then declared in the JMS bridge configuration.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139978501253136">
      ⁠</a><p class="title"><strong>Procedure 18.2. Create a JMS Bridge</strong></p><div class="para">
			This procedure demonstrates how to configure a JMS bridge to migrate messages from a JBoss EAP 5.x server to a JBoss EAP 6 server.
		</div><ol class="1"><li class="step"><div class="para">
				Configure the Bridge On the Source JMS Messaging Server
			</div><div class="para">
				Configure the JMS bridge on the source server using the instructions provided for that server type. For an example of how to configure a JMS Bridge for a JBoss EAP 5.x server, see the topic entitled <em class="citetitle">Create a JMS Bridge</em> in the <em class="citetitle">Migration Guide</em> for JBoss EAP 6.
			</div></li><li class="step"><div class="para">
				Configure the Bridge on the Destination JBoss EAP 6 Server
			</div><div class="para">
				In JBoss EAP 6.1 and later, the JMS bridge can be used to bridge messages from any JMS 1.1 compliant server. Because the source and target JMS resources are looked up using JNDI, the JNDI lookup classes of the source messaging provider, or message broker, must be bundled in a JBoss Module. The following steps use the fictitious 'MyCustomMQ' message broker as an example.
			</div><ol class="substeps a"><li class="step"><div class="para">
						Create the JBoss module for the messaging provider.
					</div><ol class="substeps i"><li class="step"><div class="para">
								Create a directory structure under <code class="filename"><em class="replaceable">EAP_HOME</em>/modules/system/layers/base/</code> for the new module. The <code class="filename">main/</code> subdirectory will contain the client JARs and <code class="filename">module.xml</code> file. The following is an example of the directory structure created for the MyCustomMQ messaging provider: <code class="filename"><em class="replaceable">EAP_HOME</em>/modules/system/layers/base/org/mycustommq/main/</code>
							</div></li><li class="step"><div class="para">
								In the <code class="filename">main/</code> subdirectory, create a <code class="filename">module.xml</code> file containing the module definition for the messaging provider. The following is an example of the <code class="filename">module.xml</code> created for the MyCustomMQ messaging provider. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:module:1.1"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.mycustommq"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;properties&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.api"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"private"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/properties&gt;</span> 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;resources&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- Insert resources required to connect to the source or target   --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;resource-root</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"mycustommq-1.2.3.jar"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;resource-root</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"mylogapi-0.0.1.jar"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/resources&gt;</span> 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">&lt;!-- Add the dependencies required by JMS Bridge code                 --&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"javax.api"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"javax.jms.api"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"javax.transaction.api"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">&lt;!-- Add a dependency on the org.hornetq module since we send         --&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">&lt;!-- messages tothe HornetQ server embedded in the local EAP instance --&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;module</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"org.hornetq"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/module&gt;</span>
</pre>

							</div></li><li class="step"><div class="para">
								Copy the messaging provider JARs required for the JNDI lookup of the source resources to the module's <code class="filename">main/</code> subdirectory. The directory structure for the MyCustomMQ module should now look like the following. 
<pre class="screen">
modules/
`-- system
    `-- layers
        `-- base
            `-- org
                  `-- mycustommq
                      `-- main
                          |-- mycustommq-1.2.3.jar
                          |-- mylogapi-0.0.1.jar
                          |-- module.xml
</pre>

							</div></li></ol></li><li class="step"><div class="para">
						Configure the JMS bridge in the <code class="literal">messaging</code> subsystem of the JBoss EAP 6 server.
					</div><ol class="substeps i"><li class="step"><div class="para">
								Before you begin, stop the server and back up the current server configuration files. If you are running a standalone server, this is the <code class="filename"><em class="replaceable">EAP_HOME</em>/standalone/configuration/standalone-full-ha.xml</code> file. If you are running a managed domain, back up both the <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/domain.xml</code> and the <code class="filename"><em class="replaceable">EAP_HOME</em>/domain/configuration/host.xml</code> files.
							</div></li><li class="step"><div class="para">
								Add the <code class="literal">jms-bridge</code> element to the <code class="literal">messaging</code> subsystem in the server configuration file. The <code class="literal">source</code> and <code class="literal">target</code> elements provide the names of the JMS resources used for JNDI lookups. If <code class="literal">user</code> and <code class="literal">password</code> credentials are specified, they are passed as arguments when JMS connection is created.
							</div><div class="para">
								The following is an example of the <code class="literal">jms-bridge</code> element configured for the MyCustomMQ messaging provider: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;subsystem</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:domain:messaging:1.3"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;jms-bridge</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"myBridge"</span><span xmlns="" class="perl_Others"> module=</span><span xmlns="" class="perl_String">"org.mycustommq"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;source&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;destination</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"sourceQ"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;user&gt;</span>user1<span xmlns="" class="perl_Keyword">&lt;/user&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;password&gt;</span>pwd1<span xmlns="" class="perl_Keyword">&lt;/password&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;context&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"java.naming.factory.initial"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.mycustommq.jndi.MyCustomMQInitialContextFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"java.naming.provider.url"</span><span xmlns="" class="perl_Others">    value=</span><span xmlns="" class="perl_String">"tcp://127.0.0.1:9292"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/context&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/source&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;target&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java:/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;destination</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/jms/targetQ"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/target&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;quality-of-service&gt;</span>DUPLICATES_OK<span xmlns="" class="perl_Keyword">&lt;/quality-of-service&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;failure-retry-interval&gt;</span>500<span xmlns="" class="perl_Keyword">&lt;/failure-retry-interval&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;max-retries&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/max-retries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;max-batch-size&gt;</span>500<span xmlns="" class="perl_Keyword">&lt;/max-batch-size&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;max-batch-time&gt;</span>500<span xmlns="" class="perl_Keyword">&lt;/max-batch-time&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;add-messageID-in-header&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/add-messageID-in-header&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/jms-bridge&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/subsystem&gt;</span>
</pre>
								 In the above example, the JNDI properties are defined in the <code class="literal">context</code> element for the <code class="literal">source</code>. If the <code class="literal">context</code> element is omitted, as in the <code class="literal">target</code> example above, the JMS resources are looked up in the local instance.
							</div></li></ol></li></ol></li></ol></div><div class="para">

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34417-766860+%5BLatest%5D&amp;comment=Title%3A+Create+a+JMS+Bridge%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34417-766860+05+Aug+2015+11%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Persistence">
      ⁠</a>18.14. Persistence</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Persistence_in_HornetQ">
      ⁠</a>18.14.1. About Persistence in HornetQ</h2></div></div></div><div class="para">
		HornetQ handles its own persistence. It ships with a high-performance journal, which is optimized for messaging-specific use cases.
	</div><div class="para">
		The HornetQ journal is append only with a configurable file size, which improves performance by enabling single write operations. It consists of a set of files on disk, which are initially pre-created to a fixed size and filled with padding. As server operations (add message, delete message, update message, etc.) are performed, records of the operations are appended to the journal until the journal file is full, at which point the next journal file is used.
	</div><div class="para">
		A sophisticated garbage collection algorithm determines whether journal files can be reclaimed and re-used when all of their data has been deleted. A compaction algorithm removes dead space from journal files and compresses the data.
	</div><div class="para">
		The journal also fully supports both local and XA transactions.
	</div><div class="para">
		The majority of the journal is written in Java, but interaction with the file system has been abstracted to allow different pluggable implementations. The two implementations shipped with HornetQ are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="emphasis"><em>Java New I/O (NIO)</em></span>
			</div><div class="para">
				Uses standard Java NIO to interface with the file system. This provides extremely good performance and runs on any platform with a Java 6 or later runtime.
			</div></li><li class="listitem"><div class="para">
				<span class="emphasis"><em>Linux Asynchronous IO (AIO)</em></span>
			</div><div class="para">
				Uses a native code wrapper to talk to the Linux asynchronous IO library (AIO). With AIO, HornetQ receives a message when data has been persisted. This removes the need for explicit syncs. AIO will typically provide better performance than Java NIO, but requires Linux kernel 2.6 or later and the libaio package.
			</div><div class="para">
				AIO also requires ext2, ext3, ext4, jfs or xfs type file systems.
			</div></li></ul></div><div class="para">
		The standard HornetQ core server uses the following journal instances:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="emphasis"><em>bindings journal</em></span>
			</div><div class="para">
				Stores bindings-related data, including the set of queues deployed on the server and their attributes. It also stores data such as ID sequence counters. The bindings journal is always a NIO journal, as it typically has low throughput in comparison to the message journal.
			</div><div class="para">
				The files on this journal are prefixed as hornetq-bindings. Each file has a bindings extension. File size is 1048576 bytes, and it is located in the bindings folder.
			</div></li><li class="listitem"><div class="para">
				<span class="emphasis"><em>JMS journal</em></span>
			</div><div class="para">
				Stores all JMS-related data, for example, any JMS queues, topics or connection factories and any JNDI bindings for these resources. Any JMS resources created with the management API are persisted to this journal. Any resources configured with configuration files are not. This journal is created only if JMS is in use.
			</div></li><li class="listitem"><div class="para">
				<span class="emphasis"><em>message journal</em></span>
			</div><div class="para">
				Stores all message-related data, including messages themselves and duplicate-id caches. By default, HornetQ uses AIO for this journal. If AIO is not available, it will automatically fall back to NIO.
			</div></li></ul></div><div class="para">
		Large messages are persisted outside the message journal. In low memory situations, configure HornetQ to page messages to disk. If persistence is not required, HornetQ can be configured not to persist any data.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Running JBoss EAP server with installed HornetQ natives and journal type set to AsyncIO causes error when running on <code class="filename">tmpfs</code> filesystem.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+13385-777866+%5BLatest%5D&amp;comment=Title%3A+About+Persistence+in+HornetQ%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13385-777866+15+Jun+2016+11%3A26+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Import_or_Export_the_Journal_Data">
      ⁠</a>18.14.2. Import or Export the Journal Data</h2></div></div></div><div class="para">
		You may want to inspect the existent records on each one of the journals used by HornetQ, and you can use the export/import tool for that purpose. The export/import are classes located in the <code class="literal"><em class="replaceable">EAP_HOME</em>/bin/client/jboss-client.jar</code>, you can export the journal as a text file by using this command: <code class="command"> java -cp jboss-client.jar org.hornetq.core.journal.impl.ExportJournal &lt;JournalDirectory&gt; &lt;JournalPrefix&gt; &lt;FileExtension&gt; &lt;FileSize&gt; &lt;FileOutput&gt;</code>
	</div><div class="para">
		To import the file as binary data on the journal: <code class="command"> java -cp jboss-client.jar org.hornetq.core.journal.impl.ImportJournal &lt;JournalDirectory&gt; &lt;JournalPrefix&gt; &lt;FileExtension&gt; &lt;FileSize&gt; &lt;FileInput&gt; </code>
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				JournalDirectory: Use the configured folder for your selected folder. Example:<em class="replaceable">./hornetq/data/journal</em>
			</div></li><li class="listitem"><div class="para">
				JournalPrefix: Use the prefix for your selected journal, as discussed
			</div></li><li class="listitem"><div class="para">
				FileExtension: Use the extension for your selected journal, as discussed
			</div></li><li class="listitem"><div class="para">
				FileSize: Use the size for your selected journal, as discussed
			</div></li><li class="listitem"><div class="para">
				FileOutput: text file that will contain the exported data
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44644-767910+%5BLatest%5D&amp;comment=Title%3A+Import+or+Export+the+Journal+Data%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44644-767910+20+Aug+2015+06%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-HornetQ_Clustering">
      ⁠</a>18.15. HornetQ Clustering</h1></div></div></div><div class="para">
			HornetQ clusters are used to create groups of HornetQ servers in order to share message processing load. Each active node in the cluster acts as an independent HornetQ server and manages its own messages and connections.
		</div><div class="para">
			To form a cluster, each node (independent HornetQ server) declares cluster connections with another node with configuration parameters in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>).
		</div><div class="para">
			In clustering, core bridges are used for bridging/routing messages from one cluster to another. Core bridges consume messages from a source queue and then forward these messages to a target HornetQ server (node) which may or may not be in the same cluster.
		</div><div class="para">
			When a node forms a cluster connection with another node, it creates a core bridge internally. Each node creates an explicit core bridge and you do not need to declare it. These cluster connections allow transmission of messages between nodes in various clusters for balancing message processing load.
		</div><div class="para">
			You can configure cluster nodes in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				You can configure a node through server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>) and copy this configuration to other nodes to generate a symmetric cluster. However you must be careful when you are copying the server configuration files. You must not copy the HornetQ data (i.e. the bindings, journal, and large messages directories) from one node to another. When a node is started for the first time it persists a unique identifier to the journal directory which is needed for proper formation of clusters.
			</div></div></div><div class="para RoleCreateBugPara">
			<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A34449-665442+%5BLatest%5D&amp;comment=Title%3A+HornetQ+Clustering%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_Server_Discovery">
      ⁠</a>18.15.1. About Server Discovery</h2></div></div></div><div class="para">
		Servers use a mechanism called "server discovery" to:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Forward their connection details to messaging clients: Messaging clients intend to connect to servers of a cluster without specific details on the servers which are up and running at a given point of time
			</div></li><li class="listitem"><div class="para">
				Connect to other servers: Servers in a cluster want to establish cluster connections with other servers without specific details on of all other servers in a cluster
			</div></li></ul></div><div class="para">
		Information about servers is sent to messaging clients via normal HornetQ connections and to other servers via cluster connections.
	</div><div class="para">
		The initial first connection needs to be established and it can be established using dynamic server discovery techniques like UDP (User Datagram Protocol), JGroups or by providing a list of connectors.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34452-665442+%5BLatest%5D&amp;comment=Title%3A+About+Server+Discovery%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34452-665442+09+Jun+2014+13%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Broadcast_Groups">
      ⁠</a>18.15.2. Broadcast Groups</h2></div></div></div><div class="para">
				Connectors are used on the client to define how and in what ways it connects to the server. Servers use broadcast groups to broadcast connectors over the network. The broadcast group takes a set of connector pairs and broadcasts them on the network. Each connector pair contains connection settings for a live and backup server.
			</div><div class="para">
				You can define broadcast groups in <em class="parameter"><code>broadcast-groups</code></em> element of server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>). A single HornetQ server can have many broadcast groups. You can define either a User Datagram Protocol (UDP) or a JGroup broadcast group.
			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A34454-665442+%5BLatest%5D&amp;comment=Title%3A+Broadcast+Groups%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="User_Datagram_Protocol_UDP_Broadcast_Group">
      ⁠</a>18.15.2.1. User Datagram Protocol (UDP) Broadcast Group</h3></div></div></div><div class="para">
		The example shown below defines a UDP broadcast group: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;broadcast-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-broadcast-group"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;local-bind-address&gt;</span>172.16.9.3<span xmlns="" class="perl_Keyword">&lt;/local-bind-address&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;local-bind-port&gt;</span>5432<span xmlns="" class="perl_Keyword">&lt;/local-bind-port&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;group-address&gt;</span>231.7.7.7<span xmlns="" class="perl_Keyword">&lt;/group-address&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;group-port&gt;</span>9876<span xmlns="" class="perl_Keyword">&lt;/group-port&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;broadcast-period&gt;</span>2000<span xmlns="" class="perl_Keyword">&lt;/broadcast-period&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/broadcast-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/broadcast-groups&gt;</span>
</pre>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				In the configuration example shown above, the attributes "local-bind-address", "local-bind-port", "group-address" and "group-port" are deprecated. Instead of these attributes you can choose to use the attribute "socket-binding".
			</div></div></div>

	</div><div class="para">
		The example shown below defines a UDP broadcast group replacing all the deprecated attributes with the attribute "socket-binding": 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;broadcast-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-broadcast-group"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;socket-binding&gt;</span>messaging-group<span xmlns="" class="perl_Keyword">&lt;/socket-binding&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;broadcast-period&gt;</span>2000<span xmlns="" class="perl_Keyword">&lt;/broadcast-period&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/broadcast-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/broadcast-groups&gt;</span>
</pre>

	</div><div class="para">
		The table shown below describes all the important parameters used in the above examples and in general to define a UDP broadcast group: 
		<div class="table"><a id="idm139978517526432">
      ⁠</a><p class="title"><strong>Table 18.11. UDP Broadcast Group Parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="UDP Broadcast Group Parameters"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> name attribute </td><td> <div class="para">
							Denotes the name of each broadcast group in a server. Each broadcast group must have a unique name.
						</div>
						 </td></tr><tr><td> local-bind-address </td><td> <div class="para">
							[Deprecated] This is a UDP specific attribute and specifies the local bind address which the datagram packet binds to. You must set this property to define the interface which you wish to use for your broadcasts. If this property is not specified then the socket binds to a wildcard address (a random kernel generated address).
						</div>
						 </td></tr><tr><td> local-bind-port </td><td> <div class="para">
							[Deprecated] This is a UDP specific attribute and is used to specify a local port which the datagram socket binds to. A default value of "-1" specifies an anonymous port to be used.
						</div>
						 </td></tr><tr><td> group-address </td><td> <div class="para">
							[Deprecated] This is a multicast address specific to UDP where messages are broadcast. This IP address has a range of 224.0.0.0 to 239.255.255.255, inclusive. The IP address 224.0.0 is reserved and can not be used.
						</div>
						 </td></tr><tr><td> group-port </td><td> <div class="para">
							[Deprecated] This denotes the UDP port number for broadcasting.
						</div>
						 </td></tr><tr><td> socket-binding </td><td> <div class="para">
							This denotes the broadcast group socket binding
						</div>
						 </td></tr><tr><td> broadcast-period </td><td> <div class="para">
							This parameter specifies the time between two broadcasts (milliseconds). It is optional.
						</div>
						 </td></tr><tr><td> connector-ref </td><td> <div class="para">
							This refers to the connector which will be broadcasted.
						</div>
						 </td></tr></tbody></table></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34455-673414+%5BLatest%5D&amp;comment=Title%3A+User+Datagram+Protocol+%28UDP%29+Broadcast+Group%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34455-673414+16+Jun+2014+05%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="JGroups_Broadcast_Group">
      ⁠</a>18.15.2.2. JGroups Broadcast Group</h3></div></div></div><div class="para">
		You can use JGroups to broadcast by specifying two attributes namely <em class="parameter"><code>jgroups-stack</code></em> and <em class="parameter"><code>jgroups-channel</code></em>. The example shown below defines a JGroups broadcast group: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;broadcast-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"bg-group1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jgroups-stack&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/jgroups-stack&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jgroups-channel&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/jgroups-channel&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;broadcast-period&gt;</span>2000<span xmlns="" class="perl_Keyword">&lt;/broadcast-period&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/broadcast-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/broadcast-groups&gt;</span>
</pre>
		 The JGroups broadcast group definition uses two main attributes: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<em class="parameter"><code>jgroups-stack</code></em> attribute: This denotes the name of a stack defined in the <code class="literal">org.jboss.as.clustering.jgroups</code> subsystem
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>jgroups-channel</code></em> attribute: This denotes the channel which JGroups channels connect to for broadcasting
				</div></li></ul></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34456-673419+%5BLatest%5D&amp;comment=Title%3A+JGroups+Broadcast+Group%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34456-673419+16+Jun+2014+05%3A54+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Discovery_Groups">
      ⁠</a>18.15.3. Discovery Groups</h2></div></div></div><div class="para">
				Broadcast groups are used for broadcasting connectors over a network. On the other hand discovery groups define how connector information is received from broadcast endpoints (UDP or JGroups broadcast group). A discovery group maintains a list of connector pair- one for each broadcast by a different server.
			</div><div class="para">
				When a discovery group receives broadcasts on a broadcast endpoint for a specific server, it accordingly updates the connector pairs entry in the list for the specific server. If it does not receive a broadcast from a specific server for a long time, it removes the server's entry from the list altogether.
			</div><div class="para">
				Discovery groups are mainly used by cluster connections and Java Messaging Service (JMS) clients to obtain initial connection information in order to download the required topology. 
				<div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						You must configure each discovery group with an appropriate broadcast endpoint which matches its broadcast group counterpart (UDP or JGroups).
					</div></div></div>

			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A34457-665442+%5BLatest%5D&amp;comment=Title%3A+Discovery+Groups%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configuring_User_Datagram_Protocol_UDP_Discovery_Group_on_the_Server">
      ⁠</a>18.15.3.1. Configuring User Datagram Protocol (UDP) Discovery Group on the Server</h3></div></div></div><div class="para">
		The example shown below defines a UDP discovery group: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;discovery-groups&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;discovery-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-discovery-group"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;local-bind-address&gt;</span>172.16.9.7<span xmlns="" class="perl_Keyword">&lt;/local-bind-address&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;group-address&gt;</span>231.7.7.7<span xmlns="" class="perl_Keyword">&lt;/group-address&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;group-port&gt;</span>9876<span xmlns="" class="perl_Keyword">&lt;/group-port&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;refresh-timeout&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/refresh-timeout&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/discovery-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/discovery-groups&gt;</span>
</pre>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				In the configuration example shown above, the attributes "local-bind-address", "group-address" and "group-port" are deprecated. Instead of these attributes you can choose to use the attribute "socket-binding".
			</div></div></div>

	</div><div class="para">
		The example shown below defines a UDP discovery group replacing all the deprecated attributes with the attribute "socket-binding": 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;discovery-groups&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;discovery-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-discovery-group"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;socket-binding&gt;</span>messaging-group<span xmlns="" class="perl_Keyword">&lt;/socket-binding&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;refresh-timeout&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/refresh-timeout&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/discovery-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/discovery-groups&gt;</span>
</pre>

	</div><div class="para">
		The table shown below describes all the important parameters used in the above example and in general to define a discovery group: 
		<div class="table"><a id="idm139978536298080">
      ⁠</a><p class="title"><strong>Table 18.12. UDP Discovery Group Parameters</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="UDP Discovery Group Parameters"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> name attribute </td><td> <div class="para">
							This attribute denotes the name of your discovery group. Each discovery name must have a unique name per server.
						</div>
						 </td></tr><tr><td> local-bind-address </td><td> <div class="para">
							[Deprecated] This is an optional UDP specific attribute. It is used to configure a discovery group to listen on a specific interface when using multiple interfaces on the same machine.
						</div>
						 </td></tr><tr><td> group-address </td><td> <div class="para">
							[Deprecated] This is a compulsory UDP specific attribute. It is used to configure a discovery group to listen on the multicast IP address of a group. The value of this attribute must match the <em class="parameter"><code>group-address</code></em> attribute of the broadcast group that you wish to listen from.
						</div>
						 </td></tr><tr><td> group-port </td><td> <div class="para">
							[Deprecated] This is a compulsory UDP specific attribute. It is used to configure the UDP port of the multicast group. The value of this attribute must match the <em class="parameter"><code>group-port</code></em> attribute of the multicast group that you wish to listen from.
						</div>
						 </td></tr><tr><td> socket-binding </td><td> <div class="para">
							This denotes the discovery group socket binding
						</div>
						 </td></tr><tr><td> refresh-timeout </td><td> <div class="para">
							This is an optional UDP specific attribute. It is used to configure the time period (in milliseconds) for which the discovery group waits before removing a server's connector pair entry from the list after receiving the last broadcast from that server. The value of <em class="parameter"><code>refresh-timeout</code></em> must be set significantly higher than the value of <em class="parameter"><code>broadcast-period</code></em> attribute on the broadcast group to prevent quick removal servers from the list when the broadcast process is still on. The default value of this attribute is 10,000 milliseconds.
						</div>
						 </td></tr></tbody></table></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34458-673431+%5BLatest%5D&amp;comment=Title%3A+Configuring+User+Datagram+Protocol+%28UDP%29+Discovery+Group+on+the+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34458-673431+16+Jun+2014+07%3A32+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configuring_JGroups_Discovery_Group_on_the_Server">
      ⁠</a>18.15.3.2. Configuring JGroups Discovery Group on the Server</h3></div></div></div><div class="para">
		The example shown below defines a JGroups discovery group: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;discovery-groups&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;discovery-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dg-group1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jgroups-stack&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/jgroups-stack&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jgroups-channel&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/jgroups-channel&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;refresh-timeout&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/refresh-timeout&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/discovery-group&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/discovery-groups&gt;</span>
</pre>
		 The JGroups discovery group definition uses two main attributes: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<em class="parameter"><code>jgroups-stack</code></em> attribute: This denotes the name of a stack defined in the <code class="literal">org.jboss.as.clustering.jgroups</code> subsystem
				</div></li><li class="listitem"><div class="para">
					<em class="parameter"><code>jgroups-channel</code></em> attribute: This attribute denotes the channel which JGroups channels connect to for receiving broadcasts
				</div></li></ul></div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				JGroup attributes and UDP specific attributes are exclusive. You can use either JGroup or UDP set of attributes in the configuration of a discovery group or a broadcast group
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34459-673423+%5BLatest%5D&amp;comment=Title%3A+Configuring+JGroups+Discovery+Group+on+the+Server%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34459-673423+16+Jun+2014+06%3A29+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configuring_Discovery_Groups_for_Java_Messaging_Service_JMS_Clients">
      ⁠</a>18.15.3.3. Configuring Discovery Groups for Java Messaging Service (JMS) Clients</h3></div></div></div><div class="para">
		Discovery groups can be configured for JMS and core clients. You can specify the discovery group to be used for a JMS connection factory in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>):
	</div><div class="para">
		
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;discovery-group-ref</span><span xmlns="" class="perl_Others"> discovery-group-name=</span><span xmlns="" class="perl_String">"my-discovery-group"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
</pre>
		 The element <em class="parameter"><code>discovery-group-ref</code></em> is used to specify the name of a discovery group. When a client application downloads this connection factory from Java Naming and Directory Interface (JNDI) and creates JMS connections, these connections are load balanced across all the servers which the discovery group maintains by listening on the multicast address specified in the discovery group configuration.
	</div><div class="para">
		If you are using JMS but not JNDI to lookup for a connection factory then you can specify the discovery group parameters directly when creating the JMS connection factory: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>final String groupAddress = "231.7.7.7";
<span xmlns="" class="line">​</span>final int groupPort = 9876;
<span xmlns="" class="line">​</span>ConnectionFactory jmsConnectionFactory = HornetQJMSClient.createConnectionFactory(new DiscoveryGroupConfiguration(groupAddress, groupPort, new UDPBroadcastGroupConfiguration(groupAddress, groupPort, null, -1)), JMSFactoryType.CF);
<span xmlns="" class="line">​</span>Connection jmsConnection1 = jmsConnectionFactory.createConnection();
<span xmlns="" class="line">​</span>Connection jmsConnection2 = jmsConnectionFactory.createConnection();
</pre>

	</div><div class="para">
		The default value of <em class="parameter"><code>refresh-timeout</code></em> attribute can be set on DiscoveryGroupConfiguration by using the setter method <code class="methodname">setDiscoveryRefreshTimeout()</code>. For the connection factory to wait for a specific amount of time before creating the first connection, you can use the setter method <code class="methodname">setDiscoveryInitialWaitTimeout()</code> on DiscoveryGroupConfiguration.
	</div><div class="para">
		Doing this ensures that the connection factory has enough time to receive broadcasts from all the nodes in the cluster. The default value for this parameter is 10000 milliseconds.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34461-665442+%5BLatest%5D&amp;comment=Title%3A+Configuring+Discovery+Groups+for+Java+Messaging+Service+%28JMS%29+Clients%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34461-665442+09+Jun+2014+13%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configuring_discovery_for_Core_API">
      ⁠</a>18.15.3.4. Configuring discovery for Core API</h3></div></div></div><div class="para">
		If you are using the core API to directly instantiate <em class="parameter"><code>ClientSessionFactory</code></em> instances, then you can specify the discovery group parameters directly when creating the session factory: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>final String groupAddress = "231.7.7.7";
<span xmlns="" class="line">​</span>final int groupPort = 9876;
<span xmlns="" class="line">​</span>ServerLocator factory = HornetQClient.createServerLocatorWithHA(new DiscoveryGroupConfiguration(groupAddress, groupPort, new UDPBroadcastGroupConfiguration(groupAddress, groupPort, null, -1))));
<span xmlns="" class="line">​</span>ClientSessionFactory factory = locator.createSessionFactory();
<span xmlns="" class="line">​</span>ClientSession session1 = factory.createSession();
<span xmlns="" class="line">​</span>ClientSession session2 = factory.createSession();
</pre>
		 The default value of <em class="parameter"><code>refresh-timeout</code></em> attribute can be set on DiscoveryGroupConfiguration by using the setter method <code class="methodname">setDiscoveryRefreshTimeout()</code>. You can use <code class="methodname">setDiscoveryInitialWaitTimeout()</code> on DiscoveryGroupConfiguration for the session factory to wait for a specific amount of time before creating a session.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34462-665442+%5BLatest%5D&amp;comment=Title%3A+Configuring+discovery+for+Core+API%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34462-665442+09+Jun+2014+13%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Server_Side_Load_Balancing">
      ⁠</a>18.15.4. Server Side Load Balancing</h2></div></div></div><div class="para">
				There is one important cluster topology: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							Symmetric Cluster: In a symmetric cluster every cluster node is connected directly to every other node in the cluster. To create a symmetric cluster every node in the cluster defines a cluster connection with the attribute <em class="parameter"><code>max-hops</code></em> set to 1. 
							<div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									In a symmetric cluster each node knows about all the queues that exist on all the other nodes and what consumers they have. With this knowledge it can determine how to load balance and redistribute messages around the nodes.
								</div></div></div>

						</div></li></ul></div>

			</div><div class="para RoleCreateBugPara">
				<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+IDs%3A%0A34463-673425+%5BLatest%5D&amp;comment=Title%3A+Server+Side+Load+Balancing%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configuring_Cluster_Connections">
      ⁠</a>18.15.4.1. Configuring Cluster Connections</h3></div></div></div><div class="para">
		Cluster connections are configured in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>) in the element <em class="parameter"><code>cluster-connection</code></em>. There can be zero or more cluster connections defined per HornetQ server. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-connections&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;cluster-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-cluster"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty-connector<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;check-period&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/check-period&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connection-ttl&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/connection-ttl&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;min-large-message-size&gt;</span>50000<span xmlns="" class="perl_Keyword">&lt;/min-large-message-size&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;call-timeout&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/call-timeout&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;retry-interval&gt;</span>500<span xmlns="" class="perl_Keyword">&lt;/retry-interval&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;retry-interval-multiplier&gt;</span>1.0<span xmlns="" class="perl_Keyword">&lt;/retry-interval-multiplier&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;max-retry-interval&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/max-retry-interval&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;reconnect-attempts&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/reconnect-attempts&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;use-duplicate-detection&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/use-duplicate-detection&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;forward-when-no-consumers&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/forward-when-no-consumers&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;max-hops&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/max-hops&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;confirmation-window-size&gt;</span>32000<span xmlns="" class="perl_Keyword">&lt;/confirmation-window-size&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;call-failover-timeout&gt;</span>30000<span xmlns="" class="perl_Keyword">&lt;/call-failover-timeout&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;notification-interval&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/notification-interval&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;notification-attempts&gt;</span>2<span xmlns="" class="perl_Keyword">&lt;/notification-attempts&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;discovery-group-ref</span><span xmlns="" class="perl_Others"> discovery-group-name=</span><span xmlns="" class="perl_String">"my-discovery-group"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/cluster-connection&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/cluster-connections&gt;</span>
</pre>
		 The following table defines the configurable attributes: 
		<div class="table"><a id="idm139978529156848">
      ⁠</a><p class="title"><strong>Table 18.13. Cluster Connections Configurable Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-14-rows" summary="Cluster Connections Configurable Attributes"><colgroup><col style="text-align: left" class="Attribute"/><col style="text-align: left" class="Description"/><col style="text-align: left" class="Default"/></colgroup><thead><tr><th style="text-align: left"> Attribute </th><th style="text-align: left"> Description </th><th style="text-align: left"> Default </th></tr></thead><tbody><tr><td style="text-align: left"> <em class="parameter"><code>address</code></em> </td><td style="text-align: left"> Each cluster connection only applies to messages sent to an address that starts with this value. The address can be any value and you can have many cluster connections with different values of addresses, simultaneously balancing messages for those addresses, potentially to different clusters of servers. This does not use wild card matching. </td><td style="text-align: left"> </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>connector-ref</code></em> </td><td style="text-align: left"> This is a compulsory attribute which refers to the connector sent to other nodes in the cluster so that they have the correct cluster topology </td><td style="text-align: left"> </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>check-period</code></em> </td><td style="text-align: left"> This refers to the time period (in milliseconds) which is used to verify if a cluster connection has failed to receive pings from another server </td><td style="text-align: left"> 30,000 milliseconds </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>connection-ttl</code></em> </td><td style="text-align: left"> This specifies how long a cluster connection must stay alive if it stops receiving messages from a specific node in the cluster </td><td style="text-align: left"> 60,000 milliseconds </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>min-large-message-size</code></em> </td><td style="text-align: left"> If the message size (in bytes) is larger than this value then it will be split into multiple segments when sent over the network to other cluster members </td><td style="text-align: left"> 102400 bytes </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>call-timeout</code></em> </td><td style="text-align: left"> This specifies the time period (milliseconds) for which a packet sent over a cluster connection waits (for a reply) before throwing an exception </td><td style="text-align: left"> 30,000 milliseconds </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>retry-interval</code></em> </td><td style="text-align: left"> If the cluster connection is created between nodes of a cluster and the target node has not been started, or is being rebooted, then the cluster connections from other nodes will retry connecting to the target until it comes back up. The parameter <em class="parameter"><code>retry-interval</code></em> defines the interval (milliseconds) between retry attempts </td><td style="text-align: left"> 500 milliseconds </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>retry-interval-multiplier</code></em> </td><td style="text-align: left"> This is used to increment the <em class="parameter"><code>retry-interval</code></em> after each retry attempt </td><td style="text-align: left"> 1 </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>max-retry-interval</code></em> </td><td style="text-align: left"> This refers to the maximum delay (in milliseconds) for retries </td><td style="text-align: left"> 2000 milliseconds </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>reconnect-attempts</code></em> </td><td style="text-align: left"> This defines the number of times the system will try to connect a node on the cluster </td><td style="text-align: left"> -1 (infinite retries) </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>use-duplicate-detection</code></em> </td><td style="text-align: left"> Cluster connections use bridges to link the nodes, and bridges can be configured to add a duplicate id property in each message that is forwarded. If the target node of the bridge crashes and then recovers, messages might be resent from the source node. By enabling duplicate detection any duplicate messages will be filtered out and ignored on receipt at the target node. </td><td style="text-align: left"> True </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>forward-when-no-consumers</code></em> </td><td style="text-align: left"> This parameter determines whether or not messages will be distributed in a round robin fashion between other nodes of the cluster regardless of whether there are matching or indeed any consumers on other nodes </td><td style="text-align: left"> False </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>max-hops</code></em> </td><td style="text-align: left"> This determines how messages are load balanced to other HornetQ serves which are connected to this server </td><td style="text-align: left"> -1 </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>confirmation-window-size</code></em> </td><td style="text-align: left"> The size (in bytes) of the window used for sending confirmations from the server connected to </td><td style="text-align: left"> 1048576 </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>call-failover-timeout</code></em> </td><td style="text-align: left"> This is used when a call is made during a failover attempt </td><td style="text-align: left"> -1 (no timeout) </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>notification-interval</code></em> </td><td style="text-align: left"> This determines how often (in milliseconds) the cluster connection must broadcast itself when attaching to the cluster </td><td style="text-align: left"> 1000 milliseconds </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>notification-attempts</code></em> </td><td style="text-align: left"> This defines as to how many times the cluster connection must broadcast itself when connecting to the cluster </td><td style="text-align: left"> 2 </td></tr><tr><td style="text-align: left"> <em class="parameter"><code>discovery-group-ref</code></em> </td><td style="text-align: left"> This parameter determines which discovery group is used to obtain the list of other servers in the cluster which the current cluster connection will make connections to </td><td style="text-align: left"> </td></tr></tbody></table></div></div>
		 When creating connections between nodes of a cluster to form a cluster connection, HornetQ uses a cluster user and cluster password which is defined in server configuration files (<code class="filename">standalone.xml</code> and <code class="filename">domain.xml</code>): 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-user&gt;</span>HORNETQ.CLUSTER.ADMIN.USER<span xmlns="" class="perl_Keyword">&lt;/cluster-user&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-password&gt;</span>NEW USER<span xmlns="" class="perl_Keyword">&lt;/cluster-password&gt;</span>
</pre>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				It is important to change the default values of these credentials to prevent remote clients from making connections to the server using the default values.
			</div></div></div>

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34464-745776+%5BLatest%5D&amp;comment=Title%3A+Configuring+Cluster+Connections%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34464-745776+04+Mar+2015+01%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-High_Availability">
      ⁠</a>18.16. High Availability</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="High_Availability_Introduction">
      ⁠</a>18.16.1. High Availability Introduction</h2></div></div></div><div class="para">
		HornetQ supports the ability to continue functioning after failure of one or more of the servers. Part of this is achieved through failover support where client connections migrate from the live server to a backup server in the event of the live server failing. To keep the backup server current, messages are replicated from the live server to the backup server continuously through two strategies: shared store and replication.
	</div><div class="para">
		There are two types of high-availability Topologies: 
		<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="literal">Dedicated Topology</code>: This topology comprises of two EAP servers. In the first server HornetQ is configured as a live server. In the second server HornetQ is configured as a backup server. The EAP server which has HornetQ configured as a backup server, acts only as a container for HornetQ. This server is inactive and can not host deployments like EJBs, MDBs or Servlets.
				</div></li><li class="listitem"><div class="para">
					<code class="literal">Collocated Topology</code>: This topology contains two EAP servers. Each EAP server contains two HornetQ servers (a live server and a backup server). The HornetQ live server on first EAP server and the HornetQ backup server on the second EAP server form a live backup pair. Whereas the HornetQ live server on the second EAP server and the HornetQ backup server on the first EAP server form another live backup pair.
				</div></li></ul></div>
		 In collocated topology, as soon as a live HornetQ server (part of live-backup pair) fails, the backup HornetQ server takes up and becomes active. When the backup HornetQ server shuts down in case of failback then destinations and connection factories configured in the backup server are unbound from JNDI (Java Naming and Directory Interface).
	</div><div class="para">
		Java Naming and Directory Interface is shared with the other live HornetQ server (part of the other live-backup pair). Therefore unbounding of destinations and connection factories from JNDI also unbounds destinations and connection factories for this live HornetQ server. 
		<div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				Configuration of collocated backup servers cannot contain configuration of destinations or connection factories.
			</div></div></div>

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The following information references <code class="literal">standalone-full-ha.xml</code>. The configuration changes can be applied to <code class="literal">standalone-full-ha.xml</code>, or any configuration files derived from it.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+28639-674132+%5BLatest%5D&amp;comment=Title%3A+High+Availability+Introduction%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=28639-674132+18+Jun+2014+06%3A56+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_HornetQ_Shared_Stores">
      ⁠</a>18.16.2. About HornetQ Shared Stores</h2></div></div></div><div class="para">
		When using a shared store, both the live and backup servers share the same, entire data directory, using a shared file system. This includes the paging directory, journal directory, large messages, and the binding journal. When failover occurs and the backup server takes over, it will load the persistent storage from the shared file system. Clients can then connect to it.
	</div><div class="para">
		This form of high-availability differs from data replication, as it requires a shared file system accessible by both the live and backup nodes. This will usually be a high performance Storage Area Network (SAN) of some kind.
	</div><div class="para">
		The advantage of shared store high-availability is that no replication occurs between the live and backup nodes. This means it does not suffer any performance penalties due to the overhead of replication during normal operation.
	</div><div class="para">
		The disadvantage of shared store replication is that it requires a shared file system, and when the backup server activates it must load the journal from the shared store. This can take some time, depending on the amount of data in the store.
	</div><div class="para">
		If the highest performance during normal operation is required, there is access to a fast SAN, and a slightly slower failover rate is acceptable (depending on the amount of data), shared store high-availability is recommended.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			HornetQ's data replication mechanism would replicate JMS data and not replicate bindings.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+13604-770220+%5BLatest%5D&amp;comment=Title%3A+About+HornetQ+Shared+Stores%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13604-770220+14+Sep+2015+06%3A13+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_HornetQ_Storage_Configurations">
      ⁠</a>18.16.3. About HornetQ Storage Configurations</h2></div></div></div><div class="para">
		HornetQ supports shared storage when using the Red Hat Enterprise Linux version of NFSv4, either ASYNCIO or NIO journal type, for shared storage. The Red Hat Enterprise Linux NFS implementation supports both direct I/O (opening files with the O_DIRECT flag set), and kernel based asynchronous I/O. When configuring NFS for shared storage, it is recommended to use a highly-available NFS configuration.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			When using the Red Hat Enterprise Linux NFSv4 as a shared storage option, the client cache must be disabled.
		</div></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+37029-781574+%5BLatest%5D&amp;comment=Title%3A+About+HornetQ+Storage+Configurations%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=37029-781574+15+Nov+2017+11%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_HornetQ_Journal_Types">
      ⁠</a>18.16.4. About HornetQ Journal Types</h2></div></div></div><div class="para">
		Two journal types are available for HornetQ:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				ASYNCIO
			</div></li><li class="listitem"><div class="para">
				NIO
			</div></li></ul></div><div class="para">
		The ASYNCIO journal type, also known as AIO, is a thin native code wrapper around the Linux asynchronous IO library (AIO). Using native functionality can provide better performance than NIO. This journal type is only supported on Red Hat Enterprise Linux and requires that <code class="filename">libaio</code> and the Native Components package are installed where JBoss EAP 6 is running. See the <em class="citetitle">Installation Guide</em> for instructions on installing the Native Components package.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Check the server log after JBoss EAP 6 is started, to ensure that the native library successfully loaded, and that the ASYNCIO journal type is being used. If the native library fails to load, HornetQ will revert to the NIO journal type, and this will be stated in the server log.
		</div></div></div><div class="para">
		The NIO journal type uses standard Java NIO to interface with the file system. It provides very good performance and runs on all supported platforms.
	</div><div class="para">
		To specify the HornetQ journal type, set the parameter <code class="literal">&lt;journal-type&gt;</code> in the <code class="literal">Messaging</code> subsystem.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+37031-673598+%5BLatest%5D&amp;comment=Title%3A+About+HornetQ+Journal+Types%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=37031-673598+16+Jun+2014+18%3A58+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_HornetQ_Shared_Stores">
      ⁠</a>18.16.5. Configuring HornetQ for Dedicated Topology with Shared Store</h2></div></div></div><div class="para">
		To configure the live and backup servers for shared store in dedicated topology, configure the <code class="filename">standalone-X.xml</code> files on each server to have the following: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;shared-store&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/shared-store&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;paging-directory</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"${shared.directory}/paging"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bindings-directory</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"${shared.directory}/bindings"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;journal-directory</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"${shared.directory}/journal"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;large-messages-directory</span><span xmlns="" class="perl_Others"> path=</span><span xmlns="" class="perl_String">"${shared.directory}/large-messages"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-connections&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;cluster-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-cluster"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      ...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/cluster-connection&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/cluster-connections&gt;</span>
</pre>
		 <div class="table"><a id="idm139978512193360">
      ⁠</a><p class="title"><strong>Table 18.14. HornetQ Servers Setup Attributes (for both live and backup servers)</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="HornetQ Servers Setup Attributes (for both live and backup servers)"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> shared-store </td><td> <div class="para">
							Whether this server is using shared store or not. Default is false
						</div>
						 </td></tr><tr><td> paging-directory path </td><td> <div class="para">
							This indicates the path to the paging directory. This path is the same for both live and backup servers as they share this directory
						</div>
						 </td></tr><tr><td> bindings-directory path </td><td> <div class="para">
							This indicates the path to the binding journal. This path is the same for both live and backup servers as they share this journal
						</div>
						 </td></tr><tr><td> journal-directory path </td><td> <div class="para">
							This indicates the path to the journal directory. This path is the same for both live and backup servers as they share this directory
						</div>
						 </td></tr><tr><td> large-messages-directory path </td><td> <div class="para">
							This indicates the path to the large messages directory. This path is the same for both live and backup servers as they share this directory
						</div>
						 </td></tr><tr><td> failover-on-shutdown </td><td> <div class="para">
							Whether this server becomes active when live or currently active backup server shuts down
						</div>
						 </td></tr></tbody></table></div></div>
		 The backup server must also be flagged explicitly as a backup. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;backup&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/backup&gt;</span>
</pre>
		 The setup attribute exclusively for HornetQ backup server is: <code class="literal">allow-failback</code>. This specifies whether the backup server will automatically shutdown if the original live server comes back up.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+34211-765160+%5BLatest%5D&amp;comment=Title%3A+Configuring+HornetQ+for+Dedicated+Topology+with+Shared+Store%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=34211-765160+15+Jul+2015+22%3A14+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="HornetQ_Message_Replication">
      ⁠</a>18.16.6. HornetQ Message Replication</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Only persistent messages are replicated. Any non-persistent messages do not survive failover.
		</div></div></div><div class="para">
		Message replication between a live and a backup server is achieved via network traffic as the live and backup servers do not share the same data stores. All the journals are replicated between the two servers as long as the two servers are within the same cluster and have the same cluster username and password. All persistent data traffic received by the live server gets replicated to the backup server.
	</div><div class="para">
		When the backup server comes online, it looks for and connects to a live server to attempt synchronization. While it is synchronizing, it is unavailable as a backup server. Synchronization can take a long time depending on the amount of data to be synchronized and the network speed. If the backup server comes online and no live server is available, the backup server will wait until the live server is available in the cluster.
	</div><div class="para">
		To enable servers to replicate data, a link must be defined between them in the <code class="filename">standalone-full-ha.xml</code> file. A backup server will only replicate with a live server with the same group name. The group name must be defined in the <em class="parameter"><code>backup-group-name</code></em> parameter in the <code class="filename">standalone-full-ha.xml</code> file on each server.
	</div><div class="para">
		In the event of a live server failing, the correctly configured and fully synchronized backup server takes over its duties. The backup server will activate only if the live server has failed and the backup server is able to connect to more than half of the servers in the cluster. If more than half of the other servers in the cluster also fail to respond it would indicate a general network failure and the backup server will wait to retry the connection to the live server.
	</div><div class="para">
		To get to the original state after failover, it is necessary to start the live server and wait until it is fully synchronized with the backup server. When this has been achieved, you can shutdown the backup server for the original live server to activate again. This happens automatically if the <em class="parameter"><code>allow-failback</code></em> attribute is set to true.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+13565-661896+%5BLatest%5D&amp;comment=Title%3A+HornetQ+Message+Replication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13565-661896+06+Jun+2014+01%3A19+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_the_HornetQ_Servers_for_Replication">
      ⁠</a>18.16.7. Configuring the HornetQ Servers for Replication</h2></div></div></div><div class="para">
		To configure the live and backup servers to be a replicating pair, configure the <code class="filename">standalone-full-ha.xml</code> files on each server to have the following settings:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;shared-store&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/shared-store&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;backup-group-name&gt;</span>NameOfLiveBackupPair<span xmlns="" class="perl_Keyword">&lt;/backup-group-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;check-for-live-server&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/check-for-live-server&gt;</span>
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span>.
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;cluster-connections&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;cluster-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-cluster"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      ...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/cluster-connection&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/cluster-connections&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Administrators must take care not to mix settings for shared store and replicated configurations. For example, the <code class="literal">backup-group-name</code> attribute, which is used for replication, should not be set when <code class="literal">shared-store</code> is set to <code class="literal">true</code>, which indicates a shared store.
		</div></div></div><div class="table"><a id="idm139978512522672">
      ⁠</a><p class="title"><strong>Table 18.15. HornetQ Replicating Setup Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="HornetQ Replicating Setup Attributes"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> shared-store </td><td> <div class="para">
						Whether this server is using shared store or not. This value should be set to false for a replicated configuration. Default is false.
					</div>
					 </td></tr><tr><td> backup-group-name </td><td> <div class="para">
						This is the unique name which identifies a live/backup pair that should replicate with each other
					</div>
					 </td></tr><tr><td> check-for-live-server </td><td> <div class="para">
						If a replicated live server should check the current cluster to see if there is already a live server with the same node id. Default is false.
					</div>
					 </td></tr><tr><td> failover-on-shutdown </td><td> <div class="para">
						Whether this backup server (if it is a backup server) becomes the live server on a normal server shutdown. Default is false.
					</div>
					 </td></tr></tbody></table></div></div><div class="para">
		The backup server must also be flagged explicitly as a backup.
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;backup&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/backup&gt;</span></pre><div class="table"><a id="idm139978537953600">
      ⁠</a><p class="title"><strong>Table 18.16. HornetQ Backup Server Setup Attributes</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="HornetQ Backup Server Setup Attributes"><colgroup><col/><col/></colgroup><thead><tr><th> Attribute </th><th> Description </th></tr></thead><tbody><tr><td> allow-failback </td><td> <div class="para">
						Whether this server will automatically shutdown if the original live server comes back up. Default is true.
					</div>
					 </td></tr><tr><td> max-saved-replicated-journal-size </td><td> <div class="para">
						The maximum number of backup journals to keep after failback occurs. Specifying this attribute is only necessary if allow-failback is true. Default value is 2, which means that after 2 failbacks the backup server must be restarted in order to be able to replicate journal from live server and become backup again.
					</div>
					 </td></tr></tbody></table></div></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+13566-781123+%5BLatest%5D&amp;comment=Title%3A+Configuring+the+HornetQ+Servers+for+Replication%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=13566-781123+27+Jan+2017+09%3A15+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="About_High-availability_HA_Failover">
      ⁠</a>18.16.8. About High-availability (HA) Failover</h2></div></div></div><div class="para">
		High-availability failover is available with either automatic client failover, or application-level failover, through a live-backup structure. Each live server has a backup server. Only one backup per live server is supported.
	</div><div class="para">
		The backup server only takes over if the live server crashes and there is a failover. After the live server has been restarted, and if the <code class="literal">allow-failback</code> attribute is set to true, it becomes the live server again. When the original live server takes over, the backup server reverts to being backup for the live server.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			Clustering should be enabled even if you are not using the clustering capabilities. This is because each node of the HA cluster must have a cluster-connection to all of the other nodes, in order to negotiate roles with the other servers.
		</div></div></div><div class="para">
		High availability cluster topology is achieved by the live and backup server as they send information about their connection details using IP multicasts. If IP multicasts can not be used, it is also possible to use a static configuration of the initial connections. After the initial connection, the client is informed about the topology. If the current connection is stale, the client establishes a new connection to another node.
	</div><div class="para">
		After a live server has failed and a backup server has taken over, you will need to restart the live server and have clients fail back. To do this, restart the original live server and kill the new live server. You can do this by killing the process itself or wait for the server to crash on its own. You can also cause failover to occur on normal server shutdown, to enable this set the <code class="literal">failover-on-shutdown</code> property to true in the <code class="filename">standalone.xml</code> configuration file:
	</div><div class="para">
		
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;failover-on-shutdown&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/failover-on-shutdown&gt;</span></pre>

	</div><div class="para">
		By default, the <code class="literal">failover-on-shutdown</code> property is set to false.
	</div><div class="para">
		You can also force the new live server to shutdown when the old live server comes back up allowing the original live server to take over automatically by setting the <code class="literal">allow-failback</code> property to true in the <code class="filename">standalone.xml</code> configuration file:
	</div><div class="para">
		
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;allow-failback&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/allow-failback&gt;</span></pre>

	</div><div class="para">
		In replication HA mode, to force the new live server to shutdown when the old live server comes back, set the <code class="literal">check-for-live-server</code> property to true in <code class="filename">standalone.xml</code> configuration file:
	</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;check-for-live-server&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/check-for-live-server&gt;</span></pre><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+4820-762484+%5BLatest%5D&amp;comment=Title%3A+About+High-availability+%28HA%29+Failover%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=4820-762484+19+Jun+2015+09%3A37+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Deployments_on_HornetQ_Backup_Servers">
      ⁠</a>18.16.9. Deployments on HornetQ Backup Servers</h2></div></div></div><div class="para">
		In a dedicated HA environment, a JBoss EAP 6 server with HornetQ configured as a backup must not be used to host any deployments which use or connect to the HornetQ backup on that server. This includes deployments such as Enterprise Java Beans (Stateless Session Beans, Message Driven Beans), or servlets.
	</div><div class="para">
		If a JBoss EAP 6 server has a HornetQ collocated backup configuration (where in the messaging subsystem there is a HornetQ server configured as 'live' and another HornetQ server configured as backup), then the JBoss EAP 6 server can host deployments as long as they are configured to connect to the 'live' HornetQ server.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+25722-592620+%5BLatest%5D&amp;comment=Title%3A+Deployments+on+HornetQ+Backup+Servers%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=25722-592620+23+Feb+2014+16%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="HornetQ_Failover_Modes">
      ⁠</a>18.16.10. HornetQ Failover Modes</h2></div></div></div><div class="para">
		HornetQ defines two types of client failover:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Automatic client failover
			</div></li><li class="listitem"><div class="para">
				Application-level client failover
			</div></li></ul></div><div class="para">
		HornetQ provides transparent automatic reattachment of connections to the same server, for example, in case of transient network problems. This is similar to failover, except it is reconnecting to the same server.
	</div><div class="para">
		During failover, if the client has consumers on any non persistent or temporary queues, those queues are automatically recreated during failover on the backup node, since the backup node does not have any information about non persistent queues.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42323-732028+%5BLatest%5D&amp;comment=Title%3A+HornetQ+Failover+Modes%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42323-732028+10+Dec+2014+01%3A24+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Automatic_Client_Failover">
      ⁠</a>18.16.11. Automatic Client Failover</h2></div></div></div><div class="para">
		HornetQ clients can be configured to receive information about live and backup servers, this information helps in event of client connection failure - live server connection, the client detects failover and reconnects to the backup server. The backup server automatically recreates any sessions and consumers that existed on each connection before failover, thus saving the user from having to hand-code manual reconnection logic.
	</div><div class="para">
		HornetQ clients detect connection failure if packets are not received from the server within the time specified in <code class="literal">client-failure-check-period</code>. If the client does not receive data in time, the client assumes the connection has failed and attempts failover. If the socket is closed by the operating system, the server process is killed rather than the machine itself crashing, then the client immediately initiates failover.
	</div><div class="para">
		HornetQ clients can be configured in different ways to discover the list of live-backup server groups. The client can be configured explicitly or use server discovery for the client to automatically discover the list. Alternatively, the clients can explicitly connect to a specific server and download the current servers and backups.
	</div><div class="para">
		To enable automatic client failover, the client must be configured to allow non-zero reconnection attempts.
	</div><div class="para">
		By default, failover only occurs after at least one connection has been made to the live server. The client retries connecting to the live server as specified in the <code class="literal">reconnect-attempts</code> property and fails after the specified number of attempts.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42324-732454+%5BLatest%5D&amp;comment=Title%3A+Automatic+Client+Failover%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42324-732454+12+Dec+2014+01%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Application-Level_Failover">
      ⁠</a>18.16.12. Application-Level Failover</h2></div></div></div><div class="para">
		In some cases, as per your requirement, you could handle any connection failure manually by specifying reconnection logic in a custom failure handler. You can define this as application-level failover, since the failover is handled at the user application level.
	</div><div class="para">
		To implement application-level failover, if you are using JMS, you need to set an ExceptionListener class on the JMS connection. If a connection failure is detected, the ExceptionListener class is called by HornetQ. In your ExceptionListener, close the old JMS connections, look up for new connection factory instances from JNDI and create new connections.
	</div><div class="para">
		If you are using the core API, then the procedure is very similar: set a FailureListener on the core ClientSession instances.
	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+42325-735024+%5BLatest%5D&amp;comment=Title%3A+Application-Level+Failover%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=42325-735024+09+Jan+2015+05%3A09+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Performance_Tuning">
      ⁠</a>18.17. Performance Tuning</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Tuning_Persistence">
      ⁠</a>18.17.1. Tuning Persistence</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Put the message journal on its own physical volume. If the disk is shared with other processes, for example transaction co-ordinator, database or other journals, which are also reading and writing from it, then this may greatly reduce performance since the disk head may be skipping between the different files. One of the advantages of an append only journal is that disk head movement is minimized. This advantage is lost if the disk is shared. If you are using paging or large messages, make sure they are put on separate volumes too.
			</div></li><li class="listitem"><div class="para">
				Minimum number of journal files. Set <em class="parameter"><code>journal-min-files</code></em> parameter to a number of files that would fit your average sustainable rate. If you see new files being created on the journal data directory too often, that is, lots of data is being persisted, you need to increase the minimal number of files, this way the journal would reuse more files instead of creating new data files.
			</div></li><li class="listitem"><div class="para">
				Journal file size. The journal file size must be aligned to the capacity of a cylinder on the disk. The default value of 10MiB should be enough on most systems.
			</div></li><li class="listitem"><div class="para">
				Use AIO journal. For Linux operating system, keep your journal type as <code class="literal">AIO</code>. <code class="literal">AIO</code> will scale better than Java NIO.
			</div></li><li class="listitem"><div class="para">
				Tune <em class="parameter"><code>journal-buffer-timeout</code></em>. The timeout can be increased to increase throughput at the expense of latency.
			</div></li><li class="listitem"><div class="para">
				If you are running AIO you might be able to get improved performance by increasing <em class="parameter"><code>journal-max-io</code></em> parameter value. Do not change this parameter if you are running NIO.
			</div></li></ul></div><div class="para">

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44748-768089+%5BLatest%5D&amp;comment=Title%3A+Tuning+Persistence%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44748-768089+22+Aug+2015+14%3A10+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Tuning_JMS">
      ⁠</a>18.17.2. Tuning JMS</h2></div></div></div><div class="para">
		There are a few areas where some tweaks can be done if you are using the JMS API.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Disable message ID. Use the <code class="classname">setDisableMessageID()</code> method on the <code class="classname">MessageProducer</code> class to disable message IDs if you do not need them. This decreases the size of the message and also avoids the overhead of creating a unique ID.
			</div></li><li class="listitem"><div class="para">
				Disable message timestamp. Use the <em class="parameter"><code>setDisableMessageTimeStamp()</code></em> method on the <code class="classname">MessageProducer</code> class to disable message timestamps if you do not need them.
			</div></li><li class="listitem"><div class="para">
				Avoid <em class="parameter"><code>ObjectMessage</code></em>. <em class="parameter"><code>ObjectMessage</code></em> is convenient but it comes at a cost. The body of a <em class="parameter"><code>ObjectMessage</code></em> uses Java serialization to serialize it to bytes. The Java serialized form of even small objects is very verbose so takes up a lot of space on the wire, also Java serialization is slow compared to custom marshalling techniques. Only use <em class="parameter"><code>ObjectMessage</code></em> if you really cannot use one of the other message types, that is if you do not know the type of the payload until run-time.
			</div></li><li class="listitem"><div class="para">
				Avoid <em class="parameter"><code>AUTO_ACKNOWLEDGE</code></em>. <em class="parameter"><code>AUTO_ACKNOWLEDGE</code></em> mode requires an acknowledgement to be sent from the server for each message received on the client, this means more traffic on the network. If you can, use <em class="parameter"><code>DUPS_OK_ACKNOWLEDGE</code></em> or use <em class="parameter"><code>CLIENT_ACKNOWLEDGE</code></em> or a transacted session and batch up many acknowledgements with one acknowledge/commit.
			</div></li><li class="listitem"><div class="para">
				Avoid durable messages. By default, JMS messages are durable. If you do not need durable messages then set them to be <em class="parameter"><code>non-durable</code></em>. Durable messages incur a lot more overhead in persisting them to storage.
			</div></li><li class="listitem"><div class="para">
				Batch many sends or acknowledgements in a single transaction. HornetQ will only require a network round trip on the commit, not on every send or acknowledgement.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44749-768090+%5BLatest%5D&amp;comment=Title%3A+Tuning+JMS%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44749-768090+22+Aug+2015+14%3A16+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Other_Tunings">
      ⁠</a>18.17.3. Other Tunings</h2></div></div></div><div class="para">
		There are various places in HornetQ where we can perform some tuning:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Use Asynchronous Send Acknowledgements. If you need to send durable messages non transactional and you need a guarantee that they have reached the server by the time the call to <code class="classname">send()</code> returns, do not set durable messages to be sent blocking, instead use asynchronous send acknowledgements to get your acknowledgements of send back in a separate stream.
			</div></li><li class="listitem"><div class="para">
				Use <em class="parameter"><code>pre-acknowledge</code></em> mode. With <em class="parameter"><code>pre-acknowledge</code></em> mode, messages are acknowledged before they are sent to the client. This reduces the amount of acknowledgement traffic on the wire.
			</div></li><li class="listitem"><div class="para">
				Disable security. There is a small performance boost when you disable security by setting the <em class="parameter"><code>security-enabled</code></em> parameter to false in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code>.
			</div></li><li class="listitem"><div class="para">
				Disable persistence. You can turn off message persistence altogether by setting <em class="parameter"><code>persistence-enabled</code></em> to false in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code>.
			</div></li><li class="listitem"><div class="para">
				Sync transactions lazily. Setting <em class="parameter"><code>journal-sync-transactional</code></em> to false in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> gives better transactional persistent performance at the expense of some possibility of loss of transactions on failure.
			</div></li><li class="listitem"><div class="para">
				Sync non transactional lazily. Setting <em class="parameter"><code>journal-sync-non-transactional</code></em> to false in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> gives better non-transactional persistent performance at the expense of some possibility of loss of durable messages on failure
			</div></li><li class="listitem"><div class="para">
				Send messages non blocking. Setting <em class="parameter"><code>block-on-durable-send</code></em> and <em class="parameter"><code>block-on-non-durable-send</code></em> to false in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> (if you are using JMS and JNDI) or directly on the ServerLocator. This means you do not have to wait a whole network round trip for every message sent.
			</div></li><li class="listitem"><div class="para">
				If you have very fast consumers, you can increase <em class="parameter"><code>consumer-window-size</code></em>. This effectively disables consumer flow control.
			</div></li><li class="listitem"><div class="para">
				Socket NIO vs Socket Old IO. By default HornetQ uses old (blocking) on the server and the client side. NIO is much more scalable but can give some latency hit compared to old blocking IO. To service many thousands of connections on the server, then you must use NIO on the server. However, if there are no thousands of connections on the server you can keep the server acceptors using old IO, and you may get a small performance advantage.
			</div></li><li class="listitem"><div class="para">
				Use the core API not JMS. Using the JMS API you will have slightly lower performance than using the core API, since all JMS operations need to be translated into core operations before the server can handle them. If using the core API try to use methods that take <em class="parameter"><code>SimpleString</code></em> as much as possible. <em class="parameter"><code>SimpleString</code></em>, unlike <code class="classname">java.lang.String</code> does not require copying before it is written to the wire, so if you re-use <code class="classname">SimpleString</code> instances between calls then you can avoid some unnecessary copying.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44759-768091+%5BLatest%5D&amp;comment=Title%3A+Other+Tunings%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44759-768091+22+Aug+2015+14%3A18+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Tuning_Transport_Settings">
      ⁠</a>18.17.4. Tuning Transport Settings</h2></div></div></div><div class="para">

	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				TCP buffer sizes. If you have a fast network and fast machines you may get a performance boost by increasing the TCP send and receive buffer sizes.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Some operating systems like later versions of Linux include TCP auto-tuning and setting TCP buffer sizes manually can prevent auto-tune from working and actually give you worse performance.
				</div></div></div></li><li class="listitem"><div class="para">
				Increase limit on file handles on the server. If you expect a lot of concurrent connections on your servers, or if clients are rapidly opening and closing connections, you must make sure the user running the server has permission to create sufficient file handles.
			</div><div class="para">
				This varies from operating system to operating system. On Linux systems you can increase the number of allowable open file handles in the file <code class="filename">/etc/security/limits.conf</code>. For example, add the lines
			</div><pre class="screen">serveruser     soft    nofile  20000
serveruser     hard    nofile  20000</pre><div class="para">
				This would allow up to 20000 file handles to be open by the user <code class="literal"><em class="replaceable">serveruser</em></code>.
			</div></li><li class="listitem"><div class="para">
				Use <em class="parameter"><code>batch-delay</code></em> and set <em class="parameter"><code>direct-deliver</code></em> to false for the best throughput for very small messages. HornetQ comes with a preconfigured connector/acceptor pair <em class="parameter"><code>(netty-throughput)</code></em> in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> and JMS connection factory <em class="parameter"><code>(ThroughputConnectionFactory)</code></em> in <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code> which can be used to give the very best throughput, especially for small messages.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44760-768025+%5BLatest%5D&amp;comment=Title%3A+Tuning+Transport+Settings%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44760-768025+21+Aug+2015+07%3A31+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Tuning_the_VM">
      ⁠</a>18.17.5. Tuning the VM</h2></div></div></div><div class="para">
		It is highly recommend to use the latest Java JVM for the best performance. Internal testing is done using the Sun JVM, so some of these tunings may not apply to JDKs from other providers like IBM or JRockit
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Garbage collection. For smooth server operation, it is recommended to use a parallel garbage collection algorithm. For example, using the JVM argument <code class="code">-XX:+UseParallelGC</code> on Sun JDKs.
			</div></li><li class="listitem"><div class="para">
				Memory settings. Give as much memory as you can to the server. HornetQ can run in low memory by using paging but if it can run with all queues in RAM this will improve performance. The amount of memory you require will depend on the size and number of your queues and the size and number of your messages. Use the JVM arguments <em class="parameter"><code>-Xms</code></em> and <em class="parameter"><code>-Xmx</code></em> to set server available RAM. We recommend setting them to the same high value.
			</div></li><li class="listitem"><div class="para">
				Aggressive options. Different JVMs provide different sets of JVM tuning parameters. It is recommended at least using <em class="parameter"><code>-XX:+AggressiveOpts</code></em> and <em class="parameter"><code>-XX:+UseFastAccessorMethods</code></em>. You may get some mileage with the other tuning parameters depending on your operating system platform and application usage patterns.
			</div></li></ul></div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44762-767909+%5BLatest%5D&amp;comment=Title%3A+Tuning+the+VM%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44762-767909+20+Aug+2015+06%3A59+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Avoiding_Anti-Patterns">
      ⁠</a>18.17.6. Avoiding Anti-Patterns</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Re-use connections / sessions / consumers / producers. Probably the most common messaging anti-pattern we see is users who create a new connection/session/producer for every message they send or every message they consume. This is a poor use of resources. These objects take time to create and may involve several network round trips. Always re-use them.
			</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Some popular libraries such as the Spring JMS Template use these anti-patterns. If you are using Spring JMS Template, you may get poor performance. The Spring JMS Template can only safely be used in an application server which caches JMS sessions, example, using JCA), and only then for sending messages. It cannot be safely be used for synchronously consuming messages, even in an application server.
				</div></div></div></li><li class="listitem"><div class="para">
				Avoid fat messages. Verbose formats such as XML take up a lot of space on the wire and performance will suffer as result. Avoid XML in message bodies if you can.
			</div></li><li class="listitem"><div class="para">
				Do not create temporary queues for each request. This common anti-pattern involves the temporary queue request-response pattern. With the temporary queue request-response pattern a message is sent to a target and a reply-to header is set with the address of a local temporary queue. When the recipient receives the message they process it then send back a response to the address specified in the reply-to. A common mistake made with this pattern is to create a new temporary queue on each message sent. This drastically reduces performance. Instead the temporary queue should be re-used for many requests.
			</div></li><li class="listitem"><div class="para">
				Do not use Message-Driven Beans for the sake of it. As soon as you start using MDBs you are greatly increasing the codepath for each message received compared to a straightforward message consumer, since a lot of extra application server code is executed.
			</div></li></ul></div><div class="para">

	</div><div class="para RoleCreateBugPara">
		<a href="https://bugzilla.redhat.com/enter_bug.cgi?cf_environment=Build+Name%3A+23087%2C+Red+Hat+Administration+and+Configuration+Guide-6.4%0ABuild+Date%3A+16-11-2017+09%3A12%3A46%0ATopic+ID%3A+44763-767914+%5BLatest%5D&amp;comment=Title%3A+Avoiding+Anti-Patterns%0A%0ADescribe+the+issue%3A%0A%0A%0ASuggestions+for+improvement%3A%0A%0A%0AAdditional+information%3A&amp;cf_build_id=44763-767914+20+Aug+2015+08%3A03+en-US+%5BLatest%5D&amp;product=JBoss+Enterprise+Application+Platform+6&amp;component=Documentation&amp;version=6.4.0">Report a bug</a>
	</div></div></div></div></body></html>