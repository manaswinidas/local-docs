<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Securing the Management Interfaces with LDAP</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="securing_the_management_interfaces_with_ldap"/>Chapter 3. Securing the Management Interfaces with LDAP</h1></div></div></div><p>
			The Management Interfaces can authenticate against an LDAP server (including Microsoft Active Directory) instead of the property-file based security realms configured by default. This is accomplished by using an LDAP authenticator. An LDAP authenticator operates by first establishing a connection (using an outbound LDAP connection) to the remote directory server. It then performs a search using the username which the user passed to the authentication system, to find the fully-qualified distinguished name (DN) of the LDAP record. If successful, a new connection is established, using the DN of the user as the credential, and password supplied by the user. If this second connection and authentication to the LDAP server is successful, the DN is verified to be valid and authentication has succeeded.
		</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
				Securing the Management Interfaces with LDAP changes the authentication from digest to BASIC/Plain, which by default, will cause usernames and passwords to be sent over the network in the clear. <a class="link" href="securing_the_management_interfaces_with_ldap.html#using_ssl_tls_for_the_outbound_ldap_connection" title="Using SSL/TLS for the Outbound LDAP Connection">SSL/TLS can be enabled on the outbound connection</a> to encrypt this traffic and avoid sending this information in the clear.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="basic_setup"/>Basic setup</h1></div></div></div><p>
				To use an LDAP directory server as the authentication source for any or all of the management interfaces, the following procedures must be performed:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						<a class="link" href="securing_the_management_interfaces_with_ldap.html#one_creating_an_outbound_connection_to_the_ldap_server" title="1. Creating an Outbound Connection to the LDAP Server">Create an outbound connection to the LDAP server</a>.
					</li><li class="listitem">
						<a class="link" href="securing_the_management_interfaces_with_ldap.html#two_creating_a_new_ldap_enabled_security_realm" title="2. Creating a new LDAP-Enabled Security Realm">Create a new LDAP-enabled Security Realm and reference the outbound connection</a>.
					</li><li class="listitem">
						<a class="link" href="securing_the_management_interfaces_with_ldap.html#three_reference_the_new_security_realm_in_the_management_interface" title="3. Reference the new security realm in the Management Interface">Reference the new security realm in the Management Interface</a>.
					</li></ol></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="one_creating_an_outbound_connection_to_the_ldap_server"/>1. Creating an Outbound Connection to the LDAP Server</h2></div></div></div><p>
					The purpose of creating an outbound LDAP connection is to allow the security realm (and the JBoss EAP instance) to establish a connection to the LDAP server. This is similar to the case of creating a datasource for use with the <span class="emphasis"><em>Database</em></span> login module in a security domain.
				</p><p>
					The LDAP outbound connection allows the following attributes:
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Required</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									url
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									yes
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The URL address of the directory server.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									search-dn
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									no
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The fully distinguished name (DN) of the user authorized to perform searches.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									search-credential
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									no
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The password of the user authorized to perform searches.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									initial-context-factory
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									no
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The initial context factory to use when establishing the connection. Defaults to <span class="strong"><strong>com.sun.jndi.ldap.LdapCtxFactory</strong></span>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									security-realm
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									no
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The security realm to reference to obtain a configured <span class="strong"><strong>SSLContext</strong></span> to use when establishing the connection.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									referrals
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									no
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Specifies the behavior when encountering a referral when doing a search. Valid options are <span class="emphasis"><em>IGNORE</em></span>, <span class="emphasis"><em>FOLLOW</em></span>, and <span class="emphasis"><em>THROW</em></span>. <span class="emphasis"><em>INGORE</em></span> (default behavior) simply ignores the referral. If set to <span class="emphasis"><em>FOLLOW</em></span>, when referrals are encountered during a search, the DirContext being used will attempt to follow that referral. This assumes the same connection settings can be used to connect to the second server and the name used in the referral is reachable. If set to <span class="emphasis"><em>THROW</em></span>, then the DirContext will throw an exception (<span class="emphasis"><em>LdapReferralException</em></span>) to indicate that a referral is required, which the security realm will handle and attempt to identify an alternative connection to use for the referral.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									handles-referrals-for
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									no
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Specifies the referrals a connection can handle. If specifying list of URIs, they should be separated by spaces. This enables a connection with connection properties to be defined and used when different credentials are needed to follow a referral. This is useful in situations where different credentials are needed to authenticate against the second server or for situations where the server returns a name in the referral that is not reachable from the JBoss EAP 6 installation and an alternative address can be substituted.
								</p>
								 </td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The <span class="emphasis"><em>search-dn</em></span> and <span class="emphasis"><em>search-credential</em></span> are <span class="strong"><strong>different</strong></span> than the username and password provided by the user. The information provided here is specifically for establishing an initial connection between the JBoss EAP instance and the LDAP server. This connection allows JBoss EAP to perform a subsequent search for the DN of the user trying to authenticate. The DN of the user (which is a result of the search) trying to authenticate and the password they provided are used to establish a second (and separate) connection for completing the authentication process.
					</p></div><p>
					Given the example LDAP server, below are the CLI commands and resulting XML configuration for configuring an outbound LDAP connection to it:
				</p><div class="table"><a id="idm140420929228336"/><p class="title"><strong>Table 3.1. Example LDAP Server</strong></p><div class="table-contents"><table summary="Example LDAP Server" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Value</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									url
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									127.0.0.1:389
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									search-credential
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									myPass
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									search-dn
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									cn=search,dc=acme,dc=com
								</p>
								 </td></tr></tbody></table></div></div><div class="title"><strong>CLI for Adding the Outbound Connection</strong></div><p>
						
</p><pre class="programlisting">/core-service=management/ldap-connection=ldap-connection/:add( \
search-credential=myPass, \
url=ldap://127.0.0.1:389, \
search-dn="cn=search,dc=acme,dc=com")</pre><p>

					</p><pre class="programlisting">reload</pre><div class="title"><strong>Resulting XML</strong></div><p>
						
</p><pre class="programlisting">&lt;outbound-connections&gt;
  &lt;ldap name="ldap-connection"
        url="ldap://127.0.0.1:389"
        search-dn="cn=search,dc=acme,dc=com"
        search-credential="myPass"/&gt;
&lt;/outbound-connections&gt;</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The above CLI commands were done assuming a standalone instance of JBoss EAP 6. For more details on using the CLI with JBoss EAP 6 domains, please consult <span class="emphasis"><em>The Management CLI</em></span> section of the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#sect-The_Management_CLI">Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
					</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						This creates an <span class="emphasis"><em>clear</em></span> connection between the JBoss EAP instance and the LDAP server. For more details on setting up an encrypted connection using SSL/TLS, please see the <a class="xref" href="securing_the_management_interfaces_with_ldap.html#using_ssl_tls_for_the_outbound_ldap_connection" title="Using SSL/TLS for the Outbound LDAP Connection">the section called “Using SSL/TLS for the Outbound LDAP Connection”</a>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="two_creating_a_new_ldap_enabled_security_realm"/>2. Creating a new LDAP-Enabled Security Realm</h2></div></div></div><p>
					Once the outbound LDAP connection has been created, a new LDAP-Enabled security realm must be created to use it.
				</p><p>
					The LDAP security realm has the following configuration attributes:
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									connection
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The name of the connection defined in outbound-connections to use to connect to the LDAP directory.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									base-dn
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The distinguished name of the context to begin searching for the user.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									recursive
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Whether the search should be recursive throughout the LDAP directory tree, or only search the specified context. Defaults to false.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									user-dn
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The attribute of the user that holds the distinguished name. This is subsequently used to test authentication as the user can complete. Defaults to dn.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									allow-empty-passwords
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This attribute determines whether an empty password is accepted. The default value for this attribute is false.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									username-attribute
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Either username-attribute or advanced-filter must be specified. The name of the attribute to search for the user. This filter performs a simple search where the user name entered by the user matches the specified attribute.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									advanced-filter
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Either username-attribute or advanced-filter must be specified. The fully defined filter used to search for a user based on the supplied user ID. This attribute contains a filter query in standard LDAP syntax. The filter must contain a variable in the following format: {0}. This is later replaced with the user name supplied by the user. More specifics and examples on using <span class="emphasis"><em>advanced-filter</em></span> can be found in the <a class="link" href="securing_the_management_interfaces_with_ldap.html#combining_ldap_and_rbac_for_authorization" title="Combining LDAP and RBAC for Authorization">&lt;advanced-filter&gt; part of the Combining LDAP and RBAC for Authorization section</a>.
								</p>
								 </td></tr></tbody></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						It is important to ensure that empty LDAP passwords are not allowed since it is a serious security concern. Unless this behavior is specifically desired in the environment, ensure empty passwords are not allowed and <span class="emphasis"><em>allow-empty-passwords</em></span> remains false.
					</p></div><p>
					Here are the CLI commands and resulting XML configuration for configuring an LDAP-enabled security realm using the <span class="emphasis"><em>ldap-connection</em></span> outbound LDAP connection.
				</p><div class="title"><strong>CLI</strong></div><p>
						
</p><pre class="programlisting">/core-service=management/security-realm=ldap-security-realm:add</pre><p>

					</p><pre class="programlisting">/core-service=management/security-realm=ldap-security-realm/authentication=ldap:add( \
connection="ldap-connection", base-dn="cn=users,dc=acme,dc=com", \
username-attribute="sambaAccountName")</pre><pre class="programlisting">reload</pre><div class="title"><strong>Resulting XML</strong></div><p>
						
</p><pre class="programlisting">&lt;security-realm name="ldap-security-realm"&gt;
  &lt;authentication&gt;
    &lt;ldap connection="ldap-connection" base-dn="cn=users,dc=acme,dc=com"&gt;
      &lt;username-filter attribute="sambaAccountName"/&gt;
    &lt;/ldap&gt;
  &lt;/authentication&gt;
&lt;/security-realm&gt;</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The above CLI commands were done assuming a standalone instance of JBoss EAP 6. For more details on using the CLI with JBoss EAP 6 domains, please consult <span class="emphasis"><em>The Management CLI</em></span> section of the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#sect-The_Management_CLI">Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="three_reference_the_new_security_realm_in_the_management_interface"/>3. Reference the new security realm in the Management Interface</h2></div></div></div><p>
					Once a security realm has been created and is using the outbound LDAP connection, that new security realm must be referenced by the management interfaces.
				</p><div class="title"><strong>CLI Command for Updating the HTTP Interface</strong></div><p>
						
</p><pre class="programlisting">/core-service=management/management-interface=http-interface/:write-attribute( \
name=security-realm,value="ldap-security-realm")</pre><p>

					</p><div class="title"><strong>CLI Command for Updating the Native Interface</strong></div><p>
						
</p><pre class="programlisting">/core-service=management/management-interface=native-interface/:write-attribute( \
name=security-realm,value="ldap-security-realm")</pre><p>

					</p><div class="title"><strong>Resulting XML</strong></div><p>
						
</p><pre class="programlisting">&lt;management-interfaces&gt;
  &lt;native-interface security-realm="ldap-security-realm"&gt;
    &lt;socket-binding native="management-native"/&gt;
  &lt;/native-interface&gt;
  &lt;http-interface security-realm="ldap-security-realm"&gt;
    &lt;socket-binding http="management-http"/&gt;
  &lt;/http-interface&gt;
&lt;/management-interfaces&gt;</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The above CLI commands were done assuming a standalone instance of JBoss EAP 6. For more details on using the CLI with JBoss EAP 6 domains, please consult <span class="emphasis"><em>The Management CLI</em></span> section of the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#sect-The_Management_CLI">Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_ssl_tls_for_the_outbound_ldap_connection"/>Using SSL/TLS for the Outbound LDAP Connection</h1></div></div></div><p>
				JBoss EAP 6 can be configured to use an outbound connection to an LDAP server using SSL/TLS. To create an outbound LDAP connection secured by SSL/TLS, the following procedures must be performed:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						<a class="link" href="securing_the_management_interfaces_with_ldap.html#one_configuring_a_security_realm_for_the_outbound_ldap_connection_to_use" title="1. Configuring a Security Realm for the Outbound LDAP Connection to Use">Configure a security realm with a keystore and truststore for the outbound LDAP connection to use</a>.
					</li><li class="listitem">
						<a class="link" href="securing_the_management_interfaces_with_ldap.html#two_create_an_outbound_ldap_connection_with_the_ssl_tls_url_and_security_realm" title="2. Create an Outbound LDAP Connection with the SSL/TLS URL and Security Realm">Create an Outbound LDAP Connection with the SSL/TLS URL and Security Realm</a>.
					</li><li class="listitem">
						<a class="link" href="securing_the_management_interfaces_with_ldap.html#three_creating_a_new_security_realm_that_uses_the_outbound_ldap_connection_for_use_by_the_management_interfaces" title="3. Creating a New Security Realm that uses the Outbound LDAP Connection for use by the Management Interfaces">Create a new security realm that uses the outbound ldap connection for use by the management interfaces</a>.
					</li></ol></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="one_configuring_a_security_realm_for_the_outbound_ldap_connection_to_use"/>1. Configuring a Security Realm for the Outbound LDAP Connection to Use</h2></div></div></div><p>
					The security realm must contain a keystore configured with the key that the JBoss EAP 6 server will use to decrypt/encrypt communications between itself and the LDAP server. This keystore will also allow the JBoss EAP 6 instance to verify itself against the LDAP server. The security realm must also contain a truststore that contains the LDAP server’s certificate (or the certificate of the certificate authority used to sign the LDAP server’s certificate). See <a class="link" href="/documentation/en/red-hat-jboss-enterprise-application-platform/version-6.4/how-to-configure-server-security#setting_up_2_way_ssl_tls_for_the_management_interfaces">Setting up 2-Way SSL/TLS for the Management Interfaces in the JBoss EAP 6 How to Configure Server Security guide</a> for instructions on configuring keystores and truststores and creating a security realm that uses them.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="two_create_an_outbound_ldap_connection_with_the_ssl_tls_url_and_security_realm"/>2. Create an Outbound LDAP Connection with the SSL/TLS URL and Security Realm</h2></div></div></div><p>
					Similar to the process defined in <a class="link" href="securing_the_management_interfaces_with_ldap.html#one_creating_an_outbound_connection_to_the_ldap_server" title="1. Creating an Outbound Connection to the LDAP Server">Creating an Outbound Connection to the LDAP Server</a>, an outbound LDAP connection should be created, but using the SSL/TLS URL for the LDAP server and the SSL/TLS security realm.
				</p><p>
					Once the outbound LDAP connection and SSL/TLS security realm for the LDAP server have been created, the the outbound LDAP connection needs to be updated with that information.
				</p><div class="title"><strong>Example CLI for Adding the Outbound Connection with an SSL/TLS URL</strong></div><p>
						
</p><pre class="programlisting">/core-service=management/ldap-connection=ldap-connection/:add( \
search-credential=myPass, \
url=ldaps://LDAP_HOST:LDAP_PORT, \
search-dn="cn=search,dc=acme,dc=com")</pre><p>

					</p><div class="title"><strong>Adding the security realm with the SSL/TLS certificates</strong></div><p>
						
</p><pre class="programlisting">/core-service=management/ldap-connection=ldap-connection:write-attribute( \
name=security-realm,value="CertificateRealm")</pre><p>

					</p><pre class="programlisting">reload</pre><div class="title"><strong>Resulting XML</strong></div><p>
						
</p><pre class="programlisting">&lt;outbound-connections&gt;
  &lt;ldap name="ldap-connection" url="ldaps://LDAP_HOST:LDAP_PORT"
  security-realm="CertificateRealm"
  search-dn="cn=search,dc=acme,dc=com"
  search-credential="myPass" /&gt;
&lt;/outbound-connections&gt;</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The above CLI commands were done assuming a standalone instance of JBoss EAP 6. For more details on using the CLI with JBoss EAP 6 domains, please consult <span class="emphasis"><em>The Management CLI</em></span> section of the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#sect-The_Management_CLI">Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="three_creating_a_new_security_realm_that_uses_the_outbound_ldap_connection_for_use_by_the_management_interfaces"/>3. Creating a New Security Realm that uses the Outbound LDAP Connection for use by the Management Interfaces</h2></div></div></div><p>
					Follow the procedures outlined in sections <a class="link" href="securing_the_management_interfaces_with_ldap.html#two_creating_a_new_ldap_enabled_security_realm" title="2. Creating a new LDAP-Enabled Security Realm">Creating a new LDAP-Enabled Security Realm</a> and <a class="link" href="securing_the_management_interfaces_with_ldap.html#three_reference_the_new_security_realm_in_the_management_interface" title="3. Reference the new security realm in the Management Interface">Reference the new security realm in the Management Interface</a>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ldap_and_rbac"/>LDAP and RBAC</h1></div></div></div><p>
				<span class="emphasis"><em>RBAC (Role-Based Access Control)</em></span> is a mechanism for specifying a set of permissions (roles) for a set of management users, allowing users to be granted different management responsibilities without giving them full, unrestricted access. For more specific details on RBAC, please see the <span class="emphasis"><em>Role-Based Access Control</em></span> section of the <a class="link" href="/documentation/en/red-hat-jboss-enterprise-application-platform/version-6.4/security-architecture#role_based_access_control">Red Hat JBoss Enterprise Application Platform 6 Security Architecture guide</a>.
			</p><p>
				RBAC is used only for authorization, with authentication being handled separately. Since LDAP can be used for authentication as well as authorization, JBoss EAP 6 may be configured to use RBAC for authorization without LDAP (using LDAP or any other mechanism for authentication). JBoss EAP 6 may also be configured to use RBAC combined with LDAP for making authorization decisions in the management interfaces.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_ldap_and_rbac_independently"/>Using LDAP and RBAC Independently</h2></div></div></div><p>
					JBoss EAP 6 allows for authentication and authorization to be configured independently in security realms. This enables LDAP to be configured as an authentication mechanism and RBAC to be configured as an authorization mechanism. If configured in this manner, when a user attempts to access a management interface, they will first be authenticated using the configured LDAP server. If successful, the user’s role (and configured permissions of that role) will be determined using only RBAC (independent of any group information found in the LDAP server).
				</p><p>
					For more details on using just RBAC as an authorization mechanism for the management interfaces, please see the <a class="link" href="/documentation/en/red-hat-jboss-enterprise-application-platform/version-6.4/how-to-configure-server-security#role_based_access_control">Server Security guide</a>. For more details on configuring LDAP for authentication with the management interfaces, please see the <a class="link" href="securing_the_management_interfaces_with_ldap.html#basic_setup" title="Basic setup">previous section</a> on the topic.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="combining_ldap_and_rbac_for_authorization"/>Combining LDAP and RBAC for Authorization</h2></div></div></div><p>
					Users who have authenticated using an LDAP server (or using the properties file), can be members of user groups. A user group is simply an arbitrary label that can be assigned to one or more users. RBAC can be configured to use this group information to automatically assign a role to a user or exclude a user from a role.
				</p><p>
					An LDAP directory contains entries for user accounts and groups, cross referenced by attributes. Depending on the LDAP server configuration, a user entity may map the groups the user belongs to through <span class="emphasis"><em>memberOf</em></span> attributes; a group entity may map which users belong to it through <span class="emphasis"><em>uniqueMember</em></span> attributes; or a combination of the two. Once a user is successfully authenticated to the LDAP server, a group search is performed to load that user’s group information. Depending on the directory server in use, group searches can be performed using their simple name (usually the username used in authentication) or by using the distinguished name of the user’s entry in the directory. Group searches (<code class="literal">&lt;group-search&gt;</code>) as well as mapping between a username and a distinguished name (<code class="literal">&lt;username-to-dn&gt;</code>) are configured when setting up LDAP as an authorization mechanism in a security realm.
				</p><p>
					Once a user’s group membership information is determined from the LDAP server, a mapping within the RBAC configuration is used to determine what role(s) a user has. This mapping is configured to explicitly include or exclude groups as well as individual users.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The authentication step of a user connecting to the server always happens first. Once the user is successfully authenticated the server loads the user’s groups. The authentication step and the authorization step each require a connection to the LDAP server. The security realm optimizes this process by reusing the authentication connection for the group loading step.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="using_group_search"/>Using group-search</h3></div></div></div><p>
						There are two different styles that can be used when searching for group membership information: <span class="emphasis"><em>Principal to Group</em></span> and <span class="emphasis"><em>Group to Principal</em></span>. Principal to Group has the user’s entry containing references to the group(s) it is a member of (i.e. <span class="emphasis"><em>memberOf</em></span> attribute). Group to Principal has the group’s entry contain the references to the user(s) who are members of it (i.e. <span class="emphasis"><em>uniqueMember</em></span>).
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							JBoss EAP 6 supports both Principal to Group as well as Group to Principal searches, but Principal to Group is recommended over Group to Principal. If Principal to Group is used, group information can be loaded directly by reading attributes of known distinguished names without having to perform any searches. Group to Principal requires extensive searches to identify the all groups that reference a user.
						</p></div><p>
						Both Principal to Group and Group to Principal use the <code class="literal">&lt;group-search&gt;</code> tag which contains the following attributes:
					</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										group-name
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										This attribute is used to specify the form that should be used for the group name returned as the list of groups of which the user is a member. This can either be the simple form of the group name or the group’s distinguished name. If the distinguished name is required this attribute can be set to DISTINGUISHED_NAME. Defaults to SIMPLE.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										iterative
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										This attribute is used to indicate if, after identifying the groups a user is a member of, we should also iteratively search based on the groups to identify which groups the groups are a member of. If iterative searching is enabled we keep going until either we reach a group that is not a member if any other groups or a cycle is detected. Defaults to false.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										group-dn-attribute
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										On an entry for a group which attribute is its distinguished name. Defaults to dn.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										group-name-attribute
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										On an entry for a group which attribute is its simple name. Defaults to uid.
									</p>
									 </td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Cyclic group membership is not a problem. A record of each search is kept to prevent groups that have already been searched from being searched again.
						</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							For iterative searching to work the group entries need to look the same as user entries. The same approach used to identify the groups a user is a member of is then used to identify the groups of which the group is a member. This would not be possible if for group to group membership the name of the attribute used for the cross reference changes or if the direction of the reference changes.
						</p></div><div class="title"><strong>Principal to Group (memberOf) for Group Search</strong></div><p>
							Consider an example where a user <span class="emphasis"><em>TestUserOne</em></span> who is a member of <span class="emphasis"><em>GroupOne</em></span>, and <span class="emphasis"><em>GroupOne</em></span> is in turn a member of <span class="emphasis"><em>GroupFive</em></span>. The group membership would be shown by the use of a <span class="emphasis"><em>memberOf</em></span> attribute at the member level. This means, <span class="emphasis"><em>TestUserOne</em></span> would have a <span class="emphasis"><em>memberOf</em></span> attribute set to the <span class="emphasis"><em>dn</em></span> of <span class="emphasis"><em>GroupOne</em></span>. <span class="emphasis"><em>GroupOne</em></span> in turn would have a <span class="emphasis"><em>memberOf</em></span> attribute set to the <span class="emphasis"><em>dn</em></span> of <span class="emphasis"><em>GroupFive</em></span>.
						</p><p>
						To use this type of searching, the <span class="emphasis"><em>principal-to-group</em></span> element is added to the <span class="emphasis"><em>group-search</em></span> element:
					</p><div class="title"><strong>Principal to Group (i.e. memberOf) Configuration</strong></div><p>
							
</p><pre class="programlisting">&lt;security-realm name="ldap-security-realm"&gt;
  &lt;authentication&gt;
    &lt;ldap connection="ldap-connection" &gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;ldap connection="ldap-connection"&gt;
      &lt;!-- configuration --&gt;
        &lt;group-search group-name="SIMPLE" iterative="true" group-dn-attribute="dn" group-name-attribute="uid"&gt;
            &lt;principal-to-group group-attribute="memberOf" /&gt;
        &lt;/group-search&gt;
    &lt;/ldap&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;</pre><p>

						</p><p>
						Notice that within <code class="literal">&lt;group-search&gt;</code>, <code class="literal">&lt;principal-to-group&gt;</code> has been added with a <code class="literal">group-attribute</code> attribute. For reference:
					</p><div class="table"><a id="idm140421020711520"/><p class="title"><strong>Table 3.2. principal-to-group</strong></p><div class="table-contents"><table summary="principal-to-group" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										group-attribute
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The name of the attribute on the user entry that matches the distinguished name of the group the user is a member of. Defaults to memberOf.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										prefer-original-connection
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										This value is used to indicate which group information to prefer when following a referral. Each time a principal is loaded, attributes from each of their group memberships are subsequently loaded. Each time attributes are loaded, either the original connection or connection from the last referral can be used. Defaults to <span class="emphasis"><em>true</em></span>.
									</p>
									 </td></tr></tbody></table></div></div><div class="title"><strong>Group to Principal (i.e. uniqueMember) Group Search</strong></div><p>
							Consider the same example as Principal to Group where a user <span class="emphasis"><em>TestUserOne</em></span> who is a member of <span class="emphasis"><em>GroupOne</em></span>, and <span class="emphasis"><em>GroupOne</em></span> is in turn a member of <span class="emphasis"><em>GroupFive</em></span>. However, in this case the group membership would be shown by the use of the <span class="emphasis"><em>uniqueMember</em></span> attribute set at the group level. This means, <span class="emphasis"><em>GroupFive</em></span> would have a <span class="emphasis"><em>uniqueMember</em></span> set to the <span class="emphasis"><em>dn</em></span> of <span class="emphasis"><em>GroupOne</em></span>. <span class="emphasis"><em>GroupOne</em></span> in turn would have a <span class="emphasis"><em>uniqueMember</em></span> set to the <span class="emphasis"><em>dn</em></span> of <span class="emphasis"><em>TestUserOne</em></span>.
						</p><p>
						To use this type of searching, the <span class="emphasis"><em>group-to-principal</em></span> element is added to the <span class="emphasis"><em>group-search</em></span> element:
					</p><div class="title"><strong>Group to Principal (i.e. uniqueMember) Configuration</strong></div><p>
							
</p><pre class="programlisting">&lt;security-realm name="ldap-security-realm"&gt;
  &lt;authentication&gt;
    &lt;ldap connection="ldap-connection" &gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;ldap connection="ldap-connection"&gt;
      &lt;!-- configuration --&gt;
      &lt;group-search group-name="SIMPLE" iterative="true" group-dn-attribute="dn" group-name-attribute="uid"&gt;
        &lt;group-to-principal base-dn="ou=groups,dc=group-to-principal,dc=example,dc=org" recursive="true" search-by="DISTINGUISHED_NAME"&gt;
          &lt;membership-filter principal-attribute="uniqueMember" /&gt;
        &lt;/group-to-principal&gt;
      &lt;/group-search&gt;
    &lt;/ldap&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;</pre><p>

						</p><p>
						Notice that within <code class="literal">&lt;group-search&gt;</code>, <code class="literal">&lt;group-to-principal&gt;</code> has been added with attributes and contains <code class="literal">&lt;membership-filter&gt;</code>. <code class="literal">group-to-principal</code> is used to define how searches for groups that reference the user entry will be performed, and <code class="literal">membership-filter</code> is used to define the cross reference.
					</p><p>
						For reference:
					</p><div class="table"><a id="idm140421024124464"/><p class="title"><strong>Table 3.3. group-to-principal</strong></p><div class="table-contents"><table summary="group-to-principal" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										base-dn
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The distinguished name of the context to use to begin the search.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										recursive
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Whether sub-contexts also be searched. Defaults to false.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										search-by
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The form of the role name used in searches. Valid values are SIMPLE and DISTINGUISHED_NAME. Defaults to DISTINGUISHED_NAME.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										prefer-original-connection
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										This value is used to indicate which group information to prefer when following a referral. Each time a principal is loaded, attributes from each of their group memberships are subsequently loaded. Each time attributes are loaded, either the original connection or connection from the last referral can be used.
									</p>
									 </td></tr></tbody></table></div></div><div class="table"><a id="idm140421014709232"/><p class="title"><strong>Table 3.4. membership-filter</strong></p><div class="table-contents"><table summary="membership-filter" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										principal-attribute
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The name of the attribute on the group entry that references the user entry. Defaults to member.
									</p>
									 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="using_username_to_dn"/>Using username-to-dn</h3></div></div></div><p>
						It is possible to define rules within the authorization section to convert a user’s simple user name to their distinguished name. The username-to-dn element specifies how to map the user name to the distinguished name of their entry in the LDAP directory. This element is <span class="strong"><strong>optional</strong></span> and only required when both of the following are true:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The authentication and authorization steps are against different LDAP servers.
							</li><li class="listitem">
								The group search uses the distinguished name.
							</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							This could also be applicable in instances where the security realm supports both LDAP and Kerberos authentication and a conversion is needed for Kerberos, if LDAP authentication has been performed the DN discovered during authentication can be used.
						</p></div><p>
						It contains the following attributes:
					</p><div class="table"><a id="idm140421022982448"/><p class="title"><strong>Table 3.5. username-to-dn</strong></p><div class="table-contents"><table summary="username-to-dn" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										force
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The result of a <span class="emphasis"><em>user name to distinguished name mapping</em></span> search during authentication is cached and reused during the authorization query when the force attribute is set to "false". When force is true, the search is performed again during authorization (while loading groups). This is typically done when different servers perform authentication and authorization.
									</p>
									 </td></tr></tbody></table></div></div><p>
						<code class="literal">username-to-dn</code> can be configured with one of the following:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;username-is-dn&gt;</span></dt><dd>
									This specifies that the user name entered by the remote user is the user’s distinguished name.
								</dd></dl></div><div class="title"><strong>username-is-dn Example</strong></div><p>
							
</p><pre class="programlisting">&lt;security-realm name="ldap-security-realm"&gt;
  &lt;authentication&gt;
    &lt;ldap connection="ldap-connection" &gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;ldap connection="ldap-connection"&gt;
      &lt;username-to-dn force="false"&gt;
        &lt;username-is-dn /&gt;
      &lt;/username-to-dn&gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;</pre><p>

						</p><p>
						This defines a 1:1 mapping and there is no additional configuration.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;username-filter&gt;</span></dt><dd>
									A specified attribute is searched for a match against the supplied user name.
								</dd></dl></div><div class="title"><strong>username-filter Example</strong></div><p>
							
</p><pre class="programlisting">&lt;security-realm name="ldap-security-realm"&gt;
  &lt;authentication&gt;
    &lt;ldap connection="ldap-connection" &gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;ldap connection="ldap-connection"&gt;
      &lt;username-to-dn force="true"&gt;
        &lt;username-filter base-dn="dc=people,dc=harold,dc=example,dc=com" recursive="false" attribute="sn" user-dn-attribute="dn" /&gt;
      &lt;/username-to-dn&gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;</pre><p>

						</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										base-dn
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The distinguished name of the context to begin the search.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										recursive
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Whether the search will extend to sub contexts. Defaults to false.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										attribute
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The attribute of the users entry to try and match against the supplied user name. Defaults to uid.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										user-dn-attribute
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The attribute to read to obtain the users distinguished name. Defaults to dn.
									</p>
									 </td></tr></tbody></table></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;advanced-filter&gt;</span></dt><dd>
									This option uses a custom filter to locate the users distinguished name.
								</dd></dl></div><div class="title"><strong>advanced-filter Example</strong></div><p>
							
</p><pre class="programlisting">&lt;security-realm name="ldap-security-realm"&gt;
  &lt;authentication&gt;
    &lt;ldap connection="ldap-connection" &gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;ldap connection="ldap-connection"&gt;
      &lt;username-to-dn force="true"&gt;
        &lt;advanced-filter base-dn="dc=people,dc=harold,dc=example,dc=com" recursive="false" filter="sAMAccountName={0}" user-dn-attribute="dn" /&gt;
      &lt;/username-to-dn&gt;
      &lt;!-- configuration --&gt;
    &lt;/ldap&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;</pre><p>

						</p><p>
						For the attributes that match those in the <span class="emphasis"><em>username-filter</em></span> example, the meaning and default values are the same. There is one additional attribute:
					</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										filter
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Custom filter used to search for a user’s entry where the user name will be substituted in the {0} place holder.
									</p>
									 </td></tr></tbody></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							The XML must remain valid after the filter is defined so if any special characters are used (such as <span class="emphasis"><em>&amp;</em></span>) ensure the proper form is used. For example <span class="emphasis"><em>&amp;amp;</em></span> for the <span class="emphasis"><em>&amp;</em></span> character.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mapping_ldap_group_information_to_rbac_roles"/>Mapping LDAP Group Information to RBAC Roles</h3></div></div></div><p>
						Once the connection to the LDAP server has been created and the group searching has been properly configured, a mapping needs to be created between the LDAP groups and RBAC roles. This mapping can be both inclusive as well as exclusive and enables users to be automatically assigned one or more roles based on their group membership information.
					</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
							If RBAC is not already configured, pay close attention when doing so, especially if switching to a newly-created LDAP-enabled realm. Enabling RBAC without having users and roles properly configured could result in administrators being unable to login to the management interfaces.
						</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The below CLI commands were done assuming a standalone instance of JBoss EAP 6. For more details on using the CLI with JBoss EAP 6 domains, please consult <span class="emphasis"><em>The Management CLI</em></span> section of the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#sect-The_Management_CLI">Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
						</p></div><div class="title"><strong>Ensure RBAC is Enabled and Configured</strong></div><p>
							Before mappings between LDAP and RBAC Roles can be used, RBAC must enabled and initially configured.
						</p><pre class="programlisting">/core-service=management/access=authorization:read-attribute(name=provider)</pre><p>
						It should yield the following result:
					</p><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; "rbac"
}</pre><p>
						For more information on enabling and configuring RBAC, please see the <span class="emphasis"><em>Enabling Role-Based Access Control</em></span> section of the <a class="link" href="/documentation/en/red-hat-jboss-enterprise-application-platform/version-6.4/how-to-configure-server-security#enabling_role_based_access_control">Red Hat JBoss Enterprise Application Platform 6 How to Configure Server Security guide</a>.
					</p><div class="title"><strong>Verify Existing List of Roles</strong></div><p>
							Use the read-children-names operation to get a complete list of the configured roles:
						</p><pre class="programlisting">/core-service=management/access=authorization:read-children-names(child-type=role-mapping)</pre><p>
						Which should yield a list of roles:
					</p><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "Administrator",
        "Deployer",
        "Maintainer",
        "Monitor",
        "Operator",
        "SuperUser"
    ]
}</pre><p>
						In addition, all existing mappings for a role may be checked:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Administrator:read-resource(recursive=true)</pre><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "include-all" =&gt; false,
        "exclude" =&gt; undefined,
        "include" =&gt; {
            "user-theboss" =&gt; {
                "name" =&gt; "theboss",
                "realm" =&gt; undefined,
                "type" =&gt; "USER"
            },
            "user-harold" =&gt; {
                "name" =&gt; "harold",
                "realm" =&gt; undefined,
                "type" =&gt; "USER"
            },
            "group-SysOps" =&gt; {
                "name" =&gt; "SysOps",
                "realm" =&gt; undefined,
                "type" =&gt; "GROUP"
            }
        }
    }
}</pre><div class="title"><strong>Configure a Role-Mapping entry</strong></div><p>
							If a role does not already have a Role-Mapping entry, one needs to be created. For instance:
						</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor:read-resource()</pre><pre class="programlisting">{
    "outcome" =&gt; "failed",
    "failure-description" =&gt; "JBAS014807: Management resource '[
    (\"core-service\" =&gt; \"management\"),
    (\"access\" =&gt; \"authorization\"),
    (\"role-mapping\" =&gt; \"Auditor\")
]' not found"
}</pre><p>
						To add a role mapping:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor:add()</pre><pre class="programlisting">{
    "outcome" =&gt; "success"
}</pre><p>
						To verify:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor:read-resource()</pre><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "include-all" =&gt; false,
        "exclude" =&gt; undefined,
        "include" =&gt; undefined
    }
}
⁠</pre><div class="title"><strong>Add Groups to the Role for Inclusion and Exclusion</strong></div><p>
							Groups may be added for inclusion or exclusion from a role.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The exclusion mapping takes precedence or the inclusion mapping.
						</p></div><p>
						To add a group for inclusion:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor/include=group-GroupToInclude:add(name=GroupToInclude, type=GROUP)</pre><p>
						To add a group for exclusion:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor/exclude=group-GroupToExclude:add(name=GroupToExclude, type=GROUP)</pre><p>
						To check the result:
					</p><pre class="programlisting">[standalone@localhost:9999 /] /core-service=management/access=authorization/role-mapping=Auditor:read-resource(recursive=true)</pre><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "include-all" =&gt; false,
        "exclude" =&gt; {"group-GroupToExclude" =&gt; {
            "name" =&gt; "GroupToExclude",
            "realm" =&gt; undefined,
            "type" =&gt; "GROUP"
        }},
        "include" =&gt; {"group-GroupToInclude" =&gt; {
            "name" =&gt; "GroupToInclude",
            "realm" =&gt; undefined,
            "type" =&gt; "GROUP"
        }}
    }
}</pre><div class="title"><strong>Removing a Group from a Role</strong></div><p>
							Groups that are added for exclusion or inclusion may also be removed
						</p><p>
						To remove a group from inclusion:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor/include=group-GroupToInclude:remove</pre><p>
						To remove a group from exclusion:
					</p><pre class="programlisting">/core-service=management/access=authorization/role-mapping=Auditor/exclude=group-GroupToExclude:remove</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enabling_caching"/>Enabling Caching</h1></div></div></div><p>
				Security Realms also offer the ability to cache the results of LDAP queries for both authentication as well as group loading. This enables the results of different queries to be reused across multiple searches by different users in certain circumstances (e.g. iteratively querying the group membership information of groups). There are three different caches available, each of which are configured separately and operate independently:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						authentication
					</li><li class="listitem">
						group-to-principal
					</li><li class="listitem">
						username-to-dn
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cache_configuration"/>Cache Configuration</h2></div></div></div><p>
					Even though the caches are independent of one another, all three are configured in the same manner. Each cache offers the following configuration options:
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									type
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This defines the eviction straregy that the cache will adhere to. Options are <span class="strong"><strong>by-access-time</strong></span> and <span class="strong"><strong>by-search-time</strong></span>. <span class="strong"><strong>by-access-time</strong></span> evicts items from the cache after a certain period of time has elapsed since their last access. <span class="strong"><strong>by-search-time</strong></span> evicts items based on how long they have been in the cache regardless of their last access.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									eviction-time
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This defines the time (in seconds) used for evictions depending on the strategy.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									cache-failures
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is a boolean that enables/disables the caching of failed searches. This has the potential for preventing an LDAP server from being repeatedly access by the same failed search, but it also has the potential to fill up the cache with searches for users that do not exist. This setting is particularly important for the authentication cache.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									max-cache-size
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This defines maximum size (number of items) of the cache, which in-turn dictates when items will begin getting evicted. Old items are evicted from the cache to make room for new authentication and searches as needed, meaning <span class="emphasis"><em>max-cache-size</em></span> will not prevent new authentication attempts or searches from occuring.
								</p>
								 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="example"/>Example</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						This example assumes a security realm has been created named <span class="emphasis"><em>LDAPRealm</em></span> that connects to an existing LDAP server and is configured for authentication and authorization. The commands to display the current configuration are detailed in a <a class="link" href="securing_the_management_interfaces_with_ldap.html#reading_the_current_cache_configuration" title="Reading the Current Cache Configuration">later section</a>. More details on creating a security realm that uses LDAP can be found <a class="link" href="securing_the_management_interfaces_with_ldap.html#basic_setup" title="Basic setup">here</a>.
					</p></div><div class="title"><strong>Example Base Configuration</strong></div><p>
						
</p><pre class="programlisting">​"core-service" : {
​        "management" : {
​            "security-realm" : {
​                "LDAPRealm" : {
​                    "authentication" : {"ldap" : {
​                        "allow-empty-passwords" : false,
​                        "base-dn" : "...",
​                        "connection" : "MyLdapConnection",
​                        "recursive" : false,
​                        "user-dn" : "dn",
​                        "username-attribute" : "uid",
​                        "cache" : null
​                    }},
​                    "authorization" : {"ldap" : {
​                        "connection" : "MyLdapConnection",
​                        "group-search" : {"group-to-principal" : {
​                            "base-dn" : "...",
​                            "group-dn-attribute" : "dn",
​                            "group-name" : "SIMPLE",
​                            "group-name-attribute" : "uid",
​                            "iterative" : true,
​                          "principal-attribute" : "uniqueMember",
​                            "search-by" : "DISTINGUISHED_NAME",
​                            "cache" : null
​                        }},
​                        "username-to-dn" : {"username-filter" : {
​                            "attribute" : "uid",
​                            "base-dn" : "...",
​                            "force" : false,
​                            "recursive" : false,
​                            "user-dn-attribute" : "dn",
​                            "cache" : null
​                        }}
​                    }},
​                }
​            }
​        }</pre><p>

					</p><p>
					In all areas where <span class="strong"><strong>"cache" : null</strong></span> appear, a cache may be configured:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication</span></dt><dd>
								During authentication the user’s distinguished name is discovered using this definition and an attempt to connect to the LDAP server and verify their identity is made using these credentials.
							</dd><dt><span class="term">A group-search definition</span></dt><dd>
								There is the group search definition, in this case it is an iterative search (because <span class="strong"><strong>iterative</strong></span> is set to <span class="strong"><strong>true</strong></span> in the sample configuration above). First, a search will be performed to find all groups the user is a direct member of. After that, a search will be performed for each of those groups to identify if they have membership to other groups. This process continues until either a cyclic reference is detected or the final groups are not members of any further groups.
							</dd><dt><span class="term">A username-to-dn definition in group search</span></dt><dd>
								Group searching relies on the availability of the users distinguished name. This section is not used in all situations, but it can be used as a second attempt to discover a user’s distinguished name. This, for instance, may be useful or even required when a second form of authentication was supported (e.g. local authentication).
							</dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="reading_the_current_cache_configuration"/>Reading the Current Cache Configuration</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The CLI commands used in this and subsequent sections use <span class="emphasis"><em>LDAPRealm</em></span> for the name of the security realm. This should be substituted for the name of the actual realm being configured.
						</p></div><div class="title"><strong>CLI Command to Read the Current Cache Configuration</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm:read-resource(recursive=true)</pre><p>

						</p><div class="title"><strong>Output</strong></div><p>
							
</p><pre class="programlisting">​​{
​    "outcome" =&gt; "success",
​    "result" =&gt; {
​        "map-groups-to-roles" =&gt; true,
​        "authentication" =&gt; {"ldap" =&gt; {
​            "advanced-filter" =&gt; undefined,
​            "allow-empty-passwords" =&gt; false,
​            "base-dn" =&gt; "dc=example,dc=com",
​            "connection" =&gt; "ldapConnection",
​            "recursive" =&gt; true,
​            "user-dn" =&gt; "dn",
​            "username-attribute" =&gt; "uid",
​            "cache" =&gt; undefined
​        }},
​        "authorization" =&gt; {"ldap" =&gt; {
​            "connection" =&gt; "ldapConnection",
​            "group-search" =&gt; {"principal-to-group" =&gt; {
​                "group-attribute" =&gt; "description",
​                "group-dn-attribute" =&gt; "dn",
​                "group-name" =&gt; "SIMPLE",
​                "group-name-attribute" =&gt; "cn",
​                "iterative" =&gt; false,
​                "prefer-original-connection" =&gt; true,
​                "skip-missing-groups" =&gt; false,
​                "cache" =&gt; undefined
​            }},
​            "username-to-dn" =&gt; {"username-filter" =&gt; {
​                "attribute" =&gt; "uid",
​                "base-dn" =&gt; "ou=Users,dc=jboss,dc=org",
​                "force" =&gt; true,
​                "recursive" =&gt; false,
​                "user-dn-attribute" =&gt; "dn",
​                "cache" =&gt; undefined
​            }}
​        }},
​        "plug-in" =&gt; undefined,
​        "server-identity" =&gt; undefined
​    }
​}</pre><p>

						</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="enabling_a_cache"/>Enabling a Cache</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The CLI commands used in this and subsequent sections configure the cache in the authentication portion of the security realm (i.e. <span class="emphasis"><em>/authentication=ldap/</em></span>). Caches in the authorization portion may also be configured in a similar manner by updating the path of the command.
						</p></div><div class="title"><strong>CLI for Enabling a Cache</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-access-time:add( \
eviction-time=300, cache-failures=true, max-cache-size=100)</pre><p>

						</p><p>
						This commands adds a <span class="strong"><strong>by-access-time</strong></span> cache for authentication with an eviction time of 300 seconds (5 minutes) and a max cache size of 100 items. In addition, failed searches will be cached. Alternatively, a <span class="strong"><strong>by-search-time</strong></span> cache could also be configured:
					</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-search-time:add( \
eviction-time=300, cache-failures=true, max-cache-size=100)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="inspecting_an_existing_cache"/>Inspecting an Existing Cache</h3></div></div></div><div class="title"><strong>CLI for Inspecting an Existing Cache</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-access-time:read-resource(include-runtime=true)</pre><p>

						</p><div class="title"><strong>Output</strong></div><p>
							
</p><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "cache-failures" =&gt; true,
        "cache-size" =&gt; 1,
        "eviction-time" =&gt; 300,
        "max-cache-size" =&gt; 100
    }
}</pre><p>

						</p><p>
						The <span class="emphasis"><em>include-runtime</em></span> attribute adds the <span class="strong"><strong>cache-size</strong></span> element, which displays the current number of items in the cache (1 in this case).
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="testing_an_existing_cache_s_contents"/>Testing an Existing Cache’s Contents</h3></div></div></div><div class="title"><strong>CLI for Testing an Existing Cache’s Contents</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-access-time:contains(name=TestUserOne)</pre><p>

						</p><div class="title"><strong>Output</strong></div><p>
							
</p><pre class="programlisting">{
    "outcome" =&gt; "success",
    "result" =&gt; true
}</pre><p>

						</p><p>
						This shows that an entry for <span class="emphasis"><em>TestUserOne</em></span> exists the in the cache.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="flushing_a_cache"/>Flushing a Cache</h3></div></div></div><p>
						An entire cache may be flushed as can individual items from a cache.
					</p><div class="title"><strong>CLI for Flushing a Single Item</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-access-time:flush-cache(name=TestUserOne)</pre><p>

						</p><div class="title"><strong>CLI for Flushing an Entire Cache</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-access-time:flush-cache()</pre><p>

						</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="removing_a_cache"/>Removing a Cache</h3></div></div></div><div class="title"><strong>CLI for Removing a Cache</strong></div><p>
							
</p><pre class="programlisting">/core-service=management/security-realm=LDAPRealm/authentication=ldap/cache=by-access-time:remove()</pre><p>

						</p><pre class="programlisting">reload</pre></div></div></div></div></body></html>