<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. How to Setup SSO for Red Hat JBoss Enterprise Application Platform 6 with Kerberos</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos"/>Chapter 2. How to Setup SSO for Red Hat JBoss Enterprise Application Platform 6 with Kerberos</h1></div></div></div><p>
			This section covers how to configure JBoss EAP 6 and the deployed applications to use Kerberos for SSO.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="components"/>Components</h1></div></div></div><p>
				The following components are needed for setting SSO for JBoss EAP 6 with Kerberos:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						A properly configured Kerberos environment
					</li><li class="listitem">
						A JBoss EAP 6 instance
					</li><li class="listitem">
						A web application
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jboss_negotiation_toolkit"/>JBoss Negotiation Toolkit</h2></div></div></div><p>
					The <span class="emphasis"><em>JBoss Negotiation Toolkit</em></span> is a debugging tool which is available for download from <a class="link" href="https://community.jboss.org/servlet/JiveServlet/download/16876-2-34629/jboss-negotiation-toolkit.war">https://community.jboss.org/servlet/JiveServlet/download/16876-2-34629/jboss-negotiation-toolkit.war</a>. It is provided as an extra tool to help users to debug and test the authentication mechanisms before introducing an application into production. It is an unsupported tool, but is considered to be very helpful, as SPNEGO can be difficult to configure for web applications.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos_environment"/>Kerberos Environment</h2></div></div></div><p>
					As discussed in <a class="link" href="sso_with_kerberos_deeper_dive.html#how_does_kerberos_provide_sso_for_red_hat_jboss_enterprise_application_platform" title="How does Kerberos provide SSO for Red Hat JBoss Enterprise Application Platform?">a previous section</a>, Kerberos relies on a third party (the KDC), to provide authentication and authorization decisions. This also requires clients (e.g. browsers) and their host to be properly configured to authenticate with the KDC. This guide is primarily focused on how to configure JBoss EAP 6 and its hosted web applications so configuring the KDC and Kerberos domain are not in the scope of this document.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The subsequent sections assume a KDC and Kerberos domain have already been set up and properly configured.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="differences_from_configuring_previous_versions_red_hat_jboss_enterprise_application_platform"/>Differences from Configuring Previous Versions Red Hat JBoss Enterprise Application Platform</h2></div></div></div><p>
					There are a few noticeable differences between JBoss EAP 6 and earlier versions:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Security domains are configured for each profile of a managed domain, or for each standalone server. They are not part of the deployment itself. The security domain a deployment should use is named in the deployment’s <code class="literal">jboss-web.xml</code> or <code class="literal">jboss-ejb3.xml</code> file.
						</li><li class="listitem">
							Security properties are configured as part of a security domain. They are not part of the deployment.
						</li><li class="listitem">
							Authenticators can no longer be overriden as part of a deployment. However, a NegotiationAuthenticator valve can be added to the <code class="literal">jboss-web.xml</code> descriptor to achieve the same effect. The valve still requires the <span class="emphasis"><em>&lt;security-constraint&gt;</em></span> and <span class="emphasis"><em>&lt;login-config&gt;</em></span> elements to be defined in the <code class="literal">web.xml</code>. These are used to decide which resources are secured. However, the chosen <span class="emphasis"><em>auth-method</em></span> will be overridden by the NegotiationAuthenticator valve in the <code class="literal">jboss-web.xml</code>.
						</li><li class="listitem">
							The <span class="emphasis"><em>CODE</em></span> attributes in security domains now use a simple name instead of a fully-qualified class name. The below table shows the mappings between the classes used for JBoss Negotiation, and their classes.
						</li></ul></div><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Simple Name</th><th style="text-align: left" valign="top">Class Name</th><th style="text-align: left" valign="top">Purpose</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Kerberos
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									com.sun.security.auth.module.Krb5LoginModule
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Kerberos login module when using the Oracle JDK
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Kerberos
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									com.ibm.security.auth.module.Krb5LoginModule
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Kerberos login module when using the IBM JDK
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									SPNEGO
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									org.jboss.security.negotiation.spnego.SPNEGOLoginModule
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The mechanism which enables your Web applications to authenticate to your Kerberos authentication server.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									AdvancedLdap
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									org.jboss.security.negotiation.AdvancedLdapLoginModule
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Used with LDAP servers other than Microsoft Active Directory.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									AdvancedAdLdap
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									org.jboss.security.negotiation.AdvancedADLoginModule
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Used with Microsoft Active Directory LDAP servers.
								</p>
								 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_the_red_hat_jboss_enterprise_application_platform_6_instance"/>Configuring the Red Hat JBoss Enterprise Application Platform 6 Instance</h2></div></div></div><p>
					JBoss EAP 6 comes with all the components necessary to use Kerberos (via SPNEGO and JBoss Negotiation) for SSO with deployed applications, but the following configuration changes need to be made:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							<a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#one_configuring_server_identity_host_security_domain" title="1. Configuring Server Identity (Host) Security Domain">Configure Server Identity (Host) Security Domain</a>
						</li><li class="listitem">
							<a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#two_configuring_web_application_security_domain" title="2. Configuring Web Application Security Domain">Configure Web Application Security Domain</a>
						</li><li class="listitem">
							<a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#three_configuring_relevant_system_properties" title="3. Configuring Relevant System Properties">Configure Relevant System Properties</a>
						</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The CLI commands shown below were done assuming a standalone instance of JBoss EAP 6. For more details on using the CLI with JBoss EAP 6 domains, please consult <span class="emphasis"><em>The Management CLI</em></span> section of the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#sect-The_Management_CLI">Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="one_configuring_server_identity_host_security_domain"/>1. Configuring Server Identity (Host) Security Domain</h3></div></div></div><p>
						This security domain authenticates the container itself to the KDC. It needs to use a login module which accepts a static login mechanism since a real user is not involved in this connection. The below example uses a static principal and references a keytab file which contains the credential.
					</p><div class="title"><strong>Example CLI for Creating a Server Identity Security Domain</strong></div><p>
							
</p><pre class="programlisting">/subsystem=security/security-domain=host:add(cache-type=default)</pre><p>

						</p><pre class="programlisting">/subsystem=security/security-domain=host/authentication=classic:add</pre><pre class="programlisting">/subsystem=security/security-domain=host/authentication=classic/login-module=Kerberos:add( \
  code=Kerberos, \
  flag=required, \
  module-options=[ \
    ("storeKey"=&gt;"true"), \
    ("refreshKrb5Config"=&gt;"true"), \
    ("useKeyTab"=&gt;"true"), \
    ("principal"=&gt;"host/testserver@MY_REALM"), \
    ("keyTab"=&gt;"/home/username/service.keytab"), \
    ("doNotPrompt"=&gt;"true"), \
    ("debug"=&gt;"false") \
  ])</pre><pre class="programlisting">reload</pre><div class="title"><strong>Resulting XML</strong></div><p>
							
</p><pre class="programlisting">&lt;security-domain name="host" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;login-module code="Kerberos" flag="required"&gt;
      &lt;module-option name="storeKey" value="true"/&gt;
      &lt;module-option name="useKeyTab" value="true"/&gt;
      &lt;module-option name="principal" value="host/testserver@MY_REALM"/&gt;
      &lt;module-option name="keyTab" value="/home/username/service.keytab"/&gt;
      &lt;module-option name="doNotPrompt" value="true"/&gt;
      &lt;module-option name="debug" value="false"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre><p>

						</p><p>
						If using the IBM JDK, options for Kerberos module are different. The <span class="strong"><strong>jboss.security.disable.secdomain.option</strong></span> system property must be set to <span class="strong"><strong>true</strong></span> (see <a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#three_configuring_relevant_system_properties" title="3. Configuring Relevant System Properties">Configure Relevant System Properties</a>). In addition the login module should be updated to the following:
					</p><div class="title"><strong>IBM JDK Example</strong></div><p>
							
</p><pre class="programlisting">&lt;security-domain name="host" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;login-module code="Kerberos" flag="required"&gt;
      &lt;module-option name="principal" value="HTTP/testserver@MY_REALM"/&gt;
      &lt;module-option name="credsType" value="acceptor"/&gt;
      &lt;module-option name="useKeytab" value="file:///root/keytab"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre><p>

						</p><p>
						For a complete list of options for configuring the <span class="emphasis"><em>Kerberos</em></span> login module, refer to the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html/Security_Guide/appe-Reference.html#topic4732_kerberos">Red Hat JBoss Enterprise Application Platform 6 Security Guide</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="two_configuring_web_application_security_domain"/>2. Configuring Web Application Security Domain</h3></div></div></div><p>
						The web application security domain is used to authenticate the individual user to the KDC. There needs to be at least one login module to authenticate the user, and a way to search for the roles to apply to the user. The latter can be accomplished in many different ways (e.g. adding a <code class="literal">&lt;mapping&gt;</code> that manually maps users to roles, adding a second login module for mapping users to roles, etc).
					</p><p>
						The following shows an example web application security domain.
					</p><div class="title"><strong>Example CLI for Creating a Server Identity Security Domain</strong></div><p>
							
</p><pre class="programlisting">/subsystem=security/security-domain=app-spnego:add(cache-type=default)</pre><p>

						</p><pre class="programlisting">/subsystem=security/security-domain=app-spnego/authentication=classic:add</pre><pre class="programlisting">/subsystem=security/security-domain=app-spnego/authentication=classic/login-module=SPNEGO:add( \
  code=SPNEGO, \
  flag=required, \
  module-options=[ \
    ("serverSecurityDomain"=&gt;"host") \
  ])</pre><pre class="programlisting">reload</pre><div class="title"><strong>Resulting XML</strong></div><p>
							
</p><pre class="programlisting">&lt;security-domain name="app-spnego" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;!-- Check the username and password --&gt;
    &lt;login-module code="SPNEGO"  flag="required"&gt;
      &lt;module-option name="serverSecurityDomain" value="host"/&gt;
    &lt;/login-module&gt;
    &lt;!-- Second login module to search for roles --&gt;
  &lt;/authentication&gt;
  &lt;!-- Alternatively, a 'mapping' element may be added instead of a second login module to map users to roles--&gt;
&lt;/security-domain&gt;</pre><p>

						</p><p>
						For a complete list of options for configuring the <span class="emphasis"><em>SPNEGO</em></span> login module, refer to the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html/Security_Guide/appe-Reference.html#topic4732_spnego">Red Hat JBoss Enterprise Application Platform 6 Security Guide</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="three_configuring_relevant_system_properties"/>3. Configuring Relevant System Properties</h3></div></div></div><p>
						JBoss EAP 6 offers the ability to configure system properties related to connecting to Kerberos servers. Depending on the KDC, Kerberos Domain, and network configuration, the below system properties may or may not be required.
					</p><pre class="programlisting">&lt;system-properties&gt;
  &lt;property name="java.security.krb5.kdc" value="mykdc.mydomain"/&gt;
  &lt;property name="java.security.krb5.realm" value="MY_REALM"/&gt;
  &lt;property name="java.security.krb5.conf" value="/path/to/krb5.conf"/&gt;
  &lt;property name="jboss.security.disable.secdomain.option" value="true"/&gt;
  &lt;property name="sun.security.krb5.debug" value="false"/&gt;
&lt;/system-properties&gt;</pre><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Value</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										java.security.krb5.kdc
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The host name of the KDC
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										java.security.krb5.realm
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The name of the realm
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										java.security.krb5.conf
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The path to the configuration <code class="literal">krb5.conf</code> file
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										jboss.security.disable.secdomain.option
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										When set to <span class="strong"><strong>true</strong></span>, disables automatic adding of <span class="emphasis"><em>jboss.security.security_domain</em></span> login module option to login modules declared in the security domain. Must be set to <span class="strong"><strong>true</strong></span> when using the IBM JDK
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										sun.security.krb5.debug
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										If <span class="strong"><strong>true</strong></span>, debugging mode will be enabled
									</p>
									 </td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							By default, each login module defined in a security domain has the <span class="emphasis"><em>jboss.security.security_domain</em></span> module option added to it automatically. This option causes problems with login modules which check to make sure that only known options are defined. The IBM Kerberos login module, <span class="emphasis"><em>com.ibm.security.auth.module.Krb5LoginModule</em></span> is one of these. This behavior of adding this module option can disabled by setting the <span class="emphasis"><em>jboss.security.disable.secdomain.option</em></span> system property to <span class="strong"><strong>true</strong></span> when starting JBoss EAP 6. This can be accomplished by configuring the <span class="emphasis"><em>&lt;system-properties&gt;</em></span> (via the Management CLI or Management Console) or by adding <code class="literal">-Djboss.security.disable.secdomain.option=true</code> to the start-up parameters.
						</p></div><p>
						For more information about configuring system properties, refer to the <a class="link" href="https://access.redhat.com/documentation/en-US/JBoss_Enterprise_Application_Platform/6.4/html-single/Administration_and_Configuration_Guide/index.html#Configure_System_Properties_Using_the_Management_CLI">Configure System Properties Using the Management CLI section of the Red Hat JBoss Enterprise Application Platform 6 Administration and Configuration Guide</a>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_the_web_application"/>Configuring the Web Application</h2></div></div></div><p>
					Once the security domains have been configured, the web application must be configured to use those security domains in order to enable Kerberos authentication. The following updates must be made the application:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							<a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#one_configuring_the_web_xml_to_use_the_spnego_authentication_method" title="1. Configuring the web.xml to Use the SPNEGO Authentication Method">Configure the web.xml to Use the SPNEGO Authentication Method</a>
						</li><li class="listitem">
							<a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#two_configuring_the_jboss_web_xml_to_use_the_configured_security_domain" title="2. Configuring the jboss-web.xml to Use the Configured Security Domain">Configure the jboss-web.xml to Use the Configured Security Domain</a>
						</li><li class="listitem">
							<a class="link" href="how_to_setup_sso_for_red_hat_jboss_enterprise_application_platform_6_with_kerberos.html#three_adding_the_jboss_negotiation_dependencies_to_the_deployment" title="3. Adding the JBoss Negotiation Dependencies to the Deployment">Add the JBoss Negotiation Dependencies to the Deployment</a>
						</li></ol></div><p>
					Once the application changes have been made, it may be deployed to the JBoss EAP 6 instance and begin using Kerberos for authentication.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="one_configuring_the_web_xml_to_use_the_spnego_authentication_method"/>1. Configuring the web.xml to Use the SPNEGO Authentication Method</h3></div></div></div><p>
						The <code class="literal">web.xml</code> file should contain the following:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A <code class="literal">&lt;security-constraint&gt;</code> with a <code class="literal">&lt;web-resource-collection&gt;</code> containing a <code class="literal">&lt;url-pattern&gt;</code> that maps to the URL pattern of the secured area. Optionally, <code class="literal">&lt;security-constraint&gt;</code> may also contain an <code class="literal">&lt;auth-constraint&gt;</code> stipulating the allowed roles.
							</li><li class="listitem">
								If any roles were specified in the <code class="literal">&lt;auth-constraint&gt;</code>, those roles should be defined in a <code class="literal">&lt;security-role&gt;</code>.
							</li></ul></div><p>
						The <code class="literal">&lt;security-constraint&gt;</code> and <code class="literal">&lt;security-role&gt;</code> elements enable administrators to setup restricted or unrestricted areas based on URL patterns and roles. This allows resources to be secured or unsecured.
					</p><div class="title"><strong>Example <code class="literal">web.xml</code> file:</strong></div><p>
							
</p><pre class="programlisting">&lt;web-app&gt;
  &lt;display-name&gt;App1&lt;/display-name&gt;
  &lt;description&gt;App1&lt;/description&gt;
  &lt;!-- Define a security constraint that requires the All role to access resources --&gt;
  &lt;security-constraint&gt;
    &lt;display-name&gt;Security Constraint on Conversation&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;exampleWebApp&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;All&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
&lt;!-- Define the Login Configuration for this Application --&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;SPNEGO&lt;/auth-method&gt;
    &lt;realm-name&gt;SPNEGO&lt;/realm-name&gt;
  &lt;/login-config&gt;
&lt;!-- Security roles referenced by this web application --&gt;
  &lt;security-role&gt;
    &lt;description&gt;Role required to log in to the Application&lt;/description&gt;
    &lt;role-name&gt;All&lt;/role-name&gt;
  &lt;/security-role&gt;
&lt;/web-app&gt;</pre><p>

						</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="two_configuring_the_jboss_web_xml_to_use_the_configured_security_domain"/>2. Configuring the jboss-web.xml to Use the Configured Security Domain</h3></div></div></div><p>
						The <code class="literal">jboss-web.xml</code> file should have the following:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A <code class="literal">&lt;security-domain&gt;</code> to specify which security domain to use for authentication and authorization.
							</li><li class="listitem">
								A <code class="literal">&lt;valve&gt;</code> configured to use the NegotiationAuthenticator valve class (i.e. <span class="emphasis"><em>org.jboss.security.negotiation.NegotiationAuthenticator</em></span>)
							</li><li class="listitem">
								<span class="strong"><strong>Optional</strong></span>: A &lt;jacc-star-role-allow&gt;, which enables the use of the asterisk (*) character in role-name element in <code class="literal">web.xml</code> to match multiple role names.
							</li></ul></div><div class="title"><strong>An example <code class="literal">jboss-web.xml</code> file:</strong></div><p>
							
</p><pre class="programlisting">&lt;jboss-web&gt;
  &lt;security-domain&gt;app-spnego&lt;/security-domain&gt;
  &lt;valve&gt;
    &lt;class-name&gt;org.jboss.security.negotiation.NegotiationAuthenticator&lt;/class-name&gt;
  &lt;/valve&gt;
  &lt;jacc-star-role-allow&gt;true&lt;/jacc-star-role-allow&gt;
&lt;/jboss-web&gt;</pre><p>

						</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="three_adding_the_jboss_negotiation_dependencies_to_the_deployment"/>3. Adding the JBoss Negotiation Dependencies to the Deployment</h3></div></div></div><p>
						A web application using SPNEGO and JBoss Negotiation requires a dependency to be defined in <code class="literal">jboss-deployment-structure.xml</code> so that the JBoss Negotiation classes can be located. Since JBoss EAP 6 provides all necessary JBoss Negotiation and related classes, the application just needs to declare them as dependencies to use them.
					</p><div class="title"><strong>Using jboss-deployment-structure.xml to declare dependencies</strong></div><p>
							
</p><pre class="programlisting">&lt;jboss-deployment-structure&gt;
  &lt;deployment&gt;
    &lt;dependencies&gt;
      &lt;module name="org.jboss.security.negotiation"/&gt;
    &lt;/dependencies&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre><p>

						</p><p>
						Alternatively, this dependency may be defined in a <code class="literal">META-INF/MANIFEST.MF</code> file instead:
					</p><div class="title"><strong>Using META-INF/MANIFEST.MF to declare dependencies</strong></div><p>
							
</p><pre class="programlisting">Manifest-Version: 1.0
Build-Jdk: 1.6.0_24
Dependencies: org.jboss.security.negotiation</pre><p>

						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="additional_considerations_for_active_directory"/>Additional Considerations for Active Directory</h1></div></div></div><p>
				This section describes how to configure the accounts required for JBoss Negotiation to be used when JBoss EAP 6 is running on a Microsoft Windows server, which is a part of the Active Directory domain.
			</p><p>
				In this section, the hostname that is used to access the server as is referred to as <span class="strong"><strong>HOSTNAME</strong></span>, realm is referred to as <span class="strong"><strong>REALM</strong></span>, domain is referred to as <span class="strong"><strong>DOMAIN</strong></span>, and the server hosting the JBoss EAP 6 instance is referred to as <span class="strong"><strong>MACHINE_NAME</strong></span>. ⁠
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_jboss_negotiation_for_microsoft_windows_domain"/>Configure JBoss Negotiation for Microsoft Windows Domain</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="one_clear_existing_service_principal_mappings"/>1. Clear Existing Service Principal Mappings</h3></div></div></div><p>
						On a Microsoft Windows network some mappings are created automatically. Delete the automatically created mappings to map the identity of the server to the service principal for negotiation to take place correctly. The mapping enables the web browser on the client computer to trust the server and attempt SPNEGO. The client computer verifies with the domain controller for a mapping in the form of HTTP/<span class="strong"><strong>HOSTNAME</strong></span>.
					</p><p>
						The following are the steps to delete the existing mappings:
					</p><div class="title"><strong>List the mapping registered with the domain for the computer using the command:</strong></div><p>
							
</p><pre class="programlisting">setspn -L MACHINE_NAME</pre><p>

						</p><div class="title"><strong>Delete the existing mappings using the commands:</strong></div><p>
							
</p><pre class="programlisting">setspn -D HTTP/HOST_NAME MACHINE_NAME</pre><p>

						</p><pre class="programlisting">setspn -D host/HOSTNAME MACHINE_NAME</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="two_create_a_host_user_account"/>2. Create a host user account.</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Ensure the host user name is different from the <span class="strong"><strong>MACHINE_NAME</strong></span>.
						</p></div><p>
						In the rest of the section the host user name is referred to as <span class="strong"><strong>USER_NAME</strong></span>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="three_define_the_mapping_between_the_emphasis_role_strong_user_name_emphasis_and_emphasis_role_strong_hostname_emphasis"/>3. Define the mapping between the <span class="strong"><strong>USER_NAME</strong></span> and <span class="strong"><strong>HOSTNAME</strong></span>.</h3></div></div></div><p>
						Run the following command to configure the Service Principal Mapping:
					</p><pre class="programlisting">ktpass -princ HTTP/HOSTNAME@REALM -pass * -mapuser DOMAIN\USER_NAME</pre><p>
						Enter the password for the user name when prompted.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Reset the password for the user name as it is a prerequisite for exporting the keytab.
						</p></div><p>
						Verify the mapping by running the following command, setspn -L <span class="strong"><strong>USER_NAME</strong></span>
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="four_export_the_keytab_of_the_user_to_the_server_on_which_eap_jboss_is_installed"/>4. Export the keytab of the user to the server on which EAP JBoss is installed.</h3></div></div></div><p>
						Run the following command to export the keytab:
					</p><pre class="programlisting">ktab -k service.keytab -a HTTP/HOSTNAME@REALM</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							This command exports the ticket for the HTTP/<span class="strong"><strong>HOSTNAME</strong></span> principal to the keytab service.keytab, which is used to configure the host security domain on JBoss EAP 6.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="five_define_the_principal_within_the_security_domain"/>5. Define the principal within the security domain</h3></div></div></div><p>
						The principal can be defined or updated in the security domain as follows:
					</p><pre class="programlisting">&lt;module-option name="principal"&gt;HTTP/HOSTNAME@REALM&lt;/module-option&gt;</pre></div></div></div></div></body></html>