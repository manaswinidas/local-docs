<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. Configuring Transactions</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_transactions"/>Chapter 2. Configuring Transactions</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="transactions_unique_node_identifier"/>Unique Node Identifier</h1></div></div></div><p>
				Unique node identifier allows JBoss EAP to recover transactions and transaction states that match only the specified node identifier. You can set the node identifier using the <code class="literal">com.arjuna.ats.arjuna.nodeIdentifier</code> property.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="importance_of_the_unique_node_identifier"/>Importance of the Unique Node Identifier</h2></div></div></div><p>
					When running XA recovery, you must configure the <code class="literal">Xid</code> types that JBoss EAP transactions can recover. Each <code class="literal">Xid</code> has the unique node identifier encoded in it and JBoss EAP only recovers the transactions and transaction states that match the specified node identifier.
				</p><p>
					You can configure the node identifier using the <code class="literal">JTAEnvironmentBean.xaRecoveryNodes</code> property, which can include multiple values in a list.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						A value of asterisk <code class="literal">"*"</code> forces JBoss EAP to recover, and possibly rollback, all the transactions irrespective of their node identifiers. It must be used with caution.
					</p></div><p>
					The value of <code class="literal">com.arjuna.ats.jta.xaRecoveryNode</code> property must be alphanumeric and must match the value of the <code class="literal">com.arjuna.ats.arjuna.nodeIdentifier</code> property.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_the_transaction_manager"/>Configuring the Transaction Manager</h1></div></div></div><p>
				You can configure the transaction manager using the web-based management console or the command line management CLI.
			</p><h3><a id="configuring_the_transaction_manager_using_the_management_console"/>Configuring the Transaction Manager Using the Management Console</h3><p>
				The following steps explain how to configure the transaction manager using the web-based management console:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						Select the <span class="strong"><strong>Configuration</strong></span> tab from the top of the screen.
					</li><li class="listitem">
						If you are running JBoss EAP as a managed domain, choose the desired profile to modify.
					</li><li class="listitem">
						From the <span class="strong"><strong>Subsystem</strong></span> list, select <span class="strong"><strong>Transaction</strong></span> and click <span class="strong"><strong>View</strong></span>.
					</li><li class="listitem">
						Select the appropriate tab for the settings that you want to configure, such as <span class="strong"><strong>Recovery</strong></span> for recovery options.
					</li><li class="listitem">
						Click <span class="strong"><strong>Edit</strong></span>, make the necessary changes, and click <span class="strong"><strong>Save</strong></span> to save the changes.
					</li></ol></div><h3><a id="configuring_the_transaction_manager_using_the_management_cli"/>Configuring the Transaction Manager Using the Management CLI</h3><p>
				Using the management CLI, you can configure the transaction manager using a series of commands. The commands all begin with <code class="literal">/subsystem=transactions</code> for a standalone server or <code class="literal">/profile=default/subsystem=transactions/</code> for the <code class="literal">default</code> profile in a managed domain.
			</p><p>
				For a detailed listing of all the transaction manager configuration options, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#reference_of_transaction_manager_configuration_options">Transaction Manager Configuration Options</a> for JBoss EAP.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_transaction_manager_using_system_properties"/>Configuring the Transaction Manager Using System Properties</h1></div></div></div><p>
				You can use either the management console, management CLI, or the system properties to configure many of the Transaction Manager options. However, the following options are configurable only using system properties. They are not configurable using the management CLI or management console.
			</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Property Name</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								RecoveryEnvironmentBean.periodicRecoveryPeriod
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Interval between recovery attempts, in seconds.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										Must be a positive Integer.
									</li><li class="listitem">
										Default is 120 seconds (2 minutes).
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								RecoveryEnvironmentBean.recoveryBackoffPeriod
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Interval between the first and second recovery passes, in seconds.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										Must be a positive Integer.
									</li><li class="listitem">
										Default is 10 seconds.
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								RecoveryEnvironmentBean.periodicRecoveryInitializationOffset
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Interval before first recovery pass, in seconds.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										Must be 0 or a positive Integer.
									</li><li class="listitem">
										Default is 0 seconds.
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								RecoveryEnvironmentBean.expiryScanInterval
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Interval between expiry scans, in hours.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										Can be any Integer.
									</li><li class="listitem">
										0 disables scanning.
									</li><li class="listitem">
										Negative values postpone the first run.
									</li><li class="listitem">
										Default is 12 hours.
									</li></ul></div>
							 </td></tr></tbody></table></div><p>
				This example shows how to configure these system properties in the <code class="literal">standalone.xml</code> server configuration file.
			</p><pre class="programlisting">&lt;system-properties&gt;
    &lt;property name="RecoveryEnvironmentBean.periodicRecoveryPeriod" value="180"/&gt;
    &lt;property name="RecoveryEnvironmentBean.recoveryBackoffPeriod" value="20"/&gt;
    &lt;property name="RecoveryEnvironmentBean.periodicRecoveryInitializationOffset" value="5"/&gt;
    &lt;property name="RecoveryEnvironmentBean.expiryScanInterval" value="24"/&gt;
&lt;/system-properties&gt;</pre><p>
				For more information on how to configure system properties, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#system_properties">System Properties</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_your_datasource_to_use_jta"/>Configuring Your Datasource to Use JTA</h1></div></div></div><p>
				This task shows you how to enable Java Transaction API (JTA) on your datasource.
			</p><h3><a id="prerequisites"/>Prerequisites</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Your database must support JTA. For more information, see the documentation from your database vendor.
					</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Create a <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#create_a_non_xa_datasource">non-XA datasource</a>. For instructions, see the <span class="emphasis"><em>Configuration Guide</em></span>.
					</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					XA datasources, described in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#create_an_xa_datasource"><span class="emphasis"><em>Configuration Guide</em></span></a>, are JTA capable by default.
				</p></div><h3><a id="configuring_the_datasource_to_use_jta"/>Configuring the Datasource to use JTA</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Use the following management CLI command to set the <code class="literal">jta</code> attribute to <code class="literal">true</code>.
					</p><pre class="screen">/subsystem=datasources/data-source=<span class="emphasis"><em>DATASOURCE_NAME</em></span>:write-attribute(name=jta,value=true)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							In a managed domain, precede this command with <code class="literal">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span></code>.
						</p></div></li><li class="listitem"><p class="simpara">
						Reload the server for the changes to take effect.
					</p><pre class="screen">reload</pre></li></ol></div><p>
				Your datasource is now configured to use JTA.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_the_orb_for_jts_transactions"/>Configuring the ORB for JTS Transactions</h1></div></div></div><p>
				In a default installation of JBoss EAP, the Object Request Broker (ORB) support for transactions is disabled. You can configure ORB settings in the <code class="literal">iiop-openjdk</code> subsystem using the management CLI or the management console.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The <code class="literal">iiop-openjdk</code> subsystem is available when using the <span class="emphasis"><em>full</em></span> or <span class="emphasis"><em>full-ha</em></span> profile in a managed domain, or the <code class="literal">standalone-full.xml</code> or <code class="literal">standalone-full-ha.xml</code> configuration file for a standalone server.
				</p></div><p>
				For a listing of the available configuration options for the <code class="literal">iiop-openjdk</code> subsystem, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#iiop_subsystem_attributes">IIOP Subsystem Attributes</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><h3><a id="configure_the_orb_using_the_management_cli"/>Configure the ORB Using the Management CLI</h3><p>
				You can configure each aspect of the ORB using the management CLI. This is the minimum configuration for the ORB to be used with JTS.
			</p><p>
				You can configure the following management CLI commands for a managed domain using the <code class="literal">full</code> profile. If necessary, change the profile to suit the one you need to configure. If you are using a standalone server, omit the <code class="literal">/profile=full</code> portion of the commands.
			</p><h4><a id="enable_the_security_interceptors"/>Enable the Security Interceptors</h4><p>
				Enable the <code class="literal">security</code> attribute by setting the value to <code class="literal">identity</code>.
			</p><pre class="screen">/profile=full/subsystem=iiop-openjdk:write-attribute(name=security,value=identity)</pre><h4><a id="enable_transactions_in_the_iiop_subsystem"/>Enable Transactions in the IIOP Subsystem</h4><p>
				To enable the ORB for JTS, set the value of <code class="literal">transactions</code> attribute to <code class="literal">full</code>, rather than the default <code class="literal">spec</code>.
			</p><pre class="screen">/profile=full/subsystem=iiop-openjdk:write-attribute(name=transactions, value=full)</pre><h4><a id="enable_jts_in_the_transactions_subsystem"/>Enable JTS in the Transactions Subsystem</h4><pre class="screen">/profile=full/subsystem=transactions:write-attribute(name=jts,value=true)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					For JTS activation, the server must be restarted as reload is not enough.
				</p></div><h3><a id="configure_the_orb_using_the_management_console"/>Configure the ORB Using the Management Console</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						Select the <span class="strong"><strong>Configuration</strong></span> tab from the top of the management console. In a managed domain, you must select the appropriate profile to modify.
					</li><li class="listitem">
						Select <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>IIOP (OpenJDK)</strong></span> and click <span class="strong"><strong>View</strong></span>.
					</li><li class="listitem">
						Click <span class="strong"><strong>Edit</strong></span> and modify the attributes as needed.
					</li><li class="listitem">
						Click <span class="strong"><strong>Save</strong></span> to save the changes.
					</li></ol></div></div></div></body></html>