<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Appendix A. Reference Material</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="reference_material"/>Appendix A. Reference Material</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jax_rs_resteasy_annotations"/>JAX-RS/RESTEasy Annotations</h1></div></div></div><div class="table"><a id="idm140182264530336"/><p class="title"><strong>Table A.1. JAX-RS/RESTEasy Annotations</strong></p><div class="table-contents"><table summary="JAX-RS/RESTEasy Annotations" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Annotation</th><th style="text-align: left" valign="top">Usage</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								Cache
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Set response <code class="literal">Cache-Control</code> header automatically.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								ClientInterceptor
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Identifies an interceptor as a client-side interceptor.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								ContentEncoding
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Meta annotation that specifies a <code class="literal">Content-Encoding</code> to be applied via the annotated annotation.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Context
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Allows you to specify instances of <code class="literal">javax.ws.rs.core.HttpHeaders</code>, <code class="literal">javax.ws.rs.core.UriInfo</code>, <code class="literal">javax.ws.rs.core.Request</code>, <code class="literal">javax.servlet.HttpServletRequest</code>, <code class="literal">javax.servlet.HttpServletResponse</code>, and <code class="literal">javax.ws.rs.core.SecurityContext</code> objects.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								CookieParam
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Allows you to specify the value of a cookie or object representation of an HTTP request cookie into the method invocation.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								DecorateTypes
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Must be placed on a <code class="literal">DecoratorProcessor</code> class to specify the supported types.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Decorator
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Meta-annotation to be placed on another annotation that triggers decoration.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								DefaultValue
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Can be combined with the other <code class="literal">@*Param</code> annotations to define a default value when the HTTP request item does not exist.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								DELETE
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">DELETE</code> requests.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								DoNotUseJAXBProvider
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Put this on a class or parameter when you do not want the JAXB <code class="literal">MessageBodyReader</code>/<code class="literal">Writer</code> used but instead have a more specific provider you want to use to marshal the type.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Encoded
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Can be used on a class, method, or param. By default, inject <code class="literal">@PathParam</code> and <code class="literal">@QueryParams</code> are decoded. By adding the <code class="literal">@Encoded</code> annotation, the value of these params are provided in encoded form.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Form
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This can be used as a value object for incoming/outgoing request/responses.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Formatted
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Format XML output with indentations and newlines. This is a JAXB Decorator.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								GET
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">GET</code> requests.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								IgnoreMediaTypes
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Placed on a type, method, parameter, or field to tell JAXRS not to use JAXB provider for a certain media type
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								ImageWriterParams
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An annotation that a resource class can use to pass parameters to the <code class="literal">IIOImageProvider</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Mapped
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A <code class="literal">JSONConfig</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								MultipartForm
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This can be used as a value object for incoming/outgoing request/responses of the multipart/form-data MIME type.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								NoCache
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Set <code class="literal">Cache-Control</code> response header of <code class="literal">nocache</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								NoJackson
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Placed on class, parameter, field or method when you do not want the Jackson provider to be triggered.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								PartType
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Must be used in conjunction with Multipart providers when writing out a List or Map as a <code class="literal">multipart/*</code> type.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Path
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This must exist either in the class or resource method. If it exists in both, the relative path to the resource method is a concatenation of the class and method.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								PathParam
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Allows you to map variable URI path fragments into a method call.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								POST
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">POST</code> requests.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Priority
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An annotation to indicate what order a class should be used. Uses an integer parameter with a lower value signifying a higher priority.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Provider
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Marks a class to be discoverable as a <a class="link" href="developing_jax_rs_web_services.html#content_marshalling_and_providers" title="Content Marshalling and Providers">provider</a> by JAX-RS runtime during a provider scanning phase.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								PUT
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">PUT</code> requests.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								QueryParam
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Allows you to map URI query string parameter or URL form encoded parameter to the method invocation.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								ServerInterceptor
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Identifies an interceptor as a server-side interceptor.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								StringParameterUnmarshallerBinder
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Meta-annotation to be placed on another annotation that triggers a <code class="literal">StringParameterUnmarshaller</code> to be applied to a string-based annotation injector.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Stylesheet
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies an XML stylesheet header.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Wrapped
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Put this on a method or parameter when you want to marshal or unmarshal a collection or array of JAXB objects.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								WrappedMap
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Put this on a method or parameter when you want to marshal or unmarshal a map of JAXB objects.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								XmlHeader
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets an XML header for the returned document.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								XmlNsMap
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A <code class="literal">JSONToXml</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								XopWithMultipartRelated
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This annotation can be used to process/produce incoming/outgoing XOP messages (packaged as multipart/related) to/from JAXB annotated objects.
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="resteasy_configuration_parameters"/>RESTEasy Configuration Parameters</h1></div></div></div><div class="table"><a id="idm140182267982624"/><p class="title"><strong>Table A.2. Elements</strong></p><div class="table-contents"><table summary="Elements" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Option Name</th><th style="text-align: left" valign="top">Default Value</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								resteasy.servlet.mapping.prefix
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								No default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								If the URL-pattern for the Resteasy servlet-mapping is not <code class="literal">/*</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.scan
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Automatically scan <code class="literal">WEB-INF/lib</code> JARs and <code class="literal">WEB-INF/classes</code> directory for both <code class="literal">@Provider</code> and JAX-RS resource classes (such as <code class="literal">@Path</code>, <code class="literal">@GET</code>, <code class="literal">@POST</code>) and register them.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.scan.providers
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Scan for <code class="literal">@Provider</code> classes and register them.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.scan.resources
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Scan for JAX-RS resource classes.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.providers
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								no default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A comma delimited list of fully qualified <code class="literal">@Provider</code> class names you want to register.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.use.builtin.providers
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Whether or not to register default, built-in <code class="literal">@Provider</code> classes.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.resources
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								No default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A comma delimited list of fully qualified JAX-RS resource class names you want to register.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.jndi.resources
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								No default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A comma delimited list of JNDI names which reference objects you want to register as JAX-RS resources.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								javax.ws.rs.Application
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								No default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Fully qualified name of <code class="literal">Application</code> class to bootstrap in a spec portable way.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.media.type.mappings
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								No default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Replaces the need for an <code class="literal">Accept</code> header by mapping file name extensions (like <code class="literal">.xml</code> or <code class="literal">.txt</code>) to a media type. Used when the client is unable to use a <code class="literal">Accept</code> header to choose a representation (i.e. a browser). You configure this in the <code class="literal">WEB-INF/web.xml</code> file using the <code class="literal">resteasy.media.type.mappings</code> and <code class="literal">resteasy.language.mappings</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.language.mappings
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								No default
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Replaces the need for an <code class="literal">Accept-Language</code> header by mapping file name extensions (like <code class="literal">.en</code> or <code class="literal">.fr</code>) to a language. Used when the client is unable to use a <code class="literal">Accept-Language</code> header to choose a language (i.e. a browser).
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.document.expand.entity.references
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Whether to expand external entities or replace them with an empty string. In JBoss EAP, this parameter defaults to <code class="literal">false</code>, so it replaces them with an empty string.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.document.secure.processing.feature
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Impose security constraints in processing <code class="literal">org.w3c.dom.Document</code> documents and JAXB object representations.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.document.secure.disableDTDs
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Prohibit DTDs in <code class="literal">org.w3c.dom.Document</code> documents and JAXB object representations.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.wider.request.matching
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Turn off class-level expression filtering as defined in the JAX-RS specification and instead match based on the full expression of each JAX-RS method.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.use.container.form.params
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Use the <code class="literal">HttpServletRequest.getParameterMap()</code> method to obtain form parameters. Use this switch if you are calling this method within a servlet filter or consuming the input stream within the filter.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.add.charset
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								If a resource method returns a <code class="literal">text/*</code> or <code class="literal">application/xml*</code> media type without an explicit charset, RESTEasy adds <code class="literal">charset=UTF-8</code> to the returned content-type header. Note that the charset defaults to UTF-8 in this case, independent of the setting of this parameter.
							</p>
							 </td></tr></tbody></table></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					These parameters are configured in the <code class="literal">WEB-INF/web.xml</code> file.
				</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					In a Servlet 3.0 container, the <code class="literal">resteasy.scan.*</code> configurations in the <code class="literal">web.xml</code> file are ignored, and all JAX-RS annotated components will be automatically scanned.
				</p></div><p>
				For example, <code class="literal">javax.ws.rs.Application</code> parameter is configured within <code class="literal">init-param</code> of the servlet configuration:
			</p><pre class="programlisting">&lt;servlet&gt;
    &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
        &lt;param-value&gt;org.jboss.resteasy.utils.TestApplication&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/servlet&gt;</pre><p>
				For example, <code class="literal">resteasy.document.expand.entity.references</code> is configured within <code class="literal">context-param</code>:
			</p><pre class="programlisting">&lt;context-param&gt;
    &lt;param-name&gt;resteasy.document.expand.entity.references&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
					Changing the default values of the following RESTEasy parameters may cause RESTEasy applications to be potentially vulnerable against XXE attacks:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							resteasy.document.expand.entity.references
						</li><li class="listitem">
							resteasy.document.secure.processing.feature
						</li><li class="listitem">
							resteasy.document.secure.disableDTDs
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="resteasy_javascript_api_parameters"/>RESTEasy JavaScript API Parameters</h1></div></div></div><div class="table"><a id="idm140182216406816"/><p class="title"><strong>Table A.3. Parameter Properties</strong></p><div class="table-contents"><table summary="Parameter Properties" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Property</th><th style="text-align: left" valign="top">Default Value</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								$entity
							</p>
							 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
								The entity to send as a <code class="literal">PUT</code>, <code class="literal">POST</code> request.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								$contentType
							</p>
							 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
								The MIME type of the body entity sent as the <code class="literal">Content-Type</code> header. Determined by the <code class="literal">@Consumes</code> annotation.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								$accepts
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								*/*
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The accepted MIME types sent as the <code class="literal">Accept</code> header. Determined by the <code class="literal">@Provides</code> annotation.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								$callback
							</p>
							 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
								Set to a function (<code class="literal">httpCode</code>, <code class="literal">xmlHttpRequest</code>, <code class="literal">value</code>) for an asynchronous call. If not present, the call will be synchronous and return the value.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								$apiURL
							</p>
							 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
								Set to the base URI of the JAX-RS endpoint, not including the last slash.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								$username
							</p>
							 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
								If username and password are set, they will be used for credentials for the request.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								$password
							</p>
							 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
								If username and password are set, they will be used for credentials for the request.
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="rest_request_class_members"/>REST.Request Class Members</h1></div></div></div><div class="table"><a id="idm140182248075776"/><p class="title"><strong>Table A.4. REST.Request Class</strong></p><div class="table-contents"><table summary="REST.Request Class" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Member</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								execute(callback)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Executes the request with all the information set in the current object. The value is passed to the optional argument callback, not returned.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setAccepts(acceptHeader)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the <code class="literal">Accept</code> request header. Defaults to <code class="literal">*/*</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setCredentials(username, password)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the request credentials.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setEntity(entity)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the request entity.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setContentType(contentTypeHeader)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the <code class="literal">Content-Type</code> request header.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setURI(uri)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the request URI. This should be an absolute URI.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setMethod(method)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the request method. Defaults to <code class="literal">GET</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								setAsync(async)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Controls whether the request should be asynchronous. Defaults to <code class="literal">true</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								addCookie(name, value)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the given cookie in the current document when executing the request. This will be persistent in the browser.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								addQueryParameter(name, value)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Adds a query parameter to the URI query part.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								addMatrixParameter(name, value)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Adds a matrix parameter (path parameter) to the last path segment of the request URI.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								addHeader(name, value)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Adds a request header.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								addForm(name, value)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Adds a form.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								addFormParameter(name, value)
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Adds a form parameter.
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Asynchronous_Job_Service_Configuration_Parameters"/>RESTEasy Asynchronous Job Service Configuration Parameters</h1></div></div></div><p>
				The table below details the configurable <code class="literal">context-params</code> for the Asynchronous Job Service. These parameters can be configured in the <code class="literal">web.xml</code> file.
			</p><div class="table"><a id="idm140182269553424"/><p class="title"><strong>Table A.5. Configuration Parameters</strong></p><div class="table-contents"><table summary="Configuration Parameters" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Parameter</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								resteasy.async.job.service.max.job.results
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Number of job results that can be held in the memory at any one time. Default value is <code class="literal">100</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.async.job.service.max.wait
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Maximum wait time on a job when a client is querying for it. Default value is <code class="literal">300000</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.async.job.service.thread.pool.size
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Thread pool size of the background threads that run the job. Default value is <code class="literal">100</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								resteasy.async.job.service.base.path
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Sets the base path for the job URIs. Default value is <code class="literal">/asynch/jobs</code>.
							</p>
							 </td></tr></tbody></table></div></div><pre class="programlisting">&lt;web-app&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.enabled&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.job.results&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.wait&lt;/param-name&gt;
        &lt;param-value&gt;300000&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.thread.pool.size&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.base.path&lt;/param-name&gt;
        &lt;param-value&gt;/asynch/jobs&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;
            org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jax_ws_tools"/>JAX-WS Tools</h1></div></div></div><h3><a id="wsconsume_tool"/>wsconsume</h3><p>
				<code class="literal">wsconsume</code> is a command-line tool provided with JBoss EAP that consumes a WSDL and produces portable JAX-WS service and client artifacts.
			</p><h4><a id="usage_2"/>Usage</h4><p>
				The <code class="literal">wsconsume</code> tool is located in the <code class="literal">EAP_HOME/bin</code> directory and uses the following syntax.
			</p><pre class="screen">EAP_HOME/bin/wsconsume.sh [options] &lt;wsdl-url&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Use the <code class="literal">wsconsume.bat</code> script for Windows.
				</p></div><p>
				Example usage:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Generate Java class files from the <code class="literal">Example.wsdl</code> WSDL file
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh Example.wsdl</pre></li><li class="listitem"><p class="simpara">
						Generate Java source and class files from the <code class="literal">Example.wsdl</code> WSDL file
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh -k Example.wsdl</pre></li><li class="listitem"><p class="simpara">
						Generate Java source and class files in the <code class="literal">my.org</code> package from the <code class="literal">Example.wsdl</code> WSDL file
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh -k -p my.org Example.wsdl</pre></li><li class="listitem"><p class="simpara">
						Generate Java source and class files using multiple binding files
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh -k -b schema-binding1.xsd -b schema-binding2.xsd Example.wsdl</pre></li></ul></div><p>
				Use the <code class="literal">--help</code> argument or see the below table for a listing of all available <code class="literal">wsconsume</code> options.
			</p><div class="table"><a id="idm140182265576080"/><p class="title"><strong>Table A.6. wsconsume Options</strong></p><div class="table-contents"><table summary="wsconsume Options" border="1" width="100%"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Option</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								-a, --additionalHeaders
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enable processing of implicit SOAP headers.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-b, --binding=&lt;file&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								One or more JAX-WS or JAXB binding files.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-c --catalog=&lt;file&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Oasis XML Catalog file for entity resolution.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-d --encoding=&lt;charset&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The charset encoding to use for generated sources.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-e, --extension
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enable SOAP 1.2 binding extension.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-h, --help
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Show this help message.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-j --clientjar=&lt;name&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Create a JAR file of the generated artifacts for calling the web. service
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-k, --keep
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Keep/Generate Java source.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-l, --load-consumer
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Load the consumer and exit (debug utility).
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-n, --nocompile
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Do not compile generated sources.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-o, --output=&lt;directory&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The directory to put generated artifacts.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-p --package=&lt;name&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The target package for generated source.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-q, --quiet
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Be somewhat more quiet.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-s, --source=&lt;directory&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The directory to put Java source.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-t, --target=&lt;2.1|2.2&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The JAX-WS specification target.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-v, --verbose
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Show full exception stack traces.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-w --wsdlLocation=&lt;loc&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Value to use for <code class="literal">@WebService.wsdlLocation</code>.
							</p>
							 </td></tr></tbody></table></div></div><h3><a id="wsprovide_tool"/>wsprovide</h3><p>
				<code class="literal">wsprovide</code> is a command-line tool provided with JBoss EAP that generates portable JAX-WS artifacts for a service endpoint implementation. It also has the option to generate a WSDL file.
			</p><h4><a id="usage_3"/>Usage</h4><p>
				The <code class="literal">wsprovide</code> tool is located in the <code class="literal">EAP_HOME/bin</code> directory and uses the following syntax.
			</p><pre class="screen">EAP_HOME/bin/wsprovide.sh [options] &lt;endpoint class name&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Use the <code class="literal">wsprovide.bat</code> script for Windows.
				</p></div><p>
				Example usage:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Generate wrapper classes for portable artifacts in the <code class="literal">output</code> directory.
					</p><pre class="screen">EAP_HOME/bin/wsprovide.sh -o output my.package.MyEndpoint</pre></li><li class="listitem"><p class="simpara">
						Generate wrapper classes and WSDL in the <code class="literal">output</code> directory.
					</p><pre class="screen">EAP_HOME/bin/wsprovide.sh -o output -w my.package.MyEndpoint</pre></li><li class="listitem"><p class="simpara">
						Generate wrapper classes in the <code class="literal">output</code> directory for an endpoint that references other JARs.
					</p><pre class="screen">EAP_HOME/bin/wsprovide.sh -o output -c myapplication1.jar:myapplication2.jar my.org.MyEndpoint</pre></li></ul></div><p>
				Use the <code class="literal">--help</code> argument or see the below table for a listing of all available <code class="literal">wsprovide</code> options.
			</p><div class="table"><a id="idm140182248256448"/><p class="title"><strong>Table A.7. wsprovide Options</strong></p><div class="table-contents"><table summary="wsprovide Options" border="1" width="100%"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Option</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								-a, --address=&lt;address&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The generated port soap:address in WSDL.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-c, --classpath=&lt;path&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The classpath that contains the endpoint.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-e, --extension
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enable SOAP 1.2 binding extension.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-h, --help
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Show this help message.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-k, --keep
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Keep/Generate Java source.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-l, --load-provider
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Load the provider and exit (debug utility).
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-o, --output=&lt;directory&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The directory to put generated artifacts.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-q, --quiet
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Be somewhat more quiet.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-r, --resource=&lt;directory&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The directory to put resource artifacts.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-s, --source=&lt;directory&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The directory to put Java source.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-t, --show-traces
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Show full exception stack traces.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								-w, --wsdl
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enable WSDL file generation.
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jax_ws_common_api_reference"/>JAX-WS Common API Reference</h1></div></div></div><p>
				Several JAX-WS development concepts are shared between web service endpoints and clients. These include the handler framework, message context, and fault handling.
			</p><h3><a id="handler_framework"/>Handler Framework</h3><p>
				The handler framework is implemented by a JAX-WS protocol binding in the runtime of the client and the endpoint, which is the server component. Proxies and <code class="literal">Dispatch</code> instances, known collectively as binding providers, each use protocol bindings to bind their abstract functionality to specific protocols.
			</p><p>
				Client and server-side handlers are organized into an ordered list known as a handler chain. The handlers within a handler chain are invoked each time a message is sent or received. Inbound messages are processed by handlers before the binding provider processes them. Outbound messages are processed by handlers after the binding provider processes them.
			</p><p>
				Handlers are invoked with a message context which provides methods to access and modify inbound and outbound messages and to manage a set of properties. Message context properties facilitate communication between individual handlers, as well as between handlers and client and service implementations. Different types of handlers are invoked with different types of message contexts.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Logical Handler</span></dt><dd>
							Logical handlers only operate on message context properties and message payloads. Logical handlers are protocol-independent and cannot affect protocol-specific parts of a message. Logical handlers implement interface <code class="literal">javax.xml.ws.handler.LogicalHandler</code>.
						</dd><dt><span class="term">Protocol Handler</span></dt><dd>
							Protocol handlers operate on message context properties and protocol-specific messages. Protocol handlers are specific to a particular protocol and may access and change protocol-specific aspects of a message. Protocol handlers implement any interface derived from <code class="literal">javax.xml.ws.handler.Handler</code>, except <code class="literal">javax.xml.ws.handler.LogicalHandler</code>.
						</dd><dt><span class="term">Service Endpoint Handler</span></dt><dd><p class="simpara">
							On a service endpoint, handlers are defined using the <code class="literal">@HandlerChain</code> annotation. The location of the handler chain file can be either an absolute <code class="literal">java.net.URL</code> in <code class="literal">externalForm</code> or a relative path from the source file or class file.
						</p><pre class="programlisting">@WebService
@HandlerChain(file = "jaxws-server-source-handlers.xml")
public class SOAPEndpointSourceImpl {
   ...
}</pre></dd><dt><span class="term">Service Client Handler</span></dt><dd><p class="simpara">
							On a JAX-WS client, handlers are defined either by using the <code class="literal">@HandlerChain</code> annotation, as in service endpoints, or dynamically, using the JAX-WS API.
						</p><pre class="programlisting">Service service = Service.create(wsdlURL, serviceName);
Endpoint port = (Endpoint)service.getPort(Endpoint.class);

BindingProvider bindingProvider = (BindingProvider)port;
List&lt;Handler&gt; handlerChain = new ArrayList&lt;Handler&gt;();
handlerChain.add(new LogHandler());
handlerChain.add(new AuthorizationHandler());
handlerChain.add(new RoutingHandler());
bindingProvider.getBinding().setHandlerChain(handlerChain);</pre><p class="simpara">
							The call to the <code class="literal">setHandlerChain</code> method is required.
						</p></dd></dl></div><h3><a id="message_context"/>Message Context</h3><p>
				The <code class="literal">MessageContext</code> interface is the super interface for all JAX-WS message contexts. It extends <code class="literal">Map&lt;String,Object&gt;</code> with additional methods and constants to manage a set of properties that enable handlers in a handler chain to share processing related state. For example, a handler may use the <code class="literal">put</code> method to insert a property into the message context. One or more other handlers in the handler chain may subsequently obtain the message using the <code class="literal">get</code> method.
			</p><p>
				Properties are scoped as either <code class="literal">APPLICATION</code> or <code class="literal">HANDLER</code>. All properties are available to all handlers for an instance of a message exchange pattern (MEP) of a particular endpoint. For instance, if a logical handler puts a property into the message context, that property is also available to any protocol handlers in the chain during the execution of an MEP instance.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					An asynchronous Message Exchange Pattern (MEP) allows for sending and receiving messages asynchronously at the HTTP connection level. You can enable it by setting additional properties in the request context.
				</p></div><p>
				Properties scoped at the <code class="literal">APPLICATION</code> level are also made available to client applications and service endpoint implementations. The <code class="literal">defaultscope</code> for a property is <code class="literal">HANDLER</code>.
			</p><p>
				Logical and SOAP messages use different contexts.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Logical Message Context</span></dt><dd>
							When logical handlers are invoked, they receive a message context of type <code class="literal">LogicalMessageContext</code>. <code class="literal">LogicalMessageContext</code> extends <code class="literal">MessageContext</code> with methods which obtain and modify the message payload. It does not provide access to the protocol-specific aspects of a message. A protocol binding defines which components of a message are available through a logical message context. A logical handler deployed in a SOAP binding can access the contents of the SOAP body but not the SOAP headers. On the other hand, the XML/HTTP binding defines that a logical handler can access the entire XML payload of a message.
						</dd><dt><span class="term">SOAP Message Context</span></dt><dd>
							When SOAP handlers are invoked, they receive a <code class="literal">SOAPMessageContext</code>. <code class="literal">SOAPMessageContext</code> extends <code class="literal">MessageContext</code> with methods which obtain and modify the SOAP message payload.
						</dd></dl></div><h3><a id="fault_handling"/>Fault Handling</h3><p>
				An application may throw a <code class="literal">SOAPFaultException</code> or an application-specific user exception. In the case of the latter, the required fault wrapper beans are generated at runtime if they are not already part of the deployment.
			</p><pre class="programlisting">public void throwSoapFaultException() {
   SOAPFactory factory = SOAPFactory.newInstance();
   SOAPFault fault = factory.createFault("this is a fault string!", new QName("http://foo", "FooCode"));
   fault.setFaultActor("mr.actor");
   fault.addDetail().addChildElement("test");
   throw new SOAPFaultException(fault);
}</pre><pre class="programlisting">public void throwApplicationException() throws UserException {
   throw new UserException("validation", 123, "Some validation error");
}</pre><h3><a id="jax_ws_annotations"/>JAX-WS Annotations</h3><p>
				The annotations available by the JAX-WS API are defined in <a class="link" href="http://www.jcp.org/en/jsr/detail?id=224">JSR-224</a>. These annotations are in the <code class="literal">javax.xml.ws</code> package.
			</p><p>
				The annotations available by the JWS API are defined in <a class="link" href="http://www.jcp.org/en/jsr/detail?id=181">JSR-181</a>. These annotations are in the <code class="literal">javax.jws</code> package.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="advanced_trust_scenarios"/>Advanced WS-Trust Scenarios</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="SAML_holder_of_key_assertion_scenario"/>Scenario: SAML Holder-Of-Key Assertion Scenario</h2></div></div></div><p>
					WS-Trust helps in managing software security tokens. A SAML assertion is a type of security token. In the Holder-Of-Key method, STS creates a SAML token containing the client’s public key and signs the SAML token with its private key. The client includes the SAML token and signs the outgoing soap envelope to the web service with its private key. The web service validates the SOAP message and SAML token.
				</p><p>
					Implementation of this scenario requires the following:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							SAML tokens with a Holder-Of-Key subject confirmation method must be protected so the token cannot be snooped. In most cases, a Holder-Of-Key token combined with HTTPS is sufficient to prevent getting possession of the token. This means the security policy uses a <code class="literal">sp:TransportBinding</code> and <code class="literal">sp:HttpsToken</code>.
						</li><li class="listitem">
							A Holder-Of-Key token has no encryption or signing keys associated with it, therefore a <code class="literal">sp:IssuedToken</code> of <code class="literal">SymmetricKey</code> or <code class="literal">PublicKey</code> keyType should be used with a <code class="literal">sp:SignedEndorsingSupportingTokens</code>.
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP"/>Web Service Provider</h3></div></div></div><p>
						This section lists the web service elements for the SAML Holder-Of-Key scenario. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#SAML_holder_of_key_assertion_scenario_WSP_WSDL" title="Web Service Provider WSDL">Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_holder_of_key_assertion_scenario_WSP_SSL_conf" title="SSL Configuration">SSL Configuration</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_holder_of_key_assertion_scenario_WSP_interface" title="Web Service Provider Interface">Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_holder_of_key_assertion_scenario_WSP_implementation" title="Web Service Provider Implementation">Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_holder_of_key_assertion_scenario_WSP_crypto_prop_keystore_files" title="Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_holder_of_key_assertion_scenario_WSP_manifest" title="Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP_WSDL"/>Web Service Provider WSDL</h4></div></div></div><p>
							The Web Service Provider is a contract-first endpoint. All WS-trust and security policies for it are declared in the <code class="literal">HolderOfKeyService.wsdl</code> WSDL. For this scenario, a <code class="literal">ws-requester</code> is required to provide a SAML 2.0 token of <code class="literal">SymmetricKey</code> keyType, issued from a designated STS. The STS address is provided in the WSDL. A transport binding policy is used. The token is declared to be signed and endorsed, <code class="literal">sp:SignedEndorsingSupportingTokens</code>.
						</p><p>
							A detailed explanation of the security settings are provided in the comments in the following listing:
						</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
             name="HolderOfKeyService"
        xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        xmlns:wsp="http://www.w3.org/ns/ws-policy"
        xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
    xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
    xmlns:wsaws="http://www.w3.org/2005/08/addressing"
    xmlns:wsx="http://schemas.xmlsoap.org/ws/2004/09/mex"
    xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
    xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;

  &lt;types&gt;
    &lt;xsd:schema&gt;
      &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
                  schemaLocation="HolderOfKeyService_schema1.xsd"/&gt;
    &lt;/xsd:schema&gt;
  &lt;/types&gt;
  &lt;message name="sayHello"&gt;
    &lt;part name="parameters" element="tns:sayHello"/&gt;
  &lt;/message&gt;
  &lt;message name="sayHelloResponse"&gt;
    &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
  &lt;/message&gt;
  &lt;portType name="HolderOfKeyIface"&gt;
    &lt;operation name="sayHello"&gt;
      &lt;input message="tns:sayHello"/&gt;
      &lt;output message="tns:sayHelloResponse"/&gt;
    &lt;/operation&gt;
  &lt;/portType&gt;
&lt;!--
        The wsp:PolicyReference binds the security requirements on all the endpoints.
        The wsp:Policy wsu:Id="#TransportSAML2HolderOfKeyPolicy" element is defined later in this file.
--&gt;
  &lt;binding name="HolderOfKeyServicePortBinding" type="tns:HolderOfKeyIface"&gt;
    &lt;wsp:PolicyReference URI="#TransportSAML2HolderOfKeyPolicy" /&gt;
    &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
    &lt;operation name="sayHello"&gt;
      &lt;soap:operation soapAction=""/&gt;
      &lt;input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/input&gt;
      &lt;output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;
&lt;!--
  The soap:address has been defined to use JBoss's https port, 8443.  This is
  set in conjunction with the sp:TransportBinding policy for https.
--&gt;
  &lt;service name="HolderOfKeyService"&gt;
    &lt;port name="HolderOfKeyServicePort" binding="tns:HolderOfKeyServicePortBinding"&gt;
      &lt;soap:address location="https://@jboss.bind.address@:8443/jaxws-samples-wsse-policy-trust-holderofkey/HolderOfKeyService"/&gt;
    &lt;/port&gt;
  &lt;/service&gt;


  &lt;wsp:Policy wsu:Id="TransportSAML2HolderOfKeyPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
  &lt;!--
        The wsam:Addressing element, indicates that the endpoints of this
        web service MUST conform to the WS-Addressing specification.  The
        attribute wsp:Optional="false" enforces this assertion.
  --&gt;
        &lt;wsam:Addressing wsp:Optional="false"&gt;
          &lt;wsp:Policy /&gt;
        &lt;/wsam:Addressing&gt;
&lt;!--
  The sp:TransportBinding element indicates that security is provided by the
  message exchange transport medium, https.  WS-Security policy specification
  defines the sp:HttpsToken for use in exchanging messages transmitted over HTTPS.
--&gt;
          &lt;sp:TransportBinding
            xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
            &lt;wsp:Policy&gt;
              &lt;sp:TransportToken&gt;
                &lt;wsp:Policy&gt;
                  &lt;sp:HttpsToken&gt;
                    &lt;wsp:Policy/&gt;
                  &lt;/sp:HttpsToken&gt;
                &lt;/wsp:Policy&gt;
              &lt;/sp:TransportToken&gt;
&lt;!--
     The sp:AlgorithmSuite element, requires the TripleDes algorithm suite
     be used in performing cryptographic operations.
--&gt;
              &lt;sp:AlgorithmSuite&gt;
                &lt;wsp:Policy&gt;
                  &lt;sp:TripleDes /&gt;
                &lt;/wsp:Policy&gt;
              &lt;/sp:AlgorithmSuite&gt;
&lt;!--
     The sp:Layout element,  indicates the layout rules to apply when adding
     items to the security header.  The sp:Lax sub-element indicates items
     are added to the security header in any order that conforms to
     WSS: SOAP Message Security.
--&gt;
              &lt;sp:Layout&gt;
                &lt;wsp:Policy&gt;
                  &lt;sp:Lax /&gt;
                &lt;/wsp:Policy&gt;
              &lt;/sp:Layout&gt;
              &lt;sp:IncludeTimestamp /&gt;
            &lt;/wsp:Policy&gt;
          &lt;/sp:TransportBinding&gt;

&lt;!--
  The sp:SignedEndorsingSupportingTokens, when transport level security level is
  used there will be no message signature and the signature generated by the
  supporting token will sign the Timestamp.
--&gt;
        &lt;sp:SignedEndorsingSupportingTokens
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
&lt;!--
  The sp:IssuedToken element asserts that a SAML 2.0 security token of type
  Bearer is expected from the STS.  The
  sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
  attribute instructs the runtime to include the initiator's public key
  with every message sent to the recipient.

  The sp:RequestSecurityTokenTemplate element directs that all of the
  children of this element will be copied directly into the body of the
  RequestSecurityToken (RST) message that is sent to the STS when the
  initiator asks the STS to issue a token.
--&gt;
            &lt;sp:IssuedToken
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
              &lt;sp:RequestSecurityTokenTemplate&gt;
                &lt;t:TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/t:TokenType&gt;
 &lt;!--
   KeyType of "SymmetricKey", the client must prove to the WS service that it
   possesses a particular symmetric session key.
 --&gt;
                &lt;t:KeyType&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/SymmetricKey&lt;/t:KeyType&gt;
              &lt;/sp:RequestSecurityTokenTemplate&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:RequireInternalReference /&gt;
              &lt;/wsp:Policy&gt;
&lt;!--
  The sp:Issuer element defines the STS's address and endpoint information
  This information is used by the STSClient.
--&gt;
              &lt;sp:Issuer&gt;
                &lt;wsaws:Address&gt;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-holderofkey/SecurityTokenService&lt;/wsaws:Address&gt;
                &lt;wsaws:Metadata
                  xmlns:wsdli="http://www.w3.org/2006/01/wsdl-instance"
                  wsdli:wsdlLocation="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-holderofkey/SecurityTokenService?wsdl"&gt;
                  &lt;wsaw:ServiceName
                    xmlns:wsaw="http://www.w3.org/2006/05/addressing/wsdl"
                    xmlns:stsns="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
                    EndpointName="UT_Port"&gt;stsns:SecurityTokenService&lt;/wsaw:ServiceName&gt;
                &lt;/wsaws:Metadata&gt;
              &lt;/sp:Issuer&gt;

            &lt;/sp:IssuedToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedEndorsingSupportingTokens&gt;
&lt;!--
    The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
    to be supported by the STS.  These particular elements generally refer
    to how keys are referenced within the SOAP envelope.  These are normally handled by Apache CXF.
--&gt;
        &lt;sp:Wss11&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefIssuerSerial /&gt;
            &lt;sp:MustSupportRefThumbprint /&gt;
            &lt;sp:MustSupportRefEncryptedKey /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
&lt;!--
    The sp:Trust13 element declares controls for WS-Trust 1.3 options.
    They are policy assertions related to exchanges specifically with
    client and server challenges and entropy behaviors.  Again these are
    normally handled by Apache CXF.
--&gt;
        &lt;sp:Trust13&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens /&gt;
            &lt;sp:RequireClientEntropy /&gt;
            &lt;sp:RequireServerEntropy /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/definitions&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP_SSL_conf"/>SSL Configuration</h4></div></div></div><p>
							This web service uses HTTPS, therefore the JBoss EAP server must be configured to provide SSL/TLS support in the <code class="literal">undertow</code> subsystem.
						</p><p>
							For information on how to configure HTTPS for web applications, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#configure_one_way_and_two_way_ssl_tls_for_application">Configure One-way and Two-way SSL/TLS for Applications</a> in <span class="emphasis"><em>How to Configure Server Security</em></span>.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP_interface"/>Web Service Provider Interface</h4></div></div></div><p>
							The web service provider interface <code class="literal">HolderOfKeyIface</code> class is a simple web service definition.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
)
public interface HolderOfKeyIface {
   @WebMethod
   String sayHello();
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP_implementation"/>Web Service Provider Implementation</h4></div></div></div><p>
							The web service provider implementation <code class="literal">HolderOfKeyImpl</code> class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint. In addition there are two Apache CXF annotations, <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> used for configuring the endpoint for the Apache CXF runtime. These annotations come from the Apache WSS4J project, which provides a Java implementation of the primary WS-Security standards for web services. These annotations programmatically add properties to the endpoint. With plain Apache CXF, these properties are often set using the <code class="literal">&lt;jaxws:properties&gt;</code> element on the <code class="literal">&lt;jaxws:endpoint&gt;</code> element in the Spring configuration. These annotations allow the properties to be configured in the code.
						</p><p>
							WSS4J uses the Crypto interface to get keys and certificates for signature creation/verification, as asserted by the WSDL for this service. The WSS4J configuration information provided by <code class="literal">HolderOfKeyImpl</code> is for Crypto’s Merlin implementation.
						</p><p>
							The first <code class="literal">EndpointProperty</code> statement in the listing disables ensurance of compliance with the Basic Security Profile 1.1. The next <code class="literal">EndpointProperty</code> statements declares the Java properties file that contains the (Merlin) Crypto configuration information. The last <code class="literal">EndpointProperty</code> statement declares the <code class="literal">STSHolderOfKeyCallbackHandler</code> implementation class. It is used to obtain the user’s password for the certificates in the keystore file.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;

import javax.jws.WebService;

@WebService
   (
      portName = "HolderOfKeyServicePort",
      serviceName = "HolderOfKeyService",
      wsdlLocation = "WEB-INF/wsdl/HolderOfKeyService.wsdl",
      targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy",
      endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey.HolderOfKeyIface"
   )
@EndpointProperties(value = {
   @EndpointProperty(key = "ws-security.is-bsp-compliant", value = "false"),
   @EndpointProperty(key = "ws-security.signature.properties", value = "serviceKeystore.properties"),
   @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey.HolderOfKeyCallbackHandler")
})
public class HolderOfKeyImpl implements HolderOfKeyIface {
   public String sayHello() {
      return "Holder-Of-Key WS-Trust Hello World!";
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP_crypto_prop_keystore_files"/>Crypto Properties and Keystore Files</h4></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application uses the Merlin implementation. The <code class="literal">serviceKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">servicestore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=sspass
org.apache.ws.security.crypto.merlin.keystore.alias=myservicekey
org.apache.ws.security.crypto.merlin.keystore.file=servicestore.jks</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_holder_of_key_assertion_scenario_WSP_manifest"/>Default MANIFEST.MF</h4></div></div></div><p>
							This application requires access to JBossWS and Apache CXF APIs provided in the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> module. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="scenario_saml_bearer_assertion"/>Scenario: SAML Bearer Assertion</h2></div></div></div><p>
					WS-Trust manages software security tokens. A SAML assertion is a type of security token. In the SAML Bearer scenario, the service provider automatically trusts that the incoming SOAP request came from the subject defined in the SAML token after the service verifies the token’s signature.
				</p><p>
					Implementation of this scenario has the following requirements.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							SAML tokens with a <code class="literal">Bearer</code> subject confirmation method must be protected so the token can not be snooped. In most cases, a bearer token combined with HTTPS is sufficient to prevent "a man in the middle" getting possession of the token. This means a security policy that uses a <code class="literal">sp:TransportBinding</code> and <code class="literal">sp:HttpsToken</code>.
						</li><li class="listitem">
							A bearer token has no encryption or signing keys associated with it, therefore a <code class="literal">sp:IssuedToken</code> of <code class="literal">bearer</code> keyType should be used with a <code class="literal">sp:SupportingToken</code> or a <code class="literal">sp:SignedSupportingTokens</code>.
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="SAML_bearer_assertion_scenario_WSP"/>Web Service Provider</h3></div></div></div><p>
						This section examines the web service elements for the SAML Bearer scenario. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSP_wsdl" title="Bearer Web Service Provider WSDL">Bearer Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSP_ssl_conf" title="SSL Configuration">SSL Configuration</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSP_interface" title="Bearer Web Service Providers Interface">Bearer Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSP_implementation" title="Bearer Web Service Providers Implementation">Bearer Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSP_crypto_prop_keystore_files" title="Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSP_manifest" title="Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSP_wsdl"/>Bearer Web Service Provider WSDL</h4></div></div></div><p>
							The web service provider is a contract-first endpoint. All the WS-trust and security policies for it are declared in the <code class="literal">BearerService.wsdl</code> WSDL. For this scenario, a <code class="literal">ws-requester</code> is required to provide a SAML 2.0 Bearer token issued from a designated STS. The address of the STS is provided in the WSDL. HTTPS, a <code class="literal">TransportBinding</code> and <code class="literal">HttpsToken</code> policy are used to protect the SOAP body of messages that are sent between <code class="literal">ws-requester</code> and <code class="literal">ws-provider</code>. The security settings details are provided as comments in the following listing.
						</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
             name="BearerService"
             xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:wsp="http://www.w3.org/ns/ws-policy"
             xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
             xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
             xmlns:wsaws="http://www.w3.org/2005/08/addressing"
             xmlns:wsx="http://schemas.xmlsoap.org/ws/2004/09/mex"
             xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
             xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;

  &lt;types&gt;
    &lt;xsd:schema&gt;
      &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
                  schemaLocation="BearerService_schema1.xsd"/&gt;
    &lt;/xsd:schema&gt;
  &lt;/types&gt;
  &lt;message name="sayHello"&gt;
    &lt;part name="parameters" element="tns:sayHello"/&gt;
  &lt;/message&gt;
  &lt;message name="sayHelloResponse"&gt;
    &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
  &lt;/message&gt;
  &lt;portType name="BearerIface"&gt;
    &lt;operation name="sayHello"&gt;
      &lt;input message="tns:sayHello"/&gt;
      &lt;output message="tns:sayHelloResponse"/&gt;
    &lt;/operation&gt;
  &lt;/portType&gt;

&lt;!--
        The wsp:PolicyReference binds the security requirments on all the endpoints.
        The wsp:Policy wsu:Id="#TransportSAML2BearerPolicy" element is defined later in this file.
--&gt;
  &lt;binding name="BearerServicePortBinding" type="tns:BearerIface"&gt;
    &lt;wsp:PolicyReference URI="#TransportSAML2BearerPolicy" /&gt;
    &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
    &lt;operation name="sayHello"&gt;
      &lt;soap:operation soapAction=""/&gt;
      &lt;input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/input&gt;
      &lt;output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;

&lt;!--
  The soap:address has been defined to use JBoss's https port, 8443.  This is
  set in conjunction with the sp:TransportBinding policy for https.
--&gt;
  &lt;service name="BearerService"&gt;
    &lt;port name="BearerServicePort" binding="tns:BearerServicePortBinding"&gt;
      &lt;soap:address location="https://@jboss.bind.address@:8443/jaxws-samples-wsse-policy-trust-bearer/BearerService"/&gt;
    &lt;/port&gt;
  &lt;/service&gt;


  &lt;wsp:Policy wsu:Id="TransportSAML2BearerPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
  &lt;!--
        The wsam:Addressing element, indicates that the endpoints of this
        web service MUST conform to the WS-Addressing specification.  The
        attribute wsp:Optional="false" enforces this assertion.
  --&gt;
        &lt;wsam:Addressing wsp:Optional="false"&gt;
          &lt;wsp:Policy /&gt;
        &lt;/wsam:Addressing&gt;

&lt;!--
  The sp:TransportBinding element indicates that security is provided by the
  message exchange transport medium, https.  WS-Security policy specification
  defines the sp:HttpsToken for use in exchanging messages transmitted over HTTPS.
--&gt;
        &lt;sp:TransportBinding
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:TransportToken&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:HttpsToken&gt;
                  &lt;wsp:Policy/&gt;
                &lt;/sp:HttpsToken&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:TransportToken&gt;
&lt;!--
     The sp:AlgorithmSuite element, requires the TripleDes algorithm suite
     be used in performing cryptographic operations.
--&gt;
            &lt;sp:AlgorithmSuite&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:TripleDes /&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:AlgorithmSuite&gt;
&lt;!--
     The sp:Layout element,  indicates the layout rules to apply when adding
     items to the security header.  The sp:Lax sub-element indicates items
     are added to the security header in any order that conforms to
     WSS: SOAP Message Security.
--&gt;
            &lt;sp:Layout&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Lax /&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:Layout&gt;
            &lt;sp:IncludeTimestamp /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:TransportBinding&gt;

&lt;!--
  The sp:SignedSupportingTokens element causes the supporting tokens
  to be signed using the primary token that is used to sign the message.
--&gt;
        &lt;sp:SignedSupportingTokens
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
&lt;!--
  The sp:IssuedToken element asserts that a SAML 2.0 security token of type
  Bearer is expected from the STS.  The
  sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
  attribute instructs the runtime to include the initiator's public key
  with every message sent to the recipient.

  The sp:RequestSecurityTokenTemplate element directs that all of the
  children of this element will be copied directly into the body of the
  RequestSecurityToken (RST) message that is sent to the STS when the
  initiator asks the STS to issue a token.
--&gt;
            &lt;sp:IssuedToken
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
              &lt;sp:RequestSecurityTokenTemplate&gt;
                &lt;t:TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/t:TokenType&gt;
                &lt;t:KeyType&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer&lt;/t:KeyType&gt;
              &lt;/sp:RequestSecurityTokenTemplate&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:RequireInternalReference /&gt;
              &lt;/wsp:Policy&gt;
&lt;!--
  The sp:Issuer element defines the STS's address and endpoint information
  This information is used by the STSClient.
--&gt;
              &lt;sp:Issuer&gt;
                &lt;wsaws:Address&gt;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-bearer/SecurityTokenService&lt;/wsaws:Address&gt;
                &lt;wsaws:Metadata
                  xmlns:wsdli="http://www.w3.org/2006/01/wsdl-instance"
                  wsdli:wsdlLocation="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-bearer/SecurityTokenService?wsdl"&gt;
                  &lt;wsaw:ServiceName
                    xmlns:wsaw="http://www.w3.org/2006/05/addressing/wsdl"
                    xmlns:stsns="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
                    EndpointName="UT_Port"&gt;stsns:SecurityTokenService&lt;/wsaw:ServiceName&gt;
                &lt;/wsaws:Metadata&gt;
              &lt;/sp:Issuer&gt;

            &lt;/sp:IssuedToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedSupportingTokens&gt;
&lt;!--
    The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
    to be supported by the STS.  These particular elements generally refer
    to how keys are referenced within the SOAP envelope.  These are normally handled by Apache CXF.
--&gt;
        &lt;sp:Wss11&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefIssuerSerial /&gt;
            &lt;sp:MustSupportRefThumbprint /&gt;
            &lt;sp:MustSupportRefEncryptedKey /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
&lt;!--
    The sp:Trust13 element declares controls for WS-Trust 1.3 options.
    They are policy assertions related to exchanges specifically with
    client and server challenges and entropy behaviors.  Again these are
    normally handled by Apache CXF.
--&gt;
        &lt;sp:Trust13&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens /&gt;
            &lt;sp:RequireClientEntropy /&gt;
            &lt;sp:RequireServerEntropy /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/definitions&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSP_ssl_conf"/>SSL Configuration</h4></div></div></div><p>
							This web service is using HTTPS, therefore the JBoss EAP server must be configured to provide SSL support in the <code class="literal">undertow</code> subsystem.
						</p><p>
							For information on how to configure HTTPS for web applications, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#configure_one_way_and_two_way_ssl_tls_for_application">Configure One-way and Two-way SSL/TLS for Applications</a> in <span class="emphasis"><em>How to Configure Server Security</em></span>.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSP_interface"/>Bearer Web Service Providers Interface</h4></div></div></div><p>
							The <code class="literal">BearerIface</code> Bearer Web Service Provider Interface class is a simple web service definition.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
)
public interface BearerIface {
   @WebMethod
   String sayHello();
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSP_implementation"/>Bearer Web Service Providers Implementation</h4></div></div></div><p>
							The <code class="literal">BearerImpl</code> Web Service Provider Implementation class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint. In addition there are two Apache CXF annotations, <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> used for configuring the endpoint for the Apache CXF runtime. These annotations come from the Apache WSS4J project, which provides a Java implementation of the primary WS-Security standards for web services. These annotations are programmatically adding properties to the endpoint. With plain Apache CXF, these properties are often set using the <code class="literal">&lt;jaxws:properties&gt;</code> element on the <code class="literal">&lt;jaxws:endpoint&gt;</code> element in the Spring configuration. These annotations allow the properties to be configured in the code.
						</p><p>
							WSS4J uses the Crypto interface to get keys and certificates for signature creation/verification, as asserted by the WSDL for this service. The WSS4J configuration information being provided by <code class="literal">BearerImpl</code> is for Crypto’s Merlin implementation.
						</p><p>
							Because the web service provider automatically trusts that the incoming SOAP request that came from the subject defined in the SAML token, it is not required for a Crypto <code class="literal">CallbackHandler</code> class or a signature username, unlike in prior examples. However, in order to verify the message signature, the Java properties file that contains the (Merlin) Crypto configuration information is still required.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;

import javax.jws.WebService;

@WebService
(
   portName = "BearerServicePort",
   serviceName = "BearerService",
   wsdlLocation = "WEB-INF/wsdl/BearerService.wsdl",
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy",
   endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer.BearerIface"
)
@EndpointProperties(value = {
   @EndpointProperty(key = "ws-security.signature.properties", value = "serviceKeystore.properties")
})
public class BearerImpl implements BearerIface {
   public String sayHello() {
      return "Bearer WS-Trust Hello World!";
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSP_crypto_prop_keystore_files"/>Crypto Properties and Keystore Files</h4></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application is using the Merlin implementation. The <code class="literal">serviceKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">servicestore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Self-signed certificates are not appropriate for production use.
							</p></div><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=sspass
org.apache.ws.security.crypto.merlin.keystore.alias=myservicekey
org.apache.ws.security.crypto.merlin.keystore.file=servicestore.jks</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSP_manifest"/>Default MANIFEST.MF</h4></div></div></div><p>
							When deployed, this application requires access to the JBossWS and Apache CXF APIs provided in module <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code>. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="SAML_bearer_assertion_scenario_STS"/>Bearer Security Token Service</h3></div></div></div><p>
						This section lists the crucial elements in providing the Security Token Service functionality for providing a SAML Bearer token. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_STS_security_domain" title="Security Domain">Security Domain</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_STS_sts_wsdl" title="STS WSDL">STS WSDL</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_STS_implementation" title="STS Implementation Class">STS Implementation Class</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_STS_STSBearerCallbackHandler" title="STSBearerCallbackHandler Class">STSBearerCallbackHandler Class</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_STS_crypto_prop_keystore_files" title="Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_STS_manifest" title="Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_STS_security_domain"/>Security Domain</h4></div></div></div><p>
							STS requires a JBoss security domain be configured. The <code class="literal">jboss-web.xml</code> descriptor declares a named security domain,<code class="literal">JBossWS-trust-sts</code> to be used by this service for authentication. This security domain requires two properties files and the addition of a security domain declaration in the JBoss EAP server configuration file.
						</p><p>
							For this scenario the domain needs to contain user <code class="literal">alice</code>, password <code class="literal">clarinet</code>, and role <code class="literal">friend</code>. Refer to the following listings for <code class="literal">jbossws-users.properties</code> and <code class="literal">jbossws-roles.properties</code>. In addition, the following XML must be added to the JBoss <code class="literal">security</code> subsystem in the server configuration file.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Replace "SOME_PATH" with appropriate information.
							</p></div><pre class="programlisting">&lt;security-domain name="JBossWS-trust-sts"&gt;
  &lt;authentication&gt;
    &lt;login-module code="UsersRoles" flag="required"&gt;
      &lt;module-option name="usersProperties" value="/<span class="emphasis"><em>SOME_PATH</em></span>/jbossws-users.properties"/&gt;
      &lt;module-option name="unauthenticatedIdentity" value="anonymous"/&gt;
      &lt;module-option name="rolesProperties" value="/<span class="emphasis"><em>SOME_PATH</em></span>/jbossws-roles.properties"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre><div class="title"><strong>Example: <code class="literal">.jboss-web.xml</code> File</strong></div><p>
								
</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE jboss-web PUBLIC "-//JBoss//DTD Web Application 2.4//EN" "&gt;
&lt;jboss-web&gt;
  &lt;security-domain&gt;java:/jaas/JBossWS-trust-sts&lt;/security-domain&gt;
&lt;/jboss-web&gt;</pre><p>

							</p><div class="title"><strong>Example: <code class="literal">.jbossws-users.properties</code> File</strong></div><p>
								
</p><pre class="screen"># A sample users.properties file for use with the UsersRolesLoginModule
alice=clarinet</pre><p>

							</p><div class="title"><strong>Example: <code class="literal">jbossws-roles.properties</code> File</strong></div><p>
								
</p><pre class="screen"># A sample roles.properties file for use with the UsersRolesLoginModule
alice=friend</pre><p>

							</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_STS_sts_wsdl"/>STS WSDL</h4></div></div></div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsdl:definitions
  targetNamespace="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
  xmlns:tns="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
  xmlns:wstrust="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
  xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
  xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
  xmlns:wsap10="http://www.w3.org/2006/05/addressing/wsdl"
  xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
  xmlns:wsp="http://www.w3.org/ns/ws-policy"
  xmlns:wst="http://docs.oasis-open.org/ws-sx/ws-trust/200512"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"&gt;

  &lt;wsdl:types&gt;
    &lt;xs:schema elementFormDefault="qualified"
               targetNamespace='http://docs.oasis-open.org/ws-sx/ws-trust/200512'&gt;

      &lt;xs:element name='RequestSecurityToken'
                  type='wst:AbstractRequestSecurityTokenType'/&gt;
      &lt;xs:element name='RequestSecurityTokenResponse'
                  type='wst:AbstractRequestSecurityTokenType'/&gt;

      &lt;xs:complexType name='AbstractRequestSecurityTokenType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace='##any' processContents='lax' minOccurs='0'
                  maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name='Context' type='xs:anyURI' use='optional'/&gt;
        &lt;xs:anyAttribute namespace='##other' processContents='lax'/&gt;
      &lt;/xs:complexType&gt;
      &lt;xs:element name='RequestSecurityTokenCollection'
                  type='wst:RequestSecurityTokenCollectionType'/&gt;
      &lt;xs:complexType name='RequestSecurityTokenCollectionType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='RequestSecurityToken'
                      type='wst:AbstractRequestSecurityTokenType' minOccurs='2'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:element name='RequestSecurityTokenResponseCollection'
                  type='wst:RequestSecurityTokenResponseCollectionType'/&gt;
      &lt;xs:complexType name='RequestSecurityTokenResponseCollectionType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='wst:RequestSecurityTokenResponse' minOccurs='1'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace='##other' processContents='lax'/&gt;
      &lt;/xs:complexType&gt;

    &lt;/xs:schema&gt;
  &lt;/wsdl:types&gt;

  &lt;!-- WS-Trust defines the following GEDs --&gt;
  &lt;wsdl:message name="RequestSecurityTokenMsg"&gt;
    &lt;wsdl:part name="request" element="wst:RequestSecurityToken"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenResponseMsg"&gt;
    &lt;wsdl:part name="response"
               element="wst:RequestSecurityTokenResponse"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenCollectionMsg"&gt;
    &lt;wsdl:part name="requestCollection"
               element="wst:RequestSecurityTokenCollection"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenResponseCollectionMsg"&gt;
    &lt;wsdl:part name="responseCollection"
               element="wst:RequestSecurityTokenResponseCollection"/&gt;
  &lt;/wsdl:message&gt;

  &lt;!-- This portType an example of a Requestor (or other) endpoint that
  Accepts SOAP-based challenges from a Security Token Service --&gt;
  &lt;wsdl:portType name="WSSecurityRequestor"&gt;
    &lt;wsdl:operation name="Challenge"&gt;
      &lt;wsdl:input message="tns:RequestSecurityTokenResponseMsg"/&gt;
      &lt;wsdl:output message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!-- This portType is an example of an STS supporting full protocol --&gt;
  &lt;!--
      The wsdl:portType and data types are XML elements defined by the
      WS_Trust specification.  The wsdl:portType defines the endpoints
      supported in the STS implementation.  This WSDL defines all operations
      that an STS implementation can support.
  --&gt;
  &lt;wsdl:portType name="STS"&gt;
    &lt;wsdl:operation name="Cancel"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Cancel"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/CancelFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Issue"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTRC/IssueFinal"
        message="tns:RequestSecurityTokenResponseCollectionMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Renew"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Renew"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/RenewFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Validate"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Validate"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/ValidateFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="KeyExchangeToken"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/KET"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/KETFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="RequestCollection"&gt;
      &lt;wsdl:input message="tns:RequestSecurityTokenCollectionMsg"/&gt;
      &lt;wsdl:output message="tns:RequestSecurityTokenResponseCollectionMsg"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!-- This portType is an example of an endpoint that accepts
  Unsolicited RequestSecurityTokenResponse messages --&gt;
  &lt;wsdl:portType name="SecurityTokenResponseService"&gt;
    &lt;wsdl:operation name="RequestSecurityTokenResponse"&gt;
      &lt;wsdl:input message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!--
      The wsp:PolicyReference binds the security requirments on all the STS endpoints.
      The wsp:Policy wsu:Id="UT_policy" element is later in this file.
  --&gt;
  &lt;wsdl:binding name="UT_Binding" type="wstrust:STS"&gt;
    &lt;wsp:PolicyReference URI="#UT_policy"/&gt;
    &lt;soap:binding style="document"
                  transport="http://schemas.xmlsoap.org/soap/http"/&gt;
    &lt;wsdl:operation name="Issue"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue"/&gt;
      &lt;wsdl:input&gt;
        &lt;wsp:PolicyReference
          URI="#Input_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;wsp:PolicyReference
          URI="#Output_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Validate"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Validate"/&gt;
      &lt;wsdl:input&gt;
        &lt;wsp:PolicyReference
          URI="#Input_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;wsp:PolicyReference
          URI="#Output_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Cancel"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Cancel"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Renew"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Renew"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="KeyExchangeToken"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/KeyExchangeToken"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="RequestCollection"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/RequestCollection"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:binding&gt;

  &lt;wsdl:service name="SecurityTokenService"&gt;
    &lt;wsdl:port name="UT_Port" binding="tns:UT_Binding"&gt;
      &lt;soap:address location="http://localhost:8080/SecurityTokenService/UT"/&gt;
    &lt;/wsdl:port&gt;
  &lt;/wsdl:service&gt;


  &lt;wsp:Policy wsu:Id="UT_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;!--
            The sp:UsingAddressing element, indicates that the endpoints of this
            web service conforms to the WS-Addressing specification.  More detail
            can be found here: [http://www.w3.org/TR/2006/CR-ws-addr-wsdl-20060529]
        --&gt;
        &lt;wsap10:UsingAddressing/&gt;
        &lt;!--
            The sp:SymmetricBinding element indicates that security is provided
            at the SOAP layer and any initiator must authenticate itself by providing
            WSS UsernameToken credentials.
        --&gt;
        &lt;sp:SymmetricBinding
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;!--
                In a symmetric binding, the keys used for encrypting and signing in both
                directions are derived from a single key, the one specified by the
                sp:ProtectionToken element.  The sp:X509Token sub-element declares this
                key to be a X.509 certificate and the
                IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never"
                attribute adds the requirement that the token MUST NOT be included in
                any messages sent between the initiator and the recipient; rather, an
                external reference to the token should be used.  Lastly the WssX509V3Token10
                sub-element declares that the Username token presented by the initiator
                should be compliant with Web Services Security UsernameToken Profile
                1.0 specification. [ http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0.pdf ]
            --&gt;
            &lt;sp:ProtectionToken&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:X509Token
                  sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never"&gt;
                  &lt;wsp:Policy&gt;
                    &lt;sp:RequireDerivedKeys/&gt;
                    &lt;sp:RequireThumbprintReference/&gt;
                    &lt;sp:WssX509V3Token10/&gt;
                  &lt;/wsp:Policy&gt;
                &lt;/sp:X509Token&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:ProtectionToken&gt;
            &lt;!--
                The sp:AlgorithmSuite element, requires the Basic256 algorithm suite
                be used in performing cryptographic operations.
            --&gt;
            &lt;sp:AlgorithmSuite&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Basic256/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:AlgorithmSuite&gt;
            &lt;!--
                The sp:Layout element,  indicates the layout rules to apply when adding
                items to the security header.  The sp:Lax sub-element indicates items
                are added to the security header in any order that conforms to
                WSS: SOAP Message Security.
            --&gt;
            &lt;sp:Layout&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Lax/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:Layout&gt;
            &lt;sp:IncludeTimestamp/&gt;
            &lt;sp:EncryptSignature/&gt;
            &lt;sp:OnlySignEntireHeadersAndBody/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SymmetricBinding&gt;

        &lt;!--
            The sp:SignedSupportingTokens element declares that the security header
            of messages must contain a sp:UsernameToken and the token must be signed.
            The attribute IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"
            on sp:UsernameToken indicates that the token MUST be included in all
            messages sent from initiator to the recipient and that the token MUST
            NOT be included in messages sent from the recipient to the initiator.
            And finally the element sp:WssUsernameToken10 is a policy assertion
            indicating the Username token should be as defined in  Web Services
            Security UsernameToken Profile 1.0
        --&gt;
        &lt;sp:SignedSupportingTokens
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:UsernameToken
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:WssUsernameToken10/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:UsernameToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedSupportingTokens&gt;
        &lt;!--
            The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
            to be supported by the STS.  These particular elements generally refer
            to how keys are referenced within the SOAP envelope.  These are normally
            handled by Apache CXF.
        --&gt;
        &lt;sp:Wss11
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefKeyIdentifier/&gt;
            &lt;sp:MustSupportRefIssuerSerial/&gt;
            &lt;sp:MustSupportRefThumbprint/&gt;
            &lt;sp:MustSupportRefEncryptedKey/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
        &lt;!--
            The sp:Trust13 element declares controls for WS-Trust 1.3 options.
            They are policy assertions related to exchanges specifically with
            client and server challenges and entropy behaviors.  Again these are
            normally handled by Apache CXF.
        --&gt;
        &lt;sp:Trust13
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens/&gt;
            &lt;sp:RequireClientEntropy/&gt;
            &lt;sp:RequireServerEntropy/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

  &lt;wsp:Policy wsu:Id="Input_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;sp:SignedParts
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;sp:Body/&gt;
          &lt;sp:Header Name="To"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="From"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="FaultTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="ReplyTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="MessageID"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="RelatesTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="Action"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
        &lt;/sp:SignedParts&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

  &lt;wsp:Policy wsu:Id="Output_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;sp:SignedParts
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;sp:Body/&gt;
          &lt;sp:Header Name="To"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="From"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="FaultTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="ReplyTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="MessageID"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="RelatesTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="Action"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
        &lt;/sp:SignedParts&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/wsdl:definitions&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_STS_implementation"/>STS Implementation Class</h4></div></div></div><p>
							The Apache CXF’s STS, <code class="literal">SecurityTokenServiceProvider</code>, is a web service provider that is compliant with the protocols and functionality defined by the WS-Trust specification. It has a modular architecture and its components are configurable or replaceable. There are optional features that are enabled by implementing and configuring plugins. You can customize your own STS by extending from <code class="literal">SecurityTokenServiceProvider</code> and overriding the default settings.
						</p><p>
							The <code class="literal">SampleSTSBearer</code> STS implementation class is a POJO that extends from <code class="literal">SecurityTokenServiceProvider</code>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The <code class="literal">SampleSTSBearer</code> class is defined with a <code class="literal">WebServiceProvider</code> annotation and not a <code class="literal">WebService</code> annotation. This annotation defines the service as a <code class="literal">Provider</code>-based endpoint, it supports a messaging-oriented approach to web services. In particular, it signals that the exchanged messages will be XML documents. <code class="literal">SecurityTokenServiceProvider</code> is an implementation of the <code class="literal">javax.xml.ws.Provider</code> interface. In comparison the <code class="literal">WebService</code> annotation defines a service endpoint interface-based endpoint, which supports message exchange using SOAP envelopes.
							</p></div><p>
							As done in the <code class="literal">BearerImpl</code> class, the WSS4J annotations <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> provide endpoint configuration for the Apache CXF runtime. The first <code class="literal">EndpointProperty</code> statement in the listing is declaring the user’s name to use for the message signature. It is used as the alias name in the keystore to get the user’s certificate and private key for signature. The next two <code class="literal">EndpointProperty</code> statements declare the Java properties file that contains the (Merlin) Crypto configuration information. In this case both for signing and encrypting the messages. WSS4J reads this file and required information for message handling. The last <code class="literal">EndpointProperty</code> statement declares the <code class="literal">STSBearerCallbackHandler</code> implementation class. It is used to obtain the user’s password for the certificates in the keystore file.
						</p><p>
							In this implementation we are customizing the operations of token issuance, token validation, and their static properties.
						</p><p>
							<code class="literal">StaticSTSProperties</code> is used to set select properties for configuring resources in STS. This may seem like duplication of the settings made with the WSS4J annotations. The values are the same but the underlaying structures being set are different, thus this information must be declared in both places.
						</p><p>
							The <code class="literal">setIssuer</code> setting is important because it uniquely identifies the issuing STS. The issuer string is embedded in issued tokens and, when validating tokens, the STS checks the issuer string value. Consequently, it is important to use the issuer string in a consistent way, so that the STS can recognize the tokens that are issued.
						</p><p>
							The <code class="literal">setEndpoints</code> call allows the declaration of a set of allowed token recipients by address. The addresses are specified as reg-ex patterns.
						</p><p>
							<code class="literal">TokenIssueOperation</code> has a modular structure. This allows custom behaviors to be injected into the processing of messages. In this case we are overriding the <code class="literal">SecurityTokenServiceProvider</code> default behavior and performing SAML token processing. Apache CXF provides an implementation of a <code class="literal">SAMLTokenProvider</code>, which can be used rather than creating one.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.sts.StaticSTSProperties;
import org.apache.cxf.sts.operation.TokenIssueOperation;
import org.apache.cxf.sts.service.ServiceMBean;
import org.apache.cxf.sts.service.StaticService;
import org.apache.cxf.sts.token.provider.SAMLTokenProvider;
import org.apache.cxf.ws.security.sts.provider.SecurityTokenServiceProvider;

import javax.xml.ws.WebServiceProvider;
import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

@WebServiceProvider(serviceName = "SecurityTokenService",
      portName = "UT_Port",
      targetNamespace = "http://docs.oasis-open.org/ws-sx/ws-trust/200512/",
      wsdlLocation = "WEB-INF/wsdl/bearer-ws-trust-1.4-service.wsdl")
//dependency on org.apache.cxf module or on module that exports org.apache.cxf (e.g. org.jboss.ws.cxf.jbossws-cxf-client) is needed, otherwise Apache CXF annotations are ignored
@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "mystskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value = "stsKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer.STSBearerCallbackHandler")
})
public class SampleSTSBearer extends SecurityTokenServiceProvider {

   public SampleSTSBearer() throws Exception {
      super();

      StaticSTSProperties props = new StaticSTSProperties();
      props.setSignatureCryptoProperties("stsKeystore.properties");
      props.setSignatureUsername("mystskey");
      props.setCallbackHandlerClass(STSBearerCallbackHandler.class.getName());
      props.setEncryptionCryptoProperties("stsKeystore.properties");
      props.setEncryptionUsername("myservicekey");
      props.setIssuer("DoubleItSTSIssuer");

      List&lt;ServiceMBean&gt; services = new LinkedList&lt;ServiceMBean&gt;();
      StaticService service = new StaticService();
      service.setEndpoints(Arrays.asList(
         "https://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService",
         "https://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService",
         "https://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService"
      ));
      services.add(service);

      TokenIssueOperation issueOperation = new TokenIssueOperation();
      issueOperation.getTokenProviders().add(new SAMLTokenProvider());
      issueOperation.setServices(services);
      issueOperation.setStsProperties(props);
      this.setIssueOperation(issueOperation);
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_STS_STSBearerCallbackHandler"/>STSBearerCallbackHandler Class</h4></div></div></div><p>
							<code class="literal">STSBearerCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;

import java.util.HashMap;
import java.util.Map;

public class STSBearerCallbackHandler extends PasswordCallbackHandler {
   public STSBearerCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("mystskey", "stskpass");
      passwords.put("alice", "clarinet");
      return passwords;
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_STS_crypto_prop_keystore_files"/>Crypto Properties and Keystore Files</h4></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application is using the Merlin implementation. The <code class="literal">stsKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">servicestore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Self-signed certificates are not appropriate for production use.
							</p></div><pre class="programlisting">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=stsspass
org.apache.ws.security.crypto.merlin.keystore.file=stsstore.jks</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_STS_manifest"/>Default MANIFEST.MF</h4></div></div></div><p>
							This application requires access to the JBossWS and Apache CXF APIs provided in the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> module. The <code class="literal">org.jboss.ws.cxf.sts</code> module is also needed to build the STS configuration in the <code class="literal">SampleSTS</code> constructor. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client,org.jboss.ws.cxf.sts</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="SAML_bearer_assertion_scenario_WSR"/>Web Service Requester</h3></div></div></div><p>
						This section provides the details of crucial elements in calling a web service that implements endpoint security as described in the SAML Bearer scenario. The components that will be discussed include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSR_implementation" title="Web Service Requester Implementation">Web Service Requester Implementation</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSR_ClientCallbackHandler" title="ClientCallbackHandler">ClientCallbackHandler</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#SAML_bearer_assertion_scenario_WSR_crypto_prop_keystore_files" title="Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSR_implementation"/>Web Service Requester Implementation</h4></div></div></div><p>
							The <code class="literal">ws-requester</code>, the client, uses standard procedures for creating a reference to the web service. To address the endpoint security requirements, the web service’s "Request Context" is configured with the information required for message generation. In addition, the <code class="literal">STSClient</code> that communicates with the STS is configured with similar values.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The key strings ending with a <code class="literal">.it</code> suffix flags these settings as belonging to the <code class="literal">STSClient</code>. The internal Apache CXF code assigns this information to the <code class="literal">STSClient</code> that is auto-generated for this service call.
							</p></div><p>
							There is an alternate method of setting up the <code class="literal">STSCLient</code>. The user may provide their own instance of the <code class="literal">STSClient</code>. The Apache CXF code uses this object and does not auto-generate one. When providing the <code class="literal">STSClient</code> in this way, the user must provide a <code class="literal">org.apache.cxf.Bus</code> for it and the configuration keys must not have the <code class="literal">.it</code> suffix. This is used in the <a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler" title="ActAsCallbackHandler Class">ActAs</a> and <a class="link" href="reference_material.html#OnBehalfOf_ws_trust_scenario_WSR_implementation" title="OnBehalfOf Web Service Requester Implementation Class">OnBehalfOf</a> examples.
						</p><pre class="programlisting">String serviceURL = "https://" + getServerHost() + ":8443/jaxws-samples-wsse-policy-trust-bearer/BearerService";

final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy", "BearerService");
Service service = Service.create(new URL(serviceURL + "?wsdl"), serviceName);
BearerIface proxy = (BearerIface) service.getPort(BearerIface.class);

Map&lt;String, Object&gt; ctx = ((BindingProvider)proxy).getRequestContext();

// set the security related configuration information for the service "request"
ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myclientkey");
ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myservicekey");

//-- Configuration settings that will be transfered to the STSClient
// "alice" is the name provided for the WSS Username. Her password will
// be retreived from the ClientCallbackHander by the STSClient.
ctx.put(SecurityConstants.USERNAME + ".it", "alice");
ctx.put(SecurityConstants.CALLBACK_HANDLER + ".it", new ClientCallbackHandler());
ctx.put(SecurityConstants.ENCRYPT_PROPERTIES + ".it",
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.ENCRYPT_USERNAME + ".it", "mystskey");
ctx.put(SecurityConstants.STS_TOKEN_USERNAME + ".it", "myclientkey");
ctx.put(SecurityConstants.STS_TOKEN_PROPERTIES + ".it",
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO + ".it", "true");

proxy.sayHello();</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSR_ClientCallbackHandler"/>ClientCallbackHandler</h4></div></div></div><p>
							<code class="literal">ClientCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The user <code class="literal">alice</code> and password have been provided here. This information is not in the (JKS) keystore but provided in the security domain. It is declared in <code class="literal">jbossws-users.properties</code> file.
							</p></div><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared;

import java.io.IOException;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import org.apache.ws.security.WSPasswordCallback;

public class ClientCallbackHandler implements CallbackHandler {

    public void handle(Callback[] callbacks) throws IOException,
            UnsupportedCallbackException {
        for (int i = 0; i &lt; callbacks.length; i++) {
            if (callbacks[i] instanceof WSPasswordCallback) {
                WSPasswordCallback pc = (WSPasswordCallback) callbacks[i];
                if ("myclientkey".equals(pc.getIdentifier())) {
                    pc.setPassword("ckpass");
                    break;
                } else if ("alice".equals(pc.getIdentifier())) {
                    pc.setPassword("clarinet");
                    break;
                } else if ("bob".equals(pc.getIdentifier())) {
                    pc.setPassword("trombone");
                    break;
                } else if ("myservicekey".equals(pc.getIdentifier())) {  // rls test  added for bearer test
                   pc.setPassword("skpass");
                   break;
                }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="SAML_bearer_assertion_scenario_WSR_crypto_prop_keystore_files"/>Crypto Properties and Keystore Files</h4></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application is using the Merlin implementation. The <code class="literal">clientKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">clientstore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Self-signed certificates are not appropriate for production use.
							</p></div><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=cspass
org.apache.ws.security.crypto.merlin.keystore.alias=myclientkey
org.apache.ws.security.crypto.merlin.keystore.file=META-INF/clientstore.jks</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="scenario_onbehalfof_ws_trust"/>Scenario: OnBehalfOf WS-Trust</h2></div></div></div><p>
					The <code class="literal">OnBehalfOf</code> feature is used in scenarios that use the proxy pattern. In such scenarios, the client cannot access the STS directly, instead it communicates through a proxy gateway. The proxy gateway authenticates the caller and puts information about the caller into the <code class="literal">OnBehalfOf</code> element of the <code class="literal">RequestSecurityToken</code> (RST) sent to the real STS for processing. The resulting token contains only claims related to the client of the proxy, making the proxy completely transparent to the receiver of the issued token.
				</p><p>
					<code class="literal">OnBehalfOf</code> is nothing more than a new sub-element in the RST. It provides additional information about the original caller when a token is negotiated with the STS. The <code class="literal">OnBehalfOf</code> element usually takes the form of a token with identity claims such as name, role, and authorization code, for the client to access the service.
				</p><p>
					The <code class="literal">OnBehalfOf</code> scenario is an extension of the basic WS-Trust scenario. In this example the <code class="literal">OnBehalfOf</code> service calls the <code class="literal">ws-service</code> on behalf of a user. There are only a couple of additions to the basic scenario’s code. An <code class="literal">OnBehalfOf</code> web service provider and callback handler have been added. The <code class="literal">OnBehalfOf</code> web services' WSDL imposes the same security policies as the <code class="literal">ws-provider</code>. <code class="literal">UsernameTokenCallbackHandler</code> is a utility shared with <code class="literal">ActAs</code>. It generates the content for the <code class="literal">OnBehalfOf</code> element. Lastly, there are code additions in the STS that both <code class="literal">OnBehalfOf</code> and <code class="literal">ActAs</code> share in common.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSP"/>Web Service Provider</h3></div></div></div><p>
						This section provides the web service elements from the basic WS-Trust scenario that have been updated to address the requirements of the <code class="literal">OnBehalfOf</code> example. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#OnBehalfOf_ws_trust_scenario_WSP_wsdl" title="Web Service Provider WSDL">Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#OnBehalfOf_ws_trust_scenario_WSP_interface" title="Web Service Provider Interface">Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#OnBehalfOf_ws_trust_scenario_WSP_implementation" title="Web Service Provider Implementation">Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#OnBehalfOf_ws_trust_scenario_WSP_OnBehalfOfCallbackHandler" title="OnBehalfOfCallbackHandler Class">OnBehalfOfCallbackHandler Class</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSP_wsdl"/>Web Service Provider WSDL</h4></div></div></div><p>
							The <code class="literal">OnBehalfOf</code> web service provider’s WSDL is a clone of the <code class="literal">ws-provider’s</code> WSDL. The <code class="literal">wsp:Policy</code> section is the same. There are updates to the service endpoint, <code class="literal">targetNamespace</code>, <code class="literal">portType</code>, <code class="literal">binding</code> name, and <code class="literal">service</code>.
						</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy" name="OnBehalfOfService"
             xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:wsp="http://www.w3.org/ns/ws-policy"
             xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
             xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
             xmlns:wsaws="http://www.w3.org/2005/08/addressing"
             xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
             xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;
    &lt;types&gt;
        &lt;xsd:schema&gt;
            &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy"
                  schemaLocation="OnBehalfOfService_schema1.xsd"/&gt;
        &lt;/xsd:schema&gt;
    &lt;/types&gt;
    &lt;message name="sayHello"&gt;
        &lt;part name="parameters" element="tns:sayHello"/&gt;
    &lt;/message&gt;
    &lt;message name="sayHelloResponse"&gt;
        &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
    &lt;/message&gt;
    &lt;portType name="OnBehalfOfServiceIface"&gt;
        &lt;operation name="sayHello"&gt;
            &lt;input message="tns:sayHello"/&gt;
            &lt;output message="tns:sayHelloResponse"/&gt;
        &lt;/operation&gt;
    &lt;/portType&gt;
    &lt;binding name="OnBehalfOfServicePortBinding" type="tns:OnBehalfOfServiceIface"&gt;
        &lt;wsp:PolicyReference URI="#AsymmetricSAML2Policy" /&gt;
        &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
        &lt;operation name="sayHello"&gt;
            &lt;soap:operation soapAction=""/&gt;
            &lt;input&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Input_Policy" /&gt;
            &lt;/input&gt;
            &lt;output&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Output_Policy" /&gt;
            &lt;/output&gt;
        &lt;/operation&gt;
    &lt;/binding&gt;
    &lt;service name="OnBehalfOfService"&gt;
        &lt;port name="OnBehalfOfServicePort" binding="tns:OnBehalfOfServicePortBinding"&gt;
            &lt;soap:address location="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService"/&gt;
        &lt;/port&gt;
    &lt;/service&gt;
&lt;/definitions&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSP_interface"/>Web Service Provider Interface</h4></div></div></div><p>
							The <code class="literal">OnBehalfOfServiceIface</code> web service provider interface class is a simple web service definition.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy"
)
public interface OnBehalfOfServiceIface {
   @WebMethod
   String sayHello();
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSP_implementation"/>Web Service Provider Implementation</h4></div></div></div><p>
							The <code class="literal">OnBehalfOfServiceImpl</code> web service provider implementation class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint and two Apache WSS4J annotations, <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> used for configuring the endpoint for the Apache CXF runtime. The WSS4J configuration information provided is for WSS4J’s Crypto Merlin implementation.
						</p><p>
							<code class="literal">OnBehalfOfServiceImpl</code> calls the <code class="literal">ServiceImpl</code> acting on behalf of the user. The <code class="literal">setupService</code> method performs the required configuration setup.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import org.apache.cxf.Bus;
import org.apache.cxf.BusFactory;
import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.STSClient;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.service.ServiceIface;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared.WSTrustAppUtils;

import javax.jws.WebService;
import javax.xml.namespace.QName;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.Service;
import java.net.*;
import java.util.Map;

@WebService
(
   portName = "OnBehalfOfServicePort",
   serviceName = "OnBehalfOfService",
   wsdlLocation = "WEB-INF/wsdl/OnBehalfOfService.wsdl",
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy",
   endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof.OnBehalfOfServiceIface"
)

@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "myactaskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value =  "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.encryption.properties", value = "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof.OnBehalfOfCallbackHandler")
})

public class OnBehalfOfServiceImpl implements OnBehalfOfServiceIface {
   public String sayHello() {
      try {

         ServiceIface proxy = setupService();
         return "OnBehalfOf " + proxy.sayHello();

      } catch (MalformedURLException e) {
         e.printStackTrace();
      }
      return null;
   }

   /**
    *
    * @return
    * @throws MalformedURLException
    */
   private  ServiceIface setupService()throws MalformedURLException {
      ServiceIface proxy = null;
      Bus bus = BusFactory.newInstance().createBus();

      try {
         BusFactory.setThreadDefaultBus(bus);

         final String serviceURL = "http://" + WSTrustAppUtils.getServerHost() + ":8080/jaxws-samples-wsse-policy-trust/SecurityService";
         final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/wssecuritypolicy", "SecurityService");
         final URL wsdlURL = new URL(serviceURL + "?wsdl");
         Service service = Service.create(wsdlURL, serviceName);
         proxy = (ServiceIface) service.getPort(ServiceIface.class);

         Map&lt;String, Object&gt; ctx = ((BindingProvider) proxy).getRequestContext();
         ctx.put(SecurityConstants.CALLBACK_HANDLER, new OnBehalfOfCallbackHandler());

         ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            "actasKeystore.properties" ));
         ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myactaskey" );
         ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            "../../META-INF/clientKeystore.properties" ));
         ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myservicekey");

         STSClient stsClient = new STSClient(bus);
         Map&lt;String, Object&gt; props = stsClient.getProperties();
         props.put(SecurityConstants.USERNAME, "bob");
         props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
         props.put(SecurityConstants.STS_TOKEN_USERNAME, "myactaskey" );
         props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            "actasKeystore.properties" ));
         props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

         ctx.put(SecurityConstants.STS_CLIENT, stsClient);

      } finally {
         bus.shutdown(true);
      }

      return proxy;
   }

}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSP_OnBehalfOfCallbackHandler"/>OnBehalfOfCallbackHandler Class</h4></div></div></div><p>
							The <code class="literal">OnBehalfOfCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature. This class has been updated to return the passwords for this service, <code class="literal">myactaskey</code> and the <code class="literal">OnBehalfOf</code> user, <code class="literal">alice</code>.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;
import java.util.HashMap;
import java.util.Map;

public class OnBehalfOfCallbackHandler extends PasswordCallbackHandler {

   public OnBehalfOfCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("myactaskey", "aspass");
      passwords.put("alice", "clarinet");
      passwords.put("bob", "trombone");
      return passwords;
   }

}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSR"/>Web Service Requester</h3></div></div></div><p>
						This section provides details of the <code class="literal">ws-requester</code> elements from the basic WS-Trust scenario that have been updated to address the requirements of the <code class="literal">OnBehalfOf</code> example. The component is:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#OnBehalfOf_ws_trust_scenario_WSR_implementation" title="OnBehalfOf Web Service Requester Implementation Class">OnBehalfOf Web Service Requester Implementation Class</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="OnBehalfOf_ws_trust_scenario_WSR_implementation"/>OnBehalfOf Web Service Requester Implementation Class</h4></div></div></div><p>
							The <code class="literal">OnBehalfOf</code> <code class="literal">ws-requester</code>, the client, uses standard procedures for creating a reference to the web service in the first four lines. To address the endpoint security requirements, the web service’s request context is configured using the <code class="literal">BindingProvider</code>. Information needed in the message generation is provided through it. The <code class="literal">OnBehalfOf</code> user, <code class="literal">alice</code>, is declared in this section and the <code class="literal">callbackHandler</code>, <code class="literal">UsernameTokenCallbackHandler</code> is provided to the <code class="literal">STSClient</code> for generation of the contents for the <code class="literal">OnBehalfOf</code> message element. In this example an <code class="literal">STSClient</code> object is created and provided to the proxy’s request context. The alternative is to provide keys tagged with the <code class="literal">.it</code> suffix as done in the Basic Scenario client. The use of <code class="literal">OnBehalfOf</code> is configured by the <code class="literal">stsClient.setOnBehalfOf</code> call method. The alternative is to use the key <code class="literal">SecurityConstants.STS_TOKEN_ON_BEHALF_OF</code> and a value in the properties map.
						</p><pre class="programlisting">final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy", "OnBehalfOfService");
final URL wsdlURL = new URL(serviceURL + "?wsdl");
Service service = Service.create(wsdlURL, serviceName);
OnBehalfOfServiceIface proxy = (OnBehalfOfServiceIface) service.getPort(OnBehalfOfServiceIface.class);


Bus bus = BusFactory.newInstance().createBus();
try {

    BusFactory.setThreadDefaultBus(bus);

    Map&lt;String, Object&gt; ctx = proxy.getRequestContext();

    ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myactaskey");
    ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myclientkey");

    // user and password OnBehalfOf user
    // UsernameTokenCallbackHandler will extract this information when called
    ctx.put(SecurityConstants.USERNAME,"alice");
    ctx.put(SecurityConstants.PASSWORD, "clarinet");

    STSClient stsClient = new STSClient(bus);

    // Providing the STSClient the mechanism to create the claims contents for OnBehalfOf
    stsClient.setOnBehalfOf(new UsernameTokenCallbackHandler());

    Map&lt;String, Object&gt; props = stsClient.getProperties();
    props.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    props.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
    props.put(SecurityConstants.STS_TOKEN_USERNAME, "myclientkey");
    props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

    ctx.put(SecurityConstants.STS_CLIENT, stsClient);

} finally {
    bus.shutdown(true);
}
proxy.sayHello();</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ActAs_ws_trust_scenario"/>Scenario: ActAs WS-Trust</h2></div></div></div><p>
					The <code class="literal">ActAs</code> feature is used in scenarios that require composite delegation. It is commonly used in multi-tiered systems where an application calls a service on behalf of a logged in user, or a service calls another service on behalf of the original caller.
				</p><p>
					<code class="literal">ActAs</code> is nothing more than a new sub-element in the <code class="literal">RequestSecurityToken</code> (RST). It provides additional information about the original caller when a token is negotiated with the STS. The <code class="literal">ActAs</code> element usually takes the form of a token with identity claims such as name, role, and authorization code, for the client to access the service.
				</p><p>
					The <code class="literal">ActAs</code> scenario is an extension of the basic WS-Trust scenario. In this example the <code class="literal">ActAs</code> service calls the <code class="literal">ws-service</code> on behalf of a user. There are only a couple of additions to the basic scenario’s code. An <code class="literal">ActAs</code> web service provider and callback handler have been added. The <code class="literal">ActAs</code> web services' WSDL imposes the same security policies as the <code class="literal">ws-provider</code>. <code class="literal">UsernameTokenCallbackHandler</code> is a new utility that generates the content for the <code class="literal">ActAs</code> element. Lastly, there are a couple of code additions in the STS to support the <code class="literal">ActAs</code> request.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ActAs_ws_trust_scenario_WSP"/>Web Service Provider</h3></div></div></div><p>
						This section provides details about the web service elements from the basic WS-Trust scenario that have been changed to address the needs of the <code class="literal">ActAs</code> example. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_wsdl" title="Web Service Provider WSDL">ActAs Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_interface" title="Web Service Provider Interface">ActAs Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_implementation" title="Web Service Provider Implementation">ActAs Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler" title="ActAsCallbackHandler Class">ActAsCallbackHandler Class</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_UsernameTokenCallbackHandler" title="UsernameTokenCallbackHandler">UsernameTokenCallbackHandler</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_crypto_prop_keystore_files" title="Crypto properties and keystore files">Crypto properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSP_manifest" title="Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_wsdl"/>Web Service Provider WSDL</h4></div></div></div><p>
							The <code class="literal">ActAs</code> web service provider’s WSDL is a clone of the <code class="literal">ws-provider’s</code> WSDL. The <code class="literal">wsp:Policy</code> section is the same. There are changes to the service endpoint, <code class="literal">targetNamespace</code>, <code class="literal">portType</code>, <code class="literal">binding</code> name, and <code class="literal">service</code>.
						</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy" name="ActAsService"
             xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:wsp="http://www.w3.org/ns/ws-policy"
             xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
             xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
             xmlns:wsaws="http://www.w3.org/2005/08/addressing"
             xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
             xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;
    &lt;types&gt;
        &lt;xsd:schema&gt;
            &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy"
                    schemaLocation="ActAsService_schema1.xsd"/&gt;
        &lt;/xsd:schema&gt;
    &lt;/types&gt;
    &lt;message name="sayHello"&gt;
        &lt;part name="parameters" element="tns:sayHello"/&gt;
    &lt;/message&gt;
    &lt;message name="sayHelloResponse"&gt;
        &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
    &lt;/message&gt;
    &lt;portType name="ActAsServiceIface"&gt;
        &lt;operation name="sayHello"&gt;
            &lt;input message="tns:sayHello"/&gt;
            &lt;output message="tns:sayHelloResponse"/&gt;
        &lt;/operation&gt;
    &lt;/portType&gt;
    &lt;binding name="ActAsServicePortBinding" type="tns:ActAsServiceIface"&gt;
        &lt;wsp:PolicyReference URI="#AsymmetricSAML2Policy" /&gt;
        &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
        &lt;operation name="sayHello"&gt;
            &lt;soap:operation soapAction=""/&gt;
            &lt;input&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Input_Policy" /&gt;
            &lt;/input&gt;
            &lt;output&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Output_Policy" /&gt;
            &lt;/output&gt;
        &lt;/operation&gt;
    &lt;/binding&gt;
    &lt;service name="ActAsService"&gt;
        &lt;port name="ActAsServicePort" binding="tns:ActAsServicePortBinding"&gt;
            &lt;soap:address location="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-actas/ActAsService"/&gt;
        &lt;/port&gt;
    &lt;/service&gt;

&lt;/definitions&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_interface"/>Web Service Provider Interface</h4></div></div></div><p>
							The <code class="literal">ActAsServiceIface</code> web service provider interface class is a simple web service definition.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy"
)
public interface ActAsServiceIface {
   @WebMethod
   String sayHello();
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_implementation"/>Web Service Provider Implementation</h4></div></div></div><p>
							The <code class="literal">ActAsServiceImpl</code> web service provider implementation class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint and two Apache WSS4J annotations, <code class="literal">EndpointProperties</code>, and <code class="literal">EndpointProperty</code>, used for configuring the endpoint for the Apache CXF runtime. The WSS4J configuration information provided is for WSS4J’s Crypto Merlin implementation.
						</p><p>
							<code class="literal">ActAsServiceImpl</code> is calling <code class="literal">ServiceImpl</code> acting on behalf of the user. The <code class="literal">setupService</code> method performs the required configuration setup.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas;

import org.apache.cxf.Bus;
import org.apache.cxf.BusFactory;
import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.STSClient;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.service.ServiceIface;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared.WSTrustAppUtils;

import javax.jws.WebService;
import javax.xml.namespace.QName;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.Service;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Map;

@WebService
(
   portName = "ActAsServicePort",
   serviceName = "ActAsService",
   wsdlLocation = "WEB-INF/wsdl/ActAsService.wsdl",
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy",
   endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas.ActAsServiceIface"
)

@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "myactaskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value =  "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.encryption.properties", value = "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas.ActAsCallbackHandler")
})

public class ActAsServiceImpl implements ActAsServiceIface {
   public String sayHello() {
      try {
         ServiceIface proxy = setupService();
         return "ActAs " + proxy.sayHello();
      } catch (MalformedURLException e) {
         e.printStackTrace();
      }
      return null;
   }

   private  ServiceIface setupService()throws MalformedURLException {
      ServiceIface proxy = null;
      Bus bus = BusFactory.newInstance().createBus();

      try {
         BusFactory.setThreadDefaultBus(bus);

         final String serviceURL = "http://" + WSTrustAppUtils.getServerHost() + ":8080/jaxws-samples-wsse-policy-trust/SecurityService";
         final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/wssecuritypolicy", "SecurityService");
         final URL wsdlURL = new URL(serviceURL + "?wsdl");
         Service service = Service.create(wsdlURL, serviceName);
         proxy = (ServiceIface) service.getPort(ServiceIface.class);

         Map&lt;String, Object&gt; ctx = ((BindingProvider) proxy).getRequestContext();
         ctx.put(SecurityConstants.CALLBACK_HANDLER, new ActAsCallbackHandler());

         ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource("actasKeystore.properties" ));
         ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myactaskey" );
         ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource("../../META-INF/clientKeystore.properties" ));
         ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myservicekey");

         STSClient stsClient = new STSClient(bus);
         Map&lt;String, Object&gt; props = stsClient.getProperties();
         props.put(SecurityConstants.USERNAME, "alice");
         props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
         props.put(SecurityConstants.STS_TOKEN_USERNAME, "myactaskey" );
         props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource("actasKeystore.properties" ));
         props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

         ctx.put(SecurityConstants.STS_CLIENT, stsClient);

      } finally {
         bus.shutdown(true);
      }

      return proxy;
   }

}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler"/>ActAsCallbackHandler Class</h4></div></div></div><p>
							<code class="literal">ActAsCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature. This class has been updated to return the passwords for this service, <code class="literal">myactaskey</code> and the <code class="literal">ActAs</code> user, <code class="literal">alice</code>.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;
import java.util.HashMap;
import java.util.Map;

public class ActAsCallbackHandler extends PasswordCallbackHandler {

   public ActAsCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("myactaskey", "aspass");
      passwords.put("alice", "clarinet");
      return passwords;
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_UsernameTokenCallbackHandler"/>UsernameTokenCallbackHandler</h4></div></div></div><p>
							The <code class="literal">ActAs</code> and <code class="literal">OnBeholdOf</code> sub-elements of the <code class="literal">RequestSecurityToken</code> have to be defined as WSSE <code class="literal">UsernameTokens</code>. This utility generates the properly formatted element.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared;

import org.apache.cxf.helpers.DOMUtils;
import org.apache.cxf.message.Message;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.delegation.DelegationCallback;
import org.apache.ws.security.WSConstants;
import org.apache.ws.security.message.token.UsernameToken;
import org.w3c.dom.Document;
import org.w3c.dom.Node;
import org.w3c.dom.Element;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSSerializer;

import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import java.io.IOException;
import java.util.Map;

/**
* A utility to provide the 3 different input parameter types for jaxws property
* "ws-security.sts.token.act-as" and "ws-security.sts.token.on-behalf-of".
* This implementation obtains a username and password via the jaxws property
* "ws-security.username" and "ws-security.password" respectively, as defined
* in SecurityConstants.  It creates a wss UsernameToken to be used as the
* delegation token.
*/

public class UsernameTokenCallbackHandler implements CallbackHandler {

   public void handle(Callback[] callbacks)
      throws IOException, UnsupportedCallbackException {
      for (int i = 0; i &lt; callbacks.length; i++) {
         if (callbacks[i] instanceof DelegationCallback) {
            DelegationCallback callback = (DelegationCallback) callbacks[i];
            Message message = callback.getCurrentMessage();

            String username =
               (String)message.getContextualProperty(SecurityConstants.USERNAME);
            String password =
               (String)message.getContextualProperty(SecurityConstants.PASSWORD);
            if (username != null) {
               Node contentNode = message.getContent(Node.class);
               Document doc = null;
               if (contentNode != null) {
                  doc = contentNode.getOwnerDocument();
               } else {
                  doc = DOMUtils.createDocument();
               }
               UsernameToken usernameToken = createWSSEUsernameToken(username,password, doc);
               callback.setToken(usernameToken.getElement());
            }
         } else {
            throw new UnsupportedCallbackException(callbacks[i], "Unrecognized Callback");
         }
      }
   }

   /**
    * Provide UsernameToken as a string.
    * @param ctx
    * @return
    */
   public String getUsernameTokenString(Map&lt;String, Object&gt; ctx){
      Document doc = DOMUtils.createDocument();
      String result = null;
      String username = (String)ctx.get(SecurityConstants.USERNAME);
      String password = (String)ctx.get(SecurityConstants.PASSWORD);
      if (username != null) {
         UsernameToken usernameToken = createWSSEUsernameToken(username,password, doc);
         result = toString(usernameToken.getElement().getFirstChild().getParentNode());
      }
      return result;
   }

   /**
    *
    * @param username
    * @param password
    * @return
    */
   public String getUsernameTokenString(String username, String password){
      Document doc = DOMUtils.createDocument();
      String result = null;
      if (username != null) {
         UsernameToken usernameToken = createWSSEUsernameToken(username,password, doc);
         result = toString(usernameToken.getElement().getFirstChild().getParentNode());
      }
      return result;
   }

   /**
    * Provide UsernameToken as a DOM Element.
    * @param ctx
    * @return
    */
   public Element getUsernameTokenElement(Map&lt;String, Object&gt; ctx){
      Document doc = DOMUtils.createDocument();
      Element result = null;
      UsernameToken usernameToken = null;
         String username = (String)ctx.get(SecurityConstants.USERNAME);
      String password = (String)ctx.get(SecurityConstants.PASSWORD);
      if (username != null) {
         usernameToken = createWSSEUsernameToken(username,password, doc);
         result = usernameToken.getElement();
      }
      return result;
   }

   /**
    *
    * @param username
    * @param password
    * @return
    */
   public Element getUsernameTokenElement(String username, String password){
      Document doc = DOMUtils.createDocument();
      Element result = null;
      UsernameToken usernameToken = null;
      if (username != null) {
         usernameToken = createWSSEUsernameToken(username,password, doc);
         result = usernameToken.getElement();
      }
      return result;
   }

   private UsernameToken createWSSEUsernameToken(String username, String password, Document doc) {

      UsernameToken usernameToken = new UsernameToken(true, doc,
         (password == null)? null: WSConstants.PASSWORD_TEXT);
      usernameToken.setName(username);
      usernameToken.addWSUNamespace();
      usernameToken.addWSSENamespace();
      usernameToken.setID("id-" + username);

      if (password != null){
         usernameToken.setPassword(password);
      }

      return usernameToken;
   }


   private String toString(Node node) {
      String str = null;

      if (node != null) {
         DOMImplementationLS lsImpl = (DOMImplementationLS)
            node.getOwnerDocument().getImplementation().getFeature("LS", "3.0");
         LSSerializer serializer = lsImpl.createLSSerializer();
         serializer.getDomConfig().setParameter("xml-declaration", false); //by default its true, so set it to false to get String without xml-declaration
         str = serializer.writeToString(node);
      }
      return str;
   }

}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_crypto_prop_keystore_files"/>Crypto properties and keystore files</h4></div></div></div><p>
							The <code class="literal">ActAs</code> service must provide its own credentials. The requisite <code class="literal">actasKeystore.properties</code> properties file and <code class="literal">actasstore.jks</code> keystore are created.
						</p><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=aapass
org.apache.ws.security.crypto.merlin.keystore.alias=myactaskey
org.apache.ws.security.crypto.merlin.keystore.file=actasstore.jks</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSP_manifest"/>Default MANIFEST.MF</h4></div></div></div><p>
							This application requires access to the JBossWS and Apache CXF APIs provided in the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> module. The <code class="literal">org.jboss.ws.cxf.sts</code> module is also needed in handling the <code class="literal">ActAs</code> and <code class="literal">OnBehalfOf</code> extensions. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client, org.jboss.ws.cxf.sts</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ActAs_ws_trust_scenario_STS"/>Security Token Service</h3></div></div></div><p>
						This section provides the details of the STS elements from the basic WS-Trust scenario that have been changed to address the needs of the <code class="literal">ActAs</code> example. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_STS_implementation" title="STS Implementation Class">STS Implementation Class</a>
							</li><li class="listitem">
								<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_STS_STSCallbackHandler" title="STSCallbackHandler Class">STSCallbackHandler Class</a>
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_STS_implementation"/>STS Implementation Class</h4></div></div></div><p>
							The declaration of the set of allowed token recipients by address has been extended to accept <code class="literal">ActAs</code> addresses and <code class="literal">OnBehalfOf</code> addresses. The addresses are specified as reg-ex patterns.
						</p><p>
							The <code class="literal">TokenIssueOperation</code> requires the <code class="literal">UsernameTokenValidator</code> class to be provided to validate the contents of the <code class="literal">OnBehalfOf</code>, and the <code class="literal">UsernameTokenDelegationHandler</code> class to be provided to process the token delegation request of the <code class="literal">ActAs</code> on <code class="literal">OnBehalfOf</code> user.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.sts;

import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

import javax.xml.ws.WebServiceProvider;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.interceptor.InInterceptors;
import org.apache.cxf.sts.StaticSTSProperties;
import org.apache.cxf.sts.operation.TokenIssueOperation;
import org.apache.cxf.sts.operation.TokenValidateOperation;
import org.apache.cxf.sts.service.ServiceMBean;
import org.apache.cxf.sts.service.StaticService;
import org.apache.cxf.sts.token.delegation.UsernameTokenDelegationHandler;
import org.apache.cxf.sts.token.provider.SAMLTokenProvider;
import org.apache.cxf.sts.token.validator.SAMLTokenValidator;
import org.apache.cxf.sts.token.validator.UsernameTokenValidator;
import org.apache.cxf.ws.security.sts.provider.SecurityTokenServiceProvider;

@WebServiceProvider(serviceName = "SecurityTokenService",
      portName = "UT_Port",
      targetNamespace = "http://docs.oasis-open.org/ws-sx/ws-trust/200512/",
      wsdlLocation = "WEB-INF/wsdl/ws-trust-1.4-service.wsdl")
//dependency on org.apache.cxf module or on module that exports org.apache.cxf (e.g. org.jboss.ws.cxf.jbossws-cxf-client) is needed, otherwise Apache CXF annotations are ignored
@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "mystskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value = "stsKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.sts.STSCallbackHandler"),
      @EndpointProperty(key = "ws-security.validate.token", value = "false") //to let the JAAS integration deal with validation through the interceptor below
})
@InInterceptors(interceptors = {"org.jboss.wsf.stack.cxf.security.authentication.SubjectCreatingPolicyInterceptor"})
public class SampleSTS extends SecurityTokenServiceProvider {
   public SampleSTS() throws Exception {
      super();

      StaticSTSProperties props = new StaticSTSProperties();
      props.setSignatureCryptoProperties("stsKeystore.properties");
      props.setSignatureUsername("mystskey");
      props.setCallbackHandlerClass(STSCallbackHandler.class.getName());
      props.setIssuer("DoubleItSTSIssuer");

      List&lt;ServiceMBean&gt; services = new LinkedList&lt;ServiceMBean&gt;();
      StaticService service = new StaticService();
      service.setEndpoints(Arrays.asList(
         "http://localhost:(\\d)*/jaxws-samples-wsse-policy-trust/SecurityService",
         "http://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust/SecurityService",
         "http://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust/SecurityService",

         "http://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-actas/ActAsService",
         "http://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-actas/ActAsService",
         "http://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-actas/ActAsService",

         "http://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService",
         "http://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService",
         "http://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService"
      ));
      services.add(service);

      TokenIssueOperation issueOperation = new TokenIssueOperation();
      issueOperation.setServices(services);
      issueOperation.getTokenProviders().add(new SAMLTokenProvider());
      // required for OnBehalfOf
      issueOperation.getTokenValidators().add(new UsernameTokenValidator());
      // added for OnBehalfOf and ActAs
      issueOperation.getDelegationHandlers().add(new UsernameTokenDelegationHandler());
      issueOperation.setStsProperties(props);

      TokenValidateOperation validateOperation = new TokenValidateOperation();
      validateOperation.getTokenValidators().add(new SAMLTokenValidator());
      validateOperation.setStsProperties(props);

      this.setIssueOperation(issueOperation);
      this.setValidateOperation(validateOperation);
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_STS_STSCallbackHandler"/>STSCallbackHandler Class</h4></div></div></div><p>
							The user, <code class="literal">alice</code>, and corresponding password was required to be added for the <code class="literal">ActAs</code> example.
						</p><pre class="programlisting">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.sts;

import java.util.HashMap;
import java.util.Map;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;

public class STSCallbackHandler extends PasswordCallbackHandler {
   public STSCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("mystskey", "stskpass");
      passwords.put("alice", "clarinet");
      return passwords;
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSR"/>Web Service Requester</h4></div></div></div><p>
							This section provides the details of the <code class="literal">ws-requester</code> elements from the basic WS-Trust scenario that have been changed to address the requirements of the <code class="literal">ActAs</code> example. The component is:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="link" href="reference_material.html#ActAs_ws_trust_scenario_WSR_implementation" title="Web Service Requester Implementation Class">ActAs Web Service Requester Implementation Class</a>
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ActAs_ws_trust_scenario_WSR_implementation"/>Web Service Requester Implementation Class</h4></div></div></div><p>
							The <code class="literal">ActAs</code> <code class="literal">ws-requester</code>, the client, uses standard procedures for creating a reference to the web service in the first four lines. To address the endpoint security requirements, the web service’s request context is configured using <code class="literal">BindingProvider</code> to provide information required for message generation. The <code class="literal">ActAs</code> user, <code class="literal">myactaskey</code>, is declared in this section and <code class="literal">UsernameTokenCallbackHandler</code> is used to provide the contents of the <code class="literal">ActAs</code> element to the <code class="literal">STSClient</code>. In this example an <code class="literal">STSClient</code> object is created and provided to the proxy’s request context. The alternative is to provide keys tagged with the <code class="literal">.it</code> suffix as was done in the Basic Scenario client. The use of <code class="literal">ActAs</code> is configured through the properties map using the <code class="literal">SecurityConstants.STS_TOKEN_ACT_AS</code> key. The alternative is to use the <code class="literal">STSClient.setActAs</code> method.
						</p><pre class="programlisting">final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy", "ActAsService");
final URL wsdlURL = new URL(serviceURL + "?wsdl");
Service service = Service.create(wsdlURL, serviceName);
ActAsServiceIface proxy = (ActAsServiceIface) service.getPort(ActAsServiceIface.class);

Bus bus = BusFactory.newInstance().createBus();
try {
    BusFactory.setThreadDefaultBus(bus);

    Map&lt;String, Object&gt; ctx = proxy.getRequestContext();

    ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myactaskey");
    ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myclientkey");

    // Generate the ActAs element contents and pass to the STSClient as a string
    UsernameTokenCallbackHandler ch = new UsernameTokenCallbackHandler();
    String str = ch.getUsernameTokenString("alice","clarinet");
    ctx.put(SecurityConstants.STS_TOKEN_ACT_AS, str);

    STSClient stsClient = new STSClient(bus);
    Map&lt;String, Object&gt; props = stsClient.getProperties();
    props.put(SecurityConstants.USERNAME, "bob");
    props.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    props.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
    props.put(SecurityConstants.STS_TOKEN_USERNAME, "myclientkey");
    props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

    ctx.put(SecurityConstants.STS_CLIENT, stsClient);
} finally {
    bus.shutdown(true);
}
proxy.sayHello();</pre><p>
							<br/><br/><br/><br/>
						</p><p>
							<span class="emphasis"><em><span class="right">Revised on 2019-05-02 08:52:40 UTC</span></em></span>
						</p></div></div></div></div></div></body></html>