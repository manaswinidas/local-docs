<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Additional Features</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="additional_features"/>Chapter 3. Additional Features</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="adding_form_login_as_fallback"/>Adding a FORM Login as a Fallback</h1></div></div></div><p>
				JBoss EAP and applications deployed to it can also configure a FORM login authentication mechanism to use as a fallback. This allows applications to present a login page for authentication in cases where Kerberos/SPNEGO tokens are not present. This authentication happens independent of the Kerberos authentication. As a result, depending on how the FORM login fallback is configured, users may require separate credentials to authenticate by this method.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The fallback to FORM login is available when no SPNEGO or NTLM tokens are present or, when a SPNEGO token is present, but from another KDC.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="update_your_application"/>Update Your Application</h2></div></div></div><p>
					The following steps are required to configure your application for FORM login as a fallback:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Configure JBoss EAP and the web application to use Kerberos and SPNEGO.
						</p><p class="simpara">
							See <a class="link" href="how_to_set_up_sso_for_jboss_eap_with_kerberos.html" title="Chapter 2. How to Set Up SSO for JBoss EAP with Kerberos">How to Set Up SSO for JBoss EAP with Kerberos</a> for the steps required to configure JBoss EAP and web applications to use Kerberos and SPNEGO for authentication and authorization. ⁠
						</p></li><li class="listitem"><p class="simpara">
							Add the login and error pages.
						</p><p class="simpara">
							To use FORM login, a login and error page are required. These files are added to web application and are used in the authentication process.
						</p><div class="title"><strong>Example: <code class="literal">login.jsp</code> File</strong></div><p>
								
</p><pre class="programlisting">&lt;html&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;form id="login_form" name="login_form" method="post" action="j_security_check" enctype="application/x-www-form-urlencoded"&gt;
      &lt;center&gt; &lt;p&gt;Please login to proceed.&lt;/p&gt; &lt;/center&gt;
      &lt;div style="margin-left: 15px;"&gt;
        &lt;p&gt; &lt;label for="username"&gt;Username&lt;/label&gt; &lt;br /&gt; &lt;input id="username" type="text" name="j_username"/&gt; &lt;/p&gt;
        &lt;p&gt; &lt;label for="password"&gt;Password&lt;/label&gt; &lt;br /&gt; &lt;input id="password" type="password" name="j_password" value=""/&gt; &lt;/p&gt;
        &lt;center&gt; &lt;input id="submit" type="submit" name="submit" value="Login"/&gt; &lt;/center&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre><p>

							</p><div class="title"><strong>Example: <code class="literal">error.jsp</code> File</strong></div><p>
								
</p><pre class="programlisting">&lt;html&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;Login failed, please go back and try again.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Modify the <code class="literal">web.xml</code>.
						</p><p class="simpara">
							After adding the login and error pages to the web application, the <code class="literal">web.xml</code> must be updated to use these files for FORM login. The <span class="emphasis"><em>exact</em></span> value <code class="literal">FORM</code> must be added to the <code class="literal">&lt;auth-method&gt;</code> element. Since <code class="literal">&lt;auth-method&gt;</code> expects a comma-separated list and order is significant, the <span class="emphasis"><em>exact</em></span> value for <code class="literal">&lt;auth-method&gt;</code> must be updated to <code class="literal">SPNEGO,FORM</code>. In addition, a <code class="literal">&lt;form-login-config&gt;</code> element must be added to <code class="literal">&lt;login-config&gt;</code> and the paths to the login and error pages specified as <code class="literal">&lt;form-login-page&gt;</code> and <code class="literal">&lt;form-error-page&gt;</code> elements.
						</p><div class="title"><strong>Example: Updated <code class="literal">web.xml</code> File</strong></div><p>
								
</p><pre class="programlisting">&lt;web-app&gt;
  &lt;display-name&gt;App1&lt;/display-name&gt;
  &lt;description&gt;App1&lt;/description&gt;
  &lt;!-- Define a security constraint that requires the Admin role to access resources --&gt;
  &lt;security-constraint&gt;
    &lt;display-name&gt;Security Constraint on Conversation&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;examplesWebApp&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;Admin&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;!-- Define the Login Configuration for this Application --&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;SPNEGO,FORM&lt;/auth-method&gt;
    &lt;realm-name&gt;SPNEGO&lt;/realm-name&gt;
    &lt;form-login-config&gt;
      &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
      &lt;form-error-page&gt;/error.jsp&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
  &lt;/login-config&gt;
  &lt;!-- Security roles referenced by this web application --&gt;
  &lt;security-role&gt;
    &lt;description&gt; role required to log in to the Application&lt;/description&gt;
    &lt;role-name&gt;Admin&lt;/role-name&gt;
  &lt;/security-role&gt;
&lt;/web-app&gt;</pre><p>

							</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="update_the_elytron_subsystem"/>Update the Elytron Subsystem</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Add a mechanism for <code class="literal">FORM</code> authentication in the <code class="literal">http-authentication-factory</code>.
						</p><p class="simpara">
							You can use the existing <code class="literal">http-authentication-factory</code> you configured for kerberos-based authentication and an additional mechanism for <code class="literal">FORM</code> authentication.
						</p><pre class="screen">/subsystem=elytron/http-authentication-factory=example-krb-http-auth:list-add(name=mechanism-configurations, value={mechanism-name=FORM})</pre></li><li class="listitem"><p class="simpara">
							Add additional fallback principals.
						</p><p class="simpara">
							The existing configuration for kerberos-based authentication should already have a security realm configured for mapping principals from kerberos token to roles for the application. You can add additional users for fallback authentication to that realm. For example if you used a <code class="literal">filesystem-realm</code>, you can simply create a new user with the appropriate roles:
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								<code class="literal">filesystem-realm</code> is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
							</p><p>
								See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
							</p></div><pre class="screen">/subsystem=elytron/filesystem-realm=exampleFsRealm:add-identity(identity=fallbackUser1)

/subsystem=elytron/filesystem-realm=exampleFsRealm:set-password(identity=fallbackUser1, clear={password="password123"})

/subsystem=elytron/filesystem-realm=exampleFsRealm:add-identity-attribute(identity=fallbackUser1, name=Roles, value=["Admin","Guest"])</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="update_the_legacy_security_subsystem"/>Update the Legacy Security Subsystem</h2></div></div></div><p>
					If you are using the legacy <code class="literal">security</code> subsystem in JBoss EAP, you must update the security domain for fallback authentication.
				</p><p>
					The web application security domain must be configured to support a fallback login mechanism. This requires the following steps:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Add a new security domain to serve as a fallback authentication method.
						</li><li class="listitem">
							Add a <code class="literal">usernamePasswordDomain</code> module option to the web application security domain that points to the fallback domain.
						</li></ol></div><div class="title"><strong>Example: Security Domain Configured with a Fallback Security Domain</strong></div><p>
						
</p><pre class="screen">/subsystem=security/security-domain=app-fallback:add(cache-type=default)

/subsystem=security/security-domain=app-fallback/authentication=classic:add()

/subsystem=security/security-domain=app-fallback/authentication=classic/login-module=UsersRoles:add(code=UsersRoles, flag=required, module-options=[usersProperties="file:${jboss.server.config.dir}/fallback-users.properties", rolesProperties="file:${jboss.server.config.dir}/fallback-roles.properties"])

/subsystem=security/security-domain=app-spnego/authentication=classic/login-module=SPNEGO:add(code=SPNEGO, flag=required, module-options=[serverSecurityDomain=host])

/subsystem=security/security-domain=app-spnego/authentication=classic/login-module=SPNEGO:map-put(name=module-options, key=usernamePasswordDomain, value=app-fallback)

/subsystem=security/security-domain=app-spnego/authentication=classic/login-module=SPNEGO:map-put(name=module-options, key=password-stacking, value=useFirstPass)

reload</pre><p>

					</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure-krb-management-interfaces"/>Securing the Management Interfaces with Kerberos</h1></div></div></div><p>
				In addition to providing Kerberos authentication in security domains, JBoss EAP also provides the ability to secure the management interfaces using Kerberos.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="secure_mgmt_interface_krb_elytron"/>Secure the Management Interfaces with Kerberos Using Elytron</h2></div></div></div><p>
					To configure Kerberos authentication for the HTTP management interface:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Follow the same instructions for <a class="link" href="how_to_set_up_sso_for_jboss_eap_with_kerberos.html#elytron_http_auth_app" title="Configure the Elytron Subsystem">configuring Kerberos authentication for applications</a> to create an <code class="literal">http-authentication-factory</code> that does Kerberos authentication.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								When configuring Kerberos authentication with the management interfaces, it is very important that you pay close attention to the service principal you configure for JBoss EAP to authenticate against the KDC. This service principal takes the form of <code class="literal">service-name/hostname</code>. JBoss EAP expects <code class="literal">HTTP</code> to be the service name, for example <code class="literal">HTTP/localhost</code>, when authenticating against the web-based management console and <code class="literal">remote</code> to be the service name, for example <code class="literal">remote/localhost</code>, for the management CLI.
							</p></div></li><li class="listitem"><p class="simpara">
							Update the management HTTP interface to use the <code class="literal">http-authentication-factory</code>.
						</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory, value=example-krb-http-auth)</pre></li></ol></div><p>
					To configure Kerberos authentication for SASL authentication for the management CLI:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Follow the same instructions for <a class="link" href="how_to_set_up_sso_for_jboss_eap_with_kerberos.html#elytron_http_auth_app" title="Configure the Elytron Subsystem">configuring Kerberos authentication for applications</a> to create a security domain and <code class="literal">kerberos-security-factory</code>.
						</li><li class="listitem"><p class="simpara">
							Add <code class="literal">GSSAPI</code> to the <code class="literal">configurable-sasl-server-factory</code>.
						</p><pre class="screen">/subsystem=elytron/configurable-sasl-server-factory=configured:list-add(name=filters, value={pattern-filter=GSSAPI})</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">sasl-authentication-factory</code> that uses the security domain and <code class="literal">kerberos-security-factory</code>.
						</p><div class="title"><strong>Example: <code class="literal">sasl-authentication-factory</code></strong></div><p>
								
</p><pre class="screen">/subsystem=elytron/sasl-authentication-factory=example-sasl-auth:add(sasl-server-factory=configured, security-domain=exampleFsSD, mechanism-configurations=[{mechanism-name=GSSAPI, mechanism-realm-configurations=[{realm-name=exampleFsSD}], credential-security-factory=krbSF}])</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Update the management SASL interface to use the <code class="literal">sasl-authentication-factory</code>.
						</p><div class="title"><strong>Example: Update <code class="literal">sasl-authentication-factory</code></strong></div><p>
								
</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade.sasl-authentication-factory, value=example-sasl-auth)

reload</pre><p>

							</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="secure_mgmt_interface_krb_legacy"/>Secure the Management Interfaces With Kerberos Using Legacy Core Management Authentication</h2></div></div></div><p>
					To enable Kerberos authentication on the management interfaces using legacy core management authentication, the following steps must be performed:
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The management CLI commands shown assume that you are running a JBoss EAP standalone server. For more details on using the management CLI for a JBoss EAP managed domain, see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/"><span class="emphasis"><em>Management CLI Guide</em></span></a>.
					</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Enable the relevant system properties.
						</p><p class="simpara">
							As discussed in a <a class="link" href="how_to_set_up_sso_for_jboss_eap_with_kerberos.html#configure_relevant_system_properties">previous section</a>, enable any needed JBoss EAP system properties for connecting to the Kerberos server.
						</p></li><li class="listitem"><p class="simpara">
							Add the Kerberos server identity to the security realm.
						</p><p class="simpara">
							Before Kerberos authentication can be used in a security realm, a connection to a Kerberos server must be added. The following example shows how to add a Kerberos server identity to the existing Management Realm. You will need to replace <code class="literal">service-name</code>, <code class="literal">hostname</code>, and <code class="literal">MY-REALM</code> with the appropriate values.
						</p><div class="title"><strong>Example CLI for Adding a Server Identity to a Security Realm</strong></div><p>
								
</p><pre class="screen">/core-service=management/security-realm=ManagementRealm/server-identity=kerberos:add()

/core-service=management/security-realm=ManagementRealm/server-identity=kerberos/keytab=service-name\/hostname@MY-REALM:add(path=/home\/username\/service.keytab, debug=true)

reload</pre><p>

							</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								When configuring Kerberos authentication with the management interfaces, it is very important that you pay close attention to the service principal you configure for JBoss EAP to authenticate against the KDC. This service principal takes the form of <code class="literal">service-name/hostname</code>. JBoss EAP expects <code class="literal">HTTP</code> to be the service name, for example <code class="literal">HTTP/localhost</code>, when authenticating against the web-based management console and <code class="literal">remote</code> to be the service name, for example <code class="literal">remote/localhost</code>, for the management CLI.
							</p></div></li><li class="listitem"><p class="simpara">
							Update the authentication method in the security realm.
						</p><p class="simpara">
							Once the Kerberos server identity has been properly configured, the authentication method in the security realm needs to be updated to use it.
						</p><div class="title"><strong>Example: Adding Kerberos Authentication to a Security Realm</strong></div><p>
								
</p><pre class="screen">/core-service=management/security-realm=ManagementRealm/authentication=kerberos:add()

reload</pre><p>

							</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								Based on the order in which you have the authentication mechanisms defined in the security realm, JBoss EAP will attempt to authenticate the user in that order when accessing the management interfaces.
							</p></div></li><li class="listitem"><p class="simpara">
							Secure both interfaces with Kerberos.
						</p><p class="simpara">
							In cases where you would like to secure both the web-based management console and management CLI with Kerberos, you need a Kerberos server identity configured for each. To add an additional identity, use the following command.
						</p><pre class="screen">/core-service=management/security-realm=ManagementRealm/server-identity=kerberos/keytab=remote\/hostname@MY-REALM:add(path=/home\/username\/remote.keytab, debug=true)

reload</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="connecting_to_the_management_interface"/>Connecting to the Management Interface</h2></div></div></div><p>
					Before attempting to connect to the management interfaces, you need to have a valid Kerberos ticket. If the security realm fails to authenticate a user via Kerberos, when using the legacy security solution, it will attempt to authenticate the user using any of the subsequent methods specified in the <code class="literal">&lt;authentication&gt;</code> element. The <code class="literal">elytron</code> subsystem behaves similar to the legacy security solution. If the Kerberos authentication mechanism fails, authentication falls back to any other mechanism that you have defined in the authentication factory that is protecting the management interface. Usually, DIGEST or BASIC is used as a fallback.
				</p><p>
					When you connect to the web-based management console using a browser, the security realm will attempt to authenticate you based on that ticket.
				</p><p>
					When connecting to the management CLI, you will need to use the <code class="literal">-Djavax.security.auth.useSubjectCredsOnly=false</code> parameter, as this allows the GSSAPI implementation to make use of the identity managed at the operating system level. You may also need to use the following parameters based on how your environment is set up:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-Djava.security.krb5.realm=<span class="emphasis"><em>REALM_NAME</em></span></span></dt><dd>
								Specifies the realm name.
							</dd><dt><span class="term">-Djava.security.krb5.kdc=<span class="emphasis"><em>KDC_HOSTNAME</em></span></span></dt><dd>
								Specifies the location of the KDC.
							</dd><dt><span class="term">--no-local-auth</span></dt><dd>
								Disables local authentication. This is useful if you are attempting to connect to a JBoss EAP instance running on the same machine you are running the script from.
							</dd></dl></div><div class="title"><strong>Example Command</strong></div><p>
						
</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh -c -Djavax.security.auth.useSubjectCredsOnly=false --no-local-auth</pre><p>

					</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						If an HTTP proxy is used between the client and server, it must take care to not share authenticated connections between different authenticated clients to the same server. If this is not honored, then the server can easily lose track of security context associations. A proxy that correctly honors client to server authentication integrity will supply the <code class="literal">Proxy-support: Session- Based-Authentication</code> HTTP header to the client in HTTP responses from the proxy. The client must <span class="emphasis"><em>not</em></span> utilize the SPNEGO HTTP authentication mechanism through a proxy unless the proxy supplies this header with the <code class="literal">401 Unauthorized</code> response from the server.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure-krb-remoting"/>Kerberos Authentication Integration for Remoting</h1></div></div></div><p>
				In addition to using Kerberos for securing the management interfaces and web applications, you can also configure Kerberos authentication for services accessed via remoting, such as EJBs.
			</p><p>
				System properties for Kerberos also need to be configured. For more information, see <a class="link" href="how_to_set_up_sso_for_jboss_eap_with_kerberos.html#elytron_http_auth_app" title="Configure the Elytron Subsystem">Configure the Elytron Subsystem</a>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos_authentication_integration_using_legacy_security_realms"/>Kerberos Authentication Integration Using Legacy Security Realms</h2></div></div></div><p>
					To configure Kerberos authentication, you will need to do the following:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Configure a security domain with remoting and <code class="literal">RealmDirect</code>
						</p><p class="simpara">
							You need to configure a security domain for use by the service that is accessed by remoting. This security domain needs to make use of both the <code class="literal">Remoting</code> login module as well as a <code class="literal">RealmDirect</code> login module, such as <code class="literal">RealmDirect</code> or <code class="literal">RealmUsersRoles</code>. Essentially, it should look very similar to the <code class="literal">other</code> security domain provided by default. For more details on the specific configuration options of each login module, see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/"><span class="emphasis"><em>Login Module Reference</em></span></a>.
						</p><div class="title"><strong>Example: Security Domain with Remoting and RealmDirect Login Modules</strong></div><p>
								
</p><pre class="screen">/subsystem=security/security-domain=krb-remoting-domain:add()

/subsystem=security/security-domain=krb-remoting-domain/authentication=classic:add()

/subsystem=security/security-domain=krb-remoting-domain/authentication=classic/login-module=Remoting:add(code=Remoting, flag=optional, module-options=[password-stacking=useFirstPass])

/subsystem=security/security-domain=krb-remoting-domain/authentication=classic/login-module=RealmDirect:add(code=RealmDirect, flag=required, module-options=[password-stacking=useFirstPass, realm=krbRealm])

/subsystem=security/security-domain=krb-remoting-domain/mapping=classic:add()

/subsystem=security/security-domain=krb-remoting-domain/mapping=classic/mapping-module=SimpleRoles:add(code=SimpleRoles, type=role, module-options=["testUser"="testRole"])

reload</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure a security realm for Kerberos authentication.
						</p><p class="simpara">
							Setting up a security realm with Kerberos authentication is covered in the <a class="link" href="additional_features.html#configure-krb-management-interfaces" title="Securing the Management Interfaces with Kerberos">Securing the Management Interfaces with Kerberos</a> section.
						</p><div class="title"><strong>Example: Security Realm</strong></div><p>
								
</p><pre class="screen">/core-service=management/security-realm=krbRealm:add()

/core-service=management/security-realm=krbRealm/server-identity=kerberos:add()

/core-service=management/security-realm=krbRealm/server-identity=kerberos/keytab=remote\/localhost@JBOSS.ORG:add(path=\/path\/to\/remote.keytab, debug=true)

/core-service=management/security-realm=krbRealm/authentication=kerberos:add(remove-realm=true)

reload</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure the HTTP connector in the <code class="literal">remoting</code> subsystem.
						</p><p class="simpara">
							In addition, you will need to configure the HTTP connector in the <code class="literal">remoting</code> subsystem to use the newly created security realm.
						</p><div class="title"><strong>Example: Remoting Subsystem</strong></div><p>
								
</p><pre class="screen">/subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=security-realm, value=krbRealm)</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure security for the service.
						</p><p class="simpara">
							You must also set up the service that is accessed using the remoting interface to <code class="literal">secured</code>. This will vary depending on the service. For example, with an EJB, you can use the <a class="link" href="https://access.redhat.com/webassets/avalon/d/red_hat_jboss_enterprise_application_platform/7.2/javadocs/org/jboss/ejb3/annotation/SecurityDomain.html"><code class="literal">@SecurityDomain</code></a> and <a class="link" href="http://docs.oracle.com/javaee/7/api/javax/annotation/security/RolesAllowed.html"><code class="literal">@RolesAllowed</code></a> annotations.
						</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kerberos_authentication_integration_using_elytron"/>Kerberos Authentication Integration Using Elytron</h2></div></div></div><p>
					It is possible to define an Elytron security domain for Kerberos or GSSAPI SASL authentication for remoting authentication.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Define the security realm to load the identity from. It is used for assigning roles.
						</p><pre class="screen">/path=kerberos:add(relative-to=user.home, path=src/kerberos)

/subsystem=elytron/properties-realm=kerberos-properties:add(users-properties={path=kerberos-users.properties, relative-to=kerberos, digest-realm-name=ELYTRON.ORG}, groups-properties={path=kerberos-groups.properties, relative-to=kerberos})</pre></li><li class="listitem"><p class="simpara">
							Define the Kerberos security factory for the server’s identity.
						</p><pre class="screen">/subsystem=elytron/kerberos-security-factory=test-server:add(relative-to=kerberos, path=remote-test-server.keytab, principal=remote/test-server.elytron.org@ELYTRON.ORG)</pre></li><li class="listitem"><p class="simpara">
							Define the security domain and along with it, a SASL authentication factory.
						</p><pre class="screen">/subsystem=elytron/security-domain=KerberosDomain:add(default-realm=kerberos-properties, realms=[{realm=kerberos-properties, role-decoder=groups-to-roles}], permission-mapper=default-permission-mapper)

/subsystem=elytron/sasl-authentication-factory=gssapi-authentication-factory:add(security-domain=KerberosDomain, sasl-server-factory=elytron, mechanism-configurations=[{mechanism-name=GSSAPI, credential-security-factory=test-server}])</pre></li><li class="listitem"><p class="simpara">
							Use the created <code class="literal">sasl-authentication-factory</code>, in the <code class="literal">remoting</code> subsystem, to enable it for remoting.
						</p><div class="title"><strong>Example CLI Command</strong></div><p>
								
</p><pre class="screen">/subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=sasl-authentication-factory, value=gssapi-authentication-factory)</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure security for the service.
						</p><p class="simpara">
							If you reference the security domain in an EJB, you must specify the <code class="literal">application-security-domain</code> that maps to the Elytron security domain. For example, with an EJB, you can use the <a class="link" href="https://access.redhat.com/webassets/avalon/d/red_hat_jboss_enterprise_application_platform/7.2/javadocs/org/jboss/ejb3/annotation/SecurityDomain.html"><code class="literal">@SecurityDomain</code></a> annotation.
						</p><div class="title"><strong>Example CLI Command</strong></div><p>
								
</p><pre class="screen">/subsystem=ejb3/application-security-domain=KerberosDomain:add(security-domain=KerberosDomain)</pre><p>

							</p></li></ol></div><p>
					With the new JBoss EAP 7.1 EJB client, the use of a JAAS Subject for identity association is no longer supported. Clients wishing to programmatically manage the Kerberos identity for an EJB call should migrate and use the <code class="literal">AuthenticationConfiguration</code> APIs directly, as follows:
				</p><pre class="programlisting">// create your authentication configuration
AuthenticationConfiguration configuration = AuthenticationConfiguration.empty()
    .useProvidersFromClassLoader(SecuredGSSCredentialClient.class.getClassLoader())
    .useGSSCredential(getGSSCredential());

// create your authentication context
AuthenticationContext context = AuthenticationContext.empty().with(MatchRule.ALL, configuration);

// create a callable that looks up an EJB and invokes a method on it
Callable&lt;Void&gt; callable = () -&gt; {
...
};

// use your authentication context to run your callable
context.runCallable(callable);</pre><p>
					The call to <code class="literal">useGSSCredential(getGSSCredential())</code> happens when creating the <code class="literal">AuthenticationConfiguration</code>. Client code that already has access to a JAAS Subject can easily be converted to obtain the <code class="literal">GSSCredential</code> as follows:
				</p><pre class="programlisting">private GSSCredential getGSSCredential() {
    return Subject.doAs(subject, new PrivilegedAction&lt;GSSCredential&gt;() {

        public GSSCredential run() {
            try {
                GSSManager gssManager = GSSManager.getInstance();
                return gssManager.createCredential(GSSCredential.INITIATE_ONLY);
            } catch (Exception e) {
                e.printStackTrace();
            }
            return null;
        }
    });
}</pre><p>
					<br/><br/><br/><br/>
				</p><p>
					<span class="emphasis"><em><span class="right">Revised on 2019-05-02 08:53:43 UTC</span></em></span>
				</p></div></div></div></body></html>