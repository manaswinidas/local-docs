<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Securely Storing Credentials</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="securely_storing_credentials"/>Chapter 3. Securely Storing Credentials</h1></div></div></div><p>
			JBoss EAP allows the encryption of sensitive strings outside of configuration files. These strings can be stored in a keystore, and subsequently decrypted for applications and verifications systems. Sensitive strings can be stored in either of the following:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					<a class="link" href="securely_storing_credentials.html#credential_store" title="Credential Store">Credential Store</a> - Introduced in JBoss EAP 7.1, a credential store can safely secure sensitive and plain text strings by encrypting them in a storage file. Each JBoss EAP server can contain multiple credential stores.
				</li><li class="listitem">
					<a class="link" href="securely_storing_credentials.html#password_vault" title="Password Vault">Password Vault</a> - Primarily used in legacy configurations, a password vault uses a Java Keystore to store sensitive strings outside of the configuration files. Each JBoss EAP server can only contain a single password vault.
				</li></ul></div><p>
			All of the configuration files in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/</code> and <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/domain/configuration/</code> are world readable by default. It is strongly recommended to not store plaintext passwords in the configuration files, and instead place these credentials in either a <a class="link" href="securely_storing_credentials.html#credential_store" title="Credential Store">credential store</a> or <a class="link" href="securely_storing_credentials.html#password_vault" title="Password Vault">password vault</a>.
		</p><p>
			If you decide to place plaintext passwords in the configuration files, then these files should only be accessible by limited users. At a minimum, the user account under which JBoss EAP 7 is running requires read-write access.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="credential_store"/>Credential Store</h1></div></div></div><p>
				Introduced with the <code class="literal">elytron</code> subsystem, credential stores allow for secure storage and usage of credentials. You can find more background information on credential stores as well as other Elytron components in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#elytron_core_concepts_components">Core Concepts and Components</a> section of the <span class="emphasis"><em>Security Architecture</em></span> guide.
			</p><p>
				Using a credential store is preferred to using a <a class="link" href="securely_storing_credentials.html#password_vault" title="Password Vault">password vault</a> to store passwords and other sensitive strings. Credential stores allow for easier credential management within the JBoss EAP management CLI, without having to use an external tool. You can also use multiple credential stores within a JBoss EAP server, compared to the limitation of only one password vault per JBoss EAP server.
			</p><p>
				The default credential store implementation uses a JCEKS keystore file to store credentials. When creating a new credential store, the default implementation also allows you to reference an existing keystore file or have JBoss EAP automatically create one for you. Currently, the default implementation only allows you to store clear text passwords.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					The <code class="literal">elytron</code> subsystem does not provide any checks for using the same file as storage to multiple credential stores. It is strongly advised not to use the same file for multiple credential stores or even to share the storage file using remote file systems.
				</p><p>
					If you need to use shared storage file, be sure to set the <code class="literal">read-only</code> flag on the credential stores accessing it. This will prevent the file from being modified. After the file is updated from outside, each credential store has to be reloaded to reflect the changed values. A similar process needs to be followed when using credential stores in a managed domain.
				</p><p>
					Since a credential store contains sensitive information, the directory containing the store should be accessible to only limited users. At a minimum the user account under which JBoss EAP is running requires read-write access.
				</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					JBoss EAP reads the credential store file into memory and writes changes to it at varying times. You must ensure that the user running the JBoss EAP process has permissions to the store file, and that you do not externally modify the store file while JBoss EAP is running.
				</p><p>
					If the file is modified externally, you can use the <code class="literal">reload()</code> operation on the credential store to make JBoss EAP reload the content of the store file.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_create"/>Create a Credential Store</h2></div></div></div><p>
					To create a credential store, you must define a path to the new credential store file, and provide a master password that is used to encrypt the credential store. The directory containing the store should be accessible to only limited users. At a minimum the user account under which JBoss EAP is running requires read-write access.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						JCEKS keystore implementations differ between Java vendors, so the JBoss EAP instance must run a JDK from the same vendor that generated the JCEKS keystore.
					</p></div><p>
					Like providing paths in other JBoss EAP configuration, you can also use the <code class="literal">relative-to</code> attribute to provide a path relative to another.
				</p><h4><a id="create_a_credential_store_for_a_standalone_server"/>Create a Credential Store for a Standalone Server</h4><p>
					Use the following management CLI command to create a new credential store:
				</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:add(location="<span class="emphasis"><em>path/to/store_file</em></span>", credential-reference={clear-text=<span class="emphasis"><em>STORE_PASSWORD</em></span>},create=true)</pre><p>
					For example, the following command creates a new store named <code class="literal">my_store</code>, and creates the file <code class="literal">jboss.server.data.dir/cred_stores/my_store.jceks</code>:
				</p><pre class="screen">/subsystem=elytron/credential-store=my_store:add(location="cred_stores/my_store.jceks", relative-to=jboss.server.data.dir,  credential-reference={clear-text=supersecretstorepassword},create=true)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If you want to use an implementation other than <code class="literal">default</code>, you can explicitly define the type of a credential store. For more information, see the section on <a class="link" href="securely_storing_credentials.html#cred_store_custom_implementation" title="Use a Custom Implementation of the Credential Store">using a custom credential store implementation</a>.
					</p></div><h4><a id="creating_credential_store_in_managed_domain"/>Create a Credential Store in a Managed Domain</h4><p>
					Use the following management CLI command to create a new credential store in a managed domain:
				</p><pre class="screen">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span>/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:add(location=<span class="emphasis"><em>path/to/store_file</em></span>,credential-reference={clear-text="<span class="emphasis"><em>STORE_PASSWORD</em></span>"},create=true)</pre><p>
					For example, the following command creates a new store named <code class="literal">my_store</code>, and creates the file <code class="literal">jboss.server.data.dir/cred_stores/my_store.jceks</code>:
				</p><pre class="screen">/profile=full/subsystem=elytron/credential-store=my_store:add(relative-to=jboss.server.data.dir,location="cred_stores/my_store.jceks",credential-reference={clear-text=supersecretstorepassword},create=true)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						There is no need to define a credential store resource at each server. Every server running the same profile, for which the credential store is created, contains our credential store. Therefore, it is good idea to locate the storage file at the server data directory, <code class="literal">relative-to=jboss.server.data.dir</code>.
					</p></div><p>
					For another way of creating a credential store in a managed domain, see <a class="link" href="securely_storing_credentials.html#credential_store_in_managed_domain" title="Using Credential Stores in a Managed Domain">Using Credential Stores in a Managed Domain</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_add"/>Add a Credential to the Credential Store</h2></div></div></div><p>
					To add a new credential to a credential store, you associate an alias to the sensitive string that you are wanting to store.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Credential store aliases are case insensitive by default. Any stored alias is displayed in lowercase, and may be referenced using any combination of uppercase and lowercase letters.
					</p><p>
						If a <a class="link" href="securely_storing_credentials.html#cred_store_custom_implementation" title="Use a Custom Implementation of the Credential Store">custom credential store</a> is used, then case sensitivity will be determined by the custom implementation.
					</p></div><p>
					The following management CLI command adds a credential to a credential store:
				</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:add-alias(alias=<span class="emphasis"><em>ALIAS</em></span>, secret-value="<span class="emphasis"><em>SENSITIVE_STRING</em></span>")</pre><p>
					For example, to add a password with the alias <code class="literal">database-pw</code> to the store created in the <a class="link" href="securely_storing_credentials.html#cred_store_create" title="Create a Credential Store">previous section</a>:
				</p><pre class="screen">/subsystem=elytron/credential-store=my_store:add-alias(alias=database-pw, secret-value="speci@l_db_pa$$_01")</pre><h4><a id="editing_credential_store_aliases_using_the_management_console"/>Editing Credential Store Aliases Using the Management Console</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Log in to the management console and click on the <span class="strong"><strong>Runtime</strong></span> tab.
						</li><li class="listitem">
							Select the server and select <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Stores</strong></span> and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select the credential store and click <span class="strong"><strong>Aliases</strong></span> to edit the aliases.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_use"/>Use a Stored Credential in a Configuration</h2></div></div></div><p>
					To refer to a password or sensitive string stored in a credential store, use the <code class="literal">credential-reference</code> attribute in your JBoss EAP configuration. You can use <code class="literal">credential-reference</code> as an alternative to providing a password or other sensitive string in most places throughout the JBoss EAP configuration.
				</p><pre class="screen">credential-reference={store=<span class="emphasis"><em>STORE_NAME</em></span>, alias=<span class="emphasis"><em>ALIAS</em></span>}</pre><p>
					For example, to create a new datasource using the password that was added to the credential store in the <a class="link" href="securely_storing_credentials.html#cred_store_add" title="Add a Credential to the Credential Store">previous example</a>, you can use <code class="literal">credential-reference</code> like the following:
				</p><pre class="screen">data-source add --name=my_DS --jndi-name=java:/my_DS --driver-name=h2 --connection-url=jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE --user-name=db_user --credential-reference={store=my_store, alias=database-pw}</pre><p>
					In the above example, instead of providing a password using <code class="literal">--password</code>, a <code class="literal">credential-reference</code> including a store name and alias is provided. If you check the resulting datasource configuration, note that <code class="literal">password</code> is undefined and the <code class="literal">credential-reference</code> attribute is defined instead.
				</p><pre class="screen">/subsystem=datasources/data-source=my_DS:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        ...
        "credential-reference" =&gt; {
            "store" =&gt; "my_store",
            "alias" =&gt; "database-pw"
        },
        ...
        "password" =&gt; undefined,
        ...
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_list"/>List the Credentials in the Credential Store</h2></div></div></div><p>
					You can list the aliases of all the credentials contained in a credential store using the following management CLI command:
				</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:read-aliases()</pre><p>
					For example:
				</p><pre class="screen">/subsystem=elytron/credential-store=my_store:read-aliases()
{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "database-pw"
    ]
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_remove"/>Remove a Credential from the Credential Store</h2></div></div></div><p>
					You can remove a credential from a credential store using the following command:
				</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:remove-alias(alias=<span class="emphasis"><em>ALIAS</em></span>)</pre><p>
					For example:
				</p><pre class="screen">/subsystem=elytron/credential-store=my_store:remove-alias(alias=database-pw)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="obtain_the_master_password_for_the_credential_store_from_an_external_source"/>Obtain the Master Password for the Credential Store from an External Source</h2></div></div></div><p>
					Instead of providing your credential store’s master password in the clear, you can choose to provide that password using a pseudo credential store. You have the following options:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">EXT</span></dt><dd><p class="simpara">
								External command using <code class="literal">java.lang.Runtime#exec(java.lang.String)</code>. If parameters are needed, they are supplied using a space-separated list of strings. An external command refers to any executable from the operation system, for example a shell script or an executable binary. The password is read from the standard output of the executed command.
							</p><div class="title"><strong>Example</strong></div><p>
									
</p><pre class="screen">{EXT}/usr/bin/getTheMasterPassswordScript.sh par1 par2</pre><p>

								</p></dd><dt><span class="term">CMD</span></dt><dd><p class="simpara">
								External command using <code class="literal">java.lang.ProcessBuilder</code>. If parameters are needed, they are supplied using a comma-separated list of strings. An external command refers to any executable from the operation system, for example a shell script or an executable binary. The password is read from the standard output of the executed command.
							</p><div class="title"><strong>Example</strong></div><p>
									
</p><pre class="screen">{CMD}/usr/bin/getTheMasterPassswordScript.sh par1,par2</pre><p>

								</p></dd><dt><span class="term">MASK</span></dt><dd><p class="simpara">
								Masked password using PBE, or Password Based Encryption. It must be in the following format, which includes the <code class="literal">SALT</code> and <code class="literal">ITERATION</code> values:
							</p><pre class="screen">MASK-<span class="emphasis"><em>MASKED_VALUE</em></span>;<span class="emphasis"><em>SALT</em></span>;<span class="emphasis"><em>ITERATION</em></span></pre><div class="title"><strong>Example</strong></div><p>
									
</p><pre class="screen">MASK-NqMznhSbL3lwRpDmyuqLBW==;12345678;123</pre><p>

								</p></dd></dl></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						<code class="literal">EXT</code>, <code class="literal">CMD</code>, and <code class="literal">MASK</code> provide backward compatibility with the legacy security vault style of supplying an external password. For <code class="literal">MASK</code> you must use the above format that includes the <code class="literal">SALT</code> and <code class="literal">ITERATION</code> values.
					</p></div><p>
					You can also use a password located in another credential store as the master password for a new credential store.
				</p><div class="title"><strong>Example Credential Store Created with a Password from Another Credential Store</strong></div><p>
						
</p><pre class="screen">/subsystem=elytron/credential-store=exampleCS:add(location="cred_stores/exampleCS.jceks", relative-to=jboss.server.data.dir, create=true, credential-reference={store=master-cred-store, alias=master-pw})</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_cred_store_fips_header"/>Define a FIPS 140-2 Compliant Credential Store</h2></div></div></div><p>
					A FIPS 140-2 compliant credential store may be defined using either of the following methods.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="securely_storing_credentials.html#credential_store_fips" title="Define a FIPS 140-2 Compliant Credential Store Using an NSS Database">Using an NSS Database</a>
						</li><li class="listitem">
							<a class="link" href="securely_storing_credentials.html#credential_store_fips_bouncycastle" title="Define a FIPS 140-2 Compliant Credential Store Using the BouncyCastle Providers">Using the BouncyCastle Providers</a>
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="credential_store_fips"/>Define a FIPS 140-2 Compliant Credential Store Using an NSS Database</h3></div></div></div><p>
						To obtain a FIPS compliant keystore, use a Sun PKCS#11 provider accessing an NSS database. Instructions on defining the database are found at <a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_nss_database" title="Configuring the NSS database">Configuring the NSS Database</a>.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create a secret key to be used in the credential store.
							</p><pre class="screen">$ keytool -keystore NONE -storetype PKCS11 -storepass <span class="emphasis"><em>STORE_PASSWORD</em></span> -genseckey -alias <span class="emphasis"><em>ALIAS</em></span> -keyalg AES -keysize 256</pre></li><li class="listitem"><p class="simpara">
								Create an external credential store. An external credential store holds a secret key in a PKCS#11 keystore, and accesses this keystore using the alias defined in the previous step. This keystore is then used to decrypt the credentials in a JCEKS keystore. In addition to the <a class="link" href="reference_material.html#credential_store_attributes" title="Table A.27. credential-store Attributes"><code class="literal">credential-store</code> attributes</a>, the <a class="link" href="reference_material.html#credential_store_implementation_properties" title="Table A.29. credential-store KeyStoreCredentialStore implementation properties"><code class="literal">credential-store</code> <code class="literal">KeyStoreCredentialStore</code> implementation properties</a> are used to configure external credential stores.
							</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:add(modifiable=true, implementation-properties={"keyStoreType"=&gt;"PKCS11","external"=&gt;"true","keyAlias"=&gt;"<span class="emphasis"><em>ALIAS</em></span>", externalPath="<span class="emphasis"><em>/path/to/EXTERNAL_STORAGE</em></span>"},credential-reference={clear-text="<span class="emphasis"><em>STORE_PASSWORD</em></span>"}, create=true)</pre></li><li class="listitem"><p class="simpara">
								Once created, the credential store can be used to store aliases as normal.
							</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:add-alias(alias="<span class="emphasis"><em>ALIAS</em></span>", secret-value="<span class="emphasis"><em>SENSITIVE_STRING</em></span>")</pre></li><li class="listitem"><p class="simpara">
								Confirm that the alias has been added successfully by reading from the credential store.
							</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:read-aliases()</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="credential_store_fips_bouncycastle"/>Define a FIPS 140-2 Compliant Credential Store Using the <code class="literal">BouncyCastle</code> Providers</h3></div></div></div><p>
						The following instructions outline how you can use a <code class="literal">BouncyCastle</code> provider to obtain a FIPS compliant keystore.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Ensure your your environment is <a class="link" href="reference_material.html#configure_java_bouncycastle_provider" title="Configure Your Environment to use the BouncyCastle Provider">configured to use the <code class="literal">BouncyCastle</code> provider</a>.
							</li><li class="listitem"><p class="simpara">
								Create a secret key to be used in the credential store.
							</p><pre class="screen">$ keytool -genseckey -alias <span class="emphasis"><em>KEY_ALIAS</em></span> -keyalg AES -keysize 128 -keystore <span class="emphasis"><em>KEYSTORE</em></span> -storetype BCFKS -storepass <span class="emphasis"><em>PASSWORD</em></span> -keypass <span class="emphasis"><em>PASSWORD</em></span></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									The <code class="literal">keypass</code> and <code class="literal">storepass</code> for the keystore must be identical for FIPS credential stores to be defined in the <code class="literal">elytron</code> subsystem.
								</p></div></li><li class="listitem"><p class="simpara">
								Create an external credential store. An external credential store holds a secret key in a BCFKS keystore, and accesses this keystore using the alias defined in the previous step. This keystore is then used to decrypt the credentials in a JCEKS keystore. The <a class="link" href="reference_material.html#credential_store_implementation_properties" title="Table A.29. credential-store KeyStoreCredentialStore implementation properties"><code class="literal">credential-store</code> <code class="literal">KeyStoreCredentialStore</code> implementation properties</a> are used to configure external credential stores.
							</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>BCFKS_CREDENTIAL_STORE</em></span>:add(relative-to=jboss.server.config.dir,credential-reference={clear-text=<span class="emphasis"><em>PASSWORD</em></span>},implementation-properties={keyAlias=<span class="emphasis"><em>KEY_ALIAS</em></span>,external=true,externalPath=<span class="emphasis"><em>CREDENTIAL_STORE</em></span>,keyStoreType=BCFKS},create=true,location=<span class="emphasis"><em>KEYSTORE</em></span>,modifiable=true)</pre></li><li class="listitem"><p class="simpara">
								Once created, the credential store can be used to store aliases as normal.
							</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>BCFKS_CREDENTIAL_STORE</em></span>:add-alias(alias="<span class="emphasis"><em>ALIAS</em></span>", secret-value="<span class="emphasis"><em>SENSITIVE_STRING</em></span>")</pre></li><li class="listitem"><p class="simpara">
								Confirm that the alias has been added successfully by reading from the credential store.
							</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>BCFKS_CREDENTIAL_STORE</em></span>:read-aliases()</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_custom_implementation"/>Use a Custom Implementation of the Credential Store</h2></div></div></div><p>
					To use a custom implementation of the credential store:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Create a class that extends the Service Provider Interface (SPI) <code class="literal">CredentialStoreSpi</code> abstract class.
						</li><li class="listitem">
							Create a class that implements the Java Security <code class="literal">Provider</code>. The provider must add the custom credential store class as a service.
						</li><li class="listitem"><p class="simpara">
							Create a module containing your credential store and provider classes, and add it to JBoss EAP with a dependency on <code class="literal">org.wildfly.security.elytron</code>. For example:
						</p><pre class="screen">module add --name=org.jboss.customcredstore --resources=/path/to/customcredstoreprovider.jar --dependencies=org.wildfly.security.elytron --slot=main</pre></li><li class="listitem"><p class="simpara">
							Create a provider loader for your provider. For example:
						</p><pre class="screen">/subsystem=elytron/provider-loader=myCustomLoader:add(class-names=[org.wildfly.security.mycustomcredstore.CustomElytronProvider],module=org.jboss.customcredstore)</pre></li><li class="listitem"><p class="simpara">
							Create a credential store using the custom implementation.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Ensure that you specify the correct <code class="literal">providers</code> and <code class="literal">type</code> values. The value of <code class="literal">type</code> is what is used in your provider class where it adds your custom credential store class as a service.
							</p></div><p class="simpara">
							For example:
						</p><pre class="screen">/subsystem=elytron/credential-store=my_store:add(providers=myCustomLoader,type=CustomKeyStorePasswordStore,location="cred_stores/my_store.jceks",relative-to=jboss.server.data.dir,credential-reference={clear-text=supersecretstorepassword},create=true)</pre><p class="simpara">
							Alternatively, if you have created multiple providers, you can specify the additional providers using another provider loader with <code class="literal">other-providers</code>. This allows you to have other additional implementations for new types of credentials. These specified other providers are automatically accessible in the custom credential store’s <code class="literal">initialize</code> method as the <code class="literal">Provider[]</code> argument. For example:
						</p><pre class="screen">/subsystem=elytron/credential-store=my_store:add(providers=myCustomLoader,other-providers=myCustomLoader2,type=CustomKeyStorePasswordStore,location="cred_stores/my_store.jceks",relative-to=jboss.server.data.dir,credential-reference={clear-text=supersecretstorepassword},create=true)</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_elytron_tool"/>Create and Modify Credential Stores Offline with the WildFly Elytron Tool</h2></div></div></div><p>
					You can use the WildFly Elytron tool, which you access using the <code class="literal">elytron-tool</code> script located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code>, to create and modify a credential store for an offline, or stopped, JBoss EAP server.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						JCEKS keystore implementations differ between Java vendors, so the JBoss EAP instance must run a JDK from the same vendor that generated the JCEKS keystore.
					</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Using the WildFly Elytron tool to modify a credential store that is in use by a running JBoss EAP server can result in changes to the store being lost. Instead, you should create and modify credential stores for a running server by using the management CLI, as <a class="link" href="securely_storing_credentials.html#cred_store_create" title="Create a Credential Store">described in the previous sections</a>.
					</p></div><p>
					The following commands are shown using <code class="literal">elytron-tool.sh</code> for Red Hat Enterprise Linux and Solaris systems. For Windows Server systems, use the <code class="literal">elytron-tool.bat</code> script instead.
				</p><div class="title"><strong>Create a Credential Store Using the WildFly Elytron Tool</strong></div><p>
						Create a credential store using the WildFly Elytron tool with the following command:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --create --location "<span class="emphasis"><em>path/to/store_file</em></span>" --password <span class="emphasis"><em>STORE_PASSWORD</em></span></pre><p>
					For example:
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --create --location "../cred_stores/my_store.jceks" --password supersecretstorepassword</pre><p>
					If you do not want to provide your store password in the command, you can omit that argument and you will be prompted to enter the password manually using standard input. You can also use a <a class="link" href="securely_storing_credentials.html#elytron_tool_mask" title="Generate Masked Encrypted Strings Using the WildFly Elytron Tool">masked password generated by the WildFly Elytron tool</a> for the store password.
				</p><div class="title"><strong>Create a Credential Store Using the <code class="literal">BouncyCastle</code> Provider with the WildFly Elytron Tool</strong></div><p>
						The following procedure outlines how to create a credential store using the WildFly Elytron tool.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Ensure your environment is <a class="link" href="reference_material.html#configure_java_bouncycastle_provider" title="Configure Your Environment to use the BouncyCastle Provider">configured to use the <code class="literal">BouncyCastle</code> provider</a>.
						</li><li class="listitem"><p class="simpara">
							Define a <code class="literal">BCFKS</code> keystore. If this keystore already exists, proceed to the next step.
						</p><pre class="screen">$ keytool -genkeypair -alias <span class="emphasis"><em>ALIAS</em></span> -keyalg RSA -keysize 2048 -keypass <span class="emphasis"><em>PASSWORD</em></span> -keystore <span class="emphasis"><em>KEYSTORE</em></span> -storetype BCFKS -storepass <span class="emphasis"><em>PASSWORD</em></span></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								The <code class="literal">keypass</code> and <code class="literal">storepass</code> for the keystore must be identical for FIPS credential stores to be defined in the <code class="literal">elytron</code> subsystem.
							</p></div></li><li class="listitem"><p class="simpara">
							Generate a secret key for the credential store.
						</p><pre class="screen">$ keytool -genseckey -alias <span class="emphasis"><em>KEY_ALIAS</em></span> -keyalg AES -keysize 128 -keystore <span class="emphasis"><em>KEYSTORE</em></span> -storetype BCFKS -storepass <span class="emphasis"><em>PASSWORD</em></span> -keypass <span class="emphasis"><em>PASSWORD</em></span></pre></li><li class="listitem"><p class="simpara">
							Define the credential store using the WildFly Elytron tool with the following command:
						</p><pre class="screen">$ EAP_HOME/bin/elytron-tool.sh credential-store -c -a <span class="emphasis"><em>ALIAS</em></span> -x <span class="emphasis"><em>ALIAS_PASSWORD</em></span> -p <span class="emphasis"><em>PASSWORD</em></span> -l <span class="emphasis"><em>KEYSTORE</em></span> -u "keyStoreType=BCFKS;external=true;keyAlias=<span class="emphasis"><em>KEY_ALIAS</em></span>;externalPath=<span class="emphasis"><em>CREDENTIAL_STORE</em></span>"</pre></li></ol></div><div class="title"><strong>Add a Credential to a Credential Store Using the WildFly Elytron Tool</strong></div><p>
						Add a credential to a credential store using the WildFly Elytron tool with the following command:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "<span class="emphasis"><em>path/to/store_file</em></span>" --password <span class="emphasis"><em>STORE_PASSWORD</em></span> --add <span class="emphasis"><em>ALIAS</em></span> --secret <span class="emphasis"><em>SENSITIVE_STRING</em></span></pre><p>
					For example:
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "../cred_stores/my_store.jceks" --password supersecretstorepassword --add database-pw --secret speci@l_db_pa$$_01</pre><p>
					Similar to providing the credential store password, if you do not want to provide your secret in the command, you can omit that argument and you will be prompted to enter the secret manually using standard input.
				</p><div class="title"><strong>List All the Credentials in the Credential Store Using the WildFly Elytron Tool</strong></div><p>
						List the credentials in a credential store using the WildFly Elytron tool with the following command:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "<span class="emphasis"><em>path/to/store_file</em></span>" --password <span class="emphasis"><em>STORE_PASSWORD</em></span> --aliases</pre><p>
					For example:
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "../cred_stores/my_store.jceks" --password supersecretstorepassword --aliases</pre><div class="title"><strong>Check If an Alias Exists in the Credential Store Using the Wildfly Elytron Tool</strong></div><p>
						Check if an alias exists in a credential store using the WildFly Elytron tool with the following command:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "<span class="emphasis"><em>path/to/store_file</em></span>" --password <span class="emphasis"><em>STORE_PASSWORD</em></span> --exists <span class="emphasis"><em>ALIAS</em></span></pre><p>
					For example:
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "../cred_stores/my_store.jceks" --password supersecretstorepassword --exists database-pw</pre><div class="title"><strong>Remove a Credential from the Credential Store Using the WildFly Elytron Tool</strong></div><p>
						Remove a credential from a credential store using the WildFly Elytron tool with the following command:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "<span class="emphasis"><em>path/to/store_file</em></span>" --password <span class="emphasis"><em>STORE_PASSWORD</em></span> --remove <span class="emphasis"><em>ALIAS</em></span></pre><p>
					For example:
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --location "../cred_stores/my_store.jceks" --password supersecretstorepassword --remove database-pw</pre><div class="title"><strong>Add a Credential Store Created with the WildFly Elytron Tool to a JBoss EAP Server</strong></div><p>
						After you have created a credential store with the WildFly Elytron tool, add it to your running JBoss EAP server with the following management CLI command:
					</p><pre class="screen">/subsystem=elytron/credential-store=<span class="emphasis"><em>STORE_NAME</em></span>:add(location="<span class="emphasis"><em>path/to/store_file</em></span>",credential-reference={clear-text=<span class="emphasis"><em>STORE_PASSWORD</em></span>})</pre><p>
					For example:
				</p><pre class="screen">/subsystem=elytron/credential-store=my_store:add(location="../cred_stores/my_store.jceks",credential-reference={clear-text=supersecretstorepassword})</pre><p>
					After adding the credential store to the JBoss EAP configuration, you can then refer to a password or sensitive string stored in the credential store using the <a class="link" href="securely_storing_credentials.html#cred_store_use" title="Use a Stored Credential in a Configuration"><code class="literal">credential-reference</code> attribute</a>.
				</p><p>
					For more information, use the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh credential-store --help</code> command for a detailed listing of available options.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_tool_mask"/>Generate Masked Encrypted Strings Using the WildFly Elytron Tool</h3></div></div></div><p>
						You can use the WildFly Elytron tool to generate PicketBox-compatible <code class="literal">MASK-</code> encrypted strings to use instead of a plain text password for a credential store.
					</p><p>
						To generate a masked string, use the following command and provide values for the salt and the iteration count:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh mask --salt <span class="emphasis"><em>SALT</em></span> --iteration <span class="emphasis"><em>ITERATION_COUNT</em></span> --secret <span class="emphasis"><em>PASSWORD</em></span></pre><p>
						For example:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh mask --salt 12345678 --iteration 123 --secret supersecretstorepassword

MASK-8VzWsSNwBaR676g8ujiIDdFKwSjOBHCHgnKf17nun3v;12345678;123</pre><p>
						If you do not want to provide the secret in the command, you can omit that argument and you will be prompted to enter the secret manually using standard input.
					</p><p>
						For more information, use the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh mask --help</code> command for a detailed listing of available options.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_tool_convert_vault"/>Convert a Password Vault to a Credential Store Using the WildFly Elytron Tool</h3></div></div></div><p>
						You can use the WildFly Elytron tool to convert a <a class="link" href="securely_storing_credentials.html#password_vault" title="Password Vault">password vault</a> to a credential store. To convert a password vault to a credential store, you need the <a class="link" href="securely_storing_credentials.html#initialize_passord_vault" title="Initialize the Password Vault">vault’s values used when initializing the vault</a>.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							When converting a password vault, aliases in the new credential store are named in the following format based on their equivalent password vault block and attribute name: <code class="literal"><span class="emphasis"><em>VAULT_BLOCK</em></span>::<span class="emphasis"><em>ATTRIBUTE_NAME</em></span></code>.
						</p></div><div class="title"><strong>Convert a Single Password Vault</strong></div><p>
							Convert a single password vault to a credential store using the following command:
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh vault --keystore <span class="emphasis"><em>"path/to/vault_file"</em></span> --keystore-password <span class="emphasis"><em>VAULT_PASSWORD</em></span> --enc-dir <span class="emphasis"><em>"path/to/vault_directory"</em></span> --salt <span class="emphasis"><em>SALT</em></span> --iteration <span class="emphasis"><em>ITERATION_COUNT</em></span> --alias <span class="emphasis"><em>VAULT_ALIAS</em></span></pre><p>
						For example, you can also specify the new credential store’s file name and location with the <code class="literal">--location</code> argument:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh vault --keystore ../vaults/vault.keystore --keystore-password vault22 --enc-dir ../vaults/ --salt 1234abcd --iteration 120 --alias my_vault --location ../cred_stores/my_vault_converted.cred_store</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							You can also use the <code class="literal">--summary</code> argument to print a summary of the management CLI commands used to convert it. Note that even if a plain text password is used, it is masked in the summary output. The default <code class="literal">SALT</code> and <code class="literal">ITERATION</code> values are used unless they are specified in the command.
						</p></div><div class="title"><strong>Bulk Convert Multiple Password Vaults</strong></div><p>
							To bulk convert multiple password vaults:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Put the details of the vaults you want to convert into a description file in the following format:
							</p><pre class="screen">keystore:<span class="emphasis"><em>path/to/vault_file</em></span>
keystore-password:<span class="emphasis"><em>VAULT_PASSWORD</em></span>
enc-dir:<span class="emphasis"><em>path/to/vault_directory</em></span>
salt:<span class="emphasis"><em>SALT</em></span> <a id="CO1-1"/><span><img src="images/callouts/1.png" alt="1"/></span>
iteration:<span class="emphasis"><em>ITERATION_COUNT</em></span>
location:<span class="emphasis"><em>path/to/converted_cred_store</em></span> <a id="CO1-2"/><span><img src="images/callouts/2.png" alt="2"/></span>
alias:<span class="emphasis"><em>VAULT_ALIAS</em></span>
properties:<span class="emphasis"><em>PARAMETER1</em></span>=<span class="emphasis"><em>VALUE1</em></span>;<span class="emphasis"><em>PARAMETER2</em></span>=<span class="emphasis"><em>VALUE2</em></span>; <a id="CO1-3"/><span><img src="images/callouts/3.png" alt="3"/></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/callouts/1.png" alt="1"/></span></a> </p></td><td valign="top" align="left"><p>
										<code class="literal">salt</code> and <code class="literal">iteration</code> can be omitted if you are providing a plain text password for the vault.
									</p></td></tr><tr><td valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/callouts/2.png" alt="2"/></span></a> </p></td><td valign="top" align="left"><p>
										Specifies the location and file name for the converted credential store.
									</p></td></tr><tr><td valign="top" align="left"><p><a href="#CO1-3"><span><img src="images/callouts/3.png" alt="3"/></span></a> </p></td><td valign="top" align="left"><p>
										Optional: Specifies a list of optional parameters separated by semicolons (<code class="literal">;</code>). See <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh vault --help</code> for a list of available parameters.
									</p></td></tr></table></div><p class="simpara">
								For example:
							</p><pre class="screen">keystore:/vaults/vault1/vault1.keystore
keystore-password:vault11
enc-dir:/vaults/vault1/
salt:1234abcd
iteration:120
location:/cred_stores/vault1_converted.cred_store
alias:my_vault

keystore:/vaults/vault2/vault2.keystore
keystore-password:vault22
enc-dir:/vaults/vault2/
salt:abcd1234
iteration:130
location:/cred_stores/vault2_converted.cred_store
alias:my_vault2</pre></li><li class="listitem"><p class="simpara">
								Run the bulk convert command with your description file from the previous step:
							</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh vault --bulk-convert <span class="emphasis"><em>vaultdescriptions.txt</em></span></pre></li></ol></div><p>
						For more information, use the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/elytron-tool.sh vault --help</code> command for a detailed listing of available options.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cred_store_elytron_client"/>Using Credential Stores with Elytron Client</h2></div></div></div><p>
					Clients connecting to JBoss EAP, such as EJBs, can authenticate using Elytron Client. Users without access to a running JBoss EAP server can <a class="link" href="securely_storing_credentials.html#cred_store_elytron_tool" title="Create and Modify Credential Stores Offline with the WildFly Elytron Tool">create and modify credential stores using the WildFly Elytron tool</a>, and then clients can use Elytron Client to access sensitive strings inside a credential store.
				</p><p>
					The following example shows you how to use a credential store in an Elytron Client configuration file.
				</p><div class="title"><strong>Example <code class="literal">custom-config.xml</code> with a Credential Store</strong></div><p>
						
</p><pre class="programlisting">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
    ...
    &lt;credential-stores&gt;
      &lt;credential-store name="my_store"&gt; <a id="CO2-1"/><span><img src="images/callouts/1.png" alt="1"/></span>
        &lt;protection-parameter-credentials&gt;
          &lt;credential-store-reference clear-text="pass123"/&gt; <a id="CO2-2"/><span><img src="images/callouts/2.png" alt="2"/></span>
        &lt;/protection-parameter-credentials&gt;
        &lt;attributes&gt;
          &lt;attribute name="location" value="/path/to/my_store.jceks"/&gt; <a id="CO2-3"/><span><img src="images/callouts/3.png" alt="3"/></span>
        &lt;/attributes&gt;
      &lt;/credential-store&gt;
    &lt;/credential-stores&gt;
    ...
    &lt;authentication-configurations&gt;
      &lt;configuration name="my_user"&gt;
        &lt;set-host name="localhost"/&gt;
        &lt;set-user-name name="my_user"/&gt;
        &lt;set-mechanism-realm name="ManagementRealm"/&gt;
        &lt;use-provider-sasl-factory/&gt;
        &lt;credentials&gt;
          &lt;credential-store-reference store="my_store" alias="my_user"/&gt; <a id="CO2-4"/><span><img src="images/callouts/4.png" alt="4"/></span>
        &lt;/credentials&gt;
      &lt;/configuration&gt;
    &lt;/authentication-configurations&gt;
    ...
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre><p>

					</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/callouts/1.png" alt="1"/></span></a> </p></td><td valign="top" align="left"><p>
							A name for the credential store for use within the Elytron Client configuration file.
						</p></td></tr><tr><td valign="top" align="left"><p><a href="#CO2-2"><span><img src="images/callouts/2.png" alt="2"/></span></a> </p></td><td valign="top" align="left"><p>
							The master password for the credential store.
						</p></td></tr><tr><td valign="top" align="left"><p><a href="#CO2-3"><span><img src="images/callouts/3.png" alt="3"/></span></a> </p></td><td valign="top" align="left"><p>
							The path to the credential store file.
						</p></td></tr><tr><td valign="top" align="left"><p><a href="#CO2-4"><span><img src="images/callouts/4.png" alt="4"/></span></a> </p></td><td valign="top" align="left"><p>
							A credential reference for a sensitive string stored in the credential store.
						</p></td></tr></table></div><p>
					See the JBoss EAP <span class="emphasis"><em>How to Configure Identity Management Guide</em></span> for more information on <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#elytron_client_authentication">configuring client authentication using Elytron Client</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="credential_store_in_managed_domain"/>Using Credential Stores in a Managed Domain</h2></div></div></div><p>
					There are a few different ways of creating and setting up a credential store in a managed domain. One of the ways is:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Use the WildFly Elytron Tool to prepare the credential store. For more information on this, see <a class="link" href="securely_storing_credentials.html#cred_store_elytron_tool" title="Create and Modify Credential Stores Offline with the WildFly Elytron Tool">Create and Modify Credential Stores Offline with the WildFly Elytron Tool</a>.
						</li><li class="listitem">
							Distribute the created credential store storage file. For example, distribute it to each server, for example by using <code class="literal">scp</code>, or store it in NFS and use it for all the created credential stores.
						</li><li class="listitem"><p class="simpara">
							You can then create a credential store with the <code class="literal">create</code> property set to <code class="literal">false</code>, using the already created file.
						</p><pre class="screen">/profile=full/subsystem=elytron/credential-store=test:add(relative-to=jboss.server.data.dir,location="store.keystore",credential-reference={clear-text="secret2"},create=false)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								When using one credential store to store all credential stores, when storing it on NFS, you must use the credential store in <code class="literal">read-only</code> mode. The <code class="literal">read-only</code> mode is used to maintain consistency. It is also prefered to use an absolute path in this case.
							</p><pre class="screen">/profile=full/subsystem=elytron/credential-store=test:add(location=/absolute/path/to/store.keystore,credential-reference={clear-text="secret2"},create=false,modifiable=false)</pre></div></li></ol></div><p>
					For other ways of creating a credential store in a managed domain, see <a class="link" href="securely_storing_credentials.html#creating_credential_store_in_managed_domain" title="Create a Credential Store in a Managed Domain">Create a Credential Store in a Managed Domain</a>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="password_vault"/>Password Vault</h1></div></div></div><p>
				Configuration of JBoss EAP and associated applications requires potentially sensitive information, such as user names and passwords. Instead of storing the password as plain text in configuration files, the password vault feature can be used to mask the password information and store it in an encrypted keystore. Once the password is stored, references can be included in management CLI commands or applications deployed to JBoss EAP.
			</p><p>
				The password vault uses the Java keystore as its storage mechanism. Password vault consists of two parts: storage and key storage. Java keystore is used to store the key, which is used to encrypt or decrypt sensitive strings in Vault storage.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					The keytool utility, provided by the Java Runtime Environment (JRE), is utilized for this steps. Locate the path for the file, which on Red Hat Enterprise Linux is <code class="literal">/usr/bin/keytool</code>.
				</p><p>
					JCEKS keystore implementations differ between Java vendors so the keystore must be generated using the keytool utility from the same vendor as the JDK used. Using a keystore generated by the keytool from one vendor’s JDK in a JBoss EAP 7 instance running on a JDK from a different vendor results in the following exception: <code class="literal">java.io.IOException: com.sun.crypto.provider.SealedObjectForKeyProtector</code>
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="set_up_password_vault"/>Set Up a Password Vault</h2></div></div></div><p>
					Follow the steps below to set up and use a Password Vault.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a directory to store the keystore and other encrypted information.
						</p><p class="simpara">
							The rest of this procedure assumes that the directory is <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/vault/</code>. Since this directory will contain sensitive information it should be accessible to only limited users. At a minimum the user account under which JBoss EAP is running requires read-write access.
						</p></li><li class="listitem"><p class="simpara">
							Determine the parameters to use with keytool utility.
						</p><p class="simpara">
							Decide on values for the following parameters:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">alias</span></dt><dd>
										The alias is a unique identifier for the vault or other data stored in the keystore. Aliases are case-insensitive.
									</dd><dt><span class="term">storetype</span></dt><dd>
										The storetype specifies the keystore type. The value <code class="literal">jceks</code> is recommended.
									</dd><dt><span class="term">keyalg</span></dt><dd>
										The algorithm to use for encryption. Use the documentation for the JRE and operating system to see which other choices are available.
									</dd><dt><span class="term">keysize</span></dt><dd>
										The size of an encryption key impacts how difficult it is to decrypt through brute force. For information on appropriate values, see the documentation distributed with the keytool utility.
									</dd><dt><span class="term">storepass</span></dt><dd>
										The value of storepass is the password that is used to authenticate to the keystore so that the key can be read. The password must be at least 6 characters long and must be provided when the keystore is accessed. If this parameter is omitted, the keytool utility will prompt for it to be entered after the command has been executed
									</dd><dt><span class="term">keypass</span></dt><dd>
										The value of keypass is the password used to access the specific key and must match the value of the storepass parameter.
									</dd><dt><span class="term">validity</span></dt><dd>
										The value of validity is the period (in days) for which the key will be valid.
									</dd><dt><span class="term">keystore</span></dt><dd><p class="simpara">
										The value of keystore is the file path and file name in which the keystore’s values are to be stored. The keystore file is created when data is first added to it. Ensure the correct file path separator is used: / (forward slash) for Red Hat Enterprise Linux and similar operating systems, \ (backslash) for Windows Server.
									</p><p class="simpara">
										The <code class="literal">keytool</code> utility has many other options. See the documentation for the JRE or the operating system for more details.
									</p></dd></dl></div></li><li class="listitem"><p class="simpara">
							Run the keytool command, ensuring <code class="literal">keypass</code> and <code class="literal">storepass</code> contain the same value.
						</p><pre class="programlisting">$ keytool -genseckey -alias vault -storetype jceks -keyalg AES -keysize 128 -storepass vault22 -keypass vault22 -validity 730 -keystore <span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore</pre><p class="simpara">
							This results in a keystore that has been created in the file <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore</code>. It stores a single key, with the alias vault, which will be used to store encrypted strings, such as passwords, for JBoss EAP.
						</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="initialize_passord_vault"/>Initialize the Password Vault</h2></div></div></div><p>
					The password vault can be initialized either interactively, where you are prompted for each parameter’s value, or non-interactively, where all parameter values are provided on the command line. Each method gives the same result, so either may be used.
				</p><p>
					The following parameters will be needed:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">keystore URL (KEYSTORE_URL)</span></dt><dd>
								The file system path or URI of the keystore file. The examples use <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore</code>.
							</dd><dt><span class="term">keystore password (KEYSTORE_PASSWORD)</span></dt><dd>
								The password used to access the keystore.
							</dd><dt><span class="term">Salt (SALT)</span></dt><dd>
								The salt value is a random string of eight characters used, together with the iteration count, to encrypt the content of the keystore.
							</dd><dt><span class="term">keystore Alias (KEYSTORE_ALIAS)</span></dt><dd>
								The alias by which the keystore is known.
							</dd><dt><span class="term">Iteration Count (ITERATION_COUNT)</span></dt><dd>
								The number of times the encryption algorithm is run.
							</dd><dt><span class="term">Directory to store encrypted files (ENC_FILE_DIR)</span></dt><dd>
								The path in which the encrypted files are to be stored. This is typically the directory containing the password vault. It is convenient but not mandatory to store all of your encrypted information in the same place as the keystore. This directory should be only accessible to limited users. At a minimum the user account under which JBoss EAP 7 is running requires read-write access. The keystore should be located in the directory you created when you <a class="link" href="securely_storing_credentials.html#set_up_password_vault" title="Set Up a Password Vault">set up the password vault</a>. Note that the trailing backslash or forward slash on the directory name is required. Ensure the correct file path separator is used: / (forward slash) for Red Hat Enterprise Linux and similar operating systems, \ (backslash) for Windows Server.
							</dd><dt><span class="term">Vault Block (VAULT_BLOCK)</span></dt><dd>
								The name to be given to this block in the password vault.
							</dd><dt><span class="term">Attribute (ATTRIBUTE)</span></dt><dd>
								The name to be given to the attribute being stored.
							</dd><dt><span class="term">Security Attribute (SEC-ATTR)</span></dt><dd>
								The password which is being stored in the password vault.
							</dd></dl></div><p>
					To run the password vault command non-interactively, the <code class="literal">vault</code> script located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> can be invoked with parameters for the relevant information:
				</p><pre class="programlisting">$ vault.sh --keystore <span class="emphasis"><em>KEYSTORE_URL</em></span> --keystore-password <span class="emphasis"><em>KEYSTORE_PASSWORD</em></span> --alias <span class="emphasis"><em>KEYSTORE_ALIAS</em></span> --vault-block <span class="emphasis"><em>VAULT_BLOCK</em></span> --attribute <span class="emphasis"><em>ATTRIBUTE</em></span> --sec-attr <span class="emphasis"><em>SEC-ATTR</em></span> --enc-dir <span class="emphasis"><em>ENC_FILE_DIR</em></span> --iteration <span class="emphasis"><em>ITERATION_COUNT</em></span> --salt <span class="emphasis"><em>SALT</em></span></pre><div class="title"><strong>Example: Initializing Password Vault</strong></div><p>
						
</p><pre class="programlisting">$ vault.sh --keystore <span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore --keystore-password vault22 --alias vault --vault-block vb --attribute password --sec-attr 0penS3sam3 --enc-dir <span class="emphasis"><em>EAP_HOME</em></span>/vault/ --iteration 120 --salt 1234abcd</pre><p>

					</p><div class="title"><strong>Example: Output</strong></div><p>
						
</p><pre class="programlisting">=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME

  JAVA: java

=========================================================================

Nov 09, 2015 9:02:47 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX00361: Default Security Vault Implementation Initialized and Ready
WFLYSEC0047: Secured attribute value has been stored in Vault.
Please make note of the following:
********************************************
Vault Block:vb
Attribute Name:password
Configuration should be done as follows:
VAULT::vb::password::1
********************************************
WFLYSEC0048: Vault Configuration in WildFly configuration file:
********************************************

&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************</pre><p>

					</p><p>
					To run the password vault command interactively, the following steps are required:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Launch the password vault command interactively.
						</p><p class="simpara">
							Run <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/vault.sh</code> on Red Hat Enterprise Linux and similar operating systems or <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>\bin\vault.bat</code> on Windows Server. Start a new interactive session by typing <code class="literal">0</code> (zero).
						</p></li><li class="listitem"><p class="simpara">
							Complete the prompted parameters.
						</p><p class="simpara">
							Follow the prompts to input the required parameters.
						</p></li><li class="listitem"><p class="simpara">
							Make a note of the masked password information.
						</p><p class="simpara">
							The masked password, salt, and iteration count are printed to standard output. Make a note of them in a secure location. They are required to add entries to the Password Vault. Access to the keystore file and these values could allow an attacker access to obtain access to sensitive information in the Password Vault.
						</p></li><li class="listitem"><p class="simpara">
							Exit the interactive console
						</p><p class="simpara">
							Type <code class="literal">2</code> (two) to exit the interactive console.
						</p></li></ol></div><div class="title"><strong>Example: Input and Output</strong></div><p>
						
</p><pre class="programlisting">Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault/
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password: vault22
Enter Keystore password again: vault22
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Nov 09, 2015 9:24:36 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in AS7 config file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************
Vault is initialized and ready for use
Handshake with Vault complete</pre><p>

					</p><p>
					+ The keystore password has been masked for use in configuration files and deployments. In addition, the vault is initialized and ready to use.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="use_a_password_vault"/>Use a Password Vault</h2></div></div></div><p>
					Before passwords and other sensitive attributes can be masked and used in configuration files, JBoss EAP 7 must be made aware of the password vault which stores and decrypts them.
				</p><p>
					The following command can be used to configure JBoss EAP 7 to use the password vault:
				</p><pre class="screen">/core-service=vault:add(vault-options=[("KEYSTORE_URL" =&gt; <span class="emphasis"><em>PATH_TO_KEYSTORE</em></span>),("KEYSTORE_PASSWORD" =&gt; <span class="emphasis"><em>MASKED_PASSWORD</em></span>),("KEYSTORE_ALIAS" =&gt; <span class="emphasis"><em>ALIAS</em></span>),("SALT" =&gt; <span class="emphasis"><em>SALT</em></span>),("ITERATION_COUNT" =&gt; <span class="emphasis"><em>ITERATION_COUNT</em></span>),("ENC_FILE_DIR" =&gt; <span class="emphasis"><em>ENC_FILE_DIR</em></span>)])

/core-service=vault:add(vault-options=[("KEYSTORE_URL" =&gt; "<span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore"),("KEYSTORE_PASSWORD" =&gt; "MASK-5dOaAVafCSd"),("KEYSTORE_ALIAS" =&gt; "vault"),("SALT" =&gt; "1234abcd"),("ITERATION_COUNT" =&gt; "120"),("ENC_FILE_DIR" =&gt; "<span class="emphasis"><em>EAP_HOME</em></span>/vault/")])</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If Microsoft Windows Server is being used, use two backslashes (\\) in the file path instead using one. For example, <code class="literal">C:\\data\\vault\\vault.keystore</code>. This is because a single backslash character (\) is used for character escaping.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="store_a_sensitive_string_in_the_password_vault"/>Store a Sensitive String in the Password Vault</h2></div></div></div><p>
					Including passwords and other sensitive strings in plaintext configuration files is a security risk. Store these strings instead in the Password Vault for improved security, where they can then be referenced in configuration files, management CLI commands and applications in their masked form.
				</p><p>
					Sensitive strings can be stored in the Password Vault either interactively, where the tool prompts for each parameter’s value, or non-interactively, where all the parameters' values are provided on the command line. Each method gives the same result, so either may be used. Both of these methods are invoked using the <code class="literal">vault</code> script.
				</p><p>
					To run the password vault command non-interactively, the <code class="literal">vault</code> script (located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code>) can be invoked with parameters for the relevant information:
				</p><pre class="programlisting">$ vault.sh --keystore <span class="emphasis"><em>KEYSTORE_URL</em></span> --keystore-password <span class="emphasis"><em>KEYSTORE_PASSWORD</em></span> --alias <span class="emphasis"><em>KEYSTORE_ALIAS</em></span> --vault-block <span class="emphasis"><em>VAULT_BLOCK</em></span> --attribute <span class="emphasis"><em>ATTRIBUTE</em></span> --sec-attr <span class="emphasis"><em>SEC-ATTR</em></span> --enc-dir <span class="emphasis"><em>ENC_FILE_DIR</em></span> --iteration <span class="emphasis"><em>ITERATION_COUNT</em></span> --salt <span class="emphasis"><em>SALT</em></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The keystore password must be given in plaintext form, not masked form.
					</p></div><pre class="programlisting">$ vault.sh --keystore <span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore --keystore-password vault22 --alias vault --vault-block vb --attribute password --sec-attr 0penS3sam3 --enc-dir <span class="emphasis"><em>EAP_HOME</em></span>/vault/ --iteration 120 --salt 1234abcd</pre><div class="title"><strong>Example: Output</strong></div><p>
						
</p><pre class="programlisting">=========================================================================

  JBoss Vault

  JBOSS_HOME: EAP_HOME

  JAVA: java

=========================================================================

Nov 09, 2015 9:24:36 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX00361: Default Security Vault Implementation Initialized and Ready
WFLYSEC0047: Secured attribute value has been stored in Vault.
Please make note of the following:
********************************************
Vault Block:vb
Attribute Name:password
Configuration should be done as follows:
VAULT::vb::password::1
********************************************
WFLYSEC0048: Vault Configuration in WildFly configuration file:
********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="../vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="../vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
********************************************</pre><p>

					</p><p>
					After invoking the <code class="literal">vault</code> script, a message prints to standard output, showing the vault block, attribute name, masked string, and advice about using the string in your configuration. Make note of this information in a secure location. An extract of sample output is as follows:
				</p><pre class="programlisting">Vault Block:vb
Attribute Name:password
Configuration should be done as follows:
VAULT::vb::password::1</pre><p>
					To run the password vault command interactively, the following steps are required:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Launch the Password Vault command interactively.
						</p><p class="simpara">
							Launch the operating system’s command line interface and run <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>\bin\vault.bat</code> (on Microsoft Windows Server). Start a new interactive session by typing <code class="literal">0</code> (zero).
						</p></li><li class="listitem"><p class="simpara">
							Complete the prompted parameters.
						</p><p class="simpara">
							Follow the prompts to input the required parameters. These values must match those provided when the Password Vault was created.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The keystore password must be given in plaintext form, not masked form.
							</p></div></li><li class="listitem"><p class="simpara">
							Complete the prompted parameters about the sensitive string.
						</p><p class="simpara">
							Enter <code class="literal">0</code> (zero) to start storing the sensitive string. Follow the prompts to input the required parameters.
						</p></li><li class="listitem"><p class="simpara">
							Make note of the information about the masked string.
						</p><p class="simpara">
							A message prints to standard output, showing the vault block, attribute name, masked string, and advice about using the string in the configuration. Make note of this information in a secure location. An extract of sample output is as follows:
						</p><pre class="programlisting">Vault Block:ds_Example1
Attribute Name:password
Configuration should be done as follows:
VAULT::ds_Example1::password::1</pre></li><li class="listitem"><p class="simpara">
							Exit the interactive console.
						</p><p class="simpara">
							Type <code class="literal">2</code> (two) to exit the interactive console.
						</p></li></ol></div><div class="title"><strong>Example: Input and Output</strong></div><p>
						
</p><pre class="programlisting"> =========================================================================
  JBoss Vault
  JBOSS_HOME: EAP_HOME
  JAVA: java
 =========================================================================
 **********************************
 ****  JBoss Vault  ***************
 **********************************
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault/
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password:
Enter Keystore password again:
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Nov 09, 2015 9:24:36 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in AS7 config file:
 ********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
 ********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::  0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
0
Task: Store a secured attribute
Please enter secured attribute value (such as password):
Please enter secured attribute value (such as password) again:
Values match
Enter Vault Block:ds_Example1
Enter Attribute Name:password
Secured attribute value has been stored in vault.
Please make note of the following:
 ********************************************
Vault Block:ds_Example1
Attribute Name:password
Configuration should be done as follows:
VAULT::ds_Example1::password::1
 ********************************************
Please enter a Digit::  0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="use_an_encrypted_sensitive_string_in_configuration"/>Use an Encrypted Sensitive String in Configuration</h2></div></div></div><p>
					Any sensitive string which has been encrypted can be used in a configuration file or management CLI command in its masked form, providing expressions are allowed.
				</p><p>
					To confirm if expressions are allowed within a particular subsystem, run the following management CLI command against that subsystem:
				</p><pre class="screen">/subsystem=<span class="emphasis"><em>SUBSYSTEM</em></span>:read-resource-description(recursive=true)</pre><p>
					From the output of running this command, look for the value of the <code class="literal">expressions-allowed</code> parameter. If this is <code class="literal">true</code>, then expressions can be used within the configuration of this subsystem.
				</p><p>
					Use the following syntax to replace any plaintext string with the masked form.
				</p><pre class="programlisting">${VAULT::VAULT_BLOCK::ATTRIBUTE_NAME::MASKED_STRING}</pre><div class="title"><strong>Example: Datasource Definition Using a Password in Masked Form</strong></div><p>
						
</p><pre class="programlisting">...
  &lt;subsystem xmlns="urn:jboss:domain:datasources:5.0"&gt;
    &lt;datasources&gt;
      &lt;datasource jndi-name="java:jboss/datasources/ExampleDS" enabled="true" use-java-context="true" pool-name="H2DS"&gt;
        &lt;connection-url&gt;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&lt;/connection-url&gt;
        &lt;driver&gt;h2&lt;/driver&gt;
        &lt;pool&gt;&lt;/pool&gt;
        &lt;security&gt;
          &lt;user-name&gt;sa&lt;/user-name&gt;
          &lt;password&gt;${VAULT::ds_ExampleDS::password::1}&lt;/password&gt;
        &lt;/security&gt;
      &lt;/datasource&gt;
      &lt;drivers&gt;
         &lt;driver name="h2" module="com.h2database.h2"&gt;
            &lt;xa-datasource-class&gt;org.h2.jdbcx.JdbcDataSource&lt;/xa-datasource-class&gt;
         &lt;/driver&gt;
      &lt;/drivers&gt;
    &lt;/datasources&gt;
  &lt;/subsystem&gt;
...</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="use_an_encrypted_sensitive_string_in_an_application"/>Use an Encrypted Sensitive String in an Application</h2></div></div></div><p>
					Encrypted strings stored in the password vault can be used in an application’s source code. The below example is an extract of a servlet’s source code, illustrating the use of a masked password in a datasource definition, instead of the plaintext password. The plaintext version is commented out so that you can see the difference.
				</p><div class="title"><strong>Example: Servlet Using a Vaulted Password</strong></div><p>
						
</p><pre class="programlisting">@DataSourceDefinition(
        name = "java:jboss/datasources/LoginDS",
        user = "sa",
        password = "VAULT::DS::thePass::1",
        className = "org.h2.jdbcx.JdbcDataSource",
        url = "jdbc:h2:tcp://localhost/mem:test"
)
/*old (plaintext) definition
@DataSourceDefinition(
        name = "java:jboss/datasources/LoginDS",
        user = "sa",
        password = "sa",
        className = "org.h2.jdbcx.JdbcDataSource",
        url = "jdbc:h2:tcp://localhost/mem:test"
)*/</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="check_if_a_sensitive_string_is_in_the_password_vault"/>Check if a Sensitive String is in the Password Vault</h2></div></div></div><p>
					Before attempting to store or use a sensitive string in the Password Vault it can be useful to first confirm if it is already stored.
				</p><p>
					This check can be done either interactively, where the user is prompted for each parameter’s value, or non-interactively, where all parameters' values are provided on the command line. Each method gives the same result, so either may be used. Both of these methods are invoked using the <code class="literal">vault</code> script.
				</p><p>
					Use the non-interative method to provide all parameters' values at once. For a description of all parameters, see <a class="link" href="securely_storing_credentials.html#initialize_passord_vault" title="Initialize the Password Vault">Initialize the Password Vault</a>. To run the password vault command non-interactively, the <code class="literal">vault</code> script located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> can be invoked with parameters for the relevant information:
				</p><pre class="programlisting">$ vault.sh --keystore <span class="emphasis"><em>KEYSTORE_URL</em></span> --keystore-password <span class="emphasis"><em>KEYSTORE_PASSWORD</em></span> --alias <span class="emphasis"><em>KEYSTORE_ALIAS</em></span> --check-sec-attr --vault-block VAULT_BLOCK --attribute <span class="emphasis"><em>ATTRIBUTE</em></span> --enc-dir <span class="emphasis"><em>ENC_FILE_DIR</em></span> --iteration <span class="emphasis"><em>ITERATION_COUNT</em></span> --salt <span class="emphasis"><em>SALT</em></span></pre><p>
					Substitute the placeholder values with the actual values. The values for parameters <span class="emphasis"><em>KEYSTORE_URL</em></span>, <span class="emphasis"><em>KEYSTORE_PASSWORD</em></span> and <span class="emphasis"><em>KEYSTORE_ALIAS</em></span> must match those provided when the password vault was created.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The keystore password must be given in plaintext form, not masked form.
					</p></div><p>
					If the sensitive string is stored in the vault block specified, the following message will be displayed:
				</p><pre class="programlisting">Password already exists.</pre><p>
					If the value is not stored in the specified block, the following message will be displayed:
				</p><pre class="programlisting">Password doesn't exist.</pre><p>
					To run the password vault command interactively, the following steps are required:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Launch the password vault command interactively.
						</p><p class="simpara">
							Run <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>\bin\vault.bat</code> (on Windows Server). Start a new interactive session by typing <code class="literal">0</code> (zero).
						</p></li><li class="listitem"><p class="simpara">
							Complete the prompted parameters. Follow the prompts to input the required authentication parameters. These values must match those provided when the password vault was created.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								When prompted for authentication, the keystore password must be given in plaintext form, not masked form.
							</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Enter <code class="literal">1</code> (one) to select <span class="strong"><strong>Check whether a secured attribute exists</strong></span>.
								</li><li class="listitem">
									Enter the name of the vault block in which the sensitive string is stored.
								</li><li class="listitem">
									Enter the name of the sensitive string to be checked.
								</li></ul></div></li></ol></div><p>
					If the sensitive string is stored in the vault block specified, a confirmation message like the following will be output:
				</p><pre class="programlisting">A value exists for (VAULT_BLOCK, ATTRIBUTE)</pre><p>
					If the sensitive string is not stored in the specified block, a message like the following will be output:
				</p><pre class="programlisting">No value has been store for (VAULT_BLOCK, ATTRIBUTE)</pre><div class="title"><strong>Example: Check For a Sensitive String Interactively</strong></div><p>
						
</p><pre class="programlisting"> =========================================================================
  JBoss Vault
  JBOSS_HOME: EAP_HOME
  JAVA: java
 =========================================================================
 **********************************
 ****  JBoss Vault  ***************
 **********************************
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password:
Enter Keystore password again:
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Nov 09, 2015 9:24:36 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in AS7 config file:
 ********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
 ********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::  0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
1
Task: Verify whether a secured attribute exists
Enter Vault Block:vb
Enter Attribute Name:password
A value exists for (vb, password)
Please enter a Digit::  0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="remove_a_sensitive_string_from_the_password_vault"/>Remove a Sensitive String from the Password Vault</h2></div></div></div><p>
					For security reasons it is best to remove sensitive strings from the Password Vault when they are no longer required. For example, if an application is being decommissioned, any sensitive strings used in datasource definitions should be removed at the same time.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						As a prerequisite, before removing a sensitive string from the Password Vault, confirm if it is used in the configuration of JBoss EAP.
					</p></div><p>
					This operation can be done either interactively, where the user is prompted for each parameter’s value, or non-interactively, where all parameters' values are provided on the command line. Each method gives the same result, so either may be used. Both of these methods are invoked using the <code class="literal">vault</code> script.
				</p><p>
					Use the non-interative method to provide all parameters' values at once. For a description of all parameters, see <a class="link" href="securely_storing_credentials.html#initialize_passord_vault" title="Initialize the Password Vault">Initialize the Password Vault</a>. To run the password vault command non-interactively, the <code class="literal">vault</code> script (located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code>) can be invoked with parameters for the relevant information:
				</p><pre class="programlisting">$ vault.sh --keystore <span class="emphasis"><em>KEYSTORE_URL</em></span> --keystore-password <span class="emphasis"><em>KEYSTORE_PASSWORD</em></span> --alias <span class="emphasis"><em>KEYSTORE_ALIAS</em></span> --remove-sec-attr --vault-block <span class="emphasis"><em>VAULT_BLOCK</em></span> --attribute <span class="emphasis"><em>ATTRIBUTE</em></span> --enc-dir <span class="emphasis"><em>ENC_FILE_DIR</em></span> --iteration <span class="emphasis"><em>ITERATION_COUNT</em></span> --salt <span class="emphasis"><em>SALT</em></span></pre><p>
					Substitute the placeholder values with the actual values. The values for parameters <span class="emphasis"><em>KEYSTORE_URL</em></span>, <span class="emphasis"><em>KEYSTORE_PASSWORD</em></span> and <span class="emphasis"><em>KEYSTORE_ALIAS</em></span> must match those provided when the password Vault was created.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The keystore password must be given in plaintext form, not masked form.
					</p></div><p>
					If the sensitive string is successfully removed, a confirmation message like the following will be displayed:
				</p><pre class="programlisting">Secured attribute [VAULT_BLOCK::ATTRIBUTE] has been successfully removed from vault</pre><p>
					If the sensitive string is not removed, a message like the following will be displayed:
				</p><pre class="programlisting">Secured attribute [VAULT_BLOCK::ATTRIBUTE] was not removed from vault, check whether it exist</pre><div class="title"><strong>Example: Output</strong></div><p>
						
</p><pre class="programlisting">$ ./vault.sh --keystore <span class="emphasis"><em>EAP_HOME</em></span>/vault/vault.keystore --keystore-password vault22 --alias vault --remove-sec-attr --vault-block vb --attribute password --enc-dir <span class="emphasis"><em>EAP_HOME</em></span>/vault/ --iteration 120 --salt 1234abcd
 =========================================================================
  JBoss Vault
  JBOSS_HOME: EAP_HOME
  JAVA: java
 =========================================================================
Dec 23, 2015 1:54:24 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Secured attribute [vb::password] has been successfully removed from vault</pre><p>

					</p><h4><a id="remove_a_sensitive_string_interactively"/>Remove a Sensitive String Interactively</h4><p>
					To run the password vault command interactively, the following steps are required:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Launch the password vault command interactively.
						</p><p class="simpara">
							Run <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/vault.sh</code> (on Red Hat Enterprise Linux and similar operating systems) or <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>\bin\vault.bat</code> (on Microsoft Windows Server). Start a new interactive session by typing <code class="literal">0</code> (zero).
						</p></li><li class="listitem"><p class="simpara">
							Complete the prompted parameters.
						</p><p class="simpara">
							Follow the prompts to input the required authentication parameters. These values must match those provided when the password vault was created.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								When prompted for authentication, the keystore password must be given in plaintext form, not masked form.
							</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Enter <code class="literal">2</code> (two) to choose option Remove secured attribute.
								</li><li class="listitem">
									Enter the name of the vault block in which the sensitive string is stored.
								</li><li class="listitem">
									Enter the name of the sensitive string to be removed.
								</li></ul></div></li></ol></div><p>
					If the sensitive string is successfully removed, a confirmation message like the following will be displayed:
				</p><pre class="programlisting">Secured attribute [VAULT_BLOCK::ATTRIBUTE] has been successfully removed from vault</pre><p>
					If the sensitive string is not removed, a message like the following will be displayed:
				</p><pre class="programlisting">Secured attribute [VAULT_BLOCK::ATTRIBUTE] was not removed from vault, check whether it exist</pre><div class="title"><strong>Example: Output</strong></div><p>
						
</p><pre class="programlisting"> **********************************
 ****  JBoss Vault  ***************
 **********************************
Please enter a Digit::   0: Start Interactive Session  1: Remove Interactive Session  2: Exit
0
Starting an interactive session
Enter directory to store encrypted files:EAP_HOME/vault/
Enter Keystore URL:EAP_HOME/vault/vault.keystore
Enter Keystore password:
Enter Keystore password again:
Values match
Enter 8 character salt:1234abcd
Enter iteration count as a number (Eg: 44):120
Enter Keystore Alias:vault
Initializing Vault
Dec 23, 2014 1:40:56 PM org.picketbox.plugins.vault.PicketBoxSecurityVault init
INFO: PBOX000361: Default Security Vault Implementation Initialized and Ready
Vault Configuration in configuration file:
 ********************************************
...
&lt;/extensions&gt;
&lt;vault&gt;
  &lt;vault-option name="KEYSTORE_URL" value="EAP_HOME/vault/vault.keystore"/&gt;
  &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5dOaAVafCSd"/&gt;
  &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
  &lt;vault-option name="SALT" value="1234abcd"/&gt;
  &lt;vault-option name="ITERATION_COUNT" value="120"/&gt;
  &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
&lt;/vault&gt;&lt;management&gt; ...
 ********************************************
Vault is initialized and ready for use
Handshake with Vault complete
Please enter a Digit::  0: Store a secured attribute  1: Check whether a secured attribute exists  2: Remove secured attribute  3: Exit
2
Task: Remove secured attribute
Enter Vault Block:vb
Enter Attribute Name:password
Secured attribute [vb::password] has been successfully removed from vault</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_red_hat_jboss_enterprise_application_platform_to_use_a_custom_implementation_of_the_password_vault"/>Configure Red Hat JBoss Enterprise Application Platform to Use a Custom Implementation of the Password Vault</h2></div></div></div><p>
					In addition to using the provided password vault implementation, a custom implementation of <code class="literal">SecurityVault</code> can also be used.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						As a prerequisite, ensure that the password vault has been initialized. For more information, see <a class="link" href="securely_storing_credentials.html#initialize_passord_vault" title="Initialize the Password Vault">Initialize the Password Vault</a>.
					</p></div><p>
					To use a custom implementation for the password vault:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Create a class that implements the interface <code class="literal">SecurityVault</code>.
						</li><li class="listitem">
							Create a module containing the class from the previous step, and specify a dependency on <code class="literal">org.picketbox</code> where the interface is <code class="literal">SecurityVault</code>.
						</li><li class="listitem"><p class="simpara">
							Enable the custom password vault in the JBoss EAP configuration by adding the vault element with the following attributes:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<span class="strong"><strong>code</strong></span> - The fully qualified name of class that implements <code class="literal">SecurityVault</code>.
								</li><li class="listitem">
									<span class="strong"><strong>module</strong></span> - The name of the module that contains the custom class.
								</li></ul></div></li></ol></div><p>
					Optionally, the <code class="literal">vault-options</code> parameters can be used to initialize the custom class for a password vault.
				</p><div class="title"><strong>Example: Use vault-options Parameters to Initialize the Custom Class</strong></div><p>
						
</p><pre class="screen">/core-service=vault:add(code="custom.vault.implementation.CustomSecurityVault", module="custom.vault.module", vault-options=[("KEYSTORE_URL" =&gt; <span class="emphasis"><em>PATH_TO_KEYSTORE</em></span>),("KEYSTORE_PASSWORD" =&gt; <span class="emphasis"><em>MASKED_PASSWORD</em></span>), ("KEYSTORE_ALIAS" =&gt; <span class="emphasis"><em>ALIAS</em></span>),("SALT" =&gt; <span class="emphasis"><em>SALT</em></span>),("ITERATION_COUNT" =&gt; <span class="emphasis"><em>ITERATION_COUNT</em></span>),("ENC_FILE_DIR" =&gt; <span class="emphasis"><em>ENC_FILE_DIR</em></span>)])</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="obtain_keystore_password_from_external_source"/>Obtain Keystore Password From External Source</h2></div></div></div><p>
					The <code class="literal">EXT</code>, <code class="literal">EXTC</code>, <code class="literal">CMD</code>, <code class="literal">CMDC</code> or <code class="literal">CLASS</code> methods can be used in vault configuration for obtaining the Java keystore password.
				</p><pre class="programlisting">&lt;vault-option name="KEYSTORE_PASSWORD" value="<span class="emphasis"><em>METHOD_TO_OBTAIN_PASSWORD</em></span>"/&gt;</pre><p>
					The description for the methods are listed as:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">{EXT}…​</span></dt><dd>
								Refers to the exact command, where the <code class="literal">…​</code> is the exact command. For example: <code class="literal">{EXT}/usr/bin/getmypassword --section 1 --query company</code>, run the <code class="literal">/usr/bin/getmypassword</code> command, which displays the password on standard output and use it as password for Security Vault’s keystore. In this example, the command is using two options: <code class="literal">--section 1</code> and <code class="literal">--query company</code>.
							</dd><dt><span class="term">{EXTC[:expiration_in_millis]}…​</span></dt><dd>
								Refers to the exact command, where the <code class="literal">…​</code> is the exact command line that is passed to the <code class="literal">Runtime.exec(String)</code> method to execute a platform command. The first line of the command output is used as the password. EXTC variant caches the passwords for <code class="literal">expiration_in_millis</code> milliseconds. Default cache expiration is <code class="literal">0 = infinity</code>. For example: <code class="literal">{EXTC:120000}/usr/bin/getmypassword --section 1 --query company</code> verifies if the cache contains <code class="literal">/usr/bin/getmypassword</code> output, if it contains the output then use it. If it does not contain the output, run the command to output it to cache and use it. In this example, the cache expires in 2 minutes, that is 120000 milliseconds.
							</dd><dt><span class="term">{CMD}…​ or {CMDC[:expiration_in_millis]}…​</span></dt><dd>
								The general command is a string delimited by <code class="literal">,</code> (comma) where the first part is the actual command and further parts represents the parameters. The comma can be backslashed to keep it as a part of the parameter. For example, <code class="literal">{CMD}/usr/bin/getmypassword,--section,1,--query,company</code>.
							</dd><dt><span class="term">{CLASS[@jboss_module_spec]}classname[:ctorargs]</span></dt><dd>
								Where the <code class="literal">[:ctorargs]</code> is an optional string delimited by the <code class="literal">:</code> (colon) from the classname is passed to the classname <code class="literal">ctor</code>. The <code class="literal">ctorargs</code> is a comma delimited list of strings. For example, <code class="literal">{CLASS@org.test.passwd}org.test.passwd.ExternamPassworProvider</code>. In this example, the <code class="literal">org.test.passwd.ExternamPassworProvider</code> class is loaded from <code class="literal">org.test.passwd</code> module and uses the <code class="literal">toCharArray()</code> method to get the password. If <code class="literal">toCharArray()</code> is not available the <code class="literal">toString()</code> method is used. The <code class="literal">org.test.passwd.ExternamPassworProvider</code> class must have the default constructor.
							</dd></dl></div></div></div></div></body></html>