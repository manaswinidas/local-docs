<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 1. Securing the Server and Its Interfaces</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="securing_the_server_and_its_interfaces"/>Chapter 1. Securing the Server and Its Interfaces</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="building_blocks"/>Building Blocks</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="interfaces_and_socket_bindings"/>Interfaces and Socket Bindings</h2></div></div></div><p>
					JBoss EAP utilizes its host’s interfaces, for example <code class="literal">inet-address</code> and <code class="literal">nic</code>, as well as ports for communication for both its web applications as well as its management interfaces. These interfaces and ports are defined and configured through the <code class="literal">interfaces</code> and <code class="literal">socket-binding-groups</code> settings in the JBoss EAP.
				</p><p>
					For more information on how to define and configure <code class="literal">interfaces</code> and <code class="literal">socket-binding-groups</code>, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#socket_bindings">Socket Bindings</a> section of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p><div class="title"><strong>Example: Interfaces</strong></div><p>
						
</p><pre class="programlisting">&lt;interfaces&gt;
  &lt;interface name="management"&gt;
    &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="public"&gt;
    &lt;inet-address value="${jboss.bind.address:127.0.0.1}"/&gt;
  &lt;/interface&gt;
&lt;/interfaces&gt;</pre><p>

					</p><div class="title"><strong>Example: Socket Binding Group</strong></div><p>
						
</p><pre class="programlisting">&lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;
    &lt;socket-binding name="management-http" interface="management" port="${jboss.management.http.port:9990}"/&gt;
    &lt;socket-binding name="management-https" interface="management" port="${jboss.management.https.port:9993}"/&gt;
    &lt;socket-binding name="ajp" port="${jboss.ajp.port:8009}"/&gt;
    &lt;socket-binding name="http" port="${jboss.http.port:8080}"/&gt;
    &lt;socket-binding name="https" port="${jboss.https.port:8443}"/&gt;
    &lt;socket-binding name="txn-recovery-environment" port="4712"/&gt;
    &lt;socket-binding name="txn-status-manager" port="4713"/&gt;
    &lt;outbound-socket-binding name="mail-smtp"&gt;
        &lt;remote-destination host="localhost" port="25"/&gt;
    &lt;/outbound-socket-binding&gt;
&lt;/socket-binding-group&gt;</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_subsystem"/>Elytron Subsystem</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="enable_elytron_security_across_server"/>Enable Elytron Security Across the Server</h3></div></div></div><p>
						There is a simple way to enable Elytron across the server. JBoss EAP 7.1 introduced an example configuration script that enables Elytron as the security provider. This script resides in the <span class="emphasis"><em>EAP_HOME</em></span>/docs/examples directory in the server installation.
					</p><p>
						Execute the following command to enable Elytron security across the server.
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh --file=EAP_HOME/docs/examples/enable-elytron.cli</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_security_domain"/>Create an Elytron Security Domain</h3></div></div></div><p>
						Security domains in the <code class="literal">elytron</code> subsystem, when used in conjunction with security realms, are used for both core management authentication as well as for authentication with applications.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Deployments are limited to using one Elytron security domain per deployment. Scenarios that may have required multiple legacy security domains can now be accomplished using a single Elytron security domain.
						</p></div><h5><a id="add_a_security_domain_using_the_management_cli"/>Add a Security Domain Using the Management CLI</h5><pre class="screen">/subsystem=elytron/security-domain=domainName:add(realms=[{realm=realmName,role-decoder=roleDecoderName}],default-realm=realmName,permission-mapper=permissionMapperName,role-mapper=roleMapperName,...)</pre><h5><a id="add_a_security_domain_using_the_management_console"/>Add a Security Domain Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Other Settings</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Select <span class="strong"><strong>SSL</strong></span> → <span class="strong"><strong>Security Domain</strong></span> and use the <span class="strong"><strong>Add</strong></span> button to configure a new security domain.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_security_realm"/>Create an Elytron Security Realm</h3></div></div></div><p>
						Security realms in the <code class="literal">elytron</code> subsystem, when used in conjunction with security domains, are used for both core management authentication as well as for authentication with applications. Security realms are also specifically typed based on their identity store, for example <code class="literal">jdbc-realm</code>, <code class="literal">filesystem-realm</code>, <code class="literal">properties-realm</code>, etc.
					</p><h5><a id="add_a_security_realm_using_the_management_cli"/>Add a Security Realm Using the Management CLI</h5><pre class="screen">/subsystem=elytron/type-of-realm=realmName:add(....)</pre><p>
						Examples of adding specific realms, such as <code class="literal">jdbc-realm</code>, <code class="literal">filesystem-realm</code>, and <code class="literal">properties-realm</code> can be found in previous sections.
					</p><h5><a id="add_a_security_realm_using_the_management_console"/>Add a Security Realm Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Security Realms</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Select the appropriate security realm type from the <span class="strong"><strong>Security Realm</strong></span> tab and click <span class="strong"><strong>Add</strong></span> to configure a new security realm.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_role_decoder"/>Create an Elytron Role Decoder</h3></div></div></div><p>
						A role decoder converts attributes from the identity provided by the security realm into roles. Role decoders are also specifically typed based on their functionality, for example <code class="literal">empty-role-decoder</code>, <code class="literal">simple-role-decoder</code>, and <code class="literal">custom-role-decoder</code>.
					</p><h5><a id="add_a_role_decoder_using_the_management_cli"/>Add a Role Decoder Using the Management CLI</h5><pre class="screen">/subsystem=elytron/ROLE-DECODER-TYPE=roleDeoderName:add(....)</pre><h5><a id="add_a_role_decoder_using_the_management_console"/>Add a Role Decoder Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Mappers / Decoders</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>Role Decoder</strong></span>, select the appropriate role decoder type and click <span class="strong"><strong>Add</strong></span> to configure a new role decoder.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_role_mapper"/>Create an Elytron Role Mapper</h3></div></div></div><p>
						A role mapper maps roles after they have been decoded to other roles. Examples include normalizing role names or adding and removing specific roles from principals after they have been decoded. Role mappers are also specifically typed based on their functionality, for example <code class="literal">add-prefix-role-mapper</code>, <code class="literal">add-suffix-role-mapper</code>, and <code class="literal">constant-role-mapper</code>.
					</p><h5><a id="adding_a_role_mapper_takes_the_general_form"/>Adding a Role Mapper Takes the General Form</h5><pre class="screen">/subsystem=elytron/ROLE-MAPPER-TYPE=roleMapperName:add(...)</pre><h5><a id="adding_a_role_mapper_using_the_management_console"/>Adding a Role Mapper Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Mappers / Decoders</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>Role Mapper</strong></span>, select the appropriate role mapper type and click <span class="strong"><strong>Add</strong></span> to configure a new role mapper.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_permission_set"/>Create an Elytron Permission Set</h3></div></div></div><p>
						Permission sets can be used to assign permissions to an identity.
					</p><h5><a id="add_a_permission_set_using_the_management_cli"/>Add a Permission Set Using the Management CLI</h5><pre class="screen">/subsystem=elytron/permission-set=PermissionSetName:add(permissions=[{class-name="...", module="...", target-name="...", action="..."}...])</pre><p>
						The <code class="literal">permissions</code> parameter consists of a set of permissions, where each permission has the following attributes:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">class-name</code> is the fully qualified class name of the permission. This is the only permission attribute that is required.
							</li><li class="listitem">
								<code class="literal">module</code> is an optional module used to load the permission.
							</li><li class="listitem">
								<code class="literal">target-name</code> is an optional target name passed to the permission as it is constructed.
							</li><li class="listitem">
								<code class="literal">action</code> is an optional action passed to the permission as it is constructed.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_eltron_permission_mapper"/>Create an Elytron Permission Mapper</h3></div></div></div><p>
						In addition to roles being assigned to a identity, permissions may also be assigned. A permission mapper assigns permissions to an identity. Permission mappers are also specifically typed based on their functionality, for example <code class="literal">logical-permission-mapper</code>, <code class="literal">simple-permission-mapper</code>, and <code class="literal">custom-permission-mapper</code>.
					</p><h5><a id="add_a_permission_mapper_using_the_management_cli"/>Add a Permission Mapper Using the Management CLI</h5><pre class="screen">/subsystem=elytron/simple-permission-mapper=PermissionMapperName:add(...)</pre><h5><a id="add_a_permission_mapper_using_the_management_console"/>Add a Permission Mapper Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Mappers / Decoders</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>Principal Decoder</strong></span>, select the appropriate principal decoder type and click <span class="strong"><strong>Add</strong></span> to configure a new principal decoder.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="creating_an_authentication_configuration"/>Creating an Authentication Configuration</h3></div></div></div><p>
						An authentication configuration contains the credentials to use when making a connection. For more information on authentication configurations, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#elytron_client_authentication">Configure Client Authentication with Elytron Client</a> in <span class="emphasis"><em>How to Configure Identity Management</em></span> for JBoss EAP.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Instead of a credential store, you can configure an Elytron security domain to use the credentials of the accessing user. For instance, a security domain can be used in conjunction with Kerberos for authenticating incoming users. Follow the instructions in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_set_up_sso_with_kerberos/#elytron_http_auth_app">Configure the Elytron Subsystem</a> in <span class="emphasis"><em>How to Set Up SSO with Kerberos</em></span> for JBoss EAP, and set <code class="literal">obtain-kerberos-ticket=true</code> in the Kerberos security factory.
						</p></div><h5><a id="add_an_authentication_configuration_using_the_management_cli"/>Add an Authentication Configuration Using the Management CLI</h5><pre class="screen">/subsystem=elytron/authentication-configuration=<span class="emphasis"><em>AUTHENTICATION_CONFIGURATION_NAME</em></span>:add(authentication-name=<span class="emphasis"><em>AUTHENTICATION_NAME</em></span>, credential-reference={clear-text=<span class="emphasis"><em>PASSWORD</em></span>})</pre><h5><a id="add_an_authentication_configuration_using_the_management_console"/>Add an Authentication Configuration Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Other Settings</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>Authentication</strong></span> → <span class="strong"><strong>Authentication Configuration</strong></span> and click <span class="strong"><strong>Add</strong></span> to configure a new authentication configuration.
							</li></ol></div><p>
						For the full list of <code class="literal">authentication-configuration</code> attributes, see <a class="link" href="reference_material.html#elytron_subsystem_components_reference" title="Elytron Subsystem Components Reference">Elytron Subsystem Components Reference</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="creating_an_authentication_context"/>Creating an Authentication Context</h3></div></div></div><p>
						An authentication context contains a set of rules and either <a class="link" href="securing_the_server_and_its_interfaces.html#creating_an_authentication_configuration" title="Creating an Authentication Configuration">authentication configurations</a> or <a class="link" href="securing_the_server_and_its_interfaces.html#using_client_ssl_context" title="Using a client-ssl-context">SSL contexts</a> to use for establishing a connection. For more information on authentication contexts, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#elytron_client_authentication">Configure Client Authentication with Elytron Client</a> in <span class="emphasis"><em>How to Configure Identity Management</em></span> for JBoss EAP.
					</p><h5><a id="add_an_authentication_context_using_the_management_cli"/>Add an Authentication Context Using the Management CLI</h5><p>
						An authentication context can be created using the following management CLI command.
					</p><pre class="screen">/subsystem=elytron/authentication-context=<span class="emphasis"><em>AUTHENTICATION_CONTEXT_NAME</em></span>:add()</pre><p>
						Typically, an authentication context will contain a set of rules and either an authentication configuration or a SSL context. The following CLI command provides demonstrates defining an authentication context that only functions when the hostname is <code class="literal">localhost</code>.
					</p><pre class="screen">/subsystem=elytron/authentication-context=<span class="emphasis"><em>AUTHENTICATION_CONTEXT_NAME</em></span>:add(match-rules=[{authentication-configuration=<span class="emphasis"><em>AUTHENTICATION_CONFIGURATION_NAME</em></span>, match-host=localhost}])</pre><h5><a id="add_an_authentication_context_using_the_management_console"/>Add an Authentication Context Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Other Settings</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>Authentication</strong></span> → <span class="strong"><strong>Authentication Context</strong></span> and click <span class="strong"><strong>Add</strong></span> to configure a new authentication context.
							</li></ol></div><p>
						For the full list of <code class="literal">authentication-context</code> attributes, see <a class="link" href="reference_material.html#elytron_subsystem_components_reference" title="Elytron Subsystem Components Reference">Elytron Subsystem Components Reference</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_authentication_factory"/>Create an Elytron Authentication Factory</h3></div></div></div><p>
						An authentication factory is an authentication policy used for specific authentication mechanisms. Authentication factories are specifically based on the authentication mechanism, for example <code class="literal">http-authentication-factory</code>, <code class="literal">sasl-authentication-factory</code> and <code class="literal">kerberos-security-factory</code>.
					</p><h5><a id="add_an_authentication_factory_using_the_management_cli"/>Add an Authentication Factory Using the Management CLI</h5><pre class="screen">/subsystem=elytron/AUTH-FACTORY-TYPE=authFactoryName:add(....)</pre><h5><a id="add_an_authentication_factory_using_the_management_console"/>Add an Authentication Factory Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Factories / Transformers</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>HTTP Factories</strong></span>, <span class="strong"><strong>SASL Factories</strong></span>, or <span class="strong"><strong>Other Factories</strong></span>, choose the appropriate factory type, and click <span class="strong"><strong>Add</strong></span> to configure a new factory.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_keystore"/>Create an Elytron Keystore</h3></div></div></div><p>
						A <code class="literal">key-store</code> is the definition of a keystore or truststore including the type of keystore, its location, and the credential for accessing it.
					</p><p>
						To generate an example keystore for use with the <code class="literal">elytron</code> subsystem, use the following command in Red Hat Enterprise Linux 7.
					</p><pre class="programlisting">$ keytool -genkeypair -alias localhost -keyalg RSA -keysize 1024 -validity 365 -keystore keystore.jks -dname "CN=localhost" -keypass secret -storepass secret</pre><h5><a id="add_a_keystore_using_the_management_cli"/>Add a Keystore Using the Management CLI</h5><p>
						To define a <code class="literal">key-store</code> in Elytron that references the newly made keystore, execute the following management CLI command. This command species the path to the keystore, relative to the file system path provided, the credential reference used for accessing the keystore, and the type of keystore.
					</p><pre class="screen">/subsystem=elytron/key-store=newKeyStore:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The above command uses <code class="literal">relative-to</code> to reference the location of the keystore file. Alternatively, you can specify the full path to the keystore in <code class="literal">path</code> and omit <code class="literal">relative-to</code>.
						</p></div><h5><a id="add_a_keystore_using_the_management_console"/>Add a Keystore Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Other Settings</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>Stores</strong></span> → <span class="strong"><strong>Key Store</strong></span> and click <span class="strong"><strong>Add</strong></span> to configure a new keystore.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_key_manager"/>Create an Elytron Key Manager</h3></div></div></div><p>
						A <code class="literal">key-manager</code> references a <code class="literal">key-store</code>, and is used in conjunction with an SSL context.
					</p><h5><a id="add_a_key_manager_using_the_management_cli"/>Add a Key Manager Using the Management CLI</h5><p>
						The following command specifies the underlying keystore to reference, the algorithm to use when initializing the key manager, and the credential reference for accessing the entries in the underlying keystore.
					</p><pre class="screen">/subsystem=elytron/key-manager=newKeyManager:add(key-store=<span class="emphasis"><em>KEY_STORE</em></span>,algorithm="PKIX",credential-reference={clear-text=secret})</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							If an algorithm is not specified, then it will be set to the default <code class="literal">KeyManagerFactory</code> algorithm name.
						</p><p>
							The available key manager algorithms are provided by the JDK in use. For example, a JDK <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">that uses SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms.
						</p></div><h5><a id="add_a_key_manager_using_the_management_console"/>Add a Key Manager Using the Management Console</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Other Settings</strong></span> and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click on <span class="strong"><strong>SSL</strong></span> → <span class="strong"><strong>Key Manager</strong></span> and click <span class="strong"><strong>Add</strong></span> to configure a new key manager.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_trust_store"/>Create an Elytron Truststore</h3></div></div></div><p>
						To create a truststore in Elytron execute the following CLI command.
					</p><pre class="screen">/subsystem=elytron/key-store=default-trust-store:add(type=JKS, relative-to=jboss.server.config.dir, path=application.truststore, credential-reference={clear-text=password})</pre><p>
						In order to successfully execute the command above you must have an <code class="literal">application.truststore</code> file inside your <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration</code> directory. The truststore must contain the certificates associated with the endpoint or a certificate chain in case the end point’s certificate is signed by a CA.
					</p><p>
						Red Hat recommends you to avoid using self-signed certificates. Ideally, certificates should be signed by a CA and your truststore should contain a certificate chain representing your <code class="literal">ROOT</code> and intermediary CAs.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create_an_elytron_trust_manager"/>Create an Elytron Trust Manager</h3></div></div></div><p>
						To define a trust manager in Elytron execute the following CLI command.
					</p><pre class="screen">/subsystem=elytron/trust-manager=default-trust-manager:add(key-store=TRUST-STORE-NAME)</pre><p>
						This sets the defined truststore as the source of the certificates that the application server trusts.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_switch_to_ootb_components"/>Using the Out of the Box Elytron Components</h3></div></div></div><p>
						JBoss EAP provides a default set of Elytron components configured in the <code class="literal">elytron</code> subsystem. You can find more details on these pre-configured components in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#elytron_ootb_example">Out of the Box</a> section of the <span class="emphasis"><em>Security Architecture</em></span> guide.
					</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="securing_management_interfaces"/>Securing Management Interfaces</h4></div></div></div><p>
							You can find more details on the enabling JBoss EAP to use the out of the box Elytron components for securing the management interfaces in the <a class="link" href="securing_users_of_the_server_and_its_management_interfaces.html#mgmt_user_authentication_with_eltyron" title="User Authentication with Elytron">User Authentication with Elytron</a> section.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="securing_applications"/>Securing Applications</h4></div></div></div><p>
							The <code class="literal">elytron</code> subsystem provides <code class="literal">application-http-authentication</code> for <code class="literal">http-authentication-factory</code> by default, which can be used to secure applications. For more information on how to configure <code class="literal">application-http-authentication</code>, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#elytron_ootb_example">Out of the Box</a> section of the <span class="emphasis"><em>Security Architecture</em></span> guide.
						</p><p>
							To configure applications to use <code class="literal">application-http-authentication</code>, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#configure-app-authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a> in <span class="emphasis"><em>How to Configure Identity Management Guide</em></span>. You can also override the default behavior of all applications using the steps in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#elytron_override_deployment_config">Override an Application’s Authentication Configuration</a> section of the JBoss EAP <span class="emphasis"><em>How to Configure Identity Management Guide</em></span>.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="enable_elytron_ssl"/>Using SSL/TLS</h4></div></div></div><p>
							JBoss EAP does provide a default one-way SSL/TLS configuration using the legacy core management authentication, but it does not provide one in the <code class="literal">elytron</code> subsystem. You can find more details on configuring SSL/TLS using the <code class="literal">elytron</code> subsystem for both the management interfaces as well as for applications in the following sections:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_mgmt" title="Enable One-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem">Enable One-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem</a>
								</li><li class="listitem">
									<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_mgmt" title="Enable Two-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem">Enable Two-Way SSL/TLS for the Management Interfaces using the Elytron Subsystem</a>
								</li><li class="listitem">
									<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_apps" title="Enable One-way SSL/TLS for Applications Using the Elytron Subsystem">Enable One-way SSL/TLS for Applications using the Elytron Subsystem</a>
								</li><li class="listitem">
									<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Enable Two-Way SSL/TLS for Applications using the Elytron Subsystem</a>
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="using_elytron_with_other_subsystems"/>Using Elytron with Other Subsystems</h4></div></div></div><p>
							In addition to securing applications and management interfaces, Elytron also integrates with other subsystems in JBoss EAP.
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">batch-jberet</code></span></dt><dd>
										You can configure the <code class="literal">batch-jberet</code> subsystem to run batch jobs using an Elytron security domain. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_batch_job_security">Configure Security for Batch Jobs</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">datasources</code></span></dt><dd>
										You can use a credential store or an Elytron security domain to provide authentication information in a datasource definition. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#datasource_security">Datasource Security</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">ejb3</code></span></dt><dd>
										You can create mappings for Elytron security domains in the <code class="literal">ejb3</code> subsystem to be referenced by deployments. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/developing_ejb_applications/#elytron_integration_ejb_subsystem">Elytron Integration with the EJB Subsystem</a> in <span class="emphasis"><em>Developing EJB Applications</em></span>.
									</dd><dt><span class="term"><code class="literal">iiop-openjdk</code></span></dt><dd>
										You can use the <code class="literal">elytron</code> subsystem to configure SSL/TLS between clients and servers using the <code class="literal">iiop-openjdk</code> subsystem. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_iiop_ssl">Configure IIOP to use SSL/TLS with the Elytron Subsystem</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">jca</code></span></dt><dd>
										You can use the <code class="literal">elytron-enabled</code> attribute to enable Elytron security for a work manager. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configuring_jca_subsystem">Configuring the JCA Subsystem</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">jgroups</code></span></dt><dd>
										You can configure the <code class="literal">SYM_ENCRYPT</code> and <code class="literal">ASYM_ENCRYPT</code> protocols to reference keystores or credential references defined in the <code class="literal">elytron</code> subsystem. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#securing_cluster">Securing a Cluster</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">mail</code></span></dt><dd>
										You can use a credential store to provide authentication information in a server definition in the <code class="literal">mail</code> subsystem. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#mail_subsystem_cred_store">Use a Credential Store for Passwords</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">messaging-activemq</code></span></dt><dd>
										You can secure remote connections to the remote connections used by the <code class="literal">messaging-activemq</code> subsystem. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#using_the_elytron_subsystem">Using the Elytron Subsystem</a> section of <span class="emphasis"><em>Configuring Messaging</em></span>.
									</dd><dt><span class="term"><code class="literal">modcluster</code></span></dt><dd>
										You can use an Elytron client <code class="literal">ssl-context</code> to communicate with a load balancer using SSL/TLS. For more information, see <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_integration_mod_cluster" title="Elytron Integration with the ModCluster Subsystem">Elytron Integration with the ModCluster Subsystem</a>.
									</dd><dt><span class="term"><code class="literal">remoting</code></span></dt><dd>
										You can configure inbound and outbound connections in the <code class="literal">remoting</code> subsystem to reference authentication contexts, SASL authentication factories, and SSL contexts defined in the <code class="literal">elytron</code> subsystem. For full details on configuring each type of connection, see <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_remoting_subsystem" title="Elytron Integration with the Remoting Subsystem">Elytron Integration with the Remoting Subsystem</a>.
									</dd><dt><span class="term"><code class="literal">resource-adapters</code></span></dt><dd>
										You can secure connections to the resource adapter using Elytron. You can enable security inflow to establish security credentials when submitting work to be executed by the work manager. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_resource_adapters_with_elytron">Configure Resource Adapters to Use the Elytron Subsystem</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
									</dd><dt><span class="term"><code class="literal">undertow</code></span></dt><dd>
										You can use the <code class="literal">elytron</code> subsystem to configure both SSL/TLS and application authentication. For more information on configuring application authentication, see <a class="link" href="securing_the_server_and_its_interfaces.html#enable_elytron_ssl" title="Using SSL/TLS">Using SSL/TLS</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#configure-app-authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a> in <span class="emphasis"><em>How to Configure Identity Management</em></span>.
									</dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="enable_and_disable_the_elytron_subsystem"/>Enable and Disable the Elytron Subsystem</h3></div></div></div><p>
						The <code class="literal">elytron</code> subsystem comes pre-configured with the default JBoss EAP profiles alongside the legacy <code class="literal">security</code> subsystem.
					</p><p>
						If you are using a profile where the <code class="literal">elytron</code> subsystem has not been configured, you can add it by adding the <code class="literal">elytron</code> extension and enabling the <code class="literal">elytron</code> subsystem.
					</p><p>
						To add the <code class="literal">elytron</code> extension required for the <code class="literal">elytron</code> subsystem:
					</p><pre class="screen">/extension=org.wildfly.extension.elytron:add()</pre><p>
						To enable the <code class="literal">elytron</code> subsystem in JBoss EAP:
					</p><pre class="screen">/subsystem=elytron:add

reload</pre><p>
						To disable the <code class="literal">elytron</code> subsystem in JBoss EAP:
					</p><pre class="screen">/subsystem=elytron:remove

reload</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Other subsystems within JBoss EAP may have dependencies on the <code class="literal">elytron</code> subsystem. If these dependencies are not resolved before disabling it, you will see errors when starting JBoss EAP.
						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="legacy_security_subsystem"/>Legacy Security Subsystem</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="enable_and_disable_the_security_subsystem"/>Enable and Disable the Security Subsystem</h3></div></div></div><p>
						To disable the security subsystem in JBoss EAP:
					</p><pre class="screen">/subsystem=security:remove</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Other subsystems within JBoss EAP may have dependencies on the security subsystem. If these dependencies are not resolved before disabling it, you will see errors when starting JBoss EAP.
						</p></div><p>
						To enable the security subsystem in JBoss EAP:
					</p><pre class="screen">/subsystem=security:add</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="legacy_security_realms"/>Legacy Security Realms</h2></div></div></div><p>
					JBoss EAP uses security realms to define authentication and authorization mechanisms, such as local, LDAP, properties, which can then be used by the management interfaces. For more background information on security realms, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#security_realms">Security Realms</a> section of the Red Hat JBoss Enterprise Application Platform <span class="emphasis"><em>Security Architecture</em></span> guide.
				</p><div class="title"><strong>Example: Security Realms</strong></div><p>
						
</p><pre class="programlisting">&lt;security-realms&gt;
  &lt;security-realm name="ManagementRealm"&gt;
    &lt;authentication&gt;
      &lt;local default-user="$local" skip-group-loading="true"/&gt;
      &lt;properties path="mgmt-users.properties" relative-to="jboss.server.config.dir"/&gt;
    &lt;/authentication&gt;
    &lt;authorization map-groups-to-roles="false"&gt;
      &lt;properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir"/&gt;
    &lt;/authorization&gt;
  &lt;/security-realm&gt;
  &lt;security-realm name="ApplicationRealm"&gt;
    &lt;authentication&gt;
      &lt;local default-user="$local" allowed-users="*" skip-group-loading="true"/&gt;
      &lt;properties path="application-users.properties" relative-to="jboss.server.config.dir"/&gt;
    &lt;/authentication&gt;
    &lt;authorization&gt;
      &lt;properties path="application-roles.properties" relative-to="jboss.server.config.dir"/&gt;
    &lt;/authorization&gt;
  &lt;/security-realm&gt;
&lt;/security-realms&gt;</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						In addition to updating the existing security realms, JBoss EAP also allows you to create new security realms. You can create new security realms via the management console as well as invoking the following command from the management CLI:
					</p><pre class="screen">/core-service=management/security-realm=NEW-REALM-NAME:add()</pre><p>
						If you create a new security realm and want to use a properties file for authentication or authorization, you must create a new properties file specifically for the new security domain. JBoss EAP does not reuse existing files used by other security domains nor does it automatically create new files specified in the configuration if they do not exist.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_authentication_and_socket_bindings_for_securing_the_management_interfaces"/>Using Authentication and Socket Bindings for Securing the Management Interfaces</h2></div></div></div><p>
					By default, JBoss EAP defines an <code class="literal">http-interface</code> to connect to the management interfaces:
				</p><pre class="screen">[standalone@localhost:9990 /] /core-service=management:read-resource(recursive=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "access" =&gt; {...},
        "ldap-connection" =&gt; undefined,
        "management-interface" =&gt; {"http-interface" =&gt; {
            "allowed-origins" =&gt; undefined,
            "console-enabled" =&gt; true,
            "http-authentication-factory" =&gt; "management-http-authentication",
            "http-upgrade" =&gt; {
                "enabled" =&gt; true,
                "sasl-authentication-factory" =&gt; "management-sasl-authentication"
            },
            "http-upgrade-enabled" =&gt; true,
            "sasl-protocol" =&gt; "remote",
            "secure-socket-binding" =&gt; undefined,
            "security-realm" =&gt; undefined,
            "server-name" =&gt; undefined,
            "socket-binding" =&gt; "management-http",
            "ssl-context" =&gt; undefined
        }},
        "security-realm" =&gt; {...},
        "service" =&gt; undefined
    }
}</pre><p>
					You can use a combination <code class="literal">socket-binding</code>, <code class="literal">http-authentication-factory</code> and <code class="literal">http-upgrade</code> to secure the management interfaces using the <code class="literal">elytron</code> subsystem. Alternatively, you can use <code class="literal">socket-binding</code> with <code class="literal">security-realm</code> to secure the management interfaces with the legacy core management authentication. You can also disable the management interfaces, and configure users of the interfaces to have various roles and access rights.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="secure_the_management_interfaces"/>How to Secure the Management Interfaces</h1></div></div></div><p>
				The following sections show how to perform various operations related to securing the JBoss EAP management interfaces and related subsystems.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The management CLI commands shown assume that you are running a JBoss EAP standalone server. For more details on using the management CLI for a JBoss EAP managed domain, see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/"><span class="emphasis"><em>Management CLI Guide</em></span></a>.
				</p></div><h3><a id="elytron_integration_with_management_cli"/>Elytron Integration with the Management CLI</h3><p>
				The management interfaces can be secured using resources from the <code class="literal">elytron</code> subsystem in the same way as it is done by the legacy security realms.
			</p><p>
				The SSL configuration for connections comes from one of these locations:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Any SSL configuration within the CLI specific configuration.
					</li><li class="listitem">
						The default SSL configuration that automatically prompts users to accept the server’s certificate.
					</li><li class="listitem">
						The java system property.
					</li></ul></div><p>
				Client configuration can be modified using the <code class="literal">wildfly-config.xml</code> file.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					If you set the <code class="literal">-Dwildfly.config.url</code> property, any file can be used by the client for configuration.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_networking_and_ports"/>Configure Networking and Ports</h2></div></div></div><p>
					Depending on the configuration of the host, JBoss EAP may be configured to use various network interfaces and ports. This allows JBoss EAP to work with different host, networking, and firewall requirements.
				</p><p>
					For more information on the networking and ports used by JBoss EAP, as well as how to configure these settings, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#network_and_port_configuration">Network and Port Configuration</a> section of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling_the_management_console"/>Disabling the Management Console</h2></div></div></div><p>
					Other clients, such as JBoss Operations Network, operate using the HTTP interface for managing JBoss EAP. In order to continue using these services, just the web-based management console itself may be disabled. This is accomplished by setting the <code class="literal">console-enabled</code> attribute to <code class="literal">false</code>:
				</p><pre class="screen">/core-service=management/management-interface=http-interface/:write-attribute(name=console-enabled,value=false)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling_remote_access_to_jmx"/>Disabling Remote Access to JMX</h2></div></div></div><p>
					Remote access to the <code class="literal">jmx</code> subsystem allows for JDK and application management operations to be triggered remotely. To disable remote access to JMX in JBoss EAP, remove the remoting connector in the <code class="literal">jmx</code> subsystem:
				</p><h4><a id="removing_the_remoting_connector"/>Removing the Remoting Connector</h4><pre class="screen">/subsystem=jmx/remoting-connector=jmx/:remove</pre><p>
					For more information on JMX, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#jmx">JMX</a> section of the Red Hat JBoss Enterprise Application Platform <span class="emphasis"><em>Security Architecture</em></span> guide.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="silent-auth"/>Silent Authentication</h2></div></div></div><p>
					The default installation of JBoss EAP contains a method of silent authentication for a local management CLI user. This allows the local user the ability to access the management CLI without user name or password authentication. This functionality is enabled as a convenience, and to assist local users running the management CLI scripts without requiring authentication. It is considered a useful feature given that access to the local configuration typically also gives the user the ability to add their own user details or otherwise disable security checks.
				</p><p>
					The convenience of silent authentication for local users can be disabled where greater security control is required. This can be achieved by removing the local element within the <code class="literal">security-realm</code> attribute of the configuration file. This is applicable to both standalone instance as well as managed domain.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						The removal of the local element should only be done if the impact on the JBoss EAP instance and its configuration is fully understood.
					</p></div><p>
					To remove silent authentication when using the <code class="literal">elytron</code> subsystem:
				</p><pre class="screen">[standalone@localhost:9990 /] /subsystem=elytron/sasl-authentication-factory=managenet-sasl-authentication:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "mechanism-configurations" =&gt; [
            {
                "mechanism-name" =&gt; "JBOSS-LOCAL-USER",
                "realm-mapper" =&gt; "local"
            },
            {
                "mechanism-name" =&gt; "DIGEST-MD5",
                "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "ManagementRealm"}]
            }
        ],
        "sasl-server-factory" =&gt; "configured",
        "security-domain" =&gt; "ManagementDomain"
    }
}

/subsystem=elytron/sasl-authentication-factory=temp-sasl-authentication:list-remove(name=mechanism-configurations,index=0)

reload</pre><p>
					To remove silent authentication when using a legacy security realm:
				</p><pre class="screen">/core-service=management/security-realm=<span class="emphasis"><em>REALM_NAME</em></span>/authentication=local:remove</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_one_way_ssl_mgmt"/>Enable One-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem</h2></div></div></div><p>
					In JBoss EAP, you can enable one-way SSL/TLS for the management interfaces using the JBoss EAP management CLI or the management console.
				</p><p>
					In the management CLI, one-way SSL/TLS can be enabled in two ways:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Using <a class="link" href="securing_the_server_and_its_interfaces.html#one_way_https_mgmt_sercurity_command" title="Using a Security Command">security command</a>.
						</li><li class="listitem">
							Using <a class="link" href="securing_the_server_and_its_interfaces.html#one_way_https_mgmt_elytron_subsystem_commands" title="Using Elytron Subsystem Commands"><code class="literal">elytron</code> subsystem commands</a>.
						</li></ul></div><h4><a id="one_way_https_mgmt_sercurity_command"/>Using a Security Command</h4><p>
					The <code class="literal">security enable-ssl-management</code> command can be used to enable one-way SSL/TLS for the management interfaces.
				</p><div class="title"><strong>Example: Wizard Usage</strong></div><p>
						
</p><pre class="screen">security enable-ssl-management --interactive

Please provide required pieces of information to enable SSL:
Key-store file name (default management.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n :y</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Once the command is executed, the management CLI will reload the server and reconnect to it.
					</p></div><h4><a id="one_way_https_mgmt_elytron_subsystem_commands"/>Using Elytron Subsystem Commands</h4><p>
					The <code class="literal">elytron</code> subsystem commands can also be used to enable one-way SSL/TLS for the management interfaces.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Configure a <code class="literal">key-store</code>.
						</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:add(path=keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The above command uses <code class="literal">relative-to</code> to reference the location of the keystore file. Alternatively, you can specify the full path to the keystore in <code class="literal">path</code> and omit <code class="literal">relative-to</code>.
							</p></div><p class="simpara">
							If the keystore file does not exist yet, the following commands can be used to generate an example key pair:
						</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")

/subsystem=elytron/key-store=httpsKS:store()</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">key-manager</code> and <code class="literal">server-ssl-context</code>.
						</p><pre class="screen">/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,algorithm="SunX509",credential-reference={clear-text=secret})

/subsystem=elytron/server-ssl-context=httpsSSC:add(key-manager=httpsKM,protocols=["TLSv1.2"])</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								You need to know what key manager algorithms are provided by the JDK you are using. For example, a JDK <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">that uses SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms. You also need to determine what HTTPS protocols you want to support. The example commands above use <code class="literal">TLSv1.2</code>. You can use the <code class="literal">cipher-suite-filter</code> argument to specify which cipher suites are allowed, and the <code class="literal">use-cipher-suites-order</code> argument to honor server cipher suite order. The <code class="literal">use-cipher-suites-order</code> attribute by default is set to <code class="literal">true</code>. This differs from the legacy <code class="literal">security</code> subsystem behavior, which defaults to honoring client cipher suite order.
							</p></div></li><li class="listitem"><p class="simpara">
							Enable HTTPS on the management interface.
						</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=httpsSSC)

/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</pre></li><li class="listitem"><p class="simpara">
							Reload the JBoss EAP instance.
						</p><pre class="screen">reload</pre></li></ol></div><p>
					One-way SSL/TLS is now enabled for the management interfaces.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
					</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						You can disable one-way SSL/TLS for the management interfaces using the <code class="literal">disable-ssl-management</code> command.
					</p><pre class="programlisting">security disable-ssl-management</pre><p>
						This command does not delete the Elytron resources. It configures the system to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration.
					</p></div><h4><a id="one_way_https_mgmt_mgmt_console"/>Using Management Console</h4><p>
					You can enable SSL for the management interface used by the management console using an SSL wizard in the management console.
				</p><p>
					To access the wizard:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li><li class="listitem">
							Navigate to <span class="strong"><strong>Runtime</strong></span>, click <span class="strong"><strong>View</strong></span> next to the appropriate server name.
						</li><li class="listitem">
							Click <span class="strong"><strong>HTTP Manageme…​</strong></span> to open the <span class="strong"><strong>HTTP Management Interface</strong></span> configuration page.
						</li><li class="listitem"><p class="simpara">
							Click <span class="strong"><strong>Enable SSL</strong></span> to launch the wizard.
						</p><p class="simpara">
							The wizard guides you through the following scenarios for enabling SSL:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									You want to create a certificate store and generate a self-signed certificate.
								</li><li class="listitem">
									You already have the certificate store on the file system, but no keystore configuration.
								</li><li class="listitem">
									You already have a keystore configuration that uses a valid certificate store.
								</li></ul></div></li></ol></div><p>
					Using the wizard, you can optionally create a truststore for mutual authentication.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_two-way_ssl_mgmt"/>Enable Two-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Obtain or generate your client keystores:
						</p><pre class="programlisting">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname "CN=client" -keypass secret -storepass secret</pre></li><li class="listitem"><p class="simpara">
							Export the client certificate:
						</p><pre class="programlisting">$ keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</pre></li><li class="listitem"><p class="simpara">
							In JBoss EAP, two-way SSL/TLS for the management interfaces can be enabled either by using a security command or by using the <code class="literal">elytron</code> subsystem commands.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Using a security command:
								</p><p class="simpara">
									The <code class="literal">security enable-ssl-management</code> command can be used to enable two-way SSL/TLS for the management interfaces.
								</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
										The following example does not validate the certificate as no chain of trust exists. If you are using a trusted certificate, then the client certificate can be validated without issue.
									</p></div><div class="title"><strong>Example: Wizard Usage</strong></div><p>
										
</p><pre class="screen">security enable-ssl-management --interactive

Please provide required pieces of information to enable SSL:
Key-store file name (default management.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y): n
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</pre><p>

									</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
										Once the command is executed, the management CLI will reload the server and attempt to reconnect to it.
									</p><p>
										To complete the two-way SSL/TLS authentication, you need to import the server certificate into the client truststore and configure your client to present the client certificate.
									</p></div></li><li class="listitem"><p class="simpara">
									Using Elytron subsystem commands:
								</p><p class="simpara">
									The <code class="literal">elytron</code> subsystem commands can also be used to enable two-way SSL/TLS for the management interfaces.
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
											Obtain or generate your keystore. Before enabling one-way SSL/TLS in JBoss EAP, you must obtain or generate the keystores, truststores and certificates you plan on using. To generate an example set of keystores, truststores, and certificates in Red Hat Enterprise Linux 7, use the following commands.
										</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
													Configure a <code class="literal">key-store</code>.
												</p><pre class="screen">/subsystem=elytron/key-store=twoWayKS:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")

/subsystem=elytron/key-store=twoWayKS:store()</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
														The above command uses <code class="literal">relative-to</code> to reference the location of the keystore file. Alternatively, you can specify the full path to the keystore in <code class="literal">path</code> and omit <code class="literal">relative-to</code>.
													</p></div></li><li class="listitem"><p class="simpara">
													Export your server certificate.
												</p><pre class="screen">/subsystem=elytron/key-store=twoWayKS:export-certificate(alias=localhost,path=/path/to/server.cer,pem=true)</pre></li><li class="listitem"><p class="simpara">
													Create a <code class="literal">key-store</code> for the server trust store and import the client certificate into the server truststore.
												</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
														The following example does not validate the certificate as no chain of trust exists. If you are using a trusted certificate, then the client certificate can be validated without issue.
													</p></div><pre class="screen">/subsystem=elytron/key-store=twoWayTS:add(path=server.truststore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayTS:import-certificate(alias=client,path=/path/to/client.cer,credential-reference={clear-text=secret},trust-cacerts=true,validate=false)

/subsystem=elytron/key-store=twoWayTS:store()</pre></li></ol></div></li><li class="listitem"><p class="simpara">
											Configure a <code class="literal">key-manager</code>, <code class="literal">trust-manager</code>, and <code class="literal">server-ssl-context</code> for the server keystore and truststore.
										</p><pre class="screen">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,credential-reference={clear-text=secret})

/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS,algorithm="SunX509")

/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM,want-client-auth=true,need-client-auth=true)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
												You need to know what key manager algorithms are provided by the JDK you are using. For example, a JDK <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">that uses SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms. You also need to determine what HTTPS protocols you want to support. The example commands above use <code class="literal">TLSv1.2</code>. You can use the <code class="literal">cipher-suite-filter</code> argument to specify which cipher suites are allowed, and the <code class="literal">use-cipher-suites-order</code> argument to honor server cipher suite order. The <code class="literal">use-cipher-suites-order</code> attribute by default is set to <code class="literal">true</code>. This differs from the legacy <code class="literal">security</code> subsystem behavior, which defaults to honoring client cipher suite order.
											</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
													Enable HTTPS on the management interface.
												</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=ssl-context, value=twoWaySSC)

/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)</pre></li><li class="listitem"><p class="simpara">
													Reload the JBoss EAP instance.
												</p><pre class="screen">reload</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
														To complete the two-way SSL/TLS authentication, you need to import the server certificate into the client truststore and configure your client to present the client certificate.
													</p></div></li><li class="listitem"><p class="simpara">
													Configure your client to use the client certificate.
												</p><p class="simpara">
													You need to configure your client to present the trusted client certificate to the server to complete the two-way SSL/TLS authentication. For example, if using a browser, you need to import the trusted certificate into the browser’s trust store.
												</p><p class="simpara">
													This results in a forced two-way SSL/TLS authentication, without changing the original authentication to the server management.
												</p><p class="simpara">
													If you want to change the original authentication method, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#configure_authentication_with_certificates">Configure Authentication with Certificates</a> in <span class="emphasis"><em>How to Configure Identity Management</em></span> for JBoss EAP.
												</p></li></ol></div></li></ol></div></li></ol></div></li></ol></div><p>
					Two-way SSL/TLS is now enabled for the management interfaces.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
					</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						You can disable two-way SSL/TLS for the management interfaces using the <code class="literal">disable-ssl-management</code> command.
					</p><pre class="programlisting">security disable-ssl-management</pre><p>
						This command does not delete the Elytron resources. It configures the system to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_sasl_mgmt"/>Enable SASL Authentication for the Management Interfaces Using the CLI Security Command</h2></div></div></div><p>
					In JBoss EAP, SASL authentication, using an elytron SASL authentication factory, can be enabled for the management interfaces with the <code class="literal">security enable-sasl-management</code> command. This command creates all of the non-existing resources required to configure authentication. By default this command associates the included SASL factory with the <code class="literal">http-interface</code>.
				</p><div class="title"><strong>Example: Enable SASL Authentication</strong></div><p>
						
</p><pre class="screen">security enable-sasl-management

Server reloaded.
Command success.
Authentication configured for management http-interface
sasl authentication-factory=management-sasl-authentication
security-domain=ManagementDomain</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Once the command is executed, the management CLI will reload the server and reconnect to it.
					</p></div><p>
					If a SASL factory already exists, then the factory is updated to use the mechanism defined by the <code class="literal">--mechanism</code> argument.
				</p><p>
					For a list of arguments, see <a class="link" href="reference_material.html#auth_security_arguments" title="Security Authorization Arguments">Authorization Security Arguments</a>.
				</p><h4><a id="reorder_sasl_mechanisms"/>Reorder SASL Mechanisms</h4><p>
					The order of defined SASL mechanisms dictate how the server authenticates the request, with the first matching mechanism being sent to the client. This order can be changed by passing a comma-separated list into the following command.
				</p><pre class="screen">security reorder-sasl-management --mechanisms-order=<span class="emphasis"><em>MECHANISM1</em></span>,<span class="emphasis"><em>MECHANISM2</em></span>,...</pre><h4><a id="disable_sasl_authentication_for_the_management_interfaces"/>Disable SASL Authentication for the Management Interfaces</h4><p>
					To remove the active SASL authentication factory use the following command.
				</p><pre class="screen">security disable-sasl-management</pre><p>
					Alternatively, the command can be used to remove specific mechanisms from the active SASL authentication factory.
				</p><pre class="screen">security disable-sasl-management --mechanism=<span class="emphasis"><em>MECHANISM</em></span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_http_auth_mgmt"/>Enable HTTP Authentication for the Management Interfaces Using the CLI Security Command</h2></div></div></div><p>
					In JBoss EAP, HTTP authentication, using an elytron HTTP authentication factory, can be enabled for the management interfaces with the <code class="literal">security enable-http-auth-management</code> command. This command can only target the <code class="literal">http-interface</code>, and with no additional arguments the included HTTP authentication factory will be associated with this interface.
				</p><div class="title"><strong>Example: Enable HTTP Authentication</strong></div><p>
						
</p><pre class="screen">security enable-http-auth-management

Server reloaded.
Command success.
Authentication configured for management http-interface
http authentication-factory=management-http-authentication
security-domain=ManagementDomain</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Once the command is executed, the management CLI will reload the server and reconnect to it.
					</p></div><p>
					If a HTTP factory already exists, then the factory is updated to use the mechanism defined by the <code class="literal">--mechanism</code> argument.
				</p><p>
					For a list of arguments, see <a class="link" href="reference_material.html#auth_security_arguments" title="Security Authorization Arguments">Authorization Security Arguments</a>.
				</p><h4><a id="disable_http_authentication_for_the_management_interfaces"/>Disable HTTP Authentication for the Management Interfaces</h4><p>
					To remove the active HTTP authentication factory use the following command.
				</p><pre class="screen">security disable-http-auth-management</pre><p>
					Alternatively, you can use the following command to remove specific mechanisms from the active HTTP authentication factory.
				</p><pre class="screen">security disable-http-auth-management --mechanism=<span class="emphasis"><em>MECHANISM</em></span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mgmt_interface_ssl"/>Configure the Management Interfaces for One-way SSL/TLS with Legacy Core Management Authentication</h2></div></div></div><p>
					Configuring the JBoss EAP management interfaces for communication only using one-way SSL/TLS provides increased security. All network traffic between the client and the management interfaces is encrypted, which reduces the risk of security attacks such as a man-in-the-middle attack.
				</p><p>
					In this procedure unencrypted communication with the JBoss EAP instance is disabled. This procedure applies to both standalone server and managed domain configurations. For a managed domain, prefix the management CLI commands with the name of the host, for example: <code class="literal">/host=master</code>.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						While performing the steps for enabling one-way SSL/TLS on the management interfaces, do not reload the configuration unless explicitly instructed. Doing so may cause you to be locked out of the management interfaces.
					</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#create_a_keystore_to_secure_the_management_interfaces" title="Create a Keystore to Secure the Management Interfaces">Create a keystore to secure the management interfaces</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#ensure_the_management_interfaces_bind_to_https" title="Ensure the Management Interfaces Bind to HTTPS">Ensure the management interfaces bind to HTTPS</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#optional_custom_socket_binding_group" title="Optional: Implement a Custom socket-binding-group"><span class="strong"><strong>Optional:</strong></span> Implement a custom <code class="literal">socket-binding-group</code></a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#create_a_new_security_realm" title="Create a New Security Realm">Create a new security realm</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#configure_management_interfaces_to_use_the_new_security_realm" title="Configure the Management Interfaces to Use the New Security Realm">Configure the management interfaces to use the new security realm</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#configure_the_management_interfaces_to_use_the_keystore" title="Configure the Management Interfaces to Use the Keystore">Configure the management interfaces to use the keystore</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#update_the_jboss_cli_xml" title="Update the jboss-cli.xml File">Update the <code class="literal">jboss-cli.xml</code></a>.
						</li></ol></div><h4><a id="create_a_keystore_to_secure_the_management_interfaces"/>Create a Keystore to Secure the Management Interfaces</h4><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						This keystore must be in JKS format as the management interfaces are not compatible with keystores in JCEKS format.
					</p></div><p>
					Use the following to generate a keystore, replacing the example values for the parameters, for example <code class="literal">alias</code>, <code class="literal">keypass</code>, <code class="literal">keystore</code>, <code class="literal">storepass</code> and <code class="literal">dname</code>, with the correct values for the environment.
				</p><pre class="programlisting">$ keytool -genkeypair -alias appserver -storetype jks -keyalg RSA -keysize 2048 -keypass password1 -keystore <span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/identity.jks -storepass password1 -dname "CN=appserver,OU=Sales,O=Systems Inc,L=Raleigh,ST=NC,C=US" -validity 730 -v</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The parameter <code class="literal">validity</code> specifies for how many days the key is valid. A value of <code class="literal">730</code> equals two years.
					</p></div><h4><a id="ensure_the_management_interfaces_bind_to_https"/>Ensure the Management Interfaces Bind to HTTPS</h4><div class="title"><strong>Running a Standalone Server</strong></div><p>
						To ensure the management interfaces bind to HTTPS, you must add the <code class="literal">management-https</code> configuration and remove the <code class="literal">management-http</code> configuration.
					</p><p>
					Use the following CLI commands to bind the management interfaces to HTTPS:
				</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=secure-socket-binding, value=management-https)

/core-service=management/management-interface=http-interface:undefine-attribute(name=socket-binding)</pre><div class="title"><strong>Running a Managed Domain</strong></div><p>
						Change the socket element within the <code class="literal">management-interface</code> attribute by adding <code class="literal">secure-port</code> and removing port configuration.
					</p><p>
					Use the following commands to bind the management interfaces to HTTPS:
				</p><pre class="screen">/host=master/core-service=management/management-interface=http-interface:write-attribute(name=secure-port,value=9993)

/host=master/core-service=management/management-interface=http-interface:undefine-attribute(name=port)</pre><h4><a id="optional_custom_socket_binding_group"/><span class="strong"><strong>Optional:</strong></span> Implement a Custom socket-binding-group</h4><p>
					If you want to use a custom <code class="literal">socket-binding-group</code>, you must ensure the <code class="literal">management-https</code> binding is defined, which by default is bound to port <code class="literal">9993</code>. You can verify this from the <code class="literal">socket-binding-group</code> attribute of the server’s configuration file or using the management CLI:
				</p><pre class="screen">/socket-binding-group=standard-sockets/socket-binding=management-https:read-resource(recursive=true)

{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "client-mappings" =&gt; undefined,
        "fixed-port" =&gt; false,
        "interface" =&gt; "management",
        "multicast-address" =&gt; undefined,
        "multicast-port" =&gt; undefined,
        "name" =&gt; "management-https",
        "port" =&gt; expression "${jboss.management.https.port:9993}"
    }
}</pre><h4><a id="create_a_new_security_realm"/>Create a New Security Realm</h4><p>
					In this example, the new security realm using HTTPS, <code class="literal">ManagementRealmHTTPS</code>, uses a properties file named <code class="literal">https-mgmt-users.properties</code> located in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/</code> directory for storing user names and passwords.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a properties file for storing user name and passwords.
						</p><p class="simpara">
							User names and passwords can be added to the file later, but for now, you need to create an empty file named <code class="literal">https-mgmt-users.properties</code> and save it to that location. The below example shows using the <code class="literal">touch</code> command, but you may also use other mechanisms, such as a text editor.
						</p><div class="title"><strong>Example: Using the touch Command to Create an Empty File</strong></div><p>
								
</p><pre class="programlisting">$ touch <span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/https-mgmt-users.properties</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Next, use the following management CLI commands to create a new security realm named <code class="literal">ManagementRealmHTTPS</code>:
						</p><pre class="screen">/core-service=management/security-realm=ManagementRealmHTTPS:add

/core-service=management/security-realm=ManagementRealmHTTPS/authentication=properties:add(path=https-mgmt-users.properties,relative-to=jboss.server.config.dir)</pre></li><li class="listitem"><p class="simpara">
							Add users to the properties file.
						</p><p class="simpara">
							At this point, you have created a new security realm and configured it to use a properties file for authentication. You must now add users to that properties file using the <code class="literal">add-user</code> script, which is available in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> directory. When running the <code class="literal">add-user</code> script, you must specify both the properties file and the security realm using the <code class="literal">-up</code> and <code class="literal">-r</code> options respectively. From there, the <code class="literal">add-user</code> script will interactively prompt you for the user name and password information to store in the <code class="literal">https-mgmt-users.properties</code> file.
						</p><pre class="programlisting">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/add-user.sh -up <span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/https-mgmt-users.properties -r ManagementRealmHTTPS
...
Enter the details of the new user to add.
Using realm 'ManagementRealmHTTPS' as specified on the command line.
...
Username : httpUser
Password requirements are listed below. To modify these restrictions edit the add-user.properties configuration file.
 - The password must not be one of the following restricted values {root, admin, administrator}
 - The password must contain at least 8 characters, 1 alphabetic character(s), 1 digit(s), 1 non-alphanumeric symbol(s)
 - The password must be different from the username
...
Password :
Re-enter Password :
About to add user 'httpUser' for realm 'ManagementRealmHTTPS'
...
Is this correct yes/no? yes
..
Added user 'httpUser' to file 'EAP_HOME/configuration/https-mgmt-users.properties'
...
Is this new user going to be used for one AS process to connect to another AS process?
e.g. for a slave host controller connecting to the master or for a Remoting connection for server to server EJB calls.
yes/no? no</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								When configuring security realms that use properties files to store usernames and passwords, it is recommended that each realm use a distinct properties file that is not shared with another realm.
							</p></div></li></ol></div><h4><a id="configure_management_interfaces_to_use_the_new_security_realm"/>Configure the Management Interfaces to Use the New Security Realm</h4><p>
					Use the following management CLI command to configure the management interfaces to use the new security realm.
				</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=security-realm,value=ManagementRealmHTTPS)</pre><h4><a id="configure_the_management_interfaces_to_use_the_keystore"/>Configure the Management Interfaces to Use the Keystore</h4><p>
					Use the below management CLI command to configure the management interfaces to use the keystore. For the parameters file, password and alias their values must be copied from the <a class="link" href="securing_the_server_and_its_interfaces.html#create_a_keystore_to_secure_the_management_interfaces" title="Create a Keystore to Secure the Management Interfaces">Create a Keystore to Secure the Management Interfaces</a> step.
				</p><pre class="screen">/core-service=management/security-realm=ManagementRealmHTTPS/server-identity=ssl:add(keystore-path=identity.jks,keystore-relative-to=jboss.server.config.dir,keystore-password=password1, alias=appserver)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						To update the keystore password, use the following CLI command:
					</p><pre class="screen">/core-service=management/security-realm=ManagementRealmHTTPS/server-identity=ssl:write-attribute(name=keystore-password,value=newpassword)</pre></div><p>
					At this point, you need to reload the server’s configuration:
				</p><pre class="screen">reload</pre><p>
					After reloading the server configuration, the log should contain the following, just before the text which states the number of services that are started:
				</p><pre class="programlisting">13:50:54,160 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0061: Http management interface listening on https://127.0.0.1:9993/management
13:50:54,162 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0052: Admin console listening on https://127.0.0.1:9993</pre><p>
					The management interfaces are now listening on port <code class="literal">9993</code>, which confirms that the procedure was successful.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						At this point, the CLI will disconnect and will be unable to reconnect since the port bindings have changed. Proceed to the <a class="link" href="securing_the_server_and_its_interfaces.html#update_the_jboss_cli_xml" title="Update the jboss-cli.xml File">next step</a> to update the <code class="literal">jboss-cli.xml</code> file to allow the management CLI to reconnect.
					</p></div><h4><a id="update_the_jboss_cli_xml"/>Update the jboss-cli.xml File</h4><p>
					If using the management CLI to perform management actions, the following changes must to be made to the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.xml</code> file:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Update the value of <code class="literal">&lt;default-protocol&gt;</code> to <code class="literal">https-remoting</code>.
						</li><li class="listitem">
							In <code class="literal">&lt;default-controller&gt;</code>, update the value of <code class="literal">&lt;protocol&gt;</code> to <code class="literal">https-remoting</code>.
						</li><li class="listitem">
							In <code class="literal">&lt;default-controller&gt;</code>, update the value of <code class="literal">&lt;port&gt;</code> to <code class="literal">9993</code>.
						</li></ul></div><div class="title"><strong>Example: <code class="literal">jboss-cli.xml</code></strong></div><p>
						
</p><pre class="programlisting">&lt;jboss-cli xmlns="urn:jboss:cli:2.0"&gt;
    &lt;default-protocol use-legacy-override="true"&gt;https-remoting&lt;/default-protocol&gt;
    &lt;!-- The default controller to connect to when 'connect' command is executed w/o arguments --&gt;
    &lt;default-controller&gt;
        &lt;protocol&gt;https-remoting&lt;/protocol&gt;
        &lt;host&gt;localhost&lt;/host&gt;
        &lt;port&gt;9993&lt;/port&gt;
    &lt;/default-controller&gt;
...</pre><p>

					</p><p>
					The next time you connect to the management interface using the management CLI, you must accept the server certificate and authenticate against the <code class="literal">ManagementRealmHTTPS</code> security realm:
				</p><div class="title"><strong>Example: Accepting Server Certificate and Authenticating</strong></div><p>
						
</p><pre class="programlisting">$ ./jboss-cli.sh -c
Unable to connect due to unrecognised server certificate
Subject    - CN=appserver,OU=Sales,O=Systems Inc,L=Raleigh,ST=NC,C=US
Issuer     - CN=appserver, OU=Sales, O=Systems Inc, L=Raleigh, ST=NC, C=US
Valid From - Tue Jun 28 13:38:48 CDT 2016
Valid To   - Thu Jun 28 13:38:48 CDT 2018
MD5 : 76:f4:81:8b:7e:c3:be:6d:ee:63:c1:7a:b7:b8:f0:fb
SHA1 : ea:e3:f1:eb:53:90:69:d0:c9:69:4a:5a:a3:20:8f:76:c1:e6:66:b6

Accept certificate? [N]o, [T]emporarily, [P]ermenantly : p
Authenticating against security realm: ManagementRealmHTTPS
Username: httpUser
Password:
[standalone@localhost:9993 /]</pre><p>

					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mgmt-interface-two-way-ssl-legacy"/>Setting up Two-way SSL/TLS for the Management Interfaces with Legacy Core Management Authentication</h2></div></div></div><p>
					Two-way SSL/TLS authentication, also known as <span class="emphasis"><em>client authentication</em></span>, authenticates both the client and the server using SSL/TLS certificates. This differs from the <a class="link" href="securing_the_server_and_its_interfaces.html#mgmt_interface_ssl" title="Configure the Management Interfaces for One-way SSL/TLS with Legacy Core Management Authentication">Configure the Management Interfaces for One-way SSL/TLS</a> section in that both the client and server each have a certificate. This provides assurance that not only is the server who it says it is, but the client is also who it says it is.
				</p><p>
					In this section the following conventions are used:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">HOST1</span></dt><dd>
								The JBoss server hostname. For example: <code class="literal">jboss.redhat.com</code>.
							</dd><dt><span class="term">HOST2</span></dt><dd>
								A suitable name for the client. For example: <code class="literal">myclient</code>. Note this is not necessarily an actual hostname.
							</dd><dt><span class="term">CA_HOST1</span></dt><dd>
								The DN (distinguished name) to use for the HOST1 certificate. For example: <code class="literal">cn=jboss,dc=redhat,dc=com</code>.
							</dd><dt><span class="term">CA_HOST2</span></dt><dd>
								The DN (distinguished name) to use for the HOST2 certificate. For example: <code class="literal">cn=myclient,dc=redhat,dc=com</code>.
							</dd></dl></div><h4><a id="prerequisites"/>Prerequisites</h4><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If a password vault is used to store the keystore and truststore passwords, which is recommended, the password vault should already be created. For more information on the password vault, see the <a class="link" href="securely_storing_credentials.html#password_vault" title="Password Vault">Password Vault</a> section as well as the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#password_vault_system">Password Vault System</a> section of the Red Hat JBoss Enterprise Application Platform 7 <span class="emphasis"><em>Security Architecture</em></span> guide.
					</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
					</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Generate the keystores.
						</p><pre class="programlisting">$ keytool -genkeypair -alias HOST1_alias -keyalg RSA -keysize 1024 -validity 365 -keystore HOST1.keystore.jks -dname "CA_HOST1" -keypass secret -storepass secret

$ keytool -genkeypair -alias HOST2_alias -keyalg RSA -keysize 1024 -validity 365 -keystore HOST2.keystore.jks -dname "CA_HOST2" -keypass secret -storepass secret</pre></li><li class="listitem"><p class="simpara">
							Export the certificates.
						</p><pre class="programlisting">$ keytool -exportcert  -keystore HOST1.keystore.jks -alias HOST1_alias -keypass secret -storepass secret -file HOST1.cer

$ keytool -exportcert  -keystore HOST2.keystore.jks -alias HOST2_alias -keypass secret -storepass secret -file HOST2.cer</pre></li><li class="listitem"><p class="simpara">
							Import the certificates into the opposing truststores.
						</p><pre class="programlisting">$ keytool -importcert -keystore HOST1.truststore.jks -storepass secret -alias HOST2_alias -trustcacerts -file HOST2.cer

$ keytool -importcert -keystore HOST2.truststore.jks -storepass secret -alias HOST1_alias -trustcacerts -file HOST1.cer</pre></li><li class="listitem"><p class="simpara">
							Define a CertificateRealm.
						</p><p class="simpara">
							Define a CertificateRealm in the configuration for the server (<code class="literal">host.xml</code> or <code class="literal">standalone.xml</code>) and point the interface to it. This can be done using the following commands:
						</p><pre class="screen">/core-service=management/security-realm=CertificateRealm:add()

/core-service=management/security-realm=CertificateRealm/server-identity=ssl:add(keystore-path=/path/to/HOST1.keystore.jks, keystore-password=secret,alias=HOST1_alias)

/core-service=management/security-realm=CertificateRealm/authentication=truststore:add(keystore-path=/path/to/HOST1.truststore.jks,keystore-password=secret)</pre></li><li class="listitem"><p class="simpara">
							Change the <code class="literal">security-realm</code> of the <code class="literal">http-interface</code> to the new CertificateRealm.
						</p><pre class="screen">/core-service=management/management-interface=http-interface:write-attribute(name=security-realm,value=CertificateRealm)</pre></li><li class="listitem"><p class="simpara">
							Add the SSL/TLS configuration for the CLI.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								In addition to adding the two-way SSL/TLS, the management interface should also be configured to bind to HTTPS. For details, see <a class="link" href="securing_the_server_and_its_interfaces.html#ensure_the_management_interfaces_bind_to_https" title="Ensure the Management Interfaces Bind to HTTPS">Ensure the Management Interfaces Bind to HTTPS</a> in the section entitled <a class="link" href="securing_the_server_and_its_interfaces.html#mgmt_interface_ssl" title="Configure the Management Interfaces for One-way SSL/TLS with Legacy Core Management Authentication">Configure the Management Interfaces for One-way SSL/TLS with Legacy Core Management Authentication</a>.
							</p></div><p class="simpara">
							Add the SSL/TLS configuration for the CLI, which uses <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.xml</code> as a settings file.
						</p><p class="simpara">
							To store the keystore and truststore passwords in plain text, edit <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.xml</code> and add the SSL/TLS configuration using the appropriate values for the variables:
						</p><div class="title"><strong>Example: jboss-cli.xml Storing Keystore and Truststore Passwords in Plain Text</strong></div><p>
								
</p><pre class="programlisting">&lt;ssl&gt;
  &lt;alias&gt;HOST2_alias&lt;/alias&gt;
  &lt;key-store&gt;/path/to/HOST2.keystore.jks&lt;/key-store&gt;
  &lt;key-store-password&gt;secret&lt;/key-store-password&gt;
  &lt;trust-store&gt;/path/to/HOST2.truststore.jks&lt;/trust-store&gt;
  &lt;trust-store-password&gt;secret&lt;/trust-store-password&gt;
  &lt;modify-trust-store&gt;true&lt;/modify-trust-store&gt;
&lt;/ssl&gt;</pre><p>

							</p><p class="simpara">
							To use the keystore and truststore passwords stored in a password vault, you need to add the vault configuration and appropriate vault values to <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.xml</code>:
						</p><div class="title"><strong>Example: jboss-cli.xml Storing Keystore and Truststore Passwords in a Password Vault</strong></div><p>
								
</p><pre class="programlisting">&lt;ssl&gt;
  &lt;vault&gt;
    &lt;vault-option name="KEYSTORE_URL" value="path-to/vault/vault.keystore"/&gt;
    &lt;vault-option name="KEYSTORE_PASSWORD" value="MASK-5WNXs8oEbrs"/&gt;
    &lt;vault-option name="KEYSTORE_ALIAS" value="vault"/&gt;
    &lt;vault-option name="SALT" value="12345678"/&gt;
    &lt;vault-option name="ITERATION_COUNT" value="50"/&gt;
    &lt;vault-option name="ENC_FILE_DIR" value="EAP_HOME/vault/"/&gt;
  &lt;/vault&gt;
  &lt;alias&gt;HOST2_alias&lt;/alias&gt;
  &lt;key-store&gt;/path/to/HOST2.keystore.jks&lt;/key-store&gt;
  &lt;key-store-password&gt;VAULT::VB::cli_pass::1&lt;/key-store-password&gt;
  &lt;key-password&gt;VAULT::VB::cli_pass::1&lt;/key-password&gt;
  &lt;trust-store&gt;/path/to/HOST2.truststore.jks&lt;/trust-store&gt;
  &lt;trust-store-password&gt;VAULT::VB::cli_pass::1&lt;/trust-store-password&gt;
  &lt;modify-trust-store&gt;true&lt;/modify-trust-store&gt;
&lt;/ssl&gt;</pre><p>

							</p></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="https_listener_reference"/>HTTPS Listener Reference</h2></div></div></div><p>
					For a full list of attributes available for the HTTPS listener, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#undertow-attribute-refs">Undertow Subsystem Attributes</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="about-cipher-suites"/>About Cipher Suites</h3></div></div></div><p>
						You can configure a list of the encryption ciphers which are allowed. For JSSE syntax, it must be a comma-separated list. For OpenSSL syntax, it must be a colon-separated list. Ensure that only one syntax is used. The default is the JVM default.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Using weak ciphers is a significant security risk. See <a class="link" href="http://www.nist.gov/manuscript-publication-search.cfm?pub_id=915295">NIST Guidelines</a> for NIST recommendations on cipher suites.
						</p></div><p>
						See the OpenSSL documentation for a <a class="link" href="https://www.openssl.org/docs/man1.1.0/apps/ciphers.html">list of available OpenSSL ciphers</a>. Note that the following are not supported:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<span class="emphasis"><em>@SECLEVEL</em></span>
							</li><li class="listitem">
								<span class="emphasis"><em>SUITEB128</em></span>
							</li><li class="listitem">
								<span class="emphasis"><em>SUITEB128ONLY</em></span>
							</li><li class="listitem">
								<span class="emphasis"><em>SUITEB192</em></span>
							</li></ul></div><p>
						See the Java documentation for a <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#Cipher">list of the standard JSSE ciphers</a>.
					</p><p>
						To update the list of enabled cipher suites, use the <span class="emphasis"><em>enabled-cipher-suites</em></span> attribute of the HTTPS listener in the <code class="literal">undertow</code> subsystem.
					</p><div class="title"><strong>Example: Management CLI Command for Updating the List of Enabled Cipher Suites</strong></div><p>
							
</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=enabled-cipher-suites,value="TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA")</pre><p>

						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The example only lists two possible ciphers, but real-world examples will likely use more.
						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="fips_compliant_cryptography"/>FIPS 140-2 Compliant Cryptography</h2></div></div></div><p>
					It is possible to configure FIPS 140-2 compliant cryptography on Red Hat Enterprise Linux using either of the following methods.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_rhel7" title="Enable FIPS 140-2 Cryptography for SSL/TLS on Red Hat Enterprise Linux 7">Using the SunPKCS11 provider with an NSS database</a>
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_bouncycastle" title="Enable FIPS 140-2 Cryptography for SSL/TLS Using Bouncy Castle">Using the third party BouncyCastle providers</a>
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configure_ssl_fips_rhel7"/>Enable FIPS 140-2 Cryptography for SSL/TLS on Red Hat Enterprise Linux 7</h3></div></div></div><p>
						You can configure Undertow to use FIPS 140-2 compliant cryptography for SSL/TLS. The scope of this configuration example is limited to Red Hat Enterprise Linux 7, using the Mozilla NSS library in FIPS mode.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Red Hat Enterprise Linux 7 must already be configured to be FIPS 140-2 compliant. For more information, see the solution titled <a class="link" href="https://access.redhat.com/knowledge/solutions/137833">How can I make RHEL 6 or RHEL 7 FIPS 140-2 compliant?</a>, which is located on the Red Hat Customer Portal.
						</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
							Using the TLS 1.2 protocol when running JBoss EAP in FIPS mode can cause a <code class="literal">NoSuchAlgorithmException</code> to occur. More details on this issue can be found in the solution titled <a class="link" href="https://access.redhat.com/solutions/1309153">NoSuchAlgorithmException: no such algorithm: SunTls12MasterSecret</a>, which is located on the Red Hat Customer Portal.
						</p><p>
							Therefore, it is not possible to configure HTTP/2 in FIPS mode because HTTP/2 requires the TLS 1.2 protocol. FIPS mode (PKCS11) supports the TLS 1 and the TLS 1.1 protocols so you can use:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									TLS 1.1 in case of Oracle/OpenJDK
								</li><li class="listitem">
									TLS 1 in case of IBM java
								</li></ul></div></div><p>
						To configure Undertow to use FIPS 140-2 compliant cryptography for SSL/TLS, you must do the following:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_nss_database" title="Configuring the NSS database">Configure the NSS database</a>.
							</li><li class="listitem">
								<a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_management_cli" title="Configure the Management CLI for FIPS 140-2 Compliant Cryptography for SSL/TLS">Configure the management CLI for FIPS 140-2 compliant cryptography for SSL/TLS</a>.
							</li><li class="listitem">
								Configure the <code class="literal">undertow</code> subsystem to use either <a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_elytron" title="Configure the Elytron and Undertow Subsystems">Elytron</a> or the <a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_legacy" title="Configure Undertow with the Legacy Core Management Authentication">legacy core management authentication</a>.
							</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The OpenSSL provider requires a private key, but it is not possible to retrieve a private key from the PKCS11 store. FIPS does not allow the export of unencrypted keys from FIPS compliant cryptographic module. Therefore, for both the <code class="literal">elytron</code> subsystem as well as legacy security, it is not possible to use the OpenSSL provider for TLS when in FIPS mode.
						</p></div><h5><a id="configure_ssl_fips_nss_database"/>Configuring the NSS database</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create a directory owned by the appropriate user to house the NSS database.
							</p><div class="title"><strong>Example Commands for Creating the NSS Database Directory</strong></div><p>
									
</p><pre class="programlisting">$ mkdir -p /usr/share/jboss-as/nssdb
$ chown jboss /usr/share/jboss-as/nssdb
$ modutil -create -dbdir /usr/share/jboss-as/nssdb</pre><p>

								</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									The <span class="emphasis"><em>jboss</em></span> user is only an example. You need to replace it with a user on your operating system that you plan on using for running JBoss EAP.
								</p></div></li><li class="listitem"><p class="simpara">
								Create the NSS configuration file: <code class="literal">/usr/share/jboss-as/nss_pkcsll_fips.cfg</code>.
							</p><p class="simpara">
								It must specify:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										a name
									</li><li class="listitem">
										the directory where the NSS library is located
									</li><li class="listitem"><p class="simpara">
										the directory where the NSS database was created in the previous step
									</p><div class="title"><strong>Example: <code class="literal">nss_pkcsll_fips.cfg</code></strong></div><p>
											
</p><pre class="screen">name = nss-fips
nssLibraryDirectory=/usr/lib64
nssSecmodDirectory=/usr/share/jboss-as/nssdb
nssDbMode = readOnly
nssModule = fips</pre><p>

										</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
											If you are not running a 64-bit version of Red Hat Enterprise Linux 6 then set <code class="literal">nssLibraryDirectory</code> to <code class="literal">/usr/lib</code> instead of <code class="literal">/usr/lib64</code>.
										</p></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Edit the Java security configuration file. This configuration file affects the entire JVM, and can be defined using either of the following methods.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										A default configuration file, <code class="literal">java.security</code>, is provided in your JDK. This file is used if no other security configuration files are specified. See the JDK vendor’s documentation for the location of this file.
									</li><li class="listitem"><p class="simpara">
										Define a custom Java security configuration file and reference it by using the <code class="literal">-Djava.security.properties=<span class="emphasis"><em>/path/to/</em></span>java.security.properties</code>. When referenced in this manner it overrides the settings in the default security file. This option is useful when having multiple JVMs running on the same host that require different security settings.
									</p><p class="simpara">
										Add the following line to your Java security configuration file:
									</p><div class="title"><strong>Example: <code class="literal">java.security</code></strong></div><p>
											
</p><pre class="screen">security.provider.1=sun.security.pkcs11.SunPKCS11 /usr/share/jboss-as/nss_pkcsll_fips.cfg</pre><p>

										</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
											The <code class="literal">nss_pkcsll_fips.cfg</code> configuration file specified in the above line is the file created in the previous step.
										</p></div><p class="simpara">
										You also need to update the following link in your configuration file from:
									</p><pre class="screen">security.provider.5=com.sun.net.ssl.internal.ssl.Provider</pre><p class="simpara">
										to
									</p><pre class="screen">security.provider.5=com.sun.net.ssl.internal.ssl.Provider SunPKCS11-nss-fips</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
											Any other <code class="literal">security.provider.X</code> lines in this file, for example <code class="literal">security.provider.2</code>, must have the value of their X increased by one to ensure that this provider is given priority.
										</p></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Run the <code class="literal">modutil</code> command on the NSS database directory you created in the previous step to enable FIPS mode.
							</p><pre class="screen">modutil -fips true -dbdir /usr/share/jboss-as/nssdb</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									You may get a security library error at this point requiring you to regenerate the library signatures for some of the NSS shared objects.
								</p></div></li><li class="listitem"><p class="simpara">
								Set the password on the FIPS token.
							</p><p class="simpara">
								The name of the token <span class="emphasis"><em>must</em></span> be <span class="emphasis"><em>NSS FIPS 140-2 Certificate DB</em></span>.
							</p><pre class="screen">modutil -changepw "NSS FIPS 140-2 Certificate DB" -dbdir /usr/share/jboss-as/nssdb</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									The password used for the FIPS token must be a FIPS compliant password. If the password is not strong enough, you may receive an error: <span class="emphasis"><em>ERROR: Unable to change password on token "NSS FIPS 140-2 Certificate DB".</em></span>
								</p></div></li><li class="listitem"><p class="simpara">
								Create a certificate using the NSS tools.
							</p><div class="title"><strong>Example Command</strong></div><p>
									
</p><pre class="programlisting">$ certutil -S -k rsa -n undertow -t "u,u,u" -x -s "CN=localhost, OU=MYOU, O=MYORG, L=MYCITY, ST=MYSTATE, C=MY" -d /usr/share/jboss-as/nssdb</pre><p>

								</p></li><li class="listitem"><p class="simpara">
								Verify that the JVM can read the private key from the PKCS11 keystore by running the following command:
							</p><pre class="screen">$ keytool -list -storetype pkcs11</pre></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Once you have FIPS enabled, you may see the following error when starting JBoss EAP:
						</p><pre class="screen">10:16:13,993 ERROR [org.jboss.msc.service.fail] (MSC service thread 1-1) MSC000001: Failed to start service jboss.server.controller.management.security_realm.ApplicationRealm.key-manager: org.jboss.msc.service.StartException in service jboss.server.controller.management.security_realm.ApplicationRealm.key-manager: WFLYDM0018: Unable to start service
	at org.jboss.as.domain.management.security.AbstractKeyManagerService.start(AbstractKeyManagerService.java:85)
	at org.jboss.msc.service.ServiceControllerImpl$StartTask.startService(ServiceControllerImpl.java:1963)
	at org.jboss.msc.service.ServiceControllerImpl$StartTask.run(ServiceControllerImpl.java:1896)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.security.KeyStoreException: FIPS mode: KeyStore must be from provider SunPKCS11-nss-fips
	at sun.security.ssl.KeyManagerFactoryImpl$SunX509.engineInit(KeyManagerFactoryImpl.java:67)
	at javax.net.ssl.KeyManagerFactory.init(KeyManagerFactory.java:256)
	at org.jboss.as.domain.management.security.AbstractKeyManagerService.createKeyManagers(AbstractKeyManagerService.java:130)
	at org.jboss.as.domain.management.security.AbstractKeyManagerService.start(AbstractKeyManagerService.java:83)
	... 5 more</pre><p>
							This message will appear if you have any existing key managers configured, such as the default key manager in legacy core management authentication, that do not use FIPS 140-2 compliant cryptography.
						</p></div><h5><a id="configure_ssl_fips_management_cli"/>Configure the Management CLI for FIPS 140-2 Compliant Cryptography for SSL/TLS</h5><p>
						You must configure the JBoss EAP management CLI to work in an environment with FIPS 140-2 compliant cryptography for SSL/TLS enabled. By default, if you try to use the management CLI in such an environment, the following exception is thrown: <code class="literal">org.jboss.as.cli.CliInitializationException: java.security.KeyManagementException: FIPS mode: only SunJSSE TrustManagers may be used</code>.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								If you are using the legacy <code class="literal">security</code> subsystem:
							</p><p class="simpara">
								Update the <code class="literal">javax.net.ssl.keyStore</code> and <code class="literal">javax.net.ssl.trustStore</code> system properties in the <code class="literal">jboss-cli.sh</code> file, as shown below:
							</p><pre class="screen">JAVA_OPTS="$JAVA_OPTS -Djavax.net.ssl.trustStore=NONE -Djavax.net.ssl.trustStoreType=PKCS11"
JAVA_OPTS="$JAVA_OPTS -Djavax.net.ssl.keyStore=NONE -Djavax.net.ssl.keyStoreType=PKCS11 -Djavax.net.ssl.keyStorePassword=P@ssword123"</pre></li><li class="listitem"><p class="simpara">
								If you are using the <code class="literal">elytron</code> subsystem:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Create an XML configuration file for the management CLI with the following contents:
									</p><div class="title"><strong>Example: <code class="literal">cli-wildfly-config.xml</code></strong></div><p>
											
</p><pre class="programlisting">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
    &lt;key-stores&gt;
      &lt;key-store name="truststore" type="PKCS11"&gt;
        &lt;key-store-clear-password password="P@ssword123"/&gt;
      &lt;/key-store&gt;
    &lt;/key-stores&gt;
    &lt;ssl-contexts&gt;
      &lt;ssl-context name="client-cli-context"&gt;
        &lt;trust-store key-store-name="truststore"/&gt;
        &lt;cipher-suite selector="${cipher.suite.filter}"/&gt;
        &lt;protocol names="TLSv1.1"/&gt;
      &lt;/ssl-context&gt;
    &lt;/ssl-contexts&gt;
    &lt;ssl-context-rules&gt;
      &lt;rule use-ssl-context="client-cli-context"/&gt;
    &lt;/ssl-context-rules&gt;
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre><p>

										</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
											If you are using the IBM JDK, see the <a class="link" href="securing_the_server_and_its_interfaces.html#fips-ibm-jdk_management_cli" title="Management CLI Configuration">IBM management CLI configuration example</a> for the specific configuration required.
										</p></div></li><li class="listitem"><p class="simpara">
										When starting the management CLI, pass the configuration file to the management CLI script using the <code class="literal">-Dwildfly.config.url</code> property. For example:
									</p><pre class="screen">$ jboss-cli.sh -Dwildfly.config.url=cli-wildfly-config.xml</pre></li></ol></div></li></ul></div><h5><a id="configure_ssl_fips_elytron"/>Configure the Elytron and Undertow Subsystems</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Add the FIPS 140-2 compliant cryptography <code class="literal">key-store</code>, <code class="literal">key-manager</code> and <code class="literal">ssl-context</code>.
							</p><pre class="screen">/subsystem=elytron/key-store=fipsKS:add(type=PKCS11,provider="SunPKCS11-nss-fips",credential-reference={clear-text="P@ssword123"})

/subsystem=elytron/key-manager=fipsKM:add(key-store=fipsKS,algorithm="SunX509",provider=SunPKCS11-nss-fips,credential-reference={clear-text="P@ssword123"})

/subsystem=elytron/server-ssl-context=fipsSSC:add(key-manager=fipsKM,protocols=["TLSv1.1"])</pre></li><li class="listitem"><p class="simpara">
								Update the <code class="literal">undertow</code> subsystem to use the new <code class="literal">ssl-context</code>.
							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									<code class="literal">https-listener</code> must always have either a <code class="literal">security-realm</code> or <code class="literal">ssl-context</code> configured. When changing between the two configurations, the commands must be executed as a single batch, as shown below.
								</p></div><pre class="screen">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=fipsSSC)
run-batch

reload</pre></li></ol></div><p>
						In the <code class="literal">elytron</code> subsystem, OpenJDK and Oracle JDK in FIPS mode restrict the usage of any advanced features that are based on providing custom <code class="literal">KeyManager</code> or <code class="literal">TrustManager</code> implementations. The following configuration attributes do not work on the server:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">server-ssl-context.security-domain</code>
							</li><li class="listitem">
								<code class="literal">trust-manager.certificate-revocation-list</code>
							</li></ul></div><h5><a id="configure_ssl_fips_legacy"/>Configure Undertow with the Legacy Core Management Authentication</h5><p>
						Optionally, you can still use the legacy core management authentication instead of the <code class="literal">elytron</code> subsystem to complete the setup of FIPS 140-2 compliant cryptography for SSL/TLS:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Configure Undertow to use SSL/TLS.
							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									The following commands below must either be run in batch mode, or the server must be reloaded after adding the <span class="emphasis"><em>ssl</em></span> server identity. The example below is shown using batch mode.
								</p></div><pre class="screen">batch

/core-service=management/security-realm=HTTPSRealm:add

/core-service=management/security-realm=HTTPSRealm/server-identity=ssl:add(keystore-provider=PKCS11, keystore-password="strongP@ssword1")

/subsystem=undertow/server=default-server/https-listener=https:add(socket-binding=https, security-realm=HTTPSRealm, enabled-protocols="TLSv1.1")

run-batch</pre><p class="simpara">
								The basic details for configuring Undertow to SSL/TLS are covered in <a class="link" href="securing_the_server_and_its_interfaces.html#setup-ssl-realm-and-undertow" title="Enable One-way SSL/TLS for Applications Using Legacy Security Realms">Setting up an SSL/TLS for Applications</a>.
							</p></li><li class="listitem"><p class="simpara">
								Configure the cipher suites used by Undertow.
							</p><p class="simpara">
								Once you have SSL/TLS configured, you need to configure the https listener and security realm to have a specific set of cipher suites enabled:
							</p><div class="title"><strong>Required Cipher Suites</strong></div><p>
									
</p><pre class="screen">SSL_RSA_WITH_3DES_EDE_CBC_SHA, SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_DSS_WITH_AES_128_CBC_SHA, TLS_DHE_RSA_WITH_AES_128_CBC_SHA, TLS_RSA_WITH_AES_256_CBC_SHA, TLS_DHE_DSS_WITH_AES_256_CBC_SHA, TLS_DHE_RSA_WITH_AES_256_CBC_SHA, TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_RSA_WITH_AES_128_CBC_SHA, TLS_ECDH_RSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA, TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_anon_WITH_AES_128_CBC_SHA, TLS_ECDH_anon_WITH_AES_256_CBC_SHA</pre><p>

								</p><p class="simpara">
								The basics behind enabling cipher suites for the https listener are covered in <a class="link" href="securing_the_server_and_its_interfaces.html#about-cipher-suites" title="About Cipher Suites">About Cipher Suites</a>. To enable cipher suites on the https listener:
							</p><div class="title"><strong>Example Command for Enabling Cipher Suites on the Https Listener</strong></div><p>
									
</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=enabled-cipher-suites,value="SSL_RSA_WITH_3DES_EDE_CBC_SHA,SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDH_RSA_WITH_AES_128_CBC_SHA,TLS_ECDH_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA,TLS_ECDH_anon_WITH_AES_128_CBC_SHA,TLS_ECDH_anon_WITH_AES_256_CBC_SHA")</pre><p>

								</p></li><li class="listitem"><p class="simpara">
								Enable cipher suites on the security realm.
							</p><div class="title"><strong>Example Command for Enabling Cipher Suites on the Security Realm</strong></div><p>
									
</p><pre class="screen">/core-service=management/security-realm=HTTPSRealm/server-identity=ssl:write-attribute(name=enabled-cipher-suites, value=[SSL_RSA_WITH_3DES_EDE_CBC_SHA, SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_DSS_WITH_AES_128_CBC_SHA, TLS_DHE_RSA_WITH_AES_128_CBC_SHA, TLS_RSA_WITH_AES_256_CBC_SHA, TLS_DHE_DSS_WITH_AES_256_CBC_SHA, TLS_DHE_RSA_WITH_AES_256_CBC_SHA, TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_RSA_WITH_AES_128_CBC_SHA, TLS_ECDH_RSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA, TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA, TLS_ECDH_anon_WITH_AES_128_CBC_SHA, TLS_ECDH_anon_WITH_AES_256_CBC_SHA])</pre><p>

								</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configure_ssl_fips_bouncycastle"/>Enable FIPS 140-2 Cryptography for SSL/TLS Using Bouncy Castle</h3></div></div></div><p>
						You can configure Undertow to use FIPS 140-2 compliant cryptography for SSL/TLS. The scope of this configuration example is limited to Red Hat Enterprise Linux 7. The Bouncy Castle JARs are not provided by Red Hat, and must be obtained directly from Bouncy Castle.
					</p><h5><a id="prerequisites_2"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Ensure your environment is <a class="link" href="reference_material.html#configure_java_bouncycastle_provider" title="Configure Your Environment to use the BouncyCastle Provider">configured to use the <code class="literal">BouncyCastle</code> provider</a>.
							</li><li class="listitem"><p class="simpara">
								A Bouncy Castle keystore must exist on the server. If one does not exist, it can be created using the following command.
							</p><pre class="screen">$ keytool -genkeypair -alias <span class="emphasis"><em>ALIAS</em></span> -keyalg RSA -keysize 2048 -keypass <span class="emphasis"><em>PASSWORD</em></span> -keystore <span class="emphasis"><em>KEYSTORE</em></span> -storetype BCFKS -storepass <span class="emphasis"><em>STORE_PASSWORD</em></span></pre></li></ul></div><h5><a id="configure_ssl_fips_management_cli_bouncycastle"/>Configure the Management CLI for FIPS 140-2 Compliant Cryptography for SSL/TLS Using Elytron</h5><p>
						You must configure the JBoss EAP management CLI to work in an environment with FIPS 140-2 compliant cryptography for SSL/TLS enabled.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create an XML configuration file for the management CLI with the following contents:
							</p><div class="title"><strong>Example: <code class="literal">cli-wildfly-config.xml</code></strong></div><p>
									
</p><pre class="programlisting">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
    &lt;key-stores&gt;
      &lt;key-store name="truststore" type="BCFKS"&gt;
        &lt;file name="${truststore.location}" /&gt;
        &lt;key-store-clear-password password="${password}" /&gt;
      &lt;/key-store&gt;
      &lt;key-store name="keystore" type="BCFKS"&gt;
        &lt;file name="${keystore.location}" /&gt;
        &lt;key-store-clear-password password="${password}" /&gt;
      &lt;/key-store&gt;
    &lt;/key-stores&gt;
    &lt;ssl-contexts&gt;
      &lt;ssl-context name="client-cli-context"&gt;
        &lt;key-store-ssl-certificate algorithm="X509" key-store-name="keystore"&gt;
          &lt;key-store-clear-password password="${password"} /&gt;
        &lt;/key-store-ssl-certificate&gt;
        &lt;trust-store key-store-name="truststore"/&gt;
        &lt;trust-manager algorithm="X509"&gt;
        &lt;/trust-manager&gt;
        &lt;cipher-suite selector="TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CCM,TLS_RSA_WITH_AES_128_CCM"/&gt;
        &lt;protocol names="TLSv1.2"/&gt;
      &lt;/ssl-context&gt;
    &lt;/ssl-contexts&gt;
    &lt;ssl-context-rules&gt;
      &lt;rule use-ssl-context="client-cli-context"/&gt;
    &lt;/ssl-context-rules&gt;
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre><p>

								</p></li><li class="listitem"><p class="simpara">
								When starting the management CLI, pass the configuration file to the management CLI script using the <code class="literal">-Dwildfly.config.url</code> property. For example:
							</p><pre class="screen">$ jboss-cli.sh -Dwildfly.config.url=cli-wildfly-config.xml</pre></li></ol></div><h5><a id="configure_ssl_fips_elytron_bouncycastle"/>Configure the Elytron and Undertow Subsystems</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Add the FIPS 140-2 compliant cryptography <code class="literal">key-store</code>, <code class="literal">key-manager</code> and <code class="literal">ssl-context</code>. When defining the keystore, the type must be <code class="literal">BCFKS</code>.
							</p><pre class="screen">/subsystem=elytron/key-store=fipsKS:add(path=<span class="emphasis"><em>KEYSTORE</em></span>,relative-to=jboss.server.config.dir,credential-reference={clear-text=<span class="emphasis"><em>STORE_PASSWORD</em></span>},type="BCFKS")

/subsystem=elytron/key-manager=fipsKM:add(key-store=fipsKS,algorithm="X509",credential-reference={clear-text=<span class="emphasis"><em>PASSWORD</em></span>})

/subsystem=elytron/server-ssl-context=fipsSSC:add(key-manager=fipsKM,protocols=["TLSv1.2"],cipher-suite-filter="TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA, TLS_DHE_DSS_WITH_AES_128_CBC_SHA, TLS_DHE_DSS_WITH_AES_128_CBC_SHA256, TLS_DHE_DSS_WITH_AES_256_CBC_SHA, TLS_DHE_DSS_WITH_AES_256_CBC_SHA256, TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256, TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384, TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA, TLS_RSA_WITH_3DES_EDE_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA256, TLS_RSA_WITH_AES_256_CBC_SHA, TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CCM,TLS_RSA_WITH_AES_128_CCM")</pre></li><li class="listitem"><p class="simpara">
								Update the <code class="literal">undertow</code> subsystem to use the new <code class="literal">ssl-context</code>.
							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									<code class="literal">https-listener</code> must always have either a <code class="literal">security-realm</code> or <code class="literal">ssl-context</code> configured. When changing between the two configurations, the commands must be executed as a single batch, as shown below.
								</p></div><pre class="screen">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=fipsSSC)
run-batch

reload</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about-fips-ibm-jdk"/>FIPS 140-2 Compliant Cryptography on IBM JDK</h2></div></div></div><p>
					On the IBM JDK, the IBM Java Cryptographic Extension (JCE) IBMJCEFIPS provider and the IBM Java Secure Sockets Extension (JSSE) FIPS 140-2 Cryptographic Module (IBMJSSE2) for multi-platforms provide FIPS 140-2 compliant cryptography.
				</p><p>
					For more information on the IBMJCEFIPS provider, see the <a class="link" href="https://www-01.ibm.com/support/knowledgecenter/SSYKE2_8.0.0/com.ibm.java.security.component.80.doc/security-component/JCEFIPSDocs/ibmjcefips.html">IBM Documentation for IBM JCEFIPS</a> and <a class="link" href="http://csrc.nist.gov/groups/STM/cmvp/documents/140-1/140sp/140sp497.pdf">NIST IBMJCEFIPS – Security Policy</a>. For more information on IBMJSSE2, see <a class="link" href="https://www-01.ibm.com/support/knowledgecenter/SSYKE2_8.0.0/com.ibm.java.security.component.80.doc/security-component/jsse2Docs/runfips.html">Running IBMJSSE2 in FIPS mode</a>.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="key_storage"/>Key Storage</h3></div></div></div><p>
						The IBM JCE does not provide a keystore. The keys are stored on the computer and do not leave its physical boundary. If the keys are moved between computers they must be encrypted.
					</p><p>
						To run <code class="literal">keytool</code> in FIPS-compliant mode use the <code class="literal">-providerClass</code> option on each command like this:
					</p><pre class="screen">keytool -list -storetype JCEKS -keystore mystore.jck -storepass mystorepass -providerClass com.ibm.crypto.fips.provider.IBMJCEFIPS</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="fips-ibm-jdk_management_cli"/>Management CLI Configuration</h3></div></div></div><p>
						To <a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_management_cli" title="Configure the Management CLI for FIPS 140-2 Compliant Cryptography for SSL/TLS">configure the management CLI for FIPS 140-2 compliant cryptography</a> on the IBM JDK, you must use a management CLI configuration file specifically for the IBM JDK, such as the following:
					</p><div class="title"><strong>Example: <code class="literal">cli-wildfly-config-ibm.xml</code></strong></div><p>
							
</p><pre class="programlisting">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
    &lt;key-stores&gt;
      &lt;key-store name="truststore" type="JKS"&gt;
        &lt;file name="/path/to/truststore"/&gt;
        &lt;key-store-clear-password password="P@ssword123"/&gt;
      &lt;/key-store&gt;
    &lt;/key-stores&gt;
    &lt;ssl-contexts&gt;
      &lt;ssl-context name="client-cli-context"&gt;
        &lt;trust-store key-store-name="truststore"/&gt;
        &lt;cipher-suite selector="${cipher.suite.filter}"/&gt;
        &lt;protocol names="TLSv1"/&gt;
      &lt;/ssl-context&gt;
    &lt;/ssl-contexts&gt;
    &lt;ssl-context-rules&gt;
      &lt;rule use-ssl-context="client-cli-context"/&gt;
    &lt;/ssl-context-rules&gt;
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre><p>

						</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="examine_fips_provider_information"/>Examine FIPS Provider Information</h3></div></div></div><p>
						To examine information about the IBMJCEFIPS used by the server, enable debug-level logging by adding <code class="literal">-Djavax.net.debug=true</code> to the <code class="literal">standalone.conf</code> or <code class="literal">domain.conf</code> files. Information about the FIPS provider is logged to the <code class="literal">server.log</code> file, for example:
					</p><pre class="screen">04:22:45,685 INFO  [stdout] (http-/127.0.0.1:8443-1) JsseJCE:  Using MessageDigest SHA from provider IBMJCEFIPS version 1.7
04:22:45,689 INFO  [stdout] (http-/127.0.0.1:8443-1) DHCrypt:  DH KeyPairGenerator  from provider from init IBMJCEFIPS version 1.7
04:22:45,754 INFO  [stdout] (http-/127.0.0.1:8443-1) JsseJCE:  Using KeyFactory DiffieHellman from provider IBMJCEFIPS version 1.7
04:22:45,754 INFO  [stdout] (http-/127.0.0.1:8443-1) JsseJCE:  Using KeyAgreement DiffieHellman from provider IBMJCEFIPS version 1.7
04:22:45,754 INFO  [stdout] (http-/127.0.0.1:8443-1) DHCrypt:  DH KeyAgreement  from provider IBMJCEFIPS version 1.7
04:22:45,754 INFO  [stdout] (http-/127.0.0.1:8443-1) DHCrypt:  DH KeyAgreement  from provider from initIBMJCEFIPS version 1.7</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure-fips-domain-rhel6"/>Starting a Managed Domain when the JVM is Running in FIPS Mode</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						It is assumed you have a managed domain, FIPS configured, as well as all necessary certificates configured. This includes having imported the domain controller’s certificate into each controller’s truststore. For more details on configuring a managed domain, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#domain_management">Domain Management</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>. For more details on configuring FIPS, see <a class="link" href="securing_the_server_and_its_interfaces.html#configure_ssl_fips_rhel7" title="Enable FIPS 140-2 Cryptography for SSL/TLS on Red Hat Enterprise Linux 7">Enable FIPS 140-2 Cryptography for SSL/TLS on Red Hat Enterprise Linux 7</a>.
					</p></div><p>
					You need to update each host controller and the master domain controller to use SSL/TLS for communication.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 in all affected packages.
					</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create an SSL/TLS security realm on the master domain controller.
						</p><p class="simpara">
							You need to create an SSL/TLS security realm on the master domain controller configured to use your NSS database as a PKCS11 provider.
						</p><div class="title"><strong>Example: Security Realm on the Master Domain Controller</strong></div><p>
								
</p><pre class="programlisting">&lt;security-realm name="HTTPSRealm"&gt;
    &lt;server-identities&gt;
        &lt;ssl&gt;
            &lt;engine enabled-protocols="TLSv1.1"/&gt;
            &lt;keystore provider="PKCS11" keystore-password="strongP@ssword1"/&gt;
        &lt;/ssl&gt;
    &lt;/server-identities&gt;
    &lt;authentication&gt;
        &lt;local default-user="\$local"/&gt;
        &lt;properties path="https-users.properties" relative-to="jboss.domain.config.dir"/&gt;
    &lt;/authentication&gt;
&lt;/security-realm&gt;</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Create an SSL/TLS security realm on each host controller.
						</p><p class="simpara">
							You need to create a security realm with an SSL/TLS truststore for authentication.
						</p><div class="title"><strong>Example: Security Realm on Each Host Controller</strong></div><p>
								
</p><pre class="programlisting">&lt;security-realm name="HTTPSRealm"&gt;
  &lt;authentication&gt;
    &lt;truststore provider="PKCS11" keystore-password="strongP@ssword1"/&gt;
  &lt;/authentication&gt;
&lt;/security-realm&gt;</pre><p>

							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								You need to repeat this process on each host.
							</p></div></li><li class="listitem"><p class="simpara">
							Secure the native interface on the master domain controller.
						</p><p class="simpara">
							You need to ensure that the native interface on the master domain controller is secured with the security realm you just created.
						</p><div class="title"><strong>Example: Native Interface</strong></div><p>
								
</p><pre class="programlisting">&lt;management-interfaces&gt;
  ...
  &lt;native-interface security-realm="HTTPSRealm"&gt;
    &lt;socket interface="management" port="${jboss.management.native.port:9999}"/&gt;
   &lt;/native-interface&gt;
&lt;/management-interfaces&gt;</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Use the SSL/TLS realm on each host controller to connect to the master domain controller.
						</p><p class="simpara">
							You need to update the security realm used for connecting to the master domain controller. This change must be done directly in the host controller’s configuration file, for example <code class="literal">host.xml</code> or <code class="literal">host-slave.xml</code>, while the server is not running.
						</p><div class="title"><strong>Example: Host Controller Configuration File</strong></div><p>
								
</p><pre class="programlisting">&lt;domain-controller&gt;
  &lt;remote security-realm="HTTPSRealm"&gt;
    &lt;discovery-options&gt;
      &lt;static-discovery name="primary" protocol="${jboss.domain.master.protocol:remote}" host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}"/&gt;
    &lt;/discovery-options&gt;
  &lt;/remote&gt;
&lt;/domain-controller&gt;</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Update how each server connects back to its host controller.
						</p><p class="simpara">
							You also need to update how each server connects back to its host controller.
						</p><div class="title"><strong>Example: Server Configuration</strong></div><p>
								
</p><pre class="programlisting">&lt;server name="my-server" group="my-server-group"&gt;
  &lt;ssl ssl-protocol="TLS" trust-manager-algorithm="SunX509" truststore-type="PKCS11" truststore-password="strongP@ssword1"/&gt;
&lt;/server&gt;</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure two-way SSL/TLS in a managed domain.
						</p><p class="simpara">
							To enable two-way SSL/TLS, add a truststore authentication method to the SSL/TLS security realm for the master domain controller, execute the following management CLI commands:
						</p><pre class="screen">/host=master/core-service=management/security-realm=HTTPSRealm/authentication=truststore:add(keystore-provider="PKCS11",keystore-password="strongP@ssword1")

reload --host=master</pre><p class="simpara">
							You also need to update each host controller’s security realm to have an SSL server identity, execute the following management CLI commands:
						</p><pre class="screen">/host=host1/core-service=management/security-realm=HTTPSRealm/server-identity=ssl:add(keystore-provider=PKCS11, keystore-password="strongP@ssword1",enabled-protocols=["TLSv1.1"])

reload --host=host1</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								You also need to ensure that each host’s certificate is imported into the domain controller’s truststore.
							</p></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="secure_console_sso"/>Secure the Management Console with Red Hat Single Sign-On</h2></div></div></div><p>
					You can secure the JBoss EAP management console with Red Hat Single Sign-On using the <code class="literal">elytron</code> subsystem.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						This feature is only available when running a standalone server and is not supported when running a managed domain. It is not supported to use Red Hat Single Sign-On to secure the management CLI.
					</p></div><p>
					Use the following steps to set up Red Hat Single Sign-On to authenticate users for the JBoss EAP management console.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#configure_rhsso_for_eap" title="Configure a Red Hat Single Sign-On Server for JBoss EAP Management">Configure a Red Hat Single Sign-On server for JBoss EAP management</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#install_rhsso_client_adapter" title="Install the Red Hat Single Sign-On Client Adapter on JBoss EAP">Install the Red Hat Single Sign-On client adapter on JBoss EAP</a>.
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#configure_eap_for_rhsso" title="Configure JBoss EAP to Use Red Hat Single Sign-On">Configure JBoss EAP to use Red Hat Single Sign-On</a>.
						</li></ol></div><h4><a id="configure_rhsso_for_eap"/>Configure a Red Hat Single Sign-On Server for JBoss EAP Management</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Download and install a Red Hat Single Sign-On server. See the Red Hat Single Sign-On <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.2/html-single/getting_started_guide/"><span class="emphasis"><em>Getting Started Guide</em></span></a> for basic instructions.
						</li><li class="listitem"><p class="simpara">
							Start the Red Hat Single Sign-On server.
						</p><p class="simpara">
							This procedure assumes that you started the server with a port offset of <code class="literal">100</code>.
						</p><pre class="screen">$ <span class="emphasis"><em>RHSSO_HOME</em></span>/bin/standalone.sh -Djboss.socket.binding.port-offset=100</pre></li><li class="listitem"><p class="simpara">
							Log in to the Red Hat Single Sign-On administration console at <a class="link" href="http://localhost:8180/auth/">http://localhost:8180/auth/</a>.
						</p><p class="simpara">
							If this is the first time you have accessed the Red Hat Single Sign-On administration console, you are prompted to create an initial administration user.
						</p></li><li class="listitem"><p class="simpara">
							Create a new realm called <code class="literal">wildfly-infra</code>.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									From the drop down next to the realm name, click <span class="strong"><strong>Add realm</strong></span>, enter <code class="literal">wildfly-infra</code> in the <span class="strong"><strong>Name</strong></span> field, and click <span class="strong"><strong>Create</strong></span>.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Create a client application called <code class="literal">wildfly-console</code>.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								The name of this client application <span class="emphasis"><em>must</em></span> be <code class="literal">wildfly-console</code>.
							</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Select <span class="strong"><strong>Clients</strong></span> and click <span class="strong"><strong>Create</strong></span>.
								</li><li class="listitem">
									Enter <code class="literal">wildfly-console</code> in the <span class="strong"><strong>Client ID</strong></span> field and click <span class="strong"><strong>Save</strong></span>.
								</li><li class="listitem">
									In the <span class="strong"><strong>Settings</strong></span> screen that appears, set <span class="strong"><strong>Access Type</strong></span> to <code class="literal">public</code>, <span class="strong"><strong>Valid Redirect URIs</strong></span> to <code class="literal">http://localhost:9990/console/*</code>, <span class="strong"><strong>Web Origins</strong></span> to <code class="literal">http://localhost:9990</code>, and click <span class="strong"><strong>Save</strong></span>.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Create a client application called <code class="literal">wildfly-management</code>.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Select <span class="strong"><strong>Clients</strong></span> and click <span class="strong"><strong>Create</strong></span>.
								</li><li class="listitem">
									Enter <code class="literal">wildfly-management</code> in the <span class="strong"><strong>Client ID</strong></span> field and click <span class="strong"><strong>Save</strong></span>.
								</li><li class="listitem">
									In the <span class="strong"><strong>Settings</strong></span> screen that appears, set <span class="strong"><strong>Access Type</strong></span> to <code class="literal">bearer-only</code> and click <span class="strong"><strong>Save</strong></span>.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Create a role to grant access to the JBoss EAP management console.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Select <span class="strong"><strong>Roles</strong></span> and click <span class="strong"><strong>Add Role</strong></span>.
								</li><li class="listitem"><p class="simpara">
									Enter <code class="literal">ADMINISTRATOR</code> in uppercase in the <span class="strong"><strong>Role Name</strong></span> field and click <span class="strong"><strong>Save</strong></span>.
								</p><p class="simpara">
									This procedure uses the <code class="literal">ADMINISTRATOR</code> role, but other roles are supported. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#rbac">Role-Based Access Control</a> section of JBoss EAP’s <span class="emphasis"><em>Security Architecture</em></span>.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							Create a user and assign the <code class="literal">ADMINISTRATOR</code> role to them.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Select <span class="strong"><strong>Users</strong></span> and click <span class="strong"><strong>Add user</strong></span>.
								</li><li class="listitem">
									Enter <code class="literal">jboss</code> in the <span class="strong"><strong>Username</strong></span> field and click <span class="strong"><strong>Save</strong></span>.
								</li><li class="listitem">
									Select the <span class="strong"><strong>Credentials</strong></span> tab and set a password for this user.
								</li><li class="listitem">
									Select the <span class="strong"><strong>Role Mappings</strong></span> tab, select <span class="strong"><strong>ADMINISTRATOR</strong></span> and click <span class="strong"><strong>Add selected</strong></span> to add the role to this user.
								</li></ol></div></li></ol></div><h4><a id="install_rhsso_client_adapter"/>Install the Red Hat Single Sign-On Client Adapter on JBoss EAP</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Download the Red Hat Single Sign-On client adapter for JBoss EAP 7 from the <a class="link" href="https://access.redhat.com/jbossnetwork/restricted/listSoftware.html?downloadType=distributions&amp;product=core.service.rhsso">software downloads page</a>.
						</li><li class="listitem">
							Unzip this file into the root directory of your JBoss EAP installation.
						</li><li class="listitem"><p class="simpara">
							Execute the <code class="literal">adapter-elytron-install-offline.cli</code> script to configure your JBoss EAP installation.
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh --file=adapter-elytron-install-offline.cli</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								This script adds the <code class="literal">keycloak</code> subsystem and other required resources in the <code class="literal">elytron</code> and <code class="literal">undertow</code> subsystems to <code class="literal">standalone.xml</code>. If you need to use a different configuration file, modify the script as needed.
							</p></div></li></ol></div><h4><a id="configure_eap_for_rhsso"/>Configure JBoss EAP to Use Red Hat Single Sign-On</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							In the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> directory, create a file called <code class="literal">protect-eap-mgmt-services.cli</code> with the following contents.
						</p><pre class="programlisting"># Create a realm for both JBoss EAP console and mgmt interface
/subsystem=keycloak/realm=wildfly-infra:add(auth-server-url=http://localhost:8180/auth,realm-public-key=<span class="emphasis"><em>REALM_PUBLIC_KEY</em></span>)

# Create a secure-deployment in order to protect mgmt interface
/subsystem=keycloak/secure-deployment=wildfly-management:add(realm=wildfly-infra,resource=wildfly-management,principal-attribute=preferred_username,bearer-only=true,ssl-required=EXTERNAL)

# Protect HTTP mgmt interface with Keycloak adapter
/core-service=management/management-interface=http-interface:undefine-attribute(name=security-realm)
/subsystem=elytron/http-authentication-factory=keycloak-mgmt-http-authentication:add(security-domain=KeycloakDomain,http-server-mechanism-factory=wildfly-management,mechanism-configurations=[{mechanism-name=KEYCLOAK,mechanism-realm-configurations=[{realm-name=KeycloakOIDCRealm,realm-mapper=keycloak-oidc-realm-mapper}]}])
/core-service=management/management-interface=http-interface:write-attribute(name=http-authentication-factory,value=keycloak-mgmt-http-authentication)
/core-service=management/management-interface=http-interface:write-attribute(name=http-upgrade, value={enabled=true, sasl-authentication-factory=management-sasl-authentication})

# Enable RBAC where roles are obtained from the identity
/core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
/core-service=management/access=authorization:write-attribute(name=use-identity-roles,value=true)

# Create a secure-server in order to publish the JBoss EAP console configuration via mgmt interface
/subsystem=keycloak/secure-server=wildfly-console:add(realm=wildfly-infra,resource=wildfly-console,public-client=true)

# reload
reload</pre></li><li class="listitem">
							In this file, replace <code class="literal"><span class="emphasis"><em>REALM_PUBLIC_KEY</em></span></code> with the value of the public key. To obtain this value, log in to the Red Hat Single Sign-On administration console, select the <code class="literal">wildfly-infra</code> realm, navigate to <span class="strong"><strong>Realm Settings</strong></span> → <span class="strong"><strong>Keys</strong></span> and click <span class="strong"><strong>Public key</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Start JBoss EAP.
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								If you modified the <code class="literal">adapter-elytron-install-offline.cli</code> script when <a class="link" href="securing_the_server_and_its_interfaces.html#install_rhsso_client_adapter" title="Install the Red Hat Single Sign-On Client Adapter on JBoss EAP">installing the Red Hat Single Sign-On client adapter</a> to use a configuration file other than <code class="literal">standalone.xml</code>, be sure to start the JBoss EAP using that configuration.
							</p></div></li><li class="listitem"><p class="simpara">
							Execute the <code class="literal">protect-eap-mgmt-services.cli</code> script.
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh --connect --file=protect-eap-mgmt-services.cli</pre></li></ol></div><p>
					Now, when you access the JBoss EAP management console at <a class="link" href="http://localhost:9990/console/">http://localhost:9990/console/</a>, you are redirected to Red Hat Single Sign-On to log in, and then redirected back to the JBoss EAP management console upon successful authentication.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="security_auditing"/>Security Auditing</h1></div></div></div><p>
				Security auditing refers to triggering events, such as writing to a log, in response to an authorization or authentication attempt. Auditing is configured differently depending on the security system in use.
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						For instructions on configuring auditing with Elytron, see <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_audit_logging" title="Elytron Audit Logging">Elytron Audit Logging</a>.
					</li><li class="listitem">
						For instructions on configuring auditing with the legacy security system, see <a class="link" href="securing_the_server_and_its_interfaces.html#configure_security_auditing_legacy" title="Configure Security Auditing for the Legacy Security Domains">Configure Security Auditing for the Legacy Security Domains</a>.
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_audit_logging"/>Elytron Audit Logging</h2></div></div></div><p>
					Audit logging for the <code class="literal">elytron</code> subsystem enables logging of Elytron authentication and authorization events within the application server. Audit log entries are stored in either <code class="literal">JSON</code> or <code class="literal">SIMPLE</code>, human readable format. By default, audit logging is disabled in Elytron.
				</p><p>
					You can enable audit logging by configuring any of the following log handlers for Elytron, and then adding them to the desired security domain:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_file_audit_logging" title="File Audit Logging">file audit logging</a>
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_periodic_file_audit_logging" title="Periodic Rotating File Audit Logging">periodic rotating file audit logging</a>
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_size_file_audit_logging" title="Size Rotating File Audit Logging">size rotating file audit logging</a>
						</li><li class="listitem">
							<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_syslog_audit_logging" title="Syslog Audit Logging">syslog audit logging</a>
						</li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Elytron audit logging is distinct from other audit logging, such as audit logging for the JBoss EAP management interfaces. For more information on management interface audit logging options, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_audit_logging">Management Audit Logging</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
					</p></div><h4><a id="elytron_file_audit_logging"/>File Audit Logging</h4><p>
					File audit logging stores audit log messages in one specified file in the file system, without dividing them into multiple files.
				</p><p>
					An Elytron file audit logger, named <code class="literal">local-audit</code>, is defined by default. Once enabled, it will write Elytron audit logs to <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/log/audit.log</code> on a standalone server, or <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/domain/log/audit.log</code> for a managed domain host.
				</p><p>
					The attributes of a file audit logger are:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">path</code> and <code class="literal">relative-to</code>: Defines the location of the log file.
						</li><li class="listitem">
							<code class="literal">synchronized</code>: Specifies whether every event should be immediately written to disk.
						</li><li class="listitem"><p class="simpara">
							<code class="literal">format</code>: Use <code class="literal">SIMPLE</code> for human readable text format, or <code class="literal">JSON</code> for storing individual events in JSON.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									You can use a command similar to the following to create a file audit log.
								</p><pre class="screen">/subsystem=elytron/file-audit-log=my_audit_log:add(path="my_audit.log",relative-to="jboss.server.log.dir",format=SIMPLE,synchronized=true)</pre></li><li class="listitem"><p class="simpara">
									Enable the defined file audit logger by adding it to a security domain.
								</p><pre class="screen">/subsystem=elytron/security-domain=domain-with-file-logger:write-attribute(name=security-event-listener, value=my_audit_log)</pre></li></ol></div></li></ul></div><h4><a id="elytron_periodic_file_audit_logging"/>Periodic Rotating File Audit Logging</h4><p>
					Periodic rotating file audit logging automatically rotates audit log files based on a configured schedule. It has the same basic attributes as the default <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_file_audit_logging" title="File Audit Logging">file audit logger</a>, with the following additional attribute:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							<code class="literal">suffix</code>: This must be in the <code class="literal">java.text.SimpleDateFormat</code> format, for example <code class="literal">.yyyy-MM-dd-HH</code>. The period of the rotation is automatically calculated based on this suffix, and the suffix is appended to the end of the log file names.
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									You can use a command similar to the following to create a periodic rotating file audit log.
								</p><pre class="screen">/subsystem=elytron/periodic-rotating-file-audit-log=my_periodic_audit_log:add(path="my_periodic_audit.log",relative-to="jboss.server.log.dir",format=SIMPLE,synchronized=false,suffix=".yyyy-MM-dd-HH")</pre></li><li class="listitem"><p class="simpara">
									Enable the defined periodic rotating file audit logger by adding it to a security domain.
								</p><pre class="screen">/subsystem=elytron/security-domain=domain-with-periodic-file-logger:write-attribute(name=security-event-listener, value=my_periodic_audit_log)</pre></li></ol></div></li></ul></div><h4><a id="elytron_size_file_audit_logging"/>Size Rotating File Audit Logging</h4><p>
					Size rotating file audit logging automatically rotates audit log files when the log file reaches a configured file size. It has the same basic attributes as the default <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_file_audit_logging" title="File Audit Logging">file audit logger</a>, with the following additional attributes:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">rotate-size</code>: The maximum size that the log file can reach before being rotated. The default is <code class="literal">2m</code> for 2 megabytes.
						</li><li class="listitem">
							<code class="literal">max-backup-index</code>: The maximum number of files to backup when rotating.
						</li><li class="listitem">
							<code class="literal">rotate-on-boot</code>: By default, a new log file is not created on server restart. You can set this to <code class="literal">true</code> to rotate the log on server restart.
						</li><li class="listitem">
							<code class="literal">suffix</code>: This optionally adds a date suffix to a rotated log. This must be in the <code class="literal">java.text.SimpleDateFormat</code> format, for example <code class="literal">.yyyy-MM-dd-HH</code>.
						</li></ul></div><p>
					When the log file size exceeds the limit defined by the <code class="literal">rotate-size</code> attribute, the suffix <code class="literal">.1</code> is appended to the end of the current file and a new log file is created. If there are any existing log files, their suffixed number is incremented by one, for example <code class="literal">audit_log.1</code> is renamed to <code class="literal">audit_log.2</code>. This happens until the maximum number of log files defined by <code class="literal">max-backup-index</code> is reached. When the <code class="literal">max-backup-index</code> is exceeded, the file that is over limit, for example <code class="literal">audit_log.99</code>, is removed.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							You can use a command similar to the following to create a size rotating file audit log.
						</p><pre class="screen">/subsystem=elytron/size-rotating-file-audit-log=my_size_log:add(path="my_size_audit.log",relative-to="jboss.server.log.dir",format=SIMPLE,synchronized=false,rotate-size="2m",max-backup-index=10)</pre></li><li class="listitem"><p class="simpara">
							Enable the defined size rotating audit logger by adding it to a security domain.
						</p><pre class="screen">/subsystem=elytron/security-domain=domain-with-size-logger:write-attribute(name=security-event-listener, value=my_size_log)</pre></li></ol></div><h4><a id="elytron_syslog_audit_logging"/>Syslog Audit Logging</h4><p>
					A syslog handler specifies the parameters by which audit log entries are sent to a syslog server, specifically the syslog server’s host name and port on which the syslog server is listening. Sending audit logging to a syslog server provides more security options than logging to a local file or local syslog server. Multiple syslog handlers can be defined and be active at the same time.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Add a syslog handler.
						</p><pre class="screen">/subsystem=elytron/syslog-audit-log=syslog-logger:add(host-name=<span class="emphasis"><em>HOST_NAME</em></span>, port=<span class="emphasis"><em>PORT</em></span>, server-address=<span class="emphasis"><em>SERVER_ADDRESS</em></span>, format=JSON, transport=UDP)</pre></li><li class="listitem"><p class="simpara">
							Enable the defined syslog audit logger by adding it to a security domain.
						</p><pre class="screen">/subsystem=elytron/security-domain=domain-with-syslog-logger:write-attribute(name=security-event-listener, value=syslog-logger)</pre></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						To send logs to syslog server over TLS, you can add the following configuration:
					</p><pre class="screen">/subsystem=elytron/syslog-audit-log=remote-audit:add(transport=SSL_TCP,server-address=127.0.0.1,port=9898,host-name=Elytron,ssl-context=audit-ssl)</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						To send security events to more destinations, mainly loggers, the <code class="literal">aggregate-security-event-listener</code> resource is used. This delivers all events to all listeners specified in the aggregate listener definition.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_custom_event_listeners"/>Custom Security Event Listeners for Elytron</h3></div></div></div><p>
						You can define a custom event listener to adjust how incoming security events are processed. This event listener can be used for custom audit logging, or to authenticate users against your internal identity storage.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create a class that implements the <code class="literal">java.util.function.Consumer&lt;org.wildfly.security.auth.server.event.SecurityEvent&gt;</code> interface. For example, the following prints a message whenever a user succeeds or fails authentication.
							</p><pre class="programlisting">public class MySecurityEventListener implements Consumer&lt;SecurityEvent&gt; {
    public void accept(SecurityEvent securityEvent) {
        if (securityEvent instanceof SecurityAuthenticationSuccessfulEvent) {
            System.err.printf("Authenticated user \"%s\"\n", securityEvent.getSecurityIdentity().getPrincipal());
        } else if (securityEvent instanceof SecurityAuthenticationFailedEvent) {
            System.err.printf("Failed authentication as user \"%s\"\n", ((SecurityAuthenticationFailedEvent)securityEvent).getPrincipal());
        }
    }
}</pre></li><li class="listitem"><p class="simpara">
								Add the JAR providing the custom event listener as a module to JBoss EAP, as outlined in <a class="link" href="securing_the_server_and_its_interfaces.html#add_custom_component_elytron" title="Add a Custom Component to Elytron">Add a Custom Component to Elytron</a>. The following is an example of the management CLI command that adds a custom event listener as a module to Elytron.
							</p><pre class="screen">/subsystem=elytron/custom-security-event-listener=<span class="emphasis"><em>LISTENER_NAME</em></span>:add(module=<span class="emphasis"><em>MODULE_NAME</em></span>, class-name=<span class="emphasis"><em>CLASS_NAME</em></span>)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									Using the <code class="literal">module</code> management CLI command to add and remove modules is provided as Technology Preview only. This command is not appropriate for use in a managed domain or when connecting to the management CLI remotely. Modules should be added and removed manually in a production environment. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#create_module_manually">Create a Custom Module Manually</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#remove_module_manually">Remove a Custom Module Manually</a> sections of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
								</p><p>
									Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
								</p><p>
									See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
								</p></div></li><li class="listitem"><p class="simpara">
								Reference the newly defined listener from the security domain, such as <code class="literal">ApplicationDomain</code>.
							</p><pre class="screen">/subsystem=elytron/security-domain=<span class="emphasis"><em>DOMAIN_NAME</em></span>:write-attribute(name=security-event-listener, value=<span class="emphasis"><em>LISTENER_NAME</em></span>)</pre></li><li class="listitem"><p class="simpara">
								Reload the server to begin receiving security events from the provided security domain.
							</p><pre class="screen">reload</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_security_auditing_legacy"/>Configure Security Auditing for the Legacy Security Domains</h2></div></div></div><p>
					The goal of an audit module is to provide a way to monitor the events in the <code class="literal">security</code> subsystem. This monitoring can be done by means of writing to a log file, email notifications, or any other measurable auditing mechanism.
				</p><p>
					Auditing uses provider modules. Both included provider modules as well as custom implementations may be used.
				</p><p>
					To configure security auditing settings for a security domain, the following steps must be performed from the management console:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Click on the <span class="strong"><strong>Configuration</strong></span> tab.
						</li><li class="listitem">
							Navigate to <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Legacy)</strong></span>.
						</li><li class="listitem">
							Select the security domain to edit and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select the <span class="strong"><strong>Audit</strong></span> tab and press <span class="strong"><strong>Add</strong></span> to add a new audit module.
						</li><li class="listitem">
							Set a name for the module and fill in the <span class="strong"><strong>Code</strong></span> field with the class name of the provider module.
						</li><li class="listitem">
							Optionally, add module options by editing the module and adding key/value pairs in the <span class="strong"><strong>Module Options</strong></span> field. Press Enter to add a new value and press Backspace to remove an existing value.
						</li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_one_way_and_two_way_ssl_tls_for_application"/>Configure One-way and Two-way SSL/TLS for Applications</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="automatic_self_signed_cert_creation"/>Automatic Self-signed Certificate Creation for Applications</h2></div></div></div><p>
					When using the legacy security realms, JBoss EAP provides automatic generation of self-signed certificate for development purposes.
				</p><div class="title"><strong>Example: Server Log Showing Self-signed Certificate Creation</strong></div><p>
						
</p><pre class="screen">15:26:09,031 WARN  [org.jboss.as.domain.management.security] (MSC service thread 1-7) WFLYDM0111: Keystore /path/to/jboss/standalone/configuration/application.keystore not found, it will be auto generated on first use with a self signed certificate for host localhost
...
15:26:10,076 WARN  [org.jboss.as.domain.management.security] (MSC service thread 1-2) WFLYDM0113: Generated self signed certificate at /path/to/jboss/configuration/application.keystore. Please note that self signed certificates are not secure, and should only be used for testing purposes. Do not use this self signed certificate in production.
SHA-1 fingerprint of the generated key is 00:11:22:33:44:55:66:77:88:99:aa:bb:cc:dd:ee:ff:00:11:22:33
SHA-256 fingerprint of the generated key is 00:11:22:33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee:ff:00:11:22:33:44:55:66:77:88:99:aa:bb:cc:dd:ee
...</pre><p>

					</p><p>
					This certificate is created for testing purposes and is assigned to the HTTPS interface used by applications. The keystore containing the certificate will be generated if the file does not exist the first time the HTTPS interface is accessed.
				</p><div class="title"><strong>Example: Default ApplicationRealm Using the Self-signed Certificate</strong></div><p>
						
</p><pre class="programlisting">&lt;security-realm name="ApplicationRealm"&gt;
  &lt;server-identities&gt;
    &lt;ssl&gt;
      &lt;keystore path="application.keystore" relative-to="jboss.server.config.dir" keystore-password="password" alias="server" key-password="password" generate-self-signed-certificate-host="localhost"/&gt;
    &lt;/ssl&gt;
  &lt;/server-identities&gt;
  ...
&lt;/security-realm&gt;</pre><p>

					</p><div class="title"><strong>Example: Default HTTPS Interface Configuration</strong></div><p>
						
</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0"&gt;
    ...
    &lt;server name="default-server"&gt;
        ...
        &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;host name="default-host" alias="localhost"&gt;
        ...</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If you want to disable the self-signed certificate creation, you will need to remove the <code class="literal">generate-self-signed-certificate-host="localhost"</code> from the server keystore configuration. The <code class="literal">generate-self-signed-certificate-host</code> attribute holds the host name for which the self-signed certificate should be generated.
					</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						This self-signed certificate is intended for testing purposes only and is not intended for use in production environments. For more information on configuring SSL/TLS for applications with Elytron, see the <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_apps" title="Enable One-way SSL/TLS for Applications Using the Elytron Subsystem">Enable One-way SSL/TLS for Applications using the Elytron Subsystem</a> and <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Enable Two-way SSL/TLS for Applications using the Elytron Subsystem</a> sections. For more information on configuring SSL/TLS for applications with legacy security, see the <a class="link" href="securing_the_server_and_its_interfaces.html#setup-ssl-realm-and-undertow" title="Enable One-way SSL/TLS for Applications Using Legacy Security Realms">Enable One-way SSL/TLS for Applications Using Legacy Security Realms</a> and <a class="link" href="securing_the_server_and_its_interfaces.html#application_two-way_ssl" title="Enable Two-way SSL/TLS for Applications Using Legacy Security Realms">Enable Two-way SSL/TLS for Applications Using Legacy Security Realms</a> sections.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_elytron"/>Using Elytron</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_one_way_ssl_apps"/>Enable One-way SSL/TLS for Applications Using the Elytron Subsystem</h3></div></div></div><p>
						In JBoss EAP, you can enable one-way SSL/TLS for the for deployed applications using the JBoss EAP management CLI or the management console.
					</p><p>
						In the management CLI, one-way SSL/TLS can be enabled in two ways:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Using <a class="link" href="securing_the_server_and_its_interfaces.html#one_way_https_apps_sercurity_command" title="Using a Security Command">security command</a>.
							</li><li class="listitem">
								Using <a class="link" href="securing_the_server_and_its_interfaces.html#one_way_https_apps_elytron_subsystem_commands" title="Using Elytron Subsystem Commands"><code class="literal">elytron</code> subsystem commands</a>.
							</li></ul></div><h5><a id="one_way_https_apps_sercurity_command"/>Using a Security Command</h5><p>
						The <code class="literal">security enable-ssl-http-server</code> command can be used to enable one-way SSL/TLS for deployed applications.
					</p><div class="title"><strong>Example: Wizard Usage</strong></div><p>
							
</p><pre class="programlisting">security enable-ssl-http-server --interactive

Please provide required pieces of information to enable SSL:
Key-store file name (default default-server.keystore): keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): n

SSL options:
key store file: keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
Server keystore file keystore.jks, certificate file keystore.pem and keystore.csr file
will be generated in server configuration directory.
Do you confirm y/n: y</pre><p>

						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Once the command is executed, the management CLI will reload the server.
						</p></div><p>
						One-way SSL/TLS is now enabled for applications.
					</p><h5><a id="one_way_https_apps_elytron_subsystem_commands"/>Using Elytron Subsystem Commands</h5><p>
						In JBoss EAP, you can use the <code class="literal">elytron</code> subsystem, along with the <code class="literal">undertow</code> subsystem, to enable one-way SSL/TLS for deployed applications.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Configure a <code class="literal">key-store</code> in JBoss EAP.
							</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:add(path=/path/to/keystore.jks, credential-reference={clear-text=secret}, type=JKS)</pre><p class="simpara">
								If the keystore file does not exist yet, the following commands can be used to generate an example key pair:
							</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")

/subsystem=elytron/key-store=httpsKS:store()</pre></li><li class="listitem"><p class="simpara">
								Configure a <code class="literal">key-manager</code> that references your <code class="literal">key-store</code>.
							</p><pre class="screen">/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS, algorithm="SunX509", credential-reference={clear-text=secret})</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									You need to know what key manager algorithms are provided by the JDK you are using. For example, a JDK that uses <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms.
								</p><p>
									The example command above uses <code class="literal">SunX509</code> for the key manager algorithm.
								</p></div></li><li class="listitem"><p class="simpara">
								Configure a <code class="literal">server-ssl-context</code> that references your <code class="literal">key-manager</code>.
							</p><pre class="screen">/subsystem=elytron/server-ssl-context=httpsSSC:add(key-manager=httpsKM, protocols=["TLSv1.2"])</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									You need to determine what SSL/TLS protocols you want to support. The example command above uses <code class="literal">TLSv1.2</code>. You can use the <code class="literal">cipher-suite-filter</code> argument to specify which cipher suites are allowed, and the <code class="literal">use-cipher-suites-order</code> argument to honor server cipher suite order. The <code class="literal">use-cipher-suites-order</code> attribute by default is set to <code class="literal">true</code>. This differs from the legacy <code class="literal">security</code> subsystem behavior, which defaults to honoring client cipher suite order.
								</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
									Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
								</p></div></li><li class="listitem"><p class="simpara">
								Check and see if the <code class="literal">https-listener</code> is configured to use a legacy security realm for its SSL configuration.
							</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</pre><p class="simpara">
								The above command shows that the <code class="literal">https-listener</code> is configured to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration. Undertow cannot reference both a legacy security realm and an <code class="literal">ssl-context</code> in Elytron at the same time so you must remove the reference to the legacy security realm.
							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									If the result is <code class="literal">undefined</code>, you do not need to remove the reference to the security realm in the next step.
								</p></div></li><li class="listitem"><p class="simpara">
								Remove the reference to the legacy security realm, and update the <code class="literal">https-listener</code> to use the <code class="literal">ssl-context</code> from Elytron.
							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									<code class="literal">https-listener</code> must always have either a <code class="literal">security-realm</code> or <code class="literal">ssl-context</code> configured. When changing between the two configurations, the commands must be executed as a single batch, as shown below.
								</p></div><pre class="screen">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context, value=httpsSSC)
run-batch</pre></li><li class="listitem"><p class="simpara">
								Reload the server.
							</p><pre class="screen">reload</pre><p class="simpara">
								One-way SSL/TLS is now enabled for applications.
							</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							You can disable one-way SSL/TLS for deployed applications using the <code class="literal">disable-ssl-http-server</code> command.
						</p><pre class="programlisting">security disable-ssl-http-server</pre><p>
							This command does not delete the Elytron resources. It configures the system to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration.
						</p></div><h5><a id="using_management_console"/>Using Management Console</h5><p>
						You can enable SSL for applications by configuring the <code class="literal">undertow</code> subsystem using an SSL wizard in the management console.
					</p><p>
						To access the wizard:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Server</strong></span>.
							</li><li class="listitem">
								Click the name of the server to configure.
							</li><li class="listitem">
								Click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Navigate to <span class="strong"><strong>Listener</strong></span> → <span class="strong"><strong>HTTPS Listener</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Select the listener for which SSL is to be enabled, and click <span class="strong"><strong>Enable SSL</strong></span> to launch the wizard.
							</p><p class="simpara">
								The wizard guides you through the following scenarios for enabling SSL:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										You want to create a certificate store and generate a self-signed certificate.
									</li><li class="listitem">
										You already have the certificate store on the file system, but no keystore configuration.
									</li><li class="listitem">
										You already have a keystore configuration that uses a valid certificate store.
									</li></ul></div></li></ol></div><p>
						Using the wizard, you can optionally create a truststore for mutual authentication.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_two-way_ssl_apps"/>Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem</h3></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Obtain or generate your client keystores:
							</p><pre class="programlisting">$ keytool -genkeypair -alias client -keyalg RSA -keysize 1024 -validity 365 -keystore client.keystore.jks -dname "CN=client" -keypass secret -storepass secret</pre></li><li class="listitem"><p class="simpara">
								Export the client certificate:
							</p><pre class="programlisting">keytool -exportcert  -keystore client.keystore.jks -alias client -keypass secret -storepass secret -file /path/to/client.cer</pre></li><li class="listitem"><p class="simpara">
								Enable two-way SSL/TLS for deployed applications.
							</p><p class="simpara">
								In JBoss EAP, two-way SSL/TLS for deployed applications can be enabled either by using a security command or by using the <code class="literal">elytron</code> subsystem commands.
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Using a security command.
									</p><p class="simpara">
										The <code class="literal">security enable-ssl-http-server</code> command can be used to enable two-way SSL/TLS for the deployed applications.
									</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
											The following example does not validate the certificate as no chain of trust exists. If you are using a trusted certificate, then the client certificate can be validated without issue.
										</p></div><div class="title"><strong>Example: Wizard Usage</strong></div><p>
											
</p><pre class="programlisting">security enable-ssl-http-server --interactive

Please provide required pieces of information to enable SSL:
Key-store file name (default default-server.keystore): server.keystore.jks
Password (blank generated): secret
What is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]:
What is the name of your organization? [Unknown]:
What is the name of your City or Locality? [Unknown]:
What is the name of your State or Province? [Unknown]:
What is the two-letter country code for this unit? [Unknown]:
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct y/n [y]?
Validity (in days, blank default): 365
Alias (blank generated): localhost
Enable SSL Mutual Authentication y/n (blank n): y
Client certificate (path to pem file): /path/to/client.cer
Validate certificate y/n (blank y): n
Trust-store file name (management.truststore): server.truststore.jks
Password (blank generated): secret

SSL options:
key store file: server.keystore.jks
distinguished name: CN=localhost, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown
password: secret
validity: 365
alias: localhost
client certificate: /path/to/client.cer
trust store file: server.trustore.jks
trust store password: secret
Server keystore file server.keystore.jks, certificate file server.pem and server.csr file will be generated in server configuration directory.
Server truststore file server.trustore.jks will be generated in server configuration directory.
Do you confirm y/n: y</pre><p>

										</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
											Once the command is executed, the management CLI will reload the server.
										</p><p>
											To complete the two-way SSL/TLS authentication, you need to import the server certificate into the client truststore and configure your client to present the client certificate.
										</p></div></li><li class="listitem"><p class="simpara">
										Using elytron subsystem commands.
									</p><p class="simpara">
										In JBoss EAP, you can also use the <code class="literal">elytron</code> subsystem, along with the <code class="literal">undertow</code> subsystem, to enable two-way SSL/TLS for deployed applications.
									</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
												Obtain or generate your keystore.
											</p><p class="simpara">
												Before enabling two-way SSL/TLS in JBoss EAP, you must obtain or generate the keystores, truststores and certificates you plan on using.
											</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
														Create a server keystore:
													</p><pre class="screen">/subsystem=elytron/key-store=twoWayKS:add(path=<span class="emphasis"><em>/PATH/TO</em></span>/server.keystore.jks,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayKS:generate-key-pair(alias=localhost,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=localhost")

/subsystem=elytron/key-store=twoWayKS:store()</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
															The command above uses an absolute path to the keystore. Alternatively you can use the <code class="literal">relative-to</code> attribute to specify the base directory variable and <code class="literal">path</code> specify a relative path.
														</p><pre class="screen">/subsystem=elytron/key-store=twoWayKS:add(path=server.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)</pre></div></li><li class="listitem"><p class="simpara">
														Export the server certificate:
													</p><pre class="screen">/subsystem=elytron/key-store=twoWayKS:export-certificate(alias=localhost,path=/path/to/server.cer,pem=true)</pre></li></ol></div></li><li class="listitem"><p class="simpara">
												Create a keystore for the server truststore and import the client certificate into the server truststore.
											</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
													The following example does not validate the certificate as no chain of trust exists. If you are using a trusted certificate, then the client certificate can be validated without issue.
												</p></div><pre class="screen">/subsystem=elytron/key-store=twoWayTS:add(path=/path/to/server.truststore.jks,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=twoWayTS:import-certificate(alias=client,path=/path/to/client.cer,credential-reference={clear-text=secret},trust-cacerts=true,validate=false)

/subsystem=elytron/key-store=twoWayTS:store()</pre></li><li class="listitem"><p class="simpara">
												Configure a <code class="literal">key-manager</code> that references your keystore <code class="literal">key-store</code>.
											</p><pre class="screen">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS, algorithm="SunX509", credential-reference={clear-text=secret})</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
													You need to know what key manager algorithms are provided by the JDK you are using. For example, a JDK that uses <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms.
												</p><p>
													The example command below uses <code class="literal">SunX509</code> for the key manager algorithm.
												</p></div></li><li class="listitem"><p class="simpara">
												Configure a <code class="literal">trust-manager</code> that references your truststore <code class="literal">key-store</code>.
											</p><pre class="screen">/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS, algorithm="SunX509")</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
													You need to know what key manager algorithms are provided by the JDK you are using. For example, a JDK that uses <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms.
												</p><p>
													The example command above uses <code class="literal">SunX509</code> for the key manager algorithm.
												</p></div></li><li class="listitem"><p class="simpara">
												Configure a <code class="literal">server-ssl-context</code> that references your <code class="literal">key-manager</code>, <code class="literal">trust-manager</code>, and enables client authentication:
											</p><pre class="screen">/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM, protocols=["TLSv1.2"], trust-manager=twoWayTM, need-client-auth=true)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
													You need to determine what SSL/TLS protocols you want to support. The example command above uses <code class="literal">TLSv1.2</code>. You can use the <code class="literal">cipher-suite-filter</code> argument to specify which cipher suites are allowed, and the <code class="literal">use-cipher-suites-order</code> argument to honor server cipher suite order. The <code class="literal">use-cipher-suites-order</code> attribute by default is set to <code class="literal">true</code>. This differs from the legacy <code class="literal">security</code> subsystem behavior, which defaults to honoring client cipher suite order.
												</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
													Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
												</p></div></li><li class="listitem"><p class="simpara">
												Check and see if the <code class="literal">https-listener</code> is configured to use a legacy security realm for its SSL configuration.
											</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</pre><p class="simpara">
												The above command shows that the <code class="literal">https-listener</code> is configured to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration. Undertow cannot reference both a legacy security realm and an <code class="literal">ssl-context</code> in the <code class="literal">elytron</code> subsystem at the same time. So you must remove the reference to the legacy security realm.
											</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
													If the result is <code class="literal">undefined</code>, you do not need to remove the reference to the security realm in the next step.
												</p></div></li><li class="listitem"><p class="simpara">
												Remove the reference to the legacy security realm, and update the <code class="literal">https-listener</code> to use the <code class="literal">ssl-context</code> from Elytron.
											</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
													<code class="literal">https-listener</code> must always have either a <code class="literal">security-realm</code> or <code class="literal">ssl-context</code> configured. When changing between the two configurations, the commands must be executed as a single batch, as shown below.
												</p></div><pre class="screen">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context, value=twoWaySSC)
run-batch</pre></li><li class="listitem"><p class="simpara">
												Reload the server.
											</p><pre class="screen">reload</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
													To complete the two-way SSL/TLS authentication, you need to import the server certificate into the client truststore and configure your client to present the client certificate.
												</p><pre class="screen">$ keytool -importcert -keystore client.truststore.jks -storepass secret -alias localhost -trustcacerts -file /path/to/server.cer</pre></div></li><li class="listitem"><p class="simpara">
												Configure your client to use the client certificate.
											</p><p class="simpara">
												You need to configure your client to present the trusted client certificate to the server to complete the two-way SSL/TLS authentication. For example, if using a browser, you need to import the trusted certificate into the browser’s trust store.
											</p><p class="simpara">
												This procedure forces a two-way SSL/TLS but it does not change the original authentication method of the application.
											</p><p class="simpara">
												If you want to change the original authentication method, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#configure_authentication_with_certificates">Configure Authentication with Certificates</a> in <span class="emphasis"><em>How to Configure Identity Management</em></span> for JBoss EAP.
											</p></li></ol></div></li></ol></div></li></ol></div><p>
						Two-way SSL/TLS is now enabled for applications.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							You can disable two-way SSL/TLS for deployed applications using the <code class="literal">disable-ssl-http-server</code> command.
						</p><pre class="programlisting">security disable-ssl-http-server</pre><p>
							This command does not delete the Elytron resources. It configures the system to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration.
						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_legacy_security_realms"/>Using Legacy Security Realms</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						As a prerequisite, an SSL/TLS encryption key and certificate should be created and placed in an accessible directory. Additionally, relevant information, such as keystore aliases and passwords, desired cipher suites, should also be accessible. For examples on generating SSL/TLS Keys and Certificates, see the first two steps in the <a class="link" href="securing_the_server_and_its_interfaces.html#mgmt-interface-two-way-ssl-legacy" title="Setting up Two-way SSL/TLS for the Management Interfaces with Legacy Core Management Authentication">Setting up Two-way SSL/TLS for the Management Interfaces</a> section. For more information about the HTTPS listener, including cipher suites, see the <a class="link" href="securing_the_server_and_its_interfaces.html#https_listener_reference" title="HTTPS Listener Reference">HTTPS Listener Reference</a> section.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="setup-ssl-realm-and-undertow"/>Enable One-way SSL/TLS for Applications Using Legacy Security Realms</h3></div></div></div><p>
						This example assumes that the keystore, <code class="literal">identity.jks</code>, has been copied to the server configuration directory and configured with the given properties. Administrators should substitute their own values for the example ones.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The management CLI commands shown assume that you are running a JBoss EAP standalone server. For more details on using the management CLI for a JBoss EAP managed domain, see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/"><span class="emphasis"><em>Management CLI Guide</em></span></a>.
						</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Add and configure an HTTPS security realm first. Once the HTTPS security realm has been configured, configure an <code class="literal">https-listener</code> in the <code class="literal">undertow</code> subsystem that references the security realm:
							</p><pre class="screen">batch

/core-service=management/security-realm=HTTPSRealm:add

/core-service=management/security-realm=HTTPSRealm/server-identity=ssl:add(keystore-path=identity.jks, keystore-relative-to=jboss.server.config.dir, keystore-password=password1, alias=appserver)

/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=security-realm, value=HTTPSRealm)

run-batch</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
									Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
								</p></div></li><li class="listitem">
								Restart the JBoss EAP instance for the changes to take effect.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="application_two-way_ssl"/>Enable Two-way SSL/TLS for Applications Using Legacy Security Realms</h3></div></div></div><p>
						Setting up two-way SSL/TLS for applications follows many of the same procedures outlined in <a class="link" href="securing_the_server_and_its_interfaces.html#mgmt-interface-two-way-ssl-legacy" title="Setting up Two-way SSL/TLS for the Management Interfaces with Legacy Core Management Authentication">Setting up Two-way SSL/TLS for the Management Interfaces</a>. To set up two-way SSL/TLS for applications, you need to do the following:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Generate the stores for both the client and server
							</li><li class="listitem">
								Export the certificates for both the client and server
							</li><li class="listitem">
								Import the certificates into the opposing truststores
							</li><li class="listitem">
								Define a security realm, for example <code class="literal">CertificateRealm</code>, on the server that uses the server’s keystore and truststore
							</li><li class="listitem">
								Update the <code class="literal">undertow</code> subsystem to use the security realm and require client verification
							</li></ol></div><p>
						The first four steps are covered in <a class="link" href="securing_the_server_and_its_interfaces.html#mgmt-interface-two-way-ssl-legacy" title="Setting up Two-way SSL/TLS for the Management Interfaces with Legacy Core Management Authentication">Setting up Two-way SSL/TLS for the Management Interfaces</a>.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							If the server has not been reloaded since the new security realm has been added, you must reload the server before performing the next step.
						</p></div><h5><a id="update_the_undertow_subsystem"/>Update the Undertow Subsystem</h5><p>
						Once the keystores, certificates, truststores, and security realms have been created and configured, you need to add an HTTPS listener to the <code class="literal">undertow</code> subsystem, use the security realm you created, and require client verification:
					</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=security-realm, value=CertificateRealm)

/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=verify-client, value=REQUIRED)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							You must reload the server for these changes to take effect.
						</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Any client connecting to a JBoss EAP instance with two-way SSL/TLS enabled for applications must have access to a client certificate or keystore, in other words a client keystore whose certificate is included in the server’s truststore. If the client is using a browser to connect to the JBoss EAP instance, you need to import that certificate or keystore into the browser’s certificate manager.
						</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							More details on using certificate-based authentication in applications, in addition to two-way SSL/TLS with applications, can be found in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#cert_based_auth_security_domain">Configuring a Security Domain to Use Certificate-based Authentication</a> section of the JBoss EAP <span class="emphasis"><em>How to Configure Identity Management Guide</em></span>.
						</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_http_auth_http"/>Enable HTTP Authentication for Applications Using the CLI Security Command</h1></div></div></div><p>
				In JBoss EAP, HTTP authentication, using an elytron HTTP authentication factory, can be enabled for the undertow security domain with the <code class="literal">security enable-http-auth-http-server</code> command. By default this command associates the application HTTP factory to the specified security domain.
			</p><div class="title"><strong>Example: Enable HTTP Authentication on the Undertow Security Domain</strong></div><p>
					
</p><pre class="screen">security enable-http-auth-http-server --security-domain=<span class="emphasis"><em>SECURITY_DOMAIN</em></span>

Server reloaded.
Command success.
Authentication configured for security domain <span class="emphasis"><em>SECURITY_DOMAIN</em></span>
http authentication-factory=application-http-authentication
security-domain=<span class="emphasis"><em>SECURITY_DOMAIN</em></span></pre><p>

				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Once the command is executed, the management CLI will reload the server and reconnect to it.
				</p></div><p>
				If a HTTP factory already exists, then the factory is updated to use the mechanism defined by the <code class="literal">--mechanism</code> argument.
			</p><p>
				For a list of arguments, see <a class="link" href="reference_material.html#auth_security_arguments" title="Security Authorization Arguments">Authorization Security Arguments</a>.
			</p><h3><a id="disable_http_authentication_for_the_management_interfaces_2"/>Disable HTTP Authentication for the Management Interfaces</h3><p>
				To remove the active HTTP authentication factory use the following command.
			</p><pre class="screen">security disable-http-auth-http-server --security-domain=<span class="emphasis"><em>SECURITY_DOMAIN</em></span></pre><p>
				Alternatively, you can use the following command to remove specific mechanisms from the active SASL authentication factory.
			</p><pre class="screen">security disable-http-auth-http-server --mechanism=<span class="emphasis"><em>MECHANISM</em></span> --security-domain=<span class="emphasis"><em>SECURITY_DOMAIN</em></span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sasl_auth_mechanisms"/>SASL Authentication Mechanisms</h1></div></div></div><p>
				<a class="link" href="https://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer">Simple Authentication and Security Layer (SASL)</a> authentication mechanisms are used for defining the mechanisms for authenticating connections to a JBoss EAP server using the <code class="literal">elytron</code> subsystem, and for clients connecting to servers. Clients can be other JBoss EAP instances, or Elytron Client. SASL authentication mechanisms in JBoss EAP are also significantly used in <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_remoting_subsystem" title="Elytron Integration with the Remoting Subsystem">Elytron integration with the <code class="literal">remoting</code> subsystem</a>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="choosing_sasl_authentication_mechanisms"/>Choosing SASL Authentication Mechanisms</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Although JBoss EAP and Elytron Client work with a variety of SASL authentication mechanisms, you must ensure that the mechanisms you use are supported. See <a class="link" href="reference_material.html#sasl_auth_mechanisms_list" title="Support Level for SASL Authentication Mechanisms">this list for the support levels for SASL authentication mechanisms</a>.
					</p></div><p>
					The authentication mechanisms you use depends on your environment and desired authentication method. The following list summarizes the use of some of the <a class="link" href="reference_material.html#sasl_auth_mechanisms_list" title="Support Level for SASL Authentication Mechanisms">supported SASL authentication mechanisms</a>:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ANONYMOUS</code></span></dt><dd>
								Unauthenticated guest access.
							</dd><dt><span class="term"><code class="literal">DIGEST-MD5</code></span></dt><dd>
								Uses HTTP digest authentication as a SASL mechanism.
							</dd><dt><span class="term"><code class="literal">EXTERNAL</code></span></dt><dd>
								Uses authentication credentials that are implied in the context of the request. For example, IPsec or TLS authentication.
							</dd><dt><span class="term">Mechanisms beginning with <code class="literal">GS</code></span></dt><dd>
								Authentication using Kerberos.
							</dd><dt><span class="term"><code class="literal">JBOSS-LOCAL-USER</code></span></dt><dd>
								Provides authentication by testing that the client has the same file access as the local user that is running the JBoss EAP server. This is useful for other JBoss EAP instances running on the same machine.
							</dd><dt><span class="term"><code class="literal">OAUTHBEARER</code></span></dt><dd>
								Uses authentication provided by OAuth as a SASL mechanism.
							</dd><dt><span class="term"><code class="literal">PLAIN</code></span></dt><dd>
								Plain text username and password authentication.
							</dd><dt><span class="term">Mechanisms beginning with <code class="literal">SCRAM</code></span></dt><dd>
								Salted Challenge Response Authentication Mechanism (SCRAM) that uses a specified hashing function.
							</dd><dt><span class="term">Mechanisms ending with <code class="literal">-PLUS</code></span></dt><dd>
								Indicates a channel binding variant of a particular authentication mechanism. You should use these variants when the underlying connection uses SSL/TLS.
							</dd></dl></div><p>
					For more information on individual SASL authentication mechanisms, see the <a class="link" href="https://www.iana.org/assignments/sasl-mechanisms/sasl-mechanisms.xml">IANA SASL mechanism list and individual mechanism memos</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_sasl_authentication_mechanisms_on_the_server_side"/>Configuring SASL Authentication Mechanisms on the Server Side</h2></div></div></div><p>
					Configuring SASL authentication mechanisms on the server side is done using SASL authentication factories.
				</p><p>
					There are two levels of configuration required:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							A <code class="literal">sasl-authentication-factory</code>, where you specify authentication mechanisms.
						</li><li class="listitem">
							A <code class="literal">configurable-sasl-server-factory</code> that aggregates one or more of <code class="literal">sasl-authentication-factory</code>, and configures mechanism properties as well as optionally applying filters to enable or disable certain authentication mechanisms.
						</li></ul></div><p>
					The following example demonstrates creating a new <code class="literal">configurable-sasl-server-factory</code>, and a <code class="literal">sasl-authentication-factory</code> that uses DIGEST-MD5 as a SASL authentication mechanism for application clients.
				</p><pre class="screen">/subsystem=elytron/configurable-sasl-server-factory=mySASLServerFactory:add(sasl-server-factory=elytron)

/subsystem=elytron/sasl-authentication-factory=mySASLAuthFactory:add(sasl-server-factory=mySASLServerFactory,security-domain=ApplicationDomain,mechanism-configurations=[{mechanism-name=DIGEST-MD5,mechanism-realm-configurations=[{realm-name=ApplicationRealm}]}])</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sasl_auth_mechanism_specify_client"/>Specifying SASL Authentication Mechanisms on the Client Side</h2></div></div></div><p>
					SASL authentication mechanisms used by a client are specified using a <code class="literal">sasl-mechanism-selector</code>. You can specify any supported SASL authentication mechanisms that are exposed by the server that the client is connecting to.
				</p><p>
					A <code class="literal">sasl-mechanism-selector</code> is defined in Elytron configurations where authentication is configured:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							In the <code class="literal">elytron</code> subsystem, this is an attribute of an <code class="literal">authentication-configuration</code>. For example:
						</p><pre class="screen">/subsystem=elytron/authentication-configuration=myAuthConfig:write-attribute(name=sasl-mechanism-selector,value="DIGEST-MD5")</pre><p class="simpara">
							An example of using an <code class="literal">authentication-configuration</code> with a <code class="literal">sasl-mechanism-selector</code> can be seen in <a class="link" href="securing_the_server_and_its_interfaces.html#configure-ssl-managed-domain-elytron" title="Configuring SSL/TLS Between Domain and Host Controllers Using Elytron">Configuring SSL/TLS Between Domain and Host Controllers Using Elytron</a>.
						</p></li><li class="listitem"><p class="simpara">
							For Elytron Client, it is specified under the <code class="literal">configuration</code> element of <code class="literal">authentication-configurations</code> in the client configuration file, usually named <code class="literal">wildfly-config.xml</code>. For example:
						</p><pre class="programlisting">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
    &lt;authentication-rules&gt;
      &lt;rule use-configuration="default" /&gt;
    &lt;/authentication-rules&gt;
    &lt;authentication-configurations&gt;
      &lt;configuration name="default"&gt;
        &lt;sasl-mechanism-selector selector="#ALL" /&gt;
      ...
      &lt;/configuration&gt;
    &lt;/authentication-configurations&gt;
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre></li></ul></div><p>
					See <span class="emphasis"><em>How to Configure Identity Management</em></span> for more information on <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_identity_management/#elytron_client_authentication">configuring client authentication with Elytron Client</a>.
				</p><h4><a id="sasl_mechanism_selector_grammar"/><code class="literal">sasl-mechanism-selector</code> Grammar</h4><p>
					The selector string for <code class="literal">sasl-mechanism-selector</code> has a specific grammar.
				</p><p>
					In a simple form, individual mechanisms are specified by listing their names in order, separated by a spaces. For example, to specify DIGEST-MD5, SCRAM-SHA-1, and SCRAM-SHA-256 as allowed authentication mechanisms, use the following string: <code class="literal">DIGEST-MD5 SCRAM-SHA-1 SCRAM-SHA-256</code>.
				</p><p>
					More advanced usage of the grammar can use the following special tokens:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">#ALL</code>: All mechanisms.
						</li><li class="listitem">
							<code class="literal">#FAMILY(<span class="emphasis"><em>NAME</em></span>)</code>: Mechanisms belonging to the specified mechanism family. For example, the family could be DIGEST, EAP, GS2, SCRAM, or IEC-ISO-9798.
						</li><li class="listitem">
							<code class="literal">#PLUS</code>: Mechanisms that use channel binding. For example, SCRAM-SHA-<span class="emphasis"><em>XXX</em></span>-PLUS or GS2-<span class="emphasis"><em>XXX</em></span>-PLUS.
						</li><li class="listitem">
							<code class="literal">#MUTUAL</code>: Mechanisms that authenticate the server in some way, for example making the server prove that the server knows the password. <code class="literal">#MUTUAL</code> includes families such as <code class="literal">#FAMILY(SCRAM)</code> and <code class="literal">#FAMILY(GS2)</code>.
						</li><li class="listitem">
							<code class="literal">#HASH(<span class="emphasis"><em>ALGORITHM</em></span>)</code>: Mechanisms that use the specified hash algorithm. For example, the algorithm could be MD5, SHA-1, SHA-256, SHA-384, or SHA-512.
						</li></ul></div><p>
					The above tokens and names can also be used with the following operations and predicates:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">-</code>: Forbids
						</li><li class="listitem">
							<code class="literal">!</code>: Inverts
						</li><li class="listitem">
							<code class="literal">&amp;&amp;</code>: And
						</li><li class="listitem">
							<code class="literal">||</code>: Or
						</li><li class="listitem">
							<code class="literal">==</code>: Equals
						</li><li class="listitem">
							<code class="literal">?</code>: If
						</li><li class="listitem">
							<code class="literal">#TLS</code>: Is true when TLS is active, otherwise false.
						</li></ul></div><p>
					Below are some examples of <code class="literal">sasl-mechanism-selector</code> strings and their meaning:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">#TLS &amp;&amp; !#MUTUAL</code>: When TLS is active, all mechanisms without mutual authentication.
						</li><li class="listitem">
							<code class="literal">#ALL -ANONYMOUS</code>: All mechanisms, except for ANONYMOUS.
						</li><li class="listitem">
							<code class="literal">SCRAM-SHA-1 SCRAM-SHA-256</code>: Adds those two mechanisms in that order.
						</li><li class="listitem">
							<code class="literal">(SCRAM-SHA-1 || SCRAM-SHA-256)</code>: Adds the two mechanisms in the order that the provider or server presents them.
						</li><li class="listitem">
							<code class="literal">!#HASH(MD5)</code>: Any mechanism that does not use the MD5 hashing algorithm.
						</li><li class="listitem">
							<code class="literal">#FAMILY(DIGEST)</code>: Any digest mechanism.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sasl_auth_mechanism_props_specify"/>Configuring SASL Authentication Mechanism Properties</h2></div></div></div><p>
					You can configure authentication mechanism properties on both the server side and on the client side.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							On the server side, you define authentication mechanism properties in the <code class="literal">configurable-sasl-server-factory</code>. The following example defines the <code class="literal">com.sun.security.sasl.digest.utf8</code> property with a value of <code class="literal">false</code>.
						</p><pre class="screen">/subsystem=elytron/configurable-sasl-server-factory=mySASLServerFactory:map-put(name=properties,key=com.sun.security.sasl.digest.utf8,value=false)</pre></li><li class="listitem"><p class="simpara">
							On the client side, you define authentication mechanisms properties in the client’s authentication configuration:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									In the <code class="literal">elytron</code> subsystem, define the authentication mechanism properties in your <code class="literal">authentication-configuration</code>. The following example defines the <code class="literal">wildfly.sasl.local-user.quiet-auth</code> property with a value of <code class="literal">true</code>.
								</p><pre class="screen">/subsystem=elytron/authentication-configuration=myAuthConfig:map-put(name=mechanism-properties,key=wildfly.sasl.local-user.quiet-auth,value=true)</pre></li><li class="listitem"><p class="simpara">
									For Elytron Client, authentication mechanism properties are specified under the <code class="literal">configuration</code> element of <code class="literal">authentication-configurations</code> in the client configuration file, usually named <code class="literal">wildfly-config.xml</code>. For example:
								</p><pre class="programlisting">...
&lt;authentication-configurations&gt;
  &lt;configuration name="default"&gt;
    &lt;sasl-mechanism-selector selector="#ALL" /&gt;
    &lt;set-mechanism-properties&gt;
      &lt;property key="wildfly.sasl.local-user.quiet-auth" value="true" /&gt;
    &lt;/set-mechanism-properties&gt;
    ...
  &lt;/configuration&gt;
&lt;/authentication-configurations&gt;
...</pre></li></ul></div></li></ul></div><p>
					You can see a list of <a class="link" href="https://docs.oracle.com/javase/8/docs/api/javax/security/sasl/Sasl.html#field.summary">standard Java SASL authentication mechanism properties in the Java documentation</a>. Other JBoss EAP-specific SASL authentication mechanism properties are listed in the <a class="link" href="reference_material.html#sasl_auth_mechanism_props_ref" title="SASL Authentication Mechanism Properties">Authentication Mechanisms Reference</a>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_integration_mod_cluster"/>Elytron Integration with the ModCluster Subsystem</h1></div></div></div><p>
				One of the security capabilities exposed by <code class="literal">elytron</code> subsystem is a client <code class="literal">ssl-context</code> that can be used to configure the <code class="literal">modcluster</code> subsystem to communicate with a load balancer using SSL/TLS.
			</p><p>
				When protecting the communication between the application server and the load balancer, you need to define a client <code class="literal">ssl-context</code> in order to:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Define a truststore holding the certificate chain that will be used to validate load balancer’s certificate.
					</li><li class="listitem">
						Define a trust manager to perform validations against the load balancer’s certificate.
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="defining_a_client_ssl_context_and_configuring_modcluster_subsystem"/>Defining a Client SSL Context and Configuring ModCluster Subsystem</h2></div></div></div><p>
					The following procedure requires that a truststore and trust manager be configured. For information on creating these see <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_store" title="Create an Elytron Truststore">Create an Elytron Truststore</a> and <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_manager" title="Create an Elytron Trust Manager">Create an Elytron Trust Manager</a>.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the client SSL context.
						</p><p class="simpara">
							This SSL context is going to be used by the <code class="literal">modcluster</code> subsystem when connecting to the load balancer using SSL/TLS:
						</p><pre class="screen">/subsystem=elytron/client-ssl-context=modcluster-client-ssl-context:add(trust-manager=default-trust-manager)</pre></li><li class="listitem"><p class="simpara">
							Reference the newly created client SSL context using one of the following options.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									Configure the <code class="literal">modcluster</code> subsystem by setting the <code class="literal">ssl-context</code>.
								</p><pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration:write-attribute(name=ssl-context, value=modcluster-client-ssl-context)</pre></li><li class="listitem"><p class="simpara">
									Configure the <code class="literal">undertow</code> subsystem by defining the <code class="literal">ssl-context</code> attribute of the <code class="literal">mod-cluster</code> filter.
								</p><pre class="screen">/subsystem=undertow/configuration=filter/mod-cluster=modcluster:write-attribute(name=ssl-context,value=modcluster-client-ssl-context)</pre></li></ul></div></li><li class="listitem"><p class="simpara">
							Reload the server.
						</p><pre class="screen">reload</pre></li></ol></div><p>
					For configuring the <code class="literal">modcluster</code> subsystem and using <a class="link" href="securing_the_server_and_its_interfaces.html#using_elytron" title="Using Elytron">two-way authentication</a>, along with the trust manager, the key manager also needs to be configured.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the keystore.
						</p><pre class="screen">/subsystem=elytron/key-store=twoWayKS:add(path=/path/to/client.keystore.jks, credential-reference={clear-text=secret},type=JKS)</pre></li><li class="listitem"><p class="simpara">
							Configure the key manager.
						</p><pre class="screen">/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS, algorithm="SunX509", credential-reference={clear-text=secret})</pre></li><li class="listitem"><p class="simpara">
							Create the client SSL context.
						</p><pre class="screen">/subsystem=elytron/client-ssl-context=modcluster-client-ssl-context:add(trust-manager=default-trust-manager, key-manager=twoWayKM)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								If you already have an existing client SSL context, you can add the <code class="literal">key-manager</code> to it as follows:
							</p><pre class="screen">/subsystem=elytron/client-ssl-context=modcluster-client-ssl-context:write-attribute(name=key-manager, value=twoWayKM)</pre></div></li><li class="listitem"><p class="simpara">
							Reload the server.
						</p><pre class="screen">reload</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_integration_jgroups"/>Elytron Integration with the JGroups Subsystem</h1></div></div></div><p>
				Components in the <code class="literal">elytron</code> subsystem may be referenced when defining authorization or encryption protocols in the <code class="literal">jgroups</code> subsystem. Full instructions on configuring these protocols are found in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#securing_cluster">Securing a Cluster</a> section of the <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_remoting_subsystem"/>Elytron Integration with the Remoting Subsystem</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_integration_remoting_connectors"/>Elytron Integration with Remoting Connectors</h2></div></div></div><p>
					A remoting connector is specified by a SASL authentication factory, a socket binding, and an optional SSL context. In particular, the attributes for a connector are as follows:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sasl-authentication-factory</code></span></dt><dd>
								A reference to the SASL authentication factory to use for authenticating requests to this connector. For more information on creating this factory, see <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_authentication_factory" title="Create an Elytron Authentication Factory">Create an Elytron Authentication Factory</a>.
							</dd><dt><span class="term"><code class="literal">socket-binding</code></span></dt><dd>
								A reference to the socket binding, detailing the interface and port where the connector should listen for incoming requests.
							</dd><dt><span class="term"><code class="literal">ssl-context</code></span></dt><dd>
								An optional reference to the server-side SSL Context to use for this connector. The SSL Context contains the server key manager and trust manager to be used, and should be defined in instances where SSL is desired.
							</dd></dl></div><p>
					For example, a connector can be added as follows, where <code class="literal"><span class="emphasis"><em>SASL_FACTORY_NAME</em></span></code> is an already defined authentication factory and <code class="literal"><span class="emphasis"><em>SOCKET_BINDING_NAME</em></span></code> is an existing socket binding.
				</p><pre class="screen">/subsystem=remoting/connector=<span class="emphasis"><em>CONNECTOR_NAME</em></span>:add(sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY_NAME</em></span>,socket-binding=<span class="emphasis"><em>SOCKET_BINDING_NAME</em></span>)</pre><p>
					If SSL is desired, a preconfigured <code class="literal">server-ssl-context</code> may be referenced using the <code class="literal">ssl-context</code> attribute, as seen below.
				</p><pre class="screen">/subsystem=remoting/connector=<span class="emphasis"><em>CONNECTOR_NAME</em></span>:add(sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY_NAME</em></span>,socket-binding=<span class="emphasis"><em>SOCKET_BINDING_NAME</em></span>,ssl-context=<span class="emphasis"><em>SSL_CONTEXT_NAME</em></span>)</pre><h4><a id="elytron_one_way_ssl_remoting_connector"/>Enable One-way SSL/TLS for Remoting Connectors Using the Elytron Subsystem</h4><p>
					Before enabling one-way SSL/TLS in JBoss EAP, you must configure a <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_keystore" title="Create an Elytron Keystore"><code class="literal">key-store</code></a>, <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_key_manager" title="Create an Elytron Key Manager"><code class="literal">key-manager</code></a>, and a <a class="link" href="securing_the_server_and_its_interfaces.html#using_server_ssl_context" title="Using a server-ssl-context"><code class="literal">server-ssl-context</code></a> that references the defined <code class="literal">key-manager</code>.
				</p><p>
					The following SASL mechanisms support channel binding to external secure channels, such as SSL/TLS:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							GS2-KRB5-PLUS
						</li><li class="listitem">
							SCRAM-SHA-1-PLUS
						</li><li class="listitem">
							SCRAM-SHA-256-PLUS
						</li><li class="listitem">
							SCRAM-SHA-384-PLUS
						</li><li class="listitem">
							SCRAM-SHA-512-PLUS
						</li></ul></div><p>
					To use any of the above mechanisms, a <a class="link" href="securing_the_server_and_its_interfaces.html#configuring_sasl_authentication_mechanisms_on_the_server_side" title="Configuring SASL Authentication Mechanisms on the Server Side">custom SASL factory</a> can be configured, or one of the predefined SASL authentication factories can be modified to offer any of these mechanisms. A <a class="link" href="securing_the_server_and_its_interfaces.html#sasl_auth_mechanism_specify_client" title="Specifying SASL Authentication Mechanisms on the Client Side">SASL mechanism selector</a> can be used on the client to specify the appropriate SASL mechanism.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a <code class="literal">socket-binding</code> for the connector. The following command defines the <code class="literal">oneWayBinding</code> binding that listens on port <code class="literal">11199</code>.
						</p><pre class="screen">/socket-binding-group=standard-sockets/socket-binding=oneWayBinding:add(port=11199)</pre></li><li class="listitem"><p class="simpara">
							Create a connector that references the SASL authentication factory, the previously created socket binding, and the SSL context.
						</p><pre class="screen">/subsystem=remoting/connector=oneWayConnector:add(sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY</em></span>,socket-binding=oneWayBinding,ssl-context=<span class="emphasis"><em>SSL_CONTEXT</em></span>)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
							</p></div></li><li class="listitem">
							Configure the client to trust the server certificate. A generic example client is found at <a class="link" href="reference_material.html#elytron_client_side_one_way_example" title="Elytron Client Side One Way Example">Elytron Client Side One Way Example</a>. This example configures an <code class="literal">ssl-context</code> using the client <code class="literal">trust-store</code>.
						</li></ol></div><h4><a id="elytron_two_way_ssl_remoting_connector"/>Enable Two-way SSL/TLS for Remoting Connectors Using the Elytron Subsystem</h4><p>
					Before enabling two-way SSL/TLS in JBoss EAP, you must configure a separate <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_keystore" title="Create an Elytron Keystore"><code class="literal">key-store</code></a> components for the client and server certificates, a <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_key_manager" title="Create an Elytron Key Manager"><code class="literal">key-manager</code></a> for the server <code class="literal">key-store</code>, a <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_manager" title="Create an Elytron Trust Manager"><code class="literal">trust-manager</code></a> for the server <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_store" title="Create an Elytron Truststore"><code class="literal">trust-store</code></a>, and a <a class="link" href="securing_the_server_and_its_interfaces.html#using_server_ssl_context" title="Using a server-ssl-context"><code class="literal">server-ssl-context</code></a> that references the defined <code class="literal">key-manager</code> and <code class="literal">trust-manager</code>.
				</p><p>
					The following SASL mechanisms support channel binding to external secure channels, such as SSL/TLS:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							GS2-KRB5-PLUS
						</li><li class="listitem">
							SCRAM-SHA-1-PLUS
						</li><li class="listitem">
							SCRAM-SHA-256-PLUS
						</li><li class="listitem">
							SCRAM-SHA-384-PLUS
						</li><li class="listitem">
							SCRAM-SHA-512-PLUS
						</li></ul></div><p>
					To use any of the above mechanisms, a <a class="link" href="securing_the_server_and_its_interfaces.html#configuring_sasl_authentication_mechanisms_on_the_server_side" title="Configuring SASL Authentication Mechanisms on the Server Side">custom SASL factory</a> can be configured, or one of the predefined SASL authentication factories can be modified to offer any of these mechanisms. A <a class="link" href="securing_the_server_and_its_interfaces.html#sasl_auth_mechanism_specify_client" title="Specifying SASL Authentication Mechanisms on the Client Side">SASL mechanism selector</a> can be used on the client to specify the appropriate SASL mechanism.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a <code class="literal">socket-binding</code> for the connector. The following command defines the <code class="literal">twoWayBinding</code> binding that listens on port <code class="literal">11199</code>.
						</p><pre class="screen">/socket-binding-group=standard-sockets/socket-binding=twoWayBinding:add(port=11199)</pre></li><li class="listitem"><p class="simpara">
							Create a connector that references the SASL authentication factory, the previously created socket binding, and the SSL context.
						</p><pre class="screen">/subsystem=remoting/connector=twoWayConnector:add(sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY</em></span>,socket-binding=twoWayBinding,ssl-context=<span class="emphasis"><em>SSL_CONTEXT</em></span>)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
							</p></div></li><li class="listitem"><p class="simpara">
							Configure your client to trust the server certificate, and to present its certificate to the server.
						</p><p class="simpara">
							You need to configure your client to present the trusted client certificate to the server to complete the two-way SSL/TLS authentication. For example, if using a browser, you need to import the trusted certificate into the browser’s truststore. A generic example client is found at <a class="link" href="reference_material.html#elytron_client_side_two_way_example" title="Elytron Client Side Two Way Example">Elytron Client Side Two Way Example</a>. This example configures an <code class="literal">ssl-context</code> using the client <code class="literal">trust-store</code> and <code class="literal">key-store</code>.
						</p></li></ol></div><p>
					Two-way SSL/TLS is now enabled on the remoting connector.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_integration_remoting_http_connectors"/>Elytron Integration with Remoting HTTP Connectors</h2></div></div></div><p>
					A remote HTTP connection is specified by referencing a connector in the <code class="literal">undertow</code> system and a SASL authentication factory defined in the <code class="literal">elytron</code> subsystem. The HTTP connector provides the configuration for the HTTP upgrade-based remoting connector, and connects to an HTTP listener specified by the <code class="literal">connector-ref</code> attribute.
				</p><p>
					The attributes for a <code class="literal">connector</code> are as follows:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">connector-ref</code></span></dt><dd>
								A reference to a predefined <code class="literal">undertow</code> listener.
							</dd><dt><span class="term"><code class="literal">sasl-authentication-factory</code></span></dt><dd>
								A reference to the SASL authentication factory to use for authenticating requests to this connector. For more information on creating this factory, see <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_authentication_factory" title="Create an Elytron Authentication Factory">Create an Elytron Authentication Factory</a>.
							</dd></dl></div><p>
					For example, a <code class="literal">http-connector</code> can be added as follows, where <code class="literal"><span class="emphasis"><em>CONNECTOR_NAME</em></span></code> references the <code class="literal">undertow</code> listener, and <code class="literal"><span class="emphasis"><em>SASL_FACTORY_NAME</em></span></code> is an already defined authentication factory in the <code class="literal">elytron</code> subsystem.
				</p><pre class="screen">/subsystem=remoting/http-connector=<span class="emphasis"><em>HTTP_CONNECTOR_NAME</em></span>:add(connector-ref=<span class="emphasis"><em>CONNECTOR_NAME</em></span>,sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY_NAME</em></span>)</pre><h4><a id="elytron_one_way_ssl_remoting_http_connector"/>Enable One-Way SSL on the Remoting HTTP Connector</h4><p>
					Before enabling one-way SSL/TLS in JBoss EAP, you must configure a <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_keystore" title="Create an Elytron Keystore"><code class="literal">key-store</code></a>, <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_key_manager" title="Create an Elytron Key Manager"><code class="literal">key-manager</code></a>, and a <a class="link" href="securing_the_server_and_its_interfaces.html#using_server_ssl_context" title="Using a server-ssl-context"><code class="literal">server-ssl-context</code></a> that references the defined <code class="literal">key-manager</code>.
				</p><p>
					The following SASL mechanisms support channel binding to external secure channels, such as SSL/TLS:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							GS2-KRB5-PLUS
						</li><li class="listitem">
							SCRAM-SHA-1-PLUS
						</li><li class="listitem">
							SCRAM-SHA-256-PLUS
						</li><li class="listitem">
							SCRAM-SHA-384-PLUS
						</li><li class="listitem">
							SCRAM-SHA-512-PLUS
						</li></ul></div><p>
					To use any of the above mechanisms, a <a class="link" href="securing_the_server_and_its_interfaces.html#configuring_sasl_authentication_mechanisms_on_the_server_side" title="Configuring SASL Authentication Mechanisms on the Server Side">custom SASL factory</a> can be configured, or one of the predefined SASL authentication factories can be modified to offer any of these mechanisms. A <a class="link" href="securing_the_server_and_its_interfaces.html#sasl_auth_mechanism_specify_client" title="Specifying SASL Authentication Mechanisms on the Client Side">SASL mechanism selector</a> can be used on the client to specify the appropriate SASL mechanism.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Check whether the <code class="literal">https-listener</code> is configured to use a legacy security realm for its SSL configuration.
						</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</pre><p class="simpara">
							The above command shows that the <code class="literal">https-listener</code> is configured to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration. Undertow cannot reference both a legacy security realm and an <code class="literal">ssl-context</code> in Elytron at the same time so you must remove the reference to the legacy security realm.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								If the result is <code class="literal">undefined</code>, you do not need to remove the reference to the security realm in the next step.
							</p></div></li><li class="listitem"><p class="simpara">
							Remove the reference to the legacy security realm, and update the <code class="literal">https-listener</code> to use the <code class="literal">ssl-context</code> from Elytron.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								<code class="literal">https-listener</code> must always have either a <code class="literal">security-realm</code> or <code class="literal">ssl-context</code> configured. When changing between the two configurations, the commands must be executed as a single batch, as shown below.
							</p></div><pre class="screen">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context, value=<span class="emphasis"><em>SERVER_SSL_CONTEXT</em></span>)
run-batch</pre></li><li class="listitem"><p class="simpara">
							Create an HTTP connector that references the HTTPS listener and the SASL authentication factory.
						</p><pre class="screen">/subsystem=remoting/http-connector=ssl-http-connector:add(connector-ref=https,sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY</em></span>)</pre></li><li class="listitem"><p class="simpara">
							Reload the server.
						</p><pre class="screen">reload</pre></li><li class="listitem">
							Configure the client to trust the server certificate. For example, if using a browser, you need to import the trusted certificate into the browser’s truststore.
						</li></ol></div><h4><a id="elytron_two_way_ssl_remoting_http_connector"/>Enable Two-way SSL/TLS on the Remoting HTTP Connectors</h4><p>
					Before enabling two-way SSL/TLS in JBoss EAP, you must configure separate <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_keystore" title="Create an Elytron Keystore"><code class="literal">key-store</code></a> components for the client and server certificates, a <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_key_manager" title="Create an Elytron Key Manager"><code class="literal">key-manager</code></a> for the server <code class="literal">key-store</code>, a <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_manager" title="Create an Elytron Trust Manager"><code class="literal">trust-manager</code></a> for the server <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_store" title="Create an Elytron Truststore"><code class="literal">trust-store</code></a>, and a <a class="link" href="securing_the_server_and_its_interfaces.html#using_server_ssl_context" title="Using a server-ssl-context"><code class="literal">server-ssl-context</code></a> that references the defined <code class="literal">key-manager</code> and <code class="literal">trust-manager</code>.
				</p><p>
					The following SASL mechanisms support channel binding to external secure channels, such as SSL/TLS:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							GS2-KRB5-PLUS
						</li><li class="listitem">
							SCRAM-SHA-1-PLUS
						</li><li class="listitem">
							SCRAM-SHA-256-PLUS
						</li><li class="listitem">
							SCRAM-SHA-384-PLUS
						</li><li class="listitem">
							SCRAM-SHA-512-PLUS
						</li></ul></div><p>
					To use any of the above mechanisms, a <a class="link" href="securing_the_server_and_its_interfaces.html#configuring_sasl_authentication_mechanisms_on_the_server_side" title="Configuring SASL Authentication Mechanisms on the Server Side">custom SASL factory</a> can be configured, or one of the predefined SASL authentication factories can be modified to offer any of these mechanisms. A <a class="link" href="securing_the_server_and_its_interfaces.html#sasl_auth_mechanism_specify_client" title="Specifying SASL Authentication Mechanisms on the Client Side">SASL mechanism selector</a> can be used on the client to specify the appropriate SASL mechanism.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Check whether the <code class="literal">https-listener</code> is configured to use a legacy security realm for its SSL configuration.
						</p><pre class="screen">/subsystem=undertow/server=default-server/https-listener=https:read-attribute(name=security-realm)
{
    "outcome" =&gt; "success",
    "result" =&gt; "ApplicationRealm"
}</pre><p class="simpara">
							The above command shows that the <code class="literal">https-listener</code> is configured to use the <code class="literal">ApplicationRealm</code> legacy security realm for its SSL configuration. Undertow cannot reference both a legacy security realm and an <code class="literal">ssl-context</code> in Elytron at the same time so you must remove the reference to the legacy security realm.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								If the result is <code class="literal">undefined</code>, you do not need to remove the reference to the security realm in the next step.
							</p></div></li><li class="listitem"><p class="simpara">
							Remove the reference to the legacy security realm, and update the <code class="literal">https-listener</code> to use the <code class="literal">ssl-context</code> from Elytron.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								<code class="literal">https-listener</code> must always have either a <code class="literal">security-realm</code> or <code class="literal">ssl-context</code> configured. When changing between the two configurations, the commands must be executed as a single batch, as shown below.
							</p></div><pre class="screen">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context, value=<span class="emphasis"><em>SERVER_SSL_CONTEXT</em></span>)
run-batch</pre></li><li class="listitem"><p class="simpara">
							Create an HTTP connector that references the HTTPS listener and the SASL authentication factory.
						</p><pre class="screen">/subsystem=remoting/http-connector=ssl-http-connector:add(connector-ref=https,sasl-authentication-factory=<span class="emphasis"><em>SASL_FACTORY</em></span>)</pre></li><li class="listitem"><p class="simpara">
							Reload the server.
						</p><pre class="screen">reload</pre></li><li class="listitem"><p class="simpara">
							Configure your client to trust the server certificate, and to present its certificate to the server.
						</p><p class="simpara">
							You need to configure your client to present the trusted client certificate to the server to complete the two-way SSL/TLS authentication. For example, if using a browser, you need to import the trusted certificate into the browser’s truststore.
						</p></li></ol></div><p>
					Two-way SSL/TLS is now enabled on the remoting HTTP connector.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						In cases where you have <span class="emphasis"><em>both</em></span> a <code class="literal">security-realm</code> and <code class="literal">ssl-context</code> defined, JBoss EAP will use the SSL/TLS configuration provided by <code class="literal">ssl-context</code>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_integration_remoting_outbound_connectors"/>Elytron Integration with Remoting Outbound Connectors</h2></div></div></div><p>
					A remote outbound connection is specified by an outbound socket binding and an authentication context. The authentication context provides all of the security information that is needed for the connection. In particular, the attributes for a <code class="literal">remote-outbound-connection</code> are as follows:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">outbound-socket-binding-ref</code> - The name of the outbound socket binding, which is used to determine the destination address and port for the connection.
						</li><li class="listitem">
							<code class="literal">authentication-context</code> - A reference to the authentication context, which contains the authentication configuration and the defined SSL context, if one exists, required for the connection. For information on defining an authentication context, see <a class="link" href="securing_the_server_and_its_interfaces.html#creating_an_authentication_context" title="Creating an Authentication Context">Creating an Authentication Context</a>.
						</li></ul></div><p>
					For example, a <code class="literal">remote-outbound-connection</code> can be added as follows, where <span class="emphasis"><em>OUTBOUND_SOCKET_BINDING_NAME</em></span> is an already defined <code class="literal">outbound-socket-binding</code> and <span class="emphasis"><em>AUTHENTICATION_CONTEXT_NAME</em></span> is an <code class="literal">authentication-context</code> that has already been defined in the <code class="literal">elytron</code> subsystem configuration.
				</p><pre class="screen">/subsystem=remoting/remote-outbound-connection=<span class="emphasis"><em>OUTBOUND_CONNECTION_NAME</em></span>:add(authentication-context=<span class="emphasis"><em>AUTHENTICATION_CONTEXT_NAME</em></span>, outbound-socket-binding-ref=<span class="emphasis"><em>OUTBOUND_SOCKET_BINDING_NAME</em></span>)</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="securing_managed_domain"/>Securing a Managed Domain</h1></div></div></div><p>
				In addition to securing the management interfaces, you can also secure communication between JBoss EAP instances in a managed domain.
			</p><p>
				For information on concepts and general configuration for the managed domain operating mode, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#domain_management">Domain Management</a> section of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_configure_password_slave_to_domain_controller"/>Configure Password Authentication Between Slaves and the Domain Controller Using Elytron</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Add a user on the master domain controller.
						</p><p class="simpara">
							A user needs to be added on the master domain controller for the slave controller to use for authentication. If you are using the default file based user and group authentication mechanism, this can be done by running <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/adduser.sh</code>. Add the username, password and other configurations when prompted.
						</p><p class="simpara">
							The <code class="literal">add-user</code> utility can be used to manage both the users in the <code class="literal">ManagementRealm</code> and the users in the <code class="literal">ApplicationRealm</code>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The server caches the contents of the properties files in memory. However, the server does check the modified time of the properties files on each authentication request and reloads if the time has been updated. This means that all changes made by the <code class="literal">add-user</code> utility are immediately applied to any running server.
							</p></div><p class="simpara">
							The slave controller attemps to authenticate using the native interface. If the native interface has been secured with the <code class="literal">ManagementRealm</code> Elytron security realm, then you would need to add a user to <code class="literal">ManagementRealm</code> for the slave controller to use.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The default name of the realm for management users is <code class="literal">ManagementRealm</code>. When the <code class="literal">add-user</code> utility prompts for the realm name, just accept the default unless you have switched to a different realm.
							</p></div><p class="simpara">
							The following example assumes the user <code class="literal">slave</code> with the password <code class="literal">password1!</code> has been added to <code class="literal">ManagementRealm</code>.
						</p></li><li class="listitem"><p class="simpara">
							Add an <code class="literal">authentication-configuration</code> to the slave controller.
						</p><pre class="screen">/host=slave/subsystem=elytron/authentication-configuration=slave:add(authentication-name=slave, credential-reference={clear-text=password1!})</pre></li><li class="listitem"><p class="simpara">
							Add an <code class="literal">authentication-context</code> to the slave controller.
						</p><pre class="screen">/host=slave/subsystem=elytron/authentication-context=slave-context:add(match-rules=[{authentication-configuration=slave}])</pre></li><li class="listitem"><p class="simpara">
							Specify the domain controller location and <code class="literal">authentication-context</code> in the slave controller.
						</p><pre class="screen">&lt;domain-controller&gt;
  &lt;remote protocol="remote" host="localhost" port="9999" authentication-context="slave-context"/&gt;
&lt;/domain-controller&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure-password-slave-to-domain-controller"/>Configure Password Authentication Between Slaves and the Domain Controller Using Legacy Core Management Authentication</h2></div></div></div><p>
					When configuring a managed domain, by default, the master domain controller is configured to require authentication for each slave controller that connects to it. To configure slave controllers with the proper credentials, you must do the following:
				</p><div class="orderedlist"><a id="add_user_master_domain_controller"/><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Add a user to the master domain controller
						</p><p class="simpara">
							You need to add a user to the master domain controller using the <code class="literal">add-user</code> script. Specifically, you will need to ensure that the user is added to the same realm the master uses to secure its management interface, which by default is <code class="literal">ManagementRealm</code>. You also need to ensure you answer <code class="literal">yes</code> to the <span class="emphasis"><em>Is this new user going to be used for one AS process to connect to another AS process?</em></span> question.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								After adding the user, the script will output a <span class="emphasis"><em>&lt;secret&gt;</em></span> element, which will be used in the next step. You must keep this value for use in the next step.
							</p></div><div class="title"><strong>Example: Adding a Slave User</strong></div><p>
								
</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/add-user.sh

What type of user do you wish to add?
 a) Management User (mgmt-users.properties)
 b) Application User (application-users.properties)
(a): a

Enter the details of the new user to add.
Using realm 'ManagementRealm' as discovered from the existing property files.
Username : slave-user
Password recommendations are listed below. To modify these restrictions edit the add-user.properties configuration file.
 - The password should be different from the username
 - The password should not be one of the following restricted values {root, admin, administrator}
 - The password should contain at least 8 characters, 1 alphabetic character(s), 1 digit(s), 1 non-alphanumeric symbol(s)
Password :
Re-enter Password :
What groups do you want this user to belong to? (Please enter a comma separated list, or leave blank for none)[  ]:
About to add user 'slave-user' for realm 'ManagementRealm'
Is this correct yes/no? yes
Added user 'slave-user' to file '/home/user/EAP-7.2.0/standalone/configuration/mgmt-users.properties'
Added user 'slave-user' to file '/home/user/EAP-7.2.0/domain/configuration/mgmt-users.properties'
Added user 'slave-user' with groups  to file '/home/user/EAP-7.2.0/standalone/configuration/mgmt-groups.properties'
Added user 'slave-user' with groups  to file '/home/user/EAP-7.2.0/domain/configuration/mgmt-groups.properties'
Is this new user going to be used for one AS process to connect to another AS process?
e.g. for a slave host controller connecting to the master or for a Remoting connection for server to server EJB calls.
yes/no? yes
To represent the user add the following to the server-identities definition &lt;secret value="ABCzc3dv11Qx" /&gt;</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure the slave controllers to use the credential.
						</p><p class="simpara">
							Once you have created the user on the master domain controller, you will need to update each slave controller to use that credential in the host configuration file, for example <code class="literal">host.xml</code> or <code class="literal">host-slave.xml</code>. To do so, you need to add the user name to the <code class="literal">&lt;remote&gt;</code> element in the domain controller configuration. You will also need to add the <span class="emphasis"><em>&lt;secret&gt;</em></span> to the <code class="literal">server identities</code> of the realm used to secure the <code class="literal">&lt;remote&gt;</code> element. Both the user name and <span class="emphasis"><em>&lt;secret&gt;</em></span> were obtained when adding the user to the master domain controller in the previous step.
						</p><p><a id="configuring_slave_controllers_use_credential"/></p><div class="title"><strong>Example: Configuring Slave Controllers</strong></div><p>
								
</p><pre class="programlisting">...
&lt;security-realm name="ManagementRealm"&gt;
    &lt;server-identities&gt;
        &lt;!-- Replace this with either a base64 password of your own, or use a vault with a vault expression --&gt;
        &lt;secret value="ABCzc3dv11Qx"/&gt;
    &lt;/server-identities&gt;
...
&lt;domain-controller&gt;
  &lt;remote security-realm="ManagementRealm" username="slave-user"&gt;
      &lt;discovery-options&gt;
          &lt;static-discovery name="primary" protocol="${jboss.domain.master.protocol:remote}" host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}"/&gt;
      &lt;/discovery-options&gt;
  &lt;/remote&gt;
&lt;/domain-controller&gt;</pre><p>

							</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure-ssl-managed-domain-elytron"/>Configuring SSL/TLS Between Domain and Host Controllers Using Elytron</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						When you configure SSL/TLS to be used between JBoss EAP instances in a managed domain, each instance can have a client or server role depending on the interaction. This includes all host controllers as well as domain controllers. As a result, it is recommended that you set up two-way SSL/TLS between endpoints.
					</p></div><p>
					You can configure JBoss EAP instances in a managed domain to use SSL/TLS when communicating with each other, in other words, between the master domain controller and host controllers. To do so using Elytron, use the following procedure.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Generate and configure all necessary certificates and keystores.
						</p><p class="simpara">
							In order to set up two-way SSL/TLS between endpoints, you need to generate and configure certificates and keystores for the master domain controller as well as each host controller. You also need to import the certificate of the master domain controller into each host controller’s keystore as well as import each host controller’s certificate into the master domain controller’s keystore. The specifics of this process is covered in <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_mgmt" title="Enable Two-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem">Enable Two-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem</a>.
						</p></li><li class="listitem"><p class="simpara">
							Add a user on the master domain controller.
						</p><p class="simpara">
							A user needs to be added on the master domain controller for the slave controller to use for authentication. If you are using the default file based user and group authentication mechanism, this can be done by running <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/adduser.sh</code>. Add the username, password and other configurations when prompted.
						</p><p class="simpara">
							The <code class="literal">add-user</code> utility can be used to manage both the users in the <code class="literal">ManagementRealm</code> and the users in the <code class="literal">ApplicationRealm</code>.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The server caches the contents of the properties files in memory. However, the server does check the modified time of the properties files on each authentication request and reloads if the time has been updated. This means that all changes made by the <code class="literal">add-user</code> utility are immediately applied to any running server.
							</p></div><p class="simpara">
							The slave controller attemps to authenticate using the native interface. If the native interface has been secured with the <code class="literal">ManagementRealm</code> Elytron security realm, then you would need to add a user to <code class="literal">ManagementRealm</code> for the slave controller to use.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The default name of the realm for management users is <code class="literal">ManagementRealm</code>. When the <code class="literal">add-user</code> utility prompts for the realm name, just accept the default unless you have switched to a different realm.
							</p></div><p class="simpara">
							The following example assumes the user <code class="literal">slave</code> with the password <code class="literal">password1!</code> has been added to <code class="literal">ManagementRealm</code>.
						</p></li><li class="listitem"><p class="simpara">
							Configure the master domain controller to use SSL/TLS.
						</p><p class="simpara">
							The commands below configure the domain controller’s <code class="literal">key-store</code>, <code class="literal">key-manager</code>, <code class="literal">trust-manager</code>, and <code class="literal">server-ssl-context</code> for the server keystore and truststore.
						</p><pre class="screen">/host=master/subsystem=elytron/key-store=twoWayKS:add(path=/path/to/server.keystore.jks,credential-reference={clear-text=secret},type=JKS)

/host=master/subsystem=elytron/key-store=twoWayTS:add(path=/path/to/server.truststore.jks,credential-reference={clear-text=secret},type=JKS)

/host=master/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,algorithm="SunX509",credential-reference={clear-text=secret})

/host=master/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS,algorithm="SunX509")

/host=master/subsystem=elytron/server-ssl-context=twoWaySSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM,want-client-auth=true,need-client-auth=true)

/host=master/core-service=management/management-interface=native-interface:write-attribute(name=ssl-context, value=twoWaySSC)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								You need to know what key manager algorithms are provided by the JDK you are using. For example, a JDK <a class="link" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SupportClasses">that uses SunJSSE</a> provides the <code class="literal">PKIX</code> and <code class="literal">SunX509</code> algorithms. You also need to determine what HTTPS protocols you want to support. The example commands above use <code class="literal">TLSv1.2</code>. You can use the <code class="literal">cipher-suite-filter</code> argument to specify which cipher suites are allowed, and the <code class="literal">use-cipher-suites-order</code> argument to honor server cipher suite order. The <code class="literal">use-cipher-suites-order</code> attribute by default is set to <code class="literal">true</code>. This differs from the legacy <code class="literal">security</code> subsystem behavior, which defaults to honoring client cipher suite order.
							</p></div></li><li class="listitem"><p class="simpara">
							Configure an authentication context and domain controller location on each slave host controller.
						</p><p class="simpara">
							The following example configuration assumes the domain controller exists on <code class="literal">localhost</code>. Ensure you specify the correct management user, password, and domain controller location for your environment.
						</p><pre class="screen">/host=slave1/subsystem=elytron/authentication-context=slaveHostSSLContext:add()

/host=slave1/subsystem=elytron/authentication-configuration=slaveHostSSLConfiguration:add()

/host=slave1/subsystem=elytron/authentication-configuration=slaveHostSSLConfiguration:write-attribute(name=sasl-mechanism-selector,value=DIGEST-MD5)

/host=slave1/subsystem=elytron/authentication-configuration=slaveHostSSLConfiguration:write-attribute(name=authentication-name,value=slave)

/host=slave1/subsystem=elytron/authentication-configuration=slaveHostSSLConfiguration:write-attribute(name=realm,value=ManagementRealm)

/host=slave1/subsystem=elytron/authentication-configuration=slaveHostSSLConfiguration:write-attribute(name=credential-reference,value={clear-text=password1!})

/host=slave1/subsystem=elytron/authentication-context=slaveHostSSLContext:write-attribute(name=match-rules,value=[{match-host=localhost,authentication-configuration=slaveHostSSLConfiguration}]

/host=slave1:write-remote-domain-controller(host=localhost,port=9999,protocol=remote,authentication-context=slaveHostSSLContext)</pre></li><li class="listitem"><p class="simpara">
							Configure each slave host controller to use SSL/TLS.
						</p><p class="simpara">
							The commands below configure a slave host controller’s <code class="literal">key-store</code>, <code class="literal">key-manager</code>, <code class="literal">trust-manager</code>, <code class="literal">client-ssl-context</code> for the server keystore and truststore, as well as the <code class="literal">authentication-context</code>.
						</p><p class="simpara">
							The following example configuration assumes the domain controller exists on <code class="literal">localhost</code>. Ensure you specify the correct domain controller location for your environment.
						</p><pre class="screen">/host=slave1/subsystem=elytron/key-store=twoWayKS:add(path=/path/to/client.keystore.jks,credential-reference={clear-text=secret},type=JKS)

/host=slave1/subsystem=elytron/key-store=twoWayTS:add(path=/path/to/client.truststore.jks,credential-reference={clear-text=secret},type=JKS)

/host=slave1/subsystem=elytron/key-manager=twoWayKM:add(key-store=twoWayKS,algorithm="SunX509",credential-reference={clear-text=secret})

/host=slave1/subsystem=elytron/trust-manager=twoWayTM:add(key-store=twoWayTS,algorithm="SunX509")

/host=slave1/subsystem=elytron/client-ssl-context=twoWayCSC:add(key-manager=twoWayKM,protocols=["TLSv1.2"],trust-manager=twoWayTM)

/host=slave1/subsystem=elytron/authentication-context=slaveHostSSLContext:write-attribute(name=match-rules,value=[{match-host=localhost,authentication-configuration=slaveHostSSLConfiguration,ssl-context=twoWayCSC}])</pre></li><li class="listitem">
							Reload all the JBoss EAP hosts in your managed domain.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure-ssl-managed-domain"/>Configuring SSL/TLS Between Domain and Host Controllers Using Legacy Core Management Authentication</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						When you configure SSL/TLS to be used between JBoss EAP instances in a managed domain, each instance can have a client or server role depending on the interaction. This includes all host controllers as well as domain controllers. As a result, it is recommended that you set up two-way SSL/TLS between endpoints.
					</p></div><p>
					You can configure JBoss EAP instances in a managed domain to use SSL/TLS when communicating with each other, in other words, between the master domain controller and host controllers. To do so using legacy core management authentication, use the following procedure.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Generate and configure all necessary certificates and keystores.
						</p><p class="simpara">
							In order to set up two-way SSL/TLS between endpoints, you need to generate and configure certificates and keystores for the master domain controller as well as each host controller. You also need to import the certificate of the master domain controller into each host controller’s keystore as well as import each host controller’s certificate into the master domain controller’s keystore. The specifics of this process is covered in <a class="link" href="securing_the_server_and_its_interfaces.html#mgmt-interface-two-way-ssl-legacy" title="Setting up Two-way SSL/TLS for the Management Interfaces with Legacy Core Management Authentication">Setting up Two-way SSL/TLS for the Management Interfaces with Legacy Core Management Authentication</a>.
						</p></li><li class="listitem"><p class="simpara">
							Configure the master domain controller to use SSL/TLS.
						</p><p class="simpara">
							Once you have configured all certificates and keystores, you need to configure a security realm to use two-way SSL/TLS. This is done by configuring a security realm to use SSL/TLS and to require it for authentication. That security realm is then used to secure the management interface used for connecting between host controllers and the master domain controller.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The following commands below must either be run in batch mode, or the server must be reloaded after adding the <span class="emphasis"><em>ssl</em></span> server identity. The example below is shown using batch mode.
							</p></div><pre class="screen">batch

/host=master/core-service=management/security-realm=CertificateRealm:add()

/host=master/core-service=management/security-realm=CertificateRealm/server-identity=ssl:add(alias=domaincontroller,keystore-relative-to=jboss.domain.config.dir,keystore-path=domaincontroller.jks,keystore-password=secret)

/host=master/core-service=management/security-realm=CertificateRealm/authentication=truststore:add(keystore-relative-to=jboss.domain.config.dir,keystore-path=domaincontroller.jks,keystore-password=secret)

/host=master/core-service=management/security-realm=CertificateRealm/authentication=local:add(default-user=\$local)

/host=master/core-service=management/security-realm=CertificateRealm/authentication=properties:add(relative-to=jboss.domain.config.dir,path=mgmt-users.properties)

/host=master/core-service=management/management-interface=native-interface:write-attribute(name=security-realm,value=CertificateRealm)

run-batch</pre></li><li class="listitem"><p class="simpara">
							Configure all host controllers to use SSL/TLS.
						</p><p class="simpara">
							Once you have the master domain controller configured to use two-way SSL/TLS, you need to configure each host controller to use it as well. The process is very much the same as the master domain controller configuration, except you will need to use the keystore specific to each host.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The following commands below must either be run in batch mode, or the server must be reloaded after adding the <span class="emphasis"><em>ssl</em></span> server identity. The example below is shown using batch mode.
							</p></div><pre class="screen">batch

/host=instance1/core-service=management/security-realm=CertificateRealm:add()

/host=instance1/core-service=management/security-realm=CertificateRealm/server-identity=ssl:add(alias=instance1,keystore-relative-to=jboss.domain.config.dir,keystore-path=instance1.jks,keystore-password=secret)

/host=instance1/core-service=management/security-realm=CertificateRealm/authentication=truststore:add(keystore-relative-to=jboss.domain.config.dir,keystore-path=instance1.jks,keystore-password=secret)

/host=instance1/core-service=management/security-realm=CertificateRealm/authentication=local:add(default-user="\$local")

/host=instance1/core-service=management/security-realm=CertificateRealm/authentication=properties:add(relative-to=jboss.domain.config.dir,path=mgmt-users.properties)

/host=instance1/core-service=management/management-interface=native-interface:write-attribute(name=security-realm,value=CertificateRealm)

run-batch</pre><p class="simpara">
							Additionally, you will need to update the security realm used when connecting the master domain controller. This change must be done directly in the host controller’s configuration file, for example <code class="literal">host.xml</code> or <code class="literal">host-slave.xml</code>, while the server is not running.
						</p><div class="title"><strong>Example: Host Controller Configuration File</strong></div><p>
								
</p><pre class="programlisting">&lt;domain-controller&gt;
  &lt;remote security-realm="CertificateRealm" username="slave-user"&gt;
    &lt;discovery-options&gt;
      &lt;static-discovery name="primary" protocol="${jboss.domain.master.protocol:remote}" host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}"/&gt;
    &lt;/discovery-options&gt;
  &lt;/remote&gt;
&lt;/domain-controller&gt;</pre><p>

							</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
								Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
							</p></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="additional_components_ssl_tls"/>Additional Elytron Components for SSL/TLS</h1></div></div></div><p>
				The basic concepts behind configuring one-way SSL/TLS and two-way SSL/TLS are covered in the following:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_apps" title="Enable One-way SSL/TLS for Applications Using the Elytron Subsystem">Enable One-way SSL/TLS for Applications Using the Elytron Subsystem</a>
					</li><li class="listitem">
						<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem</a>
					</li><li class="listitem">
						<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_mgmt" title="Enable One-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem">Enable One-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem</a>
					</li><li class="listitem">
						<a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_mgmt" title="Enable Two-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem">Enable Two-way SSL/TLS for the Management Interfaces Using the Elytron Subsystem</a>
					</li></ul></div><p>
				Elytron also offers some additional components for configuring SSL/TLS.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_ldap_key_store"/>Using an ldap-key-store</h2></div></div></div><p>
					An <code class="literal">ldap-key-store</code> allows you to use a keystore stored in an LDAP server. You can use an <code class="literal">ldap-key-store</code> in the same way as you use a <code class="literal">key-store</code>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						It is not possible to use a JMX ObjectName to decrypt the LDAP credentials. Instead, credentials can be secured by using a <a class="link" href="securely_storing_credentials.html#credential_store" title="Credential Store">credential store</a>.
					</p></div><p>
					To create and use an <code class="literal">ldap-key-store</code>:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Configure a <code class="literal">dir-context</code>.
						</p><p class="simpara">
							To connect to the LDAP server from JBoss EAP, you need to configure a <code class="literal">dir-context</code> that provides the URL as well as the principal used to connect to the server.
						</p><div class="title"><strong>Example: dir-context</strong></div><p>
								
</p><pre class="screen">/subsystem=elytron/dir-context=exampleDC:add(url="ldap://127.0.0.1:10389", principal="uid=admin,ou=system", credential-reference={clear-text="secret"})</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Configure an <code class="literal">ldap-key-store</code>.
						</p><p class="simpara">
							When you configure an <code class="literal">ldap-key-store</code>, you need to specify both the <code class="literal">dir-context</code> used to connect to the LDAP server as well as how to locate the keystore stored in the LDAP server. At a minimum, this requires you to specify a <code class="literal">search-path</code>.
						</p><div class="title"><strong>Example: ldap-key-store</strong></div><p>
								
</p><pre class="screen">/subsystem=elytron/ldap-key-store=ldapKS:add(dir-context=exampleDC, search-path="ou=Keystores,dc=wildfly,dc=org")</pre><p>

							</p></li><li class="listitem"><p class="simpara">
							Use the <code class="literal">ldap-key-store</code>.
						</p><p class="simpara">
							Once you have defined your <code class="literal">ldap-key-store</code>, you can use it in the same places where a <code class="literal">key-store</code> could be used. For example, you could use an <code class="literal">ldap-key-store</code> when configuring <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_apps" title="Enable One-way SSL/TLS for Applications Using the Elytron Subsystem">One-way SSL/TLS</a> and <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Two-way SSL/TLS</a> for applications.
						</p></li></ol></div><p>
					For the full list of attributes for <code class="literal">ldap-key-store</code> as well as other Elytron components, see <a class="link" href="reference_material.html#elytron_subsystem_components_reference" title="Elytron Subsystem Components Reference">Elytron Subsystem Components Reference</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_filtering_key_store"/>Using a filtering-key-store</h2></div></div></div><p>
					A <code class="literal">filtering-key-store</code> allows you to expose a subset of aliases from an existing <code class="literal">key-store</code>, and use it in the same places you could use a <code class="literal">key-store</code>. For example, if a keystore contained <code class="literal">alias1</code>, <code class="literal">alias2</code>, and <code class="literal">alias3</code>, but you only wanted to expose <code class="literal">alias1</code> and <code class="literal">alias3</code>, a <code class="literal">filtering-key-store</code> provides you several ways to do that.
				</p><p>
					To create a <code class="literal">filtering-key-store</code>:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Configure a <code class="literal">key-store</code>.
						</p><pre class="screen">/subsystem=elytron/key-store=myKS:add(path=keystore.jks, relative-to=jboss.server.config.dir, credential-reference={clear-text=secret}, type=JKS)</pre></li><li class="listitem"><p class="simpara">
							Configure a <code class="literal">filtering-key-store</code>.
						</p><p class="simpara">
							When you configure a <code class="literal">filtering-key-store</code>, you specify which <code class="literal">key-store</code> you want to filter and the <code class="literal">alias-filter</code> for filtering aliases from the <code class="literal">key-store</code>. The filter can be specified in one of the following formats:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<code class="literal">alias1,alias3</code>, which is a comma-delimited list of aliases to expose.
								</li><li class="listitem">
									<code class="literal">ALL:-alias2</code>, which exposes all aliases in the keystore except the ones listed.
								</li><li class="listitem"><p class="simpara">
									<code class="literal">NONE:+alias1:+alias3</code>, which exposes no aliases in the keystore except the ones listed.
								</p><p class="simpara">
									This example uses a comma-delimted list to expose <code class="literal">alias1</code> and <code class="literal">alias3</code>.
								</p><pre class="screen">/subsystem=elytron/filtering-key-store=filterKS:add(key-store=myKS, alias-filter="alias1,alias3")</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
										The <code class="literal">alias-filter</code> attribute is case sensitive. Because the use of mixed-case or uppercase aliases, such as <code class="literal">elytronAppServer</code>, might not be recognized by some keystore providers, it is recommended to use lowercase aliases, such as <code class="literal">elytronappserver</code>.
									</p></div></li></ul></div></li><li class="listitem"><p class="simpara">
							Use the <code class="literal">filtering-key-store</code>.
						</p><p class="simpara">
							Once you have defined your <code class="literal">filtering-key-store</code>, you can use it in the same places where a <code class="literal">key-store</code> could be used. For example, you could use a <code class="literal">filtering-key-store</code> when configuring <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_one_way_ssl_apps" title="Enable One-way SSL/TLS for Applications Using the Elytron Subsystem">One-way SSL/TLS</a> and <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Two-way SSL/TLS</a> for applications.
						</p></li></ol></div><p>
					For the full list of attributes for <code class="literal">filtering-key-store</code> as well as other Elytron components, see <a class="link" href="reference_material.html#elytron_subsystem_components_reference" title="Elytron Subsystem Components Reference">Elytron Subsystem Components Reference</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reload_a_keystore"/>Reload a Keystore</h2></div></div></div><p>
					You can reload a keystore configured in JBoss EAP from the management CLI. This is useful in cases where you have made changes to certificates referenced by a keystore.
				</p><p>
					To reload a keystore:
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:load</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reinitialize_a_key_manager"/>Reinitialize a Key Manager</h2></div></div></div><p>
					You can reinitialize a <code class="literal">key-manager</code> configured in JBoss EAP from the management CLI. This is useful in cases where you have made changes in certificates provided by keystore resource and you want to apply this change to new SSL connections without restarting the server.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If the <code class="literal">key-store</code> is file based then it must be loaded first.
					</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:load()</pre></div><p>
					To reinitialize a <code class="literal">key-manager</code>:
				</p><pre class="screen">/subsystem=elytron/key-manager=httpsKM:init()</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reinitialize_a_trust_manager"/>Reinitialize a Trust Manager</h2></div></div></div><p>
					You can reinitialize a <code class="literal">trust-manager</code> configured in JBoss EAP from the management CLI. This is useful in cases where you have made changes to certificates provided by keystore resource and you want to apply this change to new SSL connections without restarting the server.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If the <code class="literal">key-store</code> is file based then it must be loaded first.
					</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:load()</pre></div><p>
					To reinitialize a <code class="literal">trust-manager</code>:
				</p><pre class="screen">/subsystem=elytron/trust-manager=httpsTM:init()</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="keystore_alias"/>Keystore Alias</h2></div></div></div><p>
					The <code class="literal">alias</code> denotes the stored secret or credential in the store. If you add a keystore to the <code class="literal">elytron</code> subsystem using the <code class="literal">key-store</code> component, you can check the keystore’s contents using the <code class="literal">alias</code> related <code class="literal">key-store</code> operations.
				</p><p>
					The different operations for alias manipulation are:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">read-alias</code> - Read an alias from a keystore.
						</li><li class="listitem">
							<code class="literal">read-aliases</code> - Read aliases from a keystore.
						</li><li class="listitem">
							<code class="literal">remove-alias</code> - Remove an alias from a keystore.
						</li></ul></div><p>
					For example, to read an alias:
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS/:read-alias(alias=localhost)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_client_ssl_context"/>Using a client-ssl-context</h2></div></div></div><p>
					A <code class="literal">client-ssl-context</code> is used for providing an SSL context when the JBoss EAP instance creates an SSL connection as a client, such as using SSL in remoting.
				</p><p>
					To create a <code class="literal">client-ssl-context</code>:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_keystore" title="Create an Elytron Keystore"><code class="literal">key-store</code></a>, <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_key_manager" title="Create an Elytron Key Manager"><code class="literal">key-manager</code></a>, and <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_manager" title="Create an Elytron Trust Manager"><code class="literal">trust-manager</code></a> components as needed.
						</p><p class="simpara">
							If establishing a two-way SSL/TLS connection, you need to create separate <code class="literal">key-store</code> components for the client and server certificates, a <code class="literal">key-manager</code> for the client <code class="literal">key-store</code>, and a <code class="literal">trust-manager</code> for the server <code class="literal">key-store</code>. Alternatively, if you are doing a one-way SSL/TLS connection, you need to create a <code class="literal">key-store</code> for the server certificate and a <code class="literal">trust-manager</code> that references it. Examples on creating keystores and truststores are available in the <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Enable Two-way SSL/TLS for Applications using the Elytron Subsystem</a> section.
						</p></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">client-ssl-context</code>.
						</p><p class="simpara">
							Create a <code class="literal">client-ssl-context</code> referencing keystores, truststores, as well as any other necessary configuration options.
						</p><div class="title"><strong>Example: client-ssl-context</strong></div><p>
								
</p><pre class="screen">/subsystem=elytron/client-ssl-context=exampleCSC:add(key-manager=clientKM, trust-manager=clientTM, protocols=["TLSv1.2"])</pre><p>

							</p></li><li class="listitem">
							Reference the <code class="literal">client-ssl-context</code>.
						</li></ol></div><p>
					For the full list of attributes for <code class="literal">client-ssl-context</code> as well as other Elytron components, see <a class="link" href="reference_material.html#elytron_subsystem_components_reference" title="Elytron Subsystem Components Reference">Elytron Subsystem Components Reference</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_server_ssl_context"/>Using a server-ssl-context</h2></div></div></div><p>
					A <code class="literal">server-ssl-context</code> is used for providing a server-side SSL context. In addition to the usual configuration for an SSL context, it is possible to configure additional items such as cipher suites and protocols. The SSL context will wrap any additional items that are configured.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_keystore" title="Create an Elytron Keystore"><code class="literal">key-store</code></a>, <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_key_manager" title="Create an Elytron Key Manager"><code class="literal">key-manager</code></a>, and <a class="link" href="securing_the_server_and_its_interfaces.html#create_an_elytron_trust_manager" title="Create an Elytron Trust Manager"><code class="literal">trust-manager</code></a> components as needed.
						</p><p class="simpara">
							If establishing a two-way SSL/TLS connection, you need to create separate <code class="literal">key-store</code> components for the client and server certificates, a <code class="literal">key-manager</code> for the server <code class="literal">key-store</code>, and a <code class="literal">trust-manager</code> for the server <code class="literal">trust-store</code>. Alternatively, if you are doing a one-way SSL/TLS connection, you need to create a <code class="literal">key-store</code> for the server certificate and a <code class="literal">key-manager</code> that references it. Examples on creating keystores and truststores are available in the <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_two-way_ssl_apps" title="Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem">Enable Two-way SSL/TLS for Applications Using the Elytron Subsystem</a> section.
						</p></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">server-ssl-context</code>.
						</p><p class="simpara">
							Create a <code class="literal">server-ssl-context</code> that references the key manager, trust manager, or any other desired configuration options using one of the options outlined below.
						</p></li></ol></div><h4><a id="add_a_server_ssl_context_using_the_management_cli"/>Add a Server SSL Context Using the Management CLI</h4><pre class="screen">/subsystem=elytron/server-ssl-context=newServerSSLContext:add(key-manager=<span class="emphasis"><em>KEY_MANAGER</em></span>,protocols=["TLSv1.2"])</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						You need to determine what HTTPS protocols will be supported. The example commands above use <code class="literal">TLSv1.2</code>. You can use the <code class="literal">cipher-suite-filter</code> argument to specify which cipher suites are allowed, and the <code class="literal">use-cipher-suites-order</code> argument to honor server cipher suite order. The <code class="literal">use-cipher-suites-order</code> attribute by default is set to <code class="literal">true</code>. This differs from the legacy <code class="literal">security</code> subsystem behavior, which defaults to honoring client cipher suite order.
					</p></div><h4><a id="add_a_server_ssl_context_using_the_management_console"/>Add a Server SSL Context Using the Management Console</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Access the management console. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> section in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li><li class="listitem">
							Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Elytron)</strong></span> → <span class="strong"><strong>Other Settings</strong></span> and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Click on <span class="strong"><strong>SSL</strong></span> → <span class="strong"><strong>Server SSL Context</strong></span> and click <span class="strong"><strong>Add</strong></span> to configure a new server SSL context.
						</li></ol></div><p>
					For the full list of attributes for <code class="literal">server-ssl-context</code> as well as other Elytron components, see <a class="link" href="reference_material.html#elytron_subsystem_components_reference" title="Elytron Subsystem Components Reference">Elytron Subsystem Components Reference</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_ssl_custom_components"/>Custom SSL Components</h2></div></div></div><p>
					When configuring SSL/TLS in the <code class="literal">elytron</code> subsystem, you can provide and use custom implementations of the following components:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">key-store</code>
						</li><li class="listitem">
							<code class="literal">key-manager</code>
						</li><li class="listitem">
							<code class="literal">trust-manager</code>
						</li><li class="listitem">
							<code class="literal">client-ssl-context</code>
						</li><li class="listitem">
							<code class="literal">server-ssl-context</code>
						</li></ul></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						It is not recommended to provide custom implementations of any component outside of the <code class="literal">trust-manager</code> without an intimate knowledge of the Java Secure Socket Extension (JSSE).
					</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						When using FIPS it is not possible to utilize a custom trust manager or key manager, as FIPS requires these managers be embedded in the JDK for security reasons. Similar behavior can be accomplished by implementing a <code class="literal">SecurityRealm</code> that validates X509 evidences.
					</p></div><p>
					When creating custom implementations of Elytron components, they must present the appropriate capabilities and requirements. For more details on capabilities and requirements, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#capabilities_and_requirements">Capabilities and Requirements</a> section of the JBoss EAP <span class="emphasis"><em>Security Architecture</em></span> guide. Implementation details for each component are provided by the JDK vendor.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="add_custom_component_elytron"/>Add a Custom Component to Elytron</h3></div></div></div><p>
						The following steps describe adding a custom component within Elytron.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Add the JAR containing the provider for the custom component as a module into JBoss EAP, declaring any required dependencies, such as <code class="literal">javax.api</code>:
							</p><pre class="screen">module add --name=<span class="emphasis"><em>MODULE_NAME</em></span> --resources=<span class="emphasis"><em>FACTORY_JAR</em></span> --dependencies=javax.api,<span class="emphasis"><em>DEPENDENCY_LIST</em></span></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									Using the <code class="literal">module</code> management CLI command to add and remove modules is provided as Technology Preview only. This command is not appropriate for use in a managed domain or when connecting to the management CLI remotely. Modules should be added and removed manually in a production environment. For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#create_module_manually">Create a Custom Module Manually</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#remove_module_manually">Remove a Custom Module Manually</a> sections of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
								</p><p>
									Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
								</p><p>
									See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
								</p></div></li><li class="listitem"><p class="simpara">
								When the component is added to the <code class="literal">elytron</code> subsystem the <a class="link" href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html"><code class="literal">java.util.ServiceLoader</code></a> will be used to discover the provider. Alternatively, a reference to the provider can be provided by defining a <a class="link" href="reference_material.html#provider_loader_attributes" title="Table A.74. provider-loader Attributes"><code class="literal">provider-loader</code></a>. There are two methods of creating the loader, and only one should be implemented for each component.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										Reference the provider directly when defining the <code class="literal">provider-loader</code>:
									</p><pre class="screen">/subsystem=elytron/provider-loader=<span class="emphasis"><em>LOADER_NAME</em></span>:add(class-names=[<span class="emphasis"><em>CLASS_NAME</em></span>],module=<span class="emphasis"><em>MODULE_NAME</em></span>)</pre></li><li class="listitem"><p class="simpara">
										Include a reference to the provider in <code class="literal">META-INF/services/java.security.Provider</code>. This reference is automatically created when using the <code class="literal">@MetaInfServices</code> annotation in <code class="literal">org.kohsuke.metainf-services</code>. When using this method only the module needs to be referenced by the <code class="literal">provider-loader</code>, as seen below:
									</p><pre class="screen">/subsystem=elytron/provider-loader=<span class="emphasis"><em>LOADER_NAME</em></span>:add(module=<span class="emphasis"><em>MODULE_NAME</em></span>)</pre></li></ul></div></li><li class="listitem"><p class="simpara">
								Add the custom component into Elytron’s configuration, using the appropriate element for the type to be added and referencing any defined providers.
							</p><pre class="screen">/subsystem=elytron/<span class="emphasis"><em>COMPONENT_NAME</em></span>=<span class="emphasis"><em>NEW_COMPONENT</em></span>:add(providers=<span class="emphasis"><em>LOADER_NAME</em></span>,...)</pre><p class="simpara">
								For instance, to define a trust manager, the <code class="literal">trust-manager</code> element would be used, as seen in the following command:
							</p><div class="title"><strong>Example: Adding a Custom Trust Manager</strong></div><p>
									
</p><pre class="screen">/subsystem=elytron/trust-manager=newTrustManager:add(algorithm=MyX509,providers=customProvider,key-store=sampleKeystore)</pre><p>

								</p></li><li class="listitem">
								Once defined, the component can be referenced from other elements.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="elytron_custom_component_configuration"/>Including Arguments in a Custom Elytron Component</h3></div></div></div><p>
						You can include arguments within a custom component if your class implements the <code class="literal">initialize</code> method, as seen below.
					</p><pre class="programlisting">void initialize(final Map&lt;String, String&gt; configuration);</pre><p>
						This method allows the custom class to receive a set of configuration strings when defined. These are passed in using the <code class="literal">configuration</code> attribute when defining the component. For instance, the following example defines an attribute named <code class="literal">myAttribute</code> with a value of <code class="literal">myValue</code>.
					</p><pre class="screen">/subsystem=elytron/<span class="emphasis"><em>COMPONENT_NAME</em></span>=<span class="emphasis"><em>NEW_COMPONENT</em></span>:add(class-name=<span class="emphasis"><em>CLASS_NAME</em></span>,module=<span class="emphasis"><em>MODULE_NAME</em></span>,configuration={myAttribute="myValue"}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="using_custom_trust_managers_with_elytron"/>Using Custom Trust Managers with Elytron</h3></div></div></div><p>
						By implementing a custom trust manager, it is possible to extend the validation of certificates when using HTTPS in Undertow, LDAPS in a <code class="literal">dir-context</code>, or any place where Elytron is used for SSL connections. This component is responsible for making trust decisions for the server, and it is strongly recommended that these be implemented if a custom trust manager is used.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							When using FIPS it is not possible to utilize a custom trust manager, as FIPS requires this manager be embedded in the JDK for security reasons. Similar behavior can be accomplished by implementing a <code class="literal">SecurityRealm</code> that validates X509 evidences.
						</p></div><h5><a id="requirements_for_implementing_a_custom_trust_manager"/>Requirements for Implementing a Custom Trust Manager</h5><p>
						When using a custom trust manager, the following must be implemented:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A trust manager that implements the <code class="literal">X509ExtendedTrustManager</code> interface.
							</li><li class="listitem">
								A trust manager factory that extends <code class="literal">TrustManagerFactorySpi</code>.
							</li><li class="listitem">
								The provider of the trust manager factory.
							</li></ul></div><p>
						The provider must be included in the JAR file to be added into JBoss EAP. Any implemented classes must be included in JBoss EAP as a module. Classes are not required to be in one module, and can be loaded from module dependencies.
					</p><h5><a id="example_implementations"/>Example Implementations</h5><p>
						The following example demonstrates a provider that registers the custom trust manager factory as a service.
					</p><div class="title"><strong>Example: Provider</strong></div><p>
							
</p><pre class="programlisting">import org.kohsuke.MetaInfServices;
import javax.net.ssl.TrustManagerFactory;
import java.security.Provider;
import java.util.Collections;
import java.util.List;
import java.util.Map;

@MetaInfServices(Provider.class)
public class CustomProvider extends Provider {

    public CustomProvider() {
        super("CustomProvider", 1.0, "Demo provider");

        System.out.println("CustomProvider initialization.");

        final List&lt;String&gt; emptyList = Collections.emptyList();
        final Map&lt;String, String&gt; emptyMap = Collections.emptyMap();

        putService(new Service(this, TrustManagerFactory.class.getSimpleName(),"CustomAlgorithm", CustomTrustManagerFactorySpi.class.getName(), emptyList, emptyMap));
    }

}</pre><p>

						</p><p>
						The following example demonstrates a custom trust manager. This trust manager contains overloaded methods on checking if a client or server is trusted.
					</p><div class="title"><strong>Example: TrustManager</strong></div><p>
							
</p><pre class="programlisting">import javax.net.ssl.SSLEngine;
import javax.net.ssl.X509ExtendedTrustManager;
import java.net.Socket;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;

public class CustomTrustManager extends X509ExtendedTrustManager {

    public void checkClientTrusted(X509Certificate[] x509Certificates, String s, Socket socket) throws CertificateException {
        // Insert your code here
    }

    public void checkServerTrusted(X509Certificate[] x509Certificates, String s, Socket socket) throws CertificateException {
        // Insert your code here
    }

    public void checkClientTrusted(X509Certificate[] x509Certificates, String s, SSLEngine sslEngine) throws CertificateException {
        // Insert your code here
    }

    public void checkServerTrusted(X509Certificate[] x509Certificates, String s, SSLEngine sslEngine) throws CertificateException {
        // Insert your code here
    }

    public void checkClientTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
        // Insert your code here
    }

    public void checkServerTrusted(X509Certificate[] x509Certificates, String s) throws CertificateException {
        // Insert your code here
    }

    public X509Certificate[] getAcceptedIssuers() {
        // Insert your code here
    }

}</pre><p>

						</p><p>
						The following example is a factory used to return instances of the trust manager.
					</p><div class="title"><strong>Example: TrustManagerFactorySpi</strong></div><p>
							
</p><pre class="programlisting">import javax.net.ssl.ManagerFactoryParameters;
import javax.net.ssl.TrustManager;
import javax.net.ssl.TrustManagerFactorySpi;
import java.security.InvalidAlgorithmParameterException;
import java.security.KeyStore;
import java.security.KeyStoreException;

public class CustomTrustManagerFactorySpi extends TrustManagerFactorySpi {

    protected void engineInit(KeyStore keyStore) throws KeyStoreException {
        // Insert your code here
    }

    protected void engineInit(ManagerFactoryParameters managerFactoryParameters) throws InvalidAlgorithmParameterException {
        // Insert your code here
    }

    protected CustomTrustManager[] engineGetTrustManagers() {
        // Insert your code here
    }

}</pre><p>

						</p><h5><a id="adding_the_custom_trust_manager"/>Adding the Custom Trust Manager</h5><p>
						Once the provider and trust manager have been created, add them to the <code class="literal">elytron</code> subsystem by using the steps outlined in <a class="link" href="securing_the_server_and_its_interfaces.html#add_custom_component_elytron" title="Add a Custom Component to Elytron">Add a Custom Component to Elytron</a>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_certificate_revocation_list"/>Using a Certificate Revocation List</h2></div></div></div><p>
					If you want to validate a certificate against a certificate revocation list (CRL), you can configure this using the <code class="literal">certificate-revocation-list</code> attribute for a trust manager in the <code class="literal">elytron</code> subsystem. For example:
				</p><pre class="screen">/subsystem=elytron/trust-manager=<span class="emphasis"><em>TRUST_MANAGER</em></span>:write-attribute(name=certificate-revocation-list,value={path=<span class="emphasis"><em>/path/to/CRL_FILE</em></span>.crl.pem}</pre><p>
					For more information on the available attributes for a trust manager, see the <a class="link" href="reference_material.html#trust_manager_attributes" title="Table A.92. trust-manager Attributes"><code class="literal">trust-manager</code> Attributes table</a>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Your truststore must contain the certificate chain in order to check the validity of both the certification revocation list and the certificate. The truststore should not contain end-entity certificates, just certificate authority and intermediate certificates.
					</p></div><p>
					You can instruct the trust manager to reload the certificate revocation list by using the <code class="literal">reload-certificate-revocation-list</code> operation.
				</p><pre class="screen">/subsystem=elytron/trust-manager=<span class="emphasis"><em>TRUST_MANAGER</em></span>:reload-certificate-revocation-list</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_certificate_authority"/>Using a Certificate Authority to Manage Signed Certificates</h2></div></div></div><p>
					You can obtain and manage signed certificates using the JBoss EAP management CLI. This allows you to create a signed certificate directly from the CLI and then import it into the desired keystore.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Many of the commands in this section have an optional <code class="literal">staging</code> parameter that indicates whether the certificate authority’s staging URL should be used. This value defaults to <code class="literal">false</code>, and is designed to assist in testing purposes. This parameter should never be enabled in a production environment.
					</p></div><h4><a id="elytron_configure_lets_encrypt_account"/>Configure a Let’s Encrypt Account</h4><p>
					As of JBoss EAP 7.2, Let’s Encrypt is the only supported certificate authority. To manage signed certificates an account must be created with the certificate authority, and the following information provided:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							A keystore to contain the alias of the certificate authority account key.
						</li><li class="listitem">
							The alias of the certificate authority. If the provided alias does not exist in the given keystore, then one will be created and stored as a private key entry.
						</li><li class="listitem">
							An optional list of URLs, such as email addresses, that the certificate authority can contact in the result of any issues.
						</li></ul></div><pre class="screen">/subsystem=elytron/certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>:add(key-store=<span class="emphasis"><em>KEYSTORE</em></span>,alias=<span class="emphasis"><em>ALIAS</em></span>,contact-urls=[mailto:<span class="emphasis"><em>EMAIL_ADDRESS</em></span>])</pre><h4><a id="create_an_account_with_the_certificate_authority"/>Create an Account with the Certificate Authority</h4><p>
					Once an account has been configured it may be created with the certificate authority by agreeing to their terms of service.
				</p><pre class="screen">/subsystem=elytron/certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>:create-account(agree-to-terms-of-service=true)</pre><h4><a id="update_an_account_with_the_certificate_authority"/>Update an Account with the Certificate Authority</h4><p>
					The certificate authority account options can be updated using the <code class="literal">update-account</code> command.
				</p><pre class="screen">/subsystem=elytron/certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>:update-account(agree-to-terms-of-service=true)</pre><h4><a id="change_the_account_key_associated_with_the_certificate_authority"/>Change the Account Key Associated with the Certificate Authority</h4><p>
					The key associated with the certificate authority account can be changed by using the <code class="literal">change-account-key</code> command.
				</p><pre class="screen">/subsystem=elytron/certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>:change-account-key()</pre><h4><a id="deactivate_the_account_with_the_certificate_authority"/>Deactivate the Account with the Certificate Authority</h4><p>
					If the account is no longer desired, then it may be deactivated by using the <code class="literal">deactivate-account</code> command.
				</p><pre class="screen">/subsystem=elytron/certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>:deactivate-account()</pre><h4><a id="get_the_metadata_associated_with_the_certificate_authority"/>Get the Metadata Associated with the Certificate Authority</h4><p>
					The metadata for the account can be queried with the <code class="literal">get-metadata</code> command. This provides the following information:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							A URL to the terms of service.
						</li><li class="listitem">
							A URL to the certificate authority website.
						</li><li class="listitem">
							A list of the certificate authority accounts.
						</li><li class="listitem">
							Whether or not an external account is required.
						</li></ul></div><pre class="screen">/subsystem=elytron/certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>:get-metadata()</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="keystore_manipulation_operations"/>Keystore Manipulation Operations</h2></div></div></div><p>
					It is possible to perform various keystore manipulation operations on an Elytron <code class="literal">key-store</code> resource using the management CLI.
				</p><h4><a id="generate_key_pair"/>Generate a Key Pair</h4><p>
					The <code class="literal">generate-key-pair</code> command generates a key pair and wraps the resulting public key in a self-signed X.509 certificate. The generated private key and self-signed certificate will be added to the keystore.
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:add(path=/path/to/server.keystore.jks,credential-reference={clear-text=secret},type=JKS)

/subsystem=elytron/key-store=httpsKS:generate-key-pair(alias=example,algorithm=RSA,key-size=1024,validity=365,credential-reference={clear-text=secret},distinguished-name="CN=www.example.com")</pre><h4><a id="generate_certificate_signing_request"/>Generate a Certificate Signing Request</h4><p>
					The <code class="literal">generate-certificate-signing-request</code> command generates a PKCS #10 certificate signing request using a <code class="literal">PrivateKeyEntry</code> from the keystore. The generated certificate signing request will be written to a file.
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:generate-certificate-signing-request(alias=example,path=server.csr,relative-to=jboss.server.config.dir,distinguished-name="CN=www.example.com",extensions=[{critical=false,name=KeyUsage,value=digitalSignature}],credential-reference={clear-text=secret})</pre><h4><a id="import_certificate"/>Import a Certificate or Certificate Chain</h4><p>
					The <code class="literal">import-certificate</code> command imports a certificate or certificate chain from a file into an entry in the keystore.
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:import-certificate(alias=example,path=/path/to/certificate_or_chain/file,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},trust-cacerts=true)</pre><h4><a id="export_certificate"/>Export a Certificate</h4><p>
					The <code class="literal">export-certificate</code> command exports a certificate from an entry in the keystore to a file.
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:export-certificate(alias=example,path=serverCert.cer,relative-to=jboss.server.config.dir,pem=true)</pre><h4><a id="change_alias"/>Change an Alias</h4><p>
					The <code class="literal">change-alias</code> command moves an existing keystore entry to a new alias.
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:change-alias(alias=example,new-alias=newExample,credential-reference={clear-text=secret})</pre><h4><a id="store_changes"/>Store Changes Made to Keystores</h4><p>
					The <code class="literal">store</code> command persists any changes that have been made to the file that backs the keystore.
				</p><pre class="screen">/subsystem=elytron/key-store=httpsKS:store()</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="keystore_certificate_authority_operations"/>Keystore Certificate Authority Operations</h3></div></div></div><p>
						The following operations can be performed on the keystore after you <a class="link" href="securing_the_server_and_its_interfaces.html#elytron_configure_lets_encrypt_account" title="Configure a Let’s Encrypt Account">Configure a Let’s Encrypt Account</a>.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Many of the commands in this section have an optional <code class="literal">staging</code> parameter that indicates whether the certificate authority’s staging URL should be used. This value defaults to <code class="literal">false</code>, and is designed to assist in testing purposes. This parameter should never be enabled in a production environment.
						</p></div><h5><a id="obtain_signed_certificate"/>Obtain a Signed Certificate</h5><p>
						Once a certificate authority account has been defined for the keystore, you can use the <code class="literal">obtain-certificate</code> command to obtain a signed certificate and store it in the keystore. If an account with the certificate authority does not exist, then it will be automatically created.
					</p><pre class="screen">/subsystem=elytron/key-store=<span class="emphasis"><em>KEYSTORE</em></span>:obtain-certificate(alias=<span class="emphasis"><em>ALIAS</em></span>,domain-names=[<span class="emphasis"><em>DOMAIN_NAME</em></span>],certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>,agree-to-terms-of-service=true,algorithm=RSA,credential-reference={clear-text=secret})</pre><h5><a id="revoke_signed_certificate"/>Revoke a Signed Certificate</h5><p>
						The <code class="literal">revoke-certificate</code> command revokes a certificate that was issued by the certificate authority.
					</p><pre class="screen">/subsystem=elytron/key-store=<span class="emphasis"><em>KEYSTORE</em></span>:revoke-certificate(alias=<span class="emphasis"><em>ALIAS</em></span>,certificate-authority-account=<span class="emphasis"><em>CERTIFICATE_ACCOUNT</em></span>)</pre><h5><a id="should_renew_certificate"/>Check if a Signed Certificate is Due for Renewal</h5><p>
						The <code class="literal">should-renew-certificate</code> command determines if a certificate is due for renewal. The command returns <code class="literal">true</code> if the certificate expires in less than the given number of days, and <code class="literal">false</code> otherwise.
					</p><p>
						The following command determines if the certificate expires in the next 7 days.
					</p><pre class="screen">/subsystem=elytron/key-store=<span class="emphasis"><em>KEYSTORE</em></span>:should-renew-certificate(alias=<span class="emphasis"><em>ALIAS</em></span>,expiration=7)</pre></div></div></div></div></body></html>