<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 4. Java Security Manager</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="java_security_manager"/>Chapter 4. Java Security Manager</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="about-java-security-manager"/>About the Java Security Manager</h1></div></div></div><p>
				The Java Security Manager is a class that manages the external boundary of the Java Virtual Machine (JVM) sandbox, controlling how code executing within the JVM can interact with resources outside the JVM. When the Java Security Manager is activated, the Java API checks with the security manager for approval before executing a wide range of potentially unsafe operations. The Java Security Manager uses a security policy to determine whether a given action will be allowed or denied.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="define-security-policy"/>Define a Java Security Policy</h1></div></div></div><p>
				A Java security policy is a set of defined permissions for different classes of code. The Java Security Manager compares actions requested by applications against the security policy. If an action is allowed by the policy, the Security Manager will permit that action to take place. If the action is not allowed by the policy, the Security Manager will deny that action.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Previous versions of JBoss EAP defined policies using an external file, e.g. <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/server.policy</code>. JBoss EAP 7 defines Java Security Policies in two ways: the <code class="literal">security-manager</code> subsystem and through XML files in the individual deployments. The <code class="literal">security-manager</code> subsystem defines minimum and maximum permission for <span class="emphasis"><em>ALL</em></span> deployments, while the XML files specify the permissions requested by the individual deployment.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="defining_policies_in_the_security_manager_subsystem"/>Defining Policies in the Security Manager Subsystem</h2></div></div></div><p>
					The <code class="literal">security-manager</code> subsystem allows you do define shared or common permissions for all deployments. This is accomplished by defining minimum and maximum permission sets. All deployments will be granted at the least all permissions defined in the minimum permission. The deployment process fails for a deployment if it requests a permission that exceeds the ones defined in the maximum permission set.
				</p><div class="title"><strong>Example: Management CLI Command for Updating Minimum Permission Set</strong></div><p>
						
</p><pre class="programlisting">/subsystem=security-manager/deployment-permissions=default:write-attribute(name=minimum-permissions, value=[{class="java.util.PropertyPermission", actions="read", name="*"}])</pre><p>

					</p><div class="title"><strong>Example: Management CLI Command for Updating Maximum Permission Set</strong></div><p>
						
</p><pre class="programlisting">/subsystem=security-manager/deployment-permissions=default:write-attribute(name=maximum-permissions, value=[{class="java.util.PropertyPermission", actions="read,write", name="*"}, {class="java.io.FilePermission", actions="read,write", name="/-"}])</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If the maximum permission set is not defined, its value defaults to <code class="literal">java.security.AllPermission</code>.
					</p></div><p>
					You can find a full reference of the <code class="literal">security-manager</code> subsystem in the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#security-manager-reference"><span class="emphasis"><em>Configuration Guide</em></span></a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="defining_policies_in_the_deployment"/>Defining Policies in the Deployment</h2></div></div></div><p>
					In JBoss EAP 7, you can add a <code class="literal">META-INF/permissions.xml</code> to your deployment, which is part of <a class="link" href="http://jcp.org/en/jsr/detail?id=342">JSR 342</a> and is a part of the Java EE specification. This file allows you to specify the permissions needed by the deployment. If a minimum permissions set is defined in the <code class="literal">security-manager</code> subsystem and a <code class="literal">META-INF/permissions.xml</code> is added to your deployment, then the union of those permissions is granted. If the permissions requested in the <code class="literal">permissions.xml</code> exceed the maximum policies defined in the <code class="literal">security-manager</code> subsystem, its deployment will not succeed. If both <code class="literal">META-INF/permissions.xml</code> and <code class="literal">META-INF/jboss-permissions.xml</code> are present in the deployment, then only the permissions requested in the <code class="literal">META-INF/jboss-permissions.xml</code> are granted.
				</p><p>
					The specification dictates that <code class="literal">permissions.xml</code> cover the entire application or top-level deployment module. In cases where you wish to define specific permissions for a subdeployment, you can use the JBoss EAP-specific <code class="literal">META-INF/jboss-permissions.xml</code>. It follows the same exact format as <code class="literal">permissions.xml</code> and will apply only to the deployment module in which it is declared.
				</p><div class="title"><strong>Example: Sample permissions.xml</strong></div><p>
						
</p><pre class="programlisting">&lt;permissions version="7"&gt;
  &lt;permission&gt;
  &lt;class-name&gt;java.util.PropertyPermission&lt;/class-name&gt;
  &lt;name&gt;*&lt;/name&gt;
  &lt;actions&gt;read&lt;/actions&gt;
  &lt;/permission&gt;
&lt;/permissions&gt;</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="defining_policies_in_modules"/>Defining Policies in Modules</h2></div></div></div><p>
					You can restrict the permissions of a module by adding a <code class="literal">&lt;permissions&gt;</code> element to the <code class="literal">module.xml</code> file. The <code class="literal">&lt;permissions&gt;</code> element contains zero or more <code class="literal">&lt;grant&gt;</code> elements, which define the permission to grant to the module. Each <code class="literal">&lt;grant&gt;</code> element contains the following attributes:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">permission</span></dt><dd>
								The qualified class name of the permission to grant.
							</dd><dt><span class="term">name</span></dt><dd>
								The permission name to provide to the permission class constructor.
							</dd><dt><span class="term">actions</span></dt><dd>
								The (optional) list of actions, required by some permission types.
							</dd></dl></div><div class="title"><strong>Example: <code class="literal">module.xml</code> with Defined Policies</strong></div><p>
						
</p><pre class="programlisting">&lt;module xmlns="urn:jboss:module:1.5" name="org.jboss.test.example"&gt;
  &lt;permissions&gt;
    &lt;grant permission="java.util.PropertyPermission" name="*" actions="read,write" /&gt;
    &lt;grant permission="java.io.FilePermission" name="/etc/-" actions="read" /&gt;
  &lt;/permissions&gt;
  ...
&lt;/module&gt;</pre><p>

					</p><p>
					If the <code class="literal">&lt;permissions&gt;</code> element is present, the module will be restricted to only the permissions you have listed. If the <code class="literal">&lt;permissions&gt;</code> element is not present, there will be no restrictions on the module.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="run-within-java-security-manager"/>Run JBoss EAP With the Java Security Manager</h1></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Previous version of JBoss EAP allowed for the use of the <code class="literal">-Djava.security.manager</code> Java system property as well as custom security managers. Neither of these are supported in JBoss EAP 7. In addition, the Java Security Manager policies are now defined within the <code class="literal">security-manager</code> subsystem, meaning external policy files and the <code class="literal">-Djava.security.policy</code> Java system property are not supported JBoss EAP 7.
				</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Before starting JBoss EAP with the Java Security Manager enabled, you need make sure all security policies are defined in the <code class="literal">security-manager</code> subsystem.
				</p></div><p>
				To run JBoss EAP with the Java Security Manager, you need to use the <code class="literal">secmgr</code> option during startup. There are two ways to do this:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Use the flag with the startup script To use the <code class="literal">-secmgr</code> flag with the startup script, include it when starting up your JBoss EAP instance:
					</p><div class="title"><strong>Example: Startup Script</strong></div><p>
							
</p><pre class="screen">./standalone.sh -secmgr</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Using the Startup Configuration File
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							The domain or standalone server must be completely stopped before you edit any configuration files.
						</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							If you are using JBoss EAP in a managed domain, you must perform the following procedure on each physical host or instance in your domain.
						</p></div><p class="simpara">
						To enable the Java Security Manager using the startup configuration file, you need to edit either the <code class="literal">standalone.conf</code> or <code class="literal">domain.conf</code> file, depending if you are running a standalone instance or managed domain. If running in Windows, the <code class="literal">standalone.conf.bat</code> or <code class="literal">domain.conf.bat</code> files are used instead.
					</p><p class="simpara">
						Uncomment the <code class="literal">SECMGR="true"</code> line in the configuration file:
					</p><div class="title"><strong>Example: standalone.conf or domain.conf</strong></div><p>
							
</p><pre class="screen"># Uncomment this to run with a security manager enabled
SECMGR="true"</pre><p>

						</p><div class="title"><strong>Example: standalone.conf.bat or domain.conf.bat</strong></div><p>
							
</p><pre class="screen">rem # Uncomment this to run with a security manager enabled
set "SECMGR=true"</pre><p>

						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="java-security-manager-migration-considerations"/>Considerations Moving from Previous Versions</h1></div></div></div><p>
				When moving applications from a previous version of JBoss EAP to JBoss EAP 7 running with the Java Security Manager enabled, you need to be aware of the changes in how policies are defined as well as the necessary configuration needed with both the JBoss EAP configuration and the deployment.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="defining_policies"/>Defining Policies</h2></div></div></div><p>
					In previous versions of JBoss EAP, policies were defined in an external configuration file. In JBoss EAP 7, policies are defined using the <code class="literal">security-manager</code> subsystem and with <code class="literal">permissions.xml</code> or <code class="literal">jboss-permissions.xml</code> contained in the deployment. More details on how to use both to define your policies are covered in a <a class="link" href="java_security_manager.html#define-security-policy" title="Define a Java Security Policy">previous section</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jboss_eap_configuration_changes"/>JBoss EAP Configuration Changes</h2></div></div></div><p>
					In previous versions of JBoss EAP, you could use <code class="literal">-Djava.security.manager</code> and <code class="literal">-Djava.security.policy</code> Java system properties during JBoss EAP startup. These are no longer supported and the <code class="literal">secmgr</code> flag should be used instead to enable JBoss EAP to run with the Java Security Manager. More details on the <code class="literal">secmgr</code> flag are covered in a <a class="link" href="java_security_manager.html#run-within-java-security-manager" title="Run JBoss EAP With the Java Security Manager">previous section</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="custom_security_managers"/>Custom Security Managers</h2></div></div></div><p>
					Custom security managers are not supported in JBoss EAP 7.
				</p></div></div></div></body></html>