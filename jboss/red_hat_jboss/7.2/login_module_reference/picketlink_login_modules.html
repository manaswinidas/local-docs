<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 7. About PicketLink Login Modules</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="picketlink_login_modules"/>Chapter 7. About PicketLink Login Modules</h1></div></div></div><p>
			A PicketLink login module is typically configured as part of the security setup to use a Security Token Service (STS) or browser-based SSO with SAML for authenticating users. The STS may be collocated on the same container as the login module or be accessed remotely through web service calls or another technology. PicketLink STS login modules support non-PicketLink STS implementations through standard WS-Trust calls. For more details on the concepts behind Security Token Services as well as browser-based SSO with SAML, please see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#claims_based_identity"><span class="emphasis"><em>Security Architecture</em></span></a> guide.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="stsissuingloginmodule"/>STSIssuingLoginModule</h1></div></div></div><p>
				<span class="strong"><strong>Full name</strong></span>: org.picketlink.identity.federation.core.wstrust.auth.STSIssuingLoginModule
			</p><p>
				The <span class="emphasis"><em>STSIssuingLoginModule</em></span> uses a user name and password to authenticate the user against an STS by retrieving a token. The authentication happens as follows:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Calls the configured STS and requests for a security token. Upon successfully receiving the <span class="emphasis"><em>RequestedSecurityToken</em></span>, it marks the authentication as successful.
					</li><li class="listitem"><p class="simpara">
						A call to the STS typically requires authentication. This login module uses credentials from one of the following sources:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Its properties file, if the <span class="emphasis"><em>useOptionsCredentials</em></span> module option is set to <span class="emphasis"><em>true</em></span>.
							</li><li class="listitem">
								Previous login module credentials if the <span class="emphasis"><em>password-stacking</em></span> module option is set to <span class="emphasis"><em>useFirstPass</em></span>.
							</li><li class="listitem">
								From the configured <span class="emphasis"><em>CallbackHandler</em></span> by supplying a Name and Password Callback.
							</li></ul></div></li><li class="listitem">
						Upon successful authentication, the security token is stored in the login module’s shared map with <code class="literal">org.picketlink.identity.federation.core.wstrust.lm.stsToken</code> key.
					</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					This login module has no direct configurable attributes, but you may use module options to pass in configuration options.
				</p></div><div class="title"><strong>Example STSIssuingLoginModule</strong></div><p>
					
</p><pre class="programlisting">&lt;security-domain name="saml-issue-token"&gt;
  &lt;authentication&gt;
    &lt;login-module code="org.picketlink.identity.federation.core.wstrust.auth.STSIssuingLoginModule" flag="required"&gt;
      &lt;module-option name="configFile"&gt;./picketlink-sts-client.properties&lt;/module-option&gt;
      &lt;module-option name="endpointURI"&gt;http://security_saml/endpoint&lt;/module-option&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
  &lt;mapping&gt;
    &lt;mapping-module code="org.picketlink.identity.federation.bindings.jboss.auth.mapping.STSPrincipalMappingProvider" type="principal"/&gt;
    &lt;mapping-module code="org.picketlink.identity.federation.bindings.jboss.auth.mapping.STSGroupMappingProvider" type="role" /&gt;
  &lt;/mapping&gt;
&lt;/security-domain&gt;</pre><p>

				</p><p>
				In the above example, the specified Principal mapping provider and the RoleGroup mapping provider results in an authenticated Subject being populated that enables coarse-grained and role-based authorization. After authentication, the Security Token is available and may be used to invoke other services by Single Sign-On.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="stsvalidatingloginmodule"/>STSValidatingLoginModule</h1></div></div></div><p>
				<span class="strong"><strong>Full name</strong></span>: org.picketlink.identity.federation.core.wstrust.auth.STSValidatingLoginModule
			</p><p>
				The <span class="emphasis"><em>STSValidatingLoginModule</em></span> uses a TokenCallback to retrieve a security token from STS.
			</p><p>
				The authentication happens as follows:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Calls the configured STS and validates an available security token.
					</li><li class="listitem"><p class="simpara">
						A call to STS typically requires authentication. This Login Module uses credentials from one of the following sources:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Its properties file, if the <span class="emphasis"><em>useOptionsCredentials</em></span> module option is set to <span class="emphasis"><em>true</em></span>.
							</li><li class="listitem">
								Previous login module credentials if the <span class="emphasis"><em>password-stacking</em></span> module option is set to <span class="emphasis"><em>useFirstPass</em></span>.
							</li><li class="listitem">
								From the configured <span class="emphasis"><em>CallbackHandler</em></span> by supplying a Name and Password Callback.
							</li></ul></div></li><li class="listitem">
						Upon successful authentication, the security token is stored in the login module’s shared map with <code class="literal">org.picketlink.identity.federation.core.wstrust.lm.stsToken</code> key.
					</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					This login module has no direct configurable attributes, but you may use module options to pass in configuration options.
				</p></div><div class="title"><strong>Example STSValidatingLoginModule</strong></div><p>
					
</p><pre class="programlisting">&lt;security-domain name="saml-validate-token"&gt;
  &lt;authentication&gt;
    &lt;login-module code="org.picketlink.identity.federation.core.wstrust.auth.STSValidatingLoginModule" flag="required"&gt;
      &lt;module-option name="configFile"&gt;./picketlink-sts-client.properties&lt;/module-option&gt;
      &lt;module-option name="endpointURI"&gt;http://security_saml/endpoint&lt;/module-option&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
  &lt;mapping&gt;
    &lt;mapping-module code="org.picketlink.identity.federation.bindings.jboss.auth.mapping.STSPrincipalMappingProvider" type="principal"/&gt;
    &lt;mapping-module code="org.picketlink.identity.federation.bindings.jboss.auth.mapping.STSGroupMappingProvider" type="role"/&gt;
  &lt;/mapping&gt;
&lt;/security-domain&gt;</pre><p>

				</p><p>
				The above example shows how to enable validation for an issued token, either directly by contacting the STS or through a token-issuing login module, to be used to authenticate against multiple applications and services. Providing a Principal mapping provider and a RoleGroup mapping provider results in an authenticated Subject being populated that enables coarse-grained and role-based authorization. After authentication, the Security Token is available and can be used to invoke other services by Single Sign-On.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="saml2stsloginmodule"/>SAML2STSLoginModule</h1></div></div></div><p>
				<span class="strong"><strong>Full name</strong></span>: org.picketlink.identity.federation.bindings.jboss.auth.SAML2STSLoginModule
			</p><p>
				The authentication happens as follows:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						This Login Module supplies an <span class="emphasis"><em>ObjectCallback</em></span> to the configured <span class="emphasis"><em>CallbackHandler</em></span> and expects a <span class="emphasis"><em>SamlCredential</em></span> object back. The Assertion is validated against the configured STS.
					</li><li class="listitem">
						Upon successful authentication, the <span class="emphasis"><em>SamlCredential</em></span> is inspected for a <span class="emphasis"><em>NameIDType</em></span>.
					</li><li class="listitem">
						If a user ID and SAML token are shared, this Login Module bypasses validation when stacked on top of another Login Module that is successfully authenticated.
					</li></ul></div><div class="title"><strong>Example SAML2STSLoginModule</strong></div><p>
					
</p><pre class="programlisting">&lt;security-domain name="saml-sts" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;login-module code="org.picketlink.identity.federation.bindings.jboss.auth.SAML2STSLoginModule" flag="required" module="org.picketlink"&gt;
      &lt;module-option name="configFile" value="${jboss.server.config.dir}/sts-config.properties"/&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre><p>

				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					This login module has no direct configurable attributes, but you may use module options to pass in configuration options.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="saml2loginmodule"/>SAML2LoginModule</h1></div></div></div><p>
				<span class="strong"><strong>Full name</strong></span>: org.picketlink.identity.federation.bindings.jboss.auth.SAML2LoginModule
			</p><p>
				The authentication happens as follows:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						This login module is used in conjunction with other components for SAML authentication and performs no authentication itself.
					</li><li class="listitem">
						The SAML authenticator, which is installed by the PicketLink Service Provider Undertow ServletExtension (<code class="literal">org.picketlink.identity.federation.bindings.wildfly.sp.SPServletExtension</code>), uses this login module to authenticate users based on a SAML assertion previously issued by an identity provider.
					</li><li class="listitem">
						If the user does not have a SAML assertion for the service provider, the user is redirected to the identity provider to obtain a SAML assertion.
					</li><li class="listitem">
						This login module is used to pass the user ID and roles to the security framework to be populated in the JAAS subject.
					</li></ul></div><div class="title"><strong>Example SAML2LoginModule</strong></div><p>
					
</p><pre class="programlisting">&lt;security-domain name="sp" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;login-module code="org.picketlink.identity.federation.bindings.jboss.auth.SAML2LoginModule" flag="required"/&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre><p>

				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					This login module has no direct configurable attributes.
				</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
					The <code class="literal">SAML2LoginModule</code> is intended for use with applications using PicketLink with SAML and should not be used without the PicketLink Service Provider Undertow ServletExtension (<code class="literal">org.picketlink.identity.federation.bindings.wildfly.sp.SPServletExtension</code>). Doing so presents a possible security risk since the <code class="literal">SAML2LoginModule</code> or <code class="literal">SAML2CommonLoginModule</code> will always accept the default password of <code class="literal">EMPTY_STR</code>. For example, this can also occur if the PicketLink Service Provider Undertow ServletExtension is not installed in the SP application. The PicketLink Service Provider Undertow ServletExtension is installed automatically when <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_set_up_sso_with_saml_v2/#setting_up_sp">configuring the SP application for JBoss EAP</a>. This can also occur if the <code class="literal">SAML2LoginModule</code> is stacked with other login modules:
				</p><pre class="programlisting">&lt;security-domain name="sp" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;login-module code="org.picketlink.identity.federation.bindings.jboss.auth.SAML2LoginModule" flag="optional"&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
    &lt;/login-module&gt;
    &lt;login-module code="UsersRoles" flag="required"&gt;
      &lt;module-option name="usersProperties" value="users.properties"/&gt;
      &lt;module-option name="rolesProperties" value="roles.properties"/&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="regex-user-name-login-module"/>RegExUserNameLoginModule</h1></div></div></div><p>
				<span class="strong"><strong>Full name</strong></span>: org.picketlink.identity.federation.bindings.jboss.auth.RegExUserNameLoginModule
			</p><p>
				This login module can be used after any <a class="link" href="certificate_based_login_modules.html#certificate_login_module" title="Certificate Login Module">Certificate Login Module</a> to extract a username, UID or other field from the principal name so that roles can be obtained from LDAP. The module has an option named <code class="literal">regex</code> which specifies the regular expression to be applied to the principal name, the result of which is passed on to the subsequent login module.
			</p><div class="title"><strong>Example RegExUserNameLoginModule</strong></div><p>
					
</p><pre class="programlisting">&lt;login-module code="org.picketlink.identity.federation.bindings.jboss.auth.RegExUserNameLoginModule" flag="required"&gt;
  &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
  &lt;module-option name="regex" value="UID=(.*?),"/&gt;
&lt;/login-module&gt;</pre><p>

				</p><p>
				For example, an input principal name of <code class="literal">UID=007, EMAILADDRESS=something@something, CN=James Bond, O=SpyAgency</code> would result in the output <code class="literal">007</code> using the above login module.
			</p><p>
				For more information on regular expressions, see the <a class="link" href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html"><code class="literal">java.util.regex.Pattern</code> class documentation</a>.
			</p></div></div></body></html>