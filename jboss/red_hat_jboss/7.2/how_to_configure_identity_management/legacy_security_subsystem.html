<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Legacy Security Subsystem</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="legacy_security_subsystem"/>Chapter 3. Legacy Security Subsystem</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_a_security_domain_to_use_ldap"/>Configure a Security Domain to use LDAP</h1></div></div></div><p>
				Security domains can be configured to use an LDAP server for authentication and authorization by using a login module. The basics of security domains and login modules are covered in the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/"><span class="emphasis"><em>Security Architecture</em></span> guide</a>. <span class="emphasis"><em>LdapExtended</em></span> is the preferred login module for integrating with LDAP servers (including Active Directory), but there are several other LDAP login modules that can be used as well. Specifically, the <span class="emphasis"><em>Ldap</em></span>, <span class="emphasis"><em>AdvancedLdap</em></span>, and <span class="emphasis"><em>AdvancedAdLdap</em></span> login modules can also be used to configure a security domain to use LDAP. This section uses the <span class="emphasis"><em>LdapExtended</em></span> login module to illustrate how to create a security domain that uses LDAP for authentication and authorization, but the other LDAP login modules can be used as well. For more details on the other LDAP login modules, see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/"><span class="emphasis"><em>Login Module Reference</em></span></a>.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					In cases where the legacy <code class="literal">security</code> subsystem uses an LDAP server to perform authentication, JBoss EAP will return a <code class="literal">500</code>, or internal server error, error code if that LDAP server is unreachable. This behavior differs from previous versions of JBoss EAP which returned a <code class="literal">401</code>, or unauthorized, error code under the same conditions.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ldapextended_login_module"/>LdapExtended Login Module</h2></div></div></div><p>
					LdapExtended (<code class="literal">org.jboss.security.auth.spi.LdapExtLoginModule</code>) is a login module implementation that uses searches to locate the bind user and associated roles on an LDAP server. The roles query recursively follows DNs to navigate a hierarchical role structure. For the vast majority of cases when using LDAP with security domains, the LdapExtended login module should be used, especially with LDAP implementations that are not Active Directory. For a full list of configuration options for the LdapExtended login module, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/#ldapextended_login_module">LdapExtended login module section in the JBoss EAP <span class="emphasis"><em>Login Module Reference</em></span></a>.
				</p><p>
					The authentication happens as follows:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							An initial bind to the LDAP server is done using the <code class="literal">bindDN</code> and <code class="literal">bindCredential</code> options. The <code class="literal">bindDN</code> is a LDAP user with the ability to search both the <code class="literal">baseCtxDN</code> and <code class="literal">rolesCtxDN</code> trees for the user and roles. The user DN to authenticate against is queried using the filter specified by the <code class="literal">baseFilter</code> attribute.
						</li><li class="listitem">
							The resulting user DN is authenticated by binding to the LDAP server using the user DN as the <code class="literal">InitialLdapContext</code> environment <code class="literal">Context.SECURITY_PRINCIPAL</code>. The <code class="literal">Context.SECURITY_CREDENTIALS</code> property is set to the <code class="literal">String</code> password obtained by the callback handler.
						</li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configure_a_security_domain_to_use_the_ldapextended_login_module"/>Configure a Security Domain to use the LdapExtended Login Module</h3></div></div></div><div class="title"><strong>Example Data (LDIF format)</strong></div><p>
							
</p><pre class="screen">dn: uid=jduke,ou=Users,dc=jboss,dc=org
objectClass: inetOrgPerson
objectClass: person
objectClass: top
cn: Java Duke
sn: duke
uid: jduke
userPassword: theduke
# =============================
dn: uid=hnelson,ou=Users,dc=jboss,dc=org
objectClass: inetOrgPerson
objectClass: person
objectClass: top
cn: Horatio Nelson
sn: Nelson
uid: hnelson
userPassword: secret
# =============================
dn: ou=groups,dc=jboss,dc=org
objectClass: top
objectClass: organizationalUnit
ou: groups
# =============================
dn: uid=ldap,ou=Users,dc=jboss,dc=org
objectClass: inetOrgPerson
objectClass: person
objectClass: top
cn: LDAP
sn: Service
uid: ldap
userPassword: randall
# =============================
dn: ou=Users,dc=jboss,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Users
# =============================
dn: dc=jboss,dc=org
objectclass: top
objectclass: domain
dc: jboss
# =============================
dn: uid=GroupTwo,ou=groups,dc=jboss,dc=org
objectClass: top
objectClass: groupOfNames
objectClass: uidObject
cn: GroupTwo
member: uid=jduke,ou=Users,dc=jboss,dc=org
uid: GroupTwo
# =============================
dn: uid=GroupThree,ou=groups,dc=jboss,dc=org
objectClass: top
objectClass: groupOfUniqueNames
objectClass: uidObject
cn: GroupThree
uid: GroupThree
uniqueMember: uid=GroupOne,ou=groups,dc=jboss,dc=org
# =============================
dn: uid=HTTP,ou=Users,dc=jboss,dc=org
objectClass: inetOrgPerson
objectClass: person
objectClass: top
cn: HTTP
sn: Service
uid: HTTP
userPassword: httppwd
# =============================
dn: uid=GroupOne,ou=groups,dc=jboss,dc=org
objectClass: top
objectClass: groupOfUniqueNames
objectClass: uidObject
cn: GroupOne
uid: GroupOne
uniqueMember: uid=jduke,ou=Users,dc=jboss,dc=org
uniqueMember: uid=hnelson,ou=Users,dc=jboss,dc=org</pre><p>

						</p><div class="title"><strong>CLI Commands for Adding the LdapExtended Login Module</strong></div><p>
							
</p><pre class="programlisting">/subsystem=security/security-domain=testLdapExtendedExample:add(cache-type=default)

/subsystem=security/security-domain=testLdapExtendedExample/authentication=classic:add

/subsystem=security/security-domain=testLdapExtendedExample/authentication=classic/login-module=LdapExtended:add(code=LdapExtended, flag=required, module-options=[ ("java.naming.factory.initial"=&gt;"com.sun.jndi.ldap.LdapCtxFactory"),     ("java.naming.provider.url"=&gt;"ldap://localhost:10389"), ("java.naming.security.authentication"=&gt;"simple"),     ("bindDN"=&gt;"uid=ldap,ou=Users,dc=jboss,dc=org"), ("bindCredential"=&gt;"randall"),     ("baseCtxDN"=&gt;"ou=Users,dc=jboss,dc=org"), ("baseFilter"=&gt;"(uid={0})"), ("rolesCtxDN"=&gt;"ou=groups,dc=jboss,dc=org"),     ("roleFilter"=&gt;"(uniqueMember={1})"), ("roleAttributeID"=&gt;"uid")])

reload</pre><p>

						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The management CLI commands shown assume that you are running a JBoss EAP standalone server. For more details on using the management CLI for a JBoss EAP managed domain, see the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/"><span class="emphasis"><em>Management CLI Guide</em></span></a>.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="configure_a_security_domain_to_use_the_ldapextended_login_module_for_active_directory"/>Configure a Security Domain to use the LdapExtended Login Module for Active Directory</h4></div></div></div><p>
							For Microsoft Active Directory, the LdapExtended login module can be used.
						</p><p>
							The example below represents the configuration for a default Active Directory configuration. Some Active Directory configurations may require searching against the Global Catalog on port <code class="literal">3268</code> instead of the usual port <code class="literal">389</code>. This is most likely when the Active Directory forest includes multiple domains.
						</p><div class="title"><strong>Example Configuration for the LdapExtended Login Module for a Default AD Configuration</strong></div><p>
								
</p><pre class="screen">/subsystem=security/security-domain=AD_Default:add(cache-type=default)

/subsystem=security/security-domain=AD_Default/authentication=classic:add

/subsystem=security/security-domain=AD_Default/authentication=classic/login-module=LdapExtended:add(code=LdapExtended,flag=required,module-options=[ ("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"),("bindDN"=&gt;"JBOSSsearchuser"), ("bindCredential"=&gt;"password"), ("baseCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), ("baseFilter"=&gt;"(sAMAccountName={0})"), ("rolesCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), ("roleFilter"=&gt;"(sAMAccountName={0})"), ("roleAttributeID"=&gt;"memberOf"), ("roleAttributeIsDN"=&gt;"true"), ("roleNameAttributeID"=&gt;"cn"), ("searchScope"=&gt;"ONELEVEL_SCOPE"), ("allowEmptyPasswords"=&gt;"false")])

reload</pre><p>

							</p><p>
							The example below implements a recursive role search within Active Directory. The key difference between this example and the default Active Directory example is that the role search has been replaced to search the member attribute using the DN of the user. The login module then uses the DN of the role to find groups of which the group is a member.
						</p><div class="title"><strong>Example Configuration for the LdapExtended Login Module for a Default AD Configuration with Recursive Search</strong></div><p>
								
</p><pre class="screen">/subsystem=security/security-domain=AD_Recursive:add(cache-type=default)

/subsystem=security/security-domain=AD_Recursive/authentication=classic:add

/subsystem=security/security-domain=AD_Recursive/authentication=classic/login-module=LdapExtended:add(code=LdapExtended,flag=required,module-options=[("java.naming.provider.url"=&gt;"ldap://ldaphost.jboss.org"), ("java.naming.referral"=&gt;"follow"), ("bindDN"=&gt;"JBOSSsearchuser"), ("bindCredential"=&gt;"password"), ("baseCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), ("baseFilter"=&gt;"(sAMAccountName={0})"), ("rolesCtxDN"=&gt;"CN=Users,DC=jboss,DC=org"), ("roleFilter"=&gt;"(member={1})"), ("roleAttributeID"=&gt;"cn"), ("roleAttributeIsDN"=&gt;"false"), ("roleRecursion"=&gt;"2"), ("searchScope"=&gt;"ONELEVEL_SCOPE"), ("allowEmptyPasswords"=&gt;"false")])

reload</pre><p>

							</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_a_security_domain_to_use_a_database"/>Configure a Security Domain to use a Database</h1></div></div></div><p>
				Similar to LDAP, security domains can be configured to use a database for authentication and authorization by using a login module.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="database_login_module"/>Database Login Module</h2></div></div></div><p>
					The Database login module is a Java Database Connectivity-based (JDBC) login module that supports authentication and role mapping. This login module is used if username, password, and role information are stored in a relational database.
				</p><p>
					This works by providing a reference to logical tables containing principals and roles in the expected format. For example:
				</p><pre class="programlisting">Table Principals(PrincipalID text, Password text) Table Roles(PrincipalID text, Role text, RoleGroup text)</pre><p>
					The <code class="literal">Principals</code> table associates the user <code class="literal">PrincipalID</code> with the valid password, and the <code class="literal">Roles</code> table associates the user <code class="literal">PrincipalID</code> with its role sets. The roles used for user permissions must be contained in rows with a <code class="literal">RoleGroup</code> column value of <code class="literal">Roles</code>.
				</p><p>
					The tables are logical in that users can specify the SQL query that the login module uses. The only requirement is that the <code class="literal">java.sql.ResultSet</code> has the same logical structure as the <code class="literal">Principals</code> and <code class="literal">Roles</code> tables described previously. The actual names of the tables and columns are not relevant as the results are accessed based on the column index.
				</p><p>
					To clarify this concept, consider a database with two tables, <code class="literal">Principals</code> and <code class="literal">Roles</code>, as already declared. The following statements populate the tables with the following data:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">PrincipalID</code> <code class="literal">java</code> with a password of <code class="literal">echoman</code> in the <code class="literal">Principals</code> table
						</li><li class="listitem">
							<code class="literal">PrincipalID</code> <code class="literal">java</code> with a role named <code class="literal">Echo</code> in the <code class="literal">RolesRoleGroup</code> in the <code class="literal">Roles</code> table
						</li><li class="listitem">
							<code class="literal">PrincipalID</code> <code class="literal">java</code> with a role named <code class="literal">caller-java</code> in the <code class="literal">CallerPrincipalRoleGroup</code> in the <code class="literal">Roles</code> table
						</li></ul></div><p>
					For a full list of configuration options for the Database login module, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/#database_login_module">Database login module section in the JBoss EAP <span class="emphasis"><em>Login Module Reference</em></span></a>.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configure_a_security_domain_to_use_the_database_login_module"/>Configure a Security Domain to use the Database Login Module</h3></div></div></div><p>
						Before configuring a security domain to use the Database login module, a datasource must be properly configured.
					</p><p>
						For more information on creating and configuring datasources in JBoss EAP, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#datasource_management">Datasource Management section of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span></a>.
					</p><p>
						Once a datasource has been properly configured, a security domain can be configured to use the Database login module. The below example assumes a datasource named <code class="literal">MyDatabaseDS</code> has been created and properly configured with a database that is constructed with the following:
					</p><pre class="programlisting">CREATE TABLE Users(username VARCHAR(64) PRIMARY KEY, passwd VARCHAR(64))
CREATE TABLE UserRoles(username VARCHAR(64), role VARCHAR(32))</pre><div class="title"><strong>CLI Commands for Adding the Database Login Module</strong></div><p>
							
</p><pre class="programlisting">/subsystem=security/security-domain=testDB:add

/subsystem=security/security-domain=testDB/authentication=classic:add

/subsystem=security/security-domain=testDB/authentication=classic/login-module=Database:add(code=Database,flag=required,module-options=[("dsJndiName"=&gt;"java:/MyDatabaseDS"),("principalsQuery"=&gt;"select passwd from Users where username=?"),("rolesQuery"=&gt;"select role, 'Roles' from UserRoles where username=?")])

reload</pre><p>

						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_a_security_domain_to_use_a_properties_file"/>Configure a Security Domain to use a Properties File</h1></div></div></div><p>
				Security domains can also be configured to use a filesystem as an identity store for authentication and authorization by using a login module.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="usersroles_login_module"/>UsersRoles Login Module</h2></div></div></div><p>
					UsersRoles is a simple login module that supports multiple users and user roles loaded from Java properties files. The primary purpose of this login module is to easily test the security settings of multiple users and roles using properties files deployed with the application. The default username-to-password mapping filename is <code class="literal">users.properties</code> and the default username-to-roles mapping filename is <code class="literal">roles.properties</code>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						This login module supports password stacking, password hashing, and unauthenticated identity.
					</p></div><p>
					The properties files are loaded during initialization using the initialize method thread context class loader. This means that these files can be placed on the classpath of the Java EE deployment (for example, into the <code class="literal">WEB-INF/classes</code> folder in the WAR archive), or into any directory on the server classpath.
				</p><p>
					For a full list of configuration options for the UsersRoles login module, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/#userroles_login_module">UsersRoles login module section in the JBoss EAP <span class="emphasis"><em>Login Module Reference</em></span></a>.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configure_a_security_domain_to_use_the_usersroles_login_module"/>Configure a Security Domain to use the UsersRoles Login Module</h3></div></div></div><p>
						The below example assumes the following files have been created and are available on the application’s classpath:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">sampleapp-users.properties</code>
							</li><li class="listitem">
								<code class="literal">sampleapp-roles.properties</code>
							</li></ul></div><div class="title"><strong>CLI Commands for Adding the UserRoles Login Module</strong></div><p>
							
</p><pre class="programlisting">/subsystem=security/security-domain=sampleapp:add

/subsystem=security/security-domain=sampleapp/authentication=classic:add

/subsystem=security/security-domain=sampleapp/authentication=classic/login-module=UsersRoles:add(code=UsersRoles,flag=required,module-options=[("usersProperties"=&gt;"sampleapp-users.properties"),("rolesProperties"=&gt;"sampleapp-roles.properties")])

reload</pre><p>

						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="cert_based_auth_security_domain"/>Configure a Security Domain to use Certificate-Based Authentication</h1></div></div></div><p>
				JBoss EAP provides you with the ability to use certificate-based authentication with security domains to secure web applications or EJBs.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Before you can configure certificate-based authentication, you need to have <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#application_two-way_ssl">Two-Way SSL/TLS for Applications</a> enabled and configured, which requires X509 certificates configured for both the JBoss EAP instance as well as any clients accessing the web application or EJB secured by the security domain.
				</p><p>
					Once the certificates, truststores, and two-way SSL/TLS are configured, you then can proceed with configuring a security domain that uses certificate-based authentication, configuring an application to use that security domain, and configuring your client to use the client certificate.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_security_domain_with_certificate_based_authentication"/>Creating a Security Domain with Certificate-Based Authentication</h2></div></div></div><p>
					To create a security domain that uses certificate-based authentication, you need to specify a truststore as well as a <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/#certificate_based_login_modules">Certificate</a> login module or one of its subclasses.
				</p><p>
					The truststore must contain any trusted client certificates used for authentication, or it must contain the certificate of the certificate authority used to sign the client’s certificate. The login module is used to authenticate the certificate presented by the client using the configured truststore. The security domain as a whole also must provide a way to map a role to the principal once it is authenticated. The Certificate login module itself will not map any role information to the principal, but it may be combined with another login module to do so. Alternatively, two subclasses of the Certificate login module, <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/#certificateroles_login_module">CertificateRoles</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/login_module_reference/#databasecertificate_login_module">DatabaseCertificate</a>, do provide a way to map roles to a principal after it is authenticated. The below example shows how to configure a security domain with certificate-based authentication using the CertificateRoles login module.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						When performing authentication, the security domain will use the same certificate presented by the client when establishing two-way SSL/TLS. As a result, the client must use the same certificate for <span class="strong"><strong>BOTH</strong></span> two-way SSL/TLS and the certificate-based authentication with the application or EJB.
					</p></div><div class="title"><strong>Example Security Domain with Certificate-Based Authentication</strong></div><p>
						
</p><pre class="screen">/subsystem=security/security-domain=cert-roles-domain:add

/subsystem=security/security-domain=cert-roles-domain/jsse=classic:add(truststore={password=secret, url="/path/to/server.truststore.jks"}, keystore={password=secret, url="/path/to/server.keystore.jks"}, client-auth=true)

/subsystem=security/security-domain=cert-roles-domain/authentication=classic:add

/subsystem=security/security-domain=cert-roles-domain/authentication=classic/login-module=CertificateRoles:add(code=CertificateRoles, flag=required, module-options=[ securityDomain="cert-roles-domain", rolesProperties="${jboss.server.config.dir}/cert-roles.properties",password-stacking="useFirstPass", verifier="org.jboss.security.auth.certs.AnyCertVerifier"])</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The above example uses the CertificateRoles login module to handle authentication and map roles to authenticated principals. It does so by referencing a properties file using the <code class="literal">rolesProperties</code> attribute. This file lists usernames and roles using the following format:
					</p><pre class="screen">user1=roleA
user2=roleB,roleC
user3=</pre><p>
						Since usernames are presented as the DN from the provided certificate, for example <code class="literal">CN=valid-client, OU=JBoss, O=Red Hat, L=Raleigh, ST=NC, C=US</code>, you have to escape special characters such as <code class="literal">=</code> and spaces when using a properties file:
					</p><div class="title"><strong>Example Roles Properties File</strong></div><p>
							
</p><pre class="screen">CN\=valid-client,\ OU\=JBoss,\ O\=Red\ Hat,\ L\=Raleigh,\ ST\=NC,\ C\=US=Admin</pre><p>

						</p><p>
						To view, the DN of certificate:
					</p><pre class="screen">$ keytool -printcert -file valid-client.crt
Owner: CN=valid-client, OU=JBoss, O=Red Hat, L=Raleigh, ST=NC, C=US
...</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_an_application_to_use_a_security_domain_with_certificate_based_authentication"/>Configure an Application to use a Security Domain with Certificate-Based Authentication</h2></div></div></div><p>
					Similar to configuring an application to use a security domain with other forms of authentication, you need to configure both the <code class="literal">jboss-web.xml</code> and <code class="literal">web.xml</code> files appropriately.
				</p><p>
					For <code class="literal">jboss-web.xml</code>, add a reference to the security domain you configured for certificate-based authentication.
				</p><div class="title"><strong>Example jboss-web.xml</strong></div><p>
						
</p><pre class="programlisting">&lt;jboss-web&gt;
  &lt;security-domain&gt;cert-roles-domain&lt;/security-domain&gt;
&lt;/jboss-web&gt;</pre><p>

					</p><p>
					For <code class="literal">web.xml</code>, set the <code class="literal">&lt;auth-method&gt;</code> attribute in <code class="literal">&lt;login-config&gt;</code> to <code class="literal">CLIENT-CERT</code>. You also need define <code class="literal">&lt;security-constraint&gt;</code> as well as <code class="literal">&lt;security-roles&gt;</code>.
				</p><div class="title"><strong>Example web.xml</strong></div><p>
						
</p><pre class="programlisting">&lt;web-app&gt;
  &lt;!-- URL for secured portion of application--&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;secure&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/secure/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;All&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

  &lt;!-- Security roles referenced by this web application --&gt;
  &lt;security-role&gt;
    &lt;description&gt;The role that is required to log in to the application&lt;/description&gt;
    &lt;role-name&gt;All&lt;/role-name&gt;
  &lt;/security-role&gt;

  &lt;login-config&gt;
    &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
    &lt;realm-name&gt;cert-roles-domain&lt;/realm-name&gt;
  &lt;/login-config&gt;
&lt;/web-app&gt;</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_the_client"/>Configure the Client</h2></div></div></div><p>
					For a client to authenticate against an application secured with certificate-based authentication, the client needs access to a client certificate that is contained in the JBoss EAP instance’s truststore. For example, if accessing the application using a browser, the client will need to import the trusted certificate into the browser’s truststore.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="security_domain_cache"/>Configure Caching for a Security Domain</h1></div></div></div><p>
				You can specify a cache for a security domain to speed up authentication checks. By default, a security domain uses a simple map as the cache. This default cache is a Least Recently Used (LRU) cache with a maximum of 1000 entries. Alternatively, you can set a security domain to use an Infinispan cache, or disable caching altogether.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting_the_cache_type_for_a_security_domain"/>Setting the Cache Type for a Security Domain</h2></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							If you are configuring a security domain to use an Infinispan cache, you must first create an Infinispan cache container named <code class="literal">security</code> that contains a default cache that the security domain will use.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								You can only define one Infinispan cache configuration for use with security domains. Although you can have multiple security domains that use an Infinispan cache, each security domain creates its own cache instance from the one Infinispan cache configuration.
							</p></div><p class="simpara">
							See the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span> for more information on <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_cache_containers">creating a cache container</a>.
						</p></li></ul></div><p>
					You can use either the management console or management CLI to set a security domain’s cache type.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To use the management console:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Legacy)</strong></span>.
								</li><li class="listitem">
									Select the security domain from the list and click <span class="strong"><strong>View</strong></span>.
								</li><li class="listitem">
									Click <span class="strong"><strong>Edit</strong></span>, and for the <span class="strong"><strong>Cache Type</strong></span> field, select either <span class="strong"><strong>default</strong></span> or <span class="strong"><strong>infinspan</strong></span>.
								</li><li class="listitem">
									Click <span class="strong"><strong>Save</strong></span>.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							To use the management CLI, use the following command:
						</p><pre class="screen">/subsystem=security/security-domain=<span class="emphasis"><em>SECURITY_DOMAIN_NAME</em></span>:write-attribute(name=cache-type,value=<span class="emphasis"><em>CACHE_TYPE</em></span>)</pre><p class="simpara">
							For example, to set the <code class="literal">other</code> security domain to use an Infinispan cache:
						</p><pre class="screen">/subsystem=security/security-domain=other:write-attribute(name=cache-type,value=infinispan)</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="listing_and_flushing_principals"/>Listing and Flushing Principals</h2></div></div></div><div class="title"><strong>Listing Principals in the Cache</strong></div><p>
						You can see the principals that are stored in a security domain’s cache using the following management CLI command:
					</p><pre class="screen">/subsystem=security/security-domain=<span class="emphasis"><em>SECURITY_DOMAIN_NAME</em></span>:list-cached-principals</pre><div class="title"><strong>Flushing Principals from the Cache</strong></div><p>
						If required, you can flush principals from a security domain’s cache.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To flush a specific principal, use the following management CLI command:
						</p><pre class="screen">/subsystem=security/security-domain=<span class="emphasis"><em>SECURITY_DOMAIN_NAME</em></span>:flush-cache(principal=<span class="emphasis"><em>USERNAME</em></span>)</pre></li><li class="listitem"><p class="simpara">
							To flush all principals from the cache, use the following management CLI command:
						</p><pre class="screen">/subsystem=security/security-domain=<span class="emphasis"><em>SECURITY_DOMAIN_NAME</em></span>:flush-cache</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling_caching_for_a_security_domain"/>Disabling Caching for a Security Domain</h2></div></div></div><p>
					You can use either the management console or management CLI to disable caching for a security domain.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To use the management console:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Security (Legacy)</strong></span>.
								</li><li class="listitem">
									Select the security domain from the list and click <span class="strong"><strong>View</strong></span>.
								</li><li class="listitem">
									Click <span class="strong"><strong>Edit</strong></span> and select the blank value for the <span class="strong"><strong>Cache Type</strong></span>.
								</li><li class="listitem">
									Click <span class="strong"><strong>Save</strong></span>.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							To use the management CLI, use the following command:
						</p><pre class="screen">/subsystem=security/security-domain=<span class="emphasis"><em>SECURITY_DOMAIN_NAME</em></span>:undefine-attribute(name=cache-type)</pre></li></ul></div></div></div></div></body></html>