<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. Elytron Subsystem</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_secure_apps"/>Chapter 2. Elytron Subsystem</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_apps_filesystemAuth"/>Configure Authentication with a Filesystem-Based Identity Store</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Configure a <code class="literal">filesystem-realm</code> in JBoss EAP:
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							<code class="literal">filesystem-realm</code> is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
						</p><p>
							See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
						</p></div><pre class="screen">/subsystem=elytron/filesystem-realm=exampleFsRealm:add(path=fs-realm-users,relative-to=jboss.server.config.dir)</pre><p class="simpara">
						If your directory is located outside of <code class="literal">jboss.server.config.dir</code>, then you need to change the <code class="literal">path</code> and <code class="literal">relative-to</code> values appropriately.
					</p></li><li class="listitem"><p class="simpara">
						Add a user:
					</p><p class="simpara">
						When using the <code class="literal">filesystem-realm</code>, you can add users using the management CLI.
					</p><pre class="screen">/subsystem=elytron/filesystem-realm=exampleFsRealm:add-identity(identity=user1)
/subsystem=elytron/filesystem-realm=exampleFsRealm:set-password(identity=user1, clear={password="password123"})
/subsystem=elytron/filesystem-realm=exampleFsRealm:add-identity-attribute(identity=user1, name=Roles, value=["Admin","Guest"])</pre></li><li class="listitem"><p class="simpara">
						Add a <code class="literal">simple-role-decoder</code>:
					</p><pre class="screen">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</pre><p class="simpara">
						This <code class="literal">simple-role-decoder</code> decodes a principal’s roles from the <code class="literal">Roles</code> attribute. You can change this value if your roles are in a different attribute.
					</p></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">security-domain</code>:
					</p><pre class="screen">/subsystem=elytron/security-domain=exampleFsSD:add(realms=[{realm=exampleFsRealm,role-decoder=from-roles-attribute}],default-realm=exampleFsRealm,permission-mapper=default-permission-mapper)</pre></li><li class="listitem"><p class="simpara">
						Configure an <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem:
					</p><pre class="screen">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(security-domain=exampleFsSD)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
						</p></div></li><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code>:
					</p><p class="simpara">
						Your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> must be updated to use the <code class="literal">application-security-domain</code> you configured in JBoss EAP. An example of this is available in <a class="link" href="application_configuration.html#configure-app-authentication" title="Configure Web Applications to Use Elytron or Legacy Security for Authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a>.
					</p></li></ol></div><p>
				Your application is now using a file system-based identity store for authentication.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_authentication_with_a_properties_file_based_identity_store"/>Configure Authentication with a Properties File-Based Identity Store</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Create properties files:
					</p><p class="simpara">
						You must create two properties files: one that maps users to passwords and another that maps users to roles. Usually, these files are located in the <code class="literal">jboss.server.config.dir</code> directory and follow the naming convention <code class="literal">*-users.properties</code> and <code class="literal">*-roles.properties</code>, but other locations and names can be used. The <code class="literal">*-users.properties</code> file must also contain a reference to the <code class="literal">properties-realm</code>, which you will create in the next step: <code class="literal">#$REALM_NAME=<span class="emphasis"><em>YOUR_PROPERTIES_REALM_NAME</em></span>$</code>
					</p><div class="title"><strong>Example user to password file: example-users.properties</strong></div><p>
							
</p><pre class="screen">#$REALM_NAME=examplePropRealm$
user1=password123
user2=password123</pre><p>

						</p><div class="title"><strong>Example user to roles file: example-roles.properties</strong></div><p>
							
</p><pre class="screen">user1=Admin
user2=Guest</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">properties-realm</code> in JBoss EAP:
					</p><pre class="screen">/subsystem=elytron/properties-realm=examplePropRealm:add(groups-attribute=groups,groups-properties={path=example-roles.properties,relative-to=jboss.server.config.dir},users-properties={path=example-users.properties,relative-to=jboss.server.config.dir,plain-text=true})</pre><p class="simpara">
						The name of the <code class="literal">properties-realm</code> is <code class="literal">examplePropRealm</code>, which is used in the previous step in the <code class="literal">example-users.properties</code> file. Also, if your properties files are located outside of <code class="literal">jboss.server.config.dir</code>, then you must change the <code class="literal">path</code> and <code class="literal">relative-to</code> values appropriately.
					</p></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">security-domain</code>:
					</p><pre class="screen">/subsystem=elytron/security-domain=exampleSD:add(realms=[{realm=examplePropRealm,role-decoder=groups-to-roles}],default-realm=examplePropRealm,permission-mapper=default-permission-mapper)</pre></li><li class="listitem"><p class="simpara">
						Configure an <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem:
					</p><pre class="screen">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(security-domain=exampleSD)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
						</p></div></li><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code>:
					</p><p class="simpara">
						Your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> must be updated to use the <code class="literal">application-security-domain</code> you configured in JBoss EAP. An example of this is available in <a class="link" href="application_configuration.html#configure-app-authentication" title="Configure Web Applications to Use Elytron or Legacy Security for Authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a>.
					</p></li></ol></div><p>
				Your application is now using a properties file-based identity store for authentication.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					The properties files are only read when the server starts. Any users added after server startup, either manually or by using an <code class="literal">add-user</code> script, requires a server reload. This reload is accomplished by running the <code class="literal">reload</code> command from the management CLI.
				</p><pre class="screen">reload</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_apps_DBAuth"/>Configure Authentication with a Database-Based Identity Store</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Determine your database format for usernames, passwords, and roles:
					</p><p class="simpara">
						To set up authentication using a database for an identity store, you need to determine how your usernames, passwords, and roles are stored in that database. In this example, we are using a single table with the following sample data:
					</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">username</th><th style="text-align: left" valign="top">password</th><th style="text-align: left" valign="top">roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										user1
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										password123
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Admin
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										user2
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										password123
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Guest
									</p>
									 </td></tr></tbody></table></div></li><li class="listitem"><p class="simpara">
						Configure a datasource:
					</p><p class="simpara">
						To connect to a database from JBoss EAP, you must have the appropriate database driver deployed, as well as a datasource configured. This example shows deploying the driver for PostgreSQL and configuring a datasource in JBoss EAP:
					</p><pre class="screen">deploy /path/to/postgresql-9.4.1210.jar

data-source add --name=examplePostgresDS --jndi-name=java:jboss/examplePostgresDS --driver-name=postgresql-9.4.1210.jar  --connection-url=jdbc:postgresql://localhost:5432/postgresdb --user-name=postgresAdmin --password=mysecretpassword</pre></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">jdbc-realm</code> in JBoss EAP:
					</p><pre class="screen">/subsystem=elytron/jdbc-realm=exampleDbRealm:add(principal-query=[{sql="SELECT password,roles FROM eap_users WHERE username=?",data-source=examplePostgresDS,clear-password-mapper={password-index=1},attribute-mapping=[{index=2,to=groups}]}])</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The above example shows how to obtain passwords and roles from a single <code class="literal">principal-query</code>. You can also create additional <code class="literal">principal-query</code> with <code class="literal">attribute-mapping</code> attributes if you require multiple queries to obtain roles or additional authentication or authorization information.
						</p></div></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">security-domain</code>:
					</p><pre class="screen">/subsystem=elytron/security-domain=exampleDbSD:add(realms=[{realm=exampleDbRealm,role-decoder=groups-to-roles}],default-realm=exampleDbRealm,permission-mapper=default-permission-mapper)</pre></li><li class="listitem"><p class="simpara">
						Configure an <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem:
					</p><pre class="screen">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(security-domain=exampleDbSD)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
						</p></div></li><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code>:
					</p><p class="simpara">
						Your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> must be updated to use the <code class="literal">application-security-domain</code> you configured in JBoss EAP. An example of this is available in <a class="link" href="application_configuration.html#configure-app-authentication" title="Configure Web Applications to Use Elytron or Legacy Security for Authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a>.
					</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_ldap_auth_app"/>Configure Authentication with an LDAP-Based Identity Store</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Determine your LDAP format for usernames, passwords, and roles:
					</p><p class="simpara">
						To set up authentication using an LDAP server for an identity store, you need to determine how your usernames, passwords, and roles are stored. In this example, we are using the following structure:
					</p><pre class="screen">dn: dc=wildfly,dc=org
dc: wildfly
objectClass: top
objectClass: domain

dn: ou=Users,dc=wildfly,dc=org
objectClass: organizationalUnit
objectClass: top
ou: Users

dn: uid=jsmith,ou=Users,dc=wildfly,dc=org
objectClass: top
objectClass: person
objectClass: inetOrgPerson
cn: John Smith
sn: smith
uid: jsmith
userPassword: password123

dn: ou=Roles,dc=wildfly,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Roles

dn: cn=Admin,ou=Roles,dc=wildfly,dc=org
objectClass: top
objectClass: groupOfNames
cn: Admin
member: uid=jsmith,ou=Users,dc=wildfly,dc=org</pre></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">dir-context</code>:
					</p><p class="simpara">
						To connect to the LDAP server from JBoss EAP, you need to configure a <code class="literal">dir-context</code> that provides the URL as well as the principal used to connect to the server.
					</p><pre class="screen">/subsystem=elytron/dir-context=exampleDC:add(url="ldap://127.0.0.1:10389",principal="uid=admin,ou=system",credential-reference={clear-text="secret"})</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							It is not possible to use a JMX <code class="literal">ObjectName</code> to decrypt the LDAP credentials. Instead, credentials can be secured by using a <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#credential_store">Credential Store</a> as discussed in <span class="emphasis"><em>How to Configure Server Security</em></span> for JBoss EAP.
						</p></div></li><li class="listitem"><p class="simpara">
						Configure an <code class="literal">ldap-realm</code> in JBoss EAP:
					</p><pre class="screen">/subsystem=elytron/ldap-realm=exampleLR:add(dir-context=exampleDC,identity-mapping={search-base-dn="ou=Users,dc=wildfly,dc=org",rdn-identifier="uid",user-password-mapper={from="userPassword"},attribute-mapping=[{filter-base-dn="ou=Roles,dc=wildfly,dc=org",filter="(&amp;(objectClass=groupOfNames)(member={0}))",from="cn",to="Roles"}]})</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
							If any referenced LDAP servers contain a loop in referrals, it can result in a <code class="literal">java.lang.OutOfMemoryError</code> error on the JBoss EAP server.
						</p></div></li><li class="listitem"><p class="simpara">
						Add a <code class="literal">simple-role-decoder</code>:
					</p><pre class="screen">/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</pre></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">security-domain</code>:
					</p><pre class="screen">/subsystem=elytron/security-domain=exampleLdapSD:add(realms=[{realm=exampleLR,role-decoder=from-roles-attribute}],default-realm=exampleLR,permission-mapper=default-permission-mapper)</pre></li><li class="listitem"><p class="simpara">
						Configure an <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem:
					</p><pre class="screen">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(security-domain=exampleLdapSD)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
						</p></div></li><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code>:
					</p><p class="simpara">
						Your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> must be updated to use the <code class="literal">application-security-domain</code> you configured in JBoss EAP. An example of this is available in <a class="link" href="application_configuration.html#configure-app-authentication" title="Configure Web Applications to Use Elytron or Legacy Security for Authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a>.
					</p></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					In cases where the <code class="literal">elytron</code> subsystem uses an LDAP server to perform authentication, JBoss EAP will return a <code class="literal">500</code>, or internal server error, error code if that LDAP server is unreachable. This behavior differs from previous versions of JBoss EAP using the legacy <code class="literal">security</code> subsystem, which returned a <code class="literal">401</code>, or unauthorized, error code under the same conditions.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_authentication_with_certificates"/>Configure Authentication with Certificates</h1></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Before you can set up certificate-based authentication, you must have two-way SSL configured. More details on configuring two-way SSL can be found in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#elytron_two-way_ssl_apps">Enable Two-way SSL/TLS for Applications using the Elytron Subsystem</a> section of the <span class="emphasis"><em>How to Configure Server Security</em></span> guide.
				</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Configure a <code class="literal">key-store-realm</code>.
					</p><pre class="screen">/subsystem=elytron/key-store-realm=ksRealm:add(key-store=twoWayTS)</pre><p class="simpara">
						You must configure this realm with a truststore that contains the client’s certificate. The authentication process uses the same certificate presented by the client during the two-way SSL handshake.
					</p></li><li class="listitem"><p class="simpara">
						Create a decoder.
					</p><p class="simpara">
						You need to create a <code class="literal">x500-attribute-principal-decoder</code> to decode the principal you get from your certificate. The below example will decode the principal based on the first <code class="literal">CN</code> value.
					</p><pre class="screen">/subsystem=elytron/x500-attribute-principal-decoder=CNDecoder:add(oid="2.5.4.3",maximum-segments=1)</pre><p class="simpara">
						For example, if the full <code class="literal">DN</code> was <code class="literal">CN=client,CN=client-certificate,DC=example,DC=jboss,DC=org</code>, <code class="literal">CNDecoder</code> would decode the principal as <code class="literal">client</code>. This decoded principal is used as the <code class="literal">alias</code> value to lookup a certificate in the truststore configured in <code class="literal">ksRealm</code>.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							The decoded principal <span class="strong"><strong>MUST</strong></span> be the <code class="literal">alias</code> value you set in your server’s truststore for the client’s certificate.
						</p></div></li><li class="listitem"><p class="simpara">
						Add a <code class="literal">constant-role-mapper</code> for assigning roles.
					</p><p class="simpara">
						This is example uses a <code class="literal">constant-role-mapper</code> to assign roles to a principal from <code class="literal">ksRealm</code>, but you can also use other approaches.
					</p><pre class="screen">/subsystem=elytron/constant-role-mapper=constantClientCertRole:add(roles=[Admin,Guest])</pre></li><li class="listitem"><p class="simpara">
						Configure a <code class="literal">security-domain</code>.
					</p><pre class="screen">/subsystem=elytron/security-domain=exampleCertSD:add(realms=[{realm=ksRealm}],default-realm=ksRealm,permission-mapper=default-permission-mapper,principal-decoder=CNDecoder,role-mapper=constantClientCertRole)</pre></li><li class="listitem"><p class="simpara">
						Configure an <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem.
					</p><pre class="screen">/subsystem=undertow/application-security-domain=exampleApplicationDomain:add(security-domain=exampleCertSD)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
						</p></div></li><li class="listitem"><p class="simpara">
						Update <code class="literal">server-ssl-context</code>.
					</p><pre class="screen">/subsystem=elytron/server-ssl-context=twoWaySSC:write-attribute(name=security-domain,value=exampleCertSD)
/subsystem=elytron/server-ssl-context=twoWaySSC:write-attribute(name=authentication-optional, value=true)
reload</pre></li><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code>.
					</p><p class="simpara">
						Your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> must be updated to use the <code class="literal">application-security-domain</code> you configured in JBoss EAP. An example of this is available in <a class="link" href="application_configuration.html#configure-app-authentication" title="Configure Web Applications to Use Elytron or Legacy Security for Authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a>.
					</p><p class="simpara">
						In addition, you need to update your <code class="literal">web.xml</code> to use <code class="literal">CLIENT-CERT</code> as its authentication method.
					</p><pre class="screen">&lt;login-config&gt;
  &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_override_deployment_config"/>Override an Application’s Authentication Configuration</h1></div></div></div><p>
				You can override the authentication configuration of an application with one configured in JBoss EAP. To do this, use the <code class="literal">override-deployment-configuration</code> property in the <code class="literal">application-security-domain</code> section of the <code class="literal">undertow</code> subsystem:
			</p><pre class="screen">/subsystem=undertow/application-security-domain=exampleApplicationDomain:write-attribute(name=override-deployment-config,value=true)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
				</p></div><p>
				For example, an application is configured to use <code class="literal">FORM</code> authentication with the <code class="literal">exampleApplicationDomain</code> in its <code class="literal">jboss-web.xml</code>.
			</p><div class="title"><strong>Example <code class="literal">jboss-web.xml</code></strong></div><p>
					
</p><pre class="screen">&lt;login-config&gt;
  &lt;auth-method&gt;FORM&lt;/auth-method&gt;
  &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
&lt;/login-config&gt;</pre><p>

				</p><p>
				By enabling <code class="literal">override-deployment-configuration</code>, you can create a new <code class="literal">http-authentication-factory</code> that specifies a different authentication mechanism, such as <code class="literal">BASIC</code> or <code class="literal">DIGEST</code>.
			</p><div class="title"><strong>Example <code class="literal">http-authentication-factory</code></strong></div><p>
					
</p><pre class="screen">/subsystem=elytron/http-authentication-factory=exampleHttpAuth:read-resource()
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "http-server-mechanism-factory" =&gt; "global",
        "mechanism-configurations" =&gt; [{
            "mechanism-name" =&gt; "BASIC",
            "mechanism-realm-configurations" =&gt; [{"realm-name" =&gt; "exampleApplicationDomain"}]
        }],
        "security-domain" =&gt; "exampleSD"
    }
}</pre><p>

				</p><p>
				This will override the authentication mechanism defined in the application’s <code class="literal">jboss-web.xml</code> and attempt to authenticate a user using <code class="literal">BASIC</code> instead of <code class="literal">FORM</code>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_apps_caching_realm"/>Set Up Caching for Security Realms</h1></div></div></div><p>
				Elytron provides a <code class="literal">caching-realm</code> which allows you to cache the results of a credential lookup from a security realm. For example, you could use this to configure a cache for credentials coming from LDAP or a database to increase performance for frequently queried users.
			</p><p>
				The <code class="literal">caching-realm</code> caches the <code class="literal">PasswordCredential</code> credential using a <span class="emphasis"><em>LRU</em></span> or <span class="emphasis"><em>Least Recently Used</em></span> caching strategy, in which the least accessed entries are discarded when maximum number of entries is reached.
			</p><p>
				You can use a <code class="literal">caching-realm</code> with the following security realms:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">filesystem-realm</code>
					</li><li class="listitem">
						<code class="literal">jdbc-realm</code>
					</li><li class="listitem">
						<code class="literal">ldap-realm</code>
					</li><li class="listitem">
						a custom security realm
					</li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					<code class="literal">filesystem-realm</code> is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
				</p><p>
					See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
				</p></div><p>
				If you make changes to your credential source outside of JBoss EAP, those changes are only propagated to a JBoss EAP caching realm if the underlying security realm supports listening. In particular, an <code class="literal">ldap-realm</code> supports listening, however filtered attributes, such as <code class="literal">roles</code>, inside the <code class="literal">ldap-realm</code> do not.
			</p><p>
				To ensure that your caching realm has a correct cache of user data, it is recommended that you modify your user attributes through the caching realm rather than at your credential source. Alternatively, you can <a class="link" href="elytron_secure_apps.html#caching_realm_clear" title="Clear a caching-realm Cache">clear the cache</a>.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Making user changes through a caching realm is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
				</p><p>
					See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
				</p></div><p>
				To configure and use a <code class="literal">caching-realm</code>:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Create an existing security realm.
					</p><p class="simpara">
						You need an existing security realm to use with a <code class="literal">caching-realm</code>. For example, you could create a <code class="literal">filesystem-realm</code> similar to the steps in <a class="link" href="elytron_secure_apps.html#elytron_apps_filesystemAuth" title="Configure Authentication with a Filesystem-Based Identity Store">Configure Authentication with a Filesystem-Based Identity Store</a>.
					</p><div class="title"><strong>Example filesystem-realm</strong></div><p>
							
</p><pre class="screen">/subsystem=elytron/filesystem-realm=exampleFsRealm:add(path=fs-realm-users, relative-to=jboss.server.config.dir)

/subsystem=elytron/filesystem-realm=exampleFsRealm:add-identity(identity=user1)

/subsystem=elytron/filesystem-realm=exampleFsRealm:set-password(identity=user1, clear={password="password123"})

/subsystem=elytron/filesystem-realm=exampleFsRealm:add-identity-attribute(identity=user1,name=Roles,value=["Admin","Guest"])

/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">caching-realm</code>.
					</p><p class="simpara">
						Once you have an existing realm you want to cache, create a <code class="literal">caching-realm</code> that references it.
					</p><div class="title"><strong>Example caching-realm that Uses exampleFsRealm</strong></div><p>
							
</p><pre class="screen">/subsystem=elytron/caching-realm=exampleCacheRealm:add(realm=exampleFsRealm)</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">caching-realm</code>.
					</p><p class="simpara">
						After you create the <code class="literal">caching-realm</code>, you can then use it in your security configuration just as you would any other security realm. For example, you could use it in the same place you would use a <code class="literal">filesystem-realm</code> in <a class="link" href="elytron_secure_apps.html#elytron_apps_filesystemAuth" title="Configure Authentication with a Filesystem-Based Identity Store">Configure Authentication with a Filesystem-Based Identity Store</a>.
					</p><div class="title"><strong>Example Configuration Using the caching-realm</strong></div><p>
							
</p><pre class="screen">/subsystem=elytron/security-domain=exampleFsSD:add(realms=[{realm=exampleCacheRealm, role-decoder=from-roles-attribute}], default-realm=exampleCacheRealm, permission-mapper=default-permission-mapper)

/subsystem=elytron/http-authentication-factory=example-fs-http-auth:add(http-server-mechanism-factory=global, security-domain=exampleFsSD, mechanism-configurations=[{mechanism-name=BASIC, mechanism-realm-configurations=[{realm-name=exampleApplicationDomain}]}])</pre><p>

						</p></li></ol></div><p>
				You can control the cache size as well as item expiration by using <code class="literal">maximum-entries</code> and <code class="literal">maximum-age</code> attributes of the <code class="literal">caching-realm</code>. For more details on those attributes, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#elytron_subsystem_components_reference">Elytron Subsystem Components Reference</a> section in <span class="emphasis"><em>How to Configure Server Security</em></span>.
			</p><p><a id="caching_realm_clear"/></p><div class="title"><strong>Clear a <code class="literal">caching-realm</code> Cache</strong></div><p>
					You can clear an existing cache by using the <code class="literal">clear-cache</code> command. Clearing a cache forces it to repopulate using the latest data from the security realm.
				</p><pre class="screen">/subsystem=elytron/caching-realm=exampleCacheRealm:clear-cache</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_container_sso"/>Configure Applications to use Container-managed Single Sign-on</h1></div></div></div><p>
				You can configure JBoss EAP to use container-managed single sign-on for applications using the Elytron <code class="literal">FORM</code> authentication method. This allows users to authenticate once and access other resources secured by the <code class="literal">FORM</code> authentication method without having to reauthenticate.
			</p><p>
				The related single sign-on session is invalidated when:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						there are no active local sessions left.
					</li><li class="listitem">
						logging out from an application.
					</li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					You can use single sign-on across applications deployed on different JBoss EAP instances as long as these instances are in a cluster.
				</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Create a <code class="literal">key-store</code>.
					</p><p class="simpara">
						A <code class="literal">key-store</code> is necessary in order to configure a secure communication channel between the different servers participating in the SSO. This channel is used to exchange messages about events that occur when single sign-on sessions are created or destroyed, during log in and log out respectively.
					</p><p class="simpara">
						To create a <code class="literal">key-store</code> in the <code class="literal">elytron</code> subsystem, first create a Java KeyStore as follows:
					</p><pre class="screen">keytool -genkeypair -alias localhost -keyalg RSA -keysize 1024 -validity 365 -keystore keystore.jks -dname "CN=localhost" -keypass secret -storepass secret</pre><p class="simpara">
						Once the <code class="literal">keystore.jks</code> file is created, execute the following management CLI command to create a <code class="literal">key-store</code> definition in Elytron:
					</p><pre class="screen">/subsystem=elytron/key-store=example-keystore:add(path=keystore.jks, relative-to=jboss.server.config.dir, credential-reference={clear-text=secret}, type=JKS)</pre></li><li class="listitem"><p class="simpara">
						Add the security realm.
					</p><p class="simpara">
						Create a <code class="literal">FileSystem</code> realm, an identity store where users are stored in the local file system, using the following management CLI command:
					</p><pre class="screen">/subsystem=elytron/filesystem-realm=example-realm:add(path=/tmp/example-realm)</pre></li><li class="listitem"><p class="simpara">
						Use the following management CLI command to create a <code class="literal">security-domain</code>:
					</p><pre class="screen">/subsystem=elytron/security-domain=example-domain:add(default-realm=example-realm,permission-mapper=default-permission-mapper,realms=[{realm=example-realm,role-decoder=groups-to-roles}]</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Applications using SSO should use <code class="literal">HTTP FORM</code> authentication as they usually need to provide a login page for the users.
						</p></div></li><li class="listitem"><p class="simpara">
						Create an application security domain in the <code class="literal">undertow</code> subsystem.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							If you already have a <code class="literal">application-security-domain</code> defined in the <code class="literal">undertow</code> subsystem and just want to use it to enable single sign-on to your applications, you can skip this step.
						</p></div><pre class="screen">/subsystem=undertow/application-security-domain=other:add(security-domain=example-domain)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							By default, if your application does not define any specific security-domain in the <code class="literal">jboss-web.xml</code> file, the application server will choose one with a name <code class="literal">other</code>.
						</p></div></li><li class="listitem"><p class="simpara">
						Update the <code class="literal">undertow</code> subsystem to enable single sign-on and use the keystore.
					</p><p class="simpara">
						Single sign-on is enabled to a specific <code class="literal">application-security-domain</code> definition in the <code class="literal">undertow</code> subsystem. It is important that the servers you are using to deploy the applications are using the same configuration.
					</p><p class="simpara">
						To enable single sign-on, just change an existing <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem as follows:
					</p><pre class="screen">/subsystem=undertow/application-security-domain=other/setting=single-sign-on:add(key-store=example-keystore, key-alias=localhost, domain=localhost, credential-reference={clear-text=secret})</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							An <code class="literal">application-security-domain</code> in the <code class="literal">undertow</code> subsystem can be configured using the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Web (Undertow)</strong></span> → <span class="strong"><strong>Application Security Domain</strong></span>.
						</p></div><p class="simpara">
						For more information on the SSO attributes and their definitions, see <a class="link" href="reference_material.html#single_sign_on_attributes" title="Reference for Single Sign-on Attributes">Reference for Single Sign-on Attributes</a>.
					</p></li><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> files.
					</p><p class="simpara">
						Your application’s <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code> must be updated to use the <code class="literal">application-security-domain</code> you configured in JBoss EAP. An example of this is available in <a class="link" href="application_configuration.html#configure-app-authentication" title="Configure Web Applications to Use Elytron or Legacy Security for Authentication">Configure Web Applications to Use Elytron or Legacy Security for Authentication</a>.
					</p></li></ol></div><p>
				JBoss EAP provides out-of-the-box support for clustered and non-clustered <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#legacy_sso">SSO using the <code class="literal">undertow</code> and <code class="literal">infinispan</code> subsystems</a>.
			</p></div></div></body></html>