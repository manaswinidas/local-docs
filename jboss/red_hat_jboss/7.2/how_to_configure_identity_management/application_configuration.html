<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 4. Application Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="application_configuration"/>Chapter 4. Application Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure-app-authentication"/>Configure Web Applications to Use Elytron or Legacy Security for Authentication</h1></div></div></div><p>
				After you have configured the <code class="literal">elytron</code> or legacy <code class="literal">security</code> subsystem for authentication, you need to configure your application to use it.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Configure your application’s <code class="literal">web.xml</code>.
					</p><p class="simpara"><a id="configure-elytron-web-and-jboss-xml"/>
						Your application’s <code class="literal">web.xml</code> needs to be configured to use the appropriate authentication method. When using the <code class="literal">elytron</code> subsystem, this is defined in the <code class="literal">http-authentication-factory</code> you created. When using the legacy <code class="literal">security</code> subsystem, this depends on your login module and the type of authentication you want to configure.
					</p><div class="title"><strong>Example <code class="literal">web.xml</code> with <code class="literal">BASIC</code> Authentication</strong></div><p>
							
</p><pre class="programlisting">&lt;web-app&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;secure&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/secure/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;Admin&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-role&gt;
    &lt;description&gt;The role that is required to log in to /secure/*&lt;/description&gt;
    &lt;role-name&gt;Admin&lt;/role-name&gt;
  &lt;/security-role&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;exampleApplicationDomain&lt;/realm-name&gt;
  &lt;/login-config&gt;
&lt;/web-app&gt;</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Configure your application to use a security domain.
					</p><p class="simpara">
						You can configure your application’s <code class="literal">jboss-web.xml</code> to specify the security domain you want to use for authentication. When using the <code class="literal">elytron</code> subsystem, this is defined when you created the <code class="literal">application-security-domain</code>. When using the legacy <code class="literal">security</code> subsystem, this is the name of the legacy security domain.
					</p><div class="title"><strong>Example <code class="literal">jboss-web.xml</code></strong></div><p>
							
</p><pre class="programlisting">&lt;jboss-web&gt;
  &lt;security-domain&gt;exampleApplicationDomain&lt;/security-domain&gt;
&lt;/jboss-web&gt;</pre><p>

						</p><p class="simpara">
						Using <code class="literal">jboss-web.xml</code> allows you to configure the security domain for a single application only. Alternatively, you can specify a default security domain for all applications using the <code class="literal">undertow</code> subsystem. This allows you to omit using <code class="literal">jboss-web.xml</code> to configure a security domain for an individual application.
					</p><pre class="screen">/subsystem=undertow:write-attribute(name=default-security-domain, value="exampleApplicationDomain")</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Setting <code class="literal">default-security-domain</code> in the <code class="literal">undertow</code> subsystem will apply to <span class="strong"><strong>ALL</strong></span> applications. If <code class="literal">default-security-domain</code> is set and an application specifies a security domain in a <code class="literal">jboss-web.xml</code> file, the configuration in <code class="literal">jboss-web.xml</code> will override the <code class="literal">default-security-domain</code> in the <code class="literal">undertow</code> subsystem.
						</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The security domain for EJBs is defined in the EJB configuration, either in the <code class="literal">ejb3</code> subsystem, the descriptor for EJBs in the <code class="literal">jboss-ejb3.xml</code> file, or by using the <code class="literal">@SecurityDomain</code> annotation.
						</p><p>
							For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/developing_ejb_applications/#ejb_application_security">EJB Application Security</a> in the <span class="emphasis"><em>Developing EJB Applications</em></span> guide.
						</p></div></li></ol></div><h3><a id="using_elytron_and_legacy_security_subsystems_in_parallel"/>Using Elytron and Legacy Security Subsystems in Parallel</h3><p>
				You can define authentication in both the <code class="literal">elytron</code> and legacy <code class="literal">security</code> subsystems and use them in parallel. If you use both <code class="literal">jboss-web.xml</code> and <code class="literal">default-security-domain</code> in the <code class="literal">undertow</code> subsystem, JBoss EAP will first try to match the configured security domain in the <code class="literal">elytron</code> subsystem. If a match is not found, then JBoss EAP will attempt to match the security domain with one configured in the legacy <code class="literal">security</code> subsystem. If the <code class="literal">elytron</code> and legacy <code class="literal">security</code> subsystem each have a security domain with the same name, the <code class="literal">elytron</code> security domain is used.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					If you have a web servlet defined using one security domain and you are calling EJB from another EAR module, which uses EJB specific security domain, one of the following might happen:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							If the WAR and the EJB are mapped to different Elytron security domains, you need to configure the outflow or the trusted security domains so that their identities propagate from one deployment domain to the next one. Unless this is done, once the call reaches the EJB, the identity becomes anonymous. For more information on how to configure security identities for authentication, see <a class="link" href="application_configuration.html#configure_trusted_security_domain_outflows" title="Configuring Trusted Security Domain Outflows">Configuring Trusted Security Domain Outflows</a>.
						</li><li class="listitem">
							If the WAR and the EJB references different security domain names but they are mapped to the same Elytron security domain, their identity will propagate without requiring any additional steps.
						</li></ul></div><p>
					When migrating, it is best to migrate the entire application. Migrating the EJB and WAR separately and using both <code class="literal">elytron</code> and legacy <code class="literal">security</code> subsystems in parallel is not suggested. For more information on how to migrate your application to use Elytron, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/migration_guide/#migrating_to_elytron">Migrating to Elytron in JBoss EAP 7.1</a> in the JBoss EAP Migration Guide.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_client_authentication"/>Configure Client Authentication with Elytron Client</h1></div></div></div><p>
				Clients connecting to JBoss EAP, such as EJBs, can authenticate using Elytron Client. Elytron Client is a client-side framework that enables remote clients to authenticate using Elytron. Elytron Client has the following components:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication Configuration</span></dt><dd>
							The authentication configuration contains authentication information such as usernames, passwords, allowed SASL mechanisms, as well as which security realm to use during digest authentication. The connection information specified in the authentication configuration overrides any values that are specified in the <code class="literal">PROVIDER_URL</code> of the initial context.
						</dd><dt><span class="term">MatchRule</span></dt><dd>
							A rule used for deciding which authentication configuration to use.
						</dd><dt><span class="term">Authentication Context</span></dt><dd>
							A set of rules and authentication configurations to use with a client for establishing a connection.
						</dd></dl></div><p>
				When a connection is established, the client makes use of an authentication context. This authentication context contains rules to choose which authentication configuration to use for each outbound connection. For example, you could have rules that use one authentication configuration when connecting to <code class="literal">server1</code> and another authentication configuration when connecting with <code class="literal">server2</code>. The authentication context is comprised of a set of authentication configurations and a set of rules that define how they are selected when establishing a connection. An authentication context can also reference <code class="literal">ssl-context</code> and can be matched with rules.
			</p><p>
				To create a client that uses security information when establishing a connection:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Create one or more authentication configurations.
					</li><li class="listitem">
						Create an authentication context by creating rule and authentication configuration pairs.
					</li><li class="listitem">
						Create a runnable for establishing your connection.
					</li><li class="listitem">
						Use your authentication context to run your runnable.
					</li></ul></div><p>
				When you establish your connection, Elytron Client will use the set of rules provided by the authentication context to match the correct authentication configuration to use during authentication.
			</p><p>
				You can use one of the following approaches to use security information when establishing a client connection.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					When using Elytron Client to make EJB calls, any hard-coded programmatic authentication information, such as setting <code class="literal">Context.SECURITY_PRINCIPAL</code> in the <code class="literal">javax.naming.InitialContext</code>, will override the Elytron Client configuration.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_client_configuration_file_approach"/>The Configuration File Approach</h2></div></div></div><p>
					The configuration file approach involves creating an XML file with your authentication configuration, authentication context, and match rules.
				</p><div class="title"><strong>Example: custom-config.xml</strong></div><p>
						
</p><pre class="programlisting">&lt;configuration&gt;
    &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
        &lt;authentication-rules&gt;
            &lt;rule use-configuration="monitor"&gt;
                &lt;match-host name="127.0.0.1" /&gt;
            &lt;/rule&gt;
            &lt;rule use-configuration="administrator"&gt;
                &lt;match-host name="localhost" /&gt;
            &lt;/rule&gt;
        &lt;/authentication-rules&gt;
        &lt;authentication-configurations&gt;
            &lt;configuration name="monitor"&gt;
                &lt;sasl-mechanism-selector selector="DIGEST-MD5" /&gt;
                &lt;providers&gt;
                  &lt;use-service-loader /&gt;
                &lt;/providers&gt;
                &lt;set-user-name name="monitor" /&gt;
                &lt;credentials&gt;
                    &lt;clear-password password="password1!" /&gt;
                &lt;/credentials&gt;
                &lt;set-mechanism-realm name="ManagementRealm" /&gt;
             &lt;/configuration&gt;

             &lt;configuration name="administrator"&gt;
                &lt;sasl-mechanism-selector selector="DIGEST-MD5" /&gt;
                &lt;providers&gt;
                  &lt;use-service-loader /&gt;
                &lt;/providers&gt;
                &lt;set-user-name name="administrator" /&gt;
                &lt;credentials&gt;
                    &lt;clear-password password="password1!" /&gt;
                &lt;/credentials&gt;
                &lt;set-mechanism-realm name="ManagementRealm" /&gt;
             &lt;/configuration&gt;
        &lt;/authentication-configurations&gt;
    &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre><p>

					</p><p>
					You can then reference that file in your client’s code by setting a system property when running your client.
				</p><pre class="screen">$ java -Dwildfly.config.url=/path/to/custom-config.xml ...</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						If you use the <a class="link" href="application_configuration.html#elytron_client_programmatic_approach" title="The Programmatic Approach">programmatic approach</a>, it will override any provided configuration files even if the <code class="literal">wildfly.config.url</code> system property is set.
					</p></div><p>
					When creating rules, you can look for matches on various parameters, such as <code class="literal">hostname</code>, <code class="literal">port</code>, <code class="literal">protocol</code>, or <code class="literal">user-name</code>. A full list of options for <code class="literal">MatchRule</code> are available in the Javadocs. Rules are evaluated in the order in which they are configured.
				</p><p>
					When no match settings are included in a rule, then the whole rule matches and the authentication configuration is chosen. If more than one match setting is included in a rule, then all must match for the authentication configuration to be chosen.
				</p><div class="table"><a id="idm140267130965024"/><p class="title"><strong>Table 4.1. Common Rules</strong></p><div class="table-contents"><table summary="Common Rules" border="1" width="100%"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									match-local-security-domain
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the local security domain to match against.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-host
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the hostname to match against. For example, the host <code class="literal">127.0.0.1</code> would match on <code class="literal"><a class="link" href="http://127.0.0.1:9990/my/path">http://127.0.0.1:9990/my/path</a></code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-no-user
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Matches against URIs with no user.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-path
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the path to match against. For example, the path <code class="literal">/my/path/</code> would match on <code class="literal"><a class="link" href="http://127.0.0.1:9990/my/path">http://127.0.0.1:9990/my/path</a></code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-port
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the port to match against. For example, the port <code class="literal">9990</code> would match on <code class="literal"><a class="link" href="http://127.0.0.1:9990/my/path">http://127.0.0.1:9990/my/path</a></code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-protocol
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the protocol to match against. For example, the protocol <code class="literal">http</code> would match on <code class="literal"><a class="link" href="http://127.0.0.1:9990/my/path">http://127.0.0.1:9990/my/path</a></code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-urn
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the URN to match against.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									match-user
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Takes a single <code class="literal">name</code> attribute specifying the <code class="literal">user</code> to match against.
								</p>
								 </td></tr></tbody></table></div></div><p>
					An example <code class="literal">wildfly-config.xml</code> file can be found in <a class="link" href="reference_material.html#elytron_wildfly_config" title="Example wildfly-config.xml">Example <code class="literal">wildfly-config.xml</code></a>. For more information about how to configure the <code class="literal">wildfly-config.xml</code> file, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#client_configuration_using_the_wildfly_config_file">Client Configuration Using the <code class="literal">wildfly-config.xml</code> File</a> in the <span class="emphasis"><em>Development Guide</em></span> for JBoss EAP.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_client_programmatic_approach"/>The Programmatic Approach</h2></div></div></div><p>
					The programmatic approach configures all Elytron Client configuration in the client’s code:
				</p><pre class="programlisting">//create your authentication configuration
AuthenticationConfiguration adminConfig =
    AuthenticationConfiguration.empty()
      .useProviders(() -&gt; new Provider[] { new WildFlyElytronProvider() })
      .setSaslMechanismSelector(SaslMechanismSelector.NONE.addMechanism("DIGEST-MD5"))
      .useRealm("ManagementRealm")
      .useName("administrator")
      .usePassword("password1!");

//create your authentication context
AuthenticationContext context = AuthenticationContext.empty();
context = context.with(MatchRule.ALL.matchHost("127.0.0.1"), adminConfig);


//create your runnable for establishing a connection
Runnable runnable =
    new Runnable() {
      public void run() {
        try {
           //Establish your connection and do some work
        } catch (Exception e) {
          e.printStackTrace();
        }
      }
    };

//use your authentication context to run your client
context.run(runnable);</pre><p>
					When adding configuration details to <code class="literal">AuthenticationConfiguration</code> and <code class="literal">AuthenticationContext</code>, each method call returns a new instance of that object. For example, if you wanted separate configurations when connecting over different hostnames, you could do the following:
				</p><pre class="programlisting">//create your authentication configuration
AuthenticationConfiguration commonConfig =
    AuthenticationConfiguration.empty()
      .useProviders(() -&gt; new Provider[] { new WildFlyElytronProvider() })
      .setSaslMechanismSelector(SaslMechanismSelector.NONE.addMechanism("DIGEST-MD5"))
      .useRealm("ManagementRealm");

AuthenticationConfiguration administrator =
    commonConfig
      .useName("administrator")
      .usePassword("password1!");


AuthenticationConfiguration monitor =
    commonConfig
      .useName("monitor")
      .usePassword("password1!");


//create your authentication context
AuthenticationContext context = AuthenticationContext.empty();
context = context.with(MatchRule.ALL.matchHost("127.0.0.1"), administrator);
context = context.with(MatchRule.ALL.matchHost("localhost"), monitor);</pre><div class="table"><a id="idm140267152797856"/><p class="title"><strong>Table 4.2. Common Rules</strong></p><div class="table-contents"><table summary="Common Rules" border="1" width="100%"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Rule</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									matchLocalSecurityDomain(String name)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-domain</code> in the configuration file approach.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchNoUser()
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-no-user</code> in the configuration file approach.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchPath(String pathSpec)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-path</code> in the configuration file approach.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchPort(int port)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-port</code> in the configuration file approach.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchProtocol(String protoName)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-port</code> in the configuration file approach.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchPurpose(String purpose)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Create a new rule which is the same as this rule, but also matches the given purpose name.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchUrnName(String name)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-urn</code> in the configuration file approach.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									matchUser(String userSpec)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									This is the same as <code class="literal">match-userinfo</code> in the configuration file approach.
								</p>
								 </td></tr></tbody></table></div></div><p>
					Also, instead of starting with an empty authentication configuration, you can start with the currently configured one by using <code class="literal">captureCurrent()</code>.
				</p><pre class="programlisting">//create your authentication configuration
AuthenticationConfiguration commonConfig = AuthenticationConfiguration.captureCurrent();</pre><p>
					Using <code class="literal">captureCurrent()</code> will capture any previously established authentication context and use it as your new base configuration. An authentication context is established once it has been activated by calling <code class="literal">run()</code>. If <code class="literal">captureCurrent()</code> is called and no context is currently active, it will try and use the default authentication if available. You can find more details about this in the following sections:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="application_configuration.html#elytron_client_configuration_file_approach" title="The Configuration File Approach">The Configuration File Approach</a>
						</li><li class="listitem">
							<a class="link" href="application_configuration.html#elytron_client_default_configuration_approach" title="The Default Configuration Approach">The Default Configuration Approach</a>
						</li><li class="listitem">
							<a class="link" href="application_configuration.html#using_elytron_client_deployed" title="Using Elytron Client with Clients Deployed to JBoss EAP">Using Elytron Client with Clients Deployed to JBoss EAP</a>
						</li></ul></div><p>
					<code class="literal">AuthenticationConfiguration.empty()</code> should only be used as a base to build a configuration on top of, and should not be used on its own. It provides a configuration that uses the JVM-wide registered providers and enables anonymous authentication.
				</p><p>
					When specifying the providers on top of the <code class="literal">AuthenticationConfiguration.empty()</code> configuration, you can specify a custom list, but most users should use <code class="literal">WildFlyElytronProvider()</code> providers.
				</p><p>
					When creating an authentication context, using the <code class="literal">context.with(…​)</code> will create a new context that merges the rules and authentication configuration from the current context with the provided rule and authentication configuration. The provided rule and authentication configuration will appear after the ones in the current context.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="elytron_client_default_configuration_approach"/>The Default Configuration Approach</h2></div></div></div><p>
					The default configuration approach relies completely on the configuration provided by Elytron Client:
				</p><pre class="programlisting">//create your runnable for establishing a connection
Runnable runnable =
    new Runnable() {
      public void run() {
        try {
           //Establish your connection and do some work
        } catch (Exception e) {
          e.printStackTrace();
        }
      }
    };

// run runnable directly
runnable.run();</pre><p>
					To provide a default configuration, Elytron Client tries to auto-discover a <code class="literal">wildfly-config.xml</code> file on the filesystem. It looks in the following locations:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The location specified by the <code class="literal">wildfly.config.url</code> system property set outside of the client code.
						</li><li class="listitem">
							The classpath root directory.
						</li><li class="listitem">
							The <code class="literal">META-INF</code> directory on the classpath.
						</li><li class="listitem">
							The current user’s home directory.
						</li><li class="listitem">
							The current working directory.
						</li></ul></div><p>
					You can use the following example as the basic configuration for your client <code class="literal">wildfly-config.xml</code> file.
				</p><p><a id="basic_wildfly_config_file"/></p><div class="title"><strong>Basic <code class="literal">wildfly-config.xml</code></strong></div><p>
						
</p><pre class="programlisting">&lt;configuration&gt;
  &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
    &lt;authentication-rules&gt;
      &lt;rule use-configuration="default" /&gt;
    &lt;/authentication-rules&gt;
    &lt;authentication-configurations&gt;
      &lt;configuration name="default"&gt;
        &lt;sasl-mechanism-selector selector="#ALL" /&gt;
        &lt;set-mechanism-properties&gt;
          &lt;property key="wildfly.sasl.local-user.quiet-auth" value="true" /&gt;
        &lt;/set-mechanism-properties&gt;
        &lt;providers&gt;
          &lt;use-service-loader/&gt;
        &lt;/providers&gt;
      &lt;/configuration&gt;
    &lt;/authentication-configurations&gt;
  &lt;/authentication-client&gt;
&lt;/configuration&gt;</pre><p>

					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The <code class="literal">ANONYMOUS</code> mechanism does not support authorization as a <code class="literal">non-anonymous</code> user. This means that <code class="literal">set-authorization-name</code> does not work with <code class="literal">set-anonymous</code> in the Elytron client configuration file. Instead, if you configure the <code class="literal">set-authorization-name</code>, you must also specify a <code class="literal">set-user-name</code> for the authorized identity.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_elytron_client_deployed"/>Using Elytron Client with Clients Deployed to JBoss EAP</h2></div></div></div><p>
					Clients deployed to JBoss EAP can also make use of Elytron Client. The <code class="literal">AuthenticationContext</code> is automatically parsed and created from the <code class="literal">default-authentication-context</code> setting in the JBoss EAP configuration. If the <code class="literal">default-authentication-context</code> is not configured, but you have a <code class="literal">wildfly-config.xml</code> file included with your deployment or set using the <code class="literal">wildfly.config.url</code> system property, the <code class="literal">AuthenticationContext</code> is automatically parsed and created from that file.
				</p><div class="title"><strong>Example: Set the Default Authentication Context</strong></div><p>
						
</p><pre class="screen">/subsystem=elytron/authentication-context=<span class="emphasis"><em>AUTH_CONTEXT</em></span>:add
/subsystem=elytron:write-attribute(name=default-authentication-context,value=<span class="emphasis"><em>AUTH_CONTEXT</em></span>)</pre><p>

					</p><p>
					To load a configuration file outside of the deployment, you can use the <code class="literal">parseAuthenticationClientConfiguration(URI)</code> method. This method returns an <code class="literal">AuthenticationContext</code> that you can then use in your client code using the <a class="link" href="application_configuration.html#elytron_client_programmatic_approach" title="The Programmatic Approach">programmatic approach</a>.
				</p><p>
					Additionally, clients will also automatically parse and create an <code class="literal">AuthenticationContext</code> from the client configuration provided by the <code class="literal">elytron</code> subsystem. The client configuration in the <code class="literal">elytron</code> subsystem can also take advantage of other components defined in the <code class="literal">elytron</code> subsystem, such as credential stores. If the client configuration is provided by both the deployment and the <code class="literal">elytron</code> subsystem, the <code class="literal">elytron</code> subsystem’s configuration is used.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The <code class="literal">AuthenticationContext</code> from the <code class="literal">elytron</code> subsystem can only be used when this <code class="literal">authentication-context</code> is set as the default for the <code class="literal">elytron</code> subsystem.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="client_configuration_jmx_jconsole_using_wildfly_config"/>Configuring a JMX Client Using the wildfly-config.xml File</h2></div></div></div><p>
					Starting in JBoss EAP 7.1, JMX clients, including JConsole, can be configured using the <code class="literal">wildfly-config.xml</code> file. You specify the file path to the configuration file using the <code class="literal">-Dwildfly.config.url</code> system property when starting the JMX client.
				</p><pre class="screen">-Dwildfly.config.url=<span class="emphasis"><em>path/to</em></span>/wildfly-config.xml</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						When using JConsole, the <code class="literal">-Dwildfly.config.url</code> system property must be prefixed with <code class="literal">-J</code>, for example:
					</p><pre class="screen">-J-Dwildfly.config.url=<span class="emphasis"><em>path/to</em></span>/wildfly-config.xml</pre></div><p>
					For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#client_configuration_using_the_wildfly_config_file">Client Configuration Using the <code class="literal">wildfly-config.xml</code> File</a> in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using_the_elytronauthenticator_to_propagate_identities"/>Using the ElytronAuthenticator to Propagate Identities</h2></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Using the <code class="literal">ElytronAuthenticator</code> in JBoss EAP is not supported or recommended due to known credential limitations in Java 8. Be aware of the following limitations when using this class to propagate identities.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Security identity propagation does not work for calls to protected servlets due to Java 8 design limitations.
							</li><li class="listitem">
								Do not use the <code class="literal">ElytronAuthenticator</code> on the server, for example, in EJBs.
							</li><li class="listitem">
								Credentials caching can impact its use in a standalone client JVM.
							</li></ul></div></div><p>
					JBoss EAP 7.1 introduced the <code class="literal">ElytronAuthenticator</code> class, which uses the current security context to perform the authentication. The <a class="link" href="http://wildfly-security.github.io/wildfly-elytron/1.6.x/api-javadoc/org/wildfly/security/auth/util/ElytronAuthenticator.html">org.wildfly.security.auth.util.ElytronAuthenticator</a> class is an implementation of <a class="link" href="https://docs.oracle.com/javase/8/docs/api/java/net/Authenticator.html">java.net.Authenticator</a>.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							It has one constructor, <code class="literal">ElytronAuthenticator()</code>, that constructs a new instance.
						</li><li class="listitem">
							It has one method, <code class="literal">getPasswordAuthentication()</code>, that returns the <a class="link" href="https://docs.oracle.com/javase/8/docs/api/java/net/PasswordAuthentication.html"><code class="literal">PasswordAuthentication</code></a> instance.
						</li></ul></div><p>
					The following is an example of client code that creates and uses the <code class="literal">ElytronAuthenticator</code> class to propagate an identity to the server.
				</p><div class="title"><strong>Example: Code Using the ElytronAuthenticator</strong></div><p>
						
</p><pre class="programlisting">// Create the authentication configuration
AuthenticationConfiguration httpConfig = AuthenticationConfiguration.empty().useName("bob");

// Create the authentication context
AuthenticationContext context = AuthenticationContext.captureCurrent().with(MatchRule.ALL, httpConfig.usePassword(createPassword(httpConfig, "secret")));

String response = context.run((PrivilegedExceptionAction&lt;String&gt;) () -&gt; {
    Authenticator.setDefault(new ElytronAuthenticator());
    HttpURLConnection connection = HttpURLConnection.class.cast(new URL("http://localhost:" + <span class="emphasis"><em>SERVER_PORT</em></span>).openConnection());
    try (InputStream inputStream = connection.getInputStream()) {
        return new BufferedReader(new InputStreamReader(inputStream)).lines().findFirst().orElse(null);
    }
});</pre><p>

					</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_trusted_security_domain_outflows"/>Configuring Trusted Security Domain Outflows</h1></div></div></div><p>
				For any security invocation, a security identity is established for the security domain. As the invocation is handled, the <code class="literal">SecurityIdentity</code> is associated with the current thread. For subsequent calls to <code class="literal">getCurrentSecurityIdentity()</code> on the same security domain, the associated identity is returned.
			</p><p>
				Within the application server, there can be multiple <code class="literal">SecurityDomain</code> instances for a single invocation or thread. Each <code class="literal">SecurityDomain</code> instance can be associated with a different <code class="literal">SecurityIdentity</code>. The correct security identity is returned when you call that security domain’s <code class="literal">getCurrentSecurityIdentity()</code> method. Deployments can invoke other deployments during request handling. Each deployment is associated with a single security domain. If the invoked deployments use the same security domain, then the notion of a single security domain with a current security identity remains. However, each deployment can reference its own security domain.
			</p><p>
				It is possible to import a security identity that is associated with a security domain into another security domain, as described in the next section.
			</p><h3><a id="importing_a_security_identity"/>Importing a Security Identity</h3><p>
				To import a security identity from a security domain into another security domain to obtain a security identity for this domain, there are predominantly three processing flows.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Same Security Domain</span></dt><dd>
							A security domain can always import its own security identities. In this case, the security domain always trusts itself.
						</dd><dt><span class="term">Common Security Realm</span></dt><dd>
							During the import process, the security domain takes the principal from the security identity being imported, passes it through its configured principal transformers and realm mappers, and maps it to an identity within that security domain. If the same security realm is used within the security domain as was used in the security domain that created the identity, both are backed by the same underlying identity and the import is accepted.
						</dd><dt><span class="term">Trusted Security Domain</span></dt><dd>
							If the identity is successfully mapped but there is no common security realm, the security domain handling the import is tested to see if it trusts the original security domain. If it does, the import is accepted.
						</dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The identity must exist in the security domain handling the import. The security identity is never trusted in its entirety.
				</p></div><h3><a id="outflow"/>Outflow</h3><p>
				A security domain can be configured to automatically outflow its security identities to a different security domain.
			</p><p>
				In the security domain, if the security identity is established and used for the current invocation, the list of outflow security domains is iterated and the security identity is imported for each of them.
			</p><p>
				This model is more appropriate where multiple invocations to a deployment using a different security domain are likely to occur, for example, when a web application calls five different EJBs using a common security domain.
			</p></div></div></body></html>