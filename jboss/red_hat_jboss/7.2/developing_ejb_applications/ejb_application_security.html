<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. EJB Application Security</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ejb_application_security"/>Chapter 6. EJB Application Security</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="security_identity"/>Security Identity</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about_ejb_security_identity"/>About EJB Security Identity</h2></div></div></div><p>
					An EJB can specify an identity to use when invoking methods on other components. This is the EJB security identity, also known as invocation identity.
				</p><p>
					By default, the EJB uses its own caller identity. The identity can alternatively be set to a specific security role. Using specific security roles is useful when you want to construct a segmented security model, for example, restricting access to a set of components to internal EJBs only.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="set_the_security_identity_of_an_ejb"/>Set the Security Identity of an EJB</h2></div></div></div><p>
					The security identity of the EJB is specified through the <code class="literal">&lt;security-identity&gt;</code> tag in the security configuration. If no <code class="literal">&lt;security-identity&gt;</code> tag is present, the caller identity of the EJB is used by default.
				</p><div class="title"><strong>Example: Set the Security Identity of an EJB to Be the Same as Its Caller</strong></div><p>
						This example sets the security identity for method invocations made by an EJB to be the same as the current caller’s identity. This behavior is the default if you do not specify a <code class="literal">&lt;security-identity&gt;</code> element declaration.
					</p><pre class="programlisting">&lt;ejb-jar&gt;
  &lt;enterprise-beans&gt;
     &lt;session&gt;
        &lt;ejb-name&gt;ASessionBean&lt;/ejb-name&gt;
        ...
        &lt;security-identity&gt;
          &lt;use-caller-identity/&gt;
        &lt;/security-identity&gt;
     &lt;/session&gt;
     ...
  &lt;/enterprise-beans&gt;
&lt;/ejb-jar&gt;</pre><div class="title"><strong>Example: Set the Security Identity of an EJB to a Specific Role</strong></div><p>
						To set the security identity to a specific role, use the <code class="literal">&lt;run-as&gt;</code> and <code class="literal">&lt;role-name&gt;</code> tags inside the <code class="literal">&lt;security-identity&gt;</code> tag.
					</p><pre class="programlisting">&lt;ejb-jar&gt;
  &lt;enterprise-beans&gt;
     &lt;session&gt;
        &lt;ejb-name&gt;RunAsBean&lt;/ejb-name&gt;
        ...
        &lt;security-identity&gt;
          &lt;run-as&gt;
             &lt;description&gt;A private internal role&lt;/description&gt;
             &lt;role-name&gt;InternalRole&lt;/role-name&gt;
          &lt;/run-as&gt;
        &lt;/security-identity&gt;
     &lt;/session&gt;
  &lt;/enterprise-beans&gt;
  ...
&lt;/ejb-jar&gt;</pre><p>
					By default, when you use <code class="literal">&lt;run-as&gt;</code>, a principal named <code class="literal">anonymous</code> is assigned to outgoing calls. To assign a different principal, uses the <code class="literal">&lt;run-as-principal&gt;</code>.
				</p><pre class="programlisting">&lt;session&gt;
    &lt;ejb-name&gt;RunAsBean&lt;/ejb-name&gt;
    &lt;security-identity&gt;
        &lt;run-as-principal&gt;internal&lt;/run-as-principal&gt;
    &lt;/security-identity&gt;
&lt;/session&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						You can also use the <code class="literal">&lt;run-as&gt;</code> and <code class="literal">&lt;run-as-principal&gt;</code> elements inside a servlet element.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ejb_method_permissions"/>EJB Method Permissions</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about_ejb_method_permissions"/>About EJB Method Permissions</h2></div></div></div><p>
					EJBs can restrict access to their methods to specific security roles.
				</p><p>
					The EJB <code class="literal">&lt;method-permission&gt;</code> element declaration specifies the roles that can invoke the interface methods of the EJB. You can specify permissions for the following combinations:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							All home and component interface methods of the named EJB
						</li><li class="listitem">
							A specified method of the home or component interface of the named EJB
						</li><li class="listitem">
							A specified method within a set of methods with an overloaded name
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="use_ejb_method_permissions"/>Use EJB Method Permissions</h2></div></div></div><p>
					The <code class="literal">&lt;method-permission&gt;</code> element defines the logical roles that are allowed to access the EJB methods defined by <code class="literal">&lt;method&gt;</code> elements. Several examples demonstrate the syntax of the xml. Multiple method permission statements may be present, and they have a cumulative effect. The <code class="literal">&lt;method-permission&gt;</code> element is a child of the <code class="literal">&lt;assembly-descriptor&gt;</code> element of the <code class="literal">&lt;ejb-jar&gt;</code> descriptor.
				</p><p>
					The XML syntax is an alternative to using annotations for EJB method permissions.
				</p><div class="title"><strong>Example: Allow Roles to Access All Methods of an EJB</strong></div><p>
						
</p><pre class="programlisting">&lt;method-permission&gt;
  &lt;description&gt;The employee and temp-employee roles may access any method
  of the EmployeeService bean &lt;/description&gt;
  &lt;role-name&gt;employee&lt;/role-name&gt;
  &lt;role-name&gt;temp-employee&lt;/role-name&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
    &lt;method-name&gt;*&lt;/method-name&gt;
  &lt;/method&gt;
&lt;/method-permission&gt;</pre><p>

					</p><div class="title"><strong>Example: Allow Roles to Access Certain Methods of an EJB and Limit Method Parameters</strong></div><p>
						
</p><pre class="programlisting">&lt;method-permission&gt;
  &lt;description&gt;The employee role may access the findByPrimaryKey,
  getEmployeeInfo, and the updateEmployeeInfo(String) method of
  the AcmePayroll bean &lt;/description&gt;
  &lt;role-name&gt;employee&lt;/role-name&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
    &lt;method-name&gt;findByPrimaryKey&lt;/method-name&gt;
  &lt;/method&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
    &lt;method-name&gt;getEmployeeInfo&lt;/method-name&gt;
  &lt;/method&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
    &lt;method-name&gt;updateEmployeeInfo&lt;/method-name&gt;
    &lt;method-params&gt;
      &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
    &lt;/method-params&gt;
  &lt;/method&gt;
&lt;/method-permission&gt;</pre><p>

					</p><div class="title"><strong>Example: Allow Any Authenticated User to Access Methods of EJBs</strong></div><p>
						Using the <code class="literal">&lt;unchecked/&gt;</code> element allows any authenticated user to use the specified methods.
					</p><pre class="programlisting">&lt;method-permission&gt;
  &lt;description&gt;Any authenticated user may access any method of the
  EmployeeServiceHelp bean&lt;/description&gt;
  &lt;unchecked/&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;EmployeeServiceHelp&lt;/ejb-name&gt;
    &lt;method-name&gt;*&lt;/method-name&gt;
  &lt;/method&gt;
&lt;/method-permission&gt;</pre><div class="title"><strong>Example: Completely Exclude Specific EJB Methods</strong></div><p>
						
</p><pre class="programlisting">&lt;exclude-list&gt;
  &lt;description&gt;No fireTheCTO methods of the EmployeeFiring bean may be
  used in this deployment&lt;/description&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;EmployeeFiring&lt;/ejb-name&gt;
    &lt;method-name&gt;fireTheCTO&lt;/method-name&gt;
  &lt;/method&gt;
&lt;/exclude-list&gt;</pre><p>

					</p><div class="title"><strong>Example: A Complete <code class="literal">&lt;assembly-descriptor&gt;</code> Containing Several <code class="literal">&lt;method-permission&gt;</code> Blocks</strong></div><p>
						
</p><pre class="programlisting">&lt;ejb-jar&gt;
    &lt;assembly-descriptor&gt;
        &lt;method-permission&gt;
            &lt;description&gt;The employee and temp-employee roles may access any method of the EmployeeService bean &lt;/description&gt;
            &lt;role-name&gt;employee&lt;/role-name&gt;
            &lt;role-name&gt;temp-employee&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;method-permission&gt;
            &lt;description&gt;The employee role may access the findByPrimaryKey, getEmployeeInfo, and the updateEmployeeInfo(String) method of the AcmePayroll bean &lt;/description&gt;
            &lt;role-name&gt;employee&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
                &lt;method-name&gt;findByPrimaryKey&lt;/method-name&gt;
            &lt;/method&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
                &lt;method-name&gt;getEmployeeInfo&lt;/method-name&gt;
            &lt;/method&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
                &lt;method-name&gt;updateEmployeeInfo&lt;/method-name&gt;
                &lt;method-params&gt;
                    &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
                &lt;/method-params&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;method-permission&gt;
            &lt;description&gt;The admin role may access any method of the EmployeeServiceAdmin bean &lt;/description&gt;
            &lt;role-name&gt;admin&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeServiceAdmin&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;method-permission&gt;
            &lt;description&gt;Any authenticated user may access any method of the EmployeeServiceHelp bean&lt;/description&gt;
            &lt;unchecked/&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeServiceHelp&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;exclude-list&gt;
            &lt;description&gt;No fireTheCTO methods of the EmployeeFiring bean may be used in this deployment&lt;/description&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeFiring&lt;/ejb-name&gt;
                &lt;method-name&gt;fireTheCTO&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/exclude-list&gt;
    &lt;/assembly-descriptor&gt;
&lt;/ejb-jar&gt;</pre><p>

					</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ejb_security_annotations"/>EJB Security Annotations</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about_ejb_security_annotations"/>About EJB Security Annotations</h2></div></div></div><p>
					EJB <code class="literal">javax.annotation.security</code> annotations are defined in <a class="link" href="https://jcp.org/en/jsr/detail?id=250">JSR-250</a>.
				</p><p>
					EJBs use security annotations to pass information about security to the deployer. These include:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">@DeclareRoles</span></dt><dd>
								Declares which roles are available.
							</dd><dt><span class="term">@RunAs</span></dt><dd>
								Configures the propagated security identity of a component.
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="use_ejb_security_annotations"/>Use EJB Security Annotations</h2></div></div></div><p>
					You can use either XML descriptors or annotations to control which security roles are able to call methods in your Enterprise JavaBeans (EJBs). For information on using XML descriptors, see <a class="link" href="ejb_application_security.html#use_ejb_method_permissions" title="Use EJB Method Permissions">Use EJB Method Permissions</a>.
				</p><p>
					Any method values explicitly specified in the deployment descriptor override annotation values. If a method value is not specified in the deployment descriptor, those values set using annotations are used. The overriding granularity is on a per-method basis.
				</p><div class="variablelist"><p class="title"><strong>Annotations for Controlling Security Permissions of EJBs</strong></p><dl class="variablelist"><dt><span class="term">@DeclareRoles</span></dt><dd>
								Use <code class="literal">@DeclareRoles</code> to define which security roles to check permissions against. If no <code class="literal">@DeclareRoles</code> is present, the list is built automatically from the <code class="literal">@RolesAllowed</code> annotation. For information about configuring roles, see the Java EE tutorial <a class="link" href="https://javaee.github.io/tutorial/security-javaee002.html#specifying-authorized-users-by-declaring-security-roles">Specifying Authorized Users by Declaring Security Roles</a>.
							</dd><dt><span class="term">@RolesAllowed, @PermitAll, @DenyAll</span></dt><dd>
								Use <code class="literal">@RolesAllowed</code> to list which roles are allowed to access a method or methods. Use <code class="literal">@PermitAll</code> or <code class="literal">@DenyAll</code> to either permit or deny all roles from using a method or methods. For information about configuring annotation method permissions, see the Java EE tutorial <a class="link" href="https://javaee.github.io/tutorial/security-javaee002.html#specifying-authorized-users-by-declaring-security-roles">Specifying Authorized Users by Declaring Security Roles</a>.
							</dd><dt><span class="term">@RunAs</span></dt><dd>
								Use <code class="literal">@RunAs</code> to specify a role a method uses when making calls from the annotated method. For information about configuring propagated security identities using annotations, see the Java EE tutorial <a class="link" href="https://javaee.github.io/tutorial/security-javaee002.html#propagating-a-security-identity-run-as">Propagating a Security Identity (Run-As)</a>.
							</dd></dl></div><div class="title"><strong>Example: Security Annotations Example</strong></div><p>
						
</p><pre class="programlisting">@Stateless
@RolesAllowed({"admin"})
@SecurityDomain("other")
public class WelcomeEJB implements Welcome {
    @PermitAll
    public String WelcomeEveryone(String msg) {
        return "Welcome to " + msg;
    }
    @RunAs("tempemployee")
    public String GoodBye(String msg) {
        return "Goodbye, " + msg;
    }
    public String GoodbyeAdmin(String msg) {
        return "See you later, " + msg;
    }
}</pre><p>

					</p><p>
					In this code, all roles can access method <code class="literal">WelcomeEveryone</code>. The <code class="literal">GoodBye</code> method uses the <code class="literal">tempemployee</code> role when making calls. Only the <code class="literal">admin</code> role can access method <code class="literal">GoodbyeAdmin</code>, and any other methods with no security annotation.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="remote_access_to_ejbs"/>Remote Access to EJBs</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="use_security_realms_with_remote_ejb_clients"/>Use Security Realms with Remote EJB Clients</h2></div></div></div><p>
					One way to add security to clients which invoke EJBs remotely is to use security realms. A security realm is a simple database of username/password pairs and username/role pairs. The terminology is also used in the context of web containers, with a slightly different meaning.
				</p><p>
					To authenticate a specific username/password pair that exists in a security realm against an EJB, follow these steps:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Add a new security realm to the domain controller or standalone server.
						</li><li class="listitem"><p class="simpara">
							Configure the <code class="literal">wildfly-config.xml</code> file, which is located in the class path of the application, as shown in the following example:
						</p><pre class="programlisting">&lt;configuration&gt;
   &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
      &lt;authentication-rules&gt;
         &lt;rule use-configuration="default" /&gt;
      &lt;/authentication-rules&gt;
      &lt;authentication-configurations&gt;
         &lt;configuration name="default"&gt;
            &lt;sasl-mechanism-selector selector="DIGEST-MD5" /&gt;
            &lt;set-user-name name="admin" /&gt;
            &lt;credentials&gt;
               &lt;clear-password password="password123!" /&gt;
            &lt;/credentials&gt;
         &lt;/configuration&gt;
      &lt;/authentication-configurations&gt;
   &lt;/authentication-client&gt;
   &lt;jboss-ejb-client xmlns="urn:jboss:wildfly-client-ejb:3.0"&gt;
      &lt;connections&gt;
         &lt;connection uri="remote+http://127.0.0.1:8080" /&gt;
      &lt;/connections&gt;
   &lt;/jboss-ejb-client&gt;
&lt;/configuration&gt;</pre></li><li class="listitem">
							Create a custom remoting connector on the domain or standalone server that uses your new security realm.
						</li><li class="listitem">
							Deploy your EJB to the server group which is configured to use the profile with the custom Remoting connector, or to your standalone server if you are not using a managed domain.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="add_a_new_security_realm"/>Add a New Security Realm</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Run the management CLI:
						</p><p class="simpara">
							Execute the <code class="literal">jboss-cli.sh</code> or <code class="literal">jboss-cli.bat</code> script and connect to the server.
						</p></li><li class="listitem"><p class="simpara">
							Create the new security realm itself:
						</p><p class="simpara">
							Run the following command to create a new security realm named <code class="literal">MyDomainRealm</code> on a domain controller or a standalone server.
						</p><p class="simpara">
							For a domain instance, use this command:
						</p><pre class="screen">/host=master/core-service=management/security-realm=MyDomainRealm:add()</pre><p class="simpara">
							For a standalone instance, use this command:
						</p><pre class="screen">/core-service=management/security-realm=MyDomainRealm:add()</pre></li><li class="listitem"><p class="simpara">
							Create a properties file named <code class="literal">myfile.properties</code>:
						</p><p class="simpara">
							For a standalone instance, create a file <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/myfile.properties</code> and for a domain instance, create a file <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/domain/configuration/myfile.properties</code>. These files need to have read and write access for the file owner.
						</p><pre class="screen">$ chmod 600 myfile.properties</pre></li><li class="listitem"><p class="simpara">
							Create the references to the properties file which will store information about the new role:
						</p><p class="simpara">
							Run the following command to create a pointer to the <code class="literal">myfile.properties</code> file, which will contain the properties pertaining to the new role.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The properties file will not be created by the included <code class="literal">add-user.sh</code> and <code class="literal">add-user.bat</code> scripts. It must be created externally.
							</p></div><p class="simpara">
							For a domain instance, use this command:
						</p><pre class="screen">/host=master/core-service=management/security-realm=MyDomainRealm/authentication=properties:add(path=myfile.properties)</pre><p class="simpara">
							For a standalone instance, use this command:
						</p><pre class="screen">/core-service=management/security-realm=MyDomainRealm/authentication=properties:add(path=myfile.properties)</pre></li></ol></div><p>
					Your new security realm is created. When you add users and roles to this new realm, the information will be stored in a separate file from the default security realms. You can manage this new file using your own applications or procedures.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						When using the <code class="literal">add-user.sh</code> script to add a user to a non-default file, other than <code class="literal">application-users.properties</code>, you have to pass it the argument <code class="literal">--user-properties myfile.properties</code> otherwise it will try to use <code class="literal">application-users.properties</code>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="add_a_user_to_a_security_realm"/>Add a User to a Security Realm</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Run the <code class="literal">add-user</code> script. Open a terminal and change directories to the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> directory. If you are on Red Hat Enterprise Linux or any other UNIX-like operating system, run <code class="literal">add-user.sh</code>. If you are on Windows Server, run <code class="literal">add-user.bat</code>.
						</li><li class="listitem">
							Choose whether to add a management user or application user. For this procedure, type <code class="literal">b</code> to add an application user.
						</li><li class="listitem">
							Choose the realm the user will be added to. By default, the only available realm is <code class="literal">ApplicationRealm</code>. If you have added a custom realm, you may add the user to that instead.
						</li><li class="listitem">
							Type the username, password, and roles, when prompted. Type the desired username, password, and optional roles when prompted. Verify your choice by typing <code class="literal">yes</code>, or type <code class="literal">no</code> to cancel the changes. The changes are written to each of the properties files for the security realm.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assigning_security_realm_to_ejb"/>Relationship Between Security Domains and Security Realms</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						For EJBs to be secured by security realms, they have to use a security domain which is configured to retrieve user credentials from the security realm. This means that the domain needs to contain the Remoting and RealmDirect login modules. Assigning a security domain is done by the <code class="literal">@SecurityDomain</code> annotation, which can be applied on an EJB.
					</p></div><p>
					The <code class="literal">other</code> security domain retrieves the user and password data from the underlying security realm. This security domain is the default one if there is no <code class="literal">@SecurityDomain</code> annotation on the EJB but the EJB contains any of the other security-related annotations to be considered secured.
				</p><p>
					The underlying <code class="literal">http-remoting connector</code>, which is used by the client to establish a connection, decides which security realm is used. For more information on <code class="literal">http-remoting connector</code>, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#about_the_remoting_subsystem">About the Remoting Subsystem</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p><p>
					The security realm of the default connector can be changed this way:
				</p><pre class="screen">/subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=security-realm,value=MyDomainRealm)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about_remote_ejb_access_using_ssl_encryption"/>About Remote EJB Access Using SSL Encryption</h2></div></div></div><p>
					By default, the network traffic for Remote Method Invocation (RMI) of EJB2 and EJB3 Beans is not encrypted. In instances where encryption is required, Secure Sockets Layer (SSL) can be utilized so that the connection between the client and server is encrypted. Using SSL also has the added benefit of allowing the network traffic to traverse some firewalls, depending on the firewall configuration.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_integration_ejb_subsystem"/>Elytron Integration with the EJB Subsystem</h1></div></div></div><p>
				Starting with JBoss EAP 7.1, it is possible to map deployments so that their security is handled by the <code class="literal">elytron</code> subsystem. If a deployment references a mapped security domain, its security will be handled by Elytron, otherwise its security will be handled by the legacy security subsystem. This mapping is defined in the <code class="literal">ejb</code> subsystem.
			</p><p>
				Within the <code class="literal">ejb</code> subsystem, mappings are created from a security domain name, as referenced within a deployment, to a referenced Elytron security-domain. When a mapped security domain name is configured for a bean in a deployment, this indicates that security should be handled by Elytron. New EJB security interceptors are set up instead of the existing ones.
			</p><p>
				The new EJB security interceptors make use of the Elytron <code class="literal">SecurityDomain</code> associated with the invocation to obtain the current <code class="literal">SecurityIdentity</code> and perform the following tasks:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Establish the <code class="literal">run-as</code> principal.
					</li><li class="listitem">
						Create any extra roles for the <code class="literal">run-as</code> principal.
					</li><li class="listitem">
						Create the <code class="literal">run-as</code> roles.
					</li><li class="listitem">
						Make authorization decisions.
					</li></ul></div><p>
				JBoss EAP 7.1 introduced a new management resource in the <code class="literal">ejb</code> subsystem, <code class="literal">application-security-domains</code>. The <code class="literal">application-security-domains</code> element contains the application security domains that should be mapped to an Elytron security domain.
			</p><div class="table"><a id="idm140362811660384"/><p class="title"><strong>Table 6.1. Attributes of the application-security-domain</strong></p><div class="table-contents"><table summary="Attributes of the application-security-domain" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">name</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This attribute refers to the name of the security domain as specified in a deployment.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">security-domain</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This attribute is a reference to the Elytron security domain that should be used.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">enable-jacc</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This attribute enables authorization using JACC.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">referencing-deployments</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This is a runtime attribute that lists all deployments currently referencing the ASD.
							</p>
							 </td></tr></tbody></table></div></div><p>
				You can configure the <code class="literal">application-security-domain</code> in the <code class="literal">ejb</code> subsystem in either of the following ways. You can <a class="link" href="ejb_application_security.html#configure_the_application_security_domain_using_the_management_console" title="Configure the Application Security Domain Using the Management Console">use the management console</a>, or you can <a class="link" href="ejb_application_security.html#configure_the_application_security_domain_using_the_management_cli" title="Configure the Application Security Domain Using the Management CLI">use the management CLI</a>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_the_application_security_domain_using_the_management_console"/>Configure the Application Security Domain Using the Management Console</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Access the management console. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">Management Console</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li><li class="listitem">
							Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>EJB</strong></span> and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select the <span class="strong"><strong>Security Domain</strong></span> tab and configure application security domains as necessary.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_the_application_security_domain_using_the_management_cli"/>Configure the Application Security Domain Using the Management CLI</h2></div></div></div><p>
					In the following example, <code class="literal">MyAppSecurity</code> is a security domain that is referenced in the deployment and <code class="literal">ApplicationDomain</code> is an Elytron security domain that has been configured in the <code class="literal">elytron</code> subsystem.
				</p><pre class="screen">/subsystem=ejb3/application-security-domain=MyAppSecurity:add(security-domain=ApplicationDomain)</pre><p>
					The following XML is added to the <code class="literal">ejb</code> subsystem of the server configuration file as a result of this command.
				</p><pre class="programlisting">&lt;application-security-domains&gt;
    &lt;application-security-domain name="MyAppSecurity" security-domain="ApplicationDomain"/&gt;
&lt;/application-security-domains&gt;</pre><p>
					See the <code class="literal">ejb-security</code> quickstart that ships with JBoss EAP for a simple working example of an EJB that uses Elytron to handle security.
				</p></div></div></div></body></html>