<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 4. Server Configuration Changes</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="server_configuration_changes"/>Chapter 4. Server Configuration Changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="rpm_installation_changes"/>RPM Installation Changes</h1></div></div></div><p>
				In JBoss EAP 6, the default path for the RPM installation was the <code class="literal">/usr/share/jbossas/</code> directory.
			</p><p>
				JBoss EAP 7 was built to <a class="link" href="https://access.redhat.com/documentation/en-US/Red_Hat_Developer_Toolset/1/html-single/Software_Collections_Guide/index.html#sect-The_File_System_Hierarchy">Software Collections Library</a> conventions. The root directory of Software Collections is normally located in the <code class="literal">/opt/</code> directory to avoid possible conflicts between Software Collections and the base system installation. The use of the <code class="literal">/opt/</code> directory is recommended by the Filesystem Hierarchy Standard (FHS). As a result, the default path for the RPM installation has changed to <code class="literal">/opt/rh/eap7/root/usr/share/wildfly/</code> in JBoss EAP 7.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_server_configuration_migration_options"/>Server Configuration Migration Options</h1></div></div></div><p>
				To migrate your server configuration from JBoss EAP 6 to JBoss EAP 7, you can either use the <a class="link" href="server_configuration_changes.html#migrate_server_migration_tool_option" title="JBoss Server Migration Tool">JBoss Server Migration Tool</a> or you can perform a manual migration with the help of the <a class="link" href="server_configuration_changes.html#migrate__migrate_operation_option" title="Management CLI Migrate Operation">management CLI <code class="literal">migrate</code> operation</a>.
			</p><h3><a id="migrate_server_migration_tool_option"/>JBoss Server Migration Tool</h3><p>
				The JBoss Server Migration Tool is the preferred method to update your configuration to include the new features and settings in JBoss EAP 7 while keeping your existing configuration. For information about how to configure and run the tool, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/using_the_jboss_server_migration_tool">Using the JBoss Server Migration Tool</a>.
			</p><h3><a id="migrate__migrate_operation_option"/>Management CLI Migrate Operation</h3><p>
				You can use the management CLI <code class="literal">migrate</code> operation to update the <code class="literal">jacorb</code>, <code class="literal">messaging</code>, and <code class="literal">web</code> subsystems in the JBoss EAP 6 server configuration file to allow them run on the new release, but be aware that the result is not a complete JBoss EAP 7 configuration. For example:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The operation does not update the original <code class="literal">remote</code> protocol and port settings to the new <code class="literal">http-remoting</code> and new port settings now used in JBoss EAP 7.
					</li><li class="listitem">
						The configuration does not include the new JBoss EAP subsystems or features such as clustered singleton deployments, or graceful shutdown.
					</li><li class="listitem">
						The configuration does not include the new Java EE 7 features such as batch processing.
					</li><li class="listitem">
						The <code class="literal">migrate</code> operation does not migrate the <code class="literal">ejb3</code> subsystem configuration. For information about possible EJB migration issues, see <a class="link" href="server_configuration_changes.html#migrate_ejb_server_configuration_changes" title="EJB Server Configuration Changes">EJB Server Configuration Changes</a>.
					</li></ul></div><p>
				For more information about using the <code class="literal">migrate</code> operation to migration the server configuration, see <a class="link" href="server_configuration_changes.html#management_cli_migration_operation" title="Management CLI Migration Operation">Management CLI Migration Operation</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="management_cli_migration_operation"/>Management CLI Migration Operation</h1></div></div></div><p>
				You can use the management CLI to update your JBoss EAP 6 server configuration files to run on JBoss EAP 7. The management CLI provides a <code class="literal">migrate</code> operation to automatically update the <code class="literal">jacorb</code>, <code class="literal">messaging</code>, and <code class="literal">web</code> subsystems from the previous release to the new configuration. You can also execute the <code class="literal">describe-migration</code> operation for the <code class="literal">jacorb</code>, <code class="literal">messaging</code>, and <code class="literal">web</code> subsystems to review the proposed migration configuration changes before you perform the migration. There are no replacements for the <code class="literal">cmp</code>, <code class="literal">jaxr</code>, or <code class="literal">threads</code> subsystems and they must be removed from the server configuration.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					See <a class="link" href="server_configuration_changes.html#migrate_server_configuration_migration_options" title="Server Configuration Migration Options">Server Configuration Migration Options</a> for limitations of the <code class="literal">migrate</code> operation. The JBoss Server Migration Tool is the preferred method to update your configuration to include the new features and settings in JBoss EAP 7 while keeping your existing configuration. For information about how to configure and run the tool, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/using_the_jboss_server_migration_tool">Using the JBoss Server Migration Tool</a>.
				</p></div><div class="table"><a id="idm139952488424624"/><p class="title"><strong>Table 4.1. Subsystem Migration and Management CLI Operation</strong></p><div class="table-contents"><table summary="Subsystem Migration and Management CLI Operation" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">JBoss EAP 6 Subsystem</th><th style="text-align: left" valign="top">JBoss EAP 7 Subsystem</th><th style="text-align: left" valign="top">Management CLI Operation</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								cmp
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								no replacement
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								remove
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								jacorb
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								iiop-openjdk
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								migrate
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								jaxr
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								no replacement
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								remove
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								messaging
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								messaging-activemq
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								migrate
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								no replacement
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								remove
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								web
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								undertow
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								migrate
							</p>
							 </td></tr></tbody></table></div></div><h3><a id="migrate_start_the_server_and_the_management_cli"/>Start the Server and the Management CLI</h3><p>
				Follow the steps below to update your JBoss EAP 6 server configuration to run on JBoss EAP 7.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						Before you begin, review <a class="link" href="prepare_for_migration.html#migrate_back_up_important_data_and_review_server_state" title="Back Up Important Data and Review Server State">Back Up Important Data and Review Server State</a>. It contains important information about making sure the server is in a good state and the appropriate files are backed up.
					</li><li class="listitem"><p class="simpara">
						Start the JBoss EAP 7 server with the JBoss EAP 6 configuration.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Back up the JBoss EAP 7 server configuration files.
							</li><li class="listitem"><p class="simpara">
								Copy the configuration file from the previous release into the JBoss EAP 7 directory.
							</p><pre class="screen">$ cp <span class="emphasis"><em>EAP6_HOME</em></span>/standalone/configuration/standalone-full.xml <span class="emphasis"><em>EAP7_HOME</em></span>/standalone/configuration</pre></li><li class="listitem"><p class="simpara">
								Navigate to the JBoss EAP 7 install directory and start the server with the <code class="literal">--start-mode=admin-only</code> argument.
							</p><pre class="screen">$ bin/standalone.sh -c standalone-full.xml --start-mode=admin-only</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									You will see the following <code class="literal">org.jboss.as.controller.management-operation</code> ERRORS in the server log when you start the server. These errors are expected and indicate that the legacy subsystem configurations must be removed or migrated to JBoss EAP 7.
								</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
											WFLYCTL0402: Subsystems [cmp] provided by legacy extension 'org.jboss.as.cmp' are not supported on servers running this version. Both the subsystem and the extension must be removed or migrated before the server will function.
										</li><li class="listitem">
											WFLYCTL0402: Subsystems [jacorb] provided by legacy extension 'org.jboss.as.jacorb' are not supported on servers running this version. Both the subsystem and the extension must be removed or migrated before the server will function.
										</li><li class="listitem">
											WFLYCTL0402: Subsystems [jaxr] provided by legacy extension 'org.jboss.as.jaxr' are not supported on servers running this version. Both the subsystem and the extension must be removed or migrated before the server will function.
										</li><li class="listitem">
											WFLYCTL0402: Subsystems [messaging] provided by legacy extension 'org.jboss.as.messaging' are not supported on servers running this version. Both the subsystem and the extension must be removed or migrated before the server will function.
										</li><li class="listitem">
											WFLYCTL0402: Subsystems [threads] provided by legacy extension 'org.jboss.as.threads' are not supported on servers running this version. Both the subsystem and the extension must be removed or migrated before the server will function.
										</li><li class="listitem">
											WFLYCTL0402: Subsystems [web] provided by legacy extension 'org.jboss.as.web' are not supported on servers running this version. Both the subsystem and the extension must be removed or migrated before the server will function.
										</li></ul></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Open a new terminal, navigate to the JBoss EAP 7 install directory, and start the management CLI using the <code class="literal">--controller=remote://localhost:9999</code> arguments.
					</p><pre class="screen">$ bin/jboss-cli.sh --connect --controller=remote://localhost:9999</pre></li></ol></div><h3><a id="migrate_the_jacorb_messaging_and_web_subsystems"/>Migrate the JacORB, Messaging, and Web Subsystems</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To review the configuration changes that will be made to the subsystem before you perform the migration, execute the <code class="literal">describe-migration</code> operation.
					</p><p class="simpara">
						The <code class="literal">describe-migration</code> operation uses the following syntax.
					</p><pre class="screen">/subsystem=<span class="emphasis"><em>SUBSYSTEM_NAME</em></span>:describe-migration</pre><p class="simpara">
						The following example describes the configuration changes that are made to the JBoss EAP 6.4 <code class="literal">standalone-full.xml</code> configuration file when it is migrated to JBoss EAP 7. Entries were removed from the output to improve readability and to save space.
					</p><div class="title"><strong>Example: describe-migration Operation</strong></div><p>
							
</p><pre class="screen">/subsystem=messaging:describe-migration
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "migration-warnings" =&gt; [],
        "migration-operations" =&gt; [
            {
                "operation" =&gt; "add",
                "address" =&gt; [("extension" =&gt; "org.wildfly.extension.messaging-activemq")],
                "module" =&gt; "org.wildfly.extension.messaging-activemq"
            },
            {
                "operation" =&gt; "add",
                "address" =&gt; [("subsystem" =&gt; "messaging-activemq")]
            },
            &lt;!-- *** Entries removed for readability *** --&gt;
            {
                "operation" =&gt; "remove",
                "address" =&gt; [("subsystem" =&gt; "messaging")]
            },
            {
                "operation" =&gt; "remove",
                "address" =&gt; [("extension" =&gt; "org.jboss.as.messaging")]
            }
        ]
    }
}</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Execute the <code class="literal">migrate</code> operation to migrate the subsystem configuration to the subsystem that replaces it in JBoss EAP 7. The operation uses the following syntax.
					</p><pre class="screen">/subsystem=<span class="emphasis"><em>SUBSYSTEM_NAME</em></span>:migrate</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The <code class="literal">messaging</code> subsystem <code class="literal">describe-migration</code> and <code class="literal">migrate</code> operations allow you to pass an argument to configure access by legacy clients. For more information about the command syntax, see <a class="link" href="server_configuration_changes.html#migrate_messaging_subsystem_forward_compatibility" title="Messaging Subsystem Migration and Forward Compatibility">Messaging Subsystem Migration and Forward Compatibility</a>.
						</p></div></li><li class="listitem"><p class="simpara">
						Review the outcome and result of the command. Be sure the operation completed successfully and there are no "migration-warning" entries. This means the migration configuration for the subsystem is complete.
					</p><div class="title"><strong>Example: Successful migrate Operation with No Warnings</strong></div><p>
							
</p><pre class="screen">/subsystem=messaging:migrate
{
    "outcome" =&gt; "success",
    "result" =&gt; {"migration-warnings" =&gt; []}
}</pre><p>

						</p><p class="simpara">
						If you see "migration-warnings" entries in the log, this indicates the migration of the server configuration completed successfully but it was not able to migrate all of elements and attributes. You must follow the suggestions provided by the "migration-warnings" and run additional management CLI commands to modify those configurations. The following is an example of a <code class="literal">migrate</code> operation that returns "migration-warnings".
					</p><div class="title"><strong>Example: migrate Operation with Warnings</strong></div><p>
							
</p><pre class="screen">/subsystem=messaging:migrate
{
    "outcome" =&gt; "success",
    "result" =&gt; {"migration-warnings" =&gt; [
        "WFLYMSG0080: Could not migrate attribute group-address from resource [
    (\"subsystem\" =&gt; \"messaging-activemq\"),
    (\"server\" =&gt; \"default\"),
    (\"broadcast-group\" =&gt; \"groupB\")
]. Use instead the socket-binding attribute to configure this broadcast-group.",
        "WFLYMSG0080: Could not migrate attribute group-port from resource [
    (\"subsystem\" =&gt; \"messaging-activemq\"),
    (\"server\" =&gt; \"default\"),
    (\"broadcast-group\" =&gt; \"groupB\")
]. Use instead the socket-binding attribute to configure this broadcast-group.",
        "WFLYMSG0080: Could not migrate attribute local-bind-address from resource [
    (\"subsystem\" =&gt; \"messaging-activemq\"),
    (\"server\" =&gt; \"default\"),
    (\"broadcast-group\" =&gt; \"groupA\")
]. Use instead the socket-binding attribute to configure this broadcast-group.",
        "WFLYMSG0080: Could not migrate attribute local-bind-port from resource [
    (\"subsystem\" =&gt; \"messaging-activemq\"),
    (\"server\" =&gt; \"default\"),
    (\"broadcast-group\" =&gt; \"groupA\")
]. Use instead the socket-binding attribute to configure this broadcast-group.",
        "WFLYMSG0080: Could not migrate attribute group-address from resource [
    (\"subsystem\" =&gt; \"messaging-activemq\"),
    (\"server\" =&gt; \"default\"),
    (\"broadcast-group\" =&gt; \"groupA\")
]. Use instead the socket-binding attribute to configure this broadcast-group.",
        "WFLYMSG0080: Could not migrate attribute group-port from resource [
    (\"subsystem\" =&gt; \"messaging-activemq\"),
    (\"server\" =&gt; \"default\"),
    (\"broadcast-group\" =&gt; \"groupA\")
]. Use instead the socket-binding attribute to configure this broadcast-group."
    ]}
}</pre><p>

						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The list of <code class="literal">migrate</code> and <code class="literal">describe-migration</code> warnings for each subsystem is located in the <a class="link" href="migration_reference_material.html" title="Appendix A. Reference Material">Reference Material</a> at the end of this guide.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="link" href="migration_reference_material.html#migrate_operation_warnings_jacorb" title="JacORB Subsystem Migration Operation Warnings">Jacorb Subsystem Migration Operation Warnings</a>
								</li><li class="listitem">
									<a class="link" href="migration_reference_material.html#migrate_operation_warnings_messaging" title="Messaging Subsystem Migration Operation Warnings">Messaging Subsystem Migration Operation Warnings</a>
								</li><li class="listitem">
									<a class="link" href="migration_reference_material.html#migrate_operation_warnings_web" title="Web Subsystem Migration Operation Warnings">Web Subsystem Migration Operation Warnings</a>
								</li></ul></div></div></li><li class="listitem"><p class="simpara">
						Review the server configuration file to verify the extension, subsystem, and namespace were updated and the existing subsystem configuration was migrated to JBoss EAP 7.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							You must repeat this process for each of the <code class="literal">jacorb</code>, <code class="literal">messaging</code>, and <code class="literal">web</code> subsystems using the following commands.
						</p><pre class="literallayout">/subsystem=jacorb:migrate
/subsystem=messaging:migrate
/subsystem=web:migrate</pre></div></li><li class="listitem"><p class="simpara">
						Remove the <code class="literal">cmp</code>, <code class="literal">jaxr</code>, and <code class="literal">threads</code> subsystems and extensions from the server configuration.
					</p><p class="simpara">
						While still in the management CLI prompt, remove the obsolete <code class="literal">cmp</code>, <code class="literal">jaxr</code>, and <code class="literal">threads</code> subsystems by executing the following commands.
					</p><pre class="screen">/subsystem=cmp:remove
/extension=org.jboss.as.cmp:remove
/subsystem=jaxr:remove
/extension=org.jboss.as.jaxr:remove
/subsystem=threads:remove
/extension=org.jboss.as.threads:remove</pre></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					You must migrate the <code class="literal">messaging</code>, <code class="literal">jacorb</code>, and <code class="literal">web</code> subsystems and remove the <code class="literal">cmp</code>, <code class="literal">jaxr</code>, and <code class="literal">threads</code> extensions and subsystems before you can restart the server for normal operation. If you need to restart the server before you complete this process, be sure to include the <code class="literal">--start-mode=admin-only</code> argument on the server start command line. This allows you to continue with the configuration changes.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_server_logging_changes"/>Logging Changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_logging_prefix_changes"/>Logging Message Prefix Changes</h2></div></div></div><p>
					Log messages are prefixed with the project code for the subsystem that reports the message. The prefixes for all log messages have changed in JBoss EAP 7.
				</p><p>
					For a complete list of the new log message project code prefixes used in JBoss EAP 7, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#project_codes_used_in_eap">Project Codes Used in JBoss EAP</a> in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_root_logger_console_handler_changes"/>Root Logger Console Handler Changes</h2></div></div></div><p>
					The JBoss EAP 7.0 root logger included a console log handler for all domain server profiles and for all default standalone profiles except the <code class="literal">standalone-full-ha</code> profile. As of JBoss EAP 7.1, the root logger no longer includes a console log handler for the managed domain profiles. The host controller and process controller log to the console by default. To achieve the same functionality that was provided in JBoss EAP 7.0, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_console_log_handler">Configure a Console Log Handler</a> in the <span class="emphasis"><em>Configuration Guide</em></span> for JBoss EAP.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_web_server_configuration_changes"/>Web Server Configuration Changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="replace_the_web_subsystem_with_undertow"/>Replace the Web Subsystem with Undertow</h2></div></div></div><p>
					Undertow replaces JBoss Web as the web server in JBoss EAP 7. This means the legacy <code class="literal">web</code> subsystem configuration must be migrated to the new JBoss EAP 7 <code class="literal">undertow</code> subsystem configuration.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">urn:jboss:domain:web:2.2</code> subsystem configuration namespace in the server configuration file has been replaced by the <code class="literal">urn:jboss:domain:undertow:7.0</code> namespace.
						</li><li class="listitem">
							The <code class="literal">org.jboss.as.web</code> extension module, located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/system/layers/base/</code>, has been replaced with the <code class="literal">org.wildfly.extension.undertow</code> extension module.
						</li></ul></div><p>
					You can use the management CLI <code class="literal">migrate</code> operation to migrate the <code class="literal">web</code> subsystem to <code class="literal">undertow</code> in the server configuration file. However, be aware that this operation is not able to migrate all JBoss Web subsystem configurations. If you see "migration-warning" entries, you must run additional management CLI commands to migrate those configurations to Undertow. For more information about the management CLI <code class="literal">migrate</code> operation, see <a class="link" href="server_configuration_changes.html#management_cli_migration_operation" title="Management CLI Migration Operation">Management CLI Migration Operation</a>.
				</p><p>
					The following is an example of the default <code class="literal">web</code> subsystem configuration in JBoss EAP 6.4.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:web:2.2" default-virtual-server="default-host" native="false"&gt;
    &lt;connector name="http" protocol="HTTP/1.1" scheme="http" socket-binding="http"/&gt;
    &lt;virtual-server name="default-host" enable-welcome-root="true"&gt;
        &lt;alias name="localhost"/&gt;
        &lt;alias name="example.com"/&gt;
    &lt;/virtual-server&gt;
&lt;/subsystem&gt;</pre><p>
					The following is an example of the default <code class="literal">undertow</code> subsystem configuration in JBoss EAP 7.2.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0" default-server="default-server" default-virtual-host="default-host" default-servlet-container="default" default-security-domain="other"&gt;
    &lt;buffer-cache name="default"/&gt;
    &lt;server name="default-server"&gt;
        &lt;http-listener name="default" socket-binding="http" redirect-socket="https" enable-http2="true"/&gt;
        &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;host name="default-host" alias="localhost"&gt;
            &lt;location name="/" handler="welcome-content"/&gt;
            &lt;http-invoker security-realm="ApplicationRealm"/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
    ...
&lt;/subsystem&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_jboss_web_rewrite_conditions"/>Migrate JBoss Web Rewrite Conditions</h2></div></div></div><p>
					The management CLI <code class="literal">migrate</code> operation is not able to automatically migrate rewrite conditions. They are reported as "migration-warnings", and you must migrate them manually. You can create the equivalent configuration in JBoss EAP 7 by using <a class="link" href="http://undertow.io/undertow-docs/undertow-docs-2.0.0/#predicates-attributes-and-handlers">Undertow Predicates Attributes and Handlers</a>.
				</p><p>
					The following is an example of a <code class="literal">web</code> subsystem configuration in JBoss EAP 6 that includes <code class="literal">rewrite</code> configuration.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:web:2.2" default-virtual-server="default" native="false"&gt;
    &lt;virtual-server name="default" enable-welcome-root="true"&gt;
        &lt;alias name="localhost"/&gt;
        &lt;rewrite name="test" pattern="(.*)/toberewritten/(.*)" substitution="$1/rewritten/$2" flags="NC"/&gt;
        &lt;rewrite name="test2" pattern="(.*)" substitution="-" flags="F"&gt;
            &lt;condition name="get" test="%{REQUEST_METHOD}" pattern="GET"/&gt;
            &lt;condition name="andCond" test="%{REQUEST_URI}" pattern=".*index.html" flags="NC"/&gt;
        &lt;/rewrite&gt;
    &lt;/virtual-server&gt;
&lt;/subsystem&gt;</pre><p>
					Follow the <a class="link" href="server_configuration_changes.html#management_cli_migration_operation" title="Management CLI Migration Operation">Management CLI Migration Operation</a> instructions to start your server and the management CLI, then migrate the <code class="literal">web</code> subsystem configuration file using the following command.
				</p><pre class="screen">/subsystem=web:migrate</pre><p>
					The following "migration-warnings" are reported when you run the <code class="literal">migrate</code> operation on the above configuration.
				</p><pre class="screen">/subsystem=web:migrate
{
    "outcome" =&gt; "success",
    "result" =&gt; {"migration-warnings" =&gt; [
        "WFLYWEB0002: Could not migrate resource {
    \"pattern\" =&gt; \"(.*)\",
    \"substitution\" =&gt; \"-\",
    \"flags\" =&gt; \"F\",
    \"operation\" =&gt; \"add\",
    \"address\" =&gt; [
        (\"subsystem\" =&gt; \"web\"),
        (\"virtual-server\" =&gt; \"default-host\"),
        (\"rewrite\" =&gt; \"test2\")
    ]
}",
        "WFLYWEB0002: Could not migrate resource {
    \"test\" =&gt; \"%{REQUEST_METHOD}\",
    \"pattern\" =&gt; \"GET\",
    \"flags\" =&gt; undefined,
    \"operation\" =&gt; \"add\",
    \"address\" =&gt; [
        (\"subsystem\" =&gt; \"web\"),
        (\"virtual-server\" =&gt; \"default-host\"),
        (\"rewrite\" =&gt; \"test2\"),
        (\"condition\" =&gt; \"get\")
    ]
}",
        "WFLYWEB0002: Could not migrate resource {
    \"test\" =&gt; \"%{REQUEST_URI}\",
    \"pattern\" =&gt; \".*index.html\",
    \"flags\" =&gt; \"NC\",
    \"operation\" =&gt; \"add\",
    \"address\" =&gt; [
        (\"subsystem\" =&gt; \"web\"),
        (\"virtual-server\" =&gt; \"default-host\"),
        (\"rewrite\" =&gt; \"test2\"),
        (\"condition\" =&gt; \"andCond\")
    ]
}"
    ]}
}</pre><p>
					Review the server configuration file and you see the following configuration for the <code class="literal">undertow</code> subsystem.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The rewrite configuration is dropped.
					</p></div><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0" default-server="default-server" default-virtual-host="default-host" default-servlet-container="default" default-security-domain="other"&gt;
     &lt;buffer-cache name="default"/&gt;
     &lt;server name="default-server"&gt;
         &lt;http-listener name="http" socket-binding="http"/&gt;
         &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
         &lt;host name="default-host" alias="localhost, example.com"&gt;
             &lt;location name="/" handler="welcome-content"/&gt;
         &lt;/host&gt;
     &lt;/server&gt;
     &lt;servlet-container name="default"&gt;
         &lt;jsp-config/&gt;
     &lt;/servlet-container&gt;
     &lt;handlers&gt;
         &lt;file name="welcome-content" path="${jboss.home.dir}/welcome-content"/&gt;
     &lt;/handlers&gt;
 &lt;/subsystem&gt;</pre><p>
					Use the management CLI to create the filter to replace the rewrite configuration in the <code class="literal">undertow</code> subsystem. You should see "{"outcome" ⇒ "success"}" for each command.
				</p><pre class="screen"># Create the filters
/subsystem=undertow/configuration=filter/expression-filter="test1":add(expression="path('(.*)/toberewritten/(.*)') -&gt; rewrite('$1/rewritten/$2')")
/subsystem=undertow/configuration=filter/expression-filter="test2":add(expression="method('GET') and path('.*index.html') -&gt; response-code(403)")

# Add the filters to the default server
/subsystem=undertow/server=default-server/host=default-host/filter-ref="test1":add
/subsystem=undertow/server=default-server/host=default-host/filter-ref="test2":add</pre><p>
					Review the updated server configuration file. The JBoss Web subsystem is now completely migrated and configured in the <code class="literal">undertow</code> subsystem.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0" default-server="default-server" default-virtual-host="default-host" default-servlet-container="default" default-security-domain="other"&gt;
    &lt;buffer-cache name="default"/&gt;
    &lt;server name="default-server"&gt;
        &lt;http-listener name="http" socket-binding="http"/&gt;
        &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;host name="default-host" alias="localhost, example.com"&gt;
            &lt;location name="/" handler="welcome-content"/&gt;
            &lt;filter-ref name="test1"/&gt;
            &lt;filter-ref name="test2"/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
    &lt;servlet-container name="default"&gt;
        &lt;jsp-config/&gt;
    &lt;/servlet-container&gt;
    &lt;handlers&gt;
        &lt;file name="welcome-content" path="${jboss.home.dir}/welcome-content"/&gt;
    &lt;/handlers&gt;
    &lt;filters&gt;
        &lt;expression-filter name="test1" expression="path('(.*)/toberewritten/(.*)') -&gt; rewrite('$1/rewritten/$2')"/&gt;
        &lt;expression-filter name="test2" expression="method('GET') and path('.*index.html') -&gt; response-code(403)"/&gt;
    &lt;/filters&gt;
&lt;/subsystem&gt;</pre><p>
					For more information about how to configure filters and handlers using the management CLI, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configuring_the_web_server_undertow">Configuring the Web Server</a> in the JBoss EAP 7 <span class="emphasis"><em>Configuration Guide</em></span>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_jboss_web_system_properties"/>Migrate JBoss Web System Properties</h2></div></div></div><p>
					In the previous release of JBoss EAP, system properties could be used to modify the default JBoss Web behavior. For information about how to configure the same behavior in Undertow, see <a class="link" href="migration_reference_material.html#migrate_jboss_web_system_properties_reference" title="Migrate JBoss Web System Properties Reference">JBoss Web System Properties Migration Reference</a>
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="update_the_access_log_header_pattern"/>Update the Access Log Header Pattern</h2></div></div></div><p>
					When you migrate from JBoss EAP 6.4 to JBoss EAP 7, you might find that the access logs no longer write the expected "Referer" and "User-agent" values. This is because JBoss Web, which was included in JBoss EAP 6.4, used a pattern of <code class="literal">%{headername}i</code> in the <code class="literal">access-log</code> to log an incoming header.
				</p><div class="title"><strong>Example: Access Log Format in JBoss EAP 6.4</strong></div><p>
						
</p><pre class="programlisting">&lt;access-log pattern="%h %l %u %t &amp;quot;%T sec&amp;quot; &amp;quot;%r&amp;quot; %s %b &amp;quot;%{Referer}i&amp;quot; &amp;quot;%{User-agent}i&amp;quot;"/&gt;</pre><p>

					</p><p>
					With the change to use Undertow in JBoss EAP 7, the pattern for an incoming header has changed to <code class="literal">%{i,headername}</code>.
				</p><div class="title"><strong>Example: Access Format Header in JBoss EAP 7</strong></div><p>
						
</p><pre class="programlisting">&lt;access-log pattern="%h %l %u %t &amp;quot;%T sec&amp;quot; &amp;quot;%r&amp;quot; %s %b &amp;quot;%{i,Referer}&amp;quot; &amp;quot;%{i,User-Agent}&amp;quot;"/&gt;</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_global_valves"/>Migrate Global Valves</h2></div></div></div><p>
					Previous releases of JBoss EAP supported valves. Valves are custom classes inserted into the request processing pipeline for an application before servlet filters to make changes to the request or perform additional processing.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Global valves are inserted into the request processing pipeline of all deployed applications and are configured in the server configuration file.
						</li><li class="listitem">
							Authenticator valves authenticate the credentials of the request.
						</li><li class="listitem">
							Custom application valves were created by extending the <code class="literal">org.apache.catalina.valves.ValveBase</code> class and configured in the <code class="literal">&lt;valve&gt;</code> element of the <code class="literal">jboss-web.xml</code> descriptor file. These valves must be migrated manually.
						</li></ul></div><p>
					This section describes how to migrate global valves. Migration of custom and authenticator valves are covered in the <a class="link" href="application_migration_changes.html#migrate_custom_application_valves" title="Migrate Custom Application Valves">Migrate Custom Application Valves</a> section of this guide.
				</p><p>
					Undertow, which replaces JBoss Web in JBoss EAP 7, does not support global valves; however, you should be able to achieve similar functionality by using Undertow handlers. Undertow includes a number of built-in handlers that provide common functionality. It also provides the ability to create custom handlers, which can be used to replace custom valve functionality.
				</p><p>
					If your application uses valves, you must replace them with the appropriate Undertow handler code to achieve the same functionality when you migrate to JBoss EAP 7.
				</p><p>
					For more information about how to configure handlers, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#undertow-configure-handlers">Configuring Handlers</a> in the JBoss EAP 7 <span class="emphasis"><em>Configuration Guide</em></span>.
				</p><p>
					For more information about how to configure filters, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#undertow-configure-filters">Configuring Filters</a> in the JBoss EAP 7 <span class="emphasis"><em>Configuration Guide</em></span>.
				</p><h4><a id="migrate_jboss_web_valves"/>Migrate JBoss Web Valves</h4><p>
					The following table lists the valves that were provided by JBoss Web in the previous release of JBoss EAP and the corresponding Undertow built-in handler. The JBoss Web valves are located in the <code class="literal">org.apache.catalina.valves</code> package.
				</p><div class="table"><a id="idm139952523277264"/><p class="title"><strong>Table 4.2. Mapping Valves to Handlers</strong></p><div class="table-contents"><table summary="Mapping Valves to Handlers" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Valve</th><th style="text-align: left" valign="top">Handler</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									AccessLogValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.accesslog.AccessLogHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									CrawlerSessionManagerValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.servlet.handlers.CrawlerSessionManagerHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									ExtendedAccessLogValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.accesslog.AccessLogHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									JDBCAccessLogValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									See the <a class="link" href="server_configuration_changes.html#jbdcaccesslogvalve_manual_process" title="JDBCAccessLogValve Manual Migration Procedure"><code class="literal">JDBCAccessLogValve</code> Manual Migration Procedure</a> below for instructions.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									RemoteAddrValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.IPAddressAccessControlHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									RemoteHostValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.AccessControlListHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									RemoteIpValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.ProxyPeerAddressHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									RequestDumperValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.RequestDumpingHandler
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									RewriteValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									See <a class="link" href="server_configuration_changes.html#migrate_jboss_web_rewrite_conditions" title="Migrate JBoss Web Rewrite Conditions">Migrate JBoss Web Rewrite Conditions</a> for instructions to migrate these valves manually.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									StuckThreadDetectionValve
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									io.undertow.server.handlers.StuckThreadDetectionHandler
								</p>
								 </td></tr></tbody></table></div></div><p>
					You can use the management CLI <code class="literal">migrate</code> operation to automatically migrate global valves that meet the following criteria:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							They are limited to the valves listed in the previous table that do not require manual processing.
						</li><li class="listitem">
							They must be defined in the <code class="literal">web</code> subsystem of the server configuration file.
						</li></ul></div><p>
					For more information about the management CLI <code class="literal">migrate</code> operation, see <a class="link" href="server_configuration_changes.html#management_cli_migration_operation" title="Management CLI Migration Operation">Management CLI Migration Operation</a>.
				</p><h4><a id="jbdcaccesslogvalve_manual_process"/>JDBCAccessLogValve Manual Migration Procedure</h4><p>
					The <code class="literal">org.apache.catalina.valves.JDBCAccessLogValve</code> valve is an exception to the rule and can not be automatically migrated to <code class="literal">io.undertow.server.handlers.JDBCLogHandler</code>. Follow the steps below to migrate the following example valve.
				</p><pre class="programlisting">&lt;valve name="jdbc" module="org.jboss.as.web" class-name="org.apache.catalina.valves.JDBCAccessLogValve"&gt;
    &lt;param param-name="driverName" param-value="com.mysql.jdbc.Driver" /&gt;
    &lt;param param-name="connectionName" param-value="root" /&gt;
    &lt;param param-name="connectionPassword" param-value="password" /&gt;
    &lt;param param-name="connectionURL" param-value="jdbc:mysql://localhost:3306/wildfly?zeroDateTimeBehavior=convertToNull" /&gt;
    &lt;param param-name="format" param-value="combined" /&gt;
&lt;/valve&gt;</pre><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Create a driver module for the database that will store the log entries.
						</li><li class="listitem"><p class="simpara">
							Configure the datasource for the database and add the driver to the list of available drivers in the <code class="literal">datasources</code> subsystem.
						</p><pre class="programlisting">&lt;datasources&gt;
    &lt;datasource jndi-name="java:jboss/datasources/accessLogDS" pool-name="accessLogDS" enabled="true" use-java-context="true"&gt;
        &lt;connection-url&gt;jdbc:mysql://localhost:3306/wildfly?zeroDateTimeBehavior=convertToNull&lt;/connection-url&gt;
        &lt;driver&gt;mysql&lt;/driver&gt;
        &lt;security&gt;
           &lt;user-name&gt;root&lt;/user-name&gt;
           &lt;password&gt;Password1!&lt;/password&gt;
        &lt;/security&gt;
    &lt;/datasource&gt;
    ...
    &lt;drivers&gt;
        &lt;driver name="mysql" module="com.mysql"&gt;
            &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
        &lt;/driver&gt;
    ...
    &lt;/drivers&gt;
&lt;/datasources&gt;</pre></li><li class="listitem"><p class="simpara">
							Configure an <code class="literal">expression-filter</code> in the <code class="literal">undertow</code> subsystem with the following expression: <code class="literal">jdbc-access-log(datasource=<span class="emphasis"><em>DATASOURCE_JNDI_NAME</em></span>)</code>.
						</p><pre class="programlisting">&lt;filters&gt;
    &lt;expression-filter name="jdbc-access" expression="jdbc-access-log(datasource='java:jboss/datasources/accessLogDS')" /&gt;
    ...
&lt;/filters&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changes_to_set_cookie_behavior"/>Changes to Set-Cookie Behavior</h2></div></div></div><p>
					Previous specifications for <code class="literal">Set-Cookie</code> HTTP response header syntax, for example RFC2109 and RFC2965, allowed white space and other separator characters in the cookie value when the cookie value was quoted. JBoss Web in JBoss EAP 6.4 conformed to the previous specifications and automatically quoted a cookie value when it contained any separator characters.
				</p><p>
					The <a class="link" href="http://httpwg.org/specs/rfc6265.html#rfc.section.4.1">RFC6265</a> specification for <code class="literal">Set-Cookie</code> HTTP response header syntax states that cookie values in the <code class="literal">Set-Cookie</code> response header must conform to specific grammar constraints. For example, they must be US-ASCII characters, but they cannot include CTRLs (controls), whitespace, double quotes, commas, semicolons, or backslash characters.
				</p><p>
					In JBoss EAP 7.0, prior to cumulative patch <a class="link" href="https://access.redhat.com/jbossnetwork/restricted/listSoftware.html?product=appplatform&amp;downloadType=patches&amp;version=7.0">Red Hat JBoss Enterprise Application Platform 7.0 Update 08</a>, Undertow does not restrict these invalid characters and does not quote cookies that contained the excluded characters. If you apply this cumulative patch or a newer cumulative patch you can enable RFC6265 compliant cookie validation by setting the <code class="literal">io.undertow.cookie.DEFAULT_ENABLE_RFC6265_COOKIE_VALIDATION</code> system property to <code class="literal">true</code>.
				</p><p>
					Starting in JBoss EAP 7.1, by default, Undertow does not enable RFC6265 compliant cookie validation. It does quote cookies that contain the excluded characters. Starting in JBoss EAP 7.1, you cannot use the <code class="literal">io.undertow.cookie.DEFAULT_ENABLE_RFC6265_COOKIE_VALIDATION</code> system property to enable RFC6265 compliant cookie validation. Instead, you enable RFC6265 compliant cookie validation for an HTTP, HTTPS, or AJP listener by setting the <code class="literal">rfc6265-cookie-validation</code> listener attribute to <code class="literal">true</code>. The default value for this attribute is <code class="literal">false</code>. The following example enables RFC6265 compliant cookie validation for the HTTP listener.
				</p><pre class="screen">/subsystem=undertow/server=default-server/http-listener=default:write-attribute(name=rfc6265-cookie-validation,value=true)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changes_to_http_method_call_behavior"/>Changes to HTTP Method Call Behavior</h2></div></div></div><p>
					JBoss EAP 6.4, which included JBoss Web as the web server, allowed HTTP <code class="literal">TRACE</code> method calls by default.
				</p><p>
					Undertow, which replaces JBoss Web as the web server in JBoss EAP 7, disallows HTTP <code class="literal">TRACE</code> method calls by default. This setting is configured using the <code class="literal">disallowed-methods</code> attribute of the <code class="literal">http-listener</code> element in the <code class="literal">undertow</code> subsystem. This can be confirmed by reviewing the output from the following <code class="literal">read-resource</code> command. Note that the value for the <code class="literal">disallowed-methods</code> attribute is <code class="literal">["TRACE"]</code>.
				</p><pre class="screen">/subsystem=undertow/server=default-server/http-listener=default:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "allow-encoded-slash" =&gt; false,
        "allow-equals-in-cookie-value" =&gt; false,
        "allow-unescaped-characters-in-url" =&gt; false,
        "always-set-keep-alive" =&gt; true,
        "buffer-pipelined-data" =&gt; false,
        "buffer-pool" =&gt; "default",
        "certificate-forwarding" =&gt; false,
        "decode-url" =&gt; true,
        "disallowed-methods" =&gt; ["TRACE"],
         ...
    }
}</pre><p>
					To enable HTTP <code class="literal">TRACE</code> method calls in JBoss EAP 7 and later, you must remove the "TRACE" entry from the <code class="literal">disallowed-methods</code> attribute list by running the following command.
				</p><pre class="screen">/subsystem=undertow/server=default-server/http-listener=default:list-remove(name=disallowed-methods,value="TRACE")</pre><p>
					When you run the <code class="literal">read-resource</code> command again, you will notice the <code class="literal">TRACE</code> method call is no longer in the list of disallowed methods.
				</p><pre class="screen">/subsystem=undertow/server=default-server/http-listener=default:read-resource
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "allow-encoded-slash" =&gt; false,
        "allow-equals-in-cookie-value" =&gt; false,
        "allow-unescaped-characters-in-url" =&gt; false,
        "always-set-keep-alive" =&gt; true,
        "buffer-pipelined-data" =&gt; false,
        "buffer-pool" =&gt; "default",
        "certificate-forwarding" =&gt; false,
        "decode-url" =&gt; true,
        "disallowed-methods" =&gt; [],
         ...
    }
}</pre><p>
					For more information about the default behavior of HTTP methods, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#default_behavior_http_methods">Default Behavior of HTTP Methods</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changes_in_default_web_module_behavior"/>Changes in the Default Web Module Behavior</h2></div></div></div><p>
					In JBoss EAP 7.0, the root context of a web application was disabled by default in mod_cluster.
				</p><p>
					As of JBoss EAP 7.1, this is no longer the case. This can have unexpected consequences if you are expecting the root context to be disabled. For example, requests can be misrouted to undesired nodes or a private application that should not be exposed can be inadvertently accessible through a public proxy. Undertow locations are also now registered with the mod_cluster load balancer automatically unless they are explicitly excluded.
				</p><p>
					Use the following management CLI command to exclude ROOT from the <code class="literal">modcluster</code> subsystem configuration.
				</p><pre class="screen">/subsystem=modcluster/mod-cluster-config=configuration:write-attribute(name=excluded-contexts,value=ROOT)</pre><p>
					Use the following management CLI command to disable the default welcome web application.
				</p><pre class="screen">/subsystem=undertow/server=default-server/host=default-host/location=\/:remove
/subsystem=undertow/configuration=handler/file=welcome-content:remove
reload</pre><p>
					For more information about how to configure the default welcome web application, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#configure_the_default_welcome_Web_application">Configure the Default Welcome Web Application</a> in the <span class="emphasis"><em>Development Guide</em></span> for JBoss EAP.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changes_in_undertow_default_configuration"/>Changes in the Undertow Subsystem Default Configuration</h2></div></div></div><p>
					Prior to JBoss EAP 7.2, the default <code class="literal">undertow</code> subsystem configuration included two response header filters that were appended to each HTTP response by the <code class="literal">default-host</code>.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">Server</code>, which was set to <code class="literal">JBoss-EAP/7</code>.
						</li><li class="listitem">
							<code class="literal">X-Powered-By</code>, which was set to <code class="literal">Undertow/1</code>.
						</li></ul></div><p>
					These response header filters were removed from the default JBoss EAP 7.2 configuration to prevent inadvertent disclosure of information about the server in use.
				</p><p>
					The following is an example of the default <code class="literal">undertow</code> subsystem configuration in JBoss EAP 7.1.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:undertow:4.0"&gt;
    &lt;buffer-cache name="default"/&gt;
    &lt;server name="default-server"&gt;
        &lt;http-listener name="default" socket-binding="http" redirect-socket="https"/&gt;
        &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;host name="default-host" alias="localhost"&gt;
            &lt;location name="/" handler="welcome-content"/&gt;
            &lt;filter-ref name="server-header"/&gt;
            &lt;filter-ref name="x-powered-by-header"/&gt;
            &lt;http-invoker security-realm="ApplicationRealm"/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
    &lt;servlet-container name="default"&gt;
        &lt;jsp-config/&gt;
        &lt;websockets/&gt;
    &lt;/servlet-container&gt;
    &lt;handlers&gt;
        &lt;file name="welcome-content" path="${jboss.home.dir}/welcome-content"/&gt;
    &lt;/handlers&gt;
    &lt;filters&gt;
        &lt;response-header name="server-header" header-name="Server" header-value="JBoss-EAP/7"/&gt;
        &lt;response-header name="x-powered-by-header" header-name="X-Powered-By" header-value="Undertow/1"/&gt;
    &lt;/filters&gt;
&lt;/subsystem&gt;</pre><p>
					The following is an example of the new default <code class="literal">undertow</code> subsystem configuration in JBoss EAP 7.2.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:undertow:7.0" default-server="default-server" default-virtual-host="default-host" default-servlet-container="default" default-security-domain="other"&gt;
    &lt;buffer-cache name="default"/&gt;
    &lt;server name="default-server"&gt;
        &lt;http-listener name="default" socket-binding="http" redirect-socket="https" enable-http2="true"/&gt;
        &lt;https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/&gt;
        &lt;host name="default-host" alias="localhost"&gt;
            &lt;location name="/" handler="welcome-content"/&gt;
            &lt;http-invoker security-realm="ApplicationRealm"/&gt;
        &lt;/host&gt;
    &lt;/server&gt;
    &lt;servlet-container name="default"&gt;
        &lt;jsp-config/&gt;
        &lt;websockets/&gt;
    &lt;/servlet-container&gt;
    &lt;handlers&gt;
        &lt;file name="welcome-content" path="${jboss.home.dir}/welcome-content"/&gt;
    &lt;/handlers&gt;
&lt;/subsystem&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_server_configuration_changes"/>JGroups Server Configuration Changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jgroups_defaults_to_a_private_network_interface"/>JGroups Defaults to a Private Network Interface</h2></div></div></div><p>
					In the JBoss EAP 6 default configuration, JGroups used the <code class="literal">public</code> interface defined in the <code class="literal">&lt;interfaces&gt;</code> section of the server configuration file.
				</p><p>
					Because it is a recommended practice to use a dedicated network interface, JGroups now defaults to using the new <code class="literal">private</code> interface that is defined in the <code class="literal">&lt;interfaces&gt;</code> section of the server configuration file in JBoss EAP 7.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jgroups_channels_changes"/>JGroups Channels Changes</h2></div></div></div><p>
					JGroups provides group communication support for HA services in the form of JGroups channels. JBoss EAP 7 introduces <code class="literal">&lt;channel&gt;</code> elements to the <code class="literal">jgroups</code> subsystem in the server configuration file. You can add, remove, or change the configuration of JGroups channels using the management CLI.
				</p><p>
					For more information about how to configure JGroups, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#cluster_communication_jgroups">Cluster Communication with JGroups</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_infinispan_server_configuration_changes"/>Infinispan Server Configuration Changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_infinispan_default_cache_configuration_changes"/>Infinispan Default Cache Configuration Changes</h2></div></div></div><p>
					In JBoss EAP 6, the default clustered caches for web session replication and EJB replication were replicated <code class="literal">ASYNC</code> caches. This has changed in JBoss EAP 7. The default clustered caches are now distributed <code class="literal">ASYNC</code> caches. The replicated caches are no longer even configured by default. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_the_cache_mode">Configure the Cache Mode</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span> for information about how to add a replicated cache and make it the default.
				</p><p>
					This only affects you when you use the new JBoss EAP 7 default configuration. If you migrate the configuration from JBoss EAP 6, the configuration of the <code class="literal">infinispan</code> subsystem will be preserved.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_infinispan_cache_strategy_changes"/>Infinispan Cache Strategy Changes</h2></div></div></div><p>
					The behavior of <code class="literal">ASYNC</code> cache strategy has changed in JBoss EAP 7.
				</p><p>
					In JBoss EAP 6, <code class="literal">ASYNC</code> cache reads were lock free. Although they would never block, the were prone to dirty reads of stale data, for example on failover. This is because it would allow subsequent requests for the same user to start before the previous request completed. This permissiveness is not acceptable when using distributed mode, since cluster topology changes can affect session affinity and easily result in stale data.
				</p><p>
					In JBoss EAP 7, <code class="literal">ASYNC</code> cache reads require locks. Since they now block new requests from the same user until the previous replication finishes, dirty reads are prevented.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_custom_stateful_session_bean_cache_for_passivation"/>Configuring Custom Stateful Session Bean Cache for Passivation</h2></div></div></div><p>
					Be aware of the following restrictions when configuring a custom stateful session bean (SFSB) cache for passivation in JBoss EAP 7.1 and later.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">idle-timeout</code> attribute, which is configured in the <code class="literal">infinispan</code> <code class="literal">passivation-store</code> of the <code class="literal">ejb3</code> subsystem, is deprecated in JBoss EAP 7.1 and later. JBoss EAP 6.4 supported eager passivation, passivating according to the <code class="literal">idle-timeout</code> value. JBoss EAP 7.1 and later support lazy passivation, passivating when the <code class="literal">max-size</code> threshold is reached.
						</li><li class="listitem">
							In JBoss EAP 7.1 and later, the cluster name used by the EJB client is determined by the actual cluster name of the channel, as configured in the <code class="literal">jgroups</code> subsystem.
						</li><li class="listitem">
							JBoss EAP 7.1 and later still allow you to set the <code class="literal">max-size</code> attribute to control the passivation threshold.
						</li><li class="listitem"><p class="simpara">
							You should not configure eviction or expiration in your EJB cache configuration.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									You should configure eviction by using the <code class="literal">max-size</code> attribute of the <code class="literal">passivation-store</code> in the <code class="literal">ejb3</code> subsystem.
								</li><li class="listitem">
									You should configure expiration by using the <code class="literal">@StatefulTimeout</code> annotation in the SFSB Java source code or by specifying a <code class="literal">stateful-timeout</code> value in the <code class="literal">ejb-jar.xml</code> file.
								</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="infinispan_cache_container_transport_changes"/>Infinispan Cache Container Transport Changes</h2></div></div></div><p>
					A change in behavior between JBoss EAP 7.0 and later versions requires that any updates to the cache container transport protocol to be done in batch mode or using a special header. This change in behavior also impacts any tools that are used to manage the JBoss EAP server.
				</p><p>
					The following is an example of the management CLI commands used to configure the cache container transport protocol in JBoss EAP 7.0.
				</p><pre class="screen">/subsystem=infinispan/cache-container=my:add()
/subsystem=infinispan/cache-container=my/transport=jgroups:add()
/subsystem=infinispan/cache-container=my/invalidation-cache=mycache:add(mode=SYNC)</pre><p>
					The following is an example of the management CLI commands needed to perform the same configuration in JBoss EAP 7.1. Note that the commands are executed in batch mode.
				</p><pre class="screen">batch
/subsystem=infinispan/cache-container=my:add()
/subsystem=infinispan/cache-container=my/transport=jgroups:add()
/subsystem=infinispan/cache-container=my/invalidation-cache=mycache:add(mode=SYNC)
run-batch</pre><p>
					If you prefer not to use batch mode, you can instead specify the operation header <code class="literal">allow-resource-service-restart=true</code> when defining the transport. Be aware that this restarts the service so that the operations can take effect, and some services might stop working until the service is restarted.
				</p><p>
					If you use scripts to update the cache container transport protocol, be sure to review them and add batch mode.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_ejb_server_configuration_changes"/>EJB Server Configuration Changes</h1></div></div></div><p>
				There is no <code class="literal">migrate</code> operation for the <code class="literal">ejb3</code> subsystem, so if you use the management CLI <code class="literal">migrate</code> operations to upgrade your other existing JBoss EAP 6.4 configurations, be aware that the <code class="literal">ejb3</code> subsystem configuration is not migrated. Because the configuration of the <code class="literal">ejb3</code> subsystem is slightly different in JBoss EAP 7 than in JBoss EAP 6.4, you might see exceptions in the server log when you deploy your EJB applications.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					If you use the JBoss Server Migration Tool to update your server configuration, the <code class="literal">ejb3</code> subsystem should be configured correctly and you should not see any issues when you deploy your EJB applications. For information about how to configure and run the tool, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/using_the_jboss_server_migration_tool">Using the JBoss Server Migration Tool</a>.
				</p></div><h3><a id="migrate_ejb_server_configuration_duplicateservice_exception"/>DuplicateServiceException</h3><p>
				The following <code class="literal">DuplicateServiceException</code> is caused by caching changes in JBoss EAP 7.
			</p><div class="title"><strong>DuplicateServiceException in Server Log</strong></div><p>
					
</p><pre class="screen">ERROR [org.jboss.msc.service.fail] (MSC service thread 1-3) MSC000001: Failed to start service jboss.deployment.unit."mdb-1.0-SNAPSHOT.jar".cache-dependencies-installer: org.jboss.msc.service.StartException in service jboss.deployment.unit."mdb-1.0-SNAPSHOT.jar".cache-dependencies-installer: Failed to start service
...
Caused by: org.jboss.msc.service.DuplicateServiceException: Service jboss.infinispan.ejb."mdb-1.0-SNAPSHOT.jar".config is already registered</pre><p>

				</p><p>
				You must reconfigure the cache to resolve this error.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						Follow the instructions to <a class="link" href="server_configuration_changes.html#migrate_start_the_server_and_the_management_cli" title="Start the Server and the Management CLI">Start the Server and the Management CLI</a>.
					</li><li class="listitem"><p class="simpara">
						Issue the following commands to reconfigure caching in the <code class="literal">ejb3</code> subsystem.
					</p><pre class="screen">/subsystem=ejb3/file-passivation-store=file:remove
/subsystem=ejb3/cluster-passivation-store=infinispan:remove
/subsystem=ejb3/passivation-store=infinispan:add(cache-container=ejb, max-size=10000)

/subsystem=ejb3/cache=passivating:remove
/subsystem=ejb3/cache=clustered:remove
/subsystem=ejb3/cache=distributable:add(passivation-store=infinispan, aliases=[passivating, clustered])</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_messaging_server_configuration_changes"/>Messaging Server Configuration Changes</h1></div></div></div><p>
				In JBoss EAP 7, ActiveMQ Artemis replaces HornetQ as the JMS support provider. This section describes how to migrate the configuration and related messaging data.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_messaging_subsystem_server_configuration_changes"/>Messaging Subsystem Server Configuration Changes</h2></div></div></div><p>
					The <code class="literal">org.jboss.as.messaging</code> module extension, located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/system/layers/base/</code>, has been replaced by the <code class="literal">org.wildfly.extension.messaging-activemq</code> extension module.
				</p><p>
					The <code class="literal">urn:jboss:domain:messaging:3.0</code> subsystem configuration namespace has been replaced by the <code class="literal">urn:jboss:domain:messaging-activemq:4.0</code> namespace.
				</p><h4><a id="migrate_messaging_subsystem_server_configuration_management_model"/>Management Model</h4><p>
					In most cases, an effort was made to keep the element and attribute names as similar as possible to those used in previous releases. The following table lists some of the changes.
				</p><div class="table"><a id="idm139952601545040"/><p class="title"><strong>Table 4.3. Mapping Messaging Attributes</strong></p><div class="table-contents"><table summary="Mapping Messaging Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">HornetQ Name</th><th style="text-align: left" valign="top">ActiveMQ Name ﻿</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									hornetq-server
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									server
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									hornetq-serverType
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									serverType
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									connectors
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									connector
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									discovery-group-name
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									discovery-group
								</p>
								 </td></tr></tbody></table></div></div><p>
					The management operations invoked on the new <code class="literal">messaging-activemq</code> subsystem have changed from <code class="literal">/subsystem=messaging/hornetq-server=</code> to <code class="literal">/subsystem=messaging-activemq/server=</code>.
				</p><p>
					You can migrate an existing JBoss EAP 6 <code class="literal">messaging</code> subsystem configuration to the <code class="literal">messaging-activemq</code> subsystem on a JBoss EAP 7 server by invoking its <code class="literal">migrate</code> operation.
				</p><pre class="screen">/subsystem=messaging:migrate</pre><p>
					Before you execute the <code class="literal">migrate</code> operation, you can invoke the <code class="literal">describe-migration</code> operation to review the list of management operations that will be performed to migrate from the existing JBoss EAP 6 <code class="literal">messaging</code> subsystem configuration to the <code class="literal">messaging-activemq</code> subsystem on the JBoss EAP 7 server.
				</p><pre class="screen">/subsystem=messaging:describe-migration</pre><p>
					The <code class="literal">migrate</code> and <code class="literal">describe-migration</code> operations also display a list of <code class="literal">migration-warnings</code> for resources or attributes that can not be migrated automatically.
				</p><h4><a id="migrate_messaging_subsystem_forward_compatibility"/>Messaging Subsystem Migration and Forward Compatibility</h4><p>
					The <code class="literal">describe-migration</code> and <code class="literal">migrate</code> operations for the <code class="literal">messaging</code> subsystem provide an additional configuration argument. If you want to configure messaging to allow legacy JBoss EAP 6 clients to connect to the JBoss EAP 7 server, you can add the boolean <code class="literal">add-legacy-entries</code> argument to the <code class="literal">describe-migration</code> or <code class="literal">migrate</code> operation as follows.
				</p><pre class="screen">/subsystem=messaging:describe-migration(add-legacy-entries=true)
/subsystem=messaging:migrate(add-legacy-entries=true)</pre><p>
					If the boolean argument <code class="literal">add-legacy-entries</code> is set to <code class="literal">true</code>, the <code class="literal">messaging-activemq</code> subsystem creates the <code class="literal">legacy-connection-factory</code> resource and adds <code class="literal">legacy-entries</code> to the <code class="literal">jms-queue</code> and <code class="literal">jms-topic</code> resources.
				</p><p>
					If the boolean argument <code class="literal">add-legacy-entries</code> is set to <code class="literal">false</code>, no legacy resources are created in the <code class="literal">messaging-activemq</code> subsystem and legacy JMS clients will not be able to communicate with the JBoss EAP 7 servers. This is the default value.
				</p><p>
					For more information about forward and backward compatibility see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#messaging_forward_and_backward_compatiblity">Backward and Forward Compatibility</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
				</p><p>
					For more information about the management CLI <code class="literal">migrate</code> and <code class="literal">describe-migration</code> operations, see <a class="link" href="server_configuration_changes.html#management_cli_migration_operation" title="Management CLI Migration Operation">Management CLI Migration Operation</a>.
				</p><h4><a id="migrate_behavior_change_forward_when_no_consumers_attribute"/>Change in Behavior of forward-when-no-consumers Attribute</h4><p>
					The behavior of the <code class="literal">forward-when-no-consumers</code> attribute has changed in JBoss EAP 7.
				</p><p>
					In JBoss EAP 6, when <code class="literal">forward-when-no-consumers</code> was set to <code class="literal">false</code> and there were no consumers in a cluster, messages were redistributed to all nodes in a cluster.
				</p><p>
					This behavior has changed in JBoss EAP 7. When <code class="literal">forward-when-no-consumers</code> is set to <code class="literal">false</code> and there are no consumers in a cluster, messages are not redistributed. Instead, they are kept on the original node to which they were sent.
				</p><h4><a id="migrate_behavior_change_default_load_balancing_policy"/>Change in Default Cluster Load Balancing Policy</h4><p>
					The default cluster load balancing policy has changed in JBoss EAP 7.
				</p><p>
					In JBoss EAP 6, the default cluster load balancing policy was similar to <code class="literal">STRICT</code>, which is like setting the legacy <code class="literal">forward-when-no-consumers</code> parameter to <code class="literal">true</code>. In JBoss EAP 7, the default is now <code class="literal">ON_DEMAND</code>, which is like setting the legacy <code class="literal">forward-when-no-consumers</code> parameter to <code class="literal">false</code>. For more information about these settings, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#cluster_connection_attributes">Cluster Connection Attributes</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
				</p><h4><a id="migrate_messaging_subsystem_xml_configuration"/>Messaging Subsystem XML Configuration</h4><p>
					The XML configuration has changed significantly with the new <code class="literal">messaging-activemq</code> subsystem, and now provides an XML scheme more consistent with other JBoss EAP subsystems.
				</p><p>
					It is strongly advised that you do not attempt to modify the JBoss EAP <code class="literal">messaging</code> subsystem XML configuration to conform to the new <code class="literal">messaging-activemq</code> subsystem. Instead, invoke the legacy subsystem <code class="literal">migrate</code> operation. This operation will write the XML configuration of the new <code class="literal">messaging-activemq</code> subsystem as a part of its execution.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_messaging_data"/>Migrate Messaging Data</h2></div></div></div><p>
					You can use one of the following approaches to migrate messaging data from a previous release to the current release of JBoss EAP.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For file-based messaging systems, you can migrate messaging data to JBoss EAP 7.2 from JBoss EAP 6.4 and previous JBoss EAP 7.x releases <a class="link" href="server_configuration_changes.html#migrate_messaging_data_using_export_and_import" title="Migrate Messaging Data Using Export and Import">using the export and import method</a>. With this method you export the messaging data from the previous release and import it using the management CLI <code class="literal">import-journal</code> operation. Be aware that you can use this approach for file-based messaging systems only.
						</li><li class="listitem">
							You can migrate messaging data from JBoss EAP 6.4 to JBoss EAP 7.2 by <a class="link" href="server_configuration_changes.html#migrate_messaging_data_using_a_jms_bridge" title="Migrate Messaging Data Using a JMS Bridge">configuring a JMS bridge</a>. You can use this approach for both file-based and JDBC messaging systems.
						</li></ul></div><p>
					Due to the change from HornetQ to ActiveMQ Artemis as the JMS support provider, both the format and the location of the messaging data changed in JBoss EAP 7.0 and later. See <a class="link" href="server_configuration_changes.html#migrate_messaging_data_mapping_folder_names" title="Mapping Messaging Folder Names">Mapping Messaging Folder Names</a> for details of the changes to the messaging data folder names and locations between the 6.4 and 7.x releases.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="migrate_messaging_data_using_export_and_import"/>Migrate Messaging Data Using Export and Import</h3></div></div></div><p>
						Using this approach, you export the messaging data from a previous release to an XML file, and then import that file using the <code class="literal">import-journal</code> operation.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Export the messaging data to an XML file.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<a class="link" href="server_configuration_changes.html#export_messaging_data_from_eap_64" title="Export Messaging Data from JBoss EAP 6.4">Export messaging data from JBoss EAP 6.4.</a>
									</li><li class="listitem">
										<a class="link" href="server_configuration_changes.html#export_messaging_data_from_eap_7x" title="Export Messaging Data from JBoss EAP 7.x">Export messaging data from JBoss EAP 7.x.</a>
									</li></ul></div></li><li class="listitem">
								<a class="link" href="server_configuration_changes.html#import_xml_formatted_messaging_data" title="Import the XML Formatted Messaging Data">Import the XML formatted messaging data.</a>
							</li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							You cannot use the export and import method to move messaging data between systems that use a JDBC-based journal for storage.
						</p></div><h5><a id="export_messaging_data_from_eap_64"/>Export Messaging Data from JBoss EAP 6.4</h5><p>
						Due to the change from HornetQ to ActiveMQ Artemis as the JMS support provider, both the format and the location of the messaging data changed in JBoss EAP 7.0 and later.
					</p><p>
						To export messaging data from JBoss EAP 6.4, you must use the HornetQ <code class="literal">exporter</code> utility. The HornetQ <code class="literal">exporter</code> utility generates and exports the messaging data from JBoss EAP 6.4 to an XML file. This command requires that you specify the paths to the required HornetQ JARs that shipped with JBoss EAP 6.4, pass the paths to <code class="literal">messagingbindings/</code>, <code class="literal">messagingjournal/</code>, <code class="literal">messagingpaging/</code>, and <code class="literal">messaginglargemessages/</code> folders from the previous release as arguments, and specify an output file in which to write the exported XML data.
					</p><p>
						The following is the syntax required by the HornetQ <code class="literal">exporter</code> utility.
					</p><pre class="programlisting">$ java -jar -mp <span class="emphasis"><em>MODULE_PATH</em></span> org.hornetq.exporter <span class="emphasis"><em>MESSAGING_BINDINGS_DIRECTORY</em></span> <span class="emphasis"><em>MESSAGING_JOURNAL_DIRECTORY</em></span> <span class="emphasis"><em>MESSAGING_PAGING_DIRECTORY</em></span> <span class="emphasis"><em>MESSAGING_LARGE_MESSAGES_DIRECTORY</em></span> &gt; <span class="emphasis"><em>OUTPUT_DATA</em></span>.xml</pre><p>
						Create a custom module to ensure the correct versions of the HornetQ JARs, including any JARs installed with patches or upgrades, are loaded and made available to the <code class="literal">exporter</code> utility. Using your favorite editor, create a new <code class="literal">module.xml</code> file in the <code class="literal"><span class="emphasis"><em>EAP6_HOME</em></span>/modules/org/hornetq/exporter/main/</code> directory and copy the following content:
					</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.1" name="org.hornetq.exporter"&gt;
    &lt;main-class name="org.hornetq.jms.persistence.impl.journal.XmlDataExporter"/&gt;
    &lt;properties&gt;
        &lt;property name="jboss.api" value="deprecated"/&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;module name="org.hornetq"/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The custom module is created in the <code class="literal">modules/</code> directory, not the <code class="literal">modules/system/layers/base/</code> directory.
						</p></div><p>
						Follow the steps below to export the data.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Stop the JBoss EAP 6.4 server.
							</li><li class="listitem">
								Create the custom module as described above.
							</li><li class="listitem"><p class="simpara">
								Run the following command to export the data.
							</p><pre class="screen">$ java -jar jboss-modules.jar -mp modules/ org.hornetq.exporter standalone/data/messagingbindings/ standalone/data/messagingjournal/ standalone/data/messagingpaging standalone/data/messaginglargemessages/ &gt; <span class="emphasis"><em>OUTPUT_DIRECTORY</em></span>/OldMessagingData.xml</pre></li><li class="listitem">
								Make sure there are no errors or warning messages in the log at the completion of the command.
							</li><li class="listitem">
								Use tooling available for your operating system to validate the XML in the generated output file.
							</li></ol></div><h5><a id="export_messaging_data_from_eap_7x"/>Export Messaging Data from JBoss EAP 7.x</h5><p>
						Follow these steps to export messaging data from JBoss EAP 7.x.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Open a terminal, navigate to the JBoss EAP 7.x install directory, and start the server in <code class="literal">admin-only</code> mode.
							</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -c standalone-full.xml --start-mode=admin-only</pre></li><li class="listitem"><p class="simpara">
								Open a new terminal, navigate to the JBoss EAP 7.x install directory, and connect to the management CLI.
							</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh --connect</pre></li><li class="listitem"><p class="simpara">
								Use the following management CLI command to export the messaging journal data.
							</p><pre class="screen">/subsystem=messaging-activemq/server=default:export-journal()</pre></li><li class="listitem">
								Make sure there are no errors or warning messages in the log at the completion of the command.
							</li><li class="listitem">
								Use tooling available for your operating system to validate the XML in the generated output file.
							</li></ol></div><h5><a id="import_xml_formatted_messaging_data"/>Import the XML Formatted Messaging Data</h5><p>
						You then import the XML file into JBoss EAP 7.0 or later by using the <code class="literal">import-journal</code> operation as follows.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							If your target server has already performed some messaging tasks, be sure to back up your messaging folders before you begin the <code class="literal">import-journal</code> operation to prevent data loss in the event of an import failure. See <a class="link" href="server_configuration_changes.html#backing_up_messaging_folder_data" title="Backing Up Messaging Folder Data">Backing Up Messaging Folder Data</a> for more information.
						</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								If you are migrating your JBoss EAP 6.4 server to JBoss EAP 7.2, make sure you have completed the migration of the server configuration before you begin by using the <a class="link" href="server_configuration_changes.html#management_cli_migration_operation" title="Management CLI Migration Operation">management CLI migrate operation</a> or by running the JBoss Server Migration Tool. For information about how to configure and run the tool, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/using_the_jboss_server_migration_tool">Using the JBoss Server Migration Tool</a>.
							</li><li class="listitem"><p class="simpara">
								Start the JBoss EAP 7.x server in normal mode with <span class="emphasis"><em>no</em></span> JMS clients connected.
							</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									It is important that you start the server with no JMS clients connected. This is because the <code class="literal">import-journal</code> operation behaves like a JMS producer. Messages are immediately available when the operation is in progress. If this operation fails in the middle of the import and JMS clients are connected, there is no way to recover because JMS clients might have already consumed some of the messages.
								</p></div></li><li class="listitem"><p class="simpara">
								Open a new terminal, navigate to the JBoss EAP 7.x install directory, and connect to the management CLI.
							</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh --connect</pre></li><li class="listitem"><p class="simpara">
								Use the following management CLI command to import the messaging data.
							</p><pre class="screen">/subsystem=messaging-activemq/server=default:import-journal(file=<span class="emphasis"><em>OUTPUT_DIRECTORY</em></span>/OldMessagingData.xml)</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									Do <span class="emphasis"><em>not</em></span> run this command more than one time as doing so will result in duplicate messages!
								</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
									If you are using JBoss EAP 7.0, you must apply <a class="link" href="https://access.redhat.com/jbossnetwork/restricted/softwareDetail.html?softwareId=50411&amp;product=appplatform&amp;version=7.0&amp;downloadType=patches">Red Hat JBoss Enterprise Application Platform 7.0 Update 05</a> or a newer cumulative patch to your JBoss EAP installation in order to avoid a known issue when reading large messages. For more information, see <a class="link" href="https://issues.jboss.org/browse/JBEAP-4407">JBEAP-4407 - Consumer crashes with IndexOutOfBoundsException when reading large messages from imported journal</a>.
								</p><p>
									This issue does not affect JBoss EAP 7.1 and later.
								</p></div></li></ol></div><h5><a id="recovering_from_import_messaging_data_failure"/>Recovering from an Import Messaging Data Failure</h5><p>
						If the <code class="literal">import-journal</code> operation fails, you can attempt to recover by using the following steps.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Shut down the JBoss EAP 7.x server.
							</li><li class="listitem">
								Delete all of the messaging journal folders. See <a class="link" href="server_configuration_changes.html#backing_up_messaging_folder_data" title="Backing Up Messaging Folder Data">Backing Up Messaging Folder Data</a> for the management CLI commands to determine the correct directory location for the messaging journal folders.
							</li><li class="listitem">
								If you backed up the target server messaging data prior to the import, copy the messaging folders from the backup location to the messaging journal directory determined in the prior step.
							</li><li class="listitem">
								Repeat the steps to <a class="link" href="server_configuration_changes.html#import_xml_formatted_messaging_data" title="Import the XML Formatted Messaging Data">import the XML formatted messaging data</a>.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="migrate_messaging_data_using_a_jms_bridge"/>Migrate Messaging Data Using a JMS Bridge</h3></div></div></div><p>
						Using this approach, you configure and deploy a JMS bridge to the JBoss EAP 7.x server. The JMS bridge moves messages from the JBoss EAP 6.4 HornetQ queue to the JBoss EAP 7.x ActiveMQ Artemis queue.
					</p><p>
						A JMS bridge consumes messages from a source JMS queue or topic and sends them to a target JMS queue or topic, which is typically on a different server. It can be used to bridge messages between any JMS servers, as long as they are JMS 1.1 compliant. The source and destination JMS resources are looked up using JNDI and the client classes for the JNDI lookup must be bundled in a module. The module name is then declared in the JMS bridge configuration.
					</p><p>
						This section describes how to configure the servers and deploy a JMS bridge to move the messaging data from JBoss EAP 6.4 to JBoss EAP 7.x.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								<a class="link" href="server_configuration_changes.html#migrate_jms_messaging_configure_source_server" title="Configure the Source JBoss EAP 6.4 Server">Configure the source JBoss EAP 6.4 server.</a>
							</li><li class="listitem">
								<a class="link" href="server_configuration_changes.html#migrate_jms_messaging_configure_target_server" title="Configure the Target JBoss EAP 7.x Server">Configure the target JBoss EAP 7.x server.</a>
							</li><li class="listitem">
								<a class="link" href="server_configuration_changes.html#migrate_jms_messaging_migrate_the_data" title="Migrate the Messaging Data">Migrate the messaging data.</a>
							</li></ol></div><h5><a id="migrate_jms_messaging_configure_source_server"/>Configure the Source JBoss EAP 6.4 Server</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Stop the JBoss EAP 6.4 server.
							</li><li class="listitem"><p class="simpara">
								Back up the HornetQ journal and configuration files.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										By default, the HornetQ journal is located in the <code class="literal"><span class="emphasis"><em>EAP6_HOME</em></span>/standalone/data/</code> directory.
									</li><li class="listitem">
										See <a class="link" href="server_configuration_changes.html#migrate_messaging_data_mapping_folder_names" title="Mapping Messaging Folder Names">Mapping Messaging Folder Names</a> for default messaging folder locations for each release.
									</li></ul></div></li><li class="listitem">
								Make sure that the <code class="literal">InQueue</code> JMS queue containing the JMS messages is defined on the JBoss EAP 6.4 server.
							</li><li class="listitem"><p class="simpara">
								Make sure that <code class="literal">messaging</code> subsystem configuration contains an entry for the <code class="literal">RemoteConnectionFactory</code> similar to the following.
							</p><pre class="programlisting">&lt;connection-factory name="RemoteConnectionFactory"&gt;
    &lt;entries&gt;
        &lt;entry name="java:jboss/exported/jms/RemoteConnectionFactory"/&gt;
    &lt;/entries&gt;
    ...
&lt;/connection-factory&gt;</pre><p class="simpara">
								If it does not contain the entry, create one using the following management CLI command:
							</p><pre class="screen">/subsystem=messaging/hornetq-server=default/connection-factory=RemoteConnectionFactory:add(factory-type=XA_GENERIC, connector=[netty], entries=[java:jboss/exported/jms/RemoteConnectionFactory],ha=true,block-on-acknowledge=true,retry-interval=1000,retry-interval-multiplier=1.0,reconnect-attempts=-1)</pre></li></ol></div><h5><a id="migrate_jms_messaging_configure_target_server"/>Configure the Target JBoss EAP 7.x Server</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								The JMS bridge configuration needs the <code class="literal">org.hornetq</code> module to connect to the HornetQ server in the previous release. This module and its direct dependencies are not present in JBoss EAP 7.x, so you must copy the following modules from the previous release.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										Copy the <code class="literal">org.hornetq</code> module into the JBoss EAP 7.x <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/org/</code> directory.
									</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
												If you did not apply patches to this module, copy this folder from the JBoss EAP 6.4 server: <code class="literal"><span class="emphasis"><em>EAP6_HOME</em></span>/modules/system/layers/base/org/hornetq/</code>
											</li><li class="listitem">
												If you did apply patches to this module, copy this folder from the JBoss EAP 6.4 server: <code class="literal"><span class="emphasis"><em>EAP6_HOME</em></span>/modules/system/layers/base/.overlays/layer-base-jboss-eap-6.4.x.CP/org/hornetq/</code>
											</li></ul></div></li><li class="listitem"><p class="simpara">
										Remove the <code class="literal">&lt;resource-root&gt;</code> for the HornetQ <code class="literal">lib</code> path from the JBoss EAP 7.x <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/org/hornetq/main/module.xml</code> file.
									</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
												If you did not apply patches to the JBoss EAP 6.4 <code class="literal">org.hornetq</code> module, remove the following line from the file:
											</p><pre class="programlisting">&lt;resource-root path="lib"/&gt;</pre></li><li class="listitem"><p class="simpara">
												If you did apply patches to the JBoss EAP 6.4 <code class="literal">org.hornetq</code> module, remove the following lines from the file:
											</p><pre class="programlisting">&lt;resource-root path="lib"/&gt;
&lt;resource-root path="../../../../../org/hornetq/main/lib"/&gt;</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
													Failure to remove the HornetQ <code class="literal">lib</code> path <code class="literal">resource-root</code> will cause the bridge to fail with the following error in the log file.
												</p><pre class="screen">2016-07-15 09:32:25,660 ERROR [org.jboss.as.controller.management-operation] (management-handler-thread - 2) WFLYCTL0013: Operation ("add") failed - address: ([
    ("subsystem" =&gt; "messaging-activemq"),
    ("jms-bridge" =&gt; "myBridge")
]) - failure description: "WFLYMSGAMQ0086: Unable to load module org.hornetq"</pre></div></li></ul></div></li><li class="listitem"><p class="simpara">
										Copy the <code class="literal">org.jboss.netty</code> module into the JBoss EAP 7.x <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/org/jboss/</code> directory.
									</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
												If you did not apply patches to this module, copy this folder from the JBoss EAP 6.4 server: <code class="literal"><span class="emphasis"><em>EAP6_HOME</em></span>/modules/system/layers/base/org/jboss/netty/</code>
											</li><li class="listitem">
												If you did apply patches to this module, copy this folder from the JBoss EAP 6.4 server: <code class="literal"><span class="emphasis"><em>EAP6_HOME</em></span>/modules/system/layers/base/.overlays/layer-base-jboss-eap-6.4.x.CP/org/jboss/netty</code>
											</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
								Create the JMS queue to contain the messages received from JBoss EAP 6.4 server. The following is an example of a management CLI command that creates the <code class="literal">MigratedMessagesQueue</code> JMS queue to receive the message.
							</p><pre class="screen">jms-queue add --queue-address=MigratedMessagesQueue --entries=[jms/queue/MigratedMessagesQueue java:jboss/exported/jms/queue/MigratedMessagesQueue]</pre><p class="simpara">
								This creates the following <code class="literal">jms-queue</code> configuration for the default server in the <code class="literal">messaging-activemq</code> subsystem of the JBoss EAP 7.x server.
							</p><pre class="programlisting">&lt;jms-queue name="MigratedMessagesQueue" entries="jms/queue/MigratedMessagesQueue java:jboss/exported/jms/queue/MigratedMessagesQueue"/&gt;</pre></li><li class="listitem"><p class="simpara">
								Make sure that <code class="literal">messaging-activemq</code> subsystem <code class="literal">default</code> server contains a configuration for the <code class="literal">InVmConnectionFactory</code> <code class="literal">connection-factory</code> similar to the following:
							</p><pre class="programlisting">&lt;connection-factory name="InVmConnectionFactory" factory-type="XA_GENERIC" entries="java:/ConnectionFactory" connectors="in-vm"/&gt;</pre><p class="simpara">
								If it does not contain the entry, create one using the following management CLI command:
							</p><pre class="screen">/subsystem=messaging-activemq/server=default/connection-factory=InVmConnectionFactory:add(factory-type=XA_GENERIC, connectors=[in-vm], entries=[java:/ConnectionFactory])</pre></li><li class="listitem"><p class="simpara">
								Create and deploy a JMS bridge that reads messages from the <code class="literal">InQueue</code> JMS queue configured on the JBoss EAP 6.4 server and transfers them to the <code class="literal">MigratedMessagesQueue</code> configured on the JBoss EAP 7.x server.
							</p><pre class="screen">/subsystem=messaging-activemq/jms-bridge=myBridge:add(add-messageID-in-header=true,max-batch-time=100,max-batch-size=10,max-retries=-1,failure-retry-interval=1000,quality-of-service=AT_MOST_ONCE,module=org.hornetq,source-destination=jms/queue/InQueue,source-connection-factory=jms/RemoteConnectionFactory,source-context=[("java.naming.factory.initial"=&gt;"org.wildfly.naming.client.WildFlyInitialContextFactory"),("java.naming.provider.url"=&gt;"remote://127.0.0.1:4447")],target-destination=jms/queue/MigratedMessagesQueue,target-connection-factory=java:/ConnectionFactory)</pre><p class="simpara">
								This creates the following <code class="literal">jms-bridge</code> configuration in the <code class="literal">messaging-activemq</code> subsystem of the JBoss EAP 7.x server.
							</p><pre class="programlisting">&lt;jms-bridge name="myBridge" add-messageID-in-header="true" max-batch-time="100" max-batch-size="10" max-retries="-1" failure-retry-interval="1000" quality-of-service="AT_MOST_ONCE" module="org.hornetq"&gt;
    &lt;source destination="jms/queue/InQueue" connection-factory="jms/RemoteConnectionFactory"&gt;
        &lt;source-context&gt;
            &lt;property name="java.naming.factory.initial" value="org.wildfly.naming.client.WildFlyInitialContextFactory"/&gt;
            &lt;property name="java.naming.provider.url" value="remote://127.0.0.1:4447"/&gt;
        &lt;/source-context&gt;
    &lt;/source&gt;
    &lt;target destination="jms/queue/MigratedMessagesQueue" connection-factory="java:/ConnectionFactory"/&gt;
&lt;/jms-bridge&gt;</pre></li><li class="listitem">
								If security is configured for JBoss EAP 6.4, you must also configure the JMS bridge configuration <code class="literal">&lt;source&gt;</code> element to include a <code class="literal">source-context</code> that specifies the correct user name and password to use for the JNDI lookup when creating the connection.
							</li></ol></div><h5><a id="migrate_jms_messaging_migrate_the_data"/>Migrate the Messaging Data</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Verify that the information you provided for the following configurations is correct.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										Any queue and topic names.
									</li><li class="listitem">
										The <code class="literal">java.naming.provider.url</code> for JNDI lookup.
									</li></ul></div></li><li class="listitem">
								Make sure that you have deployed the target JMS destination to the JBoss EAP 7.x server.
							</li><li class="listitem">
								Start both the JBoss EAP 6.4 and JBoss EAP 7.x servers.
							</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="migrate_messaging_data_mapping_folder_names"/>Mapping Messaging Folder Names</h3></div></div></div><p>
						The following table shows the messaging directory names used in the previous release and the corresponding names used in the current release of JBoss EAP. The directories are relative to the <code class="literal">jboss.server.data.dir</code> directory, which defaults to <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/data/</code> if it is not specified.
					</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">JBoss EAP 6.4 Directory Name</th><th style="text-align: left" valign="top">JBoss EAP 7.x Directory Name</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">messagingbindings/</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">activemq/bindings/</code>
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">messagingjournal/</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">activemq/journal/</code>
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">messaginglargemessages/</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">activemq/largemessages/</code>
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">messagingpaging/</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">activemq/paging/</code>
									</p>
									 </td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The <code class="literal">messaginglargemessages/</code> and <code class="literal">messagingpaging/</code> directories might not be present if there are no large messages or if paging is disabled.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backing_up_messaging_folder_data"/>Backing Up Messaging Folder Data</h3></div></div></div><p>
						If your target server has already processed messages, it is a good idea to back up the target message folders to a backup location before you begin. The default location of the messaging folders is <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/data/activemq/</code>; however it is configurable. If you are not sure of the location of your messaging data, you can use the following management CLI commands to find the location of the messaging folders.
					</p><pre class="screen">/subsystem=messaging-activemq/server=default/path=journal-directory:resolve-path
/subsystem=messaging-activemq/server=default/path=paging-directory:resolve-path
/subsystem=messaging-activemq/server=default/path=bindings-directory:resolve-path
/subsystem=messaging-activemq/server=default/path=large-messages-directory:resolve-path</pre><p>
						Once you know the location of the folders, copy each folder to a safe backup location.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_jms_destinations"/>Migrate JMS Destinations</h2></div></div></div><p>
					In JBoss EAP 6, JMS destination queues were configured in the <code class="literal">&lt;jms-destinations&gt;</code> element under the <code class="literal">&lt;hornetq-server&gt;</code> element in the <code class="literal">messaging</code> subsystem.
				</p><pre class="programlisting">&lt;hornetq-server&gt;
  ...
  &lt;jms-destinations&gt;
     &lt;jms-queue name="testQueue"&gt;
        &lt;entry name="queue/test"/&gt;
         &lt;entry name="java:jboss/exported/jms/queue/test"/&gt;
      &lt;/jms-queue&gt;
  &lt;/jms-destinations&gt;
  ...
&lt;/hornetq-server&gt;</pre><p>
					In JBoss EAP 7, the JMS destination queue is configured in the default <code class="literal">&lt;server&gt;</code> element of the <code class="literal">messaging-activemq</code> subsystem.
				</p><pre class="programlisting">&lt;server name="default"&gt;
  ...
  &lt;jms-queue name="testQueue" entries="queue/test java:jboss/exported/jms/queue/test"/&gt;
  ...
&lt;/server&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_messaging_interceptors"/>Migrate Messaging Interceptors</h2></div></div></div><p>
					Messaging interceptors have changed significantly in JBoss EAP 7 with the replacement of HornetQ with ActiveMQ Artemis as the JMS messaging provider.
				</p><p>
					The HornetQ <code class="literal">messaging</code> subsystem included in the previous release of JBoss EAP required that you install the HornetQ interceptors by adding them to a JAR and then modifying the HornetQ <code class="literal">module.xml</code> file.
				</p><p>
					The <code class="literal">messaging-activemq</code> subsystem included in JBoss EAP 7 does not require modification of a <code class="literal">module.xml</code> file. User interceptor classes, which now implement the Apache ActiveMQ Artemis <a class="link" href="https://activemq.apache.org/artemis/docs/javadocs/javadoc-1.2.0/org/apache/activemq/artemis/api/core/Interceptor.html">Interceptor</a> interface, can now be loaded from any server module. You specify the module from which the interceptor should be loaded in the <code class="literal">messaging-activemq</code> subsystem of the server configuration file.
				</p><div class="title"><strong>Example: Interceptor Configuration</strong></div><p>
						
</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:4.0"&gt;
  &lt;server name="default"&gt;
    ...
    &lt;incoming-interceptors&gt;
      &lt;class name="com.mycompany.incoming.myInterceptor" module="com.mycompany" /&gt;
      &lt;class name="com.othercompany.incoming.myOtherInterceptor" module="com.othercompany" /&gt;
    &lt;/incoming-interceptors&gt;
    &lt;outgoing-interceptors&gt;
      &lt;class name="com.mycompany.outgoing.myInterceptor" module="com.mycompany" /&gt;
      &lt;class name="com.othercompany.outgoing.myOtherInterceptor" module="com.othercompany" /&gt;
    &lt;/outgoing-interceptors&gt;
  &lt;/server&gt;
&lt;/subsystem&gt;</pre><p>

					</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_netty_servlet_configuration"/>Replace Netty Servlet Configuration</h2></div></div></div><p>
					In JBoss EAP 6, you could configure a servlet engine to work with the Netty Servlet transport. Because ActiveMQ Artemis replaces HornetQ as the built-in messaging provider in JBoss EAP 7, this configuration is no longer available. You must replace the servlet configuration to use the new built-in messaging HTTP connectors and HTTP acceptors instead.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_generic_jms_resource_adapter"/>Configuring a Generic JMS Resource Adapter</h2></div></div></div><p>
					The way you configure a generic JMS resource adapter for use with a third-party JMS provider has changed in JBoss EAP 7. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#deploy_configure_generic_jms_resource_adapter">Deploying a Generic JMS Resource Adapter</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="messaging_configuration_changes"/>Messaging Configuration Changes</h2></div></div></div><p>
					In JBoss EAP 7.0, if you configured the <code class="literal">replication-master</code> policy without specifying the <code class="literal">check-for-live-server</code> attribute, its default value was <code class="literal">false</code>. This has changed in JBoss EAP 7.1 and later. The default value for the <code class="literal">check-for-live-server</code> attribute is now <code class="literal">true</code>.
				</p><p>
					The following is an example of a management CLI command that configures the <code class="literal">replication-master</code> policy without specifying the <code class="literal">check-for-live-server</code> attribute.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/ha-policy=replication-master:add(cluster-name=my-cluster,group-name=group1)</pre><p>
					When you read the resource using the management CLI, note that the <code class="literal">check-for-live-server</code> attribute value is set to <code class="literal">true</code>.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/ha-policy=replication-master:read-resource(recursive=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "check-for-live-server" =&gt; true,
        "cluster-name" =&gt; "my-cluster",
        "group-name" =&gt; "group1",
        "initial-replication-sync-timeout" =&gt; 30000L
    },
    "response-headers" =&gt; {"process-state" =&gt; "reload-required"}
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_messaging_changes_in_jms_serialization_behavior"/>Changes in JMS Serialization Behavior Between Releases</h2></div></div></div><p>
					The <code class="literal">serialVersionUID</code> of <a class="link" href="https://docs.oracle.com/javaee/6/api/javax/jms/JMSException.html"><code class="literal">javax.jms.JMSException</code></a> changed between JMS 1.1 and JMS 2.0.0. This means that if an instance of a <code class="literal">JMSException</code>, or any of its subclasses, is serialized using JMS 1.1, it cannot be deserialized using JMS 2.0.0. The reverse is also true. If an instance of <code class="literal">JMSException</code> is serialized using JMS 2.0.0, it cannot be deserialized using JMS 1.1. In both of these cases, it throws an exception similar to the following:
				</p><pre class="screen">javax.jms.JMSException: javax.jms.JMSException; local class incompatible: stream classdesc serialVersionUID = 8951994251593378324, local class serialVersionUID = 2368476267211489441</pre><p>
					This issue is fixed in the JMS 2.0.1 maintenance release.
				</p><p>
					The following table details the JMS implementation for each JBoss EAP release.
				</p><div class="table"><a id="migration_jms_implementation_for_each_eap_release"/><p class="title"><strong>Table 4.4. JMS Implementation for Each JBoss EAP Release</strong></p><div class="table-contents"><table summary="JMS Implementation for Each JBoss EAP Release" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">JBoss EAP Version</th><th style="text-align: left" valign="top">JMS Implementation</th><th style="text-align: left" valign="top">JMS version</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									6.4
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									HornetQ
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									JMS 1.1
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									7.0
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Apache ActiveMQ Artemis
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									JMS 2.0.0
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									7.1 and later
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Apache ActiveMQ Artemis
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									JMS 2.0.1 or later
								</p>
								 </td></tr></tbody></table></div></div><p>
					Be aware that the <code class="literal">serialVersionUID</code> incompatibility can result in a migration issue in the following situations:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							If you send a message that contains a <code class="literal">JMSException</code> using a JBoss EAP 6.4 client, migrate your messaging data to JBoss EAP 7.0, and then attempt to deserialize that message using a JBoss EAP 7.0 client, the deserialization will fail and it will throw an exception. This is because the <code class="literal">serialVersionUID</code> in JMS 1.1 is <span class="emphasis"><em>not</em></span> compatible with the one in JMS 2.0.0.
						</li><li class="listitem">
							If you send a message that contains a <code class="literal">JMSException</code> using a JBoss EAP 7.0 client, migrate your messaging data to JBoss EAP 7.1 or later, and then attempt to deserialize that message using a JBoss EAP 7.1 or later client, the deserialization will fail and it will throw an exception. This is because the <code class="literal">serialVersionUID</code> in JMS 2.0.0 is <span class="emphasis"><em>not</em></span> compatible with the one in JMS 2.0.1 or later.
						</li></ul></div><p>
					Note that if you send a message that contains a <code class="literal">JMSException</code> using a JBoss EAP 6.4 client, migrate your messaging data to JBoss EAP 7.1 or later, and then attempt to deserialize that message using a JBoss EAP 7.1 or later client, the deserialization will succeed because the <code class="literal">serialVersionUID</code> in JMS 1.1 is compatible with the one in JMS 2.0.1 or later.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Red Hat recommends that you do the following before you migrate your messaging data:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Be sure to consume all JMS 1.1 messages that contain JMSExceptions before migrating messaging data from JBoss EAP 6.4 to JBoss EAP 7.0.
							</li><li class="listitem">
								Be sure to consume all JMS 2.0.0 messages that contain JMSExceptions before migrating messaging data from JBoss EAP 7.0 to JBoss EAP 7.1 or later.
							</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_jmx_management_changes"/>JMX Management Changes</h1></div></div></div><p>
				The HornetQ component in JBoss EAP 6 provided its own JMX management; however, it was not recommended and is now deprecated and no longer supported. If you relied on this feature in JBoss EAP 6, you must migrate your management tooling to use either the JBoss EAP management CLI or the JMX management provided with JBoss EAP 7.
			</p><p>
				You must also upgrade your client libraries to use the <code class="literal">jboss-client.jar</code> that ships with JBoss EAP 7.
			</p><p>
				The following is an example of HornetQ JMX management code that was used in JBoss EAP 6.
			</p><pre class="programlisting">JMXConnector connector = null;
try {
    HashMap environment = new HashMap();
    String[] credentials = new String[]{"admin", "Password123!"};
    environment.put(JMXConnector.CREDENTIALS, credentials);

    // HornetQ used the protocol "remoting-jmx" and port "9999"
    JMXServiceURL beanServerUrl = new JMXServiceURL("service:jmx:remoting-jmx://127.0.0.1:9999");

    connector = JMXConnectorFactory.connect(beanServerUrl, environment);
    MBeanServerConnection mbeanServer = connector.getMBeanServerConnection();

    // The JMX object name pointed to the HornetQ JMX management
    ObjectName objectName = new ObjectName("org.hornetq:type=Server,module=JMS");

    // The invoked method name was "listConnectionIDs"
    String[] connections = (String[]) mbeanServer.invoke(objectName, "listConnectionIDs", new Object[]{}, new String[]{});
    for (String connection : connections) {
        System.out.println(connection);
    }
} finally {
    if (connector != null) {
      connector.close();
   }
}</pre><p>
				The following is an example of the equivalent code needed for ActiveMQ Artemis in JBoss EAP 7.
			</p><pre class="programlisting">JMXConnector connector = null;
try {
    HashMap environment = new HashMap();
    String[] credentials = new String[]{"admin", "Password123!"};
    environment.put(JMXConnector.CREDENTIALS, credentials);

    // ActiveMQ Artemis uses the protocol "remote+http" and port "9990"
    JMXServiceURL beanServerUrl = new JMXServiceURL("service:jmx:remote+http://127.0.0.1:9990");

    connector = JMXConnectorFactory.connect(beanServerUrl, environment);
    MBeanServerConnection mbeanServer = connector.getMBeanServerConnection();

    // The JMX object name points to the new JMX management in the `messaging-activemq` subsystem
    ObjectName objectName = new ObjectName("jboss.as:subsystem=messaging-activemq,server=default");

    // The invoked method name is now "listConnectionIds"
    String[] connections = (String[]) mbeanServer.invoke(objectName, "listConnectionIds", new Object[]{}, new String[]{});
    for (String connection : connections) {
        System.out.println(connection);
    }
} finally {
    if (connector != null) {
      connector.close();
   }
}</pre><p>
				Notice that the method names and parameters have changed in the new implementation. You can find the new method names in the JConsole by following these steps.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Connect to the JConsole using the following command.
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jconsole.sh</pre></li><li class="listitem">
						Connect to JBoss EAP local process. Note that it should start with "jboss-modules.jar".
					</li><li class="listitem">
						In the <span class="strong"><strong>MBeans</strong></span> tab, choose <span class="strong"><strong>jboss.as</strong></span> → <span class="strong"><strong>messaging-activemq</strong></span> → <span class="strong"><strong>default</strong></span> → <span class="strong"><strong>Operations</strong></span> to display the list of method names and attributes.
					</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_orb_server_configuration_changes"/>ORB Server Configuration Changes</h1></div></div></div><p>
				The JacORB implementation has been replaced with a downstream branch of the OpenJDK ORB in JBoss EAP 7.
			</p><p>
				The <code class="literal">org.jboss.as.jacorb</code> extension module, located in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/system/layers/base/</code>, has been replaced by the <code class="literal">org.wildfly.iiop-openjdk</code> extension module.
			</p><p>
				The <code class="literal">urn:jboss:domain:jacorb:1.4</code> subsystem configuration namespace in the server configuration file has been replaced by the <code class="literal">urn:jboss:domain:iiop-openjdk:2.1</code> namespace.
			</p><p>
				The following is an example of the default <code class="literal">jacorb</code> system configuration in JBoss EAP 6.
			</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:jacorb:1.4"&gt;
    &lt;orb socket-binding="jacorb" ssl-socket-binding="jacorb-ssl"&gt;
        &lt;initializers security="identity" transactions="spec"/&gt;
    &lt;/orb&gt;
&lt;/subsystem&gt;</pre><p>
				The following is an example of the default <code class="literal">iiop-openjdk</code> subsystem configuration in JBoss EAP 7.
			</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:iiop-openjdk:2.1"&gt;
    &lt;orb socket-binding="jacorb" ssl-socket-binding="jacorb-ssl" /&gt;
    &lt;initializers security="identity" transactions="spec" /&gt;
&lt;/subsystem&gt;</pre><p>
				The new <code class="literal">iiop-openjdk</code> subsystem configuration accepts only a subset of the legacy elements and attributes. The following is an example of a <code class="literal">jacorb</code> subsystem configuration in the previous release of JBoss EAP that contains all valid elements and attributes:
			</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:jacorb:1.4"&gt;
   &lt;orb name="JBoss" print-version="off" use-imr="off" use-bom="off"  cache-typecodes="off"
       cache-poa-names="off" giop-minor-version="2" socket-binding="jacorb" ssl-socket-binding="jacorb-ssl"&gt;
       &lt;connection retries="5" retry-interval="500" client-timeout="0" server-timeout="0"
           max-server-connections="500" max-managed-buf-size="24" outbuf-size="2048"
           outbuf-cache-timeout="-1"/&gt;
       &lt;initializers security="off" transactions="spec"/&gt;
   &lt;/orb&gt;
   &lt;poa monitoring="off" queue-wait="on" queue-min="10" queue-max="100"&gt;
       &lt;request-processors pool-size="10" max-threads="32"/&gt;
   &lt;/poa&gt;
   &lt;naming root-context="JBoss/Naming/root" export-corbaloc="on"/&gt;
   &lt;interop sun="on" comet="off" iona="off" chunk-custom-rmi-valuetypes="on"
       lax-boolean-encoding="off" indirection-encoding-disable="off" strict-check-on-tc-creation="off"/&gt;
   &lt;security support-ssl="off" add-component-via-interceptor="on" client-supports="MutualAuth"
       client-requires="None" server-supports="MutualAuth" server-requires="None"/&gt;
   &lt;properties&gt;
       &lt;property name="some_property" value="some_value"/&gt;
   &lt;/properties&gt;
&lt;/subsystem&gt;</pre><p>
				The following element attributes are no longer supported and must be removed.
			</p><div class="table"><a id="idm139952481667184"/><p class="title"><strong>Table 4.5. Attributes to Remove</strong></p><div class="table-contents"><table summary="Attributes to Remove" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Element</th><th style="text-align: left" valign="top">Unsupported Attributes</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								&lt;orb&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										client-timeout
									</li><li class="listitem">
										max-managed-buf-size
									</li><li class="listitem">
										max-server-connections
									</li><li class="listitem">
										outbuf-cache-timeout
									</li><li class="listitem">
										outbuf-size
									</li><li class="listitem">
										connection retries
									</li><li class="listitem">
										retry-interval
									</li><li class="listitem">
										name
									</li><li class="listitem">
										server-timeout
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								&lt;poa&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										queue-min
									</li><li class="listitem">
										queue-max
									</li><li class="listitem">
										pool-size
									</li><li class="listitem">
										max-threads
									</li></ul></div>
							 </td></tr></tbody></table></div></div><p>
				The following <code class="literal">on/off</code> attributes are no longer supported and will not be migrated when you run the management CLI <code class="literal">migrate</code> operation. If they are set to <code class="literal">on</code>, you will get a migration warning. Other <code class="literal">on/off</code> attributes that are not mentioned in this table, for example <code class="literal">&lt;security support-ssl="on|off"&gt;</code>, are still supported and will be migrated successfully. The only difference is that their values will be changed from <code class="literal">on/off</code> to <code class="literal">true/false</code>.
			</p><div class="table"><a id="idm139952481634832"/><p class="title"><strong>Table 4.6. Attributes to Turn Off or Remove</strong></p><div class="table-contents"><table summary="Attributes to Turn Off or Remove" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Element</th><th style="text-align: left" valign="top">Attributes to Set to Off</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								&lt;orb&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										cache-poa-names
									</li><li class="listitem">
										cache-typecodes
									</li><li class="listitem">
										print-version
									</li><li class="listitem">
										use-bom
									</li><li class="listitem">
										use-imr
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								&lt;interop&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								(all except <code class="literal">sun</code>)
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										comet
									</li><li class="listitem">
										iona
									</li><li class="listitem">
										chunk-custom-rmi-valuetypes
									</li><li class="listitem">
										indirection-encoding-disable
									</li><li class="listitem">
										lax-boolean-encoding
									</li><li class="listitem">
										strict-check-on-tc-creation
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								&lt;poa&gt;
							</p>
							 </td><td style="text-align: left" valign="top"> <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										monitoring
									</li><li class="listitem">
										queue-wait
									</li></ul></div>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_threads_subsystem_configuration"/>Migrate the Threads Subsystem Configuration</h1></div></div></div><p>
				The JBoss EAP 6 server configuration included a <code class="literal">threads</code> subsystem that was used to manage thread pools across the various subsystems in the server.
			</p><p>
				The <code class="literal">threads</code> subsystem is no longer available in JBoss EAP 7. Instead, each subsystem is responsible for managing its own thread pools.
			</p><p>
				For information about how to configure thread pools for the <code class="literal">infinispan</code> subsystem, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_infinispan_thread_pools">Configure Infinispan Thread Pools</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><p>
				For information about how to configure thread pools for the <code class="literal">jgroups</code> subsystem, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_jgroups_thread_pools">Configure JGroups Thread Pools</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><p>
				In JBoss EAP 6, you configured thread pools for connectors and listeners for the <code class="literal">web</code> subsystem by referencing an <code class="literal">executor</code> that was defined in the <code class="literal">threads</code> subsystem. In JBoss EAP 7, you now configure thread pools for the <code class="literal">undertow</code> subsystem by referencing a <code class="literal">worker</code> that is defined in the <code class="literal">io</code> subsystem. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configuring_the_io_subsystem">Configuring the IO Subsystem</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><p>
				For information about about changes to thread pool configuration in the <code class="literal">remoting</code> subsystem, see <a class="link" href="server_configuration_changes.html#migrate_the_remoting_subsystem_configuration" title="Migrate the Remoting Subsystem Configuration">Migrate the Remoting Subsystem Configuration</a> in this guide, and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#remoting_configure_endpoint">Configuring the Endpoint</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_the_remoting_subsystem_configuration"/>Migrate the Remoting Subsystem Configuration</h1></div></div></div><p>
				In JBoss EAP 6, you configured the thread pool for the <code class="literal">remoting</code> subsystem by setting various <code class="literal">worker-*</code> attributes. The worker thread pool is no longer configured in the <code class="literal">remoting</code> subsystem in JBoss EAP 7 and if you attempt to modify the existing configuration, you will see the following message.
			</p><pre class="screen">WFLYRMT0022: Worker configuration is no longer used, please use endpoint worker configuration</pre><p>
				In JBoss EAP 7, the worker thread pool is replaced by an endpoint configuration that references a <code class="literal">worker</code> defined in the <code class="literal">io</code> subsystem.
			</p><p>
				For information about how to configure the endpoint, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#remoting_configure_endpoint">Configuring the Endpoint</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_websocket_server_configuration_changes"/>WebSocket Server Configuration Changes</h1></div></div></div><p>
				To use WebSockets in JBoss EAP 6, you had to enable the non blocking Java NIO2 connector protocol for the <code class="literal">http</code> connector in the <code class="literal">web</code> subsystem of the JBoss EAP server configuration file using a command similar to the following.
			</p><pre class="screen">/subsystem=web/connector=http/:write-attribute(name=protocol,value=org.apache.coyote.http11.Http11NioProtocol)</pre><p>
				To use WebSockets in an application, you also had to create a <code class="literal">&lt;enable-websockets&gt;</code> element in the application <code class="literal">WEB-INF/jboss-web.xml</code> file and set it to <code class="literal">true</code>.
			</p><p>
				In JBoss EAP 7, you no longer need to configure the server for default WebSocket support or configure the application to use it. WebSockets are a requirement of the Java EE 7 specification and the required protocols are configured by default. More complex WebSocket configuration is done in the <code class="literal">servlet-container</code> of the <code class="literal">undertow</code> subsystem of the JBoss EAP server configuration file. You can view the available settings using the following command.
			</p><pre class="screen">/subsystem=undertow/servlet-container=default/setting=websockets:read-resource(recursive=true)
{
   "outcome" =&gt; "success",
   "result" =&gt; {
       "buffer-pool" =&gt; "default",
       "dispatch-to-worker" =&gt; true,
       "worker" =&gt; "default"
   }
}</pre><p>
				For more information about WebSocket development, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#creating_websocket_applications">Creating WebSocket Applications</a> in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>.
			</p><p>
				WebSocket code examples can also be found in the quickstarts that ship with JBoss EAP.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_single_sign_on_server_changes"/>Single Sign-on Server Changes</h1></div></div></div><p>
				The <code class="literal">infinispan</code> subsystem still provides distributed caching support for HA services in the form of Infinispan caches in JBoss EAP 7; however the caching and distribution of authentication information is handled differently than in previous releases.
			</p><p>
				In JBoss EAP 6, if single sign-on (SSO) was not provided an Infinispan cache, the cache was not distributed.
			</p><p>
				In JBoss EAP 7, SSO is distributed automatically when you select the HA profile. When running the HA profile, each host has its own Infinispan cache, which is based on the default cache of the web cache container. This cache stores the relevant session and SSO cookie information for the host. JBoss EAP handles propagation of individual cache information to all hosts. There is no way to specifically assign an Infinispan cache to SSO in JBoss EAP 7.
			</p><p>
				In JBoss EAP 7, SSO is configured in the <code class="literal">undertow</code> subsystem of the server configuration file.
			</p><p>
				There are no application code changes required for SSO when migrating to JBoss EAP 7.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_datasource_configuration_changes"/>DataSource Configuration Changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jdbc_datasource_driver_name"/>JDBC Datasource Driver Name</h2></div></div></div><p>
					When you configured a datasource in the previous release of JBoss EAP, the value specified for the driver name depended on the number of classes listed in the <code class="literal">META-INF/services/java.sql.Driver</code> file contained in the JDBC driver JAR.
				</p><h4><a id="driver_containing_a_single_class"/>Driver Containing a Single Class</h4><p>
					If the <code class="literal">META-INF/services/java.sql.Driver</code> file specified only one class, the driver name value was simply the name of the JDBC driver JAR. This has not changed in JBoss EAP 7.
				</p><h4><a id="driver_containing_multiple_classes"/>Driver Containing Multiple Classes</h4><p>
					IIn JBoss EAP 6, if there was more than one class listed in <code class="literal">META-INF/services/java.sql.Driver</code> file, you specified which class was the driver class by appending its name to the JAR name, along with the major and minor version, in the following format.
				</p><pre class="screen"><span class="emphasis"><em>JAR_NAME</em></span> + <span class="emphasis"><em>DRIVER_CLASS_NAME</em></span> + "_" + <span class="emphasis"><em>MAJOR_VERSION</em></span> + "_" + <span class="emphasis"><em>MINOR_VERSION</em></span></pre><p>
					In JBoss EAP 7, this has changed. You now specify the driver name using the following format.
				</p><pre class="screen"><span class="emphasis"><em>JAR_NAME</em></span> + "_" + <span class="emphasis"><em>DRIVER_CLASS_NAME</em></span> + "_" + <span class="emphasis"><em>MAJOR_VERSION</em></span> + "_" + <span class="emphasis"><em>MINOR_VERSION</em></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						An underscore has been added between the <span class="emphasis"><em>JAR_NAME</em></span> and the <span class="emphasis"><em>DRIVER_CLASS_NAME</em></span>.
					</p></div><p>
					The MySQL 5.1.31 JDBC driver is an example of a driver that contains two classes. The driver class name is <code class="literal">com.mysql.jdbc.Driver</code>. The following examples demonstrate the differences between how you specify the driver name in the previous and current release of JBoss EAP.
				</p><div class="title"><strong>Example: JBoss EAP 6 Driver Name</strong></div><p>
						
</p><pre class="screen">mysql-connector-java-5.1.31-bin.jarcom.mysql.jdbc.Driver_5_1</pre><p>

					</p><div class="title"><strong>Example: JBoss EAP 7 Driver Name</strong></div><p>
						
</p><pre class="screen">mysql-connector-java-5.1.31-bin.jar_com.mysql.jdbc.Driver_5_1</pre><p>

					</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_security_server_changes"/>Security Server Configuration Changes</h1></div></div></div><p>
				If you migrate to JBoss EAP 7 and plan to run with the Java Security Manager enabled, you should be aware that changes were made in the way policies are defined and that additional configuration changes might be needed. Also be aware that custom security managers are not supported in JBoss EAP 7.
			</p><p>
				For information about Java Security Manager server configuration changes, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#java-security-manager-migration-considerations">Considerations Moving from Previous Versions</a> in <span class="emphasis"><em>How to Configure Server Security</em></span> for JBoss EAP.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changes_in_security_subsystem_legacy_behavior"/>Changes in Legacy Security Behavior between JBoss EAP 7.0 and JBoss EAP 7.1</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="http-status-change-for-unreachable-ldap-realms"/>HTTP Status Change for Unreachable LDAP Realms</h3></div></div></div><p>
						If no LDAP realm was reachable by the server in JBoss EAP 7.0, the <code class="literal">security</code> subsystem returned an HTTP status code of "401 Unauthorized".
					</p><p>
						The legacy <code class="literal">security</code> subsystem in JBoss EAP 7.1 and later instead return an HTTP status code of "500 Internal Error" to more accurately describe that an unexpected condition occurred that prevented the server from successfully processing the request.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="enabling_ldap_security_realm_parse_roles_from_dn"/>Enabling the LDAP Security Realm to Parse Roles from a DN</h3></div></div></div><p>
						In JBoss EAP 7.0, the <code class="literal">org.jboss.as.domain.management.security.parseGroupNameFromLdapDN</code> system property was used to enable the LDAP security realm to parse for roles from a DN. When this property was set to <code class="literal">true</code>, roles were parsed from a DN. Otherwise, a normal LDAP search was used to search for roles.
					</p><p>
						In JBoss EAP 7.1 and later, this system property is deprecated. Instead, you configure this option by setting the newly introduced <code class="literal">parse-group-name-from-dn</code> attribute to <code class="literal">true</code> in the core service path using the following management CLI command:
					</p><pre class="screen">/core-service=management/security-realm=<span class="emphasis"><em>REALM_NAME</em></span>/authorization=ldap/group-search=principal-to-group:add(parse-group-name-from-dn=true)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="changes_sending_eap_ssl_certificate_to_ldap_server"/>Changes in Sending the JBoss EAP SSL Certificate to an LDAP Server</h3></div></div></div><p>
						In JBoss EAP 7.0, when the management interface is configured to use the <code class="literal">ldapSSL</code> security realm, mutual authentication between the server and LDAP can fail, resulting in an authentication failure in the management interface. This is because two different LDAP connections are made, each by a different thread, and they do not share the SSL sessions.
					</p><p>
						JBoss EAP 7.1 introduced a new boolean <code class="literal">always-send-client-cert</code> management attribute on the LDAP <code class="literal">outbound-connection</code>. This option allows configuration of outbound LDAP connections to support LDAP servers that are configured to always require a client certificate.
					</p><p>
						LDAP authentication happens in two steps:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								It searches for the account.
							</li><li class="listitem">
								It verifies the credentials.
							</li></ol></div><p>
						By default, the <code class="literal">always-send-client-cert</code> attribute is set to <code class="literal">false</code>, meaning the client SSL certificate is sent only with the first search account request. When this attribute is set to <code class="literal">true</code>, the JBoss EAP LDAP client sends the client certificate to the LDAP server with both the search and verification requests.
					</p><p>
						You can set this attribute to <code class="literal">true</code> using the following management CLI command.
					</p><pre class="screen">/core-service=management/ldap-connection=my-ldap-connection:write-attribute(name=always-send-client-cert,value=true)</pre><p>
						This results in the following LDAP outbound connection in the server configuration file.
					</p><pre class="programlisting">&lt;management&gt;
  ....
  &lt;outbound-connections&gt;
    &lt;ldap name="my-ldap-connection" url="ldap://127.0.0.1:389" search-dn="cn=search,dc=myCompany,dc=com" search-credential="myPass" always-send-client-cert="true"/&gt;
  &lt;/outbound-connections&gt;
  ....
&lt;/management&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrate_fips_mode_changes"/>FIPS Mode Changes</h2></div></div></div><p>
					If you are running in FIPS mode, be aware that the default behavior has changed between JBoss EAP 7.0 and JBoss EAP 7.1.
				</p><p>
					When using legacy security realms, JBoss EAP 7.1 and later provide the automatic generation of a self-signed certificate for development purposes. This feature, which was not available in JBoss EAP 7.0, is enabled by default. This means that if you are running in FIPS mode, you must configure the server to disable automatic self-signed certificate creation. Otherwise, you might see the following error when you start the server.
				</p><pre class="screen">ERROR [org.xnio.listener] (default I/O-6) XNIO001007: A channel event listener threw an exception: java.lang.RuntimeException: WFLYDM0114: Failed to lazily initialize SSL context
...
Caused by: java.lang.RuntimeException: WFLYDM0112: Failed to generate self signed certificate
...
Caused by: java.security.KeyStoreException: Cannot get key bytes, not PKCS#8 encoded</pre><p>
					For information about automatic self-signed certificate creation, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#automatic_self_signed_cert_creation">Automatic Self-signed Certificate Creation for Applications</a> in <span class="emphasis"><em>How to Configure Server Security</em></span> for JBoss EAP.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_transactions_subsystem_changes"/>Transactions Subsystem Changes</h1></div></div></div><p>
				Some Transaction Manager configuration attributes that were available in the <code class="literal">transactions</code> subsystem in JBoss EAP 6 have changed in JBoss EAP 7.
			</p><h3><a id="removed_transactions_subsystem_attributes"/>Removed Transactions Subsystem Attributes</h3><p>
				The following table lists the JBoss EAP 6 attributes that were removed from the <code class="literal">transactions</code> subsystem in JBoss EAP 7 and the equivalent replacement attributes.
			</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute in JBoss EAP 6</th><th style="text-align: left" valign="top">Replacement in JBoss EAP 7</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								path
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								object-store-path
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								relative-to
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								object-store-relative-to
							</p>
							 </td></tr></tbody></table></div><h3><a id="deprecated_transactions_subsystem_attributes"/>Deprecated Transactions Subsystem Attributes</h3><p>
				The following attributes that were available in the <code class="literal">transactions</code> subsystem in JBoss EAP 6 are deprecated in JBoss EAP 7. The deprecated attributes might be removed in a future release of the product. The following table lists the equivalent replacement attributes.
			</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute in JBoss EAP 6</th><th style="text-align: left" valign="top">Replacement in JBoss EAP 7</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								use-hornetq-store
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								use-journal-store
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								hornetq-store-enable-async-io
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								journal-store-enable-async-io
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								enable-statistics
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								statistics-enabled
							</p>
							 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="migrate_mod_cluster_changes"/>Changes to mod_cluster Configuration</h1></div></div></div><p>
				The configuration for static proxy lists in mod_cluster has changed in JBoss EAP 7.
			</p><p>
				In JBoss EAP 6, you configured the <code class="literal">proxy-list</code> attribute, which was a comma-separated list of httpd proxy addresses specified in the format of <code class="literal">hostname:port</code>.
			</p><p>
				The <code class="literal">proxy-list</code> attribute is deprecated in JBoss EAP 7. It has been replaced by the <code class="literal">proxies</code> attribute, which is a list of outbound socket binding names.
			</p><p>
				This change impacts how you define a static proxy list, for example, when disabling advertising for mod_cluster. For information about how to disable advertising for mod_cluster, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#disable_advertising_mod_cluster">Disable Advertising for mod_cluster</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><p>
				For more information about mod_cluster attributes, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#mod_cluster-reference">ModCluster Subsystem Attributes</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="view_configuration_changes"/>Viewing Configuration Changes</h1></div></div></div><p>
				JBoss EAP 7 provides the ability to track configuration changes made to the running server. This allows administrators to view a history of configuration changes made by authorized users.
			</p><p>
				In JBoss EAP 7.0, you must use the <code class="literal">core-service</code> management CLI command to configure options and to list recent configuration changes.
			</p><div class="title"><strong>Example: List Configuration Changes in JBoss EAP 7.0</strong></div><p>
					
</p><pre class="screen">/core-service=management/service=configuration-changes:add(max-history=10)
/core-service=management/service=configuration-changes:list-changes</pre><p>

				</p><p>
				JBoss EAP 7.1 introduced a new <code class="literal">core-management</code> subsystem that can be configured to track configuration changes made to the running server. This is the preferred method of configuring and viewing configuration changes in JBoss EAP 7.1 and later.
			</p><div class="title"><strong>Example: List Configuration Changes in JBoss EAP 7.1 and Later</strong></div><p>
					
</p><pre class="screen">/subsystem=core-management/service=configuration-changes:add(max-history=20)
/subsystem=core-management/service=configuration-changes:list-changes</pre><p>

				</p><p>
				For more information about using the new <code class="literal">core-management</code> subsystem introduced in JBoss EAP 7.1, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#view_config_changes">View Configuration Changes</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></div></div></body></html>