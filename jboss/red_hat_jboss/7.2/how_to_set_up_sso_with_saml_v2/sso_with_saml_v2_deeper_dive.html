<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 1. SSO with SAML v2 Deeper Dive</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="sso_with_saml_v2_deeper_dive"/>Chapter 1. SSO with SAML v2 Deeper Dive</h1></div></div></div><p>
			The basics of SSO and SAML are covered in the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#single_sign_on"><span class="emphasis"><em>Security Architecture</em></span> guide</a>. This section takes a deeper dive into the components involved in SAML v2 and SSO.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="what_is_saml_v2"/>What is SAML v2?</h1></div></div></div><p>
				Security Assertion Markup Language, or SAML, is a data format and protocol that allows two parties, usually an identity provider and a service provider, to exchange authentication and authorization information. This information is exchanged in the form of SAML tokens that contain assertions, and are issued by Identity Providers to subjects for authenticating with Service Providers. The ability for subjects to use and reuse SAML tokens issued from an identity provider with multiple service providers allow SAML v2 to facilitate browser-based SSO.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="building_blocks"/>Building Blocks</h2></div></div></div><p>
					The most important concept to keep in mind with SAML is that its all about passing security assertions between entities. SAML has several components it uses to accomplish this task.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml_entities"/>Entities</h3></div></div></div><p>
						Entities are all parties involved in creating and passing assertions. SAML has the concept of three distinct entities:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">subject</span></dt><dd>
									The <code class="literal">subject</code>, also referred to as the <code class="literal">principal</code>, which is the user in most cases, is requesting access to a resource on a <code class="literal">service provider</code>, which is secured by SAML.
								</dd><dt><span class="term">service provider</span></dt><dd>
									The <code class="literal">service provider</code>, or <code class="literal">SP</code>, requires proof, as an assertion, of the <code class="literal">subject</code> 's identity, which it needs from the <code class="literal">identity provider</code>.
								</dd><dt><span class="term">identity provider</span></dt><dd>
									The <code class="literal">identity provider</code>, or <code class="literal">IDP</code>, provides a set of assertions, in the form of a token about a <code class="literal">subject</code>, that can be used in authentication and authorization decisions by <code class="literal">service providers</code>.
								</dd></dl></div><p>
						In summary, <code class="literal">subjects</code> get issued assertions, <code class="literal">identity providers</code> issue those assertions, and <code class="literal">service providers</code> use those assertions to authenticate and authorize <code class="literal">subjects</code>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="security_assertions"/>Security Assertions</h3></div></div></div><p>
						A security assertion is a set of statements issued by an identity provider about a subject. Service providers use these assertions to make access-control decisions about a subject. Statements can take the following forms:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Authentication</span></dt><dd>
									<code class="literal">Authentication</code> assertions assert that a subject successfully authenticated using a specified method at a specific point in time. An authentication context containing other information about the authenticated subject can also be specified in an authentication statement.
								</dd><dt><span class="term">Attribute</span></dt><dd>
									<code class="literal">Attribute</code> assertions assert that a subject has certain attributes.
								</dd><dt><span class="term">Authorization Decision</span></dt><dd>
									<code class="literal">Authorization Decision</code> assertions assert a response, <code class="literal">accept</code> or <code class="literal">deny</code>, to an authorization request for a subject on a resource.
								</dd></dl></div><div class="title"><strong>Example</strong></div><p>
							
</p><pre class="screen">This user logged in as Sarah at 9:30 using a username and password.  Sarah is a member of the Managers group.  Sarah is accepted to access the Employee Information resource.</pre><p>

						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The statement <code class="literal">This user logged in as Sarah at 9:30 using a username and password</code> is an <code class="literal">Authentication</code> assertion.
							</li><li class="listitem">
								The statement <code class="literal">Sarah is a member of the Managers group</code> is an <code class="literal">Attribute</code> assertion.
							</li><li class="listitem">
								The statement <code class="literal">Sarah is accepted to access the Employee Information resource</code> is an <code class="literal">Authorization Decision</code> assertion.
							</li></ul></div><p>
						Assertions are packaged as SAML tokens and transported using SAML protocols.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="protocols"/>Protocols</h3></div></div></div><p>
						A SAML protocol describes how assertions are packaged, usually in the form of a request and response, as well as the rules on the correct way to process them. These rules must be followed by both the producers and consumers of the requests and responses. A request can ask for specific, known assertions or query identity providers for authentication, attribute, or authorization decisions. The request and response messages, which include security assertions, are formatted in XML and adhere to a specified schema.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="bindings"/>Bindings</h3></div></div></div><p>
						SAML bindings specify how SAML protocols map to other standard protocols used for transport and messaging. Some examples include:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A SAML binding that maps to an HTTP redirect.
							</li><li class="listitem">
								A SAML binding that maps to an HTTP <code class="literal">POST</code>.
							</li><li class="listitem">
								A SAML binding that maps SAML requests/responses to SOAP requests and responses.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="profiles"/>Profiles</h3></div></div></div><p>
						SAML profiles use assertions, protocols, and bindings to support specific use cases, such as Web Browser SSO, Single Logout, and Assertion Query.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="how_does_saml_v2_work_with_sso"/>How Does SAML v2 Work with SSO</h1></div></div></div><p>
				The basics of browser-based SSO with SAML v2 are covered in the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/"><span class="emphasis"><em>Security Architecture</em></span></a> guide, specifically in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#browser_based_sso_using_saml">Browser-Based SSO Using SAML</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#multiple_red_hat_jboss_enterprise_application_platform_instances_and_multiple_applications_using_browser_based_sso_with_saml">Multiple Red Hat JBoss Enterprise Application Platform Instances and Multiple Applications Using Browser-Based SSO with SAML</a> sections. This section gives a more in-depth explanation regarding the SAML profiles and bindings related to browser-based SSO with SAML v2.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="web_browser_sso_profile"/>Web Browser SSO Profile</h2></div></div></div><p>
					The <code class="literal">Web Browser SSO</code> profile specifies the way an IDP, SP, and principal, in the form of a browser agent, handle browser-based SSO. Both the SP and IDP have several bindings that each can be used in the Web Browser SSO profile, allowing many possible flows. Additionally, this profile supports message flows initiated from either the IDP or SP. This profile also supports the IDP pushing the SAML assertion to the SP, or the SP pulling the assertion from the IDP. Flows initiated from either the SP or IDP are explained at a high level in the JBoss EAP <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/security_architecture/#browser_based_sso_using_saml"><span class="emphasis"><em>Security Architecture</em></span> guide</a>. SAML assertions pushed from the IDP utilize HTTP <code class="literal">POST</code> messages or HTTP redirects. SAML assertions that are pulled by SPs involve sending an artifact to the receiver, which is then dereferenced to obtain the assertions.
				</p><p>
					The basic flow of the Web Browser SSO profile is as follows:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Principal HTTP request to SP.
						</p><p class="simpara">
							The principal first attempts to access a secured resource at the SP using an HTTP User Agent, for example a browser. If the principal has already been issued a SAML token with a valid security context, the SP will allow or decline the principal. This is the last step. Otherwise, the SP will attempt to locate the IDP for the authentication request.
						</p></li><li class="listitem"><p class="simpara">
							SP determines IDP.
						</p><p class="simpara">
							The SP locates the IDP and its endpoint that supports the SP’s preferred binding. This allows the SP to send an authentication request to the IDP. The specific means of this process can vary between implementations.
						</p></li><li class="listitem"><p class="simpara">
							Authentication Request issued from SP to IDP using the principal.
						</p><p class="simpara">
							Once the SP determines the IDP location and endpoint, the SP issues an Authentication Request in the form of an <code class="literal">&lt;AuthnRequest&gt;</code> message, which will be delivered by the user agent, principal to the IDP. The HTTP Redirect, HTTP <code class="literal">POST</code>, or HTTP Artifact SAML bindings can be used to transfer the message to the IDP using the user agent.
						</p></li><li class="listitem"><p class="simpara">
							IDP identifies principal.
						</p><p class="simpara">
							Once the Authentication Request is delivered to the IDP by the principal, the principal will be identified by the IDP. The identification method is not specifically defined by the Web Browser SSO profile and may be accomplished in a number of ways, for example authentication using <code class="literal">FORM</code>, using existing session information, kerberos authentication, etc.
						</p></li><li class="listitem"><p class="simpara">
							IDP issues Response to SP.
						</p><p class="simpara">
							Once the principal is identified, the IDP issues a Response in the form of a <code class="literal">&lt;Response&gt;</code> message, to be delivered back to the SP for granting or declining access by the principal using the user agent. This message will contain at least one authentication assertion and can also be used to indicate errors. HTTP <code class="literal">POST</code> or HTTP Artifacts can be used to transfer this message, but HTTP Redirect cannot be used due to URL length constraints with most user agents. If the user agent initiated an IDP-based flow, for example by attempting to access the IDP directly instead of an SP, the process would begin at this step. If successful, the HTTP <code class="literal">POST</code> or HTTP Artifact will be sent to a location, which is pre-configured in the IDP.
						</p></li><li class="listitem"><p class="simpara">
							SP allows or declines access to principal.
						</p><p class="simpara">
							Once the SP receives the Response, it may grant access for the requested resource to the principal by creating a security context, or it may deny access, or do its own error handling.
						</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						JBoss EAP does not support the SAML artifact binding.
					</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">HTTP Redirect vs. POST Bindings</h3><p>
						HTTP Redirect bindings make use of HTTP <code class="literal">GET</code> requests and the URL query parameters to transmit protocol messages. Messages sent in this manner are also URL and Base-64 encoded before being sent and decoded by the receiver. HTTP <code class="literal">POST</code> bindings send messages using form data, and also do a base-64 encode/decode on the message. Both SPs and IDPs can transmit and receive messages using redirect or <code class="literal">POST</code> bindings. Due to the limitation of URL lengths in certain scenarios, HTTP Redirect is usually used when passing short messages, and HTTP <code class="literal">POST</code> is used when passing longer messages.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="global_logout_profile"/>Global Logout Profile</h2></div></div></div><p>
					The Global Logout Profile allows a principal, who has authenticated with a set of IDPs and SPs, to log out and have that assertion be propagated to one or more associated IDPs and SPs.
				</p><p>
					When a principal authenticates with an IDP, the principal and IDP have established an authentication session. The IDP may then issue assertions to various SPs, or relying parties, based on that authentication. From there if the principal attempts to access a secured resource within those SPs, the SPs may choose to establish additional sessions with the principal based on that assertion issued from the IDP, hence relying on the IDP.
				</p><p>
					Once a session or set of sessions is created, a principal might be logged out of sessions individually using various means, or they can use the Global Logout Profile to logout of all sessions and from all SPs and IDPs at once. The Global Logout Profile can use the HTTP Redirect, HTTP <code class="literal">POST</code> or HTTP Artifact bindings in its flow. It can also use SOAP binding in certain cases which are not in the scope of this document.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Single Logout Profile can be used as a synonym to Global Logout Profile.
					</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						JBoss EAP does not support the SAML artifact binding.
					</p></div><p>
					As with the Web Browser SSO profile flow, the Global Logout Profile flow may be initiated either at the IDP or the SP.
				</p><p>
					The basic flow of the Global Logout Profile is as follows:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Logout issued to IDP by Session Participant.
						</p><p class="simpara">
							A session participant, such as Service Providers or other relying parties, terminates its own session with the principal and sends a Logout Request, in the form of a <code class="literal">&lt;LogoutRequest&gt;</code> message, to the IDP that initially issued the security assertion for the principal. This request can be sent directly between the IDP and relying party, or indirectly by using the principal’s user agent as a pass through.
						</p></li><li class="listitem"><p class="simpara">
							IDP identifies Session Participant.
						</p><p class="simpara">
							Once the IDP receives the Logout Request, it uses that request to determine what sessions to terminate with which relying parties, including any sessions the IDP owns as a session authority or session participant. For each session, the IDP issues a Logout Request to the relying party and waits for a Logout Response from each party before issuing a new Logout Response back to the original session participant. In cases where the Global Logout Profile flow was initiated at the IDP, the flow begins at this step, and some other mechanism is used to determine the sessions and SPs.
						</p></li><li class="listitem"><p class="simpara">
							Logout issued by IDP.
						</p><p class="simpara">
							Once the IDP determines all of the sessions and associated relying parties, it sends a Logout Request, in the form of a <code class="literal">&lt;LogoutRequest&gt;</code> message, to each relying party and awaits a Logout Response. These requests may be sent directly between the IDP and the relying parties, or indirectly through the principal’s user agent.
						</p></li><li class="listitem"><p class="simpara">
							Logout response issued by Session Participant or Authority.
						</p><p class="simpara">
							Each relying party, including the IDP itself in some cases, attempts to terminate the session as directed by the IDP in the Logout Request, and returns a Logout Response in the form of a <code class="literal">&lt;LogoutResponse&gt;</code> message, back to the IDP. As with the Logout Request, the response can be issued directly between the relying party and the IDP, or indirectly through the principal’s user agent.
						</p></li><li class="listitem"><p class="simpara">
							IDP issues Logout response to original Session Participant.
						</p><p class="simpara">
							Once all the Logout Responses has been received from the relying parties, the IDP sends a new Logout Response, in the form of a <code class="literal">&lt;LogoutResponse&gt;</code> message, back to original session participant who requested the logout. As with the other parts of this flow, this response can be passed directly between the IDP and the session participant, or indirectly through the principal’s user agent. In cases where the Logout Request was initiated at the IDP, this step is omitted.
						</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The direct communication between the IDP and SP portion of the Global Logout Profile is not supported in JBoss EAP.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="multiple_idps_and_the_identity_discovery_profile"/>Multiple IDPs and the Identity Discovery Profile</h2></div></div></div><p>
					Browser-based SSO using SAML v2 also supports having multiple IDPs, and can be used in both the Web Browser SSO profile as well as the Global Logout profile. In cases where multiple IDPs are configured, the Identity Discovery SAML profile is used to determine which IDP a principal uses. This is accomplished by reading and writing cookies with domain information and a list of IDPs.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="further_reading"/>Further Reading</h1></div></div></div><p>
				For full details on the SAML v2, see the <a class="link" href="https://www.oasis-open.org/standards#samlv2.0">official SAML 2.0 specification</a>.
			</p></div></div></body></html>