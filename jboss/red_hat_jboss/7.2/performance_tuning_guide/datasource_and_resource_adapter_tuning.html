<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. Datasource and Resource Adapter Tuning</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="datasource_and_resource_adapter_tuning"/>Chapter 6. Datasource and Resource Adapter Tuning</h1></div></div></div><p>
			Connection pools are the principal tool that JBoss EAP uses to optimize performance for environments that use datasources, such as relational databases, or resource adapters.
		</p><p>
			Allocating and deallocating resources for datasource and resource adapter connections is very expensive in terms of time and system resources. Connection pooling reduces the cost of connections by creating a 'pool' of connections that are available to applications.
		</p><p>
			Before configuring your connection pool for optimal performance, you must monitor the <a class="link" href="datasource_and_resource_adapter_tuning.html#datasource_statistics" title="Datasource Statistics">datasource pool statistics</a> or <a class="link" href="datasource_and_resource_adapter_tuning.html#resource_adapter_statistics_topic" title="Resource Adapter Statistics">resource adapter statistics</a> under load to determine the appropriate settings for your environment.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="monitoring_pool_stats"/>Monitoring Pool Statistics</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="datasource_statistics"/>Datasource Statistics</h2></div></div></div><p>
					When statistics collection is <a class="link" href="datasource_and_resource_adapter_tuning.html#enable_datasource_statistics" title="Enabling Datasource Statistics">enabled</a> for a datasource, you can <a class="link" href="datasource_and_resource_adapter_tuning.html#viewing_datasource_stats" title="Viewing Datasource Statistics">view runtime statistics</a> for the datasource.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="enable_datasource_statistics"/>Enabling Datasource Statistics</h3></div></div></div><p>
						By default, datasource statistics are <span class="emphasis"><em>not</em></span> enabled. You can enable datasource statistics collection using the <a class="link" href="datasource_and_resource_adapter_tuning.html#enable_datasource_statistics_cli" title="Enable Datasource Statistics Using the Management CLI">management CLI</a> or the <a class="link" href="datasource_and_resource_adapter_tuning.html#enable_datasource_statistics_console" title="Enable Datasource Statistics Using the Management Console">management console</a>.
					</p><h5><a id="enable_datasource_statistics_cli"/>Enable Datasource Statistics Using the Management CLI</h5><p>
						The following management CLI command enables the collection of statistics for the <code class="literal">ExampleDS</code> datasource.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							In a managed domain, precede this command with <code class="literal">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span></code>.
						</p></div><pre class="screen">/subsystem=datasources/data-source=ExampleDS:write-attribute(name=statistics-enabled,value=true)</pre><p>
						Reload the server for the changes to take effect.
					</p><h5><a id="enable_datasource_statistics_console"/>Enable Datasource Statistics Using the Management Console</h5><p>
						Use the following steps to enable statistics collection for a datasource using the management console.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Datasources &amp; Drivers</strong></span> → <span class="strong"><strong>Datasources</strong></span>.
							</li><li class="listitem">
								Select the datasource and click <span class="strong"><strong>View</strong></span>.
							</li><li class="listitem">
								Click <span class="strong"><strong>Edit</strong></span> under the <span class="strong"><strong>Attributes</strong></span> tab.
							</li><li class="listitem">
								Set the <span class="strong"><strong>Statistics Enabled</strong></span> field to <span class="strong"><strong>ON</strong></span> and click <span class="strong"><strong>Save</strong></span>. A popup appears indicating that the changes require a reload in order to take effect.
							</li><li class="listitem"><p class="simpara">
								Reload the server.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										For a standalone server, click the <span class="strong"><strong>Reload</strong></span> link from the popup to reload the server.
									</li><li class="listitem">
										For a managed domain, click the <span class="strong"><strong>Topology</strong></span> link from the popup. From the <span class="strong"><strong>Topology</strong></span> tab, select the appropriate server and select the <span class="strong"><strong>Reload</strong></span> drop down option to reload the server.
									</li></ul></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="viewing_datasource_stats"/>Viewing Datasource Statistics</h3></div></div></div><p>
						You can view runtime statistics for a datasource using the <a class="link" href="datasource_and_resource_adapter_tuning.html#view_datasource_stats_cli" title="View Datasource Statistics Using the Management CLI">management CLI</a> or <a class="link" href="datasource_and_resource_adapter_tuning.html#view_datasource_stats_console" title="View Datasource Statistics Using the Management Console">management console</a>.
					</p><h5><a id="view_datasource_stats_cli"/>View Datasource Statistics Using the Management CLI</h5><p>
						The following management CLI command retrieves the core <span class="emphasis"><em>pool</em></span> statistics for the <code class="literal">ExampleDS</code> datasource.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							In a managed domain, precede these commands with <code class="literal">/host=<span class="emphasis"><em>HOST_NAME</em></span>/server=<span class="emphasis"><em>SERVER_NAME</em></span></code>.
						</p></div><pre class="screen">/subsystem=datasources/data-source=ExampleDS/statistics=pool:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "ActiveCount" =&gt; 1,
        "AvailableCount" =&gt; 20,
        "AverageBlockingTime" =&gt; 0L,
        "AverageCreationTime" =&gt; 122L,
        "AverageGetTime" =&gt; 128L,
        "AveragePoolTime" =&gt; 0L,
        "AverageUsageTime" =&gt; 0L,
        "BlockingFailureCount" =&gt; 0,
        "CreatedCount" =&gt; 1,
        "DestroyedCount" =&gt; 0,
        "IdleCount" =&gt; 1,
        ...
}</pre><p>
						The following management CLI command retrieves the <span class="emphasis"><em>JDBC</em></span> statistics for the <code class="literal">ExampleDS</code> datasource.
					</p><pre class="screen">/subsystem=datasources/data-source=ExampleDS/statistics=jdbc:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "PreparedStatementCacheAccessCount" =&gt; 0L,
        "PreparedStatementCacheAddCount" =&gt; 0L,
        "PreparedStatementCacheCurrentSize" =&gt; 0,
        "PreparedStatementCacheDeleteCount" =&gt; 0L,
        "PreparedStatementCacheHitCount" =&gt; 0L,
        "PreparedStatementCacheMissCount" =&gt; 0L,
        "statistics-enabled" =&gt; true
    }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Since statistics are runtime information, be sure to specify the <code class="literal">include-runtime=true</code> argument.
						</p></div><p>
						See <a class="link" href="reference_material.html#reference_of_datasource_statistics" title="Datasource Statistics">Datasource Statistics</a> for a detailed list of all available statistics.
					</p><h5><a id="view_datasource_stats_console"/>View Datasource Statistics Using the Management Console</h5><p>
						To view datasource statistics from the management console, navigate to the <span class="strong"><strong>Datasources</strong></span> subsystem from the <span class="strong"><strong>Runtime</strong></span> tab, select a datasource, and click <span class="strong"><strong>View</strong></span>.
					</p><p>
						See <a class="link" href="reference_material.html#reference_of_datasource_statistics" title="Datasource Statistics">Datasource Statistics</a> for a detailed list of all available statistics.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="resource_adapter_statistics_topic"/>Resource Adapter Statistics</h2></div></div></div><p>
					You can view core runtime statistics for deployed resource adapters. See the <a class="link" href="reference_material.html#resource_adapter_statistics" title="Resource Adapter Statistics">Resource Adapter Statistics appendix</a> for a detailed list of all available statistics.
				</p><h4><a id="enable_resource_adapter_statistics"/>Enable Resource Adapter Statistics</h4><p>
					By default, resource adapter statistics are <span class="emphasis"><em>not</em></span> enabled. The following management CLI command enables the collection of statistics for a simple resource adapter <code class="literal">myRA.rar</code> with a connection factory bound in JNDI as <code class="literal">java:/eis/AcmeConnectionFactory</code>:
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						In a managed domain, precede the command with <code class="literal">/host=<span class="emphasis"><em>HOST_NAME</em></span>/server=<span class="emphasis"><em>SERVER_NAME</em></span>/</code>.
					</p></div><pre class="screen">/deployment=<span class="emphasis"><em>myRA.rar</em></span>/subsystem=resource-adapters/statistics=statistics/connection-definitions=<span class="emphasis"><em>java\:\/eis\/AcmeConnectionFactory</em></span>:write-attribute(name=statistics-enabled,value=true)</pre><h4><a id="view_resource_adapter_statistics"/>View Resource Adapter Statistics</h4><p>
					Resource adapter statistics can be retrieved from the management CLI. The following management CLI command returns statistics for the resource adapter <code class="literal">myRA.rar</code> with a connection factory bound in JNDI as <code class="literal">java:/eis/AcmeConnectionFactory</code>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						In a managed domain, precede the command with <code class="literal">/host=<span class="emphasis"><em>HOST_NAME</em></span>/server=<span class="emphasis"><em>SERVER_NAME</em></span>/</code>.
					</p></div><pre class="screen">deployment=<span class="emphasis"><em>myRA.rar</em></span>/subsystem=resource-adapters/statistics=statistics/connection-definitions=<span class="emphasis"><em>java\:\/eis\/AcmeConnectionFactory</em></span>:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "ActiveCount" =&gt; "1",
        "AvailableCount" =&gt; "20",
        "AverageBlockingTime" =&gt; "0",
        "AverageCreationTime" =&gt; "0",
        "CreatedCount" =&gt; "1",
        "DestroyedCount" =&gt; "0",
        "InUseCount" =&gt; "0",
        "MaxCreationTime" =&gt; "0",
        "MaxUsedCount" =&gt; "1",
        "MaxWaitCount" =&gt; "0",
        "MaxWaitTime" =&gt; "0",
        "TimedOut" =&gt; "0",
        "TotalBlockingTime" =&gt; "0",
        "TotalCreationTime" =&gt; "0"
    }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Since statistics are runtime information, be sure to specify the <code class="literal">include-runtime=true</code> argument.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="pool_attributes"/>Pool Attributes</h1></div></div></div><p>
				This section details advice for selected pool attributes that can be configured for optimal datasource or resource adapter performance. For instructions on how to configure each of these attributes, see:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="datasource_and_resource_adapter_tuning.html#configuring_datasource_pool" title="Configuring Datasource Pool Attributes">Configuring Datasource Pool Attributes</a>
					</li><li class="listitem"><p class="simpara">
						<a class="link" href="datasource_and_resource_adapter_tuning.html#configuring_ra_pool" title="Configuring Resource Adapter Pool Attributes">Configuring Resource Adapter Pool Attributes</a>
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Minimum Pool Size</span></dt><dd><p class="simpara">
									The <code class="literal">min-pool-size</code> attribute defines the minimum size of the connection pool. The default minimum is zero connections. With a zero <code class="literal">min-pool-size</code>, connections are created and placed in the pool when the first transactions occur.
								</p><p class="simpara">
									If <code class="literal">min-pool-size</code> is too small, it results in increased latency while executing initial database commands because new connections might need to be established. If <code class="literal">min-pool-size</code> is too large, it results in wasted connections to the datasource or resource adapter.
								</p><p class="simpara">
									During periods of inactivity the connection pool will shrink, possibly to the <code class="literal">min-pool-size</code> value.
								</p><p class="simpara">
									Red Hat recommends that you set <code class="literal">min-pool-size</code> to the number of connections that allow for ideal on-demand throughput for your applications.
								</p></dd><dt><span class="term">Maximum Pool Size</span></dt><dd><p class="simpara">
									The <code class="literal">max-pool-size</code> attribute defines the maximum size of the connection pool. It is an important performance parameter because it limits the number of active connections, and thus also limits the amount of concurrent activity.
								</p><p class="simpara">
									If <code class="literal">max-pool-size</code> is too small, it can result in requests being unnecessarily blocked. If <code class="literal">max-pool-size</code> is too large, it can result in your JBoss EAP environment, datasource, or resource adapter using more resources than it can handle.
								</p><p class="simpara">
									Red Hat recommends that you set the <code class="literal">max-pool-size</code> to at least 15% higher than an acceptable <code class="literal">MaxUsedCount</code> observed after <a class="link" href="datasource_and_resource_adapter_tuning.html#monitoring_pool_stats" title="Monitoring Pool Statistics">monitoring performance</a> under load. This allows some buffer for higher than expected conditions.
								</p></dd><dt><span class="term">Prefill</span></dt><dd><p class="simpara">
									The <code class="literal">pool-prefill</code> attribute specifies whether JBoss EAP will prefill the connection pool with the minimum number of connections when JBoss EAP starts. The default value is <code class="literal">false</code>.
								</p><p class="simpara">
									When <code class="literal">pool-prefill</code> is set to <code class="literal">true</code>, JBoss EAP uses more resources at startup, but there will be less latency for initial transactions.
								</p><p class="simpara">
									Red Hat recommends to set <code class="literal">pool-prefill</code> to <code class="literal">true</code> if you have optimized the <code class="literal">min-pool-size</code>.
								</p></dd><dt><span class="term">Strict Minimum</span></dt><dd><p class="simpara">
									The <code class="literal">pool-use-strict-min</code> attribute specifies whether JBoss EAP allows the number of connections in the pool to fall below the specified minimum.
								</p><p class="simpara">
									If <code class="literal">pool-use-strict-min</code> is set to <code class="literal">true</code>, JBoss EAP will not allow the number of connections to temporarily fall below the specified minimum. The default value is <code class="literal">false</code>.
								</p><p class="simpara">
									Although a minimum number of pool connections is specified, when JBoss EAP closes connections, for instance, if the connection is idle and has reached the timeout, the closure may cause the total number of connections to temporarily fall below the minimum before a new connection is created and added to the pool.
								</p></dd><dt><span class="term">Timeouts</span></dt><dd><p class="simpara">
									There are a number of timeout options that are configurable for a connection pool, but a significant one for performance tuning is <code class="literal">idle-timeout-minutes</code>.
								</p><p class="simpara">
									The <code class="literal">idle-timeout-minutes</code> attribute specifies the maximum time, in minutes, a connection may be idle before being closed. As idle connections are closed, the number of connections in the pool will shrink down to the specified minimum.
								</p><p class="simpara">
									The longer the timeout, the more resources are used but requests might be served faster. The lower the timeout, the less resources are used but requests might need to wait for a new connection to be created.
								</p></dd></dl></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_pool_attributes"/>Configuring Pool Attributes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_datasource_pool"/>Configuring Datasource Pool Attributes</h2></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist"><li class="listitem">
							Install a JDBC driver. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#jdbc_drivers">JDBC Drivers</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li><li class="listitem">
							Create a datasource. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#adding_datasources">Creating Datasources</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li></ul></div><p>
					You can configure datasource pool attributes using either the management CLI or the management console:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To use the management console, navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Datasources &amp; Drivers</strong></span> → <span class="strong"><strong>Datasources</strong></span>, select your datasource, and click <span class="strong"><strong>View</strong></span>. The pool options are configurable under the datasource <span class="strong"><strong>Pool</strong></span> tab. Timeout options are configurable under the datasource <span class="strong"><strong>Timeouts</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							To use the management CLI, execute the following command:
						</p><pre class="screen">/subsystem=datasources/data-source=<span class="emphasis"><em>DATASOURCE_NAME</em></span>/:write-attribute(name=<span class="emphasis"><em>ATTRIBUTE_NAME</em></span>,value=<span class="emphasis"><em>ATTRIBUTE_VALUE</em></span>)</pre><p class="simpara">
							For example, to set the <code class="literal">ExampleDS</code> datasource <code class="literal">min-pool-size</code> attribute to a value of 5 connections, use the following command:
						</p><pre class="screen">/subsystem=datasources/data-source=ExampleDS/:write-attribute(name=min-pool-size,value=5)</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_ra_pool"/>Configuring Resource Adapter Pool Attributes</h2></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist"><li class="listitem">
							Deploy your resource adapter and add a connection definition. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configuring_resource_adapters">Configuring Resource Adapters</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li></ul></div><p>
					You can configure resource adapter pool attributes using either the management CLI or the management console:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To use the management console, navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Resource Adapters</strong></span>, select your resource adapter, click <span class="strong"><strong>View</strong></span>, and select <span class="strong"><strong>Connection Definitions</strong></span> in the left menu. The pool options are configurable under the <span class="strong"><strong>Pool</strong></span> tab. Timeout options are configurable under the <span class="strong"><strong>Attributes</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							To use the management CLI, execute the following command:
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RESOURCE_ADAPTER_NAME</em></span>/connection-definitions=<span class="emphasis"><em>CONNECTION_DEFINITION_NAME</em></span>:write-attribute(name=<span class="emphasis"><em>ATTRIBUTE_NAME</em></span>,value=<span class="emphasis"><em>ATTRIBUTE_VALUE</em></span>)</pre><p class="simpara">
							For example, to set the <code class="literal">my_RA</code> resource adapter <code class="literal">my_CD</code> connection definition <code class="literal">min-pool-size</code> attribute to a value of 5 connections, use the following command:
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=my_RA/connection-definitions=my_CD:write-attribute(name=min-pool-size,value=5)</pre></li></ul></div></div></div></div></body></html>