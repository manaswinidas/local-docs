<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 11. JGroups Subsystem Tuning</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_tuning"/>Chapter 11. JGroups Subsystem Tuning</h1></div></div></div><p>
			For optimal network performance it is recommended that you use UDP multicast for JGroups in environments that support it.
		</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
				TCP has more overhead and is often considered slower than UDP since it handles error checking, packet ordering, and congestion control itself. JGroups handles these features for UDP, whereas TCP guarantees them itself. TCP is a good choice when using JGroups on unreliable or high congestion networks, or when multicast is not available.
			</p></div><p>
			This chapter assumes that you have chosen your JGroups stack transport protocol (UDP or TCP) and communications protocols that JGroups cluster communications will use. See the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span> for more information about <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#cluster_communication_jgroups">cluster communication with JGroups</a>.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_monitoring_statistics"/>Monitoring JGroups Statistics</h1></div></div></div><p>
				You can enable statistics for the <code class="literal">jgroups</code> subsystem to monitor JBoss EAP clustering using the management CLI or through JMX.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Enabling statistics adversely affects performance. Only enable statistics when necessary.
				</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Use the following command to enable statistics for a JGroups channel.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							In a managed domain, precede these commands with <code class="literal">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span></code>.
						</p></div><pre class="screen">/subsystem=jgroups/channel=<span class="emphasis"><em>CHANNEL_NAME</em></span>:write-attribute(name=statistics-enabled,value=true)</pre><p class="simpara">
						For example, use the following command to enable statistics for the default <code class="literal">ee</code> channel.
					</p><pre class="screen">/subsystem=jgroups/channel=ee:write-attribute(name=statistics-enabled,value=true)</pre></li><li class="listitem"><p class="simpara">
						Reload the JBoss EAP server.
					</p><pre class="screen">reload</pre></li><li class="listitem"><p class="simpara">
						You can now see JGroups statistics using either the management CLI, or through JMX with a JVM monitoring tool:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								To use the management CLI, use the <code class="literal">:read-resource(include-runtime=true)</code> command on the JGroups channel or protocol that you want to see the statistics for.
							</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									In a managed domain, precede these commands with <code class="literal">/host=<span class="emphasis"><em>HOST_NAME</em></span>/server=<span class="emphasis"><em>SERVER_NAME</em></span></code>.
								</p></div><p class="simpara">
								For example:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										To see the statistics for the <code class="literal">ee</code> channel, use the following command:
									</p><pre class="screen">/subsystem=jgroups/channel=ee:read-resource(include-runtime=true)</pre></li><li class="listitem"><p class="simpara">
										To see the statistics for the <code class="literal">FD_ALL</code> protocol in the <code class="literal">ee</code> channel, use the following command:
									</p><pre class="screen">/subsystem=jgroups/channel=ee/protocol=FD_ALL:read-resource(include-runtime=true)</pre></li></ul></div></li><li class="listitem">
								To connect to JBoss EAP using a JVM monitoring tool, see the <a class="link" href="monitoring_performance.html" title="Chapter 2. Monitoring Performance">Monitoring Performance</a> chapter. You can see the statistics on JGroups MBeans through the JMX connection.
							</li></ul></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_network_jumbo_frames"/>Networking and Jumbo Frames</h1></div></div></div><p>
				Where possible, it is recommended that the network interface for JGroups traffic should be part of a dedicated Virtual Local Area Network (VLAN). This allows you to separate cluster communications from other JBoss EAP network traffic to more easily control cluster network performance, throughput, and security.
			</p><p>
				Another network configuration to consider to improve cluster performance is to enable jumbo frames. If your network environment supports it, enabling jumbo frames by increasing the Maximum Transmission Unit (MTU) can help boost network performance, especially in high throughput environments.
			</p><p>
				To use jumbo frames, all NICs and switches in your network must support it. See the Red Hat Customer Portal for instructions on <a class="link" href="https://access.redhat.com/solutions/3643">enabling jumbo frames for Red Hat Enterprise Linux</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_message_bundling"/>Message Bundling</h1></div></div></div><p>
				Message bundling in JGroups improves network performance by assembling multiple small messages into larger bundles. Rather than sending out many small messages over the network to cluster nodes, instead messages are queued until the maximum bundle size is reached or there are no more messages to send. The queued messages are assembled into a larger message bundle and then sent.
			</p><p>
				This bundling reduces communications overhead, especially in TCP environments where there is a higher overhead for network communications.
			</p><div class="title"><strong>Configuring Message Bundling</strong></div><p>
					JGroups message bundling is configured using the <code class="literal">max_bundle_size</code> property. The default <code class="literal">max_bundle_size</code> is 64KB.
				</p><p>
				The performance improvements of tuning the bundle size depend on your environment, and whether more efficient network traffic is balanced against a possible delay of communications while the bundle is assembled.
			</p><p>
				Use the following management CLI command to configure <code class="literal">max_bundle_size</code>.
			</p><pre class="screen">/subsystem=jgroups/stack=<span class="emphasis"><em>STACK_NAME</em></span>/transport=<span class="emphasis"><em>TRANSPORT_TYPE</em></span>/property=max_bundle_size:add(value=<span class="emphasis"><em>BUNDLE_SIZE</em></span>)</pre><p>
				For example, to set <code class="literal">max_bundle_size</code> to <code class="literal">60K</code> for the default <code class="literal">udp</code> stack:
			</p><pre class="screen">/subsystem=jgroups/stack=udp/transport=UDP/property=max_bundle_size:add(value=60K)</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_thread_pools"/>JGroups Thread Pools</h1></div></div></div><p>
				The <code class="literal">jgroups</code> subsystem uses its own thread pools for processing cluster communication. JGroups contains thread pools for <code class="literal">default</code>, <code class="literal">internal</code>, <code class="literal">oob</code>, and <code class="literal">timer</code> functions which you can configure individually. Each JGroups thread pool includes configurable attributes for <code class="literal">keepalive-time</code>, <code class="literal">max-threads</code>, <code class="literal">min-threads</code>, and <code class="literal">queue-length</code>.
			</p><p>
				Appropriate values for each thread pool attribute depend on your environment, but for most situations the default values should suffice.
			</p><p>
				See the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span> for instructions on <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_jgroups_thread_pools">how to configure JGroups thread pools</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jgroups_buffers"/>JGroups Send and Receive Buffers</h1></div></div></div><p>
				The <code class="literal">jgroups</code> subsystem has configurable send and receive buffers for both UDP and TCP stacks.
			</p><p>
				Appropriate values for JGroups buffers depend on your environment, but for most situations the default values should suffice. It is recommended that you test your cluster under load in a development environment to tune appropriate values for the buffer sizes.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Your operating system may limit the available buffer sizes and JBoss EAP may not be able to use its configured buffer values. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_jgroups_send_receive_buffers">Resolving Buffer Size Warnings</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p></div><p>
				See the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span> for instructions on <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#configure_jgroups_send_receive_buffers">how to configure JGroups send and receive buffers</a>.
			</p></div></div></body></html>