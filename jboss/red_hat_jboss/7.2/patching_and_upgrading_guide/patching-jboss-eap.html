<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. Patching JBoss EAP</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="patching-jboss-eap"/>Chapter 2. Patching JBoss EAP</h1></div></div></div><p>
			The method of applying a patch to JBoss EAP depends on your installation method. If you installed JBoss EAP using the ZIP or installer methods, you must use the <a class="link" href="patching-jboss-eap.html#zip-patching" title="Patching a ZIP/Installer Installation">ZIP-based patch management system</a>. If you used RPMs to install JBoss EAP on Red Hat Enterprise Linux, you must use <a class="link" href="patching-jboss-eap.html#rpm-patching" title="Patching an RPM Installation">RPM patches</a>.
		</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
				Before applying or rolling back a patch, you should back up your JBoss EAP server, including all deployments and configuration files.
			</p></div><p>
			If you have a locally installed JBoss EAP Maven repository, you must also <a class="link" href="patching-jboss-eap.html#patch_a_local_maven_repository" title="Optional: Patch a Local JBoss EAP Maven Repository">patch the Maven repository</a> to the same cumulative patch version as your JBoss EAP server.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="zip-patching"/>Patching a ZIP/Installer Installation</h1></div></div></div><p>
				Cumulative patches for a ZIP or Installer installation of JBoss EAP are available to download from the <a class="link" href="https://access.redhat.com/">Red Hat Customer Portal</a>.
			</p><p>
				For multiple JBoss EAP hosts in a managed domain environment, individual hosts can be patched from your JBoss EAP domain controller.
			</p><p>
				In addition to applying a patch, you can also roll back the application of a patch.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="important_notes_on_zip_installer_installation_patching"/>Important Notes on ZIP/Installer Installation Patching</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							If you apply a patch that updates a module, the new patched JARs that are used at runtime are stored in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/system/layers/base/.overlays/<span class="emphasis"><em>PATCH_ID</em></span>/<span class="emphasis"><em>MODULE</em></span></code>. The original unpatched files are left in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/system/layers/base/<span class="emphasis"><em>MODULE</em></span></code>, but these JARs are <span class="strong"><strong>not</strong></span> used at runtime.
						</li><li class="listitem"><p class="simpara">
							In order to significantly decrease the size of cumulative patch releases for JBoss EAP 7, you now cannot perform a partial roll back of a cumulative patch. For a patch that has been applied, you will only be able to roll back the whole patch.
						</p><p class="simpara">
							For example, if you apply CP03 to JBoss EAP 7.0.0, you will not be able to roll back to CP01 or CP02. If you would like the ability to roll back to each cumulative patch release, each cumulative patch must be applied separately in the order they were released.
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="applying_a_patch"/>Applying a Patch</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						JBoss EAP servers that have been installed using the RPM method cannot be updated using these instructions. See the <a class="link" href="patching-jboss-eap.html#rpm-patching" title="Patching an RPM Installation">RPM instructions for applying a patch</a> instead.
					</p></div><p>
					You can apply downloaded patches to a JBoss EAP server using either the <a class="link" href="patching-jboss-eap.html#zip_patching_management_cli" title="Applying a Patch to JBoss EAP Using the Management CLI">management CLI</a> or the <a class="link" href="patching-jboss-eap.html#zip_patching_management_console" title="Applying a Patch to JBoss EAP Using the Management Console">management console</a>.
				</p><div class="orderedlist"><a id="zip_patching_management_cli"/><p class="title"><strong>Applying a Patch to JBoss EAP Using the Management CLI</strong></p><ol class="orderedlist"><li class="listitem">
							Log in to the Red Hat Customer Portal, and download the patch file from <a class="link" href="https://access.redhat.com/jbossnetwork/restricted/listSoftware.html?product=appplatform&amp;downloadType=patches">JBoss EAP Software Downloads</a>.
						</li><li class="listitem"><p class="simpara">
							From the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_cli_overview">management CLI</a>, apply the patch using the following command, including the appropriate path to the patch file:
						</p><pre class="screen">patch apply <span class="emphasis"><em>/path/to/downloaded-patch</em></span>.zip</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								To patch another JBoss EAP host in a managed domain, you can specify the JBoss EAP host name using the <code class="literal">--host=</code> argument. For example:
							</p><pre class="screen">patch apply <span class="emphasis"><em>/path/to/downloaded-patch.</em></span>zip --host=<span class="emphasis"><em>my-host</em></span></pre></div><p class="simpara">
							The patch tool will warn if there are any conflicts in attempting to apply the patch. If there are conflicts, enter <code class="literal">patch --help</code> for the available arguments to re-run the command with an argument specifying how to resolve the conflicts.
						</p></li><li class="listitem"><p class="simpara">
							Restart the JBoss EAP server for the patch to take effect:
						</p><pre class="screen">shutdown --restart=true</pre></li></ol></div><div class="orderedlist"><a id="zip_patching_management_console"/><p class="title"><strong>Applying a Patch to JBoss EAP Using the Management Console</strong></p><ol class="orderedlist"><li class="listitem">
							Log in to the Red Hat Customer Portal, and download the patch file from <a class="link" href="https://access.redhat.com/jbossnetwork/restricted/listSoftware.html?product=appplatform&amp;downloadType=patches">JBoss EAP Software Downloads</a>.
						</li><li class="listitem">
							Open the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#management_console_overview">management console</a> and navigate to the <span class="strong"><strong>Patching</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							Add the patch using the <span class="strong"><strong>Add Patch</strong></span> wizard.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									For a standalone server:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
											Click the Add (<span class="strong"><strong>+</strong></span>) button.
										</li><li class="listitem">
											Click <span class="strong"><strong>Choose a file or drag it here</strong></span>, select the downloaded patch to apply, and click <span class="strong"><strong>Next</strong></span>.
										</li><li class="listitem">
											Configure any of the additional options and click <span class="strong"><strong>Finish</strong></span>.
										</li></ol></div></li><li class="listitem"><p class="simpara">
									For a managed domain:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
											Select the host to patch and click the Add (<span class="strong"><strong>+</strong></span>) button.
										</li><li class="listitem">
											Select whether to shut down the servers on the host, and click <span class="strong"><strong>Next</strong></span>.
										</li><li class="listitem">
											Click <span class="strong"><strong>Choose a file or drag it here</strong></span>, select the downloaded patch to apply, and click <span class="strong"><strong>Next</strong></span>.
										</li><li class="listitem">
											Configure any of the additional options and click <span class="strong"><strong>Finish</strong></span>.
										</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
							Verify that the patch was applied successfully.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									If the patch was applied successfully, restart the server for the changes to take effect.
								</li><li class="listitem">
									If the patch application failed, review the error message. If there was a conflict, you can use the <span class="strong"><strong>Override All</strong></span>, <span class="strong"><strong>Override Modules</strong></span>, and <span class="strong"><strong>Override</strong></span> fields in the <span class="strong"><strong>Add Patch</strong></span> wizard to bypass content verification for items that the patch changes. Overriding conflicts will result in the content of the patch overriding any user modifications.
								</li></ul></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="rolling_back_a_patch"/>Rolling Back a Patch</h2></div></div></div><p>
					You can roll back a previously applied JBoss EAP patch using either the <a class="link" href="patching-jboss-eap.html#zip_rollback_management_cli" title="Rolling Back a Patch Using the Management CLI">management CLI</a> or the <a class="link" href="patching-jboss-eap.html#zip_rollback_management_console" title="Rolling Back a Patch Using the Management Console">management console</a>.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Rolling back a patch using the patch management system is not intended as a general uninstall functionality. It is only intended to be used immediately after the application of a patch that had undesirable effects.
					</p></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist"><li class="listitem">
							A patch that was previously applied.
						</li></ul></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						When rolling back a patch, use caution when specifying the value of the <code class="literal">Reset Configuration</code> option:
					</p><p>
						If set to <code class="literal">TRUE</code>, the patch rollback process will also roll back the JBoss EAP server configuration files to their pre-patch state. Any changes that were made to the JBoss EAP server configuration files after the patch was applied will be lost.
					</p><p>
						If set to <code class="literal">FALSE</code>, the server configuration files will not be rolled back. In this situation, it is possible that the server will not start after the rollback, as the patch may have altered configurations, such as namespaces, which may no longer be valid and will have to be fixed manually.
					</p></div><div class="orderedlist"><a id="zip_rollback_management_cli"/><p class="title"><strong>Rolling Back a Patch Using the Management CLI</strong></p><ol class="orderedlist"><li class="listitem"><p class="simpara">
							From the management CLI, use the <code class="literal">patch history</code> command to find the ID of the patch that you want to roll back.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								If you are using a managed domain, you must add the <code class="literal">--host=<span class="emphasis"><em>HOSTNAME</em></span></code> argument to the commands in this procedure to specify the JBoss EAP host.
							</p></div></li><li class="listitem"><p class="simpara">
							Roll back the patch with the appropriate patch ID from the previous step.
						</p><pre class="screen">patch rollback --patch-id=<span class="emphasis"><em>PATCH_ID</em></span> --reset-configuration=TRUE</pre><p class="simpara">
							The patch tool will warn if there are any conflicts in attempting to roll back the patch. If there are conflicts, enter <code class="literal">patch --help</code> for the available arguments to re-run the command with an argument specifying how to resolve the conflicts.
						</p></li><li class="listitem"><p class="simpara">
							Restart the JBoss EAP server for the patch roll back to take effect:
						</p><pre class="screen">shutdown --restart=true</pre></li></ol></div><div class="orderedlist"><a id="zip_rollback_management_console"/><p class="title"><strong>Rolling Back a Patch Using the Management Console</strong></p><ol class="orderedlist"><li class="listitem">
							Open the management console and navigate to the <span class="strong"><strong>Patching</strong></span> tab.
						</li><li class="listitem"><p class="simpara">
							Roll back the patch using the <span class="strong"><strong>Rollback</strong></span> wizard.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									For a standalone server:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
											Select the patch to roll back and click <span class="strong"><strong>Rollback</strong></span>.
										</li><li class="listitem">
											Configure any of the additional options and click <span class="strong"><strong>Finish</strong></span>.
										</li></ol></div></li><li class="listitem"><p class="simpara">
									For a managed domain:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
											Select the host, select the patch to roll back, and click <span class="strong"><strong>Rollback</strong></span>.
										</li><li class="listitem">
											Select whether to shut down the servers on the host and click <span class="strong"><strong>Next</strong></span>.
										</li><li class="listitem">
											Configure any of the additional options and click <span class="strong"><strong>Finish</strong></span>.
										</li></ol></div></li></ul></div></li><li class="listitem"><p class="simpara">
							Verify that the rollback was successful.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									If the patch was rolled back successfully, restart the server for the changes to take effect.
								</li><li class="listitem">
									If the patch rollback failed, review the error message. If there was a conflict, you can use the <span class="strong"><strong>Override All</strong></span>, <span class="strong"><strong>Override Modules</strong></span>, and <span class="strong"><strong>Override</strong></span> fields in the wizard to bypass content verification for items affected by the patch.
								</li></ul></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="clearing_patch_history"/>Clearing Patch History</h2></div></div></div><p>
					When patches are applied to a JBoss EAP server, the content and history of the patches are preserved for use in rollback operations. If multiple cumulative patches are applied, the patch history may use a significant amount of disk space.
				</p><p>
					You can use the following management CLI command to remove all older patches that are not currently in use. When using this command, only the latest cumulative patch is preserved along with the GA release. This is only useful for freeing space if multiple cumulative patches have previously been applied.
				</p><pre class="screen">/core-service=patching:ageout-history</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						If you clear the patch history, you will not be able to roll back a previously applied patch.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="rpm-patching"/>Patching an RPM Installation</h1></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist"><li class="listitem">
						Ensure that the base operating system is up to date, and is subscribed and enabled to get updates from the standard Red Hat Enterprise Linux repositories.
					</li><li class="listitem"><p class="simpara">
						Ensure that you are subscribed to the relevant JBoss EAP repository for the update.
					</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
							When updating an RPM installation, JBoss EAP is updated cumulatively with all RPM-released fixes for the subscribed repository.
						</p></div></li><li class="listitem">
						Back up all configuration files, deployments, and user data.
					</li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					For a managed domain, the JBoss EAP domain controller should be updated first.
				</p></div><p>
				To install a JBoss EAP patch via RPM from your subscribed repository, update your Red Hat Enterprise Linux system using the following command:
			</p><pre class="screen"># yum update</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="patch_a_local_maven_repository"/>Optional: Patch a Local JBoss EAP Maven Repository</h1></div></div></div><p>
				If you have installed the JBoss EAP Maven repository, it may also need to be patched.
			</p><p>
				The JBoss EAP Maven repository is available online or as a downloaded ZIP file. If you use the publicly hosted online Maven repository, updates are automatically applied, and no action is required to update it. However, if you <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#install_the_jboss_eap_maven_repository_locally">installed the Maven repository locally using the ZIP file</a>, you are responsible for applying updates to the repository.
			</p><p>
				Whenever a cumulative patch is released for JBoss EAP, a corresponding patch is provided for the JBoss EAP Maven repository. This patch is available in the form of an incremental ZIP file that is unzipped into the existing local repository. It does not overwrite or remove any existing files, so there is no rollback requirement.
			</p><p>
				Use the following procedure to apply updates to your locally installed JBoss EAP Maven repository.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist"><li class="listitem">
						Valid access and subscription to the Red Hat Customer Portal.
					</li><li class="listitem">
						The JBoss EAP 7.2 Maven repository, previously downloaded and installed locally.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Update a Locally Installed JBoss EAP Maven Repository</strong></p><ol class="orderedlist"><li class="listitem">
						Open a browser and log into the <a class="link" href="https://access.redhat.com">Red Hat Customer Portal</a>.
					</li><li class="listitem">
						Select <span class="strong"><strong>Downloads</strong></span> from the menu at the top of the page.
					</li><li class="listitem">
						Find <code class="literal">Red Hat JBoss Enterprise Application Platform</code> in the list and click on it.
					</li><li class="listitem">
						Select the correct version of JBoss EAP from the <span class="strong"><strong>Version</strong></span> drop-down menu, then click on <span class="strong"><strong>Patches</strong></span> tab.
					</li><li class="listitem">
						Find <code class="literal">Red Hat JBoss Enterprise Application Platform 7.2 Update <span class="emphasis"><em>CP_NUMBER</em></span> Incremental Maven Repository</code> in the list, where <code class="literal"><span class="emphasis"><em>CP_NUMBER</em></span></code> is the cumulative patch number you want to update to, and then click <span class="strong"><strong>Download</strong></span>.
					</li><li class="listitem">
						Locate the path to your JBoss EAP Maven repository. This is referred to in the commands below as <code class="literal"><span class="emphasis"><em>EAP_MAVEN_REPOSITORY_PATH</em></span></code>.
					</li><li class="listitem"><p class="simpara">
						Unzip the downloaded Maven patch file directly into the directory of the JBoss EAP 7.2 Maven repository.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								For Red Hat Enterprise Linux, open a terminal and run the following command, replacing the values for the cumulative patch number and your Maven repository path.
							</p><pre class="screen">$ unzip -o jboss-eap-7.2.<span class="emphasis"><em>CP_NUMBER</em></span>-incremental-maven-repository.zip -d <span class="emphasis"><em>EAP_MAVEN_REPOSITORY_PATH</em></span></pre></li><li class="listitem">
								For Microsoft Windows, use the Windows extraction utility to extract the ZIP file into the root of the <code class="literal"><span class="emphasis"><em>EAP_MAVEN_REPOSITORY_PATH</em></span></code> directory.
							</li></ol></div></li></ol></div></div></div></body></html>