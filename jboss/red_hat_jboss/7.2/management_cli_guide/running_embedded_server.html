<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 10. Embedding a Server for Offline Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="running_embedded_server"/>Chapter 10. Embedding a Server for Offline Configuration</h1></div></div></div><p>
			You can embed a JBoss EAP standalone server or host controller process inside the management CLI process. This allows you to configure the server without it being visible on the network. A common use of this feature is for initial configuration of the server, such as managing security-related settings or avoiding port conflicts, prior to the server being online.
		</p><p>
			This direct, local administration of a JBoss EAP installation through the management CLI does not require a socket-based connection. You can use the management CLI with the embedded server in a way that is consistent with interacting with a remote JBoss EAP server. All of the standard management CLI commands that you can use to administer a remote server are available.
		</p><h2><a id="start_an_embedded_standalone_server"/>Start an Embedded Standalone Server</h2><p>
			You can launch a standalone server locally using the management CLI to modify standalone configuration without launching an additional process or opening network sockets.
		</p><p>
			The following procedure launches the management CLI, starts an embedded standalone server, modifies configuration, and then stops the embedded server.
		</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
					Launch the management CLI.
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh</pre></li><li class="listitem"><p class="simpara">
					Launch the embedded standalone server.
				</p><p class="simpara">
					Passing in the <code class="literal">--std-out=echo</code> parameter prints the standard output to the terminal.
				</p><pre class="screen">embed-server --std-out=echo</pre></li><li class="listitem"><p class="simpara">
					Perform the desired operations.
				</p><pre class="screen">/socket-binding-group=standard-sockets/socket-binding=management-http:write-attribute(name=port,value=9991)</pre></li><li class="listitem"><p class="simpara">
					Stop the embedded server.
				</p><pre class="screen">stop-embedded-server</pre><p class="simpara">
					This stops the embedded server and returns you to your management CLI session. If you want to exit the management CLI session as well, you can use the <code class="literal">quit</code> command.
				</p></li></ol></div><h3><a id="specifying_the_server_configuration"/>Specifying the Server Configuration</h3><p>
			By default, the embedded server will use the <code class="literal">standalone.xml</code> configuration file. You can use the <code class="literal">--server-config</code> parameter to specify a different configuration file to use.
		</p><pre class="screen">embed-server --server-config=standalone-full-ha.xml</pre><h3><a id="starting_in_admin_only_mode"/>Starting in Admin-only Mode</h3><p>
			By default, the embedded server is started in <code class="literal">admin-only</code> mode, which will start services related to server administration, but will not start other services or accept end-user requests. This is useful for the initial configuration of the server.
		</p><p>
			You can start the embedded server in the normal running mode by setting the <code class="literal">--admin-only</code> parameter to false.
		</p><pre class="screen">embed-server --admin-only=false</pre><p>
			You can also change the running mode using the <code class="literal">reload</code> command.
		</p><pre class="screen">reload --start-mode=normal</pre><h3><a id="controlling_standard_output"/>Controlling Standard Output</h3><p>
			You can control how to handle standard output from the embedded server. By default, standard output is discarded, but you could find the output in the server log. You can pass in <code class="literal">--std-out=echo</code> to have server output appear with the management CLI output.
		</p><pre class="screen">embed-server --std-out=echo</pre><h3><a id="boot_timeout"/>Boot Timeout</h3><p>
			By default, the <code class="literal">embed-server</code> command blocks indefinitely waiting for the embedded server to fully start. You can specify the time to wait in seconds using the <code class="literal">--timeout</code> parameter. A value less than <code class="literal">1</code> will return as soon as the embedded server reaches a point where it can be managed by the CLI.
		</p><pre class="screen">embed-server --timeout=30</pre><h3><a id="starting_with_a_blank_configuration"/>Starting with a Blank Configuration</h3><p>
			When starting an embedded server, you can specify to start with an empty configuration. This is useful if you want to build the entire server configuration using management CLI commands.
		</p><pre class="screen">embed-server --server-config=my-config.xml --empty-config</pre><p>
			This command will fail if the file already exists, which helps to avoid the accidental deletion of a configuration file. You can specify to remove any existing configuration by passing in the <code class="literal">--remove-existing</code> parameter.
		</p><pre class="screen">embed-server --server-config=my-config.xml --empty-config --remove-existing</pre><h2><a id="start_an_embedded_host_controller"/>Start an Embedded Host Controller</h2><p>
			You can launch a host controller locally using the management CLI to modify domain and host controller configuration without launching additional processes or opening network sockets.
		</p><p>
			An embedded host controller does not start any of its servers. Additionally, you can not use the <code class="literal">--admin-only</code> parameter when starting an embedded host controller. It will always be launched as if it is in <code class="literal">admin-only</code> mode.
		</p><p>
			The following procedure launches the management CLI, starts an embedded host controller, modifies configuration, and then stops the embedded host controller.
		</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
					Launch the management CLI.
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh</pre></li><li class="listitem"><p class="simpara">
					Launch the embedded host controller.
				</p><p class="simpara">
					Passing in the <code class="literal">--std-out=echo</code> parameter prints the standard output to the terminal.
				</p><pre class="screen">embed-host-controller --std-out=echo</pre></li><li class="listitem"><p class="simpara">
					Perform the desired operations.
				</p><pre class="screen">/host=<span class="emphasis"><em>HOST_NAME</em></span>:write-attribute(name=name,value=<span class="emphasis"><em>NEW_HOST_NAME</em></span>)</pre></li><li class="listitem"><p class="simpara">
					Stop the embedded host controller.
				</p><pre class="screen">stop-embedded-host-controller</pre></li></ol></div><h3><a id="specifying_the_host_controller_configuration"/>Specifying the Host Controller Configuration</h3><p>
			By default, the embedded host controller will use <code class="literal">domain.xml</code> for domain configuration and <code class="literal">host.xml</code> for host configuration. You can use the <code class="literal">--domain-config</code> and <code class="literal">--host-config</code> parameters to specify different configuration files to use.
		</p><pre class="screen">embed-host-controller --domain-config=other-domain.xml --host-config=host-slave.xml</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
				Depending on which alternative configuration file you use, you may need to set certain properties when launching the management CLI. For example,
			</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh -Djboss.domain.master.address=127.0.0.1</pre></div><h3><a id="controlling_standard_output_2"/>Controlling Standard Output</h3><p>
			You can control how to handle standard output from the embedded host controller. By default, standard output is discarded, but you could find the output in the host controller’s log. You can pass in <code class="literal">--std-out=echo</code> to have host controller output appear with the management CLI output.
		</p><pre class="screen">embed-host-controller --std-out=echo</pre><h3><a id="boot_timeout_2"/>Boot Timeout</h3><p>
			By default, the <code class="literal">embed-host-controller</code> command blocks indefinitely waiting for the embedded host controller to fully start. You can specify the time to wait in seconds using the <code class="literal">--timeout</code> parameter. A value less than <code class="literal">1</code> will return as soon as the embedded host controller reaches a point where it can be managed by the CLI.
		</p><pre class="screen">embed-host-controller --timeout=30</pre><h2><a id="non_modular_class_loading_with_the_management_cli"/>Non-Modular Class Loading with the Management CLI</h2><p>
			Using the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh</code> script to launch the management CLI uses a modular class loading environment. If you use the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/client/jboss-cli-client.jar</code> to run the management CLI in a non-modular class loading environment, you will need to specify the root JBoss EAP installation directory.
		</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
					Launch the management CLI.
				</p><pre class="screen">$ java -jar <span class="emphasis"><em>EAP_HOME</em></span>/bin/client/jboss-cli-client.jar</pre></li><li class="listitem"><p class="simpara">
					Start the embedded server, specifying the root installation directory.
				</p><pre class="screen">embed-server --jboss-home=<span class="emphasis"><em>/path/to/EAP_HOME</em></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						To embed a host controller, use the <code class="literal">embed-host-controller</code> command.
					</p></div><p class="simpara">
					The embedding logic will set up an appropriate modular class loading environment for the server. The module path for the modular class loader will have a single element: <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules</code>.
				</p></li></ol></div><p>
			No matter which way you launch the management CLI, the embedded server will run in a modular class loading environment.
		</p></div></body></html>