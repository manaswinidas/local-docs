<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 5. Configuring JBoss EAP Subsystems to Work on Cloud Platforms</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_subsystems_for_cloud_platforms"/>Chapter 5. Configuring JBoss EAP Subsystems to Work on Cloud Platforms</h1></div></div></div><p>
			Some JBoss EAP subsystems must be configured to work properly on cloud platforms, such as Amazon EC2 and Microsoft Azure. This is required because a JBoss EAP server is usually bound to a cloud virtual machine’s private IP address, for example: <code class="literal">10.x.x.x</code>, which is only visible from within the cloud platform. For certain subsystems, this address must also be mapped to a server’s public IP address, which is visible from outside the cloud.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="web_services"/>Web Services</h1></div></div></div><p>
				When a client makes a web service request using <code class="literal">Service.create(wsdlURL, serviceName);</code>, the user connects to the server public IP address, but is subsequently redirected to an address defined in the server configuration files in the <code class="literal">webservices</code> subsystem. By default, this address is <code class="literal">${jboss.bind.address:127.0.0.1}</code>, which means that on a cloud platform, the caller will be redirected to the server’s private IP address and will be unable to resolve the request. The server’s public IP address has to be configured in the <code class="literal">wsdl-host</code> element, using the following command:
			</p><pre class="screen">/subsystem=webservices:write-attribute(name=wsdl-host,value=PUBLIC_IP_ADDRESS)</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="messaging"/>Messaging</h1></div></div></div><p>
				When using messaging on a cloud platform, the connection factory that the client uses must have a connector pointing to the server’s public IP address.
			</p><p>
				For this reason a new connector and socket binding must be created for JBoss EAP servers running a <code class="literal">full</code> profile.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						The referenced <code class="literal">http-public</code> socket binding must be created within the <code class="literal">socket-binding-group</code>:
					</p><pre class="screen">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=http-public:add(host=PUBLIC_IP_ADDRESS,port=${jboss.http.port:8080})</pre></li><li class="listitem"><p class="simpara">
						Create the new <code class="literal">http-connector</code> element in the <code class="literal">messaging</code> subsystem:
					</p><pre class="screen">/subsystem=messaging-activemq/server=default/http-connector=http-public-connector:add(endpoint=http-acceptor, socket-binding=http-public)</pre></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">connectors</code> in the <code class="literal">connection-factory</code>, which will be used by clients. For example, configuration of <code class="literal">RemoteConnectionFactory</code> as the default connection will be:
					</p><pre class="screen">/subsystem=messaging-activemq/server=default/connection-factory=RemoteConnectionFactory:write-attribute(name=connectors, value=["http-public-connector"]</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="remoting_configuration_for_high_availability"/>Remoting Configuration for High Availability</h1></div></div></div><p>
				If you are using JBoss EAP HA features with clustered EJBs on a cloud platform, some extra configuration for the <code class="literal">remoting</code> subsystem is required to ensure EJB clients can receive cluster view updates.
			</p><p>
				This is done by configuring <code class="literal">client-mappings</code> for the <code class="literal">remoting</code> subsystem socket binding:
			</p><pre class="screen">/socket-binding-group=standard-sockets/socket-binding=http:write-attribute(name=client-mappings,value=[{ "destination-address" =&gt; "PUBLIC_IP_ADDRESS", "destination-port" =&gt; "8080" }])</pre></div></div></body></html>