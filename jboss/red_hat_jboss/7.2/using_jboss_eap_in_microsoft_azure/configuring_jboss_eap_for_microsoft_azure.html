<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. Configuring JBoss EAP for Microsoft Azure</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_jboss_eap_for_microsoft_azure"/>Chapter 6. Configuring JBoss EAP for Microsoft Azure</h1></div></div></div><div class="title"><strong>Starting JBoss EAP as a Service at Boot on Red Hat Enterprise Linux</strong></div><p>
				If you are starting JBoss EAP as a service on Red Hat Enterprise Linux in Microsoft Azure, you must change the following configuration of the JBoss EAP service to ensure that it starts after the Azure virtual machine host name has been initialized.
			</p><p>
			Open <code class="literal">/etc/systemd/system/multi-user.target.wants/eap7-standalone.service</code> and add a dependency on <code class="literal">waagent.service</code>:
		</p><p>
			Replace the following line:
		</p><pre class="screen">After=syslog.target network.target</pre><p>
			with:
		</p><pre class="screen">After=syslog.target network.target waagent.service
Requires=waagent.service</pre><p><a id="lb_with_mod_cluster"/></p><div class="title"><strong>Load Balancing with mod_cluster</strong></div><p>
				As a result of <a class="link" href="supported_configurations.html#unsupported_features" title="Unsupported Features">mod_cluster advertising not being supported in Azure</a>, if you are configuring a JBoss EAP load balancing environment, you must ensure that all balancers and workers are bound to IP addresses that are accessible on your internal Microsoft Azure virtual network.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
				Balancers and workers must be bound to the actual internal Azure virtual IP address, for example <code class="literal">172.28.0.2</code>, and not <code class="literal">0.0.0.0</code>.
			</p></div><p>
			Additionally, because of the unavailability of mod_cluster advertising, if you are using JBoss EAP as an Undertow mod_cluster proxy load balancer, you must configure each worker node to use a proxy list containing each balancer’s IP address and port, as shown below:
		</p><pre class="screen">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=<span class="emphasis"><em>proxy-one</em></span>:add(host="<span class="emphasis"><em>BALANCER_IP_ADDRESS</em></span>", port="<span class="emphasis"><em>BALANCER_PORT</em></span>")
/subsystem=modcluster/mod-cluster-config=configuration:list-add(name=proxies,value=<span class="emphasis"><em>proxy-one</em></span>)</pre><p><a id="messaging_ha"/></p><div class="title"><strong>ActiveMQ Artemis High Availability</strong></div><p>
				JBoss EAP messaging high availability using Artemis shared stores is not supported in Microsoft Azure. To configure JBoss EAP messaging high availability in Azure, you must use a replicated journal with <a class="link" href="using_jboss_eap_high_availability_in_microsoft_azure.html#configure_azure_ping" title="Configuring AZURE_PING for JBoss EAP High Availability">the AZURE_PING JGroups discovery protocol</a> using a TCP JGroups stack. For more information on using a replicated journal, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#data_replication">Data Replication</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
			</p><p>
			After configuring the TCP JGroups stack with AZURE_PING, you must add the JGroups stack to the <code class="literal">discovery-group</code> and <code class="literal">broadcast-group</code> <code class="literal">jgroups-cluster</code> configurations in the <code class="literal">messaging-activemq</code> subsystem. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#server_discovery">Server Discovery</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
		</p></div></body></html>