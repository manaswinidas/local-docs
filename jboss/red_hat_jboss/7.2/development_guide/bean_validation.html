<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 13. Bean Validation</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="bean_validation"/>Chapter 13. Bean Validation</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="about_bean_validation"/>About Bean Validation</h1></div></div></div><p>
				Bean Validation, or JavaBeans Validation, is a model for validating data in Java objects. The model uses built-in and custom annotation constraints to ensure the integrity of application data. It also offers method and constructor validation to ensure constraints on parameters and return values. The specification is documented in <a class="link" href="https://jcp.org/en/jsr/detail?id=380">JSR 380: Bean Validation 2.0</a>.
			</p><p>
				Hibernate Validator is the JBoss EAP implementation of Bean Validation. It is also the reference implementation of the JSR.
			</p><p>
				JBoss EAP is 100% compliant with JSR 380 Bean Validation 2.0 specification. Hibernate Validator also provides additional features to the specification.
			</p><p>
				To get started with Bean Validation, see the <code class="literal">bean-validation</code> quickstart that ships with JBoss EAP. For information about how to download and run the quickstarts, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/getting_started_guide/#using_the_quickstart_examples">Using the Quickstart Examples</a> in the JBoss EAP <span class="emphasis"><em>Getting Started Guide</em></span>.
			</p><p>
				JBoss EAP 7.2 includes Hibernate Validator 6.0.x.
			</p><h4><a id="features_hibernate_validator_6_0"/>Features of Hibernate Validator 6.0.x</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Bean Validation 2.0 defines a metadata model and API for entity and method validation.
					</p><p class="simpara">
						The default source for the metadata is annotations, with the ability to override and extend the metadata through the use of XML.
					</p><p class="simpara">
						The API is not tied to any specific application tier or programming model. It is available for both server-side application programming and rich client Swing application development.
					</p></li><li class="listitem">
						In addition to bug fixes, this release of Hibernate Validator contains many performance improvements for the most common use cases.
					</li><li class="listitem">
						As of version 1.1, Bean Validation constraints can also be applied to the parameters and return values of methods of arbitrary Java types using the Bean Validation API.
					</li><li class="listitem"><p class="simpara">
						Hibernate Validator 6.0.x and Bean Validation 2.0 require Java 8 or later.
					</p><p class="simpara">
						For more information, see <a class="link" href="http://in.relation.to/2018/03/27/hibernate-validator-609-final-out/">Hibernate Validator 6.0.9.Final released</a> and the <a class="link" href="https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/">Hibernate Validator 6.0.13.Final - JSR 380 Reference Implementation: Reference Guide</a>.
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="validation_constraints"/>Validation Constraints</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about_validation_constraints"/>About Validation Constraints</h2></div></div></div><p>
					Validation constraints are rules applied to a Java element, such as a field, property or bean. A constraint will usually have a set of attributes used to set its limits. There are predefined constraints, and custom ones can be created. Each constraint is expressed in the form of an annotation.
				</p><p>
					The built-in validation constraints for Hibernate Validator are listed here: <a class="link" href="bean_validation.html#hibernate_validator_constraints" title="Hibernate Validator Constraints">Hibernate Validator Constraints</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="hibernate_validator_constraints"/>Hibernate Validator Constraints</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						When applicable, the application-level constraints lead to creation of database-level constraints that are described in the <span class="strong"><strong>Hibernate Metadata Impact</strong></span> column in the table below.
					</p></div><div class="title"><strong>Java-specific Validation Constraints</strong></div><p>
						The following table includes validation constraints defined in the Java specifications, which are included in the <code class="literal">javax.validation.constraints</code> package.
					</p><div class="informaltable"><table border="1" width="100%"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/></colgroup><thead><tr><th style="text-align: left" valign="top">Annotation</th><th style="text-align: left" valign="top">Property type</th><th style="text-align: left" valign="top">Runtime checking</th><th style="text-align: left" valign="top">Hibernate Metadata impact</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									@AssertFalse
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Boolean
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check that the method evaluates to false. Useful for constraints expressed in code rather than annotations.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@AssertTrue
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Boolean
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check that the method evaluates to true. Useful for constraints expressed in code rather than annotations.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Digits(integerDigits=1)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Numeric or string representation of a numeric
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check whether the property is a number having up to <code class="literal">integerDigits</code> integer digits and <code class="literal">fractionalDigits</code> fractional digits.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Define column precision and scale.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Future
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Date or calendar
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the date is in the future.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Max(value=)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Numeric or string representation of a numeric
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the value is less than or equal to max.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Add a check constraint on the column.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Min(value=)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Numeric or string representation of a numeric
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the value is more than or equal to Min.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Add a check constraint on the column.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@NotNull
								</p>
								 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
									Check if the value is not null.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Column(s) are not null.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Past
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Date or calendar
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the date is in the past.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Add a check constraint on the column.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Pattern(regexp="regexp", flag=) or @Patterns( {@Pattern(…​)} )
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									String
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the property matches the regular expression given a match flag. See <code class="literal">java.util.regex.Pattern</code>.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Size(min=, max=)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Array, collection, map
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the element size is between min and max, both values included.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Valid
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Object
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Perform validation recursively on the associated object. If the object is a Collection or an array, the elements are validated recursively. If the object is a Map, the value elements are validated recursively.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The parameter <code class="literal">@Valid</code> is a part of the Bean Validation specification, even though it is located in the <code class="literal">javax.validation.constraints</code> package.
					</p></div><div class="title"><strong>Hibernate Validator-specific Validation Constraints</strong></div><p>
						The following table includes vendor-specific validation constraints, which are a part of the <code class="literal">org.hibernate.validator.constraints</code> package.
					</p><div class="informaltable"><table border="1" width="100%"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/></colgroup><thead><tr><th style="text-align: left" valign="top">Annotation</th><th style="text-align: left" valign="top">Property type</th><th style="text-align: left" valign="top">Runtime checking</th><th style="text-align: left" valign="top">Hibernate Metadata impact</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									@Length(min=, max=)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									String
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the string length matches the range.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Column length will be set to max.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@CreditCardNumber
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									String
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check whether the string is a well formatted credit card number, derivative of the Luhn algorithm.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@EAN
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									String
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check whether the string is a properly formatted EAN or UPC-A code.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Email
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									String
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check whether the string is conform to the e-mail address specification.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									None.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@NotEmpty
								</p>
								 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
									Check if the string is not null nor empty. Check if the connection is not null nor empty.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Columns are not null for String.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									@Range(min=, max=)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Numeric or string representation of a numeric
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Check if the value is between min and max, both values included.
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Add a check constraint on the column.
								</p>
								 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="bean_validation_using_custom_constraint"/>Bean Validation Using Custom Constraints</h2></div></div></div><p>
					Bean Validation API defines a set of standard constraint annotations, such as <code class="literal">@NotNull</code>, <code class="literal">@Size</code>, and so on. However, in cases where these predefined constraints are not sufficient, you can easily create custom constraints tailored to your specific validation requirements.
				</p><p>
					Creating a Bean Validation custom constraint requires that you <a class="link" href="bean_validation.html#creating_constraint_annotation" title="Creating A Constraint Annotation">create a constraint annotation</a> and <a class="link" href="bean_validation.html#implementing_constraint_validator" title="Implementing A Constraint Validator">implement a constraint validator</a>. The following abbreviated code examples are taken from the <code class="literal">bean-validation-custom-constraint</code> quickstart that ships with JBoss EAP. See that quickstart for a complete working example.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="creating_constraint_annotation"/>Creating A Constraint Annotation</h3></div></div></div><p>
						The following example shows the <code class="literal">personAddress</code> field of entity <code class="literal">Person</code> is validated using a set of custom constraints defined in the class <code class="literal">AddressValidator</code>.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create the entity <code class="literal">Person</code>.
							</p><div class="title"><strong>Example: <code class="literal">Person</code> Class</strong></div><p>
									
</p><pre class="programlisting">package org.jboss.as.quickstarts.bean_validation_custom_constraint;

@Entity
@Table(name = "person")
public class Person implements Serializable {

    private static final long serialVersionUID = 1L;

    @Id
    @GeneratedValue
    @Column(name = "person_id")
    private Long personId;

    @NotNull

    @Size(min = 4)
    private String firstName;

    @NotNull
    @Size(min = 4)
    private String lastName;

    // Custom Constraint @Address for bean validation
    @NotNull
    @Address
    @OneToOne(mappedBy = "person", cascade = CascadeType.ALL)
    private PersonAddress personAddress;

    public Person() {

    }

    public Person(String firstName, String lastName, PersonAddress address) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.personAddress = address;
    }

    /* getters and setters omitted for brevity*/
}</pre><p>

								</p></li><li class="listitem"><p class="simpara">
								Create the constraint validator files.
							</p><div class="title"><strong>Example: <code class="literal">Address</code> Interface</strong></div><p>
									
</p><pre class="programlisting">package org.jboss.as.quickstarts.bean_validation_custom_constraint;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
import javax.validation.Constraint;
import javax.validation.Payload;

// Linking the AddressValidator class with @Address annotation.
@Constraint(validatedBy = { AddressValidator.class })
// This constraint annotation can be used only on fields and method parameters.
@Target({ ElementType.FIELD, ElementType.PARAMETER })
@Retention(value = RetentionPolicy.RUNTIME)
@Documented
public @interface Address {

    // The message to return when the instance of MyAddress fails the validation.
    String message() default "Address Fields must not be null/empty and obey character limit constraints";

    Class&lt;?&gt;[] groups() default {};

    Class&lt;? extends Payload&gt;[] payload() default {};
}</pre><p>

								</p><div class="title"><strong>Example: <code class="literal">PersonAddress</code> Class</strong></div><p>
									
</p><pre class="programlisting">package org.jboss.as.quickstarts.bean_validation_custom_constraint;

import java.io.Serializable;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.OneToOne;
import javax.persistence.PrimaryKeyJoinColumn;
import javax.persistence.Table;

@Entity
@Table(name = "person_address")
public class PersonAddress implements Serializable {

    private static final long serialVersionUID = 1L;

    @Id
    @Column(name = "person_id", unique = true, nullable = false)
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    private Long personId;

    private String streetAddress;
    private String locality;
    private String city;
    private String state;
    private String country;
    private String pinCode;

    @OneToOne
    @PrimaryKeyJoinColumn
    private Person person;

    public PersonAddress() {

    }

    public PersonAddress(String streetAddress, String locality, String city, String state, String country, String pinCode) {
        this.streetAddress = streetAddress;
        this.locality = locality;
        this.city = city;
        this.state = state;
        this.country = country;
        this.pinCode = pinCode;
    }

    /* getters and setters omitted for brevity*/
}</pre><p>

								</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="implementing_constraint_validator"/>Implementing A Constraint Validator</h3></div></div></div><p>
						Having defined the annotation, you need to create a constraint validator that is able to validate elements with an <code class="literal">@Address</code> annotation. To do so, implement the interface <code class="literal">ConstraintValidator</code> as shown below:
					</p><div class="title"><strong>Example: <code class="literal">AddressValidator</code> Class</strong></div><p>
							
</p><pre class="programlisting">package org.jboss.as.quickstarts.bean_validation_custom_constraint;

import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;
import org.jboss.as.quickstarts.bean_validation_custom_constraint.PersonAddress;

public class AddressValidator implements ConstraintValidator&lt;Address, PersonAddress&gt; {

    public void initialize(Address constraintAnnotation) {
    }

    /**
     * 1. A null address is handled by the @NotNull constraint on the @Address.
     * 2. The address should have all the data values specified.
     * 3. Pin code in the address should be of at least 6 characters.
     * 4. The country in the address should be of at least 4 characters.
     */
    public boolean isValid(PersonAddress value, ConstraintValidatorContext context) {
        if (value == null) {
            return true;
        }

        if (value.getCity() == null || value.getCountry() == null || value.getLocality() == null
            || value.getPinCode() == null || value.getState() == null || value.getStreetAddress() == null) {
            return false;
        }

        if (value.getCity().isEmpty()
            || value.getCountry().isEmpty() || value.getLocality().isEmpty()
            || value.getPinCode().isEmpty() || value.getState().isEmpty() || value.getStreetAddress().isEmpty()) {
            return false;
        }

        if (value.getPinCode().length() &lt; 6) {
            return false;
        }

        if (value.getCountry().length() &lt; 4) {
            return false;
        }

        return true;
    }
}</pre><p>

						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="example_validation_configuration_file"/>Validation Configuration</h1></div></div></div><p>
				You can configure bean validation using XML descriptors in the <code class="literal">validation.xml</code> file located in the <code class="literal">/META-INF</code> directory. If this file exists in the class path, its configuration is applied when the <code class="literal">ValidatorFactory</code> gets created.
			</p><div class="title"><strong>Example: Validation Configuration File</strong></div><p>
					The following example shows several configuration options of the <code class="literal">validation.xml</code> file. All the settings are optional. These options can also be configured using the <code class="literal">javax.validation</code> package.
				</p><pre class="programlisting">&lt;validation-config xmlns="http://jboss.org/xml/ns/javax/validation/configuration"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jboss.org/xml/ns/javax/validation/configuration"&gt;

    &lt;default-provider&gt;
        org.hibernate.validator.HibernateValidator
    &lt;/default-provider&gt;
    &lt;message-interpolator&gt;
        org.hibernate.validator.messageinterpolation.ResourceBundleMessageInterpolator
    &lt;/message-interpolator&gt;
    &lt;constraint-validator-factory&gt;
        org.hibernate.validator.engine.ConstraintValidatorFactoryImpl
    &lt;/constraint-validator-factory&gt;

    &lt;constraint-mapping&gt;
        /constraints-example.xml
    &lt;/constraint-mapping&gt;

    &lt;property name="prop1"&gt;value1&lt;/property&gt;
    &lt;property name="prop2"&gt;value2&lt;/property&gt;
&lt;/validation-config&gt;</pre><p>
				The node <code class="literal">default-provider</code> allows to choose the bean validation provider. This is useful if there is more than one provider on the classpath. The <code class="literal">message-interpolator</code> and <code class="literal">constraint-validator-factory</code> properties are used to customize the used implementations for the interfaces <code class="literal">MessageInterpolator</code> and <code class="literal">ConstraintValidatorFactory</code>, which are defined in the <code class="literal">javax.validation</code> package. The <code class="literal">constraint-mapping</code> element lists additional XML files containing the actual constraint configuration.
			</p></div></div></body></html>