<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 15. Java Authorization Contract for Containers (JACC)</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="java_authorization_contract_for_containers_jacc"/>Chapter 15. Java Authorization Contract for Containers (JACC)</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="about_java_authorization_contract_for_containers_jacc"/>About Java Authorization Contract for Containers (JACC)</h1></div></div></div><p>
				Java Authorization Contract for Containers (JACC) is a standard which defines a contract between containers and authorization service providers, which results in the implementation of providers for use by containers. It is defined in JSR-115 of the Java Community Process. For details about the specifications, see <a class="link" href="http://jcp.org/en/jsr/detail?id=115">Java™ Authorization Contract for Containers</a>.
			</p><p>
				JBoss EAP implements support for JACC within the security functionality of the <code class="literal">security</code> subsystem.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_java_authorization_contract_for_containers_jacc_security"/>Configure Java Authorization Contract for Containers (JACC) Security</h1></div></div></div><p>
				You can configure Java Authorization Contract for Containers (JACC) by configuring your security domain with the correct module, and then modifying your <code class="literal">jboss-web.xml</code> to include the required parameters.
			</p><div class="title"><strong>Add JACC Support to the Security Domain</strong></div><p>
					To add JACC support to the security domain, add the <code class="literal">JACC</code> authorization policy to the authorization stack of the security domain, with the <code class="literal">required</code> flag set. The following is an example of a security domain with JACC support. However, it is recommended to configure the security domain from the management console or the management CLI, rather than directly modifying the XML.
				</p><div class="title"><strong>Example: Security Domain with JACC Support</strong></div><p>
					
</p><pre class="programlisting">&lt;security-domain name="jacc" cache-type="default"&gt;
    &lt;authentication&gt;
        &lt;login-module code="UsersRoles" flag="required"&gt;
        &lt;/login-module&gt;
    &lt;/authentication&gt;
    &lt;authorization&gt;
        &lt;policy-module code="JACC" flag="required"/&gt;
    &lt;/authorization&gt;
&lt;/security-domain&gt;</pre><p>

				</p><div class="title"><strong>Configure a Web Application to Use JACC</strong></div><p>
					The <code class="literal">jboss-web.xml</code> file is located in the <code class="literal">WEB-INF/</code> directory of your deployment, and contains overrides and additional JBoss-specific configuration for the web container. To use your JACC-enabled security domain, you need to include the <code class="literal">&lt;security-domain&gt;</code> element, and also set the <code class="literal">&lt;use-jboss-authorization&gt;</code> element to <code class="literal">true</code>. The following XML is configured to use the JACC security domain above.
				</p><div class="title"><strong>Example: Utilize the JACC Security Domain</strong></div><p>
					
</p><pre class="programlisting">&lt;jboss-web&gt;
    &lt;security-domain&gt;jacc&lt;/security-domain&gt;
    &lt;use-jboss-authorization&gt;true&lt;/use-jboss-authorization&gt;
&lt;/jboss-web&gt;</pre><p>

				</p><div class="title"><strong>Configure an EJB Application to Use JACC</strong></div><p>
					Configuring EJBs to use a security domain and to use JACC differs from web applications. For an EJB, you can declare method permissions on a method or group of methods, in the <code class="literal">ejb-jar.xml</code> descriptor. Within the <code class="literal">&lt;ejb-jar&gt;</code> element, any child <code class="literal">&lt;method-permission&gt;</code> elements contain information about JACC roles. See the example configuration below for details. The <code class="literal">EJBMethodPermission</code> class is part of the Java EE API, and is documented at <a class="link" href="https://access.redhat.com/webassets/avalon/d/red_hat_jboss_enterprise_application_platform/7.2/javadocs/javax/security/jacc/EJBMethodPermission.html">https://access.redhat.com/webassets/avalon/d/red_hat_jboss_enterprise_application_platform/7.2/javadocs/javax/security/jacc/EJBMethodPermission.html</a>.
				</p><div class="title"><strong>Example: JACC Method Permissions in an EJB</strong></div><p>
					
</p><pre class="programlisting">&lt;ejb-jar&gt;
  &lt;assembly-descriptor&gt;
    &lt;method-permission&gt;
      &lt;description&gt;The employee and temp-employee roles can access any method of the EmployeeService bean &lt;/description&gt;
      &lt;role-name&gt;employee&lt;/role-name&gt;
      &lt;role-name&gt;temp-employee&lt;/role-name&gt;
      &lt;method&gt;
        &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
        &lt;method-name&gt;*&lt;/method-name&gt;
      &lt;/method&gt;
    &lt;/method-permission&gt;
  &lt;/assembly-descriptor&gt;
&lt;/ejb-jar&gt;</pre><p>

				</p><p>
				You can also constrain the authentication and authorization mechanisms for an EJB by using a security domain, just as you can do for a web application. Security domains are declared in the <code class="literal">jboss-ejb3.xml</code> descriptor, in the <code class="literal">&lt;security&gt;</code> child element. In addition to the security domain, you can also specify the <code class="literal">&lt;run-as-principal&gt;</code>, which changes the principal that the EJB runs as.
			</p><div class="title"><strong>Example: Security Domain Declaration in an EJB</strong></div><p>
					
</p><pre class="programlisting">&lt;ejb-jar&gt;
    &lt;assembly-descriptor&gt;
        &lt;security&gt;
        &lt;ejb-name&gt;*&lt;/ejb-name&gt;
        &lt;security-domain&gt;myDomain&lt;/security-domain&gt;
        &lt;run-as-principal&gt;myPrincipal&lt;/run-as-principal&gt;
        &lt;/security&gt;
    &lt;/assembly-descriptor&gt;
&lt;/ejb-jar&gt;</pre><p>

				</p><h3><a id="enabling_jacc_using_elytron"/>Enabling JACC Using the <code class="literal">elytron</code> Subsystem</h3><div class="title"><strong>Disable JACC in the Legacy Security Subsystem</strong></div><p>
					By default, the application server uses the legacy <code class="literal">security</code> subsystem to configure the JACC policy provider and factory. The default configuration maps to implementations from PicketBox.
				</p><p>
				In order to use Elytron to manage JACC configuration, or any other policy you want to install to the application server, you must first disable JACC in the legacy <code class="literal">security</code> subsystem. For that, you can use the following management CLI command:
			</p><pre class="screen">/subsystem=security:write-attribute(name=initialize-jacc, value=false)</pre><p>
				Failure to do so can result in the following error in the server log: <code class="literal">MSC000004: Failure during stop of service org.wildfly.security.policy: java.lang.StackOverflowError</code>.
			</p><div class="title"><strong>Define a JACC Policy Provider</strong></div><p>
					The <code class="literal">elytron</code> subsystem provides a built-in policy provider based on JACC specification. To create the policy provider you can execute the following management CLI command:
				</p><pre class="screen">/subsystem=elytron/policy=jacc:add(jacc-policy={})

reload</pre><div class="title"><strong>Enable JACC to a Web Deployment</strong></div><p>
					Once a JACC policy provider is defined, you can enable JACC for web deployments by executing the following command:
				</p><pre class="screen">/subsystem=undertow/application-security-domain=other:add(security-domain=ApplicationDomain,enable-jacc=true)</pre><p>
				The command above defines a default security domain for applications, if none is provided in the <code class="literal">jboss-web.xml</code> file. In case you already have a <code class="literal">application-security-domain</code> defined and just want to enable JACC you can execute the following command:
			</p><pre class="screen">/subsystem=undertow/application-security-domain=my-security-domain:write-attribute(name=enable-jacc,value=true)</pre><div class="title"><strong>Enable JACC to an EJB Deployment</strong></div><p>
					Once a JACC policy provider is defined, you can enable JACC for EJB deployments by executing the following command:
				</p><pre class="screen">/subsystem=ejb3/application-security-domain=other:add(security-domain=ApplicationDomain,enable-jacc=true)</pre><p>
				The command above defines a default security domain for EJBs. In case you already have a <code class="literal">application-security-domain</code> defined and just want to enable JACC you can execute a command as follows:
			</p><pre class="screen">/subsystem=ejb3/application-security-domain=my-security-domain:write-attribute(name=enable-jacc,value=true)</pre><div class="title"><strong>Creating a Custom Elytron Policy Provider</strong></div><p>
					A custom policy provider is used when you need a custom <code class="literal">java.security.Policy</code>, like when you want to integrate with some external authorization service in order to check permissions. To create a custom policy provider, you will need to implement the <code class="literal">java.security.Policy</code>, create and plug in a custom module with the implementation and use the implementation from the module in the <code class="literal">elytron</code> subsystem.
				</p><pre class="screen">/subsystem=elytron/policy=policy-provider-a:add(custom-policy={class-name=MyPolicyProviderA, module=x.y.z})</pre><p>
				For more information, see the <a class="link" href="reference_material.html#policy_provider_properties" title="Policy Provider Properties">Policy Provider Properties</a>.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					In most cases, you can use the JACC policy provider as it is expected to be part of any Java EE compliant application server.
				</p></div></div></div></body></html>