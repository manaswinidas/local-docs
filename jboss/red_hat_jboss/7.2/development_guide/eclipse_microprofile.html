<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 19. Eclipse MicroProfile</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="eclipse_microprofile"/>Chapter 19. Eclipse MicroProfile</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_microprofile_opentracing_smallrye_tracer"/>Using Eclipse MicroProfile OpenTracing to Trace Requests</h1></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Eclipse Microprofile OpenTracing is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
				</p><p>
					See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
				</p></div><p>
				Eclipse Microprofile OpenTracing functionality is provided by the <code class="literal">microprofile-opentracing-smallrye</code> subsystem. This subsystem ships with the <a class="link" href="https://github.com/jaegertracing/jaeger-client-java">Jaeger Java Client</a> as the default tracer and provides a set of instrumentation libraries for components commonly used in Java EE applications, such as JAX-RS and CDI. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#eclipse_microprofile_opentracing">Tracing Requests with the MicroProfile OpenTracing SmallRye Subsystem</a> in the <span class="emphasis"><em>Configuration Guide</em></span> for more information about this subsystem.
			</p><p>
				The following sections describe how to customize tracing for <a class="link" href="eclipse_microprofile.html#microprofile_opentracing_smallrye_tracer_cdi" title="Enable or Disable Tracing for CDI Beans">CDI beans</a> and other <a class="link" href="eclipse_microprofile.html#microprofile_opentracing_smallrye_tracer_jaxrs_endpoints" title="Enable or Disable Tracing for JAX-RS Endpoints">JAX-RS endpoints</a>, and how to implement a <a class="link" href="eclipse_microprofile.html#microprofile_opentracing_smallrye_tracer_custom_implementation" title="Implement a Custom Tracer">custom tracer</a>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="microprofile_opentracing_smallrye_tracer_cdi"/>Enable or Disable Tracing for CDI Beans</h2></div></div></div><p>
					As defined by the Eclipse MicroProfile OpenTracing specification, CDI beans are traced if the <a class="link" href="http://download.eclipse.org/microprofile/microprofile-2.0-javadocs-test/apidocs/org/eclipse/microprofile/opentracing/Traced.html"><code class="literal">org.eclipse.microprofile.opentracing.Traced</code></a> annotation is present, either at the class or at the method level. Tracing can be disabled by setting the annotation value to <code class="literal">false</code>. Similarly, a custom operation name can be set by specifying the parameter <code class="literal">operationName</code> for that annotation. The semantics are defined by the <a class="link" href="https://github.com/eclipse/microprofile-opentracing/blob/master/spec/src/main/asciidoc/microprofile-opentracing.asciidoc">MicroProfile OpenTracing specification</a>.
				</p><p>
					The following example demonstrates how to configure tracing for a CDI bean. Note that tracing can be specified at the method level.
				</p><pre class="programlisting">import org.eclipse.microprofile.opentracing.Traced;

@Traced
public class TracedBean {
    public void doSomething() {
    }

    @Traced(true)
    public void doSomethingTraced() {
    }

    @Traced(false)
    public void doSomethingNotTraced() {
    }
}</pre><p>
					The following example demonstrates how to specify an operation name for the OpenTracing Span for this trace point.
				</p><pre class="programlisting">import org.eclipse.microprofile.opentracing.Traced;

@Traced(operationName = "my-custom-class-operation-name")
public class CustomOperationNameBean {

    @Traced(operationName = "my-custom-method-operation-name")
    public void doSomething() {
    }

    @Traced
    public void doSomethingElse() {
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="microprofile_opentracing_smallrye_tracer_jaxrs_endpoints"/>Enable or Disable Tracing for JAX-RS Endpoints</h2></div></div></div><p>
					JAX-RS endpoints are traced by default if the <code class="literal">microprofile-opentracing-smallrye</code> subsystem is present in the server configuration.
				</p><p>
					To disable tracing for JAX-RS endpoints, add the <code class="literal">@Traced(false)</code> annotation to the JAX-RS endpoint at the class or method level as described in <a class="link" href="eclipse_microprofile.html#microprofile_opentracing_smallrye_tracer_cdi" title="Enable or Disable Tracing for CDI Beans">Enable or Disable Tracing for CDI Beans</a> above.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="microprofile_opentracing_smallrye_tracer_custom_implementation"/>Implement a Custom Tracer</h2></div></div></div><p>
					If you need something more complex than what is provided by the default Jaeger Java Client, you can provide your own tracer by implementing a <a class="link" href="https://github.com/opentracing-contrib/java-tracerresolver"><code class="literal">TracerResolver</code></a> that returns the <a class="link" href="http://static.javadoc.io/io.opentracing/opentracing-api/0.32.0-RC1/io/opentracing/Tracer.html"><code class="literal">Tracer</code></a> with the desired state. In this case, the default tracer will <span class="emphasis"><em>not</em></span> be used.
				</p><p>
					The following example demonstrates how to create a new implementation of <code class="literal">TracerResolver</code> that returns a custom implementation of the <code class="literal">Tracer</code> class.
				</p><pre class="programlisting">import io.opentracing.Tracer;
import io.opentracing.contrib.tracerresolver.TracerResolver;
import org.myproject.opentracing.CustomTracer;

public static class MyTracerResolver extends TracerResolver {
    @Override
    protected Tracer resolve() {
        return new CustomTracer();
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_microprofile_health_smallrye"/>Using Eclipse MicroProfile Health to Monitor Server Health</h1></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Eclipse MicroProfile Health is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
				</p><p>
					See <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
				</p></div><p>
				<a class="link" href="https://github.com/eclipse/microprofile-health/">Eclipse Microprofile Health</a> functionality is provided by the <code class="literal">microprofile-health-smallrye</code> subsystem. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuration_guide/#microprofile_health_check">Monitor Server Health Using Eclipse MicroProfile Health</a> in the <span class="emphasis"><em>Configuration Guide</em></span> for more information about this subsystem.
			</p><p>
				The following section describe how to <a class="link" href="eclipse_microprofile.html#microprofile_health_smallrye_custom_check" title="Implement a Custom Health Check">implement a custom health check</a>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="microprofile_health_smallrye_custom_check"/>Implement a Custom Health Check</h2></div></div></div><p>
					The default implementation provided by the <code class="literal">microprofile-health-smallrye</code> subsystem performs a basic health check. For more detailed information, on either the server or application status, custom health checks may be included. Any CDI beans that include the <a class="link" href="https://openliberty.io/javadocs/microprofile-1.2-javadoc/org/eclipse/microprofile/health/Health.html"><code class="literal">org.eclipse.microprofile.health.Health</code></a> annotation at the class level are automatically discovered and invoked at runtime.
				</p><p>
					The following example demonstrates how to create a new implementation of a health check that returns an <code class="literal">UP</code> state.
				</p><pre class="programlisting">import org.eclipse.microprofile.health.Health;
import org.eclipse.microprofile.health.HealthCheck;
import org.eclipse.microprofile.health.HealthCheckResponse;

@Health
public class HealthTest implements HealthCheck {

    @Override
    public HealthCheckResponse call() {
        return HealthCheckResponse.named("health-test").up().build();
    }
}</pre><p>
					Once deployed, any subsequent health check queries will include the custom checks, as seen below.
				</p><pre class="screen">/subsystem=microprofile-health-smallrye:check
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "outcome" =&gt; "UP",
        "checks" =&gt; [{
            "name" =&gt; "health-test",
            "state" =&gt; "UP"
        }]
    }
}</pre></div></div></div></body></html>