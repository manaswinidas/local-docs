<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. Concurrency Utilities</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="concurrency_utilities"/>Chapter 9. Concurrency Utilities</h1></div></div></div><p>
			Concurrency Utilities is an API that accommodates Java SE concurrency utilities into the Java EE application environment specifications. It is defined in <a class="link" href="https://jcp.org/ja/jsr/detail?id=236">JSR 236: Concurrency Utilities for Java™ EE</a>. JBoss EAP allows you to create, edit, and delete instances of EE concurrency utilities, thus making these instances readily available for applications to use.
		</p><p>
			Concurrency Utilities help to extend the invocation context by pulling in the existing context’s application threads and using these in its own threads. This extending of invocation context includes class loading, JNDI, and security contexts, by default.
		</p><p>
			Types of Concurrency Utilities include:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					Context Service
				</li><li class="listitem">
					Managed Thread Factory
				</li><li class="listitem">
					Managed Executor Service
				</li><li class="listitem">
					Managed Scheduled Executor Service
				</li></ul></div><div class="title"><strong>Example: Concurrency Utilities in <code class="literal">standalone.xml</code></strong></div><p>
				
</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:ee:4.0"&gt;
            &lt;spec-descriptor-property-replacement&gt;false&lt;/spec-descriptor-property-replacement&gt;
            &lt;concurrent&gt;
                &lt;context-services&gt;
                    &lt;context-service name="default" jndi-name="java:jboss/ee/concurrency/context/default" use-transaction-setup-provider="true"/&gt;
                &lt;/context-services&gt;
                &lt;managed-thread-factories&gt;
                    &lt;managed-thread-factory name="default" jndi-name="java:jboss/ee/concurrency/factory/default" context-service="default"/&gt;
                &lt;/managed-thread-factories&gt;
                &lt;managed-executor-services&gt;
                    &lt;managed-executor-service name="default" jndi-name="java:jboss/ee/concurrency/executor/default" context-service="default" hung-task-threshold="60000" keepalive-time="5000"/&gt;
                &lt;/managed-executor-services&gt;
                &lt;managed-scheduled-executor-services&gt;
                    &lt;managed-scheduled-executor-service name="default" jndi-name="java:jboss/ee/concurrency/scheduler/default" context-service="default" hung-task-threshold="60000" keepalive-time="3000"/&gt;
                &lt;/managed-scheduled-executor-services&gt;
            &lt;/concurrent&gt;
            &lt;default-bindings context-service="java:jboss/ee/concurrency/context/default" datasource="java:jboss/datasources/ExampleDS" managed-executor-service="java:jboss/ee/concurrency/executor/default" managed-scheduled-executor-service="java:jboss/ee/concurrency/scheduler/default" managed-thread-factory="java:jboss/ee/concurrency/factory/default"/&gt;
&lt;/subsystem&gt;</pre><p>

			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="context-service"/>Context Service</h1></div></div></div><p>
				The context service (<code class="literal">javax.enterprise.concurrent.ContextService</code>) allows you to build contextual proxies from existing objects. Contextual proxy prepares the invocation context, which is used by other concurrency utilities when the context is created or invoked, before transferring the invocation to the original object.
			</p><p>
				Attributes of the context service concurrency utility include:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">name</code>: A unique name within all the context services.
					</li><li class="listitem">
						<code class="literal">jndi-name</code>: Defines where the context service should be placed in JNDI.
					</li><li class="listitem">
						<code class="literal">use-transaction-setup-provider</code>: Optional. Indicates if the contextual proxies built by the context service should suspend transactions in context when invoking the proxy objects. Its value defaults to <code class="literal">false</code>, but the default context service has the value <code class="literal">true</code>.
					</li></ul></div><p>
				See the example above for the usage of the context service concurrency utility.
			</p><div class="title"><strong>Example: Add a New Context Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/context-service=newContextService:add(jndi-name=java:jboss/ee/concurrency/contextservice/newContextService)</pre><p>

				</p><div class="title"><strong>Example: Change a Context Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/context-service=newContextService:write-attribute(name=jndi-name, value=java:jboss/ee/concurrency/contextservice/changedContextService)</pre><p>

				</p><p>
				This operation requires reload.
			</p><div class="title"><strong>Example: Remove a Context Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/context-service=newContextService:remove()</pre><p>

				</p><p>
				This operation requires reload.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="managed_thread_factory"/>Managed Thread Factory</h1></div></div></div><p>
				The managed thread factory <code class="literal">(javax.enterprise.concurrent.ManagedThreadFactory)</code> concurrency utility allows Java EE applications to create Java threads. JBoss EAP handles the managed thread factory instances, hence Java EE applications cannot invoke any lifecycle related method.
			</p><p>
				Attributes of managed thread factory concurrency utility include:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">context-service</code>: A unique name within all managed thread factories.
					</li><li class="listitem">
						<code class="literal">jndi-name</code>: Defines where in JNDI the managed thread factory should be placed.
					</li><li class="listitem">
						<code class="literal">priority</code>: Optional. Indicates the priority for new threads created by the factory, and defaults to <code class="literal">5</code>.
					</li></ul></div><div class="title"><strong>Example: Add a New Managed Thread Factory</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-thread-factory=newManagedTF:add(context-service=newContextService, jndi-name=java:jboss/ee/concurrency/threadfactory/newManagedTF, priority=2)</pre><p>

				</p><div class="title"><strong>Example: Change a Managed Thread Factory</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-thread-factory=newManagedTF:write-attribute(name=jndi-name, value=java:jboss/ee/concurrency/threadfactory/changedManagedTF)</pre><p>

				</p><p>
				This operation requires reload. Similarly, you can change other attributes as well.
			</p><div class="title"><strong>Example: Remove a Managed Thread Factory</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-thread-factory=newManagedTF:remove()</pre><p>

				</p><p>
				This operation requires reload.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="managed_executor_service"/>Managed Executor Service</h1></div></div></div><p>
				Managed executor service <code class="literal">(javax.enterprise.concurrent.ManagedExecutorService)</code> allows Java EE applications to submit tasks for asynchronous execution. JBoss EAP handles managed executor service instances, hence Java EE applications cannot invoke any lifecycle related method.
			</p><p>
				Attributes of managed executor service concurrency utility include:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">context-service</code>: Optional. References an existing context service by its name. If specified, then the referenced context service will capture the invocation context present when submitting a task to the executor, which will then be used when executing the task.
					</li><li class="listitem">
						<code class="literal">jndi-name</code>: Defines where the managed thread factory should be placed in JNDI.
					</li><li class="listitem">
						<code class="literal">max-threads</code>: Defines the maximum number of threads used by the executor. If undefined, the value from <code class="literal">core-threads</code> is used.
					</li><li class="listitem">
						<code class="literal">thread-factory</code>: References an existing managed thread factory by its name, to handle the creation of internal threads. If not specified, then a managed thread factory with default configuration will be created and used internally.
					</li><li class="listitem">
						<code class="literal">core-threads</code>: Defines the minimum number of threads to be used by the executor. If this attribute is undefined, the default is calculated based on the number of processors. A value of <code class="literal">0</code> is not recommended. See the <code class="literal">queue-length</code> attribute for details on how this value is used to determine the queuing strategy.
					</li><li class="listitem">
						<code class="literal">keepalive-time</code>: Defines the time, in milliseconds, that an internal thread can be idle. The attribute default value is <code class="literal">60000</code>.
					</li><li class="listitem">
						<code class="literal">queue-length</code>: Indicates the executor’s task queue capacity. A value of <code class="literal">0</code> means direct hand-off and possible rejection will occur. If this attribute is undefined or set to <code class="literal">Integer.MAX_VALUE</code>, this indicates that an unbounded queue should be used. All other values specify an exact queue size. If an unbounded queue or direct hand-off is used, a <code class="literal">core-threads</code> value greater than <code class="literal">0</code> is required.
					</li><li class="listitem">
						<code class="literal">hung-task-threshold</code>: Defines the time, in milliseconds, after which tasks are considered hung by the managed executor service and forcefully aborted. If the value is <code class="literal">0</code>, which is the default, tasks are never considered hung.
					</li><li class="listitem">
						<code class="literal">long-running-tasks</code>: Suggests optimizing the execution of long running tasks, and defaults to <code class="literal">false</code>.
					</li><li class="listitem">
						<code class="literal">reject-policy</code>: Defines the policy to use when a task is rejected by the executor. The attribute value can be the default <code class="literal">ABORT</code>, which means an exception should be thrown, or <code class="literal">RETRY_ABORT</code>, which means the executor will try to submit it once more, before throwing an exception
					</li></ul></div><div class="title"><strong>Example: Add a New Managed Executor Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-executor-service=newManagedExecutorService:add(jndi-name=java:jboss/ee/concurrency/executor/newManagedExecutorService, core-threads=7, thread-factory=default)</pre><p>

				</p><div class="title"><strong>Example: Change a Managed Executor Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-executor-service=newManagedExecutorService:write-attribute(name=core-threads,value=10)</pre><p>

				</p><p>
				This operation requires reload. Similarly, you can change other attributes too.
			</p><div class="title"><strong>Example: Remove a Managed Executor Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-executor-service=newManagedExecutorService:remove()</pre><p>

				</p><p>
				This operation requires reload.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="managed_scheduled_executor_service"/>Managed Scheduled Executor Service</h1></div></div></div><p>
				Managed scheduled executor service <code class="literal">(javax.enterprise.concurrent.ManagedScheduledExecutorService)</code> allows Java EE applications to schedule tasks for asynchronous execution. JBoss EAP handles managed scheduled executor service instances, hence Java EE applications cannot invoke any lifecycle related method.
			</p><p>
				Attributes of managed executor service concurrency utility include:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">context-service</code>: References an existing context service by its name. If specified then the referenced context service will capture the invocation context present when submitting a task to the executor, which will then be used when executing the task.
					</li><li class="listitem">
						<code class="literal">hung-task-threshold</code>: Defines the time, in milliseconds, after which tasks are considered hung by the managed scheduled executor service and forcefully aborted. If the value is <code class="literal">0</code>, which is the default, tasks are never considered hung.
					</li><li class="listitem">
						<code class="literal">keepalive-time</code>: Defines the time, in milliseconds, that an internal thread can be idle. The attribute default value is <code class="literal">60000</code>.
					</li><li class="listitem">
						<code class="literal">reject-policy</code>: Defines the policy to use when a task is rejected by the executor. The attribute value might be the default <code class="literal">ABORT</code>, which means an exception should be thrown, or <code class="literal">RETRY_ABORT</code>, which means the executor will try to submit it once more, before throwing an exception.
					</li><li class="listitem">
						<code class="literal">core-threads</code>: Defines the minimum number of threads to be used by the scheduled executor.
					</li><li class="listitem">
						<code class="literal">jndi-name</code>: Defines where the managed scheduled executor service should be placed in JNDI .
					</li><li class="listitem">
						<code class="literal">long-running-tasks</code>: Suggests optimizing the execution of long running tasks, and defaults to false.
					</li><li class="listitem">
						<code class="literal">thread-factory</code>: References an existing managed thread factory by its name, to handle the creation of internal threads. If not specified, then a managed thread factory with default configuration will be created and used internally.
					</li></ul></div><div class="title"><strong>Example: Add a New Managed Scheduled Executor Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-scheduled-executor-service=newManagedScheduledExecutorService:add(jndi-name=java:jboss/ee/concurrency/scheduledexecutor/newManagedScheduledExecutorService, core-threads=7, context-service=default)</pre><p>

				</p><p>
				This operation requires reload.
			</p><div class="title"><strong>Example: Changed a Managed Scheduled Executor Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-scheduled-executor-service=newManagedScheduledExecutorService:write-attribute(name=core-threads, value=10)</pre><p>

				</p><p>
				This operation requires reload. Similarly, you can change other attributes.
			</p><div class="title"><strong>Example: Remove a Managed Scheduled Executor Service</strong></div><p>
					
</p><pre class="programlisting">/subsystem=ee/managed-scheduled-executor-service=newManagedScheduledExecutorService:remove()</pre><p>

				</p><p>
				This operation requires reload.
			</p></div></div></body></html>