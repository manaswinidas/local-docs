<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Additional Use Cases for SSO with Red Hat JBoss Enterprise Application Platform</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="additional_sso_usecases"/>Chapter 3. Additional Use Cases for SSO with Red Hat JBoss Enterprise Application Platform</h1></div></div></div><p>
			In addition to the out-of-the-box functionality, JBoss EAP supports additional use cases for SSO, including SAML for browser-based SSO, desktop-based SSO, and SSO via a secure token service.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="browser_based_sso_using_saml"/>Browser-Based SSO Using SAML</h1></div></div></div><p>
				In a browser-based SSO scenario, one or more web applications, known as service providers, are connected to a centralized identity provider in a hub-and-spoke architecture. The identity provider (IDP) acts as the central source, or hub, for identity and role information to all the service providers, or spokes. When an unauthenticated user attempts to access one of the service providers, that user is redirected to an IDP to perform the authentication. The IDP authenticates the user, issues a SAML token specifying the role of the principal, and redirects them to the requested service provider. From there, that SAML token is used across all of the associated service providers to determine the user’s identity and access. This specific method of using SSO starting at the service providers is known as a service provider-initiated flow.
			</p><p>
				Like many SSO systems, JBoss EAP uses IDPs and SPs. Both of these components are enabled to be run within JBoss EAP instances and work in conjunction with the JBoss EAP <code class="literal">security</code> subsystem. SAML v2, FORM-based web application security, and HTTP/POST and HTTP/Redirect Bindings are also used to implement SSO.
			</p><p>
				To create an identity provider, create a security domain, for example <code class="literal">idp-domain</code>, in a JBoss EAP instance that defines an authentication and authorization mechanism, for example LDAP or a database, to serve as the identity store. A web application, for example <code class="literal">IDP.war</code>, is configured to use additional modules, <code class="literal">org.picketlink</code>, required for running an IDP in conjunction with <code class="literal">idp-domain</code> and is deployed to that same JBoss EAP instance. IDP.war will serve as an identity provider. To create a service provider, a security domain is created, for example <code class="literal">sp-domain</code>, that uses <code class="literal">SAML2LoginModule</code> as an authentication mechanism. A web application, for example <code class="literal">SP.war</code>, is configured to use additional modules, <code class="literal">org.picketlink</code>, and contains a service provider valve that uses <code class="literal">sp-domain</code>. <code class="literal">SP.war</code> is deployed to an JBoss EAP instance where <code class="literal">sp-domain</code> is configured and is now a service provider. This process can be replicated for one or more SPs, for example <code class="literal">SP2.war</code>, <code class="literal">SP3.war</code>, and so on, and across one or more JBoss EAP instances.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="identity_provider_initiated_flow"/>Identity Provider Initiated Flow</h2></div></div></div><p>
					In most SSO scenarios, the SP starts the flow by sending an authentication request to the IDP, which sends a SAML response to SP with a valid assertion. This is known as a SP-initiated flow. The SAML 2.0 specifications define another flow, one called IDP-initiated or Unsolicited Response flow. In this scenario, the service provider does not initiate the authentication flow to receive a SAML response from the IDP. The flow starts on the IDP side. Once authenticated, the user can choose a specific SP from a list and get redirected to the SP’s URL. No special configuration is necessary to enable this flow.
				</p><div class="orderedlist"><p class="title"><strong>Walkthrough</strong></p><ol class="orderedlist"><li class="listitem">
							User accesses the IDP.
						</li><li class="listitem">
							The IDP, seeing that there is neither a SAML request nor a response, assumes an IDP-initiated flow scenario using SAML.
						</li><li class="listitem">
							The IDP challenges the user to authenticate.
						</li><li class="listitem">
							Upon authentication, the IDP shows the hosted section where the user gets a page that links to all the SP applications.
						</li><li class="listitem">
							The user chooses an SP application.
						</li><li class="listitem">
							The IDP redirects the user to the SP with a SAML assertion in the query parameter, SAML response.
						</li><li class="listitem">
							The SP checks the SAML assertion and provides access.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="global_logout"/>Global Logout</h2></div></div></div><p>
					A global logout initiated at one SP logs out the user from the IDP and all the SPs. If a user attempts to access secured portions of any SP or IDP after performing a global logout, they must reauthenticate.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="desktop_based_sso"/>Desktop-Based SSO</h1></div></div></div><p>
				A desktop-based SSO scenario enables a principal to be shared across the desktop, usually governed by an <a class="link" href="overview_of_general_security_concepts.html#third_party_sso" title="Third-Party SSO Implementations">Active Directory</a> or <a class="link" href="overview_of_general_security_concepts.html#third_party_sso" title="Third-Party SSO Implementations">Kerberos</a> server, and a set of web applications which are the SPs. In this case, the desktop IDP serves as the IDP for the web applications.
			</p><p>
				In a typical setup, the user logs in to a desktop governed by the Active Directory domain. The user accesses a web application via a web browser configured with JBoss Negotiation and hosted on the JBoss EAP. The web browser transfers the sign-on information from the local machine of the user to the web application. JBoss EAP uses background GSS messages with the Active Directory or any Kerberos Server to validate the user. This enables the user to achieve a seamless SSO into the web application.
			</p><p>
				To set up a desktop-based SSO as an IDP for a web application, a security domain is created that connects to the IDP server. A NegotiationAuthenticator is added as a valve to the desired web application, and JBoss Negotiation is added to the SP container’s class path. Alternatively, an IDP can be set up similarly to the browser-based SSO scenario but using the desktop-based SSO provider as an identity store.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sso_using_sts"/>SSO Using STS</h1></div></div></div><p>
				JBoss EAP offers several login modules for SPs to connect to an STS. It can also run an STS (<code class="literal">PicketLinkSTS</code>). More specifically, the <code class="literal">PicketLinkSTS</code> defines several interfaces to other security token services and provides extension points. Implementations can be plugged in by using configuration, and the default values can be specified for some properties via configuration. This means that the <code class="literal">PicketLinkSTS</code> generates and manages the security tokens but does not issue tokens of a specific type. Instead, it defines generic interfaces that allow multiple token providers to be plugged in. As a result, it can be configured to deal with various types of token, as long as a token provider exists for each token type. It also specifies the format of the security token request and response messages.
			</p><p>
				The following steps are the order that the security token requests are processed when using the JBoss EAP STS.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						A client sends a security token request to <code class="literal">PicketLinkSTS</code>.
					</li><li class="listitem">
						<code class="literal">PicketLinkSTS</code> parses the request message and generates a JAXB object model.
					</li><li class="listitem">
						<code class="literal">PicketLinkSTS</code> reads the configuration file and creates the <code class="literal">STSConfiguration</code> object, if needed. It obtains a reference to the <code class="literal">WSTrustRequestHandler</code> from the configuration and delegates the request processing to the handler instance.
					</li><li class="listitem">
						The request handler uses the <code class="literal">STSConfiguration</code> to set default values when needed, for example when the request does not specify a token lifetime value.
					</li><li class="listitem">
						The <code class="literal">WSTrustRequestHandler</code> creates the <code class="literal">WSTrustRequestContext</code> and sets the JAXB request object and the caller principal it received from <code class="literal">PicketLinkSTS</code>.
					</li><li class="listitem">
						The <code class="literal">WSTrustRequestHandler</code> uses the <code class="literal">STSConfiguration</code> to get the <code class="literal">SecurityTokenProvider</code> that must be used to process the request based on the type of the token that is being requested. It invokes the provider and passes the constructed <code class="literal">WSTrustRequestContext</code> as a parameter.
					</li><li class="listitem">
						The <code class="literal">SecurityTokenProvider</code> instance processes the token request and stores the issued token in the request context.
					</li><li class="listitem">
						The <code class="literal">WSTrustRequestHandler</code> obtains the token from the context, encrypts it, if needed, and constructs the WS-Trust response object containing the security token.
					</li><li class="listitem">
						<code class="literal">PicketLinkSTS</code> dictates the response generated by the request handler and returns it to the client.
					</li></ol></div><p>
				An STS login module, for example STSIssuingLoginModule, STSValidatingLoginModule, SAML2STSLoginModule, and so on, is typically configured as part of the security setup of a JEE container to use an STS for authenticating users. The STS may be collocated on the same container as the login module or be accessed remotely through web service calls or another technology.
			</p></div></div></body></html>