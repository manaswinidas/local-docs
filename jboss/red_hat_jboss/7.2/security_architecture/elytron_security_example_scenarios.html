<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 4. Elytron Subsystem Example Scenarios</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_security_example_scenarios"/>Chapter 4. Elytron Subsystem Example Scenarios</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_ootb_example"/>Out of the Box</h1></div></div></div><p>
				By default, JBoss EAP provides the following components preconfigured:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ApplicationDomain</span></dt><dd>
							The <code class="literal">ApplicationDomain</code> security domain uses <code class="literal">ApplicationRealm</code> and <code class="literal">groups-to-roles</code> for authentication. It also uses <code class="literal">default-permission-mapper</code> to assign the login permission.
						</dd><dt><span class="term">ApplicationRealm</span></dt><dd>
							The <code class="literal">ApplicationRealm</code> security realm is a properties realm that authenticates principals using <code class="literal">application-users.properties</code> and assigns roles using <code class="literal">application-roles.properties</code>. These files are located under <code class="literal">jboss.server.config.dir</code>, which by default, maps to <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration</code>. They are also the same files used by the legacy security default configuration.
						</dd><dt><span class="term">application-http-authentication</span></dt><dd>
							The <code class="literal">application-http-authentication</code> http-authentication-factory can be used for doing authentication over HTTP. It uses the <code class="literal">global</code> provider-http-server-mechanism-factory to filter authentication mechanism and uses <code class="literal">ApplicationDomain</code> for authenticating principals. It accepts <code class="literal">BASIC</code> and <code class="literal">FORM</code> authentication mechanisms and exposes <code class="literal">BASIC</code> as <code class="literal">Application Realm</code> to applications.
						</dd><dt><span class="term">application-sasl-authentication</span></dt><dd>
							The <code class="literal">application-sasl-authentication</code> sasl-authentication-factory can be used for authentication using SASL. It uses the <code class="literal">configured</code> sasl-server-factory to filter authentication mechanisms, which also uses the <code class="literal">global</code> provider-sasl-server-factory to filter by provider names. <code class="literal">application-sasl-authentication</code> uses the <code class="literal">ApplicationDomain</code> security domain for authentication of principals.
						</dd><dt><span class="term">configured (configurable-sasl-server-factory)</span></dt><dd>
							This is used to filter <code class="literal">sasl-authentication-factory</code> is used based on the mechanism name. In this case, <code class="literal">configured</code> will match on <code class="literal">JBOSS-LOCAL-USER</code> and <code class="literal">DIGEST-MD5</code>. It also sets the <code class="literal">wildfly.sasl.local-user.default-user</code> to <code class="literal">$local</code>.
						</dd><dt><span class="term">default-permission-mapper</span></dt><dd><p class="simpara">
							The <code class="literal">default-permission-mapper</code> is a simple permission mapper that uses the <code class="literal">default-permissions</code> permission set to assign the full set of permissions that an identity requires to access any services on the server.
						</p><p class="simpara">
							For example, the <code class="literal">default-permission-mapper</code> uses <code class="literal">org.wildfly.extension.batch.jberet.deployment.BatchPermission</code> specified by the <code class="literal">default-permissions</code> permission set to assign permissions for batch jobs. The batch permissions are start, stop, restart, abandon, and read which aligns with <code class="literal">javax.batch.operations.JobOperator</code>.
						</p><p class="simpara">
							The <code class="literal">default-permission-mapper</code> also uses <code class="literal">org.wildfly.security.auth.permission.LoginPermission</code> specified by the <code class="literal">login-permission</code> permission set to assign the login permission.
						</p></dd><dt><span class="term">elytron (mechanism-provider-filtering-sasl-server-factor)</span></dt><dd>
							This is used to filter which <code class="literal">sasl-authentication-factory</code> is used based on the provider. In this case, <code class="literal">elytron</code> will match on the <code class="literal">WildFlyElytron</code> provider name.
						</dd><dt><span class="term">global (provider-http-server-mechanism-factory)</span></dt><dd>
							This is the HTTP server factory mechanism definition used to list the supported authentication mechanisms when creating an HTTP authentication factory.
						</dd><dt><span class="term">global (provider-sasl-server-factory)</span></dt><dd>
							This is the SASL server factory definition used to create SASL authentication factories.
						</dd><dt><span class="term">groups-to-roles</span></dt><dd>
							The <code class="literal">groups-to-roles</code> mapper is a simple-role-decoder that will decode the <code class="literal">groups</code> information of a principal and use it for the <code class="literal">role</code> information.
						</dd><dt><span class="term">local (mapper)</span></dt><dd>
							The <code class="literal">local</code> mapper is a constant role mapper that maps to the <code class="literal">local</code> security realm. This is used to map authentication to the <code class="literal">local</code> security realm.
						</dd><dt><span class="term">local (security realm)</span></dt><dd>
							The <code class="literal">local</code> security realm does no authentication and sets the identity of principals to <code class="literal">$local</code>.
						</dd><dt><span class="term">ManagementDomain</span></dt><dd>
							The <code class="literal">ManagementDomain</code> security domain uses two security realms for authentication: <code class="literal">ManagementRealm</code> with <code class="literal">groups-to-roles</code> and <code class="literal">local</code> with <code class="literal">super-user-mapper</code>. It also uses <code class="literal">default-permission-mapper</code> to assign the login permission.
						</dd><dt><span class="term">ManagementRealm</span></dt><dd>
							The <code class="literal">ManagementRealm</code> security realm is a properties realm that authenticates principals using <code class="literal">mgmt-users.properties</code> and assigns roles using <code class="literal">mgmt-roles.properties</code>. These files are located under <code class="literal">jboss.server.config.dir</code>, which by default, maps to <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration</code>. They are also the same files used by the legacy security default configuration.
						</dd><dt><span class="term">management-http-authentication</span></dt><dd>
							The <code class="literal">management-http-authentication</code> http-authentication-factory can be used for doing authentication over HTTP. It uses the <code class="literal">global</code> provider-http-server-mechanism-factory to filter authentication mechanism and uses <code class="literal">ManagementDomain</code> for authenticating principals. It accepts the <code class="literal">DIGEST</code> authentication mechanisms and exposes it as <code class="literal">ManagementRealm</code> to applications.
						</dd><dt><span class="term">management-sasl-authentication</span></dt><dd>
							The <code class="literal">management-sasl-authentication</code> sasl-authentication-factory can be used for authentication using SASL. It uses the <code class="literal">configured</code> sasl-server-factory to filter authentication mechanisms, which also uses the <code class="literal">global</code> provider-sasl-server-factory to filter by provider names. <code class="literal">management-sasl-authentication</code> uses the <code class="literal">ManagementDomain</code> security domain for authentication of principals. It also maps authentication using <code class="literal">JBOSS-LOCAL-USER</code> mechanisms using the <code class="literal">local</code> realm mapper and authentication using <code class="literal">DIGEST-MD5</code> to <code class="literal">ManagementRealm</code>.
						</dd><dt><span class="term">super-user-mapper</span></dt><dd>
							The <code class="literal">super-user-mapper</code> mapper is a constant role mapper that maps the <code class="literal">SuperUser</code> role to a principal.
						</dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security"/>Security</h2></div></div></div><p>
					For securing applications, JBoss EAP comes preconfigured with <code class="literal">application-http-authentication</code> for using HTTP and <code class="literal">application-sasl-authentication</code> for using SASL. The <code class="literal">application-http-authentication</code> http-authentication-factory uses <code class="literal">ApplicationDomain</code> which uses <code class="literal">ApplicationRealm</code> and <code class="literal">groups-to-roles</code> for authentication. <code class="literal">ApplicationRealm</code> is a properties-realm backed by <code class="literal">application-users.properties</code> and <code class="literal">application-roles.properties</code> for username, password, and role information.
				</p><p>
					For securing the management interfaces, JBoss EAP comes preconfigured with <code class="literal">management-http-authentication</code> for HTTP and <code class="literal">management-sasl-authentication</code> for SASL. The <code class="literal">management-http-authentication</code> http-authentication-factory uses <code class="literal">ManagementDomain</code> which uses <code class="literal">ManagementRealm</code> and <code class="literal">groups-to-roles</code> for authentication. <code class="literal">ManagementRealm</code> is a properties-realm backed by <code class="literal">mgmt-users.properties</code> and <code class="literal">mgmt-roles.properties</code> for username, password, and role information. The <code class="literal">management-sasl-authentication</code> sasl-authentication-factory uses <code class="literal">ManagementDomain</code> which uses <code class="literal">local</code> for <code class="literal">JBOSS-LOCAL-USER</code> authentication and <code class="literal">ManagementRealm</code> for <code class="literal">DIGEST-MD5</code> authentication.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works"/>How It Works</h2></div></div></div><p>
					By default, there are no users for JBoss EAP, but for the purposes of this example the following users have been added:
				</p><div class="table"><a id="idm140063379059936"/><p class="title"><strong>Table 4.1. Users</strong></p><div class="table-contents"><table summary="Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th><th style="text-align: left" valign="top">Security Realm</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Susan
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
									ManagementRealm
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Sarah
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									sample
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									ApplicationRealm
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Frank
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
									ApplicationRealm
								</p>
								 </td></tr></tbody></table></div></div><p>
					On startup, the JBoss EAP instance loads all four authentication factories and their associated security domains, security realms, and other configured components.
				</p><p>
					If anyone attempts to access the management interface with the management CLI using <code class="literal">JBOSS-LOCAL-USER</code>, in other words running the management CLI from the same host as the JBoss EAP instance, the user will be directed to the <code class="literal">management-sasl-authentication</code> sasl-authentication-factory which will attempt to authenticate the user with <code class="literal">ManagementDomain</code> using the <code class="literal">local</code> security realm.
				</p><p>
					If Susan attempts to access the management interface using the management CLI from a different host, she will be using the <code class="literal">DIGEST-MD5</code> authentication mechanism with SASL. She will be directed to the <code class="literal">management-sasl-authentication</code> sasl-authentication-factory which will attempt to authenticate the user with <code class="literal">ManagementDomain</code> using the <code class="literal">ManagementRealm</code> security realm.
				</p><p>
					If Susan attempts to access the management interface using the web-based management console, she will be using the <code class="literal">DIGEST</code> authentication mechanism with HTTP. She will be directed to the <code class="literal">management-http-authentication</code> http-authentication-factory which will attempt to authenticate the user with <code class="literal">ManagementDomain</code> using the <code class="literal">ManagementRealm</code> security realm.
				</p><p>
					The application <code class="literal">sampleApp1.war</code> has two HTML files, <code class="literal">/hello.html</code> and <code class="literal">/secure/hello.html</code>, and uses <code class="literal">BASIC</code> HTTP authentication to secure the path <code class="literal">/secure/*</code>. It uses the <code class="literal">Application Realm</code> and requires the role of <code class="literal">sample</code>. When a user attempts to access <code class="literal">sampleApp1.war</code>, they are directed to the <code class="literal">application-http-authentication</code> http-authentication-factory. It will attempt to authenticate the user with <code class="literal">ApplicationDomain</code> using the <code class="literal">ApplicationRealm</code> security realm.
				</p><p>
					When Sarah requests <code class="literal">/hello.html</code>, she is able to view the page without authenticating. When Sarah tries to request <code class="literal">/secure/hello.html</code>, she is prompted to enter her username and password. She is able to view <code class="literal">/secure/hello.html</code> after successfully logging in. Frank and Susan, or any user, can access <code class="literal">/hello.html</code>, but neither can access <code class="literal">/secure/hello.html</code>. Frank does not have the <code class="literal">sample</code> role, and Susan is not in the <code class="literal">ApplicationRealm</code> security realm.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_ssl_tls_to_secure_the_management_interfaces_and_applications"/>Using SSL/TLS to Secure the Management Interfaces and Applications</h1></div></div></div><p>
				This scenario shows how JBoss EAP is secured when using Elytron for SSL/TLS with both management interfaces and applications.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_2"/>Security</h2></div></div></div><p>
					JBoss EAP provides the ability to secure both the management interfaces as well as applications with SSL/TLS. With Elytron, this configuration is now unified so you now have the option to secure both the management interfaces and applications with the same SSL/TLS configuration. SSL/TLS is configured in Elytron by creating a <code class="literal">key-store</code>, <code class="literal">key-manager</code>, and <code class="literal">server-ssl-context</code>. SSL/TLS is enabled for the management interfaces by setting <code class="literal">secure-socket-binding</code> on the <code class="literal">http-interface</code> and by assigning the <code class="literal">server-ssl-context</code> to the management interfaces. This enables the management interfaces to use SSL/TLS for HTTP traffic. SSL/TLS is enabled for applications by assigning the <code class="literal">server-ssl-context</code> to the <code class="literal">https-listener</code> in the <code class="literal">undertow</code> subsystem. For more background information on SSL/TLS see the <a class="link" href="eap_security_out_of_the_box.html#advanced_security" title="Advanced Security">Advanced Security</a> section.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_2"/>How It Works</h2></div></div></div><p>
					On startup, JBoss EAP loads the management interfaces as part of the core services, which also starts the <code class="literal">http-interface</code>, configured for SSL/TLS for the management interfaces. It also starts the <code class="literal">undertow</code> subsystem, which is configured for SSL/TLS for applications, and the <code class="literal">elytron</code> subsystem which provides the SSL/TLS configuration through the <code class="literal">server-ssl-context</code>. Both the management interfaces and applications can then be accessed over the secure ports with SSL/TLS enabled.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="elytron_scenario_new_ident_store"/>Securing the Management Interfaces and Applications with a New Identity Store</h1></div></div></div><p>
				This scenario shows how both the management interfaces and applications in JBoss EAP are secured with a new identity store in Elytron. An application, <code class="literal">sampleApp2.war</code>, is deployed to JBoss EAP and is configured to use <code class="literal">basicExampleDomain</code>.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_3"/>Security</h2></div></div></div><p>
					JBoss EAP provides the ability to secure both the management interfaces as well as applications with identity stores beyond <code class="literal">ManagementRealm</code> and <code class="literal">ApplicationRealm</code>. With Elytron, the same identity store can be used to secure the management interfaces as well as applications, but you also still have the option to set up separate identity stores for each. An identity store is represented by a security realm, for example a <code class="literal">filesystem-realm</code>, <code class="literal">jdbc-realm</code>, or <code class="literal">ldap-realm</code>. For the purposes of this example, a <code class="literal">filesystem-realm</code> named <code class="literal">exampleRealm</code> has been created. A security domain named <code class="literal">exampleDomain</code> has also been created which uses <code class="literal">exampleRealm</code> as an identity store, the <code class="literal">groups-to-roles</code> role mapper to decode the group information provided by <code class="literal">exampleRealm</code> into roles, and <code class="literal">default-permission-mapper</code> for mapping permissions.
				</p><p>
					For HTTP authentication, an <code class="literal">http-authentication-factory</code> called <code class="literal">exampleHttpAuthFactory</code> has been created. It uses the <code class="literal">global</code> HTTP server factory mechanism and <code class="literal">exampleDomain</code> for authentication. It also has two mechanism configurations. One that uses the <code class="literal">BASIC</code> authentication method exposed as <code class="literal">basicExampleDomain</code>, and one that uses the <code class="literal">DIGEST</code> authentication method exposed as <code class="literal">digestExampleDomain</code>. The HTTP management interface has been configured to use <code class="literal">exampleHttpAuthFactory</code>. The <code class="literal">undertow</code> subsystem has also been configured with a new <code class="literal">application-security-domain</code> which also uses <code class="literal">exampleHttpAuthFactory</code>. The application <code class="literal">sampleApp2.war</code> is configured to use <code class="literal">basicExampleDomain</code> with <code class="literal">BASIC</code> authentication.
				</p><p>
					For SASL authentication a <code class="literal">sasl-authentication-factory</code> called <code class="literal">exampleSaslAuthFactory</code> has been created. It uses the <code class="literal">configured</code> SASL server factory and <code class="literal">exampleDomain</code> for authentication. It also has a <code class="literal">DIGEST-MD5</code> authentication mechanism configured which is exposed as <code class="literal">digestMD5ExampleDomain</code>. The SASL configuration for the management interfaces has been set to use <code class="literal">exampleSaslAuthFactory</code>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_3"/>How It Works</h2></div></div></div><p>
					The following users have been added to <code class="literal">exampleRealm</code>:
				</p><div class="table"><a id="idm140063291558208"/><p class="title"><strong>Table 4.2. exampleRealm Users</strong></p><div class="table-contents"><table summary="exampleRealm Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Vincent
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									sample
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Issac
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									guest
								</p>
								 </td></tr></tbody></table></div></div><p>
					On startup, JBoss EAP loads the core services and starts the <code class="literal">undertow</code> and <code class="literal">elytron</code> subsystems. This secures the management interfaces and exposes <code class="literal">basicExampleDomain</code>, <code class="literal">digestExampleDomain</code>, and <code class="literal">digestMD5ExampleDomain</code> for applications deployed to JBoss EAP.
				</p><p>
					When <code class="literal">sampleApp2.war</code> is loaded, it looks for <code class="literal">basicExampleDomain</code> to provide authentication and authorization for its secured URLs. It has two HTML files, <code class="literal">/hello.html</code> and <code class="literal">/secure/hello.html</code>, and uses BASIC authentication to secure the path <code class="literal">/secure/*</code>. It requires the role of <code class="literal">sample</code> to access any secure URLs.
				</p><p>
					When users authenticate, their credentials are submitted using a specific mechanism depending on how they are accessing JBoss EAP. For instance, if a user attempts to access the management console using HTTP with DIGEST authentication, they will authenticate using the DIGEST authentication method exposed as <code class="literal">digestExampleDomain</code>. If they attempt to access <code class="literal">sampleApp2.war</code> using HTTP with BASIC authentication, they will authenticate using the BASIC authentication method exposed as <code class="literal">basicExampleDomain</code>. If they attempt to access the management CLI using SASL with DIGEST authentication, they will authenticate using the DIGEST-MD5 exposed as <code class="literal">digestMD5ExampleDomain</code>. The HTTP authentication mechanisms use <code class="literal">exampleHttpAuthFactory</code>, and the SASL authentication mechanism uses <code class="literal">exampleSaslAuthFactory</code>. Both authentication factories handle authentication and role mapping with <code class="literal">exampleDomain</code>.
				</p><p>
					If Vincent or Issac attempt to access the management interfaces, they are prompted for their username and password. After successfully logging in, they are each able to perform management operations.
				</p><p>
					When Vincent or Issac requests <code class="literal">/hello.html</code>, they are able to view the page without authenticating. When Vincent or Issac tries to request <code class="literal">/secure/hello.html</code>, they are prompted to enter a username and password. After successfully logging in, Vincent is able to view <code class="literal">/secure/hello.html</code> since he has the <code class="literal">sample</code> role but Issac will not be able to view <code class="literal">/secure/hello.html</code> since he has the <code class="literal">guest</code> role. All other users can access <code class="literal">/hello.html</code> without logging in, but none can access <code class="literal">/secure/hello.html</code> because Vincent and Issac are the only users in <code class="literal">exampleRealm</code>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_rbac_to_secure_the_management_interfaces"/>Using RBAC to Secure the Management Interfaces</h1></div></div></div><p>
				This scenario shows how the JBoss EAP management interfaces are secured with RBAC and an identity store in the <code class="literal">elytron</code> subsystem.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_4"/>Security</h2></div></div></div><p>
					JBoss EAP offers the ability to use RBAC on the management interfaces. The concepts behind RBAC are covered in the <a class="link" href="eap_security_out_of_the_box.html#rbac" title="Role-Based Access Control">RBAC</a> section. This example uses a security realm called <code class="literal">exampleRealm</code>. The remainder of the security configuration, including role decoder, security domain, and authentication factories, are the same as in the <a class="link" href="elytron_security_example_scenarios.html#elytron_scenario_new_ident_store" title="Securing the Management Interfaces and Applications with a New Identity Store">Securing the Management Interfaces and Applications with a New Identity Store</a> section. RBAC is enabled by setting the <code class="literal">provider</code> attribute to <code class="literal">rbac</code> for the management interface and updating the <code class="literal">exampleRealm</code> with the desired users and roles.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_4"/>How It Works</h2></div></div></div><p>
					For this scenario, the following users have been added to the existing security realms:
				</p><div class="table"><a id="idm140063394180432"/><p class="title"><strong>Table 4.3. exampleRealm Users</strong></p><div class="table-contents"><table summary="exampleRealm Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Suzy
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Tim
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Emily
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Zach
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Natalie
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td></tr></tbody></table></div></div><p>
					Based on group membership, the users have also been mapped to the following RBAC roles:
				</p><div class="table"><a id="idm140063284613568"/><p class="title"><strong>Table 4.4. RBAC Roles</strong></p><div class="table-contents"><table summary="RBAC Roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">RBAC Role</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Suzy
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									SuperUser
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Tim
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Administrator
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Emily
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Maintainer
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Zach
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Deployer
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Natalie
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Monitor
								</p>
								 </td></tr></tbody></table></div></div><p>
					On startup, JBoss EAP loads the core services and <code class="literal">elytron</code> subsystem, which loads the security configuration and the RBAC configuration. If RBAC was not enabled, any user in the <code class="literal">exampleRealm</code> is considered a <code class="literal">SuperUser</code> and has unlimited access. Because RBAC has been enabled, each user is now restricted based on the roles they have. Suzy, Tim, Emily, Zach, and Natalie have different roles, which are shown in the table above. For example, only Suzy and Tim can read and modify access control information. Suzy, Tim, and Emily can modify runtime state and other persistent configuration information. <code class="literal">Zach</code> can also modify runtime state and other persistent configuration information but only related to application resources. Suzy, Tim, Emily, Zach, and Natalie can read configuration and state information, but Natalie cannot update anything. For more details on each of the roles and how JBoss EAP handles RBAC, see the <a class="link" href="eap_security_out_of_the_box.html#rbac" title="Role-Based Access Control">Role-Based Access Control</a> and <a class="link" href="eap_security_out_of_the_box.html#adding_rbac_to_the_management_interfaces" title="Adding RBAC to the Management Interfaces">Adding RBAC to the Management Interfaces</a> sections.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_kerberos_to_provide_sso_for_web_applications"/>Using Kerberos to Provide SSO for Web Applications</h1></div></div></div><p>
				This scenario shows how Kerberos can be used with JBoss EAP to provide SSO for web applications. A JBoss EAP instance has been created, <code class="literal">EAP1</code>, and is running as a standalone server. Two web applications, <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code>, have been deployed to <code class="literal">EAP1</code>. Both the web applications and <code class="literal">EAP1</code> have been configured to authenticate using desktop-based SSO with Kerberos.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_5"/>Security</h2></div></div></div><p>
					JBoss EAP provides authentication with Kerberos using the <code class="literal">SPNEGO</code> authentication method. For more information on the specifics of Kerberos and SPNEGO, please see the <a class="link" href="overview_of_general_security_concepts.html#third_party_sso" title="Third-Party SSO Implementations">Third-Party SSO Implementations</a> section. To enable JBoss EAP and deployed web applications to use Kerberos for authentication, a <code class="literal">kerberos-security-factory</code> is created to connect to the Kerberos server. A security realm, role mapper, and security domain are also created for assigning roles to users from the Kerberos server. An <code class="literal">http-authentication-factory</code> is created that uses the <code class="literal">kerberos-security-factory</code> and uses the security domain for authentication and role assignment. An authentication mechanism is exposed as <code class="literal">exampleSpnegoDomain</code> using a <code class="literal">SPNEGO</code> authentication mechanism. The <code class="literal">undertow</code> subsystem is also configured to use the <code class="literal">http-authentication-factory</code> for authentication.
				</p><p>
					Both <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code> are configured to use <code class="literal">exampleSpnegoDomain</code> to perform authentication and get a user’s roles for authorization. Both applications can also be configured with <code class="literal">FORM</code> authentication as a fallback authentication mechanism in case the security tokens cannot be passed from the operating system to the browser. If <code class="literal">FORM</code> authentication is configured as a fallback, an additional authentication mechanism, along with a supporting security domain, must be configured. This authentication mechanism is independent of Kerberos and <code class="literal">SPNEGO</code> and only has to support <code class="literal">FORM</code> authentication. In this case, an additional mechanism and supporting security domain have been configured for <code class="literal">FORM</code> authentication and exposed as <code class="literal">exampleFormDomain</code>. Each application is configured to use a <code class="literal">exampleFormDomain</code> and to provide <code class="literal">FORM</code> authentication as a fallback. Each application is also configured to secure the path <code class="literal">/secure/*</code> and supplies its own list of roles for handling authorization.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_5"/>How It Works</h2></div></div></div><p>
					The following users have been created in the Kerberos server:
				</p><div class="table"><a id="idm140063394222848"/><p class="title"><strong>Table 4.5. Kerberos Users</strong></p><div class="table-contents"><table summary="Kerberos Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Sande
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Andrea
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Betty
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Chuck
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td></tr></tbody></table></div></div><p>
					The following roles are mapped to the users using the security domain:
				</p><div class="table"><a id="idm140063384831904"/><p class="title"><strong>Table 4.6. User Roles</strong></p><div class="table-contents"><table summary="User Roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Sande
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Andrea
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									A
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Betty
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									B
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Chuck
								</p>
								 </td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></div><p>
					The following roles have also been configured in each application:
				</p><div class="table"><a id="idm140063383683216"/><p class="title"><strong>Table 4.7. Application Roles</strong></p><div class="table-contents"><table summary="Application Roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Application/SP</th><th style="text-align: left" valign="top">Allowed Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									sampleAppA
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all, A
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									sampleAppB
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all, B
								</p>
								 </td></tr></tbody></table></div></div><p>
					On startup, <code class="literal">EAP1</code> loads the core services, followed by the <code class="literal">elytron</code> and other subsystems. The <code class="literal">kerberos-security-factory</code> establishes a connection to the Kerberos server. Both <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code> are deployed and connect to <code class="literal">exampleSpnegoDomain</code> and <code class="literal">exampleFormDomain</code> for authentication.
				</p><p>
					Sande has logged in to a computer that is secured with Kerberos. She opens a browser and attempts to access <code class="literal">sampleAppA/secure/hello.html</code>. Because that is secured, authentication is required. <code class="literal">EAP1</code> directs the browser to send a request for a key to the Kerberos server, specifically the Kerberos Key Distribution Center that is configured on her computer. After the browser obtains a key, it is sent to <code class="literal">sampleAppA</code>. <code class="literal">sampleAppA</code> sends the ticket using <code class="literal">exampleSpnegoDomain</code> to JBoss EAP where it is unpacked and authentication is performed in conjunction with the configured Kerberos server in the <code class="literal">kerberos-security-factory</code>. Once the ticket is authenticated, Sande’s role is passed back to <code class="literal">sampleAppA</code> to perform authorization. Because Sande has the <code class="literal">all</code> role, she will be able to access <code class="literal">sampleAppA/secure/hello.html</code>. If Sande tries to access <code class="literal">sampleAppB/secure/hello.html</code>, the same process will occur. She will be granted access, due to her having the <code class="literal">all</code> role. Andrea and Betty would follow the same process, but with Andrea only having access to <code class="literal">sampleAppA/secure/hello.html</code> and not <code class="literal">sampleAppB/secure/hello.html</code>. Betty would be the opposite, having access to <code class="literal">sampleAppB/secure/hello.html</code> and not <code class="literal">sampleAppA/secure/hello.html</code>. Chuck would pass authentication to either <code class="literal">sampleAppA/secure/hello.html</code> or <code class="literal">sampleAppB/secure/hello.html</code> but would not be granted access to either because he does not have any roles.
				</p><p>
					If Sande were to attempt to access <code class="literal">sampleAppA/secure/hello.html</code> from a computer not secured by Kerberos, for example a personal laptop connected to the office network, she would be directed to the <code class="literal">FORM</code> login page as a fallback. Her credentials would then be authenticated using the fallback authentication mechanism and the process would continue with authorization.
				</p></div></div></div></body></html>