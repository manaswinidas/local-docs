<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 5. Legacy Core Management and Security Subsystem Example Scenarios</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="security_example_scenarios"/>Chapter 5. Legacy Core Management and Security Subsystem Example Scenarios</h1></div></div></div><p>
			One way of understanding how JBoss EAP security and its components work together is to review real scenarios. The following sections cover several generalized but realistic situations that involve the various JBoss EAP security components and configuration options. They focus on how an application or set of applications is secured as well as how the management interfaces are secured.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="red_hat_jboss_enterprise_application_platform_out_of_the_box"/>Red Hat JBoss Enterprise Application Platform Out of the Box</h1></div></div></div><p>
				This scenario shows how JBoss EAP and a sample application are secured when no configuration changes are made after the initial installation. An application, <code class="literal">sampleApp1.war</code>, is deployed and configured to use container-based security.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario1.png" width="600" alt="scenario1"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="core_management_authentication_out_of_the_box"/>Core Management Authentication out of the Box</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="security_6"/>Security</h3></div></div></div><p>
						The Core Management Authentication offers two preconfigured security realms by default: <code class="literal">ManagementRealm</code> and <code class="literal">ApplicationRealm</code>. These realms use property files to store the usernames, passwords, and roles. The <code class="literal">ManagementRealm</code>, which is used to store the authentication information and the management APIs, also defines and enables local authentication for users using the CLI on the same host as the JBoss EAP instance. The <code class="literal">ApplicationRealm</code> is preconfigured to store authentication and authorization information but for use with other applications besides the management APIs. In addition, <code class="literal">ApplicationRealm</code> comes preconfigured with local authentication enabled, but it is not commonly used.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how_it_works_6"/>How It Works</h3></div></div></div><p>
						For this scenario, the following users have been added to a default installation of JBoss EAP:
					</p><div class="table"><a id="idm140063382658032"/><p class="title"><strong>Table 5.1. Users</strong></p><div class="table-contents"><table summary="Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th><th style="text-align: left" valign="top">Security Realm</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										Susan
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Testing123!
									</p>
									 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
										ManagementRealm
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Sarah
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Testing123!
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										sample
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										ApplicationRealm
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Frank
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Testing123!
									</p>
									 </td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> <p>
										ApplicationRealm
									</p>
									 </td></tr></tbody></table></div></div><p>
						On startup, the JBoss EAP instance loads the <code class="literal">ManagementRealm</code> and <code class="literal">ApplicationRealm</code> security realms.
					</p><p>
						If Susan attempts to access either of the management interfaces, HTTP or CLI, she is required to authenticate. Her username, password, and roles must match an entry in the <code class="literal">ManagementRealm</code> security realm. By default, no roles are required to access the management APIs. Sarah and Frank would not be able to access the management APIs because they are not in the <code class="literal">ManagementRealm</code> security realm.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_subsystem_out_of_the_box"/>Security Subsystem out of the Box</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="security_7"/>Security</h3></div></div></div><p>
						The <code class="literal">security</code> subsystem comes preconfigured with four security domains: <code class="literal">other</code>, <code class="literal">jboss-web-policy</code>, <code class="literal">jboss-ejb-policy</code>, and <code class="literal">jaspitest</code>. The <code class="literal">other</code> security domain performs authentication and authorization by delegating to the realm specified in the login module, which uses <code class="literal">ApplicationRealm</code> by default.
					</p><p>
						Additional information about the default security realms and the default security domains can be found in the <a class="link" href="eap_security_out_of_the_box.html#security_realms" title="Security Realms">Security Realms</a> and <a class="link" href="eap_security_out_of_the_box.html#security_domains-1" title="Security Domains">Security Domains</a> sections.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how_it_works_7"/>How It Works</h3></div></div></div><p>
						The application <code class="literal">sampleApp1.war</code> has two HTML files, <code class="literal">/hello.html</code> and <code class="literal">/secure/hello.html</code>, and uses basic HTTP authentication to secure the path <code class="literal">/secure/*</code>. It uses the <code class="literal">other</code> security domain and requires the role of <code class="literal">sample</code>. Because the <code class="literal">other</code> security domain defers to <code class="literal">ApplicationRealm</code> for its authentication and authorization information, refer to the users in the <code class="literal">Users</code> table from the <a class="link" href="security_example_scenarios.html#core_management_authentication_out_of_the_box" title="Core Management Authentication out of the Box">previous section</a>.
					</p><p>
						When Sarah requests <code class="literal">/hello.html</code>, she is able to view the page without authenticating. When Sarah tries to request <code class="literal">/secure/hello.html</code>, she is prompted to enter her username and password. She is able to view <code class="literal">/secure/hello.html</code> after successfully logging in. Frank and Susan, or any user, can access <code class="literal">/hello.html</code>, but neither can access <code class="literal">/secure/hello.html</code>. Frank does not have the <code class="literal">sample</code> role, and Susan is not in the <code class="literal">ApplicationRealm</code> security realm.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="red_hat_jboss_enterprise_application_platform_with_https_and_rbac_added_to_the_management_interfaces"/>Red Hat JBoss Enterprise Application Platform with HTTPS and RBAC Added to the Management Interfaces</h1></div></div></div><p>
				This scenario shows how JBoss EAP is secured when HTTPS is enabled for the management interfaces and RBAC is added to the <code class="literal">ManagementRealm</code> security realm.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario2.png" width="600" alt="scenario2"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_8"/>Security</h2></div></div></div><p>
					JBoss EAP provides support for using HTTPS with the management interfaces, which includes the management console. HTTPS can be enabled by configuring the <code class="literal">secure-interface</code> element, adding a <code class="literal">secure-port</code> to the <code class="literal">http-interface</code> section of the management interface, and configuring an existing or new security realm with the desired settings, for example, server-identities, protocol, keystore, alias, and so on. This enables the management interfaces to use SSL/TLS for all HTTP traffic. For more background information on HTTPS and securing the management interfaces in general, see the <a class="link" href="eap_security_out_of_the_box.html#advanced_security" title="Advanced Security">Advanced Security</a> section.
				</p><p>
					JBoss EAP also offers the ability to enable <a class="link" href="eap_security_out_of_the_box.html#rbac" title="Role-Based Access Control">RBAC</a> on the management interfaces using a couple of different authentication schemes. This example uses username and password authentication with the existing property files used in the <code class="literal">ManagementRealm</code>. RBAC is enabled by setting the <code class="literal">provider</code> attribute to <code class="literal">rbac</code> for the management interface and updating the <code class="literal">ManagementRealm</code> with the desired users and roles.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_8"/>How It Works</h2></div></div></div><p>
					For this scenario, the following users have been added to the existing security realms:
				</p><div class="table"><a id="idm140063389780288"/><p class="title"><strong>Table 5.2. Management Users</strong></p><div class="table-contents"><table summary="Management Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Security Realm</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Suzy
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									ManagementRealm
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Tim
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									ManagementRealm
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Emily
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									ManagementRealm
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Zach
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									ManagementRealm
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Natalie
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Testing123!
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									ManagementRealm
								</p>
								 </td></tr></tbody></table></div></div><p>
					Based on group membership, the users have also been mapped to the following RBAC roles:
				</p><div class="table"><a id="idm140063402979968"/><p class="title"><strong>Table 5.3. RBAC Roles</strong></p><div class="table-contents"><table summary="RBAC Roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">RBAC Role</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Suzy
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									SuperUser
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Tim
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Administrator
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Emily
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Maintainer
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Zach
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Deployer
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Natalie
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Monitor
								</p>
								 </td></tr></tbody></table></div></div><p>
					On startup, JBoss EAP loads the <code class="literal">ManagementRealm</code>, with the RBAC configuration, and management interfaces as part of the core services, which also starts the <code class="literal">http-interface</code>, configured for HTTPS, for the management interfaces. Users now access the management interfaces via HTTPS, and RBAC has also been enabled and configured. If RBAC is not enabled, any user in the <code class="literal">ManagementRealm</code> security realm is considered a <code class="literal">SuperUser</code> and has unlimited access. Because RBAC has been enabled, each user is now restricted based on the roles they have. Suzy, Tim, Emily, Zach, and Natalie have different roles, which are shown in the table above. For example, only Suzy and Tim can read and modify access control information. Suzy, Tim, and Emily can modify runtime state and other persistent configuration information. <code class="literal">Zach</code> can also modify runtime state and other persistent configuration information but only related to application resources. Suzy, Tim, Emily, Zach, and Natalie can read configuration and state information, but Natalie cannot update anything. For more details on each of the roles and how JBoss EAP handles RBAC, see the <a class="link" href="eap_security_out_of_the_box.html#rbac" title="Role-Based Access Control">Role-Based Access Control</a> and <a class="link" href="eap_security_out_of_the_box.html#adding_rbac_to_the_management_interfaces" title="Adding RBAC to the Management Interfaces">Adding RBAC to the Management Interfaces</a> sections.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="red_hat_jboss_enterprise_application_platform_with_an_updated_security_subsystem_including_https"/>Red Hat JBoss Enterprise Application Platform with an Updated Security Subsystem including HTTPS</h1></div></div></div><p>
				This scenario shows how a sample application running on JBoss EAP is secured when a new security domain is added and HTTPS is enabled. An application, <code class="literal">sampleApp2.war</code>, is deployed that is configured to use container-based security, <code class="literal">sample-domain</code>, and HTTPS.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario3.png" width="600" alt="scenario3"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_9"/>Security</h2></div></div></div><p>
					JBoss EAP provides support for using HTTPS for use with applications, which is handled using the <code class="literal">undertow</code> subsystem. A new connector for HTTPS is added to the <code class="literal">undertow</code> subsystem and is configured with the desired settings, for example, protocol, port, keystore, and so on. Once the configuration is saved, web applications can start accepting HTTPS traffic on the configured port. A new security domain called <code class="literal">sample-domain</code> has been added, and it uses the <code class="literal">IdentityLoginModule</code> for authentication. <code class="literal">sampleApp2.war</code> is configured to use <code class="literal">sample-domain</code> to authenticate users.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_9"/>How It Works</h2></div></div></div><p>
					A security domain, <code class="literal">sample-domain</code>, has been created and configured to use the <code class="literal">IdentityLoginModule</code>. The following credentials have been configured in the login module:
				</p><div class="table"><a id="idm140063379096160"/><p class="title"><strong>Table 5.4. sample-domain Users</strong></p><div class="table-contents"><table summary="sample-domain Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Vincent
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									sample
								</p>
								 </td></tr></tbody></table></div></div><p>
					On startup, JBoss EAP loads the core services and starts the <code class="literal">undertow</code> and <code class="literal">security</code> subsystems that manage the HTTPS connections for all web applications and the <code class="literal">sample-domain</code>, respectively. <code class="literal">sampleApp2.war</code> is loaded and looks for <code class="literal">sample-domain</code> for providing authentication and authorization for its secured URLs. <code class="literal">sampleApp2.war</code> has two HTML files, <code class="literal">/hello.html</code> and <code class="literal">/secure/hello.html</code>, and uses basic HTTP authentication to secure the path <code class="literal">/secure/*</code>. It uses the <code class="literal">sample-domain</code> security domain and requires the role of <code class="literal">sample</code>.
				</p><p>
					When Vincent requests <code class="literal">/hello.html</code>, he is able to view the page without authenticating. When Vincent tries to request <code class="literal">/secure/hello.html</code>, he is prompted to enter his username and password. After successfully logging in, he is able to view <code class="literal">/secure/hello.html</code>. All other users can access <code class="literal">/hello.html</code> without logging in, but none can access <code class="literal">/secure/hello.html</code> because Vincent is the only user in <code class="literal">sample-domain</code>. This also applies to all traffic handled over HTTPS.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sso_for_web_applications_on_red_hat_jboss_enterprise_application_platform"/>SSO for Web Applications on Red Hat JBoss Enterprise Application Platform</h1></div></div></div><p>
				This scenario shows how web applications make use of clustered and non-clustered SSO on JBoss EAP. Four JBoss EAP instances are created: <code class="literal">EAP1</code>, <code class="literal">EAP2</code>, <code class="literal">EAP3</code>, and <code class="literal">EAP4</code>. <code class="literal">EAP1</code> and <code class="literal">EAP2</code> operate as standalone servers, and <code class="literal">EAP3</code> and <code class="literal">EAP4</code> operate as a two-node cluster. Two web applications, <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code>, have been deployed to each of the four JBoss EAP instances.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario4.png" width="800" alt="scenario4"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_10"/>Security</h2></div></div></div><p>
					JBoss EAP provides support for clustered and non-clustered SSO with web applications by using a combination of the <code class="literal">security</code>, <code class="literal">undertow</code>, and <code class="literal">infinispan</code> subsystems. The <code class="literal">security</code> subsystem provides a security domain for performing authentication and authorization, while the <code class="literal">infinispan</code> and <code class="literal">undertow</code> subsystems help with caching and distributing the SSO information between all the web applications on an JBoss EAP instance or across a JBoss EAP cluster. All four EAP instances have a security domain, <code class="literal">sso-domain</code>, configured to use the <code class="literal">IdentityLoginModule</code>. <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code> have been configured to use the <code class="literal">sso-domain</code> security domain to secure the path <code class="literal">/secure/*</code> and require the role of <code class="literal">sample</code> to access it. The following credentials have been configured in the <code class="literal">sso-domain</code> login module:
				</p><div class="table"><a id="idm140063397144848"/><p class="title"><strong>Table 5.5. sso-domain Users</strong></p><div class="table-contents"><table summary="sso-domain Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Jane
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									sample
								</p>
								 </td></tr></tbody></table></div></div><p>
					All four JBoss EAP instances have also been configured to start up with either the <code class="literal">standalone-full-ha</code> or <code class="literal">full-ha</code> profile, which adds the <code class="literal">infinispan</code> subsystem and other functionality needed for enabling SSO in this scenario. The <code class="literal">web</code> cache-container and <code class="literal">SSO</code> replicated-cache have also been added, and the <code class="literal">undertow</code> subsystem has been configured to use them both. <code class="literal">EAP1</code> and <code class="literal">EAP2</code> have configured their <code class="literal">undertow</code> subsystems for non-clustered SSO, while the cluster containing <code class="literal">EAP3</code> and <code class="literal">EAP4</code> has been configured to use clustered SSO.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Application Clustering vs. Clustered SSO</h3><p>
						There is a distinct difference between a clustered web application and clustered SSO. A clustered web application is one which is distributed across the nodes of a cluster to spread the load of hosting that application. In clustered applications marked as distributable, all new sessions and changes to existing sessions are replicated to other members of the cluster. Clustered SSO allows for replication of security context and identity information, regardless of whether the applications are themselves clustered. Although these technologies may be used together, they are mutually exclusive and may be used independently.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_10"/>How It Works</h2></div></div></div><p>
					On startup, JBoss EAP loads the core services and starts the <code class="literal">security</code>, <code class="literal">undertow</code>, and <code class="literal">infinispan</code> subsystems that manage <code class="literal">sso-domain</code> and the associated caching for SSO information. <code class="literal">sampleAppA.war</code> and <code class="literal">sampleAppB.war</code> are loaded on all four JBoss EAP instances, each of which look for <code class="literal">sso-domain</code> for providing authentication and authorization.
				</p><p>
					If Jane attempts to access <code class="literal">EAP1/sampleAppA/secure/hello.html</code>, she will be asked to authenticate. After providing the correct information, she will be allowed to see <code class="literal">EAP1/sampleAppA/secure/hello.html</code>. Jane’s session will be added in the SSO caches used by the <code class="literal">undertow</code> and <code class="literal">infinispan</code> subsystems. If she attempts to access <code class="literal">EAP1/sampleAppB/secure/hello.html</code>, she will not be asked to reauthenticate. <code class="literal">sampleAppB</code> running on <code class="literal">EAP1</code> will find her session using the <code class="literal">undertow</code> subsystem caches, along with the <code class="literal">infinispan</code> subsystem, and grant her access because she is already authenticated. If Jane attempts to access either <code class="literal">EAP2/sampleAppA/secure/hello.html</code> or <code class="literal">EAP2/sampleAppB/secure/hello.html</code>, she will be asked to authenticate again because <code class="literal">EAP1</code> and <code class="literal">EAP2</code> do not share a cache.
				</p><p>
					If Jane attempts to access <code class="literal">EAP3/sampleAppA/secure/hello.html</code>, she will be asked to authenticate and her session will be stored in the SSO caches. These caches are stored across the entire cluster, so if Jane attempts to log into <code class="literal">EAP3/sampleAppB/secure/hello.html</code>, <code class="literal">EAP4/sampleAppA/secure/hello.html</code>, or <code class="literal">EAP4/sampleAppB/secure/hello.html</code>, she will not have to reauthenticate. If either <code class="literal">EAP3</code> or <code class="literal">EAP4</code> are restarted, Jane’s SSO information will remain in the cache because the other JBoss EAP instance and the cluster remain running, thus preserving the cache. Similarly, if Jane’s session is invalidated, it ripples across the cache, and she will be asked to reauthenticate regardless of which application or server she tries to access in the cluster.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="multiple_red_hat_jboss_enterprise_application_platform_instances_and_multiple_applications_using_browser_based_sso_with_saml"/>Multiple Red Hat JBoss Enterprise Application Platform Instances and Multiple Applications Using Browser-Based SSO with SAML</h1></div></div></div><p>
				This scenario shows how multiple instances of JBoss EAP are secured and browser-based SSO is added. Three separate, non-clustered JBoss EAP instances are configured: <code class="literal">EAP1</code>, <code class="literal">EAP2</code>, and <code class="literal">EAP3</code>. Three sample applications: <code class="literal">sampleAppA.war</code>, <code class="literal">sampleAppB.war</code>, and <code class="literal">sampleAppC.war</code>, are configured to use browser-based SSO for authentication.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario5.png" width="800" alt="scenario5"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_11"/>Security</h2></div></div></div><p>
					JBoss EAP provides support for doing browser-based SSO via SAML with web applications as well as hosting an identity provider. To host an identity provider, a security domain, in this case named <code class="literal">idp-domain</code>, must be configured with an authentication mechanism defined. In this case, <code class="literal">idp-domain</code> is configured to use the <code class="literal">DatabaseLoginModule</code> as the authentication mechanism. The IDP application, for example <code class="literal">IDP.war</code>, is deployed to that JBoss EAP instance, in this example <code class="literal">EAP-IDP</code>, and configured to use <code class="literal">idp-domain</code> as its identity store. <code class="literal">IDP.war</code> uses the identity store in combination with functionality in the application to authenticate users as well as issue SAML tokens containing the user’s identity and role information. Three additional JBoss EAP instances: <code class="literal">EAP1</code>, <code class="literal">EAP2</code>, and <code class="literal">EAP3</code>, each host one distinct application that will serve as an individual SP, <code class="literal">sampleAppA.war</code>, <code class="literal">sampleAppB.war</code>, and <code class="literal">sampleAppC</code> respectively. Each JBoss EAP instance has a security domain, <code class="literal">sso-domain</code>, configured to use the <code class="literal">SAML2LoginModule</code> as the authentication mechanism. Each application contains functionality to support SSO, use <code class="literal">IDP.war</code> as an identity provider, and use HTTP/POST binding for authentication. Each application is also configured to use <code class="literal">sso-domain</code> to secure the path <code class="literal">/secure/*</code> and supplies its own list of roles for handling authorization.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_11"/>How It Works</h2></div></div></div><p>
					For this scenario, the following users have been added to the database used by the <code class="literal">DatabaseLoginModule</code> in the <code class="literal">idp-domain</code> security domain:
				</p><div class="table"><a id="idm140063288615728"/><p class="title"><strong>Table 5.6. idp-domain Users</strong></p><div class="table-contents"><table summary="idp-domain Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Eric
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Amar
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									AB
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Brian
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									C
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Alan
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></div><p>
					On startup of <code class="literal">EAP-IDP</code>, the management interfaces start, followed by the subsystems and deployed applications, including the <code class="literal">security</code> subsystem, which includes <code class="literal">idp-domain</code>, and <code class="literal">IDP.war</code>. <code class="literal">idp-domain</code> connects to the database and loads the usernames, passwords, and roles as configured in the <code class="literal">DatabaseLoginModule</code> login module. To prevent sensitive information from being stored in plain text in the configuration of the <code class="literal">DatabaseLoginModule</code> login module, password hashing is configured to obscure certain fields, for example, password for the database. <code class="literal">IDP.war</code> uses <code class="literal">idp-domain</code> for authentication and authorization. <code class="literal">IDP.war</code> is also configured, using <code class="literal">jboss-web.xml</code>, <code class="literal">web.xml</code>, <code class="literal">picketlink.xml</code>, and <code class="literal">jboss-deployment-structure.xml</code>, to issue SAML tokens to authenticated users and supplies a simple login form for users to authenticate against. This allows it to serve as an IDP.
				</p><p>
					On startup of <code class="literal">EAP1</code>, <code class="literal">EAP2</code> and <code class="literal">EAP3</code>, the management interfaces start, followed by the subsystems and deployed applications, including the <code class="literal">security</code> subsystem, which includes <code class="literal">sso-domain</code> on each instance, and <code class="literal">sampleAppA.war</code>, <code class="literal">sampleAppB.war</code>, and <code class="literal">sampleAppC.war</code>, respectively. <code class="literal">sso-domain</code> is configured to use the <code class="literal">SAML2LoginModule</code> login module but relies on the application to supply the proper SAML token. This means any application using <code class="literal">sso-domain</code> must properly connect to an IDP to obtain a SAML token. In this case, <code class="literal">sampleAppA</code>, <code class="literal">sampleAppB</code>, and <code class="literal">sampleAppC</code> are each configured, via <code class="literal">jboss-web.xml</code>, <code class="literal">web.xml</code>, <code class="literal">picketlink.xml</code>, and <code class="literal">jboss-deployment-structure.xml</code>, to obtain SAML tokens from an IDP, <code class="literal">IDP.war</code>, using that IDP’s login form.
				</p><p>
					Each application is also configured with its own set of allowed roles:
				</p><div class="table"><a id="idm140063405481264"/><p class="title"><strong>Table 5.7. Application/SP roles</strong></p><div class="table-contents"><table summary="Application/SP roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Application/SP</th><th style="text-align: left" valign="top">Allowed Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									sampleAppA
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all, AB
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									sampleAppB
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all, AB
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									sampleAppC
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									all, C
								</p>
								 </td></tr></tbody></table></div></div><p>
					When an unauthenticated user attempts to access the URLs secured by <code class="literal">sso-domain</code>, that is, <code class="literal">/secure/*</code>, of any application, that user is redirected to the login page at <code class="literal">IDP.war</code>. The user then authenticates using the form and is issued a SAML token containing their identity and role information. The user is redirected to the original URL, and their SAML token is presented to the application, SP. The application ensures the SAML token is valid and then authorizes the user based on the roles provided by the SAML token and the ones configured in the application. Once a user is issued a SAML token, they use that token to be authenticated and authorized on the other applications secured by SSO using the same IDP. Once the SAML token expires or becomes invalidated, the user will be required to obtain a new SAML token from the IDP.
				</p><p>
					In this example, if Eric accesses <code class="literal">EAP1/sampleAppA/secure/hello.html</code>, he is redirected to <code class="literal">EAP-IDP/IDP/login.html</code> to log in. After successfully logging in, he is issued a SAML token containing his user information and the role <code class="literal">all</code> and is redirected to <code class="literal">EAP1/sampleAppA/secure/hello.html</code>. His SAML token is presented to <code class="literal">sampleAppA</code> to be checked and to authorize him based on his roles. Because <code class="literal">sampleAppA</code> allows the roles <code class="literal">all</code> and <code class="literal">AB</code> to access <code class="literal">/secure/*</code> and Eric has the role <code class="literal">all</code>, he is allowed to access <code class="literal">EAP1/sampleAppA/secure/hello.html</code>.
				</p><p>
					If Eric tries to access <code class="literal">EAP2/sampleAppB/secure/hello.html</code>, because he is not already authenticated against that SP, he is redirected to <code class="literal">IDP.war</code> with an authentication request. Because Eric has already authenticated against the IDP, he is redirected to <code class="literal">EAP2/sampleAppB/secure/hello.html</code> by <code class="literal">IDP.war</code> with a new SAML token for that SP without having to reauthenticate. <code class="literal">sampleAppB</code> checks his new SAML token and authorizes him based on his role. Because <code class="literal">sampleAppB</code> allows the roles <code class="literal">all</code> and <code class="literal">AB</code> to access <code class="literal">/secure/*</code> and Eric has the role <code class="literal">all</code>, he is allowed to access <code class="literal">EAP2/sampleAppB/secure/hello.html</code>. The same thing would apply if Eric were to try to access <code class="literal">EAP3/sampleAppC/secure/hello.html</code>.
				</p><p>
					If Eric were to return to <code class="literal">EAP1/sampleAppA/secure/hello.html</code>, or any URL under <code class="literal">EAP2/sampleAppB/secure/*</code> or <code class="literal">EAP3/sampleAppC/secure/*</code>, after his SAML token became invalidated via global logout, he would be redirected to <code class="literal">EAP-IDP/IDP/login.html</code> to authenticate again and be issued a new SAML token.
				</p><p>
					If Amar attempted to access <code class="literal">EAP1/sampleAppA/secure/hello.html</code> or <code class="literal">EAP2/sampleAppB/secure/hello.html</code>, he would be directed through the same flow as Eric. If Amar attempted to access <code class="literal">EAP3/sampleAppC/secure/hello.html</code>, he would still be required to have or obtain a SAML token but would be restricted from viewing <code class="literal">EAP3/sampleAppC/secure/hello.html</code> because his role <code class="literal">AB</code> only allows him to access <code class="literal">EAP1/sampleAppA/secure/*</code> and <code class="literal">EAP2/sampleAppB/secure/*</code>. Brian is in a similar situation, but he is only allowed to access <code class="literal">EAP3/sampleAppC/secure/*</code>. If Alan tries to access any service provider’s secured area, he would still be required to have or obtain a SAML token but would be restricted from seeing anything because he has no role. Each SP also has an unsecured area which any user, authorized or not, can view without obtaining a SAML token.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_ldap_management_realm"/>Using LDAP with the ManagementRealm</h1></div></div></div><p>
				This scenario shows the <code class="literal">ManagementRealm</code> using LDAP for securing the management interfaces. A JBoss EAP instance has been created, <code class="literal">EAP1</code>, and is running as a standalone server. The <code class="literal">ManagementRealm</code> on <code class="literal">EAP1</code> has also been updated to use LDAP as the authentication and authorization mechanism.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario6.png" width="800" alt="scenario6"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_12"/>Security</h2></div></div></div><p>
					JBoss EAP supports using LDAP, as well as Kerberos, for authentication in security realms. This is accomplished by updating the existing <code class="literal">ManagementRealm</code> to use <code class="literal">ldap</code> as the authentication type and creating an outbound connection to the LDAP server. This changes the authentication mechanism from <code class="literal">digest</code> to <code class="literal">BASIC / Plain</code> and will transmit usernames and passwords in the clear over the network by default.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_it_works_12"/>How It Works</h2></div></div></div><p>
					The following users have been added to the LDAP directory:
				</p><div class="table"><a id="idm140063403309376"/><p class="title"><strong>Table 5.8. Management Users</strong></p><div class="table-contents"><table summary="Management Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									Adam
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									SuperUser
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									Sam
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									samplePass
								</p>
								 </td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></div><p>
					On startup, <code class="literal">EAP1</code> loads the core services, including <code class="literal">ManagementRealm</code> and the management interfaces. <code class="literal">ManagementRealm</code> connects to the LDAP directory server and provides the authentication for the management interfaces as needed.
				</p><p>
					If Adam` attempts to access a management interface, he will be forced to authenticate. His credentials will be passed to the <code class="literal">ManagementRealm</code> security realm, which will use the LDAP directory server for authentication. Since <code class="literal">EAP1</code> is using the default simple access controls, after authentication, Adam’s roles will not be checked and he will be granted access. The same process will occur if Sam attempts to access the management interface.
				</p><p>
					If RBAC was enabled after Adam is authenticated, his roles would be passed back to the management interface for authorization. Because Adam has the <code class="literal">SuperUser</code> role, he would be granted access to the management interface. If Sam attempted to access a management interface with RBAC enabled, he would be authenticated via LDAP but would be denied access because he does not have a proper role.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using_desktop_sso_using_kerberos_to_provide_sso_for_web_applications"/>Using Desktop SSO, using Kerberos, to Provide SSO for Web Applications</h1></div></div></div><p>
				This scenario shows how Kerberos can be used with JBoss EAP to provide SSO for web applications. A JBoss EAP instance has been created, <code class="literal">EAP1</code>, and is running as a standalone server. Two web applications, <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code>, have been deployed to <code class="literal">EAP1</code>. Both the web applications and <code class="literal">EAP1</code> have been configured to authenticate using desktop-based SSO via Kerberos.
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/topics/images/scenario7.png" width="800" alt="scenario7"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security_13"/>Security</h2></div></div></div><p>
					JBoss EAP offers support for using Kerberos for SSO in web applications via SPNEGO and JBoss Negotiation. For more information on the specifics of Kerberos and SPNEGO, see the <a class="link" href="overview_of_general_security_concepts.html#third_party_sso" title="Third-Party SSO Implementations">Third-Party SSO Implementations</a> section. To enable JBoss EAP and deployed web applications to use Kerberos for authentication, two security domains must be created. The first security domain, <code class="literal">host-domain</code>, is configured with the <code class="literal">kerberos</code> login module to connect to the Kerberos server. This allows JBoss EAP to authenticate at the container level. A second security domain, <code class="literal">spnego-domain</code>, is created with two login modules. One uses the <code class="literal">spnego</code> login module to connect to <code class="literal">host-domain</code> to authenticate users. The second can use any other login module to load role information for use in authorization decisions, for example, <code class="literal">UsersRoles</code> using properties files to map users to roles.
				</p><p>
					These two login modules also make use of <code class="literal">password-stacking</code> to map the users and roles in the authorization module with the users in the authentication login module. <code class="literal">EAP1</code> is configured with both <code class="literal">host-domain</code> and <code class="literal">spnego-domain</code>. Applications are configured, via <code class="literal">web.xml</code> and <code class="literal">jboss-web.xml</code>, to use <code class="literal">spnego-domain</code> to perform authentication and get a user’s roles for authorization. Applications can also be configured with FORM authentication as a fallback authentication mechanism in case the security tokens cannot be passed from the operating system to the browser. If FORM authentication is configured as a fallback, an additional security domain must be configured to support it. This security domain is independent of Kerberos and SPNEGO and only has to support FORM authentication, that is, username and password validation and roles. Each application is configured to use <code class="literal">spnego-domain</code> and to provide FORM authentication as a fallback. Each application is also configured to secure the path <code class="literal">/secure/*</code> and supplies its own list of roles for handling authorization.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how_it_works_13"/>How It Works</h3></div></div></div><p>
						The following users have been created in the Kerberos server:
					</p><div class="table"><a id="idm140063288063536"/><p class="title"><strong>Table 5.9. Kerberos Users</strong></p><div class="table-contents"><table summary="Kerberos Users" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Password</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										Brent
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										samplePass
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Andy
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										samplePass
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Bill
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										samplePass
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Ron
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										samplePass
									</p>
									 </td></tr></tbody></table></div></div><p>
						The following roles have mapped to the users via an additional module that is chained by setting the <code class="literal">password-stacking</code> option to <code class="literal">useFirstPass</code>:
					</p><div class="table"><a id="idm140063393377616"/><p class="title"><strong>Table 5.10. User Roles</strong></p><div class="table-contents"><table summary="User Roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Username</th><th style="text-align: left" valign="top">Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										Brent
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										all
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Andy
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										A
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Bill
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										B
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										Ron
									</p>
									 </td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></div><p>
						The following roles have also been configured in each application:
					</p><div class="table"><a id="idm140063380435200"/><p class="title"><strong>Table 5.11. Application Roles</strong></p><div class="table-contents"><table summary="Application Roles" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Application/SP</th><th style="text-align: left" valign="top">Allowed Roles</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										sampleAppA
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										all, A
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										sampleAppB
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										all, B
									</p>
									 </td></tr></tbody></table></div></div><p>
						On startup, <code class="literal">EAP1</code> loads the core services, followed by the <code class="literal">security</code> and other subsystems. <code class="literal">host-domain</code> establishes a connection to the Kerberos server, and <code class="literal">spnego-domain</code> connects to <code class="literal">host-domain</code>. <code class="literal">sampleAppA</code> and <code class="literal">sampleAppB</code> are deployed and connect to <code class="literal">spnego-domain</code> for authentication.
					</p><p>
						Brent has logged in to a computer that is secured with Kerberos. He opens a browser and attempts to access <code class="literal">sampleAppA/secure/hello.html</code>. Because that is secured, authentication is required. <code class="literal">EAP1</code> directs the browser to send a request for a key to the Kerberos server, specifically the Kerberos Key Distribution Center that is configured on his computer. After the browser obtains a key, it is sent to <code class="literal">simpleAppA</code>. <code class="literal">simpleAppA</code> sends the ticket to <code class="literal">spnego-domain</code>, where it is unpacked and authentication is performed by <code class="literal">host-domain</code>, in conjunction with the configured Kerberos server. Once the ticket is authenticated, Brent’s role is passed back to <code class="literal">simpleAppA</code> to perform authorization. Because Brent has the <code class="literal">all</code> role, he will be able to access <code class="literal">sampleAppA/secure/hello.html</code>. If Brent tries to access <code class="literal">sampleAppB/secure/hello.html</code>, the same process will occur. He will be granted access, due to him having the <code class="literal">all</code> role. Andy and Bill would follow the same process, but with Andy only having access to <code class="literal">sampleAppA/secure/hello.html</code> and not <code class="literal">sampleAppB/secure/hello.html</code>. Bill would be the opposite, having access to <code class="literal">sampleAppB/secure/hello.html</code> and not <code class="literal">sampleAppA/secure/hello.html</code>. Ron would pass authentication to either <code class="literal">sampleAppA/secure/hello.html</code> or <code class="literal">sampleAppB/secure/hello.html</code> but would not be granted access to either because he has no role.
					</p><p>
						If Andy were to attempt to access <code class="literal">sampleAppA/secure/hello.html</code> from a computer not secured by Kerberos, for example a personal laptop connected to the office network, he would be directed to the FORM login page as a fallback login mechanism. His credentials would then be authenticated via the fallback security domain and the process would continue with authorization.
					</p><p>
						<br/><br/><br/><br/>
					</p><p>
						<span class="emphasis"><em><span class="right">Revised on 2019-05-02 08:54:42 UTC</span></em></span>
					</p></div></div></div></div></body></html>