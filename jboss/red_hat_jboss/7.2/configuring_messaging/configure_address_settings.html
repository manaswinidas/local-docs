<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. Address Settings</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configure_address_settings"/>Chapter 6. Address Settings</h1></div></div></div><p>
				The <code class="literal">messaging-activemq</code> subsystem has several configurable options which control aspects of how and when a message is delivered, how many attempts should be made, and when the message expires. These configuration options all exist within the <code class="literal">&lt;address-setting&gt;</code> configuration element. You can configure JBoss EAP to apply a single <code class="literal">&lt;address-setting&gt;</code> to multiple destinations by using a wildcard syntax.
			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="wildcard_syntax"/>Wildcard Syntax</h1></div></div></div><p>
					Wildcards can be used to match similar addresses with a single statement, much like how many systems use the asterisk character, <code class="literal">*</code>, to match multiple files or strings with a single query. The following table lists the special characters that can be used to define an <code class="literal">&lt;address-setting&gt;</code>.
				</p><div class="table"><a id="idm139716566212208"/><p class="title"><strong>Table 6.1. JMS Wildcard Syntax</strong></p><div class="table-contents"><table summary="JMS Wildcard Syntax" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Character</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									. (a single period)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Denotes the space between words in a wildcard expression.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									# (a pound or hash symbol)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Matches any sequence of zero or more words.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									* (an asterisk)
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Matches a single word.
								</p>
								 </td></tr></tbody></table></div></div><p>
					The examples in the table below illustrate how wildcards are used to match a set of addresses.
				</p><div class="table"><a id="idm139716566192752"/><p class="title"><strong>Table 6.2. JMS Wildcard Examples</strong></p><div class="table-contents"><table summary="JMS Wildcard Examples" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Example</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									news.europe.#
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Matches <code class="literal">news.europe</code>, <code class="literal">news.europe.sport</code>, <code class="literal">news.europe.politics.fr</code>, but not <code class="literal">news.usa</code> or <code class="literal">europe</code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									news.*
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Matches <code class="literal">news.europe</code> and <code class="literal">news.usa</code>, but not <code class="literal">news.europe.sport</code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									news.*.sport
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Matches <code class="literal">news.europe.sport</code> and <code class="literal">news.usa.sport</code>, but not <code class="literal">news.europe.fr.sport</code>.
								</p>
								 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="default_address_setting"/>Default address-setting</h1></div></div></div><p>
					Out of the box, JBoss EAP includes a single <code class="literal">address-setting</code> element as part of the configuration for the <code class="literal">messaging-activemq</code> subsystem:
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:4.0"&gt;
  &lt;server name="default"&gt;
      ...
      &lt;address-setting
        name="#"
        dead-letter-address="jms.queue.DLQ"
        expiry-address="jms.queue.ExpiryQueue"
        max-size-bytes="10485760"
        page-size-bytes="2097152"
        message-counter-history-day-limit="10" /&gt;
      ...
  &lt;/server&gt;
&lt;/subsystem&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The use of a single <code class="literal">#</code> for the <code class="literal">name</code> attribute makes this default <code class="literal">address-setting</code> the configuration to be used for all destinations since <code class="literal">#</code> matches any address. You can continue to apply this catch-all configuration to all of your addresses, or you can add a new <code class="literal">address-setting</code> for each address or group of addresses that requires its own configuration set.
					</p></div><h2><a id="configuring_address_settings_using_the_management_cli"/>Configuring Address Settings Using the Management CLI</h2><p>
					Configuring address settings is done by using either the management CLI or the management console, but the management CLI exposes more of the configuration attributes for editing. See <a class="link" href="reference_material.html#address_setting_attributes" title="Address Setting Attributes"> Address Setting Attributes</a> in the appendix of this guide for the full list of attributes.
				</p><h3><a id="add_a_new_address_setting"/>Add a new address-setting</h3><p>
					Use the <code class="literal">add</code> operation to create a new address setting if required. You can run this command from the root of the management CLI session, which in the following examples creates a new pattern named . You can include configuration attributes for the <code class="literal">address-setting</code>. Below, a new <code class="literal">address-setting</code> matching <code class="literal">news.europe.#</code> is created with its <code class="literal">dead-letter-address</code> attribute set to the queue <code class="literal">DLQ.news</code>, which was created beforehand. Examples for both a standalone server and a managed server domain using the <code class="literal">full</code> profile are shown respectively.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/address-setting=news.europe.#/:add(dead-letter-address=DLQ.news)</pre><pre class="screen">/profile=full/subsystem=messaging-activemq/server=default/address-setting=news.europe.#/:add(dead-letter-address=DLQ.news)</pre><h3><a id="edit_an_address_setting_attribute"/>Edit an address-setting attribute</h3><p>
					Use the <code class="literal">write-attribute</code> operation to write a new value to an attribute. You can use tab completion to help complete the command string as you type, as well as to expose the available attributes. The following example updates the <code class="literal">max-delivery-attempts</code> value to <code class="literal">10</code>.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/address-setting=news.europe.#/:write-attribute(name=max-delivery-attempts,value=10)</pre><pre class="screen">/profile=full/subsystem=messaging-activemq/server=default/address-setting=news.europe.#/:write-attribute(name=max-delivery-attempts,value=10)</pre><h3><a id="read_address_setting_attributes"/>Read address-setting Attributes</h3><p>
					Confirm the values are changed by running the <code class="literal">read-resource</code> operation with the <code class="literal">include-runtime=true</code> parameter to expose all current values active in the server model.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/address-setting=news.europe.#/:read-resource(include-runtime=true)</pre><pre class="screen">/profile=full/subsystem=messaging-activemq/server=default/address-setting=news.europe.#/:read-resource(include-runtime=true)</pre><h2><a id="configuring_address_settings_using_the_management_console"/>Configuring Address Settings Using the Management Console</h2><p>
					You can use the management console to create and review address settings by following these steps:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Log in to the management console.
						</li><li class="listitem">
							Select the <span class="strong"><strong>Configuration</strong></span> tab at the top of the screen. When running a managed domain, select the profile to update.
						</li><li class="listitem">
							Select <span class="strong"><strong>Messaging (ActiveMQ)</strong></span> → <span class="strong"><strong>Server</strong></span>.
						</li><li class="listitem">
							Select a messaging server. In the default configuration, only one server, called <code class="literal">default</code>, is shown.
						</li><li class="listitem">
							Select <span class="strong"><strong>Destinations</strong></span> and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select the <span class="strong"><strong>Address Setting</strong></span> tab to configure address settings.
						</li></ol></div><p>
					Remember that when adding a new pattern, for example <code class="literal">news.europe.#</code>, the <span class="strong"><strong>Pattern</strong></span> field refers to the <code class="literal">name</code> attribute of the <code class="literal">address-setting</code> element. You enter this value when using the management CLI to read or write attributes.
				</p><p>
					You can edit only the <code class="literal">dead-letter-address</code>, <code class="literal">expiry-address</code>, <code class="literal">redelivery-delay</code>, and <code class="literal">max-delivery-attempts</code> attributes while using the management console. Other attributes must be configured using the management CLI.
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="last_value_queues"/>Last-value Queues</h1></div></div></div><p>
					Last-value queues are special queues which discard any messages when a newer message with the same value for a well-defined last-value property is put in the queue. In other words, a last-value queue only retains the last value. A typical application of a last-value queue might involve stock prices, where you are interested only in the latest price of a particular stock.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Last-value queues will not work as expected if the queue has paging enabled. Be sure to <a class="link" href="configuring_paging.html#paging_mode" title="Configuring Paging Mode">disable paging</a> before using a last-value queue.
					</p></div><h3><a id="configuring_last_value_queues"/>Configuring Last-value Queues</h3><p>
					Last-value queues are defined within the <code class="literal">address-setting</code> configuration element:
				</p><pre class="programlisting">&lt;address-setting name="jms.queue.lastValueQueue" last-value-queue="true" /&gt;</pre><p>
					Use the management CLI to read the value of <code class="literal">last-value-queue</code> for a given <code class="literal">address-setting</code>:
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/address-setting=news.europe.#:read-attribute(name=last-value-queue)
{
    "outcome" =&gt; "success",
    "result" =&gt; false
}</pre><p>
					The accepted values for <code class="literal">last-value-queue</code> are <code class="literal">true</code> or <code class="literal">false</code>. Use the management CLI to set either value, like so:
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/address-setting=news.europe.#:write-attribute(name=last-value-queue,value=true)

/subsystem=messaging-activemq/server=default/address-setting=news.asia.#:write-attribute(name=last-value-queue,value=false)</pre><h3><a id="using_the_last_value_property"/>Using the Last-value Property</h3><p>
					The property name used to identify the last value is <code class="literal">_AMQ_LVQ_NAME</code> (or the constant <code class="literal">Message.HDR_LAST_VALUE_NAME</code> from the Core API). Let the following Java code illustrate how to use the last-value property.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							First, the publisher sends a message to the last-value queue
						</li></ul></div><pre class="screen">TextMessage message = session.createTextMessage("My 1st message with the last-value property set");
message.setStringProperty("_AMQ_LVQ_NAME", "MY_MESSAGE");
producer.send(message);</pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Then it sends another message to the queue using the same last-value
						</li></ul></div><pre class="screen">message = session.createTextMessage("My 2nd message with the last-value property set");
message.setStringProperty("_AMQ_LVQ_NAME", "MY_MESSAGE");
producer.send(message);</pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Next, the consumer receives the message with the last-value
						</li></ul></div><pre class="screen">TextMessage messageReceived = (TextMessage)messageConsumer.receive(5000);
System.out.format("Received message: %s\n", messageReceived.getText());</pre><p>
					In the above example the client’s output would be <code class="literal">"My 2nd message with the last-value property set"</code> since both messages set <code class="literal">_AMQ_LVQ_NAME</code> to <code class="literal">"MY_MESSAGE"</code>, and the second message was received in the queue after the first.
				</p></div></div></body></html>