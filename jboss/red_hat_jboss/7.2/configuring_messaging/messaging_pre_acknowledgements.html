<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 20. Configuring Pre-Acknowledgments</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="messaging_pre_acknowledgements"/>Chapter 20. Configuring Pre-Acknowledgments</h1></div></div></div><p>
				JMS specifies three acknowledgement modes:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						AUTO_ACKNOWLEDGE
					</li><li class="listitem">
						CLIENT_ACKNOWLEDGE
					</li><li class="listitem">
						DUPS_OK_ACKNOWLEDGE
					</li></ul></div><p>
				In some cases you can afford to lose messages in the event of a failure, so it would make sense to acknowledge the message on the server before delivering it to the client. This extra mode is supported by JBoss EAP messaging and is called pre-acknowledge mode.
			</p><p>
				The disadvantage of pre-acknowledging on the server before delivery is that the message will be lost if the server’s system crashes after acknowledging the message but before it is delivered to the client. In that case, the message is lost and will not be recovered when the system restarts.
			</p><p>
				Depending on your messaging case, pre-acknowledge mode can avoid extra network traffic and CPU usage at the cost of coping with message loss.
			</p><p>
				An example use case for pre-acknowledgement is for stock price update messages. With these messages, it might be reasonable to lose a message in event of a crash since the next price update message will arrive soon, overriding the previous price.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					If you use pre-acknowledge mode, you will lose transactional semantics for messages being consumed since they are being acknowledged first on the server, not when you commit the transaction.
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_the_server"/>Configuring the Server</h1></div></div></div><p>
					A connection factory can be configured to use pre-acknowledge mode by setting its <code class="literal">pre-acknowledge</code> attribute to <code class="literal">true</code> using the management CLI as below:
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/connection-factory=RemoteConnectionFactory:write-attribute(name=pre-acknowledge,value=true)</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_the_client"/>Configuring the Client</h1></div></div></div><p>
					Pre-acknowledge mode can be configured in the client’s JNDI context environment, for example, in the <code class="literal">jndi.properties</code> file:
				</p><pre class="screen">java.naming.factory.initial=org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory
connection.ConnectionFactory=tcp://localhost:8080?preAcknowledge=true</pre><p>
					Alternatively, to use pre-acknowledge mode using the JMS API, create a JMS Session with the <code class="literal">ActiveMQSession.PRE_ACKNOWLEDGE</code> constant.
				</p><pre class="programlisting">// messages will be acknowledge on the server *before* being delivered to the client
Session session = connection.createSession(false, ActiveMQJMSConstants.PRE_ACKNOWLEDGE);</pre></div></div></body></html>