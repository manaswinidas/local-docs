<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 27. Configuring JMS Bridges</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_jms_bridges"/>Chapter 27. Configuring JMS Bridges</h1></div></div></div><p>
				JBoss EAP messaging includes a fully functional JMS message bridge. The function of a JMS bridge is to consume messages from a source queue or topic and send them to a target queue or topic, typically on a different server.
			</p><p>
				If the source destination is a topic, the JMS bridge creates a subscription for it. If the <code class="literal">client-id</code> and <code class="literal">subscription-name</code> attributes are configured for the JMS bridge, the subscription is durable. This means that no messages are missed if the JMS bridge is stopped and then restarted.
			</p><p>
				The source and target servers do not have to be in the same cluster, which makes bridging suitable for reliably sending messages from one cluster to another, for instance across a WAN, and where the connection may be unreliable.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Do not confuse a JMS bridge with a core bridge. A JMS bridge can be used to bridge any two JMS 1.1 compliant JMS providers and uses the JMS API. A <a class="link" href="configuring_core_bridges.html" title="Chapter 28. Configuring Core Bridges">core bridge</a> is used to bridge any two JBoss EAP messaging instances and uses the core API. It is preferable to use a core bridge instead of a JMS bridge whenever possible.
				</p></div><p>
				Below is an example configuration of a JBoss EAP JMS bridge.
			</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:messaging-activemq:4.0"&gt;
  &lt;server name="default"&gt;
  ...
  &lt;/server&gt;
  &lt;jms-bridge name="my-jms-bridge" module="org.apache.activemq.artemis" max-batch-time="100" max-batch-size="10" max-retries="1" failure-retry-interval="500" quality-of-service="AT_MOST_ONCE"&gt;
    &lt;source destination="jms/queue/InQueue" connection-factory="ConnectionFactory"&gt;
      &lt;source-context/&gt;
    &lt;/source&gt;
    &lt;target destination="jms/queue/OutQueue" connection-factory="jms/RemoteConnectionFactory"&gt;
      &lt;target-context&gt;
        &lt;property name="java.naming.factory.initial" value="org.wildfly.naming.client.WildFlyInitialContextFactory"/&gt;
        &lt;property name="java.naming.provider.url" value="http-remoting://192.168.40.1:8080"/&gt;
      &lt;/target-context&gt;
    &lt;/target&gt;
  &lt;/jms-bridge&gt;
  ...
&lt;/subsystem&gt;</pre><div class="title"><strong>Adding a JMS Bridge Using the Management CLI</strong></div><p>
					A JMS bridge can be added using the following management CLI command. Note that the source and target destinations must already be defined in the configuration. See the <a class="link" href="reference_material.html#jms_bridge_attributes" title="JMS Bridge Attributes">table in the appendix</a> for a full list of configurable attributes.
				</p><pre class="screen">/subsystem=messaging-activemq/jms-bridge=my-jms-bridge:add(quality-of-service=AT_MOST_ONCE,module=org.apache.activemq.artemis,failure-retry-interval=500,max-retries=1,max-batch-size=10,max-batch-time=100,source-connection-factory=ConnectionFactory,source-destination=jms/queue/InQueue,source-context={},target-connection-factory=jms/RemoteConnectionFactory,target-destination=jms/queue/OutQueue,target-context={java.naming.factory.initial=org.wildfly.naming.client.WildFlyInitialContextFactory,java.naming.provider.url=http-remoting://192.168.40.1:8080})</pre><p>
				You can review the configuration of a JMS bridge using the <code class="literal">read-resource</code> command in the management CLI as in the following example.
			</p><pre class="screen">/subsystem=messaging-activemq/jms-bridge=my-jms-bridge:read-resource</pre><p>
				Add configuration to a JMS bridge by using the <code class="literal">write-attribute</code>, as done in this example:
			</p><pre class="screen">/subsystem=messaging-activemq/jms-bridge=my-jms-bridge:write-attribute(name=<span class="emphasis"><em>ATTRIBUTE</em></span>,value=<span class="emphasis"><em>VALUE</em></span>)</pre><div class="title"><strong>Adding a JMS Bridge Using the Management Console</strong></div><p>
					You can also use the management console to add a JMS bridge by following these steps.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						Open the management console in a browser and navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Messaging (ActiveMQ)</strong></span> → <span class="strong"><strong>JMS Bridge</strong></span>.
					</li><li class="listitem">
						Click the Add (<span class="strong"><strong>+</strong></span>) button and provide the required information when prompted.
					</li><li class="listitem">
						Click <span class="strong"><strong>Add</strong></span> when finished.
					</li></ol></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="quality_of_service"/>Quality of Service</h1></div></div></div><p>
					In JBoss EAP, <code class="literal">quality-of-service</code> is a configurable attribute that determines how messages are consumed and acknowledged. The valid values for <code class="literal">quality-of-service</code> and their descriptions are below. See the <a class="link" href="reference_material.html#jms_bridge_attributes" title="JMS Bridge Attributes">table in the appendix</a> for a full list of JMS bridge attributes.
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">AT_MOST_ONCE</span></dt><dd><p class="simpara">
								Messages will reach the destination from the source at the most one time. The messages are consumed from the source and acknowledged before sending to the destination. Therefore, there is a possibility that messages could be lost if a failure occurs between their removal from the source and their arrival at the destination. This mode is the default value.
							</p><p class="simpara">
								This mode is available for both durable and non-durable messages.
							</p></dd><dt><span class="term">DUPLICATES_OK</span></dt><dd><p class="simpara">
								Messages are consumed from the source and then acknowledged after they have been successfully sent to the destination. Therefore, there is a possibility that messages could be sent again if a failure occurs after the initial message was sent but before it is acknowledged.
							</p><p class="simpara">
								This mode is available for both durable and non-durable messages.
							</p></dd><dt><span class="term">ONCE_AND_ONLY_ONCE</span></dt><dd><p class="simpara">
								Messages will reach the destination from the source once and only once. If both the source and the destination are on the same server instance, this can be achieved by sending and acknowledging the messages in the same local transaction. If the source and destination are on different servers, this is achieved by enlisting the sending and consuming sessions in a JTA transaction. The JTA transaction is controlled by a JTA Transaction Manager which will need to be set using the <code class="literal">setTransactionManager()</code> method on the bridge.
							</p><p class="simpara">
								This mode is only available for durable messages.
							</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
									When shutting down a server that has a deployed JMS bridge with the <code class="literal">quality-of-service</code> attribute set to <code class="literal">ONCE_AND_ONLY_ONCE</code>, be sure to shut the server down with the JMS bridge first to avoid unexpected errors.
								</p></div></dd></dl></div><p>
					It may possible to provide once and only once semantics by using the <code class="literal">DUPLICATES_OK</code> mode instead of <code class="literal">ONCE_AND_ONLY_ONCE</code> and then checking for duplicates at the destination and discarding them. See <a class="link" href="about_duplicate_message_detection.html" title="Chapter 25. Configuring Duplicate Message Detection">Configuring Duplicate Message Detection</a> for more information. However, the cache would only be valid for a certain period of time. This approach therefore is not as watertight as using <code class="literal">ONCE_AND_ONLY_ONCE</code>, but it may be a good choice depending on your specific application needs.
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="timeouts_and_the_jms_bridge"/>Timeouts and the JMS Bridge</h1></div></div></div><p>
					There is a possibility that the target or source server will not be available at some point in time. If this occurs, the bridge will try to reconnect a number of times equal to the value of <code class="literal">max-retries</code>. The wait between attempts is set by <code class="literal">failure-retry-interval</code>.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Because each JMS bridge has its own <code class="literal">max-retries</code> parameter, you should use a connection factory that does not set the <code class="literal">reconnect-attempts</code> parameter, or sets it to <code class="literal">0</code>. This will avoid a potential collision that may result in longer reconnection times. Also note that any connection factory referenced by a JMS bridge with the <code class="literal">quality-of-service</code> set to <code class="literal">ONCE_AND_ONLY_ONCE</code> needs to have the <code class="literal">factory-type</code> set to <code class="literal">XA_GENERIC</code>, <code class="literal">XA_TOPIC</code>, or <code class="literal">XA_QUEUE</code>.
					</p></div></div></div></body></html>