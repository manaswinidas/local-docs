<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 33. Monitoring Messaging Statistics</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="messaging_statistics"/>Chapter 33. Monitoring Messaging Statistics</h1></div></div></div><p>
				When statistics collection is <a class="link" href="messaging_statistics.html#enable_messaging_statistics" title="Enabling Messaging Statistics">enabled</a> for a messaging server in the <code class="literal">messaging-activemq</code> subsystem, you can <a class="link" href="messaging_statistics.html#viewing_messaging_stats" title="Viewing Messaging Statistics">view runtime statistics</a> for resources on the messaging server.
			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enable_messaging_statistics"/>Enabling Messaging Statistics</h1></div></div></div><p>
					Because it can negatively impact performance, statistics collection for the <code class="literal">messaging-activemq</code> subsystem is <span class="emphasis"><em>not</em></span> enabled by default. You do not need to enable queue statistics to obtain basic information, such as as number of messages on a queue or the number of messages added to a queue. Those statistics are available using queue attributes without requiring that you set <code class="literal">statistics-enabled</code> to <code class="literal">true</code>.
				</p><p>
					You can enable additional statistics collection using the <a class="link" href="messaging_statistics.html#enable_messaging_statistics_cli" title="Enable Messaging Statistics Using the Management CLI">management CLI</a> or the <a class="link" href="messaging_statistics.html#enable_messaging_statistics_console" title="Enable Messaging Statistics Using the Management Console">management console</a>.
				</p><h3><a id="enable_messaging_statistics_cli"/>Enable Messaging Statistics Using the Management CLI</h3><p>
					The following management CLI command enables the collection of statistics for the <code class="literal">default</code> messaging server.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default:write-attribute(name=statistics-enabled,value=true)</pre><p>
					Pooled connection factory statistics are enabled separately from the other messaging server statistics. Use the following command to enable statistics for a pooled connection factory.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/pooled-connection-factory=activemq-ra:write-attribute(name=statistics-enabled,value=true)</pre><p>
					Reload the server for the changes to take effect.
				</p><h3><a id="enable_messaging_statistics_console"/>Enable Messaging Statistics Using the Management Console</h3><p>
					Use the following steps to enable statistics collection for a messaging server using the management console.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Messaging (ActiveMQ)</strong></span> → <span class="strong"><strong>Server</strong></span>.
						</li><li class="listitem">
							Select the server and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Click <span class="strong"><strong>Edit</strong></span> under the <span class="strong"><strong>Statistics</strong></span> tab.
						</li><li class="listitem">
							Set the <span class="strong"><strong>Statistics Enabled</strong></span> field to <span class="strong"><strong>ON</strong></span> and click <span class="strong"><strong>Save</strong></span>.
						</li></ol></div><p>
					Pooled connection factory statistics are enabled separately from the other messaging server statistics. Use the following steps to enable statistics collection for a pooled connection factory.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Messaging (ActiveMQ)</strong></span> → <span class="strong"><strong>Server</strong></span>.
						</li><li class="listitem">
							Select the server, select <span class="strong"><strong>Connections</strong></span>, and click <span class="strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select the <span class="strong"><strong>Pooled Connection Factory</strong></span> tab.
						</li><li class="listitem">
							Select the pooled connection factory and click <span class="strong"><strong>Edit</strong></span> under the <span class="strong"><strong>Attributes</strong></span> tab.
						</li><li class="listitem">
							Set the <span class="strong"><strong>Statistics Enabled</strong></span> field to <span class="strong"><strong>ON</strong></span> and click <span class="strong"><strong>Save</strong></span>.
						</li><li class="listitem">
							Reload the server for the changes to take effect.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="viewing_messaging_stats"/>Viewing Messaging Statistics</h1></div></div></div><p>
					You can view runtime statistics for a messaging server using the <a class="link" href="messaging_statistics.html#view_messaging_stats_cli" title="View Messaging Statistics Using the Management CLI">management CLI</a> or <a class="link" href="messaging_statistics.html#view_messaging_stats_console" title="View Messaging Statistics Using the Management Console">management console</a>.
				</p><h3><a id="view_messaging_stats_cli"/>View Messaging Statistics Using the Management CLI</h3><p>
					You can view messaging statistics using the following management CLI commands. Be sure to include the <code class="literal">include-runtime=true</code> argument as statistics are runtime information.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							View statistics for a queue.
						</p><pre class="screen">/subsystem=messaging-activemq/server=default/jms-queue=DLQ:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "consumer-count" =&gt; 0,
        "dead-letter-address" =&gt; "jms.queue.DLQ",
        "delivering-count" =&gt; 0,
        "durable" =&gt; true,
        ...
    }
}</pre></li><li class="listitem"><p class="simpara">
							View statistics for a topic.
						</p><pre class="screen">/subsystem=messaging-activemq/server=default/jms-topic=testTopic:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "delivering-count" =&gt; 0,
        "durable-message-count" =&gt; 0,
        "durable-subscription-count" =&gt; 0,
        ...
    }
}</pre></li><li class="listitem"><p class="simpara">
							View statistics for a pooled connection factory.
						</p><pre class="screen">/subsystem=messaging-activemq/server=default/pooled-connection-factory=activemq-ra/statistics=pool:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "ActiveCount" =&gt; 1,
        "AvailableCount" =&gt; 20,
        "AverageBlockingTime" =&gt; 0L,
        "AverageCreationTime" =&gt; 13L,
        "AverageGetTime" =&gt; 14L,
        ...
    }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Pooled connection factory statistics are enabled separately from the other messaging server statistics. See <a class="link" href="messaging_statistics.html#enable_messaging_statistics" title="Enabling Messaging Statistics">Enabling Messaging Statistics</a> for instructions.
							</p></div></li></ul></div><h3><a id="view_messaging_stats_console"/>View Messaging Statistics Using the Management Console</h3><p>
					To view messaging statistics from the management console, navigate to the <span class="strong"><strong>Messaging (ActiveMQ)</strong></span> subsystem from the <span class="strong"><strong>Runtime</strong></span> tab, and select the server. Select a destination to view its statistics.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The <span class="strong"><strong>Prepared Transactions</strong></span> page is where you can view, commit, and roll back prepared transactions. See <a class="link" href="configuring_persistence.html#managing_journal_prepared_transactions" title="Managing Messaging Journal Prepared Transactions">Managing Messaging Journal Prepared Transactions</a> for more information.
					</p></div><p>
					See <a class="link" href="reference_material.html#messaging_statistics_reference" title="Messaging Statistics">Messaging Statistics</a> for a detailed list of all available statistics.
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_messaging_counters"/>Configuring Message Counters</h1></div></div></div><p>
					You can configure the following message counter attributes for a messaging server.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">message-counter-max-day-history</code>: The number of days the message counter history is kept.
						</li><li class="listitem">
							<code class="literal">message-counter-sample-period</code>: How often, in milliseconds, the queue is sampled.
						</li></ul></div><p>
					The management CLI command to configure these options uses the following syntax. Be sure to replace <code class="literal"><span class="emphasis"><em>STATISTICS_NAME</em></span></code> and <code class="literal"><span class="emphasis"><em>STATISTICS_VALUE</em></span></code> with the statistic name and value you want to configure.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default::write-attribute(name=<span class="emphasis"><em>STATISTICS_NAME</em></span>,value=<span class="emphasis"><em>STATISTICS_VALUE</em></span>)</pre><p>
					For example, use the following commands to set the <code class="literal">message-counter-max-day-history</code> to five days and the <code class="literal">message-counter-sample-period</code> to two seconds.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default:write-attribute(name=message-counter-max-day-history,value=5)
/subsystem=messaging-activemq/server=default:write-attribute(name=message-counter-sample-period,value=2000)</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="view_message_count_for_queue"/>Viewing the Message Counter and History for a Queue</h1></div></div></div><p>
					You can view the message counter and message counter history for a queue using the following management CLI operations.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">list-message-counter-as-json</code>
						</li><li class="listitem">
							<code class="literal">list-message-counter-as-html</code>
						</li><li class="listitem">
							<code class="literal">list-message-counter-history-as-json</code>
						</li><li class="listitem">
							<code class="literal">list-message-counter-history-as-html</code>
						</li></ul></div><p>
					The management CLI command to use display these values uses the following syntax. Be sure to replace <code class="literal"><span class="emphasis"><em>QUEUE_NAME</em></span></code> and <code class="literal"><span class="emphasis"><em>OPERATION_NAME</em></span></code> with the queue name and operation you want to use.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/jms-queue=<span class="emphasis"><em>QUEUE_NAME</em></span>:<span class="emphasis"><em>OPERATION_NAME</em></span></pre><p>
					For example, use the following command to view the message counter for the <code class="literal">TestQueue</code> queue in JSON format.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/jms-queue=TestQueue:list-message-counter-as-json
{
    "outcome" =&gt; "success",
    "result" =&gt; "{\"destinationName\":\"TestQueue\",\"destinationSubscription\":null,\"destinationDurable\":true,\"count\":0,\"countDelta\":0,\"messageCount\":0,\"messageCountDelta\":0,\"lastAddTimestamp\":\"12/31/69 7:00:00 PM\",\"updateTimestamp\":\"2/20/18 2:24:05 PM\"}"
}</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="reset_message_count_for_queue"/>Reset the Message Counter for a Queue</h1></div></div></div><p>
					You can reset the message counter for a queue using the <code class="literal">reset-message-counter</code> management CLI operation.
				</p><pre class="screen">/subsystem=messaging-activemq/server=default/jms-queue=TestQueue:reset-message-counter
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</pre></div></div></body></html>