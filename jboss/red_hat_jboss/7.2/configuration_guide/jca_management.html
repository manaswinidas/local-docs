<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 16. Java Connector Architecture (JCA) Management</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="jca_management"/>Chapter 16. Java Connector Architecture (JCA) Management</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="java_connector_arch"/>About the Java Connector Architecture (JCA)</h1></div></div></div><p>
				The Java EE Connector Architecture (JCA) defines a standard architecture for Java EE systems to external heterogeneous Enterprise Information Systems (EIS). Examples of EISs include Enterprise Resource Planning (ERP) systems, mainframe transaction processing (TP), databases, and messaging systems. A <a class="link" href="jca_management.html#resource_adapters" title="About Resource Adapters">resource adapter</a> is a component that implements the Java EE Connector API architecture.
			</p><p>
				JCA 1.7 provides features for managing:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						connections
					</li><li class="listitem">
						transactions
					</li><li class="listitem">
						security
					</li><li class="listitem">
						life-cycle
					</li><li class="listitem">
						work instances
					</li><li class="listitem">
						transaction inflow
					</li><li class="listitem">
						message inflow
					</li></ul></div><p>
				JCA 1.7 was developed under the Java Community Process as <a class="link" href="https://www.jcp.org/en/jsr/detail?id=322">JSR-322</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="resource_adapters"/>About Resource Adapters</h1></div></div></div><p>
				A resource adapter is a deployable Java EE component that provides communication between a Java EE application and an Enterprise Information System (EIS) using the Java Connector Architecture (JCA) specification. A resource adapter is often provided by EIS vendors to allow easy integration of their products with Java EE applications.
			</p><p>
				An Enterprise Information System can be any other software system within an organization. Examples include Enterprise Resource Planning (ERP) systems, database systems, e-mail servers and proprietary messaging systems.
			</p><p>
				A resource adapter is packaged in a Resource Adapter Archive (RAR) file which can be deployed to JBoss EAP. A RAR file may also be included in an Enterprise Archive (EAR) deployment.
			</p><p>
				The resource adapter itself is defined within the <code class="literal">resource-adapters</code> subsystem, which is provided by the IronJacamar project.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_jca_subsystem"/>Configuring the JCA Subsystem</h1></div></div></div><p>
				The <code class="literal">jca</code> subsystem controls the general settings for the JCA container and resource adapter deployments. You can configure the <code class="literal">jca</code> subsystem using the management console or the management CLI.
			</p><p>
				The main JCA elements to configure are:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="jca_management.html#archive_validation" title="Archive Validation">Archive validation</a>
					</li><li class="listitem">
						<a class="link" href="jca_management.html#bean_validation" title="Bean Validation">Bean validation</a>
					</li><li class="listitem">
						<a class="link" href="jca_management.html#work_managers" title="Work Managers">Work managers</a>
					</li><li class="listitem">
						<a class="link" href="jca_management.html#dist_work_managers" title="Distributed Work Managers">Distributed work managers</a>
					</li><li class="listitem">
						<a class="link" href="jca_management.html#bootstrap_contexts" title="Bootstrap Contexts">Bootstrap contexts</a>
					</li><li class="listitem">
						<a class="link" href="jca_management.html#cached_connection_manager" title="Cached Connection Manager">Cached connection manager</a>
					</li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Configure JCA settings from the management console</span></dt><dd><p class="simpara">
							The <code class="literal">jca</code> subsystem can be configured from the management console by navigating to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>JCA</strong></span> and clicking <span class="strong"><strong>View</strong></span>. Then, select the appropriate tab:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<span class="strong"><strong>Configuration</strong></span> - Contains settings for the cached connection manager, archive validation, and bean validation. Each of these is contained in their own tab as well. Modify these settings by opening the appropriate tab and clicking the <span class="strong"><strong>Edit</strong></span> link.
								</li><li class="listitem">
									<span class="strong"><strong>Bootstrap Context</strong></span> - Contains the list of configured bootstrap contexts. New bootstrap context objects can be added, removed, and configured. Each bootstrap context must be assigned a work manager.
								</li><li class="listitem"><p class="simpara">
									<span class="strong"><strong>Workmanager</strong></span> - Contains the list of configured work managers. New work managers can be added, removed, and their thread pools configured here. Each work manager can have one short-running thread pool and an optional long-running thread pool.
								</p><p class="simpara">
									The thread pool attributes can be configured by clicking <span class="strong"><strong>Thread Pools</strong></span> on the selected work manager.
								</p></li></ul></div></dd><dt><span class="term">Configure JCA settings from the management CLI</span></dt><dd>
							The <code class="literal">jca</code> subsystem can be configured from the management CLI from the <code class="literal">/subsystem=jca</code> address. In a managed domain, you must precede the command with <code class="literal">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span></code>.
						</dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Attribute names in the tables in the following sections are listed as they appear in the management model, for example, when using the management CLI. See the schema definition file located at <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/docs/schema/wildfly-jca_5_0.xsd</code> to view the elements as they appear in the XML, as there may be differences from the management model.
				</p></div><h3><a id="archive_validation"/>Archive Validation</h3><p>
				This determines whether archive validation will be performed on the deployment units. The following table describes the attributes you can set for archive validation.
			</p><div class="table"><a id="idm140150820096144"/><p class="title"><strong>Table 16.1. Archive Validation Attributes</strong></p><div class="table-contents"><table summary="Archive Validation Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Default Value</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								enabled
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies whether archive validation is enabled.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								fail-on-error
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies whether an archive validation error report fails the deployment.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								fail-on-warn
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies whether an archive validation warning report fails the deployment.
							</p>
							 </td></tr></tbody></table></div></div><p>
				If an archive does not implement the JCA specification correctly and archive validation is enabled, an error message will display during deployment describing the problem. For example:
			</p><pre class="screen">Severity: ERROR
Section: 19.4.2
Description: A ResourceAdapter must implement a "public int hashCode()" method.
Code: com.mycompany.myproject.ResourceAdapterImpl

Severity: ERROR
Section: 19.4.2
Description: A ResourceAdapter must implement a "public boolean equals(Object)" method.
Code: com.mycompany.myproject.ResourceAdapterImpl</pre><p>
				If archive validation is not specified, it is considered present and the <code class="literal">enabled</code> attribute defaults to <code class="literal">true</code>.
			</p><h3><a id="bean_validation"/>Bean Validation</h3><p>
				This setting determines whether bean validation, defined in <a class="link" href="https://jcp.org/en/jsr/detail?id=303">JSR-303</a>, will be performed on the deployment units. The following table describes the attributes you can set for bean validation.
			</p><div class="table"><a id="idm140150820064496"/><p class="title"><strong>Table 16.2. Bean Validation Attributes</strong></p><div class="table-contents"><table summary="Bean Validation Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Default Value</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								enabled
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								true
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies whether bean validation is enabled.
							</p>
							 </td></tr></tbody></table></div></div><p>
				If bean validation is not specified, it is considered present and the <code class="literal">enabled</code> attribute defaults to <code class="literal">true</code>.
			</p><h3><a id="work_managers"/>Work Managers</h3><p>
				There are two types of work managers:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Default work manager</span></dt><dd>
							The default work manager and its thread pools.
						</dd><dt><span class="term">Custom work manager</span></dt><dd>
							A custom work manager definition and its thread pools.
						</dd></dl></div><p>
				The following table describes the attributes you can set for work managers.
			</p><div class="table"><a id="idm140150820040832"/><p class="title"><strong>Table 16.3. Work Manager Attributes</strong></p><div class="table-contents"><table summary="Work Manager Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								name
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies the name of the work manager.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								elytron-enabled
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								This attribute enables Elytron security for the <code class="literal">workmanager</code>.
							</p>
							 </td></tr></tbody></table></div></div><p>
				A work manager also has the following child elements.
			</p><div class="table"><a id="idm140150820024352"/><p class="title"><strong>Table 16.4. Work Manager Child Elements</strong></p><div class="table-contents"><table summary="Work Manager Child Elements" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Child Element</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								short-running-threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Thread pool for standard Work instances. Each work manager has one short-running thread pool.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								long-running-threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Thread pool for JCA 1.7 Work instances that set the <code class="literal">LONG_RUNNING</code> hint. Each work manager can have one optional long-running thread pool.
							</p>
							 </td></tr></tbody></table></div></div><p>
				The following table describes the attributes you can set for work manager thread pools.
			</p><div class="table"><a id="idm140150820007696"/><p class="title"><strong>Table 16.5. Thread Pool Attributes</strong></p><div class="table-contents"><table summary="Thread Pool Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								allow-core-timeout
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Boolean setting that determines whether core threads may time out. The default value is <code class="literal">false</code>.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								core-threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The core thread pool size. This must be equal to or smaller than the maximum thread pool size.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								handoff-executor
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An executor to delegate tasks to in the event that a task cannot be accepted. If not specified, tasks that cannot be accepted will be silently discarded.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								keepalive-time
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies the amount of time that pool threads should be kept after doing work.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								max-threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The maximum thread pool size.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								name
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies the name of the thread pool.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								queue-length
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The maximum queue length.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								thread-factory
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Reference to the thread factory.
							</p>
							 </td></tr></tbody></table></div></div><h3><a id="dist_work_managers"/>Distributed Work Managers</h3><p>
				A distributed work manager is a work manager instance that is able to reschedule work execution on another work manager instance.
			</p><p>
				The following example management CLI commands configure a distributed work manager. Note that you must use a configuration that provides high availability capabilities, such as the <code class="literal">standalone-ha.xml</code> or <code class="literal">standalone-full-ha.xml</code> configuration file for a standalone server.
			</p><div class="title"><strong>Example: Configure a Distributed Work Manager</strong></div><p>
					
</p><pre class="screen">batch
/subsystem=jca/distributed-workmanager=myDistWorkMgr:add(name=myDistWorkMgr)
/subsystem=jca/distributed-workmanager=myDistWorkMgr/short-running-threads=myDistWorkMgr:add(queue-length=10,max-threads=10)
/subsystem=jca/bootstrap-context=myCustomContext:add(name=myCustomContext,workmanager=myDistWorkMgr)
run-batch</pre><p>

				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The name of the <code class="literal">short-running-threads</code> element must be the same as the name of the <code class="literal">distributed-workmanager</code> element.
				</p></div><p>
				The following table describes the attributes you can configure for distributed work managers.
			</p><div class="table"><a id="idm140150819961184"/><p class="title"><strong>Table 16.6. Distributed Work Manager Attributes</strong></p><div class="table-contents"><table summary="Distributed Work Manager Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								elytron-enabled
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enables Elytron security for the work manager.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								name
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The name of the distributed work manager.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								policy
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The policy decides when to redistribute a work instance. Allowed values are:
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<code class="literal">NEVER</code> - Never distribute the work instance to another node.
									</li><li class="listitem">
										<code class="literal">ALWAYS</code> - Always distribute the work instance to another node.
									</li><li class="listitem">
										<code class="literal">WATERMARK</code> - Distribute the work instance to another node based on how many free worker threads the current node has available.
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								policy-options
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								List of the policy’s key/value pair options. If you use the <code class="literal">WATERMARK</code> policy, then you can use the <code class="literal">watermark</code> policy option to specify at what number of free threads that work should be distributed. For example:
							</p>
							 
<pre class="screen">/subsystem=jca/distributed-workmanager=myDistWorkMgr:write-attribute(name=policy-options,value={watermark=3})</pre>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								selector
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The selector decides to which nodes in the network to redistribute the work instance. Allowed values are:
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<code class="literal">FIRST_AVAILABLE</code> - Select the first available node in the list.
									</li><li class="listitem">
										<code class="literal">PING_TIME</code> - Select the node with the lowest ping time.
									</li><li class="listitem">
										<code class="literal">MAX_FREE_THREADS</code> - Select the node with highest number of free worker threads.
									</li></ul></div>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								selector-options
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								List of the selector’s key/value pair options.
							</p>
							 </td></tr></tbody></table></div></div><p>
				A distributed work manager also has the following child elements.
			</p><div class="table"><a id="idm140150819918608"/><p class="title"><strong>Table 16.7. Distributed Work Manager Child Elements</strong></p><div class="table-contents"><table summary="Distributed Work Manager Child Elements" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Child Element</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								long-running-threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The thread pool for work instances that set the <code class="literal">LONG_RUNNING</code> hint. Each distributed work manager can optionally have a long-running thread pool.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								short-running-threads
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The thread pool for standard work instances. Each distributed work manager must have a short-running thread pool.
							</p>
							 </td></tr></tbody></table></div></div><h3><a id="bootstrap_contexts"/>Bootstrap Contexts</h3><p>
				This is used to define custom bootstrap contexts. The following table describes the attributes you can set for bootstrap contexts.
			</p><div class="table"><a id="idm140150819900592"/><p class="title"><strong>Table 16.8. Bootstrap Context Attributes</strong></p><div class="table-contents"><table summary="Bootstrap Context Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								name
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies the name of the bootstrap context.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								workmanager
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies the name of the work manager to use for this context.
							</p>
							 </td></tr></tbody></table></div></div><h3><a id="cached_connection_manager"/>Cached Connection Manager</h3><p>
				This is used for debugging connections and supporting lazy enlistment of a connection in a transaction, tracking whether they are used and released properly by the application. The following table describes the attributes you can set for the cached connection manager.
			</p><div class="table"><a id="idm140150819883008"/><p class="title"><strong>Table 16.9. Cached Connection Manager Attributes</strong></p><div class="table-contents"><table summary="Cached Connection Manager Attributes" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Attribute</th><th style="text-align: left" valign="top">Default Value</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								debug
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Outputs warning on failure to explicitly close connections.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								error
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Throws exception on failure to explicitly close connections.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								ignore-unknown-connections
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Specifies that unknown connections will not be cached.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								install
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								false
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enable or disable the cached connection manager valve and interceptor.
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_resource_adapters"/>Configuring Resource Adapters</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deploy_resource_adapter"/>Deploy a Resource Adapter</h2></div></div></div><p>
					Resource adapters can be deployed just like other deployments using the management CLI or the management console. When running a standalone server, you can also copy the archive to the deployments directory to be picked up by the deployment scanner.
				</p><h4><a id="deploy_a_resource_adapter_using_the_management_cli"/>Deploy a Resource Adapter using the Management CLI</h4><p>
					To deploy the resource adapter to a standalone server, enter the following management CLI command.
				</p><pre class="screen">deploy <span class="emphasis"><em>/path/to</em></span>/resource-adapter.rar</pre><p>
					To deploy the resource adapter to all server groups in a managed domain, enter the following management CLI command.
				</p><pre class="screen">deploy <span class="emphasis"><em>/path/to</em></span>/resource-adapter.rar --all-server-groups</pre><h4><a id="deploy_a_resource_adapter_using_the_management_console"/>Deploy a Resource Adapter using the Management Console</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Log in to the management console and click on the <span class="strong"><strong>Deployments</strong></span> tab.
						</li><li class="listitem">
							Click the Add (<span class="strong"><strong>+</strong></span>) button. In a managed domain, you will first need to select <span class="strong"><strong>Content Repository</strong></span>.
						</li><li class="listitem">
							Choose the <span class="strong"><strong>Upload Deployment</strong></span> option.
						</li><li class="listitem">
							Browse to the resource adapter archive and click <span class="strong"><strong>Next</strong></span>.
						</li><li class="listitem">
							Verify the upload, then click <span class="strong"><strong>Finish</strong></span>.
						</li><li class="listitem">
							In a managed domain, deploy the deployment to the appropriate server groups and enable the deployment.
						</li></ol></div><h4><a id="deploy_a_resource_adapter_using_the_deployment_scanner"/>Deploy a Resource Adapter Using the Deployment Scanner</h4><p>
					To deploy a resource adapter manually to a standalone server, copy the resource adapter archive to the server deployments directory, for example, <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/deployments/</code>. This will be picked up and deployed by the deployment scanner.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						This option is not available for managed domains. You must use either the management console or the management CLI to deploy the resource adapter to server groups.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_resource_adapater"/>Configure a Resource Adapter</h2></div></div></div><p>
					You can configure resource adapters using the management interfaces. The below example shows how to configure a resource adapter using the management CLI. See your resource adapter vendor’s documentation for supported properties and other important information.
				</p><h4><a id="add_the_resource_adapter_configuration"/>Add the Resource Adapter Configuration</h4><p>
					Add the resource adapter configuration.
				</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar:add(archive=eis.rar, transaction-support=XATransaction)</pre><h4><a id="configure_the_resource_adapter_settings"/>Configure the Resource Adapter Settings</h4><p>
					Configure any of the following settings as necessary.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Configure <code class="literal">config-properties</code>.
						</p><p class="simpara">
							Add the <code class="literal">server</code> configuration property.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/config-properties=server:add(value=localhost)</pre><p class="simpara">
							Add the <code class="literal">port</code> configuration property.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/config-properties=port:add(value=9000)</pre></li><li class="listitem"><p class="simpara">
							Configure <code class="literal">admin-objects</code>.
						</p><p class="simpara">
							Add an admin object.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/admin-objects=aoName:add(class-name=com.acme.eis.ra.EISAdminObjectImpl, jndi-name=java:/eis/AcmeAdminObject)</pre><p class="simpara">
							Configure an admin object configuration property.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/admin-objects=aoName/config-properties=threshold:add(value=10)</pre></li><li class="listitem"><p class="simpara">
							Configure <code class="literal">connection-definitions</code>.
						</p><p class="simpara">
							Add a connection definition for a managed connection factory.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/connection-definitions=cfName:add(class-name=com.acme.eis.ra.EISManagedConnectionFactory, jndi-name=java:/eis/AcmeConnectionFactory)</pre><p class="simpara">
							Configure a managed connection factory configuration property.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/connection-definitions=cfName/config-properties=name:add(value=Acme Inc)</pre><p class="simpara">
							Configure whether to record the enlistment trace. You can enable the recording of enlistment traces by setting the <code class="literal">enlistment-trace</code> attribute to <code class="literal">true</code>.
						</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar/connection-definitions=cfName:write-attribute(name=enlistment-trace,value=true)</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
								Enabling enlistment tracing makes tracking down errors during transaction enlistment easier, but comes with a performance impact.
							</p></div></li></ul></div><p>
					See <a class="link" href="reference_material.html#resource_adapter_attributes" title="Resource Adapter Attributes">Resource Adapter Attributes</a> for all available configuration options for resource adapters.
				</p><h4><a id="activate_the_resource_adapter"/>Activate the Resource Adapter</h4><p>
					Activate the resource adapter.
				</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=eis.rar:activate</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						You can also define capacity policies for resource adapters. For more details, see the <a class="link" href="datasource_management.html#jca-capacity-policies" title="Capacity Policies">Capacity Policies</a> section.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_resource_adapters_with_elytron"/>Configure Resource Adapters to Use the Elytron Subsystem</h2></div></div></div><p>
					Two types of communications occur between the server and the resource adapter in IronJacamar.
				</p><p>
					One of them is when the server opens a resource adapter connection. As defined by the specifications, this can be secured by container-managed sign-on, which requires propagation of a JAAS subject with principal and credentials to the resource adapter when opening the connection. This sign-on can be delegated to Elytron.
				</p><p>
					IronJacamar supports security inflow. This mechanism enables a resource adapter to establish security information when submitting a work to the work manager, and when delivering messages to endpoints residing in the same JBoss EAP instance.
				</p><h4><a id="container_managed_sign_on"/>Container-managed Sign-On</h4><p>
					In order to achieve container-managed sign-on with Elytron, the <code class="literal">elytron-enabled</code> attribute needs to be set to <code class="literal">true</code>. This will result in all connections to the resource adapter to be secured by Elytron.
				</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RAR_NAME</em></span>/connection-definitions=<span class="emphasis"><em>FACTORY_NAME</em></span>:write-attribute(name=elytron-enabled,value=true)</pre><p>
					The <code class="literal">elytron-enabled</code> attribute can be configured using the management CLI by setting the <code class="literal">elytron-enabled</code> attribute, in the <code class="literal">resource-adapters</code> subsystems, to <code class="literal">true</code>. By default this attribute is set to <code class="literal">false</code>.
				</p><p>
					The <code class="literal">authentication-context</code> attribute defines the name of the Elytron authentication context that will be used for performing sign-on.
				</p><p>
					An Elytron <code class="literal">authentication-context</code> attribute can contain one or more <code class="literal">authentication-configuration</code> elements, which in turn contains the credentials you want to use.
				</p><p>
					If the <code class="literal">authentication-context</code> attribute is not set, JBoss EAP will use the current <code class="literal">authentication-context</code>, which is the <code class="literal">authentication-context</code> used by the caller code that is opening the connection.
				</p><div class="title"><strong>Example: Creating an <code class="literal">authentication-configuration</code></strong></div><p>
						
</p><pre class="screen">/subsystem=elytron/authentication-configuration=exampleAuthConfig:add(authentication-name=sa,credential-reference={clear-text=sa})</pre><p>

					</p><div class="title"><strong>Example: Creating the <code class="literal">authentication-context</code> Using the above Configuration</strong></div><p>
						
</p><pre class="screen">/subsystem=elytron/authentication-context=exampleAuthContext:add(match-rules=[{authentication-configuration=exampleAuthConfig}])</pre><p>

					</p><h4><a id="security-inflow"/>Security Inflow</h4><p>
					It is also possible for the resource manager to inflow security credentials when submitting the work which is to be executed by the work manager. Security inflow allows the work to authenticate itself before execution. If authentication succeeds, the submitted work will be executed under the resulting authentication context. If it fails, the work execution will be rejected.
				</p><p>
					To enable Elytron security inflow, set the <code class="literal">wm-elytron-security-domain</code> attribute when configuring the resource adapter work manager. Elytron will perform the authentication based on the specified domain.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						When the resource adapter work manager is configured to use the Elytron security domain, <code class="literal">wm-elytron-security-domain</code>, the referenced work manager should have the <code class="literal">elytron-enabled</code> attribute set to <code class="literal">true</code>.
					</p><pre class="screen">/subsystem=jca/workmanager=customWM:add(name=customWM, elytron-enabled=true)</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If instead of <code class="literal">wm-elytron-security-domain</code> the <code class="literal">wm-security-domain</code> attribute is used, the security inflow will be performed by the legacy <code class="literal">security</code> subsystem.
					</p></div><p>
					In the example configuration of <code class="literal">jca</code> subsystem below, we can see the configuration of a resource adapter called <code class="literal">ra-with-elytron-security-domain</code>. This resource adapter configures work manager security to use the Elytron security domain’s <code class="literal">wm-realm</code>.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:jca:5.0"&gt;
    &lt;archive-validation enabled="true" fail-on-error="true" fail-on-warn="false"/&gt;
    &lt;bean-validation enabled="true"/&gt;
    &lt;default-workmanager&gt;
        &lt;short-running-threads&gt;
            &lt;core-threads count="50"/&gt;
            &lt;queue-length count="50"/&gt;
            &lt;max-threads count="50"/&gt;
            &lt;keepalive-time time="10" unit="seconds"/&gt;
        &lt;/short-running-threads&gt;
        &lt;long-running-threads&gt;
            &lt;core-threads count="50"/&gt;
            &lt;queue-length count="50"/&gt;
            &lt;max-threads count="50"/&gt;
            &lt;keepalive-time time="10" unit="seconds"/&gt;
        &lt;/long-running-threads&gt;
    &lt;/default-workmanager&gt;
    &lt;workmanager name="customWM"&gt;
        &lt;elytron-enabled&gt;true&lt;/elytron-enabled&gt;
        &lt;short-running-threads&gt;
            &lt;core-threads count="20"/&gt;
            &lt;queue-length count="20"/&gt;
            &lt;max-threads count="20"/&gt;
        &lt;/short-running-threads&gt;
    &lt;/workmanager&gt;
    &lt;bootstrap-contexts&gt;
        &lt;bootstrap-context name="customContext" workmanager="customWM"/&gt;
    &lt;/bootstrap-contexts&gt;
    &lt;cached-connection-manager/&gt;
&lt;/subsystem&gt;</pre><p>
					The work manager is then referenced using the boostrap context from the <code class="literal">resource-adapter</code> subsystem.
				</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:resource-adapters:5.0"&gt;
    &lt;resource-adapters&gt;
        &lt;resource-adapter id="ra-with-elytron-security-domain"&gt;
            &lt;archive&gt;
                ra-with-elytron-security-domain.rar
            &lt;/archive&gt;
            &lt;bootstrap-context&gt;customContext&lt;/bootstrap-context&gt;
            &lt;transaction-support&gt;NoTransaction&lt;/transaction-support&gt;
            &lt;workmanager&gt;
                &lt;security&gt;
                    &lt;elytron-security-domain&gt;wm-realm&lt;/elytron-security-domain&gt;
                    &lt;default-principal&gt;wm-default-principal&lt;/default-principal&gt;
                    &lt;default-groups&gt;
                        &lt;group&gt;
                            wm-default-group
                        &lt;/group&gt;
                    &lt;/default-groups&gt;
                &lt;/security&gt;
            &lt;/workmanager&gt;
        &lt;/resource-adapter&gt;
    &lt;/resource-adapters&gt;
&lt;/subsystem&gt;</pre><div class="title"><strong>Example: Configuration of the Security Domain</strong></div><p>
						
</p><pre class="screen">/subsystem=elytron/properties-realm=wm-properties-realm:add(users-properties={path=/security-dir/users.properties, plain-text=true}, groups-properties={path=/security-dir/groups.properties})

/subsystem=elytron/simple-role-decoder=wm-role-decoder:add(attribute=groups)

/subsystem=elytron/constant-permission-mapper=wm-permission-mapper:add(permissions=[{class-name="org.wildfly.security.auth.permission.LoginPermission"}])

/subsystem=elytron/security-domain=wm-realm:add(default-realm=wm-properties-realm, permission-mapper=wm-permission-mapper, realms=[{role-decoder=wm-role-decoder, realm=wm-properties-realm}])</pre><p>

					</p><p>
					The <code class="literal">Work</code> class is responsible for providing the credentials for Elytron’s authentication under the specified domain. For that, it must implement <code class="literal">javax.resource.spi.work.WorkContextProvider</code>.
				</p><pre class="programlisting">public interface WorkContextProvider {
   /**
    * Gets an instance of &lt;code&gt;WorkContexts&lt;/code&gt; that needs to be used
    * by the &lt;code&gt;WorkManager&lt;/code&gt; to set up the execution context while
    * executing a &lt;code&gt;Work&lt;/code&gt; instance.
    *
    * @return an &lt;code&gt;List&lt;/code&gt; of &lt;code&gt;WorkContext&lt;/code&gt; instances.
    */
   List&lt;WorkContext&gt; getWorkContexts();
}</pre><p>
					This interface allows the <code class="literal">Work</code> class to use the <code class="literal">WorkContext</code> to configure some aspects of the context in which the work will be executed. One of those aspects is the security inflow. For that, the <code class="literal">List&lt;WorkContext&gt; getWorkContexts</code> method must provide a <code class="literal">javax.resource.spi.work.SecurityContext</code>. This context will use <code class="literal">javax.security.auth.callback.Callback</code> objects as defined in the <a class="link" href="https://www.jcp.org/en/jsr/detail?id=196">JSR-196 specification</a> to provide the credentials.
				</p><div class="title"><strong>Example: Creation of Callbacks Using Context</strong></div><p>
						
</p><pre class="programlisting">public class ExampleWork implements Work, WorkContextProvider {

    private final String username;
    private final String role;

    public MyWork(TestBean bean, String username, String role) {
        this.principals = null;
        this.roles = null;
        this.bean = bean;
        this.username = username;
        this.role = role;
    }

    public List&lt;WorkContext&gt; getWorkContexts() {
        List&lt;WorkContext&gt; l = new ArrayList&lt;&gt;(1);
        l.add(new MySecurityContext(username, role));
        return l;
    }

    public void run() {
        ...
    }

    public void release() {
        ...
    }

    public class ExampleSecurityContext extends SecurityContext {

        public void setupSecurityContext(CallbackHandler handler, Subject executionSubject, Subject serviceSubject) {
            try {
                List&lt;javax.security.auth.callback.Callback&gt; cbs = new ArrayList&lt;&gt;();
                cbs.add(new CallerPrincipalCallback(executionSubject, new SimplePrincipal(username)));
                cbs.add(new GroupPrincipalCallback(executionSubject, new String[]{role}));
                handler.handle(cbs.toArray(new javax.security.auth.callback.Callback[cbs.size()]));
            } catch (Throwable t) {
                throw new RuntimeException(t);
            }
        }
    }</pre><p>

					</p><p>
					In the above example, <code class="literal">ExampleWork</code> implements the <code class="literal">WorkContextProvider</code> interface to provide <code class="literal">ExampleSecurityContext</code>. That context will create the callbacks necessary to provide the security information that will be authenticated by Elytron upon work execution.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deploy_configure_ibm_mq_resource_adapter"/>Deploy and Configure the IBM MQ Resource Adapter</h2></div></div></div><p>
					You can find the instructions for <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#deploy_the_ibm_mq_resource_adapter">deploying the IBM MQ resource adapter</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deploy_configure_generic_resource_adapter"/>Deploy and Configure the Generic JMS Resource Adapter</h2></div></div></div><p>
					You can find the instructions for <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#deploy_configure_generic_jms_resource_adapter">configuring the generic JMS resource adapter</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure_managed_connection_pools"/>Configure Managed Connection Pools</h1></div></div></div><p>
				JBoss EAP provides three implementations of the <code class="literal">ManagedConnectionPool</code> interface.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">org.jboss.jca.core.connectionmanager.pool.mcp.SemaphoreConcurrentLinkedQueueManagedConnectionPool</code></span></dt><dd>
							This is the default connection pool in JBoss EAP 7 and provides the best out-of-the-box performance.
						</dd><dt><span class="term"><code class="literal">org.jboss.jca.core.connectionmanager.pool.mcp.SemaphoreArrayListManagedConnectionPool</code></span></dt><dd>
							This was the default connection pool in previous JBoss EAP versions.
						</dd><dt><span class="term"><code class="literal">org.jboss.jca.core.connectionmanager.pool.mcp.LeakDumperManagedConnectionPool</code></span></dt><dd>
							This connection pool is used for debugging purposes only and will report any leaks upon shutdown or when the pool is flushed.
						</dd></dl></div><p>
				You can set the managed connection pool implementation for a datasource using the following management CLI command.
			</p><pre class="screen">/subsystem=datasources/data-source=<span class="emphasis"><em>DATA_SOURCE</em></span>:write-attribute(name=mcp,value=<span class="emphasis"><em>MCP_CLASS</em></span>)</pre><p>
				You can set the managed connection pool implementation for a resource adapter using the following management CLI command.
			</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RESOURCE_ADAPTER</em></span>/connection-definitions=<span class="emphasis"><em>CONNECTION_DEFINITION</em></span>:write-attribute(name=mcp,value=<span class="emphasis"><em>MCP_CLASS</em></span>)</pre><p>
				You can set the managed connection pool implementation for a messaging server using the following management CLI command.
			</p><pre class="screen">/subsystem=messaging-activemq/server=<span class="emphasis"><em>SERVER</em></span>/pooled-connection-factory=<span class="emphasis"><em>CONNECTION_FACTORY</em></span>:write-attribute(name=managed-connection-pool,value=<span class="emphasis"><em>MCP_CLASS</em></span>)</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="view_defined_connection_stats"/>View Connection Statistics</h1></div></div></div><p>
				You can read statistics for a defined connection from the <code class="literal">/deployment=<span class="emphasis"><em>NAME</em></span>.rar</code> subtree. This is so that you can access statistics for any RAR, even if it not defined in a <code class="literal">standalone.xml</code> or <code class="literal">domain.xml</code> configuration.
			</p><pre class="screen">/deployment=<span class="emphasis"><em>NAME</em></span>.rar/subsystem=resource-adapters/statistics=statistics/connection-definitions=java\:\/testMe:read-resource(include-runtime=true)</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					Be sure to specify the <code class="literal">include-runtime=true</code> argument, as all statistics are runtime-only information.
				</p></div><p>
				See <a class="link" href="reference_material.html#resource_adapter_statistics" title="Resource Adapter Statistics">Resource Adapter Statistics</a> for information on the available statistics.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="flushing_resource_adapter_connections"/>Flushing Resource Adapter Connections</h1></div></div></div><p>
				You can flush resource adapter connections using the following management CLI commands.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					In a managed domain, you must precede these commands with <code class="literal">/host=<span class="emphasis"><em>HOST_NAME</em></span>/server=<span class="emphasis"><em>SERVER_NAME</em></span></code>.
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Flush all connections in the pool.
					</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RESOURCE_ADAPTER</em></span>/connection-definitions=<span class="emphasis"><em>CONNECTION_DEFINITION</em></span>:flush-all-connection-in-pool</pre></li><li class="listitem"><p class="simpara">
						Gracefully flush all connections in the pool.
					</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RESOURCE_ADAPTER</em></span>/connection-definitions=<span class="emphasis"><em>CONNECTION_DEFINITION</em></span>:flush-gracefully-connection-in-pool</pre><p class="simpara">
						The server will wait until connections become idle before flushing them.
					</p></li><li class="listitem"><p class="simpara">
						Flush all idle connections in the pool.
					</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RESOURCE_ADAPTER</em></span>/connection-definitions=<span class="emphasis"><em>CONNECTION_DEFINITION</em></span>:flush-idle-connection-in-pool</pre></li><li class="listitem"><p class="simpara">
						Flush all invalid connections in the pool.
					</p><pre class="screen">/subsystem=resource-adapters/resource-adapter=<span class="emphasis"><em>RESOURCE_ADAPTER</em></span>/connection-definitions=<span class="emphasis"><em>CONNECTION_DEFINITION</em></span>:flush-invalid-connection-in-pool</pre><p class="simpara">
						The server will flush all connections that it determines to be invalid.
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tuning_resource_adapters_subsystem"/>Tuning the Resource Adapters Subsystem</h1></div></div></div><p>
				For tips on monitoring and optimizing performance for the <code class="literal">resource-adapters</code> subsystem, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/performance_tuning_guide/#datasource_and_resource_adapter_tuning">Datasource and Resource Adapter Tuning</a> section of the <span class="emphasis"><em>Performance Tuning Guide</em></span>.
			</p></div></div></body></html>