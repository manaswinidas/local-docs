<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 4. Network and Port Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="network_and_port_configuration"/>Chapter 4. Network and Port Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="interfaces"/>Interfaces</h1></div></div></div><p>
				JBoss EAP references named interfaces throughout the configuration. This allows the configuration to reference individual interface declarations with logical names, rather than requiring the full details of the interface at each use.
			</p><p>
				This also allows for easier configuration in a managed domain, where network interface details can vary across multiple machines. Each server instance can correspond to a logical name group.
			</p><p>
				The <code class="literal">standalone.xml</code>, <code class="literal">domain.xml</code>, and <code class="literal">host.xml</code> files all include interface declarations. There are several preconfigured interface names, depending on which default configuration is used. The <code class="literal">management</code> interface can be used for all components and services that require the management layer, including the HTTP management endpoint. The <code class="literal">public</code> interface can be used for all application-related network communications. The <code class="literal">unsecure</code> interface is used for IIOP sockets in the standard configuration. The <code class="literal">private</code> interface is used for JGroups sockets in the standard configuration.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="default_interface_configurations"/>Default Interface Configurations</h2></div></div></div><pre class="programlisting">&lt;interfaces&gt;
  &lt;interface name="management"&gt;
    &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="public"&gt;
    &lt;inet-address value="${jboss.bind.address:127.0.0.1}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="private"&gt;
    &lt;inet-address value="${jboss.bind.address.private:127.0.0.1}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="unsecure"&gt;
    &lt;inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/&gt;
  &lt;/interface&gt;
&lt;/interfaces&gt;</pre><p>
					By default, JBoss EAP binds these interfaces to <code class="literal">127.0.0.1</code>, but these values can be overridden at runtime by setting the appropriate property. For example, the <code class="literal">inet-address</code> of the <code class="literal">public</code> interface can be set when starting JBoss EAP as a standalone server with the following command.
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -Djboss.bind.address=<span class="emphasis"><em>IP_ADDRESS</em></span></pre><p>
					Alternatively, you can use the <code class="literal">-b</code> switch on the server start command line. For more information about server start options, see <a class="link" href="reference_material.html#reference_of_switches_and_arguments_to_pass_at_server_runtime" title="Server Runtime Arguments">Server Runtime Arguments</a>.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						If you modify the default network interfaces or ports that JBoss EAP uses, you must also remember to change any scripts that use the modified interfaces or ports. These include JBoss EAP service scripts, as well as remembering to specify the correct interface and port when accessing the management console or management CLI.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_interfaces"/>Configuring Interfaces</h2></div></div></div><p>
					Network interfaces are declared by specifying a logical name and selection criteria for the physical interface. The selection criteria can reference a wildcard address or specify a set of one or more characteristics that an interface or address must have in order to be a valid match. For a listing of all available interface selection criteria, see the <a class="link" href="reference_material.html#reference_of_interface_attributes" title="Interface Attributes">Interface Attributes</a> section.
				</p><p>
					Interfaces can be configured using the management console or the management CLI. Below are several examples of adding and updating interfaces. The management CLI command is shown first, followed by the corresponding configuration XML.
				</p><h4><a id="add_an_interface_with_a_nic_value"/>Add an Interface with a NIC Value</h4><p>
					Add a new interface with a NIC value of <code class="literal">eth0</code>.
				</p><pre class="screen">/interface=external:add(nic=eth0)</pre><pre class="programlisting">&lt;interface name="external"&gt;
   &lt;nic name="eth0"/&gt;
&lt;/interface&gt;</pre><h4><a id="add_an_interface_with_several_conditional_values"/>Add an Interface with Several Conditional Values</h4><p>
					Add a new interface that matches any interface/address on the correct subnet if it is up, supports multicast, and is not point-to-point.
				</p><pre class="screen">/interface=default:add(subnet-match=192.168.0.0/16,up=true,multicast=true,not={point-to-point=true})</pre><pre class="programlisting">&lt;interface name="default"&gt;
   &lt;subnet-match value="192.168.0.0/16"/&gt;
   &lt;up/&gt;
   &lt;multicast/&gt;
   &lt;not&gt;
      &lt;point-to-point/&gt;
   &lt;/not&gt;
&lt;/interface&gt;</pre><h4><a id="update_an_interface_attribute"/>Update an Interface Attribute</h4><p>
					Update the <code class="literal">public</code> interface’s default <code class="literal">inet-address</code> value, keeping the <code class="literal">jboss.bind.address</code> property to allow for this value to be set at runtime.
				</p><pre class="screen">/interface=public:write-attribute(name=inet-address,value="${jboss.bind.address:192.168.0.0}")</pre><pre class="programlisting">&lt;interface name="public"&gt;
    &lt;inet-address value="${jboss.bind.address:192.168.0.0}"/&gt;
&lt;/interface&gt;</pre><h4><a id="add_an_interface_to_a_server_in_a_managed_domain"/>Add an Interface to a Server in a Managed Domain</h4><pre class="screen">/host=<span class="emphasis"><em>HOST_NAME</em></span>/server-config=<span class="emphasis"><em>SERVER_NAME</em></span>/interface=<span class="emphasis"><em>INTERFACE_NAME</em></span>:add(inet-address=127.0.0.1)</pre><pre class="programlisting">&lt;servers&gt;
   &lt;server name="<span class="emphasis"><em>SERVER_NAME</em></span>" group="main-server-group"&gt;
      &lt;interfaces&gt;
         &lt;interface name="<span class="emphasis"><em>INTERFACE_NAME</em></span>"&gt;
            &lt;inet-address value="127.0.0.1"/&gt;
         &lt;/interface&gt;
      &lt;/interfaces&gt;
   &lt;/server&gt;
&lt;/servers&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="socket_bindings"/>Socket Bindings</h1></div></div></div><p>
				Socket bindings and socket binding groups allow you to define network ports and their relationship to the networking interfaces required for your JBoss EAP configuration. A socket binding is a named configuration for a socket. A socket binding group is a collection of socket binding declarations that are grouped under a logical name.
			</p><p>
				This allows other sections of the configuration to reference socket bindings by their logical name, rather than requiring the full details of the socket configuration at each use.
			</p><p>
				The declarations for these named configurations can be found in the <code class="literal">standalone.xml</code> and <code class="literal">domain.xml</code> configuration files. A standalone server contains only one socket binding group, while a managed domain can contain multiple groups. You can create a socket binding group for each server group in the managed domain, or share a socket binding group between multiple server groups.
			</p><p>
				The ports JBoss EAP uses by default depend on which socket binding groups are used and the requirements of your individual deployments.
			</p><p>
				There are three types of socket bindings that can be defined in a socket binding group in the JBoss EAP configuration:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Inbound Socket Bindings</span></dt><dd><p class="simpara">
							The <code class="literal">socket-binding</code> element is used to configure inbound socket bindings for the JBoss EAP server. The default JBoss EAP configurations provide several preconfigured <code class="literal">socket-binding</code> elements, for example, for HTTP and HTTPS traffic. Another example can be found in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#broadcast_groups">Broadcast Groups</a> section of <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
						</p><p class="simpara">
							Attributes for this element can be found in the <a class="link" href="reference_material.html#socket_binding_local" title="Table A.12. Inbound Socket Binding (socket-binding) Attributes">Inbound Socket Binding Attributes</a> table.
						</p></dd><dt><span class="term">Remote Outbound Socket Bindings</span></dt><dd><p class="simpara">
							The <code class="literal">remote-destination-outbound-socket-binding</code> element is used to configure outbound socket bindings for destinations that are remote to the JBoss EAP server. The default JBoss EAP configurations provide an example remote destination socket binding that can be used for a mail server. Another example can be found in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/configuring_messaging/#use_provided_amq_adapter">Using the Integrated Artemis Resource Adapter for Remote Connections</a> section of <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
						</p><p class="simpara">
							Attributes for this element can be found in the <a class="link" href="reference_material.html#socket_binding_outbound_remote" title="Table A.13. Remote Outbound Socket Binding (remote-destination-outbound-socket-binding) Attributes">Remote Outbound Socket Binding Attributes</a> table.
						</p></dd><dt><span class="term">Local Outbound Socket Bindings</span></dt><dd><p class="simpara">
							The <code class="literal">local-destination-outbound-socket-binding</code> element is used to configure outbound socket bindings for destinations that are local to the JBoss EAP server. This type of socket binding is not expected to be commonly used.
						</p><p class="simpara">
							Attributes for this element can be found in the <a class="link" href="reference_material.html#socket_binding_outbound_local" title="Table A.14. Local Outbound Socket Binding (local-destination-outbound-socket-binding) Attributes">Local Outbound Socket Binding Attributes</a> table.
						</p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="management_ports"/>Management Ports</h2></div></div></div><p>
					Management ports were consolidated in JBoss EAP 7. By default, JBoss EAP 7 uses port <code class="literal">9990</code> for both native management, used by the management CLI, and HTTP management, used by the web-based management console. Port <code class="literal">9999</code>, which was used as the native management port in JBoss EAP 6, is no longer used but can still be enabled if desired.
				</p><p>
					If HTTPS is enabled for the management console, then port <code class="literal">9993</code> is used by default.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="default_socket_bindings"/>Default Socket Bindings</h2></div></div></div><p>
					JBoss EAP ships with a socket binding group for each of the five predefined profiles (<span class="emphasis"><em>default</em></span>, <span class="emphasis"><em>ha</em></span>, <span class="emphasis"><em>full</em></span>, <span class="emphasis"><em>full-ha</em></span>, <span class="emphasis"><em>load-balancer</em></span>).
				</p><p>
					For detailed information about the default socket bindings, such as default ports and descriptions, see the <a class="link" href="reference_material.html#reference_of_default_socket_bindings" title="Default Socket Bindings">Default Socket Bindings</a> section.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						If you modify the default network interfaces or ports that JBoss EAP uses, you must also remember to change any scripts that use the modified interfaces or ports. These include JBoss EAP service scripts, as well as remembering to specify the correct interface and port when accessing the management console or management CLI.
					</p></div><h4><a id="standalone_server"/>Standalone Server</h4><p>
					When running as a standalone server, only one socket binding group is defined per configuration file. Each standalone configuration file (<code class="literal">standalone.xml</code>, <code class="literal">standalone-ha.xml</code>, <code class="literal">standalone-full.xml</code>, <code class="literal">standalone-full-ha.xml</code>, <code class="literal">standalone-load-balancer.xml</code>) defines socket bindings for the technologies used by its corresponding profile.
				</p><p>
					For example, the default standalone configuration file (<code class="literal">standalone.xml</code>) specifies the below socket bindings.
				</p><pre class="programlisting">&lt;socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}"&gt;
    &lt;socket-binding name="management-http" interface="management" port="${jboss.management.http.port:9990}"/&gt;
    &lt;socket-binding name="management-https" interface="management" port="${jboss.management.https.port:9993}"/&gt;
    &lt;socket-binding name="ajp" port="${jboss.ajp.port:8009}"/&gt;
    &lt;socket-binding name="http" port="${jboss.http.port:8080}"/&gt;
    &lt;socket-binding name="https" port="${jboss.https.port:8443}"/&gt;
    &lt;socket-binding name="txn-recovery-environment" port="4712"/&gt;
    &lt;socket-binding name="txn-status-manager" port="4713"/&gt;
    &lt;outbound-socket-binding name="mail-smtp"&gt;
        &lt;remote-destination host="localhost" port="25"/&gt;
    &lt;/outbound-socket-binding&gt;
&lt;/socket-binding-group&gt;</pre><h4><a id="managed_domain"/>Managed Domain</h4><p>
					When running in a managed domain, all socket binding groups are defined in the <code class="literal">domain.xml</code> file. There are five predefined socket binding groups:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">standard-sockets</code>
						</li><li class="listitem">
							<code class="literal">ha-sockets</code>
						</li><li class="listitem">
							<code class="literal">full-sockets</code>
						</li><li class="listitem">
							<code class="literal">full-ha-sockets</code>
						</li><li class="listitem">
							<code class="literal">load-balancer-sockets</code>
						</li></ul></div><p>
					Each socket binding group specifies socket bindings for the technologies used by its corresponding profile. For example, the <code class="literal">full-ha-sockets</code> socket binding group defines several <code class="literal">jgroups</code> socket bindings, which are used by the <span class="emphasis"><em>full-ha</em></span> profile for high availability.
				</p><pre class="programlisting">&lt;socket-binding-groups&gt;
  &lt;socket-binding-group name="standard-sockets" default-interface="public"&gt;
    &lt;!-- Needed for server groups using the 'default' profile  --&gt;
    &lt;socket-binding name="ajp" port="${jboss.ajp.port:8009}"/&gt;
    &lt;socket-binding name="http" port="${jboss.http.port:8080}"/&gt;
    &lt;socket-binding name="https" port="${jboss.https.port:8443}"/&gt;
    &lt;socket-binding name="txn-recovery-environment" port="4712"/&gt;
    &lt;socket-binding name="txn-status-manager" port="4713"/&gt;
    &lt;outbound-socket-binding name="mail-smtp"&gt;
      &lt;remote-destination host="localhost" port="25"/&gt;
    &lt;/outbound-socket-binding&gt;
  &lt;/socket-binding-group&gt;
  &lt;socket-binding-group name="ha-sockets" default-interface="public"&gt;
    &lt;!-- Needed for server groups using the 'ha' profile  --&gt;
    ...
  &lt;/socket-binding-group&gt;
  &lt;socket-binding-group name="full-sockets" default-interface="public"&gt;
    &lt;!-- Needed for server groups using the 'full' profile  --&gt;
    ...
  &lt;/socket-binding-group&gt;
  &lt;socket-binding-group name="full-ha-sockets" default-interface="public"&gt;
    &lt;!-- Needed for server groups using the 'full-ha' profile  --&gt;
    &lt;socket-binding name="ajp" port="${jboss.ajp.port:8009}"/&gt;
    &lt;socket-binding name="http" port="${jboss.http.port:8080}"/&gt;
    &lt;socket-binding name="https" port="${jboss.https.port:8443}"/&gt;
    &lt;socket-binding name="iiop" interface="unsecure" port="3528"/&gt;
    &lt;socket-binding name="iiop-ssl" interface="unsecure" port="3529"/&gt;
    &lt;socket-binding name="jgroups-mping" interface="private" port="0" multicast-address="${jboss.default.multicast.address:230.0.0.4}" multicast-port="45700"/&gt;
    &lt;socket-binding name="jgroups-tcp" interface="private" port="7600"/&gt;
    &lt;socket-binding name="jgroups-udp" interface="private" port="55200" multicast-address="${jboss.default.multicast.address:230.0.0.4}" multicast-port="45688"/&gt;
    &lt;socket-binding name="modcluster" port="0" multicast-address="224.0.1.105" multicast-port="23364"/&gt;
    &lt;socket-binding name="txn-recovery-environment" port="4712"/&gt;
    &lt;socket-binding name="txn-status-manager" port="4713"/&gt;
    &lt;outbound-socket-binding name="mail-smtp"&gt;
      &lt;remote-destination host="localhost" port="25"/&gt;
    &lt;/outbound-socket-binding&gt;
  &lt;/socket-binding-group&gt;
  &lt;socket-binding-group name="load-balancer-sockets" default-interface="public"&gt;
    &lt;!-- Needed for server groups using the 'load-balancer' profile  --&gt;
    ...
  &lt;/socket-binding-group&gt;
&lt;/socket-binding-groups&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The socket configuration for the management interfaces is defined in the domain controller’s <code class="literal">host.xml</code> file.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_socket_bindings"/>Configuring Socket Bindings</h2></div></div></div><p>
					When defining a socket binding, you can configure the <code class="literal">port</code> and <code class="literal">interface</code> attributes, as well as multicast settings such as <code class="literal">multicast-address</code> and <code class="literal">multicast-port</code>. For details on all available socket bindings attributes, see the <a class="link" href="reference_material.html#reference_of_socket_binding_attributes" title="Socket Binding Attributes">Socket Binding Attributes</a> section.
				</p><p>
					Socket bindings can be configured using the management console or the management CLI. The following steps go through adding a socket binding group, adding a socket binding, and configuring socket binding settings using the management CLI.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Add a new socket binding group. Note that this step cannot be performed when running as a standalone server.
						</p><pre class="screen">/socket-binding-group=new-sockets:add(default-interface=public)</pre></li><li class="listitem"><p class="simpara">
							Add a socket binding.
						</p><pre class="screen">/socket-binding-group=new-sockets/socket-binding=new-socket-binding:add(port=1234)</pre></li><li class="listitem"><p class="simpara">
							Change the socket binding to use an interface other than the default, which is set by the socket binding group.
						</p><pre class="screen">/socket-binding-group=new-sockets/socket-binding=new-socket-binding:write-attribute(name=interface,value=unsecure)</pre></li></ol></div><p>
					The following example shows how the XML configuration may look after the above steps have been completed.
				</p><pre class="programlisting">&lt;socket-binding-groups&gt;
    ...
    &lt;socket-binding-group name="new-sockets" default-interface="public"&gt;
        &lt;socket-binding name="new-socket-binding" interface="unsecure" port="1234"/&gt;
    &lt;/socket-binding-group&gt;
&lt;/socket-binding-groups&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="port_offsets"/>Port Offsets</h2></div></div></div><p>
					A port offset is a numeric offset value added to all port values specified in the socket binding group for that server. This allows the server to inherit the port values defined in its socket binding group, with an offset to ensure that it does not conflict with any other servers on the same host. For instance, if the HTTP port of the socket binding group is <code class="literal">8080</code>, and a server uses a port offset of <code class="literal">100</code>, then its HTTP port is <code class="literal">8180</code>.
				</p><p>
					Below is an example of setting a port offset of <code class="literal">250</code> for a server in a managed domain using the management CLI.
				</p><pre class="screen">/host=master/server-config=server-two/:write-attribute(name=socket-binding-port-offset,value=250)</pre><p>
					Port offsets can be used for servers in a managed domain and for running multiple standalone servers on the same host.
				</p><p>
					You can pass in a port offset when starting a standalone server using the <code class="literal">jboss.socket.binding.port-offset</code> property.
				</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -Djboss.socket.binding.port-offset=100</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ipv6_addresses"/>IPv6 Addresses</h1></div></div></div><p>
				By default, JBoss EAP is configured to run using IPv4 addresses. The steps below show how to configure JBoss EAP to run using IPv6 addresses.
			</p><h3><a id="configure_the_jvm_stack_for_ipv6_addresses"/>Configure the JVM Stack for IPv6 Addresses</h3><p>
				Update the startup configuration to prefer IPv6 addresses.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Open the startup configuration file.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								When running as a standalone server, edit the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.conf</code> file (or <code class="literal">standalone.conf.bat</code> for Windows Server).
							</li><li class="listitem">
								When running in a managed domain, edit the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/domain.conf</code> file (or <code class="literal">domain.conf.bat</code> for Windows Server).
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">java.net.preferIPv4Stack</code> property to <code class="literal">false</code>.
					</p><pre class="screen">-Djava.net.preferIPv4Stack=false</pre></li><li class="listitem"><p class="simpara">
						Append the <code class="literal">java.net.preferIPv6Addresses</code> property and set it to <code class="literal">true</code>.
					</p><pre class="screen">-Djava.net.preferIPv6Addresses=true</pre></li></ol></div><p>
				The following example shows how the JVM options in the startup configuration file may look after making the above changes.
			</p><pre class="programlisting"># Specify options to pass to the Java VM.
#
if [ "x$JAVA_OPTS" = "x" ]; then
   JAVA_OPTS="-Xms1303m -Xmx1303m -Djava.net.preferIPv4Stack=false"
   JAVA_OPTS="$JAVA_OPTS -Djboss.modules.system.pkgs=$JBOSS_MODULES_SYSTEM_PKGS -Djava.awt.headless=true"
   JAVA_OPTS="$JAVA_OPTS -Djava.net.preferIPv6Addresses=true"
else</pre><h3><a id="update_interface_declarations_for_ipv6_addresses"/>Update Interface Declarations for IPv6 Addresses</h3><p>
				The default interface values in the configuration can be changed to IPv6 addresses. For example, the below management CLI command sets the <code class="literal">management</code> interface to the IPv6 loopback address (<code class="literal">::1</code>).
			</p><pre class="screen">/interface=management:write-attribute(name=inet-address,value="${jboss.bind.address.management:[::1]}")</pre><p>
				The following example shows how the XML configuration may look after running the above command.
			</p><pre class="programlisting">&lt;interfaces&gt;
    &lt;interface name="management"&gt;
        &lt;inet-address value="${jboss.bind.address.management:[::1]}"/&gt;
    &lt;/interface&gt;
    ....
&lt;/interfaces&gt;</pre></div></div></body></html>