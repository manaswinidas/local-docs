<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 21. JavaServer Faces (JSF) Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="javaserver_faces_jsf_configuration"/>Chapter 21. JavaServer Faces (JSF) Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="multi_jsf_implementation_overview"/>Multi-JSF Implementation of JavaServer Faces</h1></div></div></div><p>
				The JavaServer Faces (JSF) subsystem allows you to install multiple JSF implementations on the same JBoss EAP server instance. In particular, you can install any version of Sun Mojarra or Apache MyFaces that implements JSF specification 2.1, or later.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="install_jsf_implementation"/>Installing a JSF Implementation</h2></div></div></div><p>
					The following procedure describes how to manually install a new JSF implementation and make it the default implementation.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							<a class="link" href="javaserver_faces_jsf_configuration.html#add_jsf_impl" title="Add the JSF Implementation JAR File">Add the JSF implementation JAR file</a>.
						</li><li class="listitem">
							<a class="link" href="javaserver_faces_jsf_configuration.html#add_jsf_api" title="Add the JSF API JAR File">Add the JSF API JAR file</a>.
						</li><li class="listitem">
							<a class="link" href="javaserver_faces_jsf_configuration.html#add_jsf_injection" title="Add the JSF Injection JAR File">Add the JSF injection JAR file</a>.
						</li><li class="listitem">
							<a class="link" href="javaserver_faces_jsf_configuration.html#add_digester_myfaces" title="Add the commons-digester JAR File for MyFaces">Add the <code class="literal">commons-digester</code> JAR file if you are installing MyFaces</a>.
						</li><li class="listitem">
							<a class="link" href="javaserver_faces_jsf_configuration.html#set_default_jsf" title="Set the Default JSF Implementation">Set the default JSF implementation</a>.
						</li></ol></div><h4><a id="add_jsf_impl"/>Add the JSF Implementation JAR File</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the appropriate directory structure in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/</code> directory for the JSF implementation:
						</p><pre class="screen">$ cd <span class="emphasis"><em>EAP_HOME</em></span>/modules/
$ mkdir -p com/sun/jsf-impl/<span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								For example, replace <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span></code> with <code class="literal">mojarra-2.2.11</code> for Mojarra 2.2.11.
							</p></div></li><li class="listitem">
							Copy the JSF implementation JAR file to the <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span>/</code> subdirectory.
						</li><li class="listitem">
							In the <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME-JSF_VERSION</em></span>/</code> subdirectory, create a <code class="literal">module.xml</code> file similar to this <a class="link" href="reference_material.html#jsf_impl_mojarra" title="Example: Mojarra JSF Implementation JAR module.xml">Mojarra template</a> or this <a class="link" href="reference_material.html#jsf_impl_myfaces" title="Example: MyFaces JSF Implementation JAR module.xml">MyFaces template</a>. If you use a template, be sure to use appropriate values for the replaceable variables noted.
						</li></ol></div><h4><a id="add_jsf_api"/>Add the JSF API JAR File</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the appropriate directory structure in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/</code> directory for the JSF implementation:
						</p><pre class="screen">$ cd <span class="emphasis"><em>EAP_HOME</em></span>/modules/
$ mkdir -p javax/faces/api/<span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span></pre></li><li class="listitem">
							Copy the JSF API JAR file to the <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span>/</code> subdirectory.
						</li><li class="listitem">
							In the <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME-JSF_VERSION</em></span>/</code> subdirectory, create a <code class="literal">module.xml</code> file similar to this <a class="link" href="reference_material.html#jsf_api_mojarra" title="Example: Mojarra JSF API JAR module.xml">Mojarra template</a> or this <a class="link" href="reference_material.html#jsf_api_myfaces" title="Example: MyFaces JSF API JAR module.xml">MyFaces template</a>. If you use a template, be sure to use appropriate values for the replaceable variables noted.
						</li></ol></div><h4><a id="add_jsf_injection"/>Add the JSF Injection JAR File</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the appropriate directory structure in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/</code> directory for the JSF implementation:
						</p><pre class="screen">$ cd <span class="emphasis"><em>EAP_HOME</em></span>/modules/
$ mkdir -p org/jboss/as/jsf-injection/<span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span></pre></li><li class="listitem">
							Copy the <code class="literal">wildfly-jsf-injection</code> and <code class="literal">weld-core-jsf</code> JAR files from <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/system/layers/base/org/jboss/as/jsf-injection/main/</code> to the <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span>/</code> subdirectory.
						</li><li class="listitem">
							In the <code class="literal"><span class="emphasis"><em>JSF_IMPL_NAME-JSF_VERSION</em></span>/</code> subdirectory, create a <code class="literal">module.xml</code> file similar to this <a class="link" href="reference_material.html#jsf_injection_mojarra" title="Example: Mojarra JSF Injection JAR module.xml">Mojarra template</a> or this <a class="link" href="reference_material.html#jsf_injection_myfaces" title="Example: MyFaces JSF Injection JAR module.xml">MyFaces template</a>. If you use a template, be sure to use appropriate values for the replaceable variables noted.
						</li></ol></div><h4><a id="add_digester_myfaces"/>Add the commons-digester JAR File for MyFaces</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the appropriate directory structure in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/modules/</code> directory for the <code class="literal">commons-digester</code> JAR:
						</p><pre class="screen">$ cd <span class="emphasis"><em>EAP_HOME</em></span>/modules/
$ mkdir -p org/apache/commons/digester/main</pre></li><li class="listitem">
							Download the <a class="link" href="http://search.maven.org/remotecontent?filepath=commons-digester/commons-digester/1.8/commons-digester-1.8.jar"><code class="literal">commons-digester</code></a> JAR file and copy it to the <code class="literal">main/</code> subdirectory.
						</li><li class="listitem">
							In the <code class="literal">main/</code> subdirectory, create a <code class="literal">module.xml</code> file similar to this <a class="link" href="reference_material.html#jsf_commons_digester_myfaces" title="Example: MyFaces commons-digester JAR module.xml">template</a>. If you use the template, be sure to use appropriate values for the replaceable variables noted.
						</li></ol></div><h4><a id="set_default_jsf"/>Set the Default JSF Implementation</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Run the following management CLI command to set the new JSF implementation as the default implementation:
						</p><pre class="screen">/subsystem=jsf:write-attribute(name=default-jsf-impl-slot,value=<span class="emphasis"><em>JSF_IMPL_NAME</em></span>-<span class="emphasis"><em>JSF_VERSION</em></span>)</pre></li><li class="listitem">
							Restart the JBoss EAP server for the changes to take effect.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="multi_jsf_implementation_support"/>Multi-JSF Implementation Support</h2></div></div></div><p>
					JBoss EAP 7.2 ships with a single JSF implementation, a <a class="link" href="https://jcp.org/en/jsr/detail?id=372">JSF 2.3</a> implementation based on Mojarra.
				</p><p>
					Multi-JSF allows the installation of multiple JSF implementations and versions on the same JBoss EAP server. The goal is to allow the use of any of the JSF implementations, MyFaces or Mojarra, and any version of those implementations from JSF 2.1 and beyond. Multi-JSF provides an implementation that is fully integrated with the container, which allows more efficient annotation processing, lifecycle handling, and other integration advantages.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="working_of_the_multi_jsf_implementation"/>Working of the Multi-JSF Implementation</h3></div></div></div><p>
						The way multi-JSF works is that for each JSF version, a new slot is created in the modules path under <code class="literal">com.sun.jsf-impl</code>, <code class="literal">javax.faces.api</code>, and <code class="literal">org.jboss.as.jsf-injection</code>. When the <code class="literal">jsf</code> subsystem is started, it scans the module path to find all the installed JSF implementations. When the <code class="literal">jsf</code> subsystem deploys a web application containing the specified context parameter, it adds the slotted modules to the deployment.
					</p><p>
						For example, to indicate that the JSF application should use MyFaces 2.2.12, assuming MyFaces 2.2.12 has been installed on the server, the following context parameter must be added:
					</p><pre class="programlisting">&lt;context-param&gt;
   &lt;param-name&gt;org.jboss.jbossfaces.<span class="emphasis"><em>JSF_CONFIG_NAME</em></span>&lt;/param-name&gt;
   &lt;param-value&gt;myfaces-2.2.12&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="changing_the_default_jsf_implementation"/>Changing the Default JSF Implementation</h3></div></div></div><p>
						The multi-JSF feature includes the <code class="literal">default-jsf-impl-slot</code> attribute in the <code class="literal">jsf</code> subsystem. This attribute allows you to change the default JSF implementation, as described in the following procedure:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Use the <code class="literal">write-attribute</code> command to set the value of the <code class="literal">default-jsf-impl-slot</code> attribute to one of the active JSF implementations:
							</p><pre class="screen">/subsystem=jsf:write-attribute(name=default-jsf-impl-slot,value=<span class="emphasis"><em>JSF_IMPLEMENTATION</em></span>)</pre></li><li class="listitem"><p class="simpara">
								Restart the JBoss EAP server for the change to take effect.
							</p><pre class="screen">reload</pre></li></ol></div><p>
						To see which JSF implementations are installed, you can execute the <code class="literal">list-active-jsf-impls</code> operation.
					</p><pre class="screen">/subsystem=jsf:list-active-jsf-impls
{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "myfaces-2.1.12",
        "mojarra-2.2.0-m05",
        "main"
    ]
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="disallow_doctype_declarations"/>Disallowing DOCTYPE Declarations</h1></div></div></div><p>
				You can use the following management CLI commands to disallow <code class="literal">DOCTYPE</code> declarations in JSF deployments:
			</p><pre class="screen">/subsystem=jsf:write-attribute(name=disallow-doctype-decl,value=true)
reload</pre><p>
				You can override this setting for a particular JSF deployment by adding the <code class="literal">com.sun.faces.disallowDoctypeDecl</code> context parameter to the deployment’s <code class="literal">web.xml</code> file:
			</p><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;com.sun.faces.disallowDoctypeDecl&lt;/param-name&gt;
  &lt;param-value&gt;false&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div></div></body></html>