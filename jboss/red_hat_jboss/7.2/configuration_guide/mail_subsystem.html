<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 10. Mail Subsystem</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="mail_subsystem"/>Chapter 10. Mail Subsystem</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_the_mail_subsystem"/>Configuring the Mail Subsystem</h1></div></div></div><p>
				The <code class="literal">mail</code> subsystem allows you to configure mail sessions in JBoss EAP and then inject those sessions into applications using JNDI. It also supports configuration using the Java EE <code class="literal">@MailSessionDefinition</code> and <code class="literal">@MailSessionDefinitions</code> annotations.
			</p><h3><a id="configuring_smtp_server_for_use_in_an_application"/>Configuring SMTP server for use in an application</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Configure the SMTP server and the outbound socket binding using the following CLI commands, for example:
					</p><pre class="screen">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=my-smtp:add(host=localhost, port=25)</pre><pre class="screen">/subsystem=mail/mail-session=mySession:add(jndi-name=java:jboss/mail/MySession)</pre><pre class="screen">/subsystem=mail/mail-session=mySession/server=smtp:add(outbound-socket-binding-ref=my-smtp, username=user, password=pass, tls=true)</pre></li><li class="listitem"><p class="simpara">
						Call the configured mail session within an application
					</p><pre class="programlisting">@Resource(lookup="java:jboss/mail/MySession")
private Session session;</pre></li></ol></div><p>
				For a full list of the attributes available for configuring mail sessions and servers, see <a class="link" href="reference_material.html#mail_attributes" title="Mail Subsystem Attributes">Mail Subsystem Attributes</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_custom_transports"/>Configuring Custom Transports</h1></div></div></div><p>
				When using a standard mail server, such as POP3 or IMAP, the mail server has a set of attributes that can be defined. Some of these attributes are mandatory. The most important of these is the <code class="literal">outbound-socket-binding-ref</code>, which is a reference to the outbound mail socket binding and is defined with a host address and port number.
			</p><p>
				Defining the <code class="literal">outbound-socket-binding-ref</code> may not be the most effective solution for users who have their host configuration using multiple hosts for load balancing purposes. Standard JavaMail does not support host configuration using multiple hosts for load balancing. Therefore, users who have this configuration using multiple hosts are required to implement custom mail transports. These custom mail transports do not require the <code class="literal">outbound-socket-binding-ref</code> and allow custom host property formats.
			</p><p>
				You can configure custom mail transports from the management CLI.
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Add a new mail session and specify the JNDI name.
					</p><pre class="screen">/subsystem=mail/mail-session=mySession:add(jndi-name=java:jboss/mail/MySession)</pre></li><li class="listitem"><p class="simpara">
						Add an outbound socket binding and specify the host and port.
					</p><pre class="screen">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=my-smtp-binding:add(host=localhost, port=25)</pre></li><li class="listitem"><p class="simpara">
						Add an SMTP server and specify the outbound socket binding, username, and password.
					</p><pre class="screen">/subsystem=mail/mail-session=mySession/server=smtp:add(outbound-socket-binding-ref=my-smtp-binding, username=user, password=pass, tls=true)</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					You can configure a POP3 or IMAP server using similar steps.
				</p><div class="title"><strong>POP3 Server</strong></div><p>
						
</p><pre class="screen">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=my-pop3-binding:add(host=localhost, port=110)
/subsystem=mail/mail-session=mySession/server=pop3:add(outbound-socket-binding-ref=my-pop3-binding, username=user, password=pass)</pre><p>

					</p><div class="title"><strong>IMAP Server</strong></div><p>
						
</p><pre class="screen">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=my-imap-binding:add(host=localhost, port=143)
/subsystem=mail/mail-session=mySession/server=imap:add(outbound-socket-binding-ref=my-imap-binding, username=user, password=pass)</pre><p>

					</p></div><p>
				To use a custom server, create a custom mail server without an outbound socket binding. You can specify the host information in the properties definition of the custom mail server. For example:
			</p><pre class="screen">/subsystem=mail/mail-session=mySession/custom=myCustomServer:add(username=user,password=pass, properties={"host" =&gt; "myhost", "my-property" =&gt;"value"})</pre><p>
				If you define a custom protocol, any property name that includes a period (<code class="literal">.</code>) is considered a fully-qualified name and is passed directly. Any other format, such as <code class="literal">my-property</code>, is translated in the following format: <code class="literal">mail.server-name.my-property</code>.
			</p><p>
				The following XML is an example mail configuration that includes custom servers.
			</p><pre class="programlisting">&lt;subsystem xmlns="urn:jboss:domain:mail:3.0"&gt;
   &lt;mail-session name="default" jndi-name="java:jboss/mail/Default"&gt;
        &lt;smtp-server outbound-socket-binding-ref="mail-smtp"/&gt;
   &lt;/mail-session&gt;
    &lt;mail-session name="myMail" from="user.name@domain.org" jndi-name="java:/Mail"&gt;
        &lt;smtp-server password="password" username="user" tls="true" outbound-socket-binding-ref="mail-smtp"/&gt;
        &lt;pop3-server outbound-socket-binding-ref="mail-pop3"/&gt;
        &lt;imap-server password="password" username="nobody" outbound-socket-binding-ref="mail-imap"/&gt;
    &lt;/mail-session&gt;
    &lt;mail-session name="custom" jndi-name="java:jboss/mail/Custom" debug="true"&gt;
        &lt;custom-server name="smtp" password="password" username="username"&gt;
            &lt;property name="host" value="mail.example.com"/&gt;
        &lt;/custom-server&gt;
    &lt;/mail-session&gt;
    &lt;mail-session name="custom2" jndi-name="java:jboss/mail/Custom2" debug="true"&gt;
        &lt;custom-server name="pop3" outbound-socket-binding-ref="mail-pop3"&gt;
            &lt;property name="custom-prop" value="some-custom-prop-value"/&gt;
        &lt;/custom-server&gt;
    &lt;/mail-session&gt;
&lt;/subsystem&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="mail_subsystem_cred_store"/>Use a Credential Store for Passwords</h1></div></div></div><p>
				In addition to providing clear-text passwords in the <code class="literal">mail</code> subsystem, you can also use a credential store to provide passwords. The <code class="literal">elytron</code> subsystem provides the ability to create credential stores to securely house and use your passwords throughout JBoss EAP. You can find more details on creating and using credential stores in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/how_to_configure_server_security/#credential_store">Credential Store</a> section of <span class="emphasis"><em>How to Configure Server Security</em></span>.
			</p><div class="title"><strong>Using a Credential Store Using the Management CLI</strong></div><p>
					
</p><pre class="screen">/subsystem=mail/mail-session=mySession/server=smtp:add(outbound-socket-binding-ref=my-smtp-binding, username=user, credential-reference={store=exampleCS, alias=mail-session-pw}, tls=true)</pre><p>

				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					The following is an example of how to specify a <code class="literal">credential-reference</code> attribute that uses a clear-text password.
				</p><pre class="screen">credential-reference={clear-text="MASK-Ewcyuqd/nP9;A1B2C3D4;351"}</pre></div><div class="orderedlist"><p class="title"><strong>Using a Credential Store Using the Management Console</strong></p><ol class="orderedlist"><li class="listitem">
						Access the management console. For more information, see the <a class="link" href="jboss_eap_management.html#management_console_overview" title="Management Console">Management Console</a>.
					</li><li class="listitem">
						Navigate to <span class="strong"><strong>Configuration</strong></span> → <span class="strong"><strong>Subsystems</strong></span> → <span class="strong"><strong>Mail</strong></span>.
					</li><li class="listitem">
						Select the appropriate mail session and click <span class="strong"><strong>View</strong></span>.
					</li><li class="listitem">
						Select <span class="strong"><strong>Server</strong></span> and choose the appropriate mail session server. You can configure the credential reference in the <span class="strong"><strong>Credential Reference</strong></span> tab and edit other attributes in the <span class="strong"><strong>Attributes</strong></span> tab.
					</li></ol></div></div></div></body></html>