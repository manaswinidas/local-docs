<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. Hibernate Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="hibernate_configuration"/>Chapter 2. Hibernate Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration"/>Hibernate Configuration</h1></div></div></div><p>
				The configuration for entity managers both inside an application server and in a standalone application reside in a persistence archive. A persistence archive is a JAR file which must define a <code class="literal">persistence.xml</code> file that resides in the <code class="literal">META-INF/</code> folder.
			</p><p>
				You can connect to the database using the <code class="literal">persistence.xml</code> file. There are two ways of doing this:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Specifying a data source which is configured in the <code class="literal">datasources</code> subsystem in JBoss EAP.
					</p><p class="simpara">
						The <code class="literal">jta-data-source</code> points to the JNDI name of the data source this persistence unit maps to. The <code class="literal">java:jboss/datasources/ExampleDS</code> here points to the <code class="literal">H2 DB</code> embedded in the JBoss EAP.
					</p><div class="title"><strong>Example of <code class="literal">object-relational-mapping</code> in the <code class="literal">persistence.xml</code> File</strong></div><p>
							
</p><pre class="programlisting">&lt;persistence&gt;
   &lt;persistence-unit name="myapp"&gt;
      &lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;
      &lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;
      &lt;properties&gt;
         ... ...
      &lt;/properties&gt;
   &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre><p>

						</p></li><li class="listitem"><p class="simpara">
						Explicitly configuring the <code class="literal">persistence.xml</code> file by specifying the connection properties.
					</p><div class="title"><strong>Example of Specifying Connection Properties in the <code class="literal">persistence.xml</code> file</strong></div><p>
							
</p><pre class="programlisting">&lt;property name="javax.persistence.jdbc.driver" value="org.hsqldb.jdbcDriver"/&gt;
&lt;property name="javax.persistence.jdbc.user" value="sa"/&gt;
&lt;property name="javax.persistence.jdbc.password" value=""/&gt;
&lt;property name="javax.persistence.jdbc.url" value="jdbc:hsqldb:."/&gt;</pre><p>

						</p><p class="simpara">
						For the complete list of connection properties, see <a class="link" href="reference_material.html#configurable_connection_properties" title="Table A.1. Connection Properties Configurable in the persistence.xml File">Connection Properties Configurable in the <code class="literal">persistence.xml</code> File</a>.
					</p></li></ul></div><p>
				There are a number of properties that control the behavior of Hibernate at runtime. All are optional and have reasonable default values. These Hibernate properties are all used in the <code class="literal">persistence.xml</code> file. For the complete list of all configurable Hibernate properties, see <a class="link" href="reference_material.html#hibernate_properties" title="Hibernate Properties">Hibernate Properties</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="second_level_caches"/>Second-Level Caches</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="about_second_level_caches"/>About Second-level Caches</h2></div></div></div><p>
					A second-level cache is a local data store that holds information persisted outside the application session. The cache is managed by the persistence provider, improving runtime by keeping the data separate from the application.
				</p><p>
					JBoss EAP supports caching for the following purposes:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Web Session Clustering
						</li><li class="listitem">
							Stateful Session Bean Clustering
						</li><li class="listitem">
							SSO Clustering
						</li><li class="listitem">
							Hibernate/JPA Second-level Cache
						</li></ul></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Each cache container defines a <code class="literal">repl</code> and a <code class="literal">dist</code> cache. These caches should not be used directly by user applications.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configure_a_second_level_cache_for_hibernate"/>Configure a Second-level Cache for Hibernate</h2></div></div></div><p>
					The configuration of Infinispan to act as the second-level cache for Hibernate can be done in two ways:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							It is recommended to configure the second-level cache <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/development_guide/#configure_second_level_cache_persistence_unit">through JPA applications, using the <code class="literal">persistence.xml</code> file</a>, as explained in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>.
						</li><li class="listitem">
							Alternatively, you can configure the second-level cache through Hibernate native applications, using the <code class="literal">hibernate.cfg.xml</code> file, as explained below.
						</li></ul></div><h4><a id="configuring_a_second_level_cache_for_hibernate_using_hibernate_native_applications"/>Configuring a Second-level Cache for Hibernate Using Hibernate Native Applications</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Create the <code class="literal">hibernate.cfg.xml</code> file in the deployment’s class path.
						</li><li class="listitem"><p class="simpara">
							Add the following XML to the <code class="literal">hibernate.cfg.xml</code> file. The XML needs to be within the <code class="literal">&lt;session-factory&gt;</code> tag:
						</p><pre class="programlisting">&lt;property name="hibernate.cache.use_second_level_cache"&gt;true&lt;/property&gt;
&lt;property name="hibernate.cache.use_query_cache"&gt;true&lt;/property&gt;
&lt;property name="hibernate.cache.region.factory_class"&gt;org.jboss.as.jpa.hibernate5.infinispan.InfinispanRegionFactory&lt;/property&gt;</pre></li><li class="listitem"><p class="simpara">
							In order to use the Hibernate native APIs within your application, you must add the following dependencies to the <code class="literal">MANIFEST.MF</code> file:
						</p><pre class="screen">Dependencies: org.infinispan,org.hibernate</pre></li></ol></div></div></div></div></body></html>