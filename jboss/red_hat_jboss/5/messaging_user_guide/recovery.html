<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 7. JBoss Messaging XA Recovery Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="recovery">
      ⁠</a>Chapter 7. JBoss Messaging XA Recovery Configuration</h1></div></div></div><div class="para">
		This section describes how to configure JBoss Transactions to handle XA recovery for JBoss Messaging resources in JBoss Enterprise Application Platform.
	</div><div class="para">
		The JBoss Transactions Recovery Manager can be configured to continually poll for and recover JBoss Messaging XA resources. This provides a high level of transaction durability.
	</div><div class="para">
		To enable JBoss Transactions Recovery Manager, add a line to <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/jbossts-properties.xml</code>. The following code snippet includes the line required:
	</div><pre class="programlisting">
&lt;properties depends="arjuna" name="jta"&gt;
  &lt;!--
  Support subtransactions in the JTA layer?
  Default is NO.
  --&gt;
  &lt;property name="com.arjuna.ats.jta.supportSubtransactions" value="NO"/&gt;
  &lt;property name="com.arjuna.ats.jta.jtaTMImplementation"
      value="com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple"/&gt;
  &lt;property name="com.arjuna.ats.jta.jtaUTImplementation"
      value="com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple"/&gt;      
  &lt;!--
      *** Add this line to enable recovery for JMS resources using DefaultJMSProvider ***
  --&gt;
  &lt;property name="com.arjuna.ats.jta.recovery.XAResourceRecovery.JBMESSAGING1"
      value="org.jboss.jms.server.recovery.MessagingXAResourceRecovery;java:/DefaultJMSProvider"/&gt;

&lt;/properties&gt;
</pre><div class="para">
		Here, the Recovery Manager attempts to recover JMS resources via the JMS Provider Loader, <code class="literal">DefaultJMSProvider</code>.
	</div><div class="para">
		<code class="literal">DefaultJMSProvider</code> ships with JBoss Enterprise Application Platform. It is defined in <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/jms-ds.xml</code> (or, in a clustered environment, <code class="filename">hajndi-jms-ds.xml</code>). To perform recovery with a different JMS provider loader (for example, one that corresponds with a remote JMS Provider), add another line to the properties file and specify your remote provider instead of <code class="literal">DefaultJMSProvider</code>. Your provider's name should be listed in its managed bean configuration file.
	</div><div class="para">
		Each provider requires a unique name, for example, <code class="literal">com.arjuna.ats.jta.recovery.XAResourceRecovery.JBMESSAGING1</code>, <code class="literal">com.arjuna.ats.jta.recovery.XAResourceRecovery.JBMESSAGING2</code>, etc.
	</div><div class="para">
		Recovery should work with any JMS provider that implements recoverable XAResources (that is, it properly implements <code class="literal">XAResource.recover()</code>).
	</div><div class="para">
		For the Recovery Manager to recover from any node of the cluster, you must add a line in <code class="filename">hajndi-jms-ds.xml</code> for every node of the cluster.
	</div></div></body></html>