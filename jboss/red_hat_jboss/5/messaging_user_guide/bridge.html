<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 8. JBoss Messaging Message Bridge Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="bridge">
      ⁠</a>Chapter 8. JBoss Messaging Message Bridge Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Message_Bridge_Overview">
      ⁠</a>8.1. Message Bridge Overview</h1></div></div></div><div class="para">
			JBoss Messaging includes a fully functional message bridge.
		</div><div class="para">
			The bridge consumes messages from a source queue or topic and sends them to a target queue or topic, typically on a different server. The source and target servers do not need to be in the same cluster, so bridging is a reliable method of sending messages from one cluster to another (across a WAN, for example) and where the connection may be unreliable.
		</div><div class="para">
			A bridge is deployed as a managed bean within any JBoss Enterprise Application Platform instance. To deploy, add the managed bean descriptor into the <code class="filename">deploy</code> directory of an Enterprise Application Platform configuration that contains JBoss Messaging.
		</div><div class="para">
			The example in <code class="filename">$JBOSS_HOME/docs/examples/jboss-messaging-examples/bridge/</code> demonstrates a simple bridge deployed in JBoss Enterprise Application Platform and moving messages from the source to the target destination.
		</div><div class="para">
			The bridge can also be used to retrieve messages from other non-JBoss Messaging JMS servers as long as they are JMS 1.1 compliant.
		</div><div class="para">
			The bridge has built-in failure recovery; if the source or target server connection is lost, the bridge will attempt to reconnect to the source or target until it comes back online, at which point normal operation will resume.
		</div><div class="para">
			The bridge can be configured to consume messages matching a particular JMS selector.
		</div><div class="para">
			It can be configured to consume from a queue or a topic. When the bridge consumes from a topic, it can be configured to consume with a non-durable or a durable subscription.
		</div><div class="para">
			The bridge can be configured to handle messages with one of three <em class="firstterm">quality of service</em> (QoS) levels:
		</div><div class="variablelist"><p class="title"><strong>Bridge QoS Levels</strong></p><dl class="variablelist"><dt><span class="term"> <code class="literal">QOS_AT_MOST_ONCE</code> </span></dt><dd><div class="para">
						This mode specifies that messages will arrive at the destination once at the most. Messages are consumed from the source and acknowledged before they are sent to the destination. Messages can be lost if failure occurs between the message leaving the source and arriving at the destination. Messages will therefore be delivered once at most.
					</div><div class="para">
						This mode is available for both persistent and non-persistent messages.
					</div></dd><dt><span class="term"> <code class="literal">QOS_DUPLICATES_OK</code> </span></dt><dd><div class="para">
						This mode specifies that messages are consumed from the source and acknowledged after they have been successfully sent to the destination. If failure occurs between a message arriving, and being acknowledged by the destination, that message is sent a second time when the system recovers.
					</div><div class="para">
						This mode is available for both persistent and non-persistent messages.
					</div></dd><dt><span class="term"> <code class="literal">QOS_ONCE_AND_ONLY_ONCE</code> </span></dt><dd><div class="para">
						This mode specifies that messages will arrive exactly once. When the message source and destination are on the same JBoss Messaging server instance, the message can be sent and received in the same local transaction.
					</div><div class="para">
						If the source and destination are on different servers, you can implement message high durability by using a JTA transaction controlled by JBoss Transactions JTA implementation. If JTA is required, both connection factories must be <code class="literal">XAConnectionFactory</code> implementations.
					</div><div class="para">
						This mode is only available for persistent messages.
					</div><div class="para">
						This mode requires logging on both the transaction manager and the resource side to support recovery. If you require this level of QOS, you must enable XA Recovery with JBoss Transactions.
					</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Alternative Methods</strong></p></div><div class="admonition"><div class="para">
				You may be able to apply <span class="emphasis"><em>once and only once</em></span> semantics to a specific application, without setting <code class="literal">QOS_ONCE_AND_ONLY_ONCE</code>. Set <code class="literal">QOS_DUPLICATES_OK</code> mode, and then check for and discard duplicate messages at the destination.
			</div><div class="para">
				You can implement <code class="literal">QOS_ONCE_AND_ONLY_ONCE</code> behavior at the application level by maintaining a cache of received message IDs on disk and comparing received messages to this cache. Because the cache would only be valid for a certain period of time, this approach is not infallible, but can be a useful alternative depending on your application.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="bridge.deployment">
      ⁠</a>8.2. Bridge deployment</h1></div></div></div><div class="para">
			You can deploy a message bridge by adding a managed bean descriptor into the <code class="filename">deploy</code> directory of the JBoss Enterprise Application Platform installation that contains JBoss Messaging.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="bridge.configuration">
      ⁠</a>8.3. Bridge Configuration</h1></div></div></div><div class="para">
			The following code is an example configuration of the message bridge, showing all attributes. Some attributes have been commented out for this configuration, since not all attributes should be specified at once.
		</div><div class="example"><a id="idm140038199215456">
      ⁠</a><p class="title"><strong>Example 8.1. Message Bridge Configuration</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.bridge.BridgeService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=Bridge,name=TestBridge"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/Bridge-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The JMS provider loader that is used to lookup the source </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       destination </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"SourceProviderLoader"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  jboss.messaging:service=JMSProviderLoader,name=JMSProvider<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The JMS provider loader that is used to lookup the target </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       destination </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"TargetProviderLoader"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  jboss.messaging:service=JMSProviderLoader,name=JMSProvider<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>    
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The JNDI lookup for the source destination --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SourceDestinationLookup"</span><span xmlns="" class="perl_Keyword">&gt;</span>/queue/A<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The JNDI lookup for the target destination --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TargetDestinationLookup"</span><span xmlns="" class="perl_Keyword">&gt;</span>/queue/B<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The username to use for the source connection </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="SourceUsername"&gt;bob&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The password to use for the source connection</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="SourcePassword"&gt;BobSecur3&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The username to use for the target connection</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="TargetUsername"&gt;mary&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The password to use for the target connection</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="TargetPassword"&gt;MaryS3cur3&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Optional: The Quality Of Service mode to use, one of:</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    QOS_AT_MOST_ONCE = 0;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    QOS_DUPLICATES_OK = 1;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    QOS_ONCE_AND_ONLY_ONCE = 2; </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"QualityOfServiceMode"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- JMS selector to use for consuming messages from the source</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="Selector"&gt;specify jms selector here&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The maximum number of messages to consume from the source</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       before sending to the target </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MaxBatchSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>5<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>     
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The maximum time to wait (in ms) before sending a batch to the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       target even if MaxBatchSize is not exceeded. -1 means wait forever </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MaxBatchTime"</span><span xmlns="" class="perl_Keyword">&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If consuming from a durable subscription this is the subscription</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       name</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;attribute name="SubName"&gt;mysub&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If consuming from a durable subscription this is the client ID to</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       use</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;attribute name="ClientID"&gt;myClientID&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The number of ms to wait between connection retrues in the event</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       connections to source or target fail </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FailureRetryInterval"</span><span xmlns="" class="perl_Keyword">&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>  
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The maximum number of connection retries to make in case of failure,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       before giving up -1 means try forever</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MaxRetries"</span><span xmlns="" class="perl_Keyword">&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If true then the message ID of the message before bridging will be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       added as a header to the message so it is available to the </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       receiver. Can then be sent as correlation ID to correlate in a </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       distributed request-response </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"AddMessageIDInHeader"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre></div></div><div class="variablelist"><p class="title"><strong>Message Bridge Configuration Attributes</strong></p><dl class="variablelist"><dt><span class="term">SourceProviderLoader, </span><span class="term">TargetProvider Loader</span></dt><dd><div class="para">
						The <code class="literal">JMSProviderLoader</code> managed bean is used by the bridge to look up the source connection factory and source destination. By default, JBoss Enterprise Application Platform ships with one <code class="literal">JMSProviderLoader</code>, which is deployed in the <code class="filename">$JBOSS_HOME/server/$PROFILE/deploy/messaging/jms-ds.xml</code> file, and serves as the default local <code class="literal">JMSProviderLoader</code>. For a clustered configuration, <code class="filename">hajndi-jms-ds.xml</code> performs the same role.
					</div><div class="para">
						If your source or target destination is on a different server, or corresponds to a non-JBoss JMS Provider, you can deploy another <code class="literal">JMSProviderLoader</code> managed bean instance that the bridge can use to contact the destination on the remote JMS Provider.
					</div><div class="para">
						To use <code class="literal">QOS_ONCE_AND_ONLY_ONCE</code> delivery with a remote non-JBoss Messaging source or target, the remote JMS Provider must provide a fully-functional JMS XA resource implementation that works remotely from the server.
					</div></dd><dt><span class="term">SourceDestinationLookup</span></dt><dd><div class="para">
						The full JNDI lookup for the source destination, via the <code class="literal">SourceProviderLoader</code>, such as <code class="filename">/queue/mySourceQueue</code>.
					</div></dd><dt><span class="term">TargetDestinationLookup</span></dt><dd><div class="para">
						The full JNDI lookup for the target destination, via the <code class="literal">TargetProviderLocator</code>, such as <code class="filename">/topic/myTargetTopic</code>.
					</div></dd><dt><span class="term">SourceUsername</span></dt><dd><div class="para">
						An optional attribute that specifies the username used when creating the source connection.
					</div></dd><dt><span class="term">SourcePassword</span></dt><dd><div class="para">
						An optional attribute that specifies the password used when creating the source connection.
					</div></dd><dt><span class="term">TargetUsername</span></dt><dd><div class="para">
						An optional attribute that specifies the username used when creating the target connection.
					</div></dd><dt><span class="term">TargetPassword</span></dt><dd><div class="para">
						An optional attribute that specifies the password used when creating the target connection.
					</div></dd><dt><span class="term">QualityOfServiceMode</span></dt><dd><div class="para">
						An integer representing the desired <span class="emphasis"><em>quality of service</em></span> mode. The possible values are:
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">0</code> to represent <code class="literal">QOS_AT_MOST_ONCE</code>
							</div></li><li class="listitem"><div class="para">
								<code class="literal">1</code> to represent <code class="literal">QOS_DUPLICATES_OK</code>
							</div></li><li class="listitem"><div class="para">
								<code class="literal">2</code> to represent <code class="literal">QOS_ONCE_AND_ONLY_ONCE</code>
							</div></li></ul></div><div class="para">
						See <a class="xref" href="bridge.html#sect-Message_Bridge_Overview">Section 8.1, “Message Bridge Overview”</a> for a complete explanation of these modes.
					</div></dd><dt><span class="term">Selector</span></dt><dd><div class="para">
						An optional attribute that lets you provide a JMS selector expression when consuming messages from a source destination. Only messages that match the selector expression are bridged from the source to the target destination. The selector expression must follow the JMS selector syntax, specified here: <a href="http://java.sun.com/j2ee/1.4/docs/api/javax/jms/Message.html">http://java.sun.com/j2ee/1.4/docs/api/javax/jms/Message.html</a>.
					</div><div class="para">
						For optimal performance, apply source topic subscription selectors to source queue consumers.
					</div></dd><dt><span class="term">MaxBatchSize</span></dt><dd><div class="para">
						Specifies the maximum number of messages to consume from the source destination before sending a message batch to the target destination. Its value must be greater than or equal to <code class="literal">1</code>.
					</div></dd><dt><span class="term">MaxBatchTime</span></dt><dd><div class="para">
						Specifies the longest period (in milliseconds) to wait before sending a message batch to the target, even if the <code class="varname">MaxBatchSize</code> has not been reached. Its value must be either <code class="literal">-1</code> (wait forever) or greater than or equal to <code class="literal">1</code> to specify a time.
					</div></dd><dt><span class="term">SubName</span></dt><dd><div class="para">
						Represents the name of the durable subscription that will consume from the source destination topic.
					</div></dd><dt><span class="term">ClientID</span></dt><dd><div class="para">
						Represents the JMS client ID to use when creating or looking up the durable subscription that will consume from the source destination topic.
					</div></dd><dt><span class="term">FailureRetryInterval</span></dt><dd><div class="para">
						The period of time (in milliseconds) to wait between attempting to recreate the connection to the source or target server after failure is detected.
					</div></dd><dt><span class="term">MaxRetries</span></dt><dd><div class="para">
						The number of times to attempt to recreate the connection to the source or target server after failure is detected. The bridge will then stop attempting to recreate the connection. A value of <code class="literal">-1</code> means that the bridge will continue to attempt to reconnect forever.
					</div></dd><dt><span class="term">AddMessageIDInHeader</span></dt><dd><div class="para">
						When <code class="literal">true</code>, the original message ID is added to the <code class="literal">JBossMessage.JBOSS_MESSAGING_BRIDGE_MESSAGE_ID_LIST</code> header of the message being sent to the destination. If the message is bridged multiple times, each message ID is added to the header. This enables a distributed request-response pattern.
					</div></dd></dl></div></div></div></body></html>