<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 5. Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuration">
      ⁠</a>Chapter 5. Configuration</h1></div></div></div><div class="para">
		The Java Message Service (JMS) API specifies how a messaging client interacts with a messaging server. How messaging services such as message destinations and connection factories are defined and implemented depends on the JMS provider. JBoss Messaging has its own files for service configuration. 
	</div><div class="para">
		This chapter shows you how to configure various services available in JBoss Messaging that work together to provide JMS API-level services to client applications.
	</div><div class="para">
		JBoss Messaging configuration is divided between several configuration files. Depending on the type of service provided, configuration information is divided between <code class="filename">messaging-service.xml</code>, <code class="filename">remoting-bisocket-service.xml</code>, <code class="filename">&lt;your database type&gt;-persistence-service.xml</code>, <code class="filename">connection-factories-service.xml</code> and <code class="filename">destinations-service.xml</code>. These files can all be found in the <code class="filename">$JBOSS_HOME/server/$PROFILE/deploy/messaging</code> directory.
	</div><div class="para">
		AOP interceptor stacks can be configured in <code class="filename">aop-messaging-client.xml</code> (for client-side behavior) and <code class="filename">aop-messaging-server.xml</code> (for server-side behavior). There is usually no need to change these files, but some interceptors can be removed to improve performance if they are not required. Ensure that you have considered the security implications before removing the security interceptor.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.serverpeer">
      ⁠</a>5.1. Configuring the ServerPeer</h1></div></div></div><div class="para">
			The <code class="literal">ServerPeer</code> is the heart of the JBoss Messaging JMS facade. You can configure its behavior by altering <code class="filename">$JBOSS_HOME/server/$PROFILE/deploy/messaging/messaging-service.xml</code>.
		</div><div class="para">
			All JBoss Messaging services are based in the <code class="literal">ServerPeer</code>.
		</div><div class="para">
			An example of a Server Peer configuration is presented below. Note that not all values for the server peer's attributes are specified in the example
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ServerPeer MBean configuration</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    ============================== --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.ServerPeer"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=ServerPeer"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/ServerPeer-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The unique id of the server peer - in a cluster each node </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      MUST have a unique value - must be an integer--&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ServerPeerID"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    ${jboss.messaging.ServerPeerID:0}
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The default JNDI context to use for queues when they are </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      deployed without specifying one--&gt;</span> 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultQueueJNDIContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>/queue<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The default JNDI context to use for topics when they are </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      deployed without specifying one --&gt;</span> 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultTopicJNDIContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>/topic<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PostOffice"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=PostOffice
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The default Dead Letter Queue (DLQ) to use for destinations.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       This can be overridden on a per destinatin basis --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultDLQ"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging.destination:service=Queue,name=DLQ
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The default maximum number of times to attempt delivery of a </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      message before sending to the DLQ (if configured).</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      This can be overridden on a per destination basis--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultMaxDeliveryAttempts"</span><span xmlns="" class="perl_Keyword">&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The default Expiry Queue to use for destinations. This can </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      be overridden on a per destinatin basis--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultExpiryQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging.destination:service=Queue,name=ExpiryQueue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The default redelivery delay to impose. This can be overridden </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      on a per destination basis --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultRedeliveryDelay"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The periodicity of the message counter manager enquiring on </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      queues for statistics--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MessageCounterSamplePeriod"</span><span xmlns="" class="perl_Keyword">&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The maximum amount of time for a client to wait for failover </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      to start on the server side after it has detected failure--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FailoverStartTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>60000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The maximum amount of time for a client to wait for failover </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      to complete on the server side after it has detected failure--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FailoverCompleteTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>300000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"StrictTck"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The maximum number of days results to maintain in the message </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      counter history--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultMessageCounterHistoryDayLimit"</span><span xmlns="" class="perl_Keyword">&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--The name of the connection factory to use for creating </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      connections between nodes to pull messages--&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ClusterPullConnectionFactoryName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging.connectionfactory:service=ClusterPullConnectionFactory
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!--When redistributing messages in the cluster. Do we need to </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      preserve the order of messages received</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      by a particular consumer from a particular producer? --&gt;</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultPreserveOrdering"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Max. time to hold previously delivered messages back waiting for</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       clients to reconnect after failover --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"RecoverDeliveriesTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>300000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Set to true to enable message counters that can be viewed via JMX --&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"EnableMessageCounters"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The password used by the message sucker connections to create connections.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       THIS SHOULD ALWAYS BE CHANGED AT INSTALL TIME TO SECURE SYSTEM</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="SuckerPassword"&gt;&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The name of the server aspects configuration resource</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  &lt;attribute name="ServerAopConfig"&gt;aop/jboss-aop-messaging-server.xml&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The name of the client aspects configuration resource</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    &lt;attribute name="ClientAopConfig"&gt;aop/jboss-aop-messaging-client.xml&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"PersistenceManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=PersistenceManager
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"JMSUserManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=JMSUserManager
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.messaging:service=Connector,transport=bisocket<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"SecurityStore"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    proxy-type=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.SecurityStore"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jboss.messaging:service=SecurityStore
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-ServerPeer_Attributes">
      ⁠</a>5.2. ServerPeer attributes</h1></div></div></div><div class="para">
			This section discusses the <code class="literal">ServerPeer</code> managed bean attributes.
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <span class="property">StopServerPeerOnDBFailure</span> </span></dt><dd><div class="para">
						When set to <code class="literal">true</code>, the server will stop if a database error occurs - e.g. database connection is lost - allowing other nodes to continue work. The default value is <code class="literal">false</code>.
					</div></dd><dt><span class="term">ServerPeerID</span></dt><dd><div class="para">
						The unique identifier of the <code class="literal">ServerPeer</code>. Each node deployed must have a unique identifier, whether the nodes form a cluster or are linked by a message bridge. The identifier must be a valid integer.
					</div></dd><dt><span class="term">DefaultQueueJNDIContext</span></dt><dd><div class="para">
						The default JNDI context to be used when binding queues. The default value is <code class="literal">/queue</code>.
					</div></dd><dt><span class="term">DefaultTopicJNDIContext</span></dt><dd><div class="para">
						The default JNDI context to be used when binding topics. The default value is <code class="literal">/topic</code>.
					</div></dd><dt><span class="term">PostOffice</span></dt><dd><div class="para">
						The post office used by the <code class="literal">ServerPeer</code>. You will not normally need to edit this attribute. The post office routes messages to queues and maintains the mapping between queues and addresses.
					</div></dd><dt><span class="term">DefaultDLQ</span></dt><dd><div class="para">
						The default DLQ (Dead Letter Queue) that the server uses for destinations. You can override the DLQ on a per-destination basis. For more information about destinations, refer to <a class="xref" href="configuration.html#conf.destination">Section 5.9, “Configuring Destinations”</a>. A DLQ is a destination for messages that the server has failed to deliver more than a certain number of times. If the DLQ is not specified, the message will be removed after the maximum number of delivery attempts. You can specify a global default for the maximum number of delivery attempts with the <code class="varname">DefaultMaxDeliveryAttempts</code> attribute, or set the maximum individually on a per-destination basis.
					</div></dd><dt><span class="term">DefaultMaxDeliveryAttempts</span></dt><dd><div class="para">
						The global default for the maximum number of times delivery will be attempted for a message before the message is removed or sent to the DLQ, if configured. The default value is <code class="literal">10</code>. You can override this value on a per-destination basis.
					</div></dd><dt><span class="term">DefaultExpiryQueue</span></dt><dd><div class="para">
						The default expiry queue that the <code class="literal">ServerPeer</code> will use for destinations. You can override this value on a per-destination basis, as seen in the section on destination managed bean configuration. An expiry queue holds messages that have expired. Message expiry is determined by the value of <code class="literal">Message::getJMSExpiration()</code>. If the expiry queue is not specified, the message will be deleted when it expires.
					</div></dd><dt><span class="term">DefaultRedeliveryDelay</span></dt><dd><div class="para">
						This attribute lets you delay a redelivery attempt, which helps to prevent thrashing delivery-failure. The default value is <code class="literal">0</code> (that is, no delay). You can override this value on a per-destination basis.
					</div></dd><dt><span class="term">MessageCounterSamplePeriod</span></dt><dd><div class="para">
						This attribute defines the period of time between the server's queries to the queue for queue statistics. The default value is <code class="literal">5000</code> milliseconds.
					</div></dd><dt><span class="term">FailoverStartTimeout</span></dt><dd><div class="para">
						The longest period (in milliseconds) that the client will wait for failover to begin on the server side when a problem is detected. The default value is <code class="literal">60000</code> (one minute).
					</div></dd><dt><span class="term">FailoverCompleteTimeout</span></dt><dd><div class="para">
						The longest period (in milliseconds) that the client will wait for failover to complete on the server side once failover has been initiated. The default value is <code class="literal">300000</code> (five minutes).
					</div></dd><dt><span class="term">DefaultMessageCounterHistoryDayLimit</span></dt><dd><div class="para">
						JBoss Messaging provides a message counter history, which shows the number of messages arriving on each queue over a certain number of days. This attribute represents the maximum number of days for which to store message counter history. You can override this value on a per-destination.
					</div></dd><dt><span class="term">ClusterPullConnectionFactoryName</span></dt><dd><div class="para">
						The connection factory used to pull, or suck, messages between queues. You can omit this attribute to disable message sucking while retaining failover.
					</div></dd><dt><span class="term">DefaultPreserveOrdering</span></dt><dd><div class="para">
						When <code class="literal">true</code>, JMS ordering is preserved in the cluster. See <a class="xref" href="c_configuration.html">Chapter 6, <em>Clustering Notes</em></a> for more detail. The default value is <code class="literal">false</code>.
					</div></dd><dt><span class="term">RecoverDeliveriesTimeout</span></dt><dd><div class="para">
						When failover occurs, messages that have been delivered will be stored while the clients reconnect. If the clients do not reconnect (for example, if the client is dead), these messages will eventually time out and be added to the queue. This attribute sets the period before timeout in milliseconds. The default value is <code class="literal">300000</code> (five minutes).
					</div></dd><dt><span class="term">EnableMessageCounters</span></dt><dd><div class="para">
						When set to <code class="literal">true</code>, enables message counters upon server start.
					</div></dd><dt><span class="term">SuckerPassword</span></dt><dd><div class="para">
						JBoss Messaging internally creates connections between nodes to redistribute messages between clustered destinations. These connections are created with a special, reserved username. This attribute defines the password to use when creating these connections.
					</div><div class="para">
						For versions of JBoss Messaging later than 1.4.1.GA, you must define the <code class="varname">SuckerPassword</code> on the <code class="literal">SecurityMetadataStore</code>.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
							The <code class="varname">SuckerPassword</code> must be changed at install time, or the default password will be used, giving any user who knows the default password access to any destination on the server.
						</div></div></div></dd><dt><span class="term">SuckerConnectionRetryTimes</span></dt><dd><div class="para">
						This is the maximum number of times a sucker's connection is permitted to retry in the event of a failure. The default value is <code class="literal">-1</code> which represents "retry indefinitely".
					</div></dd><dt><span class="term">SuckerConnectionRetryInterval</span></dt><dd><div class="para">
						This is the interval in milliseconds between each retry of the failed sucker's connection. The default value is <code class="literal">5000</code>.
					</div></dd><dt><span class="term">StrictTck</span></dt><dd><div class="para">
						To enable strict JMS Technology Compatibility Kit (TCK) semantics, set this attribute to <code class="literal">true</code>.
					</div></dd><dt><span class="term">Destinations</span></dt><dd><div class="para">
						Returns a list of the destinations (queues and topics) currently deployed.
					</div></dd><dt><span class="term">MessageCounters</span></dt><dd><div class="para">
						A message counter for a particular queue.
					</div></dd><dt><span class="term">MessageStatistics</span></dt><dd><div class="para">
						Statistics about each message counter for each queue.
					</div></dd><dt><span class="term">SupportsFailover</span></dt><dd><div class="para">
						When this attribute is <code class="literal">false</code>, server-side failover does not occur when a node crashes in a cluster.
					</div></dd><dt><span class="term">PersistenceManager</span></dt><dd><div class="para">
						The persistence manager used by the <code class="literal">ServerPeer</code>. (You will not normally need to change this attribute.)
					</div></dd><dt><span class="term">JMSUserManager</span></dt><dd><div class="para">
						The JMS user manager used by the <code class="literal">ServerPeer</code>. (You will not normally need to change this attribute.)
					</div></dd><dt><span class="term">SecurityStore</span></dt><dd><div class="para">
						The pluggable <code class="literal">SecurityStore</code>. If you redefine this attribute, remember that you will need to authenticate the <code class="literal">MessageSucker</code> user (<code class="literal">JBM.SUCKER</code>) with all special permissions required by clustering.
					</div></dd><dt><span class="term">SupportsTxAge</span></dt><dd><div class="para">
						Specifies whether the transaction creation time is stored in the transaction record. If set to <code class="literal">true</code>, the transaction record is stored. The default is <code class="literal">false</code>.
					</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-ServerPeer_Methods">
      ⁠</a>5.3. ServerPeer methods</h1></div></div></div><div class="para">
			The following methods are available for the ServerPeer managed bean:
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">deployQueue</span></dt><dd><div class="para">
						Used to programmatically deploy a queue. If the queue exists but is undeployed, it will be deployed. Otherwise, it is created and deployed.
					</div><div class="para">
						The <code class="varname">name</code> parameter matches a destination to deploy.
					</div><div class="para">
						The optional <code class="varname">jndiName</code> parameter represents the full JNDI name of the location to which a destination will be bound. If this is not specified, the destination will be bound in <code class="literal">&lt;DefaultQueueJNDIContext&gt;/&lt;name&gt;</code>.
					</div><div class="para">
						There are two overloaded versions of this operation. The first deploys the destination with default paging parameters. The second deploys the destination with the paging parameters specified. For more information about paging parameters, refer to <a class="xref" href="configuration.html#conf.destination">Section 5.9, “Configuring Destinations”</a>.
					</div></dd><dt><span class="term">undeployQueue</span></dt><dd><div class="para">
						Used to programmatically undeploy a queue. Queues are not removed from persistent storage. This operation returns <code class="literal">true</code> if the queue is successfully undeployed. Otherwise, it returns <code class="literal">false</code>.
					</div></dd><dt><span class="term">destroyQueue</span></dt><dd><div class="para">
						Used to programmatically destroy a queue. Queues are undeployed and all of their data is removed from the database and destroyed.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
							Exercise caution when using this method, since it will delete all data for the queue.
						</div></div></div><div class="para">
						This operation returns <code class="literal">true</code> if the queue was destroyed successfully. Otherwise, it returns <code class="literal">false</code>.
					</div></dd><dt><span class="term">deployTopic</span></dt><dd><div class="para">
						Used to programmatically deploy a topic. There are two overloaded versions of this operation. The first deploys already existing topics with the default paging parameters. The second creates and deploys topics with specified paging parameters. For more information about destinations, refer to <a class="xref" href="configuration.html#conf.destination">Section 5.9, “Configuring Destinations”</a>.
					</div><div class="para">
						The <code class="varname">name</code> parameter represents the name of the destination to deploy.
					</div><div class="para">
						The <code class="varname">jndiName</code> represents the full JNDI name of the location to which the destination will be bound. If this is not specified, the destination will be bound in <code class="literal">&lt;DefaultTopicJNDIContext&gt;/&lt;name&gt;</code>.
					</div></dd><dt><span class="term">undeployTopic</span></dt><dd><div class="para">
						Used to programmatically undeploy a topic. Topics are undeployed, but not removed from persistent storage. This operation returns <code class="literal">true</code> if the topic is undeployed successfully. Otherwise, <code class="literal">false</code> is returned.
					</div></dd><dt><span class="term">destroyTopic</span></dt><dd><div class="para">
						Used to programmatically destroy a topic. Topics are undeployed and all data is removed from the database and destroyed. This operation returns <code class="literal">true</code> if the topic is successfully destroyed. Otherwise, it returns <code class="literal">false</code>.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
							Exercise caution when using this method: it will delete all data for the topic.
						</div></div></div></dd><dt><span class="term">listMessageCountersHTML</span></dt><dd><div class="para">
						Returns message counters in a simply-displayed HTML format.
					</div></dd><dt><span class="term">resetAllMesageCounters</span></dt><dd><div class="para">
						Resets all message counters to zero.
					</div></dd><dt><span class="term">enableMessageCounters</span></dt><dd><div class="para">
						Enables all message counters for all destinations. Message counters are disabled by default.
					</div></dd><dt><span class="term">disableMessageCounters</span></dt><dd><div class="para">
						Disables all message counters for all destinations. Message counters are disabled by default.
					</div></dd><dt><span class="term">retrievePreparedTransactions</span></dt><dd><div class="para">
						Retrieves a list of the XIDs for all transactions currently in a prepared state on the node.
					</div></dd><dt><span class="term">showPreparedTransactions</span></dt><dd><div class="para">
						Retrieves a list of the XIDs for all transactions currently in a prepared state on the node in an easily-displayed HTML format.
					</div></dd><dt><span class="term">listAllPreparedTransactions</span></dt><dd><div class="para">
						Displays the details of all prepared transactions.
					</div></dd><dt><span class="term">listPreparedTransactions</span></dt><dd><div class="para">
						Displays the details of all prepared transactions where the transaction ages are equal to or older than a specified time.
					</div></dd><dt><span class="term">showMessageDetails</span></dt><dd><div class="para">
						Displays the details of a message. The message ID is used to specify the message to display.
					</div></dd><dt><span class="term">commitPreparedTransaction</span></dt><dd><div class="para">
						Manually commit a prepared transaction. The transaction ID is used to specify the transaction to commit.
					</div></dd><dt><span class="term">rollbackPreparedTransaction</span></dt><dd><div class="para">
						Manually roll-back a prepared transaction. The transaction ID is used to specify the transaction to roll-back.
					</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Changing_The_Database">
      ⁠</a>5.4. Changing the Database</h1></div></div></div><div class="para">
			<span class="application"><strong>JMS</strong></span> uses the database defined in <code class="filename">jboss-as/server/$PROFILE/deploy/messaging/<em class="replaceable">&lt;DATABASE_TYPE&gt;</em>-persistence-service.xml</code> as a persistence storage. The default persistence storage type is Hypersonic (HSQLDB) defined in <code class="filename">hsqldb-persistence-service.xml</code>. Note that the configuration is defined for a clustered environment (<code class="code">&lt;attribute name="Clustered"&gt;true&lt;/attribute&gt;</code>).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Do not Use Hypersonic in Production</strong></p></div><div class="admonition"><div class="para">
				Although Hypersonic configuration is used as the default persistence configuration, <span class="emphasis"><em>Hypersonic is not suitable or supported in production</em></span> due to the following known issues:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						no transaction isolation
					</div></li><li class="listitem"><div class="para">
						thread and socket leaks (<code class="methodname">connection.close()</code> does not tidy up resources)
					</div></li><li class="listitem"><div class="para">
						persistence quality (logs commonly become corrupted after a failure, preventing automatic recovery)
					</div></li><li class="listitem"><div class="para">
						database corruption
					</div></li><li class="listitem"><div class="para">
						stability under load (database processes cease when dealing with too much data)
					</div></li><li class="listitem"><div class="para">
						not viable in clustered environments
					</div></li></ul></div><div class="para">
				The Hypersonic database is intended for developing and testing purposes and should not be used in a production environment. For more information about recommended databases, refer to the <em class="citetitle">Using Other Databases</em> chapter in the <em class="citetitle">Getting Started Guide</em>.
			</div></div></div><div class="para">
			The Persistence Manager, Post Office and JMS User Manager all interact with persistent storage. The Persistence Manager handles message-related persistence. The Post Office handles binding related persistence. The JMS User Manager handles user-related persistence. All configuration for these managed beans is handled in the <code class="filename">&lt;your database type&gt;-persistence-service.xml</code> file.
		</div><div class="para">
			Example configuration files for MySQL, Oracle, PostgreSQL, Microsoft SQL Server or Sybase databases are available in the <code class="filename">$JBOSS_HOME/docs/examples/jms</code> directory of the release bundle.
		</div><div class="para">
			To enable your database, replace the default <code class="filename">$JBOSS_HOME/server/$PROFILE/deploy/messaging/hsqldb-persistence-service.xml</code> configuration file with the configuration file for your database type. Restart the server to apply the new persistence configuration.
		</div><div class="para">
			Apart from the unsupported Hypersonic configuration, the example configurations are by default set for non-clustered environments. To allow clustered environments for your database configuration, set the <span class="property">Clustered</span> attribute to <code class="literal">true</code> in <code class="filename"><em class="replaceable">&lt;your database type&gt;-persistence-service.xml</em></code> (the default setting is &lt;attribute name="Clustered"&gt;false&lt;/attribute&gt;).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Upgrade from JBoss Enterprise Application Platform 5.1.0 or earlier</strong></p></div><div class="admonition"><div class="para">
				The structure of the persistence configuration file changed in JBoss Enterprise Application Platform 5.1.0 so it's necessary to again copy an example configuration file for your database configuration and edit it to suit your environment. Failure to do so will cause deployment/startup problems.
			</div></div></div><div class="para">
			By default, the messaging services rely on a data store reference <code class="literal">java:/DefaultDS</code> for the data source. To deploy a data source with a different JNDI name, you must update all <code class="literal">DataSource</code> attributes in the persistence configuration file. Example data source configurations are included in the distribution.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.postoffice">
      ⁠</a>5.5. Configuring the Post Office</h1></div></div></div><div class="para">
			The post office routes messages to their destination or destinations. It maintains the mappings between the addresses to which a message can be sent, and the final queue. For example, when sending a message with an address that represents a JMS queue, the post office routes the message to that JMS queue. When sending a message with an address that represents a JMS topic, the post office routes the message to a set of queues — one for each JMS subscription.
		</div><div class="para">
			The post office also handles the persistence for address mapping.
		</div><div class="para">
			JBoss Messaging post offices are cluster-aware. In a cluster, they automatically route (push) and pull messages between nodes in order to provide fully-distributed JMS queues and topics.
		</div><div class="para">
			Configure the post office in the <code class="filename">&lt;database type&gt;-persistence-service.xml</code> file. For example:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.messaging.core.jmx.MessagingPostOfficeService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=PostOffice"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/MessagingPostOffice-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"ServerPeer"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=ServerPeer
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>
<span xmlns="" class="line">​</span>    jboss.jca:service=DataSourceBinding,name=DefaultDS
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"TransactionManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss:service=TransactionManager
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The name of the post office --&gt;</span>                  
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PostOfficeName"</span><span xmlns="" class="perl_Keyword">&gt;</span>JMS post office<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The datasource used by the post office to access it's </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       binding information --&gt;</span>                     
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DataSource"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/DefaultDS<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If true will attempt to create tables and indexes on </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       every start-up --&gt;</span>
<span xmlns="" class="line">​</span>                        
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CreateTablesOnStartup"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If true then we will automatically detect and reject </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       duplicate messages sent during failover --&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DetectDuplicates"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The size of the id cache to use when detecting duplicate </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       messages --&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"IDCacheSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>500<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SqlProperties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    CREATE_POSTOFFICE_TABLE=CREATE TABLE JBM_POSTOFFICE 
<span xmlns="" class="line">​</span>      (POSTOFFICE_NAME VARCHAR(255), 
<span xmlns="" class="line">​</span>      NODE_ID INTEGER, QUEUE_NAME VARCHAR(255), COND VARCHAR(1023), 
<span xmlns="" class="line">​</span>      SELECTOR VARCHAR(1023), CHANNEL_ID BIGINT, CLUSTERED CHAR(1), 
<span xmlns="" class="line">​</span>      ALL_NODES CHAR(1), 
<span xmlns="" class="line">​</span>      PRIMARY KEY(POSTOFFICE_NAME, NODE_ID, QUEUE_NAME)) ENGINE = INNODB
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    INSERT_BINDING=INSERT INTO JBM_POSTOFFICE 
<span xmlns="" class="line">​</span>      (POSTOFFICE_NAME, NODE_ID, QUEUE_NAME, COND, SELECTOR, 
<span xmlns="" class="line">​</span>       CHANNEL_ID, CLUSTERED, ALL_NODES) 
<span xmlns="" class="line">​</span>      VALUES (?, ?, ?, ?, ?, ?, ?, ?)
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    DELETE_BINDING=DELETE FROM JBM_POSTOFFICE WHERE 
<span xmlns="" class="line">​</span>      POSTOFFICE_NAME=? AND NODE_ID=? AND QUEUE_NAME=?
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    LOAD_BINDINGS=SELECT QUEUE_NAME, COND, SELECTOR, 
<span xmlns="" class="line">​</span>      CHANNEL_ID, CLUSTERED, ALL_NODES FROM 
<span xmlns="" class="line">​</span>   JBM_POSTOFFICE WHERE POSTOFFICE_NAME=? AND NODE_ID=?
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- This post office is clustered. If you do not want a clustered post </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       office then set to false --&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Clustered"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- All the remaining properties only have to be specified if the post </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       office is clustered. You can safely comment them out if your post </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       office is non clustered --&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The JGroups group name that the post office will use --&gt;</span>            
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"GroupName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    ${jboss.messaging.groupname:MessagingPostOffice}
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Max time to wait for state to arrive when the post office </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       joins the cluster --&gt;</span>            
<span xmlns="" class="line">​</span>                  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"StateTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Max time to wait for a synchronous call to node members using </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       the MessageDispatcher --&gt;</span>            
<span xmlns="" class="line">​</span>                  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CastTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>50000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Set this to true if you want failover of connections to occur </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       when a node is shut down --&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FailoverOnNodeLeave"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- JGroups stack configuration for the data channel - used for sending </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       data across the cluster --&gt;</span> 
<span xmlns="" class="line">​</span>                   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- By default we use the TCP stack for data --&gt;</span>                  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DataChannelConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;TCP</span><span xmlns="" class="perl_Others"> start_port=</span><span xmlns="" class="perl_String">"7900"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        loopback=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        recv_buf_size=</span><span xmlns="" class="perl_String">"20000000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        send_buf_size=</span><span xmlns="" class="perl_String">"640000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        discard_incompatible_packets=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        max_bundle_size=</span><span xmlns="" class="perl_String">"64000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        max_bundle_timeout=</span><span xmlns="" class="perl_String">"30"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_incoming_packet_handler=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_outgoing_packet_handler=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        enable_bundling=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_send_queues=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        sock_conn_timeout=</span><span xmlns="" class="perl_String">"300"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        skip_suspected_members=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;MPING</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"4000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        bind_to_all_interfaces=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        mcast_addr=</span><span xmlns="" class="perl_String">"${jboss.messaging.datachanneludpaddress:228.6.6.6}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        mcast_port=</span><span xmlns="" class="perl_String">"${jboss.messaging.datachanneludpport:45567}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        ip_ttl=</span><span xmlns="" class="perl_String">"8"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        num_initial_members=</span><span xmlns="" class="perl_String">"2"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        num_ping_requests=</span><span xmlns="" class="perl_String">"1"</span><span xmlns="" class="perl_Keyword">/&gt;</span>                     
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;MERGE2</span><span xmlns="" class="perl_Others"> max_interval=</span><span xmlns="" class="perl_String">"100000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> min_interval=</span><span xmlns="" class="perl_String">"20000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;FD_SOCK</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>            
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;VERIFY_SUSPECT</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"1500"</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.NAKACK</span><span xmlns="" class="perl_Others"> max_xmit_size=</span><span xmlns="" class="perl_String">"60000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_mcast_xmit=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> gc_lag=</span><span xmlns="" class="perl_String">"0"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        retransmit_timeout=</span><span xmlns="" class="perl_String">"300,600,1200,2400,4800"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        discard_delivered_msgs=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.STABLE</span><span xmlns="" class="perl_Others"> stability_delay=</span><span xmlns="" class="perl_String">"1000"</span><span xmlns="" class="perl_Others"> desired_avg_gossip=</span><span xmlns="" class="perl_String">"50000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        max_bytes=</span><span xmlns="" class="perl_String">"400000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.GMS</span><span xmlns="" class="perl_Others"> print_local_addr=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> join_timeout=</span><span xmlns="" class="perl_String">"3000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        join_retry_timeout=</span><span xmlns="" class="perl_String">"2000"</span><span xmlns="" class="perl_Others"> shun=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        view_bundling=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/config&gt;</span>        
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- JGroups stack configuration to use for </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       the control channel - used for control messages --&gt;</span>         
<span xmlns="" class="line">​</span>              
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- We use udp stack for the control channel --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ControlChannelConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;UDP</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        mcast_addr=</span><span xmlns="" class="perl_String">"${jboss.messaging.controlchanneludpaddress:228.7.7.7}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        mcast_port=</span><span xmlns="" class="perl_String">"${jboss.messaging.controlchanneludpport:45568}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        tos=</span><span xmlns="" class="perl_String">"8"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        ucast_recv_buf_size=</span><span xmlns="" class="perl_String">"20000000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        ucast_send_buf_size=</span><span xmlns="" class="perl_String">"640000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        mcast_recv_buf_size=</span><span xmlns="" class="perl_String">"25000000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        mcast_send_buf_size=</span><span xmlns="" class="perl_String">"640000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        loopback=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        discard_incompatible_packets=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        max_bundle_size=</span><span xmlns="" class="perl_String">"64000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        max_bundle_timeout=</span><span xmlns="" class="perl_String">"30"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_incoming_packet_handler=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_outgoing_packet_handler=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        ip_ttl=</span><span xmlns="" class="perl_String">"2"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        enable_bundling=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;PING</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"2000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> num_initial_members=</span><span xmlns="" class="perl_String">"3"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;MERGE2</span><span xmlns="" class="perl_Others"> max_interval=</span><span xmlns="" class="perl_String">"100000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> min_interval=</span><span xmlns="" class="perl_String">"20000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;FD_SOCK</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;FD</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"10000"</span><span xmlns="" class="perl_Others"> max_tries=</span><span xmlns="" class="perl_String">"5"</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> shun=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;VERIFY_SUSPECT</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"1500"</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.NAKACK</span><span xmlns="" class="perl_Others"> max_xmit_size=</span><span xmlns="" class="perl_String">"60000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_mcast_xmit=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> gc_lag=</span><span xmlns="" class="perl_String">"0"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        retransmit_timeout=</span><span xmlns="" class="perl_String">"300,600,1200,2400,4800"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        discard_delivered_msgs=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;UNICAST</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"300,600,1200,2400,3600"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.STABLE</span><span xmlns="" class="perl_Others"> stability_delay=</span><span xmlns="" class="perl_String">"1000"</span><span xmlns="" class="perl_Others"> desired_avg_gossip=</span><span xmlns="" class="perl_String">"50000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        max_bytes=</span><span xmlns="" class="perl_String">"400000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.GMS</span><span xmlns="" class="perl_Others"> print_local_addr=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> join_timeout=</span><span xmlns="" class="perl_String">"3000"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_flush=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> flush_timeout=</span><span xmlns="" class="perl_String">"3000"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        join_retry_timeout=</span><span xmlns="" class="perl_String">"2000"</span><span xmlns="" class="perl_Others"> shun=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        view_bundling=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;FRAG2</span><span xmlns="" class="perl_Others"> frag_size=</span><span xmlns="" class="perl_String">"60000"</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.STATE_TRANSFER</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        use_flush=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> flush_timeout=</span><span xmlns="" class="perl_String">"3000"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;pbcast.FLUSH</span><span xmlns="" class="perl_Others"> down_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> up_thread=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> timeout=</span><span xmlns="" class="perl_String">"20000"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        auto_flush_conf=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/config&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>    
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="conf.postoffice.attributes">
      ⁠</a>5.5.1. MessagingPostOffice Attributes</h2></div></div></div><div class="para">
				<code class="classname">MessagingPostOffice</code> Service Attributes are described in the following list.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">DataSource</span></dt><dd><div class="para">
							The datasource the postoffice should use for persisting its mapping data.
						</div></dd><dt><span class="term">SQLProperties</span></dt><dd><div class="para">
							This is where the DDL and DML for the particular database is specified. If a particular DDL or DML statement is not overridden, the default Hypersonic configuration will be used for that statement.
						</div></dd><dt><span class="term">CreateTablesOnStartup</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if you wish the post office to attempt to create the tables (and indexes) when it starts. If the tables (or indexes) already exist a <code class="literal">SQLException</code> will be thrown by the JDBC driver and ignored by the Persistence Manager, allowing it to continue.
						</div><div class="para">
							By default the value of <code class="literal">CreateTablesOnStartup</code> attribute is set to <code class="literal">true</code>
						</div></dd><dt><span class="term">DetectDuplicates</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if you wish the post office detect duplicate messages that may sent when a send is retried on a different node after server failure.
						</div><div class="para">
							By default the value of <code class="literal">DetectDuplicates</code> attribute is set to <code class="literal">true</code>
						</div></dd><dt><span class="term">IDCacheSize</span></dt><dd><div class="para">
							If duplicate detection is enabled. (See <code class="literal">DetectDuplicates</code>), then the server will remember the last <code class="literal">n</code> message ids sent, to prevent duplicate messages sent after failover has occurred. The value of <code class="literal">n</code> is determined by this attribute.
						</div><div class="para">
							By default the value of <code class="literal">IDCacheSize</code> attribute is set to <code class="literal">500</code>
						</div></dd><dt><span class="term">PostOfficeName</span></dt><dd><div class="para">
							The name of the post office.
						</div></dd><dt><span class="term">NodeIDView</span></dt><dd><div class="para">
							This returns set containing the node ids of all the nodes in the cluster.
						</div></dd><dt><span class="term">GroupName</span></dt><dd><div class="para">
							All post offices in the cluster with the same group name will form a cluster together. Make sure the group name matches with all the nodes in the cluster you want to form a cluster with.
						</div></dd><dt><span class="term">Clustered</span></dt><dd><div class="para">
							If true the post office will take part in a cluster to form distributed queues and topics. If false then it will not participate in the cluster. If false, then all the cluster related attributes will be ignored.
						</div></dd><dt><span class="term">StateTimeout</span></dt><dd><div class="para">
							The maximum time to wait when waiting for the group state to arrive when a node joins a pre-existing cluster.
						</div><div class="para">
							The default value is <code class="literal">5000</code> milliseconds.
						</div></dd><dt><span class="term">CastTimeout</span></dt><dd><div class="para">
							The maximum time to wait for a reply casting message synchronously.
						</div><div class="para">
							The default value is <code class="literal">5000</code> milliseconds.
						</div></dd><dt><span class="term">FailoverOnNodeLeave</span></dt><dd><div class="para">
							Specifies how messages stored on a node are redistributed when a node is cleanly shutdown. The default value is <code class="literal">false</code>. If <code class="literal">true</code>, when a server node is shut down cleanly (using <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> in the terminal) all messages stored on the node are moved to another node in the cluster.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
								Clients originally connected to the cleanly shutdown node are not automatically reconnected to the failover node in the cluster. Clients return an exception upon message failover.
							</div></div></div></dd><dt><span class="term">MaxConcurrentReplications</span></dt><dd><div class="para">
							The maximum number of concurrent replication requests to make before blocking for replies to come back. This prevents us overwhelming JGroups. This is rarely a good reason to change this.
						</div><div class="para">
							The default value is <code class="literal">50</code>
						</div></dd><dt><span class="term">ControlChannelConfig</span></dt><dd><div class="para">
							JBoss Messaging uses JGroups for all group management. This contains the JGroups stack configuration for the control channel.
						</div><div class="para">
							The control channel is used for sending request/receiving responses from other nodes in the cluster
						</div><div class="para">
							The details of the JGroups configuration will not be discussed here since it is standard JGroups configuration. Detailed information on JGroups can be found in JGroups release documentation or on-line at <a href="http://www.jgroups.org">http://www.jgroups.org</a> or <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups">http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups</a>.
						</div></dd><dt><span class="term">DataChannelConfig</span></dt><dd><div class="para">
							JBoss Messaging uses JGroups for all group management. This contains the JGroups stack configuration for the data channel.
						</div><div class="para">
							The data channel is used for sending sending/receiving messages from other nodes in the cluster and for replicating session data.
						</div><div class="para">
							The details of the JGroups configuration will not be discussed here since it is standard JGroups configuration. Detailed information on JGroups can be found in JGroups release documentation or on-line at <a href="http://www.jgroups.org">http://www.jgroups.org</a> or <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups">http://wiki.jboss.org/wiki/Wiki.jsp?page=JGroups</a>.
						</div></dd></dl></div><div class="para">
				Database Connection Retry Parameters control whether a connection should be re-established when a connection failure is detected, how many attempts to reconnect should be made, and at what interval each attempt should be made.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">RetryOnConnectionFailure</span></dt><dd><div class="para">
							Specifies whether the MBean should attempt to reconnect to the database. The default is <code class="literal">false</code>.
						</div></dd><dt><span class="term">MaxRetry</span></dt><dd><div class="para">
							Specifies the maximum limit for DataSource connection failures. The default is <code class="literal">25</code>. Set the parameter to <code class="literal">-1</code> to activate "retry forever" mode. This parameter is valid when <em class="parameter"><code>RetryOnConnectionFailure</code></em> is set to <code class="literal">true</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important - Closing Clients Issue on Nodes with MaxRetry set to -1</strong></p></div><div class="admonition"><div class="para">
								Clients that consume messages from a clustered destination can become unresponsive when closed. This happens if the node has the value <em class="parameter"><code>MaxRetry</code></em> set to <code class="literal">-1</code>, and loses the connection to the database. To avoid the problem, set the node parameter <em class="parameter"><code>MaxRetry</code></em> to a value greater than <code class="literal">-1</code>. You can set the attribute value in the MBeans <code class="classname">PersistenceManager</code>, <code class="classname">PostOffice</code>, and <code class="classname">JMSUserManager</code> in the file <code class="filename">[database]-persistence-service.xml</code>
							</div></div></div></dd><dt><span class="term">RetryInterval</span></dt><dd><div class="para">
							Specifies the retry interval between two consecutive retries. The default is 1000 (milliseconds). This parameter is valid when <em class="parameter"><code>RetryOnConnectionFailure</code></em> is set to <code class="literal">true</code>.
						</div></dd></dl></div><div class="para">
				If a node becomes unresponsive for a few seconds while still being stable (for example during a minor network malfunction), past failover behavior reported the node had left the cluster. This scenario can be avoided by specifying the following parameters in the MessagePostOffice bean. The following parameters provide the MessagePostOffice access to the cluster timestamp table, which is used to more accurately determine the state of a node.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					The timestamp table parameters should be used in conjunction with the MessagingClusterHealthMBean MBean. You deploy this MBean in the ServerPeer MBean. Refer to <a class="xref" href="configuration.html#conf.serverpeer">Section 5.1, “Configuring the ServerPeer”</a> for a full overview of the supported parameters and operations.
				</div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">KeepOldFailoverMode</span></dt><dd><div class="para">
							Specifies whether the timestamp table failover mode should be used. The default is <code class="literal">true</code> (disable new failover behavior).
						</div></dd><dt><span class="term">NodeStateRefreshInterval</span></dt><dd><div class="para">
							Specifies the maximum duration (in milliseconds) a cluster will wait for a node to refresh its timestamp before the cluster marks the node as disabled. The default is 30000 (30 seconds).
						</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140038226426080">
      ⁠</a>5.6. Configure the MessagingClusterHealthMBean</h1></div></div></div><div class="para">
			The <code class="classname">MessagingPostOffice</code> uses the <em class="parameter"><code>KeepOldFailoverMode</code></em> and <em class="parameter"><code>NodeStateRefreshInterval</code></em> parameters to control the interval during which a node must update timestamps to remain part of a cluster. These parameters do not control how a node responds to losing connection to the database.
		</div><div class="para">
			If a node loses connection to the database, it can not update the timestamp information available to the <code class="classname">MessagePostOffice</code>. Even though the node may still be healthy, the cluster has no way of determining the actual state of the node. As a result, the cluster assumes the node has failed and duplicate message delivery can occur.
		</div><div class="para">
			The <code class="classname">MessagingClusterHealthMBean</code> MBean is responsible for monitoring the node state, and stopping and starting a node when it loses connection to the database. When a node is shunned from the cluster and subsequently loses database connectivity, the MBean shuts down the node immediately. The MBean monitors the JGroups status and database status while the node is unavailable, and will restart the node when it detects JGroups and the database connection is restored to normal operation.
		</div><div class="para">
			To enable this functionality, declare the <code class="classname">MessagingClusterHealthMBean</code> MBean in the <code class="classname">ServerPeer</code> MBean as an <em class="parameter"><code>optional-attribute-name</code></em> attribute of the <code class="literal">&lt;depends&gt;</code> directive.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ServerPeer MBean configuration --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.ServerPeer"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=ServerPeer"</span><span xmlns="" class="perl_Others"> xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/ServerPeer-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Unique integer ID of the server peer - each cluster node MUST have a unique value --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ServerPeerID"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- The default JNDI context that queues use when deployed without specifying one --&gt;</span> 
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultQueueJNDIContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>/queue<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- The default JNDI context that topics use when deployed without specifying one --&gt;</span> 
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultTopicJNDIContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>/topic<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- XML CONFIG REMOVED FOR READABILITY --&gt;</span>   
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"PersistenceManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     jboss.messaging:service=PersistenceManager
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- XML CONFIG REMOVED FOR READABILITY --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"MessagingClusterHealthMBean"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     jboss.messaging:service=MessagingClusterHealthMBean
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre><div class="para">
			After declaring the <code class="classname">MessagingClusterHealthMBean</code> MBean in the <code class="classname">ServerPeer</code> MBean, you need to add the <code class="classname">MessagingClusterHealthMBean</code> MBean's configuration.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- MessagingClusterHealthMBean MBean configuration --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.MessagingClusterHealthMBean"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=MessagingClusterHealthMBean"</span><span xmlns="" class="perl_Others"> xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/MessagingClusterHealthMBean-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--  The service name of Server Peer  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ServerPeer"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.messaging:service=ServerPeer<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--  The service name of Post Office  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PostOffice"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.messaging:service=PostOffice<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--  The service name of Persistence Manager  --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PersistenceManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.messaging:service=PersistenceManager<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Configuring_The_Persistence_Manager">
      ⁠</a>5.7. Configuring the Persistence Manager</h1></div></div></div><div class="para">
			JBoss Messaging ships with a JDBC Persistence Manager, which handles message data persistence in a relational database accessed via JDBC. The Persistence Manager can be plugged into the Messaging server, which allows additional implementations to persist message data in non-relational stores, and file stores.
		</div><div class="para">
			Persistent service configuration details are grouped in <code class="filename">&lt;database type&gt;-persistence-service.xml</code>. JBoss Messaging ships with the <code class="filename">hsqldb-persistence-service.xml</code> file by default, which configures the Messaging server to use the Hypersonic database instance included by default with any JBoss Enterprise Application Server instance.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Hypersonic is not supported for use in a production environment.
			</div></div></div><div class="para">
			JBoss Messaging also ships with Persistence Manager configurations for MySQL, Oracle, PostgreSQL, Sybase, Microsoft SQL Server, and DB2. The example configuration files (such as <code class="filename">mysql-persistence-service.xml</code> and <code class="filename">ndb-persistence-service.xml</code>) are available from the <code class="filename">jboss-as/docs/examples/jms</code> directory of the release bundle.
		</div><div class="para">
			The JDBC Persistence Manager uses standard SQL as its Data Manipulation Language (DML), so writing a Persistence Manager configuration for another database type is a matter of changing the configuration's Data Definition Language (DDL), which usually differs on a per-database basis.
		</div><div class="para">
			JBoss Messaging also ships with a Null Persistence Manager configuration option, which can be used when persistence is not required.
		</div><div class="para">
			The following code is the default Hypersonic persistence manager configuration:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.messaging.core.jmx.JDBCPersistenceManagerService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=PersistenceManager"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/JDBCPersistenceManager-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.jca:service=DataSourceBinding,name=DefaultDS<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"TransactionManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss:service=TransactionManager
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The datasource to use for the persistence manager --&gt;</span>
<span xmlns="" class="line">​</span>                            
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DataSource"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/DefaultDS<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If true will attempt to create tables and indexes on every start-up --&gt;</span>
<span xmlns="" class="line">​</span>              
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CreateTablesOnStartup"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- If true then will use JDBC batch updates --&gt;</span>
<span xmlns="" class="line">​</span>             
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"UsingBatchUpdates"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The maximum number of parameters to include in a prepared statement --&gt;</span>            
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MaxParams"</span><span xmlns="" class="perl_Keyword">&gt;</span>500<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				The maximum size of Sybase database text and image data types is set to <code class="literal">2 kilobytes</code> by default. Any message that exceeds this limit is truncated, without any information or warning. Set the <code class="varname">@@TEXTSIZE</code> database parameter to a higher value to prevent potential truncation.
			</div><div class="para">
				Truncation may also occur in the Microsoft SQL Server if <code class="varname">@@TEXTSIZE</code> value is set to a lesser value than the default value. For further information, refer to <a href="https://issues.jboss.org/browse/SOA-554">https://issues.jboss.org/browse/SOA-554</a>, and the <em class="citetitle">Special Notes on Sybase</em> section in the <em class="citetitle">Administration and Configuration Guide</em>.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				Microsoft SQL Server does not automatically unallocate hard drive space when data is deleted from a database. When the hard drive database space is used as a data store for a service that temporarily stores many records (such as a messaging service), the disk space will quickly become much greater than the amount of data actually being stored.
			</div><div class="para">
				Database administrators must implement database maintenance plans to ensure that the unused space is reclaimed. Refer to your Microsoft SQL Server documentation for the DBCC commands <code class="command">ShrinkDatabase</code> and <code class="command">UpdateUsage</code> for guidance reclaiming the unused space. For further information about this issue, refer to <a href="https://issues.jboss.org/browse/SOA-629">https://issues.jboss.org/browse/SOA-629</a>
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="conf.persistencemanager.attributes_1">
      ⁠</a>5.7.1. JDBCPersistenceManager MBean Attributes</h2></div></div></div><div class="para">
				The JDBCPersistenceManager attributes are described in the following list.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">CreateTablesOnStartup</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if you wish the Persistence Manager to attempt to create the tables (and indexes) when it starts. If the tables (or indexes) already exist a <code class="literal">SQLException</code> will be thrown by the JDBC driver and ignored by the Persistence Manager, allowing it to continue.
						</div><div class="para">
							By default the value of <code class="literal">CreateTablesOnStartup</code> attribute is set to <code class="literal">true</code>.
						</div></dd><dt><span class="term">UsingBatchUpdates</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if the database supports JDBC batch updates. The JDBC Persistence Manager will then group multiple database updates in batches to aid performance.
						</div><div class="para">
							By default the value of <code class="literal">UsingBatchUpdates</code> attribute is set to <code class="literal">false</code>
						</div></dd><dt><span class="term">UsingBinaryStream</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if you want messages to be store and read using a JDBC binary stream rather than using getBytes(), setBytes(). Some database has limits on the maximum number of bytes that can be get/set using getBytes()/setBytes().
						</div><div class="para">
							By default the value of <code class="literal">UsingBinaryStream</code> attribute is set to <code class="literal">true</code>
						</div></dd><dt><span class="term">UsingTrailingByte</span></dt><dd><div class="para">
							Certain version of Sybase are known to truncate blobs if they have trailing zeros. To prevent this if this attribute is set to <code class="literal">true</code> then a trailing non zero byte will be added and removed to each blob before and after persistence to prevent the database from truncating it. Currently this is only known to be necessary for Sybase.
						</div><div class="para">
							By default the value of <code class="literal">UsingTrailingByte</code> attribute is set to <code class="literal">false</code>
						</div></dd><dt><span class="term">SupportsBlobOnSelect</span></dt><dd><div class="para">
							Oracle (and possibly other databases) is known to not allow BLOBs to be inserted using a INSERT INTO ... SELECT FROM statement, and requires a two stage conditional insert of messages. If this value is false then such a two stage insert will be used.
						</div><div class="para">
							By default the value of <code class="literal">SupportsBlobOnSelect</code> attribute is set to <code class="literal">true</code>
						</div></dd><dt><span class="term">SQLProperties</span></dt><dd><div class="para">
							This is where the DDL and DML for the particular database is specified. If a particular DDL or DML statement is not overridden, the default Hypersonic configuration will be used for that statement.
						</div></dd><dt><span class="term">MaxParams</span></dt><dd><div class="para">
							When loading messages the persistence manager will generate prepared statements with many parameters. This value tells the persistence manager what the absolute maximum number of parameters are allowable per prepared statement.
						</div><div class="para">
							By default the value of <code class="literal">MaxParams</code> attribute is set to <code class="literal">100</code>
						</div></dd><dt><span class="term">UseNDBFailoverStrategy</span></dt><dd><div class="para">
							When running in a clustered database environment it is possible that some databases, MySQL for instance, can fail during the commit of a database transaction. This can happen if the database node dies whilst committing meaning that the final state of the transaction is unknown. If this attribute is set to true and the above happens then the SQL statement will be re-executed, however if there is a further error an assumption is made that this is because the previous transaction committed successfully and the error is ignored.
						</div><div class="para">
							By default the value of <code class="literal">UseNDBFailoverStrategy</code> attribute is set to <code class="literal">false</code>
						</div></dd></dl></div><div class="para">
				Database Connection Retry Parameters control whether a connection should be re-established when a connection failure is detected, how many attempts to reconnect should be made, and at what interval each attempt should be made.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">RetryOnConnectionFailure</span></dt><dd><div class="para">
							Specifies whether the MBean should attempt to reconnect to the database. The default is <code class="literal">false</code>.
						</div></dd><dt><span class="term">MaxRetry</span></dt><dd><div class="para">
							Specifies the maximum limit for DataSource connection failures. The default is <code class="literal">25</code>. Set the parameter to <code class="literal">-1</code> to activate "retry forever" mode. This parameter is valid when <em class="parameter"><code>RetryOnConnectionFailure</code></em> is set to <code class="literal">true</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important - Closing Clients Issue on Nodes with MaxRetry set to -1</strong></p></div><div class="admonition"><div class="para">
								Clients that consume messages from a clustered destination can become unresponsive when closed. This happens if the node has the value <em class="parameter"><code>MaxRetry</code></em> set to <code class="literal">-1</code>, and loses the connection to the database. To avoid the problem, set the node parameter <em class="parameter"><code>MaxRetry</code></em> to a value greater than <code class="literal">-1</code>. You can set the attribute value in the MBeans <code class="classname">PersistenceManager</code>, <code class="classname">PostOffice</code>, and <code class="classname">JMSUserManager</code> in the file <code class="filename">[database]-persistence-service.xml</code>
							</div></div></div></dd><dt><span class="term">RetryInterval</span></dt><dd><div class="para">
							Specifies the retry interval between two consecutive retries. The default is 1000 (milliseconds). This parameter is valid when <em class="parameter"><code>RetryOnConnectionFailure</code></em> is set to <code class="literal">true</code>.
						</div></dd><dt><span class="term">CreateTablesOnStartup</span></dt><dd><div class="para">
							Specifies whether tables and index creation is attempted when the Persistence Manager is started. When set to <code class="literal">true</code> (default), the persistence manager will attempt to create tables (and indexes) on start up. If tables or indexes already exist, a <code class="exceptionname">SQLException</code> will be thrown by the JDBC driver and ignored by the persistence manager, allowing it to continue unhindered.
						</div></dd><dt><span class="term">UsingBatchUpdates</span></dt><dd><div class="para">
							Specifies whether multiple database updates are grouped in batches to improve performance. Set this value to <code class="literal">true</code> if your database supports JDBC batch updates.. The default value is <code class="literal">false</code>.
						</div></dd><dt><span class="term">UsingBinaryStream</span></dt><dd><div class="para">
							Specifies whether messages are stored and read with a JDBC binary stream, instead of via <code class="literal">getBytes()</code> and <code class="literal">setBytes()</code>. Set this value to <code class="literal">false</code> if your database must use <code class="literal">getBytes()</code> and <code class="literal">setBytes()</code>. The default value is <code class="literal">true</code>.
						</div></dd><dt><span class="term">UsingTrailingByte</span></dt><dd><div class="para">
							Specifies how Sybase database BLOBs containing trailing zeroes are handled. When set to <code class="literal">true</code> , a trailing non-zero byte is added to each BLOB before persistence, and removed from the BLOB following persistence, preventing truncation by the database. The default value is <code class="literal">false</code> <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									Certain versions of Sybase truncate a BLOB with trailing zeros. This attribute is only required if you are running a Sybase database.
								</div></div></div>

						</div></dd><dt><span class="term">SupportsBlobOnSelect</span></dt><dd><div class="para">
							Specifies how BLOBs are inserted into certain database types. When set to <code class="literal">false</code>, two-stage insertion will be used. The default value is <code class="literal">true</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
								Certain databases, specifically Oracle, do not allow BLOB insertion via an <code class="code">INSERT INTO ... SELECT FROM</code> statement, and require two-stage conditional message insertion. Set this attribute to <code class="literal">false</code> if you are running an Oracle database, or other database with this requirement.
							</div></div></div></dd><dt><span class="term">SQLProperties</span></dt><dd><div class="para">
							Specifies the DDL and DML for a particular database. If a particular DDL or DML statement is not overridden, the default Hypersonic configuration will be used for that statement.
						</div></dd><dt><span class="term">UseNDBFailoverStrategy</span></dt><dd><div class="para">
							Specifies whether a SQL statement is re-executed in the event a database transaction commit fails in a clustered environment. If set to <code class="literal">true</code>, the SQL statement is re-executed in the event that the commit fails. If a further error occurs, the persistence manager assumes the error is due to the previous transaction having committed successfully, and ignores the error. By default, this attribute is set to <code class="literal">false</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
								When some databases, such as MySQL, run in clustered environments, they can fail during database transaction commits. If this occurs, the final transaction state is unknown.
							</div></div></div></dd><dt><span class="term">MaxParams</span></dt><dd><div class="para">
							Specifies the maximum number of parameters allowed per prepared statement while loading messages. The default value is <code class="literal">500</code>.
						</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.jmsusermanager">
      ⁠</a>5.8. Configuring the JMS user manager</h1></div></div></div><div class="para">
			The JMS User Manager maps pre-configured client IDs to users. It also manages user and role tables, depending on the configured login module.
		</div><div class="para">
			The following is an example <code class="literal">JMSUserManager</code> configuration:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.plugin.JDBCJMSUserManagerService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=JMSUserManager"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/JMSUserManager-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.jca:service=DataSourceBinding,name=DefaultDS<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"TransactionManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss:service=TransactionManager
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DataSource"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/DefaultDS<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CreateTablesOnStartup"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SqlProperties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    CREATE_USER_TABLE=CREATE TABLE JBM_USER (USER_ID VARCHAR(32) NOT NULL,
<span xmlns="" class="line">​</span>      PASSWD VARCHAR(32) NOT NULL, CLIENTID VARCHAR(128),
<span xmlns="" class="line">​</span>      PRIMARY KEY(USER_ID)) ENGINE = INNODB
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    CREATE_ROLE_TABLE=CREATE TABLE JBM_ROLE (ROLE_ID VARCHAR(32) NOT NULL,
<span xmlns="" class="line">​</span>      USER_ID VARCHAR(32) NOT NULL, PRIMARY KEY(USER_ID, ROLE_ID))
<span xmlns="" class="line">​</span>      ENGINE = INNODB
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    SELECT_PRECONF_CLIENTID=SELECT CLIENTID FROM JBM_USER WHERE USER_ID=?
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    POPULATE.TABLES.1=INSERT INTO JBM_USER (USER_ID,PASSWD,CLIENTID)
<span xmlns="" class="line">​</span>      VALUES ('jdoe','jdoepw','jdoe-id')   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="conf.jmsusermanager.attributes_1">
      ⁠</a>5.8.1. JMSUserManager MBean Attributes</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">CreateTablesOnStartup</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if you wish the JMS user manager to attempt to create the tables (and indexes) when it starts. If the tables (or indexes) already exist a <code class="literal">SQLException</code> will be thrown by the JDBC driver and ignored by the Persistence Manager, allowing it to continue.
						</div><div class="para">
							By default the value of <code class="literal">CreateTablesOnStartup</code> attribute is set to <code class="literal">true</code>
						</div></dd><dt><span class="term">UsingBatchUpdates</span></dt><dd><div class="para">
							Set this to <code class="literal">true</code> if the database supports JDBC batch updates. The JDBC Persistence Manager will then group multiple database updates in batches to aid performance.
						</div><div class="para">
							By default the value of <code class="literal">UsingBatchUpdates</code> attribute is set to <code class="literal">false</code>
						</div></dd><dt><span class="term">SQLProperties</span></dt><dd><div class="para">
							This is where the DDL and DML for the particular database is specified. If a particular DDL or DML statement is not overridden, the default Hypersonic configuration will be used for that statement.
						</div><div class="para">
							Default user and role data can also be specified here. Any data to be inserted must be specified with property names starting with <code class="literal">POPULATE.TABLES</code> as in the above example.
						</div></dd></dl></div><div class="para">
				Database Connection Retry Parameters control whether a connection should be re-established when a connection failure is detected, how many attempts to reconnect should be made, and at what interval each attempt should be made.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">RetryOnConnectionFailure</span></dt><dd><div class="para">
							Specifies whether the MBean should attempt to reconnect to the database. The default is <code class="literal">false</code>.
						</div></dd><dt><span class="term">MaxRetry</span></dt><dd><div class="para">
							Specifies the maximum limit for DataSource connection failures. The default is <code class="literal">25</code>. Set the parameter to <code class="literal">-1</code> to activate "retry forever" mode. This parameter is valid when <em class="parameter"><code>RetryOnConnectionFailure</code></em> is set to <code class="literal">true</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important - Closing Clients Issue on Nodes with MaxRetry set to -1</strong></p></div><div class="admonition"><div class="para">
								Clients that consume messages from a clustered destination can become unresponsive when closed. This happens if the node has the value <em class="parameter"><code>MaxRetry</code></em> set to <code class="literal">-1</code>, and loses the connection to the database. To avoid the problem, set the node parameter <em class="parameter"><code>MaxRetry</code></em> to a value greater than <code class="literal">-1</code>. You can set the attribute value in the MBeans <code class="classname">PersistenceManager</code>, <code class="classname">PostOffice</code>, and <code class="classname">JMSUserManager</code> in the file <code class="filename">[database]-persistence-service.xml</code>
							</div></div></div></dd><dt><span class="term">RetryInterval</span></dt><dd><div class="para">
							Specifies the retry interval between two consecutive retries. The default is 1000 (milliseconds). This parameter is valid when <em class="parameter"><code>RetryOnConnectionFailure</code></em> is set to <code class="literal">true</code>.
						</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.destination">
      ⁠</a>5.9. Configuring Destinations</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="conf.preconf.destinations">
      ⁠</a>5.9.1. Pre-configured destinations</h2></div></div></div><div class="para">
				JBoss Messaging ships with a default set of preconfigured destinations that are deployed at server start-up. The configuration information for these destinations can be found in the following section of <code class="filename">destinations-service.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- The Default Dead Letter Queue. This destination is a dependency of an EJB MDB container. --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.destination.QueueService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      name=</span><span xmlns="" class="perl_String">"jboss.messaging.destination:service=Queue,name=DLQ"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/Queue-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"ServerPeer"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.messaging:service=ServerPeer<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.messaging:service=PostOffice<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- The Default Expiry Queue --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.destination.QueueService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      name=</span><span xmlns="" class="perl_String">"jboss.messaging.destination:service=Queue,name=ExpiryQueue"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/Queue-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"ServerPeer"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.messaging:service=ServerPeer<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.messaging:service=PostOffice<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140038197909632">
      ⁠</a>5.9.2. Configuring Queues</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="conf.destination.queue">
      ⁠</a>5.9.2.1. Queue MBean Attributes</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><div class="para">
								Defines the queue name.
							</div></dd><dt><span class="term">JNDIName</span></dt><dd><div class="para">
								Defines the JNDI name that binds the queue.
							</div></dd><dt><span class="term">DLQ</span></dt><dd><div class="para">
								Defines the DLQ (Dead Letter Queue) for this queue and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">ExpiryQueue</span></dt><dd><div class="para">
								Defines the expiry queue and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">RedeliveryDelay</span></dt><dd><div class="para">
								Defines the redelivery delay to be applied to this queue and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">MaxDeliveryAttempts</span></dt><dd><div class="para">
								Defines the maximum number of times message delivery is attempted before the message is sent to the DLQ, if configured. The default value, <code class="literal">-1</code>, means that the value from the Server Peer configuration file is used. Any other setting will override the value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">CreatedProgrammatically</span></dt><dd><div class="para">
								Returns <code class="literal">true</code> if the queue was created programmatically.
							</div></dd><dt><span class="term">MessageCount</span></dt><dd><div class="para">
								Returns the total number of messages in the queue. That is, the number of messages being scheduled plus the number being delivered, plus the number not being delivered.
							</div></dd><dt><span class="term">ScheduledMessageCount</span></dt><dd><div class="para">
								Returns the number of <span class="emphasis"><em>scheduled messages</em></span> in the queue. This is the number of messages scheduled to be delivered at a later date.
							</div><div class="para">
								Scheduled delivery lets you specify the earliest time at which a particular message will be delivered. For example, you can send a message now, and specify that it will not be delivered for two hours. To do so, set the following in the message header:
							</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">long</span> now = System.<span xmlns="" class="perl_Function">currentTimeMillis</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Message msg = sess.<span xmlns="" class="perl_Function">createMessage</span>();  
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>msg.<span xmlns="" class="perl_Function">setLongProperty</span>(JBossMessage.<span xmlns="" class="perl_Function">JMS_JBOSS_SCHEDULED_DELIVERY_PROP_NAME</span>,
<span xmlns="" class="line">​</span>  now + <span xmlns="" class="perl_Float">1000</span> * <span xmlns="" class="perl_Float">60</span> * <span xmlns="" class="perl_Float">60</span> * <span xmlns="" class="perl_Float">2</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>prod.<span xmlns="" class="perl_Function">send</span>(msg);
</pre></dd><dt><span class="term">MaxSize</span></dt><dd><div class="para">
								Specifies the maximum number of messages that can be held in a queue. Any excess messages will be dropped. The default value is <code class="literal">-1</code>, which is unbounded.
							</div></dd><dt><span class="term">Clustered</span></dt><dd><div class="para">
								This attribute must be set to <code class="literal">true</code> if the destination is clustered.
							</div></dd><dt><span class="term">MessageCounter</span></dt><dd><div class="para">
								Each queue maintains a message counter.
							</div></dd><dt><span class="term">MessageCounterStatistics</span></dt><dd><div class="para">
								The statistics for the message counter.
							</div></dd><dt><span class="term">MessageCounterHistoryDayLimit</span></dt><dd><div class="para">
								The maximum number of days for which to hold message counter history. Overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">ConsumerCount</span></dt><dd><div class="para">
								The number of consumers currently consuming from the queue.
							</div></dd><dt><span class="term">DropOldMessageOnRedeploy</span></dt><dd><div class="para">
								Specifies how queue services with clustered attributes that differ from previously deployed attributes are handled. If set to <code class="literal">true</code>, all remaining messages in the queue are deleted after the queue service re-deployment if the queue service attribute contains a different clustered attribute. If set to <code class="literal">false</code> (default), all messages are reserved.
							</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning - Redeployment Considerations</strong></p></div><div class="admonition"><div class="para">
						When you re-deploy a destination, you must shut down all the nodes in the cluster, make proper configuration changes, and then restart the nodes.
					</div><div class="para">
						Redeploying from a non-clustered to a clustered queue requires you set the clustered attribute to <code class="literal">true</code>, and add the queue service configuration to each node.
					</div><div class="para">
						Redeploying from a clustered to a non-clustered queue requires you set the clustered attribute to <code class="literal">false</code> in one of the queue configurations and delete all other queues in the cluster.
					</div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="conf.destination.queue.attributes.security">
      ⁠</a>5.9.2.1.1. Destination Security Configuration</h4></div></div></div><div class="para">
						<span class="markup">&lt;SecurityConfig&gt;</span> determines which roles can read, write and create upon the destination. It uses the same syntax and semantics as JBossMQ destination security configuration.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;SecurityConfig&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;security&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;role</span><span xmlns="" class="perl_Others"> read=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> write=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> create=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/security&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;SecurityConfig&gt;</span></pre><div class="para">
						The <span class="markup">&lt;SecurityConfig&gt;</span> element must contain one <span class="markup">&lt;security&gt;</span> element, which can contain multiple <span class="markup">&lt;role&gt;</span> elements. A <span class="markup">&lt;role&gt;</span> element defines the access type for that particular role using the following attributes:
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">read</span></dt><dd><div class="para">
									Specifies the role can create consumers, receive messages, and browse the destination.
								</div></dd><dt><span class="term">write</span></dt><dd><div class="para">
									Specifies the role can create producers, or send messages to the destination.
								</div></dd><dt><span class="term">create</span></dt><dd><div class="para">
									Specifies the role can create durable subscriptions on this destination.
								</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Configuring security for a destination is optional. If a <code class="literal">SecurityConfig</code> element is not specified, then the default security configuration from the Server Peer will be used instead.
						</div></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="conf.destination.queue.attributes.paging">
      ⁠</a>5.9.2.1.2. Destination paging parameters</h4></div></div></div><div class="para">
						<span class="emphasis"><em>Pageable Channels</em></span> is a JBoss Messaging feature that lets you specify a maximum number of messages to be stored in memory at one time, on a queue-by-queue or topic-by-topic basis. JBoss Messaging then pages messages to and from storage transparently in blocks. This allows queues and subscriptions to grow to very large sizes without any degradation in performance as channel size increases.
					</div><div class="para">
						The individual parameters associated with pageable channels are as follows:
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">FullSize</span></dt><dd><div class="para">
									Specifies the maximum number of messages held by the queue or topic subscription in memory at any one time. The actual queue can hold more messages, but these are paged to and from storage as messages are added or consumed. If no value is specified, the default is <code class="literal">75000</code>.
								</div></dd><dt><span class="term">PageSize</span></dt><dd><div class="para">
									Specifies the maximum number of messages that are pre-loaded per operation when loading messages from the queue or subscription. If no value is specified, the default is <code class="literal">2000</code>.
								</div></dd><dt><span class="term">DownCacheSize</span></dt><dd><div class="para">
									Specifies the maximum number of messages the Down Cache holds before the messages are flushed to storage. The default value is <code class="literal">2000</code> messages.
								</div><div class="para">
									When messages are paged to storage from the queue, they enter a <span class="emphasis"><em>Down Cache</em></span> before being written to storage. This enables the write to occur as a single operation, which aids performance.
								</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
										Paging parameters for temporary queues must be specified on the appropriate connection factory. Refer to <a class="xref" href="configuration.html#conf.connectionfactory">Section 5.10, “Configuring Connection Factories”</a> for detailed information about the different connection factories available.
									</div></div></div><div class="para">

								</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="conf.destination.queue.operations">
      ⁠</a>5.9.2.1.3. Queue Managed Bean Operations</h4></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">RemoveAllMessages</span></dt><dd><div class="para">
									Removes (and deletes) all messages from the queue.
								</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
										This will permanently delete all messages from the queue; use this operation with caution.
									</div></div></div></dd><dt><span class="term">ListAllMessages</span></dt><dd><div class="para">
									Lists all messages currently in the queue. Using a JMS selector as an argument in this operation lets you retrieve a subset of the messages in the queue that match the given criteria.
								</div></dd><dt><span class="term">ListDurableMessages</span></dt><dd><div class="para">
									Lists all <span class="emphasis"><em>durable</em></span> messages in the queue. Using a JMS selector as an argument in this operation lets you retrieve a subset of messages in the queue that match the given criteria.
								</div></dd><dt><span class="term">ListNonDurableMessages</span></dt><dd><div class="para">
									Lists all <span class="emphasis"><em>non-durable</em></span> messages in a queue. Using a JMS selector as an argument in this operation lets you retrieve a subset of messages in the queue that match the given criteria.
								</div></dd><dt><span class="term">ResetMessageCounter</span></dt><dd><div class="para">
									Resets the message counter to zero.
								</div></dd><dt><span class="term">ResetMessageCounterHistory</span></dt><dd><div class="para">
									Resets the message counter history.
								</div></dd><dt><span class="term">ListMessageCounterAsHTML</span></dt><dd><div class="para">
									Lists the message counter in HTML format.
								</div></dd><dt><span class="term">ListMessageCounterHistoryAsHTML</span></dt><dd><div class="para">
									Lists the message counter history in HTML format.
								</div></dd></dl></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="conf.destination.topics">
      ⁠</a>5.9.3. Configuring Topics</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="conf.destination.topic.attributes">
      ⁠</a>5.9.3.1. Topic Managed Bean Attributes</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><div class="para">
								Defines the name of the topic.
							</div></dd><dt><span class="term">JNDIName</span></dt><dd><div class="para">
								Defines the JNDI location where the topic is bound.
							</div></dd><dt><span class="term">DLQ</span></dt><dd><div class="para">
								Defines the Dead Letter Queue (DLQ) used for this topic and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">ExpiryQueue</span></dt><dd><div class="para">
								Defines the expiry queue used for this topic and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">RedeliveryDelay</span></dt><dd><div class="para">
								Defines the delay period between redelivery attempts for this topic and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">MaxDeliveryAttempts</span></dt><dd><div class="para">
								Defines the maximum number of times message delivery will be attempted before the message is sent to the DLQ, if configured. The default value is <code class="literal">-1</code>, which specifies that the value from the Server Peer configuration file be used. Any other setting overrides the Server Peer value.
							</div></dd><dt><span class="term">CreatedProgrammatically</span></dt><dd><div class="para">
								Returns <code class="literal">true</code> if the topic was created programmatically.
							</div></dd><dt><span class="term">MaxSize</span></dt><dd><div class="para">
								Specifies the maximum number of messages that can be held in a topic subscription. Any excess messages will be dropped from the topic. The default value is <code class="literal">-1</code>, which applies no size restriction.
							</div></dd><dt><span class="term">Clustered</span></dt><dd><div class="para">
								Set this to <code class="literal">true</code> if your destination is clustered.
							</div></dd><dt><span class="term">MessageCounterHistoryDayLimit</span></dt><dd><div class="para">
								Defines the maximum number of days to retain message counter history, and overrides any value set in the Server Peer configuration file.
							</div></dd><dt><span class="term">MessageCounters</span></dt><dd><div class="para">
								Returns a list of message counters for the topic's subscriptions.
							</div></dd><dt><span class="term">AllMessageCount</span></dt><dd><div class="para">
								Returns the total number of messages in all subscriptions belonging to the topic.
							</div></dd><dt><span class="term">DurableMessageCount</span></dt><dd><div class="para">
								Returns the total number of <span class="emphasis"><em>durable</em></span> messages in all subscriptions belonging to this topic.
							</div></dd><dt><span class="term">NonDurableMessageCount</span></dt><dd><div class="para">
								Returns the total number of <span class="emphasis"><em>non-durable</em></span> messages in all subscriptions belonging to this topic.
							</div></dd><dt><span class="term">DropOldMessageOnRedeploy</span></dt><dd><div class="para">
								Specifies how queue services with clustered attributes that differ from previously deployed attributes are handled. If set to <code class="literal">true</code>, all remaining messages in the queue are deleted after the queue service re-deployment if the queue service attribute contains a different clustered attribute. If set to <code class="literal">false</code> (default), all messages are reserved.
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning - Redeployment Considerations</strong></p></div><div class="admonition"><div class="para">
									When you re-deploy a destination, you must shut down all the nodes in the cluster, make proper configuration changes, and then restart the nodes.
								</div><div class="para">
									Redeploying from a non-clustered to a clustered queue requires you set the clustered attribute to <code class="literal">true</code>, and add the queue service configuration to each node.
								</div><div class="para">
									Redeploying from a clustered to a non-clustered queue requires you set the clustered attribute to <code class="literal">false</code> in one of the queue configurations and delete all other queues in the cluster.
								</div></div></div></dd><dt><span class="term">AllSubscriptionsCount</span></dt><dd><div class="para">
								Returns a count of all subscriptions belonging to this topic.
							</div></dd><dt><span class="term">DurableSubscriptionsCount</span></dt><dd><div class="para">
								Returns a count of all durable subscriptions belonging to this topic.
							</div></dd><dt><span class="term">NonDurableSubscriptionsCount</span></dt><dd><div class="para">
								Returns a count of all non-durable subscriptions belonging to this topic.
							</div></dd></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="conf.destination.topic.attributes.security">
      ⁠</a>5.9.3.1.1. Destination Security Configuration</h4></div></div></div><div class="para">
						<span class="markup">&lt;SecurityConfig&gt;</span> determines which roles can read, write and create upon the destination. It uses the same syntax and semantics as JBossMQ destination security configuration.
					</div><div class="para">
						The <span class="markup">&lt;SecurityConfig&gt;</span> element must contain one <span class="markup">&lt;security&gt;</span> element, which can contain multiple <span class="markup">&lt;role&gt;</span> elements. A <span class="markup">&lt;role&gt;</span> element defines the access type for that particular role using the following attributes:
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">read</span></dt><dd><div class="para">
									Specifies the role can create consumers, receive messages, and browse the destination.
								</div></dd><dt><span class="term">write</span></dt><dd><div class="para">
									Specifies the role can create producers, or send messages to the destination.
								</div></dd><dt><span class="term">create</span></dt><dd><div class="para">
									Specifies the role can create durable subscriptions on this destination.
								</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Configuring security for a destination is optional. If a <code class="literal">SecurityConfig</code> element is not specified, then the default security configuration from the Server Peer will be used instead.
						</div></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="sect-Destination_Paging_Parameters">
      ⁠</a>5.9.3.1.2. Destination paging parameters</h4></div></div></div><div class="para">
						Previously, for an application to support a queue or subscription, the queue needed to be stored entirely in memory. This was not always possible for very large queues or subscriptions.
					</div><div class="para">
						<span class="emphasis"><em>Pageable Channels</em></span> is a new JBoss Messaging feature that lets you specify a maximum number of messages to be stored in memory at one time, on a queue-by-queue or topic-by-topic basis. JBoss Messaging then pages messages to and from storage transparently in blocks. This allows queues and subscriptions to grow to very large sizes without any degradation in performance as channel size increases. It has been tested with queues in excess of ten million 2 kilobyte messages on very basic hardware, and has the potential to scale to much greater message numbers.
					</div><div class="para">
						The individual parameters associated with pageable channels are as follows:
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">FullSize</span></dt><dd><div class="para">
									Specifies the maximum number of messages held by the queue or topic subscription in memory at any one time. The actual queue can hold more messages, but these are paged to and from storage as messages are added or consumed. If no value is specified, the default is <code class="literal">75000</code>.
								</div></dd><dt><span class="term">PageSize</span></dt><dd><div class="para">
									Specifies the maximum number of messages that are pre-loaded per operation when loading messages from the queue or subscription. If no value is specified, the default is <code class="literal">2000</code>.
								</div></dd><dt><span class="term">DownCacheSize</span></dt><dd><div class="para">
									Specifies the maximum number of messages the Down Cache holds before the messages are flushed to storage. The default value is <code class="literal">2000</code> messages.
								</div><div class="para">
									When messages are paged to storage from the queue, they enter a <span class="emphasis"><em>Down Cache</em></span> before being written to storage. This enables the write to occur as a single operation, which aids performance.
								</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
										Paging parameters for temporary queues must be specified on the appropriate connection factory. See the section on Connection Factory Configuration for details.
									</div></div></div><div class="para">

								</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="conf.destination.topic.operations">
      ⁠</a>5.9.3.2. Topic Managed Bean Operations</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">RemoveAllMessages</span></dt><dd><div class="para">
								Removes (and deletes) all messages from subscriptions that belong to this topic.
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
									This will permanently delete all messages from the topic; use this operation with caution.
								</div></div></div></dd><dt><span class="term">ListAllMessages</span></dt><dd><div class="para">
								Lists all messages belonging to a specified subscription. Using a JMS selector as an argument in this operation lets you retrieve a subset of messages in the queue that match the given criteria.
							</div></dd><dt><span class="term">ListDurableMessages</span></dt><dd><div class="para">
								Lists all durable messages belonging to the specified subscription. Using a JMS selector as an argument in this operation lets you retrieve a subset of messages in the queue that match the given criteria.
							</div></dd><dt><span class="term">ResetMessageCounter</span></dt><dd><div class="para">
								Resets the message counter to zero.
							</div></dd><dt><span class="term">ResetMessageCounterHistory</span></dt><dd><div class="para">
								Resets the message counter history.
							</div></dd><dt><span class="term">ListAllSubscriptionsAsHTML</span></dt><dd><div class="para">
								Lists all subscriptions belonging to this topic in HTML format.
							</div></dd><dt><span class="term">ListDurableSubscriptionsAsHTML</span></dt><dd><div class="para">
								Lists all durable subscriptions belonging to this topic in HTML format.
							</div></dd><dt><span class="term">ListNonDurableSubscriptions</span></dt><dd><div class="para">
								Lists all non-durable messages belonging to the specified subscription. Using a JMS selector as an argument in this operation lets you retrieve a subset of messages in the queue that match the given criteria.
							</div></dd><dt><span class="term">ListNonDurableSubscriptionsAsHTML</span></dt><dd><div class="para">
								Lists all non-durable subscriptions belonging to this topic in HTML format.
							</div></dd></dl></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.connectionfactory">
      ⁠</a>5.10. Configuring Connection Factories</h1></div></div></div><div class="para">
			JBoss Messaging is configured by default to bind two connection factories in JNDI upon start up.
		</div><div class="para">
			The first connection factory is the default, non-clustered connection factory. This connection factory is provided to maintain compatibility with applications originally written against JBossMQ, which does not include automatic failover or load balancing. If you do not require client-side automatic failover or load balancing, then you should use this first connection factory.
		</div><div class="para">
			The first connection factory is bound into the following JNDI contexts:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="literal">/ConnectionFactory</code>
				</div></li><li class="listitem"><div class="para">
					<code class="literal">/XAConnectionFactory</code>
				</div></li><li class="listitem"><div class="para">
					<code class="literal">java:/ConnectionFactory</code>
				</div></li><li class="listitem"><div class="para">
					<code class="literal">java:/XAConnectionFactory</code>.
				</div></li></ul></div><div class="para">
			The second connection factory is the default clustered connection factory, which is bound into the following JNDI contexts:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="literal">/ClusteredConnectionFactory</code>
				</div></li><li class="listitem"><div class="para">
					<code class="literal">/ClusteredXAConnectionFactory</code>
				</div></li><li class="listitem"><div class="para">
					<code class="literal">java:/ClusteredConnectionFactory</code>
				</div></li><li class="listitem"><div class="para">
					<code class="literal">java:/ClusteredXAConnectionFactory</code>
				</div></li></ul></div><div class="para">
			If you want to provide a default client ID for a connection factory, or bind a connection factory to a different JNDI locationConsider, then configure and deploy additional connection factories. To deploy a new connection factory, configure a new <code class="literal">ConnectionFactory</code> managed bean in <code class="filename">connection-factories-service.xml</code>.
		</div><div class="para">
			You can also create a new service deployment descriptor, <code class="filename"><em class="replaceable">&lt;name&gt;</em>-service.xml</code>, and deploy it in <code class="filename">$JBOSS_HOME/server/messaging/deploy</code>.
		</div><div class="para">
			Enable support for automatic failover or load balancing by setting the relevant attributes in your connection factory:
		</div><div class="example"><a id="idm140038244901392">
      ⁠</a><p class="title"><strong>Example 5.1. Connection Factory</strong></p><div class="example-contents"><div class="para">
				This example connection factory creates a connection factory with the preconfigured client ID <code class="literal">myClientID</code>, which is bound to two locations in the JNDI tree: <code class="literal">/MyConnectionFactory</code> and <code class="literal">/factories/cf</code>.
			</div><div class="para">
				The example overrides the following default values:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="varname">PreFetchSize</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">DefaultTempQueueFullSize</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">DefaultTempQueuePageSize</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">DefaultTempQueueDownCacheSize</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">DupsOKBatchSize</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">SupportsFailover</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">SupportsLoadBalancing</code>
					</div></li><li class="listitem"><div class="para">
						<code class="varname">LoadBalancingFactory</code>
					</div></li></ul></div><div class="para">
				The connection factory uses the default remoting connector. To use a different remoting connector with the connection factory, change the <code class="literal">Connector</code> attribute to specify the service name of the connector you wish to use.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.connectionfactory.ConnectionFactory"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.messaging.connectionfactory:service=MyConnectionFactory"</span><span xmlns="" class="perl_Others"> xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/ConnectionFactory-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"ServerPeer"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=ServerPeer
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"Connector"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=Connector,transport=bisocket
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.messaging:service=PostOffice<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIBindings"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;bindings&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;binding&gt;</span>/MyConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/binding&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;binding&gt;</span>/factories/cf<span xmlns="" class="perl_Keyword">&lt;/binding&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/bindings&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ClientID"</span><span xmlns="" class="perl_Keyword">&gt;</span>myClientID<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SupportsFailover"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SupportsLoadBalancing"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>  
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"LoadBalancingFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    org.acme.MyLoadBalancingFactory
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PrefetchSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SlowConsumers"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"StrictTck"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SendAcksAsync"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultTempQueueFullSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>50000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultTempQueuePageSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultTempQueueDownCacheSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DupsOKBatchSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-ConnectionFactory_Managed_Bean_Attributes">
      ⁠</a>5.10.1. ConnectionFactory Managed Bean Attributes</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">ClientID</span></dt><dd><div class="para">
							You can preconfigure a connection factory with a client ID. Any connection created via this connection factory will obtain this client ID.
						</div></dd><dt><span class="term">JNDIBindings</span></dt><dd><div class="para">
							Lists available JNDI bindings for this connection factory.
						</div></dd><dt><span class="term">PrefetchSize</span></dt><dd><div class="para">
							Specifies how many messages the window holds at once, for consumer flow control. The window size determines the number of messages a server can send to a consumer without blocking. Each consumer maintains a buffer of messages from which it consumes.
						</div><div class="para">
							Transmission Control Protocol (TCP) implements its own additional flow control. Message consumption can also be blocked if the TCP window size is smaller than the <em class="parameter"><code>PrefetchSize</code></em> parameter.
						</div></dd><dt><span class="term">SlowConsumers</span></dt><dd><div class="para">
							Specifies whether the allowable buffer size for slow consumers is reduced. Reducing the buffer size for slow consumers results in minimized to increase the potential for messages to be consumed by faster consumers. It is not possible to totally disable buffering, however, setting the <code class="varname">SlowConsumers</code> attribute to <code class="literal">true</code> will reduce the buffer size. Setting this attribute to <code class="literal">true</code> is equivalent to setting <code class="varname">PrefetchSize</code> to <code class="literal">1</code> which is the lowest possible value available.
						</div></dd><dt><span class="term">StrictTck</span></dt><dd><div class="para">
							Enables strict JMS behavior if the attribute is set to <code class="literal">true</code>. Strict JMS behavior is required by the Technology Compatibility Kit (TCK).
						</div></dd><dt><span class="term">SendAcksAsync</span></dt><dd><div class="para">
							Specifies acknowledgments are sent asynchronously if the attribute is set to <code class="literal">true</code>. This can improve performance, particularly if <code class="literal">auto_acknowledge</code> mode is active.
						</div></dd><dt><span class="term">DefaultTempQueueFullSize</span></dt><dd><div class="para">
							Optional attribute that specifies the paging parameters for temporary full size queue destinations, which are scoped to connections created with this connection factory. The default value is <code class="literal">200000</code>. For more information about these attributes, refer to <a class="xref" href="configuration.html#sect-Destination_Paging_Parameters">Section 5.9.3.1.2, “Destination paging parameters”</a>.
						</div></dd><dt><span class="term">DefaultTempQueuePageSize</span></dt><dd><div class="para">
							Optional attribute that specifies the paging parameters for temporary page size destinations, which are scoped to connections created with this connection factory. The default value is <code class="literal">2000</code>. For more information about these attributes, refer to <a class="xref" href="configuration.html#sect-Destination_Paging_Parameters">Section 5.9.3.1.2, “Destination paging parameters”</a>.
						</div></dd><dt><span class="term">DefaultTempQueueDownCacheSize</span></dt><dd><div class="para">
							Optional attribute that specifies the paging parameters for temporary down cache size destinations, which are scoped to connections created with this connection factory. The default value is <code class="literal">2000</code>. For more information about these attributes, refer to <a class="xref" href="configuration.html#sect-Destination_Paging_Parameters">Section 5.9.3.1.2, “Destination paging parameters”</a>.
						</div></dd><dt><span class="term">DupsOKBatchSize</span></dt><dd><div class="para">
							Specifies the number of <code class="literal">DUPS_OK_ACKNOWLEDGE</code> acknowledgments that are buffered locally before they are sent. The default value is <code class="literal">2000</code>.
						</div></dd><dt><span class="term">SupportsLoadBalancing</span></dt><dd><div class="para">
							Specifies whether client-side load balancing is enabled for the connection factory on clustered installations. If load balancing is enabled, any connection created by that connection factory will be load-balanced across the nodes of a cluster. A connection created on a particular node remains on that node. The default value is <code class="literal">false</code>.
						</div></dd><dt><span class="term">SupportsFailover</span></dt><dd><div class="para">
							Specifies whether client-side automatic failover is enabled for the connection factory on clustered installations. If automatic failover is enabled, JBoss Messaging will automatically and transparently failover to another node in the cluster when a connection problem is detected. The default value is <code class="literal">false</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
								When automatic failover is disabled, the user code is responsible for catching connection exceptions in synchronous JMS operations, and a JMS <code class="literal">ExceptionListener</code> must be installed to catch exceptions asynchronously. When an exception is caught, the client-side code must look up a new connection factory via HAJNDI and recreate the connection.
							</div></div></div></dd><dt><span class="term">DisableRemotingChecks</span></dt><dd><div class="para">
							Specifies whether the connection factory checks that the corresponding JBoss Remoting Connector uses sensible values. JBoss Messaging is very sensitive to these values, and there is rarely any need to change them. To disable this sanity checking, set <code class="varname">DisableRemotingChecks</code> to <code class="literal">false</code>. The default value is <code class="literal">true</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
								Do not disable the remoting checks; system instability.
							</div></div></div></dd><dt><span class="term">LoadBalancingFactory</span></dt><dd><div class="para">
							Specifies the client-side load balancing factory implementation used by the connection factory. The value must correspond to the name of a class that implements the interface <code class="literal">org.jboss.jms.client.plugin.LoadBalancingFactory</code>.
						</div><div class="para">
							The default value is <code class="literal">org.jboss.jms.client.plugin.RoundRobinLoadBalancingFactory</code>, which load-balances connections across the cluster in a round-robin fashion.
						</div></dd><dt><span class="term">Connector</span></dt><dd><div class="para">
							Specifies the remoting connector used by the connection factory. Different connection factories can use different connectors, so you can deploy one connection factory that uses the HTTP transport to communicate with the server, and another that uses the bisocket transport to communicate.
						</div></dd><dt><span class="term">EnableOrderingGroup</span></dt><dd><div class="para">
							Specifies whether strict message ordering is enabled on the <code class="literal">ConnectionFactory</code>. If set to <code class="literal">true</code>, any messages sent from producers which are created from the enabled connection factory become ordering group messages. The default value for this parameter is <code class="literal">false</code>.
						</div></dd><dt><span class="term">DefaultOrderingGroupName</span></dt><dd><div class="para">
							Specifies the default name for the message ordering group. The specified name will take effect once the <code class="literal">EnableOrderingGroup</code> parameter is set to <code class="literal">true</code> . If this attribute is missing, the group name will be generated automatically.
						</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.connector">
      ⁠</a>5.11. Configuring the Remoting Connector</h1></div></div></div><div class="para">
			JBoss Messaging uses JBoss Remoting for all communication between the client and the server.
		</div><div class="para">
			For more information about JBoss Remoting configuration and capabilities, refer to the <em class="citetitle">Remoting</em> chapter in the <em class="citetitle">Administration and Configuration Guide</em>.
		</div><div class="para">
			The default configuration includes one remoting connector, which is used by the single default connection factory. Each connection factory can be configured to use a different connector.
		</div><div class="para">
			The default connector is configured to use the remoting bisocket transport, a TCP socket-based transport that listens and accepts connections only on the server side. That is, connections are always initiated from the client side. This connector is ideal for typical firewall scenarios, where only inbound connections are allowed on the server, or where only outbound connections are allowed from the client.
		</div><div class="para">
			The bisocket transport can be configured to use SSL when a higher level of security is required.
		</div><div class="para">
			The other supported transport is the HTTP transport, which uses the Hypertext Transfer Protocol to communicate between client and server. The client periodically polls the server for messages to receive data. This transport is ideal when a firewall between server and client allows only incoming HTTP traffic on the server. Because of its polling behavior and the limitations of HTTP, this transport does not perform as well as the bisocket transport. It is not designed to handle high-load situations.
		</div><div class="para">
			No other remoting transports are currently supported by JBoss Messaging.
		</div><div class="para">
			Remoting configuration details can be seen in <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">$SERVER</em>/deploy/messaging/remoting-bisocket-service.xml</code>. The following code is an example of a bisocket remoting configuration:
		</div><div class="example"><a id="exam-Bisocket_Remoting_Example">
      ⁠</a><p class="title"><strong>Example 5.2. Bisocket Remoting Configuration</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Standard bisocket-based Remoting service deployment descriptor. $Id: </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> remoting-bisocket-service.xml 3981 2008-03-28 18:00:41Z timfox $ --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;server&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Comment">&lt;!-- Standard bisocket connector - the bisocket transport only opens connection </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  from client-&gt;server so can be used with firewalls where only outgoing connections </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  are allowed. For examples of HTTP and SSL transports see docs/examples --&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.remoting.transport.Connector"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=Connector,transport=bisocket"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  display-name=</span><span xmlns="" class="perl_String">"Bisocket Transport Connector"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;config&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;invoker</span><span xmlns="" class="perl_Others"> transport=</span><span xmlns="" class="perl_String">"bisocket"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- There should be no reason to change these parameters - warning! </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      Changing them may stop JBoss Messaging working correctly --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"marshaller"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.wireformat.JMSWireFormat
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"unmarshaller"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.wireformat.JMSWireFormat
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dataType"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>jms<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"socket.check_connection"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serverBindAddress"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.bind.address}<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serverBindPort"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.messaging.connector.bisocket.port:4457}
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"clientSocketClass"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     org.jboss.jms.client.remoting.ClientSocketWrapper
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serverSocketClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.server.remoting.ServerSocketWrapper
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"onewayThreadPool"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.server.remoting.DirectThreadPool
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- the following parameters are useful when there is a firewall between </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      client and server. Uncomment them if so. --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- &lt;attribute name="numberOfCallRetries" isParam="true"&gt;1&lt;/attribute&gt; </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      &lt;attribute name="pingFrequency" isParam="true"&gt;214748364&lt;/attribute&gt; </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      &lt;attribute name="pingWindowFactor" isParam="true"&gt;10&lt;/attribute&gt; </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      &lt;attribute name="generalizeSocketException" isParam="true"&gt;true&lt;/attribute&gt; --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- Now remoting supports socket write timeout configuration. Uncomment </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      this if you need it. --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- &lt;attribute name="writeTimeout" isParam="true"&gt;30000&lt;/attribute&gt; --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- End immutable parameters --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"stopLeaseOnFailure"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- Periodicity of client pings. Server window by default is twice </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      this figure --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"clientLeasePeriod"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"validatorPingPeriod"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"validatorPingTimeout"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"failureDisconnectTimeout"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"callbackErrorsAllowed"</span><span xmlns="" class="perl_Keyword">&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"registerCallbackListener"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useClientConnectionIdentity"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"timeout"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- Max Number of connections in client pool. This should be significantly </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      higher than the max number of sessions/consumers you expect --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JBM_clientMaxPoolSize"</span><span xmlns="" class="perl_Others"> isParam=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>200<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- The maximum time to wait before timing out on trying to write a </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      message to socket for delivery --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"callbackTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>10000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- Use these parameters to specify values for binding and connecting </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      control connections to work with your firewall/NAT configuration </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      &lt;attribute name="secondaryBindPort"&gt;xyz&lt;/attribute&gt; </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      &lt;attribute name="secondaryConnectPort"&gt;abc&lt;/attribute&gt; --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/invoker&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;handlers&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;handler</span><span xmlns="" class="perl_Others"> subsystem=</span><span xmlns="" class="perl_String">"JMS"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.server.remoting.JMSServerInvocationHandler
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/handler&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/handlers&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/config&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/server&gt;</span>
</pre></div></div><div class="para">
			There are restricted attributes that should not be changed unless you are absolutely confident you understand the impact of the changes. The following attributes are safe to change and configure to the requirements of your project:
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">clientLeasePeriod</span></dt><dd><div class="para">
						Clients periodically return <span class="emphasis"><em>heartbeats</em></span> to the server to confirm that they are still active. If the server does not receive a heartbeat after a certain period of time, it will close down the connection and remove all resources that correspond to the client's session. The <code class="varname">clientLeasePeriod</code> determines the period of time between heartbeats, in milliseconds. The default value is <code class="literal">10000</code>.
					</div><div class="para">
						By default, the server closes a client if it does not receive a heartbeat within double the <code class="varname">clientLeasePeriod</code>. In reality, the period is automatically resized according to system load.
					</div></dd><dt><span class="term">numberOfRetries</span></dt><dd><div class="para">
						The number of seconds JBoss Remoting blocks on the client pool while waiting for a connection to become available. If you have a very large number of sessions concurrently accessing the server from a client and cannot obtain connections from the pool, you may want to increase this value.
					</div></dd><dt><span class="term">clientMaxPoolSize</span></dt><dd><div class="para">
						JBoss Remoting maintains a client-side pool of TCP connections on which to service requests. If you have a large number of sessions concurrently accessing the server from a client and cannot obtain connections from the pool, you may want to increase this value.
					</div></dd><dt><span class="term">secondaryBindPort</span></dt><dd><div class="para">
						The bisocket transport uses control connections to pass control messages between server and client. This attribute defines the address to which the secondary <code class="literal">ServerSocket</code> is bound. Its value is random by default. To work behind a firewall, you need to set it to a particular value and create a rule for it in the firewall configuration. The recommended value is <code class="literal">4458</code> because the primary port is <code class="literal">4457</code>.
					</div></dd><dt><span class="term">secondaryConnectPort</span></dt><dd><div class="para">
						The port that the client uses to connect. Specify this to let your client work with NAT routers.
					</div></dd><dt><span class="term">maxPoolSize</span></dt><dd><div class="para">
						The number of threads used on the server side to service requests.
					</div></dd></dl></div><div class="para">
			By default, JBoss Messaging binds to <code class="literal">${jboss.bind.address}</code>, which can be defined by running the <code class="command">./run.sh -c <em class="replaceable">[yourconfig]</em> -b <em class="replaceable">[yourIP]</em></code> command.
		</div><div class="para">
			If necessary, you can change <code class="filename">remoting-bisocket-service.xml</code> to use a different communication port.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Do not change values in the connector configuration other than those listed above. Changing other values can cause JBoss Messaging to stop functioning correctly.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conf.servicebindingmanager">
      ⁠</a>5.12. ServiceBindingManager</h1></div></div></div><div class="para">
			The <code class="literal">SeviceBindingManager</code> provides multiple application server instances running on the same IP using different port ranges, which is useful during development. There are other ways to do this, but the <code class="literal">ServiceBindingManager</code> removes much hassle.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140038238316880">
      ⁠</a>5.13. Message Driven Beans</h1></div></div></div><div class="para">
			A message-driven bean is an enterprise bean that allows J2EE applications to process messages asynchronously. It acts as a JMS message listener, which is similar to an event listener except that it receives messages instead of events. The messages may be sent by any J2EE component--an application client, another enterprise bean, or a Web component--or by a JMS application or system that does not use J2EE technology. This definition is from <em class="citetitle"> <a href="http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/EJBConcepts5.html">http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/EJBConcepts5.html</a> </em>, and you can read more about message driven beans (MDB) from there.
		</div><div class="para">
			You can specify MDBs in a deployment descriptor or using annotations.
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Using a descriptor</span></dt><dd><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;message-driven&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>MDBExample<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;destination-jndi-name&gt;</span>queue/@QUEUE_NAME@<span xmlns="" class="perl_Keyword">&lt;/destination-jndi-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/message-driven&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/enterprise-beans&gt;</span></pre></dd><dt><span class="term">Using an annotation</span></dt><dd><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">MessageDriven</span>(mappedName=<span xmlns="" class="perl_String">"jms/Queue"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> SimpleMessageBean <span xmlns="" class="perl_Keyword">implements</span> MessageListener {
<span xmlns="" class="line">​</span>    @Resource
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> MessageDrivenContext mdc;
<span xmlns="" class="line">​</span>    ...</pre></dd></dl></div><div class="para">
			You configure MDBs using properties divided into those specified by the JCA specification, and those available as JBoss extensions.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				MDB properties listed in <a class="xref" href="configuration.html#table-MDB_JCA_Spec_Properties">Table 5.1, “MDB Properties Provided by the JCA Specification”</a> are not mandatory, unless explicitly called out in the Remarks column.
			</div></div></div><div class="table"><a id="table-MDB_JCA_Spec_Properties">
      ⁠</a><p class="title"><strong>Table 5.1. MDB Properties Provided by the JCA Specification</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols gt-7-rows" summary="MDB Properties Provided by the JCA Specification"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th> Name </th><th> Type </th><th> Default value </th><th> Remarks </th></tr></thead><tbody><tr><td> destination </td><td> java.lang.String </td><td> none </td><td> <div class="para">
							This property is Mandatory
						</div>
						 <div class="para">
							The JNDI name of the Queue or Topic.
						</div>
						 </td></tr><tr><td> destinationType </td><td> java.lang.String </td><td> none </td><td> <div class="para">
							The type of destination valid values are javax.jms.Queue or javax.jms.Topic
						</div>
						 </td></tr><tr><td> messageSelector </td><td> java.lang.String </td><td> none </td><td> <div class="para">
							The message selector of the subscription
						</div>
						 </td></tr><tr><td> acknowledgeMode </td><td> int </td><td> AUTO_ ACKNOWLEDGE </td><td> <div class="para">
							The type of acknowledgement when not using transacted jms - valid values AUTO_ ACKNOWLEDGE or DUPS_OK_ ACKNOWLEDGE
						</div>
						 </td></tr><tr><td> clientID </td><td> java.lang.String </td><td> </td><td> <div class="para">
							The client id of the connection
						</div>
						 </td></tr><tr><td> subscriptionDurability </td><td> String </td><td> NonDurable </td><td> <div class="para">
							Whether topic subscriptions are durable. Valid values are Durable or NonDurable
						</div>
						 </td></tr><tr><td> subscriptionName </td><td> String </td><td> none </td><td> <div class="para">
							The subscription name of the topic subscription
						</div>
						 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				MDB properties listed in <a class="xref" href="configuration.html#table-MDB_JBoss_Extension_Properties">Table 5.2, “MDB Properties Provided as JBoss Extensions”</a> are not mandatory, unless explicitly called out in the Remarks column.
			</div></div></div><div class="table"><a id="table-MDB_JBoss_Extension_Properties">
      ⁠</a><p class="title"><strong>Table 5.2. MDB Properties Provided as JBoss Extensions</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="gt-4-cols gt-14-rows" summary="MDB Properties Provided as JBoss Extensions"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th> Name </th><th> Type </th><th> Default value </th><th> Remarks </th></tr></thead><tbody><tr><td> isTopic </td><td> boolean </td><td> false </td><td> <div class="para">
							Sets the destinationType
						</div>
						 </td></tr><tr><td> providerAdapterJNDI </td><td> java.lang.String </td><td> DefaultJMSProvider </td><td> The JNDI name of the JMS provider. </td></tr><tr><td> user </td><td> java.lang.String </td><td> none </td><td> The user ID used to connect to the JMS server </td></tr><tr><td> pass </td><td> java.lang.String </td><td> none </td><td> The password of the user </td></tr><tr><td> maxMessages </td><td> int </td><td> 1 </td><td> <div class="para">
							Read this number of messages before delivering messages to the MDB.
						</div>
						 <div class="para">
							Each message is delivered individually on the same thread in an attempt to avoid context excessive context switching
						</div>
						 </td></tr><tr><td> minSession </td><td> int </td><td> 1 </td><td> The minimum number of JMS sessions that are available to concurrently deliver messages to this mdb </td></tr><tr><td> maxSession </td><td> int </td><td> 15 </td><td> The maximum number of JMS sessions that are available to concurrently deliver messages to this mdb </td></tr><tr><td> reconnectInterval </td><td> long </td><td> 10 seconds </td><td> The length of time in seconds between attempts to (re-)connect to the JMS provider </td></tr><tr><td> keepAlive </td><td> long </td><td> 60 seconds </td><td> The length of time in milliseconds that sessions over the minimum are kept alive </td></tr><tr><td> sessionTransacted </td><td> boolean </td><td> true </td><td> Whether the sessions are transacted </td></tr><tr><td> useDLQ </td><td> boolean </td><td> true </td><td> Whether to use a Dead Letter Queue (DLQ) handler. </td></tr><tr><td> dLQJNDIName </td><td> java.lang.String </td><td> queue/DLQ </td><td> The JNDI name of the DLQ </td></tr><tr><td> dLQHandler </td><td> java.lang.String </td><td> <div class="para">
							org.jboss.resource. adapter.jms.inflow.dlq. GenericDLQHandler
						</div>
						 </td><td> The org.jboss.resource. adapter.jms.inflow. DLQHandler implementation class name. </td></tr><tr><td> dLQUser </td><td> java.lang.String </td><td> none </td><td> The user id used to make the dlq connection to the JMS server </td></tr><tr><td> dLQPassword </td><td> java.lang.String </td><td> none </td><td> The password of the dLQUser </td></tr><tr><td> dLQClientID </td><td> java.lang.String </td><td> none </td><td> The client id of the DLQ connection </td></tr><tr><td> dLQMaxResent </td><td> int </td><td> 5 </td><td> The maximum number of times a message is redelivered before it is sent to the DLQ. </td></tr><tr><td> redeliverUnspecified </td><td> boolean </td><td> true </td><td> Whether to attempt to redeliver a message in an unspecified transaction context </td></tr><tr><td> transactionTimeout </td><td> int </td><td> Default is the timeout set for the resource manager </td><td> Time in seconds for the transaction timeout </td></tr><tr><td> DeliveryActive </td><td> boolean </td><td> true </td><td> Whether the MDB should make the subscription at initial deployment or wait for start() or stopDelivery() on the corresponding MBean. You can set this to false if you want to prevent messages from being delivered to the MDB (which is still starting) during server start up. </td></tr></tbody></table></div></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuring default MDB properties</div>
				You can configure MDBs to have default properties using the <code class="systemitem">@org.jboss.ejb3.annotation.DefaultActivationSpecs</code> annotations.
			</div></div></div></body></html>