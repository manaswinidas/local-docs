<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 6. Clustering Notes</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="c_configuration">
      ⁠</a>Chapter 6. Clustering Notes</h1></div></div></div><div class="para">
		To help locate clustering-related information, a summary of each consideration is provided in this part of the guide with links to the related components of JBoss Messaging.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Unique_Server_Peer_ID">
      ⁠</a>6.1. Unique Server Peer ID</h1></div></div></div><div class="para">
			In most cases, JBoss Messaging works in a clustered environment with minimal configuration changes. One crucial change that must be made is that every node is assigned a unique server ID.
		</div><div class="para">
			Every deployed node must have a unique ID, including nodes that form a LAN cluster and nodes linked by message bridges.
		</div><div class="para">
			The <em class="parameter"><code>ServerPeerID</code></em> attribute is used to set this information. Refer to <a class="xref" href="configuration.html#sect-ServerPeer_Attributes">Section 5.2, “ServerPeer attributes”</a> for further information.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Clustered_Destinations">
      ⁠</a>6.2. Clustered Destinations</h1></div></div></div><div class="para">
			 JBoss Messaging clusters Java Message Service (JMS) queues and topics transparently across the cluster. Messages sent to a distributed queue or topic on one node are consumable on other nodes. To make a particular destination clustered, the <code class="varname">clustered</code> attribute is used to set this functionality. Refer to <a class="xref" href="configuration.html#conf.postoffice.attributes">Section 5.5.1, “MessagingPostOffice Attributes”</a> for further information.
		</div><div class="para">
			JBoss Messaging balances messages between nodes and caters for consumers of varying speeds so processing load can be efficiently distributed across the cluster.
		</div><div class="para">
			To disable message redistribution between nodes while retaining other characteristics of clustered destinations, do not specify the <code class="varname">ClusterPullConnectionFactoryName</code> attribute on the Server Peer. Refer to <a class="xref" href="configuration.html#sect-ServerPeer_Attributes">Section 5.2, “ServerPeer attributes”</a> for full details about this attribute.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="c_conf.clustereddursubs">
      ⁠</a>6.3. Clustered Durable Subscriptions</h1></div></div></div><div class="para">
			 JBoss Messaging durable subscriptions can be clustered in a way that allows multiple subscribers on multiple nodes to consume from one durable subscription. A durable subscription is clustered automatically, providing its topic is clustered.
		</div><div class="para">
			For more information about configuring clustered topics and queues, refer to the <em class="parameter"><code>Clustered</code></em> attribute in <a class="xref" href="configuration.html#conf.postoffice.attributes">Section 5.5.1, “MessagingPostOffice Attributes”</a>
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="c_conf.clusteredtempdest">
      ⁠</a>6.4. Clustered Temporary Destinations</h1></div></div></div><div class="para">
			 JBoss Messaging supports clustering of temporary topics and queues. All temporary topics and queues will be clustered if the Post Office is clustered.
		</div><div class="para">
			For more information about configuring clustered topics and queues, refer to the <em class="parameter"><code>Clustered</code></em> attribute in <a class="xref" href="configuration.html#conf.postoffice.attributes">Section 5.5.1, “MessagingPostOffice Attributes”</a>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="c_conf.nonclusteredserver">
      ⁠</a>6.5. Non-clustered Servers</h1></div></div></div><div class="para">
			 Set the <em class="parameter"><code>PostOffice</code></em> clustered attribute to <code class="literal">false</code> if you do not want all nodes to participate in a cluster, or if you do not want the server to be clustered.
		</div><div class="para">
			For more information about configuring non-clustered server, refer to the various attributes in <a class="xref" href="configuration.html#conf.postoffice.attributes">Section 5.5.1, “MessagingPostOffice Attributes”</a>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="c_conf.orderingincluster">
      ⁠</a>6.6. Message Ordering in the Cluster</h1></div></div></div><div class="para">
			To ensure messages are consumed in the same order they were produced, set strict JMS ordering by setting the <code class="varname">DefaultPreserveOrdering</code> Server Peer attribute to <code class="literal">true</code>. While set to <code class="literal">true</code>, messages cannot be distributed as freely around the cluster. The default value is <code class="literal">false</code>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="c_conf.idempotentops">
      ⁠</a>6.7. Idempotent Operations</h1></div></div></div><div class="para">
			A message is guaranteed to be persisted when the message sent to a persistent destination returns with no exception.
		</div><div class="para">
			An exception does not guarantee the message was <span class="emphasis"><em>not</em></span> persisted, because failure may have occurred between the message being persisted and a response being returned to the caller.
		</div><div class="para">
			Applications must therefore be coded so that operations are <span class="emphasis"><em>idempotent</em></span> — that is, operations can be repeated without causing the system to become inconsistent.
		</div><div class="para">
			You can implement this behavior on the application level by checking for duplicate messages and discarding them if the original message has been sent successfully. This <span class="emphasis"><em>duplicate checking</em></span> is a powerful technique that can remove the need for XA transactions.
		</div><div class="para">
			JBoss Messaging is configured by default to perform duplicate checking in a clustered environment.
		</div><div class="para">
			Persistence considerations are located in <a class="xref" href="configuration.html#sect-ServerPeer_Methods">Section 5.3, “ServerPeer methods”</a>, <a class="xref" href="configuration.html#sect-Changing_The_Database">Section 5.4, “Changing the Database”</a>, <a class="xref" href="configuration.html#sect-Configuring_The_Persistence_Manager">Section 5.7, “Configuring the Persistence Manager”</a>, and <a class="xref" href="bridge.html#sect-Message_Bridge_Overview">Section 8.1, “Message Bridge Overview”</a>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="c_conf.clusteredcfs">
      ⁠</a>6.8. Clustered Connection Factories</h1></div></div></div><div class="para">
			When <code class="varname">supportsLoadBalancing</code> is set to <code class="literal">true</code> in the connection factory, consecutive attempts to create connections will round-robin between available servers. The first node is chosen randomly.
		</div><div class="para">
			When <code class="varname">supportsFailover</code> is set to <code class="literal">true</code>, failover will occur transparently and automatically whenever any connection error is detected.
		</div><div class="para">
			For more information about configuring connection factories, refer to <a class="xref" href="configuration.html#sect-ConnectionFactory_Managed_Bean_Attributes">Section 5.10.1, “ConnectionFactory Managed Bean Attributes”</a>.
		</div></div></div></body></html>