<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 9. Enabling JBoss Messaging Ordering Group</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="orderinggroup">
      ⁠</a>Chapter 9. Enabling JBoss Messaging Ordering Group</h1></div></div></div><div class="para">
		This section describes how to use the JBoss Messaging ordering group feature to achieve strict message ordering.
	</div><div class="para">
		Message ordering groups is the JBoss Messaging implementation of strict message ordering. When the ordering group feature is enabled, message priorities no longer have an influence on the order that the messages are delivered. Messages of a particular ordering group are delivered in the exact order that they arrive at the target queue (FIFO).
	</div><div class="para">
		The next message of an ordering group is delivered only after the delivery of the previous messages has been accomplished. To signalize a successful message delivery, the acknowledge mechanism is used (refer to <a class="xref" href="orderinggroup.html#Acknowledge_Mechanism">Section 9.1, “Acknowledge Mechanism”</a>).
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Transactional Receipt</div>
			In the case of the transactional receipt of messages, the next message is not delivered until the transaction has been committed which includes the acknowledgment of the receipt of the current message. If the transaction is rolled back, the message is canceled, sent back to the JMS server, and made available for the next delivery.
		</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Acknowledge_Mechanism">
      ⁠</a>9.1. Acknowledge Mechanism</h1></div></div></div><div class="para">
			The messages that form a part of an ordering group are delivered one at a time. The next message is delivered only after the delivery of a previous message was completed. Message delivery completion is signaled by various means, depending on the acknowledge mode settings:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					In the <code class="literal">CLIENT_ACKNOWLEDGE</code> mode, the completion state is signalized by the <code class="methodname">Message.acknowledge()</code> method.
				</div></li><li class="listitem"><div class="para">
					In the <code class="literal">AUTO_ACKNOWLEDGE</code> and <code class="literal">DUPS_OK_ACKNOWLEDGE</code> modes, the completion is signalized by either of the following:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							a successful return from one of the <code class="classname">MessageConsumer</code>.<code class="methodname">receive()</code> methods, or
						</div></li><li class="listitem"><div class="para">
							a successful return from the <code class="methodname">onMessage()</code> call of the <code class="literal">MessageListener()</code>.
						</div></li></ul></div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				If the message consumer is closed, the message being processed at the time of its closure is deemed as completed and that regardless of whether <code class="literal">*_ACKNOWLEDGE</code> was called prior to the closure of the consumer.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enable.ordering.group">
      ⁠</a>9.2. How to Enable Message Ordering Group</h1></div></div></div><div class="para">
			You can enable an ordering group either on a connection factory or on a producer:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					If you define the ordering group on a connection factory, all producers on the connection factory use the same ordering group (refer to <a class="xref" href="orderinggroup.html#enablewiththeapi">Section 9.2.1, “Enabling Ordering Group on Producer”</a>).
				</div></li><li class="listitem"><div class="para">
					If you define the ordering group on a producer (note that the producer is defined on a connection factory), the producer uses the defined ordering group. If the connection factory of the producer defines an ordering group as well, the producer ordering group overrides the setting and uses its own ordering group (refer to <a class="xref" href="orderinggroup.html#Configurationchanges">Section 9.2.2, “Enabling Ordering Group on Connection Factory”</a>).
				</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="enablewiththeapi">
      ⁠</a>9.2.1. Enabling Ordering Group on Producer</h2></div></div></div><div class="para">
				To enable the ordering group feature on producer, do the following:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Add a <code class="classname">JBossMessageProducer</code> to your session:
					</div><pre class="programlisting">JBossMessageProducer producer=(JBossMessageProducer)session.createProducer(queue);</pre></li><li class="step"><div class="para">
						Add the enableOrderingGroup method to set an ordering group:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>producer.<span xmlns="" class="perl_Function">enableOrderingGroup</span>(String ogrpName) <span xmlns="" class="perl_Keyword">throws</span> JMSException</pre><div class="para">
						The method creates an ordering group; when the method is called, JBossMessageProducer sends messages on behalf of the ordering group. If you provide <code class="literal">null</code> as the method parameter, the ordering group is generated automatically. A new call to this method overrides the previous call.
					</div></li><li class="step"><div class="para">
						Optionally, you can add the <code class="function">disableOrderingGroup()</code> method to disable the ordering group:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">disableOrderingGroup</span>() <span xmlns="" class="perl_Keyword">throws</span> JMSException</pre><div class="para">
						When the method is called, JBossMessageProducer stops sending ordering group messages and resumes its default behavior.
					</div></li></ol></div><div class="para">
				An example is available in <code class="filename">$EAPHOME/doc/examples/jboss-messaging-examples/ordering-group/</code> in the class <code class="classname">OrderingGroupExample.java</code> (<code class="filename">src/org/jboss/example/jms/ordering/OrderingGroupExample.java</code>). Note that the example is delivered as part of the <code class="filename">jboss-eap-docs</code> archive.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configurationchanges">
      ⁠</a>9.2.2. Enabling Ordering Group on Connection Factory</h2></div></div></div><div class="para">
				To enable the ordering group feature on a connection factory, add the following attributes to the factory service configuration file:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">EnableOrderingGroup</span></dt><dd><div class="para">
							enables the ordering group feature if set to <code class="literal">true</code> (the default value is <code class="literal">false</code>).
						</div></dd><dt><span class="term">DefaultOrderingGroupName</span></dt><dd><div class="para">
							sets the default name of the message ordering group. The group name is generated automatically if the attribute is not defined.
						</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Once configured to enable the ordering group feature on a connection factory, all messages that are sent from any producers created from the connection factory become ordering group messages.
				</div></div></div><div class="para">
				The following factory service configuration file sample demonstrates how to enable the ordering group feature:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.connectionfactory.ConnectionFactory"</span><span xmlns="" class="perl_Error">;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  name=</span><span xmlns="" class="perl_String">"jboss.messaging.connectionfactory:service=ConnectionFactory"</span><span xmlns="" class="perl_Error">;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/ConnectionFactory-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"ServerPeer"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=ServerPeer
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"Connector"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=Connector,transport=bisocket
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>
<span xmlns="" class="line">​</span>    jboss.messaging:service=PostOffice
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIBindings"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;bindings&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;binding&gt;</span>/MyConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/binding&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;binding&gt;</span>/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/binding&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;binding&gt;</span>java:/MyConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/binding&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;binding&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/binding&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/bindings&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The two OrderingGroup properties --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"EnableOrderingGroup"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultOrderingGroupName"</span><span xmlns="" class="perl_Keyword">&gt;</span>MyOrderingGroup<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre><div class="para">
				The advantage of enabling the ordering group feature by making configuration changes is the ease with which message ordering functionality can be achieved without the need for code changes.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="note.ordering.group">
      ⁠</a>9.3. Notes and Limitations</h1></div></div></div><div class="para">
			The following points should be noted in regard to ordering group functionality:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Queues must be used with the ordering group feature. The feature will not work with topics.
				</div></li><li class="listitem"><div class="para">
					The ordering group feature should not be used in conjunction with message selectors and scheduled delivery.
				</div></li><li class="listitem"><div class="para">
					A message is considered completed, and the next message will be available for delivery, if the original message is dead or has expired. A dead message is moved to the <code class="literal">DLQ</code> whereas an expired message is moved to the <code class="literal">ExpiryQueue</code>.
				</div></li><li class="listitem"><div class="para">
					When using a <code class="literal">ConnectionConsumer</code>, the ordering of the messages will be observed. However, the <code class="literal">ConnectionConsumer</code> does not control which session will receive the next message.
				</div></li><li class="listitem"><div class="para">
					The ordering group feature does not work with clustered queues. However, if the user deploys the clustered queue as HASingleton, which means at a time only one queue of a clustered queue is active, ordering groups work as expected. 
				</div></li></ul></div></div></div></body></html>