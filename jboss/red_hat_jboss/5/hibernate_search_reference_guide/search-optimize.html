<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 7. Index Optimization</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="search-optimize">
      ⁠</a>Chapter 7. Index Optimization</h1></div></div></div><div class="para">
		From time to time, the Lucene index needs to be optimized. The process is essentially a defragmentation. Until an optimization is triggered Lucene only marks deleted documents as such, no physical deletions are applied. During the optimization process the deletions will be applied which also effects the number of files in the Lucene Directory.
	</div><div class="para">
		Optimizing the Lucene index speeds up searches but has no effect on the indexation (update) performance. During an optimization, searches can be performed, but will most likely be slowed down. All index updates will be stopped. It is recommended to schedule optimization:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				on an idle system or when the searches are less frequent
			</div></li><li class="listitem"><div class="para">
				after a lot of index modifications
			</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140635514653168">
      ⁠</a>7.1. Automatic optimization</h1></div></div></div><div class="para">
			Hibernate Search can automatically optimize an index after:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					a certain amount of operations (insertion, deletion)
				</div></li><li class="listitem"><div class="para">
					or a certain amount of transactions
				</div></li></ul></div><div class="para">
			The configuration for automatic index optimization can be defined on a global level or per index:
		</div><div class="example"><a id="idm140635535735216">
      ⁠</a><p class="title"><strong>Example 7.1. Defining automatic optimization parameters</strong></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.operation_limit.max = 1000
hibernate.search.default.optimizer.transaction_limit.max = 100
hibernate.search.Animal.optimizer.transaction_limit.max = 50</pre></div></div><div class="para">
			An optimization will be triggered to the <code class="literal">Animal</code> index as soon as either:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					the number of additions and deletions reaches 1000
				</div></li><li class="listitem"><div class="para">
					the number of transactions reaches 50 (<code class="constant">hibernate.search.Animal.optimizer.transaction_limit.max</code> having priority over <code class="constant">hibernate.search.default.optimizer.transaction_limit.max</code>)
				</div></li></ul></div><div class="para">
			If none of these parameters are defined, no optimization is processed automatically.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140635539379424">
      ⁠</a>7.2. Manual optimization</h1></div></div></div><div class="para">
			You can programmatically optimize (defragment) a Lucene index from Hibernate Search through the <code class="classname">SearchFactory</code>:
		</div><div class="example"><a id="idm140635476164448">
      ⁠</a><p class="title"><strong>Example 7.2. Programmatic index optimization</strong></p><div class="example-contents"><pre class="programlisting">FullTextSession fullTextSession = Search.getFullTextSession(regularSession);
SearchFactory searchFactory = fullTextSession.getSearchFactory();

searchFactory.optimize(Order.class);
// or
searchFactory.optimize();</pre></div></div><div class="para">
			The first example optimizes the Lucene index holding <code class="classname">Order</code>s; the second, optimizes all indexes.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				<code class="literal">searchFactory.optimize()</code> has no effect on a JMS back end. You must apply the optimize operation on the Master node.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140635510241744">
      ⁠</a>7.3. Adjusting optimization</h1></div></div></div><div class="para">
			Apache Lucene has a few parameters to influence how optimization is performed. Hibernate Search exposes those parameters.
		</div><div class="para">
			Further index optimization parameters include: 
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].max_buffered_docs</code>
					</div></li><li class="listitem"><div class="para">
						<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].max_field_length</code>
					</div></li><li class="listitem"><div class="para">
						<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].max_merge_docs</code>
					</div></li><li class="listitem"><div class="para">
						<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].merge_factor</code>
					</div></li><li class="listitem"><div class="para">
						<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].ram_buffer_size</code>
					</div></li><li class="listitem"><div class="para">
						<code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.[batch|transaction].term_index_interval</code>
					</div></li></ul></div>
			 See <a class="xref" href="search-configuration.html#lucene-indexing-performance">Section 3.8, “Tuning Lucene indexing performance”</a> for more details.
		</div></div></div></body></html>