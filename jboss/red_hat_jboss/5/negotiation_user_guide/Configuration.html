<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 2. Application Server Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Configuration">
      ⁠</a>Chapter 2. Application Server Configuration</h1></div></div></div><div class="para">
		To configure JBoss Negotiation to run on JBoss Enterprise Application Platform, you need to do the following:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Extend the core authentication mechanism to support JBoss Negotiation (add the SPNEGO authenticator).
			</div></li><li class="listitem"><div class="para">
				Define the application security domain, which allows an application to communicate with the application server through the SPNEGOLoginModule.
			</div></li><li class="listitem"><div class="para">
				Define the server security domain, which allows the application server to authenticate itself to the KDC for the first time.
			</div></li></ul></div><div class="para">
		You may also need to configure the realm properties to allow the server to locate the authentication realm (Kerberos realm) if the server was not previously configured to do so.
	</div><div class="para">
		JBoss Negotiation comes with Negotiation Toolkit, a web application, which allows you to test your SPNEGO setup. Consider using the application before testing on your own web applications (refer to <a class="xref" href="chapt-Negotiation_Toolkit.html">Chapter 8, <em>Negotiation Toolkit</em></a>).
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140585702570080">
      ⁠</a>2.1. Adding the SPNEGO Authenticator</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><div class="para">
				To add the <code class="literal">SPNEGO</code> authenticator to the core authentication mechanism, do the following:
			</div><ol class="1"><li class="step"><div class="para">
					Open the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deployers/jbossweb.deployer/META-INF/war-deployers-jboss-beans.xml</code> file for editing.
				</div></li><li class="step"><div class="para">
					Locate the property <code class="literal">authenticators</code>.
				</div></li><li class="step"><div class="para">
					Add the following entry to the property:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;property name=<span xmlns="" class="perl_String">"authenticators"</span>&gt;
<span xmlns="" class="line">​</span>  &lt;map <span xmlns="" class="perl_Keyword">class</span>=<span xmlns="" class="perl_String">"java.util.Properties"</span> keyClass=<span xmlns="" class="perl_String">"java.lang.String"</span> valueClass=<span xmlns="" class="perl_String">"java.lang.String"</span>&gt;
<span xmlns="" class="line">​</span>    &lt;entry&gt;
<span xmlns="" class="line">​</span>      &lt;key&gt;SPNEGO&lt;/key&gt;
<span xmlns="" class="line">​</span>      &lt;value&gt;org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">security</span>.<span xmlns="" class="perl_Function">negotiation</span>.<span xmlns="" class="perl_Function">NegotiationAuthenticator</span>&lt;/value&gt;
<span xmlns="" class="line">​</span>    &lt;/entry&gt;
</pre><div class="para">
					The key value is arbitrary; however, if you want to use the Negotiation Toolkit to test your server setup, make sure you use the <code class="literal">SPNEGO</code> value as the tool works only with the SPNEGO authenticator with this name.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-serverSecurityDomain">
      ⁠</a>2.2. Defining Server Security Domain</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><div class="para">
				The application server must define a security domain to be able to authenticate to the KDC for the first time.
			</div><div class="important"><div class="admonition_header"><p><strong>Local Credentials Cache in Kerberos</strong></p></div><div class="admonition"><div class="para">
					Krb5LoginModule can use a local credentials cache; however, this option is incompatible with the storeKey option, which is required by SPNEGO. Make sure the module does not use the local credentials cache.
				</div></div></div><div class="para">
				To define a server security domain, do the following:
			</div><ol class="1"><li class="step"><div class="para">
					Open the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">$PROFILE</em>/conf/login-config.xml</code> file for editing.
				</div></li><li class="step"><div class="para">
					Define the application policy element with the <span class="property">authentication</span> element with the following options:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">storeKey</span></dt><dd><div class="para">
								If <code class="literal">true</code> the private key is cached in the Subject (set to <code class="literal">true</code>).
							</div></dd><dt><span class="term">useKeyTab</span></dt><dd><div class="para">
								If <code class="literal">true</code> the key is loaded from a keyTab file (set to <code class="literal">true</code>).
							</div></dd><dt><span class="term">principal</span></dt><dd><div class="para">
								The attribute needs to state the full name of the principal to obtain from the keyTab file.
							</div></dd><dt><span class="term">keyTab</span></dt><dd><div class="para">
								The attribute defines the full path to the keyTab file with the server key (key for encrypting the information between the server and KDC).
							</div></dd><dt><span class="term">doNotPrompt</span></dt><dd><div class="para">
								If <code class="literal">true</code> password prompting is turned off (as this is a server, set to <code class="literal">true</code>).
							</div></dd><dt><span class="term">debug</span></dt><dd><div class="para">
								If <code class="literal">true</code> the system logs additional debug information to STDOUT.
							</div></dd></dl></div></li></ol></div><div class="example"><a id="idm140585704332640">
      ⁠</a><p class="title"><strong>Example 2.1. Server security domain</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;application-policy name=<span xmlns="" class="perl_String">"host"</span>&gt;
<span xmlns="" class="line">​</span>   &lt;authentication&gt;
<span xmlns="" class="line">​</span>      &lt;login-module code=<span xmlns="" class="perl_String">"com.sun.security.auth.module.Krb5LoginModule"</span>
<span xmlns="" class="line">​</span>         flag=<span xmlns="" class="perl_String">"required"</span>&gt;
<span xmlns="" class="line">​</span>         &lt;module-option name=<span xmlns="" class="perl_String">"storeKey"</span>&gt;<span xmlns="" class="perl_Keyword">true</span>&lt;/module-option&gt;
<span xmlns="" class="line">​</span>         &lt;module-option name=<span xmlns="" class="perl_String">"useKeyTab"</span>&gt;<span xmlns="" class="perl_Keyword">true</span>&lt;/module-option&gt;
<span xmlns="" class="line">​</span>         &lt;module-option name=<span xmlns="" class="perl_String">"principal"</span>&gt;HTTP/testserver@KERBEROS.<span xmlns="" class="perl_Function">JBOSS</span>.<span xmlns="" class="perl_Function">ORG</span>&lt;/module-option&gt;
<span xmlns="" class="line">​</span>         &lt;module-option name=<span xmlns="" class="perl_String">"keyTab"</span>&gt;/home/jboss_user/testserver.<span xmlns="" class="perl_Function">keytab</span>&lt;/module-option&gt;
<span xmlns="" class="line">​</span>         &lt;module-option name=<span xmlns="" class="perl_String">"doNotPrompt"</span>&gt;<span xmlns="" class="perl_Keyword">true</span>&lt;/module-option&gt;
<span xmlns="" class="line">​</span>         &lt;module-option name=<span xmlns="" class="perl_String">"debug"</span>&gt;<span xmlns="" class="perl_Keyword">true</span>&lt;/module-option&gt;
<span xmlns="" class="line">​</span>      &lt;/login-module&gt;
<span xmlns="" class="line">​</span>   &lt;/authentication&gt;
<span xmlns="" class="line">​</span>&lt;/application-policy&gt;
</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="applicationSecurityDomain">
      ⁠</a>2.3. Defining Application Security Domain</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><div class="para">
				To allow an application to communicate with the application server through the SPNEGOLoginModule, you need to define the application security domain on the application server.
			</div><div class="para">
				To define the application security domain, do the following:
			</div><ol class="1"><li class="step"><div class="para">
					Open the <code class="filename">$JBOSS_HOME/jboss-as/server/$PROFILE/conf/login-config.xml</code> file for editing.
				</div></li><li class="step"><div class="para">
					Define a new application policy with the following chained configuration:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							The SPNEGOLoginModule and its configuration with the following options:
						</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;</span></dt><dd><div class="para">
										The password-stacking option activates client-side authentication of clients with other login modules. Set the <code class="literal">password-stacking</code> option to <code class="literal">useFirstPass</code>, so the module looks first for a shared user name and password with <code class="literal">javax.security.auth.login.name</code> and <code class="literal">javax.security.auth.login.password</code> respectively (for further information refer to Password Stacking in the <em class="citetitle">Security Guide</em>).
									</div></dd><dt><span class="term">&lt;module-option name="serverSecurityDomain"&gt;<em class="replaceable">DomainName</em>&lt;/module-option&gt;</span></dt><dd><div class="para">
										The serverSecurityDomain option defines the server security domain, which defines the authentication module (Kerberos) and server authentication properties (refer to <a class="xref" href="Configuration.html#sect-serverSecurityDomain">Section 2.2, “Defining Server Security Domain”</a>).
									</div></dd></dl></div></li><li class="listitem"><div class="para">
							The login module which returns the roles of the authenticated user and its configuration options. You can make use of the UsersRolesLoginModule that obtains the user roles from a properties file or AdvancedLdapLoginModule, which obtains user roles from an LDAP server following GSSAPI. For further information refer to <a class="xref" href="Configuration.html#sect-Role_Mapping">Section 2.4, “Role Mapping”</a>.
						</div></li></ul></div></li></ol></div><div class="example"><a id="example-ApplicationSecurityDomain">
      ⁠</a><p class="title"><strong>Example 2.2. Application Security Domain</strong></p><div class="example-contents"><div class="para">
				
<pre class="programlisting">
&lt;application-policy name="SPNEGO"&gt;
   &lt;authentication&gt;
      &lt;login-module
         code="org.jboss.security.negotiation.spnego.SPNEGOLoginModule"
         flag="requisite"&gt;
         &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;
         &lt;module-option name="serverSecurityDomain"&gt;host&lt;/module-option&gt;
      &lt;/login-module&gt;
      &lt;login-module
         code="org.jboss.security.auth.spi.UsersRolesLoginModule"
         flag="required"&gt;
         &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;
         &lt;module-option name="usersProperties"&gt;props/spnego-users.properties&lt;/module-option&gt;
         &lt;module-option name="rolesProperties"&gt;props/spnego-roles.properties&lt;/module-option&gt;
      &lt;/login-module&gt;
   &lt;/authentication&gt;
&lt;/application-policy&gt;
</pre>

			</div><div class="para"><a id="users_roles_login_module">
      ⁠</a>
				In <a class="xref" href="Configuration.html#example-ApplicationSecurityDomain">Example 2.2, “Application Security Domain”</a> we have defined an application security domain called <code class="literal">SPNEGO</code> with two login modules: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="classname">org.jboss.security.negotiation.spnego.SPNEGOLoginModule</code> provides SPNEGO user authentication;
						</div></li><li class="listitem"><div class="para">
							<code class="classname">org.jboss.security.auth.spi.UsersRolesLoginModule</code> returns the roles of the user authenticated by the SPNEGOLoginModule (the roles are filtered from a users properties file).
						</div></li></ul></div>

			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Role_Mapping">
      ⁠</a>2.4. Role Mapping</h1></div></div></div><div class="para">
			Once the user has been authenticated against the KDC (this occurs through org.jboss.security.negotiation.spnego.SPNEGOLoginModule), the application server needs to obtain the user roles. The authentication can use either the org.jboss.security.auth.spi.UsersRolesLoginModule to obtain user roles from a roles.properties file or the org.jboss.security.negotiation.AdvancedLdapLoginModule to obtain user roles from an LDAP server.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140585696029696">
      ⁠</a>2.4.1. Setting up Role Mapping with a Roles Properties File</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><div class="para">
					To allow SPNEGO to obtain the roles of an authenticated user from a roles.properties file, do the following:
				</div><ol class="1"><li class="step"><div class="para">
						In the application security domain, set the second login module of the SPNEGO authentication to <code class="literal">org.jboss.security.auth.spi.UsersRolesLoginModule</code> (refer to <a class="xref" href="Configuration.html#example-ApplicationSecurityDomain">Example 2.2, “Application Security Domain”</a>) and provide the module options. Refer to UsersRolesLoginModule in the <em class="citetitle">Security Guide</em>).
					</div></li><li class="step"><div class="para">
						If the application security domain is defined in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">$PROFILE</em>/conf/login-config.xml</code> file, define the user roles in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">$PROFILE</em>/conf/props/spnego-users.properties</code> file. Use the following pattern: <code class="code"><em class="replaceable">fullyQualifiedUserName</em>=<em class="replaceable">comma-separatedListOfRoles</em></code>
					</div><div class="example"><a id="example-user_properties_file">
      ⁠</a><p class="title"><strong>Example 2.3. roles.properties file</strong></p><div class="example-contents"><div class="para">
							
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span># A roles.<span xmlns="" class="perl_Function">properties</span> file <span xmlns="" class="perl_Keyword">for</span> use with the UsersRolesLoginModule
<span xmlns="" class="line">​</span>darranl@KERBEROS.<span xmlns="" class="perl_Function">JBOSS</span>.<span xmlns="" class="perl_Function">ORG</span>=Users,Admins
</pre>

						</div></div></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140585657259584">
      ⁠</a>2.4.2. Setting up Role Mapping with an LDAP Server</h2></div></div></div><div class="para">
				The AdvancedLdapLoginModule allows you to obtain the roles of a user, who was previously authenticated against a KDC with the SPNEGOLoginModule. The AdvancedLdapLoginModule is based on the LdapExtLoginModule and follows GSSAPI.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Full LDAP authentication and role look up</strong></p></div><div class="admonition"><div class="para">
					In this chapter we discuss the module in chained configuration with the SPNEGOLoginModule; however, you can use the module for both authentication and role look up from an LDAP server. For further details on such configuration, refer to <a class="xref" href="appendix-advancedldap.html">Appendix A, <em>Advanced LDAP Login Module: Full LDAP Authentication</em></a>.
				</div></div></div><div class="para">
				To make use of the AdvancedLdapLoginModule in the chained configuration with the SPNEGOLoginModule, you need to chain it with the SPNEGOLoginModule in the SPNEGO application security domain: set the second login module of SPNEGO authentication to <code class="code">org.jboss.security.negotiation.AdvancedLdapLoginModule</code> (refer to <a class="xref" href="Configuration.html#example-ApplicationSecurityDomain">Example 2.2, “Application Security Domain”</a>).
			</div><div class="para">
				To set up the role mapping to an LDAP server, you need to do the following:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Define InitialLdapContext properties: these properties are used to obtain LDAP connection (refer to <a class="xref" href="Configuration.html#Initial_LDAP_Context">Section 2.4.2.1, “Defining Initial LDAP Context with GSSAPI”</a>; for details on the Java API refer to <a href="http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/InitialLdapContext.html">http://download.oracle.com/javase/6/docs/api/javax/naming/ldap/InitialLdapContext.html</a>).
					</div></li><li class="listitem"><div class="para">
						Define DN (Distinguished Name) properties: these properties are used to search for the authenticated user on the LDAP server (refer to <a class="xref" href="Configuration.html#DN_Search">Section 2.4.2.2, “Defining DN Search”</a>).
					</div></li><li class="listitem"><div class="para">
						Define role search properties: these properties govern the role search on the LDAP server (<a class="xref" href="Configuration.html#Defining_Role_Search">Section 2.4.2.3, “Defining Role Search”</a>).
					</div></li></ul></div><div class="para">
				The properties set on the login mode are passed into the InitialLdapContext constructor; that means you can make use of any of the options supported by the LdapCtxFactory.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Initial_LDAP_Context">
      ⁠</a>2.4.2.1. Defining Initial LDAP Context with GSSAPI</h3></div></div></div><div class="para">
					To obtain the initial LDAP Context, define the following module properties for the AdvancedLdapLoginModule in the application security domain (<a class="xref" href="Configuration.html#applicationSecurityDomain">Section 2.3, “Defining Application Security Domain”</a>):
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">bindAuthentication</span></dt><dd><div class="para">
								defines the authentication type (set the property value to <code class="literal">GSSAPI</code> to use GSSAPI-based authentication).
							</div></dd><dt><span class="term">jaasSecurityDomain</span></dt><dd><div class="para">
								defines the security domain that is used to obtain the subject required for the connection (refer to <a class="xref" href="Configuration.html#sect-serverSecurityDomain">Section 2.2, “Defining Server Security Domain”</a> for information defining the required jaasSecurityDomain).
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="DN_Search">
      ⁠</a>2.4.2.2. Defining DN Search</h3></div></div></div><div class="para">
					After the module has created the LDAP initial context, it takes the provided username and searches for the user DN. To define the properties of the search, provide the following properties:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">baseCtxDN</span></dt><dd><div class="para">
								defines the fixed DN of the context to search for the user; consider that this is not the Distinguished Name of the location where the actual users are located but DN of the location where the objects containing the users are located (that is, for Active Directory, this is the DN with the user account).
							</div></dd><dt><span class="term">baseFilter</span></dt><dd><div class="para">
								defines the search filter used to locate the context of the user to authenticate; the input username/userDN as obtained from the login module callback substitutes the <code class="literal">{0}</code> expression. This substitution behavior comes from the standard DirContext?.search(Name, String, Object[], SearchControls? cons) method. A common example search filter is <code class="code">(uid={0})</code>
							</div></dd><dt><span class="term">searchTimeLimit</span></dt><dd><div class="para">
								defines the timeout for the user and role search in milliseconds (defaults to 10000, that is 10 seconds).
							</div></dd></dl></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						To disable the user DN search, omit the <code class="literal">baseCtxDN</code> property; the provided username will be used as the DN in the login module.
					</div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm140585657227600">
      ⁠</a>2.4.2.2.1. User Authentication</h4></div></div></div><div class="para">
						If the AdvancedLdapLoginModule is not the first login module and a previous login module has already authenticated the user, user authentication is skipped.
					</div><div class="para">
						For user authentication, you can define the following property:
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">allowEmptyPassword</span></dt><dd><div class="para">
									If empty (length==0) passwords are passed to the LDAP server. An empty password is treated as an anonymous login by an LDAP servers. Set the property to <code class="literal">false</code> to reject empty passwords or to <code class="literal">true</code> to allow the LDAP server to validate an empty password (the default is <code class="literal">false</code>).
								</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Defining_Role_Search">
      ⁠</a>2.4.2.3. Defining Role Search</h3></div></div></div><div class="para">
					The AdvancedLdapLoginModule passes the properties that define the search for a particular user and its roles to the LDAP server.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						The following role search settings are similar to the LdapExtLoginModule settings; however, the recursion now finds the roles listed within a DN.
					</div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">rolesCtxDN</span></dt><dd><div class="para">
								defines the fixed DN of the context to search for user roles; consider that this is not the Distinguished Name of the location where the actual roles are but the DN of the location where the objects containing the user roles are (that is, for Active Directory, this is the DN where the user account is).
							</div></dd><dt><span class="term">roleFilter</span></dt><dd><div class="para">
								defines the search filter used to locate the roles of the authenticated user. The input username/userDN as obtained from the login module callback substitutes the <code class="code">{0}</code> expression in the filter definition. The authenticated userDN substitutes the <code class="code">{1}</code> in the filter definition. An example search filter that matches the input username is <code class="code">(member={0})</code>. An alternative that matches the authenticated userDN is <code class="code">(member={1})</code>.
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									If you omit the roleFilter attribute, the role search will use the UserDN as the DN to obtain the roleAttributeID value.
								</div></div></div></dd><dt><span class="term">roleAttributeID</span></dt><dd><div class="para">
								defines the name of the role attribute of the context that corresponds to the name of the role. If the roleAttributeIsDN property is set to <code class="literal">true</code>, this property is the DN of the context to query for the roleNameAttributeID attribute. If the roleAttributeIsDN property is set to <code class="literal">false</code>, this property is the attribute name of the role name.
							</div></dd><dt><span class="term">roleAttributeIsDN</span></dt><dd><div class="para">
								defines if the role attribute contains the fully distinguished name of a role object or the role name. If <code class="literal">false</code>, the role name is taken from the value of the user's role attribute. If <code class="literal">true</code>, the role attribute represents the distinguished name of a role object. The role name is taken from the value of the roleNameAttributeId attribute of the corresponding object. In certain directory schemas (for example, Microsoft Active Directory), role (group)attributes in the user object are stored as DNs to role objects and not as simple names. In such case, set this property to <code class="literal">true</code>. The default value of this property is <code class="literal">false</code>.
							</div></dd><dt><span class="term">roleNameAttributeID</span></dt><dd><div class="para">
								defines the role attribute of the context which corresponds to the name of the role. If the roleAttributeIsDN property is set to <code class="literal">true</code>, this property is used to find the name attribute of the role object. If the roleAttributeIsDN property is set to <code class="literal">false</code>, this property is ignored.
							</div></dd><dt><span class="term">recurseRoles</span></dt><dd><div class="para">
								defines if the recursive role search is enabled. The login module tracks already added roles to handle cyclic references.
							</div></dd><dt><span class="term">searchScope</span></dt><dd><div class="para">
								allows to limit the search scope to one of the following (the default value is <code class="literal">SUBTREE_SCOPE</code>): 
								<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
											OBJECT_SCOPE - searches the named roles context only.
										</div></li><li class="listitem"><div class="para">
											ONELEVEL_SCOPE - searches directly in the named roles context.
										</div></li><li class="listitem"><div class="para">
											SUBTREE_SCOPE - searches only the object if the role context is not a DirContext?. If the roles context is a DirContext?, the subtree rooted at the named object and the named object itself are searched.
										</div></li></ul></div>

							</div></dd><dt><span class="term">searchTimeLimit</span></dt><dd><div class="para">
								defines the timeout for the user/role searches in milliseconds (defaults to 10000, that is 10 seconds).
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
									Both searches use the same searchTimeLimit setting.
								</div></div></div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Chained_Config_Examples">
      ⁠</a>2.4.3. Examples of LDAP Configuration with the SPNEGO Module</h2></div></div></div><div class="para">
				The following configurations of the SPNEGO authentication uses the SPNEGOLoginModule and LDAP login module. This chained configuration is identical for FreeIPA and Active Directory with the exception of the <code class="code">baseFilter</code> value, which defines the name to search for in LDAP identified by the SPNEGOLoginModule (for the relevant ldiff dump refer to <a class="xref" href="appendix-advancedldap.html#AdvLDAP_on_AD">Section A.2.1, “Full LDAP Authentication for Active Directory”</a> and <a class="xref" href="appendix-advancedldap.html#AdvLDAP_on_FreeIPA">Section A.2.2, “Full LDAP Authentication for Free IPA”</a>).
			</div><div class="para">
				Note that the <code class="code">password-stacking</code> property is set to <code class="code">useFirstPass</code> on both login modules to allow the SPNEGOLoginModule to pass the name of the authenticated user to the AdvancedLdapLoginModule.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="FreeIPA_Chained_Config">
      ⁠</a>2.4.3.1. Chained Configuration on FreeIPA</h3></div></div></div><div class="para">
					The following configuration shows the AdvancedLdapLoginModule chained after the SPNEGOLoginModule for FreeIPA:
				</div><pre class="programlisting">
&lt;application-policy name="SPNEGO_FREEIPA"&gt;
  &lt;authentication&gt;
    &lt;login-module
       code="org.jboss.security.negotiation.spnego.SPNEGOLoginModule"
       flag="requisite"&gt;
       &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;
       &lt;module-option name="serverSecurityDomain"&gt;host&lt;/module-option&gt;
    &lt;/login-module&gt;
      
    &lt;login-module
      code="org.jboss.security.negotiation.spnego.AdvancedLdapLoginModule"
      flag="required"&gt;
      &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;
       
      &lt;module-option name="bindAuthentication"&gt;GSSAPI&lt;/module-option&gt;
      &lt;module-option name="jaasSecurityDomain"&gt;host&lt;/module-option&gt;
      &lt;module-option name="java.naming.provider.url"&gt;ldap://kerberos.jboss.org:389&lt;/module-option&gt;
        
      &lt;module-option name="baseCtxDN"&gt;cn=users,cn=accounts,dc=jboss,dc=org&lt;/module-option&gt;
      &lt;module-option name="baseFilter"&gt;(krbPrincipalName={0})&lt;/module-option&gt;
                
      &lt;module-option name="roleAttributeID"&gt;memberOf&lt;/module-option&gt;
      &lt;module-option name="roleAttributeIsDN"&gt;true&lt;/module-option&gt;
      &lt;module-option name="roleNameAttributeID"&gt;cn&lt;/module-option&gt;
        
      &lt;module-option name="recurseRoles"&gt;true&lt;/module-option&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/application-policy&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="AD_Chained_Config">
      ⁠</a>2.4.3.2. Chained Configuration on Active Directory</h3></div></div></div><div class="para">
					The following configuration shows the AdvancedLdapLoginModule chained after the SPNEGOLoginModule for Active Directory:
				</div><pre class="programlisting">
&lt;application-policy name="SPNEGO_AD"&gt;
  &lt;authentication&gt;
    &lt;login-module
     code="org.jboss.security.negotiation.spnego.SPNEGOLoginModule"
     flag="requisite"&gt;
      &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;
      &lt;module-option name="serverSecurityDomain"&gt;host&lt;/module-option&gt;
    &lt;/login-module&gt;

    &lt;login-module
      code="org.jboss.security.negotiation.spnego.AdvancedLdapLoginModule"
      flag="required"&gt;
      &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;
      
      &lt;module-option name="bindAuthentication"&gt;GSSAPI&lt;/module-option&gt;
      &lt;module-option name="jaasSecurityDomain"&gt;host&lt;/module-option&gt;
      &lt;module-option name="java.naming.provider.url"&gt;ldap://VM104:3268&lt;/module-option&gt;
       
      &lt;module-option name="baseCtxDN"&gt;CN=Users,DC=vm104,DC=gsslab,DC=rdu,DC=redhat,DC=com&lt;/module-option&gt;
      &lt;module-option name="baseFilter"&gt;(userPrincipalName={0})&lt;/module-option&gt;
       
      &lt;module-option name="roleAttributeID"&gt;memberOf&lt;/module-option&gt;
      &lt;module-option name="roleAttributeIsDN"&gt;true&lt;/module-option&gt;
      &lt;module-option name="roleNameAttributeID"&gt;cn&lt;/module-option&gt;
       
      &lt;module-option name="recurseRoles"&gt;true&lt;/module-option&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/application-policy&gt;</pre></div></div></div></div></body></html>