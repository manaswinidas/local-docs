<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 6. Configuring FreeIPA</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="FreeIPA">
      ⁠</a>Chapter 6. Configuring FreeIPA</h1></div></div></div><div class="para">
		Before you configure FreeIPA to use JBoss Negotiation, make sure you have FreeIPA installed and configured correctly, and the clients are able to obtain Kerberos tickets. Detailed FreeIPA documentation is available on <a href="http://www.freeipa.org/">http://www.freeipa.org/</a>.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
			Due to the supported encryption types of FreeIPA, the JBoss application server must run on a Java 6 JVM with unlimited cryptography enabled.
		</div></div></div><div class="para">
		To configure FreeIPA to authenticate users through JBoss Negotiation you need to do the following:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Create a service principal for the server and add the HTTP service to it. The server user acts as a connection between FreeIPA and the JBoss web server.
			</div></li><li class="listitem"><div class="para">
				Generate a keytab file for the server user and export it to the application server. The application server uses the keytab to authenticate to KDC in FreeIPA.
			</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Tested on FreeIPA 1.1</strong></p></div><div class="admonition"><div class="para">
			These instructions apply to FreeIPA 1.1.
		</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140585680587568">
      ⁠</a>6.1. Creating Service Principal</h1></div></div></div><div class="para">
			You need to create the service principal, which represents the HTTP service of your JBoss Application Server to allow the clients to request the ticket for this service.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Full information on service principal creation is available on <a href="http://freeipa.org/page/AdministratorsGuide#Managing_Service_Principals">http://freeipa.org/page/AdministratorsGuide#Managing_Service_Principals</a>.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					The simplest way to create a service principal is through the FreeIPA WebUI: access the tool as an administrator.
				</div></li><li class="step"><div class="para">
					Click the <code class="systemitem">Add Service Principal</code> link.
				</div><div class="figure"><a id="ipa-add-service-principal">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/ipa-add-service-principal.png" alt="Adding Service Principal"/></div></div><p class="title"><strong>Figure 6.1. Adding Service Principal</strong></p></div></li><li class="step"><div class="para">
					Set the hostname to the host name of your server (<code class="literal">test_server.jboss.org</code>) and the service type to <code class="literal">HTTP</code>, and click <span class="guibutton"><strong>Add Principal</strong></span>.
				</div><div class="figure"><a id="ipa-view-service-principal">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/ipa-view-service-principal.png" alt="View Service Principal"/></div></div><p class="title"><strong>Figure 6.2. View Service Principal</strong></p></div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						Creating the service principal requires the host name to be mapped with DNS. If this procedure fails, on the command line, issue the following command to create the principal: <code class="command">ipa-addservice HTTP/test_server.jboss.org@JBOSS.ORG --force</code>
					</div></div></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140585706510976">
      ⁠</a>6.2. Exporting keytab</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><div class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					Exporting a new keytab resets the secret associated with the service principal and invalidates any keytabs created previously for the principal.
				</div></div></div><div class="para">
				To export a keytab for the server, do the following:
			</div><ol class="1"><li class="step"><div class="para">
					Obtain the Kerberos ticket-granting ticket for an administrator: issue the command <code class="command">kinit <em class="replaceable">&lt;admin&gt;</em></code>.
				</div></li><li class="step"><div class="para">
					To obtain the keytab, issue the command <code class="command">ipa-getkeytab</code> with the options:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">-s</span></dt><dd><div class="para">
								FreeIPA server to obtain the keytab from
							</div></dd><dt><span class="term">-p</span></dt><dd><div class="para">
								Non-realm part of the full principal name
							</div></dd><dt><span class="term">-k</span></dt><dd><div class="para">
								File to append the keytab
							</div></dd></dl></div><div class="figure"><a id="ipa-getkeytab">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/ipa-getkeytab.png" alt="Get Keytab"/></div></div><p class="title"><strong>Figure 6.3. Get Keytab</strong></p></div></li></ol></div><div class="para">
			Once you have set up the service principal and exported the keytab, make sure your server security domain uses the output keytab file (refer to <a class="xref" href="Configuration.html#sect-serverSecurityDomain">Section 2.2, “Defining Server Security Domain”</a>) and configure the second login module to allow the client to load the roles assigned to the authenticated user (refer to <a class="xref" href="Configuration.html#sect-Role_Mapping">Section 2.4, “Role Mapping”</a>).
		</div></div></div></body></html>