<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 10. Profiling</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Profiling">
      ⁠</a>Chapter 10. Profiling</h1></div></div></div><div class="para">
		Profiling is monitoring the resource usage of an application with the aim of detecting areas for improvement. One of the difficulties in profiling is choosing a tool which provides useful data without having too great an impact on performance itself. On Red Hat Enterprise Linux, the OProfile tool is available for profiling the JBoss Enterprise Application Platform, requiring less system resources that other profiling tools.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Install_OProfile">
      ⁠</a>10.1. Install</h1></div></div></div><div class="task"><a id="task-TASK">
      ⁠</a><p class="title"><strong>Task: Install OProfile</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to install OProfile and its dependencies.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					In a terminal, enter the following command: 
<pre class="screen">
yum install oprofile oprofile-jit
</pre>

				</div></li><li class="step"><div class="para">
					For all enabled yum repositories (/etc/yum.repos.d/*.repo), replace <code class="literal">enabled=0</code> with <code class="literal">enabled=1</code> in each file's debuginfo section. If there is no <code class="literal">debug</code> section, add it, using the example below as a template.
				</div><div class="para">
					
<pre class="screen">
[rhel-debuginfo]
name=Red Hat Enterprise Linux $releasever - $basearch - Debug
baseurl=ftp://ftp.redhat.com/pub/redhat/linux/enterprise/$releasever/en/os/$basearch/Debuginfo/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
</pre>

				</div></li><li class="step"><div class="para">
					In a terminal, enter the following command, modifying the JDK version number to match the version installed:
				</div><pre class="screen">
yum install yum-plugin-auto-update-debug-info java-1.6.0-openjdk-debuginfo
</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Enable_OProfile">
      ⁠</a>10.2. Enable OProfile</h1></div></div></div><div class="para">
			Add the following to the JVM's start parameters, usually <code class="filename">standalone.conf</code> or <code class="filename">domain.conf</code> in the platform's <em class="replaceable">JBOSS_EAP_DIST</em><code class="filename">/bin</code> directory. 
<pre class="screen">
# 64-bit JVM
-agentpath:/usr/lib64/oprofile/libjvmti_oprofile.so
# 32-bit JVM
-agentpath:/usr/lib/oprofile/libjvmti_oprofile.so
</pre>

		</div><div class="para">
			For example: 
<pre class="screen">
# Specify options to pass to the Java VM.
#
if [ "x$JAVA_OPTS" = "x" ]; then
   JAVA_OPTS="-Xms10240m -Xmx10240m -XX:+UseLargePages -XX:+UseParallelOldGC"
   JAVA_OPTS="$JAVA_OPTS -Djava.net.preferIPv4Stack=true -Dorg.jboss.resolver.warning=true"
   JAVA_OPTS="$JAVA_OPTS -Dsun.rmi.dgc.client.gcInterval=3600000 -Dsun.rmi.dgc.server.gcInterval=3600000"
   JAVA_OPTS="$JAVA_OPTS -agentpath:/usr/lib64/oprofile/libjvmti_oprofile.so"
fi
</pre>

		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Control_OProfile">
      ⁠</a>10.3. Controlling OProfile</h1></div></div></div><div class="para">
			OProfile runs as a daemon and must be running while profiling data is collected. The command-line utility <code class="command">opcontrol</code> is used to manage OProfile's state.
		</div><pre class="screen">
opcontrol --start-daemon
</pre><div class="para">
			Starts the OProfile daemon. This can be done at any time prior to collecting profile data.
		</div><pre class="screen">
opcontrol --start
</pre><div class="para">
			Starts the collection of profiling data. This command must be given before starting the workload to be profiled.
		</div><pre class="screen">
opcontrol --stop
</pre><div class="para">
			Stops the collection of profiling data.
		</div><pre class="screen">
opcontrol --dump
</pre><div class="para">
			Dumps the profiling data to the default file.
		</div><pre class="screen">
opcontrol --shutdown
</pre><div class="para">
			Shuts down the OProfile daemon.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Data_Capture">
      ⁠</a>10.4. Data Capture</h1></div></div></div><div class="para">
			Before starting any profiling, start the OProfile daemon. Once it is running, each profiling session typically consists of the following steps:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Start capturing profiling data
				</div></li><li class="listitem"><div class="para">
					Start/run the workload
				</div></li><li class="listitem"><div class="para">
					Stop capturing profiling data
				</div></li><li class="listitem"><div class="para">
					Dump profiling data
				</div></li><li class="listitem"><div class="para">
					Generate the profiling report
				</div></li></ol></div><div class="para">
			The simplest profiling report is produced by the command:
		</div><pre class="screen">
opreport -l --output-file=&lt;filename&gt;
</pre><div class="para">
			This command produces a list of processes and their CPU cycles, from highest to lowest. Note that OProfile monitors the entire system, not just the Java processes. For additional information on OProfile, including additional reporting options, refer to the man page and the home page - <a href="http://oprofile.sourceforge.net">http://oprofile.sourceforge.net</a>.
		</div></div></div></body></html>