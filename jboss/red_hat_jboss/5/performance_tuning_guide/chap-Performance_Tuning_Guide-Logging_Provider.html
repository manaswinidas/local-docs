<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 7. Logging Provider</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Performance_Tuning_Guide-Logging_Provider">
      ⁠</a>Chapter 7. Logging Provider</h1></div></div></div><div class="para">
		In discussing logging and its impact on performance, there are four topics to be covered:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				console logging
			</div></li><li class="listitem"><div class="para">
				type of appender to use
			</div></li><li class="listitem"><div class="para">
				location of log files
			</div></li><li class="listitem"><div class="para">
				wrapping of log statements
			</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Performance_Tuning_Guide-Logging_Provider-Console_Logging">
      ⁠</a>7.1. Console Logging</h1></div></div></div><div class="para">
			Console logging is by far the most expensive form of logging in terms of time because console output is not buffered. All configurations, except for the production configuration, have console logging enabled because it's very convenient during development. It's especially convenient when using an IDE, such as JBoss Developer Studio, and any other IDE for that matter. With console logging on, all messages that go to the log show up in the IDE, which is an advantage when doing development work. However it's a distinct disadvantage in a production environment because it's slow and expensive.
		</div><div class="para">
			The simplest method to avoid console logging is to use the production configuration. If a new, custom configuration is to be created, base that configuration on the production configuration. To disable console logging for an existing configuration, it's necessary to edit the logging configuration file <code class="filename">jboss-log4j.xml</code> in the directory <code class="filename">JBOSS_EAP_DIST/jboss-as/server/<em class="replaceable">PROFILE</em>/conf</code>. Note that the <code class="literal">production</code> configuration is preconfigured with console logging disabled.
		</div><div class="para">
			The following is an extract of the relevant sections from the production configuration file:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>log4j:configuration SYSTEM "log4j.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ===================================================================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--                                                                       --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--  Log4j Configuration                                                  --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--                                                                       --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ===================================================================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ====================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- More Appender examples --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ====================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Buffer events and log them asynchronously --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;appender</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ASYNC"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.log4j.AsyncAppender"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;errorHandler</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.logging.util.OnlyOnceErrorHandler"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"FILE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"CONSOLE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"SMTP"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/appender&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ======================= --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Setup the Root category --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ======================= --&gt;</span><span xmlns="" class="perl_Keyword">&lt;root&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!--</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      Set the root logger priority via a system property. </span><span xmlns="" class="perl_Alert">Note</span><span xmlns="" class="perl_Comment"> this is parsed by log4j,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      so the full JBoss system property format is not supported; e.g.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      setting a default via ${jboss.server.log.threshold:WARN} will not work.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;priority</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.server.log.threshold}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"CONSOLE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"FILE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/root&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>/log4j:configuration&gt;</pre><div class="para">
			Console logging can be disabled either by deleting the entire Appender section from the configuration file or deleting the line containing &lt;appender-ref ref="CONSOLE"/&gt;
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Performance_Tuning_Guide-Logging_Provider-Appenders">
      ⁠</a>7.2. Appenders</h1></div></div></div><div class="para">
			Console logging is a form of appender and there are two other main types of file based appenders, one that writes synchronously and the other asynchronously. The amount of data logged by an application can vary greatly according to what the application does and how it behaves. If a problem occurs in the background, for instance, there may be a sudden increase in logging occurrences, resulting in performance degradation of the application. The asynchronous appender is recommended over the synchronous appender because it will generally perform better. The difference in performance varies on the amount of logging that is typical for the application.
		</div><div class="para">
			The easiest method of using the asynchronous appender is to use the production configuration or base a new configuration on it because it (as noted earlier) has console logging disabled but the asynchronous appender enabled. The configuration file to be modified is <code class="filename">jboss-log4.xml</code> in the directory <code class="filename">JBOSS_EAP_DIST/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/conf</code>.
		</div><div class="para">
			The following is an extract of the two relevant sections from the production configuration file:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>log4j:configuration SYSTEM "log4j.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ===================================================================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--                                                                       --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--  Log4j Configuration                                                  --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--                                                                       --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ===================================================================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;log4j:configuration</span><span xmlns="" class="perl_Others"> xmlns:log4j=</span><span xmlns="" class="perl_String">"http://jakarta.apache.org/log4j/"</span><span xmlns="" class="perl_Others"> debug=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ====================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- More Appender examples --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ====================== --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Buffer events and log them asynchronously --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;appender</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ASYNC"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.log4j.AsyncAppender"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;errorHandler</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.logging.util.OnlyOnceErrorHandler"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"FILE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!--</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   &lt;appender-ref ref="CONSOLE"/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   &lt;appender-ref ref="SMTP"/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/appender&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ======================= --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Setup the Root category --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- ======================= --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;root&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!--</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       Set the root logger priority via a system property. </span><span xmlns="" class="perl_Alert">Note</span><span xmlns="" class="perl_Comment"> this is parsed by log4j,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       so the full JBoss system property format is not supported; e.g.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       setting a default via ${jboss.server.log.threshold:WARN} will not work.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;priority</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.server.log.threshold}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- appender-ref ref="CONSOLE"/ --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;appender-ref</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"ASYNC"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/root&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/log4j:configuration&gt;</span>
</pre><div class="para">
			In the ASYNC appender configuration, the FILE-based appender is active but the CONSOLE and SMTP appenders are explicitly excluded. In the Root category, the Appender reference is ASYNC, enabling the asynchronous appender.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Performance_Tuning_Guide-Logging_Provider-Location_of_Log_Files">
      ⁠</a>7.3. Location of Log Files</h1></div></div></div><div class="para">
			The storage location of log files should be considered as a potential performance issue. Logging could perform poorly if on a file system and disk configuration that is poor for I/O throughput, degrading the whole platform's performance. The likely performance impact is heavily dependent on the rate at which messages are logged. Even if the logging rate is normally quite low, there can be an impact if debug/trace logging needs to be enabled to troubleshoot an issue. With this form of logging enabled the logs can grow very fast and impact performance dramatically, also making it more difficult to get the information needed.
		</div><div class="para">
			To change the storage location of log files choose one of the following options, with option 1 recommended because it's easier to maintain:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Specify the preferred value for the variable from the command-line when starting JBoss Enterprise Application Platform, such as: -Djboss.server.log.dir=<em class="replaceable">&lt;path_for_log_files&gt;</em>
				</div></li><li class="listitem"><div class="para">
					Edit the configuration file, replacing the variable ${jboss.server.log.dir} with the preferred path.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Performance_Tuning_Guide-Logging_Provider-Wrapping_Log_Statements">
      ⁠</a>7.4. Wrapping Log Statements</h1></div></div></div><div class="para">
			Here the discussion is not about the logging of JBoss Enterprise Application Platform but the application's own logging. It's common practice for developers to make liberal use of the code like the following example:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span> log.<span xmlns="" class="perl_Function">debug</span>(“Some text…” + Object);
</pre><div class="para">
			There does not seem to be anything obviously wrong with the code. It states that when debug logging is turned on, the message should be written to the log. Since an application is only run with debug logging turned on when debugging is being done, you would not expect any impact on performance. In fact there is a likely impact and it occurs because of the way statements like this are evaluated by the platform. Before the statement itself is evaluated, a lot of activity occurs in preparation: creation of temporary string objects, calling the object's toString() method, creation of an internal LoggingEvent object, formatting data, getting the current date, getting the thread ID of the calling thread and so on. Once all this is complete the statement is finally evaluated and if debug logging is not enabled, the created objects are again destroyed and processing continues to the next statement. The creation of these objects takes system resources, mainly CPU cycles and memory, with the performance impact multiplied by the number of debug statements processed.
		</div><div class="para">
			There's a method which can reduce the performance impact of using debug statements, in which they're wrapped in a boolean statement. As the following example shows, whether or not debug logging is enabled is first evaluated and only then does the processing of the debug statement occur. There is a trade-off between processing of the boolean statement versus that of the debug statement but fewer system resources are used and so the performance impact is reduced.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">if</span> (<span xmlns="" class="perl_Function">debugEnabled</span>()) {
<span xmlns="" class="line">​</span>   log.<span xmlns="" class="perl_Function">debug</span>(“Some text...” + Object);
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			It's not necessary to wrap <span class="emphasis"><em>every</em></span> debug statement, only those which are often encountered. Take the example of a debug statement placed in a <code class="literal">try..catch</code> structure, where the exception is rare. Since the debug statement will only rarely be evaluated, the performance difference between wrapping and not wrapping the statement in a boolean expression is likely to be minimal. As usual, there should be a measurable gain from the effort put into performance improvements.
		</div></div></div></body></html>