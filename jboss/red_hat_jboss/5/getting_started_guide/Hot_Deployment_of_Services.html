<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 6. Hot Deployment of Services</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Hot_Deployment_of_Services">
      ⁠</a>Chapter 6. Hot Deployment of Services</h1></div></div></div><div class="para">
		Hot-deployable services are services which can be added to or removed from the running server. Such services are placed in the <code class="filename">JBOSS_DIST/jboss-as/server/&lt;instance-name &gt;/deploy</code> directory. Let’s have a look at a practical example of hot deployment of services.
	</div><div class="para">
		Make sure EAP is running and change to the <code class="filename">JBOSS_DIST/jboss-as/server/default/deploy</code> directory. Remove the <code class="filename">mail-service.xml</code> file and watch the output from the server:
	</div><pre class="screen">13:10:05,235 INFO  [MailService] Mail service 'java:/Mail' removed from JNDI

Then replace the file and watch JBoss re-install the service:

13:58:54,331 INFO  [MailService] Mail Service bound to java:/Mail
</pre><div class="para">
		You have just undeployed the mail service during server runtime: this is hot-deployment in action.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Hot-Deployment_Configuration">
      ⁠</a>6.1. Hot-Deployment Configuration</h1></div></div></div><div class="para">
			Hot deployment of services in the server is controlled by the <code class="classname">HDScanner</code> MC bean configured in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hdscanner-jboss-beans.xml</code> file. For example, the bean sets the <span class="property">scanPeriod</span> attribute, which controls the run interval for the thread that picks up the hot deployable changes. The <span class="property">scanPeriod</span> property is set to 5 seconds by default (refer to <a class="xref" href="Hot_Deployment_of_Services.html#HDScanner_Bean">Figure 6.1, “HDScanner Bean Default Configuration”</a>).
		</div><div class="figure"><a id="HDScanner_Bean">
      ⁠</a><div class="figure-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"HDScanner"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.system.server.profileservice.hotdeploy.HDScanner"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"deployer"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"ProfileServiceDeployer"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"profileService"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"ProfileService"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"scanPeriod"</span><span xmlns="" class="perl_Keyword">&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"scanThreadName"</span><span xmlns="" class="perl_Keyword">&gt;</span>HDScanner<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre></div><p class="title"><strong>Figure 6.1. HDScanner Bean Default Configuration</strong></p></div><div class="para">

		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>The hdscanner-jboss-beans.xml file is Hot Deployable</strong></p></div><div class="admonition"><div class="para">
				Changes to the <code class="filename">hdscanner-jboss-beans.xml</code> file are hot deployable: no server restart is needed.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Adding_Custom_Deploy_Directory">
      ⁠</a>6.2. Adding a Custom Deploy Directory</h1></div></div></div><div class="para">
			EAP by default looks for deployments under the <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/&lt;instance-name&gt;/deploy</code> directory. However you can configure the server to include custom directories for scanning deployments. To do so, configure the <code class="classname">BootstrapProfileFactory</code> MC bean in <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/conf/bootstrap/profile.xml</code> file: add the custom directory to the <span class="property">applicationURIs</span> property of the <code class="classname">BootstrapProfileFactory</code>, which defines a list of URLs scanned for applications (refer to <a class="xref" href="Hot_Deployment_of_Services.html#Custom_Deployment_Directory">Example 6.1, “The /home/me/myapps Directory Defined as Custom Deploy Directory”</a>).
		</div><div class="example"><a id="Custom_Deployment_Directory">
      ⁠</a><p class="title"><strong>Example 6.1. The /home/me/myapps Directory Defined as Custom Deploy Directory</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"BootstrapProfileFactory"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.system.server.profileservice.repository.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">StaticProfileFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"applicationURIs"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;list</span><span xmlns="" class="perl_Others"> elementClass=</span><span xmlns="" class="perl_String">"java.net.URI"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>${jboss.server.home.url}deploy<span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>file:///home/me/myapps<span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/list&gt;</span>
<span xmlns="" class="line">​</span>   ...
</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Changes to profile.xml Require Server Restart</strong></p></div><div class="admonition"><div class="para">
				After modifying the <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/conf/bootstrap/profile.xml</code> file, you need to restart the server for the changes to take effect.
			</div></div></div><div class="para">
			For performance reasons, adding a new deployment directory to the BootstrapProfileFactory also requires the same URL to be added to the <code class="classname">VFSCache</code> MC bean configuration in <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/conf/bootstrap/vfs.xml</code> (refer to <a class="xref" href="Hot_Deployment_of_Services.html#Custom_Dir_in_VFSCache">Example 6.2, “The /home/me/myapps Directory Added to VFSCache”</a>).
		</div><div class="example"><a id="Custom_Dir_in_VFSCache">
      ⁠</a><p class="title"><strong>Example 6.2. The /home/me/myapps Directory Added to VFSCache</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"VFSCache"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"permanentRoots"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> keyClass=</span><span xmlns="" class="perl_String">"java.net.URL"</span><span xmlns="" class="perl_Others"> valueClass=</span><span xmlns="" class="perl_String">"org.jboss.virtual.spi.ExceptionHandler"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         ...
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key&gt;</span>file:///home/me/myapps<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;value&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"VfsNamesExceptionHandler"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   ...</pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				Not adding the custom deployment directory to the <code class="classname">VFSCache</code> bean might result in growing disk space usage by the server.
			</div></div></div></div></div></body></html>