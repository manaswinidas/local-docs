<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 8. Datasources</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Using_other_Databases">
      ⁠</a>Chapter 8. Datasources</h1></div></div></div><div class="para">
		JBoss Enterprise Application Platform is shipped with an example datasource configured to allow it to operate out of the box with the included Hypersonic database. The datasource is bound to the JNDI name <code class="literal">java:/DefaultDS</code> and its descriptor is the <code class="filename"><em class="replaceable">&lt;$JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hsqldb-ds.xml</code> file.
	</div><div class="para">
		The <code class="literal">DefaultDS</code> JNDI name and <code class="filename">hsqldb-ds.xml</code> configuration is not required for normal platform operation. Delete this datasource before deploying a production instance.
	</div><div class="task"><p class="title"><strong>Accessing the Database Manager of the Default Hypersonic Database</strong></p><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><div class="para">
			To access and edit the Hypersonic database that is available by default, do the following:
		</div><ol class="1"><li class="step"><div class="para">
				Make sure JBoss Enterprise Application Platform is running.
			</div></li><li class="step"><div class="para">
				Open the JMX console located by default on <a href="http://localhost:8080/jmx-console/">http://localhost:8080/jmx-console/</a>.
			</div></li><li class="step"><div class="para">
				On the displayed JMX Console page, click the <code class="literal">database=localDB,service=Hypersonic</code> entry in the <code class="literal">jboss</code> section.
			</div></li><li class="step"><div class="para">
				On the <code class="literal">JMX MBean View</code> page of the Hypersonic MBean, click <span class="guibutton"><strong>Invoke</strong></span> in the <code class="literal">startDatabaseManager</code> row to invoke the GUI interface of the database manager.
			</div></li></ol></div><div class="taskrelated"> <div class="para">
		The <span class="application"><strong>HSQL Database Manager</strong></span> window with the default local Hypersonic database appears.
	</div>
	 <div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Do not Use Hypersonic in Production Deployments</strong></p></div><div class="admonition"><div class="para">
			The default persistence configuration is intended only for development purposes and to allow JBoss Enterprise Application Platform to run out of the box. However, <span class="strong strong"><strong>Hypersonic is not supported in production and should not be used in a production environment.</strong></span>
		</div><div class="para">
			Known issues with the Hypersonic database include the following:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					no transaction isolation
				</div></li><li class="listitem"><div class="para">
					thread and socket leaks ( <code class="methodname"> connection.close() </code> does not tidy up resources)
				</div></li><li class="listitem"><div class="para">
					persistence quality (logs commonly become corrupted after a failure, preventing automatic recovery)
				</div></li><li class="listitem"><div class="para">
					database corruption
				</div></li><li class="listitem"><div class="para">
					stability under load (database processes cease when dealing with too much data)
				</div></li><li class="listitem"><div class="para">
					not viable in clustered environments.
				</div></li></ul></div></div></div>
	 </div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Using_other_Databases-DataSource_Configuration_Files">
      ⁠</a>8.1. Configuring Datasources</h1></div></div></div><div class="para">
			When configuring a custom datasource, you need to create the datasource configuration file, so that the JCA deployer detects and deploys the datasource: a datasource configuration file name has the <code class="filename">-ds.xml</code> suffix. The <code class="filename">docs/examples/jca</code> directory contains example files for several databases and it is recommended to adapt one of these files to create your configuration file.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Information about Datasources</strong></p></div><div class="admonition"><div class="para">
				The full description of the configuration format is available in the <code class="filename">docs/dtd/jboss-ds_1_5.dtd</code> file. Additional documentation on the files and the JBoss JCA implementation are available in the <em class="citetitle">Administration and Configuration Guide</em>.
			</div></div></div><div class="para">
			Local transaction datasources are configured using the <code class="sgmltag-element">local-tx-datasource</code> element and XA-compliant ones using <code class="sgmltag-element">xa-datasource</code>. The example file <code class="filename">generic-ds.xml</code> shows how to use both types and also some of the other elements that are available for things like connection pool configuration. Examples of both local and XA configurations are available for Oracle, DB2 and Informix.
		</div><div class="para">
			The example files <code class="filename"> firebird-ds.xml</code>, <code class="filename"> facets-ds.xml</code> and <code class="filename">sap3-ds.xml</code> are defined with the <code class="literal">connection-factories</code> root element rather than <code class="literal">datasources</code>. That is because they use an alternative, more generic JCA configuration syntax used with a pre-packaged JCA resource adapter. The syntax is not specific to datasource configuration and is used, for example, in the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/messaging/jms-ds.xml</code> file to configure the JMS resource adapter.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Using_other_Databases-Using_MySQL_as_the_Default_DataSource">
      ⁠</a>8.2. MySQL as the Default Datasource</h1></div></div></div><div class="para">
			The MySQL® database has become the most popular open source database. We will configure a datasource to this database for demonstration purposes.
		</div><div class="para">
			In this example we are using MySQL 5.1.31 and <code class="literal">Connector/J</code> 5.1.8, the official JDBC driver. Both are available at <a href="http://www.mysql.com">www.mysql.com</a>.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_MySQL_as_the_Default_DataSource-Creating_a_Database_and_User">
      ⁠</a>8.2.1. Creating a Database and User</h2></div></div></div><div class="para">
				We’ll assume that you have already installed MySQL, have it running, and are familiar with the basics. Run the MySQL client program from the command line so we can execute some administration commands. You should make sure that you are connected as a user with sufficient privileges (for example, by specifying the <code class="code">-u</code> root option to run as the MySQL root user).
			</div><div class="para">
				First create a database called <code class="literal">jboss</code> within MySQL for use by JBoss:
			</div><pre class="programlisting">
mysql&gt; CREATE DATABASE jboss;
Query OK, 1 row affected (0.05 sec)
</pre><div class="para">
				Then check that it has been created:
			</div><pre class="screen">
mysql&gt; SHOW DATABASES;
+----------+
| Database |
+----------+
| jboss    |
+----------+
1 rows in set (0.00 sec)
</pre><div class="para">
				Next, create a user called <code class="literal">jboss</code> with 'password' as the password to access the database:
			</div><pre class="programlisting">
mysql&gt; GRANT ALL PRIVILEGES ON jboss.* TO jboss@localhost IDENTIFIED BY 'password';
Query OK, 0 rows affected (0.06 sec)
</pre><div class="para">
				Again, you can check that everything has gone smoothly:
			</div><pre class="screen">
mysql&gt; select User,Host,Password from mysql.user;
+-------+-----------+------------------+
| User  | Host      | Password         |
+-------+-----------+------------------+
| root  | localhost |                  |
| root  | %         |                  |
|       | localhost |                  |
|       | %         |                  |
| jboss | localhost | 5d2e19393cc5ef67 |
+-------+-----------+------------------+
5 rows in set (0.02 sec)
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Using_MySQL_as_the_Default_DataSource-Installing_the_JDBC_Driver_and_Deploying_the_DataSource">
      ⁠</a>8.2.2. Installing the JDBC Driver and Deploying the Datasource</h2></div></div></div><div class="para">
				To add MySQL database connection support to JBoss Enterprise Application Platform:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140132751561232">
      ⁠</a><p class="title"><strong>Procedure 8.1. Red Hat Enterprise Linux 6</strong></p><ol class="1"><li class="step"><div class="para">
						Run the following command to install the connector:
					</div><pre class="programlisting"><code class="command">yum install mysql-connector-java</code></pre></li><li class="step"><div class="para">
						Run the following command to link the new connector to the JBoss Enterprise Application Platform installation:
					</div><pre class="programlisting"><code class="command">ln -s /usr/lib[64]/gcj/mysql-connector-java/mysql-connector-java&lt;version&gt;.jar.so jboss-as/server/common/lib/mysql-connector-java.jar</code></pre></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140132738882864">
      ⁠</a><p class="title"><strong>Procedure 8.2. Other Platforms</strong></p><ol class="1"><li class="step"><div class="para">
						Download the MySQL Connector/J JDBC Connector from <a href="http://www.mysql.com">http://www.mysql.com</a>
					</div></li><li class="step"><div class="para">
						Deploy the connector:
					</div><ol class="substeps a"><li class="step"><p class="title"><strong>To make the connector available to all server profiles;</strong></p><div class="para">
								Extract the <code class="filename">mysql-connector-java-<em class="replaceable">&lt;version&gt;</em>.jar</code> file to <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/common/lib</code>.
							</div></li><li class="step"><p class="title"><strong>To make the connector available to selected profiles only;</strong></p><div class="para">
								Extract the file to the <code class="filename">lib</code> directory in those server profile directories.
							</div></li></ol></li></ol></div><div class="para">
				Then create a file in the deploy directory called <code class="filename">mysql-ds.xml</code> with the following datasource configuration. Note that the database user name and password corresponds to the MySQL user that we created in the previous section:
			</div><pre class="programlisting XML">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;datasources&gt;
   &lt;local-tx-datasource&gt;
      &lt;jndi-name&gt;DefaultDS&lt;/jndi-name&gt;
      &lt;connection-url&gt;jdbc:mysql://localhost:3306/jboss&lt;/connection-url&gt;
      &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
      &lt;user-name&gt;jboss&lt;/user-name&gt;
      &lt;password&gt;password&lt;/password&gt;
      &lt;metadatda&gt;
         &lt;type-mapping&gt;mySQL&lt;/type-mapping&gt;
      &lt;/metadata&gt;
      &lt;transaction-isolation&gt;TRANSACTION_READ_COMMITTED&lt;/transaction-isolation&gt; 
   &lt;/local-tx-datasource&gt;
&lt;/datasources&gt;
</pre><div class="para">
				To ensure that you have correctly configured the datasource in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy</code> folder, start the server and you will notice messages like these in the logs:
			</div><pre class="screen">
INFO  [ConnectionFactoryBindingService] Bound ConnectionManager 'jboss.jca:service=DataSourceBinding,name=MySqlDS' to JNDI name 'java:MySqlDS'
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Configuring other datasources is a similar process.
				</div></div></div></div></div></div></body></html>