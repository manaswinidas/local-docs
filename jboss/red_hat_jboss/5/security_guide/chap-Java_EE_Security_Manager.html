<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 14. Java Security Manager</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Java_EE_Security_Manager">
      ⁠</a>Chapter 14. Java Security Manager</h1></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Java Security Manager</span></dt><dd><div class="para">
					The Java Security Manager is a class that manages the external boundary of the Java Virtual Machine (JVM) sandbox, controlling how code executing within the JVM can interact with resources outside the JVM. When the Java Security Manager is activated the Java API checks with the security manager for approval before executing a wide range of potentially unsafe operations.
				</div></dd></dl></div><div class="para">
		The Security Manager uses a security policy to determine whether a given action will be permitted or denied.
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Security Policy</span></dt><dd><div class="para">
					A set of defined permissions for different classes of code. The Java Security Manager compares actions requested by applications against the security policy. If an action is allowed by the policy, the Security Manager will permit that action to take place. If the action is not allowed by the policy, the Security Manager will deny that action. The security policy can define permissions based on the location of code or on the code's signature.
				</div></dd></dl></div><div class="para">
		The Security Manager and the security policy used are configured using the Java Virtual Machine options <code class="varname"> java.security.manager </code> and <code class="varname"> java.security.policy </code> .
	</div><div class="variablelist"><a id="ref-Security_Manager_options">
      ⁠</a><p class="title"><strong>Security Manager-related options</strong></p><dl class="variablelist"><dt><span class="term">java.security.manager</span></dt><dd><div class="para">
					Use a security manager, optionally specifying which security manager to use. If no argument is supplied with this option the default JDK security manager, <code class="classname">java.lang.SecurityManager</code>, is used. To use another security manager implementation, supply the fully qualified classname of a subclass of <code class="literal">java.lang.SecurityManager</code> with this option.
				</div></dd><dt><span class="term">java.security.policy</span></dt><dd><div class="para">
					Specifies a policy file to augment or replace the default security policy for the VM. This option takes two forms: 
					<div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal"> java.security.policy=<em class="replaceable">policyFileURL</em></code></span></dt><dd><div class="para">
									The policy file referenced by <em class="replaceable">policyFileURL</em> will <span class="emphasis"><em>augment</em></span> the default security policy configured by the VM.
								</div></dd><dt><span class="term"><code class="literal"> java.security.policy==<em class="replaceable">policyFileURL</em></code></span></dt><dd><div class="para">
									The policy file referenced by <em class="replaceable">policyFileURL</em> will <span class="emphasis"><em>replace</em></span> the default security policy configured by the VM.
								</div></dd></dl></div>

				</div><div class="para">
					The <em class="replaceable">policyFileURL</em> value can be a URL or a file path.
				</div></dd></dl></div><div class="para">
		JBoss Enterprise Application Platform does not activate the Java Security Manager by default. To configure the Platform to use the Security Manager, refer to <a class="xref" href="chap-Java_EE_Security_Manager.html#sect-Activate_Security_Manager">Section 14.1, “Using the Security Manager”</a> .
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Activate_Security_Manager">
      ⁠</a>14.1. Using the Security Manager</h1></div></div></div><div class="para">
			JBoss Enterprise Application Platform can use the JDK default Security Manager or a custom security manager. For details on selecting a custom Security Manager, refer to <a class="xref" href="chap-Java_EE_Security_Manager.html#ref-Security_Manager_options">Security Manager-related options</a> .
		</div><div class="para">
			When the Platform is configured to use a security manager, a security policy file must be specified. A security policy file, <code class="filename">jboss-as/bin/server.policy.cert</code> is included as a starting point.
		</div><div class="para">
			For information on writing security policy, refer to <a class="xref" href="chap-Java_EE_Security_Manager.html#sect-Writing_Your_Own_Security_Policy">Section 14.3, “Writing Security Policy for JBoss Enterprise Application Platform”</a> .
		</div><div class="para"><a id="note_on_config_file">
      ⁠</a><div xmlns:d="http://docbook.org/ns/docbook" class="title">Configuration File</div>
				The file <code class="filename">run.conf</code> (Linux) or <code class="filename">run.conf.bat</code> (Windows) is used to configure the Security Manager and security policy. This file is found in the <code class="filename">jboss-as/bin</code> directory.
			</div><div class="para">
			This file is used to configure server-level options, and applies to all server profiles. Configuring the Security Manager and security policy involves profile-specific configuration. You may elect to copy the global <code class="filename">run.conf</code> or <code class="filename">run.conf.bat</code> file from <code class="filename">jboss-as/bin/</code> to the server profile (for example: <code class="filename">jboss-as/server/production/run.conf</code> ), and make the configuration changes there. A configuration file in the server profile takes precedence over the global <code class="filename">run.conf</code> / <code class="filename">run.conf.bat</code> file when the server profile is started.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921687110832">
      ⁠</a><p class="title"><strong>Procedure 14.1. Activate the Security Manager</strong></p><div class="para">
				This procedure configures JBoss Enterprise Application Platform to start with the Java Security Manager activated.
			</div><div class="para">
				The file editing actions in this procedure refer to the file <code class="filename">run.conf</code> (Linux), or <code class="filename">run.conf.bat</code> (Windows) in the server profile directory, if one exists there, or in <code class="filename">jboss-as/bin</code> . Refer to <a class="xref" href="chap-Java_EE_Security_Manager.html#note_on_config_file">Configuration File</a> for details on the location of this file.
			</div><ol class="1"><li class="step"><p class="title"><strong>Specify the JBoss home directory</strong></p><div class="para">
					Edit the file <code class="filename">run.conf</code> (Linux), or <code class="filename">run.conf.bat</code> (Windows). Add the <code class="varname"> jboss.home.dir </code> option, specifying the path to the <code class="filename">jboss-as</code> directory of your installation.
				</div><div class="para"><div class="title">Linux</div>
						
<pre class="screen">JAVA_OPTS="$JAVA_OPTS -Djboss.home.dir=<em class="replaceable">/path/to/jboss-eap-5.1/jboss-as</em>"</pre>

					</div><div class="para"><div class="title">Windows</div>
						
<pre class="screen">JAVA_OPTS="%JAVA_OPTS% -Djboss.home.dir=<em class="replaceable">c:\path\jboss-eap-5.1\jboss-as</em>"</pre>

					</div></li><li class="step"><p class="title"><strong>Specify the server home directory</strong></p><div class="para">
					Add the <code class="varname"> jboss.server.home.dir </code> option, specifying the path to your server profile.
				</div><div class="para"><div class="title">Linux</div>
						
<pre class="screen">JAVA_OPTS="$JAVA_OPTS -Djboss.server.home.dir=<em class="replaceable">path/to/jboss-eap-5.1/jboss-as/server/production</em>"</pre>

					</div><div class="para"><div class="title">Windows</div>
						
<pre class="screen">JAVA_OPTS="%JAVA_OPTS% -Djboss.server.home.dir=<em class="replaceable">c:\path\to\jboss-eap-5.1\jboss-as\server\production</em>"</pre>

					</div></li><li class="step"><p class="title"><strong>Specify the Protocol Handler</strong></p><div class="para">
					Add the <code class="varname"> java.protocol.handler.pkgs </code> option, specifying the JBoss stub handler.
				</div><div class="para"><div class="title">Linux</div>
						
<pre class="screen">JAVA_OPTS="$JAVA_OPTS -Djava.protocol.handler.pkgs=org.jboss.handlers.stub"</pre>

					</div><div class="para"><div class="title">Windows</div>
						
<pre class="screen">JAVA_OPTS="%JAVA_OPTS% -Djava.protocol.handler.pkgs=org.jboss.handlers.stub"</pre>

					</div></li><li class="step"><p class="title"><strong>Specify the security policy to use</strong></p><div class="para">
					Add the <code class="varname"> $POLICY </code> variable, specifying the security policy to use. Add the variable definition before the line that activates the Security Manager.
				</div><div class="example"><a id="idm139921696049872">
      ⁠</a><p class="title"><strong>Example 14.1. Use the Platform's included security policy</strong></p><div class="example-contents"><pre class="screen">POLICY="server.policy.cert"</pre></div></div></li><li class="step"><p class="title"><strong>Activate the Security Manager</strong></p><div class="para">
					Uncomment the following line by removing the initial <code class="literal">#</code> :
				</div><div class="para"><div class="title">Linux</div>
						
<pre class="screen">#JAVA_OPTS="$JAVA_OPTS -Djava.security.manager -Djava.security.policy=$POLICY"</pre>

					</div><div class="para"><div class="title">Windows</div>
						
<pre class="screen">#JAVA_OPTS="%JAVA_OPTS% -Djava.security.manager -Djava.security.policy=%POLICY%"</pre>

					</div><div class="para"><div class="title">Result:</div>
						JBoss Enterprise Application Platform is now configured to start with the Security Manager activated.
					</div></li><li class="step"><p class="title"><strong>Optional: Import Red Hat's JBoss signing key</strong></p><div class="para">
					The included security policy grants permissions to JBoss-signed code. If you use the included policy you must import the JBoss signing key to the JDK <code class="filename">cacerts</code> key store.
				</div><div class="para">
					The following command assumes that the environment variable <code class="envar"> JAVA_HOME </code> is set to the location of a JDK supported by JBoss Enterprise Application Platform 5. You configure <code class="envar"> JAVA_HOME </code> when you first install JBoss Enterprise Application Platform 5. Refer to the <em class="citetitle">Installation Guide</em> for further information.
				</div><div class="note"><div class="admonition_header"><p><strong>JVM Selection</strong></p></div><div class="admonition"><div class="para">
						To ensure the correct JVM is selected, you can use the <code class="command">alternatives</code> command to select from JDKs installed on your Linux system. Refer to <a class="xref" href="appendix-use_alternatives_to_set_default_JDK.html">Appendix A, <em>Setting the default JDK with the <code class="command">/usr/sbin/alternatives</code> Utility</em></a>.
					</div></div></div><div class="para">
					Execute the following command in a terminal, replacing <em class="replaceable">JAVA_HOME</em> with the directory location of your Java installation:
				</div><div class="para"><div class="title">Linux</div>
						
<pre class="screen">[~]$ sudo <em class="replaceable">JAVA_HOME</em>/bin/keytool -import -alias jboss -file JBossPublicKey.RSA \
-keystore <em class="replaceable">JAVA_HOME</em>/jre/lib/security/cacerts</pre>

					</div><div class="para"><div class="title">Windows</div>
						
<pre class="screen">C:&gt; <em class="replaceable">JAVA_HOME</em>\bin\keytool -import  -alias jboss -file JBossPublicKey.RSA -keystore <em class="replaceable">JAVA_HOME</em>\jre\lib\security\cacerts</pre>

					</div><div class="para">
					Although broken across two lines in this documentation, the commands above should be entered on one single line in a terminal.
				</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The default password for the cacerts key store is <code class="literal">changeit</code> .
					</div></div></div><div class="para"><div class="title">Result:</div>
						The key used to the sign the JBoss Enterprise Application Platform code is now installed.
					</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139921627436464">
      ⁠</a>14.2. Debugging Security Policy Issues</h1></div></div></div><div class="para">
			You can enable debugging information to help you troubleshoot security policy-related issues. The <code class="varname"> java.security.debug </code> option configures the level of security-related information reported.
		</div><div class="para">
			The command <code class="command">java -Djava.security.debug=help</code> will produce help output with the full range of debugging options. Setting the debug level to <code class="literal">all</code> is useful when troubleshooting a security-related failure whose cause is completely unknown, but for general use it will produce too much information. A sensible general default is <code class="literal">access:failure</code> .
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-General_Debugging">
      ⁠</a><p class="title"><strong>Procedure 14.2. Enable general debugging</strong></p><div class="para">
				This procedure will enable a sensible general level of security-related debug information.
			</div><ul><li class="step"><div class="para">
					Add the following line to the file <code class="filename">run.conf</code> (Linux), or <code class="filename">run.conf.bat</code> (Windows):
				</div><div class="para"><div class="title">Linux</div>
						
<pre class="screen">JAVA_OPTS="$JAVA_OPTS -Djava.security.debug=access:failure"</pre>

					</div><div class="para"><div class="title">Windows</div>
						
<pre class="screen">JAVA_OPTS="%JAVA_OPTS% -Djava.security.debug=access:failure"</pre>

					</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139921696817712">
      ⁠</a>14.2.1. Debugging Security Manager</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>New feature in version 5.1</strong></p></div><div class="admonition"><div class="para">
					The Debugging Security Manager was introduced with JBoss Enterprise Application Platform 5.1
				</div></div></div><div class="para">
				The Debugging Security Manager <code class="classname">org.jboss.system.security.DebuggingJavaSecurityManager</code> prints out the protection domain corresponding to a failing permission. This additional information is very useful information when debugging permissions problems.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921689814416">
      ⁠</a><p class="title"><strong>Procedure 14.3. Enable the Debugging Security Manager</strong></p><div class="para">
					This procedure will enable the Debugging Security Manager.
				</div><ol class="1"><li class="step"><div class="para">
						Add the following option to <code class="filename">$JBOSS_HOME/bin/run.conf</code> (Linux) or <code class="filename">$JBOSS_HOME/bin/run.conf.bat</code>. See <a class="xref" href="chap-Java_EE_Security_Manager.html#note_on_config_file">Configuration File</a> for the location of this file.
					</div><div class="para"><div class="title">Linux</div>
							
<pre class="screen">JAVA_OPTS="$JAVA_OPTS -Djava.security.manager=org.jboss.system.security.DebuggingJavaSecurityManager"</pre>

						</div><div class="para"><div class="title">Windows</div>
							
<pre class="screen">JAVA_OPTS="%JAVA_OPTS% -Djava.security.manager=org.jboss.system.security.DebuggingJavaSecurityManager"</pre>

						</div></li><li class="step"><div class="para">
						Comment out all other <code class="classname">java.security.manager</code> references in the file.
					</div></li><li class="step"><div class="para">
						Ensure that the file still contains a <code class="classname">java.security.policy</code> option specifying the policy file to use
					</div></li><li class="step"><div class="para">
						Enable general debugging following the instruction in <a class="xref" href="chap-Java_EE_Security_Manager.html#proc-General_Debugging">Procedure 14.2, “Enable general debugging”</a>.
					</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					The Debugging Security Manager has a significance performance cost. Do not use it in general production.
				</div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Writing_Your_Own_Security_Policy">
      ⁠</a>14.3. Writing Security Policy for JBoss Enterprise Application Platform</h1></div></div></div><div class="para">
			The included file <code class="filename">jboss-as/bin/server.policy.cert</code> is an example security policy for JBoss Enterprise Application Platform. You can use this file as the basis for your own security policy.
		</div><div class="para">
			The <code class="command">policytool</code> application, included with the JDK, provides a graphical tool for editing and writing security policy.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				Carefully consider what permissions you grant. Be particularly cautious about granting <code class="option"> java.security.AllPermission </code> : you can potentially allow changes to the system binary, including the JVM runtime environment.
			</div></div></div><div class="para">
			For a general treatment of security policy files and Java permissions refer to the official Java documentation at <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html">http://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html</a> . JBoss-specific <code class="literal">java.lang.RuntimePermissions</code> are described below.
		</div><div class="variablelist"><p class="title"><strong>JBoss-specific Runtime Permissions</strong></p><dl class="variablelist"><dt><span class="term"><code class="classname">org.jboss.security.SecurityAssociation.getPrincipalInfo</code></span></dt><dd><div class="para">
						Provides access to the <code class="methodname"> org.jboss.security.SecurityAssociation getPrincipal() </code> and <code class="methodname"> getCredential() </code> methods. The risk involved with using this runtime permission is the ability to see the current thread caller and credentials.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.security.SecurityAssociation.getSubject</code></span></dt><dd><div class="para">
						Provides access to the <code class="methodname"> org.jboss.security.SecurityAssociation getSubject() </code> method.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.security.SecurityAssociation.setPrincipalInfo</code></span></dt><dd><div class="para">
						Provides access to the <code class="methodname"> org.jboss.security.SecurityAssociation setPrincipal() </code> , <code class="methodname"> setCredential() </code> , <code class="methodname"> setSubject() </code> , <code class="methodname"> pushSubjectContext() </code> , and <code class="methodname"> popSubjectContext() </code> methods. The risk involved with using this runtime permission is the ability to set the current thread caller and credentials.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.security.SecurityAssociation.setServer</code></span></dt><dd><div class="para">
						Provides access to the <code class="methodname"> org.jboss.security.SecurityAssociation setServer </code> method. The risk involved with using this runtime permission is the ability to enable or disable multi-thread storage of the caller principal and credential.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.security.SecurityAssociation.setRunAsRole</code></span></dt><dd><div class="para">
						Provides access to the <code class="methodname"> org.jboss.security.SecurityAssociation pushRunAsRole </code> and <code class="methodname"> popRunAsRole </code> , <code class="methodname"> pushRunAsIdentity </code> and <code class="methodname"> popRunAsIdentity </code> methods. The risk involved with using this runtime permission is the ability to change the current caller run-as role principal.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.security.SecurityAssociation.accessContextInfo</code></span></dt><dd><div class="para">
						Provides access to the <code class="methodname"> org.jboss.security.SecurityAssociation accessContextInfo, "Get" </code> and <code class="methodname"> accessContextInfo, "Set" </code> methods, allowing you to both set and get the current security context info.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.naming.JndiPermission</code></span></dt><dd><div class="para">
						Provides special permissions to files and directories in a specified JNDI tree path, or recursively to all files and subdirectories. A JndiPermission consists of a pathname and a set of valid permissions related to the file or directory.
					</div><div class="para">
						The available permissions include: <code class="option"> bind </code> , <code class="option"> rebind </code> , <code class="option"> unbind </code> , <code class="option"> lookup </code> , <code class="option"> list </code> , <code class="option"> listBindings </code> , <code class="option"> createSubcontext </code> , and <code class="option"> all </code> .
					</div><div class="para">
						Pathnames ending in <code class="literal">/*</code> indicate the specified permissions apply to all files and directories of the pathname. Pathnames ending in <code class="literal">/-</code> indicate recursive permissions to all files and subdirectories of the pathname. Pathnames consisting of the special token <code class="literal">&lt;&lt;ALL BINDINGS&gt;&gt;</code> matches any file in any directory.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.security.srp.SRPPermission</code></span></dt><dd><div class="para">
						A custom permission class for protecting access to sensitive SRP information like the private session key and private key. This permission does not have any actions defined. The <span class="property">getSessionKey</span> target provides access to the private session key resulting from the SRP negotiation. Access to this key will allow you to encrypt and decrypt messages that have been encrypted with the session key.
					</div></dd><dt><span class="term"><code class="classname">org.hibernate.secure.HibernatePermission</code></span></dt><dd><div class="para">
						This permission class provides basic permissions to secure Hibernate sessions. The target for this property is the entity name. The available actions include: <span class="property">insert</span> , <span class="property">delete</span> , <span class="property">update</span> , <span class="property">read</span> , <span class="property">*</span> (all).
					</div></dd><dt><span class="term"><code class="classname">org.jboss.metadata.spi.stack.MetaDataStackPermission</code></span></dt><dd><div class="para">
						Provides a custom permission class for controlling how callers interact with the metadata stack. The available permissions are: <code class="option"> modify </code> (push/pop onto the stack), <code class="option"> peek </code> (peek onto the stack), and <code class="option"> * </code> (all).
					</div></dd><dt><span class="term"><code class="classname">org.jboss.config.spi.ConfigurationPermission</code></span></dt><dd><div class="para">
						Secures setting of configuration properties. Defines only permission target names, and no actions. The targets for this property include: <span class="markup">&lt;property name&gt;</span> - property which code has permission to set; <span class="property">*</span> - all properties.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.kernel.KernelPermission</code></span></dt><dd><div class="para">
						Secures access to the kernel configuration. Defines only permission target names and no actions. The targets for this property include: <span class="property">access</span> - access the kernel configuration; <span class="property">configure</span> - configure the kernel (access is implied); <span class="property">*</span> - all of the above.
					</div></dd><dt><span class="term"><code class="classname">org.jboss.kernel.plugins.util.KernelLocatorPermission</code></span></dt><dd><div class="para">
						Secures access to the kernel. Defines only permission target names and no actions. The targets for this property include: <span class="property">kernel</span> - access the kernel; <span class="property">*</span> - access all areas.
					</div></dd></dl></div></div></div></body></html>