<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 3. JBoss Security Model</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="The_JBoss_Security_Model">
      ⁠</a>Chapter 3. JBoss Security Model</h1></div></div></div><div class="para">
		Similar to the rest of the JBoss architecture, security at the lowest level is defined as a set of interfaces for which alternate implementations may be provided. The following interfaces define the JBoss Enterprise Application Platform security layer:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.AuthenticationManager </code>
			</div></li><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.RealmMapping </code>
			</div></li><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.SecurityProxy </code>
			</div></li><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.AuthorizationManager </code>
			</div></li><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.AuditManager </code>
			</div></li><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.MappingManager </code>
			</div></li></ul></div><div class="para">
		<a class="xref" href="The_JBoss_Security_Model.html#figu-Sec_Model_Interface_Rel_To_JBoss_Server_EJB_Container_Elements">Figure 3.1, “Security Model Interface Relationships to JBoss Enterprise Application Platform EJB Container Elements.”</a> shows a class diagram of the security interfaces and their relationship to the EJB container architecture.
	</div><div class="figure"><a id="figu-Sec_Model_Interface_Rel_To_JBoss_Server_EJB_Container_Elements">
      ⁠</a><div class="figure-contents"><div class="mediaobject" style="text-align: center"><img src="images/EAP5_SecurityModel_Interface.png" align="middle" width="450" alt="Security Model Interface Relationships to JBoss Enterprise Application Platform EJB Container Elements." style="text-align: middle"/></div></div><p class="title"><strong>Figure 3.1. Security Model Interface Relationships to JBoss Enterprise Application Platform EJB Container Elements.</strong></p></div><div class="para">
		The EJB Container layer is represented by the classes - <code class="classname">org.jboss.ejb.Container</code>, <code class="classname">org.jboss.SecurityInterceptor</code> and <code class="classname">org.jboss.SecurityProxyInterceptor</code>. The other classes are interfaces and classes provided by the JBoss security subsystem.
	</div><div class="para">
		The two interfaces required for the J2EE security model implementation are:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.AuthenticationManager </code>
			</div></li><li class="listitem"><div class="para">
				<code class="interfacename"> org.jboss.security.AuthorizationManager </code>
			</div></li></ul></div><div class="para">
		The roles of the security interfaces presented in <a class="xref" href="The_JBoss_Security_Model.html#figu-Sec_Model_Interface_Rel_To_JBoss_Server_EJB_Container_Elements">Figure 3.1, “Security Model Interface Relationships to JBoss Enterprise Application Platform EJB Container Elements.”</a> are summarized below.
	</div><div class="variablelist"><p class="title"><strong>Security Interface Roles</strong></p><dl class="variablelist"><dt><span class="term">AuthenticationManager</span></dt><dd><div class="para">
					This interface is responsible for validating credentials associated with <em class="firstterm"> Principals </em> . Principals are identities, such as user names, employee numbers, and social security numbers. <em class="firstterm"> Credentials </em> are proof of the identity, such as passwords, session keys, and digital signatures. The <code class="methodname"> isValid </code> method is invoked to determine whether a user identity and associated credentials as known in the operational environment are valid proof of the user's identity.
				</div></dd><dt><span class="term">AuthorizationManager</span></dt><dd><div class="para">
					This interface is responsible for the access control mandated by the Java EE specifications. The implementation of this interface provides the ability to stack a set of Policy Providers useful for pluggable authorization.
				</div></dd><dt><span class="term">SecurityProxy</span></dt><dd><div class="para">
					This interface describes the requirements for a custom <code class="literal">SecurityProxyInterceptor</code> plug-in. A <code class="literal">SecurityProxy</code> allows for the externalization of custom security checks on a per-method basis for both the EJB home and remote interface methods.
				</div></dd><dt><span class="term">AuditManager</span></dt><dd><div class="para">
					This interface is responsible for providing an audit trail of security events.
				</div></dd><dt><span class="term">MappingManager</span></dt><dd><div class="para">
					This interface is responsible for providing mapping of Principal, Role, and Attributes. The implementation of AuthorizationManager may internally call the mapping manager to map roles before performing access control.
				</div></dd><dt><span class="term">SecurityDomain</span></dt><dd><div class="para">
					This is an extension of the <code class="interfacename"> AuthenticationManager </code> , <span class="interface"> RealmMapping </span> , and <code class="literal">SubjectSecurityManager</code> interfaces. <code class="classname">SecurityDomain</code> is the recommended way to implement security in components, because of the advantages the JAAS Subject offers, and the increased support offered to ASP-style application and resource deployments. A <code class="classname">java.security.KeyStore</code>, and the Java Secure Socket Extension (JSSE) <code class="classname">com.sun.net.ssl.KeyManagerFactory</code> and <code class="classname">com.sun.net.ssl.TrustManagerFactory</code> interfaces are included in the class.
				</div></dd><dt><span class="term">RealmMapping</span></dt><dd><div class="para">
					This interface is responsible for principal mapping and role mapping. The <code class="literal">getPrincipal</code> method takes a user identity as known in the operational environment and returns the application domain identity. The <code class="methodname"> doesUserHaveRole </code> method validates that the user identity in the operation environment has been assigned the indicated role from the application domain.
				</div></dd></dl></div><div class="para">
		Note that the <code class="interfacename"> AuthenticationManager </code> , <code class="interfacename"> RealmMapping </code> and <code class="interfacename"> SecurityProxy </code> interfaces have no association to JAAS related classes. Although the JBossSX framework is heavily dependent on JAAS, the basic security interfaces required for implementation of the Java EE security model are not. The JBossSX framework is simply an implementation of the basic security plug-in interfaces that are based on JAAS.
	</div><div class="para">
		The component diagram in <a class="xref" href="The_JBoss_Security_Model.html#The_JBoss_Security_Model-The_relationship_between_the_JBossSX_framework_implementation_classes_and_the_JBoss_server_EJB_container_layer.">Figure 3.2, “JBossSX Framework Implementation Classes and the EAP EJB Container Layer.”</a> illustrates this fact. The implication of this plug-in architecture is that you are free to replace the JAAS-based JBossSX implementation classes with your own non-JAAS custom security manager implementation. You'll see how to do this when you look at the JBossSX MBeans available for JBossSX configuration in <a class="xref" href="The_JBoss_Security_Model.html#The_JBoss_Security_Model-The_relationship_between_the_JBossSX_framework_implementation_classes_and_the_JBoss_server_EJB_container_layer.">Figure 3.2, “JBossSX Framework Implementation Classes and the EAP EJB Container Layer.”</a>.
	</div><div class="figure"><a id="The_JBoss_Security_Model-The_relationship_between_the_JBossSX_framework_implementation_classes_and_the_JBoss_server_EJB_container_layer.">
      ⁠</a><div class="figure-contents"><div class="mediaobject" style="text-align: center"><img src="images/j2ee_chap8-7.png" align="middle" alt="JBossSX Framework Implementation Classes and the EAP EJB Container Layer." style="text-align: middle"/></div></div><p class="title"><strong>Figure 3.2. JBossSX Framework Implementation Classes and the EAP EJB Container Layer.</strong></p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="The_JBoss_Security_Model-Enabling_Declarative_Security_in_JBoss_Revisited">
      ⁠</a>3.1. Enabling Declarative Security Revisited</h1></div></div></div><div class="para">
			Earlier in this chapter, the discussion of the Java EE standard security model ended with a requirement for the use of JBoss Enterprise Application Platform-specific deployment descriptor to enable security. The details of this configuration are presented here. <a class="xref" href="The_JBoss_Security_Model.html#Enabling_Declarative_Security_in_JBoss_Revisited-The_security_element_subsets_of_the_JBoss_server_jboss.xml_and_jboss_web.xml_deployment_descriptors.">Figure 3.3, “jboss.xml and jboss-web.xml Security Element Subsets.”</a> shows the JBoss-specific EJB and web application deployment descriptor's security-related elements.
		</div><div class="figure"><a id="Enabling_Declarative_Security_in_JBoss_Revisited-The_security_element_subsets_of_the_JBoss_server_jboss.xml_and_jboss_web.xml_deployment_descriptors.">
      ⁠</a><div class="figure-contents"><div class="mediaobject" style="text-align: center"><img src="images/j2ee_chap8-8.png" align="middle" alt="jboss.xml and jboss-web.xml Security Element Subsets." style="text-align: middle"/></div></div><p class="title"><strong>Figure 3.3. jboss.xml and jboss-web.xml Security Element Subsets.</strong></p></div><div class="para">
			The value of a <span class="markup">&lt;security-domain&gt;</span> element specifies the JNDI name of the security manager interface implementation that JBoss uses for the EJB and web containers. This is an object that implements both of the <code class="interfacename"> AuthenticationManager </code> and <code class="interfacename"> RealmMapping </code> interfaces. When specified as a top-level element, it defines what security domain is specified for all EJBs in the deployment unit. This is the typical usage because mixing security managers within a deployment unit complicates inter-component operation and administration.
		</div><div class="para">
			To specify the security domain for an individual EJB, you specify the <span class="markup">&lt;security-domain&gt;</span> at the container configuration level. This will override any top-level <span class="markup">&lt;security-domain&gt;</span> element.
		</div><div class="para">
			The <span class="markup">&lt;unauthenticated-principal&gt;</span> element specifies the name to use for the <code class="literal">Principal</code> object returned by the <code class="methodname"> EJBContext.getUserPrincipal </code> method when an unauthenticated user invokes an EJB. Note that this conveys no special permissions to an unauthenticated caller. Its primary purpose is to allow unsecured servlets and JSP pages to invoke unsecured EJBs and allow the target EJB to obtain a non-null <code class="literal">Principal</code> for the caller using the <code class="methodname"> getUserPrincipal </code> method. This is a J2EE specification requirement.
		</div><div class="para">
			The <span class="markup">&lt;security-proxy&gt;</span> element identifies a custom security proxy implementation. It allows per-request security checks outside the scope of the EJB declarative security model, without embedding security logic into the EJB implementation. You can use an implementation of the <code class="interfacename"> org.jboss.security.SecurityProxy </code> interface. Alternatively, you can use a common interface that uses an object to implement methods in the home, remote, local home, or local interfaces of the EJB. If the given class does not implement the <code class="interfacename"> SecurityProxy </code> interface, the instance must be wrapped in a <code class="interfacename"> SecurityProxy </code> implementation that delegates the method invocations to the object. The <code class="classname">org.jboss.security.SubjectSecurityProxy</code> is an example <code class="literal">SecurityProxy</code> implementation used by the default JBossSX installation.
		</div><div class="para">
			Take a look at a simple example of a custom <code class="literal">SecurityProxy</code> in the context of a trivial stateless session bean. The custom <code class="literal">SecurityProxy</code> validates that no one invokes the bean's <code class="methodname"> echo </code> method with a four-letter word as its argument. This is a check that is not possible with role-based security; you cannot define a <code class="literal">FourLetterEchoInvoker</code> role because the security context is the method argument, not a property of the caller. The code for the custom <code class="literal">SecurityProxy</code> is given in <a class="xref" href="The_JBoss_Security_Model.html#Enabling_Declarative_Security_in_JBoss_Revisited-The_example_1_custom_EchoSecurityProxy_implementation_that_enforces_the_echo_argument_based_security_constraint.">Example 3.1, “Custom EchoSecurityProxy Implementation.”</a>
		</div><div class="example"><a id="Enabling_Declarative_Security_in_JBoss_Revisited-The_example_1_custom_EchoSecurityProxy_implementation_that_enforces_the_echo_argument_based_security_constraint.">
      ⁠</a><p class="title"><strong>Example 3.1. Custom EchoSecurityProxy Implementation.</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">book</span>.<span xmlns="" class="perl_Function">security</span>.<span xmlns="" class="perl_Function">ex1</span>;
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.Method;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.ejb.EJBContext;</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.log4j.Category;</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.security.SecurityProxy;</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">/** A simple example of a custom SecurityProxy implementation</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> *  that demonstrates method argument based security checks.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@author </span><span xmlns="" class="perl_Comment">Scott.Stark@jboss.org</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> * </span><span xmlns="" class="perl_Keyword">@version </span><span xmlns="" class="perl_Comment">$Revision: 1.4 $</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment"> */</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EchoSecurityProxy <span xmlns="" class="perl_Keyword">implements</span> SecurityProxy
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    Category log = Category.<span xmlns="" class="perl_Function">getInstance</span>(EchoSecurityProxy.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>    Method echo;
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">init</span>(<span xmlns="" class="perl_Keyword">Class</span> beanHome, <span xmlns="" class="perl_Keyword">Class</span> beanRemote,
<span xmlns="" class="line">​</span>                     Object securityMgr)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throws</span> InstantiationException
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">debug</span>(<span xmlns="" class="perl_String">"init, beanHome="</span>+beanHome
<span xmlns="" class="line">​</span>                  + <span xmlns="" class="perl_String">", beanRemote="</span>+beanRemote
<span xmlns="" class="line">​</span>                  + <span xmlns="" class="perl_String">", securityMgr="</span>+securityMgr);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Get the echo method for equality testing in invoke</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">Class</span>[] params = {String.<span xmlns="" class="perl_Function">class</span>};
<span xmlns="" class="line">​</span>            echo = beanRemote.<span xmlns="" class="perl_Function">getDeclaredMethod</span>(<span xmlns="" class="perl_String">"echo"</span>, params);
<span xmlns="" class="line">​</span>        } <span xmlns="" class="perl_Keyword">catch</span>(Exception e) {
<span xmlns="" class="line">​</span>            String msg = <span xmlns="" class="perl_String">"Failed to find an echo(String) method"</span>;
<span xmlns="" class="line">​</span>            log.<span xmlns="" class="perl_Function">error</span>(msg, e);
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> InstantiationException(msg);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setEJBContext</span>(EJBContext ctx)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">debug</span>(<span xmlns="" class="perl_String">"setEJBContext, ctx="</span>+ctx);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">invokeHome</span>(Method m, Object[] args)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throws</span> SecurityException
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// We do not validate access to home methods</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">invoke</span>(Method m, Object[] args, Object bean)
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throws</span> SecurityException
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">debug</span>(<span xmlns="" class="perl_String">"invoke, m="</span>+m);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Check for the echo method</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (m.<span xmlns="" class="perl_Function">equals</span>(echo)) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// Validate that the msg arg is not 4 letter word</span>
<span xmlns="" class="line">​</span>            String arg = (String) args[<span xmlns="" class="perl_Float">0</span>];
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (arg == <span xmlns="" class="perl_Keyword">null</span> || arg.<span xmlns="" class="perl_Function">length</span>() == <span xmlns="" class="perl_Float">4</span>)
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> SecurityException(<span xmlns="" class="perl_String">"No 4 letter words"</span>);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// We are not responsible for doing the invoke</span>
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}           
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para">
			The <code class="literal">EchoSecurityProxy</code> checks that the method to be invoked on the bean instance corresponds to the <code class="methodname"> echo(String) </code> method loaded the <code class="methodname"> init </code> method. If there is a match, the method argument is obtained and its length compared against 4 or null. Either case results in a <code class="literal">SecurityException</code> being thrown.
		</div><div class="para">
			Certainly this is a contrived example, but only in its application. It is a common requirement that applications must perform security checks based on the value of method arguments. The point of the example is to demonstrate how custom security beyond the scope of the standard declarative security model can be introduced independent of the bean implementation. This allows the specification and coding of the security requirements to be delegated to security experts. Since the security proxy layer can be done independent of the bean implementation, security can be changed to match the deployment environment requirements.
		</div><div class="para">
			The associated <code class="literal">jboss.xml</code> descriptor that installs the <code class="literal">EchoSecurityProxy</code> as the custom proxy for the <code class="literal">EchoBean</code> is given in <a class="xref" href="The_JBoss_Security_Model.html#Enabling_Declarative_Security_in_JBoss_Revisited-The_jboss.xml_descriptor_which_configures_the_EchoSecurityProxy_as_the_custom_security_proxy_for_the_EchoBean.">Example 3.2, “jboss.xml descriptor”</a>.
		</div><div class="example"><a id="Enabling_Declarative_Security_in_JBoss_Revisited-The_jboss.xml_descriptor_which_configures_the_EchoSecurityProxy_as_the_custom_security_proxy_for_the_EchoBean.">
      ⁠</a><p class="title"><strong>Example 3.2. jboss.xml descriptor</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>java:/jaas/other<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>                
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;session&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>EchoBean<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;security-proxy&gt;</span>org.jboss.book.security.ex1.EchoSecurityProxy<span xmlns="" class="perl_Keyword">&lt;/security-proxy&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/session&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/enterprise-beans&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss&gt;</span>
</pre></div></div><div class="para">
			Now test the custom proxy by running a client that attempts to invoke the <code class="methodname"> EchoBean.echo </code> method with the arguments <code class="literal">Hello</code> and <code class="literal">Four</code> as illustrated in this fragment:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> ExClient
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span>(String args[])
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        Logger log = Logger.<span xmlns="" class="perl_Function">getLogger</span>(<span xmlns="" class="perl_String">"ExClient"</span>);
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Looking up EchoBean"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        InitialContext iniCtx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>        Object ref = iniCtx.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"EchoBean"</span>);
<span xmlns="" class="line">​</span>        EchoHome home = (EchoHome) ref;
<span xmlns="" class="line">​</span>        Echo echo = home.<span xmlns="" class="perl_Function">create</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Created Echo"</span>);
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Echo.echo('Hello') = "</span>+echo.<span xmlns="" class="perl_Function">echo</span>(<span xmlns="" class="perl_String">"Hello"</span>));
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Echo.echo('Four') = "</span>+echo.<span xmlns="" class="perl_Function">echo</span>(<span xmlns="" class="perl_String">"Four"</span>));
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The first call should succeed, while the second should fail due to the fact that <code class="literal">Four</code> is a four-letter word. Run the client as follows using Ant from the examples directory:
		</div><pre class="screen">[examples]$ ant -Dchap=security -Dex=1 run-example
run-example1:
...
     [echo] Waiting for 5 seconds for deploy...
     [java] [INFO,ExClient] Looking up EchoBean
     [java] [INFO,ExClient] Created Echo
     [java] [INFO,ExClient] Echo.echo('Hello') = Hello
     [java] Exception in thread "main" java.rmi.AccessException: SecurityException; nested exception is: 
     [java]     java.lang.SecurityException: No 4 letter words
...
     [java] Caused by: java.lang.SecurityException: No 4 letter words
...</pre><div class="para">
			The result is that the <code class="methodname"> echo('Hello') </code> method call succeeds as expected and the <code class="methodname"> echo('Four') </code> method call results in a rather messy looking exception, which is also expected. The above output has been truncated to fit in the book. The key part to the exception is that the <code class="literal">SecurityException("No 4 letter words")</code> generated by the <code class="literal">EchoSecurityProxy</code> was thrown to abort the attempted method invocation as desired.
		</div></div></div></body></html>