<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 2. Introduction to JAAS</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Introduction_to_JAAS">
      ⁠</a>Chapter 2. Introduction to JAAS</h1></div></div></div><div class="para">
		The JBossSX framework is based on the JAAS API. You must understand the basic elements of the JAAS API before you can understand the implementation details of JBossSX. The following sections provide an introduction to JAAS to prepare you for the JBossSX architecture discussion later in this guide.
	</div><div class="para">
		The JAAS 1.0 API consists of a set of Java packages designed for user authentication and authorization. The API implements a Java version of the standard Pluggable Authentication Modules (PAM) framework and extends the Java 2 Platform access control architecture to support user-based authorization.
	</div><div class="para">
		JAAS was first released as an extension package for JDK 1.3 and is bundled with JDK 1.5. Because the JBossSX framework only uses the authentication capabilities of JAAS to implement the declarative role-based J2EE security model, this introduction focuses on only that topic.
	</div><div class="para">
		JAAS authentication is performed in a pluggable fashion. This permits Java applications to remain independent from underlying authentication technologies, and allows the JBossSX security manager to work in different security infrastructures. Integration with a security infrastructure is achievable without changing the JBossSX security manager implementation. You need only change the configuration of the authentication stack JAAS uses.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="What_is_JAAS-The_JAAS_Core_Classes">
      ⁠</a>2.1. JAAS Core Classes</h1></div></div></div><div class="para">
			The JAAS core classes can be broken down into three categories: common, authentication, and authorization. The following list presents only the common and authentication classes because these are the specific classes used to implement the functionality of JBossSX covered in this chapter.
		</div><div class="para">
			The are the common classes:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="literal">Subject</code> (<code class="classname">javax.security.auth.Subject</code>)
				</div></li></ul></div><div class="para">
			These are the authentication classes:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="literal">Configuration</code> (<code class="classname">javax.security.auth.login.Configuration</code>)
				</div></li><li class="listitem"><div class="para">
					<code class="literal">LoginContext</code> (<code class="classname">javax.security.auth.login.LoginContext</code>)
				</div></li></ul></div><div class="para">
			These are the associated interfaces:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<code class="literal">Principal</code> (<code class="classname">java.security.Principal</code>)
				</div></li><li class="listitem"><div class="para">
					<code class="literal">Callback</code> (<code class="classname">javax.security.auth.callback.Callback</code>)
				</div></li><li class="listitem"><div class="para">
					<code class="literal">CallbackHandler</code> (<code class="classname">javax.security.auth.callback.CallbackHandler</code>)
				</div></li><li class="listitem"><div class="para">
					<code class="literal">LoginModule</code> (<code class="classname">javax.security.auth.spi.LoginModule</code>)
				</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-The_Subject_and_Principal_Classes">
      ⁠</a>2.1.1. Subject and Principal Classes</h2></div></div></div><div class="para">
		To authorize access to resources, applications must first authenticate the request's source. The JAAS framework defines the term subject to represent a request's source. The <code class="classname">Subject</code> class is the central class in JAAS. A <code class="classname">Subject</code> represents information for a single entity, such as a person or service. It encompasses the entity's principals, public credentials, and private credentials. The JAAS APIs use the existing Java 2 <code class="classname">java.security.Principal</code> interface to represent a principal, which is essentially just a typed name.
	</div><div class="para">
		During the authentication process, a subject is populated with associated identities, or principals. A subject may have many principals. For example, a person may have a name principal (John Doe), a social security number principal (123-45-6789), and a user name principal (johnd), all of which help distinguish the subject from other subjects. To retrieve the principals associated with a subject, two methods are available:
	</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getPrincipals</span>() {...}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getPrincipals</span>(<span xmlns="" class="perl_Keyword">Class</span> c) {...}
</pre><div class="para">
		<code class="methodname"> getPrincipals() </code> returns all principals contained in the subject. <code class="methodname"> getPrincipals(Class c) </code> returns only those principals that are instances of class <code class="literal">c</code> or one of its subclasses. An empty set is returned if the subject has no matching principals.
	</div><div class="para">
		Note that the <code class="classname">java.security.acl.Group</code> interface is a sub-interface of <code class="classname">java.security.Principal</code>, so an instance in the principals set may represent a logical grouping of other principals or groups of principals.
	</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Subject_Authentication">
      ⁠</a>2.1.2. Subject Authentication</h2></div></div></div><div class="para">
		Subject Authentication requires a JAAS log in. The log in process consists of the following points:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
				An application instantiates a <code class="literal">LoginContext</code> and passes in the name of the login configuration and a <code class="literal">CallbackHandler</code> to populate the <code class="literal">Callback</code> objects, as required by the configuration <code class="literal">LoginModule</code>s.
			</div></li><li class="listitem"><div class="para">
				The <code class="literal">LoginContext</code> consults a <code class="literal">Configuration</code> to load all the <code class="literal">LoginModules</code> included in the named login configuration. If no such named configuration exists the <code class="literal">other</code> configuration is used as a default.
			</div></li><li class="listitem"><div class="para">
				The application invokes the <code class="methodname"> LoginContext.login </code> method.
			</div></li><li class="listitem"><div class="para">
				The login method invokes all the loaded <code class="literal">LoginModule</code>s. As each <code class="literal">LoginModule</code> attempts to authenticate the subject, it invokes the handle method on the associated <code class="literal">CallbackHandler</code> to obtain the information required for the authentication process. The required information is passed to the handle method in the form of an array of <code class="literal">Callback</code> objects. Upon success, the <code class="literal">LoginModule</code>s associate relevant principals and credentials with the subject.
			</div></li><li class="listitem"><div class="para">
				The <code class="literal">LoginContext</code> returns the authentication status to the application. Success is represented by a return from the log in method. Failure is represented through a LoginException being thrown by the log in method.
			</div></li><li class="listitem"><div class="para">
				If authentication succeeds, the application retrieves the authenticated subject using the <code class="methodname"> LoginContext.getSubject </code> method.
			</div></li><li class="listitem"><div class="para">
				After the scope of the subject authentication is complete, all principals and related information associated with the subject by the log in method can be removed by invoking the <code class="methodname"> LoginContext.logout </code> method.
			</div></li></ol></div><div class="para">
		The <code class="classname">LoginContext</code> class provides the basic methods for authenticating subjects and offers a way to develop an application that is independent of the underlying authentication technology. The <code class="classname">LoginContext</code> consults a <code class="literal">Configuration</code> to determine the authentication services configured for a particular application. <code class="classname">LoginModule</code> classes represent the authentication services. Therefore, you can plug different login modules into an application without changing the application itself. The following code shows the steps required by an application to authenticate a subject.
	</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>CallbackHandler handler = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">MyHandler</span>();
<span xmlns="" class="line">​</span>LoginContext lc = <span xmlns="" class="perl_Keyword">new</span> LoginContext(<span xmlns="" class="perl_String">"some-config"</span>, handler);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    lc.<span xmlns="" class="perl_Function">login</span>();
<span xmlns="" class="line">​</span>    Subject subject = lc.<span xmlns="" class="perl_Function">getSubject</span>();
<span xmlns="" class="line">​</span>} <span xmlns="" class="perl_Keyword">catch</span>(LoginException e) {
<span xmlns="" class="line">​</span>    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"authentication failed"</span>);
<span xmlns="" class="line">​</span>    e.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>                        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Perform work as authenticated Subject</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// ...</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Scope of work complete, logout to remove authentication info</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    lc.<span xmlns="" class="perl_Function">logout</span>();
<span xmlns="" class="line">​</span>} <span xmlns="" class="perl_Keyword">catch</span>(LoginException e) {
<span xmlns="" class="line">​</span>    System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"logout failed"</span>);
<span xmlns="" class="line">​</span>    e.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>                        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// A sample MyHandler class</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">class</span> MyHandler 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">implements</span> CallbackHandler
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handle</span>(Callback[] callbacks) <span xmlns="" class="perl_Keyword">throws</span>
<span xmlns="" class="line">​</span>        IOException, UnsupportedCallbackException
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> i = <span xmlns="" class="perl_Float">0</span>; i &lt; callbacks.<span xmlns="" class="perl_Function">length</span>; i++) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (callbacks[i] <span xmlns="" class="perl_Keyword">instanceof</span> NameCallback) {
<span xmlns="" class="line">​</span>                NameCallback nc = (NameCallback)callbacks[i];
<span xmlns="" class="line">​</span>                nc.<span xmlns="" class="perl_Function">setName</span>(username);
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span> (callbacks[i] <span xmlns="" class="perl_Keyword">instanceof</span> PasswordCallback) {
<span xmlns="" class="line">​</span>                PasswordCallback pc = (PasswordCallback)callbacks[i];
<span xmlns="" class="line">​</span>                pc.<span xmlns="" class="perl_Function">setPassword</span>(password);
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> UnsupportedCallbackException(callbacks[i],
<span xmlns="" class="line">​</span>                                                       <span xmlns="" class="perl_String">"Unrecognized Callback"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
		Developers integrate with an authentication technology by creating an implementation of the <code class="literal">LoginModule</code> interface. This allows an administrator to plug different authentication technologies into an application. You can chain together multiple <code class="literal">LoginModule</code>s to allow for more than one authentication technology to participate in the authentication process. For example, one <code class="literal">LoginModule</code> may perform user name/password-based authentication, while another may interface to hardware devices such as smart card readers or biometric authenticators.
	</div><div class="para">
		The life cycle of a <code class="literal">LoginModule</code> is driven by the <code class="literal">LoginContext</code> object against which the client creates and issues the log in method. The process consists of two phases. The steps of the process are as follows:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				The <code class="literal">LoginContext</code> creates each configured <code class="literal">LoginModule</code> using its public no-arg constructor.
			</div></li><li class="listitem"><div class="para">
				Each <code class="literal">LoginModule</code> is initialized with a call to its initialize method. The <code class="literal">Subject</code> argument is guaranteed to be non-null. The signature of the initialize method is: <code class="methodname"> public void initialize(Subject subject, CallbackHandler callbackHandler, Map sharedState, Map options) </code>
			</div></li><li class="listitem"><div class="para">
				The <code class="methodname"> login </code> method is called to start the authentication process. For example, a method implementation might prompt the user for a user name and password and then verify the information against data stored in a naming service such as NIS or LDAP. Alternative implementations might interface to smart cards and biometric devices, or simply extract user information from the underlying operating system. The validation of user identity by each <code class="literal">LoginModule</code> is considered phase 1 of JAAS authentication. The signature of the <code class="methodname"> login </code> method is <code class="methodname"> boolean login() throws LoginException </code> . A <code class="literal">LoginException</code> indicates failure. A return value of true indicates that the method succeeded, whereas a return value of false indicates that the login module should be ignored.
			</div></li><li class="listitem"><div class="para">
				If the <code class="literal">LoginContext</code>'s overall authentication succeeds, <code class="literal">commit</code> is invoked on each <code class="literal">LoginModule</code>. If phase 1 succeeds for a <code class="literal">LoginModule</code>, then the commit method continues with phase 2 and associates the relevant principals, public credentials, and/or private credentials with the subject. If phase 1 fails for a <code class="literal">LoginModule</code>, then <code class="literal">commit</code> removes any previously stored authentication state, such as user names or passwords. The signature of the <code class="methodname"> commit </code> method is: <code class="methodname"> boolean commit() throws LoginException </code> . Failure to complete the commit phase is indicated by throwing a <code class="literal">LoginException</code>. A return of true indicates that the method succeeded, whereas a return of false indicates that the login module should be ignored.
			</div></li><li class="listitem"><div class="para">
				If the <code class="literal">LoginContext</code>'s overall authentication fails, then the <code class="methodname"> abort </code> method is invoked on each <code class="literal">LoginModule</code>. The <code class="literal">abort</code> method removes or destroys any authentication state created by the log in or initialize methods. The signature of the <code class="literal">abort</code> method is <code class="methodname"> boolean abort() throws LoginException </code> . Failure to complete the <code class="literal">abort</code> phase is indicated by throwing a <code class="literal">LoginException</code>. A return of true indicates that the method succeeded, whereas a return of false indicates that the login module should be ignored.
			</div></li><li class="listitem"><div class="para">
				To remove the authentication state after a successful log in, the application invokes <code class="literal">logout</code> on the <code class="literal">LoginContext</code>. This in turn results in a <code class="methodname"> logout </code> method invocation on each <code class="literal">LoginModule</code>. The <code class="methodname"> logout </code> method removes the principals and credentials originally associated with the subject during the <code class="literal">commit</code> operation. Credentials should be destroyed upon removal. The signature of the <code class="methodname"> logout </code> method is: <code class="methodname"> boolean logout() throws LoginException </code> . Failure to complete the logout process is indicated by throwing a <code class="literal">LoginException</code>. A return of true indicates that the method succeeded, whereas a return of false indicates that the login module should be ignored.
			</div></li></ul></div><div class="para">
		When a <code class="literal">LoginModule</code> must communicate with the user to obtain authentication information, it uses a <code class="literal">CallbackHandler</code> object. Applications implement the <span class="interface"> CallbackHandler </span> interface and pass it to the <code class="literal">LoginContext</code>, which send the authentication information directly to the underlying login modules.
	</div><div class="para">
		Login modules use the <code class="literal">CallbackHandler</code> both to gather input from users, such as a password or smart card PIN, and to supply information to users, such as status information. By allowing the application to specify the <code class="literal">CallbackHandler</code>, underlying <code class="literal">LoginModule</code>s remain independent from the different ways applications interact with users. For example, a <code class="literal">CallbackHandler</code>'s implementation for a GUI application might display a window to solicit user input. On the other hand, a <code class="literal">CallbackHandler</code> implementation for a non-GUI environment, such as an application server, might simply obtain credential information by using an application server API. The <span class="interface"> CallbackHandler </span> interface has one method to implement:
	</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handle</span>(Callback[] callbacks)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> java.<span xmlns="" class="perl_Function">io</span>.<span xmlns="" class="perl_Function">IOException</span>, 
<span xmlns="" class="line">​</span>           UnsupportedCallbackException;
</pre><div class="para">
		The <code class="literal">Callback</code> interface is the last authentication class we will look at. This is a tagging interface for which several default implementations are provided, including the <code class="literal">NameCallback</code> and <code class="literal">PasswordCallback</code> used in an earlier example. A <code class="literal">LoginModule</code> uses a <code class="literal">Callback</code> to request information required by the authentication mechanism. <code class="literal">LoginModule</code>s pass an array of <code class="literal">Callback</code>s directly to the <code class="methodname"> CallbackHandler.handle </code> method during the authentication's log in phase. If a <code class="literal">callbackhandler</code> does not understand how to use a <code class="literal">Callback</code> object passed into the handle method, it throws an <code class="literal">UnsupportedCallbackException</code> to abort the login call.
	</div></div></div></div></body></html>