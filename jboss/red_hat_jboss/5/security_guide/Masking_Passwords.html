<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 16. Masking Passwords in XML Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Masking_Passwords">
      ⁠</a>Chapter 16. Masking Passwords in XML Configuration</h1></div></div></div><div class="para">
		Follow the instructions in this chapter to increase the security of your JBoss Enterprise Application Installation by masking passwords that would otherwise be stored on the file system as clear text.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139921666359008">
      ⁠</a>16.1. Password Masking Overview</h1></div></div></div><div class="para">
			Passwords are secret authentication tokens that are used to limit access to resources to authorized parties only. For JBoss services to access password protected resources, the password must be made available to the JBoss service. This can be done by means of command line arguments passed to the JBoss Application Server on start up, however this is not practical in a production environment. In production environments, typically, passwords are made available to JBoss services through inclusion in configuration files.
		</div><div class="para">
			All JBoss Enterprise Application Platform configuration files should be stored on secure file systems, and should be readable by the JBoss Application Server process owner only. Additionally, you can mask the password in the configuration file for an added level of security. Follow the instructions in this chapter to replace a clear text password in a Microcontainer bean configuration with a password mask. Refer to <a class="xref" href="Encrypting_Data_Source_Passwords.html">Chapter 17, <em>Encrypting Data Source Passwords</em></a> for instructions on encrypting Data Source passwords; to <a class="xref" href="Encrypting_The_Keystore_Password_In_Tomcat.html">Chapter 18, <em>Encrypting the Keystore Password in a Tomcat Connector</em></a> for instructions on encrypting the key store password in Tomcat; and to <a class="xref" href="Using_LdapExtLoginModule_with_JaasSecurityDomain.html">Chapter 19, <em>Using LdapExtLoginModule with JaasSecurityDomain</em></a> for instructions on encrypting the password for LdapExtLoginModule.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				There is no such thing as impenetrable security. All good security measures merely increase the cost involved in unauthorized access of a system. Masking passwords is no exception - it is not impenetrable, but does defeat casual inspection of configuration files, and increases the amount of effort that will be required to extract the password in clear text.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921697932432">
      ⁠</a><p class="title"><strong>Procedure 16.1. Masking a clear text password overview</strong></p><ol class="1"><li class="step"><div class="para">
					Generate a key pair to use to encrypt passwords.
				</div></li><li class="step"><div class="para">
					Encrypt the key store password.
				</div></li><li class="step"><div class="para">
					Create password masks.
				</div></li><li class="step"><div class="para">
					Replace clear text passwords with their password masks.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139921684679504">
      ⁠</a>16.2. Generate a key store and a masked password</h1></div></div></div><div class="para">
			Password masking uses a public/private key pair to encrypt passwords. You need to generate a key pair for use in password masking. By default JBoss Enterprise Application Platform 5 expects a key pair with the alias <code class="filename">jboss</code> in a key store at <code class="filename">jboss-as/bin/password/password.keystore</code>.
		</div><div class="para">
			The following procedures follow this default configuration. If you wish to change the key store location or key alias you will need to change the default configuration, and should refer to <a class="xref" href="Masking_Passwords.html#sect-changing-password-masking-keystore">Section 16.6, “Changing the password masking defaults”</a> for instructions.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-generate-keystore">
      ⁠</a><p class="title"><strong>Procedure 16.2. Generate a key pair and key store for password masking</strong></p><ol class="1"><li class="step"><div class="para">
					At the command line, change directory to the <code class="filename">jboss-as/bin/password</code> directory.
				</div></li><li class="step"><div class="para">
					Use <code class="command">keytool</code> to generate the key pair with the following command:
				</div><pre class="screen"><code class="command">keytool -genkey -alias jboss -keyalg RSA -keysize 1024 -keystore password.keystore</code></pre><div class="para"><div class="title">Important:</div>
						You must specify the same password for the key store and key pair
					</div></li><li class="step"><div class="para"><div class="title">Optional:</div>
						Make the resulting password.keystore readable by the JBoss Application Server process owner only.
					</div><div class="para">
					On Unix-based systems this is accomplished by using the <code class="command">chown</code> command to change ownership to the JBoss Application Server process owner, and <code class="command">chmod 600 password.keystore</code> to make the file readable only by the owner.
				</div><div class="para">
					This step is recommended to increase the security of your server.
				</div><div class="para">
					Note: the JBoss Application Server process owner should not have interactive console log in access. In that case you will be performing these operations as another user. Creating masked passwords requires read access to the key store, so you may wish to complete configuration of masked passwords before restricting the key store file permissions.
				</div></li></ol></div><div class="para">
			For more on key stores and the <code class="command">keytool</code> command, refer to <a class="xref" href="chap-Secure_Socket_Layer.html#sect-keystore-background">Section 15.1, “SSL Encryption overview”</a>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-encrypt-key-store-password">
      ⁠</a>16.3. Encrypt the key store password</h1></div></div></div><div class="para">
			With password masking, passwords needed by JBoss services are not stored in clear text in xml configuration files. Instead they are stored in a file that is encrypted using a key pair that you provide.
		</div><div class="para">
			In order to decrypt this file and access the masked passwords at run time, JBoss Application Server needs to be able to use the key pair you created. You provide the key store password to JBoss Application Server by means of the JBoss Password Tool, <code class="command">password_tool</code>. This tool will encrypt and store your key store password. Your key store password will then be available to the JBoss Password Tool for masking passwords, and to the JBoss Application Server for decrypting them at run time.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-encrypt-key-store-password">
      ⁠</a><p class="title"><strong>Procedure 16.3. Encrypt the key store password</strong></p><ol class="1"><li class="step"><div class="para">
					At the command line, change to the <code class="filename">jboss-as/bin</code> directory.
				</div></li><li class="step"><div class="para">
					Run the password tool, using the command <code class="command">./password_tool.sh</code> for Unix-based systems, or <code class="command">password_tool.bat</code> for Windows-based systems.
				</div><div class="para"><div class="title">Result:</div>
						The JBoss Password Tool will start, and will report '<code class="command">Keystore is null. Please specify keystore below:</code>'.
					</div></li><li class="step"><div class="para">
					Select '<code class="command">0: Encrypt Keystore Password</code>' by pressing 0, then Enter.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with '<code class="command">Enter keystore password</code>'.
					</div></li><li class="step"><div class="para">
					Enter the key store password you specified in <a class="xref" href="Masking_Passwords.html#proc-generate-keystore">Procedure 16.2, “Generate a key pair and key store for password masking”</a>.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with '<code class="command">Enter Salt (String should be at least 8 characters)</code>'.
					</div></li><li class="step"><div class="para">
					Enter a random string of characters to aid with encryption strength.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with '<code class="command">Enter Iterator Count (integer value)</code>'.
					</div></li><li class="step"><div class="para">
					Enter a whole number to aid with encryption strength.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with: '<code class="command">Keystore Password encrypted into password/jboss_keystore_pass.dat</code>'.
					</div></li><li class="step"><div class="para">
					Select '<code class="command">5:Exit</code>' to exit.
				</div><div class="para"><div class="title">Result:</div>
						The password tool will exit with the message: '<code class="command">Keystore is null. Cannot store.</code>'. This is normal.
					</div></li><li class="step"><div class="para"><div class="title">Optional:</div>
						Make the resulting file <code class="filename">password/jboss_keystore_pass.dat</code> readable by the JBoss Application Server process owner only.
					</div><div class="para">
					On Unix-based systems this is accomplished by using the <code class="command">chown</code> command to change ownership to the JBoss Application Server process owner, and <code class="command">chmod 600 jboss-keystore_pass.dat</code> to make the file readable only by the owner.
				</div><div class="para">
					This step is recommended to increase the security of your server. Be aware that if this encrypted key is compromised, the security offered by password masking is significantly reduced. This file should be stored on a secure file system.
				</div><div class="para">
					Note: the JBoss Application Server process owner should not have interactive console log in access. In this case you will be performing these operations as another user. Creating masked passwords requires read access to the key store, so you may wish to complete configuration of masked passwords before restricting the key store file permissions.
				</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Note:</div>
				You should only perform this key store password encryption procedure once. If you make a mistake entering the keystore password, or you change the key store at a later date, you should delete the <code class="filename">jboss-keystore_pass.dat</code> file and repeat the procedure. Be aware that if you change the key store any masked passwords that were previously generated will no longer function.
			</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139921701385952">
      ⁠</a>16.4. Create password masks</h1></div></div></div><div class="para">
			The JBoss Password Tool maintains an encrypted password file <code class="filename">jboss-as/bin/password/jboss_password_enc.dat</code>. This file is encrypted using a key pair you provide to the password tool, and it contains the passwords that will be masked in configuration files. Passwords are stored and retrieved from this file by 'domain', an arbitrary unique identifier that you specify to the Password Tool when storing the password, and that you specify as part of the annotation that replaces that clear text password in configuration files. This allows the JBoss Application Server to retrieve the correct password from the file at run time.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				If you previously made the key store and encrypted key store password file readable only by the JBoss Application Server process owner, then you need to perform the following procedure as the JBoss Application Server process owner, or else make the keystore (<code class="filename">jboss-as/bin/password/password.keystore</code>) and encrypted key store password file (<code class="filename">jboss-as/bin/password/jboss_keystore_pass.dat</code>) readable by your user, and the encrypted passwords file <code class="filename">jboss-as/bin/password/jboss_password_enc.dat</code> (if it already exists) read and writable, while you perform this operation.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-create-password-masks">
      ⁠</a><p class="title"><strong>Procedure 16.4. Create password masks</strong></p><div class="itemizedlist"><p class="title"><strong>Prerequisites:</strong></p><ul><li class="listitem"><div class="para">
						<a class="xref" href="Masking_Passwords.html#proc-generate-keystore">Procedure 16.2, “Generate a key pair and key store for password masking”</a>.
					</div></li><li class="listitem"><div class="para">
						<a class="xref" href="Masking_Passwords.html#proc-encrypt-key-store-password">Procedure 16.3, “Encrypt the key store password”</a>.
					</div></li></ul></div><ol class="1"><li class="step"><div class="para">
					At the command line, change to the <code class="filename">jboss-as/bin</code> directory.
				</div></li><li class="step"><div class="para">
					Run the password tool, using the command <code class="command">./password_tool.sh</code> for Unix-based systems, or <code class="command">password_tool.bat</code> for Windows-based systems.
				</div><div class="para"><div class="title">Result:</div>
						The JBoss Password Tool will start, and will report '<code class="command">Keystore is null. Please specify keystore below:</code>'.
					</div></li><li class="step"><div class="para">
					Select '<code class="command">1:Specify KeyStore</code>' by pressing 1 then Enter.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with '<code class="command">Enter Keystore location including the file name</code>'.
					</div></li><li class="step"><div class="para">
					Enter the path to the key store you created in <a class="xref" href="Masking_Passwords.html#proc-generate-keystore">Procedure 16.2, “Generate a key pair and key store for password masking”</a>. You can specify an absolute path, or the path relative to <code class="filename">jboss-as/bin</code>. This should be <code class="filename">password/password.keystore</code>, unless you have performed an advanced installation and changed the defaults as per <a class="xref" href="Masking_Passwords.html#sect-changing-password-masking-keystore">Section 16.6, “Changing the password masking defaults”</a>.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with '<code class="command">Enter Keystore alias</code>'.
					</div></li><li class="step"><div class="para">
					Enter the key alias. This should be <code class="classname">jboss</code>, unless you have performed an advanced installation and changed the defaults as per <a class="xref" href="Masking_Passwords.html#sect-changing-password-masking-keystore">Section 16.6, “Changing the password masking defaults”</a>.
				</div><div class="para"><div class="title">Result:</div>
						If the key store and key alias are accessible, the password tool will respond with some log4j WARNING messages, then the line '<code class="command">Loading domains [</code>', followed by any existing password masks, and the main menu.
					</div></li><li class="step"><div class="para">
					Select '<code class="command">2:Create Password</code>' by pressing 2, then Enter
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with: '<code class="command">Enter security domain:</code>'.
					</div></li><li class="step"><div class="para">
					Enter a name for the password mask. This is an arbitrary unique name that you will use to identify the password mask in configuration files.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with: '<code class="command">Enter passwd:</code>'.
					</div></li><li class="step"><div class="para">
					Enter the password that you wish to mask.
				</div><div class="para"><div class="title">Result:</div>
						The password tool responds with: '<code class="command">Password created for domain:<em class="replaceable">mask name</em></code>'
					</div></li><li class="step"><div class="para">
					Repeat the password mask creation process to create masks for all passwords you wish to mask.
				</div></li><li class="step"><div class="para">
					Exit the program by choosing '<code class="command">5:Exit</code>'
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139921697759920">
      ⁠</a>16.5. Replace clear text passwords with their password masks</h1></div></div></div><div class="para">
			Clear text passwords in XML configuration files can be replaced with password masks by changing the property assignment for an annotation. Generate password masks for any clear text password that you wish to mask in Microcontainer bean configuration files by following <a class="xref" href="Masking_Passwords.html#proc-create-password-masks">Procedure 16.4, “Create password masks”</a>. Then replace the configuration occurrence of each clear text password with an annotation referencing its mask.
		</div><div class="para">
			The general form of the annotation is:
		</div><div class="example"><a id="idm139921678084896">
      ⁠</a><p class="title"><strong>Example 16.1. General form of password mask annotation</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;annotation&gt;</span>@org.jboss.security.integration.password.Password(securityDomain=MASK_NAME, methodName=setPROPERTY_NAME)<span xmlns="" class="perl_Keyword">&lt;/annotation&gt;</span></pre></div></div><div class="para">
			As a concrete example, the JBoss Messaging password is stored in the server profile in the file <code class="filename">deploy/messaging/messaging-jboss-beans.xml</code>. If you create a password mask named "messaging", then the before and after snippet of the configuration file looks like this:
		</div><div class="example"><a id="idm139921692286656">
      ⁠</a><p class="title"><strong>Example 16.2. JBoss Messaging Microcontainer Bean Configuration Before</strong></p><div class="example-contents"><pre class="screen">&lt;property name="suckerPassword"&gt;CHANGE ME!!&lt;/property&gt;</pre></div></div><div class="example"><a id="idm139921632581952">
      ⁠</a><p class="title"><strong>Example 16.3. JBoss Messaging Microcontainer Bean Configuration After</strong></p><div class="example-contents"><pre class="screen">&lt;annotation&gt;@org.jboss.security.integration.password.Password(securityDomain=messaging,
methodName=setSuckerPassword)&lt;/annotation&gt;</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-changing-password-masking-keystore">
      ⁠</a>16.6. Changing the password masking defaults</h1></div></div></div><div class="para">
			JBoss Enterprise Application Platform 5 ships with server profiles configured for password masking. By default the server profiles are configured to use the keystore <code class="filename">jboss-as/bin/password/password.keystore</code>, and the key alias <code class="filename">jboss</code>. If you store the key pair used for password masking elsewhere, or under a different alias, you will need to update the server profiles with the new location or key alias.
		</div><div class="para">
			The password masking key store location and key alias is specified in the file <code class="filename">deploy/security/security-jboss-beans.xml</code> under each of the included JBoss Application Server server profiles.
		</div><div class="example"><a id="idm139921665099472">
      ⁠</a><p class="title"><strong>Example 16.4. Password Masking defaults in security-jboss-beans.xml</strong></p><div class="example-contents"><pre class="screen">&lt;!-- Password Mask Management Bean--&gt;
   &lt;bean name="JBossSecurityPasswordMaskManagement"
         class="org.jboss.security.integration.password.PasswordMaskManagement" &gt;
         &lt;property name="keyStoreLocation"&gt;password/password.keystore&lt;/property&gt;
         &lt;property name="keyStoreAlias"&gt;jboss&lt;/property&gt;
         &lt;property name="passwordEncryptedFileName"&gt;password/jboss_password_enc.dat&lt;/property&gt;
         &lt;property name="keyStorePasswordEncryptedFileName"&gt;password/jboss_keystore_pass.dat&lt;/property&gt;
   &lt;/bean&gt;
</pre></div></div></div></div></body></html>