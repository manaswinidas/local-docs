<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 17. Encrypting Data Source Passwords</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Encrypting_Data_Source_Passwords">
      ⁠</a>Chapter 17. Encrypting Data Source Passwords</h1></div></div></div><div class="para">
		Database connections for the JBoss Enterprise Application Platform are defined in <code class="filename">*-ds.xml</code> data source files. These database connection details include clear text passwords. You can increase the security of your server by replacing clear text passwords in data source files with encrypted passwords.
	</div><div class="para">
		This chapter presents two different methods for encrypting data source passwords.
	</div><div class="para">
		<em class="firstterm"> Secured Identity </em> using the module <code class="classname">SecureIdentityLoginModule</code> is described in <a class="xref" href="Encrypting_Data_Source_Passwords.html#sect-Secured_Identity">Section 17.1, “Secured Identity”</a>.
	</div><div class="para">
		<em class="firstterm"> Configured Identity with Password Based Encryption </em> using the module <code class="classname">JaasSecurityDomainIdentityLoginModule</code> is described in <a class="xref" href="Encrypting_Data_Source_Passwords.html#sect-PBE">Section 17.2, “Configured Identity with Password Based Encryption (PBE)”</a>.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Secured_Identity">
      ⁠</a>17.1. Secured Identity</h1></div></div></div><div class="para">
			The class <code class="classname">org.jboss.resource.security.SecureIdentityLoginModule</code> can be used to both encrypt database passwords and to provide a decrypted version of the password when the data source configuration is required by the server. The <code class="classname">SecureIdentityLoginModule</code> uses a hard-coded password to encrypt/decrypt the data source password.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921682832016">
      ⁠</a><p class="title"><strong>Procedure 17.1. Overview: Using SecureIdentityLoginModule to encrypt a data source password</strong></p><ol class="1"><li class="step"><div class="para">
					Encrypt the data source password.
				</div></li><li class="step"><div class="para">
					Create an application authentication policy with the encrypted password.
				</div></li><li class="step"><div class="para">
					Configure the data source to use the application authentication policy.
				</div></li></ol></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-encrypt-data-source-password">
      ⁠</a>17.1.1. Encrypt the data source password</h2></div></div></div><div class="para">
				The data source password is encrypted using the <code class="methodname"> SecureIdentityLoginModule </code> main method by passing in the clear text password. The SecureIdentityLoginModule is provided by <code class="filename">jbosssx.jar</code>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921688237632">
      ⁠</a><p class="title"><strong>Procedure 17.2. Encrypt a data source password - Platform versions 5.0 and 5.0.1</strong></p><div class="para">
					This procedure encrypts a data source password on JBoss Enterprise Application Platform versions 5.0 and 5.0.1
				</div><ol class="1"><li class="step"><div class="para">
						Change directory to the <code class="filename">jboss-as</code> directory
					</div></li><li class="step"><div class="para">
						Invoke the SecureIdentityLoginModule with the following command, supplying the clear text password as <em class="replaceable">PASSWORD</em>:
					</div><div class="para"><div class="title">Linux command</div>
							
<pre class="screen">java -cp client/jboss-logging-spi.jar:common/lib/jbosssx.jar \ 
org.jboss.resource.security.SecureIdentityLoginModule <em class="replaceable">PASSWORD</em></pre>

						</div><div class="para"><div class="title">Windows command:</div>
							
<pre class="screen">java -cp client\jboss-logging-spi.jar;common\lib\jbosssx.jar \
 org.jboss.resource.security.SecureIdentityLoginModule <em class="replaceable">PASSWORD</em></pre>

						</div><div class="para"><div class="title">Result:</div>
							The command will return an encrypted password.
						</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921636160800">
      ⁠</a><p class="title"><strong>Procedure 17.3. Encrypt a data source password - Platform version 5.1 and later</strong></p><div class="para">
					This procedure encrypts a data source password on JBoss Enterprise Application Platform versions 5.1 and later
				</div><ol class="1"><li class="step"><div class="para">
						Change directory to the <code class="filename">jboss-as</code> directory
					</div></li><li class="step"><div class="para"><div class="title">Linux command</div>
							
<pre class="screen">java -cp client/jboss-logging-spi.jar:lib/jbosssx.jar \
 org.jboss.resource.security.SecureIdentityLoginModule <em class="replaceable">PASSWORD</em></pre>

						</div><div class="para"><div class="title">Windows command:</div>
							
<pre class="screen">java -cp client\jboss-logging-spi.jar;lib\jbosssx.jar \
 org.jboss.resource.security.SecureIdentityLoginModule <em class="replaceable">PASSWORD</em></pre>

						</div><div class="para"><div class="title">Result:</div>
							The command will return an encrypted password.
						</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-create-auth-policy-datasource">
      ⁠</a>17.1.2. Create an application authentication policy with the encrypted password</h2></div></div></div><div class="para">
				Each JBoss Application Server server profile has a <code class="filename">conf/login-config.xml</code> file, where application authentication policies are defined for that profile. To create an application authentication policy for your encrypted password, add a new &lt;application-policy&gt; element to the &lt;policy&gt; element.
			</div><div class="para">
				<a class="xref" href="Encrypting_Data_Source_Passwords.html#example-app-policy-encrypted-datasource">Example 17.1, “Example application authentication policy with encrypted data source password”</a> is a fragment of a <code class="filename">login-config.xml</code> file showing an application authentication policy of name "EncryptDBPassword".
			</div><div class="example"><a id="example-app-policy-encrypted-datasource">
      ⁠</a><p class="title"><strong>Example 17.1. Example application authentication policy with encrypted data source password</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;policy&gt;</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Example usage of the SecureIdentityLoginModule --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;application-policy</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"EncryptDBPassword"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.security.SecureIdentityLoginModule"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"username"</span><span xmlns="" class="perl_Keyword">&gt;</span>admin<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Keyword">&gt;</span>5dfc52b51bd35553df8592078de921bc<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"managedConnectionFactoryName"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.jca:name=PostgresDS,service=LocalTxCM<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/application-policy&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/policy&gt;</span>
</pre></div></div><div class="variablelist"><p class="title"><strong>SecureIdentityLoginModule module options</strong></p><dl class="variablelist"><dt><span class="term">user name</span></dt><dd><div class="para">
							Specify the user name to use when establishing a connection to the database.
						</div></dd><dt><span class="term">password</span></dt><dd><div class="para">
							Provide the encrypted password generated in <a class="xref" href="Encrypting_Data_Source_Passwords.html#sect-encrypt-data-source-password">Section 17.1.1, “Encrypt the data source password”</a>.
						</div></dd><dt><span class="term">managedConnectionFactoryName</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">jboss.jca:name</span></dt><dd><div class="para">
										Nominate a Java Naming and Directory Interface (JNDI) name for this data source.
									</div></dd><dt><span class="term">jboss.jca:service</span></dt><dd><div class="para">
										Specify the transaction type
									</div></dd></dl></div></dd></dl></div><div class="variablelist"><p class="title"><strong>Transaction types</strong></p><dl class="variablelist"><dt><span class="term">NoTxCM</span></dt><dd><div class="para">
							No transaction support
						</div></dd><dt><span class="term">LocalTxCM</span></dt><dd><div class="para">
							Single resource transaction support
						</div></dd><dt><span class="term">TxCM</span></dt><dd><div class="para">
							Single resource or distributed transaction support
						</div></dd><dt><span class="term">XATxCM</span></dt><dd><div class="para">
							Distributed transaction support
						</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139921680770672">
      ⁠</a>17.1.3. Configure the data source to use the application authentication policy</h2></div></div></div><div class="para">
				At run-time the application policy is bound to JNDI under the application policy name, and is made available as a security domain.
			</div><div class="para">
				The data source is configured in a <code class="filename">*-ds.xml</code> file. Remove the &lt;user-name&gt; and &lt;password&gt; elements from this file, and replace them with a &lt;security-domain&gt; element. This element will contain the application authentication policy name specified following <a class="xref" href="Encrypting_Data_Source_Passwords.html#sect-create-auth-policy-datasource">Section 17.1.2, “Create an application authentication policy with the encrypted password”</a>.
			</div><div class="para">
				Using the example name from <a class="xref" href="Encrypting_Data_Source_Passwords.html#sect-create-auth-policy-datasource">Section 17.1.2, “Create an application authentication policy with the encrypted password”</a>, "EncryptDBPassword", will result in a data source file that looks something like <a class="xref" href="Encrypting_Data_Source_Passwords.html#example-datasource-with-auth-policy">Example 17.2, “Example data source file using secured identity”</a>.
			</div><div class="example"><a id="example-datasource-with-auth-policy">
      ⁠</a><p class="title"><strong>Example 17.2. Example data source file using secured identity</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;datasources&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;local-tx-datasource&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;jndi-name&gt;</span>PostgresDS<span xmlns="" class="perl_Keyword">&lt;/jndi-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;connection-url&gt;</span>jdbc:postgresql://127.0.0.1:5432/test?protocolVersion=2<span xmlns="" class="perl_Keyword">&lt;/connection-url&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;driver-class&gt;</span>org.postgresql.Driver<span xmlns="" class="perl_Keyword">&lt;/driver-class&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;min-pool-size&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/min-pool-size&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;max-pool-size&gt;</span>20<span xmlns="" class="perl_Keyword">&lt;/max-pool-size&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- REPLACED WITH security-domain BELOW</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        &lt;user-name&gt;admin&lt;/user-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        &lt;password&gt;password&lt;/password&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>EncryptDBPassword<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;metadata&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;type-mapping&gt;</span>PostgreSQL 8.0<span xmlns="" class="perl_Keyword">&lt;/type-mapping&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/metadata&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/local-tx-datasource&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/datasources&gt;</span>
</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-PBE">
      ⁠</a>17.2. Configured Identity with Password Based Encryption (PBE)</h1></div></div></div><div class="para">
			The <code class="classname">org.jboss.resource.security.JaasSecurityDomainIdentityLoginModule</code> is a login module for statically defining a data source using a password that has been encrypted by a JaasSecurityDomain. The base64 format of the data source password may be generated using PBEUtils:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921675854528">
      ⁠</a><p class="title"><strong>Procedure 17.4. Encrypt password with PBEUtils - Platforms version 5.0 and 5.0.1</strong></p><div class="para">
				This procedure encrypts a password on JBoss Enterprise Application Platform versions 5.0 and 5.0.1.
			</div><ul><li class="step"><div class="para">
					Execute the command:
				</div><pre class="screen">java -cp jboss-as/common/lib/jbosssx.jar org.jboss.security.plugins.PBEUtils \
  <em class="replaceable">salt</em> <em class="replaceable">count</em> <em class="replaceable">domain-password</em> <em class="replaceable">data-source-password</em></pre><div class="para"><div class="title">Result:</div>
						The encrypted password is displayed
					</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921693734128">
      ⁠</a><p class="title"><strong>Procedure 17.5. Encrypt password with PBEUtils - Platform version 5.1</strong></p><div class="para">
				This procedure encrypts a password on JBoss Enterprise Application Platform versions 5.1 and later.
			</div><ul><li class="step"><div class="para">
					Execute the command:
				</div><pre class="screen">java -cp jboss-as/lib/jbosssx.jar org.jboss.security.plugins.PBEUtils \
 <em class="replaceable">salt</em> <em class="replaceable">count</em> <em class="replaceable">domain-password</em> <em class="replaceable">data-source-password</em></pre><div class="para"><div class="title">Result:</div>
						The encrypted password is displayed
					</div></li></ul></div><div class="para">
			The parameters for the <code class="command">PBEUtils</code> are:
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">salt</span></dt><dd><div class="para">
						The Salt attribute from the JaasSecurityDomain (Must only be eight characters long).
					</div></dd><dt><span class="term">count</span></dt><dd><div class="para">
						The IterationCount attribute from the JaasSecurity domain.
					</div></dd><dt><span class="term">domain-password</span></dt><dd><div class="para">
						The plain text password that maps to the KeyStorePass attribute from the JaasSecurityDomain.
					</div></dd><dt><span class="term">data-source-password</span></dt><dd><div class="para">
						The plain text password for the data source that should be encrypted with the JaasSecurityDomain password.
					</div></dd></dl></div><div class="para">
			<a class="xref" href="Encrypting_Data_Source_Passwords.html#exam-PBEUtils_Example_Command">Example 17.3, “PBEUtils command example”</a> provides an example of the command with its output.
		</div><div class="example"><a id="exam-PBEUtils_Example_Command">
      ⁠</a><p class="title"><strong>Example 17.3. PBEUtils command example</strong></p><div class="example-contents"><pre class="screen">
 java -cp jbosssx.jar org.jboss.security.plugins.PBEUtils abcdefgh 13 master password
 Encoded password: 3zbEkBDfpQAASa3H39pIyP
</pre></div></div><div class="para">
			Add the following application policy to the <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/login-config.xml</code> file.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;application-policy</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"EncryptedHsqlDbRealm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span> <span xmlns="" class="perl_String">"org.jboss.resource.security.JaasSecurityDomainIdentityLoginModule"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         flag</span> <span xmlns="" class="perl_Others">=</span> <span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"username"</span><span xmlns="" class="perl_Keyword">&gt;</span>sa<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Keyword">&gt;</span>E5gtGMKcXPP<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"managedConnectionFactoryName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            jboss.jca:service=LocalTxCM,name=DefaultDS
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jaasSecurityDomain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            jboss.security:service=JaasSecurityDomain,domain=ServerMasterPassword
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/application-policy&gt;</span>
</pre><div class="para">
			The <code class="filename">$JBOSS_HOME/docs/examples/jca/hsqldb-encrypted-ds.xml</code> illustrates that data source configuration along with the JaasSecurityDomain configuration for the keystore:
		</div><div class="para">
			<a class="xref" href="Encrypting_Data_Source_Passwords.html#exam-FilePassword_Example_Command">Example 17.4, “FilePassword command example”</a> provides an example of the command with its output.
		</div><div class="example"><a id="exam-FilePassword_Example_Command">
      ⁠</a><p class="title"><strong>Example 17.4. FilePassword command example</strong></p><div class="example-contents"><div class="para">
				The following example refers to the file <code class="filename">.../conf/server.password</code>. You first need to run the following command, which will store the encryption details and obfuscated master password:
			</div><pre class="screen">
java -cp jboss-as/lib/jbosssx.jar org.jboss.security.plugins.FilePassword <em class="replaceable">salt</em> <em class="replaceable">count</em> <em class="replaceable">master_password</em> <em class="replaceable">password_file</em>
          
For example: java -cp jboss-as/lib/jbosssx.jar org.jboss.security.plugins.FilePassword abcdefgh 13 master jboss-as/server/$PROFILE/conf/server.password
</pre></div></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- The Hypersonic embedded database JCA connection factory config</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">that illustrates the use of the JaasSecurityDomainIdentityLoginModule</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">to use encrypted password in the data source configuration. </span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">$Id: hsqldb-encrypted-ds.xml,v 1.1.2.1 2004/06/04 02:20:52 starksm Exp $ --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;datasources&gt;</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;application-policy</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"EncryptedHsqlDbRealm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.security.JaasSecurityDomainIdentityLoginModule"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            flag</span> <span xmlns="" class="perl_Others">=</span> <span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"username"</span><span xmlns="" class="perl_Keyword">&gt;</span>sa<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Keyword">&gt;</span>E5gtGMKcXPP<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"managedConnectionFactoryName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              jboss.jca:service=LocalTxCM,name=DefaultDS
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jaasSecurityDomain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              jboss.security:service=JaasSecurityDomain,domain=ServerMasterPassword
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/application-policy&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.security.plugins.JaasSecurityDomain"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      name=</span><span xmlns="" class="perl_String">"jboss.security:service=JaasSecurityDomain, domain=ServerMasterPassword"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;arg</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"ServerMasterPassword"</span><span xmlns="" class="perl_Keyword">&gt;&lt;/arg&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- The opaque master password file used to decrypt the encrypted</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      database password key --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"KeyStorePass"</span><span xmlns="" class="perl_Keyword">&gt;</span>{CLASS}org.jboss.security.plugins.FilePassword:${jboss.server.home.dir}/conf/server.password<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Salt"</span><span xmlns="" class="perl_Keyword">&gt;</span>abcdefgh<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"IterationCount"</span><span xmlns="" class="perl_Keyword">&gt;</span>13<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- This mbean can be used when using in process persistent db --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jdbc.HypersonicDatabase"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      name=</span><span xmlns="" class="perl_String">"jboss:service=Hypersonic,database=localDB"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Database"</span><span xmlns="" class="perl_Keyword">&gt;</span>localDB<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InProcessMode"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/datasources&gt;</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Remember to use the same Salt and IterationCount in the MBean that was used during the password generation step.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				When starting a service that depends on an encrypted data source, the error <code class="literal">java.security.InvalidAlgorithmParameterException: Parameters missing</code> is raised when the following MBean is not yet started as a service:
			</div><pre class="programlisting">(jboss.security:service=JaasSecurityDomain,domain=ServerMasterPassword)
</pre><div class="para">
				Include the following element so that the MBean starts before the data source, as per the example <code class="filename">hsqldb-encrypted-ds.xml</code> code shown previously.
			</div><pre class="programlisting">
&lt;depends&gt;jboss.security:service=JaasSecurityDomain,domain=ServerMasterPassword&lt;/depends&gt;
</pre></div></div></div></div></body></html>