<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 21. Securing the Administrative Access Points</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-Consoles_and_Invokers">
      ⁠</a>Chapter 21. Securing the Administrative Access Points</h1></div></div></div><div class="para">
		JBoss Enterprise Application Platform ships with several administrative access points that must be secured or removed to prevent unauthorized access to administrative functions in a deployment. This chapter discusses the various administration services, how to secure them, and how to disable authentication on these access points for development purposes.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-The_JMX_Console">
      ⁠</a>21.1. JMX Console</h1></div></div></div><div class="para">
			The JMX Console is provided by the <code class="filename">jmx-console.war</code> file located in the deploy directory. It provides with an HTML view into the JMX Microkernel and allows you to perform administrative actions such as shutting down the server, stopping services and deploying new services, among other things.
		</div><div class="para">
			This service is secured by default, and permissions need to be granted to the <code class="literal">jmx-console</code> security domain to allow access. Follow <a class="xref" href="chap-Consoles_and_Invokers.html#task-The_JMX_Console-Create_jmx-console_admin-console_and_http_invoker_user_account">Task: Create jmx-console, admin-console, and http invoker user account</a> to allow access to it. In order to remove it, delete the <code class="filename">jmx-console</code> folder from the <code class="filename">deploy</code> directory.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="How_to_Secure_the_JBoss_Server-The_Web_Console">
      ⁠</a>21.2. Admin Console</h1></div></div></div><div class="para">
			The Admin Console improves on the former Web Console, and is an embedded version of the JOPR project, which JBoss Operation Network is based on. This console allows access for users to deploy and undeploy applications, and should be secured or removed. It is secured by default.
		</div><div class="para">
			Follow <a class="xref" href="chap-Consoles_and_Invokers.html#task-The_JMX_Console-Allow_access_to_the_JMX_Invoker_from_remote_hosts">Task: Allow access to the HTTP Invoker from remote hosts</a> to allow access to the Admin Console.
		</div><div class="para">
			Alternatively, it can be removed by deleting the <code class="filename">admin-console</code> directory from the <code class="filename">deploy</code> directory.
		</div><div class="task"><a id="task-The_JMX_Console-Create_jmx-console_admin-console_and_http_invoker_user_account">
      ⁠</a><p class="title"><strong>Task: Create jmx-console, admin-console, and http invoker user account</strong></p><div class="tasksummary"> <div class="para">
			This procedure creates user with access permissions to the admin and jmx consoles, and the http invoker.
		</div>
		 <div class="para">
			The jmx-console is secured by the <code class="literal">jmx-console</code> security domain which is defined in <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/login-config.xml</code>.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921686505392">
      ⁠</a><p class="title"><strong>Procedure 21.1. </strong></p><ol class="1"><li class="step"><div class="para">
					Add a username and password to <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/props/jmx-console-users.properties</code>.
				</div></li><li class="step"><div class="para">
					Create a <em class="replaceable">username = password</em> pair.
				</div><div class="important"><div class="admonition_header"><p><strong>Default admin user configuration</strong></p></div><div class="admonition"><div class="para">
						The commented <code class="literal">admin=admin</code> username and password pair is an example of the username/password definition syntax. Do not use this for your user account.
					</div></div></div></li><li class="step"><div class="para">
					Grant permissions to the user:
				</div><ol class="substeps a"><li class="step"><div class="para">
							Edit the file <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/props/jmx-console-roles.properties</code>.
						</div></li><li class="step"><div class="para">
							Create an entry for the user of the form:
						</div><div class="para">
							<code class="literal">username=JBossAdmin,HttpInvoker</code>
						</div></li></ol></li><li class="step"><div class="para">
					Grant the user permission to access the JMX Console and Admin Console.
				</div></li><li class="step"><div class="para">
					Grant the user permission to access the HTTP Invoker.
				</div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139921679588224">
      ⁠</a>21.3. Web Console</h1></div></div></div><div class="para">
			The Web Console is a legacy console, from the EAP 4 series. The current Admin Console is a more fully featured console. The Web Console is secured by default. The Web Console is secured by the <code class="literal">web-console</code> security domain which is defined in <code class="filename">$JBOSS_HOME/server/$PROFILE/conf/login-config.xml</code>.
		</div><div class="para">
			By default, the <code class="literal">web-console</code> security domain uses the same security configuration as the <code class="literal">jmx-console</code> domain. You can follow <a class="xref" href="chap-Consoles_and_Invokers.html#task-The_JMX_Console-Create_jmx-console_admin-console_and_http_invoker_user_account">Task: Create jmx-console, admin-console, and http invoker user account</a> to allow access to it.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="How_to_Secure_the_JBoss_Server-The_HTTP_Invokers">
      ⁠</a>21.4. HTTP Invoker</h1></div></div></div><div class="para">
			The HTTP Invoker is a service that provides HTTP and Remote Method Invocation (RMI) access for EJBs and the JNDI Naming service. It is secured by the <code class="literal">jmx-console</code> security domain. The instructions in <a class="xref" href="chap-Consoles_and_Invokers.html#task-The_JMX_Console-Create_jmx-console_admin-console_and_http_invoker_user_account">Task: Create jmx-console, admin-console, and http invoker user account</a> will allow access to it.
		</div><div class="task"><a id="task-The_JMX_Console-Allow_access_to_the_JMX_Invoker_from_remote_hosts">
      ⁠</a><p class="title"><strong>Task: Allow access to the HTTP Invoker from remote hosts</strong></p><div class="tasksummary"> <div class="para">
			To allow access on the the hostName <em class="replaceable">myservice.example.com</em>, add a <em class="parameter"><code>hostName</code></em> property to invoker you wish to use; Pooled or non-Pooled. Be aware that <em class="replaceable">myservice.example.com</em> must resolve to an IP Address served by this machine.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139921665088320">
      ⁠</a><p class="title"><strong>Procedure 21.2. </strong></p><ul><li class="step"><div class="para">
					Choose the appropriate bean from the options below and copy it in your invoker:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- RMI/JRMP invoker --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.services.binding.ServiceBindingMetadata"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serviceName"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss:service=invoker,type=jrmp<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Keyword">&gt;</span>4444<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"description"</span><span xmlns="" class="perl_Keyword">&gt;</span>Socket for the legacy RMI/JRMP invoker<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hostName"</span><span xmlns="" class="perl_Keyword">&gt;</span>myservice.example.com<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Pooled invoker --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.services.binding.ServiceBindingMetadata"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serviceName"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss:service=invoker,type=pooled<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Keyword">&gt;</span>4445<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"description"</span><span xmlns="" class="perl_Keyword">&gt;</span>Socket for the legacy Pooled invoker<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hostName"</span><span xmlns="" class="perl_Keyword">&gt;</span>myservice.example.com<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="How_to_Secure_the_JBoss_Server-The_JMX_Invoker">
      ⁠</a>21.5. JMX Invoker</h1></div></div></div><div class="para">
			This invoker exposes the JMX MBeanServer interface via an RMI compatible interface using the RMI/JRMP detached invoker service. The JMX Invoker is secured by default in JBoss Enterprise Application Platform 5.1 and later, by restricting access to the request originating from the loopback network interface, or 'localhost'. To allow access to it from remote hosts, follow the procedure outlined in 21.2.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Remote_Access_to_Services_Detached_Invokers">
      ⁠</a>21.6. Remote Access to Services, Detached Invokers</h1></div></div></div><div class="para">
			In addition to the MBean services notion that allows for the ability to integrate arbitrary functionality, JBoss also has a detached invoker concept that allows MBean services to expose functional interfaces via arbitrary protocols for remote access by clients. The notion of a detached invoker is that remoting and the protocol by which a service is accessed is a functional aspect or service independent of the component. Therefore, you can make a naming service available for use via RMI/JRMP, RMI/HTTP, RMI/SOAP, or any arbitrary custom transport.
		</div><div class="para">
			The discussion of the detached invoker architecture will begin with an overview of the components involved. The main components in the detached invoker architecture are shown in <a class="xref" href="chap-Consoles_and_Invokers.html#Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">Figure 21.1, “The main components in the detached invoker architecture”</a>.
		</div><div class="figure"><a id="Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">
      ⁠</a><div class="figure-contents"><div class="mediaobject" style="text-align: center"><img src="images/j2ee_chap2-47.png" align="middle" alt="The main components in the detached invoker architecture" style="text-align: middle"/></div></div><p class="title"><strong>Figure 21.1. The main components in the detached invoker architecture</strong></p></div><div class="para">
			On the client side, there exists a client proxy which exposes the interface(s) of the MBean service. This is the same smart, compile-less dynamic proxy that is used for EJB home and remote interfaces. The only difference between the proxy for an arbitrary service and the EJB is the set of interfaces exposed as well as the client side interceptors found inside the proxy. The client interceptors are represented by the rectangles found inside of the client proxy. An interceptor is an assembly line type of pattern that allows for transformation of a method invocation and/or return values. A client obtains a proxy through some lookup mechanism, typically JNDI. Although RMI is indicated in <a class="xref" href="chap-Consoles_and_Invokers.html#Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">Figure 21.1, “The main components in the detached invoker architecture”</a>, the only real requirement on the exposed interface and its types is that they are serializable between the client server over JNDI as well as the transport layer.
		</div><div class="para">
			The choice of the transport layer is determined by the last interceptor in the client proxy, which is referred to as the <span class="emphasis"><em>Invoker Interceptor</em></span> in <a class="xref" href="chap-Consoles_and_Invokers.html#Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">Figure 21.1, “The main components in the detached invoker architecture”</a>. The invoker interceptor contains a reference to the transport specific stub of the server side <span class="emphasis"><em>Detached Invoker</em></span> MBean service. The invoker interceptor also handles the optimization of calls that occur within the same VM as the target MBean. When the invoker interceptor detects that this is the case the call is passed to a call-by-reference invoker that simply passes the invocation along to the target MBean.
		</div><div class="para">
			The detached invoker service is responsible for making a generic invoke operation available via the transport the detached invoker handles. The <code class="literal">Invoker</code> interface illustrates the generic invoke operation.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">invocation</span>;
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.rmi.Remote;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.proxy.Interceptor;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.util.id.GUID;</span>
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> Invoker
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">extends</span> Remote
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>GUID ID = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">GUID</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>String <span xmlns="" class="perl_Function">getServerHostName</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Object <span xmlns="" class="perl_Function">invoke</span>(Invocation invocation) <span xmlns="" class="perl_Keyword">throws</span> Exception;
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The Invoker interface extends <code class="literal">Remote</code> to be compatible with RMI, but this does not mean that an invoker must expose an RMI service stub. The detached invoker service acts as a transport gateway that accepts invocations represented as the <code class="literal">org.jboss.invocation.Invocation</code> object over its specific transport. The invoker service unmarshals the invocation, forwards the invocation onto the destination MBean service represented by the <span class="emphasis"><em>Target MBean</em></span> in <a class="xref" href="chap-Consoles_and_Invokers.html#Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">Figure 21.1, “The main components in the detached invoker architecture”</a>, and marshals the return value or exception resulting from the forwarded call back to the client.
		</div><div class="para">
			The <code class="literal">Invocation</code> object is just a representation of a method invocation context. This includes the target MBean name, the method, the method arguments, a context of information associated with the proxy by the proxy factory, and an arbitrary map of data associated with the invocation by the client proxy interceptors.
		</div><div class="para">
			The configuration of the client proxy is done by the server side proxy factory MBean service, indicated by the <span class="emphasis"><em>Proxy Factory</em></span> component in <a class="xref" href="chap-Consoles_and_Invokers.html#Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">Figure 21.1, “The main components in the detached invoker architecture”</a>. The proxy factory performs the following tasks:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Create a dynamic proxy that implements the interface the target MBean wishes to expose.
				</div></li><li class="listitem"><div class="para">
					Associate the client proxy interceptors with the dynamic proxy handler.
				</div></li><li class="listitem"><div class="para">
					Associate the invocation context with the dynamic proxy. This includes the target MBean, detached invoker stub and the proxy JNDI name.
				</div></li><li class="listitem"><div class="para">
					Make the proxy available to clients by binding the proxy into JNDI.
				</div></li></ul></div><div class="para">
			The last component in <a class="xref" href="chap-Consoles_and_Invokers.html#Remote_Access_to_Services_Detached_Invokers-The_main_components_in_the_detached_invoker_architecture">Figure 21.1, “The main components in the detached invoker architecture”</a> is the <span class="emphasis"><em>Target MBean</em></span> service that wishes to expose an interface for invocations to remote clients. The steps required for an MBean service to be accessible through a given interface are:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Define a JMX operation matching the signature: <code class="literal">public Object invoke(org.jboss.invocation.Invocation) throws Exception</code>
				</div></li><li class="listitem"><div class="para">
					Create a <code class="literal">HashMap&lt;Long, Method&gt;</code> mapping from the exposed interface <code class="literal">java.lang.reflect.Method</code>s to the long hash representation using the <code class="literal">org.jboss.invocation.MarshalledInvocation.calculateHash</code> method.
				</div></li><li class="listitem"><div class="para">
					Implement the <code class="literal">invoke(Invocation)</code> JMX operation and use the interface method hash mapping to transform from the long hash representation of the invoked method to the <code class="literal">java.lang.reflect.Method</code> of the exposed interface. Reflection is used to perform the actual invocation on the object associated with the MBean service that actually implements the exposed interface.
				</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Remote_Access_to_Services_Detached_Invokers-A_Detached_Invoker_Example_the_MBeanServer_Invoker_Adaptor_Service">
      ⁠</a>21.6.1. A Detached Invoker Example, the MBeanServer Invoker Adaptor Service</h2></div></div></div><div class="para">
				This section presents the <code class="literal">org.jboss.jmx.connector.invoker.InvokerAdaptorService</code> and its configuration for access via RMI/JRMP as an example of the steps required to provide remote access to an MBean service.
			</div><div class="example"><a id="A_Detached_Invoker_Example_the_MBeanServer_Invoker_Adaptor_Service-The_InvokerAdaptorService_MBean">
      ⁠</a><p class="title"><strong>Example 21.1. The InvokerAdaptorService MBean</strong></p><div class="example-contents"><div class="para">
					The <code class="literal">InvokerAdaptorService</code> is a simple MBean service that exists to fulfill the target MBean role in the detached invoker pattern.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">jmx</span>.<span xmlns="" class="perl_Function">connector</span>.<span xmlns="" class="perl_Function">invoker</span>;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> InvokerAdaptorServiceMBean
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">extends</span> org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">system</span>.<span xmlns="" class="perl_Function">ServiceMBean</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">Class</span> <span xmlns="" class="perl_Function">getExportedInterface</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setExportedInterface</span>(<span xmlns="" class="perl_Keyword">Class</span> exportedInterface);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Object <span xmlns="" class="perl_Function">invoke</span>(org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">invocation</span>.<span xmlns="" class="perl_Function">Invocation</span> invocation)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception;
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">jmx</span>.<span xmlns="" class="perl_Function">connector</span>.<span xmlns="" class="perl_Function">invoker</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.InvocationTargetException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.Method;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.UndeclaredThrowableException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Collections;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.HashMap;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Map;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.MBeanServer;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.ObjectName;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.invocation.Invocation;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.invocation.MarshalledInvocation;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.mx.server.ServerConstants;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.system.ServiceMBeanSupport;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.system.Registry;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> InvokerAdaptorService
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">extends</span> ServiceMBeanSupport
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">implements</span> InvokerAdaptorServiceMBean, ServerConstants
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> ObjectName mbeanRegistry;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">static</span> {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>        mbeanRegistry = <span xmlns="" class="perl_Keyword">new</span> ObjectName(MBEAN_REGISTRY);
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> RuntimeException(e.<span xmlns="" class="perl_Function">toString</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Map marshalledInvocationMapping = <span xmlns="" class="perl_Keyword">new</span> HashMap();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_Keyword">Class</span> exportedInterface;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">Class</span> <span xmlns="" class="perl_Function">getExportedInterface</span>()
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> exportedInterface;
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setExportedInterface</span>(<span xmlns="" class="perl_Keyword">Class</span> exportedInterface)
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">exportedInterface</span> = exportedInterface;
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">startService</span>()
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Build the interface method map</span>
<span xmlns="" class="line">​</span>    Method[] methods = exportedInterface.<span xmlns="" class="perl_Function">getMethods</span>();
<span xmlns="" class="line">​</span>    HashMap tmpMap = <span xmlns="" class="perl_Keyword">new</span> HashMap(methods.<span xmlns="" class="perl_Function">length</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> m = <span xmlns="" class="perl_Float">0</span>; m &lt; methods.<span xmlns="" class="perl_Function">length</span>; m ++) {
<span xmlns="" class="line">​</span>        Method method = methods[m];
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">Long</span> hash = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_DataType">Long</span>(MarshalledInvocation.<span xmlns="" class="perl_Function">calculateHash</span>(method));
<span xmlns="" class="line">​</span>        tmpMap.<span xmlns="" class="perl_Function">put</span>(hash, method);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    marshalledInvocationMapping = Collections.<span xmlns="" class="perl_Function">unmodifiableMap</span>(tmpMap);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Place our ObjectName hash into the Registry so invokers can</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// resolve it</span>
<span xmlns="" class="line">​</span>    Registry.<span xmlns="" class="perl_Function">bind</span>(<span xmlns="" class="perl_Keyword">new</span> Integer(serviceName.<span xmlns="" class="perl_Function">hashCode</span>()), serviceName);
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">stopService</span>()
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    Registry.<span xmlns="" class="perl_Function">unbind</span>(<span xmlns="" class="perl_Keyword">new</span> Integer(serviceName.<span xmlns="" class="perl_Function">hashCode</span>()));
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> Object <span xmlns="" class="perl_Function">invoke</span>(Invocation invocation)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Make sure we have the correct classloader before unmarshalling</span>
<span xmlns="" class="line">​</span>    Thread thread = Thread.<span xmlns="" class="perl_Function">currentThread</span>();
<span xmlns="" class="line">​</span>    ClassLoader oldCL = thread.<span xmlns="" class="perl_Function">getContextClassLoader</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Get the MBean this operation applies to</span>
<span xmlns="" class="line">​</span>    ClassLoader newCL = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    ObjectName objectName = (ObjectName) 
<span xmlns="" class="line">​</span>        invocation.<span xmlns="" class="perl_Function">getValue</span>(<span xmlns="" class="perl_String">"JMX_OBJECT_NAME"</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (objectName != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Obtain the ClassLoader associated with the MBean deployment</span>
<span xmlns="" class="line">​</span>        newCL = (ClassLoader) 
<span xmlns="" class="line">​</span>            server.<span xmlns="" class="perl_Function">invoke</span>(mbeanRegistry, <span xmlns="" class="perl_String">"getValue"</span>,
<span xmlns="" class="line">​</span>                          <span xmlns="" class="perl_Keyword">new</span> Object[] { objectName, CLASSLOADER },
<span xmlns="" class="line">​</span>                          <span xmlns="" class="perl_Keyword">new</span> String[] { ObjectName.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>(),
<span xmlns="" class="line">​</span>                                         <span xmlns="" class="perl_String">"java.lang.String"</span> });
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (newCL != <span xmlns="" class="perl_Keyword">null</span> &amp;&amp; newCL != oldCL) {
<span xmlns="" class="line">​</span>        thread.<span xmlns="" class="perl_Function">setContextClassLoader</span>(newCL);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Set the method hash to Method mapping</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (invocation <span xmlns="" class="perl_Keyword">instanceof</span> MarshalledInvocation) {
<span xmlns="" class="line">​</span>            MarshalledInvocation mi = (MarshalledInvocation) invocation;
<span xmlns="" class="line">​</span>            mi.<span xmlns="" class="perl_Function">setMethodMap</span>(marshalledInvocationMapping);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Invoke the MBeanServer method via reflection</span>
<span xmlns="" class="line">​</span>        Method method = invocation.<span xmlns="" class="perl_Function">getMethod</span>();
<span xmlns="" class="line">​</span>        Object[] args = invocation.<span xmlns="" class="perl_Function">getArguments</span>();
<span xmlns="" class="line">​</span>        Object value = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            String name = method.<span xmlns="" class="perl_Function">getName</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">Class</span>[] sig = method.<span xmlns="" class="perl_Function">getParameterTypes</span>();
<span xmlns="" class="line">​</span>            Method mbeanServerMethod =
<span xmlns="" class="line">​</span>                MBeanServer.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getMethod</span>(name, sig);
<span xmlns="" class="line">​</span>            value = mbeanServerMethod.<span xmlns="" class="perl_Function">invoke</span>(server, args);
<span xmlns="" class="line">​</span>        } <span xmlns="" class="perl_Keyword">catch</span>(InvocationTargetException e) {
<span xmlns="" class="line">​</span>            Throwable t = e.<span xmlns="" class="perl_Function">getTargetException</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (t <span xmlns="" class="perl_Keyword">instanceof</span> Exception) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> (Exception) t;
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> UndeclaredThrowableException(t, method.<span xmlns="" class="perl_Function">toString</span>());
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> value;
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">finally</span> {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (newCL != <span xmlns="" class="perl_Keyword">null</span> &amp;&amp; newCL != oldCL) {
<span xmlns="" class="line">​</span>            thread.<span xmlns="" class="perl_Function">setContextClassLoader</span>(oldCL);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="para">
				To help understand the components that make up the <code class="literal">InvokerAdaptorServiceMBean</code>, the code has been split into logical blocks, with commentary about how each block operates.
			</div><div class="example"><a id="idm139921668648720">
      ⁠</a><p class="title"><strong>Example 21.2. Block One</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">jmx</span>.<span xmlns="" class="perl_Function">connector</span>.<span xmlns="" class="perl_Function">invoker</span>;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> InvokerAdaptorServiceMBean
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">extends</span> org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">system</span>.<span xmlns="" class="perl_Function">ServiceMBean</span>
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">Class</span> <span xmlns="" class="perl_Function">getExportedInterface</span>();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setExportedInterface</span>(<span xmlns="" class="perl_Keyword">Class</span> exportedInterface);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Object <span xmlns="" class="perl_Function">invoke</span>(org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">invocation</span>.<span xmlns="" class="perl_Function">Invocation</span> invocation)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception;
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">jmx</span>.<span xmlns="" class="perl_Function">connector</span>.<span xmlns="" class="perl_Function">invoker</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.InvocationTargetException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.Method;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.lang.reflect.UndeclaredThrowableException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Collections;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.HashMap;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Map;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.MBeanServer;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.management.ObjectName;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.invocation.Invocation;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.invocation.MarshalledInvocation;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.mx.server.ServerConstants;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.system.ServiceMBeanSupport;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.system.Registry;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> InvokerAdaptorService
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">extends</span> ServiceMBeanSupport
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">implements</span> InvokerAdaptorServiceMBean, ServerConstants
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> ObjectName mbeanRegistry;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">static</span> {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>        mbeanRegistry = <span xmlns="" class="perl_Keyword">new</span> ObjectName(MBEAN_REGISTRY);
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> RuntimeException(e.<span xmlns="" class="perl_Function">toString</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Map marshalledInvocationMapping = <span xmlns="" class="perl_Keyword">new</span> HashMap();
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_Keyword">Class</span> exportedInterface;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">Class</span> <span xmlns="" class="perl_Function">getExportedInterface</span>()
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> exportedInterface;
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setExportedInterface</span>(<span xmlns="" class="perl_Keyword">Class</span> exportedInterface)
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">exportedInterface</span> = exportedInterface;
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>...</pre><div class="para">
					The <code class="literal">InvokerAdaptorServiceMBean</code> Standard MBean interface of the <code class="literal">InvokerAdaptorService</code> has a single <code class="literal">ExportedInterface</code> attribute and a single <code class="literal">invoke(Invocation)</code> operation.
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ExportedInterface</code></span></dt><dd><div class="para">
								The attribute allows customization of the type of interface the service exposes to clients. This must be compatible with the <code class="literal">MBeanServer</code> class in terms of method name and signature.
							</div></dd><dt><span class="term"><code class="literal">invoke(Invocation)</code></span></dt><dd><div class="para">
								The operation is the required entry point that target MBean services must expose to participate in the detached invoker pattern. This operation is invoked by the detached invoker services that have been configured to provide access to the <code class="literal">InvokerAdaptorService</code>.
							</div></dd></dl></div></div></div><div class="example"><a id="exam-Block_2">
      ⁠</a><p class="title"><strong>Example 21.3. Block Two</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">startService</span>()
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Build the interface method map</span>
<span xmlns="" class="line">​</span>    Method[] methods = exportedInterface.<span xmlns="" class="perl_Function">getMethods</span>();
<span xmlns="" class="line">​</span>    HashMap tmpMap = <span xmlns="" class="perl_Keyword">new</span> HashMap(methods.<span xmlns="" class="perl_Function">length</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> m = <span xmlns="" class="perl_Float">0</span>; m &amp;lt; methods.<span xmlns="" class="perl_Function">length</span>; m ++) {
<span xmlns="" class="line">​</span>        Method method = methods[m];
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_DataType">Long</span> hash = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_DataType">Long</span>(MarshalledInvocation.<span xmlns="" class="perl_Function">calculateHash</span>(method));
<span xmlns="" class="line">​</span>        tmpMap.<span xmlns="" class="perl_Function">put</span>(hash, method);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    marshalledInvocationMapping = Collections.<span xmlns="" class="perl_Function">unmodifiableMap</span>(tmpMap);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Place our ObjectName hash into the Registry so invokers can</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// resolve it</span>
<span xmlns="" class="line">​</span>    Registry.<span xmlns="" class="perl_Function">bind</span>(<span xmlns="" class="perl_Keyword">new</span> Integer(serviceName.<span xmlns="" class="perl_Function">hashCode</span>()), serviceName);
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">stopService</span>()
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    Registry.<span xmlns="" class="perl_Function">unbind</span>(<span xmlns="" class="perl_Keyword">new</span> Integer(serviceName.<span xmlns="" class="perl_Function">hashCode</span>()));
<span xmlns="" class="line">​</span>}</pre><div class="para">
					This code block builds the HashMap&lt;Long, Method&gt; of the <code class="classname">exportedInterface</code> Class using the <code class="methodname"> org.jboss.invocation.MarshalledInvocation.calculateHash(Method) </code> utility method.
				</div><div class="para">
					Because <code class="literal">java.lang.reflect.Method</code> instances are not serializable, a <code class="literal">MarshalledInvocation</code> version of the non-serializable <code class="literal">Invocation</code> class is used to marshal the invocation between the client and server. The <code class="literal">MarshalledInvocation</code> replaces the Method instances with their corresponding hash representation. On the server side, the <code class="literal">MarshalledInvocation</code> must be told what the hash to Method mapping is.
				</div><div class="para">
					This code block creates a mapping between the <code class="literal">InvokerAdaptorService</code> service name and its hash code representation. This is used by detached invokers to determine what the target MBean <code class="literal">ObjectName</code> of an <code class="literal">Invocation</code> is.
				</div><div class="para">
					When the target MBean name is stored in the <code class="literal">Invocation</code>, its store as its hashCode because <code class="literal">ObjectName</code>s are relatively expensive objects to create. The <code class="literal">org.jboss.system.Registry</code> is a global map like construct that invokers use to store the hash code to <code class="literal">ObjectName</code> mappings in.
				</div></div></div><div class="example"><a id="idm139921634812992">
      ⁠</a><p class="title"><strong>Example 21.4. Block Three</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Object <span xmlns="" class="perl_Function">invoke</span>(Invocation invocation)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">throws</span> Exception
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Make sure we have the correct classloader before unmarshalling</span>
<span xmlns="" class="line">​</span>    Thread thread = Thread.<span xmlns="" class="perl_Function">currentThread</span>();
<span xmlns="" class="line">​</span>    ClassLoader oldCL = thread.<span xmlns="" class="perl_Function">getContextClassLoader</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Get the MBean this operation applies to</span>
<span xmlns="" class="line">​</span>    ClassLoader newCL = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    ObjectName objectName = (ObjectName) 
<span xmlns="" class="line">​</span>        invocation.<span xmlns="" class="perl_Function">getValue</span>(&amp;quot;JMX_OBJECT_NAME&amp;quot;);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (objectName != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Obtain the ClassLoader associated with the MBean deployment</span>
<span xmlns="" class="line">​</span>        newCL = (ClassLoader) 
<span xmlns="" class="line">​</span>            server.<span xmlns="" class="perl_Function">invoke</span>(mbeanRegistry, &amp;quot;getValue&amp;quot;,
<span xmlns="" class="line">​</span>                          <span xmlns="" class="perl_Keyword">new</span> Object[] { objectName, CLASSLOADER },
<span xmlns="" class="line">​</span>                          <span xmlns="" class="perl_Keyword">new</span> String[] { ObjectName.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getName</span>(),
<span xmlns="" class="line">​</span>                                         &amp;quot;java.<span xmlns="" class="perl_Function">lang</span>.<span xmlns="" class="perl_Function">String</span>&amp;quot; });
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (newCL != <span xmlns="" class="perl_Keyword">null</span> &amp;amp;&amp;amp; newCL != oldCL) {
<span xmlns="" class="line">​</span>        thread.<span xmlns="" class="perl_Function">setContextClassLoader</span>(newCL);
<span xmlns="" class="line">​</span>    }
</pre><div class="para">
					This code block obtains the name of the MBean on which the MBeanServer operation is being performed, and then looks up the class loader associated with the MBean's SAR deployment. This information is available via the <code class="classname">org.jboss.mx.server.registry.BasicMBeanRegistry</code>, a JBoss JMX implementation-specific class.
				</div><div class="para">
					It is generally necessary for an MBean to establish the correct class loading context because the detached invoker protocol layer may not have access to the class loaders needed to unmarshal the types associated with an invocation.
				</div></div></div><div class="example"><a id="idm139921670606192">
      ⁠</a><p class="title"><strong>Example 21.5. Block Four</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Set the method hash to Method mapping</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (invocation <span xmlns="" class="perl_Keyword">instanceof</span> MarshalledInvocation) {
<span xmlns="" class="line">​</span>            MarshalledInvocation mi = (MarshalledInvocation) invocation;
<span xmlns="" class="line">​</span>            mi.<span xmlns="" class="perl_Function">setMethodMap</span>(marshalledInvocationMapping);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>...</pre><div class="para">
					This code block installs the <code class="literal">ExposedInterface</code> class method hash to method mapping if the invocation argument is of type <code class="literal">MarshalledInvocation</code>. The method mapping calculated in <a class="xref" href="chap-Consoles_and_Invokers.html#exam-Block_2">Example 21.3, “Block Two”</a>is used here.
				</div><div class="para">
					A second mapping is performed from the <code class="methodname"> ExposedInterface </code> method to the matching method of the MBeanServer class. The <code class="literal">InvokerServiceAdaptor</code> decouples the <code class="literal">ExposedInterface</code> from the <code class="classname">MBeanServer</code> class in that it allows an arbitrary interface. This is required because the standard <code class="classname">java.lang.reflect.Proxy</code> class can only proxy interfaces. It also allows you to only expose a subset of the MBeanServer methods and add transport specific exceptions such as <code class="literal">java.rmi.RemoteException</code> to the <code class="literal">ExposedInterface</code> method signatures.
				</div></div></div><div class="example"><a id="idm139921689283616">
      ⁠</a><p class="title"><strong>Example 21.6. Block Five</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Invoke the MBeanServer method via reflection</span>
<span xmlns="" class="line">​</span>        Method method = invocation.<span xmlns="" class="perl_Function">getMethod</span>();
<span xmlns="" class="line">​</span>        Object[] args = invocation.<span xmlns="" class="perl_Function">getArguments</span>();
<span xmlns="" class="line">​</span>        Object value = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            String name = method.<span xmlns="" class="perl_Function">getName</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">Class</span>[] sig = method.<span xmlns="" class="perl_Function">getParameterTypes</span>();
<span xmlns="" class="line">​</span>            Method mbeanServerMethod =
<span xmlns="" class="line">​</span>                MBeanServer.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">getMethod</span>(name, sig);
<span xmlns="" class="line">​</span>            value = mbeanServerMethod.<span xmlns="" class="perl_Function">invoke</span>(server, args);
<span xmlns="" class="line">​</span>        } <span xmlns="" class="perl_Keyword">catch</span>(InvocationTargetException e) {
<span xmlns="" class="line">​</span>            Throwable t = e.<span xmlns="" class="perl_Function">getTargetException</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> (t <span xmlns="" class="perl_Keyword">instanceof</span> Exception) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> (Exception) t;
<span xmlns="" class="line">​</span>            } <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> UndeclaredThrowableException(t, method.<span xmlns="" class="perl_Function">toString</span>());
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> value;
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">finally</span> {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (newCL != <span xmlns="" class="perl_Keyword">null</span> &amp;amp;&amp;amp; newCL != oldCL) {
<span xmlns="" class="line">​</span>            thread.<span xmlns="" class="perl_Function">setContextClassLoader</span>(oldCL);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>}</pre><div class="para">
					The code block dispatches the MBeanServer method invocation to the <code class="literal">InvokerAdaptorService</code> MBeanServer instance to which the was deployed. The server instance variable is inherited from the <code class="literal">ServiceMBeanSupport</code> superclass.
				</div><div class="para">
					Any exceptions that result from the reflective invocation are handled, including unwrapping any declared exceptions thrown by the invocation. The MBean code completes with the return of the successful MBeanServer method invocation result.
				</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The <code class="literal">InvokerAdaptorService</code> MBean does not deal directly with any transport specific details. There is the calculation of the method hash to Method mapping, but this is a transport independent detail.
				</div></div></div><div class="para">
				Now take a look at how the <code class="literal">InvokerAdaptorService</code> may be used to expose the same <code class="literal">org.jboss.jmx.adaptor.rmi.RMIAdaptor</code> interface via RMI/JRMP as seen in Connecting to JMX Using RMI.
			</div><div class="para">
				We start by presenting the proxy factory and <code class="literal">InvokerAdaptorService</code> configurations found in the default setup in the <code class="literal">jmx-invoker-adaptor-service.sar</code> deployment. <a class="xref" href="chap-Consoles_and_Invokers.html#A_Detached_Invoker_Example_the_MBeanServer_Invoker_Adaptor_Service-The_default_jmx_invoker_adaptor_server.sar_jboss_service.xml_deployment_descriptor">Example 21.7, “Default jmx-invoker-adaptor-server.sar deployment descriptor”</a> shows the <code class="literal">jboss-service.xml</code> descriptor for this deployment.
			</div><div class="example"><a id="A_Detached_Invoker_Example_the_MBeanServer_Invoker_Adaptor_Service-The_default_jmx_invoker_adaptor_server.sar_jboss_service.xml_deployment_descriptor">
      ⁠</a><p class="title"><strong>Example 21.7. Default jmx-invoker-adaptor-server.sar deployment descriptor</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;server&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- The JRMP invoker proxy configuration for the InvokerAdaptorService --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.invocation.jrmp.server.JRMPProxyFactory"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       name=</span><span xmlns="" class="perl_String">"jboss.jmx:type=adaptor,name=Invoker,protocol=jrmp,service=proxyFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Use the standard JRMPInvoker from conf/jboss-service.xml --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InvokerName"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss:service=invoker,type=jrmp<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- The target MBean is the InvokerAdaptorService configured below --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TargetName"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.jmx:type=adaptor,name=Invoker<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Where to bind the RMIAdaptor proxy --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JndiName"</span><span xmlns="" class="perl_Keyword">&gt;</span>jmx/invoker/RMIAdaptor<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- The RMI compatible MBeanServer interface --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExportedInterface"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jmx.adaptor.rmi.RMIAdaptor<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ClientInterceptors"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;iterceptors&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;interceptor&gt;</span>org.jboss.proxy.ClientMethodInterceptor<span xmlns="" class="perl_Keyword">&lt;/interceptor&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;interceptor&gt;</span>
<span xmlns="" class="line">​</span>                org.jboss.jmx.connector.invoker.client.InvokerAdaptorClientInterceptor 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/interceptor&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;interceptor&gt;</span>org.jboss.invocation.InvokerInterceptor<span xmlns="" class="perl_Keyword">&lt;/interceptor&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/iterceptors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss:service=invoker,type=jrmp<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- This is the service that handles the RMIAdaptor invocations by routing</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     them to the MBeanServer the service is deployed under. --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jmx.connector.invoker.InvokerAdaptorService"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       name=</span><span xmlns="" class="perl_String">"jboss.jmx:type=adaptor,name=Invoker"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExportedInterface"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jmx.adaptor.rmi.RMIAdaptor<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/server&gt;</span>
</pre></div></div><div class="para">
				The first MBean, <code class="literal">org.jboss.invocation.jrmp.server.JRMPProxyFactory</code>, is the proxy factory MBean service that creates proxies for the RMI/JRMP protocol. The configuration of this service as shown in <a class="xref" href="chap-Consoles_and_Invokers.html#A_Detached_Invoker_Example_the_MBeanServer_Invoker_Adaptor_Service-The_default_jmx_invoker_adaptor_server.sar_jboss_service.xml_deployment_descriptor">Example 21.7, “Default jmx-invoker-adaptor-server.sar deployment descriptor”</a> states that the JRMPInvoker will be used as the detached invoker, the <code class="literal">InvokerAdaptorService</code> is the target mbean to which requests will be forwarded, that the proxy will expose the <code class="literal">RMIAdaptor</code> interface, the proxy will be bound into JNDI under the name <code class="literal">jmx/invoker/RMIAdaptor</code>, and the proxy will contain 3 interceptors: <code class="literal">ClientMethodInterceptor</code>, <code class="literal">InvokerAdaptorClientInterceptor</code>, <code class="literal">InvokerInterceptor</code>. The configuration of the <code class="literal">InvokerAdaptorService</code> simply sets the RMIAdaptor interface that the service is exposing.
			</div><div class="para">
				The last piece of the configuration for exposing the <code class="literal">InvokerAdaptorService</code> via RMI/JRMP is the detached invoker. The detached invoker we will use is the standard RMI/JRMP invoker used by the EJB containers for home and remote invocations, and this is the <code class="literal">org.jboss.invocation.jrmp.server.JRMPInvoker</code> MBean service configured in the <code class="literal">conf/jboss-service.xml</code> descriptor. That we can use the same service instance emphasizes the detached nature of the invokers. The JRMPInvoker simply acts as the RMI/JRMP endpoint for all RMI/JRMP proxies regardless of the interface(s) the proxies expose or the service the proxies utilize.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Disabling_Authentication">
      ⁠</a>21.7. Disabling Authentication</h1></div></div></div><div class="para">
			This section contains information on how to disable authentication on individual specific services.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Disabling Entire Authentication</strong></p></div><div class="admonition"><div class="para">
				Developers who need to disable the entire authentication for development purposes can do so using the <code class="filename">jbossas-5-disableauth.patch</code> patch available in the source files (<code class="filename">src/build</code>). First, copy the patch file to the <code class="filename">jboss-as</code> directory and run the following command to apply the patch from the <code class="filename">jboss-as</code>directory: <pre class="synopsis">patch -p0 -i ./jbossas-5-disableauth.patch</pre>
			</div><div class="para">
				Note that this patch is intended for development purposes only.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Disabling_Auth-JMXConsole">
      ⁠</a>21.7.1. JMX Console</h2></div></div></div><div class="para">
				To disable authentication for the JMX console, comment out the <span class="markup">&lt;security-constraint&gt;</span> section in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/jmx-console.war/WEB-INF/web.xml</code> file as shown in <a class="xref" href="chap-Consoles_and_Invokers.html#JMXConsole-security-constraint_commented_out">Example 21.8, “HtmlAdaptor securite-constraint Commented out”</a>.
			</div><div class="example"><a id="JMXConsole-security-constraint_commented_out">
      ⁠</a><p class="title"><strong>Example 21.8. HtmlAdaptor securite-constraint Commented out</strong></p><div class="example-contents"><pre class="programlisting"><span class="bold bold"><strong><strong class="userinput"><code>&lt;!--</code></strong></strong></span>
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;HtmlAdaptor&lt;/web-resource-name&gt;
&lt;description&gt;
An example security config that only allows users with the role JBossAdmin to access the HTML JMX console web application
&lt;/description&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;JBossAdmin&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
<span class="bold bold"><strong><strong class="userinput"><code>--&gt;</code></strong></strong></span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Disabling_Auth-WebConsole">
      ⁠</a>21.7.2. Web Console</h2></div></div></div><div class="para">
				To disable authentication for the Web console, comment out the <span class="markup">&lt;security-constraint&gt;</span> section in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/management/console-mgr.sar/web-console.war/WEB-INF/web.xml</code> file as shown in <a class="xref" href="chap-Consoles_and_Invokers.html#WebConsole-security-constraint_commented_out">Example 21.9, “Web Console security-constraint Commented out”</a>.
			</div><div class="example"><a id="WebConsole-security-constraint_commented_out">
      ⁠</a><p class="title"><strong>Example 21.9. Web Console security-constraint Commented out</strong></p><div class="example-contents"><pre class="programlisting"><span class="bold bold"><strong><strong class="userinput"><code>&lt;!--</code></strong></strong></span>
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;HtmlAdaptor&lt;/web-resource-name&gt;
&lt;description&gt;
  An example security config that only allows users with the role JBossAdmin to access the HTML JMX console web application
&lt;/description&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;JBossAdmin&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
<span class="bold bold"><strong><strong class="userinput"><code>--&gt;</code></strong></strong></span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Disabling_Auth-HTTPInvoker">
      ⁠</a>21.7.3. JMX Invoker</h2></div></div></div><div class="para">
				To disable authentication for the JMX Invoker, comment out the <code class="literal">JNDIFactory</code>, <code class="literal">EJBInvokerServlet</code>, and <code class="literal">JMXInvokerServlet</code> from the security realm in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/httpha-invoker.sar/invoker.war/WEB-INF/web.xml</code> file as shown in <a class="xref" href="chap-Consoles_and_Invokers.html#HTTP_Invoker-security-commented_out">Example 21.10, “JMX Invoker Authentication Disabled”</a>.
			</div><div class="example"><a id="HTTP_Invoker-security-commented_out">
      ⁠</a><p class="title"><strong>Example 21.10. JMX Invoker Authentication Disabled</strong></p><div class="example-contents"><pre class="programlisting">&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;HttpInvokers&lt;/web-resource-name&gt;
&lt;description&gt;
An example security config that only allows users with the role HttpInvoker to access the HTTP invoker servlets
&lt;/description&gt;
&lt;!--
&lt;url-pattern&gt;/restricted/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/JNDIFactory/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/EJBInvokerServlet/*&lt;/url-pattern&gt;
&lt;url-pattern&gt;/JMXInvokerServlet/*&lt;/url-pattern&gt;
--&gt;
  &lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;HttpInvoker&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139921696273376">
      ⁠</a>21.7.4. JMX Invoker</h2></div></div></div><div class="para">
				To disable authentication for the JMX invoker, do the following:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Open for editing the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/jmx-invoker-service.xml</code> file.
					</div></li><li class="step"><div class="para">
						Locate the <code class="classname">org.jboss.jmx.connector.invoker.InvokerAdaptorService</code> MBean code.
					</div></li><li class="step"><div class="para">
						Comment out the <span class="markup">&lt;interceptor&gt;</span> block that specifies the <code class="classname">AuthenticationInterceptor</code> module, the security interceptor, as shown in <a class="xref" href="chap-Consoles_and_Invokers.html#JMXInvoker_commented_out">Example 21.11, “JMXInvoker Authentication Interceptor Commented out”</a>.
					</div><div class="example"><a id="JMXInvoker_commented_out">
      ⁠</a><p class="title"><strong>Example 21.11. JMXInvoker Authentication Interceptor Commented out</strong></p><div class="example-contents"><pre class="programlisting">&lt;descriptors&gt;
&lt;interceptors&gt;
&lt;!--Uncomment to require authenticated users--&gt;
<span class="bold bold"><strong><strong class="userinput"><code>&lt;!--</code></strong></strong></span>
&lt;interceptor code="org.jboss.jmx.connector.invoker.AuthenticationInterceptor"
securityDomain="java:/jaas/jmx-console"/&gt;
<span class="bold bold"><strong><strong class="userinput"><code>--&gt;</code></strong></strong></span>
&lt;!--Interceptor that deals with non-serializable results--&gt;
&lt;interceptor code="org.jboss.jmx.connector.invoker.SerializableInterceptor";
  policyClass="StripModelMBeanInfoPolicy"/&gt;
&lt;/interceptors&gt;
&lt;/descriptors&gt;</pre></div></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139921669731504">
      ⁠</a>21.7.5. ProfileService</h2></div></div></div><div class="para">
				To disable authentication for the <code class="systemitem">ProfileService</code> comment out the contents of the <span class="property">serverProxyInterceptors</span> element in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/profileservice-jboss-beans.xml</code> file as show in <a class="xref" href="chap-Consoles_and_Invokers.html#ProfileService-Authentication_commented_out">Example 21.12, “ProfileService AuthenticationInterceptor Commented out”</a>.
			</div><div class="example"><a id="ProfileService-Authentication_commented_out">
      ⁠</a><p class="title"><strong>Example 21.12. ProfileService AuthenticationInterceptor Commented out</strong></p><div class="example-contents"><pre class="programlisting">&lt;property name="serverProxyInterceptors"&gt;
&lt;list&gt;
&lt;!--
comment this list to disable auth checks for the profileservice
--&gt;
<span class="bold bold"><strong><strong class="userinput"><code>&lt;!--</code></strong></strong></span>
&lt;bean class="org.jboss.aspects.security.AuthenticationInterceptor"&gt;
 &lt;constructor&gt;
   &lt;parameter&gt;
     &lt;value-factory bean="JNDIBasedSecurityManagement" method="getAuthenticationManager" parameter="jmx-console"/&gt;
   &lt;/parameter&gt;
 &lt;/constructor&gt;
&lt;/bean&gt;
&lt;bean class="org.jboss.aspects.security.RoleBasedAuthorizationInterceptor"&gt;
 &lt;constructor&gt;
   &lt;parameter&gt;
     &lt;value-factory bean="JNDIBasedSecurityManagement" method="getAuthenticationManager" parameter="jmx-console"/&gt;
   &lt;/parameter&gt;
   &lt;parameter&gt;
     &lt;value-factory bean="JNDIBasedSecurityManagement" method="getAuthenticationManager" parameter="jmx-console"/&gt;
   &lt;/parameter&gt;
&lt;/constructor&gt;
&lt;/bean&gt;
<span class="bold bold"><strong><strong class="userinput"><code>--&gt;</code></strong></strong></span>
&lt;/list&gt;
&lt;/property&gt;</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139921686297616">
      ⁠</a>21.7.6. JBossWS</h2></div></div></div><div class="para">
				To disable authentication for JBossWS, comment out the <span class="markup">&lt;security-constraint&gt;</span> block in the <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/jbossws.sar/jbossws-management.war/WEB-INF/web.xml</code> file as shown in <a class="xref" href="chap-Consoles_and_Invokers.html#JBossWS-Auth_commented_out">Example 21.13, “JBossWS securite-constraint Commented out”</a>.
			</div><div class="example"><a id="JBossWS-Auth_commented_out">
      ⁠</a><p class="title"><strong>Example 21.13. JBossWS securite-constraint Commented out</strong></p><div class="example-contents"><pre class="programlisting"><span class="bold bold"><strong><strong class="userinput"><code>&lt;!--</code></strong></strong></span>
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;ContextServlet&lt;/web-resource-name&gt;
&lt;description&gt;
An example security config that only allows users with the role 'friend' to access the JBossWS console web application
&lt;/description&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;friend&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
<span class="bold bold"><strong><strong class="userinput"><code>--&gt;</code></strong></strong></span></pre></div></div></div></div></div></body></html>