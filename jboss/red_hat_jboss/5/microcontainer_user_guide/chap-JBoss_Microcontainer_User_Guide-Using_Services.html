<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 4. Using Services</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-JBoss_Microcontainer_User_Guide-Using_Services">
      ⁠</a>Chapter 4. Using Services</h1></div></div></div><div class="para">
		The previous chapter guided you through creating, configuring, testing and packaging a service. The next step is to create a client which will perform actual work using the service.
	</div><div class="para">
		The client in this example uses a <em class="firstterm">Text User Interface (TUI)</em> to accept input from the user and output results. This reduces the size and complexity of the example code.
	</div><div class="para">
		All of the necessary files are located in the <code class="filename">examples/User_Guide/gettingstarted/commandLineClient</code> directory, which follows the Maven Standard Directory Layout, as seen in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#example-UserGuide-gettingstarted-commandLineClient">Example 4.1, “Listing for <code class="filename">examples/User_Guide/gettingstarted/commandLineClient</code> Directory”</a>.
	</div><div class="example"><a id="example-UserGuide-gettingstarted-commandLineClient">
      ⁠</a><p class="title"><strong>Example 4.1. Listing for <code class="filename">examples/User_Guide/gettingstarted/commandLineClient</code> Directory</strong></p><div class="example-contents"><pre class="screen">
├── pom.xml
├── src
│   ├── main
│   │   ├── assembly
│   │   │   ├── aop.xml
│   │   │   ├── classloader.xml
│   │   │   ├── common.xml
│   │   │   └── pojo.xml
│   │   ├── config
│   │   │   ├── aop-beans.xml
│   │   │   ├── classloader-beans.xml
│   │   │   ├── pojo-beans.xml
│   │   │   └── run.sh
│   │   ├── java
│   │   │   └── org
│   │   │       └── jboss
│   │   │           └── example
│   │   │               └── client
│   │   │                   ├── Client.java
│   │   │                   ├── ConsoleInput.java
│   │   │                   ├── EmbeddedBootstrap.java
│   │   │                   └── UserInterface.java
│   │   └── resources
│   │       └── log4j.properties
│   └── test
│       ├── java
│       │   └── org
│       │       └── jboss
│       │           └── example
│       │               └── client
│       │                   ├── ClientTestCase.java
│       │                   ├── ClientTestSuite.java
│       │                   └── MockUserInterface.java
│       └── resources
│           └── jboss-beans.xml
└── target
    └── classes
        └── log4j.properties
</pre></div></div><div class="para">
		The client consists of three classes and one interface, located in the <code class="filename">org/jboss/example/client</code> directory.
	</div><div class="para">
		<code class="classname">UserInterface</code> describes methods that the client calls at run-time to request user input. <code class="classname">ConsoleInput</code> is an implementation of <code class="classname">UserInterface</code> that creates a TUI which the user uses to interact with the client. The advantage of this design is that you can easily create a Swing implementation of <code class="classname">UserInterface</code> at a later date and replace the TUI with a GUI. You can also simulate the data-entry process with a script. Then you can check the behavior of the client automatically using conventional JUnit test cases found in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Building_Services.html#example-src-test-java">Example 3.2, “Listing of the <code class="filename">src/test/java</code> Directory”</a>.
	</div><div class="para">
		For the build to work you must first build and install <code class="filename">auditAspect.jar</code> from the <code class="filename">examples/User_Guide/gettingStarted/auditAspect</code> directory using the <code class="command">mvn install command</code>. A number of different client distributions are created, including one based on AOP which relies on <code class="filename">auditAspect.jar</code> being available in the local Maven repository.
	</div><div class="para">
		If you previously typed <code class="command">mvn install</code> from the <code class="filename">examples/User_Guide/gettingStarted</code> directory then <code class="filename">humanResourcesService.jar</code> and <code class="filename">auditAspect.jar</code> have already been built and packaged, along with the client, so this step will not be necessary.
	</div><div class="para">
		To compile the source code, all of the steps in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#howto-compile-source-code">Procedure 4.1, “Compiling the Source Code”</a> are performed when you issue the <code class="command">mvn package</code> command from the <code class="filename">commandLineClient</code> directory.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="howto-compile-source-code">
      ⁠</a><p class="title"><strong>Procedure 4.1. Compiling the Source Code</strong></p><ol class="1"><li class="step"><div class="para">
				Run the unit tests.
			</div></li><li class="step"><div class="para">
				Build a client JAR.
			</div></li><li class="step"><div class="para">
				Assemble a distribution containing all of the necessary files.
			</div></li></ol></div><div class="para">
		After compiling and packaging the client, the directory structure in the <code class="filename">commandLineClient/target</code> directory includes the subdirectories described in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#example-commandLineClient-target">Example 4.2, “Subdirectories of the <code class="filename">commandLineClient/target</code> Directory”</a>.
	</div><div class="example"><a id="example-commandLineClient-target">
      ⁠</a><p class="title"><strong>Example 4.2. Subdirectories of the <code class="filename">commandLineClient/target</code> Directory</strong></p><div class="example-contents"><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">client-pojo</code></span></dt><dd><div class="para">
						used to call the service without AOP.
					</div></dd><dt><span class="term"><code class="filename">client-cl</code></span></dt><dd><div class="para">
						used to demonstrate classloading features.
					</div></dd><dt><span class="term">client-aop</span></dt><dd><div class="para">
						Adding AOP support. See <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Adding_Behavior_with_AOP.html">Chapter 5, <em>Adding Behavior with AOP</em></a> for more details.
					</div></dd></dl></div></div></div><div class="para">
		Each sub-directory represents a different distribution with all of the shell scripts, JARs, and XML deployment descriptors needed to run the client in different configurations. The rest of this chapter uses the <code class="filename">client-pojo</code> distribution found in the <code class="filename">client-pojo</code> sub-directory, which is listed in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#example-client-pojo.dir">Example 4.3, “Listing of the <code class="filename">client-pojo</code> Directory”</a>.
	</div><div class="example"><a id="example-client-pojo.dir">
      ⁠</a><p class="title"><strong>Example 4.3. Listing of the <code class="filename">client-pojo</code> Directory</strong></p><div class="example-contents"><pre class="screen">
       |-- client-1.0.0.jar
       |-- jboss-beans.xml
       |-- lib
       |   |-- concurrent-1.3.4.jar
       |   |-- humanResourcesService-1.0.0.jar
       |   |-- jboss-common-core-2.0.4.GA.jar
       |   |-- jboss-common-core-2.2.1.GA.jar
       |   |-- jboss-common-logging-log4j-2.0.4.GA.jar
       |   |-- jboss-common-logging-spi-2.0.4.GA.jar
       |   |-- jboss-container-2.0.0.Beta6.jar
       |   |-- jboss-dependency-2.0.0.Beta6.jar
       |   |-- jboss-kernel-2.0.0.Beta6.jar
       |   |-- jbossxb-2.0.0.CR4.jar
       |   |-- log4j-1.2.14.jar
       |   `-- xercesImpl-2.7.1.jar
       `-- run.sh
</pre></div></div><div class="para">
		To run the client, change to the <code class="filename">client-pojo</code> directory and type <code class="command">./run.sh</code>. The <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#example-run-sh-output">Example 4.4, “HRManager Menu Screen”</a> appears.
	</div><div class="example"><a id="example-run-sh-output">
      ⁠</a><p class="title"><strong>Example 4.4. HRManager Menu Screen</strong></p><div class="example-contents"><pre class="screen">
       Menu:

       d) Deploy Human Resources service
       u) Undeploy Human Resources service

       a) Add employee
       l) List employees
       r) Remove employee
       g) Get a salary
       s) Set a salary
       t) Toggle hiring freeze

       m) Display menu
       p) Print service status
       q) Quit
       &gt;
</pre></div></div><div class="para">
		To select an option, enter the letter shown on the left-hand side and press <span class="keycap"><strong>RETURN</strong></span>. For example to display the menu options enter <span class="keycap"><strong>m</strong></span> followed by <span class="keycap"><strong>RETURN</strong></span>. Entering more than one letter or entering an invalid option results in an error message.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			The <code class="filename">run.sh</code> script sets up the run-time environment by adding all of the JARs found in the <code class="filename">lib/</code> directory to the classpath using the <span class="property">java.ext.dirs</span> system property. It also adds the current directory and the <code class="filename">client-1.0.0.jar</code> using the <span class="property">-cp</span> flag so that the <code class="filename">jboss-beans.xml</code> deployment descriptor can be found at run-time along with the <code class="classname">org.jboss.example.client.Client</code> class which is called to start the application.
		</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_Microcontainer_User_Guide-Using_Services-Bootstrapping_the_Microcontainer">
      ⁠</a>4.1. Bootstrapping the Microcontainer</h1></div></div></div><div class="para">
			Before using the client to deploy and call your service, take a closer look at what happened during its construction:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">Client</span>(<span xmlns="" class="perl_DataType">final</span> <span xmlns="" class="perl_DataType">boolean</span> useBus) <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">useBus</span> = useBus;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ClassLoader cl = Thread.<span xmlns="" class="perl_Function">currentThread</span>().<span xmlns="" class="perl_Function">getContextClassLoader</span>();
<span xmlns="" class="line">​</span>    url = cl.<span xmlns="" class="perl_Function">getResource</span>(<span xmlns="" class="perl_String">"jboss-beans.xml"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Start JBoss Microcontainer</span>
<span xmlns="" class="line">​</span>    bootstrap = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">EmbeddedBootstrap</span>();
<span xmlns="" class="line">​</span>    bootstrap.<span xmlns="" class="perl_Function">run</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    kernel = bootstrap.<span xmlns="" class="perl_Function">getKernel</span>();
<span xmlns="" class="line">​</span>    controller = kernel.<span xmlns="" class="perl_Function">getController</span>();
<span xmlns="" class="line">​</span>    bus = kernel.<span xmlns="" class="perl_Function">getBus</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div class="para">
			First of all a URL representing the <code class="filename">jboss-beans.xml</code> deployment descriptor is created. This is later required so that the XML deployer can deploy and undeploy beans declared in the file. The <code class="methodname">getResource()</code> method of the application classloader is used because the <code class="filename">jboss-beans.xml</code> file is included on the classpath. This is optional; the name and location of the deployment descriptor are unimportant as long as the URL is valid and reachable.
		</div><div class="para">
			Next an instance of JBoss Microcontainer is created, along with an XML deployer. This process is called <em class="firstterm">bootstrapping</em> and a convenience class called <code class="classname">BasicBootstrap</code> is provided as part of the Microcontainer to allow for programmatic configuration. To add an XML deployer, extend <code class="classname">BasicBootstrap</code> to create an <code class="classname">EmbeddedBootstrap</code> class and override the protected <code class="methodname">bootstrap()</code> method as follows:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EmbeddedBootstrap <span xmlns="" class="perl_Keyword">extends</span> BasicBootstrap {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> BasicXMLDeployer deployer;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">EmbeddedBootstrap</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">super</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">bootstrap</span>() <span xmlns="" class="perl_Keyword">throws</span> Throwable {
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">bootstrap</span>();
<span xmlns="" class="line">​</span>	deployer = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">BasicXMLDeployer</span>(<span xmlns="" class="perl_Function">getKernel</span>());
<span xmlns="" class="line">​</span>	Runtime.<span xmlns="" class="perl_Function">getRuntime</span>().<span xmlns="" class="perl_Function">addShutdownHook</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Shutdown</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">deploy</span>(URL url) {
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>	deployer.<span xmlns="" class="perl_Function">deploy</span>(url);
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>	    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">undeploy</span>(URL url) {
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>	deployer.<span xmlns="" class="perl_Function">undeploy</span>(url);
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>	    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_Keyword">class</span> Shutdown <span xmlns="" class="perl_Keyword">extends</span> Thread {
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">run</span>() {
<span xmlns="" class="line">​</span>	    log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Shutting down"</span>);
<span xmlns="" class="line">​</span>	    deployer.<span xmlns="" class="perl_Function">shutdown</span>();
<span xmlns="" class="line">​</span>	}
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div class="para">
			The <code class="methodname">shutdown</code> hook ensures that when the JVM exits, all of the beans are undeployed in the correct order. The public <code class="methodname">deploy</code>/<code class="methodname">undeploy</code> methods delegate to the <code class="classname">BasicXMLDeployer</code> so that beans declared in <code class="filename">jboss-beans.xml</code> can be deployed and undeployed.
		</div><div class="para">
			Finally references to the Microcontainer controller and bus are restored, so you can look up bean references by name and access them directly or indirectly as necessary.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_Microcontainer_User_Guide-Using_Services-Deploying_the_Service">
      ⁠</a>4.2. Deploying the Service</h1></div></div></div><div class="para">
			After creating the client, you can deploy the Human Resources service. This is done by entering the <span class="keycap"><strong>d</strong></span> option from the TUI. Output indicates that the <code class="classname">BasicXMLDeployer</code> has parsed the <code class="filename">jboss-beans.xml</code> file using the URL, and instantiated the beans found within.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The Microcontainer is able to instantiate the beans because their classes are available in the extension classpath inside the <code class="filename">lib/humanResourcesService.jar</code> file. You can also place these classes in an exploded directory structure and add it to the application classpath, but packaging them in a JAR is typically more convenient.
			</div></div></div><div class="para">
			The deployment descriptor is entirely separate from the <code class="filename">humanResourcesService.jar</code> file. This enables easy editing of it for testing purposes. The <code class="filename">jboss-beans.xml</code> file in the example contains some commented-out fragments of XML which show some of the possible configurations.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">	    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0 bean-deployer_2_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">	    xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"HRService"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.example.service.HRManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- &lt;property name="hiringFreeze"&gt;true&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	 &lt;property name="salaryStrategy"&gt;&lt;inject bean="AgeBasedSalary"/&gt;&lt;/property&gt; --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- &lt;bean name="AgeBasedSalary" class="org.jboss.example.service.util.AgeBasedSalaryStrategy"&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;property name="minSalary"&gt;1000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;property name="maxSalary"&gt;80000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     &lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     &lt;bean name="LocationBasedSalary"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	   class="org.jboss.example.service.util.LocationBasedSalaryStrategy"&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;property name="minSalary"&gt;2000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;property name="maxSalary"&gt;90000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;/bean&gt; --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				Depending on how you access the service at run-time, you may need to shut down the application and restart it again to redeploy the service and see your changes. This reduces the flexibility of the application, but results in faster performance at run-time. Alternatively you may be able to simply redeploy the service while the application is running. This increases flexibility but results in slower run-time performance. Keep these trade-offs under consideration when designing your applications.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_Microcontainer_User_Guide-Using_Services-Direct_Access">
      ⁠</a>4.3. Direct Access</h1></div></div></div><div class="para">
			If no parameters are given to the <code class="filename">run.sh</code> script when the client is started, a reference to the <code class="classname">HRService</code> bean is looked up using the Microcontainer controller after the service is deployed:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> HRManager manager;
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">final</span> <span xmlns="" class="perl_DataType">static</span> String HRSERVICE = <span xmlns="" class="perl_String">"HRService"</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">deploy</span>() {
<span xmlns="" class="line">​</span>    bootstrap.<span xmlns="" class="perl_Function">deploy</span>(url);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (!useBus &amp;&amp; manager == <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>	ControllerContext context = controller.<span xmlns="" class="perl_Function">getInstalledContext</span>(HRSERVICE);
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">if</span> (context != <span xmlns="" class="perl_Keyword">null</span>) { manager = (HRManager) context.<span xmlns="" class="perl_Function">getTarget</span>(); }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div class="para">
			Rather than immediately looking up a reference to the bean instance, the example first looks up a reference to a <code class="classname">ControllerContext</code>, then obtains a reference to the bean instance from the context using the <code class="methodname">getTarget()</code> method. The bean can exist within the Microcontainer in any of the states listed in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#bean-states">States of a Bean Within the Microcontainer</a>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><a id="bean-states">
      ⁠</a><p class="title"><strong>States of a Bean Within the Microcontainer</strong></p><ul><li class="listitem"><div class="para">
					NOT_INSTALLED
				</div></li><li class="listitem"><div class="para">
					DESCRIBED
				</div></li><li class="listitem"><div class="para">
					INSTANTIATED
				</div></li><li class="listitem"><div class="para">
					CONFIGURED
				</div></li><li class="listitem"><div class="para">
					INSTALLED
				</div></li></ul></div><div class="para">
			To keep track of which state the bean is in, wrap it in another object called a <em class="wordasword">context</em> that describes the current state. The name of the context is the same as the bean name. Once a context reaches the INSTALLED state, the bean it represents is considered to be deployed.
		</div><div class="para">
			After creating a reference to the bean instance representing the service entry point, you can call methods on it to preform work:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SuppressWarnings</span>(<span xmlns="" class="perl_String">"unchecked"</span>)
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    Set&lt;Employee&gt; <span xmlns="" class="perl_Function">listEmployees</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (useBus)
<span xmlns="" class="line">​</span>	...
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">else</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">return</span> manager.<span xmlns="" class="perl_Function">getEmployees</span>();
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div class="para">
			The client is accessing the service directly since it is using a reference to the actual bean instance. Performance is good, because each method call goes directly to the bean. What happens, however, if you want to reconfigure the service and redeploy it while the application is running?
		</div><div class="para">
			Reconfiguration is achieved by making changes to the XML deployment descriptor and saving the file. In order to redeploy the service, the current instance must be undeployed. During undeployment the Microcontainer controller releases its reference to the bean instance, along with any dependent beans. These beans will subsequently become available for garbage collection because they are no longer required by the application. Redeploying the service creates new bean instances representing the new configuration. Any subsequent look-ups from clients will retrieve references to these new instances and they will be able to access the reconfigured service.
		</div><div class="para">
			The problem is that the reference to the bean instance representing our service entry point is cached when you deploy the service for the first time. Undeploying the service has no affect, since the bean instance can still be accessed using the cached reference and it will not be garbage collected until the client releases it. Along the same line, deploying the service again will not cause another look-up because the client already has a cached reference. It will therefore continue to use the bean instance representing the initial service configuration.
		</div><div class="para">
			You can test this behavior by typing <span class="keycap"><strong>u</strong></span> followed by <span class="keycap"><strong>RETURN</strong></span> to undeploy the current service. You should still be able to access the service from the client even though it is 'undeployed'. Next, make some changes to the configuration using the <code class="filename">jboss-beans.xml</code> file, save the file, and deploy it again using the <span class="keycap"><strong>d</strong></span> option. Printing out the status of the service using the <span class="keycap"><strong>p</strong></span> option shows that the client is still accessing the initial instance of the service that was deployed.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Even if you modify the client to look up a new reference each time the service is redeployed, new developers may hand out copies of this reference to other objects, by mistake. If all of these references are not cleaned up during redeployment, the same caching problem can occur.
			</div></div></div><div class="para">
			To reliably redeploy the reconfigured service, shut down the application completely using the 'q' option and restart it again using the <code class="filename">run.sh</code> script. For enterprise services such as Transactions, Messaging and Persistence this is perfectly acceptable behavior, since they are generally always in use. They cannot be redeployed at run-time and also benefit from the high performance given by using direct access. If your service falls into this category, consider using direct access via the Microcontainer controller.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_Microcontainer_User_Guide-Using_Services-Indirect_Access">
      ⁠</a>4.4. Indirect Access</h1></div></div></div><div class="para">
			The <code class="filename">run.sh</code> script can be called with an optional parameter <span class="property">bus</span>, which causes calls to the Human Resources service to use the Microcontainer bus.
		</div><div class="para">
			Instead of using a direct reference to the bean instance obtained from the Microcontainer controller, the new behavior is to call an <code class="methodname">invoke()</code> method on the bus, passing in the bean name, method name, method arguments and method types. The bus uses this information to call the bean on the client's behalf.
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">final</span> <span xmlns="" class="perl_DataType">static</span> String HRSERVICE = <span xmlns="" class="perl_String">"HRService"</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">SuppressWarnings</span>(<span xmlns="" class="perl_String">"unchecked"</span>)
<span xmlns="" class="line">​</span>	Set&lt;Employee&gt; <span xmlns="" class="perl_Function">listEmployees</span>() {
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">if</span> (useBus)
<span xmlns="" class="line">​</span>	    <span xmlns="" class="perl_Keyword">return</span> (Set&lt;Employee&gt;) <span xmlns="" class="perl_Function">invoke</span>(HRSERVICE, <span xmlns="" class="perl_String">"getEmployees"</span>, <span xmlns="" class="perl_Keyword">new</span> Object[] {}, <span xmlns="" class="perl_Keyword">new</span> String[] {});
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">else</span>
<span xmlns="" class="line">​</span>	    <span xmlns="" class="perl_Keyword">return</span> manager.<span xmlns="" class="perl_Function">getEmployees</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Object <span xmlns="" class="perl_Function">invoke</span>(String serviceName, String methodName, Object[] args, String[] types) {
<span xmlns="" class="line">​</span>    Object result = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>	result = bus.<span xmlns="" class="perl_Function">invoke</span>(serviceName, methodName, args, types);
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (Throwable t) {
<span xmlns="" class="line">​</span>	t.<span xmlns="" class="perl_Function">printStackTrace</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> result;
<span xmlns="" class="line">​</span>}</pre><div class="para">
			The bus looks up the reference to the named bean instance and calls the chosen method using reflection. The client never has a direct reference to the bean instance, so it is said to accesses the service indirectly. Since the bus does not cache the reference, you can safely make changes to the service configuration, and it can be redeployed at run-time. Subsequent calls by the client will use the new reference, as expected. The client and service have been decoupled.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				This behavior can be tested by deploying the service and using the <span class="keycap"><strong>p</strong></span> option to print out the status. Undeploy the service using the <span class="keycap"><strong>u</strong></span> option and notice that it is inaccessible. Next, make some changes to <code class="filename">jboss-beans.xml</code> file, save the changes, and deploy it again using the <span class="keycap"><strong>d</strong></span> option. Print out the status again using the <span class="keycap"><strong>p</strong></span> option. The client is accessing the new service configuration.
			</div></div></div><div class="para">
			Because the bus uses reflection to call bean instances, it is a slower than direct access. The benefit of the approach is that only the bus has references to the bean instances. When a service is redeployed, all of the existing references can be cleaned up and replaced with new ones. This way, a service can be reliably redeployed at run-time. Services that are not used very often or that are specific to certain applications are good candidates for indirect access using the Microcontainer bus. Often, the reduction in performance is outweighed by the flexibility that this provides.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_Microcontainer_User_Guide-Using_Services-Dynamic_Classloading">
      ⁠</a>4.5. Dynamic Classloading</h1></div></div></div><div class="para">
			So far you have used the extension and application classloaders to load all of the classes in the application. The application classpath is set up by the <code class="filename">run.sh</code> script using the <span class="property">-cp</span> flag to include the current directory and the <code class="filename">client-1.0.0.jar</code>, as shown here:
		</div><pre class="screen">java -Djava.ext.dirs=`pwd`/lib -cp .:client-1.0.0.jar org.jboss.example.client.Client $1
</pre><div class="para">
			For convenience the JARs in the <code class="filename">lib</code> directory were added to the extension classloader's classpath using the <span class="property">java.ext.dirs</span> system property, rather than listing the full path to each of the JARs after the -cp flag. Because the <code class="classname">classloader</code> extension is the parent of the <code class="systemitem">classloader</code> application, the client classes is able to find all of the Microcontainer classes and the Human Resources service classes at run-time.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				With Java versions 6 and higher, you can use a wild-card to include all JARs in a directory with the <span class="property">-cp</span> flag: <code class="command">java -cp `pwd`/lib/*:.:client-1.0.0.jar org.jboss.example.client.Client $1</code>
			</div><div class="para">
				Here, all of the classes in the application will be added to the application classloader's classpath, and the extension classloader's classpath will retain its default value.
			</div></div></div><div class="para">
			What happens if you need to deploy an additional service at run-time? If the new service is packaged in a JAR file, it must be visible to a classloader before any of its classes can be loaded. Because you have already set up the classpath for the application classloader (and extension classloader) on start-up, it is not easy to add the URL of the JAR. The same situation applies if the service classes are contained in a directory structure. Unless the top-level directory is located in the current directory (which is on the application classpath) then the classes will not be found by the application classloader.
		</div><div class="para">
			If you wish to redeploy an existing service, changing some of its classes, you need to work around security constraints, which forbid an existing classloader from reloading classes.
		</div><div class="para">
			The goal is to create a new classloader that knows the location of the new service's classes, or that can load new versions of an existing service's classes, in order to deploy the service's beans. JBoss Microcontainer uses the &lt;classloader&gt; element in the deployment descriptor to accomplish this.
		</div><div class="para">
			The <code class="filename">client-cl</code> distribution contains the file listed in the <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#example-client-cl">Example 4.5, “Listing of the <code class="filename">commandLineClient/target/client-cl</code> Directory”</a> .
		</div><div class="example"><a id="example-client-cl">
      ⁠</a><p class="title"><strong>Example 4.5. Listing of the <code class="filename">commandLineClient/target/client-cl</code> Directory</strong></p><div class="example-contents"><pre class="screen">
       |-- client-1.0.0.jar
       |-- jboss-beans.xml
       |-- lib
       |   |-- concurrent-1.3.4.jar
       |   |-- jboss-common-core-2.0.4.GA.jar
       |   |-- jboss-common-core-2.2.1.GA.jar
       |   |-- jboss-common-logging-log4j-2.0.4.GA.jar
       |   |-- jboss-common-logging-spi-2.0.4.GA.jar
       |   |-- jboss-container-2.0.0.Beta6.jar
       |   |-- jboss-dependency-2.0.0.Beta6.jar
       |   |-- jboss-kernel-2.0.0.Beta6.jar
       |   |-- jbossxb-2.0.0.CR4.jar
       |   |-- log4j-1.2.14.jar
       |   `-- xercesImpl-2.7.1.jar
       |-- otherLib
       |   `-- humanResourcesService-1.0.0.jar
       |`-- run.sh
</pre></div></div><div class="para">
			The <code class="filename">humanResourcesService.jar</code> file has been moved to a new sub-directory called <code class="filename">otherLib</code>. It is no longer available to either the extension or application classloaders whose classpaths are setup in the run.sh script:
		</div><pre class="screen">java -Djava.ext.dirs=`pwd`/lib -cp .:client-1.0.0.jar org.jboss.example.client.Client $1
</pre><div class="para">
			To work around this, create a new classloader during the deployment of the service, load it in the service classes, and create instances of the beans. To see how this is done, look at the contents of the <code class="filename">jboss-beans.xml</code> file:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>            
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">	    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0 bean-deployer_2_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">	    xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"URL"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.net.URL"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>file:/Users/newtonm/jbossmc/microcontainer/trunk/docs/examples/User_Guide/gettingStarted/commandLineClient/target/client-cl.dir/otherLib/humanResourcesService-1.0.0.jar<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customCL"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.net.URLClassLoader"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;array&gt;</span>
<span xmlns="" class="line">​</span>	  <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"URL"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/array&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"HRService"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.example.service.HRManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;classloader&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"customCL"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/classloader&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- &lt;property name="hiringFreeze"&gt;true&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">	 &lt;property name="salaryStrategy"&gt;&lt;inject bean="AgeBasedSalary"/&gt;&lt;/property&gt; --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- &lt;bean name="AgeBasedSalary" class="org.jboss.example.service.util.AgeBasedSalaryStrategy"&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;property name="minSalary"&gt;1000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;property name="maxSalary"&gt;80000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       &lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;bean name="LocationBasedSalary" class="org.jboss.example.service.util.LocationBasedSalaryStrategy"&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;property name="minSalary"&gt;2000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;property name="maxSalary"&gt;90000&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;/bean&gt; --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					First, create an instance of <code class="classname">java.net.URL</code> called <code class="classname">URL</code>, using parameter injection in the constructor to specify the location of the <code class="filename">humanResourcesService.jar</code> file on the local file-system.
				</div></li><li class="step"><div class="para">
					Next, create an instance of a <code class="classname">URLClassLoader</code> by injecting the URL bean into the constructor as the only element in an array.
				</div></li><li class="step"><div class="para">
					Include a &lt;classloader&gt; element in your <code class="classname">HRService</code> bean definition and inject the <code class="classname">customCL</code> bean. This specifies that the <code class="classname">HRManager</code> class needs to be loaded by the customCL classloader.
				</div></li></ol></div><div class="para">
			You need a way to decide which classloader to use for the other beans in the deployment. All beans in the deployment use the current thread's context classloader. In this case the thread that handles deployment is the main thread of the application which has its context classloader set to the application classloader on start-up. If you wish, you can specify a different classloader for the entire deployment using a &lt;classloader&gt; element, as shown in <a class="xref" href="chap-JBoss_Microcontainer_User_Guide-Using_Services.html#example-specifying-a-different-classloader">Example 4.6, “Specifying a Different Classloader”</a>.
		</div><div class="example"><a id="example-specifying-a-different-classloader">
      ⁠</a><p class="title"><strong>Example 4.6. Specifying a Different Classloader</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>            
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">	    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0 bean-deployer_2_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">	    xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;classloader&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"customCL"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/classloader&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"URL"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.net.URL"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>file:/Users/newtonm/jbossmc/microcontainer/trunk/docs/examples/User_Guide/gettingStarted/commandLineClient/target/client-cl.dir/otherLib/humanResourcesService-1.0.0.jar<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customCL"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.net.URLClassLoader"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;array&gt;</span>
<span xmlns="" class="line">​</span>	  <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"URL"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Keyword">&lt;/array&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>
</pre></div></div><div class="para">
			This would be necessary to allow for reconfiguration of the service by uncommenting the <code class="classname">AgeBasedSalary</code> or <code class="classname">LocationBasedSalary</code> beans. Classloaders specified at the bean level override the deployment level classloader. To override the deployment level classloader altogether, and use the default classloader for a bean, use the &lt;null/&gt; value as follows:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"HRService"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.example.service.HRManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;classloader&gt;&lt;null/&gt;&lt;/classloader&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>		
<span xmlns="" class="line">​</span>
</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139732993383104">
      ⁠</a>4.5.1. Problems With Classloaders Created with Deployment Descriptors</h2></div></div></div><div class="para">
				If you create a new classloader for your service using the deployment descriptor, you may not be able to access classes loaded by it from the application classloader. In the HRManager example, the client is no longer able to cache a direct reference to the bean instance when using the Microcontainer controller.
			</div><div class="para">
				To see this behavior, start the client using the <code class="filename">run.sh</code> command, then try to deploy the service. A <code class="systemitem">java.lang.NoClassDefFoundError</code> exception is thrown and the application exits.
			</div><div class="para">
				In this scenario, you must use the bus to access the service indirectly and provide access to any classes shared by the client in the application classpath. In this example, the affected classes are <code class="classname">Address</code>, <code class="classname">Employee</code>, and <code class="classname">SalaryStrategy</code>.
			</div></div></div></div></body></html>