<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 33. Securing JAX-RS and RESTeasy</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Securing_JAX-RS_and_RESTeasy">
      ⁠</a>Chapter 33. Securing JAX-RS and RESTeasy</h1></div></div></div><div class="para">
		Because RESTEasy is deployed as a Servlet, you must use standard <code class="filename">web.xml</code> constraints to enable authentication and authorization.
	</div><div class="para">
		Unfortunately, <code class="filename">web.xml</code> constraints have limited compatibility with JAX-RS because of the limited URL pattern matching available in <code class="filename">web.xml</code>. URL patterns in <code class="filename">web.xml</code> support only simple wildcards, so JAX-RS resources like the following:
	</div><pre class="programlisting">/{pathparam1}/foo/bar/{pathparam2}</pre><div class="para">
		Cannot be mapped as a <code class="filename">web.xml</code> URL pattern such as:
	</div><pre class="programlisting">/*/foo/bar/*</pre><div class="para">
		To work around this problem, use the following security annotations on your JAX-RS methods. You must also set up some general security constraint elements in <code class="filename">web.xml</code> to enable authentication.
	</div><div class="para">
		RESTEasy JAX-RS supports the <code class="literal">@RolesAllowed</code>, <code class="literal">@PermitAll</code> and <code class="literal">@DenyAll</code> annotations on JAX-RS methods. By default, RESTEasy does not recognize these annotations. You must configure RESTEasy to enable role-based security by setting a context parameter, like so:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Do not enable this if you are using EJBs. The EJB container will provide this function instead of RESTEasy.
		</div></div></div><pre class="programlisting">
&lt;web-app&gt;
...
   &lt;context-param&gt;
      &lt;context-name&gt;resteasy.role.based.security&lt;/context-name&gt;
      &lt;context-value&gt;true&lt;/context-value&gt;
   &lt;/context-param&gt;
&lt;/web-app&gt;
</pre><div class="para">
		With this approach, you must declare all roles used within both the RESTEasy JAX-RS <code class="filename">WAR</code> file, and in your JAX-RS classes, and establish a security constraint that lets these roles access every URL handled by the JAX-RS runtime, assuming that RESTEasy authorizes correctly.
	</div><div class="para">
		RESTEasy authorization checks if a method is annotated with <code class="literal">@RolesAllowed</code> and then performs <code class="literal">HttpServletRequest.isUserInRole</code>. If one of the the <code class="literal">@RolesAllowed</code> passes, the request is allowed. If not, a response is returned with a <code class="literal">401</code> (Unauthorized) response code.
	</div><div class="para">
		The following is an example of a modified RESTEasy WAR file. Note that every role declared is allowed access to every URL controlled by the RESTEasy Servlet.
	</div><pre class="programlisting">

&lt;web-app&gt;

   &lt;context-param&gt;
      &lt;context-name&gt;resteasy.role.based.security&lt;/context-name&gt;
      &lt;context-value&gt;true&lt;/context-value&gt;
   &lt;/context-param&gt;

   &lt;listener&gt;
      &lt;listener-class&gt;org.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt;
   &lt;/listener&gt;

   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;

   &lt;security-constraint&gt;
      &lt;web-resource-collection&gt;
         &lt;web-resource-name&gt;Resteasy&lt;/web-resource-name&gt;
         &lt;url-pattern&gt;/security&lt;/url-pattern&gt;
      &lt;/web-resource-collection&gt;
       &lt;auth-constraint&gt;
         &lt;role-name&gt;admin&lt;/role-name&gt;
         &lt;role-name&gt;user&lt;/role-name&gt;
      &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

   &lt;login-config&gt;
      &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
      &lt;realm-name&gt;Test&lt;/realm-name&gt;
   &lt;/login-config&gt;

   &lt;security-role&gt;
      &lt;role-name&gt;admin&lt;/role-name&gt;
   &lt;/security-role&gt;
   &lt;security-role&gt;
      &lt;role-name&gt;user&lt;/role-name&gt;
   &lt;/security-role&gt;


&lt;/web-app&gt;


</pre></div></body></html>