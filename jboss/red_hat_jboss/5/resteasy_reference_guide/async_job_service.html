<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 30. Asynchronous Job Service</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="async_job_service">
      ⁠</a>Chapter 30. Asynchronous Job Service</h1></div></div></div><div class="para">
		The RESTEasy Asynchronous Job Service is an implementation of the Asynchronous Job pattern defined in O'Reilly's <em class="citetitle">Restful Web Services</em>. It is designed to add asynchronicity to a synchronous protocol.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="async_job">
      ⁠</a>30.1. Using Async Jobs</h1></div></div></div><div class="para">
			While HTTP is a synchronous protocol, it is capable of dealing with asynchronous invocations. The HTTP 1.1 response code <code class="literal">202</code> (Accepted) means that the server has received and accepted the response for processing, but that processing is not yet complete. The RESTEasy Asynchronous Job Service is based on this type of response.
		</div><pre class="programlisting">
POST http://example.com/myservice?asynch=true
</pre><div class="para">
			For example, if you make the above post with the <code class="literal">asynch</code> query parameter set to <code class="literal">true</code>, RESTEasy returns a <code class="literal">202</code> (Accepted) response code and runs the invocation in the background. It also returns a Location header with a URL pointing to the location of the background method's response.
		</div><pre class="programlisting">
HTTP/1.1 202 Accepted
Location: http://example.com/asynch/jobs/3332334
</pre><div class="para">
			The URI will have the form of:
		</div><pre class="programlisting">
/asynch/jobs/{job-id}?wait={millisconds}|nowait=true
</pre><div class="para">
			You can perform <code class="literal">GET</code>, <code class="literal">POST</code> and <code class="literal">DELETE</code> operations on this job URL. <code class="literal">GET</code> returns the response of the JAX-RS resource method, if the job has completed. If the job has not completed, this <code class="literal">GET</code> returns a response code of <code class="literal">202</code> (Accepted). Invoking <code class="literal">GET</code> does not remove the job, so it can be called multiple times. When RESTEasy's job queue becomes full, it will evict the least recently used job from memory. You can clean the queue manually by calling <code class="literal">DELETE</code> on the URI. <code class="literal">POST</code> reads the <code class="literal">JOB</code> response and removes the <code class="literal">JOB</code> when it has completed.
		</div><div class="para">
			Both <code class="literal">GET</code> and <code class="literal">POST</code> let you specify a maximum wait time in milliseconds — a <code class="literal">wait</code> query parameter. For example:
		</div><pre class="programlisting">
POST http://example.com/asynch/jobs/122?wait=3000
</pre><div class="para">
			If you do not specify a <code class="literal">wait</code> parameter, the <code class="literal">GET</code> or <code class="literal">POST</code> will not wait at all if the job is not complete.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				While you can invoke <code class="literal">GET</code>, <code class="literal">DELETE</code>, and <code class="literal">PUT</code> methods asynchronously, this breaks the HTTP 1.1 contract of these methods. These invocations may not change the state of the resource if invoked more than once, but they do change the state of the server. Try to invoke POST methods asynchronously.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Security in the Asynchronous Job Service</strong></p></div><div class="admonition"><div class="para">
				RESTEasy role-based security (annotations) does not work with the Asynchronous Job Service. <span class="emphasis"><em>You must use XML declarative security within your <code class="filename">web.xml</code> file.</em></span> It is currently impossible to implement role-based security portably. In the future, we may have specific JBoss integration, but will not support other environments.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="oneway">
      ⁠</a>30.2. Oneway: Fire and Forget</h1></div></div></div><div class="para">
			RESTEasy also supports the notion of <span class="emphasis"><em>fire and forget</em></span>. This returns a <code class="literal">202</code> (Accepted) response, but no Job is created. Use the <code class="literal">oneway</code> query parameter instead of <code class="literal">asynch</code>, like so:
		</div><pre class="programlisting">
POST http://example.com/myservice?oneway=true
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Security in the Asynchronous Job Service</strong></p></div><div class="admonition"><div class="para">
				RESTEasy role-based security (annotations) does not work with the Asynchronous Job Service. <span class="emphasis"><em>You must use XML declarative security within your <code class="filename">web.xml</code> file.</em></span> It is currently impossible to implement role-based security portably. In the future, we may have specific JBoss integration, but will not support other environments.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="async_job_setup">
      ⁠</a>30.3. Setup and Configuration</h1></div></div></div><div class="para">
			The Asynchronous Job Service is not enabled by default, so you will need to enable it in your <code class="filename">web.xml</code>:
		</div><pre class="programlisting">
&lt;web-app&gt;
    &lt;!-- enable the Asynchronous Job Service --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.enabled&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- The next context parameters are all optional.  
         Their default values are shown as example param-values --&gt;

    &lt;!-- How many jobs results can be held in memory at once? --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.job.results&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- Maximum wait time on a job when a client is querying for it --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.wait&lt;/param-name&gt;
        &lt;param-value&gt;300000&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- Thread pool size of background threads that run the job --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.thread.pool.size&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- Set the base path for the Job uris --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.base.path&lt;/param-name&gt;
        &lt;param-value&gt;/asynch/jobs&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;
            org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
</pre></div></div></body></html>