<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 2. JBoss Cache: Core</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="TreeCache">
      ⁠</a>Chapter 2. JBoss Cache: Core</h1></div></div></div><div class="qandaset"><a id="idm139890456030576">
      ⁠</a><div xmlns:d="http://docbook.org/ns/docbook" class="qandaset"><div class="qandaentry"><div class="question"><a id="idm139890480252736">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I run multiple JBoss Cache instances on the same VM?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. There are some scenarios where you may want to run multiple instances of JBoss Cache. For example, you want to run multiple local cache instances with each instance having its own configuration (e.g., different cache policy). In this case, you will need multiple xml configuration files.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890499387856">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can JBoss Cache run as a second level cache inside Hibernate?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. Since Hibernate 3.0 release, you can configure it to use JBoss Cache as a second level cache. For details, see Hibernate documentation, and also see <a href="http://www.jboss.org/community/docs/DOC-10265">this wiki page</a>.
				</div><div class="para">
					JBoss Cache 3.x with MVCC in particular works very well as a Hibernate second level cache.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890511138768">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					What about using POJO Cache as a Hibernate cache?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					It is not necessary to use POJO Cache for second level cache inside Hibernate because Hibernate manages fine-grained fields in Java objects. Using POJO Cache will not provide any advantage, and will be an unnecessary performance drawback.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890499399904">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How can I configure JBoss Cache?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					You can configure the JBoss Cache through a configuration XML file or programmatically using a <code class="literal">org.jboss.cache.config.Configuration</code> object, passed in to the <code class="literal">org.jboss.cache.CacheFactory</code> instance.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890458599184">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I use a schema or DTD to validate my JBoss Cache configuration file?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					As of JBoss Cache 3.x, yes. An XSD schema is provided in your jbosscache-core.jar file, and is also available online, on <a href="http://www.jboss.org/jbosscache/jbosscache-config-3.0.xsd">http://www.jboss.org/jbosscache/jbosscache-config-3.0.xsd</a>. You can configure your IDE, text editor or XML authoring tool to use this schema to validate your file.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890503555888">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					What is the difference between the different cache modes?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					JBossCache has five different cache modes, i.e., <code class="literal">LOCAL</code>, <code class="literal">REPL_SYNC</code>, <code class="literal">REPL_ASYNC</code>, <code class="literal">INVALIDATION_SYNC</code> and <code class="literal">INVALIDATION_ASYNC</code>. If you want to run JBoss Cache as a single instance, then you should set the cache mode to <code class="literal">LOCAL</code> so that it will not attempt to replicate anything. If you want to have synchronous replication among different JBoss Cache instances, you set it to <code class="literal">REPL_SYNC</code>. For asynchronous replication, use <code class="literal">AYSNC_REPL</code>. If you do not wish to replicate cached data but simply inform other caches in a cluster that data under specific addresses are now stale and should be evicted from memory, use <code class="literal">INVALIDATION_SYNC</code> or <code class="literal">INVALIDATION_ASYNC</code>. Synchronous and asynchronous behavior applies to invalidation as well as replication.
				</div><div class="para">
					Note that <code class="literal">REPL_ASYNC</code> and <code class="literal">INVALIDATION_ASYNC</code> are non-blocking. This can be useful when you want to have another JBoss Cache serving as a mirror or backup and you do not want to wait for confirmation that this mirror has received your messages.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890457995440">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How does JBoss Cache's replication mechanism work?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					JBoss Cache leverages <a href="http://www.jgroups.org">JGroups</a> for network communications. A JGroups configuration section is present in your JBoss Cache configuration.
				</div><div class="para">
					A user can configure the cluster of JBoss Cache instances by sharing the same cluster name (<code class="literal">cluster name</code>). There is also an option of whether to populate the cache data upon starting a new instance in the <code class="literal">ClusterConfig</code> attribute.
				</div><div class="para">
					Note that once all instances join the same replication group, every replication change is propagated to all participating members. There is no mechanism for sub-partitioning where some replication can be done within only a subset of members, unless you use the Buddy Replication features. See the <em class="citetitle">JBoss Cache User Guide</em> for more details on this.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890455327440">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					I run a 2-node cluster. If the network dies, do the caches continue to run?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, both will continue to run, but depending on your replication mode, all transactions or operations may not complete. If <code class="literal">REPL_SYNC</code> is used, operations will fail while if <code class="literal">REPL_ASYNC</code> is used they will succeed. Even if they succeed though, caches will be out of sync.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890455324064">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I plug in library X instead of JGroups to handle remote calls and group communications?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					At this stage the answer is no. We do have an abstraction layer between the communication suite and JBoss Cache in the pipelines, and this may appear as a feature at some stage in the future.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454584400">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does the cache need to replicate to every other instance in the cluster? Is not this slow if the cluster is large?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Replication need not occur to every node in the cluster. This feature - called Buddy Replication - allows each node to pick one or more 'buddies' in the cluster and only replicate to its buddies. This allows a cluster to scale very easily with no extra impact on memory or network traffic with each node added.
				</div><div class="para">
					See the Users' Guide for more information on Buddy Replication, and how it can be used to achieve very high scalability.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454580992">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					I'm using Buddy Replication. Do I need to have some form of session affinity?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Session affinity relates to returning to the same cache instance for the same data being used. While this is strictly not a requirement for Buddy Replication, it is greatly recommended to minimize moving state around a cluster.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454578400">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					If I have the need for different configuration properties (e.g., <code class="literal">CacheMode</code> and <code class="literal">IsolationLevel</code>), do I simply need to create multiple <code class="literal">org.jboss.cache.Cache</code> instances with the appropriate configuration?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. All the above mentioned properties are per cache instance. Therefore you will need separate <code class="literal">org.jboss.cache.Cache</code> instances.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454618032">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Is not this expensive from a networking standpoint, i.e., needing to create sockets for each <code class="literal">org.jboss.cache.Cache</code> instance?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, it can be. For such cases it is recommended that you configure your cache using the JGroups Multiplexer, which allows several caches to share a single JGroups channel. Please see the Users' Guide for details on how to configure the JGroups Multiplexer.
				</div><div class="para">
					A faster and more efficient approach is to use a shared transport in JGroups. Please see <a href="http://www.jgroups.org">the JGroups documentation</a> for more details on how to do this.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454613872">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does the <code class="literal">ClusterName</code> configuration element have any relation to the EAP cluster <code class="literal">PartitionName</code>?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. They are both JGroups group names. Besides the notion of a channel in JGroups, it also can partition the channel into different group names.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454610320">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					When using multiple JGroups based components (<code class="filename">cluster-service.xml</code>, cache [multiple instances]), what is the correct/valid way to configure those components to make sure my multicast addresses do not conflict?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					There are two parameters to consider: multicast address (plus port) and the group name. At minimum, you will have to run components using a different group name. But whether to run them on the same channel depends upon whether the communication performance is critical for you or not. If it is, then it'd be best to run them on different channels.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890454607008">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache support cache persistence storage?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. JBoss Cache has a cache loader interface that supports cache persistence. See below for more FAQs on cache loaders.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890452524912">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache support cache passivation/overflow to a data store?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. JBoss Cache uses the cache loader to support cache passivation/ overflow. See documentation on how to configure and use this feature.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890452522416">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Is JBoss Cache thread safe?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, it is thread safe.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890452520080">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache support XA (2PC) transactions now?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					No, although it is also on our to do list. Our internal implementation does use a procedure similar to 2PC to coordinate a transactions among different instances, but JBoss Cache is not an XA resource.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890452517440">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Which transaction managers are supported by JBoss Cache?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					JBoss Cache supports any TransactionManager that is <a href="http://java.sun.com/products/jta/">JTA</a> compliant such as <a href="http://www.jboss.org/jbosstm/">JBoss Transactions</a>.
				</div><div class="para">
					While JBoss Cache does ships with a dummy transaction manager (<code class="literal">org.jboss.cache.transaction.DummyTransactionManager</code>), we do <span class="emphasis"><em>not</em></span> recommend using this for production. It is not thread safe, and is intended for internal testing only.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890452512112">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How do I set up the cache to be transactional?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					You either use the default transaction manager that ships with EAP or you have to implement the <code class="literal">org.jboss.cache.transaction.TransactionManagerLookup</code> interface, and return an instance of your <code class="literal">javax.transaction.TransactionManager</code> implementation. The configuration property <code class="literal">TransactionManagerLookupClass</code> defines the class to be used by the cache to fetch a reference to a transaction manager. It is trivial to implement this interface to support other transaction managers. Once this attribute is specified, the cache will look up the transaction context from this transaction manager.
				</div><div class="para">
					The <code class="literal">org.jboss.cache.transaction.GenericTransactionManagerLookup</code> class that ships with JBoss Cache is able to detect and bind to most popular transaction managers. See the <code class="literal">GenericTransactionManagerLookup</code> Javadocs for more information.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509527504">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How do I control the Cache locking level?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					JBoss Cache lets you control the cache locking level through the transaction isolation level. This is configured through the attribute <code class="literal">IsolationLevel</code>. The transaction isolation levels correspond to database isolation levels, namely <code class="literal">NONE</code>, <code class="literal">READ_UNCOMMITTED</code>, <code class="literal">READ_COMMITTED</code>, <code class="literal">REPEATABLE_READ</code>, and <code class="literal">SERIALIZABLE</code>. Note that these isolation levels are ignored if optimistic locking is used. For details, please refer to the <em class="citetitle">JBoss Cache User Guide</em>.
				</div><div class="para">
					As of JBoss Cache 3.x, when using the MVCC locking scheme, only <code class="literal">READ_COMMITTED</code> and <code class="literal">REPEATABLE_READ</code> are supported. Any other isolation level provided will either be upgraded or downgraded accordingly.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509520000">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How does JBoss Cache lock data for concurrent access?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					In JBoss Cache 2.x, by default pessimistic locking is used to lock data nodes, based on the isolation level configured. We also offer optimistic locking to allow for greater concurrency at the cost of slight processing overhead and performance. See the documentation for a more detailed discussion on concurrency and locking in JBoss Cache.
				</div><div class="para">
					In JBoss Cache 3.x, optimistic and pessimistic locking are deprecated in favor of MVCC (multi-version concurrency control), which is far more efficient than either optimistic or pessimistic locking. For a detailed discussion on our MVCC implementation, see <a href="http://jbosscache.blogspot.com/2008/07/mvcc-has-landed.html">this blog entry</a> and <a href="http://www.jboss.org/community/docs/DOC-10272">this wiki page</a>.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509515136">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How do I enable Optimistic Locking or MVCC in JBoss Cache?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Please see the configuration section of the <em class="citetitle">JBoss Cache User Guide</em> for details.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509512240">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I use the cache locking level even without a transaction context?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. JBoss Cache controls the individual node locking behavior through the isolation level semantics. This means even if you do not use a transaction, you can specify the lock level via isolation level. You can think of the node locking behavior outside of a transaction as if it is under transaction with <code class="literal">auto_commit</code> on.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509509088">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache support <code class="literal">SELECT FOR UPDATE</code> semantics?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, but this is only possible if you are running within a JTA transaction <span class="emphasis"><em>and</em></span> are using either <code class="literal">MVCC</code> or <code class="literal">PESSIMISTIC</code> as your node locking scheme.
				</div><div class="para">
					To achieve <code class="literal">SELECT FOR UPDATE</code> semantics, simply do:
				</div><pre class="programlisting JAVA">
// start transaction ... 

cache.getInvocationContext().getOptionOverrides().setForceWriteLock(true);
Node n = cache.get("/a/b/c"); // this acquires a WRITE LOCK on this node
    ...
    ...

// end transaction
</pre></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509503072">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					With replication (<code class="literal">REPL_SYNC</code>/<code class="literal">REPL_ASYNC</code>) or invalidation (<code class="literal">INVALIDATION_SYNC</code>/<code class="literal">INVALIDATION_ASYNC</code>), how often does the cache broadcast messages over the network?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					If the updates are under transaction, then the broadcasts happen only when the transaction is about to commit (actually during the prepare stage internally). That is, it will be a batch update. However, if the operations are not under transaction context, then each update will trigger replication. Note that this has performance implications if network latency is a problem.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509498368">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How can I do a mass removal?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					If you do a <code class="literal">cache.removeNode("/myroot")</code>, it will recursively remove all the entries under "/myroot".
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509495504">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I monitor and manage the JBoss Cache?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, using a JMX console such as the one shipped with EAP or JDK 5's <code class="literal">jconsole</code> utility. See the chapter titled <span class="bold bold"><strong>Management Information</strong></span> in the <em class="citetitle">JBoss Cache User Guide</em> for more details.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509491568">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					JBoss Cache uses a "<code class="literal">:</code>" character in its object name. This causes problems with my MBean server. What can I do about it?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					This is something we have seen with some MBean servers. By default, JBoss Cache uses <code class="literal">jboss.cache:service=JBossCache</code> as a prefix to all objects it binds in JMX. To work around this, use the <code class="code">-Djbosscache.jmx.prefix</code> JVM parameter to pass in an alternate prefix.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509487920">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I disable JBoss Cache management attributes?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, you can. See the section on configuration in the <em class="citetitle">JBoss Cache User Guide</em>.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509484944">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					What happened to jboss-serialization.jar?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					As of JBoss Cache 2.0.0, the dependency on JBoss Serialization has been dropped since most of the benefits of JBoss Serialization are available in updated Java 5 VMs. Since JBoss Cache 2.0.0 is baselined on Java 5, there was no need to provide these benefits separately.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509482304">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache support partitioning?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Not right now. JBoss Cache does not support partitioning that a user can configure to have different set of data residing on different cache instances while still participating as a replication group.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509479744">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache handle the concept of application classloading inside, say, a Java EE container?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Application-specific classloading is used widely inside a Java EE container. For example, a web application may require a new classloader to scope a specific version of the user library. However, by default JBoss Cache is agnostic to the classloader. In general, this leads to two kinds of problems:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							Object instance is stored in cache1 and replicated to cache2. As a result, the instance in cache2 is created by the system classloader. The replication may fail if the system classloader on cache2 does not have access to the required class. Even if replication does not fail, a user thread in cache2 may not be able to access the object if the user thread is expecting a type defined by the application classloader.
						</div></li><li class="listitem"><div class="para">
							Object instance is created by thread 1 and will be accessed by thread 2 (with two different classloaders). JBoss Cache has no notion of the different classloaders involved. As a result, you will have a <code class="literal">ClassCastException</code>. This is a standard problem in passing an object from one application space to another; JBoss Cache just adds a level of indirection in passing the object.
						</div></li></ul></div><div class="para">
					To solve the first kind of issue JBoss Cache uses a <code class="literal">CacheMarshaller</code>. Basically, this allows application code to register a classloader with a portion of the cache tree for use in handling objects replicated to that portion. See the <code class="literal">CacheMarshaller</code> section of the <em class="citetitle">JBoss Cache User Guide</em> for more details.
				</div><div class="para">
					To solve the second kind of issue, you can use the <code class="literal">UseLazyDeserialization</code> configuration option in JBoss Cache, which wraps your objects in a <code class="literal">Marshalledvalue</code> wrapper. The <code class="literal">MarshalledValue</code> serializes and deserializes your object on demand, ensuring the proper thread local context class loader is used each time.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509469088">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does JBoss Cache currently support pre-event and post-event notification?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. A boolean is passed in to each notification callback identifying whether the callback is before or after the event. See the <code class="literal">org.jboss.cache.notifications.annotations.CacheListener</code> annotation for details.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890509466192">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					How do I implement a custom listener to listen to cache events?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					See the <em class="citetitle">JBoss Cache User Guide</em> on this subject.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890455224464">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I use the <code class="literal">UseRegionBasedMarshalling</code> attribute in JBoss Cache in order to get around ClassCastExceptions happening when accessing data in the cache that has just been redeployed?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes, you can. Originally, cache Marshaling was designed as a workaround for those replicated caches that upon state transfer did not have access to the classloaders defining the objects in the cache.
				</div><div class="para">
					On each deployment, JBoss creates a new classloader per the top level deployment artifact, for example an EAR. You also have to bear in mind that a class in an application server is defined not only by the class name but also its classloader. So, assuming that the cache is not deployed as part of your deployment, you could deploy an application and put instances of classes belonging to this deployment inside the cache. If you did a redeployment and try to do a get operation of the data previously put, this would result in a ClassCastException. This is because even though the class names are the same, the class definitions are not. The current classloader is different to the one when the classes were originally put.
				</div><div class="para">
					By enabling Marshaling, you can control the life cycle of the data in the cache and if on undeployment, you deactivate the region and unregister the classloader that you'd have registered on deployment, you'd evict the data in the cache locally. That means that in the next deployment, the data will not be in the cache, therefore avoiding the problem. Obviously, using Marshaling to get around this problem is only recommended when you have some kind of persistence backing where the data survives, for example using CacheLoaders, or when JBoss Cache is used as a second level cache in a persistence framework.
				</div><div class="para">
					To implement this feature, please follow the instructions indicated in the example located in the CacheMarshaller section of the Users' Guide. It's worth noting that instead of a <code class="literal">ServletContextListener</code>, you could add this code into an <code class="literal">MBean</code> that contained life cycle methods, such as <code class="literal">start()</code> and <code class="literal">stop()</code>. The key would be for this MBean to depend on the target cache, so that it can operate as long as the cache is up and running.
				</div></div></div></div></div></div></div></body></html>