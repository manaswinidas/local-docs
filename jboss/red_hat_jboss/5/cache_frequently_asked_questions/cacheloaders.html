<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 4. Cache Loaders</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="cacheloaders">
      ⁠</a>Chapter 4. Cache Loaders</h1></div></div></div><div class="qandaset"><a id="idm139890510974976">
      ⁠</a><div xmlns:d="http://docbook.org/ns/docbook" class="qandaset"><div class="qandaentry"><div class="question"><a id="idm139890513348016">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					What is a cache loader?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					A cache loader is the connection of JBoss Cache to a (persistent) data store. The cache loader is called by JBoss Cache to fetch data from a store when that data is not in the cache, and when modifications are made to data in the cache the Cache Loader is called to store those modifications back to the store.
				</div><div class="para">
					In conjunction with eviction policies, JBoss Cache with a cache loader allows a user to maintain a bounded cache for a large back end datastore. Frequently used data is fetched from the datastore into the cache, and the least used data is evicted, in order to provide fast access to frequently accessed data. This is all configured through XML, and the programmer does not have to take care of loading and eviction.
				</div><div class="para">
					JBoss Cache currently ships with several cache loader implementations, including:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="literal">org.jboss.cache.loader.FileCacheLoader</code>: this implementation uses the file system to store and retrieve data. JBoss Cache nodes are mapped to directories, subnodes to subdirectories, etc. Attributes of a node are mapped to a data file inside the directory.
						</div></li><li class="listitem"><div class="para">
							<code class="literal">org.jboss.cache.loader.jdbm.JdbmCacheLoader</code>: this implementation is based on <a href="http://jdbm.sourceforge.net/">JDBM</a>, an open source file-based transactional persistence engine.
						</div></li><li class="listitem"><div class="para">
							<code class="literal">org.jboss.cache.loader.bdbje.BdbjeCacheLoader</code>: this implementation is based on Oracle's Berkeley DB Java Edition database, a fast and efficient transactional database. It uses a single file for the entire store. Note that if you use the Berkeley DB cache loader with JBoss Cache and wish to ship your product, you will have to acquire a <a href="http://www.sleepycat.com/jeforjbosscache">commercial license from Oracle</a>.
						</div></li><li class="listitem"><div class="para">
							<code class="literal">org.jboss.cache.loader.JDBCCacheLoader</code>: this implementation uses the relational database as the persistent storage.
						</div></li><li class="listitem"><div class="para">
							And more. See the chapter on cache loaders in the <em class="citetitle">JBoss Cache User Guide</em> for more details.
						</div></li></ul></div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890504893328">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Is the FileCacheLoader recommended for production use?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					No, it is not. The FileCacheLoader has some severe limitations which restrict its use in a production environment, or if used in such an environment, it should be used with due care and sufficient understanding of these limitations.
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							Due to the way the FileCacheLoader represents a tree structure on disk (directories and files) traversal is inefficient for deep trees.
						</div></li><li class="listitem"><div class="para">
							Usage on shared file systems like NFS, Windows shares, etc. should be avoided as these do not implement proper file locking and can cause data corruption.
						</div></li><li class="listitem"><div class="para">
							Usage with an isolation level of NONE can cause corrupt writes as multiple threads attempt to write to the same file.
						</div></li><li class="listitem"><div class="para">
							File systems are inherently not transactional, so when attempting to use your cache in a transactional context, failures when writing to the file (which happens during the commit phase) cannot be recovered.
						</div></li></ul></div><div class="para">
					As a rule of thumb, it is recommended that the FileCacheLoader not be used in a highly concurrent, transactional or stressful environment, and its use is restricted to testing.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890462247488">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can writing to cache loaders be asynchronous?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. Set the <code class="varname">async</code> attribute to true. See the JBoss Cache Users' Guide for a more detailed discussion. By default though, all cache loader writes are synchronous and will block.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890480125872">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I write my own cache loader?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. A cache loader is a class implementing <code class="literal">org.jboss.cache.loader.CacheLoader</code> or extending <code class="literal">org.jboss.cache.loader.AbstractCacheLoader</code>. It is configured via the XML file (see <em class="citetitle">JBoss Cache User Guide</em>).
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890480122192">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Does a cache loader have to use a persistent store?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					No. A cache loader could, for example, fetch (and possibly store) its data from a webdav-capable webserver. Another example is a caching proxy server, which fetches contents from the web. Note that an implementation of CacheLoader may not implement the 'store' functionality in this case, but just the 'load' functionality.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890516061744">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I use more than one cache loader?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. Within the CacheLoaderConfiguration XML element (see the <em class="citetitle">JBoss Cache User Guide</em> chapter on cache loaders) you can describe several cache loaders. The impact is that the cache will look at all of the cache loaders in the order they've been configured, until it finds a valid, non-null element of data. When performing writes, all cache loaders are written to (except if the ignoreModifications element has been set to true for a specific cache loader).
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890516058480">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Can I migrate a JDBCacheLoader or FileCacheLoader based cache store containing data formatted with JBoss Cache 1.x.x to JBoss Cache 2.0 format?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					Yes. See the "Transforming Cache Loaders" section within the "Cache Loaders" section located in the <em class="citetitle">JBoss Cache User Guide</em>.
				</div></div></div></div><div class="qandaentry"><div class="question"><a id="idm139890462362784">
      ⁠</a><div class="label">Q:</div><div class="data"><div class="para">
					Is the TCPDelegatingCacheLoader resilient to TCPCacheServer restarts?
				</div></div></div><div class="answer"><div class="label">A:</div><div class="data"><div class="para">
					As of JBoss Cache 2.1.0, the answer is yes. See the <em class="citetitle">JBoss Cache User Guide</em> for details on how to configure and tune your retries and wait period for reestablishing the TCP connection.
				</div><div class="para">
					Prior to that, restarting the TCPCacheServer would also mean restarting your application that uses the cache.
				</div></div></div></div></div></div></div></body></html>