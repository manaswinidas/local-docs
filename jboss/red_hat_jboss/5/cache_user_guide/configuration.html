<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 3. Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuration">
      ⁠</a>Chapter 3. Configuration</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140486282820080">
      ⁠</a>3.1. Configuration Overview</h1></div></div></div><div class="para">
			The <code class="literal">org.jboss.cache.config.Configuration</code> class (along with its <a class="xref" href="configuration.html#configuration.elements">Section 3.3, “Composition of a <code class="literal">Configuration</code> Object ”</a>) is a Java Bean that encapsulates the configuration of the <code class="literal">Cache</code> and all of its architectural elements (cache loaders, evictions policies, etc.)
		</div><div class="para">
			The <code class="literal">Configuration</code> exposes numerous properties which are summarized in the <a class="xref" href="configuration_reference_chapter.html#configuration_reference">Section 12.2, “Configuration File Quick Reference”</a> section of this book and many of which are discussed in later chapters. Any time you see a configuration option discussed in this book, you can assume that the <code class="literal">Configuration</code> class or one of its component parts exposes a simple property setter/getter for that configuration option.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration.creation">
      ⁠</a>3.2. Creating a <code class="literal">Configuration</code> </h1></div></div></div><div class="para">
			As discussed in the <a class="xref" href="api.html#api.create_start">Section 2.2, “Instantiating and Starting the Cache”</a>, before a <code class="literal">Cache</code> can be created, the <code class="literal">CacheFactory</code> must be provided with a <code class="literal">Configuration</code> object or with a file name or input stream to use to parse a <code class="literal">Configuration</code> from XML. The following sections describe how to accomplish this.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140486338128704">
      ⁠</a>3.2.1. Parsing an XML-based Configuration File</h2></div></div></div><div class="para">
				The most convenient way to configure JBoss Cache is via an XML file. The JBoss Cache distribution ships with a number of configuration files for common use cases. It is recommended that these files be used as a starting point, and tweaked to meet specific needs.
			</div><div class="para">
				The simplest example of a configuration XML file, a cache configured to run in LOCAL mode, looks like this:
			</div><pre class="programlisting XML">

&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;jbosscache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xmlns="urn:jboss:jbosscache-core:config:3.2"&gt;
&lt;/jbosscache&gt;


</pre><div class="para">
				This file uses sensible defaults for isolation levels, lock acquisition timeouts, locking modes, etc. Another, more complete, sample XML file is included in the <a class="xref" href="configuration_reference_chapter.html#sample_xml_file">Section 12.1, “Sample XML Configuration File”</a> section of this book, along with <a class="xref" href="configuration_reference_chapter.html#configuration_reference">Section 12.2, “Configuration File Quick Reference”</a> explaining the various options.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration.validation">
      ⁠</a>3.2.2. Validating Configuration Files</h2></div></div></div><div class="para">
				By default JBoss Cache will validate your XML configuration file against an XML schema and throw an exception if the configuration is invalid. This can be overridden with the <code class="literal">-Djbosscache.config.validate=false</code> JVM parameter. Alternately, you could specify your own schema to validate against, using the <code class="literal">-Djbosscache.config.schemaLocation=url</code> parameter.
			</div><div class="para">
				By default though, configuration files are validated against the JBoss Cache configuration schema, which is included in the <code class="literal">jbosscache-core.jar</code>. Most XML editing tools can be used with this schema to ensure the configuration file you create is correct and valid.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140486277736512">
      ⁠</a>3.2.3. Programmatic Configuration</h2></div></div></div><div class="para">
				In addition to the XML-based configuration above, the <code class="literal">Configuration</code> can be built up programmatically, using the simple property mutators exposed by <code class="literal">Configuration</code> and its components. When constructed, the <code class="literal">Configuration</code> object is preset with JBoss Cache defaults and can even be used as-is for a quick start.
			</div><pre class="programlisting JAVA">
Configuration config = new Configuration();
config.setTransactionManagerLookupClass( 
  GenericTransactionManagerLookup.class.getName() 
  );
config.setIsolationLevel(IsolationLevel.READ_COMMITTED);
config.setCacheMode(CacheMode.LOCAL);
config.setLockAcquisitionTimeout(15000);

CacheFactory factory = new DefaultCacheFactory();
Cache cache = factory.createCache(config);
</pre><div class="para">
				Even the above fairly simple configuration is pretty tedious programming; hence the preferred use of XML-based configuration. However, if your application requires it, there is no reason not to use XML-based configuration for most of the attributes, and then access the <code class="literal">Configuration</code> object to programmatically change a few items from the defaults, add an eviction region, etc.
			</div><div class="para">
				Note that configuration values may not be changed programmatically when a cache is running, except those annotated as <code class="literal">@Dynamic</code> . Dynamic properties are also marked as such in the <a class="xref" href="configuration_reference_chapter.html#configuration_reference">Section 12.2, “Configuration File Quick Reference”</a> table. Attempting to change a non-dynamic property will result in a <code class="literal">ConfigurationException</code> .
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140486272988896">
      ⁠</a>3.2.4. Using an IOC Framework</h2></div></div></div><div class="para">
				The <code class="literal">Configuration</code> class and its <a class="xref" href="configuration.html#configuration.elements">Section 3.3, “Composition of a <code class="literal">Configuration</code> Object ”</a> are all Java Beans that expose all configuration elements via simple setters and getters. Therefore, any good IOC framework such as JBoss Microcontainer should be able to build up a <code class="literal">Configuration</code> from an XML file in the framework's own format. See the <a class="xref" href="deployment.html#deployment.microcontainer">Section 5.2, “Via JBoss Microcontainer (EAP 5.x)”</a> section for an example of this.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration.elements">
      ⁠</a>3.3. Composition of a <code class="literal">Configuration</code> Object </h1></div></div></div><div class="para">
			A <code class="literal">Configuration</code> is composed of a number of subobjects: 
			<div class="mediaobject"><img src="images/Configuration.png" alt="Composition of a Configuration Object"/></div>

		</div><div class="para">
			Following is a brief overview of the components of a <code class="literal">Configuration</code> . See the Javadoc and the linked chapters in this book for a more complete explanation of the configurations associated with each component. 
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="literal">Configuration</code> : top level object in the hierarchy; exposes the configuration properties listed in the <a class="xref" href="configuration_reference_chapter.html#configuration_reference">Section 12.2, “Configuration File Quick Reference”</a> section of this book.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">BuddyReplicationConfig</code> : only relevant if <a class="xref" href="clustering.html#br">Section 8.1.2.2, “Buddy Replication”</a> is used. General buddy replication configuration options. Must include a:
					</div></li><li class="listitem"><div class="para">
						<code class="literal">BuddyLocatorConfig</code> : implementation-specific configuration object for the <code class="literal">BuddyLocator</code> implementation being used. What configuration elements are exposed depends on the needs of the <code class="literal">BuddyLocator</code> implementation.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">EvictionConfig</code> : only relevant if <a class="xref" href="eviction_policies.html">Chapter 10, <em>Eviction</em></a> is used. General eviction configuration options. Must include at least one:
					</div></li><li class="listitem"><div class="para">
						<code class="literal">EvictionRegionConfig</code> : one for each eviction region; names the region, etc. Must include a:
					</div></li><li class="listitem"><div class="para">
						<code class="literal">EvictionAlgorithmConfig</code> : implementation-specific configuration object for the <code class="literal">EvictionAlgorithm</code> implementation being used. What configuration elements are exposed depends on the needs of the <code class="literal">EvictionAlgorithm</code> implementation.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">CacheLoaderConfig</code> : only relevant if a <a class="xref" href="cache_loaders.html">Chapter 9, <em>Cache Loaders</em></a> is used. General cache loader configuration options. Must include at least one:
					</div></li><li class="listitem"><div class="para">
						<code class="literal">IndividualCacheLoaderConfig</code> : implementation-specific configuration object for the <code class="literal">CacheLoader</code> implementation being used. What configuration elements are exposed depends on the needs of the <code class="literal">CacheLoader</code> implementation.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">RuntimeConfig</code> : exposes to cache clients certain information about the cache's runtime environment (e.g. membership in buddy replication groups if <a class="xref" href="clustering.html#br">Section 8.1.2.2, “Buddy Replication”</a> is used.) Also allows direct injection into the cache of needed external services like a JTA <code class="literal">TransactionManager</code> or a JGroups <code class="literal">ChannelFactory</code> .
					</div></li></ul></div>

		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140486277932224">
      ⁠</a>3.4. Dynamic Reconfiguration</h1></div></div></div><div class="para">
			Dynamically changing the configuration of <span class="emphasis"><em>some</em></span> options while the cache is running is supported, by programmatically obtaining the <code class="literal">Configuration</code> object from the running cache and changing values. E.g.,
		</div><pre class="programlisting JAVA">
   Configuration liveConfig = cache.getConfiguration();
   liveConfig.setLockAcquisitionTimeout(2000);
</pre><div class="para">
			A complete listing of which options may be changed dynamically is in the <a class="xref" href="configuration_reference_chapter.html#configuration_reference">Section 12.2, “Configuration File Quick Reference”</a> section. An <code class="literal">org.jboss.cache.config.ConfigurationException</code> will be thrown if you attempt to change a setting that is not dynamic.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration.options">
      ⁠</a>3.4.1. Overriding the Configuration via the Option API</h2></div></div></div><div class="para">
				The Option API allows you to override certain behaviors of the cache on a per invocation basis. This involves creating an instance of <code class="literal">org.jboss.cache.config.Option</code> , setting the options you wish to override on the <code class="literal">Option</code> object and passing it in the <code class="literal">InvocationContext</code> before invoking your method on the cache.
			</div><div class="para">
				E.g., to force a write lock when reading data (when used in a transaction, this provides semantics similar to SELECT FOR UPDATE in a database)
			</div><pre class="programlisting JAVA">
      // first start a transaction
      cache.getInvocationContext().getOptionOverrides().setForceWriteLock(true);
      Node n = cache.getNode(Fqn.fromString("/a/b/c"));
      // make changes to the node
      // commit transaction
</pre><div class="para">
				E.g., to suppress replication of a put call in a REPL_SYNC cache:
			</div><pre class="programlisting JAVA">
      Node node = cache.getChild(Fqn.fromString("/a/b/c"));
      cache.getInvocationContext().getOptionOverrides().setLocalOnly(true);
      node.put("localCounter", new Integer(2));
</pre><div class="para">
				See the Javadocs on the <code class="literal">Option</code> class for details on the options available.
			</div></div></div></div></body></html>