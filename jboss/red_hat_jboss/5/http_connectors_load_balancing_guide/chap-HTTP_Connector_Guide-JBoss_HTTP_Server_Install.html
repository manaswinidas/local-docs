<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 6. Install proxy server components</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-HTTP_Connector_Guide-JBoss_HTTP_Server_Install">
      ⁠</a>Chapter 6. Install proxy server components</h1></div></div></div><div class="para">
		Read this chapter to install the JBoss HTTP Connector, <span class="application"><strong>mod_cluster</strong></span>, on a proxy server.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Apache_Modules">
      ⁠</a>6.1. Apache HTTP Server modules</h1></div></div></div><div class="para">
			Read this section for expanded definitions of the Apache HTTP Server proxy server modules discussed in <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Overview.html#Components">Section 5.2, “Components”</a>. You specify these modules as part of <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Server_Install.html#task-Install_Proxy_Server_Components">Task: Install Proxy Server Components</a>.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mod_manager.so">
      ⁠</a>6.1.1. mod_manager.so</h2></div></div></div><div class="para">
				The Cluster Manager module, <span class="application"><strong>mod_manager</strong></span>, receives and acknowledges messages from nodes, including worker node registrations, worker node load data, and worker node application life-cycle events.
			</div><pre class="screen">LoadModule manager_module modules/mod_manager.so</pre><div class="para">
				You can also define the following related directives in the <code class="classname">&lt;VirtualHost&gt;</code> element:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">MemManagerFile</span></dt><dd><div class="para">
							 Defines the location for the files in which mod_manager stores configuration details. mod_manager also uses this location to store generated keys for shared memory and lock files. <span class="emphasis"><em>This must be an absolute path name</em></span>.
						</div><div class="para">
							It is recommended that this path be set explicitly and on a local drive, not an NFS share. The default value is platform/httpd specific.
						</div><div class="para">
							Valid paths are:
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
									HP-UX: <code class="filename"><em class="replaceable">HTTPD_HOME</em>/cache/mod_cluster</code>
								</div></li><li class="listitem"><div class="para">
									Red Hat Enterprise Linux: <code class="filename">/var/cache/mod_cluster</code>
								</div></li></ul></div></dd><dt><span class="term">Maxcontext</span></dt><dd><div class="para">
							The maximum number of contexts JBoss mod_cluster will use. The default value is <code class="literal">100</code>.
						</div></dd><dt><span class="term">Maxnode</span></dt><dd><div class="para">
							The maximum number of worker nodes JBoss mod_cluster will use. The default value is <code class="literal">20</code>.
						</div></dd><dt><span class="term">Maxhost</span></dt><dd><div class="para">
							The maximum number of hosts (aliases) JBoss mod_cluster will use. This is also the maximum number of load balancers. The default value is <code class="literal">10</code>.
						</div></dd><dt><span class="term">Maxsessionid</span></dt><dd><div class="para">
							The maximum number of active session identifiers stored. A session is considered inactive when no information is received from that session within five minutes. The default value is <code class="literal">0</code>, which disables this logic.
						</div></dd><dt><span class="term">ManagerBalancerName</span></dt><dd><div class="para">
							The name of the load balancer to use when the worker node does not provide a load balancer name. The default value is <code class="literal">mycluster</code>.
						</div></dd><dt><span class="term">PersistSlots</span></dt><dd><div class="para">
							When set to <code class="literal">on</code>, nodes, aliases and contexts are persisted in files. The default value is <code class="literal">off</code>.
						</div></dd><dt><span class="term">CheckNonce</span></dt><dd><div class="para">
							When set to <code class="literal">on</code>, session identifiers are checked to ensure that they are unique, and have not occurred before. The default is <code class="literal">on</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
								Setting this directive to <code class="literal">off</code> can leave your server vulnerable to replay attacks.
							</div></div></div></dd><dt><span class="term">SetHandler</span></dt><dd><div class="para">
							Defines a handler to display information about worker nodes in the cluster. This is defined in the <code class="literal">Location</code> element:
						</div><pre class="programlisting">&lt;Location $LOCATION&gt;
  SetHandler mod_cluster-manager
  Order deny,allow
  Deny from all
  Allow from 127.0.0.1
&lt;/Location&gt;</pre><div class="para">
							When accessing the <em class="replaceable">$LOCATION</em> defined in the <code class="literal">Location</code> element in your browser, you will see something like the following. (In this case, <em class="replaceable">$LOCATION</em> was also defined as <code class="literal">mod_cluster-handler</code>.)
						</div></dd></dl></div><div class="figure"><a id="mod_cluster_status">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/mod_status.png" width="444" alt="mod_cluster Status"/></div></div><p class="title"><strong>Figure 6.1. mod_cluster Status</strong></p></div><div class="para">
				<span class="emphasis"><em>Transferred</em></span> corresponds to the POST data sent to the worker node. <span class="emphasis"><em>Connected</em></span> corresponds to the number of requests that had been processed when this status page was requested. <span class="emphasis"><em>Sessions</em></span> corresponds to the number of active sessions. This field is not present when <code class="varname"> Maxsessionid </code> is <code class="literal">0</code>.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139711984437568">
      ⁠</a>6.1.2. mod_proxy_cluster.so</h2></div></div></div><div class="para">
				The Proxy Balancer module, <span class="application"><strong>mod_proxy_cluster</strong></span>, handles the routing of requests to cluster nodes. The Proxy Balancer selects the appropriate node to forward the request to, based on application location in the cluster, current state of each of the cluster nodes, and the Session ID (if a request is part of an established session).
			</div><pre class="screen">LoadModule proxy_cluster_module modules/mod_proxy_cluster.so</pre><div class="para">
				You can also define the following related directives in the <code class="classname">&lt;VirtualHost&gt;</code> element to change load-balancing behavior.
			</div><div class="variablelist"><p class="title"><strong>mod_proxy_cluster directives</strong></p><dl class="variablelist"><dt><span class="term">CreateBalancers</span></dt><dd><div class="para">
							Defines how load balancers are created in the Apache HTTP Server virtual hosts. The following values are valid in <code class="varname"> CreateBalancers </code> :
						</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">0</span></dt><dd><div class="para">
										Create load balancers in all virtual hosts defined in Apache HTTP Server. Remember to configure the load balancers in the <code class="varname"> ProxyPass </code> directive. 
									</div></dd><dt><span class="term">1</span></dt><dd><div class="para">
										Do not create balancers. When using this value, you must also define the load balancer name in the <code class="varname"> ProxyPass </code> or <code class="varname"> ProxyPassMatch </code> .
									</div></dd><dt><span class="term">2</span></dt><dd><div class="para">
										Create only the main server. This is the default value for <code class="varname"> CreateBalancers </code> .
									</div></dd></dl></div></dd><dt><span class="term">UseAlias</span></dt><dd><div class="para">
							Defines whether to check that the defined <code class="varname"> Alias </code> corresponds to the <code class="varname"> ServerName </code> . The following values are valid for <code class="varname"> UseAlias </code> :
						</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">0</span></dt><dd><div class="para">
										Ignore Alias information from worker nodes. This is the default value for <code class="varname"> UseAlias </code> .
									</div></dd><dt><span class="term">1</span></dt><dd><div class="para">
										Verify that the defined alias corresponds to a worker node's server name.
									</div></dd></dl></div></dd><dt><span class="term">LBstatusRecalTime</span></dt><dd><div class="para">
							Defines the interval in seconds between the proxy calculating the status of a worker node. The default interval is 5 seconds. 
						</div></dd><dt><span class="term">ProxyPassMatch; ProxyPass</span></dt><dd><div class="para">
							<code class="varname"> ProxyPass </code> maps remote servers into the local server namespace. If the local server has an address <code class="literal">http://local.com/</code>, then the following <code class="varname"> ProxyPass </code> directive would convert a local request for <code class="literal">http://local.com/requested/file1</code> into a proxy request for <code class="literal">http://worker.local.com/file1</code>.
						</div><pre class="screen">ProxyPass /requested/ http://worker.local.com/</pre><div class="para">
							<code class="varname"> ProxyPassMatch </code> uses Regular Expressions to match local paths to which the proxied URL should apply.
						</div><div class="para">
							For either directive, <code class="literal">!</code> indicates that a specified path is local, and a request for that path should not be routed to a remote server. For example, the following directive specifies that <code class="filename">.gif</code> files should be served locally.
						</div><pre class="screen">ProxyPassMatch ^(/.*\.gif)$ !</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mod_advertise.so">
      ⁠</a>6.1.3. mod_advertise.so</h2></div></div></div><div class="para">
				The Proxy Advertisement module, <span class="application"><strong>mod_advertise.so</strong></span>, broadcasts the existence of the proxy server via UDP multicast messages. The server advertisement messages contain the IP address and port number where the proxy is listening for responses from nodes that wish to join the load-balancing cluster.
			</div><div class="para">
				This module must be defined alongside <span class="application"><strong>mod_manager</strong></span> in the <code class="literal">VirtualHost</code> element. Its identifier in the following code snippet is <code class="literal">advertise_module</code>.
			</div><pre class="screen">LoadModule advertise_module modules/mod_advertise.so</pre><div class="para">
				mod_advertise also takes the following directives:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">ServerAdvertise</span></dt><dd><div class="para">
							Enables or disables the advertising mechanism. When set to <code class="literal">On</code>, the advertising mechanism is used to tell worker nodes to send status information to this proxy. When set to <code class="literal">Off</code>, the advertising mechanism is disabled.
						</div><div class="para">
							You can also specify a hostname and port with the following syntax: <code class="code">ServerAdvertise On http://hostname:port/</code>. This is only required when using a name-based virtual host, or when a virtual host is not defined.
						</div><div class="para">
							The default value is <code class="literal">Off</code> but it is automatically enabled if any <code class="literal">Advertise</code> directive is specified in defining a VirtualHost.
						</div></dd><dt><span class="term">AdvertiseGroup</span></dt><dd><div class="para">
							Defines the multicast address to advertise on. The syntax is <code class="code">AdvertiseGroup <em class="replaceable">address:port</em></code>, where <em class="replaceable">address</em> should correspond to <code class="varname"> AdvertiseGroupAddress </code> , and <em class="replaceable">port</em> should correspond to <code class="varname"> AdvertisePort </code> in your worker nodes.
						</div><div class="para">
							If your worker node is JBoss Enterprise Application Platform-based, and the <code class="code">-u</code> switch is used at startup, the default <code class="varname"> AdvertiseGroupAddress </code> is the value passed via the <code class="code">-u</code> switch.
						</div><div class="para">
							The default value is <code class="literal">224.0.1.105:23364</code>. If <em class="replaceable">port</em> is not specified, the default port used is <code class="literal">23364</code>.
						</div></dd><dt><span class="term">AdvertiseFrequency</span></dt><dd><div class="para">
							The interval (in seconds) between multicast messages advertising the IP address and port. The default value is <code class="literal">10</code>.
						</div></dd><dt><span class="term">AdvertiseSecurityKey</span></dt><dd><div class="para">
							Defines a string used to identify the JBoss HTTP Connector mod_cluster in JBoss Web. By default this directive is not set and no information is sent.
						</div></dd><dt><span class="term">AdvertiseManagerUrl</span></dt><dd><div class="para">
							Defines the URL that the worker node should use to send information to the proxy server. By default this directive is not set and no information is sent.
						</div></dd><dt><span class="term">AdvertiseBindAddress</span></dt><dd><div class="para">
							Defines the address and port over which to send multicast messages. The syntax is <code class="code">AdvertiseBindAddress address:port</code>. This allows an address to be specified on machines with multiple IP addresses. The default value is <code class="literal">0.0.0.0:23364</code>.
						</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139711960892768">
      ⁠</a>6.2. Install proxy server components</h1></div></div></div><div class="task"><a id="task-Install_Proxy_Server_Components">
      ⁠</a><p class="title"><strong>Task: Install Proxy Server Components</strong></p><div class="tasksummary"> <div class="para">
			Follow this task to install the JBoss HTTP Connector. 
		</div>
		  <div class="para">
			The native components are specific to particular operating system and processor architectures. Refer to the JBoss Enterprise Application Platform <em class="citetitle"> Installation Guide </em> to download the correct native components package for your server operating system and processor architecture.
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711918035344">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					An installed Web Server distribution, such as JBoss Enterprise Web Server or HPWS installed (designated by HTTPD_HOME in this documentation).
				</div></li><li class="listitem"><div class="para">
					JBoss Enterprise Application Platform 5 Native components downloaded.
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Extract Apache HTTP Server modules from Native Components download</strong></p><div class="para">
					Extract the four modules <code class="filename">mod_advertise.so</code>, <code class="filename">mod_manager.so</code>, <code class="filename">mod_proxy_cluster.so</code>, <code class="filename">mod_slotmem.so</code> from the appropriate Native Components package directory for your processor architecture: either <code class="filename">native/lib/httpd/modules</code> or <code class="filename">native/lib64/httpd/modules</code>.
				</div></li><li class="step"><p class="title"><strong>Copy Apache HTTP Server modules to <em class="replaceable">HTTPD_HOME</em></strong></p><div class="para">
					Copy the JBoss HTTP Connector modules to the <code class="filename"><em class="replaceable">HTTPD_HOME</em>/httpd/modules</code> directory of the JBoss Enterprise Web Server.
				</div></li><li class="step"><p class="title"><strong>Disable the mod_proxy_balancer module</strong></p><div class="para">
					Edit the HTTPD configuration file <code class="filename"><em class="replaceable">HTTPD_HOME</em>/httpd/conf/httpd.conf</code> and mark the following line as a comment by adding a <code class="literal">#</code> character at the start:
				</div><pre class="screen">LoadModule proxy_balancer_module modules/mod_proxy_balancer.so</pre><div class="para">
					This module is incompatible with the JBoss HTTP Connector.
				</div></li><li class="step"><p class="title"><strong>Configure the server to load the JBoss HTTP Connector modules</strong></p><ol class="substeps a"><li class="step"><div class="para">
							Create <code class="filename"><em class="replaceable">HTTPD_HOME</em>/httpd/<em class="replaceable">conf</em>/JBoss_HTTP.conf</code>.
						</div></li><li class="step"><div class="para">
							Add the following lines to <code class="filename"><em class="replaceable">HTTPD_HOME</em>/httpd/<em class="replaceable">conf</em>/JBoss_HTTP.conf</code>:
						</div><pre class="screen">LoadModule slotmem_module <em class="replaceable">HTTPD_HOME</em>/modules/mod_slotmem.so
LoadModule manager_module <em class="replaceable">HTTPD_HOME</em>/modules/mod_manager.so
LoadModule proxy_cluster_module <em class="replaceable">HTTPD_HOME</em>/modules/mod_proxy_cluster.so
LoadModule advertise_module <em class="replaceable">HTTPD_HOME</em>/modules/mod_advertise.so</pre></li></ol></li><li class="step"><p class="title"><strong>Restart the HTTPD service</strong></p><div class="para">
					Refer to HTTPD-specific documentation for detailed instructions.
				</div></li></ol></div></div></div></div></body></html>