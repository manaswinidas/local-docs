<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 12. Load balancing demonstration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm139711972204144">
      ⁠</a>Chapter 12. Load balancing demonstration</h1></div></div></div><div class="para">
		The JBoss HTTP Connector includes a load balancing demonstration to show how different server-side scenarios affect the client request routing performed by the load balancing proxy server. The required configuration is located in the <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/mod_cluster/demo</code> directory.
	</div><div class="para">
		The application consists of two primary components:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">/server/load-demo.war</code></span></dt><dd><div class="para">
					A WAR file to be deployed in JBoss Enterprise Application Platform or JBoss Enterprise Web Server. This WAR includes a number of servlets.
				</div></dd><dt><span class="term"><code class="filename">/client/lib/mod-cluster-demo.jar</code></span></dt><dd><div class="para">
					A web application that lets users launch a pool of threads, by sending requests through the load balancer to the application's primary servlet. The application displays information about which servers are handling the requests. It can also send separate requests to the application's load-generation servlets, allowing the user to see how certain load conditions affect request load balancing.
				</div></dd></dl></div><div class="para">
		This application can be used to demonstrate how different worker-side scenarios impact the routing decisions of the proxy server.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important - Enterprise Web Server Limitation</strong></p></div><div class="admonition"><div class="para">
			If running the demonstration on JBoss Enterprise Web Server, the only metrics available will be System, and JVM metrics. The demonstration application is not designed to interact with any other metrics in Tomcat 6.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>The demonstration application is not a load testing tool</strong></p></div><div class="admonition"><div class="para">
			The demonstration application does not show the maximum load a cluster configuration can handle.
		</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="demo-setup">
      ⁠</a>12.1. Set up the demonstration</h1></div></div></div><div class="para">
			The following procedure summarizes how to set up and start the demonstration. These steps will then be explained in further detail. Once the demonstration is running, refer to <a class="xref" href="ch12.html#demo-use">Section 12.3, “Interact with the demonstration”</a>.
		</div><div class="task"><a id="task-Start_the_Demo">
      ⁠</a><p class="title"><strong>Task: Start the Demo</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to set up the base requirements of the demonstration.
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711922127936">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Install and Configure the Worker Node. Refer to <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Install.html#worker_install-eap">Section 8.2, “Install and configure a worker node”</a>
				</div></li><li class="listitem"><div class="para">
					Install and Configure the Proxy Server. Refer to <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Advanced_Configure.html#static-proxy-configuration">Section 9.1, “Static proxy configuration”</a>
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Start the Proxy Server</strong></p><div class="para">
					Navigate to <code class="filename"><em class="replaceable">HTTPD_DIST</em>/sbin</code> and start the proxy server.
				</div><pre class="screen">[sbin]$ apachectl start</pre></li><li class="step"><p class="title"><strong>Start the Worker Node</strong></p><div class="para">
					In a terminal, execute the following command:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							For JBoss Enterprise Web Server:
						</div><pre class="screen">[home]$ ./<em class="replaceable">JBOSS_EWS_DIST</em>/<em class="replaceable">tomcat6</em>/bin/startup.sh</pre></li><li class="listitem"><div class="para">
							For JBoss Enterprise Application Platform:
						</div><pre class="screen">[home]$ ./<em class="replaceable">JBOSS_EAP_DIST</em>/bin/run.sh</pre></li></ul></div></li><li class="step"><p class="title"><strong>On JBoss Enterprise Web Server, specify the Catalina Service Name</strong></p><div class="para">
					Tomcat 6 only: In <code class="filename"><em class="replaceable">$JBOSS_EWS_DIST</em>/mod_cluster/src/demo/resources/web.xml</code>, under the <code class="literal"> &lt;web-app&gt; </code> element, append a <code class="literal"> &lt;context-param&gt; </code> directive, which specifies Catalina as a service.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;context-param&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>service-name<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>Catalina<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/context-param&gt;</span></pre></li><li class="step"><p class="title"><strong>Deploy Demo Web Archive to Worker Node</strong></p><div class="para">
					Copy <code class="filename">load-demo.war</code> from <code class="filename"><em class="replaceable">JBOSS-EAP_DIST</em>/mod_cluster/demo/server</code> into one of the following directories:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							For JBoss Enterprise Web Server:
						</div><div class="para">
							<code class="filename"><em class="replaceable">JBOSS_EWS_DIST</em>/<em class="replaceable">tomcat6</em>/webapps</code>
						</div></li><li class="listitem"><div class="para">
							For JBoss Enterprise Application Platform:
						</div><div class="para">
							<code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/deploy</code>
						</div></li></ul></div></li><li class="step"><p class="title"><strong>Start the Demonstration</strong></p><div class="para">
					Navigate to <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/mod_cluster/demo/client/</code>, and start the demonstration.
				</div><pre class="screen">[client]$ ./run-demo.sh</pre><div class="para"><div class="title">Result</div>
						The demonstration starts, and the Load Balancing Demonstration window opens. Proceed to <a class="xref" href="ch12.html#task-Configure_Client_Control_Tab_Fields">Task: Configure Client Control Tab Fields</a>
					</div><div class="mediaobject"><img src="images/demo-server-load.jpg" alt="Result"/></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="demo-config">
      ⁠</a>12.2. Configure the demo client</h1></div></div></div><div class="para">
			You must configure the demonstration's Client Control parameters to ensure the client operates as expected throughout the demonstration.
		</div><div class="task"><a id="task-Configure_Client_Control_Tab_Fields">
      ⁠</a><p class="title"><strong>Task: Configure Client Control Tab Fields</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to configure the <span class="guilabel"><strong>Client Control</strong></span> tab of the Load Balancing Demonstration.
		</div>
		 <div class="variablelist"><a id="var-Client_Control_Tab_Field_Descriptions">
      ⁠</a><p class="title"><strong>Terms</strong></p><dl class="variablelist"><dt><span class="term">Proxy Hostname</span></dt><dd><div class="para">
						Hostname of the load-balancing proxy server, or the IP address on which the proxy server is listening for requests. The default value for this field is <code class="literal">localhost</code>, or determined by the <code class="varname"> mod_cluster.proxy.host </code> system property, if set.
					</div><div class="para">
						Edit the <code class="code">-Dmod_cluster.proxy.host=localhost</code> value in <code class="filename">run-demo.sh</code> to avoid re-setting this value each time you use the demo.
					</div></dd><dt><span class="term">Proxy Port</span></dt><dd><div class="para">
						Port on which the load-balancing proxy server listens for requests. The default value is <code class="literal">8000</code>, or determined by the <code class="varname"> mod_cluster.proxy.port </code> property, if set.
					</div><div class="para">
						Edit the <code class="code">-Dmod_cluster.proxy.port=8000</code> value in <code class="filename">run-demo.sh</code> to avoid re-setting this value each time you use the demo.
					</div></dd><dt><span class="term">Context Path</span></dt><dd><div class="para">
						The part of the request URL that specifies the request is for <code class="filename">load-demo.war</code>.
					</div></dd><dt><span class="term">Session Life</span></dt><dd><div class="para">
						Number of seconds a client thread should use a session before invalidating or abandoning it. This should be a small value, or session stickiness can prevent changes in server load from affecting the proxy server's routing decisions. When sticky sessions are enabled (strongly recommended), the creation of new sessions allows the proxy to balance the workload.
					</div></dd><dt><span class="term">Invalidate</span></dt><dd><div class="para">
						When checked, specifies that a session is invalidated by the client thread when the thread stops using a session. When unchecked, the session is abandoned, and exists on the worker node until the session timeout expires.
					</div></dd><dt><span class="term">Session Timeout</span></dt><dd><div class="para">
						The number of seconds a session can remain unused before the worker node can expire and remove the session.
					</div><div class="para">
						Deselecting <code class="varname"> Invalidate </code> and setting a high value relative to session life causes a significant number of unused sessions to accumulate on the server.
					</div></dd><dt><span class="term">Num Threads</span></dt><dd><div class="para">
						Number of client threads to launch. Each thread repeatedly makes requests until the <span class="guibutton"><strong>Stop</strong></span> button is pressed, or a request receives a response other than HTTP 200.
					</div></dd><dt><span class="term">Sleep Time</span></dt><dd><div class="para">
						Number of milliseconds that client threads should sleep between requests.
					</div></dd><dt><span class="term">Startup Time</span></dt><dd><div class="para">
						Number of seconds over which the application should stagger client thread start-up. Staggering the start time of sessions avoids the unrealistic situation where all sessions start and end almost simultaneously. Staggering the start time allows the proxy to continually see new sessions and decide how to route them.
					</div></dd></dl></div>
		 </div><div class="taskprerequisites"><a id="idm139711991452592">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div class="para">
			Complete <a class="xref" href="ch12.html#task-Start_the_Demo">Task: Start the Demo</a> before continuing with this task.
		</div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Click the <span class="guilabel"><strong>Client Control</strong></span> tab.
				</div></li><li class="step"><div class="para">
					Supply values for all fields on the <span class="guilabel"><strong>Client Control</strong></span> tab, referring to the list of terms above.
				</div></li><li class="step"><div class="para">
					Once you have specified the values, proceed to <a class="xref" href="ch12.html#task-Interact_with_the_Demonstration">Task: Interact with the Demonstration</a>.
				</div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="demo-use">
      ⁠</a>12.3. Interact with the demonstration</h1></div></div></div><div class="variablelist"><p class="title"><strong>Terms</strong></p><dl class="variablelist"><dt><span class="term">Active Sessions</span></dt><dd><div class="para">
						A session is considered active if a client thread will ever send a request associated with the session. When client threads stop using a session, they can either send a request to invalidate it, or abandon it by no longer including its session cookie in requests.
					</div><div class="para">
						Once a session has been abandoned, it is no longer reflected in the <span class="emphasis"><em>Session Balancing</em></span> chart, but will continue to exist on the worker node until it is removed based on session timeout values.
					</div></dd><dt><span class="term">Total Clients</span></dt><dd><div class="para">
						The number of client threads created since the last time the <span class="emphasis"><em>Start</em></span> button was clicked.
					</div></dd><dt><span class="term">Live Clients</span></dt><dd><div class="para">
						The number of client threads currently running.
					</div></dd><dt><span class="term">Failed Clients</span></dt><dd><div class="para">
						The number of clients threads that terminated abnormally, for example, a request that resulted in something other than a HTTP 200 response.
					</div></dd></dl></div><div class="para">
			This section shows you how to configure and start using the demo.
		</div><div class="task"><a id="task-Interact_with_the_Demonstration">
      ⁠</a><p class="title"><strong>Task: Interact with the Demonstration</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to test the effects of changing load-balancing parameters.
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711980718864">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Complete <a class="xref" href="ch12.html#task-Start_the_Demo">Task: Start the Demo</a>.
				</div></li><li class="listitem"><div class="para">
					Complete <a class="xref" href="ch12.html#task-Configure_Client_Control_Tab_Fields">Task: Configure Client Control Tab Fields</a>.
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Click on the <span class="guilabel"><strong>Request Balancing</strong></span> tab to see how many requests are going to each of the worker nodes.
				</div></li><li class="step"><div class="para">
					Click on the <span class="guilabel"><strong>Session Balancing</strong></span> tab to see how many active sessions are being hosted by each of the worker nodes.
				</div></li><li class="step"><div class="para">
					Stop some of the worker nodes, or undeploy <code class="filename">load-demo.war</code>, and observe the effect that this has on request and session balancing.
				</div></li><li class="step"><div class="para">
					Restart some of the worker nodes, or re-deploy the <code class="filename">load-demo.war</code> to some of the workers, and observe the effect that this has on request and session balancing.
				</div></li><li class="step"><div class="para">
					Experiment with adding artificial load to one or more worker nodes and observe the effects on load and session balancing. (See <a class="xref" href="ch12.html#demo-add_load">Section 12.3.1, “Generate artificial load”</a> for details.)
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="demo-add_load">
      ⁠</a>12.3.1. Generate artificial load</h2></div></div></div><div class="para">
				You can use the Load Balancing Demonstration to instruct your worker nodes to generate various types of load, and then track how that load affects request and session balancing. Load generation is controlled in the <span class="emphasis"><em>Server Load Control</em></span> tab:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Target Hostname, Target Port</span></dt><dd><div class="para">
							The hostname and port number of the server on which to generate load. There are two strategies for setting these values:
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
									Use the hostname and port of the proxy server. The proxy will route the load to a worker node. However, the client does not maintain a session cookie for these requests, so subsequent generated load will not necessarily be routed to the same worker.
								</div></li><li class="listitem"><div class="para">
									If the worker nodes are running the HttpConnector and the AJP connector, you can specify the IP address and port on which a worker's HttpConnector is listening. (The default is <code class="literal">8080</code>.)
								</div></li></ol></div></dd><dt><span class="term">Load Creation Action</span></dt><dd><div class="para">
							Specifies the type of load the worker node should generate.
						</div><div class="variablelist"><p class="title"><strong>Available Actions</strong></p><dl class="variablelist"><dt><span class="term">Active Sessions</span></dt><dd><div class="para">
										Generates server load by causing session creation on the target server.
									</div></dd><dt><span class="term">Datasource Use</span></dt><dd><div class="para">
										Generates server load by taking connections from the <code class="code">java:DefaultDS</code> datasource for a set time.
									</div></dd><dt><span class="term">Connection Pool Use</span></dt><dd><div class="para">
										Generates server load by blocking threads in the webserver connections pool for a set time.
									</div></dd><dt><span class="term">Heap Memory Pool Use</span></dt><dd><div class="para">
										Generates server load by filling 50% of free heap memory for a set time.
									</div></dd><dt><span class="term">CPU Use</span></dt><dd><div class="para">
										Generates server CPU load by initiating a tight loop in a thread.
									</div></dd><dt><span class="term">Server Receive Traffic</span></dt><dd><div class="para">
										Generates server traffic receipt load by POSTing a large byte array to the server once per second for a set time.
									</div></dd><dt><span class="term">Server Send Traffic</span></dt><dd><div class="para">
										Generates server traffic send load by making a request once per second, to which the server responds with a large byte array.
									</div></dd><dt><span class="term">Request Count</span></dt><dd><div class="para">
										Generates server load by making numerous requests, increasing the request count on the target server.
									</div></dd></dl></div></dd><dt><span class="term">Params</span></dt><dd><div class="para">
							Zero or more parameters to pass to the specified load creation servlet, for example, Number of Connections and Duration, as seen in the screenshot. The parameters displayed, their name, and their meaning depend on the selected Load Creation Action. The label for each parameter includes a tooltip that explains its use.
						</div></dd></dl></div></div></div></div></body></html>