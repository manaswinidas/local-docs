<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 7. Configure basic proxy server</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Basic_Proxy_Server">
      ⁠</a>Chapter 7. Configure basic proxy server</h1></div></div></div><div class="para">
		Follow the instructions in this chapter to configure an HTTPD to use the JBoss HTTP Connector (mod_cluster).
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_HTTP_Server_Configure_Overview">
      ⁠</a>7.1. Basic proxy configuration overview</h1></div></div></div><div class="para">
			Configuration of the proxy server consists of one mandatory and one optional portion:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Configure a proxy server listener to receive worker node connection requests and worker node feedback.
				</div></li><li class="listitem"><div class="para">
					Optional: Disable server advertisement.
				</div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Server Advertisement</div>
				The proxy server can advertise itself using UDP multicast. When UDP multicast is available on the network between the proxy server and the worker nodes server advertisement allows you to add worker nodes with no further configuration required on the proxy server, and minimal configuration on the worker nodes.
			</div><div class="para">
			If UDP multicast is not available or undesirable, configure the worker nodes with a static list of proxy servers, as detailed in <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Advanced_Configure.html#static-proxy-configuration">Section 9.1, “Static proxy configuration”</a>. There is no need in either case to configure the proxy server with a list of worker nodes.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139711986626128">
      ⁠</a>7.2. Configure a load-balancing proxy using the HTTP Connector</h1></div></div></div><div class="para">
			Read this section to configure a load balancing proxy that uses the JBoss HTTP Connector.
		</div><div class="task"><p class="title"><strong>Task: Configure a Proxy Server Listener</strong></p><div class="tasksummary"> <div class="para">
			Follow this task to configure the Apache HTTP Server service to act as a load-balancing proxy using the JBoss HTTP Connector.
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711977866736">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					An installed Web Server distribution, such as JBoss Enterprise Web Server or HPWS installed (designated by HTTPD_HOME in this documentation).
				</div></li><li class="listitem"><div class="para">
					JBoss HTTP Connector modules. Refer to <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Server_Install.html">Chapter 6, <em>Install proxy server components</em></a> for details.
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Create a listen directive for the proxy server</strong></p><div class="para">
					Edit the configuration file <code class="filename"><em class="replaceable">HTTPD_HOME</em>/httpd/<em class="replaceable">conf</em>/JBoss_HTTP.conf</code> and add the following:
				</div><pre class="screen">Listen <em class="replaceable">IP_ADDRESS</em>:<em class="replaceable">PORT_NUMBER</em></pre><div class="para">
					Where <em class="replaceable">IP_ADDRESS</em> is the IP address of a server network interface to communicate with the worker nodes, and <em class="replaceable">PORT_NUMBER</em> is the port on that interface to listen on.
				</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The port <em class="replaceable">PORT_NUMBER</em> must be open on the server firewall for incoming TCP connections.
					</div></div></div><div class="example"><a id="idm139711978373008">
      ⁠</a><p class="title"><strong>Example 7.1. Example Listen Directive</strong></p><div class="example-contents"><pre class="screen">Listen 10.33.144.3:6666</pre></div></div></li><li class="step"><a id="step-Virtual_Host">
      ⁠</a><p class="title"><strong>Create Virtual Host</strong></p><div class="para">
					Add the following &lt;VirtualHost&gt; block to <code class="filename"><em class="replaceable">HTTPD_HOME</em>/httpd/<em class="replaceable">conf</em>/JBoss_HTTP.conf</code>:
				</div><pre class="programlisting">
&lt;VirtualHost IP_ADDRESS:PORT_NUMBER&gt;

   &lt;Location /&gt;
      Order deny,allow
      Deny from all
      Allow from PARTIAL_IP_ADDRESS
   &lt;/Location&gt;

   KeepAliveTimeout 60
   MaxKeepAliveRequests 0

   ManagerBalancerName mycluster
   AdvertiseFrequency 5

&lt;/VirtualHost&gt;</pre><div class="para">
					<em class="replaceable">IP_ADDRESS</em> and <em class="replaceable">PORT_NUMBER</em> match the values from the Listen directive.
				</div><div class="para">
					<em class="replaceable">PARTIAL_IP_ADDRESS</em> is the first 1 to 3 bytes of an IP address, to restrict access to a specific subnet - 10.33.144, for example.
				</div></li><li class="step"><p class="title"><strong>Configure SELinux to allow proxy traffic</strong></p><div class="para">
					Enter the following commands as a root-equivalent user to modify the SELinux configuration to allow the proxy traffic:
				</div><div class="para">
					
<pre class="programlisting">
#semanage port -a -t http_port_t -p tcp 8079 #add port to the Apache port list to enable the next command to work
#setsebool -P httpd_can_network_relay 1 #for mod_proxy to work
</pre>

				</div></li><li class="step"><p class="title"><strong>Optional: Disable Server Advertisement</strong></p><div class="para">
					The presence of the <code class="literal">AdvertiseFrequency</code> directive, which is set to five seconds here, causes the server to periodically send server advertisement messages via UDP multicast.
				</div><div class="para">
					These server advertisement messages contain the <em class="replaceable">IP_ADDRESS</em> and <em class="replaceable">PORT_NUMBER</em> specified in the VirtualHost definition. Worker nodes that are configured to respond to server advertisements use this information to register themselves with the proxy server.
				</div><div class="para">
					To disable server advertisement, add the following directive to the <code class="literal">VirtualHost</code> definition:
				</div><pre class="screen">ServerAdvertise Off</pre><div class="para">
					If server advertisements are disabled, or UDP multicast is not available on the network between the proxy server and the worker nodes, you must configure worker nodes with a static list of proxy servers. Refer to <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Advanced_Configure.html#static-proxy-configuration">Section 9.1, “Static proxy configuration”</a> for directions.
				</div></li><li class="step"><p class="title"><strong>Restart the JBoss Enterprise Web Server Apache service</strong></p><div class="para">
					Refer to HTTPD-specific documentation for detailed instructions.
				</div></li></ol></div></div></div></div></body></html>