<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 20. Complete working example</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Appendix_Example">
      ⁠</a>Chapter 20. Complete working example</h1></div></div></div><div class="para">
		Following are a set of example configuration files for a complete working example.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Proxy Server</div>
			A proxy server listening on localhost:
		</div><pre class="screen">LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so

Listen 127.0.0.1:6666
&lt;VirtualHost 127.0.0.1:6666&gt;

    &lt;Directory /&gt;
        Order deny,allow
        Deny from all
        Allow from 127.0.0.1
    &lt;/Directory&gt;

    KeepAliveTimeout 60
    MaxKeepAliveRequests 0

    ManagerBalancerName mycluster
    ServerAdvertise On
    AdvertiseFrequency 5

&lt;/VirtualHost&gt;

&lt;Location /mod_cluster-manager&gt;
    SetHandler mod_cluster-manager
    Order deny,allow
    Deny from all
    Allow from 127.0.0.1
&lt;/Location&gt;</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">JBoss Web Client Listener</div>
			Following are the listener definitions for <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/server/<em class="replaceable">PROFILE</em>/deploy/jbossweb.sar/server.xml</code>.
		</div><pre class="screen">&lt;!-- Non-clustered mode --&gt;
&lt;Listener className="org.jboss.web.tomcat.service.deployers.MicrocontainerIntegrationLifecycleListener" delegateBeanName="ModClusterService"/&gt;
&lt;!-- Clustered mode
 Listener className="org.jboss.web.tomcat.service.deployers.MicrocontainerIntegrationLifecycleListener" delegateBeanName="HAModClusterService"/--&gt;</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">JBoss Web Client Service Dependencies</div>
			Following are the required dependencies for the WebServer bean in <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/server/<em class="replaceable">PROFILE</em>/deploy/jbossweb.sar/META-INF/jboss-beans.xml</code>. Add them to the existing dependencies.
		</div><pre class="screen">&lt;bean name="WebServer" class="org.jboss.web.tomcat.service.deployers.TomcatService"&gt;
  &lt;!-- ... --&gt;
  &lt;depends&gt;ModClusterService&lt;/depends&gt;&lt;!-- Non-clustered mode --&gt;
  &lt;!--depends&gt;HAModClusterService&lt;/depends--&gt;&lt;!-- Clustered mode --&gt;
  &lt;!-- ... --&gt;
&lt;/bean&gt;</pre><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Example iptables Firewall Rules</div>
			Following are a set of example firewall rules using <code class="command">iptables</code>, for a cluster node on the 192.168.1.0/24 subnet.
		</div><pre class="screen">/sbin/iptables -I INPUT 5 -p udp -d 224.0.1.0/24 -j ACCEPT -m comment --comment "mod_cluster traffic"
/sbin/iptables -I INPUT 6 -p udp -d 224.0.0.0/4 -j ACCEPT -m comment --comment "JBoss Cluster traffic"
/sbin/iptables -I INPUT 9 -p udp -s 192.168.1.0/24 -j ACCEPT -m comment --comment "cluster subnet for inter-node communication"
/sbin/iptables -I INPUT 10 -p tcp -s 192.168.1.0/24 -j ACCEPT -m comment --comment "cluster subnet for inter-node communication"
/etc/init.d/iptables save</pre></div></body></html>