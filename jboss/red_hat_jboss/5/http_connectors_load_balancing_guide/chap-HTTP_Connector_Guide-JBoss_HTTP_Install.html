<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 8. Install node with basic configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-HTTP_Connector_Guide-JBoss_HTTP_Install">
      ⁠</a>Chapter 8. Install node with basic configuration</h1></div></div></div><div class="para">
		Read this chapter to install the JBoss HTTP Connector on a worker node, and implement basic configuration for the node to begin immediate operation.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-JBoss_HTTP_Node_Req">
      ⁠</a>8.1. Worker node requirements</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Supported Worker Node types</strong></p><ul><li class="listitem"><div class="para">
					JBoss Enterprise Platform 5 JBoss Web component
				</div></li><li class="listitem"><div class="para">
					JBoss Enterprise Web Server Tomcat service
				</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				JBoss Enterprise Platform worker nodes support all JBoss HTTP Connector functionality. JBoss Enterprise Web Server Tomcat worker nodes support a subset of JBoss HTTP Connector functionality.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>JBoss HTTP Connector Enterprise Web Server Node Limitations</strong></p><ul><li class="listitem"><div class="para">
					Non-clustered mode only.
				</div></li><li class="listitem"><div class="para">
					Only one load metric can be used at a time when calculating the load balance factor.
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="worker_install-eap">
      ⁠</a>8.2. Install and configure a worker node</h1></div></div></div><div class="para">
			This section contains a number of tasks. Follow the appropriate task to install and configure a worker node on JBoss Enterprise Application Platform, or JBoss Enterprise Web Server.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Character Limitations on Worker Node</strong></p></div><div class="admonition"><div class="para">
				Make sure your configuration definition meets the following character limits:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Maximum JVMRoute string length: 80 character (JVMRoute in the &lt;Engine&gt; element)
					</div></li><li class="listitem"><div class="para">
						Maximum hostname length for a node: 64 characters (hostname address in the &lt;Connector&gt; element)
					</div></li><li class="listitem"><div class="para">
						Maximum port length for a node: 7 characters (<code class="literal">8009</code> is 4 characters, the <span class="property">port</span> property in the &lt;Connector&gt; element)
					</div></li><li class="listitem"><div class="para">
						Maximum scheme length for a node: 6 characters (possible values are <code class="literal">http</code>, <code class="literal">https</code>, <code class="literal">ajp</code>, the protocol of the connector)
					</div></li></ul></div></div></div><div class="task"><p class="title"><strong>Task: Install and Configure a JBoss Enterprise Application Platform Worker Node</strong></p><div class="tasksummary"> <div class="para">
			Follow this procedure to install JBoss HTTP Connector on a JBoss Enterprise Application Platform instance and configure it for non-clustered operation. 
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711979890336">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Install a supported JBoss Enterprise Application Platform.
				</div></li><li class="listitem"><div class="para">
					Understand the Proxy Configuration parameters discussed in <a class="xref" href="Java_Properties_Reference.html">Appendix B, <em>Reference: Java properties</em></a>
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Deploy the worker node service</strong></p><div class="para">
					Copy <code class="filename">mod-cluster.sar</code> from the <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/mod_cluster</code> directory to <code class="filename">jboss-as/server/<em class="replaceable">PROFILE</em>/deploy</code>.
				</div></li><li class="step"><p class="title"><strong>Add a Listener to JBoss Web</strong></p><div class="para">
					Add the following <code class="classname">Listener</code> element beneath the other Listeners in <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/deploy/jbossweb.sar/server.xml</code>:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Listener</span><span xmlns="" class="perl_Others"> className=</span><span xmlns="" class="perl_String">"org.jboss.web.tomcat.service.deployers.MicrocontainerIntegrationLifecycleListener"</span><span xmlns="" class="perl_Others"> delegateBeanName=</span><span xmlns="" class="perl_String">"ModClusterService"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></li><li class="step"><p class="title"><strong>Configure the service dependency</strong></p><div class="para">
					Add the following <code class="varname"> depends </code> element beneath the other depends elements in <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/deploy/jbossweb.sar/META-INF/jboss-beans.xml</code>:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>ModClusterService<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span></pre></li><li class="step"><p class="title"><strong>Give the worker a unique identity</strong></p><div class="para">
					Edit <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/jboss-as/server/<em class="replaceable">PROFILE</em>/deploy/jbossweb.sar/server.xml</code> and add a <code class="varname"> jvmRoute </code> attribute and value to the <code class="classname">Engine</code> element, as shown:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Engine</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.web"</span><span xmlns="" class="perl_Others"> defaultHost=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Others"> jvmRoute=</span><span xmlns="" class="perl_String">"worker01"</span><span xmlns="" class="perl_Keyword">&gt;</span></pre><div class="para">
					Use a unique <code class="varname"> jvmRoute </code> value for each node.
				</div></li><li class="step"><p class="title"><strong>Optional: Configure firewall to receive multicast Proxy Server advertisements</strong></p><div class="para">
					A proxy server using the JBoss HTTP Connector can advertise itself via UDP multicast. To enable the worker node to dynamically discover proxy servers, open port 23364 for UDP connections on the worker node's firewall.
				</div><div class="para">
					Use the following command on Red Hat Enterprise Linux to achieve this:
				</div><pre class="programlisting">/sbin/iptables -A INPUT -m state --state NEW -m udp -p udp --dport 23364 -j ACCEPT 
-m comment --comment "receive mod_cluster proxy server advertisements"
/sbin/iptables save</pre><div class="para">
					If you are not using Automatic Proxy Discovery (see <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Overview.html#Automatic_Proxy_Discovery">Automatic Proxy Discovery</a>), configure worker nodes with a static list of proxies. Refer to <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Advanced_Configure.html#static-proxy-configuration">Section 9.1, “Static proxy configuration”</a> for directions. In this case you can safely ignore the following warning message:
				</div><pre class="screen">[warning] mod_advertise: ServerAdvertise Address or Port not defined, Advertise disabled!!!</pre><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						If your nodes are on different machines that run Red Hat Enterprise Linux, they may not acknowledge each other automatically. JBoss Clustering relies on the UDP (User Datagram Protocol) multicasting provided by jGroups. Red Hat Enterprise Linux blocks these packets by default.
					</div><div class="para">
						To allow the packets, modify the iptables rules (as root). The following commands apply to an IP address that matches 192.168.1.x:
					</div><pre class="programlisting">
/sbin/iptables -I RH-Firewall-1-INPUT 5 -p udp -d 224.0.1.0/24 -j ACCEPT
/sbin/iptables -I RH-Firewall-1-INPUT 5 -p udp -d 224.0.0.0/4 -j ACCEPT
/sbin/iptables -I RH-Firewall-1-INPUT 9 -p udp -s 192.168.1.0/24 -j ACCEPT
/sbin/iptables -I RH-Firewall-1-INPUT 10 -p tcp -s 192.168.1.0/24 -j ACCEPT
/etc/init.d/iptables save
</pre></div></div></li></ol></div></div><div class="task"><p class="title"><strong>Task: Install and Configure a JBoss Enterprise Web Server Worker Node</strong></p><div class="tasksummary"> <div class="para">
			Follow this procedure to install the JBoss HTTP Connector on a JBoss Enterprise Web Server node and configure it for non-clustered operation. 
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711922107344">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Install a supported JBoss Enterprise Web Server.
				</div></li><li class="listitem"><div class="para">
					Understand the Proxy Configuration parameters discussed in <a class="xref" href="Java_Properties_Reference.html">Appendix B, <em>Reference: Java properties</em></a>
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Deploy worker node service</strong></p><div class="para">
					Copy all of the library files in the <code class="filename"><em class="replaceable">JBOSS_EAP_DIST</em>/mod_cluster/JBossWeb-Tomcat/lib</code> directory. Move these files to <code class="filename"><em class="replaceable">JBOSS_EWS_DIST</em>/tomcat6/lib/</code>
				</div></li><li class="step"><p class="title"><strong>Add a Listener to Tomcat</strong></p><div class="para">
					Add the following <code class="classname">Listener</code> element beneath the other Listener elements in <code class="filename"><em class="replaceable">JBOSS_EWS_DIST</em>/<em class="replaceable">tomcat6</em>/conf/server.xml</code>.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Listener</span><span xmlns="" class="perl_Others"> className=</span><span xmlns="" class="perl_String">"org.jboss.modcluster.ModClusterListener"</span><span xmlns="" class="perl_Others"> advertise=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> stickySession=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> stickySessionForce=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> stickySessionRemove=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></li><li class="step"><p class="title"><strong>Give this worker a unique identity</strong></p><div class="para">
					Edit <code class="filename"><em class="replaceable">JBOSS_EWS_DIST</em>/<em class="replaceable">tomcat6</em>/conf/server.xml</code> and add a <code class="varname"> jvmRoute </code> attribute and value to the <span class="markup"> &lt;Engine&gt; </span> element, as shown:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Engine</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Catalina"</span><span xmlns="" class="perl_Others"> defaultHost=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Others"> jvmRoute=</span><span xmlns="" class="perl_String">"worker01"</span><span xmlns="" class="perl_Keyword">&gt;</span></pre></li><li class="step"><p class="title"><strong>Optional: Configure firewall to receive Proxy Server advertisements</strong></p><div class="para">
					A proxy server using the JBoss HTTP Connector can advertise itself via UDP multicast. To receive these multicast messages, open port 23364 for UDP connections on the worker node's firewall.
				</div><div class="para">
					For Linux users:
				</div><pre class="programlisting">/sbin/iptables -A INPUT -m state --state NEW -m udp -p udp --dport
 23364 -j ACCEPT 
-m comment -comment "receive mod_cluster proxy server advertisements"</pre><div class="para">
					If you are not using Automatic Proxy Discovery (see <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Overview.html#Automatic_Proxy_Discovery">Automatic Proxy Discovery</a>), configure worker nodes with a static list of proxies. Refer to <a class="xref" href="chap-HTTP_Connector_Guide-JBoss_HTTP_Advanced_Configure.html#static-proxy-configuration">Section 9.1, “Static proxy configuration”</a> for directions. In this case you can safely ignore the following warning message:
				</div><pre class="screen">[warning] mod_advertise: ServerAdvertise Address or Port not defined, Advertise disabled!!!</pre></li></ol></div></div></div></div></body></html>