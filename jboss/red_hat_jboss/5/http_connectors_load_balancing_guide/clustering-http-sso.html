<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 19. Using clustered Single Sign-on (SSO)</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="clustering-http-sso">
      ⁠</a>Chapter 19. Using clustered Single Sign-on (SSO)</h1></div></div></div><div class="para">
			JBoss supports clustered single sign-on (SSO), allowing a user to authenticate to one web application and to be recognized on all web applications that are deployed on the same virtual host, regardless of whether they are deployed on that same machine or on another node in the cluster.
		</div><div class="para">
			Authentication replication is handled by JBoss Cache. Clustered single sign-on support is a JBoss-specific extension of the non-clustered <code class="literal">org.apache.catalina.authenticator.SingleSignOn</code> valve that is a standard part of Tomcat and JBoss Web.
		</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="clustering-sso-configuration">
      ⁠</a>19.1. Configuration</h1></div></div></div><div class="para">
				To enable clustered single sign-on, you must add the <code class="literal">ClusteredSingleSignOn</code> valve to the appropriate <code class="literal">Host</code> elements of the <code class="literal">JBOSS_HOME/server/<em class="replaceable">PROFILE</em>/deploy/jbossweb.sar/server.xml</code> file. The valve element is already included in the standard file; you just need to uncomment it. The valve configuration is shown here:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>Valve className="org.jboss.web.tomcat.service.sso.ClusteredSingleSignOn" /</pre><div class="para">
				The element supports the following attributes:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>className</strong></span> is a required attribute to set the Java class name of the valve implementation to use. This must be set to <code class="literal">org.jboss.web.tomcat.service.sso.ClusteredSingleSign</code>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>cacheConfig</strong></span> is the name of the cache configuration to use for the clustered SSO cache. Default is <code class="literal">clustered-sso</code>.
					</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							For more information about cache configuration, refer to <em class="citetitle"> The JBoss Enterprise Application Platform CacheManager Service </em> section in the <em class="citetitle"> Administration and Configuration Guide </em> .
						</div></div></div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>treeCacheName</strong></span> is deprecated; use <code class="literal">cacheConfig</code>. Specifies a JMX ObjectName of the JBoss Cache MBean to use for the clustered SSO cache. If no cache can be located from the CacheManager service using the value of <code class="literal">cacheConfig</code>, an attempt to locate an MBean registered in JMX under this ObjectName will be made. Default value is <code class="literal">jboss.cache:service=TomcatClusteringCache</code>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>cookieDomain</strong></span> is used to set the host domain to be used for SSO cookies. See <a class="xref" href="clustering-http-sso.html#clustering-sso-cookie-domain">Section 19.4, “Configuring the cookie domain”</a> for more. Default is <code class="literal">"/"</code>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>maxEmptyLife</strong></span> is the maximum number of seconds an SSO with no active sessions will be usable by a request. The clustered SSO valve tracks which cluster nodes are managing sessions related to an SSO. When a node is shutdown, all local copies of a session are invalidated. If a further user request is made within the time specified by <em class="parameter"><code>maxEmptyLife</code></em>, the request will fail over to another cluster node, activating the backup copy of the session. If <em class="parameter"><code>maxEmptyLife</code></em> is set to <code class="literal">0</code>, the SSO valve terminates together with the local session copies. Default is <code class="literal">1800</code>, (30 minutes).
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>processExpiresInterval</strong></span> is the minimum number of seconds between efforts by the valve to find and invalidate SSOs that have exceeded their <em class="parameter"><code>maxEmptyLife</code></em>. Does not imply effort will be spent on such cleanup every <em class="parameter"><code>processExpiresInterval</code></em>, just that it will not occur more frequently than that. Default is <code class="literal">60</code>.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>requireReauthentication</strong></span> is a flag to determine whether each request needs to be reauthenticated to the security <span class="emphasis"><em>Realm</em></span>. If <code class="literal">true</code>, this valve uses cached security credentials (username and password) to reauthenticate to the JBoss Web security <span class="emphasis"><em>Realm</em></span> for each request associated with an SSO session. If <code class="literal">false</code>, the valve can itself authenticate requests based on the presence of a valid SSO cookie, without rechecking with the <span class="emphasis"><em>Realm</em></span>. Setting to <code class="literal">true</code> can allow web applications with different <code class="literal">security-domain</code> configurations to share an SSO. Default is <code class="literal">false</code>.
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="clustering-sso-behavior">
      ⁠</a>19.2. SSO behavior</h1></div></div></div><div class="para">
				The user will not be challenged as long as they access only unprotected resources in any of the web applications on the virtual host.
			</div><div class="para">
				Upon access to a protected resource in any web app, the user will be challenged to authenticate, using the log in method defined for the web app.
			</div><div class="para">
				Once authenticated, the roles associated with this user will be utilized for access control decisions across all of the associated web applications, without challenging the user to authenticate themselves to each application individually.
			</div><div class="para">
				If the web application invalidates a session (by invoking the <code class="literal">javax.servlet.http.HttpSession.invalidate()</code> method), the user's sessions in all web applications will be invalidated.
			</div><div class="para">
				A session timeout does not invalidate the SSO if other sessions are still valid.
			</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="clustering-sso-limitations">
      ⁠</a>19.3. Limitations</h1></div></div></div><div class="para">
				There are a number of known limitations to this Tomcat valve-based SSO implementation: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							Only useful within a cluster of EAP instances; SSO does not propagate to other resources.
						</div></li><li class="listitem"><div class="para">
							Requires use of container-managed authentication (via <code class="literal">login-config</code> element in <code class="filename">web.xml</code>).
						</div></li><li class="listitem"><div class="para">
							Requires cookies. SSO is maintained via a cookie and URL rewriting is not supported.
						</div></li><li class="listitem"><div class="para">
							Unless <code class="literal">requireReauthentication</code> is set to <code class="literal">true</code>, all web applications configured for the same SSO valve must share the same JBoss Web <code class="literal">Realm</code> and JBoss Security <code class="literal">security-domain</code>. This means: 
							<div class="itemizedlist"><ul><li class="listitem"><div class="para">
										In <code class="literal">server.xml</code> you can nest the <code class="literal">Realm</code> element inside the <code class="literal">Host</code> element (or the surrounding <code class="literal">Engine</code> element), but not inside a <code class="literal">context.xml</code> packaged with one of the involved web applications.
									</div></li><li class="listitem"><div class="para">
										The <code class="literal">security-domain</code> configured in <code class="filename">jboss-web.xml</code> or <code class="filename">jboss-app.xml</code> must be consistent for all of the web applications.
									</div></li><li class="listitem"><div class="para">
										Even if you set <code class="literal">requireReauthentication</code> to <code class="literal">true</code> and use a different <code class="literal">security-domain</code> (or, less likely, a different <code class="literal">Realm</code>) for different webapps, the varying security integrations must all accept the same credentials (for example,. username and password).
									</div></li></ul></div>

						</div></li></ul></div>

			</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="clustering-sso-cookie-domain">
      ⁠</a>19.4. Configuring the cookie domain</h1></div></div></div><div class="para">
				The SSO valve supports a <code class="literal">cookieDomain</code> configuration attribute. This attribute allows configuration of the SSO cookie's domain (the set of hosts to which the browser will present the cookie). By default the domain is <code class="literal">"/"</code>, meaning the browser will only present the cookie to the host that issued it. The <code class="literal">cookieDomain</code> attribute allows the cookie to be scoped to a wider domain.
			</div><div class="para">
				For example, suppose we have a case where two apps, with URLs <code class="literal">http://app1.xyz.com</code> and <code class="literal">http://app2.xyz.com</code>, that wish to share an SSO context. These apps could be running on different servers in a cluster or the virtual host with which they are associated could have multiple aliases. This can be supported with the following configuration: 
<pre class="programlisting"><span xmlns="" class="line">​</span>Valve className="org.jboss.web.tomcat.service.sso.ClusteredSingleSignOn"
<span xmlns="" class="line">​</span>      cookieDomain="xyz.com" /</pre>

			</div></div></div></body></html>