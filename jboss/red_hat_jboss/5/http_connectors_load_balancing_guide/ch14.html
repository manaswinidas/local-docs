<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 14. Configuring the ISAPI connector on Windows</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm139711977619056">
      ⁠</a>Chapter 14. Configuring the ISAPI connector on Windows</h1></div></div></div><div class="para">
		Read this chapter to learn how to configure the ISAPI connector to use JBoss Enterprise Application Platform as a worker node for a Windows Server 2003 or 2008 master node.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ISAPI_Prerequisites">
      ⁠</a>14.1. Prerequisites and configuration assumptions</h1></div></div></div><div class="para">
			Complete the following prerequisites before continuing with the tasks that follow:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					On the master node install one of the following technology combinations, and the appropriate Native binary for its operating system and architecture.
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							Windows Server 2003 (32-bit) with Microsoft IIS 6
						</div></li><li class="listitem"><div class="para">
							Windows Server 2003 (64-bit) with Microsoft IIS 6
						</div></li><li class="listitem"><div class="para">
							Windows Server 2008 (32-bit) with Microsoft IIS 7.0
						</div></li><li class="listitem"><div class="para">
							Windows Server 2008 (64-bit) with Microsoft IIS 7.0
						</div></li></ul></div></li><li class="listitem"><div class="para">
					On the worker nodes install JBoss Enterprise Application Platform 5.2 or later. The Native components are optional for worker nodes.
				</div></li></ul></div><div class="para">
			Refer to the <em class="citetitle"> Installation Guide </em> for assistance with these installation prerequisites.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139711986022656">
      ⁠</a>14.2. Configure server instance as a worker node</h1></div></div></div><div class="task"><p class="title"><strong>Task: Configure Server Instance as a Worker Node</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to correctly configure your JBoss Enterprise Application Platform instance as a worker node for use with Microsoft Internet Information Services (IIS).
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711986024832">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="ch14.html#ISAPI_Prerequisites">Section 14.1, “Prerequisites and configuration assumptions”</a>
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Create a server profile for each worker node</strong></p><div class="para">
					Make a copy of the server profile you want to configure as a worker node, and rename it - <code class="literal">worker-01</code> for example.
				</div></li><li class="step"><p class="title"><strong>Give each instance a unique name</strong></p><div class="para">
					Edit the following line in the <code class="filename"><em class="replaceable">PROFILE</em>\deploy\jbossweb.sar\server.xml</code> file of each new worker instance:
				</div><pre class="screen"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Engine</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.web"</span><span xmlns="" class="perl_Others"> defaultHost=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Keyword">&gt;</span></pre><div class="para">
					Add a unique <code class="varname"> jvmRoute </code> value, as shown. This value is the identifier for this node in the cluster.
				</div><div class="para">
					
<pre class="screen"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Engine</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.web"</span><span xmlns="" class="perl_Others"> defaultHost=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Others"> jvmRoute=</span><span xmlns="" class="perl_String">"worker-01"</span><span xmlns="" class="perl_Keyword">&gt;</span></pre>

				</div></li><li class="step"><p class="title"><strong>Enable session handling</strong></p><div class="para">
					Uncomment the following line in the <code class="filename"><em class="replaceable">PROFILE</em>\deployers\jbossweb.deployer\META-INF\war-deployers-jboss-beans.xml</code> file of each worker node:
				</div><pre class="screen XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useJK"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span></pre><div class="para">
					This property controls whether special session handling is used to coordinate with mod_jk and other connector variants. Set this property to <code class="literal">true</code> in both worker nodes:
				</div><pre class="screen XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useJK"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span></pre></li><li class="step"><p class="title"><strong>Start worker nodes</strong></p><div class="para">
					Start each worker node in a separate command line interface. Ensure that each node is bound to a different IP address with the <code class="code">--host</code> switch and that the profile is specified with the <code class="code">-c</code> switch.
				</div><pre class="screen"><em class="replaceable">JBOSS_EAP_DIST</em>\bin\run.bat --host=<em class="replaceable">127.0.0.1</em> -c <em class="replaceable">worker-01</em></pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Microsoft_IIS6">
      ⁠</a>14.3. Microsoft IIS 6 initial clustering configuration</h1></div></div></div><div class="para">
			Microsoft IIS 6 contains basic ISAPI filters and ISAPI mapping as part of the default installation. Here we create a filter to direct web requests to JBoss Enterprise Application Platform.
		</div><div class="task"><p class="title"><strong>Task: Define ISAPI Filter</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to define the ISAPI Filter on the Master server using the management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					On the master server, open IIS Manager:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="guimenu"><strong>Start</strong></span> → <span class="guimenuitem"><strong> Run </strong></span>, then type <strong class="userinput"><code> inetmgr </code></strong> and hit Enter.
						</div></li><li class="listitem"><div class="para">
							<span class="guimenu"><strong>Start</strong></span> → <span class="guimenuitem"><strong> Control Panel </strong></span> → <span class="guimenuitem"><strong> Administrative Tools </strong></span> → <span class="guimenuitem"><strong> Internet Information Services (IIS) Manager </strong></span>
						</div></li></ul></div><div class="para">
					The IIS 6 Manager window opens.
				</div></li><li class="step"><div class="para">
					In the tree view pane, expand <span class="guimenuitem"><strong> Web Sites </strong></span>
				</div></li><li class="step"><div class="para">
					Right click on <span class="guilabel"><strong>Default Web Site</strong></span>, and then click <span class="guimenuitem"><strong> Properties </strong></span>
				</div><div class="para">
					The Properties window opens.
				</div></li><li class="step"><div class="para">
					Click the <span class="guilabel"><strong>ISAPI Filters</strong></span> tab.
				</div></li><li class="step"><div class="para">
					Click the <span class="guibutton"><strong>Add</strong></span> button, and specify the following values in the <span class="guilabel"><strong>Add/Edit Filter Properties</strong></span> window:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Filter name:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> jboss </code></strong> (exactly as written).
							</div></dd><dt><span class="term">Executable:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\isapi_redirect.dll</code> </code></strong> .
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>OK</strong></span> to save the values, and close the <span class="guilabel"><strong>Add/Edit Filter Properties</strong></span> dialog.
				</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The <span class="guilabel"><strong>ISAPI Filters</strong></span> tab now displays the <code class="literal">jboss</code> filter status and priority as Unknown because IIS has not yet received requests for the resource. The status and priority will change to Loaded and High respectively once a request is executed.
					</div></div></div></li></ol></div></div><div class="task"><p class="title"><strong>Task: Define ISAPI Virtual Directory</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to define the ISAPI virtual directory using the IIS management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Right click on <span class="guilabel"><strong>Default Web Site</strong></span>, and then click <span class="guibutton"><strong>New</strong></span> → <span class="guimenuitem"><strong> Add Virtual Directory </strong></span>.
				</div><div class="para">
					The Add Virtual Directory window opens.
				</div></li><li class="step"><div class="para">
					Specify the following values in the <span class="guilabel"><strong>Add Virtual Directory</strong></span> window:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Alias:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> jboss </code></strong> (exactly as written).
							</div></dd><dt><span class="term">Physical path:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\</code> </code></strong> .
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>OK</strong></span> to save the values and close the <span class="guilabel"><strong>Add Virtual Directory</strong></span> window.
				</div></li><li class="step"><div class="para">
					In the tree view pane, expand <span class="guimenu"><strong>Web Sites</strong></span> → <span class="guimenuitem"><strong> Default Web Site </strong></span>.
				</div></li><li class="step"><div class="para">
					Right click on the <code class="literal">jboss</code> virtual directory, and then click <span class="guimenuitem"><strong> Properties </strong></span>.
				</div></li><li class="step"><div class="para">
					Click the <span class="guilabel"><strong>Virtual Directory</strong></span> tab, and make the following changes:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Execute Permissions:</span></dt><dd><div class="para">
								Select <strong class="userinput"><code> Scripts and Executables </code></strong> .
							</div></dd><dt><span class="term">Read check box:</span></dt><dd><div class="para">
								Select to activate Read access.
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click OK to save the values and close the <span class="guilabel"><strong>jboss Properties</strong></span> window.
				</div></li></ol></div></div><div class="task"><p class="title"><strong>Task: Define ISAPI Web Service Extension</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to define the ISAPI web service extension using the management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Click <span class="guilabel"><strong>Web Service Extensions</strong></span>, and in the <span class="guilabel"><strong>Tasks</strong></span> group select <span class="guimenu"><strong>Add a new Web service extension</strong></span>.
				</div><div class="para">
					The <span class="guilabel"><strong>New Web Service Extension</strong></span> window opens.
				</div></li><li class="step"><div class="para">
					Add the following values to the <span class="guilabel"><strong>New Web Service Extension</strong></span> window:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Extension name:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> jboss </code></strong> (exactly as written).
							</div></dd><dt><span class="term">Required files:</span></dt><dd><div class="para">
								Specify the path <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\isapi_redirect.dll</code> </code></strong> .
							</div></dd><dt><span class="term">Set extension status to Allowed:</span></dt><dd><div class="para">
								Select the check box.
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click OK to save the values and close the <span class="guilabel"><strong>New Web Service Extension</strong></span> window.
				</div></li><li class="step"><div class="para">
					Confirm the <code class="literal">jboss</code> Web Service Extension displays in the list.
				</div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Microsoft_IIS7">
      ⁠</a>14.4. Microsoft IIS 7 initial clustering configuration</h1></div></div></div><div class="para">
			Microsoft IIS 7 can be managed using the Management Console, or through the command prompt using the <code class="command">APPCMD.EXE</code> command tool.
		</div><div class="variablelist"><p class="title"><strong>Terms</strong></p><dl class="variablelist"><dt><span class="term">ISAPI and CGI Restrictions</span></dt><dd><div class="para">
						ISAPI and CGI restrictions are request handlers that allow dynamic content to execute on a server. These restrictions are either CGI files (<code class="filename">.exe</code>) or ISAPI extensions (<code class="filename">.dll</code>). You can add custom ISAPI or CGI restrictions if the IIS configuration system allows this. [<span class="citation"> <a href="http://technet.microsoft.com/en-us/library/cc730912(WS.10).aspx">Configuring ISAPI and CGI Restrictions in IIS 7</a> </span>] .
					</div></dd></dl></div><div class="task"><p class="title"><strong>Task: Define a JBoss Native ISAPI Restriction</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to define an ISAPI Restriction using the management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					On the master server, open IIS Manager:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="guimenu"><strong>Start</strong></span> → <span class="guimenuitem"><strong> Run </strong></span>, then type <strong class="userinput"><code> inetmgr </code></strong> and hit Enter.
						</div></li><li class="listitem"><div class="para">
							<span class="guimenu"><strong>Start</strong></span> → <span class="guimenuitem"><strong> Control Panel </strong></span> → <span class="guimenuitem"><strong> Administrative Tools </strong></span> → <span class="guimenuitem"><strong> Internet Information Services (IIS) Manager </strong></span>
						</div></li></ul></div><div class="para">
					The IIS 7 Manager window opens.
				</div></li><li class="step"><div class="para">
					In the tree view pane, select <span class="guimenuitem"><strong> IIS 7 </strong></span> (referred to as Server Home).
				</div><div class="para">
					The IIS 7 Home Features View opens.
				</div></li><li class="step"><div class="para">
					Double-click <span class="guilabel"><strong>ISAPI and CGI Restrictions</strong></span>.
				</div><div class="para">
					The <span class="guilabel"><strong>ISAPI and CGI Restrictions</strong></span> Features View opens.
				</div></li><li class="step"><div class="para">
					In the <span class="guilabel"><strong>Actions</strong></span> pane, click <span class="guibutton"><strong>Add</strong></span>.
				</div><div class="para">
					The <span class="guilabel"><strong>Add ISAPI or CGI Restriction</strong></span> window opens.
				</div></li><li class="step"><div class="para">
					Specify the following values in the <span class="guilabel"><strong>Add ISAPI or CGI Restriction</strong></span> window:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">ISAPI or CGI Path:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> <em class="replaceable">NATIVE</em>\sbin\isapi_redirect.dll </code></strong> .
							</div></dd><dt><span class="term">Description:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> <code class="filename">jboss</code> </code></strong> (exactly as written).
							</div></dd><dt><span class="term">Allow extension path to execute</span></dt><dd><div class="para">
								Select the check box.
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>OK</strong></span> to save the values, and close the <span class="guilabel"><strong>Add ISAPI or CGI Restriction</strong></span> window.
				</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The <span class="guilabel"><strong>ISAPI and CGI Restrictions</strong></span> Features View now displays the <code class="literal">jboss</code> restriction and path.
					</div></div></div></li></ol></div></div><div class="task"><p class="title"><strong>Task: Define a JBoss Native Virtual Directory</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to define a virtual directory for the JBoss Native binary using the management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Right click on <span class="guilabel"><strong>Default Web Site</strong></span>, and then click <span class="guimenuitem"><strong> Add Virtual Directory </strong></span> .
				</div><div class="para">
					The Add Virtual Directory window opens
				</div></li><li class="step"><div class="para">
					Specify the following values in the <span class="guilabel"><strong>Add Virtual Directory</strong></span> window:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Alias:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> jboss </code></strong> (exactly as written).
							</div></dd><dt><span class="term">Physical path:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\</code> </code></strong> .
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>OK</strong></span> to save the values and close the <span class="guilabel"><strong>Add Virtual Directory</strong></span> window.
				</div></li></ol></div></div><div class="task"><p class="title"><strong>Task: Define a JBoss Native ISAPI Redirect Filter</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to define a JBoss Native ISAPI Redirect Filter using the management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					In the tree view pane, expand <span class="guimenu"><strong>Sites</strong></span> → <span class="guimenuitem"><strong> Default Web Site </strong></span>.
				</div></li><li class="step"><div class="para">
					Double-click <span class="guilabel"><strong>ISAPI Filters</strong></span>.
				</div><div class="para">
					The <span class="guilabel"><strong>ISAPI Filters</strong></span> Features View opens.
				</div></li><li class="step"><div class="para">
					In the <span class="guilabel"><strong>Actions</strong></span> pane, click <span class="guibutton"><strong>Add</strong></span>.
				</div><div class="para">
					The <span class="guilabel"><strong>Add ISAPI Filter</strong></span> window opens.
				</div></li><li class="step"><div class="para">
					Specify the following values in the <span class="guilabel"><strong>Add ISAPI Filter</strong></span> window:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Filter name:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> jboss </code></strong> (exactly as written).
							</div></dd><dt><span class="term">Executable:</span></dt><dd><div class="para">
								Specify <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\isapi_redirect.dll</code> </code></strong> .
							</div></dd></dl></div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>OK</strong></span> to save the values and close the <span class="guilabel"><strong>Add ISAPI Filters</strong></span> window.
				</div></li></ol></div></div><div class="task"><p class="title"><strong>Task: Enable the ISAPI-dll Handler</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to enable the ISAPI-dll handler using the management console.
		</div>
		 </div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					In the tree view pane, select <span class="guimenuitem"><strong> IIS 7 </strong></span> (referred to as Server Home).
				</div><div class="para">
					The IIS 7 Home Features View opens.
				</div></li><li class="step"><div class="para">
					Double-click <span class="guilabel"><strong>Handler Mappings</strong></span>.
				</div><div class="para">
					The <span class="guilabel"><strong>Handler Mappings</strong></span> Features View opens.
				</div></li><li class="step"><div class="para">
					In the <span class="guilabel"><strong>Group by</strong></span> drop down box, select <span class="guimenuitem"><strong> State </strong></span> .
				</div><div class="para">
					The Handler Mappings are displayed in Enabled and Disabled groups.
				</div></li><li class="step"><div class="para">
					If <code class="filename">ISAPI-dll</code> is in the Disabled group, right mouse click and select <span class="guimenuitem"><strong> Edit Feature Permissions </strong></span> .
				</div></li><li class="step"><div class="para">
					Ensure the <span class="guibutton"><strong>Read</strong></span>, <span class="guibutton"><strong>Script</strong></span>, and <span class="guibutton"><strong>Execute</strong></span> check boxes are selected.
				</div></li><li class="step"><div class="para">
					Click <span class="guibutton"><strong>OK</strong></span> to save the values and close the <span class="guilabel"><strong>Edit Feature Permissions</strong></span> window.
				</div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Basic_Cluster_ISAPI">
      ⁠</a>14.5. Configure a basic cluster with ISAPI</h1></div></div></div><div class="task"><p class="title"><strong>Task: Configure ISAPI to serve a Basic Cluster</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to configure ISAPI to manage applications common to all servers on a single IP address range, and route application requests to the correct server instance.
		</div>
		 <div class="para">
			Use the configuration as an example when configuring your ISAPI cluster.
		</div>
		 <div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				This task does not provide instructions for load-balancing or server outage fail over. Refer to <a class="xref" href="ch14.html#Configure_Load-balancing_Cluster_ISAPI">Section 14.6, “Configure a load-balancing cluster with ISAPI”</a> for configuration instructions.
			</div></div></div>
		 </div><div class="taskprerequisites"><a id="idm139711921922448">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Complete the relevant Microsoft IIS clustering setup procedure. Refer to <a class="xref" href="ch14.html#Configure_Microsoft_IIS6">Section 14.3, “Microsoft IIS 6 initial clustering configuration”</a> or <a class="xref" href="ch14.html#Configure_Microsoft_IIS7">Section 14.4, “Microsoft IIS 7 initial clustering configuration”</a> for more information.
				</div></li><li class="listitem"><div class="para">
					The following steps assume that the <code class="filename">C:\connectors</code> directory is used to store logs, properties files, and NSAPI locks.
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Create isapi_redirect.properties file</strong></p><div class="para">
					Create a new file named <code class="filename">isapi_redirect.properties</code> in the <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\</code> </code></strong> directory.
				</div><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						The <code class="filename">isapi_redirect.properties</code> file must be in the same directory as the <code class="filename">isapi_redirect.dll</code> file.
					</div></div></div><div class="para">
					Append the following configuration block to <code class="filename">isapi_redirect.properties</code>:
				</div><pre class="programlisting"># Configuration file for the ISAPI Redirector
# Extension uri definition
extension_uri=/jboss/isapi_redirect.dll

# Full path to the log file for the ISAPI Redirector
log_file=c:\connectors\isapi_redirect.log

# Log level (debug, info, warn, error or trace)
# Use debug only testing phase, for production switch to info
log_level=debug

# Full path to the workers.properties file
worker_file=c:\connectors\workers.properties

# Full path to the uriworkermap.properties file
worker_mount_file=c:\connectors\uriworkermap.properties

#Full path to the rewrite.properties file 
rewrite_rule_file=c:\connectors\rewrite.properties</pre></li><li class="step"><p class="title"><strong>Optional: Create rewrite.properties file</strong></p><div class="para">
					The <code class="filename">rewrite.properties</code> file allows you to specify simple URL rewrites specific to an application. This configuration file is optional, and can be excluded from the <code class="filename">isapi_redirect.properties</code> file if URL rewrites are not required.
				</div><div class="para">
					The functionality offered is similar to Apache HTTP Server's mod_rewrite, but is less powerful. You specify the rewrite path using name-value pairs. A simple example is where the app_01 application has an abstract directory name, containing images, and you want to remap that directory to something more intuitive.
				</div><pre class="programlisting">#Simple example, images are accessible under abc path
/app-01/abc/=/app-01/images/</pre></li><li class="step"><p class="title"><strong>Create uriworkermap.properties file</strong></p><div class="para">
					The <code class="filename">uriworkermap.properties</code> file contains deployed application mapping configuration information. Append the following lines to the file.
				</div><pre class="programlisting"># images and css files for path /status are provided by worker01
/status=worker01
/images/*=worker01
/css/*=worker01

# Path /web-console is provided by worker02
# IIS (customized) error page is used for http errors with number greater or equal to 400
# css files are provided by worker01
/web-console/*=worker02;use_server_errors=400
/web-console/css/*=worker01

# Example of exclusion from mapping, logo.gif will not be displayed  
# !/web-console/images/logo.gif=*

# Requests to /app-01 or /app-01/something will be routed to worker01
/app-01|/*=worker01

# Requests to /app-02 or /app-02/something will be routed to worker02
/app-02|/*=worker02</pre></li><li class="step"><p class="title"><strong>Create workers.properties file</strong></p><div class="para">
					The <code class="filename">worker.properties</code> file contains mapping definitions between worker labels and server instances. Append the following lines to the file.
				</div><pre class="programlisting"># An entry that lists all the workers defined
worker.list=worker01, worker02

# Entries that define the host and port associated with these workers

# First EAP server definition, port 8009 is standard port for AJP in EAP 
worker.worker01.host=127.0.0.1
worker.worker01.port=8009
worker.worker01.type=ajp13

# Second EAP server definition
worker.worker02.host= 127.0.0.100
worker.worker02.port=8009
worker.worker02.type=ajp13</pre></li><li class="step"><p class="title"><strong>Restart IIS</strong></p><div class="para">
					Restart your IIS server to implement the changes. Execute the following commands for the IIS version you are running:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">IIS 6</span></dt><dd><div class="para">
								
<pre class="screen">C:\&gt; net stop iisadmin /Y
C:\&gt; net start w3svc</pre>

							</div></dd><dt><span class="term">IIS 7</span></dt><dd><div class="para">
								
<pre class="screen">C:\&gt; net stop was /Y
C:\&gt; net start w3svc</pre>

							</div></dd></dl></div></li><li class="step"><p class="title"><strong>Verify the Logs</strong></p><div class="para">
					Ensure you check the ISAPI logs once IIS has restarted. The logs are saved to the file location specified in the <span class="property"> log_file </span> property in <code class="filename">isapi_redirect.properties</code>. You should also check IIS logs and the Event Viewer for other events of type Warning or Error.
				</div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configure_Load-balancing_Cluster_ISAPI">
      ⁠</a>14.6. Configure a load-balancing cluster with ISAPI</h1></div></div></div><div class="task"><p class="title"><strong>Task: Configure ISAPI to serve a Load-Balancing Cluster</strong></p><div class="tasksummary"> <div class="para">
			Complete this task to configure ISAPI to manage applications common to all servers, route requests to JBoss Enterprise Application Platform instances, and redirect requests to live nodes when some nodes are not online or experiencing connectivity issues.
		</div>
		 <div class="para">
			Use the configuration as an example when configuring your ISAPI cluster.
		</div>
		 </div><div class="taskprerequisites"><a id="idm139711977016528">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
		 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Complete the relevant Microsoft IIS clustering setup procedure. Refer to <a class="xref" href="ch14.html#Configure_Microsoft_IIS6">Section 14.3, “Microsoft IIS 6 initial clustering configuration”</a> or <a class="xref" href="ch14.html#Configure_Microsoft_IIS7">Section 14.4, “Microsoft IIS 7 initial clustering configuration”</a> for more information.
				</div></li><li class="listitem"><div class="para">
					The following steps assume that the <code class="filename">C:\connectors</code> directory is used to store logs, properties files, and NSAPI locks.
				</div></li></ul></div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Create isapi_redirect.properties file</strong></p><div class="para">
					Create a new file named <code class="filename">isapi_redirect.properties</code> in the <strong class="userinput"><code> <code class="filename"><em class="replaceable">NATIVE</em>\sbin\</code> </code></strong> directory.
				</div><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						The <code class="filename">isapi_redirect.properties</code> file must be in the same directory as the <code class="filename">isapi_redirect.dll</code> file.
					</div></div></div><div class="para">
					Append the following configuration block to the file:
				</div><pre class="programlisting"># Configuration file for the ISAPI Redirector
# Extension uri definition
extension_uri=/jboss/isapi_redirect.dll

# Full path to the log file for the ISAPI Redirector
log_file=c:\connectors\isapi_redirect.log

# Log level (debug, info, warn, error or trace)
# Use debug only testing phase, for production switch to info
log_level=debug

# Full path to the workers.properties file
worker_file=c:\connectors\workers.properties

# Full path to the uriworkermap.properties file
worker_mount_file=c:\connectors\uriworkermap.properties

#OPTIONAL: Full path to the rewrite.properties file 
rewrite_rule_file=c:\connectors\rewrite.properties</pre></li><li class="step"><p class="title"><strong>Optional: Create rewrite.properties file</strong></p><div class="para">
					The <code class="filename">rewrite.properties</code> file allows you to specify simple URL rewrites specific to an application. This configuration file is optional, and can be excluded from the <code class="filename">isapi_redirect.properties</code> file if URL rewrites are not required.
				</div><div class="para">
					The functionality offered is similar to Apache HTTP Server's mod_rewrite, but is less powerful. You specify the rewrite path using name-value pairs. A simple example is where the app_01 application has an abstract directory name containing images, and you want to remap that directory to something more intuitive.
				</div><pre class="programlisting">#Simple example, images are accessible under abc path
/app-01/abc/=/app-01/images/</pre></li><li class="step"><p class="title"><strong>Create uriworkermap.properties file</strong></p><div class="para">
					The <code class="filename">uriworkermap.properties</code> file contains deployed application mapping configuration information. Append the following lines to the file.
				</div><pre class="programlisting"># images, css files, path /status and /web-console will provided by nodes defined in load-balancer
/css/*=router
/images/*=router
/status=router
/web-console|/*=router

# Example of exclusion from mapping, logo.gif will not be displayed  
!/web-console/images/logo.gif=*

# Requests to /app-01 and /app-02 will be routed to nodes defined in load-balancer
/app-01|/*=router
/app-02|/*=router

# mapping for management console, nodes in cluster can be enabled or disabled here
/jkmanager|/*=status</pre></li><li class="step"><p class="title"><strong>Create workers.properties file</strong></p><div class="para">
					The <code class="filename">worker.properties</code> file contains mapping definitions between worker labels and server instances. Append the following lines to the file.
				</div><pre class="programlisting"># The advanced router LB worker
worker.list=router,status

# First EAP server definition, port 8009 is standard port for AJP in EAP
#
# lbfactor defines how much the worker will be used. 
# The higher the number, the more requests are served
# lbfactor is useful when one machine is more powerful 
# ping_mode=A – all possible probes will be used to determine that
# connections are still working

worker.worker01.port=8009
worker.worker01.host=127.0.0.1
worker.worker01.type=ajp13
worker.worker01.ping_mode=A
worker.worker01.socket_timeout=10
worker.worker01.lbfactor=3

# Second EAP server definition
worker.worker02.port=8009
worker.worker02.host= 127.0.0.100
worker.worker02.type=ajp13
worker.worker02.ping_mode=A
worker.worker02.socket_timeout=10
worker.worker02.lbfactor=1

# Define the LB worker
worker.router.type=lb
worker.router.balance_workers=worker01,worker02

# Define the status worker for jkmanager
worker.status.type=status</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						For an explanation of <code class="filename">workers.properties</code> directives, refer to <a class="xref" href="workers.properties_Reference.html">Appendix A, <em>Reference: workers.properties</em></a>.
					</div></div></div></li><li class="step"><p class="title"><strong>Restart IIS</strong></p><div class="para">
					Restart your IIS server to implement the changes. Execute the following commands for the IIS version you are running:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">IIS 6</span></dt><dd><div class="para">
								
<pre class="screen">C:\&gt; net stop iisadmin /Y
C:\&gt; net start w3svc</pre>

							</div></dd><dt><span class="term">IIS 7</span></dt><dd><div class="para">
								
<pre class="screen">C:\&gt; net stop was /Y
C:\&gt; net start w3svc</pre>

							</div></dd></dl></div></li><li class="step"><p class="title"><strong>Verify the Logs</strong></p><div class="para">
					Ensure you check the ISAPI logs once IIS has restarted. The logs are saved to the file location specified in the <span class="property"> log_file </span> property in <code class="filename">isapi_redirect.properties</code>. You should also check IIS logs and the Event Viewer for other events of type Warning or Error.
				</div></li></ol></div></div></div></div></body></html>