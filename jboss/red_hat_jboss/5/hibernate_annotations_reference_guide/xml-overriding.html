<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 3. Overriding metadata through XML</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="xml-overriding">
      ⁠</a>Chapter 3. Overriding metadata through XML</h1></div></div></div><div class="para">
		The primary target for metadata in EJB3 is annotations, but the EJB3 specification provides a way to override or replace the annotation defined metadata through an XML deployment descriptor. In the current release only pure EJB3 annotations overriding are supported. If you wish to use Hibernate specific features in some entities, you'll have to either use annotations or fallback to hbm files. You can of course mix and match annotated entities and entities describes in hbm files.
	</div><div class="para">
		The unit test suite shows some additional XML file samples.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="xml-overriding-principles">
      ⁠</a>3.1. Principles</h1></div></div></div><div class="para">
			The XML deployment descriptor structure has been designed to reflect the annotations one. So if you know the annotations structure, using the XML schema will be straightforward for you.
		</div><div class="para">
			You can define one ot more XML files describing your metadata, these files will be merged by the overriding engine.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140398628451616">
      ⁠</a>3.1.1. Global level metadata</h2></div></div></div><div class="para">
				You can define global level metadata available for all XML files. You must not define these metadata more than once per deployment.
			</div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;entity-mappings 
  xmlns="http://java.sun.com/xml/ns/persistence/orm"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm orm_1_0.xsd"
  version="1.0"&gt;

    &lt;persistence-unit-metadata&gt;
        &lt;xml-mapping-metadata-complete/&gt;
        &lt;persistence-unit-defaults&gt;
            &lt;schema&gt;myschema&lt;/schema&gt;
            &lt;catalog&gt;mycatalog&lt;/catalog&gt;
            &lt;cascade-persist/&gt;
        &lt;/persistence-unit-defaults&gt;
    &lt;/persistence-unit-metadata&gt;</pre><div class="para">
				<code class="literal">xml-mapping-metadata-complete</code> means that all entity, mapped-superclasses and embeddable metadata should be picked up from XML (ie ignore annotations).
			</div><div class="para">
				<code class="literal">schema / catalog</code> will override all default definitions of schema and catalog in the metadata (both XML and annotations).
			</div><div class="para">
				<code class="literal">cascade-persist</code> means that all associations have PERSIST as a cascade type. We recommend you to not use this feature.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="xml-overriding-principles-entity">
      ⁠</a>3.1.2. Entity level metadata</h2></div></div></div><div class="para">
				You can either define or override metadata information on a given entity.
			</div><div class="programlistingco"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
&lt;entity-mappings                                                                      <img class="callout" alt="1" src="Common_Content/images/1.png"/>
  xmlns="http://java.sun.com/xml/ns/persistence/orm"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm orm_1_0.xsd"
  version="1.0"&gt;
 
    &lt;package&gt;org.hibernate.test.annotations.reflection&lt;/package&gt;                      <img class="callout" alt="2" src="Common_Content/images/2.png"/>
    &lt;entity class="Administration" access="PROPERTY" metadata-complete="true"&gt;        <img class="callout" alt="3" src="Common_Content/images/3.png"/>
        &lt;table name="tbl_admin"&gt;                                                      <img class="callout" alt="4" src="Common_Content/images/4.png"/>
            &lt;unique-constraint&gt;
                &lt;column-name&gt;firstname&lt;/column-name&gt;
                &lt;column-name&gt;lastname&lt;/column-name&gt;
            &lt;/unique-constraint&gt;
        &lt;/table&gt;
        &lt;secondary-table name="admin2"&gt;                                               <img class="callout" alt="5" src="Common_Content/images/5.png"/>
            &lt;primary-key-join-column name="admin_id" referenced-column-name="id"/&gt;
            &lt;unique-constraint&gt;
                &lt;column-name&gt;address&lt;/column-name&gt;
            &lt;/unique-constraint&gt;
        &lt;/secondary-table&gt;
        &lt;id-class class="SocialSecurityNumber"/&gt;                                      <img class="callout" alt="6" src="Common_Content/images/6.png"/>
        &lt;inheritance strategy="JOINED"/&gt;                                              <img class="callout" alt="7" src="Common_Content/images/7.png"/>
        &lt;sequence-generator name="seqhilo" sequence-name="seqhilo"/&gt;                  <img class="callout" alt="8" src="Common_Content/images/8.png"/>
        &lt;table-generator name="table" table="tablehilo"/&gt;                             <img class="callout" alt="9" src="Common_Content/images/9.png"/>
        ...
    &lt;/entity&gt;
 
    &lt;entity class="PostalAdministration"&gt;
        &lt;primary-key-join-column name="id"/&gt;                                          <img class="callout" alt="10" src="Common_Content/images/10.png"/>
        ...
    &lt;/entity&gt;
&lt;/entity-mappings&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">entity-mappings</code>: entity-mappings is the root element for all XML files. You must declare the xml schema, the schema file is included in the hibernate-annotations.jar file, no internet access will be processed by Hibernate Annotations.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">package</code> (optional): default package used for all non qualified class names in the given deployment descriptor file.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">entity</code>: describes an entity.
						</div><div class="para">
							<code class="literal">metadata-complete</code> defines whether the metadata description for this element is complete or not (in other words, if annotations present at the class level should be considered or not).
						</div><div class="para">
							An entity has to have a <code class="literal">class</code> attribute referring to the java class the metadata applies on.
						</div><div class="para">
							You can overrides entity name through the <code class="literal">name</code> attribute, if none is defined and if an <code class="literal">@Entity.name</code> is present, then it is used (provided that metadata complete is not set).
						</div><div class="para">
							For metadata complete (see below) element, you can define an <code class="literal">access</code> (either <code class="literal">FIELD</code> or <code class="literal">PROPERTY</code> (default)). For non medatada complete element, if <code class="literal">access</code> is not defined, the @Id position will lead position, if <code class="literal">access</code> is defined, the value is used.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">table</code>: you can declare table properties (name, schema, catalog), if none is defined, the java annotation is used.
						</div><div class="para">
							You can define one or several unique constraints as seen in the example
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">secondary-table</code>: defines a secondary table very much like a regular table except that you can define the primary key / foreign key column(s) through the <code class="literal">primary-key-join-column</code> element. On non metadata complete, annotation secondary tables are used only if there is no <code class="literal">secondary-table</code> definition, annotations are ignored otherwise.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/6.png" alt="6"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">id-class</code>: defines the id class in a similar way <code class="literal">@IdClass</code> does
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/7.png" alt="7"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">inheritance</code>: defines the inheritance strategy (<code class="literal">JOINED</code>, <code class="literal">TABLE_PER_CLASS</code>, <code class="literal">SINGLE_TABLE</code>), Available only at the root entity level
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/8.png" alt="8"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">sequence-generator</code>: defines a sequence generator
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/9.png" alt="9"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">table-generator</code>: defines a table generator
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/10.png" alt="10"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal"><code class="literal">primary-key-join-column</code></code>: defines the primary key join column for sub entities when JOINED inheritance strategy is used
						</div></td></tr></table></div></div><div class="programlistingco"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 
&lt;entity-mappings 
  xmlns="http://java.sun.com/xml/ns/persistence/orm"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm orm_1_0.xsd"
  version="1.0"&gt;
 
    &lt;package&gt;org.hibernate.test.annotations.reflection&lt;/package&gt;
    &lt;entity class="Music" access="PROPERTY" metadata-complete="true"&gt;
        &lt;discriminator-value&gt;Generic&lt;/discriminator-value&gt;                           <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        &lt;discriminator-column length="34"/&gt;
        ...
    &lt;/entity&gt;
 
    &lt;entity class="PostalAdministration"&gt;
        &lt;primary-key-join-column name="id"/&gt;
        &lt;named-query name="adminById"&gt;                                               <img class="callout" alt="2" src="Common_Content/images/2.png"/>
            &lt;query&gt;select m from Administration m where m.id = :id&lt;/query&gt;
            &lt;hint name="org.hibernate.timeout" value="200"/&gt;
        &lt;/named-query&gt;
        &lt;named-native-query name="allAdmin" result-set-mapping="adminrs"&gt;            <img class="callout" alt="3" src="Common_Content/images/3.png"/>
            &lt;query&gt;select *, count(taxpayer_id) as taxPayerNumber 
            from Administration, TaxPayer
            where taxpayer_admin_id = admin_id group by ...&lt;/query&gt;
            &lt;hint name="org.hibernate.timeout" value="200"/&gt;
        &lt;/named-native-query&gt;
        &lt;sql-result-set-mapping name="adminrs"&gt;                                      <img class="callout" alt="4" src="Common_Content/images/4.png"/>
            &lt;entity-result entity-class="Administration"&gt;
                &lt;field-result name="name" column="fld_name"/&gt;
            &lt;/entity-result&gt;
            &lt;column-result name="taxPayerNumber"/&gt;
        &lt;/sql-result-set-mapping&gt;
        &lt;attribute-override name="ground"&gt;                                           <img class="callout" alt="5" src="Common_Content/images/5.png"/>
            &lt;column name="fld_ground" unique="true" scale="2"/&gt;
        &lt;/attribute-override&gt;
        &lt;association-override name="referer"&gt;
            &lt;join-column name="referer_id" referenced-column-name="id"/&gt;
        &lt;/association-override&gt;
        ...
    &lt;/entity&gt;
&lt;/entity-mappings&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">discriminator-value / discriminator-column</code>: defines the discriminator value and the column holding it when the SINGLE_TABLE inheritance strategy is chosen
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">named-query</code>: defines named queries and possibly the hints associated to them. Those definitions are additive to the one defined in annotations, if two definitions have the same name, the XML one has priority.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">named-native-query</code>: defines an named native query and its sql result set mapping. Alternatively, you can define the <code class="literal">result-class</code>. Those definitions are additive to the one defined in annotations, if two definitions have the same name, the XML one has priority.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">sql-result-set-mapping</code>: describes the result set mapping structure. You can define both entity and column mappings. Those definitions are additive to the one defined in annotations, if two definitions have the same name, the XML one has priority
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">attribute-override / association-override</code>: defines a column or join column overriding. This overriding is additive to the one defined in annotations
						</div></td></tr></table></div></div><div class="para">
				Same applies for <code class="literal">&lt;embeddable&gt;</code> and <code class="literal">&lt;mapped-superclass&gt;</code>.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140398648020608">
      ⁠</a>3.1.3. Property level metadata</h2></div></div></div><div class="para">
				You can of course define XML overriding for properties. If metadata complete is defined, then additional properties (ie at the Java level) will be ignored. Otherwise, once you start overriding a property, all annotations on the given property are ignored. All property level metadata resides in <code class="literal">entity/attributes</code>, <code class="literal">mapped-superclass/attributes</code> or <code class="literal">embeddable/attributes</code>.
			</div><pre class="programlisting">    &lt;attributes&gt;
        &lt;id name="id"&gt;
            &lt;column name="fld_id"/&gt;
            &lt;generated-value generator="generator" strategy="SEQUENCE"/&gt;
            &lt;temporal&gt;DATE&lt;/temporal&gt;
            &lt;sequence-generator name="generator" sequence-name="seq"/&gt;
        &lt;/id&gt;
        &lt;version name="version"/&gt;
        &lt;embedded name="embeddedObject"&gt;
            &lt;attribute-override name"subproperty"&gt;
                &lt;column name="my_column"/&gt;
            &lt;/attribute-override&gt;
        &lt;/embedded&gt;
        &lt;basic name="status" optional="false"&gt;
            &lt;enumerated&gt;STRING&lt;/enumerated&gt;
        &lt;/basic&gt;
        &lt;basic name="serial" optional="true"&gt;
            &lt;column name="serialbytes"/&gt;
            &lt;lob/&gt;
        &lt;/basic&gt;
        &lt;basic name="terminusTime" fetch="LAZY"&gt;
            &lt;temporal&gt;TIMESTAMP&lt;/temporal&gt;
        &lt;/basic&gt;
    &lt;/attributes&gt;</pre><div class="para">
				You can override a property through <code class="literal">id</code>, <code class="literal">embedded-id</code>, <code class="literal">version</code>, <code class="literal">embedded</code> and <code class="literal">basic</code>. Each of these elements can have subelements accordingly: <code class="literal">lob</code>, <code class="literal">temporal</code>, <code class="literal">enumerated</code>, <code class="literal">column</code>.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140398658543984">
      ⁠</a>3.1.4. Association level metadata</h2></div></div></div><div class="para">
				You can define XML overriding for associations. All association level metadata behave in <code class="literal">entity/attributes</code>, <code class="literal">mapped-superclass/attributes</code> or <code class="literal">embeddable/attributes</code>.
			</div><pre class="programlisting">    &lt;attributes&gt;
        &lt;one-to-many name="players" fetch="EAGER"&gt;
            &lt;map-key name="name"/&gt;
            &lt;join-column name="driver"/&gt;
            &lt;join-column name="number"/&gt;
        &lt;/one-to-many&gt;
        &lt;many-to-many name="roads" target-entity="Administration"&gt;
            &lt;order-by&gt;maxSpeed&lt;/order-by&gt;
            &lt;join-table name="bus_road"&gt;
                &lt;join-column name="driver"/&gt;
                &lt;join-column name="number"/&gt;
                &lt;inverse-join-column name="road_id"/&gt;
                &lt;unique-constraint&gt;
                    &lt;column-name&gt;driver&lt;/column-name&gt;
                    &lt;column-name&gt;number&lt;/column-name&gt;
                &lt;/unique-constraint&gt;
            &lt;/join-table&gt;
        &lt;/many-to-many&gt;
        &lt;many-to-many name="allTimeDrivers" mapped-by="drivenBuses"&gt;
    &lt;/attributes&gt;</pre><div class="para">
				You can override an association through <code class="literal">one-to-many</code>, <code class="literal">one-to-one</code>, <code class="literal">many-to-one</code>, and <code class="literal">many-to-many</code>. Each of these elements can have subelements accordingly: <code class="literal">join-table</code> (which can have <code class="literal">join-column</code>s and <code class="literal">inverse-join-column</code>s), <code class="literal"><code class="literal">join-column</code>s</code>, <code class="literal">map-key</code>, and <code class="literal">order-by</code>. <code class="literal">mapped-by</code> and <code class="literal">target-entity</code> can be defined as attributes when it makes sense. Once again the structure is reflects the annotations structure. You can find all semantic information in the chapter describing annotations.
			</div></div></div></div></body></html>