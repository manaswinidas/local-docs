<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 1. Setting up an annotations project</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm140398637312672">
      ⁠</a>Chapter 1. Setting up an annotations project</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setup-requirements">
      ⁠</a>1.1. Requirements</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<span class="emphasis"><em>This release requires Hibernate Core 3.3 and above.</em></span>
				</div></li><li class="listitem"><div class="para">
					This release is known to work on Hibernate Core 3.3.2.GA.
				</div></li><li class="listitem"><div class="para">
					Make sure you have JDK 5.0 installed or above. You can of course continue using XDoclet and get some of the benefits of annotation-based metadata with older JDK versions. Note that this document only describes JDK 5.0 annotations and you have to refer to the XDoclet documentation for more information.
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setup-configuration">
      ⁠</a>1.2. Configuration</h1></div></div></div><div class="para">
			First, set up your classpath (after you have created a new project in your favorite IDE): 
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Copy all Hibernate3 core and required 3rd party library files (see lib/README.txt in Hibernate).
					</div></li><li class="listitem"><div class="para">
						Copy <code class="filename">hibernate-annotations.jar</code>, <code class="filename">lib/hibernate-comons-annotations.jar</code> and <code class="filename">lib/ejb3-persistence.jar</code> from the Hibernate Annotations distribution to your classpath as well.
					</div></li></ul></div>

		</div><div class="para">
			If you wish to use <a href="http://validator.hibernate.org">Hibernate Validator</a>, download it from the Hibernate website and add <code class="filename">hibernate-validator.jar</code> in your classpath.
		</div><div class="para">
			If you wish to use <a href="http://search.hibernate.org">Hibernate Search</a>, download it from the Hibernate website and add <code class="filename">hibernate-search.jar</code> and <code class="filename">lucene-core-x.y.z.jar</code> in your classpath.
		</div><div class="para">
			We also recommend a small wrapper class to start Hibernate in a static initializer block, known as <code class="classname">HibernateUtil</code>. You might have seen this class in various forms in other areas of the Hibernate documentation. For Annotation support you have to enhance this helper class as follows: 
<pre class="programlisting">package hello;

import org.hibernate.*;
import org.hibernate.cfg.*;
import test.*;
import test.animals.Dog;

public class HibernateUtil {

private static final SessionFactory sessionFactory;

    static {
        try {

            sessionFactory = new <span class="bold bold"><strong>AnnotationConfiguration()</strong></span>
                    configure().buildSessionFactory();
        } catch (Throwable ex) {
            // Log exception!
            throw new ExceptionInInitializerError(ex);
        }
    }

    public static Session getSession()
            throws HibernateException {
        return sessionFactory.openSession();
    }
}
</pre>

		</div><div class="para">
			Interesting here is the use of <code class="classname">AnnotationConfiguration</code>. The packages and annotated classes are declared in your regular XML configuration file (usually <code class="filename">hibernate.cfg.xml</code>). Here is the equivalent of the above declaration:
		</div><pre class="programlisting">&lt;!DOCTYPE hibernate-configuration PUBLIC
    "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;

        &lt;hibernate-configuration&gt;
          &lt;session-factory&gt;
            <span class="bold bold"><strong>&lt;mapping package="test.animals"/&gt; &lt;mapping class="test.Flight"/&gt; &lt;mapping class="test.Sky"/&gt; &lt;mapping class="test.Person"/&gt; &lt;mapping class="test.animals.Dog"/&gt;</strong></span>
<span class="bold bold"><strong> &lt;mapping resource="test/animals/orm.xml"/&gt;</strong></span>
          &lt;/session-factory&gt;
        &lt;/hibernate-configuration&gt;
</pre><div class="para">
			Note that you can mix the hbm.xml use and the new annotation one. The resource element can be either an hbm file or an EJB3 XML deployment descriptor. The distinction is transparent for your configuration process.
		</div><div class="para">
			Alternatively, you can define the annotated classes and packages using the programmatic API
		</div><pre class="programlisting">            sessionFactory = new <span class="bold bold"><strong>AnnotationConfiguration() .addPackage("test.animals") //the fully qualified package name .addAnnotatedClass(Flight.class) .addAnnotatedClass(Sky.class) .addAnnotatedClass(Person.class) .addAnnotatedClass(Dog.class)</strong></span>
<span class="bold bold"><strong>.addResource("test/animals/orm.xml")</strong></span>
      configure()..buildSessionFactory();</pre><div class="para">
			You can also use the Hibernate EntityManager which has its own configuration mechanism. Please refer to this project documentation for more details.
		</div><div class="para">
			There is no other difference in the way you use Hibernate APIs with annotations, except for this start up routine change or in the configuration file. You can use your favorite configuration method for other properties ( <code class="filename">hibernate.properties</code>, <code class="filename">hibernate.cfg.xml</code>, programmatic APIs, etc). You can even mix annotated persistent classes and classic <code class="filename">hbm.cfg.xml</code> declarations with the same <code class="classname">SessionFactory</code>. You can however not declare a class several times (whether annotated or through hbm.xml). You cannot mix configuration strategies (hbm vs annotations) in a mapped entity hierarchy either.
		</div><div class="para">
			To ease the migration process from hbm files to annotations, the configuration mechanism detects the mapping duplication between annotations and hbm files. HBM files are then prioritized over annotated metadata on a class to class basis. You can change the priority using <code class="literal">hibernate.mapping.precedence</code> property. The default is <code class="literal">hbm, class</code>, changing it to <code class="literal">class, hbm</code> will prioritize the annotated classes over hbm files when a conflict occurs.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140398642886512">
      ⁠</a>1.3. Properties</h1></div></div></div><div class="para">
			Asides from the Hibernate core properties, Hibernate Annotations reacts to the following one
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140398642884656">
      ⁠</a>1.4. Logging</h1></div></div></div><div class="para">
			Hibernate Annotations utilizes <a href="http://www.slf4j.org/">Simple Logging Facade for Java</a> (SLF4J) in order to log various system events. SLF4J can direct your logging output to several logging frameworks (NOP, Simple, log4j version 1.2, JDK 1.4 logging, JCL or logback) depending on your chosen binding. In order to setup logging properly you will need <code class="filename">slf4j-api.jar</code> in your classpath together with the jar file for your preferred binding - <code class="filename">slf4j-log4j12.jar</code> in the case of Log4J. See the SLF4J <a href="http://www.slf4j.org/manual.html">documentation</a> for more detail.
		</div><div class="para">
			The logging categories interesting for Hibernate Annotations are:
		</div><div class="table"><a id="idm140398590970000">
      ⁠</a><p class="title"><strong>Table 1.1. Hibernate Annotations Log Categories</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Hibernate Annotations Log Categories"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: center"> Category </th><th style="text-align: center"> Function </th></tr></thead><tbody><tr><td> <span class="emphasis"><em>org.hibernate.cfg</em></span> </td><td> Log all configuration related events (not only annotations). </td></tr></tbody></table></div></div><div class="para">
			For further category configuration refer to the <a href="http://www.hibernate.org/hib_docs/v3/reference/en/html_single/#configuration-logging">Logging</a> in the Hibernate Core documentation.
		</div></div></div></body></html>