<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 1. Getting Started with JTA</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860793123952">
      ⁠</a>Chapter 1. Getting Started with JTA</h1></div></div></div><a id="idm139860809406704" class="indexterm"/><a id="idm139860802432432" class="indexterm"/><a id="idm139860795298640" class="indexterm"/><a id="idm139860809668240" class="indexterm"/><a id="idm139860792781296" class="indexterm"/><a id="idm139860787304880" class="indexterm"/><a id="idm139860796020816" class="indexterm"/><a id="idm139860790088416" class="indexterm"/><a id="idm139860797908592" class="indexterm"/><a id="idm139860804558352" class="indexterm"/><a id="idm139860790799840" class="indexterm"/><a id="idm139860787026112" class="indexterm"/><div class="para">
		This chapter summarizes the key features required to construct a <em class="firstterm">Java Transactions API (JTA)</em> application. If you are not familiar with the JTA, please begin by reading the first section of the <em class="citetitle">Transactions Development Guide</em>, provided as part of the Enterprise Application Platform documentation suite..
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860802377456">
      ⁠</a>1.1. Package Layout</h1></div></div></div><div class="para">
			Everything you need to write basic JTA applications is included in the Enterprise Application Platform. The key packages are detailed in <a class="xref" href="ch01.html#jta-important-packages">Packages Relating to the JTA</a>.
		</div><div class="variablelist"><a id="jta-important-packages">
      ⁠</a><p class="title"><strong>Packages Relating to the JTA</strong></p><dl class="variablelist"><dt><span class="term"><span class="package">com.arjuna.ats.jts</span></span></dt><dd><div class="para">
						Contains the JBoss Transaction Service implementation of the JTS and JTA <em class="firstterm">APIs (Application Programming Interfaces)</em>.
					</div></dd><dt><span class="term"><span class="package">com.arjuna.ats.jta</span></span></dt><dd><div class="para">
						Contains local and remote JTA implementation support.
					</div></dd><dt><span class="term"><span class="package">com.arjuna.ats.jdbc</span></span></dt><dd><div class="para">
						Contains transactional JDBC 2.0 support.
					</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860814395600">
      ⁠</a>1.2. Setting Properties</h1></div></div></div><div class="para">
			You can configure JBossJTA at runtime by setting various property attributes, either at run-time on the command line, or through a properties file. The initial properties file is located at <code class="filename"><em class="replaceable">$JBOSS_HOME</em>/server/default/conf/jbossts-properties.xml</code>.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139860814393376">
      ⁠</a>1.2.1. Specifying the Object Store Location</h2></div></div></div><div class="para">
				JBossJTA uses an object store to persistently record the outcomes of transactions, to be used in the event of failures. To customize the location of the object store, you need to pass the location when you are executing the application, as shown in <a class="xref" href="ch01.html#specifying_object_store">Example 1.1, “Specifying the Object Store”</a>.
			</div><div class="example"><a id="specifying_object_store">
      ⁠</a><p class="title"><strong>Example 1.1. Specifying the Object Store</strong></p><div class="example-contents"><pre class="screen">
	  <code class="command">java –Dcom.arjuna.ats.arjuna.objectstore.objectStoreDir=<em class="replaceable">/location/of/objectstore</em> <em class="replaceable">myprogram</em></code></pre></div></div><div class="para">
				By default, the object store is located in a a directory beneath the current execution directory.
			</div><div class="para">
				By default, all object states are stored within the <code class="filename">defaultStore</code> sub-directory of the object store root. You can change the sub-directory by setting the <code class="varname">com.arjuna.ats.arjuna.objectstore.localOSRoot</code> property variable.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860751163552">
      ⁠</a>1.3. Demarcating Transactions</h1></div></div></div><div class="para">
			The JBossJTA API consists of three elements:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					A high-level application transaction demarcation interface
				</div></li><li class="listitem"><div class="para">
					A high-level transaction manager interface intended for application server
				</div></li><li class="listitem"><div class="para">
					and a standard Java mapping of the X/Open XA protocol intended for transactional resource manager
				</div></li></ul></div><div class="para">
			All of the JTA classes and interfaces are located in the <span class="package">javax.transaction</span> package, and the corresponding JBossJTA implementations in the <span class="package">com.arjuna.ats.jta</span> package.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139860810881136">
      ⁠</a>1.3.1. <code class="interfacename">UserTransaction</code></h2></div></div></div><div class="para">
				The <code class="interfacename">UserTransaction</code> interface allows applications to control transaction boundaries.
			</div><div class="para">
				You can obtain <code class="classname">UserTransaction</code> implementations via JNDI.
			</div><div class="example"><a id="controlling_transactions">
      ⁠</a><p class="title"><strong>Example 1.2. Controlling Transactions</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>	  <span xmlns="" class="perl_Comment">// Initialize the context and get UserTransaction</span>
<span xmlns="" class="line">​</span>	  InitialContext ic = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>	  UserTransaction utx = ic.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"java:comp/UserTransaction"</span>)
<span xmlns="" class="line">​</span>	  <span xmlns="" class="perl_Comment">// start transaction work..</span>
<span xmlns="" class="line">​</span>	  utx.<span xmlns="" class="perl_Function">begin</span>();
<span xmlns="" class="line">​</span>	  .. <span xmlns="" class="perl_Keyword">do</span> work
<span xmlns="" class="line">​</span>	  utx.<span xmlns="" class="perl_Function">commit</span>();
</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139860802094768">
      ⁠</a>1.3.2. <code class="interfacename">TransactionManager</code></h2></div></div></div><div class="para">
				The <code class="interfacename">TransactionManager</code> interface allows the application server to control transaction boundaries on behalf of the application being managed.
			</div><div class="para">
				You can obtain <code class="classname">TransactionManager</code> implementations via JNDI.
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>	<span xmlns="" class="perl_Comment">// Initialize the context and get the TransactionManager</span>
<span xmlns="" class="line">​</span>	InitialContext ic = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>	TransactinoManager utm = ic.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"java:/TransactionManager"</span>)
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139860802090048">
      ⁠</a>1.3.3. <code class="interfacename">Transaction</code></h2></div></div></div><div class="para">
				The <code class="interfacename">Transaction</code> interface allows operations to be performed on the transaction associated with the target object. Every top-level transaction is associated with one <code class="interfacename">Transaction</code> object when the transaction is created. The <code class="interfacename">Transaction</code> object has several uses, as described in <a class="xref" href="ch01.html#transaction-interface-uses"><code class="interfacename">Transaction</code> Interface uses</a>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><a id="transaction-interface-uses">
      ⁠</a><p class="title"><strong><code class="interfacename">Transaction</code> Interface uses</strong></p><ul><li class="listitem"><div class="para">
						Enlists the transactional resources in use by the application.
					</div></li><li class="listitem"><div class="para">
						Register for transaction synchronization call backs.
					</div></li><li class="listitem"><div class="para">
						Commit or roll back the transaction.
					</div></li><li class="listitem"><div class="para">
						Obtain the status of the transaction.
					</div></li></ul></div><div class="para">
				You can obtain a <code class="classname">Transaction</code> object by invoking the <code class="methodname">getTransaction</code> method of the <code class="classname">TransactionManager</code> interface, as shown in <a class="xref" href="ch01.html#obtain-transaction">Example 1.3, “Obtaining a Transaction”</a>.
			</div><div class="example"><a id="obtain-transaction">
      ⁠</a><p class="title"><strong>Example 1.3. Obtaining a Transaction</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>	  Transaction txObj = TransactionManager.<span xmlns="" class="perl_Function">getTransaction</span>();
</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860810758720">
      ⁠</a>1.4. Local versus Distributed JTA Implementations</h1></div></div></div><div class="para">
			You should rely on the JTS/OTS specifications for transaction propagation among transaction managers, to ensure interoperability between JTA applications.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139860810757328">
      ⁠</a><p class="title"><strong>Procedure 1.1. Selecting the Local JTA Implementation</strong></p><ol class="1"><li class="step"><div class="para">
					Set the <span class="property">om.arjuna.ats.jta.jtaTMImplementation</span> property to <code class="literal">com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple</code>.
				</div></li><li class="step"><div class="para">
					Set the <span class="property">com.arjuna.ats.jta.jtaUTImplementation</span> to <code class="literal">com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple</code>.
				</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139860794036608">
      ⁠</a><p class="title"><strong>Procedure 1.2. Selecting the Distributed JTA Implementation</strong></p><ol class="1"><li class="step"><div class="para">
					Set the <span class="property">com.arjuna.ats.jta.jtaTMImplementation</span> property to <code class="literal">com.arjuna.ats.internal.jta.transaction.jts.TransactionManagerImple</code>.
				</div></li><li class="step"><div class="para">
					Set the <span class="property">com.arjuna.ats.jta.jtaUTImplementation</span> property to <code class="literal">com.arjuna.ats.internal.jta.transaction.jts.UserTransactionImple</code>.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860794031648">
      ⁠</a>1.5. JDBC and Transactions</h1></div></div></div><div class="para">
			JBossJTA supports the construction of both local and distributed transactional applications which access databases using the JDBC 2.0 APIs. JDBC 2.0 supports <em class="firstterm">two-phase commit</em> of transactions, and is similar to the XA X/Open standard. The JDBC 2.0 support is found in the <span class="package">com.arjuna.ats.jdbc</span> package.
		</div><div class="para">
			JBossJTA incorporates JDBC connections within transactions by providing transactional JDBC drivers through which all interactions occur. These drivers intercept all invocations and ensure that they are registered with, and driven by, appropriate transactions. There is a single type of transactional driver through which any JDBC driver can be driven. This driver is c<span class="package">om.arjuna.ats.jdbc.TransactionalDriver</span>, and it implements the <code class="interfacename">java.sql.Driver</code> interface.
		</div><div class="para">
			One way to establish the connection is through the <code class="methodname">java.sql.DriverManager.getConnection</code> method. After establishing the connection, JBossJTA monitors all operations. You can use such connections in the same way as any other JDBC driver connection.
		</div><div class="para">
			JBossJTA connections can be used within multiple different transactions simultaneously. Different threads, with different notions of the current transaction, may use the same JDBC connection. JBossJTA performs connection pooling for each transaction within the JDBC connection. Although multiple threads may use the same instance of the JDBC connection, internally a different connection instance may be used per transaction. With the exception of the <code class="methodname">close</code> method, all operations performed on the connection at the application level are only performed on this transaction-specific connection.
		</div><div class="para">
			JBossJTA automatically registers the JDBC driver connection with the transaction via an appropriate resource. When the transaction terminates, this resource either commits or rolls back any changes made to the underlying database, through appropriate calls on the JDBC driver.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139860784654928">
      ⁠</a>1.6. Configurable Options</h1></div></div></div><div class="para">
			<a class="xref" href="ch01.html#important-configurable-options">Important Configurable Options</a> shows the most important configuration features, along with possible values and defaults. For more information, consult the <em class="citetitle">Transactions Development Guide</em>.
		</div><div class="variablelist"><a id="important-configurable-options">
      ⁠</a><p class="title"><strong>Important Configurable Options</strong></p><dl class="variablelist"><dt><span class="term"><span class="property">com.arjuna.ats.jta.supportSubtransactions</span></span></dt><dd><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Possible Values</strong></p><ol><li class="listitem"><div class="para">
								Yes (default)
							</div></li><li class="listitem"><div class="para">
								No
							</div></li></ol></div></dd><dt><span class="term"><span class="property">com.arjuna.ats.jta.jtaTMImplementation</span></span></dt><dd><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Possible Values</strong></p><ol><li class="listitem"><div class="para">
								com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple
							</div></li><li class="listitem"><div class="para">
								com.arjuna.ats.internal.jta.transaction.jts.TransactionManagerImple
							</div></li></ol></div></dd><dt><span class="term"><span class="property">com.arjuna.ats.jta.jtaUTImplementation</span></span></dt><dd><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Possible Values</strong></p><ol><li class="listitem"><div class="para">
								com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple
							</div></li><li class="listitem"><div class="para">
								com.arjuna.ats.internal.jta.transaction.jts.UserTransactionImple
							</div></li></ol></div></dd><dt><span class="term"><span class="property">com.arjuna.ats.jta.xaBackoffPeriod</span></span></dt><dd><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Possible Values</strong></p><ol><li class="listitem"><div class="para">
								Time in seconds
							</div></li></ol></div></dd><dt><span class="term"><span class="property">com.arjuna.ats.jdbc.isolationLevel</span></span></dt><dd><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Possible Values</strong></p><ol><li class="listitem"><div class="para">
								Any supported JDBC isolation level
							</div></li></ol></div></dd></dl></div></div></div></body></html>