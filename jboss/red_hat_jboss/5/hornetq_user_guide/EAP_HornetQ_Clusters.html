<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 38. Colocated and Dedicated Symmetrical Cluster Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="EAP_HornetQ_Clusters">
      ⁠</a>Chapter 38. Colocated and Dedicated Symmetrical Cluster Configuration</h1></div></div></div><div class="para">
		Read this chapter to configure HornetQ <em class="firstterm">live backup groups</em> within JBoss Enterprise Application Platform. HornetQ only supports a shared store for live backup nodes, therefore the chapter covers configuring the live backup groups in this way.
	</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Live Backup Group</div>
			An instance of HornetQ running on JBoss Enterprise Application Platform that is configured to fail over to a specified group of HornetQ instances.
		</div><div class="para">
		HornetQ live backup groups are configured using one of the following topologies:
	</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Colocated</span></dt><dd><div class="para">
					Topology containing one live, and at least one back-up server running concurrently. Each backup node belongs to a live node on another JBoss Enterprise Application Platform instance.
				</div></dd><dt><span class="term">Dedicated</span></dt><dd><div class="para">
					Topology containing one live and at least one backup server. Only one server can run at any given time.
				</div></dd></dl></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905819285664">
      ⁠</a>38.1. Colocated Symmetrical Live and Backup Cluster</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				JBoss Enterprise Application Platform ships with an example configuration for this topology, located in <code class="literal">$JBOSS_HOME/extras/hornetq/resources/examples/symmetric-cluster-with-backups-colocated</code>. The <code class="filename">readme</code> in this directory provides basic configuration required to run the example.
			</div></div></div><div class="para">
			The colocated symmetrical topology contains an operational live node, and one or more backup nodes. Each backup node belongs to a live node on another JBoss Enterprise Application Platform instance.
		</div><div class="para">
			In a simple cluster of two JBoss Enterprise Application Platform instances, each JBoss Enterprise Application Platform instance would have a live server and one backup server. as described in <a class="xref" href="EAP_HornetQ_Clusters.html#exam-Colocated_Sym_Two_Inst_Config">Example 38.1, “Two Instance Configuration”</a>.
		</div><div class="example"><a id="exam-Colocated_Sym_Two_Inst_Config">
      ⁠</a><p class="title"><strong>Example 38.1. Two Instance Configuration</strong></p><div class="example-contents"><div class="mediaobject"><img src="images/simple-colocated.png" alt="Two Instance Configuration"/></div><div class="para">
				The continuous lines in <a class="xref" href="EAP_HornetQ_Clusters.html#exam-Colocated_Sym_Two_Inst_Config">Example 38.1, “Two Instance Configuration”</a>show the state of the cluster before fail over occurs. The dotted lines show the state of the cluster after fail over has occurred.
			</div><div class="para">
				Before fail over occurs, the two live servers are connected forming a cluster. Each live server is connected to its local applications through J2EE Connector Architecture (JCA). The remote clients residing are connected to their respective live servers.
			</div><div class="para">
				When fail over occurs, the HornetQ Backup connects to the still available live server (which happens to be in the same virtual machine) and takes over as the live server in the cluster. Any remote clients also fail over.
			</div><div class="para">
				Depending on what consumers and producers, and Message Driven Beans (MDBs) are available on each node, messages are distributed between the nodes to satisfy Java Message Service (JMS) requirements. For example, if a producer is sending messages to a queue on a backup server with no consumers, the messages will be distributed to a live node advertising the required consumers.
			</div></div></div><div class="para">
			<a class="xref" href="EAP_HornetQ_Clusters.html#exam-Three_Instance_Configuration">Example 38.2, “Three Instance Configuration”</a> is slightly more complex. It extends the same configuration in <a class="xref" href="EAP_HornetQ_Clusters.html#exam-Colocated_Sym_Two_Inst_Config">Example 38.1, “Two Instance Configuration”</a> and adds a third live and backup HornetQ instance.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The live cluster connections between each server have been removed to make the diagram clearer. All live servers form a cluster in the example.
			</div></div></div><div class="example"><a id="exam-Three_Instance_Configuration">
      ⁠</a><p class="title"><strong>Example 38.2. Three Instance Configuration</strong></p><div class="example-contents"><div class="mediaobject"><img src="images/simple-colocated-three-instance.png" alt="Three Instance Configuration"/></div><div class="para">
				In this example, the instance contains three separate JBoss Enterprise Application Platform servers, with a live and backup HornetQ instance in each server.
			</div><div class="para">
				Three node topology enables you to configure two backup instances for each server, which are shared across any of the three servers in the live backup group in case of a fail over event.
			</div><div class="para">
				While it is possible to configure multiple live backup groups for a server, one backup per live instance is considered sufficient for most deployments.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Colocated_Live_Server">
      ⁠</a>38.1.1. Colocated Live Server</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important - Cluster Firewall Requirements</strong></p></div><div class="admonition"><div class="para">
					If nodes can not discover each other, verify that you have configured the firewall and UDP ports correctly. The network configuration should allow nodes on a cluster to communicate with each other.
				</div></div></div><div class="para">
				Follow the procedures to configure a Colocated Live Server instance.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Create_Live_Server_Profile">
      ⁠</a><p class="title"><strong>Procedure 38.1. Create Live Server Profile</strong></p><div class="para">
					You must create a copy of the <code class="literal">production</code> profile to customize the live server configuration.
				</div><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						Always copy an included profile rather than editing it directly for your custom profile. If you make a critical mistake during configuration, you can fall back to the base configuration at any time.
					</div></div></div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/</code>
					</div></li><li class="step"><div class="para">
						Copy the <code class="literal">production</code> profile, and rename it to <code class="literal">HornetQ_Colocated</code>
					</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Config_Shared_Store_and_Journalling">
      ⁠</a><p class="title"><strong>Procedure 38.2. Configure Shared Store and Journaling</strong></p><div class="para">
					Follow this procedure to specify HornetQ must use a shared store for fail over, and define the location of the journal files each HornetQ instance in the live backup group uses.
				</div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Colocated/deploy/hornetq/</code>
					</div></li><li class="step"><div class="para">
						Open
					</div></li><li class="step"><div class="para">
						Add the <span class="markup">&lt;shared-store&gt;</span> element as a child of the <span class="markup">&lt;configuration&gt;</span> element.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;shared-store&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/shared-store&gt;</span></pre></li><li class="step"><div class="para">
						Ensure the bindings, journal, and large messages path locations are set to a location the live backup group can access.
					</div><div class="para">
						You can set absolute paths as the example describes, or use the JBoss parameters that exist in the configuration file.
					</div><div class="para">
						If you choose the parameter option, and you do not use the default paths that these parameters resolve to, you must specify the path your bindings, journal, and large messages reside in each time you start the server.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;large-messages-directory&gt;</span>/media/shared/data/serverA/large-messages<span xmlns="" class="perl_Keyword">&lt;/large-messages-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bindings-directory&gt;</span>/media/shared/data/serverA/bindings<span xmlns="" class="perl_Keyword">&lt;/bindings-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;journal-directory&gt;</span>/media/shared/data/serverA/journal<span xmlns="" class="perl_Keyword">&lt;/journal-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;paging-directory&gt;</span>/media/shared/data/ServerA/paging<span xmlns="" class="perl_Keyword">&lt;/paging-directory&gt;</span></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Ensure you specify paths that are accessible to the live backup groups on your network.
						</div></div></div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Change <em class="replaceable">ServerA</em> to the name suitable to your server instance.
						</div></div></div></li></ol></div><div class="para">
				By default, JMS clients will not fail over if a live server is shut down gracefully. Depending on the connection factory settings, a client will either fail, or try to reconnect to the live server.
			</div><div class="para">
				If you need clients to fail over on a normal server shutdown, you must alter the file according to <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Configure_JMS_Client_Graceful_Shutdown">Procedure 38.3, “Configure JMS Client Graceful Shutdown”</a>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Configure_JMS_Client_Graceful_Shutdown">
      ⁠</a><p class="title"><strong>Procedure 38.3. Configure JMS Client Graceful Shutdown</strong></p><div class="para">
					Follow this procedure to configure how JMS clients re-establish a connection if a server is shut down gracefully.
				</div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Colocated/deploy/hornetq/</code>
					</div></li><li class="step"><div class="para">
						Open <code class="filename">hornetq-configuration.xml</code>
					</div></li><li class="step"><div class="para">
						Specify the <span class="markup">&lt;fail-over-on-shutdown&gt;</span> element in the area near the journal directory configuration in <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Config_Shared_Store_and_Journalling">Procedure 38.2, “Configure Shared Store and Journaling”</a>.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;failover-on-shutdown&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/failover-on-shutdown&gt;</span></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							You are not constrained where you put the element in the <code class="filename">hornetq-configuration.xml</code> file, however it is easier to find the less detailed settings if they are all located at the top of the file.
						</div></div></div></li><li class="step"><div class="para">
						Save and close the file.
					</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					If you have set &lt;fail-over-on-shutdown&gt; to false (the default setting) but still want fail over to occur, terminate the server process directly, or call <code class="literal">forceFailover</code> through the JMX Console or the Admin Console on the core server object.
				</div></div></div><div class="para">
				The connection factories used by the client must be configured to be Highly Available. This is done by configuring connection factory attributes in the <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-jms.xml</code>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Config_HA_Connect_Factories">
      ⁠</a><p class="title"><strong>Procedure 38.4. Configure HA Connection Factories</strong></p><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Colocated/deploy/hornetq/</code>
					</div></li><li class="step"><div class="para">
						Open <code class="filename">hornetq-jms.xml</code>.
					</div></li><li class="step"><div class="para">
						Add the following attributes and values as specified below.
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <span class="markup">&lt;ha&gt;true&lt;/ha&gt;</span> </span></dt><dd><div class="para">
									Specifies the client must support high availability, and must always be true for fail over to occur.
								</div></dd><dt><span class="term">&lt;retry-interval&gt;1000&lt;/retry-interval&gt;</span></dt><dd><div class="para">
									Specifies how long the client must wait (in milliseconds) before it can reconnect to the server.
								</div></dd><dt><span class="term">&lt;retry-interval-multiplier&gt;1.0&lt;/retry-interval-multiplier&gt;</span></dt><dd><div class="para">
									Specifies the multiplier <span class="markup">&lt;retry-interval&gt;</span> used for each subsequent reconnection pauses. By setting the value to <code class="literal">1.0</code>, the retry interval is the same for each client reconnection request.
								</div></dd><dt><span class="term">&lt;reconnect-attempts&gt;-1&lt;/reconnect-attempts&gt;</span></dt><dd><div class="para">
									Specifies how many reconnect attempts a client should make before failing. Setting <code class="literal">-1</code> means unlimited reconnection attempts.
								</div></dd></dl></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version='1.0' encoding='UTF-8'<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;configuration</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:hornetq"</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span><span xmlns="" class="perl_Others"> xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:hornetq /schema/hornetq-jms.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"NettyConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;xa&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/xa&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/XAConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;ha&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/ha&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Pause 1 second between connect attempts --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;retry-interval&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/retry-interval&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Multiply subsequent reconnect pauses by this multiplier. This can be used </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       to implement an exponential back-off. For our purposes we just set to 1.0 so </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       each reconnect pause is the same length --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;retry-interval-multiplier&gt;</span>1.0<span xmlns="" class="perl_Keyword">&lt;/retry-interval-multiplier&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Try reconnecting an unlimited number of times (-1 means unlimited) --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;reconnect-attempts&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/reconnect-attempts&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/configuration&gt;</span>
</pre></li><li class="step"><div class="para">
						Define new queues in both master and backup nodes by adding one of the following configuration blocks to the specified file.
					</div><div class="para">
						For <code class="filename">production/deploy/hornetq/hornetq-jms.xml</code>
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"testQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/queue/testQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;durable&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/durable&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/queue&gt;</span></pre><div class="para">
						For <code class="filename">production/deploy/<em class="replaceable">customName</em>-hornetq-jms.xml</code>
					</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Ensure the file is well-formed from an XML validation perspective by ensuring the XML Namespace is present and correct in the file as specified.
						</div></div></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;configuration</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:hornetq"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:hornetq /schema/hornetq-jms.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"testQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/queue/testQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;durable&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/durable&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/queue&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/configuration&gt;</span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Colocated_Backup_Server">
      ⁠</a>38.1.2. Colocated Backup Server</h2></div></div></div><div class="para">
				Read this section and the contained procedures to configure a colocated backup HornetQ server.
			</div><div class="para">
				The backup server runs on the same JBoss Enterprise Application Platform instance as the live server configured in <a class="xref" href="EAP_HornetQ_Clusters.html#Colocated_Live_Server">Section 38.1.1, “Colocated Live Server”</a>. The important thing to understand is the backup server is the fail over point for a live server running on a different JBoss Enterprise Application Platform instance.
			</div><div class="para">
				Likewise, the backup server instance does not service any Java EE components on the JBoss Enterprise Application Platform instance it is colocated on. When the live server fails over, any existing messages are redistributed within the live backup group, to service any remote clients connected to the live server at the time it became unavailable.
			</div><div class="para">
				A backup HornetQ instance only needs a <code class="literal">hornetq-jboss-beans.xml</code> and a <code class="literal">hornetq-configuration.xml</code> configuration file. Any JMS components are created from the shared journal when the backup server becomes live (configured in <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Config_Shared_Store_and_Journalling">Procedure 38.2, “Configure Shared Store and Journaling”</a>).
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Create_Backup_Server">
      ⁠</a><p class="title"><strong>Procedure 38.5. Create Backup Server</strong></p><div class="important"><div class="admonition_header"><p><strong>Important - Cluster Firewall Requirements</strong></p></div><div class="admonition"><div class="para">
						If nodes can not discover each other, verify that you have configured the firewall and UDP ports correctly. The network configuration should allow nodes on a cluster to communicate with each other.
					</div></div></div><div class="para">
					You must set up the live server first as specified in <a class="xref" href="EAP_HornetQ_Clusters.html#Colocated_Live_Server">Section 38.1.1, “Colocated Live Server”</a>. After you have configured the live server, continue with this procedure.
				</div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Colocated/deploy/</code>
					</div></li><li class="step"><div class="para">
						Create a new directory called <code class="filename">hornetq-backup1</code>. Move into that directory.
					</div></li><li class="step"><div class="para">
						Open a text editor and create a new file called <code class="filename">hornetq-jboss-beans.xml</code> in the <code class="filename">hornetq-backup1</code> directory.
					</div></li><li class="step"><div class="para">
						Copy the following configuration into <code class="filename">hornetq-jboss-beans.xml</code>.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- The core configuration --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"BackupConfiguration"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hornetq.core.config.impl.FileConfiguration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"configurationUrl"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.server.home.url}/deploy/hornetq-backup1/hornetq-configuration.xml<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- The core server --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"BackupHornetQServer"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hornetq.core.server.impl.HornetQServerImpl"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"BackupConfiguration"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"MBeanServer"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"HornetQSecurityManager"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;start</span><span xmlns="" class="perl_Others"> ignored=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;stop</span><span xmlns="" class="perl_Others"> ignored=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- The JMS server --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"BackupJMSServerManager"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hornetq.jms.server.impl.JMSServerManagerImpl"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"BackupHornetQServer"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span>
</pre></li><li class="step"><div class="para">
						Save and close the file.
					</div></li></ol></div><div class="para">
				The <code class="filename">hornetq-jboss-beans.xml</code> file in <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Create_Backup_Server">Procedure 38.5, “Create Backup Server”</a> contains configuration worth exploring in more detail. The BackupConfiguration bean is configured to pick up the configuration in <code class="literal">hornetq-configuration.xml</code>. This file is created in the next procedure: <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Create_Backup_Server_Configuration_File">Procedure 38.6, “Create Backup Server Configuration File”</a>.
			</div><div class="para">
				The HornetQ Server and JMS server beans are added after the BackupConfiguration.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The names of the backup instance beans have been changed from those in the live server configuration. This is to prevent problems with beans sharing the same name. If you add more backup servers, you must rename these instances uniquely as well (for example: backup1, backup2).
				</div></div></div><div class="para">
				The next task involves creating the backup server configuration according to <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Create_Backup_Server_Configuration_File">Procedure 38.6, “Create Backup Server Configuration File”</a>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Create_Backup_Server_Configuration_File">
      ⁠</a><p class="title"><strong>Procedure 38.6. Create Backup Server Configuration File</strong></p><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Colocated/deploy/hornetq-backup1</code>
					</div></li><li class="step"><div class="para">
						Open a text editor and create a new file called <code class="filename">hornetq-configuration.xml</code> in the <code class="filename">hornetq-backup1</code> directory.
					</div></li><li class="step"><div class="para">
						Copy the following configuration into <code class="filename">hornetq-configuration.xml</code>
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;configuration</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:hornetq"</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span><span xmlns="" class="perl_Others"> xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:hornetq /schema/hornetq-configuration.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;jmx-domain&gt;</span>org.hornetq.backup1<span xmlns="" class="perl_Keyword">&lt;/jmx-domain&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;clustered&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/clustered&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;backup&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/backup&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;shared-store&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/shared-store&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;allow-failback&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/allow-failback&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;file-deployment-enabled&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/file-deployment-enabled&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;log-delegate-factory-class-name&gt;</span>
<span xmlns="" class="line">​</span>    org.hornetq.integration.logging.Log4jLogDelegateFactory
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/log-delegate-factory-class-name&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bindings-directory&gt;</span>
<span xmlns="" class="line">​</span>    /media/shared/data/hornetq-backup/bindings
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bindings-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;journal-directory&gt;</span>/media/shared/data/hornetq-backup/journal<span xmlns="" class="perl_Keyword">&lt;/journal-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;journal-min-files&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/journal-min-files&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;large-messages-directory&gt;</span>
<span xmlns="" class="line">​</span>    /media/shared/data/hornetq-backup/largemessages
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/large-messages-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;paging-directory&gt;</span>/media/shared/data/hornetq-backup/paging<span xmlns="" class="perl_Keyword">&lt;/paging-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-connector"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>          org.hornetq.core.remoting.impl.netty.NettyConnectorFactory
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.bind.address:localhost}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${hornetq.remoting.netty.backup.port:5446}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/connector&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"in-vm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>          org.hornetq.core.remoting.impl.invm.InVMConnectorFactory
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"server-id"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${hornetq.server-id:0}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/connector&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>          org.hornetq.core.remoting.impl.netty.NettyAcceptorFactory
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.bind.address:localhost}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${hornetq.remoting.netty.backup.port:5446}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/acceptor&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;broadcast-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"bg-group1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;group-address&gt;</span>231.7.7.7<span xmlns="" class="perl_Keyword">&lt;/group-address&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;group-port&gt;</span>9876<span xmlns="" class="perl_Keyword">&lt;/group-port&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;broadcast-period&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/broadcast-period&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty-connector<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/broadcast-group&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/broadcast-groups&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;discovery-groups&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;discovery-group</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dg-group1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;group-address&gt;</span>231.7.7.7<span xmlns="" class="perl_Keyword">&lt;/group-address&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;group-port&gt;</span>9876<span xmlns="" class="perl_Keyword">&lt;/group-port&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;refresh-timeout&gt;</span>60000<span xmlns="" class="perl_Keyword">&lt;/refresh-timeout&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/discovery-group&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/discovery-groups&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;cluster-connections&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;cluster-connection</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"my-cluster"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;address&gt;</span>jms<span xmlns="" class="perl_Keyword">&lt;/address&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;connector-ref&gt;</span>netty-connector<span xmlns="" class="perl_Keyword">&lt;/connector-ref&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;discovery-group-ref</span><span xmlns="" class="perl_Others"> discovery-group-name=</span><span xmlns="" class="perl_String">"dg-group1"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/cluster-connection&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/cluster-connections&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;security-settings&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;security-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"#"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;permission</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"createNonDurableQueue"</span><span xmlns="" class="perl_Others"> roles=</span><span xmlns="" class="perl_String">"guest"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;permission</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"deleteNonDurableQueue"</span><span xmlns="" class="perl_Others"> roles=</span><span xmlns="" class="perl_String">"guest"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;permission</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"consume"</span><span xmlns="" class="perl_Others"> roles=</span><span xmlns="" class="perl_String">"guest"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;permission</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"send"</span><span xmlns="" class="perl_Others"> roles=</span><span xmlns="" class="perl_String">"guest"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/security-setting&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/security-settings&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;address-settings&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!--default for catch all--&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"#"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;dead-letter-address&gt;</span>jms.queue.DLQ<span xmlns="" class="perl_Keyword">&lt;/dead-letter-address&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;expiry-address&gt;</span>jms.queue.ExpiryQueue<span xmlns="" class="perl_Keyword">&lt;/expiry-address&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;redelivery-delay&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/redelivery-delay&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;max-size-bytes&gt;</span>10485760<span xmlns="" class="perl_Keyword">&lt;/max-size-bytes&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;message-counter-history-day-limit&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/message-counter-history-day-limit&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;address-full-policy&gt;</span>BLOCK<span xmlns="" class="perl_Keyword">&lt;/address-full-policy&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/address-settings&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/configuration&gt;</span>
</pre></li><li class="step"><div class="para">
						Save and close the file.
					</div></li></ol></div><div class="para">
				The <code class="filename">hornetq-configuration.xml</code> file in <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Create_Backup_Server_Configuration_File">Procedure 38.6, “Create Backup Server Configuration File”</a> contains specific configuration which is discussed in <a class="xref" href="EAP_HornetQ_Clusters.html#var-hornetq-configuration.xml_Config_Points">hornetq-configuration.xml Configuration Points</a>.
			</div><div class="variablelist"><a id="var-hornetq-configuration.xml_Config_Points">
      ⁠</a><p class="title"><strong>hornetq-configuration.xml Configuration Points</strong></p><dl class="variablelist"><dt><span class="term"><span class="markup">&lt;jmx-domain&gt;</span>org.hornetq.backup1<span class="markup">&lt;/jmx-domain&gt;</span></span></dt><dd><div class="para">
							Specifies the object name (in this case the backup server) in the Java Management Extensions (JMX) service. The default value is <code class="literal">org.hornetq</code>, however this name is already in use in other parts of HornetQ. You must change the name to a unique, system-wide name to avoid naming conflicts with the live server.
						</div></dd><dt><span class="term"><span class="markup">&lt;clustered&gt;</span>true<span class="markup">&lt;/clustered&gt;</span></span></dt><dd><div class="para">
							Specifies whether the server should join a cluster. This configuration is the same as the live server.
						</div></dd><dt><span class="term"><span class="markup">&lt;backup&gt;</span>true<span class="markup">&lt;/backup&gt;</span></span></dt><dd><div class="para">
							Specifies whether the server starts as a backup server, and not a live server. Specifying true sets the server to start as a backup server.
						</div></dd><dt><span class="term"><span class="markup">&lt;shared-store&gt;</span>true<span class="markup">&lt;/shared-store&gt;</span></span></dt><dd><div class="para">
							Specifies whether the server should reference a shared store for journaling. This configuration is the same as the live server.
						</div></dd><dt><span class="term"><span class="markup">&lt;allow-failback&gt;</span>true<span class="markup">&lt;/allow-failback&gt;</span></span></dt><dd><div class="para">
							Specifies whether the backup server automatically stops and returns to standby mode when the live server becomes available again. If set to <code class="literal">false</code>, the server must be stopped manually to trigger a return to standby mode.
						</div></dd><dt><span class="term">&lt;bindings-directory&gt;, </span><span class="term">&lt;journal-directory&gt;, </span><span class="term">&lt;large-messages-directory&gt;, </span><span class="term">&lt;paging-directory&gt;</span></dt><dd><div class="para">
							The paths in these elements must all resolve to the same paths the live server references. This ensures the backup server uses the same journaling files as the live server.
						</div></dd><dt><span class="term">&lt;connectors&gt;</span></dt><dd><div class="para">
							Two connectors are defined that allow clients to connect to the backup server once live: one connector for the netty connector factory (to allow client and server connections across different Virtual Machines); and one connector to allow the server to accept connections within the VM.
						</div></dd><dt><span class="term">&lt;acceptors&gt;</span></dt><dd><div class="para">
							The NettyAcceptorFactory is chosen here for VM compatibility.
						</div></dd><dt><span class="term">&lt;broadcast-groups&gt;, </span><span class="term">&lt;discovery-groups&gt;, </span><span class="term">&lt;cluster-connections&gt;, </span><span class="term">&lt;security-settings&gt;, </span><span class="term">&lt;address-settings&gt;</span></dt><dd><div class="para">
							The settings in these configuration blocks are standard settings.
						</div></dd></dl></div><div class="task"><p class="title"><strong>Task: Create Configuration for Second Server Instance</strong></p><div class="tasksummary"> <div class="para">
				Complete this task to configure the second server instance to cluster with the first server.
			</div>
			 </div><div class="taskprerequisites"><a id="idm139905867082048">
      ⁠</a><p class="title"><strong>Prerequisites</strong></p><div class="taskprerequisites-contents"> 
			 <div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<a class="xref" href="EAP_HornetQ_Clusters.html#proc-Create_Backup_Server">Procedure 38.5, “Create Backup Server”</a>
					</div></li><li class="listitem"><div class="para">
						<a class="xref" href="EAP_HornetQ_Clusters.html#proc-Create_Backup_Server_Configuration_File">Procedure 38.6, “Create Backup Server Configuration File”</a>
					</div></li></ul></div>
			 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename"><code class="filename"> <em class="replaceable">&lt;JBOSS_HOME&gt;</em> </code>/server/</code>.
					</div></li><li class="step"><div class="para">
						Copy the <code class="filename">HornetQ_Colocated</code> directory, and rename it to <code class="filename">HornetQ_Colocated_Second</code>.
					</div></li><li class="step"><div class="para">
						Rename <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/HornetQ_Colocated_Second/hornetq-backup1/</code> to <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/HornetQ_Colocated_Second/hornetq-backup-serverA/</code>
					</div></li><li class="step"><div class="para">
						Open <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/HornetQ_Colocated_Second/hornetq/hornetq-configuration.xml</code>
					</div></li><li class="step"><div class="para">
						For all parameters with data directories specified in <code class="filename">hornetq-configuration.xml</code>, change the data paths to <code class="filename">/media/shared/data/hornetq-backup</code>.
					</div><div class="para">
						For example change:
					</div><div class="para">
						&lt;bindings-directory&gt; /media/shared/data/serverA/bindings &lt;/bindings-directory&gt;
					</div><div class="para">
						to &lt;bindings-directory&gt; /media/shared/data/hornetq-backup/bindings &lt;/bindings-directory&gt;
					</div></li><li class="step"><div class="para">
						Open <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/HornetQ_Colocated_Second/hornetq-backup-serverA/hornetq-configuration.xml</code>
					</div></li><li class="step"><div class="para">
						For all parameters with data directories specified in <code class="filename">hornetq-configuration.xml</code>, change the data paths to <code class="filename">/media/shared/data/serverA</code>.
					</div><div class="para">
						For example change:
					</div><div class="para">
						&lt;bindings-directory&gt; /media/shared/data/hornetq-backup/bindings &lt;/bindings-directory&gt;
					</div><div class="para">
						to &lt;bindings-directory&gt; /media/shared/data/serverA/bindings &lt;/bindings-directory&gt;
					</div></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905878928320">
      ⁠</a>38.2. Dedicated Symmetrical Live and Backup Clusters</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				JBoss Enterprise Application Platform ships with an example configuration for this topology, located in <code class="literal">$JBOSS_HOME/extras/hornetq/resources/examples/cluster-with-dedicated-backup</code>.
			</div></div></div><div class="para">
			In a dedicated symmetrical topology, the backup server resides on a separate JBoss Enterprise Application Platform instance, rather than colocated with another live server.
		</div><div class="para">
			This means the JBoss Enterprise Application Platform instance is passive, and not used until the backup becomes live. The passive instance is therefore only useful for pure JMS applications.
		</div><div class="para">
			The following diagram shows a possible configuration for this:
		</div><div class="example"><a id="exam-Single_Instance_Dedicated_Symmetrical_Configuration">
      ⁠</a><p class="title"><strong>Example 38.3. Single Instance, Pure JMS, Dedicated Symmetrical Configuration</strong></p><div class="example-contents"><div class="mediaobject"><img src="images/simple-dedicated.png" alt="Single Instance, Pure JMS, Dedicated Symmetrical Configuration"/></div><div class="para">
				When the HornetQ live server on the EAP1 node stops responding, the HornetQ backup instance on the EAP1(B) node activates, and becomes the live server. The Remote JMS client routes all messages destined for the HornetQ live node to the HornetQ backup node.
			</div></div></div><div class="para">
			<a class="xref" href="EAP_HornetQ_Clusters.html#exam-Single_Instance_Dedicated_Symmetrical_Configuration">Example 38.3, “Single Instance, Pure JMS, Dedicated Symmetrical Configuration”</a> describes how a dedicated symmetrical topology works with applications that are pure JMS, and have no JMS components (for example, Message Driven Beans).
		</div><div class="para">
			For topologies that contain JMS components, there are two approaches you can take for dedicated symmetrical clusters containing JMS components:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Dedicated JCA Server, as described in <a class="xref" href="EAP_HornetQ_Clusters.html#exam-Dedicated_JCA_Server">Example 38.4, “Dedicated JCA Server”</a>
				</div></li><li class="listitem"><div class="para">
					Remote JCA Server, as described in <a class="xref" href="EAP_HornetQ_Clusters.html#exam-Remote_JCA_Server">Example 38.5, “Remote JCA Server”</a>.
				</div></li></ol></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Single_Instance_Dedicated_Live_Server">
      ⁠</a>38.2.1. Dedicated JCA Live Server</h2></div></div></div><div class="example"><a id="exam-Dedicated_JCA_Server">
      ⁠</a><p class="title"><strong>Example 38.4. Dedicated JCA Server</strong></p><div class="example-contents"><div class="mediaobject"><img src="images/simple-dedicated-jca.png" alt="Dedicated JCA Server"/></div><div class="para">
					The EAP1(B) and EAP2(B) instances are only running backup HornetQ instances, therefore it does not make sense to host any applications on these instances. Applications are instead hosted on EAP1 and EAP2, closely located to the live HornetQ instances.
				</div><div class="para">
					When a live HornetQ server fails on EAP1, traffic fails over to the backup HornetQ servers EAP1(B). The remote JMS client reroutes messages sent from, or destined for Java EE components on the live server to the backup server using the HornetQ cluster connections.
				</div></div></div><div class="para">
				The live server configuration is essentially the same as in <a class="xref" href="EAP_HornetQ_Clusters.html#Colocated_Live_Server">Section 38.1.1, “Colocated Live Server”</a>. The only difference is there is no backup in the same JBoss Enterprise Application Platform node running the live HornetQ instance. This topology also requires multiple JBoss Enterprise Application Platform instances.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Create_Dedicated_Live_Server_Profile">
      ⁠</a><p class="title"><strong>Procedure 38.7. Create Dedicated Live Server Profile</strong></p><div class="important"><div class="admonition_header"><p><strong>Important - Cluster Firewall Requirements</strong></p></div><div class="admonition"><div class="para">
						If nodes can not discover each other, verify that you have configured the firewall and UDP ports correctly. The network configuration should allow nodes on a cluster to communicate with each other.
					</div></div></div><div class="para">
					You must create a copy of the <code class="literal">production</code> profile to customize the live server configuration.
				</div><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						Always copy an included profile rather than editing it directly for your custom profile. If you make a critical mistake during configuration, you can fall back to the base configuration at any time.
					</div></div></div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/</code>
					</div></li><li class="step"><div class="para">
						Copy the <code class="literal">production</code> profile, and rename it to <code class="literal">HornetQ_Dedicated</code>
					</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Config_Shared_Store_and_Journalling_1">
      ⁠</a><p class="title"><strong>Procedure 38.8. Configure Shared Store and Journaling</strong></p><div class="para">
					Follow this procedure to specify HornetQ must use a shared store for fail over, and define the location of the journal files each HornetQ instance in the live backup group uses.
				</div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Dedicated/deploy/hornetq/</code>
					</div></li><li class="step"><div class="para">
						Open <code class="filename">hornetq-configuration.xml</code>
					</div></li><li class="step"><div class="para">
						Add the <span class="markup">&lt;shared-store&gt;</span> element as a child of the <span class="markup">&lt;configuration&gt;</span> element.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;shared-store&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/shared-store&gt;</span></pre></li><li class="step"><div class="para">
						Ensure the bindings, journal, and large messages path locations are set to a location the live backup group can access.
					</div><div class="para">
						You can set absolute paths as the example describes, or use the JBoss parameters that exist in the configuration file.
					</div><div class="para">
						If you choose the parameter option, and you do not use the default paths that these parameters resolve to, you must specify the path your bindings, journal, and large messages reside in each time you start the server.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;large-messages-directory&gt;</span>/media/shared/data/large-messages<span xmlns="" class="perl_Keyword">&lt;/large-messages-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bindings-directory&gt;</span>/media/shared/data/bindings<span xmlns="" class="perl_Keyword">&lt;/bindings-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;journal-directory&gt;</span>/media/shared/data/journal<span xmlns="" class="perl_Keyword">&lt;/journal-directory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;paging-directory&gt;</span>/media/shared/data/paging<span xmlns="" class="perl_Keyword">&lt;/paging-directory&gt;</span></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Ensure you specify paths that are accessible to the live backup groups on your network.
						</div></div></div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Configure_JMS_Client_Graceful_Shutdown_1">
      ⁠</a><p class="title"><strong>Procedure 38.9. Configure JMS Client Graceful Shutdown</strong></p><div class="para">
					Follow this procedure to configure how JMS clients re-establish a connection if a server is shut down gracefully.
				</div><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Dedicated/deploy/hornetq/</code>
					</div></li><li class="step"><div class="para">
						Open <code class="filename">hornetq-configuration.xml</code>
					</div></li><li class="step"><div class="para">
						Specify the <span class="markup">&lt;fail over-on-shutdown&gt;</span> element in the area near the journal directory configuration in <a class="xref" href="EAP_HornetQ_Clusters.html#proc-Config_Shared_Store_and_Journalling">Procedure 38.2, “Configure Shared Store and Journaling”</a>.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;failover-on-shutdown&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/failover-on-shutdown&gt;</span></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							You are not constrained where you put the element in the <code class="filename">hornetq-configuration.xml</code> file, however it is easier to find the less detailed settings if they are all located at the top of the file.
						</div></div></div></li><li class="step"><div class="para">
						Save and close the file.
					</div></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="proc-Config_HA_Connect_Factories_1">
      ⁠</a><p class="title"><strong>Procedure 38.10. Configure HA Connection Factories</strong></p><ol class="1"><li class="step"><div class="para">
						Navigate to <code class="filename">$JBOSS_HOME/server/HornetQ_Dedicated/deploy/hornetq/</code>
					</div></li><li class="step"><div class="para">
						Open <code class="filename">hornetq-jms.xml</code>.
					</div></li><li class="step"><div class="para">
						Add the following attributes and values as specified below.
					</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <span class="markup">&lt;ha&gt;true&lt;/ha&gt;</span> </span></dt><dd><div class="para">
									Specifies the client must support high availability, and must always be true for fail over to occur.
								</div></dd><dt><span class="term">&lt;retry-interval&gt;1000&lt;/retry-interval&gt;</span></dt><dd><div class="para">
									Specifies how long the client must wait (in milliseconds) before it can reconnect to the server.
								</div></dd><dt><span class="term">&lt;retry-interval-multiplier&gt;1.0&lt;/retry-interval-multiplier&gt;</span></dt><dd><div class="para">
									Specifies the multiplier <span class="markup">&lt;retry-interval&gt;</span> uses for each subsequent reconnection pauses. By setting the value to <code class="literal">1.0</code>, the retry interval is the same for each client reconnection request.
								</div></dd><dt><span class="term">&lt;reconnect-attempts&gt;-1&lt;/reconnect-attempts&gt;</span></dt><dd><div class="para">
									Specifies how many reconnect attempts a client should make before failing. Setting <code class="literal">-1</code> means unlimited reconnection attempts.
								</div></dd></dl></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version='1.0' encoding='UTF-8'<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;configuration</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:hornetq"</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span><span xmlns="" class="perl_Others"> xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:hornetq /schema/hornetq-jms.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"NettyConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;xa&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/xa&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/XAConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;ha&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/ha&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Pause 1 second between connect attempts --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;retry-interval&gt;</span>1000<span xmlns="" class="perl_Keyword">&lt;/retry-interval&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Multiply subsequent reconnect pauses by this multiplier. This can be used </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       to implement an exponential back-off. For our purposes we just set to 1.0 so </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       each reconnect pause is the same length --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;retry-interval-multiplier&gt;</span>1.0<span xmlns="" class="perl_Keyword">&lt;/retry-interval-multiplier&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Try reconnecting an unlimited number of times (-1 means unlimited) --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;reconnect-attempts&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/reconnect-attempts&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/configuration&gt;</span>
</pre></li><li class="step"><div class="para">
						Define new queues in both master and backup nodes by adding one of the following configuration blocks to the specified file.
					</div><div class="para">
						For <code class="filename">production/deploy/hornetq/hornetq-jms.xml</code>
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"testQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/queue/testQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;durable&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/durable&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/queue&gt;</span></pre><div class="para">
						For <code class="filename">production/deploy/<em class="replaceable">customName</em>-hornetq-jms.xml</code>
					</div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Ensure the file is well-formed from an XML validation perspective by ensure the XML Namespace is present and correct in the file as specified.
						</div></div></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;configuration</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:hornetq"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xsi:schemaLocation=</span><span xmlns="" class="perl_String">"urn:hornetq /schema/hornetq-jms.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;queue</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"testQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/queue/testQueue"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;durable&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/durable&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/queue&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/configuration&gt;</span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Dedicated_JCA_Backup_Server">
      ⁠</a>38.2.2. Dedicated JCA Backup Server</h2></div></div></div><div class="para">
				For the backup server, the <code class="literal">hornetq-configuration.xml</code> is unchanged. Because there is no live server, you must ensure the <code class="literal">hornetq-jboss-beans.xml</code> instantiates all the beans needed. You configure this using the same configuration as in the live server, with the exception of changing the location of the <code class="literal">hornetq-configuration.xml</code> parameter for the <code class="literal">Configuration</code> bean.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139905865500864">
      ⁠</a><p class="title"><strong>Procedure 38.11. Configure Dedicated Backup Server</strong></p><div class="para">
					Follow this procedure to configure a dedicated HornetQ backup instance, located on a separate JBoss Enterprise Application Platform server.
				</div><div class="para"><div class="title">Prerequisites</div>
						<div class="itemizedlist"><ul><li class="listitem"><div class="para">
									A HornetQ Live Server, configured according to the procedures contained within <a class="xref" href="EAP_HornetQ_Clusters.html#Single_Instance_Dedicated_Live_Server">Section 38.2.1, “Dedicated JCA Live Server”</a>
								</div></li><li class="listitem"><div class="para">
									A correctly configured JBoss Enterprise Application Platform instance, installed on a separate server instance to the live server.
								</div></li><li class="listitem"><div class="para">
									HornetQ installed on the platform instance.
								</div></li></ul></div>

					</div><ol class="1"><li class="step"><div class="para">
						On the backup server, navigate using the command line to <code class="filename">/extras/hornetq/</code>.
					</div></li><li class="step"><div class="para">
						Execute <code class="command">sh ./switch.sh -Dbackup=true</code>.
					</div><div class="para">
						The script executes and creates a <code class="literal">production-backup</code> server profile in <code class="filename">$JBOSS_HOME/server/</code>
					</div></li><li class="step"><div class="para">
						Copy the <code class="literal">production-backup</code> server profile, and rename it to <code class="literal">HornetQ_Dedicated_Backup</code>.
					</div></li><li class="step"><div class="para">
						Open <code class="filename">$JBOSS_HOME/server/HornetQ_Dedicated_Backup/hornetq/hornetq-configuration.xml</code>
					</div></li><li class="step"><div class="para">
						Add the <span class="markup">&lt;shared-store&gt;</span>true<span class="markup">&lt;/shared-store&gt;</span> element as a child element to the <span class="markup">&lt;configuration&gt;</span> element.
					</div></li><li class="step"><div class="para">
						Change the data directory locations to match the following values:
					</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
								<span class="markup">&lt;large-messages-directory&gt;</span>/media/shared/data/large-messages<span class="markup">&lt;/large-messages-directory&gt;</span>
							</div></li><li class="listitem"><div class="para">
								<span class="markup">&lt;bindings-directory&gt;</span>/media/shared/data/bindings<span class="markup">&lt;/bindings-directory&gt;</span>
							</div></li><li class="listitem"><div class="para">
								<span class="markup">&lt;journal-directory&gt;</span>/media/shared/data/journal<span class="markup">&lt;/journal-directory&gt;</span>
							</div></li><li class="listitem"><div class="para">
								<span class="markup">&lt;paging-directory&gt;</span>/media/shared/data/paging<span class="markup">&lt;/paging-directory&gt;</span>
							</div></li></ul></div></li><li class="step"><div class="para">
						Save and close all updated files.
					</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905862025104">
      ⁠</a>38.2.3. Dedicated Remote Server</h2></div></div></div><div class="example"><a id="exam-Remote_JCA_Server">
      ⁠</a><p class="title"><strong>Example 38.5. Remote JCA Server</strong></p><div class="example-contents"><div class="mediaobject"><img src="images/simple-dedicated-jca-remote.png" alt="Remote JCA Server"/></div><div class="para">
					In this example, the HornetQ live instance is stored on a remote server EAP1. The backup HornetQ instance is stored on EAP1(B). The JCA and the Applications are stored on a separate EAP2 instance.
				</div><div class="para">
					When fail over occurs, the Application (via JCA) is serviced by a HornetQ server in its own JBoss Enterprise Application Platform instance.
				</div></div></div><div class="para">
				Because both HornetQ instances are located on remote servers, you must configure the JCA connection factories on the EAP2 server to correctly serve applications to the live HornetQ server and the backup HornetQ server.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139905842566304">
      ⁠</a><p class="title"><strong>Procedure 38.12. Configure JCA Connection Factories</strong></p><div class="para">
					Follow this procedure to configure the Outbound and Inbound JCA connector elements in different configuration files. Ensure you copy the Key steps are identified by a step title.
				</div><ol class="1"><li class="step"><div class="para">
						Copy the <code class="literal">production</code> server profile, and rename it to <code class="literal">EAP2</code>.
					</div></li><li class="step"><div class="para">
						On the EAP2 instance, navigate to <code class="literal">$JBOSS_HOME/server/EAP2/deploy/hornetq/jms-ds.xml</code>
					</div></li><li class="step"><div class="para">
						The default <code class="filename">jms-ds.xml</code> has the following <span class="markup">&lt;config-property&gt;</span> configuration present in the &lt;tx-connection-factory&gt;.
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factories&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- JMS Stuff --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.jndi.JMSProviderLoader"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    name=</span><span xmlns="" class="perl_String">"hornetq:service=JMSProviderLoader,name=JMSProvider"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ProviderName"</span><span xmlns="" class="perl_Keyword">&gt;</span>DefaultJMSProvider<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ProviderAdapterClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.jndi.JNDIProviderAdapter<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"QueueFactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TopicFactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- JMS XA Resource adapter, use this to get transacted JMS in beans --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;jndi-name&gt;</span>JmsXA<span xmlns="" class="perl_Keyword">&lt;/jndi-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;xa-transaction/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;rar-name&gt;</span>jms-ra.rar<span xmlns="" class="perl_Keyword">&lt;/rar-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connection-definition&gt;</span>org.hornetq.ra.HornetQRAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/connection-definition&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SessionDefaultType"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Topic<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JmsProviderAdapterJNDI"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/DefaultJMSProvider<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;max-pool-size&gt;</span>20<span xmlns="" class="perl_Keyword">&lt;/max-pool-size&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;security-domain-and-application&gt;</span>JmsXARealm<span xmlns="" class="perl_Keyword">&lt;/security-domain-and-application&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factories&gt;</span>
</pre></li><li class="step"><p class="title"><strong>Configure Outbound JCA Connector</strong></p><div class="para">
						Add extra &lt;config-property&gt; elements as described in the following code sample.
					</div><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
							Substitute the [live_server_IP_address] and [live_server_port_number] with the network address locations for your live server.
						</div><div class="para">
							If you are using Discovery to set IP address/port combinations, ensure you set the appropriate parameters for <span class="markup">&lt;DiscoveryAddress&gt;</span> and <span class="markup">&lt;DiscoveryPort&gt;</span> to match your configured broadcast groups.
						</div></div></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factories&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- JMS Stuff --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.jndi.JMSProviderLoader"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    name=</span><span xmlns="" class="perl_String">"hornetq:service=JMSProviderLoader,name=JMSProvider"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ProviderName"</span><span xmlns="" class="perl_Keyword">&gt;</span>DefaultJMSProvider<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ProviderAdapterClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.jndi.JNDIProviderAdapter<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"QueueFactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TopicFactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/XAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- JMS XA Resource adapter, use this to get transacted JMS in beans --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;jndi-name&gt;</span>JmsXA<span xmlns="" class="perl_Keyword">&lt;/jndi-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;xa-transaction/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;rar-name&gt;</span>jms-ra.rar<span xmlns="" class="perl_Keyword">&lt;/rar-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;connection-definition&gt;</span>org.hornetq.ra.HornetQRAConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/connection-definition&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SessionDefaultType"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Topic<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JmsProviderAdapterJNDI"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/DefaultJMSProvider<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectorClassName"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hornetq.core.remoting.impl.netty.NettyConnectorFactory<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ConnectionParameters"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>host=[live_server_IP_address];port=[live_server_port_number]<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;max-pool-size&gt;</span>20<span xmlns="" class="perl_Keyword">&lt;/max-pool-size&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;security-domain-and-application&gt;</span>JmsXARealm<span xmlns="" class="perl_Keyword">&lt;/security-domain-and-application&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factories&gt;</span>
</pre></li><li class="step"><div class="para">
						Open <code class="literal">$JBOSS_HOME/server/EAP2/deploy/jms-ra.rar/META-INF/ra.xml</code> in a text editor.
					</div></li><li class="step"><div class="para">
						In <code class="filename">ra.xml</code>, search for <span class="markup">&lt;resourceadapter&gt;</span>.
					</div></li><li class="step"><p class="title"><strong>Configure the Inbound Connector</strong></p><div class="para">
						Replace the "The transport type" and "The transport configuration..." &lt;config-property&gt; elements, and their child elements with the following configuration:
					</div><div class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
							Substitute the [live_server_IP_address] and [live_server_port_number] with the network address locations for your live server.
						</div><div class="para">
							If you are using Discovery to set IP address/port combinations, ensure you set the appropriate parameters for <span class="markup">&lt;DiscoveryAddress&gt;</span> and <span class="markup">&lt;DiscoveryPort&gt;</span> to match your configured broadcast groups.
						</div><div class="para">
							If you are using Auto Discovery, ensure you comment out ConnectorClassName and ConnectionParameters directives.
						</div></div></div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Preceeding parts of config file removed for readability --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;resourceadapter&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;resourceadapter-class&gt;</span>org.hornetq.ra.HornetQResourceAdapter<span xmlns="" class="perl_Keyword">&lt;/resourceadapter-class&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The transport type<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-name&gt;</span>ConnectorClassName<span xmlns="" class="perl_Keyword">&lt;/config-property-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-type&gt;</span>java.lang.String<span xmlns="" class="perl_Keyword">&lt;/config-property-type&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-value&gt;</span>org.hornetq.core.remoting.impl.netty.NettyConnectorFactory<span xmlns="" class="perl_Keyword">&lt;/config-property-value&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>The transport configuration. These values must be in the form of key=val;key=val;<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-name&gt;</span>ConnectionParameters<span xmlns="" class="perl_Keyword">&lt;/config-property-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-type&gt;</span>java.lang.String<span xmlns="" class="perl_Keyword">&lt;/config-property-type&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-value&gt;</span>host=[live_server_IP_address];port=[live_server_port_number]<span xmlns="" class="perl_Keyword">&lt;/config-property-value&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;config-property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Do we support HA<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-name&gt;</span>HA<span xmlns="" class="perl_Keyword">&lt;/config-property-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-type&gt;</span>java.lang.Boolean<span xmlns="" class="perl_Keyword">&lt;/config-property-type&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;config-property-value&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/config-property-value&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Rest of config file removed for readability --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;resourceadapter&gt;</span>
</pre></li></ol></div></div></div></div></body></html>