<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 14. Configuring the Transport</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-transports">
      ⁠</a>Chapter 14. Configuring the Transport</h1></div></div></div><div class="para">
		HornetQ has a fully pluggable and highly flexible transport layer. The transport layer defines its own Service Provider Interface (SPI) to simplify plugging in a new transport provider.
	</div><div class="para">
		This chapter covers the concepts required to use and configure HornetQ transports.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-transports.acceptors">
      ⁠</a>14.1. Understanding Acceptors</h1></div></div></div><div class="para">
			Acceptors are defined in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code> using the following directives.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>org.hornetq.core.remoting.impl.netty.NettyAcceptorFactory<span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others">  value=</span><span xmlns="" class="perl_String">"${jboss.bind.address:localhost}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others">  value=</span><span xmlns="" class="perl_String">"${hornetq.remoting.netty.port:5445}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/acceptor&gt;</span></pre><div class="para">
			Acceptors are always defined inside an <code class="classname">acceptors</code> element. Multiple acceptors can be defined in one <code class="classname">acceptors</code> element. There is no upper limit to the number of acceptors per server.
		</div><div class="para">
			Each acceptor defines a way in which connections can be made to the HornetQ server.
		</div><div class="para">
			The above example defines an <code class="classname">acceptor</code> that uses Netty to listen for connections on port <code class="literal">5445</code>.
		</div><div class="para">
			The <code class="classname">acceptor</code> element contains a sub-element <code class="literal">factory-class</code> which defines the factory used to create acceptor instances. In this case Netty is used to listen for connections, so the Netty implementation of <code class="literal">AcceptorFactory</code> is being used. The <code class="literal">factory-class</code> element determines which pluggable transport listens.
		</div><div class="para">
			The <code class="literal">acceptor</code> element can also be configured with zero or more <code class="literal">param</code> sub-elements. Each <code class="literal">param</code> element defines a key-value pair. These key-value pairs are used to configure the specific transport, the set of valid key-value pairs depends on the specific transport be used and are passed straight through to the underlying transport.
		</div><div class="para">
			Examples of key-value pairs for a particular transport would be, say, to configure the IP address to bind to, or the port to listen at.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-transports.connectors">
      ⁠</a>14.2. Understanding Connectors</h1></div></div></div><div class="para">
			Where acceptors are used on the server to define how we accept connections, connectors are used by a client to define how it connects to a server. Acceptors and Connectors are defined in the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code> file:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>org.hornetq.core.remoting.impl.netty.NettyConnectorFactory<span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${jboss.bind.address:localhost}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"${hornetq.remoting.netty.port:5445}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connector&gt;</span></pre><div class="para">
			Connectors can be defined inside a <span class="markup">&lt;connectors&gt;</span> element. Multiple connectors can be defined in the same <span class="markup">&lt;connectors&gt;</span> element. There is no upper limit to the number of connectors per server.
		</div><div class="para">
			Although connectors are used by the client, they are defined on the server for a number of reasons:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Sometimes the server acts as a client itself when it connects to another server, for example when one server is bridged to another, or when a server takes part in a cluster. In these cases the server needs to know how to connect to other servers. This is defined by <span class="emphasis"><em>connectors</em></span>.
				</div></li><li class="listitem"><div class="para">
					If JMS and the server-side JMS service are used to instantiate JMS ConnectionFactory instances and bind them in JNDI, the JMS service needs to know which server the <code class="literal">HornetQConnectionFactory</code> will create connections to at the connection factory's creation.
				</div><div class="para">
					This is defined by the <span class="markup">&lt;connector-ref&gt;</span> element in the <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-jms.xml</code> file on the server side. The following snippet from a <code class="literal">hornetq-jms.xml</code> file shows a JMS connection factory that references the netty connector defined in the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code> file:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"NettyConnectionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;connector-ref</span><span xmlns="" class="perl_Others"> connector-name=</span><span xmlns="" class="perl_String">"netty"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;entries&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/ConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"/XAConnectionFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/entries&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factory&gt;</span></pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-transports.client.side">
      ⁠</a>14.3. Configuring the transport directly from the client side</h1></div></div></div><div class="para">
			This section shows how to configure a core <code class="classname">ClientSessionFactory</code> to connect with a server.
		</div><div class="para">
			Connectors are used indirectly when configuring a core <code class="classname">ClientSessionFactory</code> to talk to a server. In this case, it is unnecessary to define a connector in the server-side configuration. Instead, create the parameters and configure the connector factory to be used by <code class="classname">ClientSessionFactory</code>.
		</div><div class="para">
			The following <code class="classname">ClientSessionFactory</code> connects directly to the acceptor defined previously in this chapter. It uses the standard Netty TCP transport, and will attempt to connect on port 5446 to localhost (the default).
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>Map&lt;String, Object&gt; connectionParams = 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String, Object&gt;();
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>  connectionParams.<span xmlns="" class="perl_Function">put</span>(
<span xmlns="" class="line">​</span>    org.<span xmlns="" class="perl_Function">hornetq</span>.<span xmlns="" class="perl_Function">core</span>.<span xmlns="" class="perl_Function">remoting</span>.<span xmlns="" class="perl_Function">impl</span>.<span xmlns="" class="perl_Function">netty</span>.<span xmlns="" class="perl_Function">TransportConstants</span>.<span xmlns="" class="perl_Function">PORT_PROP_NAME</span>, 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Float">5446</span>
<span xmlns="" class="line">​</span>  );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>TransportConfiguration transportConfiguration = 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">TransportConfiguration</span>(
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_String">"org.hornetq.core.remoting.impl.netty.NettyConnectorFactory"</span>, 
<span xmlns="" class="line">​</span>    connectionParams
<span xmlns="" class="line">​</span>  );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>ClientSessionFactory sessionFactory = 
<span xmlns="" class="line">​</span>  HornetQClient.<span xmlns="" class="perl_Function">createClientSessionFactory</span>(transportConfiguration);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>ClientSession session = sessionFactory.<span xmlns="" class="perl_Function">createSession</span>(...);</pre><div class="para">
			For JMS, you can configure the JMS connection directly on the client side without defining a connector on the server side or a connection factory in <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-jms.xml</code>:
		</div><pre class="programlisting">Map&lt;String, Object&gt; connectionParams = 
  new HashMap&lt;String, Object&gt;();

connectionParams.put(
  org.hornetq.core.remoting.impl.netty.TransportConstants.PORT_PROP_NAME, 
  5446
);

TransportConfiguration transportConfiguration = 
  new TransportConfiguration(
    "org.hornetq.core.remoting.impl.netty.NettyConnectorFactory", 
    connectionParams
  );

ConnectionFactory connectionFactory = 
  HornetQJMSClient.createConnectionFactory(transportConfiguration);

Connection jmsConnection = connectionFactory.createConnection();</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905802507120">
      ⁠</a>14.4. Configuring the Netty transport</h1></div></div></div><div class="para">
			HornetQ uses Netty, a high-performance, low-level network library.
		</div><div class="para">
			The Netty transport can be configured to use old (blocking) Java IO, NIO (non-blocking), TCP sockets, SSL, HTTP or HTTPS. A servlet transport is also provided.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905871187344">
      ⁠</a>14.4.1. Configuring Netty TCP</h2></div></div></div><div class="para">
				Netty TCP is a simple unencrypted TCP socket-based transport. Netty TCP can be configured to use blocking Java Asynchronous IO (AIO) or non-blocking Java NIO (NIO). NIO is recommended on the server-side for concurrent connection scalability; however, AIO can provide better latency if many concurrent connections are not required.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>This transport is unencrypted</strong></p></div><div class="admonition"><div class="para">
					If you are running connections across an untrusted network, consider SSL or HTTPS instead.
				</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					If non-blocking messages are sent then there is a chance that these could arrive on the server after the calling thread has completed. This means that the security context has been cleared. If this is the case then messages will need to be sent as blocking messages.
				</div></div></div><div class="para">
				With the Netty TCP transport all connections are initiated from the client side. This is useful in situations where firewall policies only allow connections to be initiated in one direction.
			</div><div class="para">
				All valid Netty transport keys are defined in <code class="classname">org.hornetq.core.remoting.impl.netty.TransportConstants</code>. Most parameters can be used with acceptors and connectors. Some only work with acceptors. The following parameters can be used to configure Netty for simple TCP:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <code class="varname">use-nio</code> </span></dt><dd><div class="para">
							If this is <code class="literal">true</code> then Java non-blocking NIO will be used. If set to <code class="literal">false</code> the older, blocking Java IO will be used. If handling many concurrent connections to the server is a requirement, the non-blocking Java NIO method is highly recommended. Java NIO does not maintain a thread per connection so can scale to many more concurrent connections than the older blocking IO method. If handling many concurrent connections is not required, slightly better performance might be gained by using older blocking IO method. The default value for this property is <code class="literal">false</code> on the server side and <code class="literal">false</code> on the client side.
						</div></dd><dt><span class="term"> <code class="varname">host</code> </span></dt><dd><div class="para">
							The host name or IP address to connect to (for connectors) or listen on (for acceptors). The default value is <code class="literal">localhost</code>.
						</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Configuration Required</strong></p></div><div class="admonition"><div class="para">
								The default for this variable is <code class="literal">localhost</code>. This is not accessible from remote nodes and must be modified for the server to accept incoming connections.
							</div></div></div><div class="para">
							Acceptors can be configured with multiple comma-delimited hosts or IP addresses. Multiple addresses are not valid for connectors. <code class="literal">0.0.0.0</code> specifies that all network interfaces of a host should be accepted.
						</div></dd><dt><span class="term"> <code class="varname">port</code> </span></dt><dd><div class="para">
							Specifies the port to connect to (for connectors) or listen on (for acceptors). The default value is <code class="literal">5445</code>.
						</div></dd><dt><span class="term"> <code class="varname">tcp-no-delay</code> </span></dt><dd><div class="para">
							If <code class="literal">true</code>, Nagle's algorithm is enabled. The default value is <code class="literal">true</code>.
						</div></dd><dt><span class="term"> <code class="varname">tcp-send-buffer-size</code> </span></dt><dd><div class="para">
							Defines the size of the TCP send buffer in bytes. The default value is <code class="literal">32768</code> (32 kilobytes). TCP buffer size should be tuned according to the bandwidth and latency of your network. The buffer size in bytes should be equal to the bandwidth in bytes-per-second multiplied by the network round-trip-time (RTT) in seconds. RTT can be measured using the <span class="application"><strong>ping</strong></span> utility. For fast networks, you may wish to increase the buffer size from the default value.  
						</div></dd><dt><span class="term"> <code class="varname">tcp-receive-buffer-size</code> </span></dt><dd><div class="para">
							Defines the size of the TCP receive buffer in bytes. The default value is <code class="literal">32768</code> (32 kilobytes).
						</div></dd><dt><span class="term"> <code class="varname">batch-delay</code> </span></dt><dd><div class="para">
							HornetQ can be configured to place write operations into batches for up to <code class="varname">batch-delay</code> milliseconds. This can increase overall throughput for very small messages, but does so at the expense of an increase in average latency for message transfer. The default value is <code class="literal">0</code> milliseconds.
						</div></dd><dt><span class="term"> <code class="varname">direct-deliver</code> </span></dt><dd><div class="para">
							When a message arrives on the server and is delivered to consumers, by default the delivery occurs on a different thread to that in which the message arrived. This gives the best overall throughput and scalability, especially on multi-core machines. However, it also introduces additional latency due to the context switch required. For the lowest latency (and possible reduction of throughput), set <code class="varname">direct-deliver</code> to <code class="literal">true</code> (the default). For highest throughput, set to <code class="literal">false</code>.
						</div></dd><dt><span class="term"> <code class="varname">nio-remoting-threads</code> </span></dt><dd><div class="para">
							When configured to use NIO, by default HornetQ uses three times the number of threads as cores (or hyper-threads) reported by <code class="methodname">Runtime.getRuntime().availableProcessors()</code> to process incoming packets. <code class="varname">nio-remoting-threads</code> overrides this and defines the number of threads to use. The default is <code class="literal">-1</code>, which represents three times the value from <code class="methodname">Runtime.getRuntime().availableProcessors()</code>.
						</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905804011952">
      ⁠</a>14.4.2. Configuring Netty SSL</h2></div></div></div><div class="para">
				Netty SSL is similar to the Netty TCP transport but it provides additional security by encrypting TCP connections using the Secure Sockets Layer (SSL).
			</div><div class="para">
				Netty SSL uses the same properties as Netty TCP in addition to the following properties:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <code class="varname">ssl-enabled</code> </span></dt><dd><div class="para">
							Set to <code class="literal">true</code> to enable SSL.
						</div></dd><dt><span class="term"> <code class="varname">key-store-path</code> </span></dt><dd><div class="para">
							Defines the path to the SSL key store on the client that holds the client certificates.
						</div></dd><dt><span class="term"> <code class="varname">key-store-password</code> </span></dt><dd><div class="para">
							Defines the password for the client certificate key store on the client.
						</div></dd><dt><span class="term"> <code class="varname">trust-store-path</code> </span></dt><dd><div class="para">
							Defines the path to the trusted client certificate store on the server.
						</div></dd><dt><span class="term"> <code class="varname">trust-store-password</code> </span></dt><dd><div class="para">
							Defines the password to the trusted client certificate store on the server.
						</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905852883008">
      ⁠</a>14.4.3. Configuring Netty HTTP</h2></div></div></div><div class="para">
				Netty HTTP tunnels packets over the HTTP protocol. It can be useful in scenarios where firewalls only allow HTTP traffic to pass.
			</div><div class="para">
				Netty HTTP uses the same properties as Netty TCP but adds the following additional properties:
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <code class="varname">http-enabled</code> </span></dt><dd><div class="para">
							Set to <code class="literal">true</code> to enable HTTP.
						</div></dd><dt><span class="term"> <code class="varname">http-client-idle-time</code> </span></dt><dd><div class="para">
							The period of time (in milliseconds) a client can be idle before sending an empty HTTP request to keep the connection alive.
						</div></dd><dt><span class="term"> <code class="varname">http-client-idle-scan-period</code> </span></dt><dd><div class="para">
							How often, in milliseconds, to scan for idle clients.
						</div></dd><dt><span class="term"> <code class="varname">http-response-time</code> </span></dt><dd><div class="para">
							The period of time in milliseconds the server should wait before sending an empty HTTP response to keep the connection alive.
						</div></dd><dt><span class="term"> <code class="varname">http-server-scan-period</code> </span></dt><dd><div class="para">
							How often, in milliseconds, to scan for clients requiring responses.
						</div></dd><dt><span class="term"> <code class="varname">http-requires-session-id</code> </span></dt><dd><div class="para">
							When <code class="literal">true</code>, the client waits to receive a session ID after the first call. This is used when the HTTP connector is connecting to the servlet acceptor (not recommended).
						</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905806896128">
      ⁠</a>14.4.4. Configuring Netty Servlet</h2></div></div></div><div class="para">
				Netty Servlet transport allows HornetQ traffic to be tunneled over HTTP to a servlet running in a servlet engine, which redirects it to an in-virtual machine HornetQ server.
			</div><div class="para">
				This differs from the Netty HTTP transport in that traffic is routed through a servlet engine which may already be serving web applications. This allows HornetQ to be used where corporate policies allow only a single web server to listen on an HTTP port.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><p class="title"><strong>Configuring a servlet engine for the Netty Servlet transport</strong></p><ol><li class="listitem"><div class="para">
						Deploy the servlet. A web application using the servlet might have a <code class="filename">web.xml</code> file similar to the following:
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web-app</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/j2ee"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  version=</span><span xmlns="" class="perl_String">"2.4"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>HornetQServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-class&gt;</span>org.jboss.netty.channel.socket.http.HttpTunnelingServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;init-param&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>endpoint<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>local:org.hornetq<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/init-param&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;load-on-startup&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/load-on-startup&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/servlet&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>HornetQServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/HornetQServlet<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/web-app&gt;</span></pre></li><li class="listitem"><div class="para">
						Add the <code class="classname">netty-invm</code> acceptor to the server-side configuration in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;acceptors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;acceptor</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-invm"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>      org.hornetq.core.remoting.impl.netty.NettyAcceptorFactory
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-invm"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.hornetq"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/acceptor&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/acceptors&gt;</span></pre></li><li class="listitem"><div class="para">
						Define a connector for the client in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
					</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connectors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-servlet"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>      org.hornetq.core.remoting.impl.netty.NettyConnectorFactory
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"8080"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-servlet"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"servlet-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/messaging/HornetQServlet"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/connector&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connectors&gt;</span></pre></li></ol></div><div class="variablelist"><p class="title"><strong>Init Parameters</strong></p><dl class="variablelist"><dt><span class="term"> <code class="varname">endpoint</code> </span></dt><dd><div class="para">
							Defines the netty acceptor to which the servlet forwards its packets. Matches the name of the <code class="varname">host</code> parameter.
						</div></dd></dl></div><div class="para">
				The servlet pattern configured in the <code class="filename">web.xml</code> is the path of the URL that is used. The connector parameter <code class="varname">servlet-path</code> on the connector configuration must match this using the application context of the web application if there is one.
			</div><div class="para">
				The servlet transport can also be used over SSL by adding the following configuration to the connector:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connector</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"netty-servlet"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;factory-class&gt;</span>
<span xmlns="" class="line">​</span>    org.hornetq.core.remoting.impl.netty.NettyConnectorFactory
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/factory-class&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"host"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"localhost"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"8443"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"use-servlet"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"servlet-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/messaging/HornetQServlet"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"ssl-enabled"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"key-store-path"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"path to a keystore"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"key-store-password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"keystore password"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connector&gt;</span></pre><div class="para">
				You will also have to configure the application server to use a Key Store. Edit the SSL/TLS connector configuration in <code class="filename">server/default/deploy/jbossweb.sar/server.xml</code> like so:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;Connector</span><span xmlns="" class="perl_Others"> protocol=</span><span xmlns="" class="perl_String">"HTTP/1.1"</span><span xmlns="" class="perl_Others"> SSLEnabled=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  port=</span><span xmlns="" class="perl_String">"8443"</span><span xmlns="" class="perl_Others"> address=</span><span xmlns="" class="perl_String">"${jboss.bind.address}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  scheme=</span><span xmlns="" class="perl_String">"https"</span><span xmlns="" class="perl_Others"> secure=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> clientAuth=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  keystoreFile=</span><span xmlns="" class="perl_String">"path to a keystore"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  keystorePass=</span><span xmlns="" class="perl_String">"keystore password"</span><span xmlns="" class="perl_Others"> sslProtocol</span> <span xmlns="" class="perl_Others">=</span> <span xmlns="" class="perl_String">"TLS"</span> <span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				In both cases you will need to provide a key store and password. See the Servlet SSL example shipped with HornetQ for more detail.
			</div></div></div></div></body></html>