<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 31. The JMS Bridge</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="jms-bridge">
      ⁠</a>Chapter 31. The JMS Bridge</h1></div></div></div><div class="para">
		HornetQ includes a fully-functional JMS message bridge, which consumes messages from a source queue or topic and sends them to a target queue or topic, usually on a different server.
	</div><div class="para">
		The source and target servers do not have to be in the same cluster which makes bridging suitable for reliably sending messages from one cluster to another, for instance across a WAN, and where the connection may be unreliable.
	</div><div class="para">
		The bridge can also be used to bridge messages from other non-HornetQ JMS servers that are JMS 1.1 compliant.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>A JMS bridge is not a Core bridge</strong></p></div><div class="admonition"><div class="para">
			A JMS bridge can be used to bridge any two JMS 1.1 compliant JMS providers and uses the JMS API. A Core bridge (described in <a class="xref" href="core-bridges.html">Chapter 34, <em>Core Bridges</em></a>) is used to bridge any two HornetQ instances and uses the core API. A core bridge will typically provide better performance than a JMS bridge, and provides once-and-only-once delivery guarantees without using XA.
		</div></div></div><div class="para">
		The bridge has built-in resilience to failure so if the source or target server connection is lost (for example, due to network failure), the bridge will attempt to reconnect to the target server until it comes back on line, at which point operations will resume as normal.
	</div><div class="para">
		The bridge can be configured with an optional JMS selector, so it will only consume messages matching that JMS selector.
	</div><div class="para">
		It can be configured to consume from a queue or a topic. When it consumes from a topic it can be configured to consume using a non-durable or durable subscription.
	</div><div class="para">
		The bridge is typically deployed by JBoss Microcontainer using a beans configuration file (<code class="filename">jms-bridge-jboss-beans.xml</code>), which is located in the <code class="filename">JBOSS_DIST/jboss-as/server/PROFILE/deploy</code> directory.
	</div><div class="para">
		<a class="xref" href="jms-bridge.html#exam-jms-bridge_xml_Sample_Config">Example 31.1, “jms-bridge-jboss-beans.xml Sample Config”</a> shows a configuration sample that bridges two destinations on the same server.
	</div><div class="example"><a id="exam-jms-bridge_xml_Sample_Config">
      ⁠</a><p class="title"><strong>Example 31.1. jms-bridge-jboss-beans.xml Sample Config</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JMSBridge"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hornetq.api.jms.bridge.impl.JMSBridgeImpl"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Comment">&lt;!-- HornetQ must be started before the bridge --&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>HornetQServer<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Source ConnectionFactory Factory --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"SourceCFF"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Target ConnectionFactory Factory --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"TargetCFF"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Source DestinationFactory --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"SourceDestinationFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Target DestinationFactory --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"TargetDestinationFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Source User Name (no user name here) --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Source Password (no password here)--&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Target User Name (no user name here)--&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Target Password (no password here)--&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Selector --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Failure Retry Interval (in ms) --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Max Retries --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Quality Of Service --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>ONCE_AND_ONLY_ONCE<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Max Batch Size --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Max Batch Time (-1 means infinite) --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>-1<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Subscription name (no subscription name here)--&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Client ID  (no client ID here)--&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;&lt;null</span> <span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Add MessageID In Header --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- register the JMS Bridge in the AS MBeanServer --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"MBeanServer"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>org.hornetq:service=JMSBridge<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"transactionManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"RealTransactionManager"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- SourceCFF describes the ConnectionFactory used to connect to the </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      source destination --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SourceCFF"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.hornetq.api.jms.bridge.impl.JNDIConnectionFactoryFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JNDI"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>/ConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- TargetCFF describes the ConnectionFactory used to connect to the </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  target destination --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TargetCFF"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.hornetq.api.jms.bridge.impl.JNDIConnectionFactoryFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JNDI"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>/ConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- SourceDestinationFactory describes the Destination used as the source --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SourceDestinationFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.hornetq.api.jms.bridge.impl.JNDIDestinationFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JNDI"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>/queue/source<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- TargetDestinationFactory describes the Destination used as the target --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TargetDestinationFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.hornetq.api.jms.bridge.impl.JNDIDestinationFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;constructor&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JNDI"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>/queue/target<span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- JNDI is a Hashtable containing the JNDI properties required --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- to connect to the sources and targets JMS resources         --&gt;</span>       
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDI"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.util.Hashtable"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;constructor</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.util.Map"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"java.util.Hashtable"</span><span xmlns="" class="perl_Others"> keyClass=</span><span xmlns="" class="perl_String">"String"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                                       valueClass=</span><span xmlns="" class="perl_String">"String"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key&gt;</span>java.naming.factory.initial<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>org.jnp.interfaces.NamingContextFactory<span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key&gt;</span>java.naming.provider.url<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>jnp://localhost:1099<span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;entry&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key&gt;</span>java.naming.factory.url.pkgs<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>org.jboss.naming:org.jnp.interfaces"<span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MBeanServer"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"javax.management.MBeanServer"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;constructor</span><span xmlns="" class="perl_Others"> factoryClass=</span><span xmlns="" class="perl_String">"org.jboss.mx.util.MBeanServerLocator"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                factoryMethod=</span><span xmlns="" class="perl_String">"locateJBoss"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905807784192">
      ⁠</a>31.1. JMS Bridge Parameters</h1></div></div></div><div class="para">
			The <code class="classname">JMSBridge</code> bean, as shown in <a class="xref" href="jms-bridge.html#exam-jms-bridge_xml_Sample_Config">Example 31.1, “jms-bridge-jboss-beans.xml Sample Config”</a>, is configured via parameters passed to its constructor in a particular order. This order, and a description of each parameter, is outlined in the list following.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				To leave a parameter unspecified (for example, if the authentication is anonymous or no message selector is provided), use <code class="literal">&lt;null /&gt;</code> for the unspecified parameter value.
			</div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <code class="varname">Source Connection Factory Factory</code> </span></dt><dd><div class="para">
						Injects the <code class="classname">SourceCFF</code> bean defined in the <code class="filename">jms-bridge-jboss-beans.xml</code> file, which creates the <code class="classname">ConnectionFactory</code>.
					</div></dd><dt><span class="term"> <code class="varname">Target Connection Factory Factory</code> </span></dt><dd><div class="para">
						Injects the <code class="classname">TargetCFF</code> bean defined in the <code class="filename">jms-bridge-jboss-beans.xml</code> file, which creates the target <code class="classname">ConnectionFactory</code>.
					</div></dd><dt><span class="term"> <code class="varname">Source Destination Factory Factory</code> </span></dt><dd><div class="para">
						Injects the <code class="literal">SourceDestinationFactory</code> bean defined in the <code class="filename">jms-bridge-jboss-beans.xml</code> file, which creates the source <code class="classname">Destination</code>.
					</div></dd><dt><span class="term"> <code class="varname">Target Destination Factory Factory</code> </span></dt><dd><div class="para">
						Injects the <code class="literal">TargetDestinationFactory</code> bean defined in the <code class="filename">jms-bridge-jboss-beans.xml</code> file, which creates the target <code class="classname">Destination</code>.
					</div></dd><dt><span class="term"> <code class="varname">Source User Name</code> </span></dt><dd><div class="para">
						Defines the username used to create the source connection.
					</div></dd><dt><span class="term"> <code class="varname">Source Password</code> </span></dt><dd><div class="para">
						Defines the password for the user name used to create the source connection.
					</div></dd><dt><span class="term"> <code class="varname">Target User Name</code> </span></dt><dd><div class="para">
						Defines the user name used to create the target connection.
					</div></dd><dt><span class="term"> <code class="varname">Target Password</code> </span></dt><dd><div class="para">
						Defines the password of the user name used to create the target connection.
					</div></dd><dt><span class="term"> <code class="varname">Selector</code> </span></dt><dd><div class="para">
						Specifies a JMS selector expression used when consuming messages from the source destination. Only messages that match the selector expression will be bridged from the source to the target destination. The selector expression must follow the <a href="http://java.sun.com/j2ee/1.4/docs/api/javax/jms/Message.html">JMS selector syntax</a>.
					</div></dd><dt><span class="term"> <code class="varname">Failure Retry Interval</code> </span></dt><dd><div class="para">
						Specifies the time in milliseconds to wait in between attempting to recreate connections to the source or target servers when the bridge detects a connection failure.
					</div></dd><dt><span class="term"> <code class="varname">Max Retries</code> </span></dt><dd><div class="para">
						Specifies the number of times to attempt to recreate connections to the source or target servers when the bridge detects a connection failure. The bridge will stop trying to reconnect after this number of tries. <code class="literal">-1</code> means 'try forever'.
					</div></dd><dt><span class="term"> <code class="varname">Quality of Service</code> </span></dt><dd><div class="para">
						Defines the quality of service mode. The possible values are:
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">AT_MOST_ONCE</code>
							</div></li><li class="listitem"><div class="para">
								<code class="literal">DUPLICATES_OK</code>
							</div></li><li class="listitem"><div class="para">
								<code class="literal">ONCE_AND_ONLY_ONCE</code>
							</div></li></ul></div><div class="para">
						See <a class="xref" href="jms-bridge.html#quality-of-service">Section 31.4, “Quality Of Service Modes”</a> for a explanation of these modes.
					</div></dd><dt><span class="term"> <code class="varname">Max Batch Size</code> </span></dt><dd><div class="para">
						Defines the maximum number of messages that should be consumed from the source connection before the messages are sent in a batch to the target destination. Its value must be <code class="literal">1</code> or greater.
					</div></dd><dt><span class="term"> <code class="varname">Max Batch Time</code> </span></dt><dd><div class="para">
						Defines the number of milliseconds to wait before sending a batch to the target destination, even if the number of messages consumed has not reached <code class="varname">MaxBatchSize</code>. Its value must be <code class="literal">1</code> or greater, or <code class="literal">-1</code> to specify 'wait forever'.
					</div></dd><dt><span class="term"> <code class="varname">Subscription Name</code> </span></dt><dd><div class="para">
						If the source destination is a topic, and you want to consume from the topic with a durable subscription, this parameter defines the durable subscription name.
					</div></dd><dt><span class="term"> <code class="varname">Client ID</code> </span></dt><dd><div class="para">
						If the source destination is a topic, and you want to consume from the topic with a durable subscription, this parameter defines the JMS client ID to use when creating or looking up the durable subscription.
					</div></dd><dt><span class="term"> <code class="varname">Add MessageID In Header</code> </span></dt><dd><div class="para">
						When <code class="literal">true</code>, the original message's message ID is appended to the message sent to the destination in the <code class="literal">HORNETQ_BRIDGE_MSG_ID_LIST</code> header. If the message is bridged multiple times, each message ID is appended. This lets you use a distributed response pattern.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							When a message is received, a response can be sent using the correlation ID of the first message ID so that when the original sender receives the response it is able to correlate the message.
						</div></div></div></dd><dt><span class="term"> <code class="varname">MBean Server</code> </span></dt><dd><div class="para">
						Set this to the place where the JMS Bridge is registered (the application server MBeanServer) to manage the JMS Bridge with JMX.
					</div></dd><dt><span class="term"> <code class="varname">ObjectName</code> </span></dt><dd><div class="para">
						If <code class="varname">MBeanServer</code> is set, this parameter must be set to define the name used to register the JMS Bridge MBean. This name must be unique.
					</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905851500336">
      ⁠</a>31.2. Source and Target Connection Factories</h1></div></div></div><div class="para">
			The source and target connection factory factories are used to create the connection factory that creates the connection for the source or target server.
		</div><div class="para">
			<a class="xref" href="jms-bridge.html#exam-jms-bridge_xml_Sample_Config">Example 31.1, “jms-bridge-jboss-beans.xml Sample Config”</a> uses the default implementation provided by HornetQ, which looks up the connection factory using JNDI. For other JMS providers, a different implementation may be required. To do so, implement the <code class="classname">org.hornetq.jms.bridge.ConnectionFactoryFactory</code> interface.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905851497200">
      ⁠</a>31.3. Source and Target Destination Factories</h1></div></div></div><div class="para">
			These create or look up the destinations.
		</div><div class="para">
			<a class="xref" href="jms-bridge.html#exam-jms-bridge_xml_Sample_Config">Example 31.1, “jms-bridge-jboss-beans.xml Sample Config”</a> uses the default implementation provided by HornetQ that looks up the destination using JNDI.
		</div><div class="para">
			Different implementations can be provided with the <code class="classname">org.hornetq.jms.bridge.DestinationFactory</code> interface.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="quality-of-service">
      ⁠</a>31.4. Quality Of Service Modes</h1></div></div></div><div class="para">
			The quality of service modes used by the bridge are described here in more detail.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905853578640">
      ⁠</a>31.4.1. AT_MOST_ONCE</h2></div></div></div><div class="para">
				Messages reach the destination once at most. Messages are consumed from the source and acknowledged before they are sent to the destination. If failure occurs between leaving the source and arriving at the destination, messages can be lost. This mode is available for both durable and non-durable messages.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905811318960">
      ⁠</a>31.4.2. DUPLICATES_OK</h2></div></div></div><div class="para">
				Messages are consumed from the source and acknowledged after they are successfully sent to the destination. If failure occurs after messages are sent, but before acknowledgment is returned, messages can be sent again once the system recovers, so the destination may receive duplicates after a failure. This mode is available for both durable and non-durable messages.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905811317152">
      ⁠</a>31.4.3. ONCE_AND_ONLY_ONCE</h2></div></div></div><div class="para">
				Messages reach the destination exactly once. If both source and destination are on the same HornetQ server instance, this mode sends and acknowledges messages as part of the same local transaction. If the source and destination are on different servers, this mode enlists the sending and consumption sessions in a JTA transaction.
			</div><div class="para">
				This JTA transaction is controlled by JBoss Transactions JTA, a full-recovery transaction manager which provides a very high degree of durability. If JTA is required, both supplied connection factories must be <code class="classname">XAConnectionFactory</code> implementations.
			</div><div class="para">
				This is likely to be the slowest mode, since it requires extra persistence. This mode is only available for durable messages.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					For some applications, once and only once semantics could be provided by setting the <code class="literal">DUPLICATES_OK</code> mode and then checking for and discarding duplicate messages on the destination. This approach is not as reliable as using <code class="literal">ONCE_AND_ONLY_ONCE</code> mode, but may be a useful alternative.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905870493904">
      ⁠</a>31.4.4. Time outs and the JMS bridge</h2></div></div></div><div class="para">
				There is a possibility that the target or source server will not be available at some point in time. If this occurs then the bridge will try <code class="literal">Max Retries</code> to reconnect every <code class="literal">Failure Retry Interval</code> milliseconds as specified in the JMS Bridge definition.
			</div><div class="para">
				However since a third party JNDI is used, in this case the JBoss naming server, it is possible for the JNDI lookup to hang if the network were to disappear during the JNDI lookup. To stop this occurring the JNDI definition can be configured to time out if this occurs. To do this set the <code class="literal">jnp.timeout</code> and the <code class="literal">jnp.sotimeout</code> on the Initial Context definition. The first sets the connection timeout for the initial connection and the second the read timeout for the socket.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Once the initial JNDI connection has succeeded all calls are made using Remote Method Invocation (RMI). If you want to control the timeouts for the RMI connections then this can be done via system properties. JBoss uses Oracle's RMI and the properties can be found <a href="http://download.oracle.com/javase/1.4.2/docs/guide/rmi/sunrmiproperties.html">here</a>. The default connection timeout is 10 seconds and the default read timeout is 18 seconds.
				</div></div></div><div class="para">
				If you implement your own factories for looking up JMS resources then you will have to bear in mind timeout issues.
			</div></div></div></div></body></html>