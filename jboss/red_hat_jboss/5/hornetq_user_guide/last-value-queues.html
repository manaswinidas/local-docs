<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 25. Last-Value Queues</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="last-value-queues">
      ⁠</a>Chapter 25. Last-Value Queues</h1></div></div></div><div class="para">
		Last-Value queues are special queues which discard any messages when a newer message with the same value for a well-defined Last-Value property is put in the queue.
	</div><div class="para">
		A typical example for Last-Value queue is for stock market prices, where you are only interested in the latest value for a particular stock.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905848329520">
      ⁠</a>25.1. Configuring Last-Value Queues</h1></div></div></div><div class="para">
			Last-value queues are defined in the address-setting configuration:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;address-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.lastValueQueue"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;last-value-queue&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/last-value-queue&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/address-setting&gt;</span></pre><div class="para">
			By default, <code class="literal">last-value-queue</code> is false. Address wildcards can be used to configure Last-Value queues for a set of addresses (see <a class="xref" href="wildcard-syntax.html">Chapter 11, <em>Understanding the HornetQ Wildcard Syntax</em></a>).
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905800591984">
      ⁠</a>25.2. Using Last-Value Property</h1></div></div></div><div class="para">
			The property name used to identify the last value is <code class="literal">"_HQ_LVQ_NAME"</code> (or the constant <code class="literal">Message.HDR_LAST_VALUE_NAME</code> from the Core API).
		</div><div class="para">
			For example, if two messages with the same value for the Last-Value property are sent to a Last-Value queue, only the latest message will be kept in the queue:
		</div><pre class="programlisting">
// send 1st message with Last-Value property set to STOCK_NAME
TextMessage message = 
  session.createTextMessage("1st message with Last-Value property set");
message.setStringProperty("_HQ_LVQ_NAME", "STOCK_NAME");
producer.send(message);

// send 2nd message with Last-Value property set to STOCK_NAME             
message = 
  session.createTextMessage("2nd message with Last-Value property set");
message.setStringProperty("_HQ_LVQ_NAME", "STOCK_NAME");
producer.send(message);
       
...
       
// only the 2nd message will be received: it is the latest with 
// the Last-Value property set
TextMessage messageReceived = (TextMessage)messageConsumer.receive(5000);
System.out.format("Received message: %s\n", messageReceived.getText());
</pre></div></div></body></html>