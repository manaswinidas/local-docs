<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 27. Pre-Acknowledge Mode</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="pre-acknowledge">
      ⁠</a>Chapter 27. Pre-Acknowledge Mode</h1></div></div></div><div class="para">
		JMS specifies three acknowledgment modes:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				<code class="literal">AUTO_ACKNOWLEDGE</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">CLIENT_ACKNOWLEDGE</code>
			</div></li><li class="listitem"><div class="para">
				<code class="literal">DUPS_OK_ACKNOWLEDGE</code>
			</div></li></ul></div><div class="para">
		However there is another case which is not supported by JMS. In some cases you can afford to lose messages in event of failure, so it would make sense to acknowledge the message on the server <span class="emphasis"><em>before</em></span> delivering it to the client.
	</div><div class="para">
		This extra mode is referred to in HornetQ as <em class="firstterm">pre-acknowledge</em> mode.
	</div><div class="para">
		The disadvantage of acknowledging on the server before delivery is that the message will be lost if the system crashes <span class="emphasis"><em>after</em></span> acknowledging the message on the server but <span class="emphasis"><em>before</em></span> it is delivered to the client.
	</div><div class="para">
		Depending on your messaging case, pre-acknowledgement mode can avoid extra network traffic and CPU at the cost of coping with message loss.
	</div><div class="para">
		An example of a use case for pre-acknowledgment is for stock price update messages. With these messages it might be reasonable to lose a message in event of crash, since the next price update message will arrive soon, overriding the previous price.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			Please note, that if you use pre-acknowledge mode, then you will lose transactional semantics for messages being consumed. This is because they are being acknowledged first on the server, not when you commit the transaction.
		</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="pre-acknowledge.configure">
      ⁠</a>27.1. Using PRE_ACKNOWLEDGE</h1></div></div></div><div class="para">
			This can be configured in the <code class="filename"><em class="replaceable">JBOSS_DIST</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-jms.xml</code> file on the <code class="literal">connection factory</code> like this:
		</div><pre class="programlisting">&lt;connection-factory name="NettyConnectionFactory"&gt;
   &lt;connectors&gt;
      &lt;connector-ref connector-name="netty-connector"/&gt;
   &lt;/connectors&gt;
   &lt;entries&gt;
      &lt;entry name="/ConnectionFactory"/&gt;
   &lt;/entries&gt;
   &lt;pre-acknowledge&gt;true&lt;/pre-acknowledge&gt;
&lt;/connection-factory&gt;</pre><div class="para">
			Alternatively, to use pre-acknowledgment mode using the JMS API, create a JMS Session with the <code class="literal">HornetQSession.PRE_ACKNOWLEDGE</code> constant.
		</div><pre class="programlisting">
// messages will be acknowledge on the server *before* being delivered to the client
Session session = connection.createSession(false, HornetQSession.PRE_ACKNOWLEDGE);
</pre><div class="para">
			Or you can set pre-acknowledge directly on the <code class="literal">HornetQConnectionFactory</code> instance using the setter method.
		</div><div class="para">
			To use pre-acknowledgment mode using the core API you can set it directly on the <code class="literal">ClientSessionFactory</code> instance using the setter method.
		</div></div></div></body></html>