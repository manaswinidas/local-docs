<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 28. Management</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="management">
      ⁠</a>Chapter 28. Management</h1></div></div></div><div class="para">
		HornetQ has an extensive management API that allows a user to:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Modify a server configuration;
			</div></li><li class="listitem"><div class="para">
				Create new resources (for example, JMS queues and topics);
			</div></li><li class="listitem"><div class="para">
				Inspect these resources (for example, how many messages are currently held in a queue);
			</div></li><li class="listitem"><div class="para">
				Interact with it (that is, to remove messages from a queue).
			</div></li></ul></div><div class="para">
		All the operations allow a client to <span class="emphasis"><em>manage</em></span> HornetQ. It also allows clients to subscribe to management notifications.
	</div><div class="para">
		There are three ways to manage HornetQ:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Using JMX; JMX is the standard way to manage Java applications.
			</div></li><li class="listitem"><div class="para">
				Using the core API; management operations are sent to HornetQ server using core messages.
			</div></li><li class="listitem"><div class="para">
				Using the JMS API; management operations are sent to HornetQ server using JMS messages.
			</div></li></ul></div><div class="para">
		Although there are three different ways to manage HornetQ, each API supports the same functionality. If it is possible to manage a resource using JMX it is also possible to achieve the same result using core messages or JMS messages.
	</div><div class="para">
		This choice depends on your requirements, your application settings, and your environment, to decide which way suits you best.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905844601248">
      ⁠</a>28.1. The Management API</h1></div></div></div><div class="para">
			The management API is the same regardless of the way you invoke management operations. A Java interface describing what can be invoked exists for each type of managed resource.
		</div><div class="para">
			HornetQ exposes its managed resources in two packages:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Core resources are located in the <span class="package">org.hornetq.api.core.management</span> package.
				</div></li><li class="listitem"><div class="para">
					<span class="emphasis"><em>JMS</em></span> resources are located in the <span class="package">org.hornetq.api.jms.management</span> package.
				</div></li></ul></div><div class="para">
			The way to invoke a management operation depends whether JMX, core messages, or JMS messages are used.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				A few management operations requires a filter parameter to choose which messages are involved by the operation. Passing <code class="literal">null</code> or an empty string means that the management operation will be performed on <span class="emphasis"><em>all messages</em></span>.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905843671552">
      ⁠</a>28.1.1. Core Management API</h2></div></div></div><div class="para">
				HornetQ defines a core management API to manage core resources. In summary:
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905843670304">
      ⁠</a>28.1.1.1. Core Server Management</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Listing, creating, deploying and destroying queues</span></dt><dd><div class="para">
								A list of deployed core queues can be retrieved using the <code class="methodname">getQueueNames()</code> method.
							</div><div class="para">
								Core queues can be created or destroyed using the management operations:
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
										<code class="methodname">createQueue()</code>
									</div></li><li class="listitem"><div class="para">
										<code class="methodname">deployQueue()</code>
									</div></li><li class="listitem"><div class="para">
										<code class="methodname">destroyQueue()</code> on the <code class="classname">HornetQServerControl</code> (with the ObjectName <code class="classname">org.hornetq:module=Core,type=Server</code> or the resource name <code class="classname">core.server</code>)
									</div></li></ul></div><div class="para">
								<code class="methodname">createQueue</code> will fail if the queue already exists while <code class="methodname">deployQueue</code> will do nothing.
							</div></dd><dt><span class="term">Pausing and resuming Queues</span></dt><dd><div class="para">
								The <code class="methodname">QueueControl</code> can pause and resume the underlying queue. When a queue is paused, it will receive messages but will not deliver them. When it is resumed, it will begin delivering the queued messages.
							</div></dd><dt><span class="term">Listing and closing remote connections</span></dt><dd><div class="para">
								Client remote addresses can be retrieved using <code class="methodname">listRemoteAddresses()</code>. It is also possible to close the connections associated with a remote address using the <code class="methodname">closeConnectionsForAddress()</code> method.
							</div><div class="para">
								Alternatively, connection ids can be listed using <code class="methodname">listConnectionIDs()</code> and all the sessions for a given connection id can be listed using <code class="methodname">listSessions()</code>.
							</div></dd><dt><span class="term">Transaction heuristic operations</span></dt><dd><div class="para">
								In the case of a server crash, some transactions may require manual intervention when the server restarts. The <code class="methodname">listPreparedTransactions()</code> method lists the transactions which are in the prepared states (the transactions are represented as opaque Base64 Strings.) To commit or rollback a given prepared transaction, the <code class="methodname">commitPreparedTransaction()</code> or <code class="methodname">rollbackPreparedTransaction()</code> method can be used to resolve heuristic transactions. Heuristically completed transactions can be listed using the <code class="methodname">listHeuristicCommittedTransactions()</code> and <code class="methodname">listHeuristicRolledBackTransactions</code> methods.
							</div></dd><dt><span class="term">Enabling and resetting Message counters</span></dt><dd><div class="para">
								Message counters can be enabled or disabled using the <code class="methodname">enableMessageCounters()</code> or <code class="methodname">disableMessageCounters()</code> method. To reset message counters, it is possible to invoke <code class="methodname">resetAllMessageCounters()</code> and <code class="methodname">resetAllMessageCounterHistories()</code> methods.
							</div></dd><dt><span class="term">Retrieving the server configuration and attributes</span></dt><dd><div class="para">
								The <code class="methodname">HornetQServerControl</code> exposes HornetQ server configuration through all its attributes (for example, <code class="methodname">getVersion()</code> method to retrieve the server's version, and so on.)
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905847333872">
      ⁠</a>28.1.1.2. Core Address Management</h3></div></div></div><div class="para">
					Core addresses can be managed using the <code class="classname">AddressControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=Address,name="&lt;the address name&gt;"</code> or the resource name <code class="classname">core.address.&lt;the address name&gt;</code>).
				</div><div class="para">
					Modifying roles and permissions for an address
				</div><div class="para">
					You can add or remove roles associated to a queue using the <code class="methodname">addRole()</code> or <code class="methodname">removeRole()</code> methods. You can list all the roles associated with the queue with the <code class="methodname">getRoles()</code> method.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905856048528">
      ⁠</a>28.1.1.3. Core Queue Management</h3></div></div></div><div class="para">
					The bulk of the core management APIs deal with core queues. The <code class="classname">QueueControl</code> class defines the core queue management operations (with the ObjectName <code class="classname">org.hornetq:module=Core,type=Queue,address="&lt;the bound address&gt;",name="&lt;the queue name&gt;"</code> or the resource name <code class="classname">core.queue.&lt;the queue name&gt;</code>).
				</div><div class="para">
					Most of the management operations on queues take either a single message id (for example, to remove a single message) or a filter (for example, to expire all messages with a given property.)
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Expiring, sending to a dead letter address and moving messages</span></dt><dd><div class="para">
								Messages can be expired from a queue by using the <code class="methodname">expireMessages()</code> method. If an expiry address is defined, messages will be sent to it, otherwise they are discarded. The queue's expiry address can be set with the <code class="methodname">setExpiryAddress()</code> method.
							</div><div class="para">
								Messages can also be sent to a dead letter address with the <code class="methodname">sendMessagesToDeadLetterAddress()</code> method. It returns the number of messages which are sent to the dead letter address. If a dead letter address is not defined, message are removed from the queue and discarded. The queue's dead letter address can be set with the <code class="methodname">setDeadLetterAddress()</code> method.
							</div><div class="para">
								Messages can also be moved from a queue to another queue by using the <code class="methodname">moveMessages()</code> method.
							</div></dd><dt><span class="term">Listing and removing messages</span></dt><dd><div class="para">
								Messages can be listed from a queue by using the <code class="methodname">listMessages()</code> method which returns an array of <span class="type">Map</span>; one <span class="type">Map</span> for each message.
							</div><div class="para">
								Messages can also be removed from the queue by using the <code class="methodname">removeMessages()</code> method which returns a <span class="type">boolean</span> for the single message id variant or the number of removed messages for the filter variant. The <code class="methodname">removeMessages()</code> method takes a <span class="type">filter</span> argument to remove only filtered messages. Setting the filter to an empty string will remove all messages.
							</div></dd><dt><span class="term">Counting messages</span></dt><dd><div class="para">
								The number of messages in a queue is returned by the <code class="methodname">getMessageCount()</code> method. Alternatively, the <code class="methodname">countMessages()</code> will return the number of messages in the queue which match a given filter
							</div></dd><dt><span class="term">Changing message priority</span></dt><dd><div class="para">
								The message priority can be changed by using the <code class="methodname">changeMessagesPriority()</code> method which returns a <span class="type">boolean</span> for the single message id variant or the number of updated messages for the filter variant.
							</div></dd><dt><span class="term">Message counters</span></dt><dd><div class="para">
								Message counters can be listed for a queue with the <code class="methodname">listMessageCounter()</code> and <code class="methodname">listMessageCounterHistory()</code> methods (see <a class="xref" href="management.html#management.message-counters">Section 28.6, “Message Counters”</a>). The message counters can also be reset for a single queue using the <code class="methodname">resetMessageCounter()</code> method.
							</div></dd><dt><span class="term">Retrieving the queue attributes</span></dt><dd><div class="para">
								The <code class="methodname">QueueControl</code> exposes core queue settings through its attributes (for example, <code class="methodname">getFilter()</code> to retrieve the queue's filter if it was created with one, <code class="methodname">isDurable()</code> to know whether the queue is durable or not, and so on).
							</div></dd><dt><span class="term">Pausing and resuming Queues</span></dt><dd><div class="para">
								The <code class="methodname">QueueControl</code> can pause and resume the underlying queue. When a queue is paused, it will receive messages but will not deliver them. When it is resumed, it will begin delivering the queued messages.
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905871619088">
      ⁠</a>28.1.1.4. Other Core Resources Management</h3></div></div></div><div class="para">
					HornetQ allows the user to start and stop its remote resources (acceptors, diverts, bridges, and so on) so that a server can be taken offline without stopping it completely (for example, if other management operations must be performed such as resolving heuristic transactions). These resources are:
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Acceptors</span></dt><dd><div class="para">
								Acceptors can be started or stopped using the <code class="methodname">start()</code> or. <code class="methodname">stop()</code> method on the <code class="classname">AcceptorControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=Acceptor,name="&lt;the acceptor name&gt;"</code> or the resource name <code class="classname">core.acceptor.&lt;the address name&gt;</code>). The parameters of the acceptors can be retrieved using the <code class="classname">AcceptorControl</code> attributes (see <a class="xref" href="configuring-transports.html#configuring-transports.acceptors">Section 14.1, “Understanding Acceptors”</a>)
							</div></dd><dt><span class="term">Diverts</span></dt><dd><div class="para">
								Diverts can be started or stopped using the <code class="methodname">start()</code> or <code class="methodname">stop()</code> method on the <code class="classname">DivertControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=Divert,name=&lt;the divert name&gt;</code> or the resource name <code class="classname">core.divert.&lt;the divert name&gt;</code>). Diverts parameters can be retrieved using the <code class="classname">DivertControl</code> attributes (see <a class="xref" href="diverts.html">Chapter 33, <em>Diverting and Splitting Message Flows</em></a>)
							</div></dd><dt><span class="term">Bridges</span></dt><dd><div class="para">
								They can be started or stopped using the <code class="methodname">start()</code> (resp. <code class="methodname">stop()</code>) method on the <code class="classname">BridgeControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=Bridge,name="&lt;the bridge name&gt;"</code> or the resource name <code class="classname">core.bridge.&lt;the bridge name&gt;</code>). Bridges parameters can be retrieved using the <code class="classname">BridgeControl</code> attributes (see <a class="xref" href="core-bridges.html">Chapter 34, <em>Core Bridges</em></a>)
							</div></dd><dt><span class="term">Broadcast groups</span></dt><dd><div class="para">
								Broadcast groups can be started or stopped using the <code class="methodname">start()</code> or <code class="methodname">stop()</code> method on the <code class="classname">BroadcastGroupControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=BroadcastGroup,name="&lt;the broadcast group name&gt;"</code> or the resource name <code class="classname">core.broadcastgroup.&lt;the broadcast group name&gt;</code>). Broadcast groups parameters can be retrieved using the <code class="classname">BroadcastGroupControl</code> attributes (see <a class="xref" href="clusters.html#clusters.broadcast-groups">Section 36.2.1, “Broadcast Groups”</a>)
							</div></dd><dt><span class="term">Discovery groups</span></dt><dd><div class="para">
								They can be started or stopped using the <code class="methodname">start()</code> or <code class="methodname">stop()</code> method on the <code class="classname">DiscoveryGroupControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=DiscoveryGroup,name="&lt;the discovery group name&gt;"</code> or the resource name <code class="classname">core.discovery.&lt;the discovery group name&gt;</code>). Discovery groups parameters can be retrieved using the <code class="classname">DiscoveryGroupControl</code> attributes (see <a class="xref" href="clusters.html#clusters.discovery-groups">Section 36.2.2, “Discovery Groups”</a>)
							</div></dd><dt><span class="term">Cluster connections</span></dt><dd><div class="para">
								They can be started or stopped using the <code class="methodname">start()</code> or <code class="methodname">stop()</code> method on the <code class="classname">ClusterConnectionControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=Core,type=ClusterConnection,name="&lt;the cluster connection name&gt;"</code> or the resource name <code class="classname">core.clusterconnection.&lt;the cluster connection name&gt;</code>). Cluster connections parameters can be retrieved using the <code class="classname">ClusterConnectionControl</code> attributes (see <a class="xref" href="clusters.html#clusters.cluster-connections">Section 36.3.1, “Configuring Cluster Connections”</a>)
							</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905800462096">
      ⁠</a>28.1.2. JMS Management API</h2></div></div></div><div class="para">
				HornetQ defines a JMS Management API to manage JMS administrated objects (that is, JMS queues, topics and connection factories).
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905800460688">
      ⁠</a>28.1.2.1. JMS Server Management</h3></div></div></div><div class="para">
					JMS Resources (connection factories and destinations) can be created using the <code class="classname">JMSServerControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=JMS,type=Server</code> or the resource name <code class="classname">jms.server</code>).
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Listing, creating, destroying connection factories</span></dt><dd><div class="para">
								Names of the deployed connection factories can be retrieved by the <code class="methodname">getConnectionFactoryNames()</code> method.
							</div><div class="para">
								JMS connection factories can be created or destroyed using the <code class="methodname">createConnectionFactory()</code> methods or <code class="methodname">destroyConnectionFactory()</code> methods. These connection factories are bound to JNDI so that JMS clients can look them up. If a graphical console is used to create the connection factories, the transport parameters are specified in the text field input as a comma-separated list of key=value (that is, <code class="literal">key1=10, key2="value", key3=false</code>). If there are multiple transports defined, you need to enclose the key/value pairs between curly braces. For example <code class="literal">{key=10}, {key=20}</code>. In that case, the first <code class="literal">key</code> will be associated to the first transport configuration and the second <code class="literal">key</code> will be associated to the second transport configuration (see <a class="xref" href="configuring-transports.html">Chapter 14, <em>Configuring the Transport</em></a> for a list of the transport parameters)
							</div></dd><dt><span class="term">Listing, creating, destroying queues</span></dt><dd><div class="para">
								Names of the deployed JMS queues can be retrieved by the <code class="methodname">getQueueNames()</code> method.
							</div><div class="para">
								JMS queues can be created or destroyed using the <code class="methodname">createQueue()</code> methods or <code class="methodname">destroyQueue()</code> methods. These queues are bound to JNDI so that JMS clients can look them up
							</div></dd><dt><span class="term">Listing, creating/destroying topics</span></dt><dd><div class="para">
								Names of the deployed topics can be retrieved by the <code class="methodname">getTopicNames()</code> method.
							</div><div class="para">
								JMS topics can be created or destroyed using the <code class="methodname">createTopic()</code> or <code class="methodname">destroyTopic()</code> methods. These topics are bound to JNDI so that JMS clients can look them up.
							</div></dd><dt><span class="term">Listing and closing remote connections</span></dt><dd><div class="para">
								JMS Clients remote addresses can be retrieved using <code class="methodname">listRemoteAddresses()</code>. It is also possible to close the connections associated with a remote address using the <code class="methodname">closeConnectionsForAddress()</code> method.
							</div><div class="para">
								Alternatively, connection ids can be listed using <code class="methodname">listConnectionIDs()</code> and all the sessions for a given connection id can be listed using <code class="methodname">listSessions()</code>.
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905866239648">
      ⁠</a>28.1.2.2. JMS ConnectionFactory Management</h3></div></div></div><div class="para">
					JMS Connection Factories can be managed using the <code class="literal">ConnectionFactoryControl</code> class (with the ObjectName <code class="literal">org.hornetq:module=JMS,type=ConnectionFactory,name="&lt;the connection factory name&gt;"</code> or the resource name <code class="literal">jms.connectionfactory.&lt;the connection factory name&gt;</code>).
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Retrieving connection factory attributes</span></dt><dd><div class="para">
								The <code class="methodname">ConnectionFactoryControl</code> exposes JMS ConnectionFactory configuration through its attributes (that is, <code class="methodname">getConsumerWindowSize()</code> to retrieve the consumer window size for flow control, <code class="methodname">isBlockOnNonDurableSend()</code> to know whether the producers created from the connection factory will block when sending non-durable messages, and so on).
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905844027648">
      ⁠</a>28.1.2.3. JMS Queue Management</h3></div></div></div><div class="para">
					JMS queues can be managed using the <code class="classname">JMSQueueControl</code> class (with the ObjectName <code class="classname">org.hornetq:module=JMS,type=Queue,name="&lt;the queue name&gt;"</code> or the resource name <code class="classname">jms.queue.&lt;the queue name&gt;</code>).
				</div><div class="para">
					The management operations on a JMS queue are very similar to the operations on a core queue.
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Expiring, sending to a dead letter address and moving messages</span></dt><dd><div class="para">
								Messages can be expired from a queue by using the <code class="methodname">expireMessages()</code> method. If an expiry address is defined, messages will be sent to it, otherwise they are discarded. The queue's expiry address can be set with the <code class="methodname">setExpiryAddress()</code> method.
							</div><div class="para">
								Messages can also be sent to a dead letter address with the <code class="methodname">sendMessagesToDeadLetterAddress()</code> method. It returns the number of messages which are sent to the dead letter address. If a dead letter address is not defined, message are removed from the queue and discarded. The queue's dead letter address can be set with the <code class="methodname">setDeadLetterAddress()</code> method.
							</div><div class="para">
								Messages can also be moved from a queue to another queue by using the <code class="methodname">moveMessages()</code> method.
							</div></dd><dt><span class="term">Listing and removing messages</span></dt><dd><div class="para">
								Messages can be listed from a queue by using the <code class="methodname">listMessages()</code> method which returns an array of <span class="type">Map</span>, one <span class="type">Map</span> for each message.
							</div><div class="para">
								Messages can also be removed from the queue by using the <code class="methodname">removeMessages()</code> method which returns a <span class="type">boolean</span> for the single message ID variant or the number of removed messages for the filter variant. The <code class="methodname">removeMessages()</code> method takes a <code class="varname">filter</code> argument to remove only filtered messages. Setting the filter to an empty string will in effect remove all messages.
							</div></dd><dt><span class="term">Counting messages</span></dt><dd><div class="para">
								The number of messages in a queue is returned by the <code class="methodname">getMessageCount()</code> method. Alternatively, the <code class="methodname">countMessages()</code> will return the number of messages in the queue which match a given filter
							</div></dd><dt><span class="term">Changing message priority</span></dt><dd><div class="para">
								The message priority can be changed by using the <code class="methodname">changeMessagesPriority()</code> method which returns a <span class="type">boolean</span> for the single message id variant or the number of updated messages for the filter variant.
							</div></dd><dt><span class="term">Message counters</span></dt><dd><div class="para">
								Message counters can be listed for a queue with the <code class="methodname">listMessageCounter()</code> and <code class="methodname">listMessageCounterHistory()</code> methods (see <a class="xref" href="management.html#management.message-counters">Section 28.6, “Message Counters”</a>)
							</div></dd><dt><span class="term">Retrieving the queue attributes</span></dt><dd><div class="para">
								The <code class="methodname">JMSQueueControl</code> exposes JMS queue settings through its attributes (for example, <code class="classname">isTemporary()</code> to know whether the queue is temporary or not, <code class="classname">isDurable()</code> to know whether the queue is durable or not, and so on.)
							</div></dd><dt><span class="term">Pausing and resuming queues</span></dt><dd><div class="para">
								The <code class="methodname">JMSQueueControl</code> can pause and resume the underlying queue. When the queue is paused it will continue to receive messages but will not deliver them. When resumed again it will deliver the enqueued messages.
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139905803758192">
      ⁠</a>28.1.2.4. JMS Topic Management</h3></div></div></div><div class="para">
					JMS Topics can be managed using the <code class="literal">TopicControl</code> class (with the ObjectName <code class="literal">org.hornetq:module=JMS,type=Topic,name="&lt;the topic name&gt;"</code> or the resource name <code class="literal">jms.topic.&lt;the topic name&gt;</code>).
				</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Listing subscriptions and messages</span></dt><dd><div class="para">
								JMS topics subscriptions can be listed using the <code class="methodname">listAllSubscriptions()</code>, <code class="methodname">listDurableSubscriptions()</code>, <code class="methodname">listNonDurableSubscriptions()</code> methods. These methods return arrays of <span class="type">Object</span> representing the subscriptions information (subscription name, client ID, durability, message count, and so on). It is also possible to list the JMS messages for a given subscription with the <code class="methodname">listMessagesForSubscription()</code> method.
							</div></dd><dt><span class="term">Dropping subscriptions</span></dt><dd><div class="para">
								Durable subscriptions can be dropped from the topic using the <code class="methodname">dropDurableSubscription()</code> method.
							</div></dd><dt><span class="term">Counting subscriptions messages</span></dt><dd><div class="para">
								The <code class="methodname">countMessagesForSubscription()</code> method can be used to determine the number of messages held for a given subscription (with an optional message selector to determine the number of messages matching the selector).
							</div></dd></dl></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="management.jmx">
      ⁠</a>28.2. Using Management Via JMX</h1></div></div></div><div class="para">
			HornetQ can be managed using JMX.
		</div><div class="para">
			The management API is exposed by HornetQ using MBeans interfaces. HornetQ registers its resources with the domain <code class="literal">org.hornetq</code>.
		</div><div class="para">
			For example, the <code class="classname">ObjectName</code> to manage a JMS Queue <code class="classname">exampleQueue</code> is:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hornetq</span>:module=JMS,type=Queue,name=<span xmlns="" class="perl_String">"exampleQueue"</span>
</pre><div class="para">
			The MBean is:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>org.<span xmlns="" class="perl_Function">hornetq</span>.<span xmlns="" class="perl_Function">api</span>.<span xmlns="" class="perl_Function">jms</span>.<span xmlns="" class="perl_Function">management</span>.<span xmlns="" class="perl_Function">JMSQueueControl</span>
</pre><div class="para">
			The MBean <code class="classname">ObjectName</code> is built using the helper class <code class="classname">org.hornetq.api.core.management.ObjectNameBuilder</code>. You can also use <code class="classname">jconsole</code> to find the <code class="classname">ObjectName</code> of the MBeans you want to manage.
		</div><div class="para">
			Managing HornetQ using JMX is identical to management of any Java Applications using JMX. It can be done by reflection or by creating proxies of the MBeans.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="management.jmx.configuration">
      ⁠</a>28.2.1. Configuring JMX</h2></div></div></div><div class="para">
				By default, JMX is enabled to manage HornetQ. It can be disabled by setting <code class="varname">jmx-management-enabled</code> to <code class="option">false</code> in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- false to disable JMX management for HornetQ --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jmx-management-enabled&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/jmx-management-enabled&gt;</span></pre><div class="para">
				If JMX is enabled, HornetQ can be managed locally using <code class="literal">jconsole</code>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Remote connections to JMX are not enabled by default for security reasons. System properties must be set in <code class="filename">run.sh</code> or <code class="filename">run.bat</code> scripts.
				</div></div></div><div class="para">
				By default, the HornetQ server uses the JMX domain "org.hornetq". To manage several HornetQ servers from the same MBeanServer, the JMX domain can be configured for each individual HornetQ server by setting <code class="literal">jmx-domain</code> in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- use a specific JMX domain for HornetQ MBeans --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jmx-domain&gt;</span>my.org.hornetq<span xmlns="" class="perl_Keyword">&lt;/jmx-domain&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905842886800">
      ⁠</a>28.3. Using Management Via Core API</h1></div></div></div><div class="para">
			The core management API in HornetQ is called by sending core messages to the <span class="emphasis"><em>management address</em></span>.
		</div><div class="para">
			<span class="emphasis"><em>Management messages</em></span> are regular core messages with well-known properties that the server needs to understand to interact with the management API:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					The name of the managed resource
				</div></li><li class="listitem"><div class="para">
					The name of the management operation
				</div></li><li class="listitem"><div class="para">
					The parameters of the management operation
				</div></li></ul></div><div class="para">
			When a management message is sent to the management address, HornetQ processes the message in the following way:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					extracts the information
				</div></li><li class="listitem"><div class="para">
					invokes the operation on the managed resources
				</div></li><li class="listitem"><div class="para">
					sends a <span class="emphasis"><em>management reply</em></span> to the management message's reply-to address.
				</div></li></ul></div><div class="para">
			The management reply sent to the reply-to address is controlled by the <code class="classname">org.hornetq.core.client.impl.ClientMessageImpl.REPLYTO_HEADER_NAME</code> parameter.
		</div><div class="para">
			A <code class="literal">ClientConsumer</code> can be used to consume the management reply and retrieve the result of the operation (if any) stored in the body of the reply. For portability, results are returned as a JSON string rather than Java Serialization. The <code class="literal">org.hornetq.api.core.management.ManagementHelper</code> can be used to convert the JSON string to Java objects.
		</div><div class="para">
			These steps can be simplified to make it easier to invoke management operations using Core messages:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139905874140240">
      ⁠</a><p class="title"><strong>Procedure 28.1. Invoking Management Operations</strong></p><ol class="1"><li class="step"><p class="title"><strong>Step One</strong></p><div class="para">
					Create a <code class="literal">ClientRequestor</code> to send messages to the management address and receive replies
				</div></li><li class="step"><p class="title"><strong>Step Two</strong></p><div class="para">
					Create a <code class="literal">ClientMessage</code>
				</div></li><li class="step"><p class="title"><strong>Step Three</strong></p><div class="para">
					Use the helper class <code class="literal">org.hornetq.api.core.management.ManagementHelper</code> to fill the message with the management properties.
				</div></li><li class="step"><p class="title"><strong>Step Four</strong></p><div class="para">
					Send the message using the <code class="literal">ClientRequestor</code>
				</div></li><li class="step"><p class="title"><strong>Step Five</strong></p><div class="para">
					Use the helper class <code class="literal">org.hornetq.api.core.management.ManagementHelper</code> to retrieve the operation result from the management reply.
				</div></li></ol></div><div class="para">
			For example, to find out the number of messages in the core queue <code class="literal">exampleQueue</code>:
		</div><pre class="programlisting">
   ClientSession session = ...
   ClientRequestor requestor = new ClientRequestor(session, "jms.queue.hornetq.management");
   ClientMessage message = session.createMessage(false);
   ManagementHelper.putAttribute(message, "core.queue.exampleQueue", "messageCount");
   ClientMessage reply = requestor.request(m);
   int count = (Integer) ManagementHelper.getResult(reply);
   System.out.println("There are " + count + " messages in exampleQueue");
</pre><div class="para">
			Management operation name and parameters must conform to the Java interfaces defined in the <code class="literal">management</code> packages.
		</div><div class="para">
			Names of the resources are built using the helper class <code class="literal">org.hornetq.api.core.management.ResourceNames</code> and are straightforward (<code class="literal">core.queue.exampleQueue</code> for the Core Queue <code class="literal">exampleQueue</code>, <code class="literal">jms.topic.exampleTopic</code> for the JMS Topic <code class="literal">exampleTopic</code>, and so on).
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="management.core.configuration">
      ⁠</a>28.3.1. Configuring Core Management</h2></div></div></div><div class="para">
				The management address to send management messages is configured in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;management-address&gt;</span>jms.queue.hornetq.management<span xmlns="" class="perl_Keyword">&lt;/management-address&gt;</span></pre><div class="para">
				By default, the address is <code class="literal">jms.queue.hornetq.management</code> (it is prepended by "jms.queue" so that JMS clients can also send management messages).
			</div><div class="para">
				The management address requires a <span class="emphasis"><em>special</em></span> user permission <code class="literal">manage</code> to be able to receive and handle management messages. This is also configured in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- users with the admin role will be allowed to manage --&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- HornetQ using management messages        --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-setting</span><span xmlns="" class="perl_Others"> match=</span><span xmlns="" class="perl_String">"jms.queue.hornetq.management"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;permission</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"manage"</span><span xmlns="" class="perl_Others"> roles=</span><span xmlns="" class="perl_String">"admin"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-setting&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="management.jms">
      ⁠</a>28.4. Using Management Via JMS</h1></div></div></div><div class="para">
			Using JMS messages to manage HornetQ is very similar to using core API.
		</div><div class="para">
			An important difference is that JMS requires a JMS queue to send the messages to (instead of an address for the core API).
		</div><div class="para">
			The <span class="emphasis"><em>management queue</em></span> is a special queue and needs to be instantiated directly by the client:
		</div><pre class="programlisting">
   Queue managementQueue = HornetQJMSClient.createQueue("hornetq.management");
</pre><div class="para">
			All the other steps are the same as for the Core API but they use JMS API instead:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Create a <code class="literal">QueueRequestor</code> to send messages to the management address and receive replies.
				</div></li><li class="listitem"><div class="para">
					Create a <code class="literal">Message.</code>
				</div></li><li class="listitem"><div class="para">
					Use the helper class <code class="literal">org.hornetq.api.jms.management.JMSManagementHelper</code> to fill the message with the management properties.
				</div></li><li class="listitem"><div class="para">
					Send the message using the <code class="literal">QueueRequestor</code>.
				</div></li><li class="listitem"><div class="para">
					Use the helper class <code class="literal">org.hornetq.api.jms.management.JMSManagementHelper</code> to retrieve the operation result from the management reply.
				</div></li></ol></div><div class="para">
			For example, to know the number of messages in the JMS queue <code class="literal">exampleQueue</code>:
		</div><pre class="programlisting">
   Queue managementQueue = HornetQJMSClient.createQueue("hornetq.management");   
   
   QueueSession session = ...      
   QueueRequestor requestor = new QueueRequestor(session, managementQueue);
   connection.start();
   Message message = session.createMessage();
   JMSManagementHelper.putAttribute(message, "jms.queue.exampleQueue", "messageCount");
   Message reply = requestor.request(message);
   int count = (Integer)JMSManagementHelper.getResult(reply);
   System.out.println("There are " + count + " messages in exampleQueue");
</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905867991488">
      ⁠</a>28.4.1. Configuring JMS Management</h2></div></div></div><div class="para">
				Whether JMS or the core API is used for management, the configuration steps are the same (see <a class="xref" href="management.html#management.core.configuration">Section 28.3.1, “Configuring Core Management”</a>).
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="management.notifications">
      ⁠</a>28.5. Management Notifications</h1></div></div></div><div class="para">
			HornetQ emits <span class="emphasis"><em>notifications</em></span> to inform listeners of potentially interesting events (creation of new resources, security violation, and so on).
		</div><div class="para">
			These notifications can be received three different ways:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					JMX notifications
				</div></li><li class="listitem"><div class="para">
					Core messages
				</div></li><li class="listitem"><div class="para">
					JMS messages
				</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905844755792">
      ⁠</a>28.5.1. JMX Notifications</h2></div></div></div><div class="para">
				If JMX is enabled (see <a class="xref" href="management.html#management.jmx.configuration">Section 28.2.1, “Configuring JMX”</a>), JMX notifications can be received by subscribing to two MBeans:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="literal">org.hornetq:module=Core,type=Server</code> for notifications on <span class="emphasis"><em>core</em></span> resources
					</div></li><li class="listitem"><div class="para">
						<code class="literal">org.hornetq:module=JMS,type=Server</code> for notifications on <span class="emphasis"><em>JMS</em></span> resources
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905849856240">
      ⁠</a>28.5.2. Core Messages Notifications</h2></div></div></div><div class="para">
				HornetQ defines a <span class="emphasis"><em>management notification address</em></span>. Core queues can be bound to this address so that clients will receive management notifications as core messages.
			</div><div class="para">
				A core client which wants to receive management notifications must create a core queue bound to the management notification address. It can then receive the notifications from its queue.
			</div><div class="para">
				Notification messages are regular core messages with additional properties corresponding to the notification (its type, when it occurred, the resources which were concerned, and so on).
			</div><div class="para">
				Since notifications are regular core messages, it is possible to use message selectors to filter out notifications and receive only a subset of all the notifications emitted by the server.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="management.notifications.core.configuration">
      ⁠</a>28.5.2.1. Configuring The Core Management Notification Address</h3></div></div></div><div class="para">
					The management notification address to receive management notifications is configured in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;management-notification-address&gt;</span>hornetq.notifications<span xmlns="" class="perl_Keyword">&lt;/management-notification-address&gt;</span></pre><div class="para">
					By default, the address is <code class="literal">hornetq.notifications</code>.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905868419008">
      ⁠</a>28.5.3. JMS Messages Notifications</h2></div></div></div><div class="para">
				HornetQ notifications can also be received using JMS messages.
			</div><div class="para">
				It is similar to receiving notifications using Core API but an important difference is that JMS requires a JMS Destination to receive the messages (preferably a topic).
			</div><div class="para">
				You must change the server's management notification address to start with <code class="literal">jms.queue</code> (if it is a JMS queue) or <code class="literal">jms.topic</code> (if it is a JMS topic) to use a JMS Destination to receive management notifications.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- notifications will be consumed from "notificationsTopic" JMS Topic --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;management-notification-address&gt;</span>jms.topic.notificationsTopic<span xmlns="" class="perl_Keyword">&lt;/management-notification-address&gt;</span></pre><div class="para">
				Once the notification topic is created, you can receive messages from it or set a <code class="literal">MessageListener</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   Topic notificationsTopic = HornetQJMSClient.<span xmlns="" class="perl_Function">createTopic</span>(<span xmlns="" class="perl_String">"notificationsTopic"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   Session session = ...
<span xmlns="" class="line">​</span>   MessageConsumer notificationConsumer = session.<span xmlns="" class="perl_Function">createConsumer</span>(notificationsTopic);
<span xmlns="" class="line">​</span>      notificationConsumer.<span xmlns="" class="perl_Function">setMessageListener</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">MessageListener</span>()
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">onMessage</span>(Message notif)
<span xmlns="" class="line">​</span>         {
<span xmlns="" class="line">​</span>            System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"------------------------"</span>);
<span xmlns="" class="line">​</span>            System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Received notification:"</span>);
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">try</span>
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>               Enumeration propertyNames = notif.<span xmlns="" class="perl_Function">getPropertyNames</span>();
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">while</span> (propertyNames.<span xmlns="" class="perl_Function">hasMoreElements</span>())
<span xmlns="" class="line">​</span>               {
<span xmlns="" class="line">​</span>                  String propertyName = (String)propertyNames.<span xmlns="" class="perl_Function">nextElement</span>();
<span xmlns="" class="line">​</span>                  System.<span xmlns="" class="perl_Function">out.format(</span><span xmlns="" class="perl_String">"  </span><span xmlns="" class="perl_Char">%s</span><span xmlns="" class="perl_String">: </span><span xmlns="" class="perl_Char">%s\n</span><span xmlns="" class="perl_String">", propertyName, notif.getObjectProperty(propertyName))</span>;
<span xmlns="" class="line">​</span>               }
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">catch</span> (JMSException e)
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"------------------------"</span>);
<span xmlns="" class="line">​</span>         }            
<span xmlns="" class="line">​</span>      });
</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="management.message-counters">
      ⁠</a>28.6. Message Counters</h1></div></div></div><div class="para">
			Message counters can be used to obtain information on queues over time as HornetQ keeps a history of queue metrics.
		</div><div class="para">
			They can be used to show trends on queues. For example, using the management API, it would be possible to query the number of messages in a queue at regular intervals. You could also view this information using the JMX Console, or use the core API (<code class="classname">org.hornetq.api.core.management.MessageCounterInfo</code>) to extract the information.
		</div><div class="para">
			However, this would not be enough to know if the queue is used. The number of messages can remain constant because nobody is sending or receiving messages from the queue or because there are as many messages sent to the queue as messages consumed from it. The number of messages in the queue remains the same in both cases but its use is different.
		</div><div class="para">
			Message counters provide additional information about the queues:
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"> <code class="literal">count</code> </span></dt><dd><div class="para">
						The <span class="emphasis"><em>total</em></span> number of messages added to the queue since the server was started.
					</div></dd><dt><span class="term"> <code class="literal">countDelta</code> </span></dt><dd><div class="para">
						The number of messages added to the queue <span class="emphasis"><em>since the last message counter update.</em></span>
					</div></dd><dt><span class="term"> <code class="literal">depth</code> </span></dt><dd><div class="para">
						The <span class="emphasis"><em>current</em></span> number of messages in the queue.
					</div></dd><dt><span class="term"> <code class="literal">depthDelta</code> </span></dt><dd><div class="para">
						The <span class="emphasis"><em>overall</em></span> number of messages added or removed from the queue <span class="emphasis"><em>since the last message counter update</em></span>. For example, if <code class="literal">depthDelta</code> is equal to <code class="literal">-10</code> this means that overall 10 messages have been removed from the queue.
					</div></dd><dt><span class="term"> <code class="literal">lastAddTimestamp</code> </span></dt><dd><div class="para">
						The time stamp of the last time a message was added to the queue.
					</div></dd><dt><span class="term"> <code class="literal">udpateTimestamp</code> </span></dt><dd><div class="para">
						The time stamp of the last message counter update.
					</div></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring.message.counters">
      ⁠</a>28.6.1. Configuring Message Counters</h2></div></div></div><div class="para">
				Message counters are disabled by default as they could have a negative effect on memory.
			</div><div class="para">
				To enable message counters, you can set it to <code class="literal">true</code> in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;message-counter-enabled&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/message-counter-enabled&gt;</span></pre><div class="para">
				Message counters keep a history of the queue metrics (10 days by default) and sample all the queues at regular intervals (10 seconds by default). If message counters are enabled, these values should be configured to suit your messaging use case in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hornetq/hornetq-configuration.xml</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- keep history for a week --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;message-counter-max-day-history&gt;</span>7<span xmlns="" class="perl_Keyword">&lt;/message-counter-max-day-history&gt;</span>        
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- sample the queues every minute (60000ms) --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;message-counter-sample-period&gt;</span>60000<span xmlns="" class="perl_Keyword">&lt;/message-counter-sample-period&gt;</span>
</pre><div class="para">
				Message counters can be retrieved using the Management API. For example, to retrieve message counters on a JMS Queue using JMX:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>// retrieve a connection to HornetQ's MBeanServer
<span xmlns="" class="line">​</span>MBeanServerConnection mbsc = ...
<span xmlns="" class="line">​</span>JMSQueueControlMBean queueControl = (JMSQueueControl)MBeanServerInvocationHandler.newProxyInstance(mbsc,
<span xmlns="" class="line">​</span>   on,
<span xmlns="" class="line">​</span>   JMSQueueControl.class,
<span xmlns="" class="line">​</span>   false);
<span xmlns="" class="line">​</span>// message counters are retrieved as a JSON String                                                                                                      
<span xmlns="" class="line">​</span>String counters = queueControl.listMessageCounter();
<span xmlns="" class="line">​</span>// use the MessageCounterInfo helper class to manipulate message counters more easily
<span xmlns="" class="line">​</span>MessageCounterInfo messageCounter = MessageCounterInfo.fromJSON(counters);         
<span xmlns="" class="line">​</span>System.out.format("%s message(s) in the queue (since last sample: %s)\n",
<span xmlns="" class="line">​</span>   counter.getDepth(),
<span xmlns="" class="line">​</span>   counter.getDepthDelta());
</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139905841050096">
      ⁠</a>28.7. Administering HornetQ Resources Using the Admin Console</h1></div></div></div><div class="para">
			It is possible to create and configure HornetQ resources via the admin console within the JBoss Enterprise Application Platform.
		</div><div class="para">
			The admin console will allow you to create destinations (JMS topics and queues) and JMS connection factories.
		</div><div class="para">
			Once logged in to the admin console you will see a JMS Manager item in the left hand tree. All HornetQ resources will be configured via this. This will have child items for JMS queues, topics and connection factories. Clicking on each node will reveal which resources are currently available. The following sections explain how to create and configure each resource in turn.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905841047312">
      ⁠</a>28.7.1. JMS Queues</h2></div></div></div><div class="para">
				To create a new JMS queue click on the JMS Queues item to reveal the available queues. On the right hand panel you will see an <span class="guimenu"><strong>Add a New Resource</strong></span> button. Click on this and then choose the default (JMS Queue) template. Click <span class="guimenu"><strong>Continue</strong></span>. The important things to fill in here are the name of the queue and the JNDI name of the queue. The JNDI name is what you will use to look up the queue in JNDI from your client. For most queues this will be the only info you will need to provide, as sensible defaults are provided for the others. You will also see a security roles section near the bottom. If you do not provide any roles for this queue then the server's default security configuration will be used. After you have created the queue these will be shown in the configuration. All configuration values, except the name and JNDI name, can be changed via the configuration tab after clicking on the queue in the admin console. The following section explains these in more detail.
			</div><div class="para">
				After highlighting the configuration you will see the following screen:
			</div><div class="mediaobject" style="text-align: center"><img src="images/console1.png" align="middle" alt="JMS Queues" style="text-align: middle"/></div><div class="para">
				The name and JNDI name cannot be changed. Recreate the queue with the appropriate settings if you want to change these names. The rest of the configuration options, apart from security roles, relate to address settings for a particular address. The default address settings are picked up from the server configuration. If you change any of these settings or create a queue via the console, a new Address Settings entry will be added. For a full explanation on Address Settings, see <a class="xref" href="queue-attributes.html#Configuring_Queues_Through_Address_Settings">Section 23.3, “Configuring Queues Through Address Settings”</a>
			</div><div class="para">
				To delete a queue, click on the <span class="guimenu"><strong>Delete</strong></span> button beside the queue name in the main JMS queues screen. This will also delete any address settings or security settings previously created for the queue address.
			</div><div class="para">
				The last part of the configuration options are security roles. If none are provided on creation then the server's default security settings will be shown. If these are changed or updated, new security settings are created for the address of this queue. For more information on security settings, see <a class="xref" href="security.html">Chapter 29, <em>Security</em></a>.
			</div><div class="para">
				It is also possible to view statistics for this queue via the metrics tab. This will show statistics such as message count, consumer count, and so on.
			</div><div class="para">
				Operations can be performed on a queue via the control tab. This will allow you to start and stop the queue, list, move, expire, and delete messages from the queue and other useful operations. To invoke an operation, click on the button for the operation you want. This will take you to a screen where parameters for the operation can be set. Once set, click the <span class="guibutton"><strong>OK</strong></span> button to invoke the operation. Results will appear at the bottom of the screen.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905839410496">
      ⁠</a>28.7.2. JMS Topics</h2></div></div></div><div class="para">
				Creating and configuring JMS topics is almost identical to creating queues. The only difference is that the configuration will be applied to the queue representing a subscription.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139905839408880">
      ⁠</a>28.7.3. JMS Connection Factories</h2></div></div></div><div class="para">
				The format for creating connection factories is similar to JMS queues and topics. For a list of all the connection factory settings, refer to <a class="xref" href="appe-configuration_index.html#hornetq-jms_xml_Reference">Section A.1.4, “hornetq-jms.xml”</a>.
			</div></div></div></div></body></html>