<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 8. Component Mapping</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="components">
      ⁠</a>Chapter 8. Component Mapping</h1></div></div></div><div class="para">
		The notion of a <span class="emphasis"><em>component</em></span> is re-used in several different contexts and purposes throughout Hibernate.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="components-dependentobjects">
      ⁠</a>8.1. Dependent objects</h1></div></div></div><div class="para">
			A component is a contained object that is persisted as a value type and not an entity reference. The term "component" refers to the object-oriented notion of composition and not to architecture-level components. For example, you can model a person like this:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Person {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Date</span> birthday;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Name name;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String key;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getKey</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> key;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setKey</span>(String key) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">key</span>=key;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Date</span> <span xmlns="" class="perl_Function">getBirthday</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> birthday;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setBirthday</span>(java.<span xmlns="" class="perl_Function">util</span>.<span xmlns="" class="perl_Function">Date</span> birthday) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">birthday</span> = birthday;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Name <span xmlns="" class="perl_Function">getName</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> name;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setName</span>(Name name) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">name</span> = name;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    ......
<span xmlns="" class="line">​</span>    ......
<span xmlns="" class="line">​</span>}</pre><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Name {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">char</span> initial;
<span xmlns="" class="line">​</span>    String first;
<span xmlns="" class="line">​</span>    String last;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getFirst</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> first;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setFirst</span>(String first) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">first</span> = first;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getLast</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> last;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setLast</span>(String last) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">last</span> = last;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">char</span> <span xmlns="" class="perl_Function">getInitial</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> initial;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setInitial</span>(<span xmlns="" class="perl_DataType">char</span> initial) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">initial</span> = initial;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre><div class="para">
			Now <code class="literal">Name</code> can be persisted as a component of <code class="literal">Person</code>. <code class="literal">Name</code> defines getter and setter methods for its persistent properties, but it does not need to declare any interfaces or identifier properties.
		</div><div class="para">
			Our Hibernate mapping would look like this:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"eg.Person"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Key"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"pid"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"uuid"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"birthday"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;component</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Name"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Name"</span><span xmlns="" class="perl_Keyword">&gt;</span> <span xmlns="" class="perl_Comment">&lt;!-- class attribute optional --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"initial"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"first"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"last"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/component&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
			The person table would have the columns <code class="literal">pid</code>, <code class="literal">birthday</code>, <code class="literal">initial</code>, <code class="literal">first</code> and <code class="literal">last</code>.
		</div><div class="para">
			Like value types, components do not support shared references. In other words, two persons could have the same name, but the two person objects would contain two independent name objects that were only "the same" by value. The null value semantics of a component are <span class="emphasis"><em>ad hoc</em></span>. When reloading the containing object, Hibernate will assume that if all component columns are null, then the entire component is null. This is suitable for most purposes.
		</div><div class="para">
			The properties of a component can be of any Hibernate type (collections, many-to-one associations, other components, etc). Nested components should <span class="emphasis"><em>not</em></span> be considered an exotic usage. Hibernate is intended to support a fine-grained object model.
		</div><div class="para">
			The <code class="literal">&lt;component&gt;</code> element allows a <code class="literal">&lt;parent&gt;</code> subelement that maps a property of the component class as a reference back to the containing entity.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"eg.Person"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Key"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"pid"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"uuid"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"birthday"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;component</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Name"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Name"</span><span xmlns="" class="perl_Others"> unique=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;parent</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"namedPerson"</span><span xmlns="" class="perl_Keyword">/&gt;</span> <span xmlns="" class="perl_Comment">&lt;!-- reference back to the Person --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"initial"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"first"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"last"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/component&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="components-incollections">
      ⁠</a>8.2. Collections of dependent objects</h1></div></div></div><div class="para">
			Collections of components are supported (e.g. an array of type <code class="literal">Name</code>). Declare your component collection by replacing the <code class="literal">&lt;element&gt;</code> tag with a <code class="literal">&lt;composite-element&gt;</code> tag:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someNames"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"some_names"</span><span xmlns="" class="perl_Others"> lazy=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;composite-element</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Name"</span><span xmlns="" class="perl_Keyword">&gt;</span> <span xmlns="" class="perl_Comment">&lt;!-- class attribute required --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"initial"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"first"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"last"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/composite-element&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
				If you define a <code class="literal">Set</code> of composite elements, it is important to implement <code class="literal">equals()</code> and <code class="literal">hashCode()</code> correctly.
			</div></div></div><div class="para">
			Composite elements can contain components but not collections. If your composite element contains components, use the <code class="literal">&lt;nested-composite-element&gt;</code> tag. This case is a collection of components which themselves have components. You may want to consider if a one-to-many association is more appropriate. Remodel the composite element as an entity, but be aware that even though the Java model is the same, the relational model and persistence semantics are still slightly different.
		</div><div class="para">
			A composite element mapping does not support null-able properties if you are using a <code class="literal">&lt;set&gt;</code>. There is no separate primary key column in the composite element table. Hibernate uses each column's value to identify a record when deleting objects, which is not possible with null values. You have to either use only not-null properties in a composite-element or choose a <code class="literal">&lt;list&gt;</code>, <code class="literal">&lt;map&gt;</code>, <code class="literal">&lt;bag&gt;</code> or <code class="literal">&lt;idbag&gt;</code>.
		</div><div class="para">
			A special case of a composite element is a composite element with a nested <code class="literal">&lt;many-to-one&gt;</code> element. This mapping allows you to map extra columns of a many-to-many association table to the composite element class. The following is a many-to-many association from <code class="literal">Order</code> to <code class="literal">Item</code>, where <code class="literal">purchaseDate</code>, <code class="literal">price</code> and <code class="literal">quantity</code> are properties of the association:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"eg.Order"</span> <span xmlns="" class="perl_Error">....</span> <span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"purchasedItems"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"purchase_items"</span><span xmlns="" class="perl_Others"> lazy=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"order_id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;composite-element</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Purchase"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"purchaseDate"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"price"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"quantity"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"item"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Item"</span><span xmlns="" class="perl_Keyword">/&gt;</span> <span xmlns="" class="perl_Comment">&lt;!-- class attribute is optional --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/composite-element&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
			There cannot be a reference to the purchase on the other side for bidirectional association navigation. Components are value types and do not allow shared references. A single <code class="literal">Purchase</code> can be in the set of an <code class="literal">Order</code>, but it cannot be referenced by the <code class="literal">Item</code> at the same time.
		</div><div class="para">
			Even ternary (or quaternary, etc) associations are possible:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"eg.Order"</span> <span xmlns="" class="perl_Error">....</span> <span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"purchasedItems"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"purchase_items"</span><span xmlns="" class="perl_Others"> lazy=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"order_id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;composite-element</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.OrderLine"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"purchaseDetails class="</span><span xmlns="" class="perl_Error">eg.Purchase"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"item"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Item"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/composite-element&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
			Composite elements can appear in queries using the same syntax as associations to other entities.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="components-asmapindex">
      ⁠</a>8.3. Components as Map indices</h1></div></div></div><div class="para">
			The <code class="literal">&lt;composite-map-key&gt;</code> element allows you to map a component class as the key of a <code class="literal">Map</code>. Ensure that you override <code class="literal">hashCode()</code> and <code class="literal">equals()</code> correctly on the component class.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="components-compositeid">
      ⁠</a>8.4. Components as composite identifiers</h1></div></div></div><div class="para">
			You can use a component as an identifier of an entity class. Your component class must satisfy certain requirements:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					It must implement <code class="literal">java.io.Serializable</code>.
				</div></li><li class="listitem"><div class="para">
					It must re-implement <code class="literal">equals()</code> and <code class="literal">hashCode()</code> consistently with the database's notion of composite key equality.
				</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				In Hibernate3, although the second requirement is not an absolutely hard requirement of Hibernate, it is recommended.
			</div></div></div><div class="para">
			You cannot use an <code class="literal">IdentifierGenerator</code> to generate composite keys. Instead the application must assign its own identifiers.
		</div><div class="para">
			Use the <code class="literal">&lt;composite-id&gt;</code> tag, with nested <code class="literal">&lt;key-property&gt;</code> elements, in place of the usual <code class="literal">&lt;id&gt;</code> declaration. For example, the <code class="literal">OrderLine</code> class has a primary key that depends upon the (composite) primary key of <code class="literal">Order</code>.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"OrderLine"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;composite-id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"OrderLineId"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lineId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customerId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/composite-id&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"order"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Order"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            insert=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> update=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customerId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/many-to-one&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
			Any foreign keys referencing the <code class="literal">OrderLine</code> table are now composite. Declare this in your mappings for other classes. An association to <code class="literal">OrderLine</code> is mapped like this:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderLine"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"OrderLine"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- the "class" attribute is optional, as usual --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lineId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customerId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/many-to-one&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The <code class="literal">&lt;column&gt;</code> tag is an alternative to the <code class="literal">column</code> attribute everywhere.
			</div></div></div><div class="para">
			A <code class="literal">many-to-many</code> association to <code class="literal">OrderLine</code> also uses the composite foreign key:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"undeliveredOrderLines"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column</span> <span xmlns="" class="perl_Error">name</span><span xmlns="" class="perl_Others">=</span><span xmlns="" class="perl_String">"warehouseId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"OrderLine"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lineId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customerId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/many-to-many&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span></pre><div class="para">
			The collection of <code class="literal">OrderLine</code>s in <code class="literal">Order</code> would use:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderLines"</span><span xmlns="" class="perl_Others"> inverse=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customerId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"OrderLine"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span></pre><div class="para">
			The <code class="literal">&lt;one-to-many&gt;</code> element declares no columns.
		</div><div class="para">
			If <code class="literal">OrderLine</code> itself owns a collection, it also has a composite foreign key.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"OrderLine"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;list</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"deliveryAttempts"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key&gt;</span>   <span xmlns="" class="perl_Comment">&lt;!-- a collection inherits the composite key type --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lineId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"orderId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;column</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"customerId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;list-index</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"attemptId"</span><span xmlns="" class="perl_Others"> base=</span><span xmlns="" class="perl_String">"1"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;composite-element</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"DeliveryAttempt"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            ...
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/composite-element&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="components-dynamic">
      ⁠</a>8.5. Dynamic components</h1></div></div></div><div class="para">
			You can also map a property of type <code class="literal">Map</code>:
		</div><pre class="programlisting">&lt;dynamic-component name="userAttributes"&gt;
    &lt;property name="foo" column="FOO" type="string"/&gt;
    &lt;property name="bar" column="BAR" type="integer"/&gt;
    &lt;many-to-one name="baz" class="Baz" column="BAZ_ID"/&gt;
&lt;/dynamic-component&gt;</pre><div class="para">
			The semantics of a <code class="literal">&lt;dynamic-component&gt;</code> mapping are identical to <code class="literal">&lt;component&gt;</code>. The advantage of this kind of mapping is the ability to determine the actual properties of the bean at deployment time just by editing the mapping document. Runtime manipulation of the mapping document is also possible, using a DOM parser. You can also access, and change, Hibernate's configuration-time metamodel via the <code class="literal">Configuration</code> object.
		</div></div></div></body></html>