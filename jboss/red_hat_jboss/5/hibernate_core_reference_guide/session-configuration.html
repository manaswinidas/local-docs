<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 3. Configuration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="session-configuration">
      ⁠</a>Chapter 3. Configuration</h1></div></div></div><div class="para">
		Hibernate is designed to operate in many different environments and, as such, there is a broad range of configuration parameters. Fortunately, most have sensible default values and Hibernate is distributed with an example <code class="literal">hibernate.properties</code> file in <code class="literal">etc/</code> that displays the various options. Simply put the example file in your classpath and customize it to suit your needs.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-programmatic">
      ⁠</a>3.1. Programmatic configuration</h1></div></div></div><div class="para">
			An instance of <code class="classname">org.hibernate.cfg.Configuration</code> represents an entire set of mappings of an application's Java types to an SQL database. The <code class="classname">org.hibernate.cfg.Configuration</code> is used to build an immutable <code class="interfacename">org.hibernate.SessionFactory</code>. The mappings are compiled from various XML mapping files.
		</div><div class="para">
			You can obtain a <code class="classname">org.hibernate.cfg.Configuration</code> instance by instantiating it directly and specifying XML mapping documents. If the mapping files are in the classpath, use <code class="literal">addResource()</code>. For example:
		</div><pre class="programlisting">Configuration cfg = new Configuration()
    .addResource("Item.hbm.xml")
    .addResource("Bid.hbm.xml");</pre><div class="para">
			An alternative way is to specify the mapped class and allow Hibernate to find the mapping document for you:
		</div><pre class="programlisting">Configuration cfg = new Configuration()
    .addClass(org.hibernate.auction.Item.class)
    .addClass(org.hibernate.auction.Bid.class);</pre><div class="para">
			Hibernate will then search for mapping files named <code class="filename">/org/hibernate/auction/Item.hbm.xml</code> and <code class="filename">/org/hibernate/auction/Bid.hbm.xml</code> in the classpath. This approach eliminates any hardcoded file names.
		</div><div class="para">
			A <code class="classname">org.hibernate.cfg.Configuration</code> also allows you to specify configuration properties. For example:
		</div><pre class="programlisting">Configuration cfg = new Configuration()
    .addClass(org.hibernate.auction.Item.class)
    .addClass(org.hibernate.auction.Bid.class)
    .setProperty("hibernate.dialect", "org.hibernate.dialect.MySQLInnoDBDialect")
    .setProperty("hibernate.connection.datasource", "java:comp/env/jdbc/test")
    .setProperty("hibernate.order_updates", "true");</pre><div class="para">
			This is not the only way to pass configuration properties to Hibernate. Some alternative options include:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Pass an instance of <code class="classname">java.util.Properties</code> to <code class="literal">Configuration.setProperties()</code>.
				</div></li><li class="listitem"><div class="para">
					Place a file named <code class="filename">hibernate.properties</code> in a root directory of the classpath.
				</div></li><li class="listitem"><div class="para">
					Set <code class="literal">System</code> properties using <code class="literal">java -Dproperty=value</code>.
				</div></li><li class="listitem"><div class="para">
					Include <code class="literal">&lt;property&gt;</code> elements in <code class="literal">hibernate.cfg.xml</code> (this is discussed later).
				</div></li></ol></div><div class="para">
			If you want to get started quickly<code class="filename">hibernate.properties</code> is the easiest approach.
		</div><div class="para">
			The <code class="classname">org.hibernate.cfg.Configuration</code> is intended as a start up object that will be discarded once a <code class="literal">SessionFactory</code> is created.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-sessionfactory">
      ⁠</a>3.2. Obtaining a SessionFactory</h1></div></div></div><div class="para">
			When all mappings have been parsed by the <code class="classname">org.hibernate.cfg.Configuration</code>, the application must obtain a factory for <code class="classname">org.hibernate.Session</code> instances. This factory is intended to be shared by all application threads:
		</div><pre class="programlisting">SessionFactory sessions = cfg.buildSessionFactory();</pre><div class="para">
			Hibernate does allow your application to instantiate more than one <code class="classname">org.hibernate.SessionFactory</code>. This is useful if you are using more than one database.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-hibernatejdbc">
      ⁠</a>3.3. JDBC connections</h1></div></div></div><div class="para">
			It is advisable to have the <code class="interfacename">org.hibernate.SessionFactory</code> create and pool JDBC connections for you. If you take this approach, opening a <code class="interfacename">org.hibernate.Session</code> is as simple as:
		</div><pre class="programlisting">Session session = sessions.openSession(); // open a new Session</pre><div class="para">
			Once you start a task that requires access to the database, a JDBC connection will be obtained from the pool.
		</div><div class="para">
			Before you can do this, you first need to pass some JDBC connection properties to Hibernate. All Hibernate property names and semantics are defined on the class <code class="classname">org.hibernate.cfg.Environment</code>. The most important settings for JDBC connection configuration are outlined below.
		</div><div class="para">
			Hibernate will obtain and pool connections using <code class="classname">java.sql.DriverManager</code> if you set the following properties:
		</div><div class="table"><a id="idm140554819882352">
      ⁠</a><p class="title"><strong>Table 3.1. Hibernate JDBC Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Hibernate JDBC Properties"><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <span class="property">hibernate.connection.driver_class</span> </td><td> <span class="emphasis"><em>JDBC driver class</em></span> </td></tr><tr><td> <span class="property">hibernate.connection.url</span> </td><td> <span class="emphasis"><em>JDBC URL</em></span> </td></tr><tr><td> <span class="property">hibernate.connection.username</span> </td><td> <span class="emphasis"><em>database user</em></span> </td></tr><tr><td> <span class="property">hibernate.connection.password</span> </td><td> <span class="emphasis"><em>database user password</em></span> </td></tr><tr><td> <span class="property">hibernate.connection.pool_size</span> </td><td> <span class="emphasis"><em>maximum number of pooled connections</em></span> </td></tr></tbody></table></div></div><div class="para">
			Hibernate's own connection pooling algorithm is, however, quite rudimentary. It is intended to help you get started and is <span class="emphasis"><em>not intended for use in a production system</em></span>, or even for performance testing. You should use a third party pool for best performance and stability. Just replace the <span class="property">hibernate.connection.pool_size</span> property with connection pool specific settings. This will turn off Hibernate's internal pool. For example, you might like to use c3p0.
		</div><div class="para">
			C3P0 is an open source JDBC connection pool distributed along with Hibernate in the <code class="filename">lib</code> directory. Hibernate will use its <code class="classname">org.hibernate.connection.C3P0ConnectionProvider</code> for connection pooling if you set <span class="property">hibernate.c3p0.*</span> properties. If you would like to use Proxool, refer to the packaged <code class="filename">hibernate.properties</code> and the Hibernate web site for more information.
		</div><div class="para">
			The following is an example <code class="filename">hibernate.properties</code> file for c3p0:
		</div><pre class="programlisting">hibernate.connection.driver_class = org.postgresql.Driver
hibernate.connection.url = jdbc:postgresql://localhost/mydatabase
hibernate.connection.username = myuser
hibernate.connection.password = secret
hibernate.c3p0.min_size=5
hibernate.c3p0.max_size=20
hibernate.c3p0.timeout=1800
hibernate.c3p0.max_statements=50
hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect</pre><div class="para">
			For use inside an application server, you should almost always configure Hibernate to obtain connections from an application server <code class="interfacename">javax.sql.Datasource</code> registered in JNDI. You will need to set at least one of the following properties:
		</div><div class="table"><a id="idm140554840254592">
      ⁠</a><p class="title"><strong>Table 3.2. Hibernate Datasource Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Hibernate Datasource Properties"><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <span class="property">hibernate.connection.datasource</span> </td><td> <span class="emphasis"><em>datasource JNDI name</em></span> </td></tr><tr><td> <span class="property">hibernate.jndi.url</span> </td><td> <span class="emphasis"><em>URL of the JNDI provider</em></span> (optional) </td></tr><tr><td> <span class="property">hibernate.jndi.class</span> </td><td> <span class="emphasis"><em>class of the JNDI <code class="literal">InitialContextFactory</code></em></span> (optional) </td></tr><tr><td> <span class="property">hibernate.connection.username</span> </td><td> <span class="emphasis"><em>database user</em></span> (optional) </td></tr><tr><td> <span class="property">hibernate.connection.password</span> </td><td> <span class="emphasis"><em>database user password</em></span> (optional) </td></tr></tbody></table></div></div><div class="para">
			Here is an example <code class="filename">hibernate.properties</code> file for an application server provided JNDI datasource:
		</div><pre class="programlisting">hibernate.connection.datasource = java:/comp/env/jdbc/test
hibernate.transaction.factory_class = \
    org.hibernate.transaction.JTATransactionFactory
hibernate.transaction.manager_lookup_class = \
    org.hibernate.transaction.JBossTransactionManagerLookup
hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect</pre><div class="para">
			JDBC connections obtained from a JNDI datasource will automatically participate in the container-managed transactions of the application server.
		</div><div class="para">
			Arbitrary connection properties can be given by prepending "<code class="literal">hibernate.connection</code>" to the connection property name. For example, you can specify a <span class="property">charSet</span> connection property using <span class="property">hibernate.connection.charSet</span>.
		</div><div class="para">
			You can define your own plug-in strategy for obtaining JDBC connections by implementing the interface <code class="interfacename">org.hibernate.connection.ConnectionProvider</code>, and specifying your custom implementation via the <span class="property">hibernate.connection.provider_class</span> property.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-optional">
      ⁠</a>3.4. Optional configuration properties</h1></div></div></div><div class="para">
			There are a number of other properties that control the behavior of Hibernate at runtime. All are optional and have reasonable default values.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				Some of these properties are system-level only. System-level properties can be set only via <code class="code">java -Dproperty=value</code> or <code class="filename">hibernate.properties</code>. They <span class="emphasis"><em>cannot</em></span> be set by the other techniques described above.
			</div></div></div><div class="table"><a id="configuration-optional-properties">
      ⁠</a><p class="title"><strong>Table 3.3. Hibernate Configuration Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Hibernate Configuration Properties"><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <span class="property">hibernate.dialect</span> </td><td> The classname of a Hibernate <code class="classname">org.hibernate.dialect.Dialect</code> which allows Hibernate to generate SQL optimized for a particular relational database. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">full.classname.of.Dialect</code>
						</div>
						 <div class="para">
							In most cases Hibernate will actually be able to choose the correct <code class="classname">org.hibernate.dialect.Dialect</code> implementation based on the <code class="literal">JDBC metadata</code> returned by the JDBC driver.
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.show_sql</span> </td><td> Write all SQL statements to console. This is an alternative to setting the log category <code class="literal">org.hibernate.SQL</code> to <code class="literal">debug</code>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.format_sql</span> </td><td> Pretty print the SQL in the log and console. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.default_schema</span> </td><td> Qualify unqualified table names with the given schema/tablespace in generated SQL. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">SCHEMA_NAME</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.default_catalog</span> </td><td> Qualifies unqualified table names with the given catalog in generated SQL. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">CATALOG_NAME</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.session_factory_name</span> </td><td> The <code class="interfacename">org.hibernate.SessionFactory</code> will be automatically bound to this name in JNDI after it has been created. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">jndi/composite/name</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.max_fetch_depth</span> </td><td> Sets a maximum "depth" for the outer join fetch tree for single-ended associations (one-to-one, many-to-one). A <code class="literal">0</code> disables default outer join fetching. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> recommended values between <code class="literal">0</code> and <code class="literal">3</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.default_batch_fetch_size</span> </td><td> Sets a default size for Hibernate batch fetching of associations. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> recommended values <code class="literal">4</code>, <code class="literal">8</code>, <code class="literal">16</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.default_entity_mode</span> </td><td> Sets a default mode for entity representation for all sessions opened from this <code class="literal">SessionFactory</code> <div class="para">
							<code class="literal">dynamic-map</code>, <code class="literal">dom4j</code>, <code class="literal">pojo</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.order_updates</span> </td><td> Forces Hibernate to order SQL updates by the primary key value of the items being updated. This will result in fewer transaction deadlocks in highly concurrent systems. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.generate_statistics</span> </td><td> If enabled, Hibernate will collect statistics useful for performance tuning. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.use_identifier_rollback</span> </td><td> If enabled, generated identifier properties will be reset to default values when objects are deleted. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.use_sql_comments</span> </td><td> If turned on, Hibernate will generate comments inside the SQL, for easier debugging, defaults to <code class="literal">false</code>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr></tbody></table></div></div><div class="table"><a id="configuration-jdbc-properties">
      ⁠</a><p class="title"><strong>Table 3.4. Hibernate JDBC and Connection Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Hibernate JDBC and Connection Properties"><colgroup><col/><col/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <span class="property">hibernate.jdbc.fetch_size</span> </td><td> A non-zero value determines the JDBC fetch size (calls <code class="literal">Statement.setFetchSize()</code>). </td></tr><tr><td> <span class="property">hibernate.jdbc.batch_size</span> </td><td> A non-zero value enables use of JDBC2 batch updates by Hibernate. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> recommended values between <code class="literal">5</code> and <code class="literal">30</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.jdbc.batch_versioned_data</span> </td><td> Set this property to <code class="literal">true</code> if your JDBC driver returns correct row counts from <code class="literal">executeBatch()</code>. It is usually safe to turn this option on. Hibernate will then use batched DML for automatically versioned data. Defaults to <code class="literal">false</code>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.jdbc.factory_class</span> </td><td> Select a custom <code class="interfacename">org.hibernate.jdbc.Batcher</code>. Most applications will not need this configuration property. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">classname.of.BatcherFactory</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.jdbc.use_scrollable_resultset</span> </td><td> Enables use of JDBC2 scrollable resultsets by Hibernate. This property is only necessary when using user-supplied JDBC connections. Hibernate uses connection metadata otherwise. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.jdbc.use_streams_for_binary</span> </td><td> Use streams when writing/reading <code class="literal">binary</code> or <code class="literal">serializable</code> types to/from JDBC. <span class="emphasis"><em>*system-level property*</em></span> <div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.jdbc.use_get_generated_keys</span> </td><td> Enables use of JDBC3 <code class="literal">PreparedStatement.getGeneratedKeys()</code> to retrieve natively generated keys after insert. Requires JDBC3+ driver and JRE1.4+, set to false if your driver has problems with the Hibernate identifier generators. By default, it tries to determine the driver capabilities using connection metadata. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true|false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.connection.provider_class</span> </td><td> The classname of a custom <code class="interfacename">org.hibernate.connection.ConnectionProvider</code> which provides JDBC connections to Hibernate. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">classname.of.ConnectionProvider</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.connection.isolation</span> </td><td> Sets the JDBC transaction isolation level. Check <code class="interfacename">java.sql.Connection</code> for meaningful values, but note that most databases do not support all isolation levels and some define additional, non-standard isolations. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">1, 2, 4, 8</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.connection.autocommit</span> </td><td> Enables autocommit for JDBC pooled connections (it is not recommended). 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.connection.release_mode</span> </td><td> Specifies when Hibernate should release JDBC connections. By default, a JDBC connection is held until the session is explicitly closed or disconnected. For an application server JTA datasource, use <code class="literal">after_statement</code> to aggressively release connections after every JDBC call. For a non-JTA connection, it often makes sense to release the connection at the end of each transaction, by using <code class="literal">after_transaction</code>. <code class="literal">auto</code> will choose <code class="literal">after_statement</code> for the JTA and CMT transaction strategies and <code class="literal">after_transaction</code> for the JDBC transaction strategy. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">auto</code> (default) | <code class="literal">on_close</code> | <code class="literal">after_transaction</code> | <code class="literal">after_statement</code>
						</div>
						 <div class="para">
							This setting only affects <code class="literal">Session</code>s returned from <code class="literal">SessionFactory.openSession</code>. For <code class="literal">Session</code>s obtained through <code class="literal">SessionFactory.getCurrentSession</code>, the <code class="literal">CurrentSessionContext</code> implementation configured for use controls the connection release mode for those <code class="literal">Session</code>s. See <a class="xref" href="architecture.html#architecture-current-session">Section 2.5, “Contextual sessions”</a>
						</div>
						 </td></tr><tr><td> <span class="property">hibernate.connection.</span><span class="emphasis"><em>&lt;propertyName&gt;</em></span> </td><td> Pass the JDBC property <span class="emphasis"><em>&lt;propertyName&gt;</em></span> to <code class="literal">DriverManager.getConnection()</code>. </td></tr><tr><td> <span class="property">hibernate.jndi.</span><span class="emphasis"><em>&lt;propertyName&gt;</em></span> </td><td> Pass the property <span class="emphasis"><em>&lt;propertyName&gt;</em></span> to the JNDI <code class="literal">InitialContextFactory</code>. </td></tr></tbody></table></div></div><div class="table"><a id="configuration-cache-properties">
      ⁠</a><p class="title"><strong>Table 3.5. Hibernate Cache Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Hibernate Cache Properties"><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <code class="literal">hibernate.cache.provider_class</code> </td><td> The classname of a custom <code class="literal">CacheProvider</code>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">classname.of.CacheProvider</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cache.use_minimal_puts</code> </td><td> Optimizes second-level cache operation to minimize writes, at the cost of more frequent reads. This setting is most useful for clustered caches and, in Hibernate3, is enabled by default for clustered cache implementations. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true|false</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cache.use_query_cache</code> </td><td> Enables the query cache. Individual queries still have to be set cacheable. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true|false</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cache.use_second_level_cache</code> </td><td> Can be used to completely disable the second level cache, which is enabled by default for classes which specify a <code class="literal">&lt;cache&gt;</code> mapping. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true|false</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cache.query_cache_factory</code> </td><td> The classname of a custom <code class="literal">QueryCache</code> interface, defaults to the built-in <code class="literal">StandardQueryCache</code>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">classname.of.QueryCache</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cache.region_prefix</code> </td><td> A prefix to use for second-level cache region names. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">prefix</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cache.use_structured_entries</code> </td><td> Forces Hibernate to store data in the second-level cache in a more human-friendly format. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true|false</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.query.plan_cache_max_strong_references</code> </td><td> Sets the maximum number of strong references held in the cache. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">128 (default)</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.query.plan_cache_max_soft_references</code> </td><td> Sets the maximum number of soft references held in the cache. Set this value to <code class="literal">Integer.MAX_VALUE</code> to replicate the behavior of 5.1.1 and earlier. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">2048 (default)</code>
						</div>
						 </td></tr></tbody></table></div></div><div class="table"><a id="configuration-transaction-properties">
      ⁠</a><p class="title"><strong>Table 3.6. Hibernate Transaction Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Hibernate Transaction Properties"><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <code class="literal">hibernate.transaction.factory_class</code> </td><td> The classname of a <code class="literal">TransactionFactory</code> to use with Hibernate <code class="literal">Transaction</code> API (defaults to <code class="literal">JDBCTransactionFactory</code>). 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">classname.of.TransactionFactory</code>
						</div>
						 </td></tr><tr><td> <code class="literal">jta.UserTransaction</code> </td><td> A JNDI name used by <code class="literal">JTATransactionFactory</code> to obtain the JTA <code class="literal">UserTransaction</code> from the application server. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">jndi/composite/name</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.transaction. manager_lookup_class</code> </td><td> The classname of a <code class="literal">TransactionManagerLookup</code>. It is required when JVM-level caching is enabled or when using hilo generator in a JTA environment. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">classname.of.TransactionManagerLookup</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.transaction. flush_before_completion</code> </td><td> If enabled, the session will be automatically flushed during the before completion phase of the transaction. Built-in and automatic session context management is preferred, see <a class="xref" href="architecture.html#architecture-current-session">Section 2.5, “Contextual sessions”</a>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.transaction. auto_close_session</code> </td><td> If enabled, the session will be automatically closed during the after completion phase of the transaction. Built-in and automatic session context management is preferred, see <a class="xref" href="architecture.html#architecture-current-session">Section 2.5, “Contextual sessions”</a>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr></tbody></table></div></div><div class="table"><a id="configuration-misc-properties">
      ⁠</a><p class="title"><strong>Table 3.7. Miscellaneous Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Miscellaneous Properties"><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><thead><tr><th> Property name </th><th> Purpose </th></tr></thead><tbody><tr><td> <code class="literal">hibernate. current_session_context_class</code> </td><td> Supply a custom strategy for the scoping of the "current" <code class="literal">Session</code>. See <a class="xref" href="architecture.html#architecture-current-session">Section 2.5, “Contextual sessions”</a> for more information about the built-in strategies. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">jta</code> | <code class="literal">thread</code> | <code class="literal">managed</code> | <code class="literal">custom.Class</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.query.factory_class</code> </td><td> Chooses the HQL parser implementation. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">org.hibernate.hql.ast.ASTQueryTranslatorFactory</code> or <code class="literal">org.hibernate.hql.classic.ClassicQueryTranslatorFactory</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.query.substitutions</code> </td><td> Is used to map from tokens in Hibernate queries to SQL tokens (tokens might be function or literal names, for example). 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">hqlLiteral=SQL_LITERAL, hqlFunction=SQLFUNC</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.hbm2ddl.auto</code> </td><td> Automatically validates or exports schema DDL to the database when the <code class="literal">SessionFactory</code> is created. With <code class="literal">create-drop</code>, the database schema will be dropped when the <code class="literal">SessionFactory</code> is closed explicitly. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">validate</code> | <code class="literal">update</code> | <code class="literal">create</code> | <code class="literal">create-drop</code>
						</div>
						 </td></tr><tr><td> <code class="literal">hibernate.cglib. use_reflection_optimizer</code> </td><td> Enables the use of CGLIB instead of runtime reflection (System-level property). Reflection can sometimes be useful when troubleshooting. Hibernate always requires CGLIB even if you turn off the optimizer. You cannot set this property in <code class="literal">hibernate.cfg.xml</code>. 
						<div class="para">
							<span class="strong strong"><strong>e.g.</strong></span> <code class="literal">true</code> | <code class="literal">false</code>
						</div>
						 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-dialects">
      ⁠</a>3.4.1. SQL Dialects</h2></div></div></div><div class="para">
				Always set the <code class="literal">hibernate.dialect</code> property to the correct <code class="literal">org.hibernate.dialect.Dialect</code> subclass for your database. If you specify a dialect, Hibernate will use sensible defaults for some of the other properties listed above. This means that you will not have to specify them manually.
			</div><div class="table"><a id="sql-dialects">
      ⁠</a><p class="title"><strong>Table 3.8. Hibernate SQL Dialects (<code class="literal">hibernate.dialect</code>)</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-14-rows" summary="Hibernate SQL Dialects (hibernate.dialect)"><colgroup><col/><col/></colgroup><thead><tr><th> RDBMS </th><th> Dialect </th></tr></thead><tbody><tr><td> DB2 </td><td> <code class="literal">org.hibernate.dialect.DB2Dialect</code> </td></tr><tr><td> DB2 AS/400 </td><td> <code class="literal">org.hibernate.dialect.DB2400Dialect</code> </td></tr><tr><td> DB2 OS390 </td><td> <code class="literal">org.hibernate.dialect.DB2390Dialect</code> </td></tr><tr><td> PostgreSQL </td><td> <code class="literal">org.hibernate.dialect.PostgreSQLDialect</code> </td></tr><tr><td> MySQL </td><td> <code class="literal">org.hibernate.dialect.MySQL5Dialect</code> </td></tr><tr><td> MySQL with InnoDB </td><td> <code class="literal">org.hibernate.dialect.MySQL5InnoDialect</code> </td></tr><tr><td> MySQL with MyISAM </td><td> <code class="literal">org.hibernate.dialect.MySQLMyISAMDialect</code> </td></tr><tr><td> Oracle (any version) </td><td> <code class="literal">org.hibernate.dialect.Oracle8iDialect</code> </td></tr><tr><td> Oracle 9i </td><td> <code class="literal">org.hibernate.dialect.Oracle9iDialect</code> </td></tr><tr><td> Oracle 10g </td><td> <code class="literal">org.hibernate.dialect.Oracle10gDialect</code> </td></tr><tr><td> Sybase </td><td> <code class="literal">org.hibernate.dialect.SybaseDialect</code> </td></tr><tr><td> Sybase Anywhere </td><td> <code class="literal">org.hibernate.dialect.SybaseAnywhereDialect</code> </td></tr><tr><td> Microsoft SQL Server </td><td> <code class="literal">org.hibernate.dialect.SQLServerDialect</code> </td></tr><tr><td> Microsoft SQL Server 2008 </td><td> <code class="literal">org.hibernate.dialect.SQLServer2008Dialect</code> </td></tr><tr><td> SAP DB </td><td> <code class="literal">org.hibernate.dialect.SAPDBDialect</code> </td></tr><tr><td> Informix </td><td> <code class="literal">org.hibernate.dialect.InformixDialect</code> </td></tr><tr><td> HypersonicSQL </td><td> <code class="literal">org.hibernate.dialect.HSQLDialect</code> </td></tr><tr><td> Ingres </td><td> <code class="literal">org.hibernate.dialect.IngresDialect</code> </td></tr><tr><td> Progress </td><td> <code class="literal">org.hibernate.dialect.ProgressDialect</code> </td></tr><tr><td> Mckoi SQL </td><td> <code class="literal">org.hibernate.dialect.MckoiDialect</code> </td></tr><tr><td> Interbase </td><td> <code class="literal">org.hibernate.dialect.InterbaseDialect</code> </td></tr><tr><td> Pointbase </td><td> <code class="literal">org.hibernate.dialect.PointbaseDialect</code> </td></tr><tr><td> FrontBase </td><td> <code class="literal">org.hibernate.dialect.FrontbaseDialect</code> </td></tr><tr><td> Firebird </td><td> <code class="literal">org.hibernate.dialect.FirebirdDialect</code> </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-outerjoin">
      ⁠</a>3.4.2. Outer Join Fetching</h2></div></div></div><div class="para">
				If your database supports ANSI, Oracle or Sybase style outer joins, <span class="emphasis"><em>outer join fetching</em></span> will often increase performance by limiting the number of round trips to and from the database. This is, however, at the cost of possibly more work performed by the database itself. Outer join fetching allows a whole graph of objects connected by many-to-one, one-to-many, many-to-many and one-to-one associations to be retrieved in a single SQL <code class="literal">SELECT</code>.
			</div><div class="para">
				Outer join fetching can be disabled <span class="emphasis"><em>globally</em></span> by setting the property <code class="literal">hibernate.max_fetch_depth</code> to <code class="literal">0</code>. A setting of <code class="literal">1</code> or higher enables outer join fetching for one-to-one and many-to-one associations that have been mapped with <code class="literal">fetch="join"</code>.
			</div><div class="para">
				See <a class="xref" href="performance.html#performance-fetching">Section 19.1, “Fetching strategies”</a> for more information.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-binarystreams">
      ⁠</a>3.4.3. Binary Streams</h2></div></div></div><div class="para">
				Oracle limits the size of <code class="literal">byte</code> arrays that can be passed to and/or from its JDBC driver. If you wish to use large instances of <code class="literal">binary</code> or <code class="literal">serializable</code> type, you should enable <code class="literal">hibernate.jdbc.use_streams_for_binary</code>. <span class="emphasis"><em>This is a system-level setting only.</em></span>
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-cacheprovider">
      ⁠</a>3.4.4. Second-level and query cache</h2></div></div></div><div class="para">
				The properties prefixed by <code class="literal">hibernate.cache</code> allow you to use a process or cluster scoped second-level cache system with Hibernate. See the <a class="xref" href="performance.html#performance-cache">Section 19.2, “The Second Level Cache”</a> for more information.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-querysubstitution">
      ⁠</a>3.4.5. Query Language Substitution</h2></div></div></div><div class="para">
				You can define new Hibernate query tokens using <code class="literal">hibernate.query.substitutions</code>. For example:
			</div><pre class="programlisting">hibernate.query.substitutions true=1, false=0</pre><div class="para">
				This would cause the tokens <code class="literal">true</code> and <code class="literal">false</code> to be translated to integer literals in the generated SQL.
			</div><pre class="programlisting">hibernate.query.substitutions toLowercase=LOWER</pre><div class="para">
				This would allow you to rename the SQL <code class="literal">LOWER</code> function.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-statistics">
      ⁠</a>3.4.6. Hibernate statistics</h2></div></div></div><div class="para">
				If you enable <code class="literal">hibernate.generate_statistics</code>, Hibernate exposes a number of metrics that are useful when tuning a running system via <code class="literal">SessionFactory.getStatistics()</code>. Hibernate can even be configured to expose these statistics via JMX. Read the Javadoc of the interfaces in <code class="literal">org.hibernate.stats</code> for more information.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-logging">
      ⁠</a>3.5. Logging</h1></div></div></div><div class="para">
			Hibernate utilizes <a href="http://www.slf4j.org/">Simple Logging Facade for Java</a> (SLF4J) in order to log various system events. SLF4J can direct your logging output to several logging frameworks (<span class="application"><strong>NOP</strong></span>, <span class="application"><strong>Simple</strong></span>, <span class="application"><strong>log4j version 1.2</strong></span>, <span class="application"><strong>JDK 1.4 logging</strong></span>, <span class="application"><strong>JCL</strong></span> or <span class="application"><strong>logback</strong></span>) depending on your chosen binding.
		</div><div class="para">
			In order to set up logging you will need <code class="filename">slf4j-api.jar</code> in your classpath together with the jar file for your preferred binding - <code class="filename">slf4j-log4j12.jar</code> in the case of Log4J. See the SLF4J <a href="http://www.slf4j.org/manual.html">documentation</a> for more detail. To use Log4j you will also need to place a <code class="filename">log4j.properties</code> file in your classpath. An example properties file is distributed with Hibernate in the <code class="literal">src/</code> directory.
		</div><div class="para">
			It is recommended that you familiarize yourself with Hibernate's log messages. A lot of work has been put into making the Hibernate log as detailed as possible, without making it unreadable. It is an essential troubleshooting device. The most interesting log categories are the following:
		</div><div class="table"><a id="log-categories">
      ⁠</a><p class="title"><strong>Table 3.9. Hibernate Log Categories</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Hibernate Log Categories"><colgroup><col width="50%"/><col width="50%"/></colgroup><thead><tr><th> Category </th><th> Function </th></tr></thead><tbody><tr><td> <code class="literal">org.hibernate.SQL</code> </td><td> Log all SQL DML statements as they are executed </td></tr><tr><td> <code class="literal">org.hibernate.type</code> </td><td> Log all JDBC parameters </td></tr><tr><td> <code class="literal">org.hibernate.tool. hbm2ddl</code> </td><td> Log all SQL DDL statements as they are executed </td></tr><tr><td> <code class="literal">org.hibernate.pretty</code> </td><td> Log the state of all entities (max 20 entities) associated with the session at flush time </td></tr><tr><td> <code class="literal">org.hibernate.cache</code> </td><td> Log all second-level cache activity </td></tr><tr><td> <code class="literal">org.hibernate. transaction</code> </td><td> Log transaction related activity </td></tr><tr><td> <code class="literal">org.hibernate.jdbc</code> </td><td> Log all JDBC resource acquisition </td></tr><tr><td> <code class="literal">org.hibernate.hql. ast.AST</code> </td><td> Log HQL and SQL ASTs during query parsing </td></tr><tr><td> <code class="literal">org.hibernate.secure</code> </td><td> Log all JAAS authorization requests </td></tr><tr><td> <code class="literal">org.hibernate</code> </td><td> Log everything. This is a lot of information but it is useful for troubleshooting </td></tr></tbody></table></div></div><div class="para">
			When developing applications with Hibernate, you should almost always work with <code class="literal">debug</code> enabled for the category <code class="literal">org.hibernate.SQL</code>, or, alternatively, the property <code class="literal">hibernate.show_sql</code> enabled.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-namingstrategy">
      ⁠</a>3.6. Implementing a <code class="literal">NamingStrategy</code></h1></div></div></div><div class="para">
			The interface <code class="literal">org.hibernate.cfg.NamingStrategy</code> allows you to specify a "naming standard" for database objects and schema elements.
		</div><div class="para">
			You can provide rules for automatically generating database identifiers from Java identifiers or for processing "logical" column and table names given in the mapping file into "physical" table and column names. This feature helps reduce the verbosity of the mapping document, eliminating repetitive noise (<code class="literal">TBL_</code> prefixes, for example). The default strategy used by Hibernate is quite minimal.
		</div><div class="para">
			You can specify a different strategy by calling <code class="literal">Configuration.setNamingStrategy()</code> before adding mappings:
		</div><pre class="programlisting">SessionFactory sf = new Configuration()
    .setNamingStrategy(ImprovedNamingStrategy.INSTANCE)
    .addFile("Item.hbm.xml")
    .addFile("Bid.hbm.xml")
    .buildSessionFactory();</pre><div class="para">
			<code class="literal">org.hibernate.cfg.ImprovedNamingStrategy</code> is a built-in strategy that might be a useful starting point for some applications.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-xmlconfig">
      ⁠</a>3.7. XML configuration file</h1></div></div></div><div class="para">
			An alternative approach to configuration is to specify a full configuration in a file named <code class="literal">hibernate.cfg.xml</code>. This file can be used as a replacement for the <code class="literal">hibernate.properties</code> file or, if both are present, to override properties.
		</div><div class="para">
			The XML configuration file is by default expected to be in the root of your <code class="literal">CLASSPATH</code>. Here is an example:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version='1.0' encoding='utf-8'<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>hibernate-configuration PUBLIC
<span xmlns="" class="line">​</span>    "-//Hibernate/Hibernate Configuration DTD//EN"
<span xmlns="" class="line">​</span>    "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-configuration&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- a SessionFactory instance listed as /jndi/name --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;session-factory</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        name=</span><span xmlns="" class="perl_String">"java:hibernate/SessionFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- properties --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connection.datasource"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/comp/env/jdbc/MyDB<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dialect"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hibernate.dialect.MySQLDialect<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"show_sql"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"transaction.factory_class"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            org.hibernate.transaction.JTATransactionFactory
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jta.UserTransaction"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:comp/UserTransaction<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- mapping files --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;mapping</span><span xmlns="" class="perl_Others"> resource=</span><span xmlns="" class="perl_String">"org/hibernate/auction/Item.hbm.xml"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;mapping</span><span xmlns="" class="perl_Others"> resource=</span><span xmlns="" class="perl_String">"org/hibernate/auction/Bid.hbm.xml"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- cache settings --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;class-cache</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hibernate.auction.Item"</span><span xmlns="" class="perl_Others"> usage=</span><span xmlns="" class="perl_String">"read-write"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;class-cache</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hibernate.auction.Bid"</span><span xmlns="" class="perl_Others"> usage=</span><span xmlns="" class="perl_String">"read-only"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;collection-cache</span><span xmlns="" class="perl_Others"> collection=</span><span xmlns="" class="perl_String">"org.hibernate.auction.Item.bids"</span><span xmlns="" class="perl_Others"> usage=</span><span xmlns="" class="perl_String">"read-write"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/session-factory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-configuration&gt;</span></pre><div class="para">
			The advantage of this approach is the externalization of the mapping file names to configuration. The <code class="literal">hibernate.cfg.xml</code> is also more convenient once you have to tune the Hibernate cache. It is your choice to use either <code class="literal">hibernate.properties</code> or <code class="literal">hibernate.cfg.xml</code>. Both are equivalent, except for the above mentioned benefits of using the XML syntax.
		</div><div class="para">
			With the XML configuration, starting Hibernate is then as simple as:
		</div><pre class="programlisting">SessionFactory sf = new Configuration().configure().buildSessionFactory();</pre><div class="para">
			You can select a different XML configuration file using:
		</div><pre class="programlisting">SessionFactory sf = new Configuration()
    .configure("catdb.cfg.xml")
    .buildSessionFactory();</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-j2ee">
      ⁠</a>3.8. J2EE Application Server integration</h1></div></div></div><div class="para">
			Hibernate has the following integration points for J2EE infrastructure:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<span class="emphasis"><em>Container-managed datasources</em></span>: Hibernate can use JDBC connections managed by the container and provided through JNDI. Usually, a JTA compatible <code class="literal">TransactionManager</code> and a <code class="literal">ResourceManager</code> take care of transaction management (CMT), especially distributed transaction handling across several datasources. You can also demarcate transaction boundaries programmatically (BMT), or you might want to use the optional Hibernate <code class="literal">Transaction</code> API for this to keep your code portable.
				</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<span class="emphasis"><em>Automatic JNDI binding</em></span>: Hibernate can bind its <code class="literal">SessionFactory</code> to JNDI after start up.
				</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<span class="emphasis"><em>JTA Session binding:</em></span> the Hibernate <code class="literal">Session</code> can be automatically bound to the scope of JTA transactions. Simply lookup the <code class="literal">SessionFactory</code> from JNDI and get the current <code class="literal">Session</code>. Let Hibernate manage flushing and closing the <code class="literal">Session</code> when your JTA transaction completes. Transaction demarcation is either declarative (CMT) or programmatic (BMT/UserTransaction).
				</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					<span class="emphasis"><em>JMX deployment:</em></span> if you have a JMX capable application server (e.g. JBoss Enterprise Application Platform ), you can choose to deploy Hibernate as a managed MBean. This saves you the one line start up code to build your <code class="literal">SessionFactory</code> from a <code class="literal">Configuration</code>. The container will start up your <code class="literal">HibernateService</code> and also take care of service dependencies (datasource has to be available before Hibernate starts, etc).
				</div></li></ul></div><div class="para">
			Depending on your environment, you might have to set the configuration option <code class="literal">hibernate.connection.aggressive_release</code> to true if your application server shows "connection containment" exceptions.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-transactionstrategy">
      ⁠</a>3.8.1. Transaction strategy configuration</h2></div></div></div><div class="para">
				The Hibernate <code class="literal">Session</code> API is independent of any transaction demarcation system in your architecture. If you let Hibernate use JDBC directly through a connection pool, you can begin and end your transactions by calling the JDBC API. If you run in a J2EE application server, you might want to use bean-managed transactions and call the JTA API and <code class="literal">UserTransaction</code> when needed.
			</div><div class="para">
				To keep your code portable between these two (and other) environments we recommend the optional Hibernate <code class="literal">Transaction</code> API, which wraps and hides the underlying system. You have to specify a factory class for <code class="literal">Transaction</code> instances by setting the Hibernate configuration property <code class="literal">hibernate.transaction.factory_class</code>.
			</div><div class="para">
				There are three standard, or built-in, choices:
			</div><div class="variablelist"><dl class="variablelist compact"><dt><span class="term"><code class="literal">org.hibernate.transaction.JDBCTransactionFactory</code></span></dt><dd><div class="para">
							delegates to database (JDBC) transactions (default)
						</div></dd><dt><span class="term"><code class="literal">org.hibernate.transaction.JTATransactionFactory</code></span></dt><dd><div class="para">
							delegates to container-managed transactions if an existing transaction is underway in this context (for example, EJB session bean method). Otherwise, a new transaction is started and bean-managed transactions are used.
						</div></dd><dt><span class="term"><code class="literal">org.hibernate.transaction.CMTTransactionFactory</code></span></dt><dd><div class="para">
							delegates to container-managed JTA transactions
						</div></dd></dl></div><div class="para">
				You can also define your own transaction strategies (for a CORBA transaction service, for example).
			</div><div class="para">
				Some features in Hibernate (i.e., the second level cache, Contextual Sessions with JTA, etc.) require access to the JTA <code class="literal">TransactionManager</code> in a managed environment. In an application server, since J2EE does not standardize a single mechanism, you have to specify how Hibernate should obtain a reference to the <code class="literal">TransactionManager</code>:
			</div><div class="table"><a id="jtamanagerlookup">
      ⁠</a><p class="title"><strong>Table 3.10. JTA TransactionManagers</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="JTA TransactionManagers"><colgroup><col width="50%"/><col width="50%"/></colgroup><thead><tr><th> Transaction Factory </th><th style="text-align: center"> Application Server </th></tr></thead><tbody><tr><td> <code class="literal">org.hibernate.transaction. JBossTransactionManagerLookup</code> </td><td style="text-align: center"> JBoss </td></tr><tr><td> <code class="literal">org.hibernate.transaction. WeblogicTransactionManagerLookup</code> </td><td style="text-align: center"> Weblogic </td></tr><tr><td> <code class="literal">org.hibernate.transaction. WebSphereTransactionManagerLookup</code> </td><td style="text-align: center"> WebSphere </td></tr><tr><td> <code class="literal">org.hibernate.transaction. WebSphereExtendedJTATransactionLookup</code> </td><td style="text-align: center"> WebSphere 6 </td></tr><tr><td> <code class="literal">org.hibernate.transaction. OrionTransactionManagerLookup</code> </td><td style="text-align: center"> Orion </td></tr><tr><td> <code class="literal">org.hibernate.transaction. ResinTransactionManagerLookup</code> </td><td style="text-align: center"> Resin </td></tr><tr><td> <code class="literal">org.hibernate.transaction. JOTMTransactionManagerLookup</code> </td><td style="text-align: center"> JOTM </td></tr><tr><td> <code class="literal">org.hibernate.transaction. JOnASTransactionManagerLookup</code> </td><td style="text-align: center"> JOnAS </td></tr><tr><td> <code class="literal">org.hibernate.transaction. JRun4TransactionManagerLookup</code> </td><td style="text-align: center"> JRun4 </td></tr><tr><td> <code class="literal">org.hibernate.transaction. BESTransactionManagerLookup</code> </td><td style="text-align: center"> Borland ES </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-optional-jndi">
      ⁠</a>3.8.2. JNDI-bound <code class="literal">SessionFactory</code></h2></div></div></div><div class="para">
				A JNDI-bound Hibernate <code class="literal">SessionFactory</code> can simplify the lookup function of the factory and create new <code class="literal">Session</code>s. This is not, however, related to a JNDI bound <code class="literal">Datasource</code>; both simply use the same registry.
			</div><div class="para">
				If you wish to have the <code class="literal">SessionFactory</code> bound to a JNDI namespace, specify a name (e.g. <code class="literal">java:hibernate/SessionFactory</code>) using the property <code class="literal">hibernate.session_factory_name</code>. If this property is omitted, the <code class="literal">SessionFactory</code> will not be bound to JNDI. This is especially useful in environments with a read-only JNDI default implementation (in Tomcat, for example).
			</div><div class="para">
				When binding the <code class="literal">SessionFactory</code> to JNDI, Hibernate will use the values of <code class="literal">hibernate.jndi.url</code>, <code class="literal">hibernate.jndi.class</code> to instantiate an initial context. If they are not specified, the default <code class="literal">InitialContext</code> will be used.
			</div><div class="para">
				Hibernate will automatically place the <code class="literal">SessionFactory</code> in JNDI after you call <code class="literal">cfg.buildSessionFactory()</code>. This means you will have this call in some start up code, or utility class in your application, unless you use JMX deployment with the <code class="literal">HibernateService</code> (this is discussed later in greater detail).
			</div><div class="para">
				If you use a JNDI <code class="literal">SessionFactory</code>, an EJB or any other class, you can obtain the <code class="literal">SessionFactory</code> using a JNDI lookup.
			</div><div class="para">
				It is recommended that you bind the <code class="literal">SessionFactory</code> to JNDI in a managed environment and use a <code class="literal">static</code> singleton otherwise. To shield your application code from these details, we also recommend to hide the actual lookup code for a <code class="literal">SessionFactory</code> in a helper class, such as <code class="literal">HibernateUtil.getSessionFactory()</code>. Note that such a class is also a convenient way to start Hibernate (Refer to <a class="xref" href="tutorial.html#tutorial-firstapp-helpers">Section 1.1.6, “Start up and helpers”</a>).
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-j2ee-currentsession">
      ⁠</a>3.8.3. Current Session context management with JTA</h2></div></div></div><div class="para">
				The easiest way to handle <code class="literal">Sessions</code> and transactions is Hibernate's automatic "current" <code class="literal">Session</code> management. For a discussion of contextual sessions see <a class="xref" href="architecture.html#architecture-current-session">Section 2.5, “Contextual sessions”</a>. Using the <code class="literal">"jta"</code> session context, if there is no Hibernate <code class="literal">Session</code> associated with the current JTA transaction, one will be started and associated with that JTA transaction the first time you call <code class="literal">sessionFactory.getCurrentSession()</code>. The <code class="literal">Session</code>s retrieved via <code class="literal">getCurrentSession()</code> in the<code class="literal"> "jta"</code> context are set to automatically flush before the transaction completes, close after the transaction completes, and aggressively release JDBC connections after each statement. This allows the <code class="literal">Session</code>s to be managed by the life cycle of the JTA transaction to which it is associated, keeping user code clean of such management concerns. Your code can either use JTA programmatically through <code class="literal">UserTransaction</code>, or (recommended for portable code) use the Hibernate <code class="literal">Transaction</code> API to set transaction boundaries. If you run in an EJB container, declarative transaction demarcation with CMT is preferred.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-j2ee-jmx">
      ⁠</a>3.8.4. JMX deployment</h2></div></div></div><div class="para">
				The line <code class="literal">cfg.buildSessionFactory()</code> still has to be executed somewhere to get a <code class="literal">SessionFactory</code> into JNDI. You can do this either in a <code class="literal">static</code> initializer block, like the one in <code class="literal">HibernateUtil</code>, or you can deploy Hibernate as a <span class="emphasis"><em>managed service</em></span>.
			</div><div class="para">
				Hibernate is distributed with <code class="literal">org.hibernate.jmx.HibernateService</code> for deployment on an application server with JMX capabilities, such as JBoss Enterprise Application Platform. The actual deployment and configuration is vendor-specific. Here is an example <code class="literal">jboss-service.xml</code> for JBoss 4.0.x:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;server&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.hibernate.jmx.HibernateService"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    name=</span><span xmlns="" class="perl_String">"jboss.jca:service=HibernateFactory,name=HibernateFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Required services --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.jca:service=RARDeployer<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.jca:service=LocalTxCM,name=HsqlDS<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Bind the Hibernate service to JNDI --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JndiName"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:/hibernate/SessionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Datasource settings --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Datasource"</span><span xmlns="" class="perl_Keyword">&gt;</span>java:HsqlDS<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Dialect"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hibernate.dialect.HSQLDialect<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Transaction integration --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TransactionStrategy"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        org.hibernate.transaction.JTATransactionFactory<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TransactionManagerLookupStrategy"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        org.hibernate.transaction.JBossTransactionManagerLookup<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FlushBeforeCompletionEnabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"AutoCloseSessionEnabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Fetching options --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MaximumFetchDepth"</span><span xmlns="" class="perl_Keyword">&gt;</span>5<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Second-level caching --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SecondLevelCacheEnabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CacheProviderClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hibernate.cache.EhCacheProvider<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"QueryCacheEnabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Logging --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ShowSqlEnabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Mapping files --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MapResources"</span><span xmlns="" class="perl_Keyword">&gt;</span>auction/Item.hbm.xml,auction/Category.hbm.xml<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/server&gt;</span></pre><div class="para">
				This file is deployed in a directory called <code class="literal">META-INF</code> and packaged in a JAR file with the extension <code class="literal">.sar</code> (service archive). You also need to package Hibernate, its required third-party libraries, your compiled persistent classes, as well as your mapping files in the same archive. Your enterprise beans (usually session beans) can be kept in their own JAR file, but you can include this EJB JAR file in the main service archive to get a single (hot-)deployable unit.
			</div></div></div></div></body></html>