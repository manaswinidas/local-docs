<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 1. Tutorial</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="tutorial">
      ⁠</a>Chapter 1. Tutorial</h1></div></div></div><div class="para">
		Intended for new users, this chapter provides an step-by-step introduction to Hibernate, starting with a simple application using an in-memory database. The tutorial is based on an earlier tutorial developed by MichaelGloegl. All code is contained in the <code class="filename">tutorials/web</code> directory of the project source.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
			This tutorial expects the user have knowledge of both Java and SQL. If you have a limited knowledge of JAVA or SQL, it is advised that you start with a good introduction to that technology prior to attempting to learn Hibernate.
		</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The distribution contains another example application under the <code class="filename">tutorial/eg</code> project source directory.
		</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tutorial-firstapp">
      ⁠</a>1.1. Part 1 - The first Hibernate Application</h1></div></div></div><div class="para">
			For this example, we will set up a small database application that can store events we want to attend and information about the host(s) of these events.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Although you can use whatever database you feel comfortable using, we will use <a href="http://hsqldb.org/">HSQLDB</a> (an in-memory, Java database) to avoid describing installation/setup of any particular database servers.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-setup">
      ⁠</a>1.1.1. Setup</h2></div></div></div><div class="para">
				The first thing we need to do is to set up the development environment. We will be using the "standard layout" advocated by many build tools such as <a href="http://maven.org">Maven</a>. Maven, in particular, has a good resource describing this <a href="http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html">layout</a>. As this tutorial is to be a web application, we will be creating and making use of <code class="filename">src/main/java</code>, <code class="filename">src/main/resources</code> and <code class="filename">src/main/webapp</code> directories.
			</div><div class="para">
				We will be using Maven in this tutorial, taking advantage of its transitive dependency management capabilities as well as the ability of many IDEs to automatically set up a project based on the maven descriptor.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;project</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://maven.apache.org/POM/4.0.0"</span><span xmlns="" class="perl_Others"> xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://maven.apache.org/POM/4.0.0 http://</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">maven.apache.org/xsd/maven-4.0.0.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;modelVersion&gt;</span>4.0.0<span xmlns="" class="perl_Keyword">&lt;/modelVersion&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.hibernate.tutorials<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>hibernate-tutorial<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>1.0.0-SNAPSHOT<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;packaging&gt;</span>war<span xmlns="" class="perl_Keyword">&lt;/packaging&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;name&gt;</span>First Hibernate Tutorial<span xmlns="" class="perl_Keyword">&lt;/name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;build&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--we dont want the version to be part of the generated war file name--&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;finalName&gt;</span>${artifactId}<span xmlns="" class="perl_Keyword">&lt;/finalName&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--we dont want to use the jars maven provided, we want to use JBoss' ones--&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;plugins&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;plugin&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>maven-war-plugin<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;configuration&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;packagingExcludes&gt;</span>WEB-INF/lib/*.jar<span xmlns="" class="perl_Keyword">&lt;/packagingExcludes&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/configuration&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/plugin&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/plugins&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/build&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependencies&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.hibernate<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>hibernate-core<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>3.3.2.GA_CP04<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- please check the release notes for the correct version you are using --&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Because this is a web app, we also have a dependency on the servlet api. --&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>javax.servlet<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>servlet-api<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>2.5<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Hibernate uses slf4j for logging, for our purposes here use the simple backend --&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>org.slf4j<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>slf4j-simple<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>1.5.8<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Hibernate gives you a choice of bytecode providers between cglib and javassist --&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;dependency&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;groupId&gt;</span>javassist<span xmlns="" class="perl_Keyword">&lt;/groupId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;artifactId&gt;</span>javassist<span xmlns="" class="perl_Keyword">&lt;/artifactId&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;version&gt;</span>3.12.0.GA<span xmlns="" class="perl_Keyword">&lt;/version&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/dependency&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/dependencies&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/project&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					It is not a requirement to use Maven. If you wish to use another technology to build this tutorial (such as Ant), the layout will remain the same. The only change is that you will need to manually account for all the needed dependencies. If you use <a href="http://ant.apache.org/ivy/">Ivy</a> to provide transitive dependency management you would still use the dependencies mentioned below. Otherwise, you will need to find all the dependencies, both explicit and transitive, and add them to the projects classpath. If working from the Hibernate distribution bundle, this would mean <code class="filename">hibernate3.jar</code>, all artifacts in the <code class="filename">lib/required</code> directory and all files from either the <code class="filename">lib/bytecode/cglib</code> or <code class="filename">lib/bytecode/javassist</code> directory; additionally you will need both the servlet-api jar and one of the slf4j logging back ends.
				</div></div></div><div class="para">
				Save this file as <code class="filename">pom.xml</code> in the project root directory.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-firstclass">
      ⁠</a>1.1.2. The first class</h2></div></div></div><div class="para">
				Next, we create a class that represents the event we want to store in the database; it is a simple JavaBean class with some properties:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">tutorial</span>.<span xmlns="" class="perl_Function">domain</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Date;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Event {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String title;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Date date;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Event() {}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">Long</span> <span xmlns="" class="perl_Function">getId</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> id;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setId</span>(<span xmlns="" class="perl_DataType">Long</span> id) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">id</span> = id;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Date <span xmlns="" class="perl_Function">getDate</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> date;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setDate</span>(Date date) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">date</span> = date;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getTitle</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> title;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setTitle</span>(String title) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">title</span> = title;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre><div class="para">
				This class uses standard JavaBean naming conventions for property getter and setter methods, as well as private visibility for the fields. Although this is the recommended design, it is not required. Hibernate can also access fields directly, the benefit of accessor methods is robustness for refactoring.
			</div><div class="para">
				The <code class="literal">id</code> property holds a unique identifier value for a particular event. All persistent entity classes (there are less important dependent classes as well) will need such an identifier property if we want to use the full feature set of Hibernate. In fact, most applications, especially web applications, need to distinguish objects by identifier, so you should consider this a feature rather than a limitation. However, we usually do not manipulate the identity of an object, hence the setter method should be private. Only Hibernate will assign identifiers when an object is saved. Hibernate can access public, private, and protected accessor methods, as well as public, private and protected fields directly. The choice is up to you and you can match it to fit your application design.
			</div><div class="para">
				The no-argument constructor is a requirement for all persistent classes; Hibernate has to create objects for you, using Java Reflection. The constructor can be private, however package or public visibility is required for runtime proxy generation and efficient data retrieval without bytecode instrumentation.
			</div><div class="para">
				Save this file to the <code class="filename">src/main/java/org/hibernate/tutorial/domain</code> directory.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-mapping">
      ⁠</a>1.1.3. The mapping file</h2></div></div></div><div class="para">
				Hibernate needs to know how to load and store objects of the persistent class. This is where the Hibernate mapping file comes into play. The mapping file tells Hibernate what table in the database it has to access, and what columns in that table it should use.
			</div><div class="para">
				The basic structure of a mapping file looks like this:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>hibernate-mapping PUBLIC
<span xmlns="" class="line">​</span>        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
<span xmlns="" class="line">​</span>        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping</span><span xmlns="" class="perl_Others"> package=</span><span xmlns="" class="perl_String">"org.hibernate.tutorial.domain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>[...]
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
				Hibernate DTD is sophisticated. You can use it for auto-completion of XML mapping elements and attributes in your editor or IDE. Opening up the DTD file in your text editor is the easiest way to get an overview of all elements and attributes, and to view the defaults, as well as some comments. Hibernate will not load the DTD file from the web, but first look it up from the classpath of the application. The DTD file is included in <code class="filename">hibernate-core.jar</code> (it is also included in the <code class="filename">hibernate3.jar</code>, if using the distribution bundle).
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					We will omit the DTD declaration in future examples to shorten the code. It is, of course, not optional.
				</div></div></div><div class="para">
				Between the two <code class="literal">hibernate-mapping</code> tags, include a <code class="literal">class</code> element. All persistent entity classes (again, there might be dependent classes later on, which are not first-class entities) need a mapping to a table in the SQL database:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping</span><span xmlns="" class="perl_Others"> package=</span><span xmlns="" class="perl_String">"org.hibernate.tutorial.domain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Event"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"EVENTS"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
				So far we have told Hibernate how to persist and load object of class <code class="literal">Event</code> to the table <code class="literal">EVENTS</code>. Each instance is now represented by a row in that table. Now we can continue by mapping the unique identifier property to the tables primary key. As we do not want to care about handling this identifier, we configure Hibernate's identifier generation strategy for a surrogate primary key column:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping</span><span xmlns="" class="perl_Others"> package=</span><span xmlns="" class="perl_String">"org.hibernate.tutorial.domain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Event"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"EVENTS"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"EVENT_ID"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"native"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
				The <code class="literal">id</code> element is the declaration of the identifier property. The <code class="literal">name="id"</code> mapping attribute declares the name of the JavaBean property and tells Hibernate to use the <code class="literal">getId()</code> and <code class="literal">setId()</code> methods to access the property. The column attribute tells Hibernate which column of the <code class="literal">EVENTS</code> table holds the primary key value.
			</div><div class="para">
				The nested <code class="literal">generator</code> element specifies the identifier generation strategy (aka how are identifier values generated?). In this case we choose <code class="literal">native</code>, which offers a level of portability depending on the configured database dialect. Hibernate supports database generated, globally unique, as well as application assigned, identifiers. Identifier value generation is also one of Hibernate's many extension points and you can plug-in in your own strategy.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					<code class="literal">native</code> is no longer considered the best strategy in terms of portability. for further discussion, see <a class="xref" href="portability.html#portability-idgen">Section 25.4, “Identifier generation”</a>
				</div></div></div><div class="para">
				Lastly, we need to tell Hibernate about the remaining entity class properties. By default, no properties of the class are considered persistent:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping</span><span xmlns="" class="perl_Others"> package=</span><span xmlns="" class="perl_String">"org.hibernate.tutorial.domain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Event"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"EVENTS"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"EVENT_ID"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"native"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"timestamp"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"EVENT_DATE"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"title"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
				Similar to the <code class="literal">id</code> element, the <code class="literal">name</code> attribute of the <code class="literal">property</code> element tells Hibernate which getter and setter methods to use. In this case, Hibernate will search for <code class="literal">getDate()</code>, <code class="literal">setDate()</code>, <code class="literal">getTitle()</code> and <code class="literal">setTitle()</code> methods.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Why does the <code class="literal">date</code> property mapping include the <code class="literal">column</code> attribute, but the <code class="literal">title</code> does not? Without the <code class="literal">column</code> attribute, Hibernate by default uses the property name as the column name. This works for <code class="literal">title</code>, however, <code class="literal">date</code> is a reserved keyword in most databases so you will need to map it to a different name.
				</div></div></div><div class="para">
				The <code class="literal">title</code> mapping also lacks a <code class="literal">type</code> attribute. The types declared and used in the mapping files are not Java data types; they are not SQL database types either. These types are called <span class="emphasis"><em>Hibernate mapping types</em></span>, converters which can translate from Java to SQL data types and vice versa. Again, Hibernate will try to determine the correct conversion and mapping type itself if the <code class="literal">type</code> attribute is not present in the mapping. In some cases this automatic detection using Reflection on the Java class might not have the default you expect or need. This is the case with the <code class="literal">date</code> property. Hibernate cannot know if the property, which is of <code class="literal">java.util.Date</code>, should map to a SQL <code class="literal">date</code>, <code class="literal">timestamp</code>, or <code class="literal">time</code> column. Full date and time information is preserved by mapping the property with a <code class="literal">timestamp</code> converter.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Hibernate makes this mapping type determination using reflection when the mapping files are processed. This can take time and resources, so if start up performance is important you should consider explicitly defining the type to use.
				</div></div></div><div class="para">
				Save this mapping file as <code class="filename">src/main/resources/org/hibernate/tutorial/domain/Event.hbm.xml</code>.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-configuration">
      ⁠</a>1.1.4. Hibernate configuration</h2></div></div></div><div class="para">
				At this point, you should have the persistent class and its mapping file in place. It is now time to configure Hibernate. First let us set up HSQLDB to run in "server mode"
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					We do this do that the data remains between runs.
				</div></div></div><div class="para">
				We will utilize the Maven exec plug-in to launch the HSQLDB server by running: <code class="command"> mvn exec:java -Dexec.mainClass="org.hsqldb.Server" -Dexec.args="-database.0 file:target/data/tutorial"</code> You will see it start up and bind to a TCP/IP socket; this is where our application will connect later. If you want to start with a fresh database during this tutorial, shutdown HSQLDB, delete all files in the <code class="filename">target/data</code> directory, and start HSQLDB again.
			</div><div class="para">
				Hibernate will be connecting to the database on behalf of your application, so it needs to know how to obtain connections. For this tutorial we will be using a standalone connection pool (as opposed to a <code class="interfacename">javax.sql.DataSource</code>). Hibernate comes with support for two third-party open source JDBC connection pools: <a href="https://sourceforge.net/projects/c3p0">c3p0</a> and <a href="http://proxool.sourceforge.net/">proxool</a>. However, we will be using the Hibernate built-in connection pool for this tutorial.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					The built-in Hibernate connection pool is not intended for production use.
				</div></div></div><div class="para">
				For Hibernate's configuration, we can use a simple <code class="literal">hibernate.properties</code> file, a more sophisticated <code class="literal">hibernate.cfg.xml</code> file, or even complete programmatic setup. Most users prefer the XML configuration file:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version='1.0' encoding='utf-8'<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>hibernate-configuration PUBLIC
<span xmlns="" class="line">​</span>        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
<span xmlns="" class="line">​</span>        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-configuration&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;session-factory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- Database connection settings --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connection.driver_class"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hsqldb.jdbcDriver<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connection.url"</span><span xmlns="" class="perl_Keyword">&gt;</span>jdbc:hsqldb:hsql://localhost<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connection.username"</span><span xmlns="" class="perl_Keyword">&gt;</span>sa<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connection.password"</span><span xmlns="" class="perl_Keyword">&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- JDBC connection pool (use the built-in) --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connection.pool_size"</span><span xmlns="" class="perl_Keyword">&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- SQL dialect --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dialect"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hibernate.dialect.HSQLDialect<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- Enable Hibernate's automatic session context management --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"current_session_context_class"</span><span xmlns="" class="perl_Keyword">&gt;</span>thread<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- Disable the second-level cache  --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cache.provider_class"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.hibernate.cache.NoCacheProvider<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- Echo all executed SQL to stdout --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"show_sql"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">&lt;!-- Drop and re-create the database schema on startup --&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hbm2ddl.auto"</span><span xmlns="" class="perl_Keyword">&gt;</span>update<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;mapping</span><span xmlns="" class="perl_Others"> resource=</span><span xmlns="" class="perl_String">"org/hibernate/tutorial/domain/Event.hbm.xml"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/session-factory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-configuration&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Notice that this configuration file specifies a different DTD
				</div></div></div><div class="para">
				You configure Hibernate's <code class="literal">SessionFactory</code>. SessionFactory is a global factory responsible for a particular database. If you have several databases, for easier start up you should use several <code class="literal">&lt;session-factory&gt;</code> configurations in several configuration files.
			</div><div class="para">
				The first four <code class="literal">property</code> elements contain the necessary configuration for the JDBC connection. The dialect <code class="literal">property</code> element specifies the particular SQL variant Hibernate generates.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Hibernate is able to correctly determine which dialect to use in most cases. See <a class="xref" href="portability.html#portability-dialectresolver">Section 25.3, “Dialect resolution”</a> for more information.
				</div></div></div><div class="para">
				Hibernate's automatic session management for persistence contexts is particularly useful in this context. The <code class="literal">hbm2ddl.auto</code> option turns on automatic generation of database schemas directly into the database. This can also be turned off by removing the configuration option, or redirected to a file with the help of the <code class="literal">SchemaExport</code> Ant task. Finally, add the mapping file(s) for persistent classes to the configuration.
			</div><div class="para">
				Save this file as <code class="filename">hibernate.cfg.xml</code> into the <code class="filename">src/main/resources</code> directory.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-mvn">
      ⁠</a>1.1.5. Building with Maven</h2></div></div></div><div class="para">
				We will now build the tutorial with Maven. You will need to have Maven installed; it is available from the <a href="http://maven.apache.org/download.html">Maven download page</a>. Maven will read the <code class="filename">/pom.xml</code> file we created earlier and know how to perform some basic project tasks. First, lets run the <code class="literal">compile</code> goal to make sure we can compile everything so far:
			</div><pre class="programlisting">[hibernateTutorial]$ mvn compile
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building First Hibernate Tutorial
[INFO]    task-segment: [compile]
[INFO] ------------------------------------------------------------------------
[INFO] [resources:resources]
[INFO] Using default encoding to copy filtered resources.
[INFO] [compiler:compile]
[INFO] Compiling 1 source file to /home/steve/projects/sandbox/hibernateTutorial/target/classes
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Tue Jun 09 12:25:25 CDT 2009
[INFO] Final Memory: 5M/547M
[INFO] ------------------------------------------------------------------------</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-helpers">
      ⁠</a>1.1.6. Start up and helpers</h2></div></div></div><div class="para">
				It is time to load and store some <code class="literal">Event</code> objects, but first you have to complete the setup with some infrastructure code. You have to start Hibernate by building a global <code class="interfacename">org.hibernate.SessionFactory</code> object and storing it somewhere for easy access in application code. A <code class="interfacename">org.hibernate.SessionFactory</code> is used to obtain <code class="interfacename">org.hibernate.Session</code> instances. A <code class="interfacename">org.hibernate.Session</code> represents a single-threaded unit of work. The <code class="interfacename">org.hibernate.SessionFactory</code> is a thread-safe global object that is instantiated once.
			</div><div class="para">
				We will create a <code class="literal">HibernateUtil</code> helper class that takes care of start up and makes accessing the <code class="interfacename">org.hibernate.SessionFactory</code> more convenient.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">tutorial</span>.<span xmlns="" class="perl_Function">util</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.hibernate.SessionFactory;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.hibernate.cfg.Configuration;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> HibernateUtil {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> SessionFactory sessionFactory = <span xmlns="" class="perl_Function">buildSessionFactory</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> SessionFactory <span xmlns="" class="perl_Function">buildSessionFactory</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// Create the SessionFactory from hibernate.cfg.xml</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> Configuration().<span xmlns="" class="perl_Function">configure</span>().<span xmlns="" class="perl_Function">buildSessionFactory</span>();
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">catch</span> (Throwable ex) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// Make sure you log the exception, as it might be swallowed</span>
<span xmlns="" class="line">​</span>            System.<span xmlns="" class="perl_Function">err</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Initial SessionFactory creation failed."</span> + ex);
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> ExceptionInInitializerError(ex);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> SessionFactory <span xmlns="" class="perl_Function">getSessionFactory</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> sessionFactory;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre><div class="para">
				Save this code as <code class="filename">src/main/java/org/hibernate/tutorial/util/HibernateUtil.java</code>
			</div><div class="para">
				This class not only produces the global <code class="interfacename">org.hibernate.SessionFactory</code> reference in its static initializer; it also hides the fact that it uses a static singleton. We might just as well have looked up the <code class="interfacename">org.hibernate.SessionFactory</code> reference from JNDI in an application server or any other location for that matter.
			</div><div class="para">
				If you give the <code class="interfacename">org.hibernate.SessionFactory</code> a name in your configuration, Hibernate will try to bind it to JNDI under that name after it has been built. Another, better option is to use a JMX deployment and let the JMX-capable container instantiate and bind a <code class="literal">HibernateService</code> to JNDI. Such advanced options are discussed later.
			</div><div class="para">
				You now need to configure a logging system. Hibernate uses commons logging and provides two choices: Log4j and JDK 1.4 logging. Most developers prefer Log4j: copy <code class="literal">log4j.properties</code> from the Hibernate distribution in the <code class="literal">etc/</code> directory to your <code class="literal">src</code> directory, next to <code class="literal">hibernate.cfg.xml</code>. If you prefer to have more verbose output than that provided in the example configuration, you can change the settings. By default, only the Hibernate start up message is shown on stdout.
			</div><div class="para">
				The tutorial infrastructure is complete and you are now ready to do some real work with Hibernate.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-firstapp-workingpersistence">
      ⁠</a>1.1.7. Loading and storing objects</h2></div></div></div><div class="para">
				We are now ready to start doing some real work with Hibernate. Let us start by writing an <code class="literal">EventManager</code> class with a <code class="literal">main()</code> method:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">tutorial</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.hibernate.Session;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.*;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.hibernate.tutorial.domain.Event;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.hibernate.tutorial.util.HibernateUtil;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EventManager {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">main</span>(String[] args) {
<span xmlns="" class="line">​</span>        EventManager mgr = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">EventManager</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (args[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">equals</span>(<span xmlns="" class="perl_String">"store"</span>)) {
<span xmlns="" class="line">​</span>            mgr.<span xmlns="" class="perl_Function">createAndStoreEvent</span>(<span xmlns="" class="perl_String">"My Event"</span>, <span xmlns="" class="perl_Keyword">new</span> Date());
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">close</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">createAndStoreEvent</span>(String title, Date theDate) {
<span xmlns="" class="line">​</span>        Session session = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>();
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Event theEvent = <span xmlns="" class="perl_Keyword">new</span> Event();
<span xmlns="" class="line">​</span>        theEvent.<span xmlns="" class="perl_Function">setTitle</span>(title);
<span xmlns="" class="line">​</span>        theEvent.<span xmlns="" class="perl_Function">setDate</span>(theDate);
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">save</span>(theEvent);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre><div class="para">
				In <code class="literal">createAndStoreEvent()</code> we created a new <code class="literal">Event</code> object and handed it over to Hibernate. At that point, Hibernate takes care of the SQL and executes an <code class="literal">INSERT</code> on the database.
			</div><div class="para">
				An <span class="interface">org.hibernate.Session</span> is designed to represent a single unit of work (a single atomic piece of work to be performed). For now we will keep things simple and assume a one-to-one granularity between a Hibernate <span class="interface">org.hibernate.Session</span> and a database transaction. To shield our code from the actual underlying transaction system we use the Hibernate <code class="interfacename">org.hibernate.Transaction</code> API. In this particular case we are using JDBC-based transactional semantics, but it could also run with JTA.
			</div><div class="para">
				What does <code class="literal">sessionFactory.getCurrentSession()</code> do? First, you can call it as many times and anywhere you like once you get hold of your <code class="interfacename">org.hibernate.SessionFactory</code>. The <code class="literal">getCurrentSession()</code> method always returns the "current" unit of work. Remember that we switched the configuration option for this mechanism to "thread" in our <code class="filename">src/main/resources/hibernate.cfg.xml</code>? Due to that setting, the context of a current unit of work is bound to the current Java thread that executes the application.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					Hibernate offers three methods of current session tracking. The "thread" based method is not intended for production use; it is merely useful for prototyping and tutorials such as this one. Current session tracking is discussed in more detail later on.
				</div></div></div><div class="para">
				An <span class="interface">org.hibernate.Session</span> begins when the first call to <code class="literal">getCurrentSession()</code> is made for the current thread. It is then bound by Hibernate to the current thread. When the transaction ends, either through commit or rollback, Hibernate automatically unbinds the <span class="interface">org.hibernate.Session</span> from the thread and closes it for you. If you call <code class="literal">getCurrentSession()</code> again, you get a new <span class="interface">org.hibernate.Session</span> and can start a new unit of work.
			</div><div class="para">
				Related to the unit of work scope, should the Hibernate <span class="interface">org.hibernate.Session</span> be used to execute one or several database operations? The above example uses one <span class="interface">org.hibernate.Session</span> for one operation. However this is pure coincidence; the example is just not complex enough to show any other approach. The scope of a Hibernate <span class="interface">org.hibernate.Session</span> is flexible but you should never design your application to use a new Hibernate <span class="interface">org.hibernate.Session</span> for <span class="emphasis"><em>every</em></span> database operation. Even though it is used in the following examples, consider <span class="emphasis"><em>session-per-operation</em></span> an anti-pattern. A real web application is shown later in the tutorial which will help illustrate this.
			</div><div class="para">
				See <a class="xref" href="transactions.html">Chapter 11, <em>Transactions and Concurrency</em></a> for more information about transaction handling and demarcation. The previous example also skipped any error handling and rollback.
			</div><div class="para">
				To run this, we will make use of the Maven <code class="literal">exec</code> plug-in to call our class with the necessary classpath setup: <code class="command">mvn exec:java -Dexec.mainClass="org.hibernate.tutorial.EventManager" -Dexec.args="store"</code>
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					You may need to perform <code class="command">mvn compile</code> first.
				</div></div></div><div class="para">
				You should see Hibernate starting up and, depending on your configuration, lots of log output. Towards the end, the following line will be displayed:
			</div><pre class="programlisting">[java] Hibernate: insert into EVENTS (EVENT_DATE, title, EVENT_ID) values (?, ?, ?)</pre><div class="para">
				This is the <code class="literal">INSERT</code> executed by Hibernate.
			</div><div class="para">
				To list stored events an option is added to the main method:
			</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (args[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">equals</span>(<span xmlns="" class="perl_String">"store"</span>)) {
<span xmlns="" class="line">​</span>            mgr.<span xmlns="" class="perl_Function">createAndStoreEvent</span>(<span xmlns="" class="perl_String">"My Event"</span>, <span xmlns="" class="perl_Keyword">new</span> Date());
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span> (args[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">equals</span>(<span xmlns="" class="perl_String">"list"</span>)) {
<span xmlns="" class="line">​</span>            List events = mgr.<span xmlns="" class="perl_Function">listEvents</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> i = <span xmlns="" class="perl_Float">0</span>; i &lt; events.<span xmlns="" class="perl_Function">size</span>(); i++) {
<span xmlns="" class="line">​</span>                Event theEvent = (Event) events.<span xmlns="" class="perl_Function">get</span>(i);
<span xmlns="" class="line">​</span>                System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_String">"Event: "</span> + theEvent.<span xmlns="" class="perl_Function">getTitle</span>() + <span xmlns="" class="perl_String">" Time: "</span> + theEvent.<span xmlns="" class="perl_Function">getDate</span>()
<span xmlns="" class="line">​</span>                );
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }</pre><div class="para">
				A new <code class="literal">listEvents() method is also added</code>:
			</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> List <span xmlns="" class="perl_Function">listEvents</span>() {
<span xmlns="" class="line">​</span>        Session session = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>();
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>        List result = session.<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"from Event"</span>).<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> result;
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				Here, we are using a Hibernate Query Language (HQL) query to load all existing <code class="literal">Event</code> objects from the database. Hibernate will generate the appropriate SQL, send it to the database and populate <code class="literal">Event</code> objects with the data. You can create more complex queries with HQL. See <a class="xref" href="queryhql.html">Chapter 14, <em>HQL: The Hibernate Query Language</em></a> for more information.
			</div><div class="para">
				Now we can call our new functionality, again using the Maven exec plug-in: <code class="command">mvn exec:java -Dexec.mainClass="org.hibernate.tutorial.EventManager" -Dexec.args="list"</code>
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tutorial-associations">
      ⁠</a>1.2. Part 2 - Mapping associations</h1></div></div></div><div class="para">
			So far we have mapped a single persistent entity class to a table in isolation. Let us expand on that a bit and add some class associations. We will add people to the application and store a list of events in which they participate.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-associations-mappinguser">
      ⁠</a>1.2.1. Mapping the Person class</h2></div></div></div><div class="para">
				The first cut of the <code class="literal">Person</code> class looks like this:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">tutorial</span>.<span xmlns="" class="perl_Function">domain</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Person {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> age;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String firstname;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String lastname;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">Person</span>() {}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">// Accessor methods for all properties, private setter for 'id'</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre><div class="para">
				Save this to a file named <code class="filename">src/main/java/org/hibernate/tutorial/domain/Person.java</code>
			</div><div class="para">
				Next, create the new mapping file as <code class="filename">src/main/resources/org/hibernate/tutorial/domain/Person.hbm.xml</code>
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping</span><span xmlns="" class="perl_Others"> package=</span><span xmlns="" class="perl_String">"org.hibernate.tutorial.domain"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Person"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"PERSON"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON_ID"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"native"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"age"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstname"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lastname"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
				Finally, add the new mapping to Hibernate's configuration immediately after the existing mapping for <code class="filename">Event.hbm.xml</code>:
			</div><pre class="programlisting">&lt;mapping resource="events/Event.hbm.xml"/&gt;
&lt;mapping resource="events/Person.hbm.xml"/&gt;</pre><div class="para">
				Create an association between these two entities. Persons can participate in events, and events have participants. The design questions you have to deal with are: directionality, multiplicity, and collection behavior.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-associations-unidirset">
      ⁠</a>1.2.2. A unidirectional Set-based association</h2></div></div></div><div class="para">
				By adding a collection of events to the <code class="literal">Person</code> class, you can easily navigate to the events for a particular person, without executing an explicit query - by calling <code class="literal">Person#getEvents</code>. Multi-valued associations are represented in Hibernate by one of the Java Collection Framework contracts; here we choose a <code class="interfacename">java.util.Set</code> because the collection will not contain duplicate elements and the ordering is not relevant to our examples:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Person {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set events = <span xmlns="" class="perl_Keyword">new</span> HashSet();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getEvents</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> events;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setEvents</span>(Set events) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">events</span> = events;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre><div class="para">
				Before mapping this association, let us consider the other side. We could just keep this unidirectional or create another collection on the <code class="literal">Event</code>, if we wanted to be able to navigate it from both directions. This is not necessary, from a functional perspective. You can always execute an explicit query to retrieve the participants for a particular event. This is a design choice left to you, but what is clear from this discussion is the multiplicity of the association: "many" valued on both sides is called a <span class="emphasis"><em>many-to-many</em></span> association. Hence, we use Hibernate's many-to-many mapping:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Person"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"PERSON"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON_ID"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"native"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"age"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstname"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lastname"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"events"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"PERSON_EVENT"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"EVENT_ID"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Event"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
				Hibernate supports a broad range of collection mappings, a <code class="literal">set</code> being most common. For a many-to-many association, or <span class="emphasis"><em>n:m</em></span> entity relationship, an association table is required. Each row in this table represents a link between a person and an event. The table name is declared using the <code class="literal">table</code> attribute of the <code class="literal">set</code> element. The identifier column name in the association, for the person side, is defined with the <code class="literal">key</code> element, the column name for the event's side with the <code class="literal">column</code> attribute of the <code class="literal">many-to-many</code>. You also have to tell Hibernate the class of the objects in your collection (the class on the other side of the collection of references).
			</div><div class="para">
				The database schema for this mapping is therefore:
			</div><pre class="programlisting">
    _____________        __________________
   |             |      |                  |       _____________
   |   EVENTS    |      |   PERSON_EVENT   |      |             |
   |_____________|      |__________________|      |    PERSON   |
   |             |      |                  |      |_____________|
   | *EVENT_ID   | &lt;--&gt; | *EVENT_ID        |      |             |
   |  EVENT_DATE |      | *PERSON_ID       | &lt;--&gt; | *PERSON_ID  |
   |  TITLE      |      |__________________|      |  AGE        |
   |_____________|                                |  FIRSTNAME  |
                                                  |  LASTNAME   |
                                                  |_____________|
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-associations-working">
      ⁠</a>1.2.3. Working the association</h2></div></div></div><div class="para">
				Now we will bring some people and events together in a new method in <code class="literal">EventManager</code>:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">addPersonToEvent</span>(<span xmlns="" class="perl_DataType">Long</span> personId, <span xmlns="" class="perl_DataType">Long</span> eventId) {
<span xmlns="" class="line">​</span>        Session session = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>();
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Person aPerson = (Person) session.<span xmlns="" class="perl_Function">load</span>(Person.<span xmlns="" class="perl_Function">class</span>, personId);
<span xmlns="" class="line">​</span>        Event anEvent = (Event) session.<span xmlns="" class="perl_Function">load</span>(Event.<span xmlns="" class="perl_Function">class</span>, eventId);
<span xmlns="" class="line">​</span>        aPerson.<span xmlns="" class="perl_Function">getEvents</span>().<span xmlns="" class="perl_Function">add</span>(anEvent);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				After loading a <code class="literal">Person</code> and an <code class="literal">Event</code>, simply modify the collection using the normal collection methods. There is no explicit call to <code class="literal">update()</code> or <code class="literal">save()</code>; Hibernate automatically detects that the collection has been modified and needs to be updated. This is called <span class="emphasis"><em>automatic dirty checking</em></span>. You can also try it by modifying the name or the date property of any of your objects. As long as they are in <span class="emphasis"><em>persistent</em></span> state, that is, bound to a particular Hibernate <code class="interfacename">org.hibernate.Session</code>, Hibernate monitors any changes and executes SQL in a write-behind fashion. The process of synchronizing the memory state with the database, usually only at the end of a unit of work, is called <span class="emphasis"><em>flushing</em></span>. In our code, the unit of work ends with a commit, or rollback, of the database transaction.
			</div><div class="para">
				You can load person and event in different units of work. Or you can modify an object outside of an <code class="interfacename">org.hibernate.Session</code>, when it is not in a persistent state (if it was persistent before, this state is called <span class="emphasis"><em>detached</em></span>). You can even modify a collection when it is detached:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">addPersonToEvent</span>(<span xmlns="" class="perl_DataType">Long</span> personId, <span xmlns="" class="perl_DataType">Long</span> eventId) {
<span xmlns="" class="line">​</span>        Session session = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>();
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Person aPerson = (Person) session
<span xmlns="" class="line">​</span>                .<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select p from Person p left join fetch p.events where p.id = :pid"</span>)
<span xmlns="" class="line">​</span>                .<span xmlns="" class="perl_Function">setParameter</span>(<span xmlns="" class="perl_String">"pid"</span>, personId)
<span xmlns="" class="line">​</span>                .<span xmlns="" class="perl_Function">uniqueResult</span>(); <span xmlns="" class="perl_Comment">// Eager fetch the collection so we can use it detached</span>
<span xmlns="" class="line">​</span>        Event anEvent = (Event) session.<span xmlns="" class="perl_Function">load</span>(Event.<span xmlns="" class="perl_Function">class</span>, eventId);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// End of first unit of work</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        aPerson.<span xmlns="" class="perl_Function">getEvents</span>().<span xmlns="" class="perl_Function">add</span>(anEvent); <span xmlns="" class="perl_Comment">// aPerson (and its collection) is detached</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Begin second unit of work</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Session session2 = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>();
<span xmlns="" class="line">​</span>        session2.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>        session2.<span xmlns="" class="perl_Function">update</span>(aPerson); <span xmlns="" class="perl_Comment">// Reattachment of aPerson</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        session2.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				The call to <code class="literal">update</code> makes a detached object persistent again by binding it to a new unit of work, so any modifications you made to it while detached can be saved to the database. This includes any modifications (additions/deletions) you made to a collection of that entity object.
			</div><div class="para">
				This is not much use in our example, but it is an important concept you can incorporate into your own application. Complete this exercise by adding a new action to the main method of the <code class="literal">EventManager</code> and call it from the command line. If you need the identifiers of a person and an event - the <code class="literal">save()</code> method returns it (you might have to modify some of the previous methods to return that identifier):
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span> (args[<span xmlns="" class="perl_Float">0</span>].<span xmlns="" class="perl_Function">equals</span>(<span xmlns="" class="perl_String">"addpersontoevent"</span>)) {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_DataType">Long</span> eventId = mgr.<span xmlns="" class="perl_Function">createAndStoreEvent</span>(<span xmlns="" class="perl_String">"My Event"</span>, <span xmlns="" class="perl_Keyword">new</span> Date());
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_DataType">Long</span> personId = mgr.<span xmlns="" class="perl_Function">createAndStorePerson</span>(<span xmlns="" class="perl_String">"Foo"</span>, <span xmlns="" class="perl_String">"Bar"</span>);
<span xmlns="" class="line">​</span>            mgr.<span xmlns="" class="perl_Function">addPersonToEvent</span>(personId, eventId);
<span xmlns="" class="line">​</span>            System.<span xmlns="" class="perl_Function">out</span>.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Added person "</span> + personId + <span xmlns="" class="perl_String">" to event "</span> + eventId);
<span xmlns="" class="line">​</span>        }</pre><div class="para">
				This is an example of an association between two equally important classes: two entities. As mentioned earlier, there are other classes and types in a typical model, usually "less important". Some you have already seen, like an <code class="literal">int</code> or a <code class="classname">java.lang.String</code>. We call these classes <span class="emphasis"><em>value types</em></span>, and their instances <span class="emphasis"><em>depend</em></span> on a particular entity. Instances of these types do not have their own identity, nor are they shared between entities. Two persons do not reference the same <code class="literal">firstname</code> object, even if they have the same first name. Value types cannot only be found in the JDK, but you can also write dependent classes yourself such as an <code class="literal">Address</code> or <code class="literal">MonetaryAmount</code> class. In fact, in a Hibernate application all JDK classes are considered value types.
			</div><div class="para">
				You can also design a collection of value types. This is conceptually different from a collection of references to other entities, but looks almost the same in Java.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-associations-valuecollections">
      ⁠</a>1.2.4. Collection of values</h2></div></div></div><div class="para">
				Let us add a collection of email addresses to the <code class="literal">Person</code> entity. This will be represented as a <code class="interfacename">java.util.Set</code> of <code class="classname">java.lang.String</code> instances:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set emailAddresses = <span xmlns="" class="perl_Keyword">new</span> HashSet();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getEmailAddresses</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> emailAddresses;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setEmailAddresses</span>(Set emailAddresses) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">emailAddresses</span> = emailAddresses;
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				The mapping of this <code class="literal">Set</code> is as follows:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"emailAddresses"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"PERSON_EMAIL_ADDR"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"EMAIL_ADDR"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span></pre><div class="para">
				The difference compared with the earlier mapping is the use of the <code class="literal">element</code> part which tells Hibernate that the collection does not contain references to another entity, but is rather a collection whose elements are values types, here specifically of type <code class="literal">string</code>. The lowercase name tells you it is a Hibernate mapping type/converter. Again the <code class="literal">table</code> attribute of the <code class="literal">set</code> element determines the table name for the collection. The <code class="literal">key</code> element defines the foreign-key column name in the collection table. The <code class="literal">column</code> attribute in the <code class="literal">element</code> element defines the column name where the email address values will actually be stored.
			</div><div class="para">
				Here is the updated schema:
			</div><pre class="programlisting">
  _____________        __________________
 |             |      |                  |       _____________
 |   EVENTS    |      |   PERSON_EVENT   |      |             |       ___________________
 |_____________|      |__________________|      |    PERSON   |      |                   |
 |             |      |                  |      |_____________|      | PERSON_EMAIL_ADDR |
 | *EVENT_ID   | &lt;--&gt; | *EVENT_ID        |      |             |      |___________________|
 |  EVENT_DATE |      | *PERSON_ID       | &lt;--&gt; | *PERSON_ID  | &lt;--&gt; |  *PERSON_ID       |
 |  TITLE      |      |__________________|      |  AGE        |      |  *EMAIL_ADDR      |
 |_____________|                                |  FIRSTNAME  |      |___________________|
                                                |  LASTNAME   |
                                                |_____________|
</pre><div class="para">
				You can see that the primary key of the collection table is in fact a composite key that uses both columns. This also implies that there cannot be duplicate email addresses per person, which is exactly the semantics we need for a set in Java.
			</div><div class="para">
				You can now try to add elements to this collection, just like we did before by linking persons and events. It is the same code in Java:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">addEmailToPerson</span>(<span xmlns="" class="perl_DataType">Long</span> personId, String emailAddress) {
<span xmlns="" class="line">​</span>        Session session = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>();
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        Person aPerson = (Person) session.<span xmlns="" class="perl_Function">load</span>(Person.<span xmlns="" class="perl_Function">class</span>, personId);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// adding to the emailAddress collection might trigger a lazy load of the collection</span>
<span xmlns="" class="line">​</span>        aPerson.<span xmlns="" class="perl_Function">getEmailAddresses</span>().<span xmlns="" class="perl_Function">add</span>(emailAddress);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        session.<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				This time we did not use a <span class="emphasis"><em>fetch</em></span> query to initialize the collection. Monitor the SQL log and try to optimize this with an eager fetch.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-associations-bidirectional">
      ⁠</a>1.2.5. Bi-directional associations</h2></div></div></div><div class="para">
				Next you will map a bi-directional association. You will make the association between person and event work from both sides in Java. The database schema does not change, so you will still have many-to-many multiplicity.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					A relational database is more flexible than a network programming language, in that it does not need a navigation direction; data can be viewed and retrieved in any possible way.
				</div></div></div><div class="para">
				First, add a collection of participants to the <code class="literal">Event</code> class:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set participants = <span xmlns="" class="perl_Keyword">new</span> HashSet();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getParticipants</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> participants;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setParticipants</span>(Set participants) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">participants</span> = participants;
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				Now map this side of the association in <code class="literal">Event.hbm.xml</code>.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"participants"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"PERSON_EVENT"</span><span xmlns="" class="perl_Others"> inverse=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"EVENT_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON_ID"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.hibernate.tutorial.domain.Person"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
</pre><div class="para">
				These are normal <code class="literal">set</code> mappings in both mapping documents. Notice that the column names in <code class="literal">key</code> and <code class="literal">many-to-many</code> swap in both mapping documents. The most important addition here is the <code class="literal">inverse="true"</code> attribute in the <code class="literal">set</code> element of the <code class="literal">Event</code>'s collection mapping.
			</div><div class="para">
				What this means is that Hibernate should take the other side, the <code class="literal">Person</code> class, when it needs to find out information about the link between the two. This will be a lot easier to understand once you see how the bi-directional link between our two entities is created.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-associations-usingbidir">
      ⁠</a>1.2.6. Working bi-directional links</h2></div></div></div><div class="para">
				First, keep in mind that Hibernate does not affect normal Java semantics. How did we create a link between a <code class="literal">Person</code> and an <code class="literal">Event</code> in the unidirectional example? You add an instance of <code class="literal">Event</code> to the collection of event references, of an instance of <code class="literal">Person</code>. If you want to make this link bi-directional, you have to do the same on the other side by adding a <code class="literal">Person</code> reference to the collection in an <code class="literal">Event</code>. This process of "setting the link on both sides" is absolutely necessary with bi-directional links.
			</div><div class="para">
				Many developers program defensively and create link management methods to correctly set both sides (for example, in <code class="literal">Person</code>):
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> Set <span xmlns="" class="perl_Function">getEvents</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> events;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setEvents</span>(Set events) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">events</span> = events;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">addToEvent</span>(Event event) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getEvents</span>().<span xmlns="" class="perl_Function">add</span>(event);
<span xmlns="" class="line">​</span>        event.<span xmlns="" class="perl_Function">getParticipants</span>().<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_Keyword">this</span>);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">removeFromEvent</span>(Event event) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">getEvents</span>().<span xmlns="" class="perl_Function">remove</span>(event);
<span xmlns="" class="line">​</span>        event.<span xmlns="" class="perl_Function">getParticipants</span>().<span xmlns="" class="perl_Function">remove</span>(<span xmlns="" class="perl_Keyword">this</span>);
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				The get and set methods for the collection are now protected. This allows classes in the same package and subclasses to still access the methods, but prevents everybody else from altering the collections directly. Repeat the steps for the collection on the other side.
			</div><div class="para">
				What about the <code class="literal">inverse</code> mapping attribute? For you, and for Java, a bi-directional link is simply a matter of setting the references on both sides correctly. Hibernate, however, does not have enough information to correctly arrange SQL <code class="literal">INSERT</code> and <code class="literal">UPDATE</code> statements (to avoid constraint violations). Making one side of the association <code class="literal">inverse</code> tells Hibernate to consider it a <span class="emphasis"><em>mirror</em></span> of the other side. That is all that is necessary for Hibernate to resolve any issues that arise when transforming a directional navigation model to a SQL database schema. The rules are straightforward: all bi-directional associations need one side as <code class="literal">inverse</code>. In a one-to-many association it has to be the many-side, and in many-to-many association you can select either side.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tutorial-webapp">
      ⁠</a>1.3. Part 3 - The EventManager web application</h1></div></div></div><div class="para">
			A Hibernate web application uses <code class="literal">Session</code> and <code class="literal">Transaction</code> almost like a standalone application. However, some common patterns are useful. You can now write an <code class="literal">EventManagerServlet</code>. This servlet can list all events stored in the database, and it provides an HTML form to enter new events.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-webapp-servlet">
      ⁠</a>1.3.1. Writing the basic servlet</h2></div></div></div><div class="para">
				First we need create our basic processing servlet. Since our servlet only handles HTTP <code class="literal">GET</code> requests, we will only implement the <code class="literal">doGet()</code> method:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">tutorial</span>.<span xmlns="" class="perl_Function">web</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// Imports</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EventManagerServlet <span xmlns="" class="perl_Keyword">extends</span> HttpServlet {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">doGet</span>(
<span xmlns="" class="line">​</span>            HttpServletRequest request,
<span xmlns="" class="line">​</span>            HttpServletResponse response) <span xmlns="" class="perl_Keyword">throws</span> ServletException, IOException {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        SimpleDateFormat dateFormatter = <span xmlns="" class="perl_Keyword">new</span> SimpleDateFormat( <span xmlns="" class="perl_String">"dd.MM.yyyy"</span> );
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// Begin unit of work</span>
<span xmlns="" class="line">​</span>            HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>().<span xmlns="" class="perl_Function">beginTransaction</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// Process request and render page...</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">// End unit of work</span>
<span xmlns="" class="line">​</span>            HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>().<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">commit</span>();
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">catch</span> (Exception ex) {
<span xmlns="" class="line">​</span>            HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>().<span xmlns="" class="perl_Function">getCurrentSession</span>().<span xmlns="" class="perl_Function">getTransaction</span>().<span xmlns="" class="perl_Function">rollback</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> ( ServletException.<span xmlns="" class="perl_Function">class</span>.<span xmlns="" class="perl_Function">isInstance</span>( ex ) ) {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> ( ServletException ) ex;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ServletException</span>( ex );
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre><div class="para">
				Save this servlet as <code class="filename">src/main/java/org/hibernate/tutorial/web/EventManagerServlet.java</code>
			</div><div class="para">
				The pattern applied here is called <span class="emphasis"><em>session-per-request</em></span>. When a request hits the servlet, a new Hibernate <code class="literal">Session</code> is opened through the first call to <code class="literal">getCurrentSession()</code> on the <code class="literal">SessionFactory</code>. A database transaction is then started. All data access occurs inside a transaction irrespective of whether the data is read or written. Do not use the auto-commit mode in applications.
			</div><div class="para">
				Do <span class="emphasis"><em>not</em></span> use a new Hibernate <code class="literal">Session</code> for every database operation. Use one Hibernate <code class="literal">Session</code> that is scoped to the whole request. Use <code class="literal">getCurrentSession()</code>, so that it is automatically bound to the current Java thread.
			</div><div class="para">
				Next, the possible actions of the request are processed and the response HTML is rendered. We will get to that part soon.
			</div><div class="para">
				Finally, the unit of work ends when processing and rendering are complete. If any problems occurred during processing or rendering, an exception will be thrown and the database transaction rolled back. This completes the <code class="literal">session-per-request</code> pattern. Instead of the transaction demarcation code in every servlet, you could also write a servlet filter. See the Hibernate website and Wiki for more information about this pattern called <span class="emphasis"><em>Open Session in View</em></span>. You will need it as soon as you consider rendering your view in JSP, not in a servlet.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-webapp-processing">
      ⁠</a>1.3.2. Processing and rendering</h2></div></div></div><div class="para">
				Now you can implement the processing of the request and the rendering of the page.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Write HTML header</span>
<span xmlns="" class="line">​</span>        PrintWriter out = response.<span xmlns="" class="perl_Function">getWriter</span>();
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Event Manager&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Handle actions</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> ( <span xmlns="" class="perl_String">"store"</span>.<span xmlns="" class="perl_Function">equals</span>(request.<span xmlns="" class="perl_Function">getParameter</span>(<span xmlns="" class="perl_String">"action"</span>)) ) {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            String eventTitle = request.<span xmlns="" class="perl_Function">getParameter</span>(<span xmlns="" class="perl_String">"eventTitle"</span>);
<span xmlns="" class="line">​</span>            String eventDate = request.<span xmlns="" class="perl_Function">getParameter</span>(<span xmlns="" class="perl_String">"eventDate"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">if</span> ( <span xmlns="" class="perl_String">""</span>.<span xmlns="" class="perl_Function">equals</span>(eventTitle) || <span xmlns="" class="perl_String">""</span>.<span xmlns="" class="perl_Function">equals</span>(eventDate) ) {
<span xmlns="" class="line">​</span>                out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;b&gt;&lt;i&gt;Please enter event title and date.&lt;/i&gt;&lt;/b&gt;"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Function">createAndStoreEvent</span>(eventTitle, dateFormatter.<span xmlns="" class="perl_Function">parse</span>(eventDate));
<span xmlns="" class="line">​</span>                out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;b&gt;&lt;i&gt;Added event.&lt;/i&gt;&lt;/b&gt;"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Print page</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Function">printEventForm</span>(out);
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Function">listEvents</span>(out, dateFormatter);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// Write HTML footer</span>
<span xmlns="" class="line">​</span>       out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;/body&gt;&lt;/html&gt;"</span>);
<span xmlns="" class="line">​</span>       out.<span xmlns="" class="perl_Function">flush</span>();
<span xmlns="" class="line">​</span>       out.<span xmlns="" class="perl_Function">close</span>();</pre><div class="para">
				This coding style, with a mix of Java and HTML, would not scale in a more complex application—keep in mind that we are only illustrating basic Hibernate concepts in this tutorial. The code prints an HTML header and a footer. Inside this page, an HTML form for event entry and a list of all events in the database are printed. The first method is trivial and only outputs HTML:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">printEventForm</span>(PrintWriter out) {
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;h2&gt;Add new event:&lt;/h2&gt;"</span>);
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;form&gt;"</span>);
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Title: &lt;input name='eventTitle' length='50'/&gt;&lt;br/&gt;"</span>);
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"Date (e.g. 24.12.2009): &lt;input name='eventDate' length='10'/&gt;&lt;br/&gt;"</span>);
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;input type='submit' name='action' value='store'/&gt;"</span>);
<span xmlns="" class="line">​</span>        out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;/form&gt;"</span>);
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				The <code class="literal">listEvents()</code> method uses the Hibernate <code class="literal">Session</code> bound to the current thread to execute a query:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">listEvents</span>(PrintWriter out, SimpleDateFormat dateFormatter) {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        List result = HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>()
<span xmlns="" class="line">​</span>                .<span xmlns="" class="perl_Function">getCurrentSession</span>().<span xmlns="" class="perl_Function">createCriteria</span>(Event.<span xmlns="" class="perl_Function">class</span>).<span xmlns="" class="perl_Function">list</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (result.<span xmlns="" class="perl_Function">size</span>() &gt; <span xmlns="" class="perl_Float">0</span>) {
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;h2&gt;Events in database:&lt;/h2&gt;"</span>);
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;table border='1'&gt;"</span>);
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;tr&gt;"</span>);
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;th&gt;Event title&lt;/th&gt;"</span>);
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;th&gt;Event date&lt;/th&gt;"</span>);
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;/tr&gt;"</span>);
<span xmlns="" class="line">​</span>            Iterator it = result.<span xmlns="" class="perl_Function">iterator</span>();
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">while</span> (it.<span xmlns="" class="perl_Function">hasNext</span>()) {
<span xmlns="" class="line">​</span>                Event event = (Event) it.<span xmlns="" class="perl_Function">next</span>();
<span xmlns="" class="line">​</span>                out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;tr&gt;"</span>);
<span xmlns="" class="line">​</span>                out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;td&gt;"</span> + event.<span xmlns="" class="perl_Function">getTitle</span>() + <span xmlns="" class="perl_String">"&lt;/td&gt;"</span>);
<span xmlns="" class="line">​</span>                out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;td&gt;"</span> + dateFormatter<span xmlns="" class="perl_Function">.format(event.getDate()) + </span><span xmlns="" class="perl_String">"&lt;/td&gt;")</span>;
<span xmlns="" class="line">​</span>                out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;/tr&gt;"</span>);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>            out.<span xmlns="" class="perl_Function">println</span>(<span xmlns="" class="perl_String">"&lt;/table&gt;"</span>);
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				Finally, the <code class="literal">store</code> action is dispatched to the <code class="literal">createAndStoreEvent()</code> method, which also uses the <code class="literal">Session</code> of the current thread:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">createAndStoreEvent</span>(String title, Date theDate) {
<span xmlns="" class="line">​</span>        Event theEvent = <span xmlns="" class="perl_Keyword">new</span> Event();
<span xmlns="" class="line">​</span>        theEvent.<span xmlns="" class="perl_Function">setTitle</span>(title);
<span xmlns="" class="line">​</span>        theEvent.<span xmlns="" class="perl_Function">setDate</span>(theDate);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        HibernateUtil.<span xmlns="" class="perl_Function">getSessionFactory</span>()
<span xmlns="" class="line">​</span>                .<span xmlns="" class="perl_Function">getCurrentSession</span>().<span xmlns="" class="perl_Function">save</span>(theEvent);
<span xmlns="" class="line">​</span>    }</pre><div class="para">
				The servlet is now complete. A request to the servlet will be processed in a single <code class="literal">Session</code> and <code class="literal">Transaction</code>. As earlier in the standalone application, Hibernate can automatically bind these objects to the current thread of execution. This gives you the freedom to layer your code and access the <code class="literal">SessionFactory</code> in any way you like. Usually you would use a more sophisticated design and move the data access code into data access objects (the DAO pattern). See the Hibernate Wiki for more examples.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tutorial-webapp-deploy">
      ⁠</a>1.3.3. Deploying and testing</h2></div></div></div><div class="para">
				To deploy this application for testing we must create a Web ARchive (WAR). First we must define the WAR descriptor as <code class="filename">src/main/webapp/WEB-INF/web.xml</code>
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web-app</span><span xmlns="" class="perl_Others"> version=</span><span xmlns="" class="perl_String">"2.4"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/j2ee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>Event Manager<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;servlet-class&gt;</span>org.hibernate.tutorial.web.EventManagerServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/servlet&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>Event Manager<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/eventmanager<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/web-app&gt;</span></pre><div class="para">
				To build and deploy call <code class="literal">mvn package</code> in your project directory and copy the <code class="filename">hibernate-tutorial.war</code> file into your <code class="filename">$JBOSS_HOME/server/$CONFIG/deploy</code> directory.
			</div><div class="para">
				Once deployed and JBoss is running, access the application at <code class="literal">http://localhost:8080/hibernate-tutorial/eventmanager</code>. Watch the server log (in <code class="filename">$JBOSS_HOME/server/$CONFIG/log/server.log</code>) to see Hibernate initialize when the first request hits your servlet (the static initializer in <code class="literal">HibernateUtil</code> is called) and to get the detailed output if any exceptions occurs.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tutorial-summary">
      ⁠</a>1.4. Summary</h1></div></div></div><div class="para">
			This tutorial covered the basics of writing a simple standalone Hibernate application and a small web application. More tutorials are available from the Hibernate <a href="http://hibernate.org">website</a>.
		</div></div></div></body></html>