<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 6. Collection mapping</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="collections">
      ⁠</a>Chapter 6. Collection mapping</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="collections-persistent">
      ⁠</a>6.1. Persistent collections</h1></div></div></div><div class="para">
			Hibernate requires that persistent collection-valued fields be declared as an interface type. For example:
		</div><pre class="programlisting Java"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Product {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String serialNumber;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set parts = <span xmlns="" class="perl_Keyword">new</span> HashSet();
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Set <span xmlns="" class="perl_Function">getParts</span>() { <span xmlns="" class="perl_Keyword">return</span> parts; }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setParts</span>(Set parts) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">parts</span> = parts; }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSerialNumber</span>() { <span xmlns="" class="perl_Keyword">return</span> serialNumber; }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setSerialNumber</span>(String sn) { serialNumber = sn; }
<span xmlns="" class="line">​</span>}</pre><div class="para">
			The actual interface might be <code class="literal">java.util.Set</code>, <code class="literal">java.util.Collection</code>, <code class="literal">java.util.List</code>, <code class="literal">java.util.Map</code>, <code class="literal">java.util.SortedSet</code>, <code class="literal">java.util.SortedMap</code> or anything you like ("anything you like" means you will have to write an implementation of <code class="literal">org.hibernate.usertype.UserCollectionType</code>.)
		</div><div class="para">
			Notice how the instance variable was initialized with an instance of <code class="literal">HashSet</code>. This is the best way to initialize collection valued properties of newly instantiated (non-persistent) instances. When you make the instance persistent, by calling <code class="literal">persist()</code> for example, Hibernate will actually replace the <code class="literal">HashSet</code> with an instance of Hibernate's own implementation of <code class="literal">Set</code>. Be aware of the following errors:
		</div><pre class="programlisting">Cat cat = new DomesticCat();
Cat kitten = new DomesticCat();
....
Set kittens = new HashSet();
kittens.add(kitten);
cat.setKittens(kittens);
session.persist(cat);
kittens = cat.getKittens(); // Okay, kittens collection is a Set
(HashSet) cat.getKittens(); // Error!</pre><div class="para">
			The persistent collections injected by Hibernate behave like <code class="literal">HashMap</code>, <code class="literal">HashSet</code>, <code class="literal">TreeMap</code>, <code class="literal">TreeSet</code> or <code class="literal">ArrayList</code>, depending on the interface type.
		</div><div class="para">
			Collections instances have the usual behavior of value types. They are automatically persisted when referenced by a persistent object and are automatically deleted when unreferenced. If a collection is passed from one persistent object to another, its elements might be moved from one table to another. Two entities cannot share a reference to the same collection instance. Due to the underlying relational model, collection-valued properties do not support null value semantics. Hibernate does not distinguish between a null collection reference and an empty collection.
		</div><div class="para">
			Use persistent collections the same way you use ordinary Java collections. However, please ensure you understand the semantics of bidirectional associations (these are discussed later).
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="collections-mapping">
      ⁠</a>6.2. Collection mappings</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				There are quite a range of mappings that can be generated for collections that cover many common relational models. We suggest you experiment with the schema generation tool so that you understand how various mapping declarations translate to database tables.
			</div></div></div><div class="para">
			The Hibernate mapping element used for mapping a collection depends upon the type of interface. For example, a <code class="literal">&lt;set&gt;</code> element is used for mapping properties of type <code class="literal">Set</code>.
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Product"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serialNumber"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"productSerialNumber"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"parts"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"productSerialNumber"</span><span xmlns="" class="perl_Others"> not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Part"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
			Apart from <code class="literal">&lt;set&gt;</code>, there is also <code class="literal">&lt;list&gt;</code>, <code class="literal">&lt;map&gt;</code>, <code class="literal">&lt;bag&gt;</code>, <code class="literal">&lt;array&gt;</code> and <code class="literal">&lt;primitive-array&gt;</code> mapping elements. The <code class="literal">&lt;map&gt;</code> element is representative:
		</div><div class="programlistingco"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    name=</span><span xmlns="" class="perl_String">"propertyName"</span>                                         <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    table=</span><span xmlns="" class="perl_String">"table_name"</span>                                          <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    schema=</span><span xmlns="" class="perl_String">"schema_name"</span>                                        <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    lazy=</span><span xmlns="" class="perl_String">"true|extra|false"</span>                                     <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    inverse=</span><span xmlns="" class="perl_String">"true|false"</span>                                        <img class="callout" alt="5" src="Common_Content/images/5.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    cascade=</span><span xmlns="" class="perl_String">"all|none|save-update|delete|all-delete-orphan|delete-orphan"</span>    <img class="callout" alt="6" src="Common_Content/images/6.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    sort=</span><span xmlns="" class="perl_String">"unsorted|natural|comparatorClass"</span>                     <img class="callout" alt="7" src="Common_Content/images/7.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    order-by=</span><span xmlns="" class="perl_String">"column_name asc|desc"</span>                             <img class="callout" alt="8" src="Common_Content/images/8.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    where=</span><span xmlns="" class="perl_String">"arbitrary sql where condition"</span>                       <img class="callout" alt="9" src="Common_Content/images/9.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    fetch=</span><span xmlns="" class="perl_String">"join|select|subselect"</span>                               <img class="callout" alt="10" src="Common_Content/images/10.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    batch-size=</span><span xmlns="" class="perl_String">"N"</span>                                              <img class="callout" alt="11" src="Common_Content/images/11.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    access=</span><span xmlns="" class="perl_String">"field|property|ClassName"</span>                           <img class="callout" alt="12" src="Common_Content/images/12.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    optimistic-lock=</span><span xmlns="" class="perl_String">"true|false"</span>                                <img class="callout" alt="13" src="Common_Content/images/13.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    mutable=</span><span xmlns="" class="perl_String">"true|false"</span>                                        <img class="callout" alt="14" src="Common_Content/images/14.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    node=</span><span xmlns="" class="perl_String">"element-name|."</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    embed-xml=</span><span xmlns="" class="perl_String">"true|false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span> <span xmlns="" class="perl_Error">....</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key</span> <span xmlns="" class="perl_Error">....</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span> <span xmlns="" class="perl_Error">....</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">name</code>: the collection property name
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">table</code> (optional - defaults to property name): the name of the collection table. It is not used for one-to-many associations.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">schema</code> (optional): the name of a table schema to override the schema declared on the root element
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">lazy</code> (optional - defaults to <code class="literal">true</code>): disables lazy fetching and specifies that the association is always eagerly fetched. It can also be used to enable "extra-lazy" fetching where most operations do not initialize the collection. This is suitable for large collections.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">inverse</code> (optional - defaults to <code class="literal">false</code>): marks this collection as the "inverse" end of a bidirectional association.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/6.png" alt="6"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">cascade</code> (optional - defaults to <code class="literal">none</code>): enables operations to cascade to child entities.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/7.png" alt="7"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">sort</code> (optional): specifies a sorted collection with <code class="literal">natural</code> sort order or a given comparator class.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/8.png" alt="8"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">order-by</code> (optional, JDK1.4 only): specifies a table column or columns that define the iteration order of the <code class="literal">Map</code>, <code class="literal">Set</code> or bag, together with an optional <code class="literal">asc</code> or <code class="literal">desc</code>.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/9.png" alt="9"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">where</code> (optional): specifies an arbitrary SQL <code class="literal">WHERE</code> condition that is used when retrieving or removing the collection. This is useful if the collection needs to contain only a subset of the available data.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/10.png" alt="10"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">fetch</code> (optional, defaults to <code class="literal">select</code>): chooses between outer-join fetching, fetching by sequential select, and fetching by sequential subselect.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/11.png" alt="11"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">batch-size</code> (optional, defaults to <code class="literal">1</code>): specifies a "batch size" for lazily fetching instances of this collection.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/12.png" alt="12"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): the strategy Hibernate uses for accessing the collection property value.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/13.png" alt="13"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">optimistic-lock</code> (optional - defaults to <code class="literal">true</code>): specifies that changes to the state of the collection results in increments of the owning entity's version. For one-to-many associations you may want to disable this setting.
					</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/14.png" alt="14"/></p></td><td valign="top" align="left"><div class="para">
						<code class="literal">mutable</code> (optional - defaults to <code class="literal">true</code>): a value of <code class="literal">false</code> specifies that the elements of the collection never change. This allows for minor performance optimization in some cases.
					</div></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-foreignkeys">
      ⁠</a>6.2.1. Collection foreign keys</h2></div></div></div><div class="para">
				Collection instances are distinguished in the database by the foreign key of the entity that owns the collection. This foreign key is referred to as the <span class="emphasis"><em>collection key column</em></span>, or columns, of the collection table. The collection key column is mapped by the <code class="literal">&lt;key&gt;</code> element.
			</div><div class="para">
				There can be a nullability constraint on the foreign key column. For most collections, this is implied. For unidirectional one-to-many associations, the foreign key column is nullable by default, so you may need to specify <code class="literal">not-null="true"</code>.
			</div><pre class="programlisting">&lt;key column="productSerialNumber" not-null="true"/&gt;</pre><div class="para">
				The foreign key constraint can use <code class="literal">ON DELETE CASCADE</code>.
			</div><pre class="programlisting">&lt;key column="productSerialNumber" on-delete="cascade"/&gt;</pre><div class="para">
				See the previous chapter for a full definition of the <code class="literal">&lt;key&gt;</code> element.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-elements">
      ⁠</a>6.2.2. Collection elements</h2></div></div></div><div class="para">
				Collections can contain almost any other Hibernate type, including: basic types, custom types, components and references to other entities. This is an important distinction. An object in a collection might be handled with "value" semantics (its life cycle fully depends on the collection owner), or it might be a reference to another entity with its own life cycle. In the latter case, only the "link" between the two objects is considered to be a state held by the collection.
			</div><div class="para">
				The contained type is referred to as the <span class="emphasis"><em>collection element type</em></span>. Collection elements are mapped by <code class="literal">&lt;element&gt;</code> or <code class="literal">&lt;composite-element&gt;</code>, or in the case of entity references, with <code class="literal">&lt;one-to-many&gt;</code> or <code class="literal">&lt;many-to-many&gt;</code>. The first two map elements with value semantics, the next two are used to map entity associations.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-indexed">
      ⁠</a>6.2.3. Indexed collections</h2></div></div></div><div class="para">
				All collection mappings, except those with set and bag semantics, need an <span class="emphasis"><em>index column</em></span> in the collection table. An index column is a column that maps to an array index, or <code class="literal">List</code> index, or <code class="literal">Map</code> key. The index of a <code class="literal">Map</code> may be of any basic type, mapped with <code class="literal">&lt;map-key&gt;</code>. It can be an entity reference mapped with <code class="literal">&lt;map-key-many-to-many&gt;</code>, or it can be a composite type mapped with <code class="literal">&lt;composite-map-key&gt;</code>. The index of an array or list is always of type <code class="literal">integer</code> and is mapped using the <code class="literal">&lt;list-index&gt;</code> element. The mapped column contains sequential integers that are numbered from zero by default.
			</div><div class="programlistingco"><pre class="programlisting">&lt;list-index 
        column="column_name"                 <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        base="0|1|..."                       <img class="callout" alt="2" src="Common_Content/images/2.png"/>
/&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">column_name</code> (required): the name of the column holding the collection index values.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">base</code> (optional - defaults to <code class="literal">0</code>): the value of the index column that corresponds to the first element of the list or array.
						</div></td></tr></table></div></div><div class="programlistingco"><pre class="programlisting">&lt;map-key 
        column="column_name"                 <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        formula="any SQL expression"         <img class="callout" alt="2" src="Common_Content/images/2.png"/>
        type="type_name"                     <img class="callout" alt="3" src="Common_Content/images/3.png"/>
        node="@attribute-name"
        length="N"/&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">column</code> (optional): the name of the column holding the collection index values.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">formula</code> (optional): a SQL formula used to evaluate the key of the map.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">type</code> (required): the type of the map keys.
						</div></td></tr></table></div></div><div class="programlistingco"><pre class="programlisting">&lt;map-key-many-to-many
        column="column_name"                 <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        formula="any SQL expression"         <img class="callout" alt="2" src="Common_Content/images/2.png"/>
        class="ClassName"                    <img class="callout" alt="3" src="Common_Content/images/3.png"/>
/&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">column</code> (optional): the name of the foreign key column for the collection index values.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">formula</code> (optional): a SQ formula used to evaluate the foreign key of the map key.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">class</code> (required): the entity class used as the map key.
						</div></td></tr></table></div></div><div class="para">
				If your table does not have an index column, and you still wish to use <code class="literal">List</code> as the property type, you can map the property as a Hibernate <span class="emphasis"><em>&lt;bag&gt;</em></span>. A bag does not retain its order when it is persisted to the database, but it can be optionally sorted or ordered when it is retrieved from the database.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-ofvalues">
      ⁠</a>6.2.4. Collections of values and many-to-many associations</h2></div></div></div><div class="para">
				Any collection of values or many-to-many associations requires a dedicated <span class="emphasis"><em>collection table</em></span> with a foreign key column or columns, <span class="emphasis"><em>collection element column</em></span> or columns, and possibly an index column or columns.
			</div><div class="para">
				For a collection of values use the <code class="literal">&lt;element&gt;</code> tag. For example:
			</div><div class="programlistingco"><pre class="programlisting">&lt;element
        column="column_name"                      <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        formula="any SQL expression"              <img class="callout" alt="2" src="Common_Content/images/2.png"/>
        type="typename"                           <img class="callout" alt="3" src="Common_Content/images/3.png"/>
        length="L"
        precision="P"
        scale="S"
        not-null="true|false"
        unique="true|false"
        node="element-name"
/&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">column</code> (optional): the name of the column holding the collection element values.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">formula</code> (optional): an SQL formula used to evaluate the element.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">type</code> (required): the type of the collection element.
						</div></td></tr></table></div></div><div class="para">
				A <span class="emphasis"><em>many-to-many association</em></span> is specified using the <code class="literal">&lt;many-to-many&gt;</code> element.
			</div><div class="programlistingco"><pre class="programlisting">&lt;many-to-many
        column="column_name"                                <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        formula="any SQL expression"                        <img class="callout" alt="2" src="Common_Content/images/2.png"/>
        class="ClassName"                                   <img class="callout" alt="3" src="Common_Content/images/3.png"/>
        fetch="select|join"                                 <img class="callout" alt="4" src="Common_Content/images/4.png"/>
        unique="true|false"                                 <img class="callout" alt="5" src="Common_Content/images/5.png"/>
        not-found="ignore|exception"                        <img class="callout" alt="6" src="Common_Content/images/6.png"/>
        entity-name="EntityName"                            <img class="callout" alt="7" src="Common_Content/images/7.png"/>
        property-ref="propertyNameFromAssociatedClass"      <img class="callout" alt="8" src="Common_Content/images/8.png"/>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">column</code> (optional): the name of the element foreign key column.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">formula</code> (optional): an SQL formula used to evaluate the element foreign key value.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">class</code> (required): the name of the associated class.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">fetch</code> (optional - defaults to <code class="literal">join</code>): enables outer-join or sequential select fetching for this association. This is a special case; for full eager fetching in a single <code class="literal">SELECT</code> of an entity and its many-to-many relationships to other entities, you would enable <code class="literal">join</code> fetching,not only of the collection itself, but also with this attribute on the <code class="literal">&lt;many-to-many&gt;</code> nested element.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">unique</code> (optional): enables the DDL generation of a unique constraint for the foreign-key column. This makes the association multiplicity effectively one-to-many.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/6.png" alt="6"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">not-found</code> (optional - defaults to <code class="literal">exception</code>): specifies how foreign keys that reference missing rows will be handled: <code class="literal">ignore</code> will treat a missing row as a null association.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/7.png" alt="7"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">entity-name</code> (optional): the entity name of the associated class, as an alternative to <code class="literal">class</code>.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/8.png" alt="8"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">property-ref</code> (optional): the name of a property of the associated class that is joined to this foreign key. If not specified, the primary key of the associated class is used.
						</div></td></tr></table></div></div><div class="para">
				Here are some examples.
			</div><div class="para">
				A set of strings:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"names"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"person_names"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"person_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"person_name"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span></pre><div class="para">
				A bag containing integers with an iteration order determined by the <code class="literal">order-by</code> attribute:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bag</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"sizes"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        table=</span><span xmlns="" class="perl_String">"item_sizes"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        order-by=</span><span xmlns="" class="perl_String">"size asc"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"item_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"size"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"integer"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bag&gt;</span></pre><div class="para">
				An array of entities, in this case, a many-to-many association:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;array</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"addresses"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        table=</span><span xmlns="" class="perl_String">"PersonAddress"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        cascade=</span><span xmlns="" class="perl_String">"persist"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"personId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;list-index</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"sortOrder"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"addressId"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Address"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/array&gt;</span></pre><div class="para">
				A map from string indices to dates:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"holidays"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        table=</span><span xmlns="" class="perl_String">"holidays"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        schema=</span><span xmlns="" class="perl_String">"dbo"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        order-by=</span><span xmlns="" class="perl_String">"hol_name asc"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"hol_name"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"hol_date"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre><div class="para">
				A list of components (this is discussed in the next chapter):
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;list</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"carComponents"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        table=</span><span xmlns="" class="perl_String">"CarComponents"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"carId"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;list-index</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"sortOrder"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;composite-element</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"CarComponent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"price"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"type"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serialNumber"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"serialNum"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/composite-element&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/list&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-onetomany">
      ⁠</a>6.2.5. One-to-many associations</h2></div></div></div><div class="para">
				A <span class="emphasis"><em>one-to-many association</em></span> links the tables of two classes via a foreign key with no intervening collection table. This mapping loses certain semantics of normal Java collections:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						An instance of the contained entity class cannot belong to more than one instance of the collection.
					</div></li><li class="listitem"><div class="para">
						An instance of the contained entity class cannot appear at more than one value of the collection index.
					</div></li></ul></div><div class="para">
				An association from <code class="literal">Product</code> to <code class="literal">Part</code> requires the existence of a foreign key column and possibly an index column to the <code class="literal">Part</code> table. A <code class="literal">&lt;one-to-many&gt;</code> tag indicates that this is a one-to-many association.
			</div><div class="programlistingco"><pre class="programlisting">&lt;one-to-many 
        class="ClassName"                                   <img class="callout" alt="1" src="Common_Content/images/1.png"/>
        not-found="ignore|exception"                        <img class="callout" alt="2" src="Common_Content/images/2.png"/>
        entity-name="EntityName"                            <img class="callout" alt="3" src="Common_Content/images/3.png"/>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">class</code> (required): the name of the associated class.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">not-found</code> (optional - defaults to <code class="literal">exception</code>): specifies how cached identifiers that reference missing rows will be handled. <code class="literal">ignore</code> will treat a missing row as a null association.
						</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
							<code class="literal">entity-name</code> (optional): the entity name of the associated class, as an alternative to <code class="literal">class</code>.
						</div></td></tr></table></div></div><div class="para">
				The <code class="literal">&lt;one-to-many&gt;</code> element does not need to declare any columns. Nor is it necessary to specify the <code class="literal">table</code> name anywhere.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					If the foreign key column of a <code class="literal">&lt;one-to-many&gt;</code> association is declared <code class="literal">NOT NULL</code>, you must declare the <code class="literal">&lt;key&gt;</code> mapping <code class="literal">not-null="true"</code> or <span class="emphasis"><em>use a bidirectional association</em></span> with the collection mapping marked <code class="literal">inverse="true"</code>. See the discussion of bidirectional associations later in this chapter for more information.
				</div></div></div><div class="para">
				The following example shows a map of <code class="literal">Part</code> entities by name, where <code class="literal">partName</code> is a persistent property of <code class="literal">Part</code>. Notice the use of a formula-based index:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"parts"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        cascade=</span><span xmlns="" class="perl_String">"all"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"productId"</span><span xmlns="" class="perl_Others"> not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key</span><span xmlns="" class="perl_Others"> formula=</span><span xmlns="" class="perl_String">"partName"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Part"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="collections-advancedmappings">
      ⁠</a>6.3. Advanced collection mappings</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-sorted">
      ⁠</a>6.3.1. Sorted collections</h2></div></div></div><div class="para">
				Hibernate supports collections implementing <code class="literal">java.util.SortedMap</code> and <code class="literal">java.util.SortedSet</code>. You must specify a comparator in the mapping file:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"aliases"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            table=</span><span xmlns="" class="perl_String">"person_aliases"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            sort=</span><span xmlns="" class="perl_String">"natural"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"holidays"</span><span xmlns="" class="perl_Others"> sort=</span><span xmlns="" class="perl_String">"my.custom.HolidayComparator"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"year_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"hol_name"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"hol_date"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre><div class="para">
				Allowed values of the <code class="literal">sort</code> attribute are <code class="literal">unsorted</code>, <code class="literal">natural</code> and the name of a class implementing <code class="literal">java.util.Comparator</code>.
			</div><div class="para">
				Sorted collections actually behave like <code class="literal">java.util.TreeSet</code> or <code class="literal">java.util.TreeMap</code>.
			</div><div class="para">
				If you want the database itself to order the collection elements, use the <code class="literal">order-by</code> attribute of <code class="literal">set</code>, <code class="literal">bag</code> or <code class="literal">map</code> mappings. This solution is only available under JDK 1.4 or higher and is implemented using <code class="literal">LinkedHashSet</code> or <code class="literal">LinkedHashMap</code>. This performs the ordering in the SQL query and not in the memory.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"aliases"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"person_aliases"</span><span xmlns="" class="perl_Others"> order-by=</span><span xmlns="" class="perl_String">"lower(name) asc"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"holidays"</span><span xmlns="" class="perl_Others"> order-by=</span><span xmlns="" class="perl_String">"hol_date, hol_name"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"year_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"hol_name"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;element</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"hol_date type="</span><span xmlns="" class="perl_Error">date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The value of the <code class="literal">order-by</code> attribute is an SQL ordering, not an HQL ordering.
				</div></div></div><div class="para">
				Associations can even be sorted by arbitrary criteria at runtime using a collection <code class="literal">filter()</code>:
			</div><pre class="programlisting">sortedUsers = s.createFilter( group.getUsers(), "order by this.name" ).list();</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-bidirectional">
      ⁠</a>6.3.2. Bidirectional associations</h2></div></div></div><div class="para">
				A <span class="emphasis"><em>bidirectional association</em></span> allows navigation from both "ends" of the association. Two kinds of bidirectional association are supported: 
				<div class="variablelist"><dl class="variablelist"><dt><span class="term">one-to-many</span></dt><dd><div class="para">
								set or bag valued at one end and single-valued at the other
							</div></dd><dt><span class="term">many-to-many</span></dt><dd><div class="para">
								set or bag valued at both ends
							</div></dd></dl></div>

			</div><div class="para">
				You can specify a bidirectional many-to-many association by mapping two many-to-many associations to the same database table and declaring one end as <span class="emphasis"><em>inverse</em></span>. You cannot select an indexed collection.
			</div><div class="para">
				Here is an example of a bidirectional many-to-many association that illustrates how each category can have many items and each item can be in many categories:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Category"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"CATEGORY_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;bag</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"items"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"CATEGORY_ITEM"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"CATEGORY_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Item"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"ITEM_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/bag&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Item"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"ITEM_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- inverse end --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;bag</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"categories"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"CATEGORY_ITEM"</span><span xmlns="" class="perl_Others"> inverse=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"ITEM_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Category"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"CATEGORY_ID"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/bag&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
				Changes made only to the inverse end of the association are <span class="emphasis"><em>not</em></span> persisted. This means that Hibernate has two representations in memory for every bidirectional association: one link from A to B and another link from B to A. This is easier to understand if you think about the Java object model and how a many-to-many relationship in Javais created:
			</div><pre class="programlisting">
category.getItems().add(item);          // The category now "knows" about the relationship
item.getCategories().add(category);     // The item now "knows" about the relationship

session.persist(item);                   // The relationship will not be saved!
session.persist(category);               // The relationship will be saved</pre><div class="para">
				The non-inverse side is used to save the in-memory representation to the database.
			</div><div class="para">
				You can define a bidirectional one-to-many association by mapping a one-to-many association to the same table column(s) as a many-to-one association and declaring the many-valued end <code class="literal">inverse="true"</code>.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Others"> inverse=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"child_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"parent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        class=</span><span xmlns="" class="perl_String">"Parent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        column=</span><span xmlns="" class="perl_String">"parent_id"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
				Mapping one end of an association with <code class="literal">inverse="true"</code> does not affect the operation of cascades as these are orthogonal concepts.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-indexedbidirectional">
      ⁠</a>6.3.3. Bidirectional associations with indexed collections</h2></div></div></div><div class="para">
				A bidirectional association where one end is represented as a <code class="literal">&lt;list&gt;</code> or <code class="literal">&lt;map&gt;</code>, requires special consideration. If there is a property of the child class that maps to the index column you can use <code class="literal">inverse="true"</code> on the collection mapping:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Others"> inverse=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;map-key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"name"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"child_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"name"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"parent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        class=</span><span xmlns="" class="perl_String">"Parent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        column=</span><span xmlns="" class="perl_String">"parent_id"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
				If there is no such property on the child class, the association cannot be considered truly bidirectional. That is, there is information available at one end of the association that is not available at the other end. In this case, you cannot map the collection <code class="literal">inverse="true"</code>. Instead, you could use the following mapping:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;map-key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"name"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            type=</span><span xmlns="" class="perl_String">"string"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"child_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"parent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        class=</span><span xmlns="" class="perl_String">"Parent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        column=</span><span xmlns="" class="perl_String">"parent_id"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        insert=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        update=</span><span xmlns="" class="perl_String">"false"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/class&gt;</span></pre><div class="para">
				Note that in this mapping, the collection-valued end of the association is responsible for updates to the foreign key. 
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-ternary">
      ⁠</a>6.3.4. Ternary associations</h2></div></div></div><div class="para">
				There are three possible approaches to mapping a ternary association. One approach is to use a <code class="literal">Map</code> with an association as its index:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"contracts"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"employer_id"</span><span xmlns="" class="perl_Others"> not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key-many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"employee_id"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Employee"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Contract"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"connections"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"incoming_node_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map-key-many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"outgoing_node_id"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Node"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"connection_id"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Connection"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/map&gt;</span></pre><div class="para">
				A second approach is to remodel the association as an entity class. This is the most common approach.
			</div><div class="para">
				A final alternative is to use composite elements, which will be discussed later.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="collections-idbag">
      ⁠</a>6.3.5. <code class="literal">Using an &lt;idbag&gt;</code></h2></div></div></div><div class="para">
				The majority of the many-to-many associations and collections of values shown previously all map to tables with composite keys, even though it has been have suggested that entities should have synthetic identifiers (surrogate keys). A pure association table does not seem to benefit much from a surrogate key, although a collection of composite values <span class="emphasis"><em>might</em></span>. It is for this reason that Hibernate provides a feature that allows you to map many-to-many associations and collections of values to a table with a surrogate key.
			</div><div class="para">
				The <code class="literal">&lt;idbag&gt;</code> element lets you map a <code class="literal">List</code> (or <code class="literal">Collection</code>) with bag semantics. For example:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;idbag</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lovers"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"LOVERS"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;collection-id</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"ID"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"long"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/collection-id&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON1"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"PERSON2"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Person"</span><span xmlns="" class="perl_Others"> fetch=</span><span xmlns="" class="perl_String">"join"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/idbag&gt;</span></pre><div class="para">
				An <code class="literal">&lt;idbag&gt;</code> has a synthetic id generator, just like an entity class. A different surrogate key is assigned to each collection row. Hibernate does not, however, provide any mechanism for discovering the surrogate key value of a particular row.
			</div><div class="para">
				The update performance of an <code class="literal">&lt;idbag&gt;</code> supersedes a regular <code class="literal">&lt;bag&gt;</code>. Hibernate can locate individual rows efficiently and update or delete them individually, similar to a list, map or set.
			</div><div class="para">
				In the current implementation, the <code class="literal">native</code> identifier generation strategy is not supported for <code class="literal">&lt;idbag&gt;</code> collection identifiers.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="collections-example">
      ⁠</a>6.4. Collection examples</h1></div></div></div><div class="para">
			This section covers collection examples.
		</div><div class="para">
			The following class has a collection of <code class="literal">Child</code> instances:
		</div><pre class="programlisting Java"><span xmlns="" class="line">​</span>package eg;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Set;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Parent {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">long</span> id;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set children;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">long</span> <span xmlns="" class="perl_Function">getId</span>() { <span xmlns="" class="perl_Keyword">return</span> id; }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setId</span>(<span xmlns="" class="perl_DataType">long</span> id) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">id</span>=id; }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Set <span xmlns="" class="perl_Function">getChildren</span>() { <span xmlns="" class="perl_Keyword">return</span> children; }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setChildren</span>(Set children) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">children</span>=children; }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>    ....
<span xmlns="" class="line">​</span>}</pre><div class="para">
			If each child has, at most, one parent, the most natural mapping is a one-to-many association:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
			This maps to the following table definitions:
		</div><pre class="programlisting">create table parent ( id bigint not null primary key )
create table child ( id bigint not null primary key, name varchar(255), parent_id bigint )
alter table child add constraint childfk0 (parent_id) references parent</pre><div class="para">
			If the parent is <span class="emphasis"><em>required</em></span>, use a bidirectional one-to-many association:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Others"> inverse=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;many-to-one</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"parent"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Others"> not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
			Notice the <code class="literal">NOT NULL</code> constraint:
		</div><pre class="programlisting">create table parent ( id bigint not null primary key )
create table child ( id bigint not null
                     primary key,
                     name varchar(255),
                     parent_id bigint not null )
alter table child add constraint childfk0 (parent_id) references parent</pre><div class="para">
			Alternatively, if this association must be unidirectional you can declare the <code class="literal">NOT NULL</code> constraint on the <code class="literal">&lt;key&gt;</code> mapping:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Others"> not-null=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;one-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
			On the other hand, if a child has multiple parents, a many-to-many association is appropriate:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;hibernate-mapping&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Parent"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;set</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"children"</span><span xmlns="" class="perl_Others"> table=</span><span xmlns="" class="perl_String">"childset"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;key</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"parent_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;many-to-many</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Others"> column=</span><span xmlns="" class="perl_String">"child_id"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/set&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;class</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Child"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;id</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;generator</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"sequence"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/id&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/class&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/hibernate-mapping&gt;</span></pre><div class="para">
			Table definitions:
		</div><pre class="programlisting">create table parent ( id bigint not null primary key )
create table child ( id bigint not null primary key, name varchar(255) )
create table childset ( parent_id bigint not null,
                        child_id bigint not null,
                        primary key ( parent_id, child_id ) )
alter table childset add constraint childsetfk0 (parent_id) references parent
alter table childset add constraint childsetfk1 (child_id) references child</pre><div class="para">
			For more examples and a complete explanation of a parent/child relationship mapping, see <a class="xref" href="example-parentchild.html">Chapter 21, <em>Example: Parent/Child</em></a> for more information.
		</div><div class="para">
			Even more complex association mappings are covered in the next chapter.
		</div></div></div></body></html>