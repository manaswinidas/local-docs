<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 8. Conversations and workspace management</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="conversations">
      ⁠</a>Chapter 8. Conversations and workspace management</h1></div></div></div><div class="para">
		Now we will take you through Seam's conversation model in finer detail.
	</div><div class="para">
		The notion of a Seam <span class="emphasis"><em>conversation</em></span> came about as a combination of three separate concepts:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				the concept of a <span class="emphasis"><em>workspace</em></span>, and effective workspace management.
			</div></li><li class="listitem"><div class="para">
				the concept of an <span class="emphasis"><em>application transaction</em></span> with optimistic semantics. Existing frameworks, based around a stateless architecture, were unable to provide effective management of extended persistence contexts.
			</div></li><li class="listitem"><div class="para">
				the concept of a workflow <span class="emphasis"><em>task</em></span>.
			</div></li></ul></div><div class="para">
		By unifying these ideas and providing deep support in the framework, we have created a powerful construct that allows for richer and more efficient applications, using less verbose code.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690454162032">
      ⁠</a>8.1. Seam's conversation model</h1></div></div></div><div class="para">
			All examples so far operate under a simple conversation model with the following rules:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					A conversation context is always active during the apply request values, process validation, update model values, invoke application and render response phases of the JSF request life cycle.
				</div></li><li class="listitem"><div class="para">
					At the end of the restore view phase of the JSF request life cycle, Seam attempts to restore any previous long-running conversation context. If none exists, Seam creates a new temporary conversation context.
				</div></li><li class="listitem"><div class="para">
					When a <code class="literal">@Begin</code> method is encountered, the temporary conversation context is promoted to a long-running conversation.
				</div></li><li class="listitem"><div class="para">
					When an <code class="literal">@End</code> method is encountered, any long-running conversation context is demoted to a temporary conversation.
				</div></li><li class="listitem"><div class="para">
					At the end of the render response phase of the JSF request life cycle, Seam either stores the contents of a long-running conversation context, or destroys the contents of a temporary conversation context.
				</div></li><li class="listitem"><div class="para">
					Any Faces request (a JSF postback) will propagate the conversation context. By default, non-Faces requests (GET requests, for example) do not propagate the conversation context.
				</div></li><li class="listitem"><div class="para">
					If the JSF request life cycle is foreshortened by a redirect, Seam transparently stores and restores the current conversation context, unless the conversation was already ended via <code class="literal">@End(beforeRedirect=true)</code>.
				</div></li></ul></div><div class="para">
			Seam transparently propagates the conversation context (including the temporary conversation context) across JSF postbacks and redirects. Without special additions, a <span class="emphasis"><em>non-Faces request</em></span> (a GET request, for example) will not propagate the conversation context, and will be processed in a new temporary conversation. This is usually — but not always — the desired behavior.
		</div><div class="para">
			To propagate a Seam conversation across a non-Faces request, the Seam <span class="emphasis"><em>conversation ID</em></span> must be explicitly coded as a request parameter:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"main.jsf?#{manager.conversationIdParameter}=#{conversation.id}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  Continue
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/a&gt;</span></pre><div class="para">
			Or, for JSF:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:outputLink</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"main.jsf"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{manager.conversationIdParameter}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     value=</span><span xmlns="" class="perl_String">"#{conversation.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Continue"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:outputLink&gt;</span></pre><div class="para">
			If you use the Seam tag library, this is equivalent:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:outputLink</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"main.jsf"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationId/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Continue"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:outputLink&gt;</span></pre><div class="para">
			The code to disable propagation of the conversation context for a postback is similar:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"main"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Exit"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"conversationPropagation"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"none"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span></pre><div class="para">
			The equivalent for the Seam tag library is:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"main"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Exit"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationPropagation</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"none"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Disabling conversation context propagation is <span class="emphasis"><em>not</em></span> the same as ending the conversation.
			</div></div></div><div class="para">
			The <code class="literal">conversationPropagation</code> request parameter or <code class="literal">&lt;s:conversationPropagation&gt;</code> tag can also be used to begin and end conversations, or to begin a nested conversation.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"main"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Exit"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationPropagation</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"end"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span></pre><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"main"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Select Child"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationPropagation</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"nested"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span></pre><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"main"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Select Hotel"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationPropagation</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"begin"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span></pre><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"main"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Select Hotel"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationPropagation</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"join"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span></pre><div class="para">
			This conversation model makes it easy to build applications which behave correctly with respect to multi-window operation. For many applications, this is all that is required. Some complex applications have one or both of the following additional requirements:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					A conversation spans many smaller units of user interaction, which execute serially or even concurrently. The smaller <span class="emphasis"><em>nested conversations</em></span> have their own isolated set of conversation state, and have access to the state of the outer conversation.
				</div></li><li class="listitem"><div class="para">
					The user can switch between many conversations within the same browser window. This feature is called <span class="emphasis"><em>workspace management</em></span>.
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690518354256">
      ⁠</a>8.2. Nested conversations</h1></div></div></div><div class="para">
			A nested conversation is created by invoking a method marked <code class="literal">@Begin(nested=true)</code> within the scope of an existing conversation. A nested conversation has its own conversation context, but can read values from the outer conversation's context. The outer conversation's context is read-only within a nested conversation, but because objects are obtained by reference, changes to the objects themselves will be reflected in the outer context.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Nesting a conversation initializes a context that is stacked on the context of the original, or outer, conversation. The outer conversation is considered the parent.
				</div></li><li class="listitem"><div class="para">
					Any values outjected or set directly into the nested conversation’s context do not affect the objects accessible in the parent conversation’s context.
				</div></li><li class="listitem"><div class="para">
					Injection, or a context look up from the conversation context, will first look up the value in the current conversation context. If no value is found, look up will continue down the conversation stack, if the conversation is nested. This behavior can be overridden.
				</div></li></ul></div><div class="para">
			When an <code class="literal">@End</code> is subsequently encountered, the nested conversation will be destroyed, and the outer conversation will resume, <span class="emphasis"><em>popping</em></span> the conversation stack. Conversations may be nested to any arbitrary depth.
		</div><div class="para">
			Certain user activities (workspace management, or the back button) can cause the outer conversation to be resumed before the inner conversation ends. In this case, it is possible to have multiple concurrent nested conversations belonging to the same outer conversation. If the outer conversation ends before a nested conversation ends, Seam destroys all nested conversation contexts along with the outer context.
		</div><div class="para">
			The conversation at the bottom of the conversation stack is the root conversation. Destroying this conversation will always destroy all descendant conversations. You can achieve this declaratively by specifying <code class="literal">@End(root=true)</code>.
		</div><div class="para">
			A conversation can be thought of as a <span class="emphasis"><em>continuable state</em></span>. Nested conversations allow the application to capture a consistent continuable state at various points in a user interaction, thus ensuring truly correct behavior in the face of backbuttoning and workspace management.
		</div><div class="para">
			As mentioned previously, if a component exists in a parent conversation of the current nested conversation, the nested conversation will use the same instance. Occasionally, it is useful to have a different instance in each nested conversation, so that the component instance that of the parent conversation is invisible to its child conversations. You can achieve this behavior by annotating the component <code class="literal">@PerNestedConversation</code>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690517416016">
      ⁠</a>8.3. Starting conversations with GET requests</h1></div></div></div><div class="para">
			JSF does not define any action listener triggered when a page is accessed via a non-Faces request (a HTTP GET request, for example). This can occur when a user bookmarks the page, or navigates to the page via an <code class="literal">&lt;h:outputLink&gt;</code>.
		</div><div class="para">
			Sometimes we want a conversation to begin immediately the page is accessed. Since there is no JSF action method, we cannot annotate the action with <code class="literal">@Begin</code>.
		</div><div class="para">
			Further problems arise when the page requires state to be fetched into a context variable. We have already seen two methods of solving this problem. If the state is held in a Seam component, we can fetch the state in a <code class="literal">@Create</code> method. If not, we can define a <code class="literal">@Factory</code> method for the context variable.
		</div><div class="para">
			If neither option works for you, Seam lets you define a <span class="emphasis"><em>page action</em></span> in the <code class="filename">pages.xml</code> file.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/messageList.jsp"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{messageManager.list}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div class="para">
			This action method is called at the beginning of the render response phase — that is, any time the page is about to be rendered. If a page action returns a non-null outcome, Seam will process any appropriate JSF and Seam navigation rules. This can result in a completely different page rendering.
		</div><div class="para">
			If beginning a conversation is <span class="emphasis"><em>all</em></span> you want to do before rendering the page, you can use a built-in action method:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/messageList.jsp"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{conversation.begin}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div class="para">
			You can also call this built-in action from a JSF control, and that <code class="literal">#{conversation.end}</code> similarly ends conversations.
		</div><div class="para">
			The <code class="literal">&lt;begin-conversation&gt;</code> element can be used as follows for further control over joining existing conversations, or beginning a nested conversation, a pageflow, or an atomic conversation.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/messageList.jsp"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;begin-conversation</span><span xmlns="" class="perl_Others"> nested=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> pageflow=</span><span xmlns="" class="perl_String">"AddItem"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page&gt;</span> 
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div class="para">
			There is also an <code class="literal">&lt;end-conversation&gt;</code> element.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/home.jsp"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;end-conversation/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page&gt;</span> 
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div class="para">
			We now have five options to begin a conversation immediately the page is accessed:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Annotate the <code class="literal">@Create</code> method with <code class="literal">@Begin</code>
				</div></li><li class="listitem"><div class="para">
					Annotate the <code class="literal">@Factory</code> method with <code class="literal">@Begin</code>
				</div></li><li class="listitem"><div class="para">
					Annotate the Seam page action method with <code class="literal">@Begin</code>
				</div></li><li class="listitem"><div class="para">
					Use <code class="literal">&lt;begin-conversation&gt;</code> in <code class="filename">pages.xml</code>.
				</div></li><li class="listitem"><div class="para">
					Use <code class="literal">#{conversation.begin}</code> as the Seam page action method
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="conversations.required">
      ⁠</a>8.4. Requiring a long-running conversation</h1></div></div></div><div class="para">
			Certain pages are only relevant in the context of a long-running conversation. One way to restrict access to such a page is to make the existence of a long-running conversation a prerequisite to the page being rendered.
		</div><div class="para">
			Seam's page descriptor has a <code class="literal">conversation-required</code> attribute, which lets you indicate that the current conversation must be long-running (or nested) in order for a page to be rendered, like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/book.xhtml"</span><span xmlns="" class="perl_Others"> conversation-required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				At present, you cannot indicate which long-running conversation is required. However, you can build on the basic authorization by checking whether a specific value is also present in the conversation within a page action.
			</div></div></div><div class="para">
			When Seam determines that the page has been requested while no long-running conversation is present, it performs the following actions:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					raises a contextual event called <code class="literal">org.jboss.seam.noConversation</code>
				</div></li><li class="listitem"><div class="para">
					registers a warning status message with the bundle key, <code class="literal">org.jboss.seam.NoConversation</code>
				</div></li><li class="listitem"><div class="para">
					redirects the user to an alternative page, if defined in the <code class="literal">no-conversation-view-id</code> attribute, like so:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages</span><span xmlns="" class="perl_Others"> no-conversation-view-id=</span><span xmlns="" class="perl_String">"/main.xhtml"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
					This page will be used across the entire application; at present, multiple alternative pages cannot be defined.
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690493848768">
      ⁠</a>8.5. Using <code class="literal">&lt;s:link&gt;</code> and <code class="literal">&lt;s:button&gt;</code></h1></div></div></div><div class="para">
			JSF command links always perform a form submission with JavaScript, which causes problems with the web browser's "open in new window" or "open in new tab" feature. If you require this functionality in plain JSF, you need to use an <code class="literal">&lt;h:outputLink&gt;</code>, but there are two major limitations to this method:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					JSF provides no way to attach an action listener to an <code class="literal">&lt;h:outputLink&gt;</code>, and
				</div></li><li class="listitem"><div class="para">
					JSF does not propagate the selected row of a <code class="literal">DataModel</code>, since there is no actual form submission.
				</div></li></ul></div><div class="para">
			To solve the first problem, Seam implements the notion of a <span class="emphasis"><em>page action</em></span>, but this does not solve the second. It is possible to work around this by passing a request parameter and requerying for the selected object on the server-side, and in some cases (like the Seam blog example application), this is the best approach. Since it is RESTful and does not require server-side state, bookmarking is supported. In other cases, where bookmarking is unnecessary, <code class="literal">@DataModel</code> and <code class="literal">@DataModelSelection</code> are transparent and convenient.
		</div><div class="para">
			To replace this missing functionality, and to simplify conversation propagation further, Seam provides the <code class="literal">&lt;s:link&gt;</code> JSF tag.
		</div><div class="para">
			The link can specify only the JSF ID:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/login.xhtml"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Login"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			It can also specify an action method, in which case the action outcome determines the page that results:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{login.logout}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Logout"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			If both a JSF view ID and an action method are specified, the view will be used unless the action method returns a non-null outcome:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/loggedOut.xhtml"</span><span xmlns="" class="perl_Others">  action=</span><span xmlns="" class="perl_String">"#{login.logout}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Logout"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			The link automatically propagates the selected row of a <code class="literal">DataModel</code> inside <code class="literal">&lt;h:dataTable&gt;</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/hotel.xhtml"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{hotelSearch.selectHotel}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   value=</span><span xmlns="" class="perl_String">"#{hotel.name}"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			You can leave the scope of an existing conversation:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/main.xhtml"</span><span xmlns="" class="perl_Others"> propagation=</span><span xmlns="" class="perl_String">"none"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			You can begin, end, or nest conversations:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{issueEditor.viewComment}"</span><span xmlns="" class="perl_Others"> propagation=</span><span xmlns="" class="perl_String">"nest"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			If the link begins a conversation, you can specify the use of a particular pageflow:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{documentEditor.getDocument}"</span><span xmlns="" class="perl_Others"> propagation=</span><span xmlns="" class="perl_String">"begin"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   pageflow=</span><span xmlns="" class="perl_String">"EditDocument"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			The <code class="literal">taskInstance</code> attribute is for use in jBPM task lists, as follows. See <a class="xref" href="tutorial.html#dvdstore">Section 1.8, “A complete application featuring Seam and jBPM: the DVD Store example”</a> for an example.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{documentApproval.approveOrReject}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   taskInstance=</span><span xmlns="" class="perl_String">"#{task}"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			Finally, use <code class="literal">&lt;s:button&gt;</code> if you want the "link" rendered as a button:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:button</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{login.logout}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Logout"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690510896128">
      ⁠</a>8.6. Success messages</h1></div></div></div><div class="para">
			Messages are commonly displayed to the user to indicate the success or failure of an action. A JSF <code class="literal">FacesMessage</code> is convenient for this function. However, a successful action often requires a browser redirect. Since JSF does not propagate Faces messages across redirects, it is difficult to display success messages in plain JSF.
		</div><div class="para">
			The built-in conversation-scoped Seam component named <code class="literal">facesMessages</code> solves this problem. (This requires the Seam redirect filter.)
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"editDocumentAction"</span>) 
<span xmlns="" class="line">​</span>@Stateless 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EditDocumentBean <span xmlns="" class="perl_Keyword">implements</span> EditDocument { 
<span xmlns="" class="line">​</span>    @In EntityManager em; 
<span xmlns="" class="line">​</span>    @In Document document; 
<span xmlns="" class="line">​</span>    @In FacesMessages facesMessages; 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">update</span>() { 
<span xmlns="" class="line">​</span>        em.<span xmlns="" class="perl_Function">merge</span>(document); 
<span xmlns="" class="line">​</span>        facesMessages.<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"Document updated"</span>);  
<span xmlns="" class="line">​</span>    } 
<span xmlns="" class="line">​</span>}</pre><div class="para">
			When a message is added to <code class="literal">facesMessages</code>, it is used in the nextg render response phase for the current conversation. Since Seam preserves even temporary conversation contexts across redirects, this works even without a long-running conversation.
		</div><div class="para">
			You can even include JSF EL expressions in a Faces message summary:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>facesMessages.<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"Document #{document.title} was updated"</span>);</pre><div class="para">
			Messages are displayed as usual:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:messages</span><span xmlns="" class="perl_Others"> globalOnly=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690505555664">
      ⁠</a>8.7. Natural conversation IDs</h1></div></div></div><div class="para">
			When working with conversations that deal with persistent objects, there are several reasons to use the natural business key of the object instead of the standard, "surrogate" conversation ID.
		</div><div class="para">
			<span class="emphasis"><em>Easy redirect to existing conversation</em></span>
		</div><div class="para">
			If the user requests the same operation twice, it can be useful to redirect to an existing conversation. Take the following situation, for example:
		</div><div class="para">
			You are on Ebay, halfway through paying for an item you won as a Christmas present for your parents. You want to send it straight to them, but once you have entered your payment details, you cannot remember your parents' address. While you find the address, you accidentally reuse the same browser window, but now you need to return to payment for the item.
		</div><div class="para">
			With a natural conversation, the user can easily rejoin the previous conversation and pick up where they left off. In this case, they can rejoin the payForItem conversation with the itemId as the conversation ID.
		</div><div class="para">
			<span class="emphasis"><em>User-friendly URLs</em></span>
		</div><div class="para">
			A user-friendly URL is meaningful (refers to page contents plainly, without using ID numbers), and has a navigable heirarchy (that is, the user can navigate by editing the URL).
		</div><div class="para">
			With a natural conversation, applications can generate long, complex URLs, but display simple, memorable URLs to users by using URLRewrite. In the case of our hotel booking example, <code class="literal">http://seam-hotels/book.seam?hotel=BestWesternAntwerpen</code> is rewritten as <code class="literal">http://seam-hotels/book/BestWesternAntwerpen</code> — much clearer. Note that URLRewrite relies upon parameters: <code class="literal">hotel</code> in the previous example must map to a unique parameter on the domain model.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690473428160">
      ⁠</a>8.8. Creating a natural conversation</h1></div></div></div><div class="para">
			Natural conversations are defined in <code class="filename">pages.xml</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;conversation</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PlaceBid"</span><span xmlns="" class="perl_Others"> parameter-name=</span><span xmlns="" class="perl_String">"auctionId"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              parameter-value=</span><span xmlns="" class="perl_String">"#{auction.auctionId}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			The first thing to note in the above definition is the conversation name, in this case <code class="literal">PlaceBid</code>. The conversation name identifies this particular named conversation uniquely, and is used by the <code class="literal">page</code> definition to identify a named conversation in which to participate.
		</div><div class="para">
			The <code class="literal">parameter-name</code> attribute defines the request parameter that will hold the natural conversation ID, and replace the default conversation ID parameter. In this case, <code class="literal">parameter-name</code> is <code class="literal">auctionId</code>. This means that the URL of your page will contain <code class="literal">auctionId=765432</code> instead of a conversation parameter like <code class="literal">cid=123</code>.
		</div><div class="para">
			The final attribute, <code class="literal">parameter-value</code>, defines an EL expression to evaluate the value of the natural business key to use as the conversation ID. In this example, the conversation ID will be the primary key value of the <code class="literal">auction</code> instance currently in scope.
		</div><div class="para">
			Next, we define the pages participating in the named conversation. This is done by specifying the <code class="literal">conversation</code> attribute for a <code class="literal">page</code> definition:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/bid.xhtml"</span><span xmlns="" class="perl_Others"> conversation=</span><span xmlns="" class="perl_String">"PlaceBid"</span><span xmlns="" class="perl_Others"> login-required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;navigation</span><span xmlns="" class="perl_Others"> from-action=</span><span xmlns="" class="perl_String">"#{bidAction.confirmBid}"</span><span xmlns="" class="perl_Keyword">&gt;</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rule</span><span xmlns="" class="perl_Others"> if-outcome=</span><span xmlns="" class="perl_String">"success"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/auction.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{bidAction.bid.auction.auctionId}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/redirect&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/rule&gt;</span>        
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/navigation&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/page&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690529909056">
      ⁠</a>8.9. Redirecting to a natural conversation</h1></div></div></div><div class="para">
			When initiating or redirecting to a natural conversation, there are several ways to specify the natural conversation name. We will start with the following page definition:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/auction.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"id"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{auctionDetail.selectedAuctionId}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;navigation</span><span xmlns="" class="perl_Others"> from-action=</span><span xmlns="" class="perl_String">"#{bidAction.placeBid}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/bid.xhtml"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/navigation&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/page&gt;</span></pre><div class="para">
			Here we see that invoking <code class="literal">#{bidAction.placeBid}</code> redirects us to <code class="filename">/bid.xhtml</code>, which is configured with the natural conversation ID <code class="literal">PlaceBid</code>. Our action method declaration looks like this:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Begin</span>(join = <span xmlns="" class="perl_Keyword">true</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">placeBid</span>()</pre><div class="para">
			When named conversations are specified in the <code class="literal">&lt;page/&gt;</code> element, redirection to the named conversation occurs as part of navigation rules following the invocation of the action method. This can cause problems when redirecting to an existing conversation, since redirection needs to occur before the action method is invoked. Therefore, the conversation name must be specified before the action is invoked. One method of doing this uses the <code class="literal">&lt;s:conversationName&gt;</code> tag:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"placeBidWithAmount"</span><span xmlns="" class="perl_Others"> styleClass=</span><span xmlns="" class="perl_String">"placeBid"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   action=</span><span xmlns="" class="perl_String">"#{bidAction.placeBid}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:conversationName</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"PlaceBid"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:commandButton&gt;</span></pre><div class="para">
			You can also specify the <code class="literal">conversationName</code> attribute for either the <code class="literal">s:link</code> or <code class="literal">s:button</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Place Bid"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{bidAction.placeBid}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   conversationName=</span><span xmlns="" class="perl_String">"PlaceBid"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690457781104">
      ⁠</a>8.10. Workspace management</h1></div></div></div><div class="para">
			Workspace management is the ability to "switch" conversations in a single window. Seam workspace management is completely transparent at the Java level. To enable workspace management:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Provide <span class="emphasis"><em>description</em></span> text for each view ID (when using JSF or Seam navigation rules) or page node (when using jPDL pageflows). Workspace switchers display this description text to the user.
				</div></li><li class="listitem"><div class="para">
					Include one or more workspace switcher JSP or Facelets fragments in your page. Standard fragments support workspace management via a drop-down menu and a list of conversations, or "breadcrumbs".
				</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690519212432">
      ⁠</a>8.10.1. Workspace management and JSF navigation</h2></div></div></div><div class="para">
				With JSF or Seam navigation rules in place, Seam switches to a conversation by restoring the current <code class="literal">view-id</code> for that conversation. The descriptive text for the workspace is defined in a file called <code class="filename">pages.xml</code>, which Seam expects to find in the <code class="literal">WEB-INF</code> directory alongside <code class="filename">faces-config.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/main.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Search hotels: #{hotelBooking.searchString}<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/hotel.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>View hotel: #{hotel.name}<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/book.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Book hotel: #{hotel.name}<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/confirm.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Confirm: #{booking.description}<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The Seam application will still work if this file is not present. However, workplace switching will not be available.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690501698352">
      ⁠</a>8.10.2. Workspace management and jPDL pageflow</h2></div></div></div><div class="para">
				When a jPDL pageflow definition is in place, Seam switches to a particular conversation by restoring the current jBPM process state. This is a more flexible model, since it allows the same <code class="literal">view-id</code> to have different descriptions depending on the current <code class="literal">&lt;page&gt;</code> node. The description text is defined by the <code class="literal">&lt;page&gt;</code> node:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pageflow-definition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"shopping"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;start-state</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"start"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"browse"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/start-state&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"browse"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/browse.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>DVD Search: #{search.searchPattern}<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"browse"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"checkout"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"checkout"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"checkout"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/checkout.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;description&gt;</span>Purchase: $#{cart.total}<span xmlns="" class="perl_Keyword">&lt;/description&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"checkout"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"complete"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"complete"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"complete"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/complete.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;end-conversation</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pageflow-definition&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690529268656">
      ⁠</a>8.10.3. The conversation switcher</h2></div></div></div><div class="para">
				Including the following fragment in your JSP or Facelets page will include a drop-down menu that lets you switch to any current conversation, or any other page of the application:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:selectOneMenu</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{switcher.conversationIdOrOutcome}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:selectItem</span><span xmlns="" class="perl_Others"> itemLabel=</span><span xmlns="" class="perl_String">"Find Issues"</span><span xmlns="" class="perl_Others"> itemValue=</span><span xmlns="" class="perl_String">"findIssue"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:selectItem</span><span xmlns="" class="perl_Others"> itemLabel=</span><span xmlns="" class="perl_String">"Create Issue"</span><span xmlns="" class="perl_Others"> itemValue=</span><span xmlns="" class="perl_String">"editIssue"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:selectItems</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{switcher.selectItems}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:selectOneMenu&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{switcher.select}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Switch"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
				This example includes a menu that contains an item for each conversation, plus two additional items that let the user begin an additional conversation.
			</div><div class="para">
				Only conversations with a description (specified in <code class="filename">pages.xml</code>) will be included in the drop-down menu.
			</div><div class="mediaobject" style="text-align: center"><img src="images/switcher.png" align="middle" alt="The conversation switcher" style="text-align: middle"/></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690462705968">
      ⁠</a>8.10.4. The conversation list</h2></div></div></div><div class="para">
				The conversation list is similar to the conversation switcher, except that it is displayed as a table:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{conversationList}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"entry"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   rendered=</span><span xmlns="" class="perl_String">"#{not empty conversationList}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Workspace<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{entry.select}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{entry.description}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"[current]"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{entry.current}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Activity<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{entry.startDatetime}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"time"</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"hh:mm a"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">" - "</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{entry.lastDatetime}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"time"</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"hh:mm a"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Action<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{entry.select}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{msg.Switch}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{entry.destroy}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{msg.Destroy}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span></pre><div class="para">
				This can be customized for your own applications.
			</div><div class="mediaobject" style="text-align: center"><img src="images/list.png" align="middle" alt="The conversation list" style="text-align: middle"/></div><div class="para">
				Only conversations with a description will be included in the list.
			</div><div class="para">
				Note that the conversation list also lets the user destroy workspaces.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690464598448">
      ⁠</a>8.10.5. Breadcrumbs</h2></div></div></div><div class="para">
				Breadcrumbs are a list of links to conversations in the current conversation stack. They are useful for applications with a nested conversation model:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ui:repeat</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{conversationStack}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"entry"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">" | "</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{entry.description}"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{entry.select}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ui:repeat&gt;</span></pre><div class="mediaobject" style="text-align: center"><img src="images/breadcrumbs.png" align="middle" alt="Breadcrumbs" style="text-align: middle"/></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690454850464">
      ⁠</a>8.11. Conversational components and JSF component bindings</h1></div></div></div><div class="para">
			Conversational components have one minor limitation: they cannot be used to hold bindings to JSF components. (Generally we recommend avoiding this feature of JSF unless absolutely necessary, since it creates a hard dependency from application logic to the view.) On a postback request, component bindings are updated during the Restore View phase, before the Seam conversation context has been restored.
		</div><div class="para">
			You can work around this by storing component bindings with an event-scoped component, and injecting this into the requiring conversation-scoped component.
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"grid"</span>) 
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(ScopeType.<span xmlns="" class="perl_Function">EVENT</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Grid { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> HtmlPanelGrid htmlPanelGrid; <span xmlns="" class="perl_Comment">// getters and setters </span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">... </span>
<span xmlns="" class="line">​</span>}</pre><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"gridEditor"</span>) 
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(ScopeType.<span xmlns="" class="perl_Function">CONVERSATION</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> GridEditor { 
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>) 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Grid grid; 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">... </span>
<span xmlns="" class="line">​</span>}</pre><div class="para">
			You are also limited in that a conversation-scoped component cannot be injected into an event-scoped component with a JSF control bound to it. This includes Seam built-in components like <code class="literal">facesMessages</code>.
		</div><div class="para">
			You can also access the JSF component tree with the implicit <code class="literal">uiComponent</code> handle. The following example accesses the <code class="literal">getRowIndex()</code> of the <code class="literal">UIData</code> component that backs the data table during iteration, and prints the current row number:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"lineItemTable"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"lineItem"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   value=</span><span xmlns="" class="perl_String">"#{orderHome.lineItems}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span> 
<span xmlns="" class="line">​</span>    Row: #{uiComponent[<span xmlns="" class="perl_DecVal">&amp;#39;</span>lineItemTable<span xmlns="" class="perl_DecVal">&amp;#39;</span>].rowIndex} 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span> 
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span></pre><div class="para">
			In this map, JSF UI components are available with their client identifier.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690450705216">
      ⁠</a>8.12. Concurrent calls to conversational components</h1></div></div></div><div class="para">
			<a class="xref" href="concepts.html#concurrency">Section 5.1.10, “Concurrency model”</a> contains a general discussion of concurrent calls to Seam components. In this section, we discuss the most common situation in which you will encounter concurrency — when accessing conversational components from AJAX requests. We will also look at the options provided by an AJAX client library, and RichFaces, to control events originating from the client.
		</div><div class="para">
			Conversational components do not allow true concurrent access, so Seam queues each request for serial processing. This allows each request to be executed in a deterministic fashion. However, there are some limitations to a simple queue. If a method, for whatever reason, takes a long time to complete, running it whenever the client generates a request can lead to Denial of Service attacks. AJAX is also often used to provide quick status updates to users, so continuing to run an action after a long time is not useful.
		</div><div class="para">
			Therefore, when you work inside a long-running conversation, Seam queues the action even for a period of time (the concurrent request timeout). If Seam cannot process the event before timeout, it creates a temporary conversation and prints a message for the user, informing them of the timeout. It is therefore important not to flood the server with AJAX events.
		</div><div class="para">
			We can set a sensible default for the concurrent request timeout (in milliseconds) in components.xml:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;core:manager</span><span xmlns="" class="perl_Others"> concurrent-request-timeout=</span><span xmlns="" class="perl_String">"500"</span> <span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
			The concurrent request timeout can also be adjusted on a page-by-page basis:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/book.xhtml"</span><span xmlns="" class="perl_Others"> conversation-required=</span><span xmlns="" class="perl_String">"true"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      login-required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> concurrent-request-timeout=</span><span xmlns="" class="perl_String">"2000"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			So far we have discussed AJAX requests that appear serial to the user, where the client tells the server than an event has occurred, and then rerenders part of the page based on the result. This approach is sufficient when the AJAX request is lightweight (the methods called are simple, for example, calculating the sum of a column of numbers), but complex computations require a different approach.
		</div><div class="para">
			A poll-based approach is where the client sends an AJAX request to the server, causing actions to begin immediate asynchronous execution on the server. The client then polls the server for updates while the actions are executed. This is a sensible approach when it is important that no action in a long-running action sequence times out.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690515591712">
      ⁠</a>8.12.1. How should we design our conversational AJAX application?</h2></div></div></div><div class="para">
				The first question is whether to use the simpler "serial" request method, or a polling approach.
			</div><div class="para">
				If you want to use <span class="emphasis"><em>serial</em></span> requests, you must estimate the time required for your request to complete. You may need to alter the concurrent request timeout for this page, as discussed in the previous section. A queue on the server side is probably necessary, to prevent requests from flooding the server. If the event occurs often (for example, a keystroke, or onblur of input fields) and immediate client update is not a priority, set a request delay on the client side. Remember to factor the possibility of server-side queueing into your request delay.
			</div><div class="para">
				Finally, the client library may provide an option to abort unfinished duplicate requests in favor of the most recent.
			</div><div class="para">
				A polling approach requires less fine-tuning — simply mark your action method <code class="literal">@Asynchronous</code> and decide on a polling interval:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">int</span> total; 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// This method is called when an event occurs on the client </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// It takes a really long time to execute </span>
<span xmlns="" class="line">​</span>@Asynchronous
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">calculateTotal</span>() { 
<span xmlns="" class="line">​</span>    total = <span xmlns="" class="perl_Function">someReallyComplicatedCalculation</span>(); 
<span xmlns="" class="line">​</span>} 
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// This method is called as the result of the poll </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">// It's very quick to execute    </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getTotal</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> total; 
<span xmlns="" class="line">​</span>}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690530782480">
      ⁠</a>8.12.2. Dealing with errors</h2></div></div></div><div class="para">
				However carefully your application is designed to queue concurrent requests to your conversational component, there is a risk that the server will overload. When overload occurs, not all requests will be processed before the <code class="literal">concurrent-request-timeout</code> period expires. In this case, Seam throws a <code class="exceptionname">ConcurrentRequestTimeoutException</code>, which is handled in <code class="filename">pages.xml</code>. We recommend sending a HTTP 503 error:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;exception</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.seam.ConcurrentRequestTimeoutException"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           log-level=</span><span xmlns="" class="perl_String">"trace"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;http-error</span><span xmlns="" class="perl_Others"> error-code=</span><span xmlns="" class="perl_String">"503"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/exception&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>503 Service Unavailable (HTTP/1.1 RFC)</strong></p></div><div class="admonition"><div class="para">
					The server is currently unable to handle the request due to a temporary overloading or maintenance of the server. The implication is that this is a temporary condition which will be alleviated after some delay.
				</div></div></div><div class="para">
				Alternatively you could redirect to an error page:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;exception</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.seam.ConcurrentRequestTimeoutException"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           log-level=</span><span xmlns="" class="perl_String">"trace"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;end-conversation/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/error.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;message&gt;</span>
<span xmlns="" class="line">​</span>      The server is too busy to process your request, 
<span xmlns="" class="line">​</span>      please try again later
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/message&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/redirect&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/exception&gt;</span></pre><div class="para">
				ICEfaces, RichFaces AJAX and Seam Remoting can all handle HTTP error codes. Seam Remoting will pop up a dialog box showing the HTTP error. ICEfaces will indicate the error in its connection status component. RichFaces provides the most complete support for handling HTTP errors by providing a user definable callback. For example, to show the error message to the user:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;script</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"text/javascript"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  A4J.AJAX.onError = function(req,status,message) { 
<span xmlns="" class="line">​</span>    alert("An error occurred"); 
<span xmlns="" class="line">​</span>  }; 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/script&gt;</span></pre><div class="para">
				If, rather than an error code, the server reports that the view has expired, perhaps because a session timed out, use a separate callback function in RichFaces:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;script</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"text/javascript"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  A4J.AJAX.onExpired = function(loc,message) { 
<span xmlns="" class="line">​</span>    alert("View expired"); 
<span xmlns="" class="line">​</span>  }; 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/script&gt;</span></pre><div class="para">
				Alternatively, you can allow RichFaces to handle the error. In this case, the user will receive a prompt reading, "View state could not be restored — reload page?" This message can be globally customized by setting the following message key in an application resource bundle:
			</div><pre class="screen">AJAX_VIEW_EXPIRED=View expired. Please reload the page.</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690515973552">
      ⁠</a>8.12.3. RichFaces (Ajax4jsf)</h2></div></div></div><div class="para">
				RichFaces (Ajax4jsf) is the most common AJAX library used with Seam, and provides all of the controls discussed in the previous section.
			</div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">eventsQueue</code></span></dt><dd><div class="para">
							Provides a queue in which events are placed. All events are queued, and requests are sent to the server serially. This is useful if the request to the server can take some time to execute (for example, in heavy computation, retrieving information from a slow source) since it prevents server flooding.
						</div></dd><dt><span class="term"><code class="literal">ignoreDupResponses</code></span></dt><dd><div class="para">
							Ignores the response produced by a request if a more recent "similar" request is already queued. <code class="literal">ignoreDupResponses="true"</code> does <span class="emphasis"><em>not</em></span> cancel the processing of the request on the server side; it only prevents unnecessary updates on the client side.
						</div><div class="para">
							With Seam conversations, this option should be used with care, since it allows multiple concurrent requests.
						</div></dd><dt><span class="term"><code class="literal">requestDelay</code></span></dt><dd><div class="para">
							Defines the time in milliseconds that the request will remain on the queue. If, at this time, the request has not been processed, the request will either be sent (regardless of whether a response has been received), or discarded (if there is a more recent "similar" event queued).
						</div><div class="para">
							With Seam conversations, this option should be used with care, as it allows multiple concurrent requests. The delay that you set (in combination with the concurrent request timeout) must be longer than the action will take to execute.
						</div></dd><dt><span class="term"><code class="literal">&lt;a:poll reRender="total" interval="1000" /&gt;</code></span></dt><dd><div class="para">
							Polls the server and rerenders an area, as required.
						</div></dd></dl></div></div></div></div></body></html>