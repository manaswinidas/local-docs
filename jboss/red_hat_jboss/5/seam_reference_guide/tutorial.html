<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 1. Seam Tutorial</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="tutorial">
      ⁠</a>Chapter 1. Seam Tutorial</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="try-examples">
      ⁠</a>1.1. Using the Seam examples</h1></div></div></div><div class="para">
			Seam provides a number of example applications which demonstrate how to use a variety of Seam's features. This tutorial will guide you through a few of those examples to help you get started learning Seam. The Seam examples are located in the <code class="filename">examples</code> subdirectory of the Seam distribution. The first example, on registration, is in the <code class="filename">examples/registration</code> directory.
		</div><div class="para">
			Each example has the same directory structure:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					The <code class="filename">view</code> directory contains view-related files such as web page templates, images and stylesheets.
				</div></li><li class="listitem"><div class="para">
					The <code class="filename">resources</code> directory contains deployment descriptors and other configuration files.
				</div></li><li class="listitem"><div class="para">
					The <code class="filename">src</code> directory contains the application source code.
				</div></li></ul></div><div class="para">
			Note that all examples are built and run from the Ant <code class="filename">build.xml</code>, so you will need a recent version of Ant installed before you get started.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690453633328">
      ⁠</a>1.1.1. Running the examples on JBoss Enterprise Application Platform</h2></div></div></div><div class="para">
				The examples are configured for use on JBoss Enterprise Application Platform. You will need to set <code class="literal">jboss.home</code>, in the shared <code class="filename">build.properties</code> file (in the root folder of your Seam installation) to the location of your JBoss Enterprise Application Platform installation.
			</div><div class="para">
				Once you have set the location of JBoss Enterprise Application Platform and started the application server, you can build and deploy any example by typing <code class="literal">ant explode</code> in that example's directory. Any example that is packaged as an EAR (Enterprise Archive) deploys to a URL like <code class="literal">/seam-<em class="replaceable">example</em></code>, where <em class="replaceable">example</em> is the name of the example folder, with one exception: if the example folder begins with "seam", the prefix "seam" is omitted. For instance, if JBoss Enterprise Application Platform is running on port 8080, the URL for the Registration example is <a href="http://localhost:8080/seam-registration/"> <code class="literal">http://localhost:8080/seam-registration/</code></a>, whereas the URL for the SeamSpace example is <a href="http://localhost:8080/seam-space/"> <code class="literal">http://localhost:8080/seam-space/</code></a>.
			</div><div class="para">
				If, on the other hand, the example is packaged as a WAR, then it deploys to a URL like <code class="literal">/jboss-seam-<em class="replaceable">example</em></code>. 
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Several of the examples — groovybooking, hibernate, jpa, and spring — can only be deployed as a WAR.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690502892512">
      ⁠</a>1.1.2. Running the example tests</h2></div></div></div><div class="para">
				Most of the examples come with a suite of TestNG integration tests. The easiest way to run the tests is to run <code class="literal">ant test</code>.
			</div><div class="para">
				It is also possible to run the tests inside your IDE using the TestNG plug-in. This requires you to run ant test before running or debugging Seam test cases in JBoss Developer Studio. Consult the <code class="filename">readme.txt</code> in the examples directory of the Seam distribution for more information.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="registration-example">
      ⁠</a>1.2. Your first Seam application: the registration example</h1></div></div></div><div class="para">
			The registration example is a simple application that lets a new user store their username, real name, and password in the database. This example uses only basic functions to demonstrate the use of an EJB3 session bean as a JSF action listener, and the basic configuration of Seam.
		</div><div class="para">
			The start page displays a basic form with three input fields. Filling them in and submitting the form will save a user object in the database.
		</div><div class="mediaobject" style="text-align: center"><img src="images/registration.png" align="middle" alt="Your first Seam application: the registration example" style="text-align: middle"/></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690531478432">
      ⁠</a>1.2.1. Understanding the code</h2></div></div></div><div class="para">
				The example is implemented with two Facelets templates: one entity bean, and one stateless session bean. This section will take you through the code in detail, starting from the base level.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690531476976">
      ⁠</a>1.2.1.1. The entity bean: <code class="literal">User.java</code></h3></div></div></div><div class="para">
					We need an EJB entity bean for user data. This class defines <span class="emphasis"><em>persistence</em></span> and <span class="emphasis"><em>validation</em></span> declaratively, via annotations. It also requires some extra annotations to define the class as a Seam component.
				</div><div class="example"><a id="idm139690454767088">
      ⁠</a><p class="title"><strong>Example 1.1. User.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity                                             <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"user"</span>)                                       <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(SESSION)                                     <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Table</span>(name=<span xmlns="" class="perl_String">"users"</span>)                                <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> User <span xmlns="" class="perl_Keyword">implements</span> Serializable
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> <span xmlns="" class="perl_DataType">long</span> serialVersionUID =
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Float">1881413500711441951</span>L;
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String username;                        <img class="callout" alt="5" src="Common_Content/images/5.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String password;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String name;
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">User</span>(String name,
<span xmlns="" class="line">​</span>                String password,
<span xmlns="" class="line">​</span>                String username)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">name</span> = name;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">password</span> = password;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">username</span> = username;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">User</span>() {}                                <img class="callout" alt="6" src="Common_Content/images/6.png"/>
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    @NotNull @<span xmlns="" class="perl_Function">Length</span>(min=<span xmlns="" class="perl_Float">5</span>, max=<span xmlns="" class="perl_Float">15</span>)                 <img class="callout" alt="7" src="Common_Content/images/7.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getPassword</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> password;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setPassword</span>(String password)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">password</span> = password;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    @NotNull
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getName</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> name;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setName</span>(String name)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">name</span> = name;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    @Id @NotNull @<span xmlns="" class="perl_Function">Length</span>(min=<span xmlns="" class="perl_Float">5</span>, max=<span xmlns="" class="perl_Float">15</span>)             <img class="callout" alt="8" src="Common_Content/images/8.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getUsername</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> username;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUsername</span>(String username)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">username</span> = username;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
									The EJB3 standard <code class="literal">@Entity</code> annotation indicates that the <code class="literal">User</code> class is an entity bean.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
									A Seam component needs a <span class="emphasis"><em>component name</em></span> specified by the <code class="literal">@Name</code> annotation. This name must be unique within the Seam application. When JSF asks Seam to resolve a context variable with a name that is the same as a Seam component name, and the context variable is currently undefined (null), Seam will instantiate that component, and bind the new instance to the context variable. In this case, Seam will instantiate a <code class="literal">User</code> the first time JSF encounters a variable named <code class="literal">user</code>.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
									Whenever Seam instantiates a component, it binds the new instance to a context variable in the component's <span class="emphasis"><em>default context</em></span>. The default context is specified using the <code class="literal">@Scope</code> annotation. The <code class="literal">User</code> bean is a session scoped component.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
									The EJB standard <code class="literal">@Table</code> annotation indicates that the <code class="literal">User</code> class is mapped to the <code class="literal">users</code> table.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
									<code class="literal">name</code>, <code class="literal">password</code> and <code class="literal">username</code> are the persistent attributes of the entity bean. All of our persistent attributes define accessor methods. These are needed when this component is used by JSF in the render response and update model values phases.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/6.png" alt="6"/></p></td><td valign="top" align="left"><div class="para">
									An empty constructor is required by both the EJB specification and Seam.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/7.png" alt="7"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">@NotNull</code> and <code class="literal">@Length</code> annotations are part of the Hibernate Validator framework. Seam integrates Hibernate Validator and lets you use it for data validation (even if you are not using Hibernate for persistence).
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/8.png" alt="8"/></p></td><td valign="top" align="left"><div class="para">
									The EJB standard <code class="literal">@Id</code> annotation indicates the primary key attribute of the entity bean.
								</div></td></tr></table></div></div></div></div><div class="para">
					The most important things to notice in this example are the <code class="literal">@Name</code> and <code class="literal">@Scope</code> annotations. These annotations establish that this class is a Seam component.
				</div><div class="para">
					In the next section, you will see that the properties of the <code class="literal">User</code> class are bound directly to JSF components and populated by JSF during the update model values phase. There is no glue code to copy data back and forth between the JSP pages and the entity bean domain model.
				</div><div class="para">
					However, entity beans should not perform transaction management or database access, so this component should not be used as a JSF action listener. In this situation, a session bean is a better choice.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690533668464">
      ⁠</a>1.2.1.2. The stateless session bean class: <code class="literal">RegisterAction.java</code></h3></div></div></div><div class="para">
					Most Seam applications use session beans as JSF action listeners, though you may also use JavaBeans.
				</div><div class="para">
					We have exactly one JSF action in this application, and one session bean method attached to it. In this case, we will use a stateless session bean, since all the state associated with our action is held by the <code class="literal">User</code> bean.
				</div><div class="para">
					The relevant code is shown below:
				</div><div class="example"><a id="idm139690474304608">
      ⁠</a><p class="title"><strong>Example 1.2. RegisterAction.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateless                                                                               <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"register"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> RegisterAction <span xmlns="" class="perl_Keyword">implements</span> Register
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    @In                                                                                  <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> User user;
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    @PersistenceContext                                                                  <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> EntityManager em;
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    @Logger                                                                              <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Log log;
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">register</span>()                                                             <img class="callout" alt="5" src="Common_Content/images/5.png"/>
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        List existing = em.<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select username "</span> +
<span xmlns="" class="line">​</span>                                       <span xmlns="" class="perl_String">"from User "</span> +
<span xmlns="" class="line">​</span>                                       <span xmlns="" class="perl_String">"where username = #{user.username}"</span>)              <img class="callout" alt="6" src="Common_Content/images/6.png"/>
<span xmlns="" class="line">​</span>            .<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (existing.<span xmlns="" class="perl_Function">size</span>()==<span xmlns="" class="perl_Float">0</span>)
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>                em.<span xmlns="" class="perl_Function">persist</span>(user);
<span xmlns="" class="line">​</span>                log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Registered new user #{user.username}"</span>);                        <img class="callout" alt="7" src="Common_Content/images/7.png"/>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"/registered.xhtml"</span>;                                              <img class="callout" alt="8" src="Common_Content/images/8.png"/>
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">else</span>
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>                FacesMessages.<span xmlns="" class="perl_Function">instance</span>().<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"User #{user.username} already exists"</span>);    <img class="callout" alt="9" src="Common_Content/images/9.png"/>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
									The EJB <code class="literal">@Stateless</code> annotation marks this class as a stateless session bean.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">@In</code> annotation marks an attribute of the bean as injected by Seam. In this case, the attribute is injected from a context variable named <code class="literal">user</code> (the instance variable name).
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
									The EJB standard <code class="literal">@PersistenceContext</code> annotation is used to inject the EJB3 entity manager.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
									The Seam <code class="literal">@Logger</code> annotation is used to inject the component's <code class="literal">Log</code> instance.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
									The action listener method uses the standard EJB3 <code class="literal">EntityManager</code> API to interact with the database, and returns the JSF outcome. Note that, since this is a session bean, a transaction is automatically begun when the <code class="literal">register()</code> method is called, and committed when it completes.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/6.png" alt="6"/></p></td><td valign="top" align="left"><div class="para">
									Notice that Seam lets you use a JSF EL expression inside EJB-QL. Under the covers, this results in an ordinary JPA <code class="literal">setParameter()</code> call on the standard JPA <code class="literal">Query</code> object.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/7.png" alt="7"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">Log</code> API lets us easily display templated log messages which can also make use of JSF EL expressions.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/8.png" alt="8"/></p></td><td valign="top" align="left"><div class="para">
									JSF action listener methods return a string-valued outcome that determines what page will be displayed next. A null outcome (or a void action listener method) redisplays the previous page. In plain JSF, it is normal to always use a JSF <span class="emphasis"><em>navigation rule</em></span> to determine the JSF view id from the outcome. For complex applications this indirection is useful and a good practice. However, for very simple examples like this one, Seam lets you use the JSF view id as the outcome, eliminating the requirement for a navigation rule. <span class="emphasis"><em>Note that when you use a view id as an outcome, Seam always performs a browser redirect.</em></span>
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/9.png" alt="9"/></p></td><td valign="top" align="left"><div class="para">
									Seam provides a number of <span class="emphasis"><em>built-in components</em></span> to help solve common problems. The <code class="literal">FacesMessages</code> component makes it easy to display templated error or success messages. (As of Seam 2.1, you can use <code class="literal">StatusMessages</code> instead to remove the semantic dependency on JSF). Built-in Seam components may be obtained by injection, or by calling the <code class="literal">instance()</code> method on the class of the built-in component.
								</div></td></tr></table></div></div></div></div><div class="para">
					Note that we did not explicitly specify a <code class="literal">@Scope</code> this time. Each Seam component type has a default scope, which will be used if scope is not explicitly specified. For stateless session beans, the default scope is the stateless context.
				</div><div class="para">
					The session bean action listener performs the business and persistence logic for our mini-application. In a more complex application, a separate service layer might be necessary, but Seam allows you to implement your own strategies for application layering. You can make any application as simple, or as complex, as you want.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						This application is more complex than necessary for the sake of clear example code. All of the application code could have been eliminated by using Seam's application framework controllers.
					</div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690463000928">
      ⁠</a>1.2.1.3. The session bean local interface: <code class="literal">Register.java</code></h3></div></div></div><div class="para">
					The session bean requires a local interface.
				</div><div class="example"><a id="idm139690462999392">
      ⁠</a><p class="title"><strong>Example 1.3. Register.java</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Local
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> Register
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">register</span>();
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
					That's the end of the Java code. The next level to examine is the view.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690510716992">
      ⁠</a>1.2.1.4. The view: <code class="literal">register.xhtml</code> and <code class="literal">registered.xhtml</code></h3></div></div></div><div class="para">
					The view pages for a Seam application can be implemented using any technology that supports JSF. This example was written with Facelets.
				</div><div class="example"><a id="idm139690454111168">
      ⁠</a><p class="title"><strong>Example 1.4. register.xhtml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="utf-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
<span xmlns="" class="line">​</span>"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;html</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://www.w3.org/1999/xhtml"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      xmlns:s=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/taglib"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      xmlns:h=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/html"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      xmlns:f=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/core"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>Register New User<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;s:validateAll&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:panelGrid</span><span xmlns="" class="perl_Others"> columns=</span><span xmlns="" class="perl_String">"2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            Username: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{user.username}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            Real Name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{user.name}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            Password: <span xmlns="" class="perl_Keyword">&lt;h:inputSecret</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{user.password}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:panelGrid&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/s:validateAll&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:messages/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Register"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{register.register}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/html&gt;</span>
</pre></div></div><div class="para">
					The only Seam-specific tag here is <code class="literal">&lt;s:validateAll&gt;</code>. This JSF component tells JSF to validate all the contained input fields against the Hibernate Validator annotations specified on the entity bean.
				</div><div class="example"><a id="idm139690508034464">
      ⁠</a><p class="title"><strong>Example 1.5. registered.xhtml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="utf-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_DataType">&lt;!DOCTYPE </span>html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
<span xmlns="" class="line">​</span>"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"<span xmlns="" class="perl_DataType">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;html</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://www.w3.org/1999/xhtml"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      xmlns:f=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/core"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>Successfully Registered New User<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>      Welcome, #{user.name}, you are successfully 
<span xmlns="" class="line">​</span>      registered as #{user.username}.
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/html&gt;</span>
</pre></div></div><div class="para">
					The above is a simple Facelets page, created with inline EL — it contains nothing specific to Seam.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690528006576">
      ⁠</a>1.2.1.5. The Seam component deployment descriptor: <code class="literal">components.xml</code></h3></div></div></div><div class="para">
					Before looking at deployment descriptors, it is worth noting that Seam strongly values minimal configuration. These configuration files will be created for you when you create a Seam application, and there will rarely be any need to alter them. They are presented here solely to assist you in understanding the purpose and function of all of the example code.
				</div><div class="para">
					If you have used Java frameworks previously, you will be used to declaring your component classes in an XML file. You have probably also noticed that as a project matures, these XML files tend to become unmanageable. Fortunately, Seam does not require application components to be accompanied by XML. Most Seam applications require only a small amount of XML, which does not tend to increase in size as projects expand.
				</div><div class="para">
					However, it is often useful to be able to provide for some external configuration of some components, particularly the components that are built into Seam. The most flexible option, here, is to provide this configuration in a file called <code class="literal">components.xml</code>, located in the <code class="literal">WEB-INF</code> directory. The <code class="literal">components.xml</code> file can be used to tell Seam how to find our EJB components in JNDI:
				</div><div class="example"><a id="idm139690517058368">
      ⁠</a><p class="title"><strong>Example 1.6. components.xml example</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;components</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/components"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:core=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/core"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_String">"http://jboss.com/products/seam/core</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">             http://jboss.com/products/seam/core-2.2.xsd </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">             http://jboss.com/products/seam/components</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">             http://jboss.com/products/seam/components-2.2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;core:init</span><span xmlns="" class="perl_Others"> jndi-pattern=</span><span xmlns="" class="perl_String">"@jndiPattern@"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/components&gt;</span></pre></div></div><div class="para">
					The above code configures a property named <code class="literal">jndiPattern</code>, which belongs to a built-in Seam component named <code class="literal">org.jboss.seam.core.init</code>. The <code class="literal">@</code> symbols are used to direct the Ant build script to insert the correct JNDI pattern from the components.properties file when the application is deployed. You will learn more about this process in <a class="xref" href="xml.html#xml.descriptor">Section 6.2, “Configuring components via <code class="filename">components.xml</code>”</a>.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690505313264">
      ⁠</a>1.2.1.6. The web deployment description: <code class="literal">web.xml</code></h3></div></div></div><div class="para">
					The presentation layer for our mini-application will be deployed in a WAR, so a web deployment descriptor is required:
				</div><div class="example"><a id="idm139690505311584">
      ⁠</a><p class="title"><strong>Example 1.7. web.xml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web-app</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         version=</span><span xmlns="" class="perl_String">"2.5"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;listener&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;listener-class&gt;</span>org.jboss.seam.servlet.SeamListener<span xmlns="" class="perl_Keyword">&lt;/listener-class&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/listener&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;context-param&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-name&gt;</span>javax.faces.DEFAULT_SUFFIX<span xmlns="" class="perl_Keyword">&lt;/param-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param-value&gt;</span>.xhtml<span xmlns="" class="perl_Keyword">&lt;/param-value&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/context-param&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>Faces Servlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-class&gt;</span>javax.faces.webapp.FacesServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;load-on-startup&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/load-on-startup&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/servlet&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>Faces Servlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>*.seam<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;session-config&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;session-timeout&gt;</span>10<span xmlns="" class="perl_Keyword">&lt;/session-timeout&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/session-config&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/web-app&gt;</span></pre></div></div><div class="para">
					The above <code class="literal">web.xml</code> file configures both Seam and JSF. The configuration you see here changes very little between Seam applications.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690529206816">
      ⁠</a>1.2.1.7. The JSF configuration: <code class="literal">faces-config.xml</code></h3></div></div></div><div class="para">
					Most Seam applications use JSF views as the presentation layer, so <code class="literal">faces-config.xml</code> is usually a requirement. In this case, Facelets is used to define our views, so we need to tell JSF to use Facelets as its templating engine.
				</div><div class="example"><a id="idm139690529204640">
      ⁠</a><p class="title"><strong>Example 1.8. faces-config.xml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;faces-config</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://java.sun.com/xml/ns/javaee/web-facesconfig_1_2.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              version=</span><span xmlns="" class="perl_String">"1.2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;application&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;view-handler&gt;</span>com.sun.facelets.FaceletViewHandler<span xmlns="" class="perl_Keyword">&lt;/view-handler&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/application&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/faces-config&gt;</span></pre></div></div><div class="para">
					Note that JSF managed bean declarations are unnecessary because the managed beans are annotated Seam components. In Seam applications, <code class="literal">faces-config.xml</code> is used much less often than in plain JSF. Here, we use it simply to enable Facelets (and not JSP) as the view handler.
				</div><div class="para">
					Once you have set up all the basic descriptors, the only XML you need write to add functionality to a Seam application will be for orchestration: navigation rules or jBPM process definitions. Seam operates on the principle that <span class="emphasis"><em>process flow</em></span> and <span class="emphasis"><em>configuration data</em></span> are all that truly belongs in XML.
				</div><div class="para">
					The above example does not require a navigation rule, since the view ID was embedded in our action code.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690510762176">
      ⁠</a>1.2.1.8. The EJB deployment descriptor: <code class="literal">ejb-jar.xml</code></h3></div></div></div><div class="para">
					The <code class="filename">ejb-jar.xml</code> file integrates Seam with EJB3 by attaching the <code class="literal">SeamInterceptor</code> to all session beans in the archive.
				</div><div class="example"><a id="idm139690514597712">
      ⁠</a><p class="title"><strong>Example 1.9. ejb-jar.xml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ejb-jar</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         version=</span><span xmlns="" class="perl_String">"3.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;interceptors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;interceptor&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>        org.jboss.seam.ejb.SeamInterceptor
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/interceptor&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/interceptors&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;ejb-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/ejb-name&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>        org.jboss.seam.ejb.SeamInterceptor
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/interceptor-class&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/interceptor-binding&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/assembly-descriptor&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ejb-jar&gt;</span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690513588096">
      ⁠</a>1.2.1.9. The EJB persistence deployment descriptor: <code class="literal">persistence.xml</code></h3></div></div></div><div class="para">
					The <code class="literal">persistence.xml</code> file directs the EJB persistence provider to the appropriate datasource, and contains some vendor-specific settings. In this case, it enables automatic schema export at start time.
				</div><div class="example"><a id="idm139690513585872">
      ⁠</a><p class="title"><strong>Example 1.10. persistence.xml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;persistence</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/persistence"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">             xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">             xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/persistence</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">              http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">             version=</span><span xmlns="" class="perl_String">"1.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;persistence-unit</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"userDatabase"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;provider&gt;</span>org.hibernate.ejb.HibernatePersistence<span xmlns="" class="perl_Keyword">&lt;/provider&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jta-data-source&gt;</span>java:/DefaultDS<span xmlns="" class="perl_Keyword">&lt;/jta-data-source&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;properties&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hibernate.hbm2ddl.auto"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"create-drop"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/properties&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/persistence-unit&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/persistence&gt;</span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690528535328">
      ⁠</a>1.2.1.10. The EAR deployment descriptor: <code class="literal">application.xml</code></h3></div></div></div><div class="para">
					Finally, since our application is deployed as an EAR, we also require a deployment descriptor.
				</div><div class="example"><a id="registration-application-xml">
      ⁠</a><p class="title"><strong>Example 1.11. registration application</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;application</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">             xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">             xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/javaee</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">              http://java.sun.com/xml/ns/javaee/application_5.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">             version=</span><span xmlns="" class="perl_String">"5"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;display-name&gt;</span>Seam Registration<span xmlns="" class="perl_Keyword">&lt;/display-name&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;module&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;web&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;web-uri&gt;</span>jboss-seam-registration.war<span xmlns="" class="perl_Keyword">&lt;/web-uri&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;context-root&gt;</span>/seam-registration<span xmlns="" class="perl_Keyword">&lt;/context-root&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/module&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;module&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;ejb&gt;</span>jboss-seam-registration.jar<span xmlns="" class="perl_Keyword">&lt;/ejb&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/module&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;module&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;ejb&gt;</span>jboss-seam.jar<span xmlns="" class="perl_Keyword">&lt;/ejb&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/module&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;module&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;java&gt;</span>jboss-el.jar<span xmlns="" class="perl_Keyword">&lt;/java&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/module&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/application&gt;</span>
</pre></div></div><div class="para">
					This deployment descriptor links modules in the enterprise archive and binds the web application to the context root <code class="literal">/seam-registration</code>.
				</div><div class="para">
					You have now seen all of the files in the application.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690497427184">
      ⁠</a>1.2.2. How it works</h2></div></div></div><div class="para">
				When the form is submitted, JSF asks Seam to resolve the variable named <code class="literal">user</code>. Since no value is yet bound to that name (in any Seam context), Seam instantiates the <code class="literal">user</code> component, and returns the resulting <code class="literal">User</code> entity bean instance to JSF after storing it in the Seam session context.
			</div><div class="para">
				The form input values are now validated against the Hibernate Validator constraints specified on the <code class="literal">User</code> entity. If the constraints are violated, JSF redisplays the page. Otherwise, JSF binds the form input values to properties of the <code class="literal">User</code> entity bean.
			</div><div class="para">
				Next, JSF asks Seam to resolve the variable named <code class="literal">register</code>. Seam uses the JNDI pattern mentioned earlier to locate the stateless session bean, wraps it as a Seam component, and returns it. Seam then presents this component to JSF and JSF invokes the <code class="literal">register()</code> action listener method.
			</div><div class="para">
				Seam then intercepts the method call and injects the <code class="literal">User</code> entity from the Seam session context, before allowing the invocation to continue.
			</div><div class="para">
				The <code class="literal">register()</code> method checks if a user with the entered username already exists. If so, an error message is queued with the <code class="literal">FacesMessages</code> component, and a null outcome is returned, causing a page redisplay. The <code class="literal">FacesMessages</code> component interpolates the JSF expression embedded in the message string and adds a JSF <code class="literal">FacesMessage</code> to the view.
			</div><div class="para">
				If no user with that username exists, the <code class="literal">"/registered.xhtml"</code> outcome triggers a browser redirect to the <code class="literal">registered.xhtml</code> page. When JSF comes to render the page, it asks Seam to resolve the variable named <code class="literal">user</code> and uses property values of the returned <code class="literal">User</code> entity from Seam's session scope.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="messages">
      ⁠</a>1.3. Clickable lists in Seam: the messages example</h1></div></div></div><div class="para">
			Clickable lists of database search results are a vital part of any online application. Seam provides special functionality on top of JSF to make it easier to query data with EJB-QL or HQL, and display it as a clickable list using a JSF <code class="literal">&lt;h:dataTable&gt;</code>. The messages example demonstrates this functionality.
		</div><div class="mediaobject" style="text-align: center"><img src="images/messages.png" align="middle" alt="Clickable lists in Seam: the messages example" style="text-align: middle"/></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690512456016">
      ⁠</a>1.3.1. Understanding the code</h2></div></div></div><div class="para">
				The message list example has one entity bean (<code class="literal">Message</code>), one session bean (<code class="literal">MessageListBean</code>), and one JSP.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690448191376">
      ⁠</a>1.3.1.1. The entity bean: <code class="literal">Message.java</code></h3></div></div></div><div class="para">
					The <code class="literal">Message</code> entity defines the title, text, date and time of a message, and a flag indicating whether the message has been read:
				</div><div class="example"><a id="idm139690448189184">
      ⁠</a><p class="title"><strong>Example 1.12. Message.java</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"message"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(EVENT)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Message <span xmlns="" class="perl_Keyword">implements</span> Serializable {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String title;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String text;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">boolean</span> read;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Date datetime;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @Id @GeneratedValue
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">Long</span> <span xmlns="" class="perl_Function">getId</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> id;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setId</span>(<span xmlns="" class="perl_DataType">Long</span> id) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">id</span> = id;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @NotNull @<span xmlns="" class="perl_Function">Length</span>(max=<span xmlns="" class="perl_Float">100</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getTitle</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> title;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setTitle</span>(String title) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">title</span> = title;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @NotNull @Lob
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getText</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> text;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setText</span>(String text) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">text</span> = text;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @NotNull
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isRead</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> read;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRead</span>(<span xmlns="" class="perl_DataType">boolean</span> read) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">read</span> = read;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @NotNull 
<span xmlns="" class="line">​</span>    @Basic @<span xmlns="" class="perl_Function">Temporal</span>(TemporalType.<span xmlns="" class="perl_Function">TIMESTAMP</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> Date <span xmlns="" class="perl_Function">getDatetime</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> datetime;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setDatetime</span>(Date datetime) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">datetime</span> = datetime;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690464806544">
      ⁠</a>1.3.1.2. The stateful session bean: <code class="literal">MessageManagerBean.java</code></h3></div></div></div><div class="para">
					As in the previous example, this example contains a session bean (<code class="literal">MessageManagerBean</code>) which defines the action listener methods for both of the buttons on our form. As in the previous example, one of the buttons selects a message from the list and displays that message; the other button deletes a message.
				</div><div class="para">
					However, <code class="literal">MessageManagerBean</code> is also responsible for fetching the list of messages the first time we navigate to the message list page. There are various ways for users to navigate to the page, not all of which are preceded by a JSF action. (Navigating to the page from your favorites will not necessarily call the JSF action, for example.) Therefore, fetching the message list must take place in a Seam <span class="emphasis"><em>factory method</em></span>, instead of in an action listener method.
				</div><div class="para">
					We want to cache the list of messages in memory between server requests, so we will make this a stateful session bean.
				</div><div class="example"><a id="idm139690502826848">
      ⁠</a><p class="title"><strong>Example 1.13. MessageManagerBean.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateful
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(SESSION)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"messageManager"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MessageManagerBean 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">implements</span> Serializable, MessageManager
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    @DataModel                                                        <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> List&lt;Message&gt; messageList;
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    @DataModelSelection                                               <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Out</span>(required=<span xmlns="" class="perl_Keyword">false</span>)                                              <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Message message;
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">PersistenceContext</span>(type=EXTENDED)                                <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> EntityManager em;
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"messageList"</span>)                                           <img class="callout" alt="5" src="Common_Content/images/5.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">findMessages</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        messageList = em.<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select msg "</span> + 
<span xmlns="" class="line">​</span>                                     <span xmlns="" class="perl_String">"from Message msg"</span> + 
<span xmlns="" class="line">​</span>                                     <span xmlns="" class="perl_String">"order by msg.datetime desc"</span>)
<span xmlns="" class="line">​</span>                         .<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">select</span>()                                              <img class="callout" alt="6" src="Common_Content/images/6.png"/>
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        message.<span xmlns="" class="perl_Function">setRead</span>(<span xmlns="" class="perl_Keyword">true</span>);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">delete</span>()                                              <img class="callout" alt="7" src="Common_Content/images/7.png"/>
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        messageList.<span xmlns="" class="perl_Function">remove</span>(message);
<span xmlns="" class="line">​</span>        em.<span xmlns="" class="perl_Function">remove</span>(message);
<span xmlns="" class="line">​</span>        message=<span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>    @Remove                                                           <img class="callout" alt="8" src="Common_Content/images/8.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">destroy</span>() {}
<span xmlns="" class="line">​</span>        
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">@DataModel</code> annotation exposes an attributes of type <code class="literal">java.util.List</code> to the JSF page as an instance of <code class="literal">javax.faces.model.DataModel</code>. This allows us to use the list in a JSF <code class="literal">&lt;h:dataTable&gt;</code> with clickable links for each row. In this case, the <code class="literal">DataModel</code> is made available in a session context variable named <code class="literal">messageList</code>.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">@DataModelSelection</code> annotation tells Seam to inject the <code class="literal">List</code> element that corresponded to the clicked link.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">@Out</code> annotation then exposes the selected value directly to the page. So every time a row of the clickable list is selected, the <code class="literal">Message</code> is injected to the attribute of the stateful bean, and then subsequently <span class="emphasis"><em>outjected</em></span> to the event context variable named <code class="literal">message</code>.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
									This stateful bean has an EJB3 <span class="emphasis"><em>extended persistence context</em></span>. The messages retrieved in the query remain in the managed state as long as the bean exists, so any subsequent method calls to the stateful bean can update them without needing to make any explicit call to the <code class="literal">EntityManager</code>.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
									The first time we navigate to the JSP page, there will be no value in the <code class="literal">messageList</code> context variable. The <code class="literal">@Factory</code> annotation tells Seam to create an instance of <code class="literal">MessageManagerBean</code> and invoke the <code class="literal">findMessages()</code> method to initialize the value. We call <code class="literal">findMessages()</code> a <span class="emphasis"><em>factory method</em></span> for <code class="literal">messages</code>.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/6.png" alt="6"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">select()</code> action listener method marks the selected <code class="literal">Message</code> as read, and updates it in the database.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/7.png" alt="7"/></p></td><td valign="top" align="left"><div class="para">
									The <code class="literal">delete()</code> action listener method removes the selected <code class="literal">Message</code> from the database.
								</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/8.png" alt="8"/></p></td><td valign="top" align="left"><div class="para">
									All stateful session bean Seam components <span class="emphasis"><em>must</em></span> define a parameterless method marked <code class="literal">@Remove</code> that Seam uses to remove the stateful bean when the Seam context ends, and clean up any server-side state.
								</div></td></tr></table></div></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						This is a session-scoped Seam component. It is associated with the user log in session, and all requests from a log in session share the same instance of the component. Session-scoped components are usually used sparingly in Seam applications.
					</div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690502699904">
      ⁠</a>1.3.1.3. The session bean local interface: <code class="literal">MessageManager.java</code></h3></div></div></div><div class="para">
					All session beans have a business interface:
				</div><div class="example"><a id="idm139690502613216">
      ⁠</a><p class="title"><strong>Example 1.14. MessageManager.java</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Local
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> MessageManager {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">findMessages</span>();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">select</span>();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">delete</span>();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">destroy</span>();
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
					From this point, local interfaces are no longer shown in these code examples. <code class="filename">Components.xml</code>, <code class="filename">persistence.xml</code>, <code class="filename">web.xml</code>, <code class="filename">ejb-jar.xml</code>, <code class="filename">faces-config.xml</code> and <code class="filename">application.xml</code> operate in a similar fashion to the previous example, and go directly to the JSP.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690519245440">
      ⁠</a>1.3.1.4. The view: <code class="literal">messages.jsp</code></h3></div></div></div><div class="para">
					The JSP page is a straightforward use of the JSF <code class="literal">&lt;h:dataTable&gt;</code> component. Once again, these functions are not Seam-specific.
				</div><div class="example"><a id="idm139690528751664">
      ⁠</a><p class="title"><strong>Example 1.15. messages.jsp</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://java.sun.com/jsf/html" prefix="h" %&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://java.sun.com/jsf/core" prefix="f" %&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;html&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>Messages<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h2&gt;</span>Message List<span xmlns="" class="perl_Keyword">&lt;/h2&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"No messages to display"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                      rendered=</span><span xmlns="" class="perl_String">"#{messageList.rowCount==0}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"msg"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{messageList}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                     rendered=</span><span xmlns="" class="perl_String">"#{messageList.rowCount&gt;0}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Read"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:selectBooleanCheckbox</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{msg.read}"</span><span xmlns="" class="perl_Others"> disabled=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Title"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{msg.title}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                           action=</span><span xmlns="" class="perl_String">"#{messageManager.select}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Date/Time"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{msg.datetime}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"both"</span><span xmlns="" class="perl_Others"> dateStyle=</span><span xmlns="" class="perl_String">"medium"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                                 timeStyle=</span><span xmlns="" class="perl_String">"short"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Delete"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                             action=</span><span xmlns="" class="perl_String">"#{messageManager.delete}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h3&gt;&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{message.title}"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/h3&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;div&gt;&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{message.text}"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/html&gt;</span></pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690528748976">
      ⁠</a>1.3.2. How it works</h2></div></div></div><div class="para">
				The first time we navigate to <code class="literal">messages.jsp</code>, the page will try to resolve the <code class="literal">messageList</code> context variable. Since this variable is not yet initialized, Seam calls the factory method <code class="literal">findMessages</code>, which queries the database and retrieves a <code class="literal">DataModel</code>. This provides the row data required to render the <code class="literal">&lt;h:dataTable&gt;</code>.
			</div><div class="para">
				When the user clicks the <code class="literal">&lt;h:commandLink&gt;</code>, JSF calls the <code class="literal">select()</code> action listener. Seam intercepts this call and injects the selected row data into the <code class="literal">message</code> attribute of the <code class="literal">messageManager</code> component. The action listener fires, marking the selected <code class="literal">Message</code> as read. At the end of the call, Seam outjects the selected <code class="literal">Message</code> to the <code class="literal">message</code> context variable. Next, the EJB container commits the transaction, and the change to the <code class="literal">Message</code> is flushed to the database. Finally, the page is re-rendered, redisplaying the message list, and displaying the selected message below it.
			</div><div class="para">
				When the user clicks the <code class="literal">&lt;h:commandButton&gt;</code>, JSF calls the <code class="literal">delete()</code> action listener. Seam intercepts this call and injects the selected row data into the <code class="literal">message</code> attribute of the <code class="literal">messageList</code> component. The action listener fires, which removes the selected <code class="literal">Message</code> from the list, and also calls <code class="literal">remove()</code> on the <code class="literal">EntityManager</code>. At the end of the call, Seam refreshes the <code class="literal">messageList</code> context variable and clears the <code class="literal">message</code> context variable. The EJB container commits the transaction, and deletes the <code class="literal">Message</code> from the database. Finally, the page is re-rendered, redisplaying the message list.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="todo">
      ⁠</a>1.4. Seam and jBPM: the todo list example</h1></div></div></div><div class="para">
			jBPM provides sophisticated functionality for workflow and task management. As an example of jBPM's integration with Seam, what follows is a simple "todo list" application. Managing task lists is a core function of jBPM, so little Java is required in this example.
		</div><div class="mediaobject" style="text-align: center"><img src="images/todo.png" align="middle" alt="Seam and jBPM: the todo list example" style="text-align: middle"/></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690530914768">
      ⁠</a>1.4.1. Understanding the code</h2></div></div></div><div class="para">
				This example revolves around the jBPM process definition. It also uses two JSPs and two basic JavaBeans. (Session beans are not required here since they would not access the database or have any transactional behavior.) We will start with the process definition:
			</div><div class="example"><a id="idm139690539245200">
      ⁠</a><p class="title"><strong>Example 1.16. todo.jpdl.xml</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;process-definition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"todo"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;start-state</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"start"</span><span xmlns="" class="perl_Keyword">&gt;</span>                                    <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"todo"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/start-state&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;task-node</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"todo"</span><span xmlns="" class="perl_Keyword">&gt;</span>                                       <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;task</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"todo"</span><span xmlns="" class="perl_Others"> description=</span><span xmlns="" class="perl_String">"#{todoList.description}"</span><span xmlns="" class="perl_Keyword">&gt;</span>    <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;assignment</span><span xmlns="" class="perl_Others"> actor-id=</span><span xmlns="" class="perl_String">"#{actor.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>                      <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/task&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"done"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/task-node&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;end-state</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"done"</span><span xmlns="" class="perl_Keyword">/&gt;</span>                                      <img class="callout" alt="5" src="Common_Content/images/5.png"/>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/process-definition&gt;</span></pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">&lt;start-state&gt;</code> node represents the logical start of the process. When the process starts, it immediately transitions to the <code class="literal">todo</code> node.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">&lt;task-node&gt;</code> node represents a <span class="emphasis"><em>wait state</em></span>, where business process execution pauses, waiting for one or more tasks to be performed.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">&lt;task&gt;</code> element defines a task to be performed by a user. Since there is only one task defined on this node, when it is complete, execution resumes, and we transition to the end state. The task gets its description from a Seam component named <code class="literal">todoList</code> (one of the JavaBeans).
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
								Tasks need to be assigned to a user or group of users when they are created. In this case, the task is assigned to the current user, which we get from a built-in Seam component named <code class="literal">actor</code>. Any Seam component may be used to perform task assignment.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">&lt;end-state&gt;</code> node defines the logical end of the business process. When execution reaches this node, the process instance is destroyed.
							</div></td></tr></table></div></div></div></div><div class="para">
				Viewed with the process definition editor provided by JBossIDE, the process definition looks like this:
			</div><div class="mediaobject" style="text-align: center"><img src="images/todo-process.png" align="middle" alt="todo.jpdl.xml" style="text-align: middle"/></div><div class="para">
				This document defines our <span class="emphasis"><em>business process</em></span> as a graph of nodes. This is the simplest possible business process: there is one <span class="emphasis"><em>task</em></span> to be performed, and when that task is complete, the business process ends.
			</div><div class="para">
				The first JavaBean handles the login screen, <code class="literal">login.jsp</code>. Here, it simply initializes the jBPM actor ID with the <code class="literal">actor</code> component. In a real application, it would also need to authenticate the user.
			</div><div class="example"><a id="idm139690502258256">
      ⁠</a><p class="title"><strong>Example 1.17. Login.java</strong></p><div class="example-contents"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"login"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Login {
<span xmlns="" class="line">​</span>    @In
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Actor actor;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String user;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getUser</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> user;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUser</span>(String user) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">user</span> = user;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">login</span>() {
<span xmlns="" class="line">​</span>        actor.<span xmlns="" class="perl_Function">setId</span>(user);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"/todo.jsp"</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="para">
				Here we see the use of <code class="literal">@In</code> to inject the built-in <code class="literal">Actor</code> component.
			</div><div class="para">
				The JSP itself is trivial:
			</div><div class="example"><a id="idm139690518271680">
      ⁠</a><p class="title"><strong>Example 1.18. login.jsp</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://java.sun.com/jsf/html" prefix="h"%&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://java.sun.com/jsf/core" prefix="f"%&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;html&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>Login<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Login<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{login.user}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Login"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{login.login}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/html&gt;</span></pre></div></div><div class="para">
				The second JavaBean is responsible for starting business process instances, and ending tasks.
			</div><div class="example"><a id="idm139690493833968">
      ⁠</a><p class="title"><strong>Example 1.19. TodoList.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"todoList"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> TodoList
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> String description;                       <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getDescription</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> description;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setDescription</span>(String description)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">description</span> = description;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">CreateProcess</span>(definition=<span xmlns="" class="perl_String">"todo"</span>)                 <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">createTodo</span>() {}
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @StartTask @EndTask                               <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">done</span>() {}
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The description property accepts user input from the JSP page, and exposes it to the process definition, allowing the task description to be set.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The Seam <code class="literal">@CreateProcess</code> annotation creates a new jBPM process instance for the named process definition.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								The Seam <code class="literal">@StartTask</code> annotation starts work on a task. The <code class="literal">@EndTask</code> ends the task, and allows the business process execution to resume.
							</div></td></tr></table></div></div></div></div><div class="para">
				In a more realistic example, <code class="literal">@StartTask</code> and <code class="literal">@EndTask</code> would not appear on the same method, because some work would need to be done with the application in order to complete the task.
			</div><div class="para">
				Finally, the core of the application is in <code class="literal">todo.jsp</code>:
			</div><div class="example"><a id="idm139690522050000">
      ⁠</a><p class="title"><strong>Example 1.20. todo.jsp</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://java.sun.com/jsf/html" prefix="h" %&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://java.sun.com/jsf/core" prefix="f" %&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Error">&lt;</span>%@ taglib uri="http://jboss.com/products/seam/taglib" prefix="s" %&gt;
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;html&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>Todo List<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Todo List<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"list"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"There are no todo items."</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                        rendered=</span><span xmlns="" class="perl_String">"#{empty taskInstanceList}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{taskInstanceList}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"task"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                       rendered=</span><span xmlns="" class="perl_String">"#{not empty taskInstanceList}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Description"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.description}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Created"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_String">"#{task.taskMgmtInstance.processInstance.start}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Priority"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.priority}"</span><span xmlns="" class="perl_Others"> style=</span><span xmlns="" class="perl_String">"width: 30"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Due Date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.dueDate}"</span><span xmlns="" class="perl_Others"> style=</span><span xmlns="" class="perl_String">"width: 100"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Others"> dateStyle=</span><span xmlns="" class="perl_String">"short"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/h:inputText&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;s:button</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Done"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{todoList.done}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                        taskInstance=</span><span xmlns="" class="perl_String">"#{task}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:messages/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Update Items"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"update"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"new"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{todoList.description}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Create New Item"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                           action=</span><span xmlns="" class="perl_String">"#{todoList.createTodo}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/html&gt;</span></pre></div></div><div class="para">
				For simplicity's sake, we will look at this once section at a time.
			</div><div class="para">
				The page renders a list of tasks, which it retrieves from a built-in Seam component named <code class="literal">taskInstanceList</code>. The list is defined inside a JSF form.
			</div><div class="example"><a id="idm139690539228160">
      ⁠</a><p class="title"><strong>Example 1.21. todo.jsp (taskInstanceList)</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"list"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"There are no todo items."</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                  rendered=</span><span xmlns="" class="perl_String">"#{empty taskInstanceList}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{taskInstanceList}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"task"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                 rendered=</span><span xmlns="" class="perl_String">"#{not empty taskInstanceList}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      ...
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span></pre></div></div><div class="para">
				Each element of the list is an instance of the jBPM class <code class="literal">TaskInstance</code>. The following code displays certain properties for every task in the list. Input controls are used for description, priority, and due date to allow users to update these values.
			</div><div class="example"><a id="idm139690532575328">
      ⁠</a><p class="title"><strong>Example 1.22. TaskInstance List Properties</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Description"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.description}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Created"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.taskMgmtInstance.processInstance.start}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Priority"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.priority}"</span><span xmlns="" class="perl_Others"> style=</span><span xmlns="" class="perl_String">"width: 30"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Due Date"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{task.dueDate}"</span><span xmlns="" class="perl_Others"> style=</span><span xmlns="" class="perl_String">"width: 100"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"date"</span><span xmlns="" class="perl_Others"> dateStyle=</span><span xmlns="" class="perl_String">"short"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:inputText&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span></pre></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Seam provides a default JSF date converter for converting a string into a date, so no converter is necessary for the field bound to <code class="literal">#{task.dueDate}</code>.
				</div></div></div><div class="para">
				This button ends the task by calling the action method annotated <code class="literal">@StartTask @EndTask</code>. It passes the task ID to Seam as a request parameter:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;s:button</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Done"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{todoList.done}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            taskInstance=</span><span xmlns="" class="perl_String">"#{task}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>
</pre><div class="para">
				Note that this uses a Seam <code class="literal">&lt;s:button&gt;</code> JSF control from the <code class="literal">seam-ui.jar</code> package. This button updates the properties of the tasks. When the form is submitted, Seam and jBPM will make any changes to the tasks persistent. There is no need for any action listener method:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Update Items"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"update"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				A second form on the page creates new items with the action method annotated <code class="literal">@CreateProcess</code>.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"new"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;div&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{todoList.description}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Create New Item"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         action=</span><span xmlns="" class="perl_String">"#{todoList.createTodo}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690518262928">
      ⁠</a>1.4.2. How it works</h2></div></div></div><div class="para">
				After logging in, <code class="filename">todo.jsp</code> uses the <code class="literal">taskInstanceList</code> component to display a table of outstanding todo items for the current user. (Initially there are none.) The page also displays a form to enter a new task item. When the user types the todo item and clicks the <span class="guibutton"><strong>Create New Item</strong></span> button, <code class="literal">#{todoList.createTodo}</code> is called. This starts the todo process, as defined in <code class="literal">todo.jpdl.xml</code>.
			</div><div class="para">
				When the process instance is created, it transitions immediately to the <code class="literal">todo</code> state, where a new task is created. The task description is set based on the user input saved to <code class="literal">#{todoList.description}</code>. The task is then assigned to the current user, stored in the seam actor component. In this example, the process has no extra process state — all the state is stored in the task definition. The process and task information is stored in the database at the end of the request.
			</div><div class="para">
				When <code class="filename">todo.jsp</code> is redisplayed, <code class="literal">taskInstanceList</code> finds the newly-created task and displays it in an <code class="literal">h:dataTable</code>. The internal state of the task is displayed in each column: <code class="literal">#{task.description}</code>, <code class="literal">#{task.priority}</code>, <code class="literal">#{task.dueDate}</code>, etc. These fields can all be edited and saved to the database.
			</div><div class="para">
				Each todo item also has a <span class="guibutton"><strong>Done</strong></span> button, which calls <code class="literal">#{todoList.done}</code>. Each button specifies <code class="literal">taskInstance="#{task}"</code> (the task for that particular row of the table) so that the <code class="literal">todoList</code> component is able to distinctly identify which task is complete. The <code class="literal">@StartTask</code> and <code class="literal">@EndTask</code> annotations activate and immediately complete the task. The original process then transitions into the <code class="literal">done</code> state (according to the process definition) and ends. The state of the task and process are both updated in the database.
			</div><div class="para">
				When <code class="filename">todo.jsp</code> is displayed again, the completed task is no longer shown in the <code class="literal">taskInstanceList</code>, since this component displays only incomplete tasks.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="numberguess">
      ⁠</a>1.5. Seam pageflow: the numberguess example</h1></div></div></div><div class="para">
			For Seam applications with freeform (ad hoc) navigation, JSF/Seam navigation rules are a good way to define page flow. However, in applications with more constrained navigation styles, especially user interfaces that are more stateful, navigation rules make understanding system flow difficult. Combining information from view pages, actions, and navigation rules makes this flow easier to understand.
		</div><div class="para">
			With Seam, jPDL process definition can be used to define pageflow, as seen in the number guessing example that follows.
		</div><div class="mediaobject" style="text-align: center"><img src="images/numberguess.png" align="middle" alt="Seam pageflow: the numberguess example" style="text-align: middle"/></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690453458272">
      ⁠</a>1.5.1. Understanding the code</h2></div></div></div><div class="para">
				The example uses one JavaBean, three JSP pages and a jPDL pageflow definition. We will start by looking at the pageflow:
			</div><div class="example"><a id="idm139690453456512">
      ⁠</a><p class="title"><strong>Example 1.23. pageflow.jpdl.xml</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pageflow-definition</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/pageflow"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/pageflow </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                        http://jboss.com/products/seam/pageflow-2.2.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    name=</span><span xmlns="" class="perl_String">"numberGuess"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;start-page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"displayGuess"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/numberGuess.jspx"</span><span xmlns="" class="perl_Keyword">&gt;</span>                        <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"guess"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"evaluateGuess"</span><span xmlns="" class="perl_Keyword">&gt;</span>                                      <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> expression=</span><span xmlns="" class="perl_String">"#{numberGuess.guess}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>                                     <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/transition&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"giveup"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"giveup"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cheat"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"cheat"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/start-page&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;decision</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"evaluateGuess"</span><span xmlns="" class="perl_Others"> expression=</span><span xmlns="" class="perl_String">"#{numberGuess.correctGuess}"</span><span xmlns="" class="perl_Keyword">&gt;</span>            <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"win"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"evaluateRemainingGuesses"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/decision&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;decision</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"evaluateRemainingGuesses"</span><span xmlns="" class="perl_Others"> expression=</span><span xmlns="" class="perl_String">"#{numberGuess.lastGuess}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"lose"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"displayGuess"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/decision&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"giveup"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/giveup.jspx"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"yes"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"lose"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"no"</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"displayGuess"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;process-state</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cheat"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;sub-process</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cheat"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;transition</span><span xmlns="" class="perl_Others"> to=</span><span xmlns="" class="perl_String">"displayGuess"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/process-state&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"win"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/win.jspx"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;end-conversation/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lose"</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/lose.jspx"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;end-conversation/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pageflow-definition&gt;</span></pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">&lt;page&gt;</code> element defines a wait state where the system displays a particular JSF view and waits for user input. The <code class="literal">view-id</code> is the same JSF view id used in plain JSF navigation rules. The <code class="literal">redirect</code> attribute tells Seam to use post-then-redirect when navigating to the page. (This results in friendly browser URLs.)
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">&lt;transition&gt;</code> element names a JSF outcome. The transition is triggered when a JSF action results in that outcome. Execution will then proceed to the next node of the pageflow graph, after invocation of any jBPM transition actions.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								A transition <code class="literal">&lt;action&gt;</code> is just like a JSF action, except that it occurs when a jBPM transition occurs. The transition action can invoke any Seam component.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
								A <code class="literal">&lt;decision&gt;</code> node branches the pageflow, and determines the next node to execute by evaluating a JSF EL expression.
							</div></td></tr></table></div></div></div></div><div class="para">
				In the JBoss Developer Studio pageflow editor, the pageflow looks like this:
			</div><div class="mediaobject" style="text-align: center"><img src="images/numberguess-pageflow.png" align="middle" alt="pageflow.jpdl.xml" style="text-align: middle"/></div><div class="para">
				With that pageflow in mind, the rest of the application is much easier to understand.
			</div><div class="para">
				Here is the main page of the application, <code class="literal">numberGuess.jspx</code>:
			</div><div class="example"><a id="idm139690515518016">
      ⁠</a><p class="title"><strong>Example 1.24. numberGuess.jspx</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jsp:root</span><span xmlns="" class="perl_Others"> xmlns:jsp=</span><span xmlns="" class="perl_String">"http://java.sun.com/JSP/Page"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns:h=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/html"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns:f=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/core"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns:s=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/taglib"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns=</span><span xmlns="" class="perl_String">"http://www.w3.org/1999/xhtml"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          version=</span><span xmlns="" class="perl_String">"2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jsp:output</span><span xmlns="" class="perl_Others"> doctype-root-element=</span><span xmlns="" class="perl_String">"html"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              doctype-public=</span><span xmlns="" class="perl_String">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              doctype-system=</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_String">"http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jsp:directive.page</span><span xmlns="" class="perl_Others"> contentType=</span><span xmlns="" class="perl_String">"text/html"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;html&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>Guess a number...<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;link</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"niceforms.css"</span><span xmlns="" class="perl_Others"> rel=</span><span xmlns="" class="perl_String">"stylesheet"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"text/css"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;script</span><span xmlns="" class="perl_Others"> language=</span><span xmlns="" class="perl_String">"javascript"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"text/javascript"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              src=</span><span xmlns="" class="perl_String">"niceforms.js"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Guess a number...<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> styleClass=</span><span xmlns="" class="perl_String">"niceform"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:messages</span><span xmlns="" class="perl_Others"> globalOnly=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Higher!"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                          rendered=</span><span xmlns="" class="perl_String">"#{</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                    numberGuess.randomNumber gt </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                    numberGuess.currentGuess}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Lower!"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                          rendered=</span><span xmlns="" class="perl_String">"#{</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                    numberGuess.randomNumber lt </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                    numberGuess.currentGuess}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>            I'm thinking of a number between 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.smallest}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> and 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.biggest}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>. You have 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.remainingGuesses}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>            guesses.
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>            Your guess: 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.currentGuess}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                         id=</span><span xmlns="" class="perl_String">"inputGuess"</span><span xmlns="" class="perl_Others"> required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> size=</span><span xmlns="" class="perl_String">"3"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                         rendered=</span><span xmlns="" class="perl_String">"#{</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                   (numberGuess.biggest-numberGuess.smallest) gt </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                   20}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;f:validateLongRange</span><span xmlns="" class="perl_Others"> maximum=</span><span xmlns="" class="perl_String">"#{numberGuess.biggest}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                                   minimum=</span><span xmlns="" class="perl_String">"#{numberGuess.smallest}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:inputText&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:selectOneMenu</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.currentGuess}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                             id=</span><span xmlns="" class="perl_String">"selectGuessMenu"</span><span xmlns="" class="perl_Others"> required=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                             rendered=</span><span xmlns="" class="perl_String">"#{</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                       (numberGuess.biggest-numberGuess.smallest) le </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                       20 and </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                       (numberGuess.biggest-numberGuess.smallest) gt </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                       4}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;s:selectItems</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.possibilities}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                             var=</span><span xmlns="" class="perl_String">"i"</span><span xmlns="" class="perl_Others"> label=</span><span xmlns="" class="perl_String">"#{i}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:selectOneMenu&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:selectOneRadio</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.currentGuess}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                              id=</span><span xmlns="" class="perl_String">"selectGuessRadio"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                              required=</span><span xmlns="" class="perl_String">"true"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                              rendered=</span><span xmlns="" class="perl_String">"#{</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                        (numberGuess.biggest-numberGuess.smallest) le </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                        4}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;s:selectItems</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.possibilities}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                             var=</span><span xmlns="" class="perl_String">"i"</span><span xmlns="" class="perl_Others"> label=</span><span xmlns="" class="perl_String">"#{i}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/h:selectOneRadio&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Guess"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"guess"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;s:button</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Cheat"</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/confirm.jspx"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;s:button</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Give up"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"giveup"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;h:message</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"inputGuess"</span><span xmlns="" class="perl_Others"> style=</span><span xmlns="" class="perl_String">"color: red"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/html&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jsp:root&gt;</span></pre></div></div><div class="para">
				Note that the command button names the <code class="literal">guess</code> transition instead of calling an action directly.
			</div><div class="para">
				The <code class="literal">win.jspx</code> page is predictable:
			</div><div class="example"><a id="idm139690506753632">
      ⁠</a><p class="title"><strong>Example 1.25. win.jspx</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jsp:root</span><span xmlns="" class="perl_Others"> xmlns:jsp=</span><span xmlns="" class="perl_String">"http://java.sun.com/JSP/Page"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns:h=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/html"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns:f=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/core"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          xmlns=</span><span xmlns="" class="perl_String">"http://www.w3.org/1999/xhtml"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          version=</span><span xmlns="" class="perl_String">"2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jsp:output</span><span xmlns="" class="perl_Others"> doctype-root-element=</span><span xmlns="" class="perl_String">"html"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              doctype-public=</span><span xmlns="" class="perl_String">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              doctype-system=</span><span xmlns="" class="perl_String">"http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jsp:directive.page</span><span xmlns="" class="perl_Others"> contentType=</span><span xmlns="" class="perl_String">"text/html"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;html&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;head&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;title&gt;</span>You won!<span xmlns="" class="perl_Keyword">&lt;/title&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;link</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"niceforms.css"</span><span xmlns="" class="perl_Others"> rel=</span><span xmlns="" class="perl_String">"stylesheet"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"text/css"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/head&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>You won!<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:view&gt;</span>
<span xmlns="" class="line">​</span>        Yes, the answer was 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.currentGuess}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>.
<span xmlns="" class="line">​</span>        It took you 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numberGuess.guessCount}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> guesses.
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"But you cheated, so it does not count!"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                      rendered=</span><span xmlns="" class="perl_String">"#{numberGuess.cheat}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        Would you like to <span xmlns="" class="perl_Keyword">&lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"numberGuess.seam"</span><span xmlns="" class="perl_Keyword">&gt;</span>play again<span xmlns="" class="perl_Keyword">&lt;/a&gt;</span>?
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/f:view&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/html&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jsp:root&gt;</span></pre></div></div><div class="para">
				The <code class="literal">lose.jspx</code> is very similar, so we have not included it here.
			</div><div class="para">
				Finally, the application code is as follows:
			</div><div class="example"><a id="idm139690512064960">
      ⁠</a><p class="title"><strong>Example 1.26. NumberGuess.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"numberGuess"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(ScopeType.<span xmlns="" class="perl_Function">CONVERSATION</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> NumberGuess <span xmlns="" class="perl_Keyword">implements</span> Serializable {
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> randomNumber;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Integer currentGuess;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> biggest;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> smallest;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> guessCount;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> maxGuesses;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">boolean</span> cheated;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @Create                                                   <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">begin</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      randomNumber = <span xmlns="" class="perl_Keyword">new</span> Random().<span xmlns="" class="perl_Function">nextInt</span>(<span xmlns="" class="perl_Float">100</span>);
<span xmlns="" class="line">​</span>      guessCount = <span xmlns="" class="perl_Float">0</span>;
<span xmlns="" class="line">​</span>      biggest = <span xmlns="" class="perl_Float">100</span>;
<span xmlns="" class="line">​</span>      smallest = <span xmlns="" class="perl_Float">1</span>;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setCurrentGuess</span>(Integer guess)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">currentGuess</span> = guess;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getCurrentGuess</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> currentGuess;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">guess</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (currentGuess&gt;randomNumber)
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         biggest = currentGuess - <span xmlns="" class="perl_Float">1</span>;
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (currentGuess&lt;randomNumber)
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         smallest = currentGuess + <span xmlns="" class="perl_Float">1</span>;
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>      guessCount ++;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isCorrectGuess</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> currentGuess==randomNumber;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getBiggest</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> biggest;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getSmallest</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> smallest;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getGuessCount</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> guessCount;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isLastGuess</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> guessCount==maxGuesses;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getRemainingGuesses</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> maxGuesses-guessCount;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setMaxGuesses</span>(<span xmlns="" class="perl_DataType">int</span> maxGuesses) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">maxGuesses</span> = maxGuesses;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getMaxGuesses</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> maxGuesses;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getRandomNumber</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> randomNumber;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">cheated</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      cheated = <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isCheat</span>() {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> cheated;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> List&lt;Integer&gt; <span xmlns="" class="perl_Function">getPossibilities</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      List&lt;Integer&gt; result = <span xmlns="" class="perl_Keyword">new</span> ArrayList&lt;Integer&gt;();
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">for</span>(<span xmlns="" class="perl_DataType">int</span> i=smallest; i&lt;=biggest; i++) result.<span xmlns="" class="perl_Function">add</span>(i);
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> result;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The first time a JSP page asks for a <code class="literal">numberGuess</code> component, Seam will create a new one for it, and the <code class="literal">@Create</code> method will be invoked, allowing the component to initialize itself.
							</div></td></tr></table></div></div></div></div><div class="para">
				The <code class="literal">pages.xml</code> file starts a Seam <span class="emphasis"><em>conversation</em></span>, and specifies the pageflow definition to use for the conversation's page flow. Refer to <a class="xref" href="conversations.html">Chapter 8, <em>Conversations and workspace management</em></a> for more information.
			</div><div class="example"><a id="idm139690449817104">
      ⁠</a><p class="title"><strong>Example 1.27. pages.xml</strong></p><div class="example-contents"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/pages"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/pages http://jboss.com/products/seam/pages-2.2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/numberGuess.jspx"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;begin-conversation</span><span xmlns="" class="perl_Others"> join=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> pageflow=</span><span xmlns="" class="perl_String">"numberGuess"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre></div></div><div class="para">
				This component is pure business logic. Since it requires no information about the user interaction flow, it is potentially more reuseable.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690527539232">
      ⁠</a>1.5.2. How it works</h2></div></div></div><div class="para">
				The game begins in the <code class="filename">numberGuess.jspx</code> view. When the page is first displayed, the <code class="filename">pages.xml</code> configuration activates a conversation and associates it with the <code class="literal">numberGuess</code> pageflow. The pageflow starts with a <code class="literal">start-page</code> tag (a <span class="emphasis"><em>wait</em></span> state), so the <code class="filename">numberGuess.xhtml</code> is rendered.
			</div><div class="para">
				The view references the <code class="literal">numberGuess</code> component, which causes a new instance to be created and stored in the conversation. the <code class="literal">@Create</code> method is called, initializing the game's state. The view displays an <code class="literal">h:form</code>, which allows the user to edit <code class="literal">#{numberGuess.currentGuess}</code>.
			</div><div class="para">
				The "Guess" button triggers the <code class="literal">guess</code> action. Seam refers to the pageflow to handle the action, and the pageflow invokes <code class="literal">#{numberGuess.guess}</code> (which updates the guess count and highest/lowest suggestions in the <code class="literal">numberGuess</code> component), and transitions to the <code class="literal">evaluateGuess</code> state.
			</div><div class="para">
				The <code class="literal">evaluateGuess</code> state checks the value of <code class="literal">#{numberGuess.correctGuess}</code> and transitions to either the <code class="literal">win</code> or <code class="literal">evaluatingRemainingGuesses</code> state. Assuming the number was incorrect, the pageflow transitions to <code class="literal">evaluatingRemainingGuesses</code>. This is also a decision state, which tests the <code class="literal">#{numberGuess.lastGuess}</code> state to determine whether or not the user is allowed further guesses. If further guesses are allowed (<code class="literal">lastGuess</code> is <code class="literal">false</code>), we transition back to the original <code class="literal">displayGuess</code> state. Since this is a page state, the associated page <code class="filename">/numberGuess.jspx</code> is displayed. This page also contains a redirect element, so Seam sends a redirect to the user's browser, which begins the process again.
			</div><div class="para">
				If on a future request either the <code class="literal">win</code> or the <code class="literal">lose</code> transition were invoked, the user would be taken to <code class="filename">/win.jspx</code> or <code class="filename">/lose.jspx</code> respectively. Both states specify that Seam should end the conversation, stop holding game and pageflow state, and redirect the user to the final page.
			</div><div class="para">
				The numberguess example also contains <span class="guibutton"><strong>Give up</strong></span> and <span class="guibutton"><strong>Cheat</strong></span> buttons. The pageflow state for both actions is relatively easy to trace, so we do not describe it here. Pay particular attention to the <code class="literal">cheat</code> transition, which loads a sub-process to handle that particular flow. Although in this application this process is superfluous, this demonstrates how complex pageflows can be broken down into smaller, simpler structures to make them easier to understand.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="booking">
      ⁠</a>1.6. A complete Seam application: the Hotel Booking example</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690530766784">
      ⁠</a>1.6.1. Introduction</h2></div></div></div><div class="para">
				The booking application is a complete hotel room reservation system incorporating the following features:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						User registration
					</div></li><li class="listitem"><div class="para">
						Login
					</div></li><li class="listitem"><div class="para">
						Logout
					</div></li><li class="listitem"><div class="para">
						Set password
					</div></li><li class="listitem"><div class="para">
						Hotel search
					</div></li><li class="listitem"><div class="para">
						Hotel selection
					</div></li><li class="listitem"><div class="para">
						Room reservation
					</div></li><li class="listitem"><div class="para">
						Reservation confirmation
					</div></li><li class="listitem"><div class="para">
						Existing reservation list
					</div></li></ul></div><div class="mediaobject" style="text-align: center"><img src="images/booking.png" align="middle" alt="Booking example" style="text-align: middle"/></div><div class="para">
				The booking application uses JSF, EJB 3.0 and Seam, together with Facelets for the view. There is also a port of this application to JSF, Facelets, Seam, JavaBeans and Hibernate3.
			</div><div class="para">
				One of the things you will notice about this application is that it is extremely <span class="emphasis"><em>robust</em></span>. You can open multiple windows, use the back and browser refresh buttons, and enter nonsensical data, but the application is difficult to crash. Seam was designed to make building robust web applications straightforward, so robustness that would previously be hand-coded comes naturally and automatically with Seam.
			</div><div class="para">
				As you browse the source code of the example application and learn how the application works, pay particular attention to the way the declarative state management and integrated validation has been used to achieve this robustness.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690462890880">
      ⁠</a>1.6.2. Overview of the booking example</h2></div></div></div><div class="para">
				The project structure here is identical to that of the previous project. To install and deploy this application, refer to <a class="xref" href="tutorial.html#try-examples">Section 1.1, “Using the Seam examples”</a>. Once you have successfully started the application, you can access it by pointing your browser to <a href="http://localhost:8080/seam-booking/"> <code class="literal">http://localhost:8080/seam-booking/</code> </a>
			</div><div class="para">
				The application uses six session beans to implement the business logic for the following features:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="literal">AuthenticatorAction</code> provides the log in authentication logic.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">BookingListAction</code> retrieves existing bookings for the currently logged in user.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">ChangePasswordAction</code> updates the password of the currently logged in user.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">HotelBookingAction</code> implements booking and confirmation functionality. This is implemented as a <span class="emphasis"><em>conversation</em></span>, so this is one of the more important classes in the application.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">HotelSearchingAction</code> implements the hotel search functionality.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">RegisterAction</code> registers a new system user.
					</div></li></ul></div><div class="para">
				Three entity beans implement the application's persistent domain model:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="literal">Hotel</code> is an entity bean that represents a hotel
					</div></li><li class="listitem"><div class="para">
						<code class="literal">Booking</code> is an entity bean that represents an existing booking
					</div></li><li class="listitem"><div class="para">
						<code class="literal">User</code> is an entity bean representing a user who can make hotel bookings
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690512829248">
      ⁠</a>1.6.3. Understanding Seam conversations</h2></div></div></div><div class="para">
				This tutorial concentrates upon one particular piece of functionality: placing a hotel reservation. From the user's perspective, hotel search, selection, booking, and confirmation are one continuous unit of work — a <span class="emphasis"><em>conversation</em></span>. However, from our perspective, it is important that searching remains separate so that users can select multiple hotels from the same search results page, and open distinct conversations in separate browser tabs.
			</div><div class="para">
				Most web application architectures do not have first class constructs to represent conversations, which makes managing conversational state problematic. Java web applications generally use a combination of several techniques. Some state is transferred in the URL, but what cannot be transferred here is either added to the <code class="literal">HttpSession</code> or recorded to the database at the beginning and end of each request.
			</div><div class="para">
				Since the database is the least-scalable tier, this drastically reduces scalability. The extra traffic to and from the database also increases latency. In order to reduce redundant traffic, Java applications often introduce a data cache to store commonly-accessed data between requests. However, since invalidation is based upon an LRU policy, rather than whether the user has finished using the data, this cache is inefficient. It is also shared between concurrent transactions, which introduces further issues associated with keeping the cached state consistent with that of the database.
			</div><div class="para">
				State held in the <code class="literal">HttpSession</code> suffers similar issues. The <code class="literal">HttpSession</code> is fine for storing true session data — data common to all requests between user and application — but for data related to individual request series, it does not work so well. Conversations stored here quickly break down when dealing with multiple windows or the back button. Without careful programming, data in the <code class="literal">HttpSession</code> can also grow quite large, which makes the session difficult to cluster. Developing mechanisms to deal with the problems these methods present (by isolating session state associated with distinct concurrent conversations, and incorporating failsafes to ensure conversation state is destroyed when a conversation is aborted) can be complicated.
			</div><div class="para">
				Seam greatly improves conditions by introducing <span class="emphasis"><em>conversation context</em></span> as a first class construct. Conversation state is stored safely in this context, with a well-defined life cycle. Even better, there is no need to push data continually between the application server and the database; the conversation context is a natural cache for currently-used data.
			</div><div class="para">
				In the following application, the conversation context is used to store stateful session beans. These are sometimes regarded as detrimental to scalability, and in the past, they may have been. However, modern application servers have sophisticated mechanisms for stateful session bean replication. JBoss Enterprise Application Platform performs fine-grained replication, replicating only altered bean attribute values. Used correctly, stateful session beans pose no scalability problems, but for those uncomfortable or unfamiliar with the use of stateful session beans, Seam also allows the use of POJOs.
			</div><div class="para">
				The booking example shows one way that stateful components with different scopes can collaborate to achieve complex behaviors. The main page of the booking application allows the user to search for hotels. Search results are stored in the Seam session scope. When the user navigate to a hotel, a conversation begins, and a conversation scoped component retrieves the selected hotel from the session scoped component.
			</div><div class="para">
				The booking example also demonstrates the use of RichFaces Ajax to implement rich client behavior without handwritten JavaScript.
			</div><div class="para">
				The search function is implemented with a session-scoped stateful session bean, similar to the one used in the message list example.
			</div><div class="example"><a id="idm139690530646464">
      ⁠</a><p class="title"><strong>Example 1.28. HotelSearchingAction.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateful                                                                                     <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"hotelSearch"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(ScopeType.<span xmlns="" class="perl_Function">SESSION</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Restrict</span>(<span xmlns="" class="perl_String">"#{identity.loggedIn}"</span>)                                                             <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> HotelSearchingAction <span xmlns="" class="perl_Keyword">implements</span> HotelSearching
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @PersistenceContext
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> EntityManager em;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> String searchString;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> pageSize = <span xmlns="" class="perl_Float">10</span>;
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">int</span> page;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @DataModel                                                                                <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> List&lt;Hotel&gt; hotels;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">find</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        page = <span xmlns="" class="perl_Float">0</span>;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Function">queryHotels</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">nextPage</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        page++;
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Function">queryHotels</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">queryHotels</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        hotels = 
<span xmlns="" class="line">​</span>            em.<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select h from Hotel h where lower(h.name) like #{pattern} "</span> + 
<span xmlns="" class="line">​</span>                           <span xmlns="" class="perl_String">"or lower(h.city) like #{pattern} "</span> + 
<span xmlns="" class="line">​</span>                           <span xmlns="" class="perl_String">"or lower(h.zip) like #{pattern} "</span> +
<span xmlns="" class="line">​</span>                           <span xmlns="" class="perl_String">"or lower(h.address) like #{pattern}"</span>)
<span xmlns="" class="line">​</span>              .<span xmlns="" class="perl_Function">setMaxResults</span>(pageSize)
<span xmlns="" class="line">​</span>              .<span xmlns="" class="perl_Function">setFirstResult</span>( page * pageSize )
<span xmlns="" class="line">​</span>              .<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isNextPageAvailable</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> hotels!=<span xmlns="" class="perl_Keyword">null</span> &amp;&amp; hotels.<span xmlns="" class="perl_Function">size</span>()==pageSize;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">int</span> <span xmlns="" class="perl_Function">getPageSize</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> pageSize;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setPageSize</span>(<span xmlns="" class="perl_DataType">int</span> pageSize) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">pageSize</span> = pageSize;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Factory</span>(value=<span xmlns="" class="perl_String">"pattern"</span>, scope=ScopeType.<span xmlns="" class="perl_Function">EVENT</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSearchPattern</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> searchString==<span xmlns="" class="perl_Keyword">null</span> ? 
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_String">"%"</span> : <span xmlns="" class="perl_Char">'%'</span> + searchString.<span xmlns="" class="perl_Function">toLowerCase</span>().<span xmlns="" class="perl_Function">replace</span>(<span xmlns="" class="perl_Char">'*'</span>, <span xmlns="" class="perl_Char">'%'</span>) + <span xmlns="" class="perl_Char">'%'</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSearchString</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> searchString;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setSearchString</span>(String searchString)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">searchString</span> = searchString;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @Remove                                                                                   <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">destroy</span>() {}
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The EJB standard <code class="literal">@Stateful</code> annotation identifies this class as a stateful session bean. Stateful session beans are scoped to the conversation context by default.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@Restrict</code> annotation applies a security restriction to the component. It restricts access to the component allowing only logged-in users. The security chapter explains more about security in Seam.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@DataModel</code> annotation exposes a <code class="literal">List</code> as a JSF <code class="literal">ListDataModel</code>. This makes it easy to implement clickable lists for search screens. In this case, the list of hotels is exposed to the page as a <code class="literal">ListDataModel</code> in the conversation variable named <code class="literal">hotels</code>.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
								The EJB standard <code class="literal">@Remove</code> annotation specifies that a stateful session bean should be removed and its state destroyed after invocation of the annotated method. In Seam, all stateful session beans must define a parameterless method marked <code class="literal">@Remove</code>. This method will be called when Seam destroys the session context.
							</div></td></tr></table></div></div></div></div><div class="para">
				The main page of the application is a Facelets page. The fragment that relates to searching for hotels is shown below:
			</div><div class="example"><a id="idm139690527989552">
      ⁠</a><p class="title"><strong>Example 1.29. main.xhtml</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"section"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;span</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"errors"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:messages</span><span xmlns="" class="perl_Others"> globalOnly=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/span&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Search Hotels<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"searchCriteria"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;fieldset&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"searchString"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{hotelSearch.searchString}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                   style=</span><span xmlns="" class="perl_String">"width: 165px;"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;a:support</span><span xmlns="" class="perl_Others"> event=</span><span xmlns="" class="perl_String">"onkeyup"</span><span xmlns="" class="perl_Others"> actionListener=</span><span xmlns="" class="perl_String">"#{hotelSearch.find}"</span>                     <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                   reRender=</span><span xmlns="" class="perl_String">"searchResults"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:inputText&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_DecVal">&amp;#160;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;a:commandButton</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"findHotels"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Find Hotels"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{hotelSearch.find}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                       reRender=</span><span xmlns="" class="perl_String">"searchResults"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_DecVal">&amp;#160;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;a:status&gt;</span>                                                                            <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"start"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:graphicImage</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/img/spinner.gif"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/a:status&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;br/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:outputLabel</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"pageSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>Maximum results:<span xmlns="" class="perl_Keyword">&lt;/h:outputLabel&gt;</span><span xmlns="" class="perl_DecVal">&amp;#160;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:selectOneMenu</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{hotelSearch.pageSize}"</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"pageSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:selectItem</span><span xmlns="" class="perl_Others"> itemLabel=</span><span xmlns="" class="perl_String">"5"</span><span xmlns="" class="perl_Others"> itemValue=</span><span xmlns="" class="perl_String">"5"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:selectItem</span><span xmlns="" class="perl_Others"> itemLabel=</span><span xmlns="" class="perl_String">"10"</span><span xmlns="" class="perl_Others"> itemValue=</span><span xmlns="" class="perl_String">"10"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:selectItem</span><span xmlns="" class="perl_Others"> itemLabel=</span><span xmlns="" class="perl_String">"20"</span><span xmlns="" class="perl_Others"> itemValue=</span><span xmlns="" class="perl_String">"20"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:selectOneMenu&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/fieldset&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;a:outputPanel</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"searchResults"</span><span xmlns="" class="perl_Keyword">&gt;</span>                                                          <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"section"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"No Hotels Found"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                  rendered=</span><span xmlns="" class="perl_String">"#{hotels != null and hotels.rowCount==0}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"hotels"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{hotels}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"hot"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                 rendered=</span><span xmlns="" class="perl_String">"#{hotels.rowCount&gt;0}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Name<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>        #{hot.name}
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Address<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>        #{hot.address}
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>City, State<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>        #{hot.city}, #{hot.state}, #{hot.country}
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Zip<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>        #{hot.zip}
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Action<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"viewHotel"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"View Hotel"</span>                                           <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                action=</span><span xmlns="" class="perl_String">"#{hotelBooking.selectHotel(hot)}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"More results"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{hotelSearch.nextPage}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            rendered=</span><span xmlns="" class="perl_String">"#{hotelSearch.nextPageAvailable}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/a:outputPanel&gt;</span></pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The RichFaces Ajax <code class="literal">&lt;a:support&gt;</code> tag allows a JSF action event listener to be called by asynchronous <code class="literal">XMLHttpRequest</code> when a JavaScript event like <code class="literal">onkeyup</code> occurs. Even better, the <code class="literal">reRender</code> attribute lets us render a fragment of the JSF page and perform a partial page update when the asynchronous response is received.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The RichFaces Ajax <code class="literal">&lt;a:status&gt;</code> tag lets us display an animated image while we wait for asynchronous requests to return.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								The RichFaces Ajax <code class="literal">&lt;a:outputPanel&gt;</code> tag defines a region of the page which can be re-rendered by an asynchronous request.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
								The Seam <code class="literal">&lt;s:link&gt;</code> tag lets us attach a JSF action listener to an ordinary (non-JavaScript) HTML link. The advantage of this over the standard JSF <code class="literal">&lt;h:commandLink&gt;</code> is that it preserves the operation of "open in new window" and "open in new tab". Also notice that we use a method binding with a parameter: <code class="literal">#{hotelBooking.selectHotel(hot)}</code>. This is not possible in the standard Unified EL, but Seam provides an extension to the EL that lets you use parameters on any method binding expression.
							</div><div class="para">
								If you are wondering how navigation occurs, you can find all the rules in <code class="literal">WEB-INF/pages.xml</code>; this is discussed in <a class="xref" href="events.html#events.pageaction.navigation">Section 7.7, “Navigation”</a>.
							</div></td></tr></table></div></div></div></div><div class="para">
				This page displays search results dynamically as the user types, and passes a selected hotel to the <code class="literal">selectHotel()</code> method of <code class="literal">HotelBookingAction</code>, where the real work occurs.
			</div><div class="para">
				The following code shows how the booking example application uses a conversation-scoped stateful session bean to achieve a natural cache of persistent data related to the conversation. Think of the code as a list of scripted actions that implement the various steps of the conversation.
			</div><div class="example"><a id="idm139690497319200">
      ⁠</a><p class="title"><strong>Example 1.30. HotelBookingAction.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateful
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"hotelBooking"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Restrict</span>(<span xmlns="" class="perl_String">"#{identity.loggedIn}"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> HotelBookingAction <span xmlns="" class="perl_Keyword">implements</span> HotelBooking
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">PersistenceContext</span>(type=EXTENDED)                                                <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> EntityManager em;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @In 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">private</span> User user;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>) @Out
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Hotel hotel;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>) 
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Out</span>(required=<span xmlns="" class="perl_Keyword">false</span>)                                                              <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Booking booking;
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>    @In
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> FacesMessages facesMessages;
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>    @In
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Events events;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @Logger 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">private</span> Log log;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">boolean</span> bookingValid;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @Begin                                                                            <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">selectHotel</span>(Hotel selectedHotel)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        hotel = em.<span xmlns="" class="perl_Function">merge</span>(selectedHotel);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">bookHotel</span>()
<span xmlns="" class="line">​</span>    {      
<span xmlns="" class="line">​</span>        booking = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Booking</span>(hotel, user);
<span xmlns="" class="line">​</span>        Calendar calendar = Calendar.<span xmlns="" class="perl_Function">getInstance</span>();
<span xmlns="" class="line">​</span>        booking.<span xmlns="" class="perl_Function">setCheckinDate</span>( calendar.<span xmlns="" class="perl_Function">getTime</span>() );
<span xmlns="" class="line">​</span>        calendar.<span xmlns="" class="perl_Function">add</span>(Calendar.<span xmlns="" class="perl_Function">DAY_OF_MONTH</span>, <span xmlns="" class="perl_Float">1</span>);
<span xmlns="" class="line">​</span>        booking.<span xmlns="" class="perl_Function">setCheckoutDate</span>( calendar.<span xmlns="" class="perl_Function">getTime</span>() );
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setBookingDetails</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        Calendar calendar = Calendar.<span xmlns="" class="perl_Function">getInstance</span>();
<span xmlns="" class="line">​</span>        calendar.<span xmlns="" class="perl_Function">add</span>(Calendar.<span xmlns="" class="perl_Function">DAY_OF_MONTH</span>, <span xmlns="" class="perl_DecVal">-1</span>);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> ( booking.<span xmlns="" class="perl_Function">getCheckinDate</span>().<span xmlns="" class="perl_Function">before</span>( calendar.<span xmlns="" class="perl_Function">getTime</span>() ) )
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>                facesMessages.<span xmlns="" class="perl_Function">addToControl</span>(<span xmlns="" class="perl_String">"checkinDate"</span>, 
<span xmlns="" class="line">​</span>                                           <span xmlns="" class="perl_String">"Check in date must be a future date"</span>);
<span xmlns="" class="line">​</span>                bookingValid=<span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span> ( !booking.<span xmlns="" class="perl_Function">getCheckinDate</span>().<span xmlns="" class="perl_Function">before</span>( booking.<span xmlns="" class="perl_Function">getCheckoutDate</span>() ) )
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>                facesMessages.<span xmlns="" class="perl_Function">addToControl</span>(<span xmlns="" class="perl_String">"checkoutDate"</span>, 
<span xmlns="" class="line">​</span>                                           <span xmlns="" class="perl_String">"Check out date must be later "</span> + 
<span xmlns="" class="line">​</span>                                           <span xmlns="" class="perl_String">"than check in date"</span>);
<span xmlns="" class="line">​</span>                bookingValid=<span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">else</span>
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>                bookingValid=<span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isBookingValid</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> bookingValid;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @End                                                                              <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">confirm</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        em.<span xmlns="" class="perl_Function">persist</span>(booking);
<span xmlns="" class="line">​</span>        facesMessages.<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"Thank you, #{user.name}, your confimation number "</span> + 
<span xmlns="" class="line">​</span>                          <span xmlns="" class="perl_String">" for #{hotel.name} is #{booki g.id}"</span>);
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"New booking: #{booking.id} for #{user.username}"</span>);
<span xmlns="" class="line">​</span>        events.<span xmlns="" class="perl_Function">raiseTransactionSuccessEvent</span>(<span xmlns="" class="perl_String">"bookingConfirmed"</span>);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @End
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">cancel</span>() {}
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @Remove                                                                           <img class="callout" alt="5" src="Common_Content/images/5.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">destroy</span>() {}
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								This bean uses an EJB3 <span class="emphasis"><em>extended persistence context</em></span>, so that any entity instances remain managed for the whole life cycle of the stateful session bean.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@Out</code> annotation declares that an attribute value is <span class="emphasis"><em>outjected</em></span> to a context variable after method invocations. In this case, the context variable named <code class="literal">hotel</code> will be set to the value of the <code class="literal">hotel</code> instance variable after every action listener invocation completes.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@Begin</code> annotation specifies that the annotated method begins a <span class="emphasis"><em>long-running conversation</em></span>, so the current conversation context will not be destroyed at the end of the request. Instead, it will be reassociated with every request from the current window, and destroyed either by timeout due to conversation inactivity or invocation of a matching <code class="literal">@End</code> method.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@End</code> annotation specifies that the annotated method ends the current long-running conversation, so the current conversation context will be destroyed at the end of the request.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/5.png" alt="5"/></p></td><td valign="top" align="left"><div class="para">
								This EJB remove method will be called when Seam destroys the conversation context. Do not forget to define this method!
							</div></td></tr></table></div></div></div></div><div class="para">
				<code class="literal">HotelBookingAction</code> contains all the action listener methods that implement selection, booking and booking confirmation, and holds state related to this work in its instance variables. This code is much cleaner and simpler than getting and setting <code class="literal">HttpSession</code> attributes.
			</div><div class="para">
				Even better, a user can have multiple isolated conversations per log in session. Log in, run a search, and navigate to different hotel pages in multiple browser tabs. You'll be able to work on creating two different hotel reservations at the same time. If you leave any one conversation inactive for long enough, Seam will eventually time out that conversation and destroy its state. If, after ending a conversation, you backtrack to a page of that conversation and try to perform an action, Seam will detect that the conversation was already ended, and redirect you to the search page.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690539545552">
      ⁠</a>1.6.4. The Seam Debug Page</h2></div></div></div><div class="para">
				The WAR also includes <code class="filename">seam-debug.jar</code>. To make the Seam debug page available, deploy this jar in <code class="literal">WEB-INF/lib</code> alongside Facelets, and set the debug property of the <code class="literal">init</code> component as shown here:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;core:init</span><span xmlns="" class="perl_Others"> jndi-pattern=</span><span xmlns="" class="perl_String">"@jndiPattern@"</span><span xmlns="" class="perl_Others"> debug=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				The debug page lets you browse and inspect the Seam components in any of the Seam contexts associated with your current log in session. Just point your browser at <a href="http://localhost:8080/seam-booking/debug.seam"> <code class="literal">http://localhost:8080/seam-booking/debug.seam</code> </a>.
			</div><div class="mediaobject" style="text-align: center"><img src="images/debug.png" align="middle" alt="The Seam Debug Page" style="text-align: middle"/></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nestedbooking">
      ⁠</a>1.7. Nested conversations: extending the Hotel Booking example</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690516546304">
      ⁠</a>1.7.1. Introduction</h2></div></div></div><div class="para">
				Long-running conversations let you easily maintain state consistency in an application, even in the face of multi-window operation and back-buttoning. Unfortunately, simply beginning and ending a long-running conversation is not always enough. Depending on the requirements of the application, inconsistencies between user expectations and application state can still result.
			</div><div class="para">
				The nested booking application extends the features of the hotel booking application to incorporate room selection. Each hotel has a list of available rooms from which the user can select. This requires the addition of a room selection page in the hotel reservation flow.
			</div><div class="mediaobject" style="text-align: center"><img src="images/nested-booking.png" align="middle" alt="Introduction" style="text-align: middle"/></div><div class="para">
				The user can now select any available room to be included in the booking. If room selection were left in the same conversation context, this could lead to issues with state consistency — if a conversation variable changes, it affects all windows operating within the same conversation context.
			</div><div class="para">
				For example, suppose the user clones the room selection screen in a new window. The user then selects the <span class="emphasis"><em>Wonderful Room</em></span> and proceeds to the confirmation screen. To check the cost of a more expensive room, the user returns to the original window, selects the <span class="emphasis"><em>Fantastic Suite</em></span> for booking, and again proceeds to confirmation. After reviewing the total cost, the user returns to the window showing <span class="emphasis"><em>Wonderful Room</em></span> to confirm.
			</div><div class="para">
				In this scenario, if all state were stored in the conversation, flexibility for multi-window operation within the same conversation would be limited. Nested conversations allow us to achieve correct behavior even when context can vary within the same conversation.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690518542768">
      ⁠</a>1.7.2. Understanding Nested Conversations</h2></div></div></div><div class="para">
				The following code shows the behavior of the hotel booking application with intended behavior for nested conversations. Again, think of the code as a set of steps to be read in sequence.
			</div><div class="example"><a id="idm139690532383648">
      ⁠</a><p class="title"><strong>Example 1.31. RoomPreferenceAction.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateful
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"roomPreference"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Restrict</span>(<span xmlns="" class="perl_String">"#{identity.loggedIn}"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> RoomPreferenceAction <span xmlns="" class="perl_Keyword">implements</span> RoomPreference 
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Logger 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">private</span> Log log;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @In <span xmlns="" class="perl_Keyword">private</span> Hotel hotel;                                                                  <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    @In <span xmlns="" class="perl_Keyword">private</span> Booking booking;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">DataModel</span>(value=<span xmlns="" class="perl_String">"availableRooms"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> List&lt;Room&gt; availableRooms;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">DataModelSelection</span>(value=<span xmlns="" class="perl_String">"availableRooms"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Room roomSelection;
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>, value=<span xmlns="" class="perl_String">"roomSelection"</span>)
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Out</span>(required=<span xmlns="" class="perl_Keyword">false</span>, value=<span xmlns="" class="perl_String">"roomSelection"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> Room room;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"availableRooms"</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">loadAvailableRooms</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        availableRooms = hotel.<span xmlns="" class="perl_Function">getAvailableRooms</span>(booking.<span xmlns="" class="perl_Function">getCheckinDate</span>(), 
<span xmlns="" class="line">​</span>                                                 booking.<span xmlns="" class="perl_Function">getCheckoutDate</span>());
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Retrieved #0 available rooms"</span>, availableRooms.<span xmlns="" class="perl_Function">size</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> BigDecimal <span xmlns="" class="perl_Function">getExpectedPrice</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Retrieving price for room #0"</span>, roomSelection.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> booking.<span xmlns="" class="perl_Function">getTotal</span>(roomSelection);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">Begin</span>(nested=<span xmlns="" class="perl_Keyword">true</span>)                                                                       <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">selectPreference</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Room selected"</span>);
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">room</span> = <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">roomSelection</span>;                                                       <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"payment"</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">requestConfirmation</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// all validations are performed through the s:validateAll, so checks are</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// already performed</span>
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Request confirmation from user"</span>);
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"confirm"</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">End</span>(beforeRedirect=<span xmlns="" class="perl_Keyword">true</span>)                                                                 <img class="callout" alt="4" src="Common_Content/images/4.png"/>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">cancel</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>        log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"ending conversation"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"cancel"</span>;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @Destroy @Remove                                                                      
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">destroy</span>() {}    
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="varname">hotel</code> instance is injected from the conversation context. The hotel is loaded through an <span class="emphasis"><em>extended persistence context</em></span> so that the entity remains managed throughout the conversation. This allows us to lazily load the <code class="varname">availableRooms</code> through an <code class="varname">@Factory</code> method by simply walking the association.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								When <code class="literal">@Begin(nested=true)</code> is encountered, a nested conversation is pushed onto the conversation stack. When executing within a nested conversation, components still have access to all outer conversation state, but setting any values in the nested conversation’s state container does not affect the outer conversation. In addition, nested conversations can exist concurrently stacked on the same outer conversation, allowing independent state for each.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="varname">roomSelection</code> is outjected to the conversation based on the <code class="varname">@DataModelSelection</code>. Note that because the nested conversation has an independent context, the <code class="varname">roomSelection</code> is only set into the new nested conversation. Should the user select a different preference in another window or tab a new nested conversation would be started.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/4.png" alt="4"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@End</code> annotation pops the conversation stack and resumes the outer conversation. The <code class="varname">roomSelection</code> is destroyed along with the conversation context.
							</div></td></tr></table></div></div></div></div><div class="para">
				When we begin a nested conversation, it is pushed onto the conversation stack. In the <code class="varname">nestedbooking</code> example, the conversation stack consists of the external long-running conversation (the booking) and each of the nested conversations (room selections).
			</div><div class="example"><a id="idm139690516550080">
      ⁠</a><p class="title"><strong>Example 1.32. rooms.xhtml</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"section"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Room Preference<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"section"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"room_selections_form"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"section"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> styleClass=</span><span xmlns="" class="perl_String">"output"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         value=</span><span xmlns="" class="perl_String">"No rooms available for the dates selected: "</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         rendered=</span><span xmlns="" class="perl_String">"#{availableRooms != null and availableRooms.rowCount == 0}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> styleClass=</span><span xmlns="" class="perl_String">"output"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         value=</span><span xmlns="" class="perl_String">"Rooms available for the dates selected: "</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         rendered=</span><span xmlns="" class="perl_String">"#{availableRooms != null and availableRooms.rowCount &gt; 0}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> styleClass=</span><span xmlns="" class="perl_String">"output"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{booking.checkinDate}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> styleClass=</span><span xmlns="" class="perl_String">"output"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{booking.checkoutDate}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;br/&gt;&lt;br/&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{availableRooms}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"room"</span>                             <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         rendered=</span><span xmlns="" class="perl_String">"#{availableRooms.rowCount &gt; 0}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Name<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>          #{room.name}
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Description<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>          #{room.description}
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Per Night<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{room.price}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;f:convertNumber</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"currency"</span><span xmlns="" class="perl_Others"> currencySymbol=</span><span xmlns="" class="perl_String">"$"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Action<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;h:commandLink</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"selectRoomPreference"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            action=</span><span xmlns="" class="perl_String">"#{roomPreference.selectPreference}"</span><span xmlns="" class="perl_Keyword">&gt;</span>Select<span xmlns="" class="perl_Keyword">&lt;/h:commandLink&gt;</span>      <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"entry"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"label"</span><span xmlns="" class="perl_Keyword">&gt;</span><span xmlns="" class="perl_DecVal">&amp;#160;</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"input"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;s:button</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"cancel"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Revise Dates"</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/book.xhtml"</span><span xmlns="" class="perl_Keyword">/&gt;</span>             <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>    
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span></pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								When requested from EL, the <code class="varname">#{availableRooms}</code> are loaded by the <code class="varname">@Factory</code> method defined in <code class="varname">RoomPreferenceAction</code>. The <code class="varname">@Factory</code> method will only be executed once to load the values into the current context as a <code class="varname">@DataModel</code> instance.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								Invoking the <code class="varname">#{roomPreference.selectPreference}</code> action results in the row being selected and set into the <code class="varname">@DataModelSelection</code>. This value is then outjected to the nested conversation context.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								Revising the dates simply returns to the <code class="varname">/book.xhtml</code>. Note that we have not yet nested a conversation (no room preference has been selected), so the current conversation can simply be resumed. The <code class="varname">&lt;s:button&gt;</code> component simply propagates the current conversation when displaying the <code class="varname">/book.xhtml</code> view.
							</div></td></tr></table></div></div></div></div><div class="para">
				Now that you have seen how to nest a conversation, the following code shows how we can confirm the booking of a selected room by extending the behavior of the <code class="varname">HotelBookingAction</code>.
			</div><div class="example"><a id="idm139690519905120">
      ⁠</a><p class="title"><strong>Example 1.33. HotelBookingAction.java</strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateful
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"hotelBooking"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Restrict</span>(<span xmlns="" class="perl_String">"#{identity.loggedIn}"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> HotelBookingAction <span xmlns="" class="perl_Keyword">implements</span> HotelBooking
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">PersistenceContext</span>(type=EXTENDED)
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> EntityManager em;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @In 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> User user;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>) @Out
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Hotel hotel;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>) 
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">Out</span>(required=<span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Booking booking;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">In</span>(required=<span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Room roomSelection;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @In
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> FacesMessages facesMessages;
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>   @In
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Events events;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @Logger 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Log log;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @Begin
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">selectHotel</span>(Hotel selectedHotel)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Selected hotel #0"</span>, selectedHotel.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>      hotel = em.<span xmlns="" class="perl_Function">merge</span>(selectedHotel);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">setBookingDates</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// the result will indicate whether or not to begin the nested conversation</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// as well as the navigation.  if a null result is returned, the nested</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// conversation will not begin, and the user will be returned to the current</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// page to fix validation issues</span>
<span xmlns="" class="line">​</span>      String result = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      Calendar calendar = Calendar.<span xmlns="" class="perl_Function">getInstance</span>();
<span xmlns="" class="line">​</span>      calendar.<span xmlns="" class="perl_Function">add</span>(Calendar.<span xmlns="" class="perl_Function">DAY_OF_MONTH</span>, <span xmlns="" class="perl_DecVal">-1</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// validate what we have received from the user so far</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> ( booking.<span xmlns="" class="perl_Function">getCheckinDate</span>().<span xmlns="" class="perl_Function">before</span>( calendar.<span xmlns="" class="perl_Function">getTime</span>() ) )
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         facesMessages.<span xmlns="" class="perl_Function">addToControl</span>(<span xmlns="" class="perl_String">"checkinDate"</span>, 
<span xmlns="" class="line">​</span>                                    <span xmlns="" class="perl_String">"Check in date must be a future date"</span>);
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">else</span> <span xmlns="" class="perl_Keyword">if</span> ( !booking.<span xmlns="" class="perl_Function">getCheckinDate</span>().<span xmlns="" class="perl_Function">before</span>( booking.<span xmlns="" class="perl_Function">getCheckoutDate</span>() ) )
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         facesMessages.<span xmlns="" class="perl_Function">addToControl</span>(<span xmlns="" class="perl_String">"checkoutDate"</span>, 
<span xmlns="" class="line">​</span>                                    <span xmlns="" class="perl_String">"Check out date must be later than check in date"</span>);
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">else</span>
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         result = <span xmlns="" class="perl_String">"rooms"</span>;
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> result;
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">bookHotel</span>()
<span xmlns="" class="line">​</span>   {      
<span xmlns="" class="line">​</span>      booking = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Booking</span>(hotel, user);
<span xmlns="" class="line">​</span>      Calendar calendar = Calendar.<span xmlns="" class="perl_Function">getInstance</span>();
<span xmlns="" class="line">​</span>      booking.<span xmlns="" class="perl_Function">setCheckinDate</span>( calendar.<span xmlns="" class="perl_Function">getTime</span>() );
<span xmlns="" class="line">​</span>      calendar.<span xmlns="" class="perl_Function">add</span>(Calendar.<span xmlns="" class="perl_Function">DAY_OF_MONTH</span>, <span xmlns="" class="perl_Float">1</span>);
<span xmlns="" class="line">​</span>      booking.<span xmlns="" class="perl_Function">setCheckoutDate</span>( calendar.<span xmlns="" class="perl_Function">getTime</span>() );
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">End</span>(root=<span xmlns="" class="perl_Keyword">true</span>)                                                                          <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">confirm</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// on confirmation we set the room preference in the booking.  the room preference</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">// will be injected based on the nested conversation we are in.</span>
<span xmlns="" class="line">​</span>      booking.<span xmlns="" class="perl_Function">setRoomPreference</span>(roomSelection);                                             <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      em.<span xmlns="" class="perl_Function">persist</span>(booking);
<span xmlns="" class="line">​</span>      facesMessages.<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"Thank you, #{user.name}, your confimation number"</span> +
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_String">" for #{hotel.name} is #{booking.id}"</span>);
<span xmlns="" class="line">​</span>      log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"New booking: #{booking.id} for #{user.username}"</span>);
<span xmlns="" class="line">​</span>      events.<span xmlns="" class="perl_Function">raiseTransactionSuccessEvent</span>(<span xmlns="" class="perl_String">"bookingConfirmed"</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">End</span>(root=<span xmlns="" class="perl_Keyword">true</span>, beforeRedirect=<span xmlns="" class="perl_Keyword">true</span>)                                                     <img class="callout" alt="3" src="Common_Content/images/3.png"/>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">cancel</span>() {}
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   @Destroy @Remove
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">destroy</span>() {}
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								Annotating an action with <code class="varname">@End(root=true)</code> ends the root conversation which effectively destroys the entire conversation stack. When any conversation is ended, its nested conversations are ended as well. As the root is the conversation that started it all, this is a simple way to destroy and release all state associated with a workspace once the booking is confirmed.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="varname">roomSelection</code> is only associated with the <code class="varname">booking</code> on user confirmation. While outjecting values to the nested conversation context will not impact the outer conversation, any objects injected from the outer conversation are injected by reference. This means that any changing to these objects will be reflected in the parent conversation as well as other concurrent nested conversations.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/3.png" alt="3"/></p></td><td valign="top" align="left"><div class="para">
								By simply annotating the cancellation action with <code class="varname">@End(root=true, beforeRedirect=true)</code> we can easily destroy and release all state associated with the workspace prior to redirecting the user back to the hotel selection view.
							</div></td></tr></table></div></div></div></div><div class="para">
				Feel free to deploy the application and test it yourself. Open many windows or tabs, and attempt combinations of various hotel and room preferences. Confirming a booking will always result in the correct hotel and room preference with the nested conversation model.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="dvdstore">
      ⁠</a>1.8. A complete application featuring Seam and jBPM: the DVD Store example</h1></div></div></div><div class="para">
			The DVD Store demo application shows the practical usage of jBPM for both task management and pageflow.
		</div><div class="para">
			The user screens take advantage of a jPDL pageflow to implement search and shopping cart functionality.
		</div><div class="mediaobject" style="text-align: center"><img src="images/dvdsearch.png" align="middle" alt="DVD Store example" style="text-align: middle"/></div><div class="para">
			The administration screens use jBPM to manage the approval and shipping cycle for orders. The business process can even be changed dynamically by selecting a different process definition.
		</div><div class="mediaobject" style="text-align: center"><img src="images/dvdtasks.png" align="middle" alt="DVD Store example" style="text-align: middle"/></div><div class="para">
			The Seam DVD Store demo can be run from the <code class="filename">dvdstore</code> directory, as with previous applications.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="blog">
      ⁠</a>1.9. Bookmarkable URLs with the Blog example</h1></div></div></div><div class="para">
			Seam makes it easy to implement applications which keep state on the server side. However, server-side state is not always appropriate, particularly for functionality that serves up content. For this, application state is often stored as part of the URL, so that any page can be accessed through a bookmark at any time. The blog example shows how to implement an application that supports bookmarking throughout, even on the search results page. This example demonstrates Seam's management of application state in the URL.
		</div><div class="mediaobject" style="text-align: center"><img src="images/blog.png" align="middle" alt="Blog example" style="text-align: middle"/></div><div class="para">
			The blog example demonstrates the use of "pull"-style model view control (MVC), where the view pulls data from components as it is being rendered rather than using action listener methods to retrieve and prepare data for the view.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690499608928">
      ⁠</a>1.9.1. Using "pull"-style MVC</h2></div></div></div><div class="para">
				This snippet from the <code class="literal">index.xhtml</code> facelets page displays a list of recent blog entries:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blog.recentBlogEntries}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"blogEntry"</span><span xmlns="" class="perl_Others"> rows=</span><span xmlns="" class="perl_String">"3"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"blogEntry"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h3&gt;</span>#{blogEntry.title}<span xmlns="" class="perl_Keyword">&lt;/h3&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;s:formattedText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.excerpt==null ? </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                                blogEntry.body : blogEntry.excerpt}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/entry.xhtml"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{blogEntry.excerpt!=null}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                propagation=</span><span xmlns="" class="perl_String">"none"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Read more..."</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"blogEntryId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span>        [Posted on<span xmlns="" class="perl_DecVal">&amp;#160;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.date}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> timeZone=</span><span xmlns="" class="perl_String">"#{blog.timeZone}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                             locale=</span><span xmlns="" class="perl_String">"#{blog.locale}"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"both"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>]
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_DecVal">&amp;#160;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/entry.xhtml"</span><span xmlns="" class="perl_Others"> propagation=</span><span xmlns="" class="perl_String">"none"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"[Link]"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"blogEntryId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span></pre><div class="para">
				If we navigate to this page from a bookmark, the <code class="literal">#{blog.recentBlogEntries}</code> data used by the <code class="literal">&lt;h:dataTable&gt;</code> is retrieved lazily — "pulled" — when required, by a Seam component named <code class="literal">blog</code>. This flow of control is the reverse of that used in traditional action-based web frameworks like Struts.
			</div><div class="example"><a id="idm139690447824368">
      ⁠</a><p class="title"><strong>Example 1.34. </strong></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting JAVA"><span xmlns="" class="line">​</span> @<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"blog"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(ScopeType.<span xmlns="" class="perl_Function">STATELESS</span>)
<span xmlns="" class="line">​</span>@AutoCreate
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> BlogService 
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   @In EntityManager entityManager;                                                                             <img class="callout" alt="1" src="Common_Content/images/1.png"/>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   @Unwrap                                                                                                      <img class="callout" alt="2" src="Common_Content/images/2.png"/>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> Blog <span xmlns="" class="perl_Function">getBlog</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> (Blog) entityManager.<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select distinct b from Blog b left join fetch b.blogEntries"</span>)
<span xmlns="" class="line">​</span>         .<span xmlns="" class="perl_Function">setHint</span>(<span xmlns="" class="perl_String">"org.hibernate.cacheable"</span>, <span xmlns="" class="perl_Keyword">true</span>)
<span xmlns="" class="line">​</span>         .<span xmlns="" class="perl_Function">getSingleResult</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/1.png" alt="1"/></p></td><td valign="top" align="left"><div class="para">
								This component uses a <span class="emphasis"><em>seam-managed persistence context</em></span>. Unlike the other examples we've seen, this persistence context is managed by Seam, instead of by the EJB3 container. The persistence context spans the entire web request, allowing us to avoid any exceptions that occur when accessing unfetched associations in the view.
							</div></td></tr><tr><td valign="top" align="left"><p><img class="callout" src="Common_Content/images/2.png" alt="2"/></p></td><td valign="top" align="left"><div class="para">
								The <code class="literal">@Unwrap</code> annotation tells Seam to provide the return value of the method — the <code class="literal">Blog</code> — instead of the actual <code class="literal">BlogService</code> component to clients. This is the Seam <span class="emphasis"><em>manager component pattern</em></span>.
							</div></td></tr></table></div></div></div></div><div class="para">
				This will store basic view content, but to bookmark form submission results like a search results page, there are several other required definitions.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690513881520">
      ⁠</a>1.9.2. Bookmarkable search results page</h2></div></div></div><div class="para">
				The blog example has a small form at the top right of each page that allows the user to search for blog entries. This is defined in <code class="literal">menu.xhtml</code>, which is included by the Facelets template <code class="literal">template.xhtml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"search"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{searchAction.searchPattern}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Search"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"/search.xhtml"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span></pre><div class="para">
				To implement a bookmarkable search results page, after the search form submission is processed, we must perform a browser redirect. Because the JSF view ID is used as the action outcome, Seam automatically redirects to the view ID when the form is submitted. We could also have defined a navigation rule as follows:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;navigation-rule&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;navigation-case&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;from-outcome&gt;</span>searchResults<span xmlns="" class="perl_Keyword">&lt;/from-outcome&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;to-view-id&gt;</span>/search.xhtml<span xmlns="" class="perl_Keyword">&lt;/to-view-id&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/navigation-case&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/navigation-rule&gt;</span></pre><div class="para">
				In that case, the form would have looked like this:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"search"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{searchAction.searchPattern}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Search"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"searchResults"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span></pre><div class="para">
				However, to get a bookmarkable URL like <code class="literal">http://localhost:8080/seam-blog/search/</code>, the values submitted with the form must be included in the URL. There is no easy way to do this with JSF, but with Seam, only two features are required: <span class="emphasis"><em>page parameters</em></span> and <span class="emphasis"><em>URL rewriting</em></span>. Both are defined here in <code class="literal">WEB-INF/pages.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;pages&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/search.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rewrite</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"/search/{searchPattern}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rewrite</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"/search"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"searchPattern"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{searchService.searchPattern}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span>
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>			
<span xmlns="" class="line">​</span>
</pre><div class="para">
				The page parameter instructs Seam to link the <code class="literal">searchPattern</code> request parameter to the value held by <code class="literal">#{searchService.searchPattern}</code>, whenever the search page is requested, and whenever a link to the search page is generated. Seam takes responsibility for maintaining the link between URL state and application state.
			</div><div class="para">
				The URL for a search on the term <em class="parameter"><code>book</code></em> would ordinarily be <code class="literal">http://localhost:8080/seam-blog/seam/search.xhtml?searchPattern=book</code>. Seam can simplify this URL by using a rewrite rule. The first rewrite rule, for the pattern <code class="literal">/search/{searchPattern}</code>, states that whenever a URL for search.xhtml contains a searchPattern request parameter, that URL can be compressed into a simplified URL. So, the earlier URL (<code class="literal">http://localhost:8080/seam-blog/seam/search.xhtml?searchPattern= book</code>) can instead be written as <code class="literal">http://localhost:8080/seam-blog/search/book</code>.
			</div><div class="para">
				As with page parameters, rewriting URLs is bidirectional. This means that Seam forwards requests for the simplified URL to the correct view, and it automatically generates the simplified view — users need not construct URLs. The entire process is handled transparently. The only requirement for rewriting URLs is to enable the rewrite filter in <code class="filename">components.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web:rewrite-filter</span><span xmlns="" class="perl_Others"> view-mapping=</span><span xmlns="" class="perl_String">"/seam/*"</span> <span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				The redirect takes us to the <code class="literal">search.xhtml</code> page:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{searchResults}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"blogEntry"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span> <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/entry.xhtml"</span><span xmlns="" class="perl_Others"> propagation=</span><span xmlns="" class="perl_String">"none"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              value=</span><span xmlns="" class="perl_String">"#{blogEntry.title}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"blogEntryId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span>      posted on 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.date}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> timeZone=</span><span xmlns="" class="perl_String">"#{blog.timeZone}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                           locale=</span><span xmlns="" class="perl_String">"#{blog.locale}"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"both"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span></pre><div class="para">
				Again, this uses "pull"-style MVC to retrieve the search results with Hibernate Search.
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"searchService"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> SearchService {
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @In
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> FullTextEntityManager entityManager;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String searchPattern;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"searchResults"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> List&lt;BlogEntry&gt; <span xmlns="" class="perl_Function">getSearchResults</span>() {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">if</span> (searchPattern==<span xmlns="" class="perl_Keyword">null</span> || <span xmlns="" class="perl_String">""</span>.<span xmlns="" class="perl_Function">equals</span>(searchPattern) )
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>      searchPattern = <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> entityManager.<span xmlns="" class="perl_Function">createQuery</span>(
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_String">"select be from BlogEntry be order by date desc"</span>
<span xmlns="" class="line">​</span>              ).<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">else</span>
<span xmlns="" class="line">​</span>        {
<span xmlns="" class="line">​</span>          Map&lt;String,<span xmlns="" class="perl_DataType">Float</span>&gt; boostPerField = <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String,<span xmlns="" class="perl_DataType">Float</span>&gt;();
<span xmlns="" class="line">​</span>          boostPerField.<span xmlns="" class="perl_Function">put</span>( <span xmlns="" class="perl_String">"title"</span>, <span xmlns="" class="perl_Float">4f</span> );
<span xmlns="" class="line">​</span>          boostPerField.<span xmlns="" class="perl_Function">put</span>( <span xmlns="" class="perl_String">"body"</span>, <span xmlns="" class="perl_Float">1f</span> );
<span xmlns="" class="line">​</span>          String[] productFields = {<span xmlns="" class="perl_String">"title"</span>, <span xmlns="" class="perl_String">"body"</span>};
<span xmlns="" class="line">​</span>          QueryParser parser = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">MultiFieldQueryParser</span>(productFields, 
<span xmlns="" class="line">​</span>                               <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">StandardAnalyzer</span>(), boostPerField);
<span xmlns="" class="line">​</span>          parser.<span xmlns="" class="perl_Function">setAllowLeadingWildcard</span>(<span xmlns="" class="perl_Keyword">true</span>);
<span xmlns="" class="line">​</span>          org.<span xmlns="" class="perl_Function">apache</span>.<span xmlns="" class="perl_Function">lucene</span>.<span xmlns="" class="perl_Function">search</span>.<span xmlns="" class="perl_Function">Query</span> luceneQuery;
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">try</span>
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>              luceneQuery = parser.<span xmlns="" class="perl_Function">parse</span>(searchPattern);
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">catch</span> (ParseException e)
<span xmlns="" class="line">​</span>            {
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>;
<span xmlns="" class="line">​</span>            }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">return</span> entityManager
<span xmlns="" class="line">​</span>            .<span xmlns="" class="perl_Function">createFullTextQuery</span>(luceneQuery, BlogEntry.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>            .<span xmlns="" class="perl_Function">setMaxResults</span>(<span xmlns="" class="perl_Float">100</span>)
<span xmlns="" class="line">​</span>            .<span xmlns="" class="perl_Function">getResultList</span>();
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getSearchPattern</span>()
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> searchPattern;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setSearchPattern</span>(String searchPattern)
<span xmlns="" class="line">​</span>    {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">searchPattern</span> = searchPattern;
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690517981024">
      ⁠</a>1.9.3. Using "push"-style MVC in a RESTful application</h2></div></div></div><div class="para">
				Push-style MVC is sometimes used to process RESTful pages, so Seam provides the notion of a <span class="emphasis"><em>page action</em></span>. The blog example uses a page action for the blog entry page, <code class="filename">entry.xhtml</code>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					We use push-style for the sake of an example, but this particular function would be simpler to implement with pull-style MVC.
				</div></div></div><div class="para">
				The <code class="literal">entryAction</code> component works much like an action class in a traditional push-MVC action-oriented framework like Struts.
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"entryAction"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(STATELESS)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EntryAction
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>    @In Blog blog;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @Out BlogEntry blogEntry;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">loadBlogEntry</span>(String id) <span xmlns="" class="perl_Keyword">throws</span> EntryNotFoundException {
<span xmlns="" class="line">​</span>        blogEntry = blog.<span xmlns="" class="perl_Function">getBlogEntry</span>(id);
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (blogEntry==<span xmlns="" class="perl_Keyword">null</span>) <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">EntryNotFoundException</span>(id);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>}
</pre><div class="para">
				Page actions are also declared in <code class="literal">pages.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/entry.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rewrite</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"/entry/{blogEntryId}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rewrite</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"/entry"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"blogEntryId"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           value=</span><span xmlns="" class="perl_String">"#{blogEntry.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{entryAction.loadBlogEntry(blogEntry.id)}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/post.xhtml"</span><span xmlns="" class="perl_Others"> login-required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rewrite</span><span xmlns="" class="perl_Others"> pattern=</span><span xmlns="" class="perl_String">"/post"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{postAction.post}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            if=</span><span xmlns="" class="perl_String">"#{validation.succeeded}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{postAction.invalid}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            if=</span><span xmlns="" class="perl_String">"#{validation.failed}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;navigation</span><span xmlns="" class="perl_Others"> from-action=</span><span xmlns="" class="perl_String">"#{postAction.post}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/index.xhtml"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/navigation&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"*"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{blog.hitCount.hit}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Note that the example uses page actions for post validation and the pageview counter. Also note the use of a parameter in the page action method binding. This is not a standard JSF EL feature, but Seam allows it both here and in JSF method bindings.
				</div></div></div><div class="para">
				When the <code class="filename">entry.xhtml</code> page is requested, Seam first binds the <code class="literal">blogEntryId</code> page parameter to the model. Remember that, because of URL rewriting, the blogEntryId parameter name won't appear in the URL. Seam then runs the page action, which retrieves the required data — the <code class="literal">blogEntry</code> — and places it in the Seam event context. Finally, it renders the following:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"blogEntry"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h3&gt;</span>#{blogEntry.title}<span xmlns="" class="perl_Keyword">&lt;/h3&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:formattedText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.body}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span>  [Posted on<span xmlns="" class="perl_DecVal">&amp;#160;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.date}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;f:convertDateTime</span><span xmlns="" class="perl_Others"> timeZone=</span><span xmlns="" class="perl_String">"#{blog.timeZone}"</span><span xmlns="" class="perl_Others"> locale=</span><span xmlns="" class="perl_String">"#{blog.locale}"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"both"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:outputText&gt;</span>]
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span></pre><div class="para">
				If the blog entry is not found in the database, the <code class="literal">EntryNotFoundException</code> exception is thrown. We want this exception to result in a 404 error, not a 505, so we annotate the exception class:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ApplicationException</span>(rollback=<span xmlns="" class="perl_Keyword">true</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">HttpError</span>(errorCode=HttpServletResponse.<span xmlns="" class="perl_Function">SC_NOT_FOUND</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EntryNotFoundException <span xmlns="" class="perl_Keyword">extends</span> Exception {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">EntryNotFoundException</span>(String id) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">super</span>(<span xmlns="" class="perl_String">"entry not found: "</span> + id);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
				An alternative implementation of the example does not use the parameter in the method binding:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"entryAction"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(STATELESS)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EntryAction {
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">In</span>(create=<span xmlns="" class="perl_Keyword">true</span>) 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">private</span> Blog blog;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    @In @Out
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> BlogEntry blogEntry;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">loadBlogEntry</span>() <span xmlns="" class="perl_Keyword">throws</span> EntryNotFoundException {
<span xmlns="" class="line">​</span>        blogEntry = blog.<span xmlns="" class="perl_Function">getBlogEntry</span>( blogEntry.<span xmlns="" class="perl_Function">getId</span>() );
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (blogEntry==<span xmlns="" class="perl_Keyword">null</span>) <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">EntryNotFoundException</span>(id);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/entry.xhtml"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{entryAction.loadBlogEntry}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"blogEntryId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{blogEntry.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span></pre><div class="para">
				The implementation used depends entirely upon personal preference.
			</div><div class="para">
				The blog example also demonstrates very simple password authentication, posting to the blog, page fragment caching and atom feed generation.
			</div></div></div></div></body></html>