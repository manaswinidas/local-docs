<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 13. The Seam Application Framework</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="framework">
      ⁠</a>Chapter 13. The Seam Application Framework</h1></div></div></div><div class="para">
		Seam makes it easy to create applications with annotated plain Java classes. We can make common programming tasks even easier by providing a set of pre-built components that are reusable with configuration or extension.
	</div><div class="para">
		The Seam Application Framework can reduce the amount of code you need to write in a web application for basic database access with either Hibernate or JPA. The framework contains a handful of simple classes that are easy to understand and to extend where required.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690498762640">
      ⁠</a>13.1. Introduction</h1></div></div></div><div class="para">
			The components provided by the Seam Application Framework can be used in two separate approaches. The first approach is to install and configure an instance of the component in <code class="filename">components.xml</code>, as with other built-in Seam components. For example, the following fragment (from <code class="filename">components.xml</code>) installs a component that performs basic CRUD operations for a <code class="literal">Person</code> entity:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-home</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personHome"</span><span xmlns="" class="perl_Others"> entity-class=</span><span xmlns="" class="perl_String">"eg.Person"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           entity-manager=</span><span xmlns="" class="perl_String">"#{personDatabase}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:id&gt;</span>#{param.personId}<span xmlns="" class="perl_Keyword">&lt;/framework:id&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/framework:entity-home&gt;</span>
</pre><div class="para">
			If this approach seems too XML-heavy, you can approach this through extension:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; { 
<span xmlns="" class="line">​</span>@In EntityManager personDatabase; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> EntityManager <span xmlns="" class="perl_Function">getEntityManager</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> personDatabase; 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The major advantage to the second approach is that the framework classes were designed for extension and customization, so it is easy to add extra functionality or override the built-in functionality.
		</div><div class="para">
			Another advantage is that you have the option of using EJB stateful session beans (or plain JavaBean components) as your classes:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateful 
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; 
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">implements</span> LocalPersonHome { }
</pre><div class="para">
			You can also make your classes stateless session beans. In this case you <span class="emphasis"><em>must</em></span> use injection to provide the persistence context, even if it is called <code class="literal">entityManager</code>:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateless 
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; 
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">implements</span> LocalPersonHome { 
<span xmlns="" class="line">​</span>  @In EntityManager entityManager; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> EntityManager <span xmlns="" class="perl_Function">getPersistenceContext</span>() { 
<span xmlns="" class="line">​</span>    entityManager; 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			At present, the Seam Application Framework provides four main built-in components: <code class="literal">EntityHome</code> and <code class="literal">HibernateEntityHome</code> for CRUD, and <code class="literal">EntityQuery</code> and <code class="literal">HibernateEntityQuery</code> for queries.
		</div><div class="para">
			The Home and Query components are written so that they can be session-, event- or conversation-scoped. The scope depends upon the state model you wish to use in your application.
		</div><div class="para">
			The Seam Application Framework works only with Seam-managed persistence contexts. By default, components will expect a persistence context named <code class="literal">entityManager</code>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690531828720">
      ⁠</a>13.2. Home objects</h1></div></div></div><div class="para">
			A Home object provides persistence operations for a particular entity class. Suppose we have our <code class="literal">Person</code> class:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Person { 
<span xmlns="" class="line">​</span>  @Id <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">Long</span> id; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String firstName; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String lastName; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Country nationality; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">//getters and setters... </span>
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			We can define a <code class="literal">personHome</code> component either through configuration:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-home</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personHome"</span><span xmlns="" class="perl_Others"> entity-class=</span><span xmlns="" class="perl_String">"eg.Person"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			Or through extension:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; {}
</pre><div class="para">
			A Home object provides operations like <code class="literal">persist()</code>, <code class="literal">remove()</code>, <code class="literal">update()</code> and <code class="literal">getInstance()</code>. Before you can call <code class="literal">remove()</code> or <code class="literal">update()</code>, you must set the identifier of the object you are interested in, using the <code class="literal">setId()</code> method.
		</div><div class="para">
			For example, we can use a Home directly from a JSF page:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Create Person<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    First name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{personHome.instance.firstName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    Last name:  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{personHome.instance.lastName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Create Person"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       action=</span><span xmlns="" class="perl_String">"#{personHome.persist}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
</pre><div class="para">
			It is useful to be able to refer to <code class="literal">Person</code> as <code class="literal">person</code>, so we will add that line to <code class="filename">components.xml</code> (if we are using configuration):
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{personHome.instance}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-home</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personHome"</span><span xmlns="" class="perl_Others"> entity-class=</span><span xmlns="" class="perl_String">"eg.Person"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			Or, if we are using extension, we can add a <code class="literal">@Factory</code> method to <code class="literal">PersonHome</code>:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; { 
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"person"</span>) 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Person <span xmlns="" class="perl_Function">initPerson</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">getInstance</span>(); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			This change simplifies our JSF page to the following:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Create Person<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    First name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.firstName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    Last name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.lastName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Create Person"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       action=</span><span xmlns="" class="perl_String">"#{personHome.persist}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
</pre><div class="para">
			This is all the code required to create new <code class="literal">Person</code> entries. If we want to be able to display, update, and delete pre-existing <code class="literal">Person</code> entries in the database, we need to be able to pass the entry identifier to the <code class="literal">PersonHome</code>. An excellent method is through page parameters:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/editPerson.jsp"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{personHome.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span>
</pre><div class="para">
			Now we can add the extra operations to our JSF page:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h1&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{!personHome.managed}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Create Person"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputText</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{personHome.managed}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Edit Person"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    First name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.firstName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    Last name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.lastName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Create Person"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{personHome.persist}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       rendered=</span><span xmlns="" class="perl_String">"#{!personHome.managed}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Update Person"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{personHome.update}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       rendered=</span><span xmlns="" class="perl_String">"#{personHome.managed}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Delete Person"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{personHome.remove}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       rendered=</span><span xmlns="" class="perl_String">"#{personHome.managed}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
</pre><div class="para">
			When we link to the page with no request parameters, the page will be displayed as a <span class="emphasis"><em>Create Person</em></span> page. When we provide a value for the <code class="literal">personId</code> request parameter, it will be an <span class="emphasis"><em>Edit Person</em></span> page.
		</div><div class="para">
			If we need to create <code class="literal">Person</code> entries with their nationality initialized, we can do so easily. Via configuration:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{personHome.instance}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-home</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personHome"</span><span xmlns="" class="perl_Others"> entity-class=</span><span xmlns="" class="perl_String">"eg.Person"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           new-instance=</span><span xmlns="" class="perl_String">"#{newPerson}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;component</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"newPerson"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"nationality"</span><span xmlns="" class="perl_Keyword">&gt;</span>#{country}<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/component&gt;</span>
</pre><div class="para">
			Or via extension:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; { 
<span xmlns="" class="line">​</span>  @In Country country; 
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"person"</span>) 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Person <span xmlns="" class="perl_Function">initPerson</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">getInstance</span>(); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> Person <span xmlns="" class="perl_Function">createInstance</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Person</span>(country); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The <code class="literal">Country</code> could be an object managed by another Home object, for example, <code class="literal">CountryHome</code>.
		</div><div class="para">
			To add more sophisticated operations (association management, etc.), we simply add methods to <code class="literal">PersonHome</code>.
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; { 
<span xmlns="" class="line">​</span>  @In Country country; 
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"person"</span>) 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Person <span xmlns="" class="perl_Function">initPerson</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">getInstance</span>(); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> Person <span xmlns="" class="perl_Function">createInstance</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Person</span>(country); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">migrate</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">getInstance</span>().<span xmlns="" class="perl_Function">setCountry</span>(country); 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">update</span>(); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The Home object raises an <code class="literal">org.jboss.seam.afterTransactionSuccess</code> event when a transaction (a call to <code class="literal">persist()</code>, <code class="literal">update()</code> or <code class="literal">remove()</code>) succeeds. By observing this event, we can refresh our queries when the underlying entities change. If we only want to refresh certain queries when a particular entry is persisted, updated, or removed, we can observe the <code class="literal">org.jboss.seam.afterTransactionSuccess.&lt;name&gt;</code> (where <code class="literal">&lt;name&gt;</code> is the name of the entity).
		</div><div class="para">
			The Home object automatically displays Faces messages when an operation succeeds. To customize these messages we can, again, use configuration:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;factory</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{personHome.instance}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-home</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personHome"</span><span xmlns="" class="perl_Others"> entity-class=</span><span xmlns="" class="perl_String">"eg.Person"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           new-instance=</span><span xmlns="" class="perl_String">"#{newPerson}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;framework:created-message&gt;</span>
<span xmlns="" class="line">​</span>    New person #{person.firstName} #{person.lastName} created
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/framework:created-message&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;framework:deleted-message&gt;</span>
<span xmlns="" class="line">​</span>    Person #{person.firstName} #{person.lastName} deleted
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/framework:deleted-message&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;framework:updated-message&gt;</span>
<span xmlns="" class="line">​</span>    Person #{person.firstName} #{person.lastName} updated
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/framework:updated-message&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/framework:entity-home&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;component</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"newPerson"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"eg.Person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"nationality"</span><span xmlns="" class="perl_Keyword">&gt;</span>#{country}<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/component&gt;</span>
</pre><div class="para">
			Or extension:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"personHome"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> PersonHome <span xmlns="" class="perl_Keyword">extends</span> EntityHome&lt;Person&gt; { 
<span xmlns="" class="line">​</span>  @In Country country; 
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Factory</span>(<span xmlns="" class="perl_String">"person"</span>) 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Person <span xmlns="" class="perl_Function">initPerson</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">getInstance</span>(); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> Person <span xmlns="" class="perl_Function">createInstance</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">Person</span>(country); 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getCreatedMessage</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">createValueExpression</span>(<span xmlns="" class="perl_String">"New person #{person.firstName} </span>
<span xmlns="" class="line">​</span>                                             #{person.<span xmlns="" class="perl_Function">lastName</span>} created<span xmlns="" class="perl_String">"); </span>
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getUpdatedMessage</span>() { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">createValueExpression</span>(<span xmlns="" class="perl_String">"Person #{person.firstName} </span>
<span xmlns="" class="line">​</span>                                         #{person.<span xmlns="" class="perl_Function">lastName</span>} updated<span xmlns="" class="perl_String">"); </span>
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">protected</span> String <span xmlns="" class="perl_Function">getDeletedMessage</span>() { 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">createValueExpression</span>(<span xmlns="" class="perl_String">"Person #{person.firstName} </span>
<span xmlns="" class="line">​</span>                                       #{person.<span xmlns="" class="perl_Function">lastName</span>} deleted<span xmlns="" class="perl_String">"); </span>
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The best way to specify messages is to put them in a resource bundle known to Seam — by default, the bundle named <code class="literal">messages</code>.
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>Person_created=<span xmlns="" class="perl_Keyword">New</span> person #{person.<span xmlns="" class="perl_Function">firstName</span>} #{person.<span xmlns="" class="perl_Function">lastName</span>} created 
<span xmlns="" class="line">​</span>Person_deleted=Person #{person.<span xmlns="" class="perl_Function">firstName</span>} #{person.<span xmlns="" class="perl_Function">lastName</span>} deleted 
<span xmlns="" class="line">​</span>Person_updated=Person #{person.<span xmlns="" class="perl_Function">firstName</span>} #{person.<span xmlns="" class="perl_Function">lastName</span>} updated
</pre><div class="para">
			This enables internationalization, and keeps your code and configuration clean of presentation concerns.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690526652432">
      ⁠</a>13.3. Query objects</h1></div></div></div><div class="para">
			If we need a list of all <code class="literal">Person</code> instances in the database, we can use a Query object, like the following.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-query</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"people"</span><span xmlns="" class="perl_Others"> ejbql=</span><span xmlns="" class="perl_String">"select p from Person p"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			We can use it from a JSF page:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>List of people<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.resultList}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/editPerson.jsp"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            value=</span><span xmlns="" class="perl_String">"#{person.firstName} #{person.lastName}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
</pre><div class="para">
			If you require pagination support:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-query</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"people"</span><span xmlns="" class="perl_Others"> ejbql=</span><span xmlns="" class="perl_String">"select p from Person p"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           order=</span><span xmlns="" class="perl_String">"lastName"</span><span xmlns="" class="perl_Others"> max-results=</span><span xmlns="" class="perl_String">"20"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			Use a page parameter to determine which page to display:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/searchPerson.jsp"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstResult"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.firstResult}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/page&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span>
</pre><div class="para">
			The JSF code for pagination control is slightly verbose, but manageable:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Search for people<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.resultList}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/editPerson.jsp"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            value=</span><span xmlns="" class="perl_String">"#{person.firstName} #{person.lastName}"</span><span xmlns="" class="perl_Keyword">&gt;</span>       
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/search.xhtml"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{people.previousExists}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        value=</span><span xmlns="" class="perl_String">"First Page"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstResult"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"0"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/search.xhtml"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{people.previousExists}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        value=</span><span xmlns="" class="perl_String">"Previous Page"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstResult"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.previousFirstResult}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/search.xhtml"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{people.nextExists}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        value=</span><span xmlns="" class="perl_String">"Next Page"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstResult"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.nextFirstResult}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/search.xhtml"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{people.nextExists}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        value=</span><span xmlns="" class="perl_String">"Last Page"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"firstResult"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.lastFirstResult}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span>
</pre><div class="para">
			Real search screens let the user enter optional search criteria to narrow the list of returned results. The Query object lets you specify optional restrictions to support this usecase:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;component</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"examplePerson"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Person"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;framework:entity-query</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"people"</span><span xmlns="" class="perl_Others"> ejbql=</span><span xmlns="" class="perl_String">"select p from Person p"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           order=</span><span xmlns="" class="perl_String">"lastName"</span><span xmlns="" class="perl_Others"> max-results=</span><span xmlns="" class="perl_String">"20"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;framework:restrictions&gt;</span> 
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>
<span xmlns="" class="line">​</span>      lower(firstName) like lower(concat(#{examplePerson.firstName},'%<span xmlns="" class="perl_Error">&amp;</span>'))
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>
<span xmlns="" class="line">​</span>      lower(lastName) like lower(concat(#{examplePerson.lastName},'%<span xmlns="" class="perl_Error">&amp;</span>'))
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/framework:restrictions&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/framework:entity-query&gt;</span>
</pre><div class="para">
			Notice the use of an "example" object.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h1&gt;</span>Search for people<span xmlns="" class="perl_Keyword">&lt;/h1&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    First name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{examplePerson.firstName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    Last name: <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{examplePerson.lastName}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Search"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"/search.jsp"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people.resultList}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/editPerson.jsp"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       value=</span><span xmlns="" class="perl_String">"#{person.firstName} #{person.lastName}"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;f:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"personId"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.id}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/s:link&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
</pre><div class="para">
			To refresh the query when the underlying entities change, we observe the <code class="literal">org.jboss.seam.afterTransactionSuccess</code> event:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.afterTransactionSuccess"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{people.refresh}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
</pre><div class="para">
			Or, to refresh the query when the person entity is persisted, updated or removed through <code class="literal">PersonHome</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.afterTransactionSuccess.Person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{people.refresh}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
</pre><div class="para">
			Unfortunately, Query objects do not work well with <span class="emphasis"><em>join fetch</em></span> queries. We do not recommend using pagination with these queries. You will need to implement your own method of total result number calculation by overriding <code class="literal">getCountEjbql()</code>.
		</div><div class="para">
			All of the examples in this section have shown re-use via configuration. It is equally possibly to re-use via extension:
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690516750032">
      ⁠</a>13.4. Controller objects</h1></div></div></div><div class="para">
			The class <code class="literal">Controller</code> and its subclasses (<code class="literal">EntityController</code>, <code class="literal">HibernateEntityController</code> and <code class="literal">BusinessProcessController</code>) are an optional part of the Seam Application Framework. These classes provide a convenient method to access frequently-used built-in components and component methods. They save keystrokes, and provide an excellent foothold for new users to explore the rich functionality built into Seam.
		</div><div class="para">
			For example, <code class="literal">RegisterAction</code> (from the Seam registration example) looks like this:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Stateless 
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"register"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> RegisterAction <span xmlns="" class="perl_Keyword">extends</span> EntityController <span xmlns="" class="perl_Keyword">implements</span> Register { 
<span xmlns="" class="line">​</span>  @In <span xmlns="" class="perl_Keyword">private</span> User user; 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">register</span>() { 
<span xmlns="" class="line">​</span>    List existing = <span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select u.username from </span>
<span xmlns="" class="line">​</span>                                 User u where u.<span xmlns="" class="perl_Function">username</span>=:username<span xmlns="" class="perl_String">").</span>
<span xmlns="" class="line">​</span>                                 <span xmlns="" class="perl_Function">setParameter</span>(<span xmlns="" class="perl_String">"username"</span>, 
<span xmlns="" class="line">​</span>                                 user.<span xmlns="" class="perl_Function">getUsername</span>()).<span xmlns="" class="perl_Function">getResultList</span>(); 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> ( existing.<span xmlns="" class="perl_Function">size</span>()==<span xmlns="" class="perl_Float">0</span> ) { 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Function">persist</span>(user); 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"Registered new user #{user.username}"</span>); 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"/registered.jspx"</span>; 
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">else</span> { 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Function">addFacesMessage</span>(<span xmlns="" class="perl_String">"User #{user.username} already exists"</span>); 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">null</span>; 
<span xmlns="" class="line">​</span>    } 
<span xmlns="" class="line">​</span>  } 
<span xmlns="" class="line">​</span>}
</pre></div></div></body></html>