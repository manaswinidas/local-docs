<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 26. Spring Framework integration</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="spring">
      ⁠</a>Chapter 26. Spring Framework integration</h1></div></div></div><div class="para">
		The Spring Framework is part of the Seam inversion-of-control (IoC) module. It allows easy migration of Spring-based projects to Seam, and benefits Spring applications with Seam features, such as conversations and a more sophisticated persistence context management.
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
			The Spring integration code is included in the <code class="literal">jboss-seam-ioc</code> library. This library is a required dependency for all Seam-Spring integration techniques covered in this chapter.
		</div></div></div><div class="para">
		Seam's support for Spring gives you:
	</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
				Seam component injection into Spring beans,
			</div></li><li class="listitem"><div class="para">
				Spring bean injection into Seam components,
			</div></li><li class="listitem"><div class="para">
				Spring bean to Seam component transformation,
			</div></li><li class="listitem"><div class="para">
				the ability to place Spring beans in any Seam context,
			</div></li><li class="listitem"><div class="para">
				the ability to start a spring WebApplicationContext with a Seam component,
			</div></li><li class="listitem"><div class="para">
				support for using Spring PlatformTransactionManagement with your Seam-based applications,
			</div></li><li class="listitem"><div class="para">
				support for using a Seam-managed replacement for Spring's <code class="literal">OpenEntityManagerInViewFilter</code> and <code class="literal">OpenSessionInViewFilter</code>, and
			</div></li><li class="listitem"><div class="para">
				support for backing <code class="literal">@Asynchronous</code> calls with Spring <code class="literal">TaskExecutors</code>.
			</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690518661792">
      ⁠</a>26.1. Injecting Seam components into Spring beans</h1></div></div></div><div class="para">
			Inject Seam component instances into Spring beans with the <code class="literal">&lt;seam:instance/&gt;</code> namespace handler. To enable the Seam namespace handler, the Seam namespace must first be added to the Spring beans definition file:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;beans</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://www.springframework.org/schema/beans"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xmlns:seam=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/spring-seam"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_String">"http://www.springframework.org/schema/beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://jboss.com/products/seam/spring-seam</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://jboss.com/products/seam/spring-seam-2.2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
</pre><div class="para">
			Any Seam component can now be injected into any Spring bean, like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span><span xmlns="" class="perl_Others"> scope=</span><span xmlns="" class="perl_String">"prototype"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someProperty"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;seam:instance</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someComponent"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			You can use an EL expression instead of a component name:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span><span xmlns="" class="perl_Others"> scope=</span><span xmlns="" class="perl_String">"prototype"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someProperty"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;seam:instance</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{someExpression}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			You can inject a Seam component instance into a Spring bean by using a Spring bean ID, like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;seam:instance</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someComponent"</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSeamComponentInstance"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span><span xmlns="" class="perl_Others"> scope=</span><span xmlns="" class="perl_String">"prototype"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someProperty"</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"someSeamComponentInstance"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
			However, Spring, unlike Seam, was not designed to support a stateful component model with multiple contexts. Spring injection does not occur at method invocation time, but when the Spring bean is instantiated.
		</div><div class="para">
			The instance available when the bean is instantiated will be used for the entire life of the bean. Say you inject a Seam conversation-scoped component instance directly into a singleton Spring bean — that singleton will hold a reference to the same instance long after the conversation is over. This is called <span class="emphasis"><em>scope impedance</em></span>.
		</div><div class="para">
			Seam bijection maintains scope impedance naturally as an invocation flows through the system. In Spring, we must inject a proxy of the Seam component, and resolve the reference when the proxy is invoked.
		</div><div class="para">
			The <code class="literal">&lt;seam:instance/&gt;</code> tag lets us automatically proxy the Seam component.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;seam:instance</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"seamManagedEM"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">               name=</span><span xmlns="" class="perl_String">"someManagedEMComponent"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">               proxy=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"entityManager"</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"seamManagedEM"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			Here, we see one example of using a Seam-managed persistence context from a Spring bean. See the section on <a class="xref" href="spring.html#spring-persistence">Section 26.6, “Using a Seam-Managed Persistence Context in Spring”</a> for a more robust way to use Seam-managed persistence contexts as a replacement for the Spring <code class="literal">OpenEntityManagerInView</code> filter.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690450932720">
      ⁠</a>26.2. Injecting Spring beans into Seam components</h1></div></div></div><div class="para">
			You can inject a Spring bean into a Seam component instance either by using an EL expression, or by making the Spring bean a Seam component.
		</div><div class="para">
			The simplest approach is to access the Spring beans with EL.
		</div><div class="para">
			The Spring <code class="literal">DelegatingVariableResolver</code> assists Spring integration with JavaServer Faces (JSF). This <code class="literal">VariableResolver</code> uses EL with bean IDs to make Spring beans available to JSF. You will need to add the <code class="literal">DelegatingVariableResolver</code> to <code class="filename">faces-config.xml</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;application&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;variable-resolver&gt;</span> 
<span xmlns="" class="line">​</span>    org.springframework.web.jsf.DelegatingVariableResolver 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/variable-resolver&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/application&gt;</span>
</pre><div class="para">
			You can then inject Spring beans using <code class="literal">@In</code>:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">In</span>(<span xmlns="" class="perl_String">"#{bookingService}"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> BookingService bookingService;
</pre><div class="para">
			Spring beans are not limited to injection. They can be used wherever EL expressions are used in Seam: process and pageflow definitions, working memory assertions, etc.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690465817792">
      ⁠</a>26.3. Making a Spring bean into a Seam component</h1></div></div></div><div class="para">
			The <code class="literal">&lt;seam:component/&gt;</code> namespace handler can be used to transform any Spring bean into a Seam component. Just add the <code class="literal">&lt;seam:component/&gt;</code> tag to the declaration of the bean that you want to make into a Seam component:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span><span xmlns="" class="perl_Others"> scope=</span><span xmlns="" class="perl_String">"prototype"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;seam:component/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
			By default, <code class="literal">&lt;seam:component/&gt;</code> creates a stateless Seam component with the class and name provided in the bean definition. Occasionally — when a <code class="literal">FactoryBean</code> is used, for example — the Spring bean class may differ from the class listed in the bean definition. In this case, specify the <code class="literal">class</code> explicitly. You should also explicitly specify a Seam component name where there is a potential naming conflict.
		</div><div class="para">
			If you want the Spring bean to be managed in a particular Seam scope, use the <code class="literal">scope</code> attribute of <code class="literal">&lt;seam:component/&gt;</code>. If the Seam scope specified is anything other than <code class="literal">STATELESS</code>, you must scope your Spring bean to <code class="literal">prototype</code>. Pre-existing Spring beans usually have a fundamentally stateless character, so this attribute is not usually necessary.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690535480544">
      ⁠</a>26.4. Seam-scoped Spring beans</h1></div></div></div><div class="para">
			With the Seam integration package, you can also use Seam's contexts as Spring 2.0-style <span class="emphasis"><em>custom scopes</em></span>, which lets you declare any Spring bean in any Seam context. However, because Spring's component model was not built to support statefulness, this feature should be used with care. In particular, there are problems with clustering session- or conversation-scoped Spring beans, and care must be taken when injecting a bean or component from a wider scope into a bean of narrower scope.
		</div><div class="para">
			Specify <code class="literal">&lt;seam:configure-scopes/&gt;</code> in a Spring bean factory configuration to make all Seam scopes available to Spring beans as custom scopes. To associate a Spring bean with a particular Seam scope, specify the desired scope in the <code class="literal">scope</code> attribute of the bean definition.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Only needs to be specified once per bean factory--&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;seam:configure-scopes/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      scope=</span><span xmlns="" class="perl_String">"seam.CONVERSATION"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			You can change the scope name's prefix by specifying the <code class="literal">prefix</code> attribute in the <code class="literal">configure-scopes</code> definition. (The default prefix is <code class="literal">seam.</code>.)
		</div><div class="para">
			By default, a Spring component instance that is registered this way is not created automatically when referenced with <code class="literal">@In</code>. To automatically create an instance, you must either specify <code class="literal">@In(create=true)</code> at the injection point (to auto-create a specific bean), or use the <code class="literal">default-auto-create</code> attribute of <code class="literal">configure-scopes</code> to auto-create all Seam-scoped Spring beans.
		</div><div class="para">
			The latter approach lets you inject Seam-scoped Spring beans into other Spring beans without using <code class="literal">&lt;seam:instance/&gt;</code>. However, you must be careful to maintain scope impedance. Normally, you would specify <code class="literal">&lt;aop:scoped-proxy/&gt;</code> in the bean definition, but Seam-scoped Spring beans are not compatible with <code class="literal">&lt;aop:scoped-proxy/&gt;</code>. Therefore, to inject a Seam-scoped Spring bean into a singleton, use <code class="literal">&lt;seam:instance/&gt;</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"SomeSpringBeanClass"</span><span xmlns="" class="perl_Others"> scope=</span><span xmlns="" class="perl_String">"seam.CONVERSATION"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"someSingleton"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someSeamScopedSpringBean"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;seam:instance</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"someSpringBean"</span><span xmlns="" class="perl_Others"> proxy=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="spring-transactions">
      ⁠</a>26.5. Using Spring PlatformTransactionManagement</h1></div></div></div><div class="para">
			Spring's extensible transaction management provides support for many transaction APIs, including the Java Persistence API (JPA), Hibernate, Java Data Objects (JDO), and Java Transaction API (JTA). It also exposes support for many advanced features such as nested transactions. Spring also provides tight integration with many application server TransactionManagers, such as Websphere and Weblogic, and supports full Java EE transaction propagation rules, such as <code class="literal">REQUIRES_NEW</code> and <code class="literal">NOT_SUPPORTED</code>. See the <a href="http://static.springframework.org/spring/docs/2.0.x/reference/ transaction.html">Spring Documentation</a> for further information.
		</div><div class="para">
			To configure Seam to use Spring transactions, enable the <code class="literal">SpringTransaction</code> component, like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;spring:spring-transaction</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        platform-transaction-manager=</span><span xmlns="" class="perl_String">"#{transactionManager}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			The <code class="literal">spring:spring-transaction</code> component will utilizes Spring's transaction synchronization capabilities for synchronization callbacks.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="spring-persistence">
      ⁠</a>26.6. Using a Seam-Managed Persistence Context in Spring</h1></div></div></div><div class="para">
			Some of Seam's most powerful features are its conversation scope, and the ability to keep an <code class="literal">EntityManager</code> open for the life of a conversation. These eliminate many problems associated with detaching and reattaching entities, and mitigate the occurrence of <code class="exceptionname">LazyInitializationException</code>. Spring does not provide a way to manage persistence contexts beyond the scope of a single web request (<code class="literal">OpenEntityManagerInViewFilter</code>).
		</div><div class="para">
			Seam brings conversation-scoped persistence context capabilities to Spring applications by allowing Spring developers to access a Seam-managed persistence context with the JPA tools provided with Spring (<code class="literal">PersistenceAnnotationBeanPostProcessor</code>, <code class="literal">JpaTemplate</code>, etc.)
		</div><div class="para">
			This integration work provides:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					transparent access to a Seam-managed persistence context using Spring-provided tools
				</div></li><li class="listitem"><div class="para">
					access to Seam conversation-scoped persistence contexts in a non-web request — for example, an asynchronous Quartz job
				</div></li><li class="listitem"><div class="para">
					the ability to use Seam-managed persistence contexts with Spring-managed transactions. This requires manual flushing of the persistent context.
				</div></li></ul></div><div class="para">
			Spring's persistence context propagation model allows only one open <code class="literal">EntityManager</code> per <code class="literal">EntityManagerFactory</code>, so the Seam integration works by wrapping an <code class="literal">EntityManagerFactory</code> around a Seam-managed persistence context, like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"seamEntityManagerFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    class=</span><span xmlns="" class="perl_String">"org.jboss.seam.ioc.spring.SeamManagedEntityManagerFactoryBean"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"persistenceContextName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"entityManager"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			Here, <code class="literal">persistenceContextName</code> is the name of the Seam-managed persistence context component. By default, this <code class="literal">EntityManagerFactory</code> has a <code class="literal">unitName</code> equal to the Seam component name — in this case, <code class="literal">entityManager</code>. If you wish to provide a different <code class="literal">unitName</code>, you can provide a <code class="literal">persistenceUnitName</code> like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"seamEntityManagerFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    class=</span><span xmlns="" class="perl_String">"org.jboss.seam.ioc.spring.SeamManagedEntityManagerFactoryBean"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"persistenceContextName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"entityManager"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"persistenceUnitName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bookingDatabase:extended"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			This <code class="literal">EntityManagerFactory</code> can now be used in any Spring-provided tools; in this case, you can use Spring's <code class="literal">PersistenceAnnotationBeanPostProcessor</code> just as you would in Spring.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.springframework.orm.jpa.support</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">             .PersistenceAnnotationBeanPostProcessor"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			If you define your real <code class="literal">EntityManagerFactory</code> in Spring, but wish to use a Seam-managed persistence context, you can tell the <code class="literal">PersistenceAnnotationBeanPostProcessor</code> your desired default <code class="literal">persistenctUnitName</code> by specifying the <code class="literal">defaultPersistenceUnitName</code> property.
		</div><div class="para">
			The <code class="filename">applicationContext.xml</code> might look like:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"entityManagerFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.springframework.orm.jpa.LocalEntityManagerFactoryBean"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"persistenceUnitName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bookingDatabase"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"seamEntityManagerFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    class=</span><span xmlns="" class="perl_String">"org.jboss.seam.ioc.spring.SeamManagedEntityManagerFactoryBean"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"persistenceContextName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"entityManager"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"persistenceUnitName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bookingDatabase:extended"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.springframework.orm.jpa</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">             .support.PersistenceAnnotationBeanPostProcessor"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"defaultPersistenceUnitName"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            value=</span><span xmlns="" class="perl_String">"bookingDatabase:extended"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			The <code class="filename">component.xml</code> might look like:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;persistence:managed-persistence-context</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"entityManager"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    auto-create=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Others"> entity-manager-factory=</span><span xmlns="" class="perl_String">"#{entityManagerFactory}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			<code class="literal">JpaTemplate</code> and <code class="literal">JpaDaoSupport</code> have an identical configuration in a Spring-based persistence context and in a normal Seam-managed persistence context.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"bookingService"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.jboss.seam.example.spring.BookingService"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"entityManagerFactory"</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"seamEntityManagerFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="spring-hibernate">
      ⁠</a>26.7. Using a Seam-Managed Hibernate Session in Spring</h1></div></div></div><div class="para">
			Spring integration into Seam also provides support for complete Spring tool access to a Seam-managed Hibernate session. This integration is very similar to the JPA integration — see <a class="xref" href="spring.html#spring-persistence">Section 26.6, “Using a Seam-Managed Persistence Context in Spring”</a> for details.
		</div><div class="para">
			Spring's propagation model allows only one open <code class="literal">EntityManager</code> per <code class="literal">EntityManagerFactory</code> to be available to Spring tools, so Seam integrates by wrapping a proxy <code class="literal">SessionFactory</code> around a Seam-managed Hibernate session context.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"seamSessionFactory"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    class=</span><span xmlns="" class="perl_String">"org.jboss.seam.ioc.spring.SeamManagedSessionFactoryBean"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"sessionName"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"hibernateSession"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
</pre><div class="para">
			Here, <code class="literal">sessionName</code> is the name of the <code class="literal">persistence:managed-hibernate-session</code> component. This <code class="literal">SessionFactory</code> can then be used with any Spring-provided tool. The integration also provides support for calls to <code class="literal">SessionFactory.getCurrentInstance()</code>, provided that <code class="literal">getCurrentInstance()</code> is called on the <code class="literal">SeamManagedSessionFactory</code>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690462767024">
      ⁠</a>26.8. Spring Application Context as a Seam Component</h1></div></div></div><div class="para">
			Although it is possible to use the Spring <code class="literal">ContextLoaderListener</code> to start your application's Spring <code class="literal">ApplicationContext</code>, there are some limitations: the Spring <code class="literal">ApplicationContext</code> must be started after the <code class="literal">SeamListener</code>, and starting a Spring <code class="literal">ApplicationContext</code> for use in Seam unit and integration tests can be complicated.
		</div><div class="para">
			To overcome these limitations, the Spring integration includes a Seam component that can start a Spring <code class="literal">ApplicationContext</code>. To use this component, place the <code class="literal">&lt;spring:context-loader/&gt;</code> definition in the <code class="filename">components.xml</code> file. Specify your Spring context file location in the <code class="literal">config-locations</code> attribute. If more than one configuration file is required, you can place them in the nested <code class="literal">&lt;spring:config-locations/&gt;</code> element, as per standard <code class="filename">components.xml</code> multi-value practices.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;components</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/components"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:spring=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/spring"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_String">"http://jboss.com/products/seam/components</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/components-2.2.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/spring</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/spring-2.2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;spring:context-loader</span><span xmlns="" class="perl_Others"> config-locations=</span>
<span xmlns="" class="line">​</span>                           <span xmlns="" class="perl_String">"/WEB-INF/applicationContext.xml"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/components&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690540095264">
      ⁠</a>26.9. Using a Spring TaskExecutor for <code class="literal">@Asynchronous</code></h1></div></div></div><div class="para">
			Spring provides an abstraction for executing code asynchronously, called a <code class="literal">TaskExecutor</code>. The Spring-Seam integration lets you use a Spring <code class="literal">TaskExecutor</code> to execute immediate <code class="literal">@Asynchronous</code> method calls. To enable this functionality, install the <code class="literal">SpringTaskExecutorDispatchor</code> and provide a Spring -bean defined <code class="literal">taskExecutor</code> like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;spring:task-executor-dispatcher</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        task-executor=</span><span xmlns="" class="perl_String">"#{springThreadPoolTaskExecutor}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			Because a Spring <code class="literal">TaskExecutor</code> does not support scheduling asynchronous events, you can provide handling with a fallback Seam <code class="literal">Dispatcher</code>, like so:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">  Install a ThreadPoolDispatcher to handle scheduled asynchronous event</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">--&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;core:thread-pool-dispatcher</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"threadPoolDispatcher"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- Install the SpringDispatcher as default --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;spring:task-executor-dispatcher</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        task-executor=</span><span xmlns="" class="perl_String">"#{springThreadPoolTaskExecutor}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        schedule-dispatcher=</span><span xmlns="" class="perl_String">"#{threadPoolDispatcher}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre></div></div></body></html>