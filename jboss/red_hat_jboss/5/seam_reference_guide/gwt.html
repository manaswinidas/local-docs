<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 25. Seam and the Google Web Toolkit</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="gwt">
      ⁠</a>Chapter 25. Seam and the Google Web Toolkit</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Google Web Toolkit integration is a Technology Preview</strong></p></div><div class="admonition"><div class="para">
			Technology Preview features are not fully supported under Red Hat subscription level agreements (SLAs), may not be functionally complete, and are not intended for production use. However, these features provide early access to upcoming product innovations, enabling customers to test functionality and provide feedback during the development process. As Red Hat considers making future iterations of Technology Preview features generally available, we will provide commercially reasonable efforts to resolve any reported issues that customers experience when using these features.
		</div></div></div><div class="para">
		If you prefer to develop dynamic AJAX (Asynchronous Java and XML) applications with the Google Web Toolkit (GWT), Seam provides an integration layer that allows GWT widgets to interact directly with Seam components.
	</div><div class="para">
		In this section, we assume you are already familiar with GWT Tools, and focus only on the Seam integration. You can find more information at <a href="http://code.google.com/webtoolkit/">http://code.google.com/webtoolkit/ </a>.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690454978464">
      ⁠</a>25.1. Configuration</h1></div></div></div><div class="para">
			You do not need to make any configuration changes to use GWT in a Seam application — all you need to do is install the Seam Resource Servlet. See <a class="xref" href="configuration.html">Chapter 28, <em>Configuring Seam and packaging Seam applications</em></a> for details.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690500969664">
      ⁠</a>25.2. Preparing your component</h1></div></div></div><div class="para">
			To prepare a Seam component to be called with GWT, you must first create both synchronous and asynchronous service interfaces for the methods you wish to call. Both interfaces should extend the GWT interface <code class="literal">com.google.gwt.user.client.rpc.RemoteService</code>:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> MyService <span xmlns="" class="perl_Keyword">extends</span> RemoteService { 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">askIt</span>(String question);      
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The asynchronous interface should be identical, except for an additional <code class="literal">AsyncCallback</code> parameter for each of the methods it declares:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> MyServiceAsync <span xmlns="" class="perl_Keyword">extends</span> RemoteService { 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">askIt</span>(String question, AsyncCallback callback); 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The asynchronous interface (in this case, <code class="literal">MyServiceAsync</code>) is implemented by GWT, and should never be implemented directly.
		</div><div class="para">
			The next step is to create a Seam component that implements the synchronous interface:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"org.jboss.seam.example.remoting.gwt.client.MyService"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> ServiceImpl <span xmlns="" class="perl_Keyword">implements</span> MyService {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @WebRemote
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">askIt</span>(String question) {
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">if</span> (!<span xmlns="" class="perl_Function">validate</span>(question)) {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> IllegalStateException(<span xmlns="" class="perl_String">"Hey, this should not happen, "</span> + 
<span xmlns="" class="line">​</span>                                      <span xmlns="" class="perl_String">"I checked on the client, but "</span> +
<span xmlns="" class="line">​</span>                                      <span xmlns="" class="perl_String">"it's always good to double check."</span>);
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_String">"42. Its the real question that you seek now."</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">validate</span>(String q) {
<span xmlns="" class="line">​</span>    ValidationUtility util = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ValidationUtility</span>();
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> util.<span xmlns="" class="perl_Function">isValid</span>(q);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			The Seam component's name must match the fully-qualified name of the GWT client interface (as shown), or the Seam Resource Servlet will not be able to find it when a client makes a GWT call. Methods that GWT will make accessible must be annotated with <code class="literal">@WebRemote</code>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690531674592">
      ⁠</a>25.3. Hooking up a GWT widget to the Seam component</h1></div></div></div><div class="para">
			Next, write a method that returns the asynchronous interface to the component. This method can be located inside the widget class, and will be used by the widget to obtain a reference to the asynchronous client stub:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> MyServiceAsync <span xmlns="" class="perl_Function">getService</span>() {       
<span xmlns="" class="line">​</span>  String endpointURL = GWT.<span xmlns="" class="perl_Function">getModuleBaseURL</span>() + <span xmlns="" class="perl_String">"seam/resource/gwt"</span>;      
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>  MyServiceAsync svc = (MyServiceAsync) GWT.<span xmlns="" class="perl_Function">create</span>(MyService.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>  ((ServiceDefTarget) svc).<span xmlns="" class="perl_Function">setServiceEntryPoint</span>(endpointURL);
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">return</span> svc;     
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			Finally, write the widget code that invokes the method on the client stub. The following example creates a simple user interface with a label, text input, and a button:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AskQuestionWidget <span xmlns="" class="perl_Keyword">extends</span> Composite {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> AbsolutePanel panel = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">AbsolutePanel</span>();
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">AskQuestionWidget</span>() {      
<span xmlns="" class="line">​</span>    Label lbl = <span xmlns="" class="perl_Keyword">new</span> Label(<span xmlns="" class="perl_String">"OK, what do you want to know?"</span>);
<span xmlns="" class="line">​</span>    panel.<span xmlns="" class="perl_Function">add</span>(lbl);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_DataType">final</span> TextBox box = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">TextBox</span>();
<span xmlns="" class="line">​</span>    box.<span xmlns="" class="perl_Function">setText</span>(<span xmlns="" class="perl_String">"What is the meaning of life?"</span>);
<span xmlns="" class="line">​</span>    panel.<span xmlns="" class="perl_Function">add</span>(box);
<span xmlns="" class="line">​</span>    Button ok = <span xmlns="" class="perl_Keyword">new</span> Button(<span xmlns="" class="perl_String">"Ask"</span>);
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    ok.<span xmlns="" class="perl_Function">addClickListener</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ClickListener</span>() {
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">onClick</span>(Widget w) {
<span xmlns="" class="line">​</span>        ValidationUtility valid = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">ValidationUtility</span>();
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">if</span> (!valid.<span xmlns="" class="perl_Function">isValid</span>(box.<span xmlns="" class="perl_Function">getText</span>())) {
<span xmlns="" class="line">​</span>          Window.<span xmlns="" class="perl_Function">alert</span>(<span xmlns="" class="perl_String">"A question has to end with a '?'"</span>);
<span xmlns="" class="line">​</span>        } <span xmlns="" class="perl_Keyword">else</span> {
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Function">askServer</span>(box.<span xmlns="" class="perl_Function">getText</span>());
<span xmlns="" class="line">​</span>        } 
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>    });
<span xmlns="" class="line">​</span>    panel.<span xmlns="" class="perl_Function">add</span>(ok);
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">initWidget</span>(panel);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">askServer</span>(String text) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">getService</span>().<span xmlns="" class="perl_Function">askIt</span>(text, <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">AsyncCallback</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">onFailure</span>(Throwable t) {
<span xmlns="" class="line">​</span>      Window.<span xmlns="" class="perl_Function">alert</span>(t.<span xmlns="" class="perl_Function">getMessage</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">onSuccess</span>(Object data) {
<span xmlns="" class="line">​</span>      Window.<span xmlns="" class="perl_Function">alert</span>((String) data);
<span xmlns="" class="line">​</span>    }         
<span xmlns="" class="line">​</span>  });      
<span xmlns="" class="line">​</span>}
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>...
</pre><div class="para">
			When clicked, this button invokes the <code class="literal">askServer()</code> method, passing the contents of the input text. In this example, it also validates that the input is a valid question. The <code class="literal">askServer()</code> method acquires a reference to the asynchronous client stub (returned by the <code class="literal">getService()</code> method) and invokes the <code class="literal">askIt()</code> method. The result (or error message, if the call fails) is shown in an alert window.
		</div><div class="mediaobject" style="text-align: center"><img src="images/gwt-helloworld.png" align="middle" alt="Hooking up a GWT widget to the Seam component" style="text-align: middle"/></div><div class="para">
			The complete code for this example can be found in the Seam distribution in the <code class="literal">examples/remoting/gwt</code> directory.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690451566208">
      ⁠</a>25.4. GWT Ant Targets</h1></div></div></div><div class="para">
			To deploy GWT applications, you must also perform compilation to JavaScript. This compacts and obfuscates the code. You can use an Ant utility instead of the command line or GUI utility provided by GWT. To do so, you must have GWT downloaded, and the Ant task <code class="filename">JAR</code> in your Ant classpath.
		</div><div class="para">
			Place the following near the top of your Ant file:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;taskdef</span><span xmlns="" class="perl_Others"> uri=</span><span xmlns="" class="perl_String">"antlib:de.samaflost.gwttasks"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         resource=</span><span xmlns="" class="perl_String">"de/samaflost/gwttasks/antlib.xml"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         classpath=</span><span xmlns="" class="perl_String">"./lib/gwttasks.jar"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> file=</span><span xmlns="" class="perl_String">"build.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			Create a <code class="filename">build.properties</code> file containing:
		</div><pre class="screen">gwt.home=/gwt_home_dir</pre><div class="para">
			This must point to the directory in which GWT is installed. Next, create a target:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- the following are handy utilities for doing GWT development.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">     To use GWT, you will of course need to download GWT seperately --&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;target</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"gwt-compile"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- in this case, we are "re homing" the gwt generated stuff, so </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       in this case we can only have one GWT module - we are doing this </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">       deliberately to keep the URL short --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;delete&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;fileset</span><span xmlns="" class="perl_Others"> dir=</span><span xmlns="" class="perl_String">"view"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/delete&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;gwt:compile</span><span xmlns="" class="perl_Others"> outDir=</span><span xmlns="" class="perl_String">"build/gwt"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">               gwtHome=</span><span xmlns="" class="perl_String">"${gwt.home}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">               classBase=</span><span xmlns="" class="perl_String">"${gwt.module.name}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">               sourceclasspath=</span><span xmlns="" class="perl_String">"src"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;copy</span><span xmlns="" class="perl_Others"> todir=</span><span xmlns="" class="perl_String">"view"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;fileset</span><span xmlns="" class="perl_Others"> dir=</span><span xmlns="" class="perl_String">"build/gwt/${gwt.module.name}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/copy&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/target&gt;</span>
</pre><div class="para">
			When called, this target compiles the GWT application and copies it to the specified directory (likely in the <code class="literal">webapp</code> section of your WAR).
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				Never edit the code generated by <code class="literal">gwt-compile</code> — if you need to edit, do so in the GWT source directory.
			</div></div></div><div class="para">
			We highly recommend using the hosted mode browser included in the GWT if you plan to develop applications with the GWT.
		</div></div></div></body></html>