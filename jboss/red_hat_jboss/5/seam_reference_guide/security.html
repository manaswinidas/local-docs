<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 15. Security</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="security">
      ⁠</a>Chapter 15. Security</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690539153696">
      ⁠</a>15.1. Overview</h1></div></div></div><div class="para">
			The Seam Security API provides a multitude of security-related features for your Seam-based application, including:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Authentication — an extensible, Java Authentication and Authorization Service (JAAS) based authentication layer that allows users to authenticate against any security provider.
				</div></li><li class="listitem"><div class="para">
					Identity Management — an API for managing the users and roles of a Seam application at runtime.
				</div></li><li class="listitem"><div class="para">
					Authorization — an extremely comprehensive authorization framework, supporting user roles, persistent and rule-based permissions, and a pluggable permission-resolver that makes it easy to implement customized security logic.
				</div></li><li class="listitem"><div class="para">
					Permission Management — a set of built-in Seam components that make it easy to manage an application's security policy.
				</div></li><li class="listitem"><div class="para">
					CAPTCHA support — to assist in the prevention of automated software/scripts abusing your Seam-based site.
				</div></li></ul></div><div class="para">
			This chapter covers each of these features in detail.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690517447824">
      ⁠</a>15.2. Disabling Security</h1></div></div></div><div class="para">
			In some situations, you may need to disable Seam Security (during unit tests, for instance, or to use a different security approach, like native JAAS). To disable the security infrastructure, call the static method <code class="literal">Identity.setSecurityEnabled(false)</code>. However, when you want to configure the application, a more convenient alternative is to control the following settings in <code class="filename">components.xml</code>:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Entity Security
				</div></li><li class="listitem"><div class="para">
					Hibernate Security Interceptor
				</div></li><li class="listitem"><div class="para">
					Seam Security Interceptor
				</div></li><li class="listitem"><div class="para">
					Page restrictions
				</div></li><li class="listitem"><div class="para">
					Servlet API security integration
				</div></li></ul></div><div class="para">
			This chapter documents the vast number of options available when establishing the user's identity (authentication) and establishing access constraints (authorization). We will begin with the foundation of the security model: authentication.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690456911008">
      ⁠</a>15.3. Authentication</h1></div></div></div><div class="para">
			Seam Security provides Java Authentication and Authorization Service (JAAS) based authorization features, providing a robust and highly configurable API for handling user authentication. If your authentication needs are not this complex, Seam also offers a simplified authentication method.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690457405984">
      ⁠</a>15.3.1. Configuring an Authenticator component</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					If you use Seam's Identity Management features, you can skip this section — it is not necessary to create an authenticator component.
				</div></div></div><div class="para">
				Seam's simplified authentication method uses a built-in JAAS login module (<code class="literal">SeamLoginModule</code>) to delegate authentication to one of your own Seam components. (This module requires no additional configuration files, and comes pre-configured within Seam.) With this, you can write an authentication method with the entity classes provided by your own application, or authenticate through another third-party provider. Configuring this simplified authentication requires the <code class="literal">identity</code> component to be configured in <code class="filename">components.xml</code>
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;components</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/components"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:core=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/core"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:security=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/security"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xsi:schemaLocation=</span> 
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_String">"http://jboss.com/products/seam/components </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/components-2.2.xsd </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/security </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/security-2.2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:identity</span><span xmlns="" class="perl_Others"> authenticate-method=</span><span xmlns="" class="perl_String">"#{authenticator.authenticate}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/components&gt;</span>
</pre><div class="para">
				<code class="literal">#{authenticator.authenticate}</code> is a method binding that indicates the <code class="literal">authenticate</code> method of the <code class="literal">authenticator</code> component will be used to authenticate the user.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690449701280">
      ⁠</a>15.3.2. Writing an authentication method</h2></div></div></div><div class="para">
				The <code class="literal">authenticate-method</code> property specified for <code class="literal">identity</code> in <code class="filename">components.xml</code> specifies the method used by <code class="literal">SeamLoginModule</code> to authenticate users. This method takes no parameters, and is expected to return a Boolean indicating authentication success or failure. Username and password are obtained from <code class="literal">Credentials.getUsername()</code> and <code class="literal">Credentials.getPassword()</code> respectively. (A reference to the <code class="literal">credentials</code> component can be obtained via <code class="literal">Identity.instance().getCredentials()</code>.) Any role that the user is a member of should be assigned with <code class="literal">Identity.addRole()</code>. The following is a complete example of an authentication method inside a POJO component:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"authenticator"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Authenticator {
<span xmlns="" class="line">​</span>  @In EntityManager entityManager;
<span xmlns="" class="line">​</span>  @In Credentials credentials;
<span xmlns="" class="line">​</span>  @In Identity identity;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">authenticate</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>      User user = (User) entityManager.<span xmlns="" class="perl_Function">createQuery</span>(
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_String">"from User where username = :username and password = :password"</span>)
<span xmlns="" class="line">​</span>          .<span xmlns="" class="perl_Function">setParameter</span>(<span xmlns="" class="perl_String">"username"</span>, credentials.<span xmlns="" class="perl_Function">getUsername</span>())
<span xmlns="" class="line">​</span>          .<span xmlns="" class="perl_Function">setParameter</span>(<span xmlns="" class="perl_String">"password"</span>, credentials.<span xmlns="" class="perl_Function">getPassword</span>())
<span xmlns="" class="line">​</span>          .<span xmlns="" class="perl_Function">getSingleResult</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (user.<span xmlns="" class="perl_Function">getRoles</span>() != <span xmlns="" class="perl_Keyword">null</span>) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">for</span> (UserRole mr : user.<span xmlns="" class="perl_Function">getRoles</span>())
<span xmlns="" class="line">​</span>          identity.<span xmlns="" class="perl_Function">addRole</span>(mr.<span xmlns="" class="perl_Function">getName</span>());
<span xmlns="" class="line">​</span>        }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">true</span>;
<span xmlns="" class="line">​</span>      } <span xmlns="" class="perl_Keyword">catch</span> (NoResultException ex) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>}
</pre><div class="para">
				In the example, both <code class="literal">User</code> and <code class="literal">UserRole</code> are application-specific entity beans. The <code class="literal">roles</code> parameter is populated with roles that the user is a member of. This is added to the <code class="literal">Set</code> as literal string values — for example, "admin", "user", etc. If the user record is not found, and a <code class="literal">NoResultException</code> is thrown, the authentication method returns <code class="literal">false</code> to indicate authentication failure.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					It is important to keep authenticator methods minimal and free from any side-effects — they can be invoked multiple times during a single request, so any special code that should execute when authentication succeeds or fails should implement an event observer. See <a class="xref" href="security.html#security-security_events">Section 15.10, “Security Events”</a> later in this chapter for more information about events raised by Seam Security.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690497494864">
      ⁠</a>15.3.2.1. Identity.addRole()</h3></div></div></div><div class="para">
					The <code class="literal">Identity.addRole()</code> method's behavior depends upon current session authentication. If the session is not authenticated, <code class="literal">addRole()</code> should only be called during the authentication process. When called here, the role name is placed in a temporary list of pre-authenticated roles. Once authentication succeeds, the pre-authenticated roles then become "real" roles, and calling <code class="literal">Identity.hasRole()</code> for those roles returns <code class="literal">true</code>. The following sequence diagram represents the list of pre-authenticated roles as a first class object to clarify its position in the authentication process.
				</div><div class="mediaobject" style="text-align: center"><img src="images/security-addrole.png" align="middle" alt="Identity.addRole()" style="text-align: middle"/></div><div class="para">
					If the current session is already authenticated, then calling <code class="literal">Identity.addRole()</code> grants the specified role to the current user immediately.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690516431712">
      ⁠</a>15.3.2.2. Writing an event observer for security-related events</h3></div></div></div><div class="para">
					If, upon successful log in, some user statistics require updates, you can write an event observer for the <code class="literal">org.jboss.seam.security.loginSuccessful</code> event, like this:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>@In UserStats userStats;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Observer</span>(<span xmlns="" class="perl_String">"org.jboss.seam.security.loginSuccessful"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">updateUserStats</span>() {
<span xmlns="" class="line">​</span>  userStats.<span xmlns="" class="perl_Function">setLastLoginDate</span>(<span xmlns="" class="perl_Keyword">new</span> Date());
<span xmlns="" class="line">​</span>  userStats.<span xmlns="" class="perl_Function">incrementLoginCount</span>();
<span xmlns="" class="line">​</span>}
</pre><div class="para">
					This observer method can be placed anywhere, even in the Authenticator component itself. More information about other security-related events appears later in the chapter.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690455601760">
      ⁠</a>15.3.3. Writing a login form</h2></div></div></div><div class="para">
				The <code class="literal">credentials</code> component provides both <code class="literal">username</code> and <code class="literal">password</code> properties, catering for the most common authentication scenario. These properties can be bound directly to the username and password fields on a login form. Once these properties are set, calling <code class="literal">identity.login()</code> authenticates the user with the credentials provided. An example of a simple login form is as follows:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputLabel</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Username"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{credentials.username}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputLabel</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Password"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputSecret</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{credentials.password}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Login"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{identity.login}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
</pre><div class="para">
				Similarly, the user is logged out by calling <code class="literal">#{identity.logout}</code>. This action clears the security state of the currently authenticated user and invalidate the user's session.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690496217856">
      ⁠</a>15.3.4. Configuration Summary</h2></div></div></div><div class="para">
				There are three easy steps to configure authentication:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Configure an authentication method in <code class="filename">components.xml</code>.
					</div></li><li class="listitem"><div class="para">
						Write an authentication method.
					</div></li><li class="listitem"><div class="para">
						Write a login form so that the user can authenticate.
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690452312256">
      ⁠</a>15.3.5. Remember Me</h2></div></div></div><div class="para">
				Seam Security supports two different modes of the <span class="emphasis"><em>Remember Me</em></span> functionality common to many web-based applications. The first mode allows the username to be stored in the user's browser as a cookie, and leaves the browser to remember the password. The second mode stores a unique token in a cookie, and lets a user authenticate automatically when they return to the site, without having to provide a password.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					Although it is convenient for users, automatic client authentication through a persistent cookie on the client machine is dangerous because the effects of any cross-site scripting (XSS) security hole are magnified. Without the authentication cookie, the only cookie an attacker can steal with XSS is the user's <span class="emphasis"><em>current session cookie</em></span> — so an attack can only occur while a user has a session open. If a persistent <span class="emphasis"><em>Remember Me</em></span> cookie is stolen, an attacker can log in without authentication at any time. If you wish to use automatic client authentication, it is vital to protect your website against XSS attacks.
				</div><div class="para">
					Browser vendors introduced the <span class="emphasis"><em>Remember Passwords</em></span> feature to combat this issue. Here, the browser remembers the username and password used to log in to a particular website and domain, and automatically fills in the login form when there is no session active. A log in keyboard shortcut on your website can make the log in process almost as convenient as the "Remember Me" cookie, and much safer. Some browsers (for example, Safari on OS X) store the login form data in the encrypted global operation system keychain. In a networked environment, the keychain can be transported with the user between laptop and desktop — cookies are not usually synchronized.
				</div><div class="para">
					Although persistent <span class="emphasis"><em>Remember Me</em></span> cookies with automatic authentication are widely used, they are bad security practice. Cookies that recall only the user's login name, and fill out the login form with that username as a convenience, are much more secure.
				</div></div></div><div class="para">
				No special configuration is required to enable the <span class="emphasis"><em>Remember Me</em></span> feature for the default (safe, username-only) mode. In your login form, simply bind the <span class="emphasis"><em>Remember Me</em></span> checkbox to <code class="literal">rememberMe.enabled</code>, as seen in the following example:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputLabel</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"User name"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"name"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{credentials.username}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputLabel</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Password"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputSecret</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{credentials.password}"</span><span xmlns="" class="perl_Others"> redisplay=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>      
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;div</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"loginRow"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:outputLabel</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"rememberMe"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Remember me"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:selectBooleanCheckbox</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"rememberMe"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{rememberMe.enabled}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/div&gt;</span>
</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690530383824">
      ⁠</a>15.3.5.1. Token-based <span class="emphasis"><em>Remember Me</em></span> Authentication</h3></div></div></div><div class="para">
					To use the automatic, token-based mode of the <span class="emphasis"><em>Remember Me</em></span> feature, you must first configure a token store. These authentication tokens are commonly stored within a database. Seam supports this method, but you can also implement your own token store by using the <code class="literal">org.jboss.seam.security.TokenStore</code> interface. This section assumes that you will be using the provided <code class="literal">JpaTokenStore</code> implementation to store authentication tokens inside a database table.
				</div><div class="para">
					First, create a new Entity to hold the tokens. The following is one possible structure:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AuthenticationToken <span xmlns="" class="perl_Keyword">implements</span> Serializable {  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer tokenId;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String username;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String value;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @Id @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getTokenId</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> tokenId;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setTokenId</span>(Integer tokenId) {
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">tokenId</span> = tokenId;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @TokenUsername
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getUsername</span>() {
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">return</span> username;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUsername</span>(String username) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">username</span> = username;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @TokenValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getValue</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> value;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setValue</span>(String value) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">value</span> = value;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
					Several special annotations, <code class="literal">@TokenUsername</code> and <code class="literal">@TokenValue</code>, are used to configure the username and token properties of the entity. These annotations are required for the entity that holds the authentication tokens.
				</div><div class="para">
					The next step is to configure <code class="literal">JpaTokenStore</code> to store and retrieve authentication tokens with this entity bean. Do this by specifying the <code class="literal">token-class</code> attribute in <code class="filename">components.xml</code>:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:jpa-token-store</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     token-class=</span><span xmlns="" class="perl_String">"org.jboss.seam.example.seamspace.AuthenticationToken"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
					The final step is to configure the <code class="literal">RememberMe</code> component in <code class="filename">components.xml</code>. Its <code class="literal">mode</code> should be set to <code class="literal">autoLogin</code>:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:remember-me</span><span xmlns="" class="perl_Others"> mode=</span><span xmlns="" class="perl_String">"autoLogin"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
					Users who check the <span class="emphasis"><em>Remember Me</em></span> checkbox will now be authenticated automatically.
				</div><div class="para">
					To ensure that users are automatically authenticated when returning to the site, the following section should be placed in <code class="filename">components.xml</code>:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.notLoggedIn"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{redirect.captureCurrentView}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{identity.tryLogin()}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.loginSuccessful"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{redirect.returnToCapturedView}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690451323968">
      ⁠</a>15.3.6. Handling Security Exceptions</h2></div></div></div><div class="para">
				So that users do not receive a basic default error page when a security error occurs, you should edit <code class="filename">pages.xml</code> to redirect users to a more attractive page. The two main exceptions thrown by the security API are:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="exceptionname">NotLoggedInException</code> — This exception is thrown when the user attempts to access a restricted action or page when they are not logged in.
					</div></li><li class="listitem"><div class="para">
						<code class="exceptionname">AuthorizationException</code> — This exception is only thrown if the user is already logged in, and they have attempted to access a restricted action or page for which they do not have the necessary privileges.
					</div></li></ul></div><div class="para">
				In the case of a <code class="exceptionname">NotLoggedInException</code>, we recommend the user be redirected to a login or registration page so that they can log in. For an <code class="exceptionname">AuthorizationException</code>, it may be useful to redirect the user to an error page. Here's an example of a <code class="filename">pages.xml</code> file that redirects both of these security exceptions:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;exception</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.NotLoggedInException"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/login.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;message&gt;</span>You must be logged in to perform this action<span xmlns="" class="perl_Keyword">&lt;/message&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/redirect&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/exception&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;exception</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.AuthorizationException"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;end-conversation/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/security_error.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;message&gt;</span>
<span xmlns="" class="line">​</span>          You do not have the necessary security privileges to perform this action.
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/message&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/redirect&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/exception&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span>
</pre><div class="para">
				Most web applications require more sophisticated handling of login redirection. Seam includes some special functionality, outlined in the following section.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690456831136">
      ⁠</a>15.3.7. Login Redirection</h2></div></div></div><div class="para">
				When an unauthenticated user tries to access a particular view or wildcarded view ID, you can have Seam redirect the user to a login screen as follows:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages</span><span xmlns="" class="perl_Others"> login-view-id=</span><span xmlns="" class="perl_String">"/login.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/members/*"</span><span xmlns="" class="perl_Others"> login-required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/pages&gt;</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					This is more refined than the exception handler shown above, but should probably be used in conjunction with it.
				</div></div></div><div class="para">
				After the user logs in, we want to automatically redirect them to the action that required log in. If you add the following event listeners to <code class="filename">components.xml</code>, attempts to access a restricted view while not logged in are remembered. Upon a successful log in, the user is redirected to the originally requested view, with any page parameters that existed in the original request.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.notLoggedIn"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{redirect.captureCurrentView}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.postAuthenticate"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{redirect.returnToCapturedView}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Login redirection is implemented as a conversation-scoped mechanism, so do not end the conversation in your <code class="literal">authenticate()</code> method.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690516188400">
      ⁠</a>15.3.8. HTTP Authentication</h2></div></div></div><div class="para">
				Although we do not recommend it unless absolutely necessary, Seam provides the means to authenticate with either HTTP Basic or HTTP Digest (RFC 2617) methods. For either form, you must first enable the <code class="literal">authentication-filter</code> component in <code class="filename">components.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web:authentication-filter</span><span xmlns="" class="perl_Others"> url-pattern=</span><span xmlns="" class="perl_String">"*.seam"</span><span xmlns="" class="perl_Others"> auth-type=</span><span xmlns="" class="perl_String">"basic"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
				To enable basic authentication, set <code class="literal">auth-type</code> to <code class="literal">basic</code>. For digest authentication, set it to <code class="literal">digest</code>. If you want to use digest authentication, you must also set the <code class="literal">key</code> and <code class="literal">realm</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web:authentication-filter</span><span xmlns="" class="perl_Others"> url-pattern=</span><span xmlns="" class="perl_String">"*.seam"</span><span xmlns="" class="perl_Others"> auth-type=</span><span xmlns="" class="perl_String">"digest"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     key=</span><span xmlns="" class="perl_String">"AA3JK34aSDlkj"</span><span xmlns="" class="perl_Others"> realm=</span><span xmlns="" class="perl_String">"My App"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
				The <code class="literal">key</code> can be any String value. The <code class="literal">realm</code> is the name of the authentication realm that is presented to the user when they authenticate.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690453736080">
      ⁠</a>15.3.8.1. Writing a Digest Authenticator</h3></div></div></div><div class="para">
					If using digest authentication, your authenticator class should extend the abstract class <code class="literal">org.jboss.seam.security.digest.DigestAuthenticator</code>, and use the <code class="literal">validatePassword()</code> method to validate the user's plain text password against the digest request. Here is an example:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">authenticate</span>() {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>    User user = (User) entityManager.<span xmlns="" class="perl_Function">createQuery</span>(
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_String">"from User where username = "</span>username<span xmlns="" class="perl_String">")</span>
<span xmlns="" class="line">​</span>         .<span xmlns="" class="perl_Function">setParameter</span>(<span xmlns="" class="perl_String">"username"</span>, identity.<span xmlns="" class="perl_Function">getUsername</span>())
<span xmlns="" class="line">​</span>         .<span xmlns="" class="perl_Function">getSingleResult</span>();
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Function">validatePassword</span>(user.<span xmlns="" class="perl_Function">getPassword</span>());
<span xmlns="" class="line">​</span>  } <span xmlns="" class="perl_Keyword">catch</span> (NoResultException ex) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">false</span>;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690496440640">
      ⁠</a>15.3.9. Advanced Authentication Features</h2></div></div></div><div class="para">
				This section explores some of the advanced features provided by the security API for addressing more complex security requirements.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690456747648">
      ⁠</a>15.3.9.1. Using your container's JAAS configuration</h3></div></div></div><div class="para">
					If you prefer not to use the simplified JAAS configuration provided by the Seam Security API, you can use the default system JAAS configuration by adding a <code class="literal">jaas-config-name</code> property to <code class="literal">components.xml</code>. For example, if you use JBoss Enterprise Application Platform and want to use the <code class="literal">other</code> policy (which uses the <code class="literal">UsersRolesLoginModule</code> login module provided by JBoss Enterprise Application Platform), then the entry in <code class="filename">components.xml</code> would look like this:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:identity</span><span xmlns="" class="perl_Others"> jaas-config-name=</span><span xmlns="" class="perl_String">"other"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
					Keep in mind that doing this does not mean that your user will be authenticated in your Seam application container — it instructs Seam Security to authenticate itself with the configured JAAS security policy.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690514415200">
      ⁠</a>15.4. Identity Management</h1></div></div></div><div class="para">
			Identity Management provides a standard API for managing a Seam application's users and roles, regardless of the identity store (database, LDAP, etc.) used in back-end operations. The <code class="literal">identityManager</code> component is at the core of the Identity Management API, and provides all methods for creating, modifying, and deleting users, granting and revoking roles, changing passwords, enabling and disabling user accounts, authenticating users, and listing users and roles.
		</div><div class="para">
			Before use, the <code class="literal">identityManager</code> must be configured with at least one <code class="literal">IdentityStore</code>. These components interact with the back-end security provider.
		</div><div class="mediaobject" style="text-align: center"><img src="images/security-identitymanager.png" align="middle" alt="Identity Management" style="text-align: middle"/></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690531902896">
      ⁠</a>15.4.1. Configuring IdentityManager</h2></div></div></div><div class="para">
				The <code class="literal">identityManager</code> component allows you to configure separate identity stores for authentication and authorization. This means that users can be authenticated against one identity store (for example, an LDAP directory), but have their roles loaded from another identity store (such as a relational database).
			</div><div class="para">
				Seam provides two <code class="literal">IdentityStore</code> implementations out of the box. The default, <code class="literal">JpaIdentityStore</code>, uses a relational database to store user and role information. The other implementation is <code class="literal">LdapIdentityStore</code>, which uses an LDAP directory to store users and roles.
			</div><div class="para">
				The <code class="literal">identityManager</code> component has two configurable properties: <code class="literal">identityStore</code> and <code class="literal">roleIndentityStore</code>. The value for these properties must be an EL expression that refers to a Seam component with the <code class="literal">IdentityStore</code> interface. If left unconfigured, the default (<code class="literal">JpaIdentityStore</code>) will be used. If only the <code class="literal">identityStore</code> property is configured, the same value will be used for <code class="literal">roleIdentityStore</code>. For example, the following entry in <code class="filename">components.xml</code> will configure <code class="literal">identityManager</code> to use an <code class="literal">LdapIdentityStore</code> for both user-related and role-related operations:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:identity-manager</span><span xmlns="" class="perl_Others"> identity-store=</span><span xmlns="" class="perl_String">"#{ldapIdentityStore}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
				The following example configures <code class="literal">identityManager</code> to use an <code class="literal">LdapIdentityStore</code> for user-related operations, and <code class="literal">JpaIdentityStore</code> for role-related operations:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:identity-manager</span><span xmlns="" class="perl_Others"> identity-store=</span><span xmlns="" class="perl_String">"#{ldapIdentityStore}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          role-identity-store=</span><span xmlns="" class="perl_String">"#{jpaIdentityStore}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
</pre><div class="para">
				The following sections explain each identity storage method in greater detail.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690517857760">
      ⁠</a>15.4.2. JpaIdentityStore</h2></div></div></div><div class="para">
				This method stores users and roles in a relational database. It is designed to allow flexible database design and table structure. A set of special annotations lets entity beans store user and role records.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690517856288">
      ⁠</a>15.4.2.1. Configuring JpaIdentityStore</h3></div></div></div><div class="para">
					Both <code class="literal">user-class</code> and <code class="literal">role-class</code> must be configured before <code class="literal">JpaIdentityStore</code> can be used. These properties refer to the entity classes used to store user and role records, respectively. The following example shows the <code class="filename">components.xml</code> file from the SeamSpace example:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:jpa-identity-store</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          user-class=</span><span xmlns="" class="perl_String">"org.jboss.seam.example.seamspace.MemberAccount"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          role-class=</span><span xmlns="" class="perl_String">"org.jboss.seam.example.seamspace.MemberRole"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690449960736">
      ⁠</a>15.4.2.2. Configuring the Entities</h3></div></div></div><div class="para">
					The following table describes the special annotations used to configure entity beans for user and role storage.
				</div><div class="table"><a id="idm139690449959376">
      ⁠</a><p class="title"><strong>Table 15.1. User Entity Annotations</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="User Entity Annotations"><colgroup><col width="33%"/><col width="17%"/><col width="50%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
									Annotation
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Status
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Description
								</div>
								 </th></tr></thead><tbody><tr><td> <div class="para">
									<code class="literal">@UserPrincipal</code>
								</div>
								 </td><td> <div class="para">
									Required
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the user's username.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@UserPassword</code>
								</div>
								 </td><td> <div class="para">
									Required
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the user's password. It allows a <code class="literal">hash</code> algorithm to be specified for password hashing. Possible values for <code class="literal">hash</code> are <code class="literal">md5</code>, <code class="literal">sha</code> and <code class="literal">none</code>. For example:
								</div>
								 
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">UserPassword</span>(hash = <span xmlns="" class="perl_String">"md5"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getPasswordHash</span>() { 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">return</span> passwordHash; 
<span xmlns="" class="line">​</span>}
</pre>
								 <div class="para">
									It is possible to extend the <code class="literal">PasswordHash</code> component to implement other hashing algorithms, if required.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@UserFirstName</code>
								</div>
								 </td><td> <div class="para">
									Optional
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the user's first name.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@UserLastName</code>
								</div>
								 </td><td> <div class="para">
									Optional
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the user's last name.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@UserEnabled</code>
								</div>
								 </td><td> <div class="para">
									Optional
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the enabled user status. This should be a Boolean property. If not present, all user accounts are assumed to be enabled.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@UserRoles</code>
								</div>
								 </td><td> <div class="para">
									Required
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the roles of the user. This property will be described in more detail in a later section. 
								</div>
								 </td></tr></tbody></table></div></div><div class="table"><a id="idm139690522743552">
      ⁠</a><p class="title"><strong>Table 15.2. Role Entity Annotations</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Role Entity Annotations"><colgroup><col width="33%"/><col width="17%"/><col width="50%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
									Annotation
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Status
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Description
								</div>
								 </th></tr></thead><tbody><tr><td> <div class="para">
									<code class="literal">@RoleName</code>
								</div>
								 </td><td> <div class="para">
									Required
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the name of the role.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@RoleGroups</code>
								</div>
								 </td><td> <div class="para">
									Optional
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method containing the group memberships of the role.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">@RoleConditional</code>
								</div>
								 </td><td> <div class="para">
									Optional
								</div>
								 </td><td> <div class="para">
									This annotation marks the field or method that indicates whether a role is conditional. Conditional roles are explained later in this chapter.
								</div>
								 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690452598016">
      ⁠</a>15.4.2.3. Entity Bean Examples</h3></div></div></div><div class="para">
					As mentioned previously, <code class="literal">JpaIdentityStore</code> is designed to be as flexible as possible when it comes to the database schema design of your user and role tables. This section looks at a number of possible database schemas that can be used to store user and role records.
				</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690461974208">
      ⁠</a>15.4.2.3.1. Minimal schema example</h4></div></div></div><div class="para">
						Here, a simple user and role table are linked via a many-to-many relationship using a cross-reference table named <code class="literal">UserRoles</code>.
					</div><div class="mediaobject" style="text-align: center"><img src="images/security-entities-1.png" align="middle" alt="Minimal schema example" style="text-align: middle"/></div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> User {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer userId;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String username;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String passwordHash;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Set&lt;Role&gt; roles;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Id @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getUserId</span>() { <span xmlns="" class="perl_Keyword">return</span> userId; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUserId</span>(Integer userId) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">userId</span> = userId; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserPrincipal
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getUsername</span>() { <span xmlns="" class="perl_Keyword">return</span> username; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUsername</span>(String username) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">username</span> = username; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">UserPassword</span>(hash = <span xmlns="" class="perl_String">"md5"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getPasswordHash</span>() { <span xmlns="" class="perl_Keyword">return</span> passwordHash; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setPasswordHash</span>(String passwordHash) { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">passwordHash</span> = passwordHash; 
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserRoles
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">ManyToMany</span>(targetEntity = Role.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">JoinTable</span>(name = <span xmlns="" class="perl_String">"UserRoles"</span>, 
<span xmlns="" class="line">​</span>       joinColumns = @<span xmlns="" class="perl_Function">JoinColumn</span>(name = <span xmlns="" class="perl_String">"UserId"</span>),
<span xmlns="" class="line">​</span>       inverseJoinColumns = @<span xmlns="" class="perl_Function">JoinColumn</span>(name = <span xmlns="" class="perl_String">"RoleId"</span>))
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Set&lt;Role&gt; <span xmlns="" class="perl_Function">getRoles</span>() { <span xmlns="" class="perl_Keyword">return</span> roles; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRoles</span>(Set&lt;Role&gt; roles) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">roles</span> = roles; }
<span xmlns="" class="line">​</span>}
</pre><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Role {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer roleId;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String rolename;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Id @Generated
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getRoleId</span>() { <span xmlns="" class="perl_Keyword">return</span> roleId; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRoleId</span>(Integer roleId) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">roleId</span> = roleId; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @RoleName
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getRolename</span>() { <span xmlns="" class="perl_Keyword">return</span> rolename; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRolename</span>(String rolename) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">rolename</span> = rolename; }
<span xmlns="" class="line">​</span>}
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690473359552">
      ⁠</a>15.4.2.3.2. Complex Schema Example</h4></div></div></div><div class="para">
						This example builds on the previous minimal example by including all optional fields, and allowing group memberships for roles.
					</div><div class="mediaobject" style="text-align: center"><img src="images/security-entities-2.png" align="middle" alt="Complex Schema Example" style="text-align: middle"/></div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> User {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer userId;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String username;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String passwordHash;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Set&lt;Role&gt; roles;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String firstname;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String lastname;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">boolean</span> enabled;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Id @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getUserId</span>() { <span xmlns="" class="perl_Keyword">return</span> userId; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUserId</span>(Integer userId) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">userId</span> = userId; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserPrincipal
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getUsername</span>() { <span xmlns="" class="perl_Keyword">return</span> username; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setUsername</span>(String username) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">username</span> = username; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">UserPassword</span>(hash = <span xmlns="" class="perl_String">"md5"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getPasswordHash</span>() { <span xmlns="" class="perl_Keyword">return</span> passwordHash; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setPasswordHash</span>(String passwordHash) { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">passwordHash</span> = passwordHash; 
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserFirstName
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getFirstname</span>() { <span xmlns="" class="perl_Keyword">return</span> firstname; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setFirstname</span>(String firstname) { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">firstname</span> = firstname; 
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserLastName
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getLastname</span>() { <span xmlns="" class="perl_Keyword">return</span> lastname; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setLastname</span>(String lastname) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">lastname</span> = lastname; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserEnabled
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isEnabled</span>() { <span xmlns="" class="perl_Keyword">return</span> enabled; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setEnabled</span>(<span xmlns="" class="perl_DataType">boolean</span> enabled) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">enabled</span> = enabled; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @UserRoles
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">ManyToMany</span>(targetEntity = Role.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">JoinTable</span>(name = <span xmlns="" class="perl_String">"UserRoles"</span>, 
<span xmlns="" class="line">​</span>    joinColumns = @<span xmlns="" class="perl_Function">JoinColumn</span>(name = <span xmlns="" class="perl_String">"UserId"</span>),
<span xmlns="" class="line">​</span>    inverseJoinColumns = @<span xmlns="" class="perl_Function">JoinColumn</span>(name = <span xmlns="" class="perl_String">"RoleId"</span>))
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Set&lt;Role&gt; <span xmlns="" class="perl_Function">getRoles</span>() { <span xmlns="" class="perl_Keyword">return</span> roles; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRoles</span>(Set&lt;Role&gt; roles) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">roles</span> = roles; }
<span xmlns="" class="line">​</span>}
</pre><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Role {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer roleId;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String rolename;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">boolean</span> conditional;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Id @Generated
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getRoleId</span>() { <span xmlns="" class="perl_Keyword">return</span> roleId; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRoleId</span>(Integer roleId) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">roleId</span> = roleId; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @RoleName
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getRolename</span>() { <span xmlns="" class="perl_Keyword">return</span> rolename; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRolename</span>(String rolename) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">rolename</span> = rolename; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @RoleConditional
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">isConditional</span>() { <span xmlns="" class="perl_Keyword">return</span> conditional; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setConditional</span>(<span xmlns="" class="perl_DataType">boolean</span> conditional) { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">conditional</span> = conditional; 
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @RoleGroups
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">ManyToMany</span>(targetEntity = Role.<span xmlns="" class="perl_Function">class</span>)
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">JoinTable</span>(name = <span xmlns="" class="perl_String">"RoleGroups"</span>, 
<span xmlns="" class="line">​</span>             joinColumns = @<span xmlns="" class="perl_Function">JoinColumn</span>(name = <span xmlns="" class="perl_String">"RoleId"</span>),
<span xmlns="" class="line">​</span>             inverseJoinColumns = @<span xmlns="" class="perl_Function">JoinColumn</span>(name = <span xmlns="" class="perl_String">"GroupId"</span>))
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Set&lt;Role&gt; <span xmlns="" class="perl_Function">getGroups</span>() { <span xmlns="" class="perl_Keyword">return</span> groups; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setGroups</span>(Set&lt;Role&gt; groups) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">groups</span> = groups; }  
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="security-id_management-jpaidstore">
      ⁠</a>15.4.2.4. JpaIdentityStore Events</h3></div></div></div><div class="para">
					When using <code class="literal">JpaIdentityStore</code> with <code class="literal">IdentityManager</code>, several events are raised when certain <code class="literal">IdentityManager</code> methods are invoked.
				</div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690456647856">
      ⁠</a>15.4.2.4.1. JpaIdentityStore.EVENT_PRE_PERSIST_USER</h4></div></div></div><div class="para">
						This event is raised in response to calling <code class="literal">IdentityManager.createUser()</code>. Just before the user entity is persisted to the database, this event is raised to pass the entity instance as an event parameter. The entity will be an instance of the <code class="literal">user-class</code> configured for <code class="literal">JpaIdentityStore</code>.
					</div><div class="para">
						An observer can be useful, here, for setting entity field values that are not part of standard <code class="literal">createUser()</code> functionality.
					</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690508314368">
      ⁠</a>15.4.2.4.2. JpaIdentityStore.EVENT_USER_CREATED</h4></div></div></div><div class="para">
						This event is also raised in response to calling <code class="literal">IdentityManager.createUser()</code>. However, it is raised after the user entity has already been persisted to the database. Like the <code class="literal">EVENT_PRE_PERSIST_USER</code> event, it also passes the entity instance as an event parameter. It may be useful to observe this event if you need to persist other entities that reference the user entity, such as contact detail records or other user-specific data.
					</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690508311872">
      ⁠</a>15.4.2.4.3. JpaIdentityStore.EVENT_USER_AUTHENTICATED</h4></div></div></div><div class="para">
						This event is raised when calling <code class="literal">IdentityManager.authenticate()</code>. It passes the user entity instance as the event parameter, and is useful for reading additional properties from the user entity being authenticated.
					</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690449512320">
      ⁠</a>15.4.3. LdapIdentityStore</h2></div></div></div><div class="para">
				This identity storage method is designed to work with user records stored in an LDAP directory. It is highly configurable, and allows very flexible directory storage of both users and roles. The following sections describe the configuration options for this identity store, and provide some configuration examples.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690449510736">
      ⁠</a>15.4.3.1. Configuring LdapIdentityStore</h3></div></div></div><div class="para">
					The following table describes the properties that can be configured in <code class="filename">components.xml</code> for <code class="literal">LdapIdentityStore</code>.
				</div><div class="table"><a id="idm139690456981504">
      ⁠</a><p class="title"><strong>Table 15.3. LdapIdentityStore Configuration Properties</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-14-rows" summary="LdapIdentityStore Configuration Properties"><colgroup><col width="40%"/><col width="40%"/><col width="20%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
									Property
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Default Value
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Description
								</div>
								 </th></tr></thead><tbody><tr><td> <div class="para">
									<code class="literal">server-address</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">localhost</code>
								</div>
								 </td><td> <div class="para">
									The address of the LDAP server.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">server-port</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">389</code>
								</div>
								 </td><td> <div class="para">
									The port number that the LDAP server listens on.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-context-DN</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">ou=Person,dc=acme,dc=com</code>
								</div>
								 </td><td> <div class="para">
									The Distinguished Name (DN) of the context containing user records.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-DN-prefix</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">uid=</code>
								</div>
								 </td><td> <div class="para">
									This value is prefixed to the front of the username to locate the user's record.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-DN-suffix</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">,ou=Person,dc=acme,dc=com</code>
								</div>
								 </td><td> <div class="para">
									This value is appended to the end of the username to locate the user's record.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">role-context-DN</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">ou=Role,dc=acme,dc=com</code>
								</div>
								 </td><td> <div class="para">
									The DN of the context containing role records.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">role-DN-prefix</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">cn=</code>
								</div>
								 </td><td> <div class="para">
									This value is prefixed to the front of the role name to form the DN that locates the role record.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">role-DN-suffix</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">,ou=Roles,dc=acme,dc=com</code>
								</div>
								 </td><td> <div class="para">
									This value is appended to the role name to form the DN that locates the role record.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">bind-DN</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">cn=Manager,dc=acme,dc=com</code>
								</div>
								 </td><td> <div class="para">
									This is the context used to bind to the LDAP server.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">bind-credentials</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">secret</code>
								</div>
								 </td><td> <div class="para">
									These are the credentials (the password) used to bind to the LDAP server.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-role-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">roles</code>
								</div>
								 </td><td> <div class="para">
									The attribute name of the user record containing the list of roles that the user is a member of.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">role-attribute-is-DN</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">true</code>
								</div>
								 </td><td> <div class="para">
									This Boolean property indicates whether the role attribute of the user record is itself a distinguished name.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-name-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">uid</code>
								</div>
								 </td><td> <div class="para">
									Indicates the user record attribute containing the username.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-password-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">userPassword</code>
								</div>
								 </td><td> <div class="para">
									Indicates the user record attribute containing the user's password.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">first-name-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">null</code>
								</div>
								 </td><td> <div class="para">
									Indicates the user record attribute containing the user's first name.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">last-name-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">sn</code>
								</div>
								 </td><td> <div class="para">
									Indicates the user record attribute containing the user's last name.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">full-name-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">cn</code>
								</div>
								 </td><td> <div class="para">
									Indicates the user record attribute containing the user's full (common) name.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">enabled-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">null</code>
								</div>
								 </td><td> <div class="para">
									Indicates the user record attribute that determines whether the user is enabled.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">role-name-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">cn</code>
								</div>
								 </td><td> <div class="para">
									Indicates the role record attribute containing the name of the role.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">object-class-attribute</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">objectClass</code>
								</div>
								 </td><td> <div class="para">
									Indicates the attribute that determines the class of an object in the directory.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">role-object-classes</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">organizationalRole</code>
								</div>
								 </td><td> <div class="para">
									An array of the object classes that new role records should be created as.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">user-object-classes</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">person,uidObject</code>
								</div>
								 </td><td> <div class="para">
									An array of the object classes that new user records should be created as.
								</div>
								 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690534378992">
      ⁠</a>15.4.3.2. LdapIdentityStore Configuration Example</h3></div></div></div><div class="para">
					The following configuration example shows how <code class="literal">LdapIdentityStore</code> can be configured for an LDAP directory running on fictional host <code class="literal">directory.mycompany.com</code>. The users are stored within this directory under the <code class="literal">ou=Person,dc=mycompany,dc=com</code> context, and are identified by the <code class="literal">uid</code> attribute (which corresponds to their username). Roles are stored in their own context, <code class="literal">ou=Roles,dc=mycompany,dc=com</code>, and are referenced from the user's entry via the <code class="literal">roles</code> attribute. Role entries are identified by their common name (the <code class="literal">cn</code> attribute), which corresponds to the role name. In this example, users can be disabled by setting the value of their <code class="literal">enabled</code> attribute to <code class="literal">false</code>.
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:ldap-identity-store</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  server-address=</span><span xmlns="" class="perl_String">"directory.mycompany.com"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  bind-DN=</span><span xmlns="" class="perl_String">"cn=Manager,dc=mycompany,dc=com"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  bind-credentials=</span><span xmlns="" class="perl_String">"secret"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  user-DN-prefix=</span><span xmlns="" class="perl_String">"uid="</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  user-DN-suffix=</span><span xmlns="" class="perl_String">",ou=Person,dc=mycompany,dc=com"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  role-DN-prefix=</span><span xmlns="" class="perl_String">"cn="</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  role-DN-suffix=</span><span xmlns="" class="perl_String">",ou=Roles,dc=mycompany,dc=com"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  user-context-DN=</span><span xmlns="" class="perl_String">"ou=Person,dc=mycompany,dc=com"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  role-context-DN=</span><span xmlns="" class="perl_String">"ou=Roles,dc=mycompany,dc=com"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  user-role-attribute=</span><span xmlns="" class="perl_String">"roles"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  role-name-attribute=</span><span xmlns="" class="perl_String">"cn"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  user-object-classes=</span><span xmlns="" class="perl_String">"person,uidObject"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  enabled-attribute=</span><span xmlns="" class="perl_String">"enabled"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690518577408">
      ⁠</a>15.4.4. Writing your own IdentityStore</h2></div></div></div><div class="para">
				Writing your own identity store implementation allows you to authenticate and perform identity management operations against security providers that are not supported out of the box by Seam. You only need a single class that implements the <code class="literal">org.jboss.seam.security.management.IdentityStore</code> interface to achieve this.
			</div><div class="para">
				Refer to the JavaDoc about <code class="literal">IdentityStore</code> for a description of the methods that must be implemented.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690458298144">
      ⁠</a>15.4.5. Authentication with Identity Management</h2></div></div></div><div class="para">
				If you use Identity Management features in your Seam application, then you do not need to provide an authenticator component (see previous Authentication section) to enable authentication. Simply omit the <code class="literal">authenticator-method</code> from the <code class="literal">identity</code> configuration in <code class="literal">components.xml</code>, and the <code class="literal">SeamLoginModule</code> will use <code class="literal">IdentityManager</code> to authenticate your application's users without any special configuration.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690529710688">
      ⁠</a>15.4.6. Using IdentityManager</h2></div></div></div><div class="para">
				Access the <code class="literal">IdentityManager</code> either by injecting it into your Seam component, like so:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@In IdentityManager identityManager;
</pre><div class="para">
				or, through its static <code class="literal">instance()</code> method:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>IdentityManager identityManager = IdentityManager.<span xmlns="" class="perl_Function">instance</span>();
</pre><div class="para">
				The following table describes <code class="literal">IdentityManager</code>'s API methods:
			</div><div class="table"><a id="idm139690530604144">
      ⁠</a><p class="title"><strong>Table 15.4. Identity Management API</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-14-rows" summary="Identity Management API"><colgroup><col width="40%"/><col width="20%"/><col width="40%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
								Method
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Returns
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Description
							</div>
							 </th></tr></thead><tbody><tr><td> <div class="para">
								<code class="literal">createUser(String name, String password)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Creates a new user account, with the specified name and password. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">deleteUser(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Deletes the user account with the specified name. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">createRole(String role)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Creates a new role, with the specified name. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">deleteRole(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Deletes the role with the specified name. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">enableUser(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Enables the user account with the specified name. Accounts that are not enabled cannot authenticate. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">disableUser(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Disables the user account with the specified name. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">changePassword(String name, String password)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Changes the password for the user account with the specified name. Returns <code class="literal">true</code> if successful; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">isUserEnabled(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Returns <code class="literal">true</code> if the specified user account is enabled; otherwise, returns <code class="literal">false</code>.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">grantRole(String name, String role)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Grants the specified role to the specified user or role. The role must already exist for it to be granted. Returns <code class="literal">true</code> if the role is successfully granted, or <code class="literal">false</code> if the user has already been granted the role.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">revokeRole(String name, String role)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Revokes the specified role from the specified user or role. Returns <code class="literal">true</code> if the specified user is a member of the role and it is successfully revoked, or <code class="literal">false</code> if the user is not a member of the role.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">userExists(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Returns <code class="literal">true</code> if the specified user exists, or <code class="literal">false</code> if it does not.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">listUsers()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">List</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of all user names, sorted in alpha-numeric order.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">listUsers(String filter)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">List</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of all user names filtered by the specified filter parameter, sorted in alpha-numeric order.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">listRoles()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">List</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of all role names.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">getGrantedRoles(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">List</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of all roles explicitly granted to the specified user name.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">getImpliedRoles(String name)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">List</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of all roles implicitly granted to the specified user name. Implicitly granted roles include those that are granted to the roles that the user is a member of, rather than granted directly to the user. For example, if the <code class="literal">admin</code> role is a member of the <code class="literal">user</code> role, and a user is a member of the <code class="literal">admin</code> role, then the implied roles for the user are both the <code class="literal">admin</code>, and <code class="literal">user</code> roles.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">authenticate(String name, String password)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Authenticates the specified username and password using the configured Identity Store. Returns <code class="literal">true</code> if successful or <code class="literal">false</code> if authentication failed. Successful authentication implies nothing beyond the return value of the method. It does not change the state of the <code class="literal">Identity</code> component - to perform a proper Seam log in the <code class="literal">Identity.login()</code> must be used instead.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">addRoleToGroup(String role, String group)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Adds the specified role as a member of the specified group. Returns true if the operation is successful.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">removeRoleFromGroup(String role, String group)</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								Removes the specified role from the specified group. Returns true if the operation is successful.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">listRoles()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">List</code>
							</div>
							 </td><td> <div class="para">
								Lists the names of all roles.
							</div>
							 </td></tr></tbody></table></div></div><div class="para">
				A calling user must have appropriate authorization to invoke methods on the Identity Management API. The following table describes the permission requirements for each of the methods in <code class="literal">IdentityManager</code>. The permission targets listed below are literal String values.
			</div><div class="table"><a id="idm139690448168928">
      ⁠</a><p class="title"><strong>Table 15.5. Identity Management Security Permissions</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-14-rows" summary="Identity Management Security Permissions"><colgroup><col width="40%"/><col width="40%"/><col width="20%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
								Method
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Permission Target
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Permission Action
							</div>
							 </th></tr></thead><tbody><tr><td> <div class="para">
								<code class="literal">createUser()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">create</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">deleteUser()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">delete</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">createRole()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.role</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">create</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">deleteRole()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.role</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">delete</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">enableUser()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">disableUser()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">changePassword()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">isUserEnabled()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">read</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">grantRole()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">revokeRole()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">userExists()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">read</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">listUsers()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.user</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">read</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">listRoles()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.role</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">read</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">addRoleToGroup()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.role</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">removeRoleFromGroup()</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.role</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">update</code>
							</div>
							 </td></tr></tbody></table></div></div><div class="para">
				The following code listing provides an example set of security rules that grants all <code class="literal">admin</code> role members access to all Identity Management-related methods:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>rule ManageUsers
<span xmlns="" class="line">​</span>  no-loop
<span xmlns="" class="line">​</span>  activation-group <span xmlns="" class="perl_String">"permissions"</span>
<span xmlns="" class="line">​</span>when
<span xmlns="" class="line">​</span>  check: <span xmlns="" class="perl_Function">PermissionCheck</span>(name == <span xmlns="" class="perl_String">"seam.user"</span>, granted == <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>  Role(name == <span xmlns="" class="perl_String">"admin"</span>)
<span xmlns="" class="line">​</span>then
<span xmlns="" class="line">​</span>  check.<span xmlns="" class="perl_Function">grant</span>();
<span xmlns="" class="line">​</span>end
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>rule ManageRoles
<span xmlns="" class="line">​</span>  no-loop
<span xmlns="" class="line">​</span>  activation-group <span xmlns="" class="perl_String">"permissions"</span>
<span xmlns="" class="line">​</span>when
<span xmlns="" class="line">​</span>  check: <span xmlns="" class="perl_Function">PermissionCheck</span>(name == <span xmlns="" class="perl_String">"seam.role"</span>, granted == <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>  Role(name == <span xmlns="" class="perl_String">"admin"</span>)
<span xmlns="" class="line">​</span>then
<span xmlns="" class="line">​</span>  check.<span xmlns="" class="perl_Function">grant</span>();
<span xmlns="" class="line">​</span>end
</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690519661488">
      ⁠</a>15.5. Error Messages</h1></div></div></div><div class="para">
			The security API produces a number of default Faces messages for various security-related events. The following table lists the message keys to specify in a <code class="filename">message.properties</code> resource file if you want to override the messages. To suppress a message, add the key (with an empty value) to the resource file.
		</div><div class="table"><a id="idm139690519659472">
      ⁠</a><p class="title"><strong>Table 15.6. Security Message Keys</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Security Message Keys"><colgroup><col width="67%"/><col width="33%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
							Message Key
						</div>
						 </th><th style="text-align: center"> <div class="para">
							Description
						</div>
						 </th></tr></thead><tbody><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.loginSuccessful</code>
						</div>
						 </td><td> <div class="para">
							This message is produced when a user successfully logs in via the security API.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.loginFailed</code>
						</div>
						 </td><td> <div class="para">
							This message is produced when the log in process fails, either because the user provided an incorrect username or password, or because authentication failed in some other way.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.NotLoggedIn</code>
						</div>
						 </td><td> <div class="para">
							This message is produced when a user attempts to perform an action or access a page that requires a security check, and the user is not currently authenticated.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.AlreadyLoggedIn</code>
						</div>
						 </td><td> <div class="para">
							This message is produced when a user that is already authenticated attempts to log in again.
						</div>
						 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690507208176">
      ⁠</a>15.6. Authorization</h1></div></div></div><div class="para">
			This section describes the range of authorization mechanisms provided by the Seam Security API for securing access to components, component methods, and pages. If you wish to use any of the advanced features (for example, rule-based permissions), you may need to configure your <code class="filename">components.xml</code> file — see the Configuration section previous.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690448989072">
      ⁠</a>15.6.1. Core concepts</h2></div></div></div><div class="para">
				Seam Security operates on the principle that users are granted roles or permissions, or both, which allow them to perform operations that are not permissible for users without the required security privileges. Each authorization mechanism provided by the Seam Security API is built upon this core concept of roles and permissions, with an extensible framework to provide multiple ways to secure application resources.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690448987376">
      ⁠</a>15.6.1.1. What is a role?</h3></div></div></div><div class="para">
					A role is a type of user that may have been granted certain privileges for performing one or more specific actions within an application. They are simple constructs, consisting of a name (such as "admin", "user", "customer", etc.) applied to users, or other roles. They are used to create logical user groups so that specific application privileges can be easily assigned.
				</div><div class="mediaobject" style="text-align: center"><img src="images/security-roleclass.png" align="middle" alt="What is a role?" style="text-align: middle"/></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690526960784">
      ⁠</a>15.6.1.2. What is a permission?</h3></div></div></div><div class="para">
					A permission is a privilege (sometimes once-off) for performing a single, specific action. You can build an application that operates solely on permissions, but roles are more convenient when granting privileges to groups. Permissions are slightly more complex in structure than roles, consisting of three "aspects"; a target, an action, and a recipient. The target of a permission is the object (or an arbitrary name or class) for which a particular action is allowed to be performed by a specific recipient (or user). For example, the user "Bob" may have permission to delete customer objects. In this case, the permission target may be "customer", the permission action would be "delete" and the recipient would be "Bob".
				</div><div class="mediaobject" style="text-align: center"><img src="images/security-permissionclass.png" align="middle" alt="What is a permission?" style="text-align: middle"/></div><div class="para">
					In this documentation, permissions are usually represented in the form <code class="literal">target:action</code>, omitting the recipient. In reality, a recipient is always required.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690504446864">
      ⁠</a>15.6.2. Securing components</h2></div></div></div><div class="para">
				We will start with the simplest form of authorization: component security. First, we will look at the <code class="literal">@Restrict</code> annotation.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>@Restrict vs Typesafe security annotations</strong></p></div><div class="admonition"><div class="para">
					While the <code class="literal">@Restrict</code> annotation is a powerful and flexible method for security components, it cannot support EL expressions. Therefore, we recommend using the typesafe equivalent (described later in this chapter) for its compile-time safety.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690525172224">
      ⁠</a>15.6.2.1. The @Restrict annotation</h3></div></div></div><div class="para">
					Seam components can be secured at either the method or the class level with the <code class="literal">@Restrict</code> annotation. If both a method and its declaring class are annotated with <code class="literal">@Restrict</code>, the method restriction will take precedence and the class restriction will not apply. If a method invocation fails a security check, an exception will be thrown as per the contract for <code class="literal">Identity.checkRestriction()</code>. (See the section following for more information on Inline Restrictions.) Placing <code class="literal">@Restrict</code> on the component class itself is the equivalent of adding <code class="literal">@Restrict</code> to each of its methods.
				</div><div class="para">
					An empty <code class="literal">@Restrict</code> implies a permission check of <code class="literal">componentName:methodName</code>. Take for example the following component method:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"account"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AccountAction {
<span xmlns="" class="line">​</span>  @Restrict 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">delete</span>() {
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
					In this example, <code class="literal">account:delete</code> is the implied permission required to call the <code class="literal">delete()</code> method. This is equivalent to writing <code class="literal">@Restrict("#{s:hasPermission('account','delete')}")</code>. The following is another example:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Restrict @<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"account"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AccountAction {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">insert</span>() {
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Restrict</span>(<span xmlns="" class="perl_String">"#{s:hasRole('admin')}"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">delete</span>() {
<span xmlns="" class="line">​</span>    ...
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
					Here, the component class itself is annotated with <code class="literal">@Restrict</code>. This means that any methods without an overriding <code class="literal">@Restrict</code> annotation require an implicit permission check. In this case, the <code class="literal">insert()</code> method requires a permission of <code class="literal">account:insert</code>, while the <code class="literal">delete()</code> method requires that the user is a member of the <code class="literal">admin</code> role.
				</div><div class="para">
					Before we go further, we will address the <code class="literal">#{s:hasRole()}</code> expression seen in the previous example. <code class="literal">s:hasRole</code> and <code class="literal">s:hasPermission</code> are EL functions that delegate to the correspondingly-named methods of the <code class="literal">Identity</code> class. These functions can be used within any EL expression throughout the entirety of the security API.
				</div><div class="para">
					Being an EL expression, the value of the <code class="literal">@Restrict</code> annotation may refer to any object within a Seam context. This is extremely useful when checking permissions for a specific object instance. Take the following example:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"account"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AccountAction {
<span xmlns="" class="line">​</span>  @In Account selectedAccount;
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Restrict</span>(<span xmlns="" class="perl_String">"#{s:hasPermission(selectedAccount,'modify')}"</span>)
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">modify</span>() {
<span xmlns="" class="line">​</span>    selectedAccount.<span xmlns="" class="perl_Function">modify</span>();
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
					In this example, the <code class="literal">hasPermission()</code> function call refers to <code class="literal">selectedAccount</code>. The value of this variable will be looked up from within the Seam context, and passed to the <code class="literal">hasPermission()</code> method in <code class="literal">Identity</code>. This will determine whether the user has the required permissions to modify the specified <code class="literal">Account</code> object.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690451813872">
      ⁠</a>15.6.2.2. Inline restrictions</h3></div></div></div><div class="para">
					It is sometimes necessary to perform a security check in code, without using the <code class="literal">@Restrict</code> annotation. To do so, use <code class="literal">Identity.checkRestriction()</code> to evaluate a security expression, like this:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">deleteCustomer</span>() { 
<span xmlns="" class="line">​</span>  Identity.<span xmlns="" class="perl_Function">instance</span>().<span xmlns="" class="perl_Function">checkRestriction</span>(<span xmlns="" class="perl_String">"#{s:hasPermission(selectedCustomer,</span>
<span xmlns="" class="line">​</span>                                                          'delete')}<span xmlns="" class="perl_String">"); </span>
<span xmlns="" class="line">​</span>}
</pre><div class="para">
					If the specified expression does not evaluate to <code class="literal">true</code>, one of two exceptions occurs. If the user is not logged in, a <code class="exceptionname">NotLoggedInException</code> is thrown. If the user is logged in, an <code class="exceptionname">AuthorizationException</code> is thrown.
				</div><div class="para">
					You can also call the <code class="literal">hasRole()</code> and <code class="literal">hasPermission()</code> methods directly from Java code:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">if</span> (!Identity.<span xmlns="" class="perl_Function">instance</span>().<span xmlns="" class="perl_Function">hasRole</span>(<span xmlns="" class="perl_String">"admin"</span>))
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">AuthorizationException</span>(<span xmlns="" class="perl_String">"Must be admin to perform this action"</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">if</span> (!Identity.<span xmlns="" class="perl_Function">instance</span>().<span xmlns="" class="perl_Function">hasPermission</span>(<span xmlns="" class="perl_String">"customer"</span>, <span xmlns="" class="perl_String">"create"</span>))
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">AuthorizationException</span>(<span xmlns="" class="perl_String">"You may not create new customers"</span>);
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690456736368">
      ⁠</a>15.6.3. Security in the user interface</h2></div></div></div><div class="para">
				A well-designed interface does not present a user with options they are not permitted to use. Seam Security allows conditional rendering of page sections or individual controls based on user privileges, using the same EL expressions that are used for component security.
			</div><div class="para">
				In this section, we will go through some examples of interface security. Say we have a login form that we want rendered only if the user is not already logged in. We can write the following with the <code class="literal">identity.isLoggedIn()</code> property:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"loginForm"</span><span xmlns="" class="perl_Others"> rendered=</span><span xmlns="" class="perl_String">"#{not identity.loggedIn}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
</pre><div class="para">
				If the user is not logged in, the login form will be rendered — very straightforward. Say we also have a menu on this page, and we want some actions to be accessed only by users in the <code class="literal">manager</code> role. One way you could write this is the following:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:outputLink</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{reports.listManagerReports}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">   rendered=</span><span xmlns="" class="perl_String">"#{s:hasRole('manager')}"</span><span xmlns="" class="perl_Keyword">&gt;</span> Manager Reports 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:outputLink&gt;</span>
</pre><div class="para">
				This, too, is straightforward — if the user is not a member of the <code class="literal">manager</code> role, the outputLink will not be rendered. The <code class="literal">rendered</code> attribute can generally be used on the control itself, or on a surrounding <code class="literal">&lt;s:div&gt;</code> or <code class="literal">&lt;s:span&gt;</code> control.
			</div><div class="para">
				A more complex example of conditional rendering might be the following situation: say you have a <code class="literal">h:dataTable</code> control on a page, and you want to render action links on its records only for users with certain privileges. The <code class="literal">s:hasPermission</code> EL function lets us use an object parameter to determine whether the user has the necessary permission for that object. A dataTable with secured links might look like this:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:dataTable</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{clients}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"cl"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Name<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>    #{cl.name}
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>City<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>    #{cl.city}
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:column&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"header"</span><span xmlns="" class="perl_Keyword">&gt;</span>Action<span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Modify Client"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{clientAction.modify}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            rendered=</span><span xmlns="" class="perl_String">"#{s:hasPermission(cl,'modify')"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Delete Client"</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{clientAction.delete}"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            rendered=</span><span xmlns="" class="perl_String">"#{s:hasPermission(cl,'delete')"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:column&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:dataTable&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690522205424">
      ⁠</a>15.6.4. Securing pages</h2></div></div></div><div class="para">
				To use page security, you will need a <code class="filename">pages.xml</code> file. Page security is easy to configure: simply include a <code class="literal">&lt;restrict/&gt;</code> element in the <code class="literal">page</code> elements that you want to secure. If no explicit restriction is specified in the <code class="literal">restrict</code> element, access via a non-Faces (GET) request requires an implied <code class="literal">/viewId.xhtml:render</code> permission, and <code class="literal">/viewId.xhtml:restore</code> permission is required when any JSF postback (form submission) originates from the page. Otherwise, the specified restriction will be evaluated as a standard security expression. Some examples are:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/settings.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;restrict/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
</pre><div class="para">
				This page requires an implied permission of <code class="literal">/settings.xhtml:render</code> for non-Faces requests, and an implied permission of <code class="literal">/settings.xhtml:restore</code> for Faces requests.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/reports.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;restrict&gt;</span>#{s:hasRole('admin')}<span xmlns="" class="perl_Keyword">&lt;/restrict&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
</pre><div class="para">
				Both Faces and non-Faces requests to this page require that the user is a member of the <code class="literal">admin</code> role.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690506560048">
      ⁠</a>15.6.5. Securing Entities</h2></div></div></div><div class="para">
				Seam Security also lets you apply security restrictions to certain actions (read, insert, update, and delete) for entities.
			</div><div class="para">
				To secure all actions for an entity class, add a <code class="literal">@Restrict</code> annotation on the class itself:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"customer"</span>)
<span xmlns="" class="line">​</span>@Restrict
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}
</pre><div class="para">
				If no expression is specified in the <code class="literal">@Restrict</code> annotation, the default action is a permission check of <code class="literal">entity:action</code>, where the permission target is the entity instance, and the <code class="literal">action</code> is either <code class="literal">read</code>, <code class="literal">insert</code>, <code class="literal">update</code> or <code class="literal">delete</code>.
			</div><div class="para">
				You can also restrict certain actions by placing a <code class="literal">@Restrict</code> annotation on the relevant entity life cycle method (annotated as follows):
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="literal">@PostLoad</code> — Called after an entity instance is loaded from the database. Use this method to configure a <code class="literal">read</code> permission.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">@PrePersist</code> — Called before a new instance of the entity is inserted. Use this method to configure an <code class="literal">insert</code> permission.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">@PreUpdate</code> — Called before an entity is updated. Use this method to configure an <code class="literal">update</code> permission.
					</div></li><li class="listitem"><div class="para">
						<code class="literal">@PreRemove</code> — Called before an entity is deleted. Use this method to configure a <code class="literal">delete</code> permission.
					</div></li></ul></div><div class="para">
				The following example shows how an entity can be configured to perform a security check for any <code class="literal">insert</code> operations. Note that the method need not perform any action; it is only important that it be annotated correctly:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@PrePersist 
<span xmlns="" class="line">​</span>@Restrict 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">prePersist</span>() {}
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Using <code class="literal">/META-INF/orm.xml</code></strong></p></div><div class="admonition"><div class="para">
					You can also specify the callback method in <code class="literal">/META-INF/orm.xml</code>:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;entity-mappings</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/persistence/orm"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        xsi:schemaLocation=</span><span xmlns="" class="perl_String">"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://java.sun.com/xml/ns/persistence/orm </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">          http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          version=</span><span xmlns="" class="perl_String">"1.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;entity</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"Customer"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;pre-persist</span><span xmlns="" class="perl_Others"> method-name=</span><span xmlns="" class="perl_String">"prePersist"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/entity&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/entity-mappings&gt;</span>
</pre><div class="para">
					You will still need to annotate the <code class="literal">prePersist()</code> method on <code class="literal">Customer</code> with <code class="literal">@Restrict</code>.
				</div></div></div><div class="para">
				The following configuration is based on the Seamspace example, and checks if the authenticated user has permission to insert a new <code class="literal">MemberBlog</code> record. The entity being checked is automatically inserted into the working memory (in this case, <code class="literal">MemberBlog</code>):
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>rule InsertMemberBlog
<span xmlns="" class="line">​</span>  no-loop
<span xmlns="" class="line">​</span>  activation-group <span xmlns="" class="perl_String">"permissions"</span>
<span xmlns="" class="line">​</span>when
<span xmlns="" class="line">​</span>  principal: Principal()
<span xmlns="" class="line">​</span>  memberBlog: <span xmlns="" class="perl_Function">MemberBlog</span>(member : member -&gt; 
<span xmlns="" class="line">​</span>                        (member.<span xmlns="" class="perl_Function">getUsername</span>().<span xmlns="" class="perl_Function">equals</span>(principal.<span xmlns="" class="perl_Function">getName</span>())))
<span xmlns="" class="line">​</span>  check: <span xmlns="" class="perl_Function">PermissionCheck</span>(target == memberBlog, 
<span xmlns="" class="line">​</span>                         action == <span xmlns="" class="perl_String">"insert"</span>, granted == <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>then
<span xmlns="" class="line">​</span>  check.<span xmlns="" class="perl_Function">grant</span>();
<span xmlns="" class="line">​</span>end;
</pre><div class="para">
				This rule grants the permission <code class="literal">memberBlog:insert</code> if the name of the currently authenticated user (indicated by the <code class="literal">Principal</code> fact) matches that of the member for whom the blog entry is being created. The <code class="literal">principal: Principal()</code> structure is a variable binding. It binds the instance of the <code class="literal">Principal</code> object placed in the working memory during authentication, and assigns it to a variable called <code class="literal">principal</code>. Variable bindings let the variable be referenced in other places, such as the following line, which compares the member name to the <code class="literal">Principal</code> name. For further details, refer to the JBoss Rules documentation. 
			</div><div class="para">
				Finally, install a listener class to integrate Seam Security with your JPA provider.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690530137472">
      ⁠</a>15.6.5.1. Entity security with JPA</h3></div></div></div><div class="para">
					Security checks for EJB3 entity beans are performed with an <code class="literal">EntityListener</code>. Install this listener with the following <code class="literal">META-INF/orm.xml</code> file:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;entity-mappings</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://java.sun.com/xml/ns/persistence/orm"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                 xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                 xsi:schemaLocation=</span><span xmlns="" class="perl_String">"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                   http://java.sun.com/xml/ns/persistence/orm </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">                   http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                 version=</span><span xmlns="" class="perl_String">"1.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;persistence-unit-metadata&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;persistence-unit-defaults&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entity-listeners&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entity-listener</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                class=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.EntitySecurityListener"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/entity-listeners&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/persistence-unit-defaults&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/persistence-unit-metadata&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/entity-mappings&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690518040144">
      ⁠</a>15.6.5.2. Entity security with a Managed Hibernate Session</h3></div></div></div><div class="para">
					If you use a Hibernate <code class="literal">SessionFactory</code> configured with Seam, and use annotations or <code class="filename">orm.xml</code>, you do not need to make any changes to use entity security.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690494332048">
      ⁠</a>15.6.6. Typesafe Permission Annotations</h2></div></div></div><div class="para">
				Seam provides a number of alternative annotations to <code class="literal">@Restrict</code>. These support arbitrary EL expressions differently, which gives them additional compile-time safety.
			</div><div class="para">
				Seam comes with a set of annotations for standard CRUD-based permissions. The following annotations are provided in the <code class="literal">org.jboss.seam.annotations.security</code> package:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						@Insert
					</div></li><li class="listitem"><div class="para">
						@Read
					</div></li><li class="listitem"><div class="para">
						@Update
					</div></li><li class="listitem"><div class="para">
						@Delete
					</div></li></ul></div><div class="para">
				To use these annotations, place them on the method or parameter for which you wish to perform a security check. When placed on a method, they specify a target class for which the permission will be checked. Take the following example:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Insert</span>(Customer.<span xmlns="" class="perl_Function">class</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">createCustomer</span>() { <span xmlns="" class="perl_Keyword">... </span>}
</pre><div class="para">
				Here, a permission check will be performed for the user to ensure that they have permission to create new <code class="literal">Customer</code> objects. The target of the permission check is <code class="literal">Customer.class</code> (the actual <code class="literal">java.lang.Class</code> instance itself), and the action is the lower case representation of the annotation name, which in this example is <code class="literal">insert</code>.
			</div><div class="para">
				You can annotate a component method's parameters in the same way, as follows. If you do this, you need not specify a permission target, since the parameter value itself will be the target of the permission check.
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">updateCustomer</span>(@Update Customer customer) { 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">... </span>
<span xmlns="" class="line">​</span>}
</pre><div class="para">
				To create your own security annotation, just annotate it with <code class="literal">@PermissionCheck</code>. For example:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Target</span>({METHOD, PARAMETER})
<span xmlns="" class="line">​</span>@Documented
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Retention</span>(RUNTIME)
<span xmlns="" class="line">​</span>@Inherited
<span xmlns="" class="line">​</span>@PermissionCheck
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">@interface</span> Promote {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">Class</span> <span xmlns="" class="perl_Function">value</span>() <span xmlns="" class="perl_Keyword">default</span> <span xmlns="" class="perl_DataType">void</span>.<span xmlns="" class="perl_Function">class</span>;
<span xmlns="" class="line">​</span>}
</pre><div class="para">
				If you wish to override the default permission action name (the lower case version of the annotation name) with another value, you can specify this within the <code class="literal">@PermissionCheck</code> annotation:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">PermissionCheck</span>(<span xmlns="" class="perl_String">"upgrade"</span>)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690540201952">
      ⁠</a>15.6.7. Typesafe Role Annotations</h2></div></div></div><div class="para">
				In addition to typsesafe permission annotation support, Seam Security provides typesafe role annotations that let you restrict access to component methods based on the role memberships of the currently authenticated user. Seam provides one such annotation (<code class="literal">org.jboss.seam.annotations.security.Admin</code>) out of the box. This restricts access of a particular method to users that belong to the <code class="literal">admin</code> role, as long as such a role is supported by your application. To create your own role annotations, meta-annotate them with <code class="literal">org.jboss.seam.annotations.security.RoleCheck</code> as in the following example:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Target</span>({METHOD})
<span xmlns="" class="line">​</span>@Documented
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Retention</span>(RUNTIME)
<span xmlns="" class="line">​</span>@Inherited
<span xmlns="" class="line">​</span>@RoleCheck
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">@interface</span> User { }
</pre><div class="para">
				Any methods subsequently annotated with the <code class="literal">@User</code> annotation will be automatically intercepted. The user will be checked for membership of the corresponding role name (the lower case version of the annotation name, in this case <code class="literal">user</code>).
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690455266752">
      ⁠</a>15.6.8. The Permission Authorization Model</h2></div></div></div><div class="para">
				Seam Security provides an extensible framework for resolving application permissions. The following class diagram shows an overview of the main components of the permission framework:
			</div><div class="mediaobject" style="text-align: center"><img src="images/security-permission-classdiagram.png" align="middle" alt="The Permission Authorization Model" style="text-align: middle"/></div><div class="para">
				The relevant classes are explained in more detail in the following sections.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690515575072">
      ⁠</a>15.6.8.1. PermissionResolver</h3></div></div></div><div class="para">
					An interface that provides methods for resolving individual object permissions. Seam provides the following built-in <code class="literal">PermissionResolver</code> implementations, which are described in greater detail later in the chapter:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="literal">RuleBasedPermissionResolver</code> — Resolves rule-based permission checks with Drools.
						</div></li><li class="listitem"><div class="para">
							<code class="literal">PersistentPermissionResolver</code> — Stores object permissions in a permanent store, such as a relational database.
						</div></li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690467250592">
      ⁠</a>15.6.8.1.1. Writing your own PermissionResolver</h4></div></div></div><div class="para">
						Implementing your own permission resolver is simple. The <code class="literal">PermissionResolver</code> interface defines two methods that must be implemented, as seen in the following table. If your <code class="literal">PermissionResolver</code> is deployed in your Seam project, it will be scanned automatically during deployment and registered with the default <code class="literal">ResolverChain</code>.
					</div><div class="table"><a id="idm139690517187168">
      ⁠</a><p class="title"><strong>Table 15.7. PermissionResolver interface</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="PermissionResolver interface"><colgroup><col width="25%"/><col width="38%"/><col width="38%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
										Return type
									</div>
									 </th><th style="text-align: center"> <div class="para">
										Method
									</div>
									 </th><th style="text-align: center"> <div class="para">
										Description
									</div>
									 </th></tr></thead><tbody><tr><td> <div class="para">
										<code class="literal">boolean</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">hasPermission(Object target, String action)</code>
									</div>
									 </td><td> <div class="para">
										This method resolves whether the currently authenticated user (obtained via a call to <code class="literal">Identity.getPrincipal()</code>) has the permission specified by the <code class="literal">target</code> and <code class="literal">action</code> parameters. It returns <code class="literal">true</code> if the user has the specified permission, or <code class="literal">false</code> if they do not.
									</div>
									 </td></tr><tr><td> <div class="para">
										<code class="literal">void</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">filterSetByAction(Set&lt;Object&gt; targets, String action)</code>
									</div>
									 </td><td> <div class="para">
										This method removes any objects from the specified set that would return <code class="literal">true</code> if passed to the <code class="literal">hasPermission()</code> method with the same <code class="literal">action</code> parameter value.
									</div>
									 </td></tr></tbody></table></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							Because they are cached in the user's session, any custom <code class="literal">PermissionResolver</code> implementations must adhere to several restrictions. Firstly, they cannot contain any state that is more fine-grained than the session scope, and the component itself should be either application- or session-scoped. Secondly, they must not use dependency injection, as they may be accessed from multiple threads simultaneously. For optimal performance, we recommend annotating with <code class="literal">@BypassInterceptors</code> to bypass Seam's interceptor stack altogether.
						</div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690525520432">
      ⁠</a>15.6.8.2. ResolverChain</h3></div></div></div><div class="para">
					A <code class="literal">ResolverChain</code> contains an ordered list of <code class="literal">PermissionResolver</code>s, to resolve object permissions for a particular object class or permission target.
				</div><div class="para">
					The default <code class="literal">ResolverChain</code> consists of all permission resolvers discovered during application deployment. The <code class="literal">org.jboss.seam.security.defaultResolverChainCreated</code> event is raised (and the <code class="literal">ResolverChain</code> instance passed as an event parameter) when the default <code class="literal">ResolverChain</code> is created. This allows additional resolvers that were not discovered during deployment to be added, or for resolvers that are in the chain to be re-ordered or removed.
				</div><div class="para">
					The following sequence diagram shows the interaction between the components of the permission framework during a permission check. A permission check can originate from a number of possible sources: the security interceptor, the <code class="literal">s:hasPermission</code> EL function, or via an API call to <code class="literal">Identity.checkPermission</code>:
				</div><div class="mediaobject" style="text-align: center"><img src="images/security-permission-sequence.png" align="middle" alt="ResolverChain" style="text-align: middle"/></div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							1. A permission check is initiated (either in code or via an EL expression), resulting in a call to <code class="literal">Identity.hasPermission()</code>.
						</div></li><li class="listitem"><div class="para">
							1.1. <code class="literal">Identity</code> invokes <code class="literal">PermissionMapper.resolvePermission()</code>, passing in the permission to be resolved.
						</div></li><li class="listitem"><div class="para">
							1.1.1. <code class="literal">PermissionMapper</code> maintains a <code class="literal">Map</code> of <code class="literal">ResolverChain</code> instances, keyed by class. It uses this map to locate the correct <code class="literal">ResolverChain</code> for the permission's target object. Once it has the correct <code class="literal">ResolverChain</code>, it retrieves the list of <code class="literal">PermissionResolver</code>s it contains by calling <code class="literal">ResolverChain.getResolvers()</code>.
						</div></li><li class="listitem"><div class="para">
							1.1.2. For each <code class="literal">PermissionResolver</code> in the <code class="literal">ResolverChain</code>, the <code class="literal">PermissionMapper</code> invokes its <code class="literal">hasPermission()</code> method, passing in the permission instance to be checked. If the <code class="literal">PermissionResolver</code>s return <code class="literal">true</code>, the permission check has succeeded and the <code class="literal">PermissionMapper</code> also returns <code class="literal">true</code> to <code class="literal">Identity</code>. If none of the <code class="literal">PermissionResolver</code>s return <code class="literal">true</code>, then the permission check has failed.
						</div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690532980192">
      ⁠</a>15.6.9. RuleBasedPermissionResolver</h2></div></div></div><div class="para">
				One of the built-in permission resolvers provided by Seam. This evaluates permissions based on a set of Drools (JBoss Rules) security rules. Some advantages to the rule engine are a centralized location for the business logic used to evaluate user permissions, and speed — Drools algorithms are very efficient for evaluating large numbers of complex rules involving multiple conditions.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690499324528">
      ⁠</a>15.6.9.1. Requirements</h3></div></div></div><div class="para">
					If you want to use the rule-based permission features provided by Seam Security, Drools requires the following <code class="filename">JAR</code> files to be distributed with your project:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							drools-api.jar
						</div></li><li class="listitem"><div class="para">
							drools-compiler.jar
						</div></li><li class="listitem"><div class="para">
							drools-core.jar
						</div></li><li class="listitem"><div class="para">
							janino.jar
						</div></li><li class="listitem"><div class="para">
							antlr-runtime.jar
						</div></li><li class="listitem"><div class="para">
							mvel2.jar
						</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690517558896">
      ⁠</a>15.6.9.2. Configuration</h3></div></div></div><div class="para">
					The configuration for <code class="literal">RuleBasedPermissionResolver</code> requires that a Drools rule base is first configured in <code class="filename">components.xml</code>. By default, it expects the rule base to be named <code class="literal">securityRules</code>, as per the following example:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;components</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/components"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:core=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/core"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:security=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/security"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:drools=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/drools"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xsi:schemaLocation=</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_String">"http://jboss.com/products/seam/core </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/core-2.2.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/components </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/components-2.2.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/drools </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/drools-2.2.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/security </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">               http://jboss.com/products/seam/security-2.2.xsd"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;drools:rule-base</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"securityRules"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;drools:rule-files&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>/META-INF/security.drl<span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/drools:rule-files&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/drools:rule-base&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/components&gt;</span>
</pre><div class="para">
					The default rule base name can be overridden by specifying the <code class="literal">security-rules</code> property for <code class="literal">RuleBasedPermissionResolver</code>:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:rule-based-permission-resolver</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          security-rules=</span><span xmlns="" class="perl_String">"#{prodSecurityRules}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
					Once the <code class="literal">RuleBase</code> component is configured, you must write the security rules.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690450228000">
      ⁠</a>15.6.9.3. Writing Security Rules</h3></div></div></div><div class="para">
					The first step to writing security rules is to create a new rule file in the <code class="literal">/META-INF</code> directory of your application's jar file. This file should be named <code class="literal">security.drl</code> or similar, but can be named anything as long as it is configured correspondingly in <code class="filename">components.xml</code>.
				</div><div class="para">
					We recommend the Drools documentation when you write your rules file. A simple example of rules file contents is:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>package MyApplicationPermissions;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.seam.security.permission.PermissionCheck;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.seam.security.Role;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>rule CanUserDeleteCustomers
<span xmlns="" class="line">​</span>when
<span xmlns="" class="line">​</span>  c: <span xmlns="" class="perl_Function">PermissionCheck</span>(target == <span xmlns="" class="perl_String">"customer"</span>, action == <span xmlns="" class="perl_String">"delete"</span>)
<span xmlns="" class="line">​</span>  Role(name == <span xmlns="" class="perl_String">"admin"</span>)
<span xmlns="" class="line">​</span>then
<span xmlns="" class="line">​</span>  c.<span xmlns="" class="perl_Function">grant</span>();
<span xmlns="" class="line">​</span>end
</pre><div class="para">
					Here, the first thing we see is the package declaration. A package in Drools is a collection of rules. The package name does not relate to anything outside the scope of the rule base, so it can be given any name.
				</div><div class="para">
					Next, we have several import statements for the <code class="literal">PermissionCheck</code> and <code class="literal">Role</code> classes. These imports inform the rules engine that our rules will refer to these classes.
				</div><div class="para">
					Finally, we have the rule code. Each rule within a package should have a unique name, usually to describe the rule's purpose. In this case our rule is called <code class="literal">CanUserDeleteCustomers</code> and will be used to check whether a user is allowed to delete a customer record.
				</div><div class="para">
					There are two distinct sections in the body of the rule definition. Rules have a left hand side (LHS) and a right hand side (RHS). The LHS is the conditional portion of the rule, that is, a list of conditions that must be satisfied for the rule to fire. The LHS is represented by the <code class="literal">when</code> section. The RHS is the consequence or action section of the rule, which will only be fired if all conditions in the LHS are met. The RHS is represented by the <code class="literal">then</code> section. The end of the rule is denoted by the <code class="literal">end</code> line.
				</div><div class="para">
					There are two conditions listed in the example LHS. The first condition is:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>c: <span xmlns="" class="perl_Function">PermissionCheck</span>(target == <span xmlns="" class="perl_String">"customer"</span>, action == <span xmlns="" class="perl_String">"delete"</span>)
</pre><div class="para">
					More plainly, this condition states that, to be fulfilled, there must be a <code class="literal">PermissionCheck</code> object with a <code class="literal">target</code> property equal to <code class="literal">customer</code>, and an <code class="literal">action</code> property equal to <code class="literal">delete</code> within the working memory.
				</div><div class="para">
					Working memory is also known as a <span class="emphasis"><em>stateful session</em></span> in Drools terminology. It is a session-scoped object containing the contextual information that the rules engine requires to make a decision about a permission check. Each time the <code class="literal">hasPermission()</code> method is called, a temporary <code class="literal">PermissionCheck</code> object, or <span class="emphasis"><em>Fact</em></span>, is inserted into the working memory. This <code class="literal">PermissionCheck</code> corresponds exactly to the permission being checked, so if you call <code class="literal">hasPermission("account", "create")</code>, a <code class="literal">PermissionCheck</code> object with a <code class="literal">target</code> equal to "account" and <code class="literal">action</code> equal to "create" will be inserted into the working memory for the duration of the permission check.
				</div><div class="para">
					Other than the <code class="literal">PermissionCheck</code> facts, there is also an <code class="literal">org.jboss.seam.security.Role</code> fact for each role that the authenticated user is a member of. These <code class="literal">Role</code> facts are synchronized with the user's authenticated roles at the beginning of every permission check. As a consequence, any <code class="literal">Role</code> object inserted into the working memory during the course of a permission check will be removed before the next permission check occurs, unless the authenticated user is actually a member of that role. The working memory also contains the <code class="literal">java.security.Principal</code> object created as a result of the authentication process.
				</div><div class="para">
					You can insert additional long-lived facts into the working memory by calling <code class="literal">RuleBasedPermissionResolver.instance().getSecurityContext().insert ()</code>, which passes the object as a parameter. <code class="literal">Role</code> objects are the exception, here, since they are synchronized at the start of each permission check.
				</div><div class="para">
					To return to our simple example, the first line of our LHS is prefixed with <code class="literal">c:</code>. This is a variable binding, and is used to refer back to the object matching the condition (in this case, the <code class="literal">PermissionCheck</code>). The second line of the LHS is:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>Role(name == <span xmlns="" class="perl_String">"admin"</span>)</pre><div class="para">
					This condition states that there must be a <code class="literal">Role</code> object with a <code class="literal">name</code> of "admin" within the working memory. So, if you are checking for the <code class="literal">customer:delete</code> permission and the user is a member of the <code class="literal">admin</code> role, this rule will fire.
				</div><div class="para">
					The RHS shows us the consequence of the rule firing:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>c.<span xmlns="" class="perl_Function">grant</span>()</pre><div class="para">
					The RHS consists of Java code. In this case it invokes the <code class="literal">grant()</code> method of the <code class="literal">c</code> object, which is a variable binding for the <code class="literal">PermissionCheck</code> object. Other than the <code class="literal">name</code> and <code class="literal">action</code> properties of the <code class="literal">PermissionCheck</code> object, there is also a <code class="literal">granted</code> property. This is initially set to <code class="literal">false</code>. Calling <code class="literal">grant()</code> on a <code class="literal">PermissionCheck</code> sets the <code class="literal">granted</code> property to <code class="literal">true</code>. This means the permission check succeeded, and the user has permission to carry out the action that prompted the permission check.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690492970800">
      ⁠</a>15.6.9.4. Non-String permission targets</h3></div></div></div><div class="para">
					So far, we have only looked at permission checks for String-literal permission targets. However, you can also write security rules for more complex permission targets. For example, say you want to write a security rule to allow your users to create blog comments. The following rule shows one way this can be expressed, by requiring that the target of the permission check be an instance of <code class="literal">MemberBlog</code>, and that the currently authenticated user be a member of the <code class="literal">user</code> role:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>rule CanCreateBlogComment
<span xmlns="" class="line">​</span>  no-loop
<span xmlns="" class="line">​</span>  activation-group <span xmlns="" class="perl_String">"permissions"</span>
<span xmlns="" class="line">​</span>when
<span xmlns="" class="line">​</span>  blog: <span xmlns="" class="perl_Function">MemberBlog</span>()
<span xmlns="" class="line">​</span>  check: <span xmlns="" class="perl_Function">PermissionCheck</span>(target == blog, action == <span xmlns="" class="perl_String">"create"</span>, 
<span xmlns="" class="line">​</span>                         granted == <span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span>  Role(name == <span xmlns="" class="perl_String">"user"</span>)
<span xmlns="" class="line">​</span>then
<span xmlns="" class="line">​</span>  check.<span xmlns="" class="perl_Function">grant</span>();
<span xmlns="" class="line">​</span>end
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690497699488">
      ⁠</a>15.6.9.5. Wildcard permission checks</h3></div></div></div><div class="para">
					It is possible to implement a wildcard permission check (which allows all actions for a given permission target), by omitting the <code class="literal">action</code> constraint for the <code class="literal">PermissionCheck</code> in your rule, like so:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>rule CanDoAnythingToCustomersIfYouAreAnAdmin
<span xmlns="" class="line">​</span>when
<span xmlns="" class="line">​</span>  c: <span xmlns="" class="perl_Function">PermissionCheck</span>(target == <span xmlns="" class="perl_String">"customer"</span>)
<span xmlns="" class="line">​</span>  Role(name == <span xmlns="" class="perl_String">"admin"</span>)
<span xmlns="" class="line">​</span>then
<span xmlns="" class="line">​</span>  c.<span xmlns="" class="perl_Function">grant</span>();
<span xmlns="" class="line">​</span>end;
</pre><div class="para">
					This rule allows users with the <code class="literal">admin</code> role to perform <span class="emphasis"><em>any</em></span> action for any <code class="literal">customer</code> permission check.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690517245520">
      ⁠</a>15.6.10. PersistentPermissionResolver</h2></div></div></div><div class="para">
				Another built-in permission resolver provided by Seam, <code class="literal">PersistentPermissionResolver</code>, allows permissions to be loaded from persistent storage, such as a relational database. This permission resolver provides Access Control List-style instance-based security, allowing specific object permissions to be assigned to individual users and roles. It also allows persistent, arbitrarily-named permission targets (which are not necessarily object/class based) to be assigned in the same way.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690509575776">
      ⁠</a>15.6.10.1. Configuration</h3></div></div></div><div class="para">
					To use <code class="literal">PersistentPermissionResolver</code>, you must configure a valid <code class="literal">PermissionStore</code> in <code class="filename">components.xml</code>. If this is not configured, the <code class="literal">PersistentPermissionResolver</code> will attempt to use the default permission store, <a class="xref" href="security.html#security-id_management-jpaidstore">Section 15.4.2.4, “JpaIdentityStore Events”</a>. To use a permission store other than the default, configure the <code class="literal">permission-store</code> property as follows:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:persistent-permission-resolver</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          permission-store=</span><span xmlns="" class="perl_String">"#{myCustomPermissionStore}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690521616640">
      ⁠</a>15.6.10.2. Permission Stores</h3></div></div></div><div class="para">
					<code class="literal">PersistentPermissionResolver</code> requires a permission store to connect to the back-end storage where permissions are persisted. Seam provides one <code class="literal">PermissionStore</code> implementation out of the box, <code class="literal">JpaPermissionStore</code>, which stores permissions inside a relational database. You can write your own permission store by implementing the <code class="literal">PermissionStore</code> interface, which defines the following methods:
				</div><div class="table"><a id="idm139690498844032">
      ⁠</a><p class="title"><strong>Table 15.8. PermissionStore interface</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="PermissionStore interface"><colgroup><col width="25%"/><col width="50%"/><col width="25%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
									Return type
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Method
								</div>
								 </th><th style="text-align: center"> <div class="para">
									Description
								</div>
								 </th></tr></thead><tbody><tr><td> <div class="para">
									<code class="literal">List&lt;Permission&gt;</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">listPermissions(Object target)</code>
								</div>
								 </td><td> <div class="para">
									This method should return a <code class="literal">List</code> of <code class="literal">Permission</code> objects representing all the permissions granted for the specified target object.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">List&lt;Permission&gt;</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">listPermissions(Object target, String action)</code>
								</div>
								 </td><td> <div class="para">
									This method should return a <code class="literal">List</code> of <code class="literal">Permission</code> objects representing all the permissions with the specified action granted for the specified target object.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">List&lt;Permission&gt;</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">listPermissions(Set&lt;Object&gt; targets, String action)</code>
								</div>
								 </td><td> <div class="para">
									This method should return a <code class="literal">List</code> of <code class="literal">Permission</code> objects representing all the permissions with the specified action granted for the specified set of target objects.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">boolean</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">grantPermission(Permission)</code>
								</div>
								 </td><td> <div class="para">
									This method should persist the specified <code class="literal">Permission</code> object to the back-end storage, and return <code class="literal">true</code> if successful.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">boolean</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">grantPermissions(List&lt;Permission&gt; permissions)</code>
								</div>
								 </td><td> <div class="para">
									This method should persist all of the <code class="literal">Permission</code> objects contained in the specified <code class="literal">List</code>, and return <code class="literal">true</code> if successful.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">boolean</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">revokePermission(Permission permission)</code>
								</div>
								 </td><td> <div class="para">
									This method should remove the specified <code class="literal">Permission</code> object from persistent storage.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">boolean</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">revokePermissions(List&lt;Permission&gt; permissions)</code>
								</div>
								 </td><td> <div class="para">
									This method should remove all of the <code class="literal">Permission</code> objects in the specified list from persistent storage.
								</div>
								 </td></tr><tr><td> <div class="para">
									<code class="literal">List&lt;String&gt;</code>
								</div>
								 </td><td> <div class="para">
									<code class="literal">listAvailableActions(Object target)</code>
								</div>
								 </td><td> <div class="para">
									This method should return a list of all available actions (as Strings) for the class of the specified target object. It is used in conjunction with permission management to build the user interface for granting specific class permissions.
								</div>
								 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690525479872">
      ⁠</a>15.6.10.3. JpaPermissionStore</h3></div></div></div><div class="para">
					The Seam-provided default <code class="literal">PermissionStore</code> implementation, which stores permissions in a relational database. It must be configured with either one or two entity classes for storing user and role permissions before it can be used. These entity classes must be annotated with a special set of security annotations to configure the entity properties that correspond to various aspects of the stored permissions.
				</div><div class="para">
					If you want to use the same entity (that is, a single database table) to store both user and role permissions, then you only need to configure the <code class="literal">user-permission-class</code> property. To user separate tables for user and role permission storage, you must also configure the <code class="literal">role-permission-class</code> property.
				</div><div class="para">
					For example, to configure a single entity class to store both user and role permissions:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:jpa-permission-store</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          user-permission-class=</span><span xmlns="" class="perl_String">"com.acme.model.AccountPermission"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
					To configure separate entity classes for storing user and role permissions:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:jpa-permission-store</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          user-permission-class=</span><span xmlns="" class="perl_String">"com.acme.model.UserPermission"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          role-permission-class=</span><span xmlns="" class="perl_String">"com.acme.model.RolePermission"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690534097568">
      ⁠</a>15.6.10.3.1. Permission annotations</h4></div></div></div><div class="para">
						The entity classes that contain the user and role permissions must be configured with a special set of annotations in the <code class="literal">org.jboss.seam.annotations.security.permission</code> package. The following table describes these annotations:
					</div><div class="table"><a id="idm139690529291552">
      ⁠</a><p class="title"><strong>Table 15.9. Entity Permission annotations</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Entity Permission annotations"><colgroup><col width="40%"/><col width="20%"/><col width="40%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
										Annotation
									</div>
									 </th><th style="text-align: center"> <div class="para">
										Target
									</div>
									 </th><th style="text-align: center"> <div class="para">
										Description
									</div>
									 </th></tr></thead><tbody><tr><td> <div class="para">
										<code class="literal">@PermissionTarget</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">FIELD,METHOD</code>
									</div>
									 </td><td> <div class="para">
										This annotation identifies the entity property containing the permission target. The property should be of type <code class="literal">java.lang.String</code>.
									</div>
									 </td></tr><tr><td> <div class="para">
										<code class="literal">@PermissionAction</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">FIELD,METHOD</code>
									</div>
									 </td><td> <div class="para">
										This annotation identifies the entity property containing the permission action. The property should be of type <code class="literal">java.lang.String</code>.
									</div>
									 </td></tr><tr><td> <div class="para">
										<code class="literal">@PermissionUser</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">FIELD,METHOD</code>
									</div>
									 </td><td> <div class="para">
										This annotation identifies the entity property containing the recipient user for the permission. It should be of type <code class="literal">java.lang.String</code> and contain the user's username.
									</div>
									 </td></tr><tr><td> <div class="para">
										<code class="literal">@PermissionRole</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">FIELD,METHOD</code>
									</div>
									 </td><td> <div class="para">
										This annotation identifies the entity property containing the recipient role for the permission. It should be of type <code class="literal">java.lang.String</code> and contain the role name.
									</div>
									 </td></tr><tr><td> <div class="para">
										<code class="literal">@PermissionDiscriminator</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">FIELD,METHOD</code>
									</div>
									 </td><td> <div class="para">
										This annotation should be used when the same entity/table stores both user and role permissions. It identifies the property of the entity being used to discriminate between user and role permissions. By default, if the column value contains the string literal <code class="literal">user</code>, then the record will be treated as a user permission. If it contains the string literal <code class="literal">role</code>, it will be treated as a role permission. You can also override these defaults by specifying the <code class="literal">userValue</code> and <code class="literal">roleValue</code> properties within the annotation. For example, to use <code class="literal">u</code> and <code class="literal">r</code> instead of <code class="literal">user</code> and <code class="literal">role</code>, write the annotation like so: 
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">PermissionDiscriminator</span>(
<span xmlns="" class="line">​</span>  userValue = <span xmlns="" class="perl_String">"u"</span>, 
<span xmlns="" class="line">​</span>  roleValue = <span xmlns="" class="perl_String">"r"</span>)
</pre>

									</div>
									 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690528034656">
      ⁠</a>15.6.10.3.2. Example Entity</h4></div></div></div><div class="para">
						The following is an example of an entity class that stores both user and role permissions, taken from the Seamspace example.
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> AccountPermission <span xmlns="" class="perl_Keyword">implements</span> Serializable {  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer permissionId;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String recipient;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String target;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String action;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String discriminator;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @Id @GeneratedValue
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getPermissionId</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> permissionId;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setPermissionId</span>(Integer permissionId) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">permissionId</span> = permissionId;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @PermissionUser @PermissionRole
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getRecipient</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> recipient;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setRecipient</span>(String recipient) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">recipient</span> = recipient;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @PermissionTarget
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getTarget</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> target;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setTarget</span>(String target) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">target</span> = target;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @PermissionAction
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getAction</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> action;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setAction</span>(String action) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">action</span> = action;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  @PermissionDiscriminator
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getDiscriminator</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> discriminator;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setDiscriminator</span>(String discriminator) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">discriminator</span> = discriminator;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
						Here, the <code class="literal">getDiscriminator()</code> method has been annotated with <code class="literal">@PermissionDiscriminator</code>, to allow <code class="literal">JpaPermissionStore</code> to determine which records represent user permissions and which represent role permissions. The <code class="literal">getRecipient()</code> method is annotated with both <code class="literal">@PermissionUser</code> and <code class="literal">@PermissionRole</code>. This means that the <code class="literal">recipient</code> property of the entity will either contain the name of the user or the name of the role, depending on the value of the <code class="literal">discriminator</code> property.
					</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690500726544">
      ⁠</a>15.6.10.3.3. Class-specific Permission Configuration</h4></div></div></div><div class="para">
						The permissions included in the <code class="literal">org.jboss.seam.annotation.security.permission</code> package can be used to configure a specific set of allowable permissions for a target class.
					</div><div class="table"><a id="idm139690501439808">
      ⁠</a><p class="title"><strong>Table 15.10. Class Permission Annotations</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Class Permission Annotations"><colgroup><col width="25%"/><col width="38%"/><col width="38%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
										Annotation
									</div>
									 </th><th style="text-align: center"> <div class="para">
										Target
									</div>
									 </th><th style="text-align: center"> <div class="para">
										Description
									</div>
									 </th></tr></thead><tbody><tr><td> <div class="para">
										<code class="literal">@Permissions</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">TYPE</code>
									</div>
									 </td><td> <div class="para">
										A container annotation, which can contain an array of <code class="literal">@Permission</code> annotations.
									</div>
									 </td></tr><tr><td> <div class="para">
										<code class="literal">@Permission</code>
									</div>
									 </td><td> <div class="para">
										<code class="literal">TYPE</code>
									</div>
									 </td><td> <div class="para">
										This annotation defines a single allowable permission action for the target class. Its <code class="literal">action</code> property must be specified, and an optional <code class="literal">mask</code> property may also be specified if permission actions are to be persisted as bitmasked values (see section following).
									</div>
									 </td></tr></tbody></table></div></div><div class="para">
						The following shows the above annotations in use. They can also be seen in the SeamSpace example.
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Permissions</span>({
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Permission</span>(action = <span xmlns="" class="perl_String">"view"</span>),
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Permission</span>(action = <span xmlns="" class="perl_String">"comment"</span>)
<span xmlns="" class="line">​</span>})
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MemberImage <span xmlns="" class="perl_Keyword">implements</span> Serializable {...}
</pre><div class="para">
						This example demonstrates how two allowable permission actions, <code class="literal">view</code> and <code class="literal">comment</code> can be declared for the entity class <code class="literal">MemberImage</code>.
					</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690454093984">
      ⁠</a>15.6.10.3.4. Permission masks</h4></div></div></div><div class="para">
						By default, multiple permissions for the same target object and recipient will be persisted as a single database record, with the <code class="literal">action</code> property/column containing a list of granted actions, separated by commas. You can use a bitmasked integer value to store the list of permission actions — this reduces the amount of physical storage required to persist a large number of permissions.
					</div><div class="para">
						For example, if recipient "Bob" is granted both the <code class="literal">view</code> and <code class="literal">comment</code> permissions for a particular <code class="literal">MemberImage</code> (an entity bean) instance, then by default the <code class="literal">action</code> property of the permission entity will contain "<code class="literal">view,comment</code>", representing the two granted permission actions. Or, if you are using bitmasked values defined as follows:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Permissions</span>({
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Permission</span>(action = <span xmlns="" class="perl_String">"view"</span>, mask = <span xmlns="" class="perl_Float">1</span>),
<span xmlns="" class="line">​</span>  @<span xmlns="" class="perl_Function">Permission</span>(action = <span xmlns="" class="perl_String">"comment"</span>, mask = <span xmlns="" class="perl_Float">2</span>)
<span xmlns="" class="line">​</span>})
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MemberImage <span xmlns="" class="perl_Keyword">implements</span> Serializable {...}
</pre><div class="para">
						The <code class="literal">action</code> property will contain "3" (with both the 1 bit and 2 bit switched on). For a large number of allowable actions for any particular target class, the storage required for the permission records is greatly reduced by using bitmasked actions.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
							The <code class="literal">mask</code> values specified must be powers of 2.
						</div></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690466860480">
      ⁠</a>15.6.10.3.5. Identifier Policy</h4></div></div></div><div class="para">
						When storing or looking up permissions, <code class="literal">JpaPermissionStore</code> must be able to uniquely identify specific object instances. To achieve this, an <span class="emphasis"><em>identifier strategy</em></span> may be assigned to each target class so that unique identifier values can be generated. Each identifier strategy implementation knows how to generate unique identifiers for a particular type of class, and creating new identifier strategies is simple.
					</div><div class="para">
						The <code class="literal">IdentifierStrategy</code> interface is very simple, declaring only two methods:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">interface</span> IdentifierStrategy { 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_DataType">boolean</span> <span xmlns="" class="perl_Function">canIdentify</span>(<span xmlns="" class="perl_Keyword">Class</span> targetClass); 
<span xmlns="" class="line">​</span>  String <span xmlns="" class="perl_Function">getIdentifier</span>(Object target); 
<span xmlns="" class="line">​</span>}
</pre><div class="para">
						The first method, <code class="literal">canIdentify()</code>, returns <code class="literal">true</code> if the identifier strategy is capable of generating a unique identifier for the specified target class. The second method, <code class="literal">getIdentifier()</code>, returns the unique identifier value for the specified target object.
					</div><div class="para">
						Seam also provides two <code class="literal">IdentifierStrategy</code> implementations, <code class="literal">ClassIdentifierStrategy</code> and <code class="literal">EntityIdentifierStrategy</code>, which are described in the sections following.
					</div><div class="para">
						To explicitly configure a specific identifier strategy for a particular class, annotate the strategy with <code class="literal">org.jboss.seam.annotations.security.permission.Identifier</code> and set the value to a concrete implementation of the <code class="literal">IdentifierStrategy</code> interface. You may also specify a <code class="literal">name</code> property. (The effect of this depends upon the <code class="literal">IdentifierStrategy</code> implementation used.)
					</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690467803840">
      ⁠</a>15.6.10.3.6. ClassIdentifierStrategy</h4></div></div></div><div class="para">
						This identifier strategy generates unique identifiers for classes, and uses the value of the <code class="literal">name</code> (if specified) in the <code class="literal">@Identifier</code> annotation. If no <code class="literal">name</code> property is provided, the identifier strategy attempts to use the component name of the class (if the class is a Seam component). It will create an identifier based on the class name (excluding the package name) as a last resort. For example, the identifier for the following class will be <code class="literal">customer</code>:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Identifier</span>(name = <span xmlns="" class="perl_String">"customer"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {...}
</pre><div class="para">
						The identifier for the following class will be <code class="literal">customerAction</code>:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"customerAction"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> CustomerAction {...}
</pre><div class="para">
						Finally, the identifier for the following class will be <code class="literal">Customer</code>:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {...}</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm139690522195712">
      ⁠</a>15.6.10.3.7. EntityIdentifierStrategy</h4></div></div></div><div class="para">
						This identifier strategy generates unique identifiers for entity beans. It concatenates the entity name (or otherwise configured name) with a string representation of the primary key value of the entity. The rules for generating the name section of the identifier are similar to those in <code class="literal">ClassIdentifierStrategy</code>. The primary key value (that is, the entity ID) is obtained with the <code class="literal">PersistenceProvider</code> component, which can determine the value regardless of the persistence implementation being used in the Seam application. For entities not annotated with <code class="literal">@Entity</code>, you must explicitly configure the identifier strategy on the entity class itself, like this:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Identifier</span>(value = EntityIdentifierStrategy.<span xmlns="" class="perl_Function">class</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {...}
</pre><div class="para">
						Assume we have the following entity class:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> Integer id;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String firstName;
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String lastName;
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  @Id 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> Integer <span xmlns="" class="perl_Function">getId</span>() { <span xmlns="" class="perl_Keyword">return</span> id; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setId</span>(Integer id) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">id</span> = id; }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getFirstName</span>() { <span xmlns="" class="perl_Keyword">return</span> firstName; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setFirstName</span>(String firstName) { 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">firstName</span> = firstName; 
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getLastName</span>() { <span xmlns="" class="perl_Keyword">return</span> lastName; }
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setLastName</span>(String lastName) { <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">lastName</span> = lastName; }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
						For a <code class="literal">Customer</code> instance with an <code class="literal">id</code> value of <code class="literal">1</code>, the value of the identifier would be <code class="literal">Customer:1</code>. If the entity class is annotated with an explicit identifier name, like so:
					</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@Entity @<span xmlns="" class="perl_Function">Identifier</span>(name = <span xmlns="" class="perl_String">"cust"</span>) 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> Customer {...}
</pre><div class="para">
						Then a <code class="literal">Customer</code> with an <code class="literal">id</code> value of <code class="literal">123</code> would have an identifier value of "<code class="literal">cust:123</code>".
					</div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690518827728">
      ⁠</a>15.7. Permission Management</h1></div></div></div><div class="para">
			Just as Seam Security provides an Identity Management API to let you manage users and roles, it also provides a Permissions Management API to let you manage persistent user permissions — the <code class="literal">PermissionManager</code> component.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690518825792">
      ⁠</a>15.7.1. PermissionManager</h2></div></div></div><div class="para">
				The <code class="literal">PermissionManager</code> component is an application-scoped Seam component that provides a number of permission-management methods. It must be configured with a permission store before use. By default, it will attempt to use <code class="literal">JpaPermissionStore</code>. To configure a custom permission store, specify the <code class="literal">permission-store</code> property in <code class="filename">components.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security:permission-manager</span><span xmlns="" class="perl_Others"> permission-store=</span><span xmlns="" class="perl_String">"#{ldapPermissionStore}"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
				The following table describes each of the methods provided by <code class="literal">PermissionManager</code>:
			</div><div class="table"><a id="idm139690456352432">
      ⁠</a><p class="title"><strong>Table 15.11. PermissionManager API methods</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="PermissionManager API methods"><colgroup><col width="25%"/><col width="50%"/><col width="25%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
								Return type
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Method
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Description
							</div>
							 </th></tr></thead><tbody><tr><td> <div class="para">
								<code class="literal">List&lt;Permission&gt;</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">listPermissions(Object target, String action)</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of <code class="literal">Permission</code> objects representing all of the permissions that have been granted for the specified target and action.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">List&lt;Permission&gt;</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">listPermissions(Object target)</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of <code class="literal">Permission</code> objects representing all of the permissions that have been granted for the specified target and action.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">grantPermission(Permission permission)</code>
							</div>
							 </td><td> <div class="para">
								Persists (grants) the specified <code class="literal">Permission</code> to the back-end permission store. Returns <code class="literal">true</code> if the operation succeeds.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">grantPermissions(List&lt;Permission&gt; permissions)</code>
							</div>
							 </td><td> <div class="para">
								Persists (grants) the specified list of <code class="literal">Permission</code>s to the back-end permission store. Returns <code class="literal">true</code> if the operation succeeds.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">revokePermission(Permission permission)</code>
							</div>
							 </td><td> <div class="para">
								Removes (revokes) the specified <code class="literal">Permission</code> from the back-end permission store. Returns <code class="literal">true</code> if the operation succeeds.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">boolean</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">revokePermissions(List&lt;Permission&gt; permissions)</code>
							</div>
							 </td><td> <div class="para">
								Removes (revokes) the specified list of <code class="literal">Permission</code>s from the back-end permission store. Returns <code class="literal">true</code> if the operation succeeds.
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">List&lt;String&gt;</code>
							</div>
							 </td><td> <div class="para">
								<code class="literal">listAvailableActions(Object target)</code>
							</div>
							 </td><td> <div class="para">
								Returns a list of the available actions for the specified target object. The actions that this method returns are dependent on the <code class="literal">@Permission</code> annotations configured on the target object's class.
							</div>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690499617136">
      ⁠</a>15.7.2. Permission checks for PermissionManager operations</h2></div></div></div><div class="para">
				To invoke <code class="literal">PermissionManager</code> methods, the currently authenticated user must be authorized to perform that management operation. The following table lists the permissions required to invoke a particular method.
			</div><div class="table"><a id="idm139690499615232">
      ⁠</a><p class="title"><strong>Table 15.12. Permission Management Security Permissions</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols lt-7-rows" summary="Permission Management Security Permissions"><colgroup><col width="33%"/><col width="33%"/><col width="33%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
								Method
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Permission Target
							</div>
							 </th><th style="text-align: center"> <div class="para">
								Permission Action
							</div>
							 </th></tr></thead><tbody><tr><td> <div class="para">
								<code class="literal">listPermissions()</code>
							</div>
							 </td><td> <div class="para">
								The specified <code class="literal">target</code>.
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.read-permissions</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">grantPermission()</code>
							</div>
							 </td><td> <div class="para">
								The target of the specified <code class="literal">Permission</code>, or each of the targets for the specified list of <code class="literal">Permission</code>s (depending on the method called).
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.grant-permission</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">grantPermission()</code>
							</div>
							 </td><td> <div class="para">
								The target of the specified <code class="literal">Permission</code>.
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.grant-permission</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">grantPermissions()</code>
							</div>
							 </td><td> <div class="para">
								Each of the targets of the specified list of <code class="literal">Permission</code>s.
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.grant-permission</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">revokePermission()</code>
							</div>
							 </td><td> <div class="para">
								The target of the specified <code class="literal">Permission</code>.
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.revoke-permission</code>
							</div>
							 </td></tr><tr><td> <div class="para">
								<code class="literal">revokePermissions()</code>
							</div>
							 </td><td> <div class="para">
								Each of the targets of the specified list of <code class="literal">Permission</code>s.
							</div>
							 </td><td> <div class="para">
								<code class="literal">seam.revoke-permission</code>
							</div>
							 </td></tr></tbody></table></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690539558928">
      ⁠</a>15.8. SSL Security</h1></div></div></div><div class="para">
			Seam includes basic support for serving sensitive pages via the HTTPS protocol. To configure this, specify a <code class="literal">scheme</code> for the page in <code class="filename">pages.xml</code>. The following example shows how the view <code class="filename">/login.xhtml</code> can be configured to use HTTPS:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/login.xhtml"</span><span xmlns="" class="perl_Others"> scheme=</span><span xmlns="" class="perl_String">"https"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			This configuration automatically extends to both <code class="literal">s:link</code> and <code class="literal">s:button</code> JSF controls, which (when specifying the <code class="literal">view</code>) will render the link under the correct protocol. Based on the previous example, the following link will use the HTTPS protocol because <code class="filename">/login.xhtml</code> is configured to use it:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;s:link</span><span xmlns="" class="perl_Others"> view=</span><span xmlns="" class="perl_String">"/login.xhtml"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Login"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			If a user browses directly to a view with the incorrect protocol, a redirect is triggered, and the same view will be reloaded with the correct protocol. For example, browsing to a <code class="literal">scheme="https"</code> page with HTTP triggers a redirect to the same page using HTTPS.
		</div><div class="para">
			You can also configure a <span class="emphasis"><em>default scheme</em></span> for all pages. This is useful if you only want to use HTTPS for a few pages. If no default scheme is specified, the current scheme will be used. So, once the user accesses a page requiring HTTPS, then HTTPS continues to be used after the user has navigated to other non-HTTPS pages. This is good for security, but not for performance. To define HTTP as the default <code class="literal">scheme</code>, add this line to <code class="filename">pages.xml</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"*"</span><span xmlns="" class="perl_Others"> scheme=</span><span xmlns="" class="perl_String">"http"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			If <span class="emphasis"><em>none</em></span> of the pages in your application use HTTPS, you need not define a default scheme.
		</div><div class="para">
			You can configure Seam to automatically invalidate the current HTTP session each time the scheme changes. To do so, add this line to <code class="literal">components.xml</code>:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;web:session</span><span xmlns="" class="perl_Others"> invalidate-on-scheme-change=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
			This option offers more protection from session ID sniffing and sensitive data leakage from pages using HTTPS to pages using HTTP.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690456319824">
      ⁠</a>15.8.1. Overriding the default ports</h2></div></div></div><div class="para">
				If you wish to configure the HTTP and HTTPS ports manually, you can do so in <code class="filename">pages.xml</code> by specifying the <code class="literal">http-port</code> and <code class="literal">https-port</code> attributes on the <code class="literal">pages</code> element:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;pages</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/pages"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xmlns:xsi=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       xsi:schemaLocation=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/pages http://jboss.com/products/seam/pages-2.2.xsd"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       no-conversation-view-id=</span><span xmlns="" class="perl_String">"/home.xhtml"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       login-view-id=</span><span xmlns="" class="perl_String">"/login.xhtml"</span><span xmlns="" class="perl_Others"> http-port=</span><span xmlns="" class="perl_String">"8080"</span><span xmlns="" class="perl_Others"> https-port=</span><span xmlns="" class="perl_String">"8443"</span><span xmlns="" class="perl_Keyword">&gt;</span>      
<span xmlns="" class="line">​</span>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690517697904">
      ⁠</a>15.9. CAPTCHA</h1></div></div></div><div class="para">
			Though not strictly part of the security API, Seam provides a built-in CAPTCHA (Completely Automated Public Turing test to tell Computers and Humans Apart) algorithm to prevent automated processes from interacting with your application.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690517696400">
      ⁠</a>15.9.1. Configuring the CAPTCHA Servlet</h2></div></div></div><div class="para">
				To use CAPTCHA, you need to configure the Seam Resource Servlet, which provides your pages with CAPTCHA challenge images. Add the following to <code class="filename">web.xml</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;servlet&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>Seam Resource Servlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet-class&gt;</span>org.jboss.seam.servlet.SeamResourceServlet<span xmlns="" class="perl_Keyword">&lt;/servlet-class&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/servlet&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;servlet-mapping&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;servlet-name&gt;</span>Seam Resource Servlet<span xmlns="" class="perl_Keyword">&lt;/servlet-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/seam/resource/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/servlet-mapping&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690507567184">
      ⁠</a>15.9.2. Adding a CAPTCHA to a form</h2></div></div></div><div class="para">
				It is easy to add a CAPTCHA challenge to a form:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:graphicImage</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/seam/resource/captcha"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"verifyCaptcha"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{captcha.response}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     required=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;s:validate</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/h:inputText&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:message</span><span xmlns="" class="perl_Others"> for=</span><span xmlns="" class="perl_String">"verifyCaptcha"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
				That is all you need to do. The <code class="literal">graphicImage</code> control displays the CAPTCHA challenge, and the <code class="literal">inputText</code> receives the user's response. The response is automatically validated against the CAPTCHA when the form is submitted.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690462839248">
      ⁠</a>15.9.3. Customizing the CAPTCHA algorithm</h2></div></div></div><div class="para">
				You can customize the CAPTCHA algorithm by overriding the built-in component:
			</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"org.jboss.seam.captcha.captcha"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(SESSION)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> HitchhikersCaptcha <span xmlns="" class="perl_Keyword">extends</span> Captcha
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>  @Override @Create
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">init</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">setChallenge</span>(<span xmlns="" class="perl_String">"What is the answer to life, the universe and everything?"</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">setCorrectResponse</span>(<span xmlns="" class="perl_String">"42"</span>);
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> BufferedImage <span xmlns="" class="perl_Function">renderChallenge</span>() {
<span xmlns="" class="line">​</span>    BufferedImage img = <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">renderChallenge</span>();
<span xmlns="" class="line">​</span>    img.<span xmlns="" class="perl_Function">getGraphics</span>().<span xmlns="" class="perl_Function">drawOval</span>(<span xmlns="" class="perl_Float">5</span>, <span xmlns="" class="perl_Float">3</span>, <span xmlns="" class="perl_Float">60</span>, <span xmlns="" class="perl_Float">14</span>); <span xmlns="" class="perl_Comment">//add an obscuring decoration</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> img;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="security-security_events">
      ⁠</a>15.10. Security Events</h1></div></div></div><div class="para">
			The following table describes a number of events (see <a class="xref" href="events.html">Chapter 7, <em>Events, interceptors and exception handling</em></a>) raised by Seam Security in response to certain security-related events.
		</div><div class="table"><a id="idm139690474094368">
      ⁠</a><p class="title"><strong>Table 15.13. Security Events</strong></p><div class="table-contents"><table xmlns:d="http://docbook.org/ns/docbook" class="lt-4-cols gt-7-rows" summary="Security Events"><colgroup><col width="60%"/><col width="40%"/></colgroup><thead><tr><th style="text-align: center"> <div class="para">
							Event Key
						</div>
						 </th><th style="text-align: center"> <div class="para">
							Description
						</div>
						 </th></tr></thead><tbody><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.loginSuccessful</code>
						</div>
						 </td><td> <div class="para">
							Raised when a log in attempt is successful.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.loginFailed</code>
						</div>
						 </td><td> <div class="para">
							Raised when a log in attempt fails.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.alreadyLoggedIn</code>
						</div>
						 </td><td> <div class="para">
							Raised when a user that is already authenticated attempts to log in again.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.notLoggedIn</code>
						</div>
						 </td><td> <div class="para">
							Raised when a security check fails when the user is not logged in.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.notAuthorized</code>
						</div>
						 </td><td> <div class="para">
							Raised when a security check fails because the user is logged in, but does not have sufficient privileges.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.preAuthenticate</code>
						</div>
						 </td><td> <div class="para">
							Raised just prior to user authentication.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.postAuthenticate</code>
						</div>
						 </td><td> <div class="para">
							Raised just after user authentication.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.loggedOut</code>
						</div>
						 </td><td> <div class="para">
							Raised after the user has logged out.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.credentialsUpdated</code>
						</div>
						 </td><td> <div class="para">
							Raised when the user's credentials have been changed.
						</div>
						 </td></tr><tr><td> <div class="para">
							<code class="literal">org.jboss.seam.security.rememberMe</code>
						</div>
						 </td><td> <div class="para">
							Raised when the Identity's rememberMe property is changed.
						</div>
						 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690450129824">
      ⁠</a>15.11. Run As</h1></div></div></div><div class="para">
			Users sometimes need to perform certain operations with elevated privileges — for example, an unauthenticated user may need to create a new user account. Seam Security provides support in this situation with the <code class="literal">RunAsOperation</code> class. This class allows either the <code class="literal">Principal</code> or <code class="literal">Subject</code>, or the user's roles, to be overridden for a single set of operations.
		</div><div class="para">
			The following code demonstrates <code class="literal">RunAsOperation</code> usage. The <code class="literal">addRole()</code> method is called to provide a set of roles to 'borrow' for the duration of the operation. The <code class="literal">execute()</code> method contains the code that will be executed with the elevated privileges.
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">RunAsOperation</span>() {       
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">execute</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Function">executePrivilegedOperation</span>();
<span xmlns="" class="line">​</span>  }         
<span xmlns="" class="line">​</span>}.<span xmlns="" class="perl_Function">addRole</span>(<span xmlns="" class="perl_String">"admin"</span>)
<span xmlns="" class="line">​</span> .<span xmlns="" class="perl_Function">run</span>();
</pre><div class="para">
			Similarly, the <code class="literal">getPrincipal()</code> or <code class="literal">getSubject()</code> methods can also be overidden to specify the <code class="literal">Principal</code> and <code class="literal">Subject</code> instances to use for the duration of the operation. Finally, the <code class="literal">run()</code> method is used to carry out the <code class="literal">RunAsOperation</code>.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690515406832">
      ⁠</a>15.12. Extending the Identity component</h1></div></div></div><div class="para">
			If your application has special security requirements, you may need to extend your Identity component. The following example shows an Identity component extended with an additional <code class="literal">companyCode</code> field to handle credentials. (Usually this would be handled by a <code class="literal">Credentials</code> component.) The install precedence of <code class="literal">APPLICATION</code> ensures that this extended Identity is installed instead of the built-in Identity.
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"org.jboss.seam.security.identity"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Scope</span>(SESSION)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Install</span>(precedence = APPLICATION)
<span xmlns="" class="line">​</span>@BypassInterceptors
<span xmlns="" class="line">​</span>@Startup
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> CustomIdentity <span xmlns="" class="perl_Keyword">extends</span> Identity {
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> <span xmlns="" class="perl_DataType">static</span> <span xmlns="" class="perl_DataType">final</span> LogProvider log = 
<span xmlns="" class="line">​</span>                       Logging.<span xmlns="" class="perl_Function">getLogProvider</span>(CustomIdentity.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">private</span> String companyCode;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">getCompanyCode</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> companyCode;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setCompanyCode</span>(String companyCode) {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">this</span>.<span xmlns="" class="perl_Function">companyCode</span> = companyCode;
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  @Override
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">public</span> String <span xmlns="" class="perl_Function">login</span>() {
<span xmlns="" class="line">​</span>    log.<span xmlns="" class="perl_Function">info</span>(<span xmlns="" class="perl_String">"###### CUSTOM LOGIN CALLED ######"</span>);
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">super</span>.<span xmlns="" class="perl_Function">login</span>();
<span xmlns="" class="line">​</span>  }
<span xmlns="" class="line">​</span>}
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				An <code class="literal">Identity</code> component must be marked <code class="literal">@Startup</code> so that it is available immediately after the <code class="literal">SESSION</code> context begins. Failing to do this may render certain Seam functionality inoperable in your application.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690511663568">
      ⁠</a>15.13. OpenID</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>OpenID integration is a Technology Preview</strong></p></div><div class="admonition"><div class="para">
				Technology Preview features are not fully supported under Red Hat subscription level agreements (SLAs), may not be functionally complete, and are not intended for production use. However, these features provide early access to upcoming product innovations, enabling customers to test functionality and provide feedback during the development process. As Red Hat considers making future iterations of Technology Preview features generally available, we will provide commercially reasonable efforts to resolve any reported issues that customers experience when using these features.
			</div></div></div><div class="para">
			OpenID is a community standard for external web-based authentication. Any web application can supplement (or replace) its local authentication handling by delegating responsibility to an external OpenID server selected by the user. This benefits both user and developer — the user (who no longer needs to remember login details for multiple web applications), and the developer (who need not maintain an entire complex authentication system).
		</div><div class="para">
			When using OpenID, the user selects an OpenID provider, and the provider assigns the user an OpenID. The ID takes the form of a URL — <code class="literal">http://maximoburrito.myopenid.com</code>, for example. (The <code class="literal">http://</code> portion of the identifier can be omitted when logging into a site.) The web application (known as a <span class="emphasis"><em>relying party</em></span>) determines which OpenID server to contact and redirects the user to the remote site for authentication. When authentication succeeds, the user is given the (cryptographically secure) token proving his identity and is redirected back to the original web application. The local web application can then assume that the user accessing the application owns the OpenID presented.
		</div><div class="para">
			However, authentication does not imply authorization. The web application must still determine how to treat the OpenID authentication. The web application can choose to treat the user as instantly logged in and grant full access to the system, or it can attempt to map the OpenID to a local user account and prompt unregistered users to register. This is a design decision for the local application.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690514454880">
      ⁠</a>15.13.1. Configuring OpenID</h2></div></div></div><div class="para">
				Seam uses the <code class="literal">openid4java</code> package, and requires four additional JARs to make use of Seam integration. These are <code class="filename">htmlparser.jar</code>, <code class="filename">openid4java.jar</code>, <code class="filename">openxri-client.jar</code> and <code class="filename">openxri-syntax.jar</code>.
			</div><div class="para">
				OpenID processing requires the <code class="literal">OpenIdPhaseListener</code>, which should be added to your <code class="filename">faces-config.xml</code> file. The phase listener processes the callback from the OpenID provider, allowing re-entry into the local application.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;lifecycle&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;phase-listener&gt;</span>
<span xmlns="" class="line">​</span>    org.jboss.seam.security.openid.OpenIdPhaseListener
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/phase-listener&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/lifecycle&gt;</span>
</pre><div class="para">
				This configuration makes OpenID support available to your application. The OpenID support component, <code class="literal">org.jboss.seam.security.openid.openid</code>, is installed automatically if the <code class="literal">openid4java</code> classes are on the classpath.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690528441104">
      ⁠</a>15.13.2. Presenting an OpenIdLogin form</h2></div></div></div><div class="para">
				To initiate an OpenID log in, present a form to the user requesting the user's OpenID. The <code class="literal">#{openid.id}</code> value accepts the user's OpenID and the <code class="literal">#{openid.login}</code> action initiates an authentication request.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;h:form&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:inputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{openid.id}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;h:commandButton</span><span xmlns="" class="perl_Others"> action=</span><span xmlns="" class="perl_String">"#{openid.login}"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"OpenID Login"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/h:form&gt;</span>
</pre><div class="para">
				When the user submits the login form, they are redirected to their OpenID provider. The user eventually returns to your application through the Seam pseudo-view <code class="filename">/openid.xhtml</code>, provided by the <code class="literal">OpenIdPhaseListener</code>. Your application can handle the OpenID response with a <code class="filename">pages.xml</code> navigation from that view, just as if the user had never left your application.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690514716128">
      ⁠</a>15.13.3. Logging in immediately</h2></div></div></div><div class="para">
				The simplest strategy is to simply log the user in immediately. The following navigation rule shows how to handle this using the <code class="literal">#{openid.loginImmediately()}</code> action.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;page</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/openid.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;navigation</span><span xmlns="" class="perl_Others"> evaluate=</span><span xmlns="" class="perl_String">"#{openid.loginImmediately()}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rule</span><span xmlns="" class="perl_Others"> if-outcome=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/main.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;message&gt;</span>OpenID login successful...<span xmlns="" class="perl_Keyword">&lt;/message&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/redirect&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/rule&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rule</span><span xmlns="" class="perl_Others"> if-outcome=</span><span xmlns="" class="perl_String">"false"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;redirect</span><span xmlns="" class="perl_Others"> view-id=</span><span xmlns="" class="perl_String">"/main.xhtml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;message&gt;</span>OpenID login rejected...<span xmlns="" class="perl_Keyword">&lt;/message&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/redirect&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/rule&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/navigation&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/page&gt;</span>
</pre><div class="para">
				The <code class="literal">loginImmediately()</code> action checks whether the OpenID is valid. If it is valid, an <code class="literal">OpenIdPrincipal</code> is added to the identity component, and the user is marked as logged in (that is, <code class="literal">#{identity.loggedIn}</code> is marked <code class="literal">true</code>), and the <code class="literal">loginImmediately()</code> action returns <code class="literal">true</code>. If the OpenID is not validated, the method returns <code class="literal">false</code>, and the user re-enters the application un-authenticated. If the user's OpenID is valid, it will be accessible using the expression <code class="literal">#{openid.validatedId}</code> and <code class="literal">#{openid.valid}</code> will be true.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690510563920">
      ⁠</a>15.13.4. Deferring log in</h2></div></div></div><div class="para">
				If you do not want the user to be immediately logged in to your application, your navigation should check the <code class="literal">#{openid.valid}</code> property, and redirect the user to a local registration or processing page. Here, you can ask for more information and create a local user account, or present a CAPTCHA to avoid programmatic registrations. When your process is complete, you can log the user in by calling the <code class="literal">loginImmediately</code> method, either through EL (as shown previously), or direct interaction with the <code class="literal">org.jboss.seam.security.openid.OpenId</code> component. You can also write custom code to interact with the Seam identity component to create even more customized behavior.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690496168032">
      ⁠</a>15.13.5. Logging out</h2></div></div></div><div class="para">
				Logging out (forgetting an OpenID association) is done by calling <code class="literal">#{openid.logout}</code>. You can call this method directly if you are not using Seam Security. If you are using Seam Security, you should continue to use <code class="literal">#{identity.logout}</code> and install an event handler to capture the log out event, calling the OpenID log out method.
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;event</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"org.jboss.seam.security.loggedOut"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;action</span><span xmlns="" class="perl_Others"> execute=</span><span xmlns="" class="perl_String">"#{openid.logout}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/event&gt;</span>
</pre><div class="para">
				It is important to include this, or the user will not be able to log in again in the same session.
			</div></div></div></div></body></html>