<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 20. Email</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="mail">
      ⁠</a>Chapter 20. Email</h1></div></div></div><div class="para">
		Seam now includes an optional component for templating and sending email.
	</div><div class="para">
		Email support is provided by <code class="filename">jboss-seam-mail.jar</code>. This <code class="filename">JAR</code> contains the mail JSF controls, used to construct emails, and the <code class="literal">mailSession</code> manager component.
	</div><div class="para">
		For a demonstration of the email support available in Seam, see the <code class="literal">examples/mail</code> project. This demonstrates proper packaging, and contains a number of currently-supported key features.
	</div><div class="para">
		You can test your mail system with Seam's integration testing environment. See <a class="xref" href="testing.html#testing.mail">Section 35.3.4, “Integration Testing Seam Mail”</a> for details.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690524941040">
      ⁠</a>20.1. Creating a message</h1></div></div></div><div class="para">
			Seam uses Facelets to template emails.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:message</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://www.w3.org/1999/xhtml"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           xmlns:m=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/mail"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           xmlns:h=</span><span xmlns="" class="perl_String">"http://java.sun.com/jsf/html"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:from</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Peter"</span><span xmlns="" class="perl_Others"> address=</span><span xmlns="" class="perl_String">"peter@example.com"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:to</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{person.firstname} #{person.lastname}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    #{person.address}
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/m:to&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:subject&gt;</span>Try out Seam!<span xmlns="" class="perl_Keyword">&lt;/m:subject&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;p&gt;&lt;h:outputText</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Dear #{person.firstname}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>,<span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>You can try out Seam by visiting 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;a</span><span xmlns="" class="perl_Others"> href=</span><span xmlns="" class="perl_String">"http://labs.jboss.com/jbossseam"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      http://labs.jboss.com/jbossseam
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/a&gt;</span>.
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>Regards,<span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>Pete<span xmlns="" class="perl_Keyword">&lt;/p&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/m:body&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/m:message&gt;</span></pre><div class="para">
			The <code class="literal">&lt;m:message&gt;</code> tag wraps the whole message, and tells Seam to start rendering an email. Inside the <code class="literal">&lt;m:message&gt;</code> tag, we use an <code class="literal">&lt;m:from&gt;</code> tag to specify the sender, a <code class="literal">&lt;m:to&gt;</code> tag to specify a recipient, and a <code class="literal">&lt;m:subject&gt;</code> tag. (Note that EL is used as it would be in a normal Facelet.)
		</div><div class="para">
			The <code class="literal">&lt;m:body&gt;</code> tag wraps the body of the email. You can use regular HTML tags inside the body, as well as JSF components.
		</div><div class="para">
			Once the <code class="literal">m:message</code> is rendered, the <code class="literal">mailSession</code> is called to send the email. To send your email, have Seam render the view:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">In</span>(create=<span xmlns="" class="perl_Keyword">true</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">private</span> Renderer renderer;
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">send</span>() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">try</span> {
<span xmlns="" class="line">​</span>        renderer.<span xmlns="" class="perl_Function">render</span>(<span xmlns="" class="perl_String">"/simple.xhtml"</span>);
<span xmlns="" class="line">​</span>        facesMessages.<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"Email sent successfully"</span>);
<span xmlns="" class="line">​</span>    } <span xmlns="" class="perl_Keyword">catch</span> (Exception e) {
<span xmlns="" class="line">​</span>        facesMessages.<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_String">"Email sending failed: "</span> + e.<span xmlns="" class="perl_Function">getMessage</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			If, for example, you entered an invalid email address, then an exception is thrown, caught and then displayed to the user.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690466858624">
      ⁠</a>20.1.1. Attachments</h2></div></div></div><div class="para">
				Seam supports most standard Java types when working with files, so it is easy to attach files to an email.
			</div><div class="para">
				For example, to email the <code class="filename">jboss-seam-mail.jar</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/WEB-INF/lib/jboss-seam-mail.jar"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				Seam loads the file from the classpath and attaches it to the email. By default, this file is attached as <code class="filename">jboss-seam-mail.jar</code>, but you can change the attachment name by adding and editing the <code class="literal">fileName</code> attribute:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"/WEB-INF/lib/jboss-seam-mail.jar"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      fileName=</span><span xmlns="" class="perl_String">"this-is-so-cool.jar"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				You can also attach a <code class="literal">java.io.File</code>, a <code class="literal">java.net.URL</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{numbers}"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				Or a <code class="literal">byte[]</code> or a <code class="literal">java.io.InputStream</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.photo}"</span><span xmlns="" class="perl_Others"> contentType=</span><span xmlns="" class="perl_String">"image/png"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				For <code class="literal">byte[]</code> and <code class="literal">java.io.InputStream</code>, you will need to specify the MIME type of the attachment, since this information is not carried as part of the file.
			</div><div class="para">
				You can attach a Seam-generated PDF, or any standard JSF view, by wrapping a <code class="literal">&lt;m:attachment&gt;</code> tag around your normal tags:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> fileName=</span><span xmlns="" class="perl_String">"tiny.pdf"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;p:document&gt;</span>
<span xmlns="" class="line">​</span>    A very tiny PDF
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/p:document&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/m:attachment&gt;</span></pre><div class="para">
				To attach a set of files — for example, a set of pictures loaded from a database — you can use a <code class="literal">&lt;ui:repeat&gt;</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ui:repeat</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"person"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.photo}"</span><span xmlns="" class="perl_Others"> contentType=</span><span xmlns="" class="perl_String">"image/jpeg"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                fileName=</span><span xmlns="" class="perl_String">"#{person.firstname}_#{person.lastname}.jpg"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ui:repeat&gt;</span></pre><div class="para">
				To display an attached image inline:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:attachment</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{person.photo}"</span><span xmlns="" class="perl_Others"> contentType=</span><span xmlns="" class="perl_String">"image/jpeg"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              fileName=</span><span xmlns="" class="perl_String">"#{person.firstname}_#{person.lastname}.jpg"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">              status=</span><span xmlns="" class="perl_String">"personPhoto"</span><span xmlns="" class="perl_Others"> disposition=</span><span xmlns="" class="perl_String">"inline"</span> <span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;img</span><span xmlns="" class="perl_Others"> src=</span><span xmlns="" class="perl_String">"cid:#{personPhoto.contentId}"</span> <span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				The <code class="literal">cid:#{...}</code> tag specifies that the attachments will be examined when attempting to locate the image. The <code class="literal">cid</code> — <code class="literal">Content-ID</code> — must match.
			</div><div class="para">
				You must declare the attachment before trying to access the status object.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690502988000">
      ⁠</a>20.1.2. HTML/Text alternative part</h2></div></div></div><div class="para">
				Although most mail readers support HTML, some do not. You can add a plain text alternative to your email body:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:body&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;f:facet</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"alternative"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    Sorry, your email reader can not show our fancy email. Please go to 
<span xmlns="" class="line">​</span>    http://labs.jboss.com/jbossseam to explore Seam.
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/f:facet&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/m:body&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690455029840">
      ⁠</a>20.1.3. Multiple recipients</h2></div></div></div><div class="para">
				Often you will want to send an email to a group of recipients, such as your users. All recipient mail tags can be placed inside a <code class="literal">&lt;ui:repeat&gt;</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ui:repeat</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{allUsers} var="</span><span xmlns="" class="perl_Error">user"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:to</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{user.firstname} #{user.lastname}"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        address=</span><span xmlns="" class="perl_String">"#{user.emailAddress}"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ui:repeat&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690504886752">
      ⁠</a>20.1.4. Multiple messages</h2></div></div></div><div class="para">
				Sometimes — for example, during a password reset — you will need to send a slightly different message to each recipient. The best way to do this is to place the whole message inside a <code class="literal">&lt;ui:repeat&gt;</code>:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ui:repeat</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"#{people}"</span><span xmlns="" class="perl_Others"> var=</span><span xmlns="" class="perl_String">"p"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:message&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;m:from</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{person.firstname} #{person.lastname}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      #{person.address}
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/m:from&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;m:to</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{p.firstname}"</span><span xmlns="" class="perl_Keyword">&gt;</span>#{p.address}<span xmlns="" class="perl_Keyword">&lt;/m:to&gt;</span> 
<span xmlns="" class="line">​</span>    ... 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/m:message&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ui:repeat&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690528089936">
      ⁠</a>20.1.5. Templating</h2></div></div></div><div class="para">
				The mail templating example shows that Facelets templating works with the Seam mail tags.
			</div><div class="para">
				Our <code class="filename">template.xhtml</code> contains:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:message&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:from</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Seam"</span><span xmlns="" class="perl_Others"> address=</span><span xmlns="" class="perl_String">"do-not-reply@jboss.com"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:to</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"#{person.firstname} #{person.lastname}"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    #{person.address}
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/m:to&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:subject&gt;</span>#{subject}<span xmlns="" class="perl_Keyword">&lt;/m:subject&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;m:body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;html&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;body&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ui:insert</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"body"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          This is the default body, specified by the template.
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/ui:insert&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/body&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/html&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/m:body&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/m:message&gt;</span></pre><div class="para">
				Our <code class="literal">templating.xhtml</code> contains:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ui:param</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"subject"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Templating with Seam Mail"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;ui:define</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"body"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;p&gt;</span>
<span xmlns="" class="line">​</span>    This example demonstrates that you can easily use 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;i&gt;</span>facelets templating<span xmlns="" class="perl_Keyword">&lt;/i&gt;</span> in email!
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/p&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/ui:define&gt;</span></pre><div class="para">
				You can also use Facelets source tags in your email. These must be placed in a JAR in <code class="literal">WEB-INF/lib</code> because referencing the <code class="filename">.taglib.xml</code> from <code class="filename">web.xml</code> is not reliable when using Seam Mail. (When mail is sent asynchronously, Seam Mail cannot access the full JSF or Servlet context, so it does not acknowledge <code class="filename">web.xml</code> configuration parameters.)
			</div><div class="para">
				To configure Facelets or JSF further when sending mail, you will need to override the Renderer component and perform the configuration programmatically. This should only be done by advanced users.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690447339072">
      ⁠</a>20.1.6. Internationalization</h2></div></div></div><div class="para">
				Seam supports sending internationalized messages. By default, Seam uses encoding provided by JSF, but this can be overridden on the template:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:message</span><span xmlns="" class="perl_Others"> charset=</span><span xmlns="" class="perl_String">"UTF-8"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  ... 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/m:message&gt;</span></pre><div class="para">
				The body, subject, and recipient and sender names are encoded. You will need to make sure that Facelets parses your page with the correct character set by setting the encoding of the template:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690521439520">
      ⁠</a>20.1.7. Other Headers</h2></div></div></div><div class="para">
				Seam also provides support for some additional email headers. (See <a class="xref" href="mail.html#mail.tags">Section 20.4, “Tags”</a>.) You can set the importance of the email, and ask for a read receipt:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:message</span><span xmlns="" class="perl_Others"> xmlns:m=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/mail"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">           importance=</span><span xmlns="" class="perl_String">"low"</span><span xmlns="" class="perl_Others"> requestReadReceipt=</span><span xmlns="" class="perl_String">"true"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre><div class="para">
				Otherwise, you can add any header to the message by using the <code class="literal">&lt;m:header&gt;</code> tag:
			</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;m:header</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"X-Sent-From"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"JBoss Seam"</span><span xmlns="" class="perl_Keyword">/&gt;</span></pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690492615168">
      ⁠</a>20.2. Receiving emails</h1></div></div></div><div class="para">
			If you use Enterprise JavaBeans (EJB), you can use a MDB (Message Driven Bean) to receive email. JBoss provides a JCA adaptor (<code class="filename">mail-ra.rar</code>). You can configure <code class="filename">mail-ra.rar</code> like this:
		</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">MessageDriven</span>(activationConfig={
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName=<span xmlns="" class="perl_String">"mailServer"</span>, 
<span xmlns="" class="line">​</span>                          propertyValue=<span xmlns="" class="perl_String">"localhost"</span>),
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName=<span xmlns="" class="perl_String">"mailFolder"</span>, 
<span xmlns="" class="line">​</span>                          propertyValue=<span xmlns="" class="perl_String">"INBOX"</span>),
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName=<span xmlns="" class="perl_String">"storeProtocol"</span>, 
<span xmlns="" class="line">​</span>                          propertyValue=<span xmlns="" class="perl_String">"pop3"</span>),
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName=<span xmlns="" class="perl_String">"userName"</span>, 
<span xmlns="" class="line">​</span>                          propertyValue=<span xmlns="" class="perl_String">"seam"</span>),
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName=<span xmlns="" class="perl_String">"password"</span>, 
<span xmlns="" class="line">​</span>                          propertyValue=<span xmlns="" class="perl_String">"seam"</span>)
<span xmlns="" class="line">​</span>})
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ResourceAdapter</span>(<span xmlns="" class="perl_String">"mail-ra.rar"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">Name</span>(<span xmlns="" class="perl_String">"mailListener"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MailListenerMDB <span xmlns="" class="perl_Keyword">implements</span> MailListener {
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    @<span xmlns="" class="perl_Function">In</span>(create=<span xmlns="" class="perl_Keyword">true</span>)
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">private</span> OrderProcessor orderProcessor;
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">onMessage</span>(Message message) {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Comment">// Process the message</span>
<span xmlns="" class="line">​</span>        orderProcessor.<span xmlns="" class="perl_Function">process</span>(message.<span xmlns="" class="perl_Function">getSubject</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			Each message received calls <code class="literal">onMessage(Message message)</code>. Most Seam annotations work inside a MDB, but you must not access the persistence context.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139690447758816">
      ⁠</a>20.3. Configuration</h1></div></div></div><div class="para">
			Include <code class="filename">jboss-seam-mail.jar</code> in your <code class="literal">WEB-INF/lib</code> directory to include email support in your application. If you use JBoss Enterprise Application Platform, no further configuration is required. If you do not use EAP, make sure you have the JavaMail API and a copy of the Java Active Framework. The versions distributed with Seam are <code class="filename">lib/mail.jar</code> and <code class="filename"> lib/activation.jar</code> respectively.)
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The Seam Mail module requires both the use of the <code class="literal">seam-ui</code> package, and that Facelets be used as the view technology. Future versions of the library may also support the use of JSP.
			</div></div></div><div class="para">
			The <code class="literal">mailSession</code> component uses JavaMail to talk to a 'real' SMTP server.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139690498839664">
      ⁠</a>20.3.1. <code class="literal">mailSession</code></h2></div></div></div><div class="para">
				If you are working in a Java EE 5 environment, a JavaMail session may be available through a JNDI look up. Otherwise, you can use a Seam-configured session.
			</div><div class="para">
				The <code class="literal">mailSession</code> component's properties are described in more detail in <a class="xref" href="components.html#components.mail">Section 30.9, “Mail-related components”</a>.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690456523744">
      ⁠</a>20.3.1.1. JNDI look up in EAP</h3></div></div></div><div class="para">
					The JBossAS <code class="filename">deploy/mail-service.xml</code> configures a JavaMail session binding into JNDI. The default service configuration must be altered for your network. <a href="http://wiki.jboss.org/wiki/Wiki.jsp?page=JavaMail">http://wiki.jboss. org/wiki/Wiki.jsp?page=JavaMail</a> describes the service in more detail.
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;components</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/components"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:core=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/core"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:mail=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/mail"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mail:mail-session</span><span xmlns="" class="perl_Others"> session-jndi-name=</span><span xmlns="" class="perl_String">"java:/Mail"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/components&gt;</span></pre><div class="para">
					Here, we tell Seam to retrieve the mail session bound to <code class="literal">java:/Mail</code> from JNDI.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139690516576320">
      ⁠</a>20.3.1.2. Seam-configured Session</h3></div></div></div><div class="para">
					A mail session can be configured via <code class="filename">components.xml</code>. Here we tell Seam to use <code class="literal">smtp.example.com</code> as the SMTP server:
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;components</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/components"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:core=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/core"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmlns:mail=</span><span xmlns="" class="perl_String">"http://jboss.com/products/seam/mail"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mail:mail-session</span><span xmlns="" class="perl_Others"> host=</span><span xmlns="" class="perl_String">"smtp.example.com"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/components&gt;</span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="mail.tags">
      ⁠</a>20.4. Tags</h1></div></div></div><div class="para">
			Emails are generated using tags in the <code class="literal">http://jboss.com/products/seam/mail</code> namespace. Documents should always have the <code class="literal">message</code> tag at the root of the message. The message tag prepares Seam to generate an email.
		</div><div class="para">
			Facelets standard templating tags can be used as normal. Inside the <code class="literal">body</code>, you can use any JSF tag. If the tag requires access to external resources such as stylesheets or JavaScript, be sure to set the <code class="literal">urlBase</code>.
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;m:message&gt;</span></dt><dd><div class="para">
						Root tag of a mail message.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">importance</code> — Sets the importance of the mail message. Valid values are <code class="literal">low</code>, <code class="literal">normal</code>, or <code class="literal">high</code>. Defaults to <code class="literal">normal</code>.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">precedence</code> — Sets the precedence of the message, for example, <code class="literal">bulk</code>.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">requestReadReceipt</code> — If set, a read receipt request will be added, and the read receipt will be sent to the <code class="literal">From:</code> address. Defaults to <code class="literal">false</code>.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">urlBase</code> — If set, the value is prepended to the <code class="literal">requestContextPath</code>, allowing you to use components such as <code class="literal">&lt;h:graphicImage&gt;</code> in your emails.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">messageId</code> — Explicitly sets the Message-ID.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:from&gt;</span></dt><dd><div class="para">
						Sets the <code class="literal">From:</code> address for the email. Only one exists per email.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">name</code> — The name that the email comes from.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">address</code> — The email address that the email comes from.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:replyTo&gt;</span></dt><dd><div class="para">
						Sets the <code class="literal">Reply-to:</code> address for the email. Only one exists per email.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">address</code> — the email address the email comes from.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:to&gt;</span></dt><dd><div class="para">
						Adds a recipient to the email. Use multiple <code class="literal">&lt;m:to&gt;</code> tags for multiple recipients. This tag can be safely placed inside a repeat tag such as <code class="literal">&lt;ui:repeat&gt;</code>.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">name</code> — The name of the recipient.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">address</code> — The email address of the recipient.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:cc&gt;</span></dt><dd><div class="para">
						Adds a CC recipient to the email. Use multiple <code class="literal">&lt;m:cc&gt;</code> tags for multiple CCs. This tag can be safely placed inside a iterator tag such as &lt;ui:repeat&gt;.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">name</code> — The name of the recipient.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">address</code> — The email address of the recipient.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:bcc&gt;</span></dt><dd><div class="para">
						Adds a BCC recipient to the email. Use multiple <code class="literal">&lt;m:bcc&gt;</code> tags for multiple bccs. This tag can be safely placed inside a repeat tag such as <code class="literal">&lt;ui:repeat&gt;</code>.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">name</code> — The name of the recipient.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">address</code> — The email address of the recipient.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:header&gt;</span></dt><dd><div class="para">
						Adds a header to the email. (For example, <code class="literal">X-Sent-From: JBoss Seam</code>.)
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">name</code> — The name of the header to add. (For example, <code class="literal">X-Sent-From</code>.)
							</div></li><li class="listitem"><div class="para">
								<code class="literal">value</code> — The value of the header to add. (For example, <code class="literal">JBoss Seam</code>.)
							</div></li></ul></div></dd><dt><span class="term">&lt;m:attachment&gt;</span></dt><dd><div class="para">
						Adds an attachment to the email.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">value</code> — The file to attach:
							</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
										<code class="literal">String</code> — A <code class="literal">String</code> is interpreted as a path to file within the classpath.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">java.io.File</code> — An EL expression can reference a <code class="literal">File</code> object.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">java.net.URL</code> — An EL expression can reference a <code class="literal">URL</code> object.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">java.io.InputStream</code> — An EL expression can reference an <code class="literal">InputStream</code>. In this case both a <code class="literal">fileName</code> and a <code class="literal">contentType</code> must be specified.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">byte[]</code> — An EL expression can reference a <code class="literal">byte[]</code>. In this case both a <code class="literal">fileName</code> and a <code class="literal">contentType</code> must be specified.
									</div></li></ul></div><div class="para">
								If the value attribute is omitted:
							</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
										If this tag contains a <code class="literal">&lt;p:document&gt;</code> tag, the document described will be generated and attached to the email. A <code class="literal">fileName</code> should be specified.
									</div></li><li class="listitem"><div class="para">
										If this tag contains other JSF tags, a HTML document will be generated from them and attached to the email. A <code class="literal">fileName</code> should be specified.
									</div></li></ul></div></li><li class="listitem"><div class="para">
								<code class="literal">fileName</code> — Specifies the file name to use for the attached file.
							</div></li><li class="listitem"><div class="para">
								<code class="literal">contentType</code> — Specifies the MIME type of the attached file.
							</div></li></ul></div></dd><dt><span class="term">&lt;m:subject&gt;</span></dt><dd><div class="para">
						Sets the subject for the email.
					</div></dd><dt><span class="term">&lt;m:body&gt;</span></dt><dd><div class="para">
						Sets the body for the email. Supports an <code class="literal">alternative</code> facet which, if a HTML email is generated, can contain alternative text for a mail reader which does not support HTML.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
								<code class="literal">type</code> — If set to <code class="literal">plain</code>, a plain text email will be generated. Otherwise, a HTML email is generated.
							</div></li></ul></div></dd></dl></div></div></div></body></html>