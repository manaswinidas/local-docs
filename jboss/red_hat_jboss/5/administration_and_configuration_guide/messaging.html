<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 15. Messaging</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="messaging">
      ⁠</a>Chapter 15. Messaging</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139776679233712">
      ⁠</a>15.1. Default JMS messaging providers</h1></div></div></div><div class="para">
			One of the following default JMS messaging providers can be used with JBoss Enterprise Application Platform: 
			<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						JBoss Messaging - detailed information can be found in <em class="citetitle">JBoss Messaging User Guide</em>.
					</div></li><li class="listitem"><div class="para">
						HornetQ - detailed information can be found in <em class="citetitle">HornetQ User Guide</em>.
					</div></li></ul></div>
			 Please refer to the dedicated guides mentioned with individual JMS providers for in-depth guidance on their configuration and use.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Deploy_the_WebSphere_MQ_Resource_Adapter">
      ⁠</a>15.2. IBM WebSphere MQ Integration</h1></div></div></div><div class="para">
			Apart from the default messaging options listed above, it is also possible to connect JBoss Enterprise Application Platform to a WebSphere MQ messaging system. WebSphere MQ is IBM's Messaging Oriented Middleware (MOM) software that allows applications on distributed systems to communicate with each other. This is accomplished through the use of messages and message queues. WebSphere MQ is responsible for delivering messages to the message queues and for transferring data to other queue managers using message channels. For more information about IBM WebSphere MQ, please refer to its documentation accessible at <a href="http://www.ibm.com">http://www.ibm.com</a>.
		</div><div class="para">
			Within the scope of the integration with JBoss Enterprise Application Platform, WebSphere MQ does not act as a default messaging provider equivalent to JBoss Messaging or Hornet Q. Instead, it runs as a standalone messaging system connected to JBoss Enterprise Application Platform through a resource adapter. While connected to WebSphere MQ, the platform still uses either JBoss Messaging or HornetQ as its default JMS messaging provider. This is typically useful when an application based on JBoss Enterprise Application Platform needs to be integrated with an existing infrastructure that uses WebSphere MQ.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776740967376">
      ⁠</a>15.2.1. Configuring WebSphere MQ Integration</h2></div></div></div><div class="para">
				This section covers the general steps that need to be performed to deploy and configure the WebSphere MQ Resource Adapter in JBoss Enterprise Application Platform 5.
			</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
					The following is required before you get started configuring your instance of JBoss Enterprise Application Platform for integration with WebSphere MQ.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						A running instance of WebSphere MQ version <code class="literal">7.5</code>.
					</div></li><li class="listitem"><div class="para">
						A WebSphere MQ JMS resource adapter. It is supplied with your distribution of WebSphere MQ as a Resource Archive (RAR) file called <code class="filename">wmq.jmsra.rar</code>. You can find it in the <code class="filename"><em class="replaceable">MQ.HOME</em>/java/lib/jca</code> directory.
					</div></li><li class="listitem"><div class="para">
						To configure the connection properly, you also need to know the values listed below. The names shown in capital letters are used in the code samples further in this chapter. When reusing the code, make sure that you replace these names with the actual values relevant for your WebSphere MQ instance.
					</div><div class="para">
						<div class="variablelist"><dl class="variablelist"><dt><span class="term">MQ.HOST.NAME</span></dt><dd><div class="para">
										The host name of the machine where the WebSphere MQ instance is running. It is also possible to specify the machine's IP address instead of the hostname.
									</div></dd><dt><span class="term">MQ.PORT</span></dt><dd><div class="para">
										The port used to connect to the WebSphere MQ queue manager. The default value is <code class="literal">1414</code>.
									</div></dd><dt><span class="term">MQ.CHANNEL.NAME</span></dt><dd><div class="para">
										The server channel used to connect to the WebSphere MQ queue manager. The default value is <code class="literal">SYSTEM.DEF.SVRCONN</code>.
									</div></dd><dt><span class="term">MQ.TRANSPORT.TYPE</span></dt><dd><div class="para">
										The transport type used for the connection to WebSphere MQ. The default value is <code class="literal">CLIENT</code>.
									</div></dd><dt><span class="term">MQ.HOME</span></dt><dd><div class="para">
										The path to the WebSphere MQ instance's base directory. The default is <code class="filename">/opt/mqm/</code> on Linux or Unix, <code class="filename">/usr/mqm/</code> on AIX and <code class="filename">C:\ProgramFiles\IBM\WebSphere MQ</code> on Windows.
									</div></dd><dt><span class="term">MQ.USER</span></dt><dd><div class="para">
										The user name of a user account with permissions to connect to the WebSphere MQ server by the broker.
									</div></dd><dt><span class="term">MQ.PASSWORD</span></dt><dd><div class="para">
										The password of the MQ.USER user account.
									</div></dd></dl></div>

					</div></li><li class="listitem"><div class="para">
						Within the WebSphere MQ instance, you need to have objects like queue managers, queues, topics and channels defined according to the needs of your specific system. The list below contains WebSphere MQ objects that are used to demonstrate the configuration in the code samples further in this chapter. Similarly as above, when reusing the code samples, make sure that you replace the capitalized names with the names of the actual objects defined in your WebSphere MQ instance.
					</div><div class="para">
						<div class="variablelist"><dl class="variablelist"><dt><span class="term">MQ.QUEUE.MANAGER</span></dt><dd><div class="para">
										The name of the WebSphere MQ queue manager with which the connection will be established.
									</div></dd><dt><span class="term">MQ.QUEUE.REQUESTS</span></dt><dd><div class="para">
										The name of the destination message queue in WebSphere MQ to which request messages will be sent.
									</div></dd><dt><span class="term">MQ.QUEUE.RESPONSES</span></dt><dd><div class="para">
										The name of the source message queue in WebSphere MQ from which response messages will be received.
									</div></dd><dt><span class="term">MQ.TOPIC1</span></dt><dd><div class="para">
										The name of a topic defined in WebSphere MQ.
									</div></dd><dt><span class="term">MQ.TOPIC2</span></dt><dd><div class="para">
										The name of another topic defined in WebSphere MQ.
									</div></dd></dl></div>

					</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139776769700624">
      ⁠</a><p class="title"><strong>Procedure 15.1. Deploying the WebSphere MQ Resource Adapter</strong></p><ol class="1"><li class="step"><div class="para">
						Copy the <code class="filename">wmq.jmsra.rar</code> file to the <code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/</code> directory. 
<pre class="screen">cp <em class="replaceable">MQ.HOME</em>/java/lib/jca/wmq.jmsra.rar <em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/</pre>

					</div></li><li class="step"><div class="para">
						Create a file named <code class="filename">jboss_jmsra_ds.xml</code> in the <code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/deploy/</code> directory.
					</div><div class="para">
						Below, you can find a code sample showing the expected content of the file. The first part of the XML file defines a connection factory used to establish the connection with the WebSphere MQ instance. The second part of the file defines JNDI bindings of objects defined in WebSphere MQ to JMS administered objects.
					</div><div class="para">
						
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factories&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- connection factory definition --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;tx-connection-factory&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jndi-name&gt;</span>jms/CF<span xmlns="" class="perl_Keyword">&lt;/jndi-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;xa-transaction</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rar-name&gt;</span>wmq.jmsra.rar<span xmlns="" class="perl_Keyword">&lt;/rar-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connection-definition&gt;</span>javax.jms.ConnectionFactory<span xmlns="" class="perl_Keyword">&lt;/connection-definition&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"channel"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.CHANNEL.NAME<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hostName"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.HOST.NAME<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.PORT<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"username"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.USER<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.PASSWORD<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"queueManager"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.QUEUE.MANAGER<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"transportType"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.TRANSPORT.TYPE<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain-and-application&gt;</span>JmsXARealm<span xmlns="" class="perl_Keyword">&lt;/security-domain-and-application&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- admin object definitions --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.deployment.AdminObject"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jca.wmq:name=queue1"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jms/queue/MQ.QUEUE.REQUESTS
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"RARName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jboss.jca:service=RARDeployment,name='wmq.jmsra.rar'
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Type"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Queue<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      baseQueueManagerName=MQ.QUEUE.MANAGER
<span xmlns="" class="line">​</span>      baseQueueName=MQ.QUEUE.REQUESTS
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.deployment.AdminObject"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jca.wmq:name=topic1"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jms/topic/MQ.TOPIC1
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"RARName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jboss.jca:service=RARDeployment,name='wmq.jmsra.rar'
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Type"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Topic<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      brokerPubQueueManager=MQ.QUEUE.MANAGER
<span xmlns="" class="line">​</span>      baseTopicName=MQ.TOPIC1
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.deployment.AdminObject"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jca.wmq:name=queue2"</span><span xmlns="" class="perl_Keyword">&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jms/queue/MQ.QUEUE.RESPONSES
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"RARName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jboss.jca:service=RARDeployment,name='wmq.jmsra.rar'
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Type"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Queue<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      baseQueueManagerName=MQ.QUEUE.MANAGER
<span xmlns="" class="line">​</span>      baseQueueName=MQ.QUEUE.RESPONSES
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.deployment.AdminObject"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jca.wmq:name=topic2"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jms/topic/MQ.TOPIC2
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"RARName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jboss.jca:service=RARDeployment,name='wmq.jmsra.rar'
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Type"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Topic<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      brokerPubQueueManager=MQ.QUEUE.MANAGER
<span xmlns="" class="line">​</span>      baseTopicName=MQ.TOPIC2
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factories&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

					</div></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776684445456">
      ⁠</a>15.2.1.1. Using the WebSphere MQ resource adapter in an MDB</h3></div></div></div><div class="para">
					Once you have performed the configuration described above, you can access a message queue from the code of an MDB by specifying the <code class="systemitem">ActivationConfigProperty</code> and <code class="systemitem">ResourceAdapter</code> annotations as in the following code sample: 
<pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">MessageDriven</span>(name=<span xmlns="" class="perl_String">"WebSphereMQMDB"</span>. 
<span xmlns="" class="line">​</span> activationConfig =
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"destinationType"</span>,propertyValue = <span xmlns="" class="perl_String">"javax.jms.Queue"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"useJNDI"</span>, propertyValue = <span xmlns="" class="perl_String">"false"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"hostName"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.HOST.NAME"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"port"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.PORT"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"channel"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.CHANNEL.NAME"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"queueManager"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.QUEUE.MANAGER"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"destination"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.QUEUE.REQUESTS"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"transportType"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.TRANSPORT.TYPE"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"username"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.USER"</span>),
<span xmlns="" class="line">​</span>   @<span xmlns="" class="perl_Function">ActivationConfigProperty</span>(propertyName = <span xmlns="" class="perl_String">"password"</span>, propertyValue = <span xmlns="" class="perl_String">"MQ.PASSWORD"</span>)
<span xmlns="" class="line">​</span>   })
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">ResourceAdapter</span>(value = <span xmlns="" class="perl_String">"wmq.jmsra.rar"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> WebSphereMQMDB <span xmlns="" class="perl_Keyword">implements</span> MessageListener {
<span xmlns="" class="line">​</span>}
</pre>

				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776733388736">
      ⁠</a>15.2.1.2. Configuration for XA Transaction Recovery</h3></div></div></div><div class="para">
					If unfinished two-phase commit transactions are not recovered after a system crash, they can use storage space in the WebSphere MQ instance and cause performance problems. To prevent this, JBoss Enterprise Application Server's Transaction service can recover such transactions if a recovery module is configured for each resource. This section explains how to configure the XARecovery module for the sample WebSphere MQ instance configured previously in this chapter.
				</div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Prerequisites</div>
						Before you begin the configuration for XA transaction recovery, you need:
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							JBoss Enterprise Application Platform and WebSphere MQ configured as described previously in this chapter.
						</div></li><li class="listitem"><div class="para">
							The <code class="filename">mqcontext.jar</code> library. It is available as part of IBM Support Pac: ME01, which can be downloaded from the IBM website. Installation of the pack adds the library to the <code class="filename"><em class="replaceable">MQ.HOME</em>/java/lib/</code> directory.
						</div></li><li class="listitem"><div class="para">
							An additional message queue created in WebSphere MQ for transaction recovery purposes. In the following code samples, it is referred to as <code class="systemitem">MQ.RECOVERY.QUEUE</code>.
						</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139776758723056">
      ⁠</a><p class="title"><strong>Procedure 15.2. Configuring WebSphere MQ Integration for XA Transaction Recovery</strong></p><ol class="1"><li class="step"><div class="para">
							In a directory of your choice on the WebSphere MQ server, create a <code class="filename">JMSAdmin.config</code> file with the following content: 
<pre class="programlisting">
INITIAL_CONTEXT_FACTORY=com.ibm.mq.jms.context.WMQInitialContextFactory
PROVIDER_URL=MQ.HOST.NAME:MQ.PORT/MQ.CHANNEL.NAME
</pre>

						</div></li><li class="step"><div class="para">
							In the same directory, create a file called <code class="filename">xaqcf_def.scp</code>. In the file, define an XA queue connection factory as follows: 
<pre class="screen">
def xaqcf(WNPMQMXACF) qmgr(MQ.QUEUE.MANAGER) tran(MQ.TRANSPORT.TYPE) chan(MQ.CHANNEL.NAME) host(MQ.HOST.NAME) port(MQ.PORT)
</pre>

						</div></li><li class="step"><div class="para">
							Still in the same directory, create a <code class="filename">JMSAdmin.sh</code> script as follows: 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/jms.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/com.ibm.mq.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/com.ibm.mqjms.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/jta.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/connector.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/jndi.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/providerutil.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/fscontext.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/com.ibm.mqjms.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">CLASSPATH=$CLASSPATH</span>:/opt/mqm/java/lib/mqcontext.jar
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Reserved">export</span> <span xmlns="" class="perl_Others">CLASSPATH</span>
<span xmlns="" class="line">​</span>/opt/mqm/java/bin/JMSAdmin -v -cfg <span xmlns="" class="perl_Others">$PWD</span>/JMSAdmin.config <span xmlns="" class="perl_Operator">&lt;</span> xaqcf_def.<span xmlns="" class="perl_BString">scp</span>
</pre>
							 All libraries necessary for JMSAdmin tools are linked from the default WebSphere MQ installation directory, which is <code class="filename">/opt/mqm</code>. Please modify the paths in the script accordingly if your WebSphere MQ installation is located elsewhere.
						</div></li><li class="step"><div class="para">
							Launch the script created in the previous step. The script will append the required paths to the CLASSPATH variable and create the XA queue connection factory.
						</div></li><li class="step"><div class="para">
							Copy the following libraries from <code class="filename"><em class="replaceable">MQ.HOME</em>/java/lib/</code> to the <code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/lib/</code> directory: 
							<div class="itemizedlist"><ul><li class="listitem"><div class="para">
										dhbcore.jar
									</div></li><li class="listitem"><div class="para">
										mqcontext.jar
									</div></li><li class="listitem"><div class="para">
										com.ibm.mq.jar
									</div></li><li class="listitem"><div class="para">
										com.ibm.mqjms.jar
									</div></li><li class="listitem"><div class="para">
										com.ibm.mq.pcf.jar
									</div></li><li class="listitem"><div class="para">
										com.ibm.mq.jmqi.jar
									</div></li><li class="listitem"><div class="para">
										com.ibm.mq.headers.jar
									</div></li><li class="listitem"><div class="para">
										com.ibm.mq.commonservices.jar
									</div></li></ul></div>

						</div></li><li class="step"><div class="para">
							Create an external JNDI context by adding the following code to the <code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/conf/jboss-service.xml</code> file:
						</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.naming.ExternalContext"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    name=</span><span xmlns="" class="perl_String">"jboss.jndi:service=ExternalContext,jndiName=IBMMQInitialContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JndiName"</span><span xmlns="" class="perl_Keyword">&gt;</span>IBMMQInitialContext<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InitialContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.naming.InitialContext<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    java.naming.factory.initial=com.ibm.mq.jms.context.WMQInitialContextFactory
<span xmlns="" class="line">​</span>    java.naming.factory.url.pkgs=com.ibm.mq.jms.naming
<span xmlns="" class="line">​</span>    java.naming.provider.url=MQ.HOST.NAME:MQ.PORT/MQ.CHANNEL.NAME
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre><div class="para">
							Alternatively, it is possible to define the external JNDI context as a remote one by adding the <code class="systemitem">RemoteAccess</code> attribute to the MBean definition. In this case, the <code class="systemitem">IBMMQInitialContext/WNPMQMXACF</code> JNDI name used in the following step points to a remote connection factory in the WebSphere MQ broker.
						</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.naming.ExternalContext"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jboss.jndi:service=ExternalContext,jndiName=IBMMQIntialContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JndiName"</span><span xmlns="" class="perl_Keyword">&gt;</span>IBMMQIntialContext<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InitialContext"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.naming.InitialContext<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Indicates that the external context is remote --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"RemoteAccess"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    java.naming.factory.initial=com.ibm.mq.jms.context.WMQInitialContextFactory
<span xmlns="" class="line">​</span>    java.naming.factory.url.pkgs=com.ibm.mq.jms.naming
<span xmlns="" class="line">​</span>    java.naming.provider.url=MQ.HOST.NAME:MQ.PORT/MQ.CHANNEL.NAME
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre></li><li class="step"><div class="para">
							Create a file called <code class="filename">wsmq-jmsprovider-ds.xml</code> in the <code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/conf/</code> directory.
						</div><div class="para">
							Below, you can find a code sample showing the expected content of the file. The first part of the XML file defines a connection factory that supports XA transactions. The second part of the file defines JNDI bindings of the recovery queue defined in WebSphere MQ and of the XA connection factory. See the comments inside the code sample for more information. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-factories&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- connection factory definition --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Bind this ConnectionFactory with the JNDI --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jndi-name&gt;</span>IbmMQJMSXA<span xmlns="" class="perl_Keyword">&lt;/jndi-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Indicate that the connection factory supports XA transactions --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;xa-transaction/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- rar-name is the actual RAR file name, in this case wmq.jmsra.rar --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;rar-name&gt;</span>wmq.jmsra.rar<span xmlns="" class="perl_Keyword">&lt;/rar-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- Do not prefix the JNDI name of the connection factory with the java: context and thus allow it to be looked up externally --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;use-java-context&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/use-java-context&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- connection-definition is the ConnectionFactory interface defined in the jboss_jmsra_ds.xml file --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;connection-definition&gt;</span>
<span xmlns="" class="line">​</span>      javax.jms.ConnectionFactory
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/connection-definition&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"hostName"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.HOST.NAME:<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"username"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.USER<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"password"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.PASSWORD<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"port"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.PORT<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"queueManager"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.QUEUE.MANAGER<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"channel"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.CHANNEL.NAME<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;config-property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"transportType"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Keyword">&gt;</span>MQ.TRANSPORT.TYPE<span xmlns="" class="perl_Keyword">&lt;/config-property&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- define the security domain --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;security-domain-and-application&gt;</span>JmsXARealm<span xmlns="" class="perl_Keyword">&lt;/security-domain-and-application&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/tx-connection-factory&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- admin object definitions --&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Binding of the crash recovery queue in WebSphere MQ --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.resource.deployment.AdminObject"</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"jca.wmq:name=crashRecovery"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JNDIName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      queue/crashRecoveryQueue
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"RARName"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      jboss.jca:service=RARDeployment,name='wmq.jmsra.rar'
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Type"</span><span xmlns="" class="perl_Keyword">&gt;</span>javax.jms.Queue<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"Properties"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      baseQueueManagerName=MQ.QUEUE.MANAGER
<span xmlns="" class="line">​</span>      baseQueueName=MQ.RECOVERY.QUEUE
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- Binding of the XA Connection factory to the JMSProvider that is used by the transaction module --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Comment">&lt;!-- The properties must match the Websphere MQ JNDI entry and the FactoryRef must match the xaqcf name --&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.jms.jndi.JMSProviderLoader"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      name=</span><span xmlns="" class="perl_String">"jboss.jms:service=JMSProviderLoader,name=WSMQJmsWNPMQMProvider"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- this will be bound to java:/... and you will need to use it in conf/jbossts-properties.xml --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ProviderName"</span><span xmlns="" class="perl_Keyword">&gt;</span>WSMQJmsWNPMQMProvider<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ProviderAdapterClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>org.jboss.jms.jndi.JNDIProviderAdapter<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>IBMMQInitialContext/WNPMQMXACF<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"QueueFactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>IBMMQInitialContext/WNPMQMXACF<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TopicFactoryRef"</span><span xmlns="" class="perl_Keyword">&gt;</span>IBMMQInitialContext/WNPMQMXACF<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Comment">&lt;!-- external context defined in conf/jboss-service.xml --&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.jndi:service=ExternalContext,jndiName=IBMMQInitialContext<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/connection-factories&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

						</div></li><li class="step"><div class="para">
							Add the the <code class="systemitem">JMSProviderLoader</code> reference to the <code class="literal">&lt;properties depends="arjuna" name="jta"&gt;</code> section of the <code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/conf/jbossts-properties.xml</code> file. The <code class="literal">WSMQJmsWNPMQMProvider</code> value must match the name in the JMSProviderLoader definition in the <code class="filename">wsmq-jmsprovider-ds.xml</code> file. 
<pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- the value has to correspond with property com.arjuna.ats.arjuna.xa.nodeIdentifier --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"com.arjuna.ats.jta.xaRecoveryNode"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"1"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- IBM MQ settings --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- the WSMQJmsWNPMQMProvider must match the name in the JMSProviderLoader definition in the *-ds.xml file. --&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"com.arjuna.ats.jta.recovery.XAResourceRecovery.WSMQWNPMQM"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.jms.server.recovery.MessagingXAResourceRecovery;java:/WSMQJmsWNPMQMProvider"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>
</pre>

						</div></li><li class="step"><div class="para">
							Restart the JBoss Enterprise Application Server instance. After the restart, the connection will be established. The connection factory will be available under the <code class="literal">IbmMQJMSXA</code> JNDI name (bound by JCA). The XA connection factory will be available under the <code class="literal">IBMMQInitialContext/WNPMQMXACF</code> JNDI name (bound as external context).
						</div><div class="para">
							If the connection is not established successfully, the following WARN message will be periodically logged: 
<pre class="programlisting">
2011-06-10 10:44:08,707 WARN  [loggerI18N] [com.arjuna.ats.internal.jta.recovery.xarecovery1] 
Local XARecoveryModule.xaRecovery  got XA exception javax.transaction.xa.XAException: 
 Error trying to connect to provider java:/WSMQJmsWNPMQMProvider, XAException.XAER_RMERR
</pre>

						</div></li></ol></div></div></div></div></div></body></html>