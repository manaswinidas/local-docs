<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 16. Using Production Databases with JBoss Enterprise Application Platform</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="production_DBs">
      ⁠</a>Chapter 16. Using Production Databases with JBoss Enterprise Application Platform</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139776680015808">
      ⁠</a>16.1. How to Use Production Databases</h1></div></div></div><div class="para">
			<a id="idm139776699315792" class="indexterm"/> JBoss utilizes the Hypersonic database as its default database. While this is good for development and prototyping, you or your company will probably require another database to be used for production. This chapter covers configuring JBoss Enterprise Application Platform to use production databases. We cover the procedures for all officially supported databases on the JBoss Enterprise Application Platform. For a complete list of certified databases, refer to <a href="http://www.jboss.com/products/platforms/application/supportedconfigurations/">http://www.jboss.com/products/platforms/application/supportedconfigurations/</a>.
		</div><div class="para">
			Please note that in this chapter, we explain how to use production databases to support all services in JBoss Enterprise Application Platform. This includes all the system level services such as EJB and JMS. For individual applications (e.g., WAR or EAR) deployed in JBoss Enterprise Application Platform, you can still use any backend database by setting up the appropriate data source connection.
		</div><div class="para">
			Installing the external database is out of the scope of this document. Use the tools provided by your database vendor to set up an empty database. You will need the database name, connection URL, username, and password, in order to create the datasource the Platform will use to connect to the database.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139776723922080">
      ⁠</a>16.2. Installing JDBC Drivers</h1></div></div></div><div class="para">
			To use the selected external database, you must also install the JDBC driver for your database. The JDBC driver is a JAR file, which must be placed into the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/lib</code> directory. Replace <em class="replaceable">&lt;PROFILE&gt;</em> with the server profile you are using.
		</div><div class="para">
			This file is loaded when JBoss Enterprise Application Platform starts up, so if you have the JBoss Enterprise Application Platform running, you will need to shut down and restart. Review the list below for a suitable JDBC driver. For a full list of certified JBoss Enterprise Application Platform database drivers, refer to <a href="http://www.jboss.com/products/platforms/application/supportedconfigurations/#JEAP5-0">http://www.jboss.com/products/platforms/application/supportedconfigurations/#JEAP5-0</a>. If the links fail to work, please file a JIRA against this documentation, but be aware that Red Hat does not control these external links. Contact your database vendor for the most current version of the driver for your database.
		</div><div class="variablelist"><p class="title"><strong>JBDC Driver Download Locations</strong></p><dl class="variablelist"><dt><span class="term">MySQL</span></dt><dd><div class="para">
						Download from <a href="http://www.mysql.com/products/connector/">http://www.mysql.com/products/connector/</a>.
					</div></dd><dt><span class="term">PostgreSQL</span></dt><dd><div class="para">
						Download from <a href="http://jdbc.postgresql.org/">http://jdbc.postgresql.org/</a>.
					</div></dd><dt><span class="term">Oracle</span></dt><dd><div class="para">
						Download from <a href="http://www.oracle.com/technology/software/tech/java/sqlj_jdbc/index.html">http://www.oracle.com/technology/software/tech/java/sqlj_jdbc/index.html</a>.
					</div></dd><dt><span class="term">IBM</span></dt><dd><div class="para">
						Download from <a href="http://www-306.ibm.com/software/data/db2/java/">http://www-306.ibm.com/software/data/db2/java/</a>.
					</div></dd><dt><span class="term">Sybase</span></dt><dd><div class="para">
						Download from the Sybase jConnect product page <a href="http://www.sybase.com/products/allproductsa-z/softwaredeveloperkit/jconnect">http://www.sybase.com/products/allproductsa-z/softwaredeveloperkit/jconnect</a>.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Sybase jConnect JDBC Driver 7</strong></p></div><div class="admonition"><div class="para">
							When using Sybase database with this driver, the <code class="varname"> MaxParams </code> attribute cannot be set higher than <code class="literal">481</code> due to a limitation in the driver's <code class="classname">PreparedStatement</code> class.
						</div></div></div></dd><dt><span class="term">Microsoft</span></dt><dd><div class="para">
						Download from the MSDN web site <a href="http://msdn.microsoft.com/data/jdbc/">http://msdn.microsoft.com/data/jdbc/</a>.
					</div></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776768598624">
      ⁠</a>16.2.1. Special Notes on Sybase</h2></div></div></div><div class="para">
				Some of the services in JBoss uses null values for the default tables that are created. Sybase Adaptive Server should be configured to allow nulls by default.
			</div><pre class="screen">sp_dboption db_name, "allow nulls by default", true</pre><div class="para">
				Refer to the Sybase manuals for more options.
			</div><div class="para">
				Additionally, text and image values stored in the database can be very large. When a select list includes both text and image values, the length limit of the data returned is determined by the <code class="varname"> @@textsize </code> global variable. The default setting for this variable depends on the software used to access Adaptive Server. For the JDBC driver, the default value is 32 kilobytes.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776756558992">
      ⁠</a>16.2.1.1. Enable JAVA services</h3></div></div></div><div class="para">
					To use any Java service (for example; JMS, CMP, timers) configured with Sybase, Java must be enabled on Sybase Adaptive Server. To do this use:
				</div><pre class="screen">sp_configure "enable java",1</pre><div class="para">
					Refer to the sybase manuals for more information.
				</div><div class="para">
					If Java is not enabled for Sybase Adaptive Server, the following error message may be echoed in the console.
				</div><pre class="screen">com.sybase.jdbc2.jdbc.SybSQLException: Cannot run this command because Java services are not
        enabled. A user with System Administrator (SA) role must reconfigure the system to enable Java</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776683156752">
      ⁠</a>16.2.1.2. CMP Configuration</h3></div></div></div><div class="para">
					To use Container Managed Persistence for user defined Java objects with Sybase Adaptive Server Enterprise, the Java classes should be installed in the database. The system table <code class="literal">sysxtypes</code> contains one row for each extended Java-SQL datatype. This table is only used for Adaptive Servers enabled for Java. Install Java classes using the <span class="application"><strong>installjava</strong></span> program.
				</div><pre class="screen">installjava -f &lt;jar-file-name&gt; -S&lt;sybase-server&gt; -U&lt;super-user&gt; -P&lt;super-pass&gt; -D&lt;db-name&gt;</pre><div class="para">
					Refer to the <span class="application"><strong>installjava</strong></span> manual in Sybase for more options.
				</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776688442416">
      ⁠</a>16.2.1.3. Installing Java Classes</h3></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
							You have to be a super-user with required privileges to install Java classes.
						</div></li><li class="listitem"><div class="para">
							The JAR file you are trying to install should be created without compression.
						</div></li><li class="listitem"><div class="para">
							Java classes that you install and use in the server must be compiled with JDK 1.2.2. If you compile a class with a later JDK, you will be able to install it in the server using the <span class="application"><strong>installjava</strong></span> utility, but you will get a <span class="errorname"> java.lang.ClassFormatError </span> exception when you attempt to use the class. This is because Sybase Adaptive Server uses an older JVM internally, and requires the Java classes to be compiled with the same.
						</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776693813312">
      ⁠</a>16.2.1.4. Increase @@textsize Default for Sybase v15.0.3</h3></div></div></div><div class="para">
					A problem with the default maximum text size value returned from the database may cause some tests to fail on JBoss Messaging. To correct the issue, change the default <em class="parameter"><code>@@textsize</code></em> value from 32768 (bytes) to 2147483647 (bytes).
				</div><div class="para">
					Make the change in the <code class="filename">sybase-ds.xml</code> file inside a <span class="markup"> &lt;connection-url&gt; </span> directive. An example <code class="filename">sybase-ds.xml</code> file is located in <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/docs/examples/jca/</code> <div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
							Specify the entire URL to the database as the directive value. Replace <em class="replaceable">[domain]</em> with the domain name or IP address hosting the Sybase Database, and <em class="replaceable">[port]</em> with the port configured to accept requests.
						</div></div></div>
					 
<pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;connection-url&gt;</span>jdbc:sybase:[domain]:[port]/db_name?SQLINITSTRING=set TextSize 2147483647<span xmlns="" class="perl_Keyword">&lt;/connection-url&gt;</span></pre>

				</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_JDBC_DataSources">
      ⁠</a>16.2.2. Configuring JDBC DataSources</h2></div></div></div><div class="para">
				Datasources correspond to the simplified JCA Datasource configuration specifications.
			</div><div class="para">
				Datasources need to reside in the <code class="filename">&lt;JBOSS_HOME&gt;/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy</code> directory, alongside other deployable applications and resources. The files use a standard naming scheme of <code class="filename"><em class="replaceable">DBNAME</em>-ds.xml</code>.
			</div><div class="para">
				Example datasources for all certified databases are located in the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/docs/examples/jca</code> directory. Edit the datasource that corresponds to your database, and copy it to the <code class="filename">deploy/</code> directory before restarting the application server.
			</div><div class="para">
				See <a class="xref" href="datasource-config.html">Chapter 17, <em>Datasource Configuration</em></a> for information on configuring datasources. As a minimum, you will need to change the <code class="varname"> connection-url </code> , <code class="varname"> user-name </code> , and <code class="varname"> password </code> to correspond to your database of choice.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Database_Configuration_Tool">
      ⁠</a>16.3. Switching to a Production Database</h1></div></div></div><div class="para">
			You can use the Database Configuration Tool to switch to a production database. The Database Configuration Tool is an Apache Ant script that sets the database to be used by JBoss Enterprise Application Platform. The script can be found in the <code class="filename">JBOSS_HOME/jboss-as/tools/schema/</code> directory.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul><li class="listitem"><div class="para">
					Apache Ant must be installed.
				</div></li><li class="listitem"><div class="para">
					The database that you wish to use must already exist.
				</div></li><li class="listitem"><div class="para">
					A user with permission to make changes to that database must already exist.
				</div></li><li class="listitem"><div class="para">
					The JDBC driver JAR file for the database must be in the server configuration's <code class="filename">lib/</code> directory.
				</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				You can only use the Database Configuration Tool to change the database configuration once. Also, it must be run before any other changes are made. If you try to run the script on an installation that has already been configured, it may not work as intended.
			</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Back Up Your Server Profile</strong></p><div class="para">
					Make a copy of the server profile for which you plan to configure your database as the Database Configuration Tool modifies the configuration settings. <code class="command">cp -R JBOSS_HOME/jboss-as/server/Profile /path/to/backup/folder</code>.
				</div></li><li class="step"><p class="title"><strong>Run the Database Configuration Tool</strong></p><div class="para">
					Change to the directory containing the Database Configuration Tool script: <code class="command">cd JBOSS_HOME/jboss-as/tools/schema</code>
				</div></li><li class="step"><p class="title"><strong>Run Apache Ant</strong></p><div class="para">
					Run the <code class="command">ant</code> command to launch the script.
				</div></li><li class="step"><p class="title"><strong>Enter Data</strong></p><div class="para">
					Following the prompts, enter the following information as it is requested:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							the type of database being used,
						</div></li><li class="listitem"><div class="para">
							the name of the database,
						</div></li><li class="listitem"><div class="para">
							the host name or IP Address of the database,
						</div></li><li class="listitem"><div class="para">
							the TCP port being used for the database,
						</div></li><li class="listitem"><div class="para">
							the user name needed to access the database, and
						</div></li><li class="listitem"><div class="para">
							the password for the user account.
						</div></li></ul></div><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						You could also add these values directly to the <code class="filename">build.properties</code> file (found in the same directory) before running the script. The Database Configuration Tool will not prompt you for these properties if it finds you have already added them to the file.
					</div></div></div></li></ol></div><div class="para"><div xmlns:d="http://docbook.org/ns/docbook" class="title">Result</div>
				The Database Configuration Tool updates the relevant configuration files and exits. JBoss Enterprise Application Platform is then reconfigured for use with the production database.
			</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139776760893216">
      ⁠</a>16.4. Common Database-Related Tasks</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776760892448">
      ⁠</a>16.4.1. Security and Pooling</h2></div></div></div><div class="para">
				Unless the <code class="classname">ResourceAdapter</code> has <code class="literal">&lt;reauthentication-support&gt;</code>, using multiple security identities will create subpools for each identity.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The min and max pool size are per subpool, so be careful with these parameters if you have lots of identities.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776740701696">
      ⁠</a>16.4.2. Change Database for the JMS Services</h2></div></div></div><div class="para">
				The JMS service in the JBoss Enterprise Application Platform uses relational databases to persist its messages. For improved performance, we should change the JMS service to take advantage of the external database. To do that, we need to replace the file <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/messaging/<em class="replaceable">$DATABASE</em>-persistence-service.xml</code> with the <code class="filename"><em class="replaceable">$DATABASE</em>-persistence-service.xml</code> filename depending on your external database. 
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						MySQL: <code class="filename">mysql-persistence-service.xml</code>
					</div></li><li class="listitem"><div class="para">
						PostgreSQL: <code class="filename">postgresql-persistence-service.xml</code>
					</div></li><li class="listitem"><div class="para">
						Oracle: <code class="filename">oracle-persistence-service.xml</code>
					</div></li><li class="listitem"><div class="para">
						DB2: <code class="filename">db2-persistence-service.xml</code>
					</div></li><li class="listitem"><div class="para">
						Sybase: <code class="filename">sybase-persistence-service.xml</code>
					</div></li><li class="listitem"><div class="para">
						MS SQL Server: <code class="filename">mssql-persistence-service.xml</code>
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776750008400">
      ⁠</a>16.4.3. Support Foreign Keys in CMP Services</h2></div></div></div><div class="para">
				Next, we need to go change the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/conf/standardjbosscmp-jdbc.xml</code> file so that the <code class="varname"> fk-constraint </code> property is <code class="literal">true</code>. That is needed for all external databases we support on the JBoss Enterprise Application Platform. This file configures the database connection settings for the EJB2 CMP beans deployed in the JBoss Enterprise Application Platform.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;fk-constraint&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/fk-constraint&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776688069536">
      ⁠</a>16.4.4. Specify Database Dialect for Java Persistence API</h2></div></div></div><div class="para">
				The Java Persistence API (JPA) entity manager can save EJB3 entity beans to any backend database. Hibernate provides the JPA implementation in JBoss Enterprise Application Platform. Hibernate has a dialect auto-detection mechanism that works for most databases including the dialects for databases referenced in this appendix which are listed below. If a specific dialect is needed for production databases, you can configure the database dialect in the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deployers/ejb3.deployer/META-INF/jpa-deployers-jboss-beans.xml</code> file. To configure this file you need to uncomment the set of tags related to the map entry <code class="literal">hibernate.dialect</code> and change the values to the following based on the database you setup. 
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						Oracle 10g: <code class="literal">org.hibernate.dialect.Oracle10gDialect</code>
					</div></li><li class="listitem"><div class="para">
						Oracle 11g: <code class="literal">org.hibernate.dialect.Oracle10gDialect</code>
					</div></li><li class="listitem"><div class="para">
						Microsoft SQL Server 2008: <code class="literal">org.hibernate.dialect.SQLServerDialect</code>
					</div></li><li class="listitem"><div class="para">
						PostgresSQL 8.2.3: <code class="literal">org.hibernate.dialect.PostgreSQLDialect</code>
					</div></li><li class="listitem"><div class="para">
						PostgresSQL 8.3.7: <code class="literal">org.hibernate.dialect.PostgreSQLDialect</code>
					</div></li><li class="listitem"><div class="para">
						MySQL 5.0: <code class="literal">org.hibernate.dialect.MySQL5InnoDBDialect</code>
					</div></li><li class="listitem"><div class="para">
						MySQL 5.1: <code class="literal">org.hibernate.dialect.MySQL5InnoDBDialect</code>
					</div></li><li class="listitem"><div class="para">
						DB2 9.1: <code class="literal">org.hibernate.dialect.DB2Dialect</code>
					</div></li><li class="listitem"><div class="para">
						Sybase ASE 15: <code class="literal">org.hibernate.dialect.SybaseASE15Dialect</code>
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776724443920">
      ⁠</a>16.4.5. Change Other JBoss Enterprise Application Platform Services to use the External Database</h2></div></div></div><div class="para">
				Besides JMS, CMP, and JPA, we still need to hook up the rest of JBoss services with the external database. There are two ways to do it. One is easy but inflexible. The other is flexible but requires more steps. Now, let us discuss those two approaches respectively.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776724442416">
      ⁠</a>16.4.5.1. The Easy Way</h3></div></div></div><div class="para">
					The easy way is just to change the JNDI name for the external database to <code class="literal">DefaultDS</code>. Most JBoss services are hard-wired to use the <code class="literal">DefaultDS</code> by default. So, by changing the DataSource name, we do not need to change the configuration for each service individually.
				</div><div class="para">
					To change the JNDI name, just open the <code class="filename">*-ds.xml</code> file for your external database, and change the value of the <code class="varname"> jndi-name </code> property to <code class="literal">DefaultDS</code>. For instance, in <code class="filename">mysql-ds.xml</code>, you would change <code class="literal">MySqlDS</code> to <code class="literal">DefaultDS</code> and so on. You will need to remove the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/hsqldb-ds.xml</code> file after you are done to avoid duplicated <code class="literal">DefaultDS</code> definition.
				</div><div class="para">
					In the <code class="filename">messaging/<em class="replaceable">$DATABASE</em>-persistence-service.xml</code> file, you should also change the datasource name in the <code class="literal">depends</code> tag for the <code class="classname">PersistenceManagers</code> MBean to <code class="literal">DefaultDS</code>. For instance, for <code class="filename">mysql-persistence-service.xml</code> file, we change the <code class="literal">MySqlDS</code> to <code class="literal">DefaultDS</code>.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;mbean</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            code=</span><span xmlns="" class="perl_String">"org.jboss.messaging.core.jmx.JDBCPersistenceManagerService"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            name=</span><span xmlns="" class="perl_String">"jboss.messaging:service=PersistenceManager"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">            xmbean-dd=</span><span xmlns="" class="perl_String">"xmdesc/JDBCPersistenceManager-xmbean.xml"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss.jca:service=DataSourceBinding,name=DefaultDS<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776761444704">
      ⁠</a>16.4.5.2. The More Flexible Way</h3></div></div></div><div class="para">
					Changing the external datasource to <code class="literal">DefaultDS</code> is convenient. But if you have applications that assume the <code class="literal">DefaultDS</code> always points to the factory-default HSQL DB, that approach could break your application. Also, changing <code class="literal">DefaultDS</code> destination forces all JBoss services to use the external database. What if you want to use the external database only on some services?
				</div><div class="para">
					A safer and more flexible way to hook up JBoss Enterprise Application Platform services with the external DataSource is to manually change the <code class="literal">DefaultDS</code> in all standard JBoss services to the DataSource JNDI name defined in your <code class="filename">*-ds.xml</code> file (for example, the <code class="literal">MySqlDS</code> in <code class="filename">mysql-ds.xml</code>, etc.). Below is a complete list of files that contain <code class="literal">DefaultDS</code>. You can update them all to use the external database on all JBoss services or update some of them to use different combination of DataSources for different services.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/conf/login-config.xml</code>: This file is used in Java EE container managed security services.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/conf/standardjbosscmp-jdbc.xml</code>: This file configures the CMP beans in the EJB container.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/ejb2-timer-service.xml</code>: This file configures the EJB timer services.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/juddi-service.sar/META-INF/jboss-service.xml</code>: This file configures the UUDI service.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/juddi-service.sar/juddi.war/WEB-INF/jboss-web.xml</code>: This file configures the UUDI service.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/juddi-service.sar/juddi.war/WEB-INF/juddi.properties</code>: This file configures the UUDI service.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/uuid-key-generator.sar/META-INF/jboss-service.xml</code>: This file configures the UUDI service.
						</div></li><li class="listitem"><div class="para">
							<code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/messaging/messaging-jboss-beans.xml</code> and <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/messaging/persistence-service.xml</code>: Those files configure the JMS persistence service as we discussed earlier.
						</div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776681386064">
      ⁠</a>16.4.6. A Special Note About Oracle Databases</h2></div></div></div><div class="para">
				In our setup discussed in this chapter, we rely on the JBoss Enterprise Application Platform to automatically create needed tables in the external database upon server start up. That works most of the time. But for databases like Oracle, there might be some minor issues if you try to use the same database server to back more than one JBoss Enterprise Application Platform instance.
			</div><div class="para">
				The Oracle database creates tables of the form <code class="literal">schemaname.tablename</code>. The <code class="literal">TIMERS</code> and <code class="literal">HILOSEQUENCES</code> tables needed by JBoss Enterprise Application Platform would not be created on a schema if the table already existed on a different schema. To work around this issue, you need to edit the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/ejb2-timer-service.xml</code> file to change the table name from <code class="literal">TIMERS</code> to something like <code class="literal">schemaname2.tablename</code>.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.ejb.txtimer.DatabasePersistencePolicy"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          name=</span><span xmlns="" class="perl_String">"jboss.ejb:service=EJBTimerService,persistencePolicy=database"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- DataSourceBinding ObjectName --&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"DataSource"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          jboss.jca:service=DataSourceBinding,name=DefaultDS
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- The plugin that handles database persistence --&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DatabasePersistencePlugin"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          org.jboss.ejb.txtimer.GeneralPurposeDatabasePersistencePlugin
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- The timers table name --&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TimersTable"</span><span xmlns="" class="perl_Keyword">&gt;</span>TIMERS<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
</pre><div class="para">
				Similarly, you need to change the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/uuid-key-generator.sar/META-INF/jboss-service.xml</code> file to change the table name from <code class="literal">HILOSEQUENCES</code> to something like <code class="literal">schemaname2.tablename</code> as well.
			</div><pre class="programlisting"><span xmlns="" class="line">​</span> <span xmlns="" class="perl_Comment">&lt;!-- HiLoKeyGeneratorFactory --&gt;</span> <span xmlns="" class="perl_Keyword">&lt;mbean</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          code=</span><span xmlns="" class="perl_String">"org.jboss.ejb.plugins.keygenerator.hilo.HiLoKeyGeneratorFactory"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">          name=</span><span xmlns="" class="perl_String">"jboss:service=KeyGeneratorFactory,type=HiLo"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;depends&gt;</span>jboss:service=TransactionManager<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- Attributes common to HiLo factory instances --&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- DataSource JNDI name --&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;depends</span><span xmlns="" class="perl_Others"> optional-attribute-name=</span><span xmlns="" class="perl_String">"DataSource"</span><span xmlns="" class="perl_Keyword">&gt;</span>jboss.jca:service=DataSourceBinding,name=DefaultDS<span xmlns="" class="perl_Keyword">&lt;/depends&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- table name --&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TableName"</span><span xmlns="" class="perl_Keyword">&gt;</span>HILOSEQUENCES<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
</pre><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Regression in Oracle JDBC driver 11.1.0.7.0</strong></p></div><div class="admonition"><div class="para">
					Oracle JDBC driver version 11.1.0.7.0 causes the JBoss Messaging Test Suite to fail with a <code class="exceptionname"> SQLException </code> ("Bigger type length than Maximum") on Oracle 11g R1.
				</div><div class="para">
					This is caused by a regression in Oracle JDBC driver 11.1.0.7.0.
				</div><div class="para">
					We recommend Oracle JDBC driver version 11.2.0.1.0 for use with Oracle 11g R1, Oracle 11g R2, Oracle RAC 11g R1 and Oracle RAC 11g R2.
				</div></div></div></div></div></div></body></html>