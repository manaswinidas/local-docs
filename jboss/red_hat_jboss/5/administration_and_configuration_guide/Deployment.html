<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 7. Deployment</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Deployment">
      ⁠</a>Chapter 7. Deployment</h1></div></div></div><div class="para">
		Deploying applications on JBoss Enterprise Application Platform is achieved by copying the application into the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy</code> directory. Replace <span class="emphasis"><em>default</em></span> with different server profiles such as <span class="emphasis"><em>all</em></span> or <span class="emphasis"><em>minimal</em></span> (server profiles are covered later in this guide). The JBoss Enterprise Application Platform constantly scans the deploy directory to pick up new applications or any changes to existing applications. This enables <span class="emphasis"><em>hot deployment</em></span> of applications on the fly, while JBoss Enterprise Application Platform is still running.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Deployable_Application_Types">
      ⁠</a>7.1. Deployable Application Types</h1></div></div></div><div class="para">
			With JBoss Enterprise Application Platform 4.x, a deployer existed to handle a specified deployment type and that was the only deployer that processed the deployment. In JBoss Enterprise Application Platform 5, multiple deployers transform the metadata associated with a deployment until it is processed by a deployer that creates a runtime component from the metadata.
		</div><div class="para">
			Deployment has to contain a descriptor that causes the component metadata to be added to the deployment. The types of deployments for which deployers exists by default in the JBoss Enterprise Application Platform include:
		</div><div class="variablelist"><dl class="variablelist"><dt><span class="term">WAR</span></dt><dd><a id="idm139776696930272" class="indexterm"/><a id="idm139776682908304" class="indexterm"/><div class="para">
						The WAR application archive (e.g., myapp.war) packages Java EE web applications in a JAR file. It contains servlet classes, view pages, libraries, and deployment descriptors in WEB-INF such as <code class="filename">web.xml</code>, <code class="filename">faces-config.xml</code>, and <code class="filename">jboss-web.xml</code> etc..
					</div></dd><dt><span class="term">EAR</span></dt><dd><a id="idm139776683614816" class="indexterm"/><a id="idm139776681066016" class="indexterm"/><div class="para">
						The EAR application archive (e.g., myapp.ear) packages a Java EE enterprise application in a JAR file. It typically contains a WAR file for the web module, JAR files for EJB modules, as well as META-INF deployment descriptors such as application.xml and jboss-app.xml etc.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Persistence Units in EAR Deployment</strong></p></div><div class="admonition"><div class="para">
							According to EJB3 specification, deployment of a persistence unit into an EAR should fail when the unit is outside of the EAR file and the bean attempting to inject the persistence unit is within the EAR. To follow the specification, you need to deploy the persistence unit packaged within the EAR file.
						</div><div class="para">
							However, JBoss Enterprise Application Platform persistence units can exist outside of their EARs. To allow this behavior, modify the bean class of the <code class="literal">PersistenceUnitDependencyResolver</code> bean in the file <code class="filename">deployers/ejb3.deployer/META-INF/jpa-deployer-jboss-beans.xml</code> under the respective JBoss Enterprise Application Platform server profile:
						</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!--</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">Can be DefaultPersistenceUnitDependencyResolver for spec compliant resolving,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">InterApplicationPersistenceUnitDependencyResolver for resolving beyond EARs,</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">or DynamicPersistencePersistenceUnitDependencyResolver which allows configuration via JMX.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">--&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"PersistenceUnitDependencyResolver"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.jpa.resolvers.DynamicPersistenceUnitDependencyResolver"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
</pre><div class="para">
							The bean default value is <code class="literal">DynamicPersistenceUnitDependencyResolver</code>. This resolver allows you to specify the specification-compliant behavior, which can be additionally monitored through an MBean in the JMX Console. To use the spec-noncompliant JBoss variant, set the bean to <code class="literal">InterApplicationPersistenceUnitDependencyResolver</code>.
						</div></div></div></dd><dt><span class="term">JBoss Microcontainer</span></dt><dd><a id="idm139776681698976" class="indexterm"/><div class="para">
						The JBoss Microcontainer (MC) beans archive (typical suffixes include, .beans, .deployer) packages a POJO deployment in a JAR file with a <code class="filename">META-INF/jboss-beans.xml</code> descriptor. This format is commonly used by the JBoss Enterprise Application Platform component deployers.
					</div><div class="para">
						You can deploy <code class="filename">*-jboss-beans.xml</code> files with MC beans definitions. If you have the appropriate JAR files available in the deploy or lib directories, the MC beans can be deployed using such a standalone XML file.
					</div></dd><dt><span class="term">SAR</span></dt><dd><a id="idm139776686938256" class="indexterm"/><a id="idm139776686937136" class="indexterm"/><div class="para">
						The SAR application archive (e.g., myservice.sar) packages a JBoss service in a JAR file. It is mostly used by JBoss Enterprise Application Platform internal services that have not been updated to support MC beans style deployments.
					</div><div class="para">
						You can deploy <code class="filename">*-service.xml</code> files with MBean service definitions. If you have the appropriate JAR files available in the deploy or lib directories, the MBeans specified in the XML files will be started. This is the way you deploy many JBoss Enterprise Application Platform internal services that have not been updated to support POJO style deployment, such as the JMS queues.
					</div></dd><dt><span class="term">DataSource</span></dt><dd><a id="idm139776686528000" class="indexterm"/><div class="para">
						The <code class="filename">*-ds.xml</code> file defines connections to external databases. The data source can then be reused by all applications and services in JBoss Enterprise Application Platform via the internal JNDI.
					</div></dd><dt><span class="term">HAR</span></dt><dd><div class="para">
						The HAR file defines Hibernate objects for an application. It resembles a SAR file but it contains the Hibernate class and mapping files, and a *-hibernate.xml deployment descriptor in its META-INF directory.
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>*-hibernate.xml</strong></p></div><div class="admonition"><div class="para">
							The <code class="filename">*-hibernate.xml</code> takes the same form as <code class="filename">jboss-service.xml</code>. 
							<div class="example"><a id="hibernate.xml">
      ⁠</a><p class="title"><strong>Example 7.1. A Hibernate deployment descriptor (*-hibernate.xml)</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;hibernate-configuration xmlns=<span xmlns="" class="perl_String">"urn:jboss:hibernate-deployer:1.0"</span>&gt;
<span xmlns="" class="line">​</span>  &lt;session-factory name=<span xmlns="" class="perl_String">"java:/hibernate/SessionFactory"</span>
<span xmlns="" class="line">​</span>    bean=<span xmlns="" class="perl_String">"jboss.test.har:service=Hibernate,testcase=TimersUnitTestCase"</span>&gt;
<span xmlns="" class="line">​</span>    &lt;property name=<span xmlns="" class="perl_String">"datasourceName"</span>&gt;OracleDS&lt;/property&gt;
<span xmlns="" class="line">​</span>    &lt;property name=<span xmlns="" class="perl_String">"dialect"</span>&gt;org.<span xmlns="" class="perl_Function">hibernate</span>.<span xmlns="" class="perl_Function">dialect</span>.<span xmlns="" class="perl_Function">OracleDialect</span>&lt;/property&gt;
<span xmlns="" class="line">​</span>    &lt;depends&gt;jboss:service=Naming&lt;/depends&gt;
<span xmlns="" class="line">​</span>    &lt;depends&gt;jboss:service=TransactionManager&lt;/depends&gt;
<span xmlns="" class="line">​</span>  &lt;/session-factory&gt;
<span xmlns="" class="line">​</span>&lt;/hibernate-configuration&gt;</pre></div></div>

						</div></div></div></dd><dt><span class="term">*AR</span></dt><dd><a id="idm139776763515776" class="indexterm"/><div class="para">
						You can also deploy JAR files containing EJBs or other service objects directly in JBoss Enterprise Application Platform. The list of suffixes that are recognized as JAR files is specified in the <code class="filename">conf/bootstrap/deployers.xml</code> JARStructure bean constructor set.
					</div></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Exploded_Deployment">
      ⁠</a>7.1.1. Exploded Deployment</h2></div></div></div><a id="idm139776740009008" class="indexterm"/><div class="para">
				The WAR, EAR, MC beans and SAR deployment packages are JAR files with special XML deployment descriptors in directories like META-INF and WEB-INF. JBoss Enterprise Application Platform allows you to deploy the archives also as expanded directories instead of JAR files. This is called exploded deployment and allows you to make application changes on the fly, that is without re-deploying the entire application. If you need to re-deploy an exploded directory without restart the server, just <code class="code">touch</code> the deployment descriptors (that is the <code class="filename">WEB-INF/web.xml</code> in a WAR and the <code class="filename">META-INF/application.xml</code> in an EAR) to update their timestamps.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Standard_Server_Profiles">
      ⁠</a>7.2. Standard Server Profiles</h1></div></div></div><div class="para">
			The JBoss Enterprise Application Platform ships with six server profiles. Each server profile is contained in a directory named <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/</code>. You can look into each server profile's directory to see the services, applications, and libraries included in the server profile.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				The exact contents of the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em></code> directory depends on the server profile service implementation and is subject to change as the management layer and embedded server evolve.
			</div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">all</span></dt><dd><a id="idm139776735838288" class="indexterm"/><div class="para">
						The <code class="literal">all</code> profile provides clustering support and other enterprise extensions.
					</div></dd><dt><span class="term">production</span></dt><dd><a id="idm139776734217744" class="indexterm"/><div class="para">
						The <span class="emphasis"><em>production</em></span> server profile is based on the <code class="literal">all</code> server profile and provides configuration optimized for production environments.
					</div></dd><dt><span class="term">minimal</span></dt><dd><a id="idm139776739191376" class="indexterm"/><div class="para">
						Starts the core server container without any of the enterprise services. Use the <code class="literal">minimal</code> server profile as a base to build a customized version of JBoss Enterprise Application Platform that only contains the services you need.
					</div></dd><dt><span class="term">default</span></dt><dd><a id="idm139776760209936" class="indexterm"/><div class="para">
						The <code class="literal">default</code> server profile is mostly used by application developers. It supports the standard Java EE 5.0 programming APIs (e.g., Annotations, JPA, and EJB3).
					</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
							The <code class="literal">default</code> server profile is used if a profile is not specified via the command-line or in a configuration file.
						</div></div></div></dd><dt><span class="term">standard</span></dt><dd><a id="idm139776770003968" class="indexterm"/><div class="para">
						The <span class="emphasis"><em>standard</em></span> server profile is the server profile that has been tested for Java EE compliance. The major differences with the existing server profiles is that call-by-value and deployment isolation are enabled by default, along with support for <code class="filename">rmiiiop</code> and <code class="filename">juddi</code> (taken from the <span class="emphasis"><em>all</em></span> config).
					</div></dd><dt><span class="term">web</span></dt><dd><a id="idm139776739606320" class="indexterm"/><div class="para">
						The <span class="emphasis"><em>web</em></span> server profile is an experimental, lightweight configuration created around JBoss Web that will follow the developments of the Java EE 6 web server profile. Except for the <code class="filename">servlet/jsp</code> container, it provides support for JTA/JCA and JPA. It also limits itself to allowing access to the server only through the http port. Please note that this server profile is not Java EE certified and will most likely change in the following releases.
					</div></dd></dl></div><div class="para">
			The detailed services and APIs supported in each of those server profiles will be discussed throughout.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Changing_Profile">
      ⁠</a>7.2.1. Changing Profile</h2></div></div></div><div class="para">
				If you want to change the profile used by the server, the method depends on whether the server was started at the command line or as a service.
			</div><div class="para">
				If the server is being started at the command line, specify the required profile with the <span class="emphasis"><em>-c</em></span> parameter: <code class="command">run.sh -c <em class="replaceable">profile</em></code>. For example, <code class="command">run.sh -c all</code> on Red Hat Enterprise Linux or <code class="command">run.bat -c all</code> command on Microsoft Windows starts the server in the <span class="emphasis"><em>all</em></span> server profile.
			</div><div class="para">
				If the server is being started as a service, reconfigure the profile used by the service then stop and restart the service. Refer to the <em class="citetitle">Run the Enterprise Application Platform as a Service</em> section of the <em class="citetitle">Installation Guide</em> for details of where the profile is specified.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
					There is no <code class="literal">Server Started</code> message shown at the console when the server is started using the <code class="literal">production</code> profile. This message can be found in the <code class="filename">server.log</code> file located in the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/jboss-as/server/production/logs/log</code> subdirectory.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139776739014496">
      ⁠</a>7.2.2. Creating Your Own Profile</h2></div></div></div><div class="para">
				When creating your own server profile, copy the profile that is closest to your needs and modify the contents.
			</div><div class="example"><a id="idm139776685565920">
      ⁠</a><p class="title"><strong>Example 7.2. Example: Create a New Server Profile</strong></p><div class="example-contents"><div class="para">
					The following procedure is an example of how you might create a new server profile that does not require the <code class="literal">messaging</code> service:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139776685564096">
      ⁠</a><p class="title"><strong>Procedure 7.1. </strong></p><ol class="1"><li class="step"><div class="para">
							Copy a suitable profile directory (<code class="literal">production</code>, for instance).
						</div></li><li class="step"><div class="para">
							Rename the copied directory as desired (<em class="replaceable">myconfig</em>, for example).
						</div></li><li class="step"><div class="para">
							Remove the <code class="literal">messaging</code> subdirectory from the <code class="filename">deploy</code> folder.
						</div></li><li class="step"><div class="para">
							Start JBoss with the new profile using the command:
						</div><pre class="programlisting">run -c <em class="replaceable">myconfig</em></pre></li></ol></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The <span class="bold bold"><strong>default</strong></span> configuration is the one used if you do not specify another when starting up the server.
				</div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Context_Root">
      ⁠</a>7.3. Context Root</h1></div></div></div><div class="para">
			The context root determines the URL of a deployed application. By default, the context root is identical with the application directory or archive structure; for example, if you deploy an <code class="filename">application.war</code> archive, which contains JSP pages in a <code class="filename">hello</code> directory, the JSPs in the <code class="filename">hello</code> directory will be available under <code class="filename">/application/hello/</code>.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139776688075456">
      ⁠</a><p class="title"><strong>Procedure 7.2. Rewriting the Default Context Root</strong></p><div class="para">
				You can change the context root if required. To rewrite the context root, you need to define the new context root and allow the server to use the new context.
			</div><ol class="1"><li class="step"><div class="para">
					To define a new context root, add the context-root element with the new value to the deployment descriptor of the application:
				</div><ul class="stepalternatives">
					<li class="step"><div class="para">
							To change the context root of a web application, add the context-root element to the <code class="filename">jboss-web.xml</code> file.
						</div><div class="example"><a id="ContextRootDef">
      ⁠</a><p class="title"><strong>Example 7.3. Example jboss-web.xml with a context root defined</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;?xml version=<span xmlns="" class="perl_String">"1.0"</span>?&gt;
<span xmlns="" class="line">​</span>&lt;jboss-web&gt;
<span xmlns="" class="line">​</span>   &lt;context-root&gt;/application-root&lt;/context-root&gt;
<span xmlns="" class="line">​</span>&lt;/jboss-web&gt;</pre><div class="para">
								The URL address for the application on localhost is 
<div class="address"><p>http://localhost:8080/application-root</p></div>

							</div></div></div></li>
					 <li class="step"><div class="para">
							To change the context root of a servlet, change the url-pattern element in the <code class="filename">web.xml</code> file.
						</div><div class="example"><a id="ContextRootDefServlet">
      ⁠</a><p class="title"><strong>Example 7.4. Example web.xml with a context root defined</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>&lt;?xml version=<span xmlns="" class="perl_String">"1.0"</span>?&gt;
<span xmlns="" class="line">​</span>&lt;servlet-mapping&gt;
<span xmlns="" class="line">​</span>  &lt;servlet-name&gt;MapRenderer&lt;/servlet-name&gt;
<span xmlns="" class="line">​</span>  &lt;url-pattern&gt;/servlet-root&lt;/url-pattern&gt;
<span xmlns="" class="line">​</span>&lt;/servlet-mapping&gt;</pre><div class="para">
								The URL address for the servlet on localhost is 
<div class="address"><p>http://localhost:8080/application-root/servlet-root</p></div>

							</div></div></div></li>

				</ul></li><li class="step"><div class="para">
					To start the server with the REWRITE_CONTEXT_CHECK variable set to <code class="literal">false</code>, run the following command: <code class="command">run.sh -Dorg.apache.catalina.connector.Response.REWRITE_CONTEXT_CHECK=false</code>
				</div></li></ol></div></div></div></body></html>