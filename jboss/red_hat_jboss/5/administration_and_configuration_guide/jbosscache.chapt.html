<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 29. JBoss Cache Configuration and Deployment</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="jbosscache.chapt">
      ⁠</a>Chapter 29. JBoss Cache Configuration and Deployment</h1></div></div></div><div class="para">
		JBoss Cache provides the underlying distributed caching support used by many of the standard clustered services in a JBoss Enterprise Application Platform cluster. You can also deploy JBoss Cache in your own application to handle custom caching requirements. In this chapter we provide some background on the main configuration options available with JBoss Cache, with an emphasis on how those options relate to the JBoss Cache usage by the standard clustered services the Enterprise Application Platform provides. We then discuss the different options available for deploying a custom cache in the Enterprise Application Platform.
	</div><div class="para">
		Users considering deploying JBoss Cache for direct use by their own application are strongly encouraged to read the JBoss Cache documentation available at the <a href="https://access.redhat.com/knowledge/docs/">https://access.redhat.com/knowledge/docs/</a>.
	</div><div class="para">
		See also <a class="xref" href="clustering-blocks.chapt.html#clustering-blocks-jbc">Section 21.2, “Distributed Caching with JBoss Cache”</a> for information on how the standard JBoss Enterprise Application Platform clustered services use JBoss Cache.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jbosscache-configuration">
      ⁠</a>29.1. Key JBoss Cache Configuration Options</h1></div></div></div><div class="para">
			JBoss Enterprise Application Platform ships with a reasonable set of default JBoss Cache configurations that are suitable for the standard clustered service use cases (e.g. web session replication or JPA/Hibernate caching). Most applications that involve the standard clustered services just work out of the box with the default configurations. You only need to tweak them when you are deploying an application that has special network or performance requirements. In this section we provide a brief overview of some of the key configuration choices. This is by no means a complete discussion; for full details users interested in moving beyond the default configurations are encouraged to read the JBoss Cache documentation available at <a href="https://access.redhat.com/knowledge/docs/">https://access.redhat.com/knowledge/docs/</a>.
		</div><div class="para">
			Most JBoss Cache configuration examples in this section use the JBoss Microcontainer schema for building up an <code class="literal">org.jboss.cache.config.Configuration</code> object graph from XML. JBoss Cache has its own custom XML schema, but the standard JBoss Enterprise Application Platform CacheManager service uses the JBoss Microcontainer schema to be consistent with most other internal Enterprise Application Platform services.
		</div><div class="para">
			Before getting into the key configuration options, let us have a look at the most likely place that a user would encounter them.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-cachemanager">
      ⁠</a>29.1.1. Editing the CacheManager Configuration</h2></div></div></div><div class="para">
				As discussed in <a class="xref" href="clustering-blocks.chapt.html#clustering-blocks-jbc-cachemanager">Section 21.2.1, “The JBoss Enterprise Application Platform CacheManager Service”</a>, the standard JBoss Enterprise Application Platform clustered services use the CacheManager service as a factory for JBoss Cache instances. So, cache configuration changes are likely to involve edits to the CacheManager service.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					Users can also use the CacheManager as a factory for custom caches used by directly by their own applications; see <a class="xref" href="jbosscache.chapt.html#jbosscache-custom-deployment-cachemgr">Section 29.2.1, “Deployment Via the CacheManager Service”</a>.
				</div></div></div><div class="para">
				The CacheManager is configured via the <code class="filename"><em class="replaceable">&lt;JBOSS_HOME&gt;</em>/server/<em class="replaceable">&lt;PROFILE&gt;</em>/deploy/cluster/jboss-cache-manager.sar/META-INF/jboss-cache-manager-jboss-beans.xml</code> file. The element most likely to be edited is the "CacheConfigurationRegistry" bean, which maintains a registry of all the named JBC configurations the CacheManager knows about. Most edits to this file would involve adding a new JBoss Cache configuration or changing a property of an existing one.
			</div><div class="para">
				The following is a redacted version of the "CacheConfigurationRegistry" bean configuration:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CacheConfigurationRegistry"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.jboss.ha.cachemanager.DependencyInjectedConfigurationRegistry"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- If users wish to add configs using a more familiar JBC config format</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">           they can add them to a cache-configs.xml file specified by this property.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">           However, use of the microcontainer format used below is recommended.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      &lt;property name="configResource"&gt;META-INF/jboss-cache-configs.xml&lt;/property&gt;      </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">      --&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- The configurations. A Map&lt;String name, Configuration config&gt; --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"newConfigurations"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> keyClass=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Others"> valueClass=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- The standard configurations follow.  You can add your own and/or edit these. --&gt;</span>   
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Standard cache used for web sessions --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entry&gt;&lt;key&gt;</span>standard-session-cache<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"StandardSessionCacheConfig"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Provides batching functionality for caches that do not want to </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">              interact with regular JTA Transactions --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"transactionManagerLookupClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            org.jboss.cache.transaction.BatchModeTransactionManagerLookup
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Name of cluster. Needs to be the same for all members --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"clusterName"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.partition.name:DefaultPartition}-SessionCache<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Use a UDP (multicast) based stack. Need JGroups flow control (FC)</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">              because we are using asynchronous replication. --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"multiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.default.jgroups.stack:udp}<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"fetchInMemoryState"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"nodeLockingScheme"</span><span xmlns="" class="perl_Keyword">&gt;</span>PESSIMISTIC<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"isolationLevel"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPEATABLE_READ<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cacheMode"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPL_ASYNC<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>          .... more details of the standard-session-cache configuration
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>      
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Appropriate for web sessions with FIELD granularity --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;entry&gt;&lt;key&gt;</span>field-granularity-session-cache<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>      
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"FieldSessionCacheConfig"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>              
<span xmlns="" class="line">​</span>           .... details of the field-granularity-standard-session-cache configuration
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>      
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   ... entry elements for the other configurations
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre><div class="para">
				The actual JBoss Cache configurations are specified using the JBoss Microcontainer's schema rather than one of the standard JBoss Cache configuration formats. When JBoss Cache parses one of its standard configuration formats, it creates a Java Bean of type <code class="literal">org.jboss.cache.config.Configuration</code> with a tree of child Java Beans for some of the more complex sub-configurations (i.e. cache loading, eviction, buddy replication). Rather than delegating this task of XML parsing/Java Bean creation to JBC, we let the Enterprise Application Platform's microcontainer do it directly. This has the advantage of making the microcontainer aware of the configuration beans, which in later Enterprise Application Platform 5.x releases will be helpful in allowing external management tools to manage the JBC configurations.
			</div><div class="para">
				The configuration format should be fairly self-explanatory if you look at the standard configurations the Enterprise Application Platform ships; they include all the major elements. The types and properties of the various java beans that make up a JBoss Cache configuration can be seen in the JBoss Cache Javadocs. Here is a fairly complete example:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"StandardSFSBCacheConfig"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!--  No transaction manager lookup --&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Name of cluster. Needs to be the same for all members --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"clusterName"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.partition.name:DefaultPartition}-SFSBCache<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Use a UDP (multicast) based stack. Need JGroups flow control (FC)</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        because we are using asynchronous replication. --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"multiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.default.jgroups.stack:udp}<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"fetchInMemoryState"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"nodeLockingScheme"</span><span xmlns="" class="perl_Keyword">&gt;</span>PESSIMISTIC<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"isolationLevel"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPEATABLE_READ<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cacheMode"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPL_ASYNC<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useLockStriping"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Number of milliseconds to wait until all responses for a</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        synchronous call have been received. Make this longer </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">        than lockAcquisitionTimeout.--&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"syncReplTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>17500<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Max number of milliseconds to wait for a lock acquisition --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lockAcquisitionTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>15000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- The max amount of time (in milliseconds) we wait until the</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    state (ie. the contents of the cache) are retrieved from</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    existing members at startup. --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"stateRetrievalTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>60000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!--</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    SFSBs use region-based marshalling to provide for partial state</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    transfer during deployment/undeployment.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">   --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"useRegionBasedMarshalling"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Must match the value of "useRegionBasedMarshalling" --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"inactiveOnStartup"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Disable asynchronous RPC marshalling/sending --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"serializationExecutorPoolSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>        
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- We have no asynchronous notification listeners --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"listenerAsyncPoolSize"</span><span xmlns="" class="perl_Keyword">&gt;</span>0<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"exposeManagementStatistics"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyReplicationConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.BuddyReplicationConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!--  Just set to true to turn on buddy replication --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"enabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- A way to specify a preferred replication group.  We try</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">              and pick a buddy who shares the same pool name (falling </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">              back to other buddies if not available). --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyPoolName"</span><span xmlns="" class="perl_Keyword">&gt;</span>default<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyCommunicationTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>17500<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- Do not change these --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"autoDataGravitation"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dataGravitationRemoveOnFind"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dataGravitationSearchBackupTrees"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyLocatorConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.buddyreplication.NextMemberBuddyLocatorConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Comment">&lt;!-- The number of backup nodes we maintain --&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"numBuddies"</span><span xmlns="" class="perl_Keyword">&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Comment">&lt;!-- Means that each node will *try* to select a buddy on </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">                    a different physical host. If not able to do so </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">                    though, it will fall back to colocated nodes. --&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ignoreColocatedBuddies"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cacheLoaderConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.CacheLoaderConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Comment">&lt;!-- Do not change these --&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"passivation"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"shared"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>             
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"individualCacheLoaderConfigs"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;list&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.loader.FileCacheLoaderConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Comment">&lt;!-- Where passivated sessions are stored --&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"location"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.server.data.dir}${/}sfsb<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Comment">&lt;!-- Do not change these --&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"async"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"fetchPersistentState"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"purgeOnStartup"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ignoreModifications"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                     <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"checkCharacterPortability"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;/list&gt;</span>
<span xmlns="" class="line">​</span>             <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- EJBs use JBoss Cache eviction --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"evictionConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.EvictionConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"wakeupInterval"</span><span xmlns="" class="perl_Keyword">&gt;</span>5000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!--  Overall default --&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"defaultEvictionRegionConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.EvictionRegionConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"regionName"</span><span xmlns="" class="perl_Keyword">&gt;</span>/<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"evictionAlgorithmConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.eviction.NullEvictionAlgorithmConfig"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Comment">&lt;!-- EJB3 integration code will programatically create</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">              other regions as beans are deployed --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre><div class="para">
				Basically, the XML specifies the creation of an <code class="literal">org.jboss.cache.config.Configuration</code> java bean and the setting of a number of properties on that bean. Most of the properties are of simple types, but some, such as <code class="literal">buddyReplicationConfig</code> and <code class="literal">cacheLoaderConfig</code> take various types java beans as their values.
			</div><div class="para">
				Next we will look at some of the key configuration options.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-cachemode">
      ⁠</a>29.1.2. Cache Mode</h2></div></div></div><div class="para">
				JBoss Cache's <code class="literal">cacheMode</code> configuration attribute combines into a single property two related aspects:
			</div><div class="para">
				<span class="bold bold"><strong>Handling of Cluster Updates</strong></span>
			</div><div class="para">
				This controls how a cache instance on one node should notify the rest of the cluster when it makes changes in its local state. There are three options: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Synchronous</strong></span> means the cache instance sends a message to its peers notifying them of the change(s) and before returning waits for them to acknowledge that they have applied the same changes. If the changes are made as part of a JTA transaction, this is done as part of a two-phase commit process during transaction commit. Any locks are held until this acknowledgment is received. Waiting for acknowledgement from all nodes adds delays, but it ensures consistency around the cluster. Synchronous mode is needed when all the nodes in the cluster may access the cached data resulting in a high need for consistency.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Asynchronous</strong></span> means the cache instance sends a message to its peers notifying them of the change(s) and then immediately returns, without any acknowledgement that they have applied the same changes. It <span class="emphasis"><em>does not</em></span> mean sending the message is handled by some other thread besides the one that changed the cache content; the thread that makes the change still spends some time dealing with sending messages to the cluster, just not as much as with synchronous communication. Asynchronous mode is most useful for cases like session replication, where the cache doing the sending expects to be the only one that accesses the data and the cluster messages are used to provide backup copies in case of failure of the sending node. Asynchronous messaging adds a small risk that a later user request that fails over to another node may see out-of-date state, but for many session-type applications this risk is acceptable given the major performance benefits asynchronous mode has over synchronous mode.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Local</strong></span> means the cache instance does not send a message at all. A JGroups channel is not even used by the cache. JBoss Cache has many useful features besides its clustering capabilities and is a very useful caching library even when not used in a cluster. Also, even in a cluster, some cached data does not need to be kept consistent around the cluster, in which case Local mode will improve performance. Caching of JPA/Hibernate query result sets is an example of this; Hibernate's second level caching logic uses a separate mechanism to invalidate stale query result sets from the second level cache, so JBoss Cache does not need to send messages around the cluster for a query result set cache.
						</div></li></ul></div>

			</div><div class="para">
				<span class="bold bold"><strong>Replication vs. Invalidation</strong></span>
			</div><div class="para">
				This aspect deals with the content of messages sent around the cluster when a cache changes its local state, i.e. what should the other caches in the cluster do to reflect the change: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Replication</strong></span> means the other nodes should update their state to reflect the new state on the sending node. This means the sending node needs to include the changed state, increasing the cost of the message. Replication is necessary if the other nodes have no other way to obtain the state.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Invalidation</strong></span> means the other nodes should remove the changed state from their local state. Invalidation reduces the cost of the cluster update messages, since only the cache key of the changed state needs to be transmitted, not the state itself. However, it is only an option if the removed state can be retrieved from another source. It is an excellent option for a clustered JPA/Hibernate entity cache, since the cached state can be re-read from the database.
						</div></li></ul></div>

			</div><div class="para">
				These two aspects combine to form 5 valid values for the <code class="literal">cacheMode</code> configuration attribute: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>LOCAL</strong></span> means no cluster messages are needed.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>REPL_SYNC</strong></span> means synchronous replication messages are sent.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>REPL_ASYNC</strong></span> means asynchronous replication messages are sent.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>INVALIDATION_SYNC</strong></span> means synchronous invalidation messages are sent.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>INVALIDATION_ASYNC</strong></span> means asynchronous invalidation messages are sent.
						</div></li></ul></div>

			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-transactions">
      ⁠</a>29.1.3. Transaction Handling</h2></div></div></div><div class="para">
				JBoss Cache integrates with JTA transaction managers to allow transactional access to the cache. When JBoss Cache detects the presence of a transaction, any locks are held for the life of the transaction, changes made to the cache will be reverted if the transaction rolls back, and any cluster-wide messages sent to inform other nodes of changes are deferred and sent in a batch as part of transaction commit (reducing chattiness).
			</div><div class="para">
				Integration with a transaction manager is accomplished by setting the <code class="literal">transactionManagerLookupClass</code> configuration attribute; this specifies the fully qualified class name of a class JBoss Cache can use to find the local transaction manager. Inside JBoss Enterprise Application Platform, this attribute would have one of two values:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>org.jboss.cache.transaction.JBossTransactionManagerLookup</strong></span>
					</div><div class="para">
						This finds the standard transaction manager running in the application server. Use this for any custom caches you deploy where you want caching to participate in any JTA transactions.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>org.jboss.cache.transaction.BatchModeTransactionManagerLookup</strong></span>
					</div><div class="para">
						This is used in the cache configurations used for web session and EJB SFSB caching. It specifies a simple mock <code class="literal">TransactionManager</code> that ships with JBoss Cache called the <code class="literal">BatchModeTransactionManager</code>. This transaction manager is not a true JTA transaction manager and should not be used for anything other than JBoss Cache. Its usage in JBoss Enterprise Application Platform is to get most of the benefits of JBoss Cache's transactional behavior for the session replication use cases, but without getting tangled up with end user transactions that may run during a request.
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-concurrency">
      ⁠</a>29.1.4. Concurrent Access</h2></div></div></div><div class="para">
				JBoss Cache is a thread safe caching API, and uses its own efficient mechanisms of controlling concurrent access. Concurrency is configured via the <code class="literal">nodeLockingScheme</code> and <code class="literal">isolationLevel</code> configuration attributes.
			</div><div class="para">
				There are three choices for <code class="literal">nodeLockingScheme</code>: 
				<div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>MVCC</strong></span> or multi-version concurrency control, is a locking scheme commonly used by modern database implementations to control fast, safe concurrent access to shared data. JBoss Cache 3.x uses an innovative implementation of MVCC as the default locking scheme. MVCC is designed to provide the following features for concurrent access: 
							<div class="itemizedlist"><ul><li class="listitem"><div class="para">
										Readers that do not block writers
									</div></li><li class="listitem"><div class="para">
										Writers that fail fast
									</div></li></ul></div>
							 It achieves this by using data versioning and copying for concurrent writers. The theory is that readers continue reading shared state, while writers copy the shared state, increment a version id, and write that shared state back after verifying that the version is still valid (i.e., another concurrent writer has not changed this state first).
						</div><div class="para">
							MVCC is the recommended choice for JPA/Hibernate entity caching.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>PESSIMISTIC</strong></span> locking involves threads/transactions acquiring either exclusive or non-exclusive locks on nodes before reading or writing. Which is acquired depends on the <code class="literal">isolationLevel</code> (see below) but in most cases a non-exclusive lock is acquired for a read and an exclusive lock is acquired for a write. Pessimistic locking requires considerably more overhead than MVCC and allows lesser concurrency, since reader threads must block until a write has completed and released its exclusive lock (potentially a long time if the write is part of a transaction). A write will also be delayed due to ongoing reads.
						</div><div class="para">
							Generally MVCC is a better choice than PESSIMISTIC, which is deprecated as of JBoss Cache 3.0. But, for the session caching usage in JBoss Enterprise Application Platform 5.0.0, PESSIMISTIC is still the default. This is largely because for the session use case there are generally not concurrent threads accessing the same cache location, so the benefits of MVCC are not as great. 
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>OPTIMISTIC</strong></span> locking seeks to improve upon the concurrency available with PESSIMISTIC by creating a "workspace" for each request/transaction that accesses the cache. Data accessed by the request/transaction (even reads) is <span class="emphasis"><em>copied</em></span> into the workspace, which is adds overhead. All data is versioned; on completion of non-transactional requests or commits of transactions the version of data in the workspace is compared to the main cache, and an exception is raised if there are inconsistencies. Otherwise changes to the workspace are applied to the main cache.
						</div><div class="para">
							OPTIMISTIC locking is deprecated but is still provided to support backward compatibility. Users are encouraged to use MVCC instead, which provides the same benefits at lower cost.
						</div></li></ul></div>

			</div><div class="para">
				The <code class="literal">isolationLevel</code> attribute has two possible values <span class="bold bold"><strong>READ_COMMITTED</strong></span> and <span class="bold bold"><strong>REPEATABLE_READ</strong></span> which correspond in semantic to database-style isolation levels. Previous versions of JBoss Cache supported all 5 database isolation levels, and if an unsupported isolation level is configured, it is either upgraded or downgraded to the closest supported level.
			</div><div class="para">
				REPEATABLE_READ is the default isolation level, to maintain compatibility with previous versions of JBoss Cache. READ_COMMITTED, while providing a slightly weaker isolation, has a significant performance benefit over REPEATABLE_READ.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-jgroups">
      ⁠</a>29.1.5. JGroups Integration</h2></div></div></div><div class="para">
				Each JBoss Cache instance internally uses a JGroups <code class="literal">Channel</code> to handle group communications. Inside JBoss Enterprise Application Platform, we strongly recommend that you use the Enterprise Application Platform's JGroups Channel Factory service  as the source for your cache's <code class="literal">Channel</code>. In this section we discuss how to configure your cache to get it's channel from the Channel Factory; if you wish to configure the channel in some other way see the JBoss Cache documentation.
			</div><div class="para">
				<span class="bold bold"><strong>Caches obtained from the CacheManager Service</strong></span>
			</div><div class="para">
				This is the simplest approach. The CacheManager service already has a reference to the Channel Factory service, so the only configuration task is to configure the name of the JGroups protocol stack configuration to use.
			</div><div class="para">
				If you are configuring your cache via the CacheManager service's <code class="literal">jboss-cache-manager-jboss-beans.xml</code> file (see <a class="xref" href="jbosscache.chapt.html#jbosscache-custom-deployment-cachemgr">Section 29.2.1, “Deployment Via the CacheManager Service”</a>), add the following to your cache configuration, where the value is the name of the protocol stack configuration.:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"multiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span></pre><div class="para">
				<span class="bold bold"><strong>Caches Deployed via a <code class="literal">-jboss-beans.xml</code> File</strong></span>
			</div><div class="para">
				If you are deploying a cache via a JBoss Microcontainer <code class="literal">-jboss-beans.xml</code> file (see <a class="xref" href="jbosscache.chapt.html#jbosscache-custom-deployment-beans.xml">Section 29.2.3, “Deployment Via a <code class="literal">-jboss-beans.xml</code> File”</a>), you need inject a reference to the Channel Factory service as well as specifying the protocol stack configuration:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"runtimeConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.RuntimeConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"muxChannelFactory"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JChannelFactory"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"multiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span></pre><div class="para">
				<span class="bold bold"><strong>Caches Deployed via a <code class="literal">-service.xml</code> File</strong></span>
			</div><div class="para">
				If you are deploying a cache MBean via <code class="literal">-service.xml</code> file (see <a class="xref" href="jbosscache.chapt.html#jbosscache-custom-deployment-service.xml">Section 29.2.2, “Deployment Via a <code class="literal">-service.xml</code> File”</a>), <code class="literal">CacheJmxWrapper</code> is the class of your MBean; that class exposes a <code class="literal">MuxChannelFactory</code> MBean attribute. You dependency inject the Channel Factory service into this attribute, and set the protocol stack name via the <code class="literal">MultiplexerStack</code> attribute:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MuxChannelFactory"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JChannelFactory"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MultiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-eviction">
      ⁠</a>29.1.6. Eviction</h2></div></div></div><div class="para">
				Eviction allows the cache to control memory by removing data (typically the least frequently used data). If you wish to configure eviction for a custom cache, refer to the <em class="citetitle">JBoss Cache User Guide</em> available in the <span class="application"><strong>JBoss Enterprise Application Platform 5</strong></span> documentation suite at <a href="https://access.redhat.com/knowledge/docs/">https://access.redhat.com/knowledge/docs/</a>.
			</div><div class="para">
				For web session caches, eviction should not be configured; the distributable session manager handles eviction itself. For EJB 3 SFSB caches, stick with the eviction configuration in the Enterprise Application Platform's standard <code class="literal">sfsb-cache</code> configuration (see <a class="xref" href="clustering-blocks.chapt.html#clustering-blocks-jbc-cachemanager">Section 21.2.1, “The JBoss Enterprise Application Platform CacheManager Service”</a>). The EJB container will configure eviction itself using the values included in each bean's configuration.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-cacheloaders">
      ⁠</a>29.1.7. Cache Loaders</h2></div></div></div><div class="para">
				Cache loading allows JBoss Cache to store data in a persistent store in addition to what it keeps in memory. This data can either be an overflow, where the data in the persistent store is not reflected in memory. Or it can be a superset of what is in memory, where everything in memory is also reflected in the persistent store, along with items that have been evicted from memory. Which of these two modes is used depends on the setting of the <code class="literal">passivation</code> flag in the JBoss Cache cache loader configuration section. A <code class="literal">true</code> value means the persistent store acts as an overflow area written to when data is evicted from the in-memory cache.
			</div><div class="para">
				If you wish to configure cache loading for a custom cache, see the JBoss Cache documentation for all of the available options. Do not configure cache loading for a JPA/Hibernate cache, as the database itself serves as a persistent store; adding a cache loader is just redundant.
			</div><div class="para">
				The caches used for web session and EJB3 SFSB caching use passivation. Next we will discuss the cache loader configuration for those caches in some detail.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="jbosscache-configuration-cacheloaders-session">
      ⁠</a>29.1.7.1. CacheLoader Configuration for Web Session and SFSB Caches</h3></div></div></div><div class="para">
					HttpSession and SFSB passivation rely on JBoss Cache's Cache Loader passivation for storing and retrieving the passivated sessions. Therefore the cache instance used by your webapp's clustered session manager or your bean's EJB container must be configured to enable Cache Loader passivaton.
				</div><div class="para">
					In most cases you do not need to do anything to alter the cache loader configurations for the standard web session and SFSB caches; the standard JBoss Enterprise Application Platform configurations should suit your needs. The following is a bit more detail in case you are interested or want to change from the defaults.
				</div><div class="para">
					The Cache Loader configuration for the <code class="literal">standard-session-cache</code> config serves as a good example:
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cacheLoaderConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.CacheLoaderConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Comment">&lt;!-- Do not change these --&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"passivation"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"shared"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>          
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"individualCacheLoaderConfigs"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;list&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.loader.FileCacheLoaderConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Comment">&lt;!-- Where passivated sessions are stored --&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"location"</span><span xmlns="" class="perl_Keyword">&gt;</span>${jboss.server.data.dir}${/}session<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Comment">&lt;!-- Do not change these --&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"async"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"fetchPersistentState"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"purgeOnStartup"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ignoreModifications"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>                  <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"checkCharacterPortability"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/list&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/property&gt;</span></pre><div class="para">
					Some explanation:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>passivation</strong></span> property MUST be <code class="literal">true</code>
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>shared</strong></span> property MUST be <code class="literal">false</code>. Do not passivate sessions to a shared persistent store, otherwise if another node activates the session, it will be gone from the persistent store and also gone from memory on other nodes that have passivated it. Backup copies will be lost.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>individualCacheLoaderConfigs</strong></span> property accepts a list of Cache Loader configurations. JBC allows you to chain cache loaders; see the JBoss Cache docs. For the session passivation use case a single cache loader is sufficient.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>class</strong></span> attribute on a cache loader config bean must refer to the configuration class for a cache loader implementation (e.g. <code class="literal">org.jboss.cache.loader.FileCacheLoaderConfig</code> or <code class="literal">org.jboss.cache.loader.JDBCCacheLoaderConfig</code>). See the JBoss Cache documentation for more on the available CacheLoader implementations. If you wish to use JDBCCacheLoader (to persist to a database rather than the file system used by FileCacheLoader) note the comment above about the <code class="literal">shared</code> property. Do not use a shared database, or at least not a shared table in the database. Each node in the cluster must have its own storage location.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>location</strong></span> property for FileCacheLoaderConfig defines the root node of the file system tree where passivated sessions should be stored. The default is to store them in your JBoss Enterprise Application Platform configuration's <code class="literal">data</code> directory.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>async</strong></span> MUST be <code class="literal">false</code> to ensure passivated sessions are promptly written to the persistent store.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>fetchPersistentState</strong></span> property MUST be <code class="literal">true</code> to ensure passivated sessions are included in the set of session backup copies transferred over from other nodes when the cache starts.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>purgeOnStartup</strong></span> should be <code class="literal">true</code> to ensure out-of-date session data left over from a previous shutdown of a server does not pollute the current data set.
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>ignoreModifications</strong></span> should be <code class="literal">false</code>
						</div></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>checkCharacterPortability</strong></span> should be <code class="literal">false</code> as a minor performance optimization.
						</div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-configuration-buddyrepl">
      ⁠</a>29.1.8. Buddy Replication</h2></div></div></div><div class="para">
				Buddy Replication is a JBoss Cache feature that allows you to suppress replicating your data to all instances in a cluster. Instead, each instance picks one or more 'buddies' in the cluster, and only replicates to those specific buddies. This greatly helps scalability as there is no longer a memory and network traffic impact every time another instance is added to a cluster.
			</div><div class="para">
				If the cache on another node needs data that it does not have locally, it can ask the other nodes in the cluster to provide it; nodes that have a copy will provide it as part of a process called "data gravitation". The new node will become the owner of the data, placing a backup copy of the data on its buddies. The ability to gravitate data means there is no need for all requests for data to occur on a node that has a copy of it; any node can handle a request for any data. However, data gravitation is expensive and should not be a frequent occurrence; ideally it should only occur if the node that is using some data fails or is shut down, forcing interested clients to fail over to a different node. This makes buddy replication primarily useful for session-type applications with session affinity (a.k.a. "sticky sessions") where all requests for a particular session are normally handled by a single server.
			</div><div class="para">
				Buddy replication can be enabled for the web session and EJB3 SFSB caches. Do not add buddy replication to the cache configurations used for other standard clustering services (e.g. JPA/Hibernate caching). Services not specifically engineered for buddy replication are highly unlikely to work correctly if it is introduced.
			</div><div class="para">
				Configuring buddy replication is fairly straightforward. As an example we will look at the buddy replication configuration section from the CacheManager service's <code class="literal">standard-session-cache</code> config:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyReplicationConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.BuddyReplicationConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>               
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!--  Just set to true to turn on buddy replication --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"enabled"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- A way to specify a preferred replication group.  We try</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">           and pick a buddy who shares the same pool name (falling </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">           back to other buddies if not available). --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyPoolName"</span><span xmlns="" class="perl_Keyword">&gt;</span>default<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyCommunicationTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>17500<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Do not change these --&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"autoDataGravitation"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dataGravitationRemoveOnFind"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"dataGravitationSearchBackupTrees"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>               
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"buddyLocatorConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.buddyreplication.NextMemberBuddyLocatorConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- The number of backup copies we maintain --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"numBuddies"</span><span xmlns="" class="perl_Keyword">&gt;</span>1<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Comment">&lt;!-- Means that each node will *try* to select a buddy on </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">                 a different physical host. If not able to do so </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">                 though, it will fall back to colocated nodes. --&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ignoreColocatedBuddies"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/property&gt;</span></pre><div class="para">
				The main things you would be likely to configure are:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="bold bold"><strong>buddyReplicationEnabled</strong></span> — <code class="literal">true</code> if you want buddy replication; <code class="literal">false</code> if data should be replicated to all nodes in the cluster, in which case none of the other buddy replication configurations matter.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>numBuddies</strong></span> — to how many backup nodes should each node replicate its state.
					</div></li><li class="listitem"><div class="para">
						<span class="bold bold"><strong>buddyPoolName</strong></span> — allows logical subgrouping of nodes within the cluster; if possible, buddies will be chosen from nodes in the same buddy pool.
					</div></li></ul></div><div class="para">
				The <code class="literal">ignoreColocatedBuddies</code> switch means that when the cache is trying to find a buddy, it will if possible not choose a buddy on the same physical host as itself. If the only server it can find is running on its own machine, it will use that server as a buddy.
			</div><div class="para">
				Do not change the settings for <code class="literal">autoDataGravitation</code>, <code class="literal">dataGravitationRemoveOnFind</code> and <code class="literal">dataGravitationSearchBackupTrees</code>. Session replication will not work properly if these are changed.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="jbosscache-custom-deployment">
      ⁠</a>29.2. Deploying Your Own JBoss Cache Instance</h1></div></div></div><div class="para">
			It's quite common for users to deploy their own instances of JBoss Cache inside JBoss Enterprise Application Platform for custom use by their applications. In this section we describe the various ways caches can be deployed.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-custom-deployment-cachemgr">
      ⁠</a>29.2.1. Deployment Via the CacheManager Service</h2></div></div></div><div class="para">
				The standard JBoss clustered services that use JBoss Cache obtain a reference to their cache from the Enterprise Application Platform's CacheManager service (see <a class="xref" href="clustering-blocks.chapt.html#clustering-blocks-jbc-cachemanager">Section 21.2.1, “The JBoss Enterprise Application Platform CacheManager Service”</a>). End user applications can do the same thing; here's how.
			</div><div class="para">
				<a class="xref" href="jbosscache.chapt.html#jbosscache-configuration-cachemanager">Section 29.1.1, “Editing the CacheManager Configuration”</a> shows the configuration of the CacheManager's "CacheConfigurationRegistry" bean. To add a new configuration, you would add an additional element inside that bean's <code class="literal">newConfigurations</code> &lt;map&gt;:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CacheConfigurationRegistry"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">      class=</span><span xmlns="" class="perl_String">"org.jboss.ha.cachemanager.DependencyInjectedConfigurationRegistry"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   .....
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"newConfigurations"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;map</span><span xmlns="" class="perl_Others"> keyClass=</span><span xmlns="" class="perl_String">"java.lang.String"</span><span xmlns="" class="perl_Others"> valueClass=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                  
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;entry&gt;&lt;key&gt;</span>my-custom-cache<span xmlns="" class="perl_Keyword">&lt;/key&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;value&gt;</span>          
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MyCustomCacheConfig"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>              
<span xmlns="" class="line">​</span>             .... details of the my-custom-cache configuration
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span> 
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;/value&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/entry&gt;</span>    
<span xmlns="" class="line">​</span>       .....
</pre><div class="para">
				See <a class="xref" href="jbosscache.chapt.html#jbosscache-configuration-cachemanager">Section 29.1.1, “Editing the CacheManager Configuration”</a> for an example configuration.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm139776752040208">
      ⁠</a>29.2.1.1. Accessing the CacheManager</h3></div></div></div><div class="para">
					Once you've added your cache configuration to the CacheManager, the next step is to provide a reference to the CacheManager to your application. There are three ways to do this:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<span class="bold bold"><strong>Dependency Injection</strong></span>
						</div><div class="para">
							If your application uses the JBoss Microcontainer for configuration, the simplest mechanism is to have it inject the CacheManager into your service.
						</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MyService"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"com.example.MyService"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cacheManager"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"CacheManager"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>JNDI Lookup</strong></span>
						</div><div class="para">
							Alternatively, you can find look up the CacheManger is JNDI. It is bound under <code class="literal">java:CacheManager</code>.
						</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.cachemanager.CacheManager;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyService {
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> CacheManager cacheManager;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">start</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>       Context ctx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>       cacheManager = (CacheManager) ctx.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"java:CacheManager"</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre></li><li class="listitem"><div class="para">
							<span class="bold bold"><strong>CacheManagerLocator</strong></span>
						</div><div class="para">
							JBoss Enterprise Application Platform also provides a service locator object that can be used to access the CacheManager.
						</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.cachemanager.CacheManager;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.framework.server.CacheManagerLocator;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyService {
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> CacheManager cacheManager;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">start</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>       CacheManagerLocator locator = CacheManagerLocator.<span xmlns="" class="perl_Function">getCacheManagerLocator</span>();
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// Locator accepts as param a set of JNDI properties to help in lookup;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// this is not necessary inside the Enterprise Application Platform</span>
<span xmlns="" class="line">​</span>       cacheManager = locator.<span xmlns="" class="perl_Function">getCacheManager</span>(<span xmlns="" class="perl_Keyword">null</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre></li></ul></div><div class="para">
					Once a reference to the CacheManager is obtained; usage is simple. Access a cache by passing in the name of the desired configuration. The CacheManager will not start the cache; this is the responsibility of the application. The cache may, however, have been started by another application running in the cache server; the cache may be shared. When the application is done using the cache, it should not stop. Just inform the CacheManager that the cache is no longer being used; the manager will stop the cache when all callers that have asked for the cache have released it.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.cache.Cache;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.cachemanager.CacheManager;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.framework.server.CacheManagerLocator;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyService {
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> CacheManager cacheManager;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Cache cache;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">start</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>       Context ctx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>       cacheManager = (CacheManager) ctx.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"java:CacheManager"</span>);
<span xmlns="" class="line">​</span>       
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// "true" param tells the manager to instantiate the cache if</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// it does not exist yet</span>
<span xmlns="" class="line">​</span>       cache = cacheManager.<span xmlns="" class="perl_Function">getCache</span>(<span xmlns="" class="perl_String">"my-cache-config"</span>, <span xmlns="" class="perl_Keyword">true</span>);
<span xmlns="" class="line">​</span>       
<span xmlns="" class="line">​</span>       cache.<span xmlns="" class="perl_Function">start</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">stop</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>       cacheManager.<span xmlns="" class="perl_Function">releaseCache</span>(<span xmlns="" class="perl_String">"my-cache-config"</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre><div class="para">
					The CacheManager can also be used to access instances of POJO Cache.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.cache.pojo.PojoCache;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.cachemanager.CacheManager;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.jboss.ha.framework.server.CacheManagerLocator;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> MyService {
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> CacheManager cacheManager;
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> PojoCache pojoCache;
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">start</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>       Context ctx = <span xmlns="" class="perl_Keyword">new</span> InitialContext();
<span xmlns="" class="line">​</span>       cacheManager = (CacheManager) ctx.<span xmlns="" class="perl_Function">lookup</span>(<span xmlns="" class="perl_String">"java:CacheManager"</span>);
<span xmlns="" class="line">​</span>       
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// "true" param tells the manager to instantiate the cache if</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Comment">// it does not exist yet</span>
<span xmlns="" class="line">​</span>       pojoCache = cacheManager.<span xmlns="" class="perl_Function">getPojoCache</span>(<span xmlns="" class="perl_String">"my-cache-config"</span>, <span xmlns="" class="perl_Keyword">true</span>);
<span xmlns="" class="line">​</span>       
<span xmlns="" class="line">​</span>       pojoCache.<span xmlns="" class="perl_Function">start</span>();
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">stop</span>() <span xmlns="" class="perl_Keyword">throws</span> Exception {
<span xmlns="" class="line">​</span>       cacheManager.<span xmlns="" class="perl_Function">releaseCache</span>(<span xmlns="" class="perl_String">"my-cache-config"</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-custom-deployment-service.xml">
      ⁠</a>29.2.2. Deployment Via a <code class="literal">-service.xml</code> File</h2></div></div></div><div class="para">
				As in JBoss Enterprise Application Platform 4.x, you can also deploy a JBoss Cache instance as an MBean service via a <code class="literal">-service.xml</code> file. The primary difference from JBoss Enterprise Application Platform 4.x is the value of the <code class="literal">code</code> attribute in the <code class="literal">mbean</code> element. In JBoss Enterprise Application Platform 4.x, this was <code class="literal">org.jboss.cache.TreeCache</code>; in JBoss Enterprise Application Platform 5.x it is <code class="literal">org.jboss.cache.jmx.CacheJmxWrapper</code>. Here's an example:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;server&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;mbean</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.cache.jmx.CacheJmxWrapper"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         name=</span><span xmlns="" class="perl_String">"foo:service=ExampleCacheJmxWrapper"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"TransactionManagerLookupClass"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>       org.jboss.cache.transaction.JBossTransactionManagerLookup
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MuxChannelFactory"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JChannelFactory"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"MultiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ClusterName"</span><span xmlns="" class="perl_Keyword">&gt;</span>Example-EntityCache<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>        
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"IsolationLevel"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPEATABLE_READ<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"CacheMode"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPL_SYNC<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"InitialStateRetrievalTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>15000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SyncReplTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>20000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"LockAcquisitionTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>15000<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;attribute</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExposeManagementStatistics"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/attribute&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/mbean&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/server&gt;</span></pre><div class="para">
				The <code class="literal">CacheJmxWrapper</code> is not the cache itself (i.e. you can not store stuff in it). Rather, as it's name implies, it's a wrapper around an <code class="literal">org.jboss.cache.Cache</code> that handles integration with JMX. <code class="literal">CacheJmxWrapper</code> exposes the <code class="literal">org.jboss.cache.Cache</code> via its <code class="literal">CacheJmxWrapperMBean</code> MBean interfaces <code class="literal">Cache</code> attribute; services that need the cache can obtain a reference to it via that attribute.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="jbosscache-custom-deployment-beans.xml">
      ⁠</a>29.2.3. Deployment Via a <code class="literal">-jboss-beans.xml</code> File</h2></div></div></div><div class="para">
				Much like it can deploy MBean services described with a <code class="literal">-service.xml</code>, JBoss Enterprise Application Platform 5 can also deploy services that consist of Plain Old Java Objects (POJOs) if the POJOs are described using the JBoss Microcontainer schema in a <code class="literal">-jboss-beans.xml</code> file. You create such a file and deploy it, either directly in the <code class="literal">deploy</code> dir, or packaged in an ear or sar. Following is an example:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- First we create a Configuration object for the cache --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleCacheConfig"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Comment">&lt;!-- Externally injected services --&gt;</span>  
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"runtimeConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleCacheRuntimeConfig"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.RuntimeConfig"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"transactionManager"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>               <span xmlns="" class="perl_Keyword">&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"jboss:service=TransactionManager"</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">                       property=</span><span xmlns="" class="perl_String">"TransactionManager"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"muxChannelFactory"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"JChannelFactory"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"multiplexerStack"</span><span xmlns="" class="perl_Keyword">&gt;</span>udp<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"clusterName"</span><span xmlns="" class="perl_Keyword">&gt;</span>Example-EntityCache<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>        
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"isolationLevel"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPEATABLE_READ<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cacheMode"</span><span xmlns="" class="perl_Keyword">&gt;</span>REPL_SYNC<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"initialStateRetrievalTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>15000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"syncReplTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>20000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"lockAcquisitionTimeout"</span><span xmlns="" class="perl_Keyword">&gt;</span>15000<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"exposeManagementStatistics"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- Factory to build the Cache. --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"DefaultCacheFactory"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.DefaultCacheFactory"</span><span xmlns="" class="perl_Keyword">&gt;</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;constructor</span><span xmlns="" class="perl_Others"> factoryClass=</span><span xmlns="" class="perl_String">"org.jboss.cache.DefaultCacheFactory"</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- The cache itself --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleCache"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.Cache"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;constructor</span><span xmlns="" class="perl_Others"> factoryMethod=</span><span xmlns="" class="perl_String">"createCache"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;factory</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"DefaultCacheFactory"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;parameter</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"ExampleCacheConfig"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/parameter&gt;</span>
<span xmlns="" class="line">​</span>          <span xmlns="" class="perl_Keyword">&lt;parameter</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"boolean"</span><span xmlns="" class="perl_Keyword">&gt;</span>false<span xmlns="" class="perl_Keyword">&lt;/false&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/constructor&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleService"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.foo.ExampleService"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cache"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"ExampleCache"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span></pre><div class="para">
				The bulk of the above is the creation of a JBoss Cache <code class="literal">Configuration</code> object; this is the same as what we saw in the configuration of the CacheManager service (see <a class="xref" href="jbosscache.chapt.html#jbosscache-configuration-cachemanager">Section 29.1.1, “Editing the CacheManager Configuration”</a>). In this case we are not using the CacheManager service as a cache factory, so instead we create our own factory bean and then use it to create the cache (the "ExampleCache" bean). The "ExampleCache" is then injected into a (fictitious) service that needs it.
			</div><div class="para">
				An interesting thing to note in the above example is the use of the <code class="literal">RuntimeConfig</code> object. External resources like a <code class="literal">TransactionManager</code> and a JGroups <code class="literal">ChannelFactory</code> that are visible to the microcontainer are dependency injected into the <code class="literal">RuntimeConfig</code>. The assumption here is that in some other deployment descriptor in the Enterprise Application Platform, the referenced beans have already been described.
			</div><div class="para">
				Using the configuration above, the "ExampleCache" cache will not be visible in JMX. Here's an alternate approach that results in the cache being bound into JMX:
			</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;?xml</span> version="1.0" encoding="UTF-8"<span xmlns="" class="perl_Keyword">?&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;deployment</span><span xmlns="" class="perl_Others"> xmlns=</span><span xmlns="" class="perl_String">"urn:jboss:bean-deployer:2.0"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Comment">&lt;!-- First we create a Configuration object for the cache --&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleCacheConfig"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">         class=</span><span xmlns="" class="perl_String">"org.jboss.cache.config.Configuration"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>      .... same as above
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleCacheJmxWrapper"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.jboss.cache.jmx.CacheJmxWrapper"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>         
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX
<span xmlns="" class="line">​</span>      (name="foo:service=ExampleCacheJmxWrapper",
<span xmlns="" class="line">​</span>                  exposedInterface=org.jboss.cache.jmx.CacheJmxWrapperMBean.class, 
<span xmlns="" class="line">​</span>                  registerDirectly=true)
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/annotation&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"configuration"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"ExampleCacheConfig"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>   
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"ExampleService"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.foo.ExampleService"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"cache"</span><span xmlns="" class="perl_Keyword">&gt;&lt;inject</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"ExampleCacheJmxWrapper"</span><span xmlns="" class="perl_Others"> property=</span><span xmlns="" class="perl_String">"cache"</span><span xmlns="" class="perl_Keyword">/&gt;&lt;/property&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/deployment&gt;</span></pre><div class="para">
				Here the "ExampleCacheJmxWrapper" bean handles the task of creating the cache from the configuration. <code class="literal">CacheJmxWrapper</code> is a JBoss Cache class that provides an MBean interface for a cache. Adding an &lt;annotation&gt; element binds the JBoss Microcontainer <code class="literal">@JMX</code> annotation to the bean; that in turn results in JBoss Enterprise Application Platform registering the bean in JXM as part of the deployment process.
			</div><div class="para">
				The actual underlying <code class="literal">org.jboss.cache.Cache</code> instance is available from the <code class="literal">CacheJmxWrapper</code> via its <code class="literal">cache</code> property; the example shows how this can be used to inject the cache into the "ExampleService".
			</div></div></div></div></body></html>