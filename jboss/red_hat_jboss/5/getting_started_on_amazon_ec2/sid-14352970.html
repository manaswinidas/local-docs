<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 6. Launching clustered JBoss Enterprise Application Platform instances</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970">
      ⁠</a>Chapter 6. Launching clustered JBoss Enterprise Application Platform instances</h1></div></div></div><div class="para">
		In this example clustered JBoss Enterprise Application Platform instances are deployed with a simple JMS sender and receiver application.
	</div><div class="para">
		To support the application, a JBoss Enterprise Web Server instance is deployed as a proxy and a Relational Database Service instance is deployed to provide the required MySQL DBMS.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-LaunchclusteredEnterpriseApplicationPlatform">
      ⁠</a>6.1. Launch clustered Enterprise Application Platform</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm140651170843232">
      ⁠</a><p class="title"><strong>Procedure 6.1. Launch clustered EAP</strong></p><ol class="1"><li class="step"><div class="para">
					Create a Relational Database Service instance.
				</div></li><li class="step"><div class="para">
					Create a Virtual Private Cloud (<abbr class="abbrev">VPC</abbr>).
				</div></li><li class="step"><div class="para">
					Launch a JBoss Enterprise Web Server instance to serve as a mod_cluster proxy and a NAT instance for the VPC.
				</div></li><li class="step"><div class="para">
					Configure VPC routing tables for the JBoss Enterprise Application Platform (<abbr class="abbrev">EAP</abbr>) nodes.
				</div></li><li class="step"><div class="para">
					Launch JBoss Enterprise Application Platform nodes.
				</div></li><li class="step"><div class="para">
					Verify the JBoss Enterprise Application Platform cluster.
				</div></li></ol></div><div class="para">
			Detailed instructions on each of these steps are contained in the following sections.
		</div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-CreateaRelationalDatabaseServicedatabaseinstance">
      ⁠</a>6.2. Create a Relational Database Service database instance</h1></div></div></div><div class="para">
			Relational Database Service (RDS) is a convenient service provided by Amazon to easily deploy and manage an RDBMS with failover, back-up and restore capabilities. Currently several versions of Oracle and MySQL database servers are available. This example uses the MySQL database server but JBoss Enterprise Application Platform also supports Oracle Database.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Go to the RDS tab in the AWS console.
				</div></li><li class="step"><div class="para">
					Subscribe to the service if needed.
				</div></li><li class="step"><div class="para">
					Click on "<span class="guilabel"><strong>Launch DB instance</strong></span>".
				</div></li><li class="step"><div class="para">
					Click on <span class="guilabel"><strong>MySQL</strong></span>
				</div><ol class="substeps a"><li class="step"><div class="para">
							Select a version (for example <code class="literal">5.5.12</code>).
						</div></li><li class="step"><div class="para">
							Select <code class="literal">small instance</code>.
						</div></li><li class="step"><div class="para">
							Ensure <em class="parameter"><code>Multi-AZ Deployment</code></em> and <em class="parameter"><code>Auto upgrade</code></em> are <code class="literal">off</code>.
						</div></li><li class="step"><div class="para">
							Set <em class="parameter"><code>Storage</code></em> to 5GB.
						</div></li><li class="step"><div class="para">
							Choose the database administrator's username and password.
						</div></li><li class="step"><div class="para">
							On the next screen choose a database name to be created with the instance.
						</div></li><li class="step"><div class="para">
							On the next screen you can disable back-up and maintenance.
						</div></li><li class="step"><div class="para">
							Confirm your settings.
						</div></li></ol></li></ol></div><div class="para">
			The database should initialize and be ready for use after a few minutes.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
				The above settings are sufficient for this example scenario but for a production environment it is highly recommended that you consider the failover and back-up features.
			</div><div class="para">
				It is good practice to create separate user/password pairs for each application accessing the database. Tune other configuration options according to your application's requirements.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-CreateaVirtualPrivateCloud">
      ⁠</a>6.3. Create a Virtual Private Cloud (<abbr class="abbrev">VPC</abbr>)</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Go to the VPC tab in the AWS console.
				</div></li><li class="step"><div class="para">
					Subscribe to the service if needed.
				</div></li><li class="step"><div class="para">
					Click on "<span class="guilabel"><strong>Create new VPC</strong></span>".
				</div></li><li class="step"><div class="para">
					Choose a VPC with one public and one private subnet.
				</div><ol class="substeps a"><li class="step"><div class="para">
							Set the public subnet to be <code class="literal">10.0.0.0/24</code>.
						</div></li><li class="step"><div class="para">
							Set the private subnet to be <code class="literal">10.0.1.0/24</code>.
						</div></li></ol></li><li class="step"><div class="para">
					Go to <span class="guilabel"><strong>Elastic IPs</strong></span>.
				</div></li><li class="step"><div class="para">
					Create an elastic IP for use by the EWS mod_cluster proxy/NAT instance.
				</div></li><li class="step"><div class="para">
					Go to <span class="guilabel"><strong>Security groups</strong></span> and create a security group to allow all traffic in and out.
				</div></li><li class="step"><div class="para">
					Go to Network ACLs
				</div><ol class="substeps a"><li class="step"><div class="para">
							Create an ACL to allow all traffic in and out.
						</div></li><li class="step"><div class="para">
							Create an ACL to allow all traffic out and traffic in on only TCP ports <code class="literal">22</code>, <code class="literal">8009</code>, <code class="literal">8080</code>, <code class="literal">8443</code> and <code class="literal">16163</code>.
						</div></li></ol></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
				VPC is recommended for a JBoss Enterprise Application Platform cluster setup as it greatly simplifies secure communication between cluster nodes, a JON Server and the mod_cluster proxy. Without a VPC all these communication channels need to be encrypted and authenticated. Please refer to JBoss Enterprise Application Platform for detailed instructions on configuring SSL.
			</div><div class="para">
				Also note that we are using a database external to the VPC in this example. Your security policies may require connection to the database to be encrypted. Please refer to Amazon's <em class="citetitle">RDS FAQ</em> for details about encrypting the database connections.
			</div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-LaunchaJBossEnterpriseWebServerinstancetoserverasamod_clusterproxyandaNATinstancefortheVPC">
      ⁠</a>6.4. Launch a JBoss Enterprise Web Server instance to serve as a mod_cluster proxy and a NAT instance for the VPC</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Create an elastic IP for this instance.
				</div></li><li class="step"><div class="para">
					Select an AMI.
				</div></li><li class="step"><div class="para">
					Go to <span class="guilabel"><strong>Security Group</strong></span> and allow all traffic (use Red Hat Enterprise Linux's built-in firewall capabilities to restrict access if desired).
				</div></li><li class="step"><div class="para">
					Choose "<code class="literal">running</code>" in the public subnet of the VPC.
				</div></li><li class="step"><div class="para">
					Choose a static IP (e.g. <code class="literal">10.0.0.4</code>).
				</div></li><li class="step"><div class="para">
					Put the following in the <span class="guilabel"><strong>User Data:</strong></span> field:
				</div><pre class="programlisting">echo 1 &gt; /proc/sys/net/ipv4/ip_forward
echo 0 &gt; /proc/sys/net/ipv4/conf/all/rp_filter
echo 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter

iptables -I INPUT 4 -s 10.0.1.0/24 -p tcp --dport 7654 -j ACCEPT
iptables -I INPUT 4 -p tcp --dport 80 -j ACCEPT

iptables -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -I FORWARD -s 10.0.1.0/24 -j ACCEPT
iptables -t nat -A POSTROUTING -o eth0 ! -s 10.0.0.4 -j MASQUERADE

# balancer module incompatible with mod_cluster
sed -i -e 's/LoadModule proxy_balancer_module/#\0/' /etc/httpd/conf/httpd.conf

cat &gt; /etc/httpd/conf.d/mod_cluster.conf &lt;&lt; "EOF"
#LoadModule proxy_module modules/mod_proxy.so
#LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so

Listen 7654

# workaround JBPAPP-4557
MemManagerFile /var/cache/mod_proxy/manager

&lt;VirtualHost *:7654&gt;
   &lt;Location /mod_cluster-manager&gt;
      SetHandler mod_cluster-manager
      Order deny,allow
      Deny from all
      Allow from 127.0.0.1
   &lt;/Location&gt;

   &lt;Location /&gt;
      Order deny,allow
      Deny from all
      Allow from 10.
      Allow from 127.0.0.1
   &lt;/Location&gt;

   KeepAliveTimeout 60
   MaxKeepAliveRequests 0
   ManagerBalancerName mycluster
   ServerAdvertise Off
   EnableMCPMReceive On
&lt;/VirtualHost&gt;
EOF

echo "`hostname | sed -e 's/ip-//' -e 'y/-/./'`        `hostname`" &gt;&gt; /etc/hosts

semanage port -a -t http_port_t -p tcp 7654 #add port in the apache port list for the below to work
setsebool -P httpd_can_network_relay 1 #for mod_proxy_cluster to work
chcon -t httpd_config_t -u system_u /etc/httpd/conf.d/mod_cluster.conf
service httpd start</pre></li><li class="step"><div class="para">
					Disable the Amazon EC2 cloud source/destination checking for this instance so it can act as a router.
				</div><div class="procedure"><ol class="1"><li class="step"><div class="para">
							Right-click on the running EWS instance and choose "<span class="guilabel"><strong>Change Source/Dest check</strong></span>".
						</div></li><li class="step"><div class="para">
							Click on <span class="guilabel"><strong>Yes, Disable</strong></span>.
						</div></li></ol></div></li><li class="step"><div class="para">
					Assign the elastic IP to this instance.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-StartingEAPinstancesinacluster">
      ⁠</a>6.5. Starting instances in a cluster</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-EC2clusteringprofiles">
      ⁠</a>6.5.1. EC2 clustering profiles</h2></div></div></div><div class="para">
				The JBoss Enterprise Application Platform AMIs provided by Red Hat feature two additional server profiles called <span class="italics italics">cluster_ec2</span> and <span class="italics italics">mod_cluster-ec2</span>.
			</div><div class="para">
				They both feature the ability to form a cluster inside the EC2 environment where multicast is not available. This is done by configuring <span class="application"><strong>JGroups</strong></span> to use only TCP unicast for cluster communication and <em class="parameter"><code>S3_PING</code></em> as the discovery protocol.
			</div><div class="para">
				Additionally <span class="italics italics">mod_cluster-ec2</span> is pre-configured to easily register with mod_cluster proxies.
			</div><div class="para">
				The following sections describe the additional setup required for <em class="parameter"><code>S3_PING</code></em>, clustering and <span class="application"><strong>mod_cluster</strong></span>.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-VPCprivatesubnetdefaultroute">
      ⁠</a>6.5.2. VPC private subnet default route</h2></div></div></div><div class="para">
				Since JBoss Enterprise Application Platform cluster nodes will be run in the private subnet of the VPC, but cluster nodes require Internet access for S3 connectivity, a default route needs to be set to go through the NAT instance.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Navigate EWS instance in the Amazon AWS console.
					</div></li><li class="step"><div class="para">
						Go to <span class="guimenu"><strong>VPC</strong></span> → <span class="guimenuitem"><strong>route tables</strong></span> and click on the routing table used by the private subnet.
					</div></li><li class="step"><div class="para">
						In the field for a new route enter <code class="literal">0.0.0.0/0</code>.
					</div></li><li class="step"><div class="para">
						Click on "<span class="guilabel"><strong>select a target</strong></span>" and choose "<code class="literal">Enter Instance ID</code>".
					</div></li><li class="step"><div class="para">
						Choose the ID of the running EWS instance.
					</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-IAMsetup">
      ⁠</a>6.5.3. IAM setup</h2></div></div></div><div class="para">
				The <em class="parameter"><code>S3_PING</code></em> protocol, as suggested by its name, uses an S3 bucket to discover other cluster members.
			</div><div class="para">
				The <span class="application"><strong>JGroups</strong></span> versions 2.6.x require Amazon AWS account access and secret keys to authenticate against the S3 service. It is a security risk to enter your main account credentials in the user-data field, store them online or in an AMI.
			</div><div class="para">
				To circumvent this, a separate account can be created using the Amazon IAM feature which would be only granted access to a single S3 bucket:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Go to the IAM tab in the AWS console.
					</div></li><li class="step"><div class="para">
						Click on users and then "<span class="guilabel"><strong>Create New Users</strong></span>".
					</div></li><li class="step"><div class="para">
						Choose a name (<em class="replaceable">jbosscluster</em>, for example) and ensure the "<span class="guilabel"><strong>Generate an access key for each User</strong></span>" option is checked.
					</div></li><li class="step"><div class="para">
						Click "<span class="guilabel"><strong>Download credentials</strong></span>" and save them in a secure location.
					</div></li><li class="step"><div class="para">
						Close the window and click on the newly created user.
					</div></li><li class="step"><div class="para">
						In the summary tab you will see <span class="strong strong"><strong>User ARN</strong></span> (<em class="replaceable">arn:aws:iam::05555555555:user/jbosscluster*</em>, for example). Make a note of this because it's required to set up the S3 bucket.
					</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-S3bucketsetup">
      ⁠</a>6.5.4. S3 bucket setup</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Open the S3 tab in the AWS console.
					</div></li><li class="step"><div class="para">
						Click on "<span class="guilabel"><strong>Create Bucket</strong></span>".
					</div></li><li class="step"><div class="para">
						Choose a name (<em class="replaceable">clusterbucket123</em> for example) and click on <span class="guilabel"><strong>Create</strong></span>.
					</div><div class="para">
						Note that bucket names are unique across the entire S3 so you will not be able to use the chosen name again.
					</div></li><li class="step"><div class="para">
						Right click over the new bucket and choose <span class="guilabel"><strong>Properties</strong></span>.
					</div></li><li class="step"><div class="para">
						In the permissions tab click on "<span class="guilabel"><strong>Add bucket policy</strong></span>".
					</div></li><li class="step"><div class="para">
						If you click on "<span class="guilabel"><strong>New policy</strong></span>" the policy creation wizard will open.
					</div></li><li class="step"><div class="para">
						For ease of completion the following can be pasted into the policy, but be sure to replace <code class="literal">arn:aws:iam::05555555555:user/jbosscluster*</code> with the value noted in the previous procedure:
					</div><pre class="programlisting">{
    "Version": "2008-10-17",
    "Id": "Policy1312228794320",
    "Statement": [
        {
            "Sid": "Stmt1312228781799",
            "Effect": "Allow",
            "Principal": {
                "AWS": [
                    "arn:aws:iam::055555555555:user/jbosscluster"
                ]
            },
            "Action": [
                "s3:ListBucketVersions",
                "s3:GetObjectVersion",
                "s3:ListBucket",
                "s3:PutBucketVersioning",
                "s3:DeleteObject",
                "s3:DeleteObjectVersion",
                "s3:GetObject",
                "s3:ListBucketMultipartUploads",
                "s3:ListMultipartUploadParts",
                "s3:PutObject",
                "s3:GetBucketVersioning"
            ],
            "Resource": [
                "arn:aws:s3:::clusterbucket123/*",
                "arn:aws:s3:::clusterbucket123"
            ]
        }
    ]
}</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-LaunchingtheEAPAMIs">
      ⁠</a>6.5.5. Launching the JBoss Enterprise Application Platform AMIs</h2></div></div></div><div class="para">
				All necessary preparation for running a cluster are now complete. The final task is to put the right configuration in the <span class="guilabel"><strong>User Data</strong></span> field.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
						Select an AMI.
					</div></li><li class="step"><div class="para">
						Choose desired number of instances (this will be the cluster size).
					</div></li><li class="step"><div class="para">
						Choose VPC and instance type.
					</div></li><li class="step"><div class="para">
						Go to Security Group and allow all traffic from the JBoss Enterprise Application Platform cluster subnet (set other restrictions as desired).
					</div></li><li class="step"><div class="para">
						Put the following into the <span class="guilabel"><strong>User Data</strong></span> field:
					</div></li></ol></div><pre class="programlisting">MOD_CLUSTER_PROXY_LIST=10.0.0.4:7654

## clustering setup
JBOSS_JGROUPS_S3_PING_SECRET_ACCESS_KEY=&lt;your secret key&gt;
JBOSS_JGROUPS_S3_PING_ACCESS_KEY=&lt;your access key&gt;
JBOSS_JGROUPS_S3_PING_BUCKET=clusterbucket123

JBOSS_CLUSTER_ID=S3

## database credentials configuration
JAVA_OPTS="$JAVA_OPTS -Ddb.host=instancename.something.rds.amazonaws.com -Ddb.database=mydatabase -Ddb.user=&lt;user&gt; -Ddb.passwd=&lt;pass&gt;"

PORTS_ALLOWED="1024:65535"
JBOSSAS_ADMIN_PASSWORD=&lt;your password for opening admin console&gt;
JBOSS_IP=`hostname` #listen on public/private EC2 IP address

cat&gt; $USER_SCRIPT &lt;&lt; "EOF"
cp /usr/share/java/jboss-ec2-eap-samples/jmssender-1.0.war $JBOSS_DEPLOY_DIR/jmssender.war
cp /usr/share/java/jboss-ec2-eap-samples/mdbtest-1.1.jar $JBOSS_DEPLOY_DIR/
yum -y install mysql-connector-java
yum -y install mysql-connector-java
cp -v /usr/share/java/mysql-connector-java-*.jar /var/lib/jbossas/server/$JBOSSCONF/lib/
## DefaultDS configuration
cd /tmp
rm -f /var/lib/jbossas/server/$JBOSSCONF/deploy/hsqldb-ds.xml /var/lib/jbossas/server/$JBOSSCONF/deploy/messaging/hsqldb-persistence-service.xml
sed -e 's#\("Clustered"&gt;\)false\(&lt;/attribute&gt;\)#\1true\2#' -e 's#\("FailoverOnNodeLeave"&gt;\)false\(&lt;/attribute&gt;\)#\1true\2#' /usr/share/doc/jbossas-&lt;version&gt;/examples/jms/mysql-persistence-service.xml &gt; /var/lib/jbossas/server/$JBOSSCONF/deploy/messaging/mysql-persistence-service.xml
sed -i -e 's#&lt;fk-constraint&gt;false&lt;/fk-constraint&gt;#&lt;fk-constraint&gt;true&lt;/fk-constraint&gt;#' /var/lib/jbossas/server/$JBOSSCONF/conf/standardjbosscmp-jdbc.xml
cat &gt; /var/lib/jbossas/server/$JBOSSCONF/deploy/mysql-ds.xml &lt;&lt; "EODS"
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;datasources&gt;
   &lt;local-tx-datasource&gt;
      &lt;jndi-name&gt;DefaultDS&lt;/jndi-name&gt;
      &lt;connection-url&gt;jdbc:mysql://${db.host}:3306/${db.database}&lt;/connection-url&gt;
      &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
      &lt;user-name&gt;${db.user}&lt;/user-name&gt;
      &lt;password&gt;${db.passwd}&lt;/password&gt;
      &lt;metadata&gt;
         &lt;type-mapping&gt;mySQL&lt;/type-mapping&gt;
      &lt;/metadata&gt;
      &lt;transaction-isolation&gt;TRANSACTION_READ_COMMITTED&lt;/transaction-isolation&gt;
   &lt;/local-tx-datasource&gt;
&lt;/datasources&gt;
EODS

cat &gt; /var/lib/jbossas/server/$JBOSSCONF/deploy/sample-destinations-service.xml &lt;&lt; "EODS"
&lt;server&gt;
  &lt;mbean code="org.jboss.jms.server.destination.TopicService"
      name="jboss.messaging.destination:service=Topic,name=jms/SampleTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends&gt;jboss.messaging:service=PostOffice&lt;/depends&gt;
      &lt;attribute name="JNDIName"&gt;SampleTopic&lt;/attribute&gt;
      &lt;attribute name="Clustered"&gt;true&lt;/attribute&gt;
   &lt;/mbean&gt;
&lt;/server&gt;
EODS

## this will workaround the problem that in a VPC, instance hostname is not resolvable
grep -q 10.0.1.15 /etc/hosts || \
  for (( i=1 ; i&lt;255 ; i++ )); do
     echo -e "10.0.1.$i\tip-10-0-1-$i" ;
  done &gt;&gt; /etc/hosts

EOF</pre><div class="para">
				Running JBoss Enterprise Application Platform cluster in a subnet with network mask smaller than 24 bits or spanning multiple subnets complicates acquiring a unique server peer ID for each cluster member.
			</div><div class="para">
				Please refer to the <em class="parameter"><code>CLUSTER_ID</code></em> variable in <a class="xref" href="sid-14352972.html">Appendix A, <em>User Script Parameters</em></a> for information on how to make such a configuration work reliably.
			</div><div class="para">
				The auto-scaling Amazon EC2 feature can be used with JBoss Enterprise Application Platform cluster nodes. However make sure you test <span class="strong strong"><strong>before</strong></span> deployment. You should ensure that your particular workloads scale to the desired number of nodes and that the performance meets your needs with the the instance type you are planning to use (different instance types receive a different share of the EC2 cloud resources).
			</div><div class="para">
				Furthermore instance locality and current network/storage/host machine/RDS utilization can affect performance of a cluster. Test with your expected real-life loads and try to account for unexpected conditions.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Down-scaling a cluster</strong></p></div><div class="admonition"><div class="para">
					The Amazon EC2 <span class="emphasis"><em>scale-down</em></span> action terminates the nodes without any chance to gracefully shut down, and, as some transactions might be interrupted, other cluster nodes (and load balancers) will need time to fail over. This is likely to impact your application users' experience.
				</div><div class="para">
					It is recommended that you scale down your application cluster manually by disabling the server from the mod_cluster management interface until processed sessions are completed or shutting down the JBoss Enterprise Application Platform instance gracefully (SSH access to the instance or JON can be used).
				</div><div class="para">
					Test that your chosen procedure for scaling-down does not lead to adverse effects on your users' experience. Additional measures might be required for particular workloads, load balancers and setups.
				</div></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sid-14352970_LaunchingclusteredEAPInstances-Verifyingeverythingisconnectedandrunning">
      ⁠</a>6.6. Verifying everything is connected and running</h1></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><div class="para">
					Open <code class="uri">http://<em class="replaceable">&lt;elastic IP of EWS&gt;</em></code> in browser.
				</div></li><li class="step"><div class="para">
					Open <code class="uri">http://<em class="replaceable">&lt;elastic IP of EWS&gt;</em>/jmssender</code> in browser.
				</div><div class="procedure"><ul><li class="step"><div class="para">
							Check that all cluster nodes are logging a message per every <span class="application"><strong>jmssender</strong></span> request (no matter which node <span class="application"><strong>jmssender</strong></span> is opened from).
						</div></li></ul></div></li><li class="step"><div class="para">
					Connect to the JBoss Enterprise Web Server instance:
				</div><pre class="programlisting">ssh -L7654:localhost:7654 &lt;elastic IP of EWS&gt;
</pre></li><li class="step"><div class="para">
					Open <a href="http://localhost:7654/mod_cluster-manager">http://localhost:7654/mod_cluster-manager</a> in a browser.
				</div></li></ol></div><div class="para">
			If these are to be production instances, add the following text to the contents of the User Data field, to ensure that security updates are applied on boot: 
<pre class="programlisting">
yum -y update
</pre>

		</div></div></div></body></html>