<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 20. Participants</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm140019161612048">
      ⁠</a>Chapter 20. Participants</h1></div></div></div><a id="idm140019113476064" class="indexterm"/><a id="idm140019147795232" class="indexterm"/><a id="idm140019168556496" class="indexterm"/><a id="idm140019145589648" class="indexterm"/><a id="idm140019109272592" class="indexterm"/><a id="idm140019157424224" class="indexterm"/><a id="idm140019149772192" class="indexterm"/><a id="idm140019119687200" class="indexterm"/><a id="idm140019115332608" class="indexterm"/><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140019174369424">
      ⁠</a>20.1. Overview</h1></div></div></div><div class="para">
			The <em class="firstterm">participant</em> is the entity that performs the work pertaining to transaction management on behalf of the business services involved in an application. The Web service (in the example code, a theater booking system) contains some business logic to reserve a seat and inquire about availability, but it needs to be supported by something that maintains information in a durable manner. Typically this is a database, but it could be a file system, NVRAM, or other storage mechanism.
		</div><div class="para">
			Although the service may talk to the back-end database directly, it cannot commit or undo any changes, since committing and rolling back are ultimately under the control of a transaction. For the transaction to exercise this control, it must communicate with the database. In XTS, participant does this communication, as shown in <a class="xref" href="ch20.html#fig-participant-backend-control">Figure 20.1, “Transactions, Participants, and Back-End Transaction Control”</a>.
		</div><div class="figure"><a id="fig-participant-backend-control">
      ⁠</a><div class="figure-contents"><div class="mediaobject"><img src="images/fig-participant-backend-control.png" alt="Transactions, Participants, and Back-End Transaction Control"/></div></div><p class="title"><strong>Figure 20.1. Transactions, Participants, and Back-End Transaction Control</strong></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140019157787488">
      ⁠</a>20.1.1. Atomic Transaction</h2></div></div></div><div class="para">
				All Atomic Transaction participants are instances of the <a class="xref" href="ch20.html#sect-Durable2PCParticipant">Section 20.1.1.1, “Durable2PCParticipant”</a> or <a class="xref" href="ch20.html#sect-Volatile2PCParticipant">Section 20.1.1.2, “Volatile2PCParticipant”</a>.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-Durable2PCParticipant">
      ⁠</a>20.1.1.1. Durable2PCParticipant</h3></div></div></div><div class="para">
					A Durable2PCParticipant supports the WS-Atomic Transaction Durable2PC protocol with the signatures listed in <a class="xref" href="ch20.html#list-Durable2PCParticipant-signatures">Durable2PCParticipant Signatures</a>, as per the <code class="interfacename">com.arjuna.wst11.Durable2Participant</code> interface.
				</div><div class="variablelist"><a id="list-Durable2PCParticipant-signatures">
      ⁠</a><p class="title"><strong>Durable2PCParticipant Signatures</strong></p><dl class="variablelist"><dt><span class="term"><code class="methodname">prepare</code></span></dt><dd><div class="para">
								The participant should perform any work necessary, so that it can either commit or roll back the work performed by the Web service under the scope of the transaction. The implementation is free to do whatever it needs to in order to fulfill the implicit contract between it and the coordinator.
							</div><div class="para">
								The participant indicates whether it can <code class="systemitem">prepare</code> by returning an instance of the <code class="interfacename">com.arjuna.wst11.Vote</code>, with one of three values.
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
										<code class="literal">ReadOnly</code> indicates that the participant does not need to be informed of the transaction outcome, because it did not update any state information.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">Prepared</code> indicates that the participant is ready to commit or roll back, depending on the final transaction outcome. Sufficient state updates have been made persistent to accomplish this.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">Aborted</code> indicates that the participant has aborted and the transaction should also attempt to do so.
									</div></li></ul></div></dd><dt><span class="term"><code class="methodname">commit</code></span></dt><dd><div class="para">
								The participant should make its work permanent. How it accomplishes this depends upon its implementation. For instance, in the theater example, the reservation of the ticket is committed. If commit processing cannot complete, the participant should throw a <code class="systemitem">SystemException</code> error, potentially leading to a heuristic outcome for the transaction.
							</div></dd><dt><span class="term"><code class="methodname">rollback</code></span></dt><dd><div class="para">
								The participant should undo its work. If rollback processing cannot complete, the participant should throw a <code class="systemitem">SystemException</code> error, potentially leading to a heuristic outcome for the transaction.
							</div></dd><dt><span class="term"><code class="methodname">unknown</code></span></dt><dd><div class="para">
								This method has been deprecated and is slated to be removed from XTS in the future.
							</div></dd><dt><span class="term"><code class="methodname">error</code></span></dt><dd><div class="para">
								In rare cases when recovering from a system crash, it may be impossible to complete or roll back a previously prepared participant, causing the <code class="methodname">error</code> operation to be invoked.
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-Volatile2PCParticipant">
      ⁠</a>20.1.1.2. Volatile2PCParticipant</h3></div></div></div><div class="para">
					This participant supports the WS-Atomic Transaction Volatile2PC protocol with the signatures listed in <a class="xref" href="ch20.html#list-Volatile2PCParticipant-signatures">Volatile2PCParticipant Signatures</a>, as per the <code class="interfacename">com.arjuna.wst11.Volatile2Participant</code> interface.
				</div><div class="variablelist"><a id="list-Volatile2PCParticipant-signatures">
      ⁠</a><p class="title"><strong>Volatile2PCParticipant Signatures</strong></p><dl class="variablelist"><dt><span class="term"><code class="methodname">prepare</code></span></dt><dd><div class="para">
								The participant should perform any work necessary to flush any volatile data created by the Web service under the scope of the transaction, to the system store. The implementation is free to do whatever it needs to in order to fulfill the implicit contract between it and the coordinator.
							</div><div class="para">
								The participant indicates whether it can <code class="systemitem">prepare</code> by returning an instance of the <code class="interfacename">com.arjuna.wst11.Vote</code>, with one of three values.
							</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
										<code class="literal">ReadOnly</code> indicates that the participant does not need to be informed of the transaction outcome, because it did not change any state information during the life of the transaction.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">Prepared</code> indicates that the participant wants to be notified of the final transaction outcome via a call to <code class="methodname">commit</code> or <code class="methodname">rollback</code>.
									</div></li><li class="listitem"><div class="para">
										<code class="literal">Aborted</code> indicates that the participant has aborted and the transaction should also attempt to do so.
									</div></li></ul></div></dd><dt><span class="term">commit</span></dt><dd><div class="para">
								The participant should perform any cleanup activities required, in response to a successful transaction commit. These cleanup activities depend upon its implementation. For instance, it may flush cached backup copies of data modified during the transaction. In the unlikely event that commit processing cannot complete, the participant should throw a <code class="systemitem">SystemException</code> error. This will not affect the outcome of the transaction but will cause an error to be logged. This method may not be called if a crash occurs during commit processing.
							</div></dd><dt><span class="term">rollback</span></dt><dd><div class="para">
								The participant should perform any cleanup activities required, in response to a transaction abort. In the unlikely event that rollback processing cannot complete, the participant should throw a <code class="systemitem">SystemException</code> error. This will not affect the outcome of the transaction but will cause an error to be logged. This method may not be called if a crash occurs during commit processing.
							</div></dd><dt><span class="term">unknown</span></dt><dd><div class="para">
								This method is deprecated and will be removed in a future release of XTS.
							</div></dd><dt><span class="term">error</span></dt><dd><div class="para">
								This method should never be called, since volatile participants are not involved in recovery processing.
							</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140019175978720">
      ⁠</a>20.1.2. Business Activity</h2></div></div></div><div class="para">
				All Business Activity participants are instances one or the other of the interfaces described in <a class="xref" href="ch20.html#sect-BusinessAgreementWithParticipantCompletion">Section 20.1.2.1, “BusinessAgreementWithParticipantCompletion”</a> or <a class="xref" href="ch20.html#sect-BusinessAgreementWithCoordinatorCompletion">Section 20.1.2.2, “BusinessAgreementWithCoordinatorCompletion”</a> interface.
			</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-BusinessAgreementWithParticipantCompletion">
      ⁠</a>20.1.2.1. BusinessAgreementWithParticipantCompletion</h3></div></div></div><div class="para">
					The <code class="interfacename">BusinessAgreementWithParticipantCompletion</code> interface supports the WS-Transactions <code class="systemitem">BusinessAgreementWithParticipantCompletion</code> protocol with the signatures listed in <a class="xref" href="ch20.html#list-BusinessAgreementWithParticipantCompletion"><code class="interfacename">BusinessAgreementWithParticipantCompletion</code> Signatures</a>, as per interface <code class="interfacename">com.arjuna.wst11.BusinessAgreementWithParticipantCompletionParticipant</code>.
				</div><div class="variablelist"><a id="list-BusinessAgreementWithParticipantCompletion">
      ⁠</a><p class="title"><strong><code class="interfacename">BusinessAgreementWithParticipantCompletion</code> Signatures</strong></p><dl class="variablelist"><dt><span class="term"><code class="methodname">close</code></span></dt><dd><div class="para">
								The transaction has completed successfully. The participant has previously informed the coordinator that it was ready to complete.
							</div></dd><dt><span class="term"><code class="methodname">cancel</code></span></dt><dd><div class="para">
								The transaction has canceled, and the participant should undo any work. The participant cannot have informed the coordinator that it has completed.
							</div></dd><dt><span class="term"><code class="methodname">compensate</code></span></dt><dd><div class="para">
								The transaction has canceled. The participant previously informed the coordinator that it had finished work but could compensate later if required, and it is now requested to do so. If compensation cannot be performed, the participant should throw a <code class="systemitem">FaultedException</code> error, potentially leading to a heuristic outcome for the transaction. If compensation processing cannot complete because of a transient condition then the participant should throw a <code class="systemitem">SystemException</code> error, in which case the compensation action may be retried or the transaction may finish with a heuristic outcome.
							</div></dd><dt><span class="term"><code class="methodname">status</code></span></dt><dd><div class="para">
								Return the status of the participant.
							</div></dd><dt><span class="term"><code class="methodname">unknown</code></span></dt><dd><div class="para">
								This method is deprecated and will be removed a future XTS release.
							</div></dd><dt><span class="term">error</span></dt><dd><div class="para">
								In rare cases when recovering from a system crash, it may be impossible to compensate a previously-completed participant. In such cases the <code class="methodname">error</code> operation is invoked.
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-BusinessAgreementWithCoordinatorCompletion">
      ⁠</a>20.1.2.2. BusinessAgreementWithCoordinatorCompletion</h3></div></div></div><div class="para">
					The BusinessAgreementWithCoordinatorCompletion participant supports the WS-Transactions <code class="systemitem">BusinessAgreementWithCoordinatorCompletion</code> protocol with the signatures listed in <a class="xref" href="ch20.html#list-BusinessAgreementWithCoordinatorCompletion-signatures">BusinessAgreementWithCoordinatorCompletion Signatures</a>, as per the <code class="interfacename">com.arjuna.wst11.BusinessAgreementWithCoordinatorCompletionParticipant</code> interface.
				</div><div class="variablelist"><a id="list-BusinessAgreementWithCoordinatorCompletion-signatures">
      ⁠</a><p class="title"><strong>BusinessAgreementWithCoordinatorCompletion Signatures</strong></p><dl class="variablelist"><dt><span class="term"><code class="methodname">close</code></span></dt><dd><div class="para">
								The transaction completed successfully. The participant previously informed the coordinator that it was ready to complete.
							</div></dd><dt><span class="term"><code class="methodname">cancel</code></span></dt><dd><div class="para">
								The transaction canceled, and the participant should undo any work.
							</div></dd><dt><span class="term"><code class="methodname">compensate</code></span></dt><dd><div class="para">
								The transaction canceled. The participant previously informed the coordinator that it had finished work but could compensate later if required, and it is now requested to do so. In the unlikely event that compensation cannot be performed the participant should throw a <code class="systemitem">FaultedException</code> error, potentially leading to a heuristic outcome for the transaction. If compensation processing cannot complete because of a transient condition, the participant should throw a <code class="systemitem">SystemException</code> error, in which case the compensation action may be retried or the transaction may finish with a heuristic outcome.
							</div></dd><dt><span class="term"><code class="methodname">complete</code></span></dt><dd><div class="para">
								The coordinator is informing the participant all work it needs to do within the scope of this business activity has been completed and that it should make permanent any provisional changes it has made.
							</div></dd><dt><span class="term"><code class="methodname">status</code></span></dt><dd><div class="para">
								Returns the status of the participant.
							</div></dd><dt><span class="term"><code class="methodname">unknown</code></span></dt><dd><div class="para">
								This method is deprecated and will be removed in a future release of XTS.
							</div></dd><dt><span class="term"><code class="methodname">error</code></span></dt><dd><div class="para">
								In rare cases when recovering from a system crash, it may be impossible to compensate a previously completed participant. In such cases, the <code class="methodname">error</code> method is invoked.
							</div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140019168916096">
      ⁠</a>20.1.2.3. BAParticipantManager</h3></div></div></div><div class="para">
					In order for the Business Activity protocol to work correctly, the participants must be able to autonomously notify the coordinator about changes in their status. Unlike the Atomic Transaction protocol, where all interactions between the coordinator and participants are instigated by the coordinator when the transaction terminates, the BAParticipantManager interaction pattern requires the participant to be able to talk to the coordinator at any time during the lifetime of the business activity.
				</div><div class="para">
					Whenever a participant is registered with a business activity, it receives a handle on the coordinator. This handle is an instance of interface com.arjuna.wst11.BAParticipantManager with the methods listed in <a class="xref" href="ch20.html#list-BAParticipantManager">BAParticipantManager Methods</a>.
				</div><div class="variablelist"><a id="list-BAParticipantManager">
      ⁠</a><p class="title"><strong>BAParticipantManager Methods</strong></p><dl class="variablelist"><dt><span class="term"><code class="methodname">exit</code></span></dt><dd><div class="para">
								The participant uses the method <code class="methodname">exit</code> to inform the coordinator that it has left the activity. It will not be informed when and how the business activity terminates. This method may only be invoked while the participant is in the <code class="systemitem">active</code> state (or the <code class="systemitem">completing</code> state, in the case of a participant registered for the <code class="systemitem">ParticipantCompletion</code> protocol). If it is called when the participant is in any other state, a <code class="systemitem">WrongStateException</code> error is thrown. An <code class="methodname">exit</code> does not stop the activity as a whole from subsequently being closed or canceled/compensated, but only ensures that the exited participant is no longer involved in completion, close or compensation of the activity.
							</div></dd><dt><span class="term"><code class="methodname">completed</code></span></dt><dd><div class="para">
								The participant has completed its work, but wishes to continue in the business activity, so that it will eventually be informed when, and how, the activity terminates. The participant may later be asked to compensate for the work it has done or learn that the activity has been closed.
							</div></dd><dt><span class="term"><code class="methodname">fault</code></span></dt><dd><div class="para">
								The participant encountered an error during normal activation and has done whatever it can to compensate the activity. The <code class="methodname">fault</code> method places the business activity into a mandatory <code class="systemitem">cancel-only</code> mode. The faulted participant is no longer involved in completion, close or compensation of the activity.
							</div></dd></dl></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm140019119936176">
      ⁠</a>20.2. Participant Creation and Deployment</h1></div></div></div><div class="para">
			The participant provides the plumbing that drives the transactional aspects of the service. This section discusses the specifics of Participant programming and usage.
		</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140019119934768">
      ⁠</a>20.2.1. Implementing Participants</h2></div></div></div><div class="para">
				Implementing a participant is a relatively straightforward task. However, depending on the complexity of the transactional infrastructure that the participant needs to manage, the task can vary greatly in complexity and scope. Your implementation needs to implement one of the interfaces found under <span class="package">com.arjuna.wst11</span>.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
					The corresponding participant interfaces used in the 1.0 protocol implementation are located in package <code class="code">com.arjuna.wst</code>.
				</div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140019147041296">
      ⁠</a>20.2.2. Deploying Participants</h2></div></div></div><div class="para">
				Transactional web services and transactional clients are deployed by placing them in the application server deploy directory alongside the XTS service archive (SAR). The SAR exports all the client and web service API classes needed to manage transactions and enroll and manage participant web services. It provides implementations of all the WS-C and WS-T coordination services, not just the coordinator services. In particular, it exposes the client and web service participant endpoints which are needed to receive incoming messages originating from the coordinator.
			</div><div class="para">
				Normally, a transactional application client and the transaction web service it invokes will be deployed in different application servers. As long as the XTS SAR is deployed to each of these containers XTS will transparently route coordination messages from clients or web services to their coordinator and vice versa. When the the client begins a transaction by default it creates a context using the coordination services in its local container. The context holds a reference to the local Registration Service which means that any web services enlisted in the transaction enroll with the coordination services in the same container."
			</div><div class="para">
				The coordinator does not need to reside in the same container as the client application. By configuring the client deployment appropriately it is possible to use the coordinator services co-located with one of the web services or even to use services deployed in a separate, dedicated container. See Chapter 8 Stand-Alone Coordination for details of how to configure a coordinator located in a different container to the client.
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="warning"><div class="admonition_header"><p><strong>Warning</strong></p></div><div class="admonition"><div class="para">
					In previous releases, XTS applications were deployed using the appropriate XTS and Transaction Manager <code class="filename">.jar</code>, <code class="filename">.war</code>, and configuration files bundled with the application. This deployment method is no longer supported in the Enterprise Application Platform.
				</div></div></div></div></div></div></body></html>