<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 11.  WSS4J security on JBoss</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm139976664637232">
      ⁠</a>Chapter 11.  WSS4J security on JBoss </h1></div></div></div><div class="para">
		Here is a brief chapter on how to use <a class="xref" href="WS_Security.html">Chapter 10, <em>WS-Security</em></a> on JBossWS-CXF. Here you'll find some explanations on how to create a simple application and what you need to do to leverage WSS4J security on JBoss.
	</div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139976639041152">
      ⁠</a>11.1.  Creating the web service endpoint </h1></div></div></div><div class="para">
			First of all you need to create the web service endpoint or client using JAX-WS. This can be achieved in many ways. For instance you might want to:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					Write your endpoint implementation, then run the <code class="command">wsprovide</code> JBoss command line tool which generates the service contract.
				</div></li><li class="listitem"><div class="para">
					Run the <code class="command">wsconsume</code> JBoss command line tool to get the client artifacts from the service contract (top-down approach).
				</div></li><li class="listitem"><div class="para">
					Write your client implementation.
				</div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139976653165264">
      ⁠</a>11.2.  Turn on WS-Security </h1></div></div></div><div class="para">
			WSS4J security is triggered through interceptors that are added to the service and client individually or as required. These interceptors allow you to perform the most common WS-Security related processes:
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
					Pass authentication tokens between services.
				</div></li><li class="listitem"><div class="para">
					Encrypt messages or parts of messages.
				</div></li><li class="listitem"><div class="para">
					Sign messages.
				</div></li><li class="listitem"><div class="para">
					Timestamp messages.
				</div></li></ul></div><div class="para">
			Interceptors can be added either programmatically or through the Spring xml configuration of endpoints. For instance, on server side, you can configure signature and encryption in the <code class="filename">jbossws-cxf.xml</code> file this way:
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/beans'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:xsi=</span><span xmlns="" class="perl_String">'http://www.w3.org/2001/XMLSchema-instance'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:beans=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/beans'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:jaxws=</span><span xmlns="" class="perl_String">'http://cxf.apache.org/jaxws'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xsi:schemaLocation=</span><span xmlns="" class="perl_String">'http://cxf.apache.org/core</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://cxf.apache.org/schemas/core.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://www.springframework.org/schema/beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://cxf.apache.org/jaxws</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://cxf.apache.org/schemas/jaxws.xsd'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"Sign_Request"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;map&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"action"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Timestamp Signature Encrypt"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"signaturePropFile"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"decryptionPropFile"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"passwordCallbackClass"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wsse.KeystorePasswordCallback"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"Sign_Response"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;map&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"action"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Timestamp Signature Encrypt"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"user"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"signaturePropFile"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"encryptionPropFile"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"encryptionUser"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"Alice"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"signatureKeyIdentifier"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"DirectReference"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"passwordCallbackClass"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wsse.KeystorePasswordCallback"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"signatureParts"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"encryptionParts"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"{Element}{http://www.w3.org/2000/09/xmldsig#}Signature;{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"encryptionKeyTransportAlgorithm"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/04/xmlenc#rsa-1_5"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"encryptionSymAlgorithm"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"http://www.w3.org/2001/04/xmlenc#tripledes-cbc"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jaxws:endpoint</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    id=</span><span xmlns="" class="perl_String">'ServiceImpl'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    address=</span><span xmlns="" class="perl_String">'http://@jboss.bind.address@:8080/jaxws-samples-wsse-sign-encrypt'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    implementor=</span><span xmlns="" class="perl_String">'org.jboss.test.ws.jaxws.samples.wsse.ServiceImpl'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jaxws:invoker&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">'org.jboss.wsf.stack.cxf.InvokerJSE'</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/jaxws:invoker&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jaxws:outInterceptors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.cxf.binding.soap.saaj.SAAJOutInterceptor"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ref</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"Sign_Response"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/jaxws:outInterceptors&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jaxws:inInterceptors&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;ref</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"Sign_Request"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.cxf.binding.soap.saaj.SAAJInInterceptor"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/jaxws:inInterceptors&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/jaxws:endpoint&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/beans&gt;</span>
</pre><div class="para">
			This specifies the whole security configuration (including algorithms and elements to be signed or encrypted); moreover it references a properties file (<code class="filename">bob.properties</code>) providing the keystore-related information:
		</div><pre class="screen"> 
org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=password
org.apache.ws.security.crypto.merlin.keystore.alias=bob
org.apache.ws.security.crypto.merlin.file=bob.jks
</pre><div class="para">
			As you can see in the <code class="filename">jbossws-cxf.xml</code> file above, a keystore password callback handler is also configured; while the properties file has the password for the keystore, this callback handler is used to set password for each key (it has to match the one used when each key was imported in the store). Here is an example:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">test</span>.<span xmlns="" class="perl_Function">ws</span>.<span xmlns="" class="perl_Function">jaxws</span>.<span xmlns="" class="perl_Function">samples</span>.<span xmlns="" class="perl_Function">wsse</span>;
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.io.IOException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.HashMap;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.util.Map;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.callback.Callback;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.callback.CallbackHandler;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.callback.UnsupportedCallbackException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.ws.security.WSPasswordCallback;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> KeystorePasswordCallback <span xmlns="" class="perl_Keyword">implements</span> CallbackHandler
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">private</span> Map&lt;String, String&gt; passwords = <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String, String&gt;();
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Function">KeystorePasswordCallback</span>()
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      passwords.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"alice"</span>, <span xmlns="" class="perl_String">"password"</span>);
<span xmlns="" class="line">​</span>      passwords.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"bob"</span>, <span xmlns="" class="perl_String">"password"</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handle</span>(Callback[] callbacks) <span xmlns="" class="perl_Keyword">throws</span> IOException, UnsupportedCallbackException
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">for</span> (<span xmlns="" class="perl_DataType">int</span> i = <span xmlns="" class="perl_Float">0</span>; i &lt; callbacks.<span xmlns="" class="perl_Function">length</span>; i++)
<span xmlns="" class="line">​</span>      {
<span xmlns="" class="line">​</span>         WSPasswordCallback pc = (WSPasswordCallback)callbacks[i];
<span xmlns="" class="line">​</span>         String pass = passwords.<span xmlns="" class="perl_Function">get</span>(pc.<span xmlns="" class="perl_Function">getIdentifer</span>());
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">if</span> (pass != <span xmlns="" class="perl_Keyword">null</span>)
<span xmlns="" class="line">​</span>         {
<span xmlns="" class="line">​</span>            pc.<span xmlns="" class="perl_Function">setPassword</span>(pass);
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">return</span>;
<span xmlns="" class="line">​</span>         }
<span xmlns="" class="line">​</span>      }
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">setAliasPassword</span>(String alias, String password)
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      passwords.<span xmlns="" class="perl_Function">put</span>(alias, password);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}
</pre><div class="para">
			On the client side, you can similarly setup the interceptors programmatically; here is an excerpt of the client for the above described endpoint:
		</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Endpoint cxfEndpoint = client.<span xmlns="" class="perl_Function">getEndpoint</span>();
<span xmlns="" class="line">​</span>Map&lt;String,Object&gt; outProps = <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String,Object&gt;();
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"action"</span>, <span xmlns="" class="perl_String">"Timestamp Signature Encrypt"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"user"</span>, <span xmlns="" class="perl_String">"alice"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"signaturePropFile"</span>, <span xmlns="" class="perl_String">"META-INF/alice.properties"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"signatureKeyIdentifier"</span>, <span xmlns="" class="perl_String">"DirectReference"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"passwordCallbackClass"</span>, <span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wsse.KeystorePasswordCallback"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"signatureParts"</span>, <span xmlns="" class="perl_String">"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"encryptionPropFile"</span>, <span xmlns="" class="perl_String">"META-INF/alice.properties"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"encryptionUser"</span>, <span xmlns="" class="perl_String">"Bob"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"encryptionParts"</span>, <span xmlns="" class="perl_String">"{Element}{http://www.w3.org/2000/09/xmldsig#}Signature;{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"encryptionSymAlgorithm"</span>, <span xmlns="" class="perl_String">"http://www.w3.org/2001/04/xmlenc#tripledes-cbc"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"encryptionKeyTransportAlgorithm"</span>, <span xmlns="" class="perl_String">"http://www.w3.org/2001/04/xmlenc#rsa-1_5"</span>);
<span xmlns="" class="line">​</span>WSS4JOutInterceptor wssOut = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">WSS4JOutInterceptor</span>(outProps); <span xmlns="" class="perl_Comment">//request</span>
<span xmlns="" class="line">​</span>cxfEndpoint.<span xmlns="" class="perl_Function">getOutInterceptors</span>().<span xmlns="" class="perl_Function">add</span>(wssOut);
<span xmlns="" class="line">​</span>cxfEndpoint.<span xmlns="" class="perl_Function">getOutInterceptors</span>().<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SAAJOutInterceptor</span>());
<span xmlns="" class="line">​</span>      
<span xmlns="" class="line">​</span>Map&lt;String,Object&gt; inProps= <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String,Object&gt;();
<span xmlns="" class="line">​</span>inProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"action"</span>, <span xmlns="" class="perl_String">"Timestamp Signature Encrypt"</span>);
<span xmlns="" class="line">​</span>inProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"signaturePropFile"</span>, <span xmlns="" class="perl_String">"META-INF/alice.properties"</span>);
<span xmlns="" class="line">​</span>inProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"passwordCallbackClass"</span>, <span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wsse.KeystorePasswordCallback"</span>);
<span xmlns="" class="line">​</span>inProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"decryptionPropFile"</span>, <span xmlns="" class="perl_String">"META-INF/alice.properties"</span>);
<span xmlns="" class="line">​</span>WSS4JInInterceptor wssIn = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">WSS4JInInterceptor</span>(inProps); <span xmlns="" class="perl_Comment">//response</span>
<span xmlns="" class="line">​</span>cxfEndpoint.<span xmlns="" class="perl_Function">getInInterceptors</span>().<span xmlns="" class="perl_Function">add</span>(wssIn);
<span xmlns="" class="line">​</span>cxfEndpoint.<span xmlns="" class="perl_Function">getInInterceptors</span>().<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SAAJInInterceptor</span>());
</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139976663519840">
      ⁠</a>11.2.1.  Package and deploy </h2></div></div></div><div class="para">
				To deploy your web service endpoint, you need to package the following files along with your service implementation and WSDL contract:
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
						The <code class="filename">jbossws-cxf.xml</code> descriptor.
					</div></li><li class="listitem"><div class="para">
						The properties file.
					</div></li><li class="listitem"><div class="para">
						The keystore file (if required for signature/encryption).
					</div></li><li class="listitem"><div class="para">
						The keystore password callback handler class.
					</div></li></ol></div><div class="para">
				For instance, here are the archive contents for the signature and encryption sample (<acronym class="acronym">POJO</acronym> endpoint) mentioned before:
			</div><pre class="programlisting">
[cxf-tests]$ jar -tvf target/test-libs/jaxws-samples-wsse-sign-encrypt.war 
   0 Tue Jun 03 19:41:26 CEST 2008 META-INF/
 106 Tue Jun 03 19:41:24 CEST 2008 META-INF/MANIFEST.MF
   0 Tue Jun 03 19:41:26 CEST 2008 WEB-INF/
   0 Tue Jun 03 19:41:26 CEST 2008 WEB-INF/classes/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/
1628 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/KeystorePasswordCallback.class
 364 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/ServiceIface.class
 859 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/ServiceImpl.class
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/jaxws/
 685 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/jaxws/SayHello.class
1049 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/org/jboss/test/ws/jaxws/samples/wsse/jaxws/SayHelloResponse.class
2847 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/jbossws-cxf.xml
   0 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/wsdl/
1575 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/wsdl/SecurityService.wsdl
 641 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/wsdl/SecurityService_schema1.xsd
1820 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/bob.jks
 311 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/classes/bob.properties
 573 Tue Jun 03 19:41:24 CEST 2008 WEB-INF/web.xml
</pre><div class="para">
				On client side, instead, you only need the properties and keystore files (assuming you set up the interceptors programmatically). You just need to deploy and test your WS-Security-enabled application.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139976608335264">
      ⁠</a>11.3.  WS-Security Policies </h1></div></div></div><div class="para">
			JBossWS-CXF also includes CXF WS-Security Policy implementation, which can be used to configure WS-Security more easily. Instead of manually configuring interceptors in the client or through the <code class="filename">jbossws-cxf.xml</code> descriptor, you simply provide the right policies in the WSDL contract.
		</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span> ...
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;binding</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"SecurityServicePortBinding"</span><span xmlns="" class="perl_Others"> type=</span><span xmlns="" class="perl_String">"tns:ServiceIface"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;wsp:PolicyReference</span><span xmlns="" class="perl_Others"> URI=</span><span xmlns="" class="perl_String">"#SecurityServiceSignPolicy"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;wsp:Policy</span><span xmlns="" class="perl_Others"> wsu:Id=</span><span xmlns="" class="perl_String">"SecurityServiceSignPolicy"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    xmlns:sp=</span><span xmlns="" class="perl_String">"http://schemas.xmlsoap.org/ws/2005/07/securitypolicy"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;wsp:ExactlyOne&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;wsp:All&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;sp:AsymmetricBinding</span><span xmlns="" class="perl_Others"> xmlns:sp=</span><span xmlns="" class="perl_String">'http://schemas.xmlsoap.org/ws/2005/07/securitypolicy'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;sp:InitiatorToken&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_Keyword">&lt;sp:X509Token</span><span xmlns="" class="perl_Others"> sp:IncludeToken=</span><span xmlns="" class="perl_String">'http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/AlwaysToRecipient'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                                <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                                    <span xmlns="" class="perl_Keyword">&lt;sp:WssX509V3Token10</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                                <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_Keyword">&lt;/sp:X509Token&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;/sp:InitiatorToken&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;sp:RecipientToken&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_Keyword">&lt;sp:X509Token</span><span xmlns="" class="perl_Others"> sp:IncludeToken=</span><span xmlns="" class="perl_String">'http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                                <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                                    <span xmlns="" class="perl_Keyword">&lt;sp:WssX509V3Token10</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                                <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_Keyword">&lt;/sp:X509Token&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;/sp:RecipientToken&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;sp:AlgorithmSuite&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_Keyword">&lt;sp:Basic256</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;/sp:AlgorithmSuite&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;sp:Layout&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                            <span xmlns="" class="perl_Keyword">&lt;sp:Strict</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                        <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;/sp:Layout&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;sp:OnlySignEntireHeadersAndBody</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/sp:AsymmetricBinding&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;sp:Wss10</span><span xmlns="" class="perl_Others"> xmlns:sp=</span><span xmlns="" class="perl_String">'http://schemas.xmlsoap.org/ws/2005/07/securitypolicy'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>                    <span xmlns="" class="perl_Keyword">&lt;sp:MustSupportRefEmbeddedToken</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/sp:Wss10&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;sp:SignedParts</span><span xmlns="" class="perl_Others"> xmlns:sp=</span><span xmlns="" class="perl_String">'http://schemas.xmlsoap.org/ws/2005/07/securitypolicy'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;sp:Body</span> <span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/sp:SignedParts&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;/wsp:All&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/wsp:ExactlyOne&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/wsp:Policy&gt;</span>
<span xmlns="" class="line">​</span>  ...
</pre><div class="para">
			A few properties are also required to be set either in the message context or in the <code class="filename">jbossws-cxf.xml</code> descriptor.
		</div><div xmlns:d="http://docbook.org/ns/docbook" class="orderedlist"><ol><li class="listitem"><div class="para">
					((BindingProvider)proxy).getRequestContext().put(SecurityConstants.CALLBACK_HANDLER, new KeystorePasswordCallback());
				</div></li><li class="listitem"><div class="para">
					((BindingProvider)proxy).getRequestContext().put(SecurityConstants.SIGNATURE_PROPERTIES, Thread.currentThread().getContextClassLoader().getResource("META-INF/alice.properties"));
				</div></li><li class="listitem"><div class="para">
					((BindingProvider)proxy).getRequestContext().put(SecurityConstants.ENCRYPT_PROPERTIES, Thread.currentThread().getContextClassLoader().getResource("META-INF/alice.properties"));
				</div></li></ol></div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/beans'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:xsi=</span><span xmlns="" class="perl_String">'http://www.w3.org/2001/XMLSchema-instance'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:beans=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/beans'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xmlns:jaxws=</span><span xmlns="" class="perl_String">'http://cxf.apache.org/jaxws'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">  xsi:schemaLocation=</span><span xmlns="" class="perl_String">'http://cxf.apache.org/core</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://cxf.apache.org/schemas/core.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://www.springframework.org/schema/beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://cxf.apache.org/jaxws</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">    http://cxf.apache.org/schemas/jaxws.xsd'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;jaxws:endpoint</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    id=</span><span xmlns="" class="perl_String">'ServiceImpl'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    address=</span><span xmlns="" class="perl_String">'http://@jboss.bind.address@:8080/jaxws-samples-wssePolicy-sign'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">    implementor=</span><span xmlns="" class="perl_String">'org.jboss.test.ws.jaxws.samples.wssePolicy.ServiceImpl'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;jaxws:properties&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"ws-security.signature.properties"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"ws-security.encryption.properties"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"bob.properties"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"ws-security.callback-handler"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wssePolicy.KeystorePasswordCallback"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/jaxws:properties&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/jaxws:endpoint&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/beans&gt;</span>
</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sect-Authentication">
      ⁠</a>11.4. Authentication</h1></div></div></div><div class="para">
			Read this section to learn how to authenticate a web service user using a number of available methods.
		</div><div class="task"><a id="task-Authenticate_a_Web_Service_User">
      ⁠</a><p class="title"><strong>Task: Authenticate a Web Service User</strong></p><div class="tasksummary"><a id="idm139976639886864">
      ⁠</a><p class="title"><strong>Task Summary</strong></p><div class="tasksummary-contents"> 
		 <div class="para">
			The following procedure describes how to authenticate a web service user with JBossWS.
		</div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Secure access to the Stateless Session Bean</strong></p><div class="para">
					Secure access to the Stateless Session Bean (SLSB) using the <code class="literal">@RolesAllowed</code>, <code class="literal">@PermitAll</code>, <code class="literal">@DenyAll</code> annotations.
				</div><div class="para">
					The allowed user roles can be set with these annotations both on the bean class and on any of its business methods.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>(<span xmlns="" class="perl_String">"friend"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EndpointEJB <span xmlns="" class="perl_Keyword">implements</span> EndpointInterface
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre></li><li class="step"><p class="title"><strong>Secure POJO endpoints</strong></p><div class="para">
					Secure Plain Old Java Object (POJO) endpoints by defining a <span class="markup">&lt;security-constraint&gt;</span> in the <code class="filename">WEB-INF/web.xml</code> file of the application. The &lt;auth-constraint&gt; &lt;role-name&gt; element specifies whether authentication is mandatory. It can be set to "not required" by specifying an asterisk value in the &lt;role-name&gt; element.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>All resources<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>friend<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-role&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>friend<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-role&gt;</span></pre></li><li class="step"><p class="title"><strong>Define the security domain for EJB3 endpoints</strong></p><div class="para">
					Declare the security domain by appending the @SecurityDomain annotation
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SecurityDomain</span>(<span xmlns="" class="perl_String">"JBossWS"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>(<span xmlns="" class="perl_String">"friend"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EndpointEJB <span xmlns="" class="perl_Keyword">implements</span> EndpointInterface
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre><ul class="stepalternatives">
					<li class="step"><div class="para">
							You can also modify <code class="filename">JBOSS_HOME/server/<em class="replaceable">PROFILE</em>/deploy/jbossws.sar/jboss-management.war/WEB-INF/jboss-web.xml</code> and specify the security domain.
						</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>JBossWS<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span></pre></li>

				</ul><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						For more information about Security Domains, refer to the <em class="citetitle">JBoss Security Guide</em>.
					</div></div></div></li><li class="step"><p class="title"><strong>Define the security domain for POJO endpoints</strong></p><div class="para">
					Modify the <code class="filename">JBOSS_HOME/server/<em class="replaceable">PROFILE</em>/deploy/jbossws.sar/jboss-management.war/WEB-INF/jboss-web.xml</code> and specify the security domain.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>JBossWS<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span>
</pre></li><li class="step"><p class="title"><strong>Define the security context</strong></p><div class="para">
					Configure the security context in the <code class="filename">JBOSS_HOME/server/<em class="replaceable">PROFILE</em>/conf/login-config.xml</code> file.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">&lt;!-- </span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    A template configuration for the JBossWS security domain.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    This defaults to the UsersRolesLoginModule the same as other and should be</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">    changed to a stronger authentication mechanism as required.</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Comment">--&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;application-policy</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JBossWS"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.security.auth.spi.UsersRolesLoginModule"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"usersProperties"</span><span xmlns="" class="perl_Keyword">&gt;</span>props/jbossws-users.properties<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"rolesProperties"</span><span xmlns="" class="perl_Keyword">&gt;</span>props/jbossws-roles.properties<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"unauthenticatedIdentity"</span><span xmlns="" class="perl_Keyword">&gt;</span>anonymous<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/application-policy&gt;</span></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						The default <code class="literal">UsersRolesLoginModule</code> should be changed to another login module that offers security suitable for your enterprise deployment. Follow <a class="xref" href="ch11.html#task-Enable_LDAP_Authentication">Task: Enable LDAP Authentication</a> for steps to use the <span class="package">LdapLoginModule</span> to control user authentication.
					</div></div></div></li><li class="step"><p class="title"><strong>Define HTTP basic authentication for EJB3 endpoints</strong></p><div class="para">
					Use @WebContext annotation on the bean class.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SecurityDomain</span>(<span xmlns="" class="perl_String">"JBossWS"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>(<span xmlns="" class="perl_String">"friend"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">WebContext</span>(contextRoot=<span xmlns="" class="perl_String">"/my-cxt"</span>, urlPattern=<span xmlns="" class="perl_String">"/*"</span>, authMethod=<span xmlns="" class="perl_String">"BASIC"</span>, transportGuarantee=<span xmlns="" class="perl_String">"NONE"</span>, secureWSDLAccess=<span xmlns="" class="perl_Keyword">false</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EndpointEJB <span xmlns="" class="perl_Keyword">implements</span> EndpointInterface
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}
</pre></li><li class="step"><p class="title"><strong>Define HTTP basic authentication for POJO endpoints</strong></p><div class="para">
					Add into WEB-INF/web.xml of your web application
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>BASIC<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;realm-name&gt;</span>Test Realm<span xmlns="" class="perl_Keyword">&lt;/realm-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span>
</pre></li><li class="step"><p class="title"><strong>Client side - set username and password</strong></p><div class="para">
					A web service client can use the <code class="interfacename">javax.xml.ws.BindingProvider</code> interface to set the username and password combination.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>URL wsdlURL = <span xmlns="" class="perl_Keyword">new</span> File(<span xmlns="" class="perl_String">"resources/jaxws/samples/context/WEB-INF/wsdl/TestEndpoint.wsdl"</span>).<span xmlns="" class="perl_Function">toURL</span>();
<span xmlns="" class="line">​</span>QName qname = <span xmlns="" class="perl_Keyword">new</span> QName(<span xmlns="" class="perl_String">"http://org.jboss.ws/jaxws/context"</span>, <span xmlns="" class="perl_String">"TestEndpointService"</span>);
<span xmlns="" class="line">​</span>Service service = Service.<span xmlns="" class="perl_Function">create</span>(wsdlURL, qname);
<span xmlns="" class="line">​</span>port = (TestEndpoint)service.<span xmlns="" class="perl_Function">getPort</span>(TestEndpoint.<span xmlns="" class="perl_Function">class</span>);
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span>BindingProvider bp = (BindingProvider)port;
<span xmlns="" class="line">​</span>bp.<span xmlns="" class="perl_Function">getRequestContext</span>().<span xmlns="" class="perl_Function">put</span>(BindingProvider.<span xmlns="" class="perl_Function">USERNAME_PROPERTY</span>, <span xmlns="" class="perl_String">"jsmith"</span>);
<span xmlns="" class="line">​</span>bp.<span xmlns="" class="perl_Function">getRequestContext</span>().<span xmlns="" class="perl_Function">put</span>(BindingProvider.<span xmlns="" class="perl_Function">PASSWORD_PROPERTY</span>, <span xmlns="" class="perl_String">"PaSSw0rd"</span>);
</pre></li><li class="step"><p class="title"><strong>Client side - WSDL secured</strong></p><div class="para">
					Use java.net.Authenticator to set username and password when accessing wsdl file.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>Authenticator.<span xmlns="" class="perl_Function">setDefault</span>(<span xmlns="" class="perl_Keyword">new</span> Authenticator() {
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">protected</span> PasswordAuthentication <span xmlns="" class="perl_Function">getPasswordAuthentication</span>() {
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">return</span> <span xmlns="" class="perl_Keyword">new</span> PasswordAuthentication(username,password.<span xmlns="" class="perl_Function">toCharArray</span>());
<span xmlns="" class="line">​</span>    }
<span xmlns="" class="line">​</span>});
<span xmlns="" class="line">​</span>Service service = Service.<span xmlns="" class="perl_Function">create</span>(wsdlURL, qname);
</pre></li></ol></div></div><div class="task"><a id="task-Enable_LDAP_Authentication">
      ⁠</a><p class="title"><strong>Task: Enable LDAP Authentication</strong></p><div class="tasksummary"><a id="idm139976608374768">
      ⁠</a><p class="title"><strong>Task Summary</strong></p><div class="tasksummary-contents"> 
		 <div class="para">
			Follow this task to configure Lightweight Directory Access Protocol (LDAP) authentication for a JBossWS application. You use the LdapLoginModule as described in the <em class="citetitle">JBoss Security Guide</em>.
		</div>
		 <div class="para">
			The initial configuration is the same as <a class="xref" href="ch11.html#task-Authenticate_a_Web_Service_User">Task: Authenticate a Web Service User</a>.
		</div>
		 </div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><ol class="1"><li class="step"><p class="title"><strong>Secure access to the Stateless Session Bean</strong></p><div class="para">
					Secure access to the Stateless Session Bean (SLSB) using the <code class="literal">@RolesAllowed</code>, <code class="literal">@PermitAll</code>, <code class="literal">@DenyAll</code> annotations.
				</div><div class="para">
					The allowed user roles can be set with these annotations both on the bean class and on any of its business methods.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>(<span xmlns="" class="perl_String">"friend"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EndpointEJB <span xmlns="" class="perl_Keyword">implements</span> EndpointInterface
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre></li><li class="step"><p class="title"><strong>Secure POJO endpoints</strong></p><div class="para">
					Secure Plain Old Java Object (POJO) endpoints by defining a <span class="markup">&lt;security-constraint&gt;</span> in the <code class="filename">WEB-INF/web.xml</code> file of the application.
				</div><div class="para">
					The <span class="markup">&lt;auth-constraint&gt;</span> <span class="markup">&lt;role-name&gt;</span> element specifies whether authentication is mandatory. It can be set to "not required" by specifying an asterisk (*) value in the &lt;role-name&gt; element.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;security-constraint&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;web-resource-name&gt;</span>All resources<span xmlns="" class="perl_Keyword">&lt;/web-resource-name&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;url-pattern&gt;</span>/*<span xmlns="" class="perl_Keyword">&lt;/url-pattern&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/web-resource-collection&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;auth-constraint&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;role-name&gt;</span>*<span xmlns="" class="perl_Keyword">&lt;/role-name&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/auth-constraint&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/security-constraint&gt;</span>
<span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;login-config&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;auth-method&gt;</span>BASIC<span xmlns="" class="perl_Keyword">&lt;/auth-method&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;realm-name&gt;</span>JBossWS<span xmlns="" class="perl_Keyword">&lt;/realm-name&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/login-config&gt;</span></pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						For more information about valid &lt;auth-method&gt; values, refer to the Web Content Security Constraints section of the <em class="citetitle">JBoss Security Guide</em>.
					</div></div></div></li><li class="step"><p class="title"><strong>Define the security domain</strong></p><div class="para">
					Declare the security domain by appending the @SecurityDomain annotation
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>@Stateless
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">SecurityDomain</span>(<span xmlns="" class="perl_String">"JBossWS"</span>)
<span xmlns="" class="line">​</span>@<span xmlns="" class="perl_Function">RolesAllowed</span>(<span xmlns="" class="perl_String">"friend"</span>)
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> EndpointEJB <span xmlns="" class="perl_Keyword">implements</span> EndpointInterface
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>  ...
<span xmlns="" class="line">​</span>}</pre><ul class="stepalternatives">
					<li class="step"><div class="para">
							You can also modify <code class="filename">JBOSS_HOME/server/<em class="replaceable">PROFILE</em>/deploy/jbossws.sar/jboss-management.war/WEB-INF/jboss-web.xml</code> and specify the security domain.
						</div><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;jboss-web&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;security-domain&gt;</span>JBossWS<span xmlns="" class="perl_Keyword">&lt;/security-domain&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/jboss-web&gt;</span></pre></li>

				</ul><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						For more information about Security Domains, refer to the <em class="citetitle">JBoss Security Guide</em>.
					</div></div></div></li><li class="step"><p class="title"><strong>Define the security context</strong></p><div class="para">
					Configure the security context in the <code class="filename">JBOSS_HOME/server/<em class="replaceable">PROFILE</em>/conf/login-config.xml</code> file.
				</div><pre class="programlisting"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;application-policy</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"JBossWS"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;authentication&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;login-module</span><span xmlns="" class="perl_Others"> code=</span><span xmlns="" class="perl_String">"org.jboss.security.auth.spi.LdapLoginModule"</span><span xmlns="" class="perl_Others"> flag=</span><span xmlns="" class="perl_String">"required"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java.naming.factory.initial"</span><span xmlns="" class="perl_Keyword">&gt;</span>com.sun.jndi.ldap.LdapCtxFactory<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java.naming.provider.url"</span><span xmlns="" class="perl_Keyword">&gt;</span>ldap://ldaphost.jboss.org:1389/<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"java.naming.security.authentication"</span><span xmlns="" class="perl_Keyword">&gt;</span>simple<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"principalDNPrefix"</span><span xmlns="" class="perl_Keyword">&gt;</span>uid=<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"principalDNSuffix"</span><span xmlns="" class="perl_Keyword">&gt;</span>,ou=People,dc=jboss,dc=org<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"rolesCtxDN"</span><span xmlns="" class="perl_Keyword">&gt;</span>ou=Roles,dc=jboss,dc=org<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"uidAttributeID"</span><span xmlns="" class="perl_Keyword">&gt;</span>member<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"matchOnUserDN"</span><span xmlns="" class="perl_Keyword">&gt;</span>true<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"roleAttributeID"</span><span xmlns="" class="perl_Keyword">&gt;</span>cn<span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                   <span xmlns="" class="perl_Keyword">&lt;module-option</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"roleAttributeIsDN"</span><span xmlns="" class="perl_Keyword">&gt;</span>false <span xmlns="" class="perl_Keyword">&lt;/module-option&gt;</span>
<span xmlns="" class="line">​</span>                <span xmlns="" class="perl_Keyword">&lt;/login-module&gt;</span>
<span xmlns="" class="line">​</span>              <span xmlns="" class="perl_Keyword">&lt;/authentication&gt;</span>
<span xmlns="" class="line">​</span>            <span xmlns="" class="perl_Keyword">&lt;/application-policy&gt;</span>
</pre><div class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						Refer to the Security Guide for information about the LdapLoginModule and other available login modules.
					</div></div></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sect-Authentication-Java_Authentication_and_Authorization_Service">
      ⁠</a>11.4.1. Java Authentication and Authorization Service</h2></div></div></div><div class="para">
				Starting EAP 5.1.1 the username token information can be used for Java Authentication and Authorization Service (<abbr class="abbrev">JAAS</abbr>) on JBoss EA
			</div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139976670273680">
      ⁠</a><p class="title"><strong>Procedure 11.1. On the Server</strong></p><ul><li class="step"><p class="title"><strong>Specify Interceptors</strong></p><div class="para">
						Specify (possibly by using a <code class="filename">jbossws-cxf.xml</code> descriptor):
					</div><div class="orderedlist"><ol><li class="listitem"><div class="para">
								An interceptor for performing authentication and populating a valid <code class="literal">SecurityContext</code>; the provided interceptor should extend <code class="literal">org.apache.cxf.ws.security.wss4j.AbstractUsernameTokenAuthenticatingInterceptor</code>.
							</div><div class="para">
								JBossWS integration comes with <code class="literal">org.jboss.wsf.stack.cxf.security.authentication.SubjectCreatingInterceptor</code> for this use.
							</div></li><li class="listitem"><div class="para">
								An interceptor for performing authorization; CXF requires this to extend <code class="literal">org.apache.cxf.interceptor.security.AbstractAuthorizingInInterceptor</code>.
							</div><div class="para">
								For instance, the <code class="literal">SimpleAuthorizingInterceptor</code> can be used for mapping endpoint operations to allowed roles.
							</div></li></ol></div><div class="example"><a id="idm139976640471120">
      ⁠</a><p class="title"><strong>Example 11.1. <code class="literal">SimpleAuthorizingInterceptor</code></strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     xmlns=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/beans'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     xmlns:xsi=</span><span xmlns="" class="perl_String">'http://www.w3.org/2001/XMLSchema-instance'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     xmlns:beans=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/beans'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     xmlns:jaxws=</span><span xmlns="" class="perl_String">'http://cxf.apache.org/jaxws'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     xmlns:util=</span><span xmlns="" class="perl_String">'http://www.springframework.org/schema/util'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">     xsi:schemaLocation=</span><span xmlns="" class="perl_String">'http://cxf.apache.org/core</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://cxf.apache.org/schemas/core.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://www.springframework.org/schema/util</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://www.springframework.org/schema/util/spring-util-2.0.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://www.springframework.org/schema/beans</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://cxf.apache.org/jaxws</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_String">       http://cxf.apache.org/schemas/jaxws.xsd'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"SecurityContextIn"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">        class=</span><span xmlns="" class="perl_String">"org.jboss.wsf.stack.cxf.security.authentication.SubjectCreatingInterceptor"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;map&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"action"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"UsernameToken"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;util:map</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"methodPermissions"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"sayHello"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"friend"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>        <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"greetMe"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"snoopies"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/util:map&gt;</span>
<span xmlns="" class="line">​</span>    
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"AuthorizeIn"</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       class=</span><span xmlns="" class="perl_String">"org.apache.cxf.interceptor.security.SimpleAuthorizingInterceptor"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;property</span><span xmlns="" class="perl_Others"> name=</span><span xmlns="" class="perl_String">"methodRolesMap"</span><span xmlns="" class="perl_Others"> ref=</span><span xmlns="" class="perl_String">"methodPermissions"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span>
<span xmlns="" class="line">​</span>     
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;jaxws:endpoint</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       id=</span><span xmlns="" class="perl_String">'ServiceImpl'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       address=</span><span xmlns="" class="perl_String">'http://@jboss.bind.address@:8080/jaxws-samples-wsse-username-authorize'</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Others">       implementor=</span><span xmlns="" class="perl_String">'org.jboss.test.ws.jaxws.samples.wsse.ServiceImpl'</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;jaxws:inInterceptors&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;ref</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"SecurityContextIn"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;ref</span><span xmlns="" class="perl_Others"> bean=</span><span xmlns="" class="perl_String">"AuthorizeIn"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>           <span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.cxf.binding.soap.saaj.SAAJInInterceptor"</span><span xmlns="" class="perl_Keyword">/&gt;</span>
<span xmlns="" class="line">​</span>       <span xmlns="" class="perl_Keyword">&lt;/jaxws:inInterceptors&gt;</span>
<span xmlns="" class="line">​</span>     <span xmlns="" class="perl_Keyword">&lt;/jaxws:endpoint&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;/beans&gt;</span></pre></div></div><div class="para">
						Authentication and authorization will be delegated to the security domain configured for the endpoint.
					</div></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Login Modules</strong></p></div><div class="admonition"><div class="para">
					You can specify the login module you prefer for that security domain.
				</div><div class="para">
					Refer to the <span class="bold bold"><strong>Login Modules</strong></span> chapter of the <span class="bold bold"><strong>JBoss Enterprise Application Platform Security Guide</strong></span> at <a href="docs.redhat.com">docs.redhat.com</a> for more information on this topic.
				</div></div></div><div xmlns:d="http://docbook.org/ns/docbook" class="procedure"><a id="idm139976639067120">
      ⁠</a><p class="title"><strong>Procedure 11.2. On the Client</strong></p><ol class="1"><li class="step"><div class="para">
						Ensure the username is provided through the API (or a custom <span class="application"><strong>Spring</strong></span> configuration used to load the Bus):
					</div><div class="example"><a id="idm139976639065024">
      ⁠</a><p class="title"><strong>Example 11.2. Username API</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>Endpoint cxfEndpoint = client.<span xmlns="" class="perl_Function">getEndpoint</span>();
<span xmlns="" class="line">​</span>Map&lt;String, Object&gt; outProps = <span xmlns="" class="perl_Keyword">new</span> HashMap&lt;String, Object&gt;();
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"action"</span>, <span xmlns="" class="perl_String">"UsernameToken"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"user"</span>, username);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"passwordType"</span>, <span xmlns="" class="perl_String">"PasswordText"</span>);
<span xmlns="" class="line">​</span>outProps.<span xmlns="" class="perl_Function">put</span>(<span xmlns="" class="perl_String">"passwordCallbackClass"</span>, <span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wsse.UsernamePasswordCallback"</span>);
<span xmlns="" class="line">​</span>WSS4JOutInterceptor wssOut = <span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">WSS4JOutInterceptor</span>(outProps); <span xmlns="" class="perl_Comment">//request</span>
<span xmlns="" class="line">​</span>cxfEndpoint.<span xmlns="" class="perl_Function">getOutInterceptors</span>().<span xmlns="" class="perl_Function">add</span>(wssOut);
<span xmlns="" class="line">​</span>cxfEndpoint.<span xmlns="" class="perl_Function">getOutInterceptors</span>().<span xmlns="" class="perl_Function">add</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">SAAJOutInterceptor</span>());
</pre></div></div></li><li class="step"><div class="para">
						The password instead is provided through a password callback handler that needs to implement <code class="literal">javax.security.auth.callback.CallbackHandler</code>, similarly to the keystore's password callback handler.
					</div><div class="para">
						If you are using an older JBossWS-CXF version, or you are not configuring the application server authorization integration, you can use a password callback handler on server side too, configured through a <code class="literal">WSS4JInInterceptor</code>:
					</div><div class="example"><a id="idm139976603078848">
      ⁠</a><p class="title"><strong>Example 11.3. Callback Handler</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;bean</span><span xmlns="" class="perl_Others"> id=</span><span xmlns="" class="perl_String">"UsernameToken_Request"</span><span xmlns="" class="perl_Others"> class=</span><span xmlns="" class="perl_String">"org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor"</span><span xmlns="" class="perl_Keyword">&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;constructor-arg&gt;</span>
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;map&gt;</span>
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"action"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"UsernameToken"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">&lt;entry</span><span xmlns="" class="perl_Others"> key=</span><span xmlns="" class="perl_String">"passwordCallbackClass"</span><span xmlns="" class="perl_Others"> value=</span><span xmlns="" class="perl_String">"org.jboss.test.ws.jaxws.samples.wsse.ServerUsernamePasswordCallback"</span><span xmlns="" class="perl_Keyword">/&gt;</span> 
<span xmlns="" class="line">​</span>    <span xmlns="" class="perl_Keyword">&lt;/map&gt;</span>
<span xmlns="" class="line">​</span>  <span xmlns="" class="perl_Keyword">&lt;/constructor-arg&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/bean&gt;</span></pre></div></div><div class="example"><a id="idm139976603076896">
      ⁠</a><p class="title"><strong>Example 11.4. <code class="literal">WSS4JInInterceptor</code> callback handler</strong></p><div class="example-contents"><pre class="programlisting"><span xmlns="" class="line">​</span>package org.<span xmlns="" class="perl_Function">jboss</span>.<span xmlns="" class="perl_Function">test</span>.<span xmlns="" class="perl_Function">ws</span>.<span xmlns="" class="perl_Function">jaxws</span>.<span xmlns="" class="perl_Function">samples</span>.<span xmlns="" class="perl_Function">wsse</span>;
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import java.io.IOException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.callback.CallbackHandler;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import javax.security.auth.callback.UnsupportedCallbackException;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">import org.apache.ws.security.WSPasswordCallback;</span>
<span xmlns="" class="line">​</span> 
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_Keyword">class</span> ServerUsernamePasswordCallback <span xmlns="" class="perl_Keyword">implements</span> CallbackHandler
<span xmlns="" class="line">​</span>{
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">public</span> <span xmlns="" class="perl_DataType">void</span> <span xmlns="" class="perl_Function">handle</span>(Callback[] callbacks) <span xmlns="" class="perl_Keyword">throws</span> IOException, UnsupportedCallbackException
<span xmlns="" class="line">​</span>   {
<span xmlns="" class="line">​</span>      WSPasswordCallback pc = (WSPasswordCallback)callbacks[<span xmlns="" class="perl_Float">0</span>];
<span xmlns="" class="line">​</span>      <span xmlns="" class="perl_Keyword">if</span> (!(<span xmlns="" class="perl_String">"kermit"</span>.<span xmlns="" class="perl_Function">equals</span>(pc.<span xmlns="" class="perl_Function">getIdentifier</span>()) &amp;&amp; <span xmlns="" class="perl_String">"thefrog"</span>.<span xmlns="" class="perl_Function">equals</span>(pc.<span xmlns="" class="perl_Function">getPassword</span>())))
<span xmlns="" class="line">​</span>         <span xmlns="" class="perl_Keyword">throw</span> <span xmlns="" class="perl_Keyword">new</span> SecurityException(<span xmlns="" class="perl_String">"User '"</span> + pc.<span xmlns="" class="perl_Function">getIdentifier</span>() + <span xmlns="" class="perl_String">"' with password '"</span> + pc.<span xmlns="" class="perl_Function">getPassword</span>() + <span xmlns="" class="perl_String">"' not allowed."</span>);
<span xmlns="" class="line">​</span>   }
<span xmlns="" class="line">​</span>}</pre></div></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="idm139976603073616">
      ⁠</a>11.5.  Further Information </h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139976603072816">
      ⁠</a>11.5.1.  Samples </h2></div></div></div><div class="para">
				The JBossWS-CXF source distribution comes with some samples using X.509 certificate signature and encryption as well as Username Token Profile. You can find them in package <span class="package">org.jboss.test.ws.jaxws.samples.wsse</span>
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139976604359136">
      ⁠</a>11.5.2.  Username/password configuration </h2></div></div></div><div class="para">
				When using the Username Token Profile, the username and password are provided and verified through two callback handlers that you need to provide. As the keystore password callback handler, they need to implement <span class="package">javax.security.auth.callback.CallbackHandler</span>; they are configured in <code class="filename">jbossws-cxf.xml</code> (or programmatically) through the <code class="varname">passwordCallbackClass</code> attribute.
			</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm139976604356176">
      ⁠</a>11.5.3.  Crypto Algorithms </h2></div></div></div><div class="para">
				When requiring encryption, you might need to install an additional <acronym class="acronym">JCE</acronym> provider supporting the crypto algorithms Apache CXF uses. This usually means the Bouncy Castle provider needs to be configured in your Java Runtime Environment (<acronym class="acronym"> JRE </acronym>). Please refer to the Installing the BouncyCastle JCE provider section of the <em class="citetitle">Administration and Configuration guide</em> for further information about this.
			</div></div></div></div></body></html>